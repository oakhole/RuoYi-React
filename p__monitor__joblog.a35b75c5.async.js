(self.webpackChunkruoyi_react=self.webpackChunkruoyi_react||[]).push([[4070],{82920:function(Ee,V,u){"use strict";u.r(V),u.d(V,{default:function(){return ge}});var ee=u(11849),Fe=u(71194),O=u(50146),Ce=u(57663),w=u(71577),x=u(2824),we=u(34792),p=u(48086),h=u(3182),ae=u(94043),t=u.n(ae),z=u(57119),re=u(73171),$=u(49101),L=u(67294),o=u(43581),te=u(19374),ne=u(66548),S=u(11238);function se(l){return H.apply(this,arguments)}function H(){return H=(0,h.Z)(t().mark(function l(a){var i;return t().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i=new URLSearchParams(a).toString(),n.abrupt("return",(0,S.ZP)("/api/monitor/jobLog/list",{data:a,method:"GET",headers:{"Content-Type":"application/json;charset=UTF-8"}}));case 2:case"end":return n.stop()}},l)})),H.apply(this,arguments)}function xe(l){return request("/api/monitor/jobLog/".concat(l),{method:"GET"})}function Je(l){return D.apply(this,arguments)}function D(){return D=_asyncToGenerator(_regeneratorRuntime.mark(function l(a){return _regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",request("/api/monitor/jobLog",{method:"POST",data:a}));case 1:case"end":return r.stop()}},l)})),D.apply(this,arguments)}function Me(l){return B.apply(this,arguments)}function B(){return B=_asyncToGenerator(_regeneratorRuntime.mark(function l(a){return _regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",request("/api/monitor/jobLog",{method:"PUT",data:a}));case 1:case"end":return r.stop()}},l)})),B.apply(this,arguments)}function N(l){return A.apply(this,arguments)}function A(){return A=(0,h.Z)(t().mark(function l(a){return t().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,S.ZP)("/api/monitor/jobLog/".concat(a),{method:"DELETE",headers:{"Content-Type":"application/json;charset=UTF-8"}}));case 1:case"end":return r.stop()}},l)})),A.apply(this,arguments)}function ue(l){return(0,ne.su)("/api/monitor/jobLog/export",{params:l},"job_log_".concat(new Date().getTime(),".xlsx"))}function oe(){return(0,S.ZP)("/api/monitor/jobLog/clean",{method:"DELETE"})}var Oe=u(98858),T=u(4914),Re=u(9715),le=u(86835),e=u(85893),ie=function(a){var i=le.Z.useForm(),r=(0,x.Z)(i,1),n=r[0],s=a.values,c=a.statusOptions,m=a.jobGroupOptions;(0,L.useEffect)(function(){n.resetFields(),n.setFieldsValue({jobLogId:a.values.jobLogId,jobName:a.values.jobName,jobGroup:a.values.jobGroup,invokeTarget:a.values.invokeTarget,jobMessage:a.values.jobMessage,status:a.values.status,exceptionInfo:a.values.exceptionInfo,createTime:a.values.createTime})},[n,a]);var k=(0,o.YB)(),G=function(){n.submit()},I=function(){a.onCancel(),n.resetFields()};return(0,e.jsx)(O.Z,{width:640,title:k.formatMessage({id:"monitor.JobLog.title",defaultMessage:"\u5B9A\u65F6\u4EFB\u52A1\u8C03\u5EA6\u65E5\u5FD7"}),visible:a.visible,destroyOnClose:!0,onOk:G,onCancel:I,children:(0,e.jsxs)(T.Z,{column:24,children:[(0,e.jsx)(T.Z.Item,{span:12,label:(0,e.jsx)(o._H,{id:"monitor.Job.job_id",defaultMessage:"\u4EFB\u52A1\u7F16\u53F7"}),children:s.jobLogId}),(0,e.jsx)(T.Z.Item,{span:12,label:(0,e.jsx)(o._H,{id:"monitor.Job.create_time",defaultMessage:"\u6267\u884C\u65F6\u95F4"}),children:s.createTime}),(0,e.jsx)(T.Z.Item,{span:12,label:(0,e.jsx)(o._H,{id:"monitor.Job.job_name",defaultMessage:"\u4EFB\u52A1\u540D\u79F0"}),children:s.jobName}),(0,e.jsx)(T.Z.Item,{span:12,label:(0,e.jsx)(o._H,{id:"monitor.Job.job_group",defaultMessage:"\u4EFB\u52A1\u7EC4\u540D"}),children:m[s.jobGroup?s.jobGroup:"DEFAULT"]}),(0,e.jsx)(T.Z.Item,{span:24,label:(0,e.jsx)(o._H,{id:"monitor.Job.invoke_target",defaultMessage:"\u8C03\u7528\u76EE\u6807"}),children:s.invokeTarget}),(0,e.jsx)(T.Z.Item,{span:24,label:(0,e.jsx)(o._H,{id:"monitor.Job.job_message",defaultMessage:"\u65E5\u5FD7\u4FE1\u606F"}),children:s.jobMessage}),(0,e.jsx)(T.Z.Item,{span:24,label:(0,e.jsx)(o._H,{id:"monitor.Job.exception_info",defaultMessage:"\u5F02\u5E38\u4FE1\u606F"}),children:s.exceptionInfo}),(0,e.jsx)(T.Z.Item,{span:12,label:(0,e.jsx)(o._H,{id:"monitor.Job.status",defaultMessage:"\u6267\u884C\u72B6\u6001"}),children:c[s.status?s.status:0]})]})})},ce=ie,W=u(52346),de=u(21349),fe=u(85224),Y=function(){var l=(0,h.Z)(t().mark(function a(i){var r,n;return t().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(r=p.default.loading("\u6B63\u5728\u5220\u9664"),i){c.next=3;break}return c.abrupt("return",!0);case 3:return c.prev=3,c.next=6,N(i.map(function(m){return m.jobLogId}).join(","));case 6:return n=c.sent,r(),n.code===200?p.default.success("\u5220\u9664\u6210\u529F\uFF0C\u5373\u5C06\u5237\u65B0"):p.default.error(n.msg),c.abrupt("return",!0);case 12:return c.prev=12,c.t0=c.catch(3),r(),p.default.error("\u5220\u9664\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5"),c.abrupt("return",!1);case 17:case"end":return c.stop()}},a,null,[[3,12]])}));return function(i){return l.apply(this,arguments)}}(),me=function(){var l=(0,h.Z)(t().mark(function a(){var i,r;return t().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return i=p.default.loading("\u6B63\u5728\u5220\u9664"),s.prev=1,s.next=4,oe();case 4:return r=s.sent,i(),r.code===200?p.default.success("\u5220\u9664\u6210\u529F\uFF0C\u5373\u5C06\u5237\u65B0"):p.default.error(r.msg),s.abrupt("return",!0);case 10:return s.prev=10,s.t0=s.catch(1),i(),p.default.error("\u5220\u9664\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5"),s.abrupt("return",!1);case 15:case"end":return s.stop()}},a,null,[[1,10]])}));return function(){return l.apply(this,arguments)}}(),ve=function(){var l=(0,h.Z)(t().mark(function a(i){var r,n,s;return t().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(r=p.default.loading("\u6B63\u5728\u5220\u9664"),i){m.next=3;break}return m.abrupt("return",!0);case 3:return m.prev=3,n=[i.jobLogId],m.next=7,N(n.join(","));case 7:return s=m.sent,r(),s.code===200?p.default.success("\u5220\u9664\u6210\u529F\uFF0C\u5373\u5C06\u5237\u65B0"):p.default.error(s.msg),m.abrupt("return",!0);case 13:return m.prev=13,m.t0=m.catch(3),r(),p.default.error("\u5220\u9664\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5"),m.abrupt("return",!1);case 18:case"end":return m.stop()}},a,null,[[3,13]])}));return function(i){return l.apply(this,arguments)}}(),he=function(){var l=(0,h.Z)(t().mark(function a(){var i;return t().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i=p.default.loading("\u6B63\u5728\u5BFC\u51FA"),n.prev=1,n.next=4,ue();case 4:return i(),p.default.success("\u5BFC\u51FA\u6210\u529F"),n.abrupt("return",!0);case 9:return n.prev=9,n.t0=n.catch(1),i(),p.default.error("\u5BFC\u51FA\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5"),n.abrupt("return",!1);case 14:case"end":return n.stop()}},a,null,[[1,9]])}));return function(){return l.apply(this,arguments)}}(),pe=function(){var a=(0,L.useRef)(),i=(0,L.useState)(!1),r=(0,x.Z)(i,2),n=r[0],s=r[1],c=(0,L.useRef)(),m=(0,L.useState)(),k=(0,x.Z)(m,2),G=k[0],I=k[1],P=(0,L.useState)([]),K=(0,x.Z)(P,2),E=K[0],U=K[1],je=(0,L.useState)([]),Q=(0,x.Z)(je,2),X=Q[0],be=Q[1],Ze=(0,L.useState)([]),q=(0,x.Z)(Ze,2),_=q[0],ye=q[1],J=(0,o.md)(),Le=(0,o.YB)();(0,L.useEffect)(function(){(0,W.zP)("sys_job_status").then(function(j){if(j.code===200){var v={};j.data.forEach(function(f){v[f.dictValue]=f.dictLabel}),be(v)}}),(0,W.zP)("sys_job_group").then(function(j){if(j.code===200){var v={};j.data.forEach(function(f){v[f.dictValue]=f.dictLabel}),ye(v)}})},[]);var Te=[{title:(0,e.jsx)(o._H,{id:"monitor.JobLog.job_log_id",defaultMessage:"\u4EFB\u52A1\u65E5\u5FD7ID"}),dataIndex:"jobLogId",valueType:"text",hideInSearch:!0},{title:(0,e.jsx)(o._H,{id:"monitor.JobLog.job_name",defaultMessage:"\u4EFB\u52A1\u540D\u79F0"}),dataIndex:"jobName",valueType:"text"},{title:(0,e.jsx)(o._H,{id:"monitor.JobLog.job_group",defaultMessage:"\u4EFB\u52A1\u7EC4\u540D"}),dataIndex:"jobGroup",valueType:"text",valueEnum:_},{title:(0,e.jsx)(o._H,{id:"monitor.JobLog.invoke_target",defaultMessage:"\u8C03\u7528\u76EE\u6807\u5B57\u7B26\u4E32"}),dataIndex:"invokeTarget",valueType:"textarea",hideInSearch:!0},{title:(0,e.jsx)(o._H,{id:"monitor.JobLog.job_message",defaultMessage:"\u65E5\u5FD7\u4FE1\u606F"}),dataIndex:"jobMessage",valueType:"textarea",hideInSearch:!0},{title:(0,e.jsx)(o._H,{id:"monitor.JobLog.status",defaultMessage:"\u6267\u884C\u72B6\u6001"}),dataIndex:"status",valueType:"select",valueEnum:X},{title:(0,e.jsx)(o._H,{id:"pages.searchTable.titleOption",defaultMessage:"\u64CD\u4F5C"}),dataIndex:"option",width:"220px",valueType:"option",render:function(v,f){return[(0,e.jsx)(w.Z,{type:"link",size:"small",hidden:!J.hasPerms("monitor:log:list"),onClick:function(){s(!0),I(f)},children:"\u8BE6\u7EC6"},"detail"),(0,e.jsx)(w.Z,{type:"link",size:"small",danger:!0,hidden:!J.hasPerms("monitor:log:remove"),onClick:(0,h.Z)(t().mark(function d(){return t().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:O.Z.confirm({title:"\u5220\u9664",content:"\u786E\u5B9A\u5220\u9664\u8BE5\u9879\u5417\uFF1F",okText:"\u786E\u8BA4",cancelText:"\u53D6\u6D88",onOk:function(){var b=(0,h.Z)(t().mark(function y(){var C;return t().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return R.next=2,ve(f);case 2:C=R.sent,C&&c.current&&c.current.reload();case 4:case"end":return R.stop()}},y)}));function g(){return b.apply(this,arguments)}return g}()});case 1:case"end":return F.stop()}},d)})),children:"\u5220\u9664"},"batchRemove")]}}];return(0,e.jsxs)(de.Z,{children:[(0,e.jsx)("div",{style:{width:"100%",float:"right"},children:(0,e.jsx)(te.ZP,{headerTitle:Le.formatMessage({id:"pages.searchTable.title",defaultMessage:"\u4FE1\u606F"}),actionRef:c,formRef:a,rowKey:"jobLogId",search:{labelWidth:"auto"},toolBarRender:function(){return[(0,e.jsxs)(w.Z,{type:"primary",hidden:(E==null?void 0:E.length)===0||!J.hasPerms("monitor:log:remove"),onClick:(0,h.Z)(t().mark(function v(){return t().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:O.Z.confirm({title:"\u662F\u5426\u786E\u8BA4\u5220\u9664\u6240\u9009\u6570\u636E\u9879?",icon:(0,e.jsx)(z.Z,{}),content:"\u8BF7\u8C28\u614E\u64CD\u4F5C",onOk:function(){return(0,h.Z)(t().mark(function F(){var b,g,y;return t().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:return Z.next=2,Y(E);case 2:b=Z.sent,b&&(U([]),(g=c.current)===null||g===void 0||(y=g.reloadAndRest)===null||y===void 0||y.call(g));case 4:case"end":return Z.stop()}},F)}))()},onCancel:function(){}});case 1:case"end":return d.stop()}},v)})),children:[(0,e.jsx)(re.Z,{}),(0,e.jsx)(o._H,{id:"pages.searchTable.delete",defaultMessage:"\u5220\u9664"})]},"remove"),(0,e.jsxs)(w.Z,{type:"primary",hidden:!J.hasPerms("monitor:operlog:remove"),onClick:(0,h.Z)(t().mark(function v(){return t().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:O.Z.confirm({title:"\u662F\u5426\u786E\u8BA4\u6E05\u7A7A\u6240\u6709\u767B\u5F55\u65E5\u5FD7\u6570\u636E\u9879?",icon:(0,e.jsx)(z.Z,{}),content:"\u8BF7\u8C28\u614E\u64CD\u4F5C",onOk:function(){return(0,h.Z)(t().mark(function F(){var b,g;return t().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:me(),(b=c.current)===null||b===void 0||(g=b.reloadAndRest)===null||g===void 0||g.call(b);case 2:case"end":return C.stop()}},F)}))()},onCancel:function(){}});case 1:case"end":return d.stop()}},v)})),children:[(0,e.jsx)($.Z,{}),(0,e.jsx)(o._H,{id:"pages.searchTable.clear",defaultMessage:"\u6E05\u7A7A"})]},"clear"),(0,e.jsxs)(w.Z,{type:"primary",hidden:!J.hasPerms("monitor:log:export"),onClick:(0,h.Z)(t().mark(function v(){return t().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:he();case 1:case"end":return d.stop()}},v)})),children:[(0,e.jsx)($.Z,{}),(0,e.jsx)(o._H,{id:"pages.searchTable.export",defaultMessage:"\u5BFC\u51FA"})]},"export"),(0,e.jsxs)(w.Z,{type:"primary",onClick:(0,h.Z)(t().mark(function v(){return t().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:o.m8.goBack();case 1:case"end":return d.stop()}},v)})),children:[(0,e.jsx)($.Z,{}),(0,e.jsx)(o._H,{id:"pages.goback",defaultMessage:"\u8FD4\u56DE"})]},"goback")]},request:function(v){return se((0,ee.Z)({},v)).then(function(f){var d={data:f.rows,total:f.total,success:!0};return d})},columns:Te,rowSelection:{onChange:function(v,f){U(f)}}},"jobLogList")}),(E==null?void 0:E.length)>0&&(0,e.jsx)(fe.Z,{extra:(0,e.jsxs)("div",{children:[(0,e.jsx)(o._H,{id:"pages.searchTable.chosen",defaultMessage:"\u5DF2\u9009\u62E9"}),(0,e.jsx)("a",{style:{fontWeight:600},children:E.length}),(0,e.jsx)(o._H,{id:"pages.searchTable.item",defaultMessage:"\u9879"})]}),children:(0,e.jsx)(w.Z,{hidden:!J.hasPerms("monitor:log:remove"),onClick:(0,h.Z)(t().mark(function j(){return t().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:O.Z.confirm({title:"\u5220\u9664",content:"\u786E\u5B9A\u5220\u9664\u8BE5\u9879\u5417\uFF1F",okText:"\u786E\u8BA4",cancelText:"\u53D6\u6D88",onOk:function(){var d=(0,h.Z)(t().mark(function F(){var b,g,y;return t().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:return Z.next=2,Y(E);case 2:b=Z.sent,b&&(U([]),(g=c.current)===null||g===void 0||(y=g.reloadAndRest)===null||y===void 0||y.call(g));case 4:case"end":return Z.stop()}},F)}));function M(){return d.apply(this,arguments)}return M}()});case 1:case"end":return f.stop()}},j)})),children:(0,e.jsx)(o._H,{id:"pages.searchTable.batchDeletion",defaultMessage:"\u6279\u91CF\u5220\u9664"})},"remove")}),(0,e.jsx)(ce,{onCancel:function(){s(!1),I(void 0)},visible:n,values:G||{},statusOptions:X,jobGroupOptions:_})]})},ge=pe}}]);
