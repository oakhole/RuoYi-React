(self.webpackChunkruoyi_react=self.webpackChunkruoyi_react||[]).push([[3802],{41252:function(Be,z,o){"use strict";o.r(z),o.d(z,{default:function(){return Te}});var De=o(57663),b=o(71577),I=o(2824),B=o(11849),Se=o(34792),f=o(48086),g=o(3182),Re=o(71194),D=o(50146),re=o(94043),s=o.n(re),G=o(57119),ae=o(73171),N=o(49101),T=o(67294),t=o(43581),te=o(19374),ne=o(66548),E=o(11238),se=o(24480);function ue(i,u){return S.apply(this,arguments)}function S(){return S=(0,g.Z)(s().mark(function i(u,r){return s().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,E.ZP)("/api/monitor/operlog/list",{params:(0,se.f)(u,r),method:"GET",headers:{"Content-Type":"application/json;charset=UTF-8"}}));case 1:case"end":return l.stop()}},i)})),S.apply(this,arguments)}function $e(i){return request("/api/monitor/operlog/".concat(i),{method:"GET"})}function le(i){return R.apply(this,arguments)}function R(){return R=(0,g.Z)(s().mark(function i(u){return s().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,E.ZP)("/api/monitor/operlog",{method:"POST",data:u}));case 1:case"end":return n.stop()}},i)})),R.apply(this,arguments)}function ie(i){return $.apply(this,arguments)}function $(){return $=(0,g.Z)(s().mark(function i(u){return s().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,E.ZP)("/api/monitor/operlog",{method:"PUT",data:u}));case 1:case"end":return n.stop()}},i)})),$.apply(this,arguments)}function oe(i){return A.apply(this,arguments)}function A(){return A=(0,g.Z)(s().mark(function i(u){return s().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,E.ZP)("/api/monitor/operlog/".concat(u),{method:"DELETE",headers:{"Content-Type":"application/json;charset=UTF-8"}}));case 1:case"end":return n.stop()}},i)})),A.apply(this,arguments)}function de(i){return(0,ne.su)("/api/monitor/operlog/export",{params:i},"oper_log_".concat(new Date().getTime(),".xlsx"))}function pe(){return P.apply(this,arguments)}function P(){return P=(0,g.Z)(s().mark(function i(){return s().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,E.ZP)("/api/monitor/operlog/clean",{method:"DELETE"}));case 1:case"end":return r.stop()}},i)})),P.apply(this,arguments)}var Ae=o(98858),v=o(4914),e=o(85893),ce=function(u){var r=u.values,n=u.statusOptions,l=u.businessTypeOptions,c=u.operatorTypeOptions;(0,T.useEffect)(function(){},[u]);var a=(0,t.YB)(),M=function(){u.onCancel()};return(0,e.jsx)(D.Z,{width:800,title:a.formatMessage({id:"monitor.Operlog.detail",defaultMessage:"\u64CD\u4F5C\u65E5\u5FD7\u8BE6\u7EC6\u4FE1\u606F"}),visible:u.visible,destroyOnClose:!0,onCancel:M,footer:[(0,e.jsx)(b.Z,{onClick:M,children:"\u5173\u95ED"},"back")],children:(0,e.jsxs)(v.Z,{column:24,children:[(0,e.jsx)(v.Z.Item,{span:12,label:(0,e.jsx)(t._H,{id:"monitor.Operlog.oper_id",defaultMessage:"\u65E5\u5FD7\u4E3B\u952E"}),children:r.operId}),(0,e.jsx)(v.Z.Item,{span:12,label:(0,e.jsx)(t._H,{id:"monitor.Operlog.title",defaultMessage:"\u6240\u5C5E\u6A21\u5757"}),children:r.title}),(0,e.jsx)(v.Z.Item,{span:12,label:(0,e.jsx)(t._H,{id:"monitor.Operlog.business_type",defaultMessage:"\u4E1A\u52A1\u7C7B\u578B"}),children:l[r.businessType?r.businessType:0]}),(0,e.jsx)(v.Z.Item,{span:12,label:(0,e.jsx)(t._H,{id:"monitor.Operlog.operator_type",defaultMessage:"\u64CD\u4F5C\u7C7B\u522B"}),children:c[r.operatorType?r.operatorType:0]}),(0,e.jsx)(v.Z.Item,{span:24,label:(0,e.jsx)(t._H,{id:"monitor.Operlog.method",defaultMessage:"\u65B9\u6CD5\u540D\u79F0"}),children:r.method}),(0,e.jsx)(v.Z.Item,{span:24,label:(0,e.jsx)(t._H,{id:"monitor.Operlog.oper_url",defaultMessage:"\u8BF7\u6C42URL"}),children:r.operUrl}),(0,e.jsx)(v.Z.Item,{span:12,label:(0,e.jsx)(t._H,{id:"monitor.Operlog.request_method",defaultMessage:"\u8BF7\u6C42\u65B9\u5F0F"}),children:r.requestMethod}),(0,e.jsx)(v.Z.Item,{span:12,label:(0,e.jsx)(t._H,{id:"monitor.Operlog.oper_name",defaultMessage:"\u64CD\u4F5C\u4EBA\u5458"}),children:r.operName}),(0,e.jsx)(v.Z.Item,{span:12,label:(0,e.jsx)(t._H,{id:"monitor.Operlog.oper_ip",defaultMessage:"\u4E3B\u673A\u5730\u5740"}),children:r.operIp}),(0,e.jsx)(v.Z.Item,{span:12,label:(0,e.jsx)(t._H,{id:"monitor.Operlog.oper_location",defaultMessage:"\u64CD\u4F5C\u5730\u70B9"}),children:r.operLocation}),(0,e.jsx)(v.Z.Item,{span:24,label:(0,e.jsx)(t._H,{id:"monitor.Operlog.oper_param",defaultMessage:"\u8BF7\u6C42\u53C2\u6570"}),children:r.operParam}),(0,e.jsx)(v.Z.Item,{span:24,label:(0,e.jsx)(t._H,{id:"monitor.Operlog.json_result",defaultMessage:"\u8FD4\u56DE\u53C2\u6570"}),children:r.jsonResult}),(0,e.jsx)(v.Z.Item,{span:12,label:(0,e.jsx)(t._H,{id:"monitor.Operlog.status",defaultMessage:"\u64CD\u4F5C\u72B6\u6001"}),children:n[r.status?r.status:0]}),(0,e.jsx)(v.Z.Item,{span:24,label:(0,e.jsx)(t._H,{id:"monitor.Operlog.error_msg",defaultMessage:"\u9519\u8BEF\u6D88\u606F"}),children:r.errorMsg}),(0,e.jsx)(v.Z.Item,{span:12,label:(0,e.jsx)(t._H,{id:"monitor.Operlog.oper_time",defaultMessage:"\u64CD\u4F5C\u65F6\u95F4"}),children:r.operTime})]})})},fe=ce,k=o(52346),he=o(21349),me=o(85224),W=D.Z.confirm,ge=function(){var i=(0,g.Z)(s().mark(function u(r){var n,l;return s().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return n=f.default.loading("\u6B63\u5728\u6DFB\u52A0"),a.prev=1,a.next=4,le((0,B.Z)({},r));case 4:return l=a.sent,n(),l.code===200?f.default.success("\u6DFB\u52A0\u6210\u529F"):f.default.error(l.msg),a.abrupt("return",!0);case 10:return a.prev=10,a.t0=a.catch(1),n(),f.default.error("\u6DFB\u52A0\u5931\u8D25\u8BF7\u91CD\u8BD5\uFF01"),a.abrupt("return",!1);case 15:case"end":return a.stop()}},u,null,[[1,10]])}));return function(r){return i.apply(this,arguments)}}(),ve=function(){var i=(0,g.Z)(s().mark(function u(r){var n,l;return s().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return n=f.default.loading("\u6B63\u5728\u914D\u7F6E"),a.prev=1,a.next=4,ie(r);case 4:return l=a.sent,n(),l.code===200?f.default.success("\u914D\u7F6E\u6210\u529F"):f.default.error(l.msg),a.abrupt("return",!0);case 10:return a.prev=10,a.t0=a.catch(1),n(),f.default.error("\u914D\u7F6E\u5931\u8D25\u8BF7\u91CD\u8BD5\uFF01"),a.abrupt("return",!1);case 15:case"end":return a.stop()}},u,null,[[1,10]])}));return function(r){return i.apply(this,arguments)}}(),Y=function(){var i=(0,g.Z)(s().mark(function u(r){var n,l;return s().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(n=f.default.loading("\u6B63\u5728\u5220\u9664"),r){a.next=3;break}return a.abrupt("return",!0);case 3:return a.prev=3,a.next=6,oe(r.map(function(M){return M.operId}).join(","));case 6:return l=a.sent,n(),l.code===200?f.default.success("\u5220\u9664\u6210\u529F\uFF0C\u5373\u5C06\u5237\u65B0"):f.default.error(l.msg),a.abrupt("return",!0);case 12:return a.prev=12,a.t0=a.catch(3),n(),f.default.error("\u5220\u9664\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5"),a.abrupt("return",!1);case 17:case"end":return a.stop()}},u,null,[[3,12]])}));return function(r){return i.apply(this,arguments)}}(),je=function(){var i=(0,g.Z)(s().mark(function u(){var r,n;return s().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return r=f.default.loading("\u6B63\u5728\u5220\u9664"),c.prev=1,c.next=4,pe();case 4:return n=c.sent,r(),n.code===200?f.default.success("\u5220\u9664\u6210\u529F\uFF0C\u5373\u5C06\u5237\u65B0"):f.default.error(n.msg),c.abrupt("return",!0);case 10:return c.prev=10,c.t0=c.catch(1),r(),f.default.error("\u5220\u9664\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5"),c.abrupt("return",!1);case 15:case"end":return c.stop()}},u,null,[[1,10]])}));return function(){return i.apply(this,arguments)}}(),ye=function(){var i=(0,g.Z)(s().mark(function u(){var r;return s().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return r=f.default.loading("\u6B63\u5728\u5BFC\u51FA"),l.prev=1,l.next=4,de();case 4:return r(),f.default.success("\u5BFC\u51FA\u6210\u529F"),l.abrupt("return",!0);case 9:return l.prev=9,l.t0=l.catch(1),r(),f.default.error("\u5BFC\u51FA\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5"),l.abrupt("return",!1);case 14:case"end":return l.stop()}},u,null,[[1,9]])}));return function(){return i.apply(this,arguments)}}(),Oe=function(){var u=(0,T.useRef)(),r=(0,T.useState)(!1),n=(0,I.Z)(r,2),l=n[0],c=n[1],a=(0,T.useRef)(),M=(0,T.useState)(),L=(0,I.Z)(M,2),Ce=L[0],U=L[1],xe=(0,T.useState)([]),K=(0,I.Z)(xe,2),x=K[0],V=K[1],Ze=(0,T.useState)([]),J=(0,I.Z)(Ze,2),Q=J[0],be=J[1],Ie=(0,T.useState)([]),X=(0,I.Z)(Ie,2),q=X[0],Me=X[1],Fe=(0,T.useState)([]),_=(0,I.Z)(Fe,2),ee=_[0],Ee=_[1],w=(0,t.md)(),we=(0,t.YB)();(0,T.useEffect)(function(){(0,k.zP)("sys_oper_type").then(function(h){if(h.code===200){var p={};h.data.forEach(function(d){p[d.dictValue]=d.dictLabel}),be(p)}}),(0,k.zP)("sys_oper_type").then(function(h){if(h.code===200){var p={};h.data.forEach(function(d){p[d.dictValue]=d.dictLabel}),Me(p)}}),(0,k.zP)("sys_common_status").then(function(h){if(h.code===200){var p={};h.data.forEach(function(d){p[d.dictValue]=d.dictLabel}),Ee(p)}})},[]);var He=[{title:(0,e.jsx)(t._H,{id:"monitor.Operlog.oper_id",defaultMessage:"\u65E5\u5FD7\u4E3B\u952E"}),dataIndex:"operId",valueType:"text",hideInSearch:!0},{title:(0,e.jsx)(t._H,{id:"monitor.Operlog.title",defaultMessage:"\u6240\u5C5E\u6A21\u5757"}),dataIndex:"title",valueType:"text"},{title:(0,e.jsx)(t._H,{id:"monitor.Operlog.business_type",defaultMessage:"\u4E1A\u52A1\u7C7B\u578B"}),dataIndex:"businessType",valueType:"select",valueEnum:Q},{title:(0,e.jsx)(t._H,{id:"monitor.Operlog.method",defaultMessage:"\u65B9\u6CD5\u540D\u79F0"}),dataIndex:"method",valueType:"text",hideInSearch:!0,hideInTable:!0},{title:(0,e.jsx)(t._H,{id:"monitor.Operlog.request_method",defaultMessage:"\u8BF7\u6C42\u65B9\u5F0F"}),dataIndex:"requestMethod",valueType:"text"},{title:(0,e.jsx)(t._H,{id:"monitor.Operlog.operator_type",defaultMessage:"\u64CD\u4F5C\u7C7B\u522B"}),dataIndex:"operatorType",valueType:"select",valueEnum:q,hideInTable:!0},{title:(0,e.jsx)(t._H,{id:"monitor.Operlog.oper_name",defaultMessage:"\u64CD\u4F5C\u4EBA\u5458"}),dataIndex:"operName",valueType:"text"},{title:(0,e.jsx)(t._H,{id:"monitor.Operlog.dept_name",defaultMessage:"\u90E8\u95E8\u540D\u79F0"}),dataIndex:"deptName",valueType:"text",hideInSearch:!0,hideInTable:!0},{title:(0,e.jsx)(t._H,{id:"monitor.Operlog.oper_url",defaultMessage:"\u8BF7\u6C42URL"}),dataIndex:"operUrl",valueType:"text",hideInTable:!0},{title:(0,e.jsx)(t._H,{id:"monitor.Operlog.oper_ip",defaultMessage:"\u4E3B\u673A\u5730\u5740"}),dataIndex:"operIp",valueType:"text"},{title:(0,e.jsx)(t._H,{id:"monitor.Operlog.oper_location",defaultMessage:"\u64CD\u4F5C\u5730\u70B9"}),dataIndex:"operLocation",valueType:"text"},{title:(0,e.jsx)(t._H,{id:"monitor.Operlog.oper_param",defaultMessage:"\u8BF7\u6C42\u53C2\u6570"}),dataIndex:"operParam",valueType:"textarea",hideInSearch:!0,hideInTable:!0},{title:(0,e.jsx)(t._H,{id:"monitor.Operlog.json_result",defaultMessage:"\u8FD4\u56DE\u53C2\u6570"}),dataIndex:"jsonResult",valueType:"textarea",hideInSearch:!0,hideInTable:!0},{title:(0,e.jsx)(t._H,{id:"monitor.Operlog.status",defaultMessage:"\u64CD\u4F5C\u72B6\u6001"}),dataIndex:"status",valueType:"select",valueEnum:ee},{title:(0,e.jsx)(t._H,{id:"monitor.Operlog.error_msg",defaultMessage:"\u9519\u8BEF\u6D88\u606F"}),dataIndex:"errorMsg",valueType:"textarea",hideInSearch:!0,hideInTable:!0},{title:(0,e.jsx)(t._H,{id:"monitor.Operlog.oper_time",defaultMessage:"\u64CD\u4F5C\u65F6\u95F4"}),dataIndex:"operTime",valueType:"dateRange",render:function(p,d){return(0,e.jsx)("span",{children:d.operTime})},search:{transform:function(p){return{"params[beginTime]":p[0],"params[endTime]":p[1]}}}},{title:(0,e.jsx)(t._H,{id:"pages.searchTable.titleOption",defaultMessage:"\u64CD\u4F5C"}),dataIndex:"option",width:"220px",valueType:"option",render:function(p,d){return[(0,e.jsx)(b.Z,{type:"link",size:"small",hidden:!w.hasPerms("monitor:operlog:list"),onClick:function(){c(!0),U(d)},children:(0,e.jsx)(t._H,{id:"detaile",defaultMessage:"Detail"})},"edit")]}}];return(0,e.jsxs)(he.Z,{children:[(0,e.jsx)("div",{style:{width:"100%",float:"right"},children:(0,e.jsx)(te.ZP,{headerTitle:we.formatMessage({id:"pages.searchTable.title",defaultMessage:"\u4FE1\u606F"}),actionRef:a,formRef:u,rowKey:"operId",search:{labelWidth:"auto"},toolBarRender:function(){return[(0,e.jsxs)(b.Z,{type:"primary",hidden:(x==null?void 0:x.length)===0||!w.hasPerms("monitor:operlog:remove"),onClick:(0,g.Z)(s().mark(function p(){return s().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:W({title:"\u662F\u5426\u786E\u8BA4\u6E05\u7A7A\u6240\u6709\u767B\u5F55\u65E5\u5FD7\u6570\u636E\u9879?",icon:(0,e.jsx)(G.Z,{}),content:"\u8BF7\u8C28\u614E\u64CD\u4F5C",onOk:function(){return(0,g.Z)(s().mark(function j(){var C,y,Z;return s().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return O.next=2,Y(x);case 2:C=O.sent,C&&(V([]),(y=a.current)===null||y===void 0||(Z=y.reloadAndRest)===null||Z===void 0||Z.call(y));case 4:case"end":return O.stop()}},j)}))()},onCancel:function(){}});case 1:case"end":return m.stop()}},p)})),children:[(0,e.jsx)(ae.Z,{}),(0,e.jsx)(t._H,{id:"pages.searchTable.delete",defaultMessage:"\u5220\u9664"})]},"remove"),(0,e.jsxs)(b.Z,{type:"primary",hidden:!w.hasPerms("monitor:operlog:remove"),onClick:(0,g.Z)(s().mark(function p(){return s().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:W({title:"\u662F\u5426\u786E\u8BA4\u6E05\u7A7A\u6240\u6709\u767B\u5F55\u65E5\u5FD7\u6570\u636E\u9879?",icon:(0,e.jsx)(G.Z,{}),content:"\u8BF7\u8C28\u614E\u64CD\u4F5C",onOk:function(){return(0,g.Z)(s().mark(function j(){var C,y;return s().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:je(),(C=a.current)===null||C===void 0||(y=C.reloadAndRest)===null||y===void 0||y.call(C);case 2:case"end":return H.stop()}},j)}))()},onCancel:function(){}});case 1:case"end":return m.stop()}},p)})),children:[(0,e.jsx)(N.Z,{}),(0,e.jsx)(t._H,{id:"pages.searchTable.clear",defaultMessage:"\u6E05\u7A7A"})]},"clear"),(0,e.jsxs)(b.Z,{type:"primary",hidden:!w.hasPerms("monitor:operlog:export"),onClick:(0,g.Z)(s().mark(function p(){return s().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:ye();case 1:case"end":return m.stop()}},p)})),children:[(0,e.jsx)(N.Z,{}),(0,e.jsx)(t._H,{id:"pages.searchTable.export",defaultMessage:"\u5BFC\u51FA"})]},"export")]},request:function(p,d){return ue((0,B.Z)({},p),d)},columns:He,rowSelection:{onChange:function(p,d){V(d)}}},"operlogList")}),(x==null?void 0:x.length)>0&&(0,e.jsx)(me.Z,{extra:(0,e.jsxs)("div",{children:[(0,e.jsx)(t._H,{id:"pages.searchTable.chosen",defaultMessage:"\u5DF2\u9009\u62E9"}),(0,e.jsx)("a",{style:{fontWeight:600},children:x.length}),(0,e.jsx)(t._H,{id:"pages.searchTable.item",defaultMessage:"\u9879"})]}),children:(0,e.jsx)(b.Z,{hidden:!w.hasPerms("monitor:operlog:remove"),onClick:(0,g.Z)(s().mark(function h(){return s().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:D.Z.confirm({title:"\u5220\u9664",content:"\u786E\u5B9A\u5220\u9664\u8BE5\u9879\u5417\uFF1F",okText:"\u786E\u8BA4",cancelText:"\u53D6\u6D88",onOk:function(){var m=(0,g.Z)(s().mark(function j(){var C,y,Z;return s().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return O.next=2,Y(x);case 2:C=O.sent,C&&(V([]),(y=a.current)===null||y===void 0||(Z=y.reloadAndRest)===null||Z===void 0||Z.call(y));case 4:case"end":return O.stop()}},j)}));function F(){return m.apply(this,arguments)}return F}()});case 1:case"end":return d.stop()}},h)})),children:(0,e.jsx)(t._H,{id:"pages.searchTable.batchDeletion",defaultMessage:"\u6279\u91CF\u5220\u9664"})},"remove")}),(0,e.jsx)(fe,{onSubmit:function(){var h=(0,g.Z)(s().mark(function p(d){var m;return s().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(m=!1,!d.operId){j.next=7;break}return j.next=4,ve((0,B.Z)({},d));case 4:m=j.sent,j.next=10;break;case 7:return j.next=9,ge((0,B.Z)({},d));case 9:m=j.sent;case 10:m&&(c(!1),U(void 0),a.current&&a.current.reload());case 11:case"end":return j.stop()}},p)}));return function(p){return h.apply(this,arguments)}}(),onCancel:function(){c(!1),U(void 0)},visible:l,values:Ce||{},businessTypeOptions:Q,operatorTypeOptions:q,statusOptions:ee})]})},Te=Oe}}]);
