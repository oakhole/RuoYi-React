(self.webpackChunkruoyi_react=self.webpackChunkruoyi_react||[]).push([[9012],{64335:function(Jt,te,W){"use strict";var _e=W(67294),ue=(0,_e.createContext)({});te.Z=ue},21349:function(Jt,te,W){"use strict";var _e=W(84305),ue=W(75901),g=W(53645),Ee=W.n(g),H=W(67294),ae=W(94184),le=W.n(ae),Be=W(64335),ye=function(st){var yt=(0,H.useContext)(Be.Z),$t=st.children,tr=st.contentWidth,Mt=st.className,Qt=st.style,Bt=(0,H.useContext)(ue.ZP.ConfigContext),ut=Bt.getPrefixCls,pt=st.prefixCls||ut("pro"),rr=tr||yt.contentWidth,K="".concat(pt,"-grid-content");return H.createElement("div",{className:le()(K,Mt,{wide:rr==="Fixed"}),style:Qt},H.createElement("div",{className:"".concat(pt,"-grid-content-children")},$t))};te.Z=ye},65309:function(Jt,te,W){"use strict";W.d(te,{zP:function(){return V3},JE:function(){return e3},ns:function(){return j3}});var _e={};W.r(_e),W.d(_e,{add:function(){return Qr},adjoint:function(){return Dd},clone:function(){return bc},copy:function(){return Po},create:function(){return Ki},determinant:function(){return yp},equals:function(){return Hr},exactEquals:function(){return En},frob:function(){return Rr},fromQuat:function(){return mr},fromQuat2:function(){return Ne},fromRotation:function(){return Ff},fromRotationTranslation:function(){return ve},fromRotationTranslationScale:function(){return qt},fromRotationTranslationScaleOrigin:function(){return fr},fromScaling:function(){return $l},fromTranslation:function(){return Gh},fromValues:function(){return js},fromXRotation:function(){return _p},fromYRotation:function(){return Fd},fromZRotation:function(){return N},frustum:function(){return xr},getRotation:function(){return kt},getScaling:function(){return ar},getTranslation:function(){return Dt},identity:function(){return gp},invert:function(){return Vh},lookAt:function(){return br},mul:function(){return Sr},multiply:function(){return Al},multiplyScalar:function(){return Kt},multiplyScalarAndAdd:function(){return ir},ortho:function(){return ot},orthoNO:function(){return Cr},orthoZO:function(){return jt},perspective:function(){return Mr},perspectiveFromFieldOfView:function(){return yr},perspectiveNO:function(){return Tr},perspectiveZO:function(){return Gr},rotate:function(){return id},rotateX:function(){return fh},rotateY:function(){return sf},rotateZ:function(){return ba},scale:function(){return Kl},set:function(){return nd},str:function(){return cr},sub:function(){return qr},subtract:function(){return Un},targetTo:function(){return Zr},translate:function(){return ch},transpose:function(){return Ld}});var ue=W(67294),g=(0,ue.createContext)({});function Ee(){return(0,ue.useContext)(g)}var H={},ae={},le=function(i){return ae[i]},Be=function(i,r){ae[i]=r},ye=function(i){return H[i]},Je=function(i,r){H[i]=r},st={},yt={},$t=34,tr=10,Mt=13;function Qt(e){return new Function("d","return {"+e.map(function(i,r){return JSON.stringify(i)+": d["+r+'] || ""'}).join(",")+"}")}function Bt(e,i){var r=Qt(e);return function(n,a){return i(r(n),a,e)}}function ut(e){var i=Object.create(null),r=[];return e.forEach(function(n){for(var a in n)a in i||r.push(i[a]=a)}),r}function pt(e,i){var r=e+"",n=r.length;return n<i?new Array(i-n+1).join(0)+r:r}function rr(e){return e<0?"-"+pt(-e,6):e>9999?"+"+pt(e,6):pt(e,4)}function K(e){var i=e.getUTCHours(),r=e.getUTCMinutes(),n=e.getUTCSeconds(),a=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":rr(e.getUTCFullYear(),4)+"-"+pt(e.getUTCMonth()+1,2)+"-"+pt(e.getUTCDate(),2)+(a?"T"+pt(i,2)+":"+pt(r,2)+":"+pt(n,2)+"."+pt(a,3)+"Z":n?"T"+pt(i,2)+":"+pt(r,2)+":"+pt(n,2)+"Z":r||i?"T"+pt(i,2)+":"+pt(r,2)+"Z":"")}function Xt(e){var i=new RegExp('["'+e+`
\r]`),r=e.charCodeAt(0);function n(T,O){var F,j,Y=a(T,function(ee,Ae){if(F)return F(ee,Ae-1);j=ee,F=O?Bt(ee,O):Qt(ee)});return Y.columns=j||[],Y}function a(T,O){var F=[],j=T.length,Y=0,ee=0,Ae,Fe=j<=0,Xe=!1;T.charCodeAt(j-1)===tr&&--j,T.charCodeAt(j-1)===Mt&&--j;function nt(){if(Fe)return yt;if(Xe)return Xe=!1,st;var wt,Wt=Y,ur;if(T.charCodeAt(Wt)===$t){for(;Y++<j&&T.charCodeAt(Y)!==$t||T.charCodeAt(++Y)===$t;);return(wt=Y)>=j?Fe=!0:(ur=T.charCodeAt(Y++))===tr?Xe=!0:ur===Mt&&(Xe=!0,T.charCodeAt(Y)===tr&&++Y),T.slice(Wt+1,wt-1).replace(/""/g,'"')}for(;Y<j;){if((ur=T.charCodeAt(wt=Y++))===tr)Xe=!0;else if(ur===Mt)Xe=!0,T.charCodeAt(Y)===tr&&++Y;else if(ur!==r)continue;return T.slice(Wt,wt)}return Fe=!0,T.slice(Wt,j)}for(;(Ae=nt())!==yt;){for(var Et=[];Ae!==st&&Ae!==yt;)Et.push(Ae),Ae=nt();O&&(Et=O(Et,ee++))==null||F.push(Et)}return F}function s(T,O){return T.map(function(F){return O.map(function(j){return A(F[j])}).join(e)})}function f(T,O){return O==null&&(O=ut(T)),[O.map(A).join(e)].concat(s(T,O)).join(`
`)}function v(T,O){return O==null&&(O=ut(T)),s(T,O).join(`
`)}function m(T){return T.map(x).join(`
`)}function x(T){return T.map(A).join(e)}function A(T){return T==null?"":T instanceof Date?K(T):i.test(T+="")?'"'+T.replace(/"/g,'""')+'"':T}return{parse:n,parseRows:a,format:f,formatBody:v,formatRows:m,formatRow:x,formatValue:A}}var lt=Xt(","),$e=lt.parse,St=lt.parseRows,et=lt.format,Ht=lt.formatBody,Er=lt.formatRows,kr=lt.formatRow,$r=lt.formatValue,S=W(96156),pe=W(85061),he=W(38163),He=W.n(he);function Ke(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function it(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Ke(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ke(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function bt(e,i){var r=i.x,n=i.y,a=i.x1,s=i.y1,f=i.coordinates,v=[];return Array.isArray(e)?(e.forEach(function(m,x){var A=[];if(r&&n&&(A=[parseFloat(m[r]),parseFloat(m[n])]),r&&n&&a&&s){var T=[parseFloat(m[r]),parseFloat(m[n])],O=[parseFloat(m[a]),parseFloat(m[s])];A=[T,O]}if(f){var F="Polygon";Array.isArray(f[0])||(F="Point"),Array.isArray(f[0])&&!Array.isArray(f[0][0])&&(F="LineString");var j={type:F,coordinates:(0,pe.Z)(m[f])};He()(j,!0),A=j.coordinates}var Y=it(it({},m),{},{_id:x,coordinates:A});v.push(Y)}),{dataArray:v}):{dataArray:[]}}var nr=[{lng1:100,lat1:30,lng2:130,lat2:30}],Nr={parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}};function wr(e,i){var r=$e(e);return bt(r,i)}var xn=63710088e-1,an={centimeters:xn*100,centimetres:xn*100,degrees:xn/111325,feet:xn*3.28084,inches:xn*39.37,kilometers:xn/1e3,kilometres:xn/1e3,meters:xn,metres:xn,miles:xn/1609.344,millimeters:xn*1e3,millimetres:xn*1e3,nauticalmiles:xn/1852,radians:1,yards:xn*1.0936},Dn={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/xn,yards:1.0936133},jn={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function In(e,i,r){r===void 0&&(r={});var n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=i||{},n.geometry=e,n}function ii(e,i,r){switch(r===void 0&&(r={}),e){case"Point":return wi(i).geometry;case"LineString":return Qi(i).geometry;case"Polygon":return Ti(i).geometry;case"MultiPoint":return Fi(i).geometry;case"MultiLineString":return pa(i).geometry;case"MultiPolygon":return ra(i).geometry;default:throw new Error(e+" is invalid")}}function wi(e,i,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!On(e[0])||!On(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return In(n,i,r)}function Ei(e,i,r){return r===void 0&&(r={}),Sa(e.map(function(n){return wi(n,i)}),r)}function Ti(e,i,r){r===void 0&&(r={});for(var n=0,a=e;n<a.length;n++){var s=a[n];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var f=0;f<s[s.length-1].length;f++)if(s[s.length-1][f]!==s[0][f])throw new Error("First and last Position are not equivalent.")}var v={type:"Polygon",coordinates:e};return In(v,i,r)}function Gi(e,i,r){return r===void 0&&(r={}),Sa(e.map(function(n){return Ti(n,i)}),r)}function Qi(e,i,r){if(r===void 0&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return In(n,i,r)}function po(e,i,r){return r===void 0&&(r={}),Sa(e.map(function(n){return Qi(n,i)}),r)}function Sa(e,i){i===void 0&&(i={});var r={type:"FeatureCollection"};return i.id&&(r.id=i.id),i.bbox&&(r.bbox=i.bbox),r.features=e,r}function pa(e,i,r){r===void 0&&(r={});var n={type:"MultiLineString",coordinates:e};return In(n,i,r)}function Fi(e,i,r){r===void 0&&(r={});var n={type:"MultiPoint",coordinates:e};return In(n,i,r)}function ra(e,i,r){r===void 0&&(r={});var n={type:"MultiPolygon",coordinates:e};return In(n,i,r)}function $i(e,i,r){r===void 0&&(r={});var n={type:"GeometryCollection",geometries:e};return In(n,i,r)}function is(e,i){if(i===void 0&&(i=0),i&&!(i>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,i||0);return Math.round(e*r)/r}function me(e,i){i===void 0&&(i="kilometers");var r=an[i];if(!r)throw new Error(i+" units is invalid");return e*r}function li(e,i){i===void 0&&(i="kilometers");var r=an[i];if(!r)throw new Error(i+" units is invalid");return e/r}function bo(e,i){return Zt(li(e,i))}function cu(e){var i=e%360;return i<0&&(i+=360),i}function Zt(e){var i=e%(2*Math.PI);return i*180/Math.PI}function er(e){var i=e%360;return i*Math.PI/180}function Lr(e,i,r){if(i===void 0&&(i="kilometers"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("length must be a positive number");return me(li(e,i),r)}function sn(e,i,r){if(i===void 0&&(i="meters"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=jn[i];if(!n)throw new Error("invalid original units");var a=jn[r];if(!a)throw new Error("invalid final units");return e/n*a}function On(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Vn(e){return!!e&&e.constructor===Object}function bi(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(i){if(!On(i))throw new Error("bbox must only contain numbers")})}function vi(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function An(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Bi(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Li(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return Li(e[0]);throw new Error("coordinates must only contain numbers")}function io(e,i,r){if(!i||!r)throw new Error("type and name required");if(!e||e.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.type)}function ys(e,i,r){if(!e)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!e.geometry||e.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.geometry.type)}function Uo(e,i,r){if(!e)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(var n=0,a=e.features;n<a.length;n++){var s=a[n];if(!s||s.type!=="Feature"||!s.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!s.geometry||s.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+s.geometry.type)}}function Na(e){return e.type==="Feature"?e.geometry:e}function xa(e,i){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function V(e,i,r){if(e!==null)for(var n,a,s,f,v,m,x,A=0,T=0,O,F=e.type,j=F==="FeatureCollection",Y=F==="Feature",ee=j?e.features.length:1,Ae=0;Ae<ee;Ae++){x=j?e.features[Ae].geometry:Y?e.geometry:e,O=x?x.type==="GeometryCollection":!1,v=O?x.geometries.length:1;for(var Fe=0;Fe<v;Fe++){var Xe=0,nt=0;if(f=O?x.geometries[Fe]:x,f!==null){m=f.coordinates;var Et=f.type;switch(A=r&&(Et==="Polygon"||Et==="MultiPolygon")?1:0,Et){case null:break;case"Point":if(i(m,T,Ae,Xe,nt)===!1)return!1;T++,Xe++;break;case"LineString":case"MultiPoint":for(n=0;n<m.length;n++){if(i(m[n],T,Ae,Xe,nt)===!1)return!1;T++,Et==="MultiPoint"&&Xe++}Et==="LineString"&&Xe++;break;case"Polygon":case"MultiLineString":for(n=0;n<m.length;n++){for(a=0;a<m[n].length-A;a++){if(i(m[n][a],T,Ae,Xe,nt)===!1)return!1;T++}Et==="MultiLineString"&&Xe++,Et==="Polygon"&&nt++}Et==="Polygon"&&Xe++;break;case"MultiPolygon":for(n=0;n<m.length;n++){for(nt=0,a=0;a<m[n].length;a++){for(s=0;s<m[n][a].length-A;s++){if(i(m[n][a][s],T,Ae,Xe,nt)===!1)return!1;T++}nt++}Xe++}break;case"GeometryCollection":for(n=0;n<f.geometries.length;n++)if(V(f.geometries[n],i,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Q(e,i,r,n){var a=r;return V(e,function(s,f,v,m,x){f===0&&r===void 0?a=s:a=i(a,s,f,v,m,x)},n),a}function ne(e,i){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length&&i(e.features[r].properties,r)!==!1;r++);break;case"Feature":i(e.properties,0);break}}function ge(e,i,r){var n=r;return ne(e,function(a,s){s===0&&r===void 0?n=a:n=i(n,a,s)}),n}function Ie(e,i){if(e.type==="Feature")i(e,0);else if(e.type==="FeatureCollection")for(var r=0;r<e.features.length&&i(e.features[r],r)!==!1;r++);}function Ge(e,i,r){var n=r;return Ie(e,function(a,s){s===0&&r===void 0?n=a:n=i(n,a,s)}),n}function tt(e){var i=[];return V(e,function(r){i.push(r)}),i}function ce(e,i){var r,n,a,s,f,v,m,x,A,T,O=0,F=e.type==="FeatureCollection",j=e.type==="Feature",Y=F?e.features.length:1;for(r=0;r<Y;r++){for(v=F?e.features[r].geometry:j?e.geometry:e,x=F?e.features[r].properties:j?e.properties:{},A=F?e.features[r].bbox:j?e.bbox:void 0,T=F?e.features[r].id:j?e.id:void 0,m=v?v.type==="GeometryCollection":!1,f=m?v.geometries.length:1,a=0;a<f;a++){if(s=m?v.geometries[a]:v,s===null){if(i(null,O,x,A,T)===!1)return!1;continue}switch(s.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(i(s,O,x,A,T)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<s.geometries.length;n++)if(i(s.geometries[n],O,x,A,T)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}O++}}function Le(e,i,r){var n=r;return ce(e,function(a,s,f,v,m){s===0&&r===void 0?n=a:n=i(n,a,s,f,v,m)}),n}function mt(e,i){ce(e,function(r,n,a,s,f){var v=r===null?null:r.type;switch(v){case null:case"Point":case"LineString":case"Polygon":return i(In(r,a,{bbox:s,id:f}),n,0)===!1?!1:void 0}var m;switch(v){case"MultiPoint":m="Point";break;case"MultiLineString":m="LineString";break;case"MultiPolygon":m="Polygon";break}for(var x=0;x<r.coordinates.length;x++){var A=r.coordinates[x],T={type:m,coordinates:A};if(i(In(T,a),n,x)===!1)return!1}})}function pr(e,i,r){var n=r;return mt(e,function(a,s,f){s===0&&f===0&&r===void 0?n=a:n=i(n,a,s,f)}),n}function Lt(e,i){mt(e,function(r,n,a){var s=0;if(!!r.geometry){var f=r.geometry.type;if(!(f==="Point"||f==="MultiPoint")){var v,m=0,x=0,A=0;if(V(r,function(T,O,F,j,Y){if(v===void 0||n>m||j>x||Y>A){v=T,m=n,x=j,A=Y,s=0;return}var ee=lineString([v,T],r.properties);if(i(ee,n,a,Y,s)===!1)return!1;s++,v=T})===!1)return!1}}})}function Ft(e,i,r){var n=r,a=!1;return Lt(e,function(s,f,v,m,x){a===!1&&r===void 0?n=s:n=i(n,s,f,v,m,x),a=!0}),n}function dr(e,i){if(!e)throw new Error("geojson is required");mt(e,function(r,n,a){if(r.geometry!==null){var s=r.geometry.type,f=r.geometry.coordinates;switch(s){case"LineString":if(i(r,n,a,0,0)===!1)return!1;break;case"Polygon":for(var v=0;v<f.length;v++)if(i(lineString(f[v],r.properties),n,a,v)===!1)return!1;break}}})}function bn(e,i,r){var n=r;return dr(e,function(a,s,f,v){s===0&&r===void 0?n=a:n=i(n,a,s,f,v)}),n}function pn(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,a=i.geometryIndex||0,s=i.segmentIndex||0,f=i.properties,v;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),f=f||e.features[r].properties,v=e.features[r].geometry;break;case"Feature":f=f||e.properties,v=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":v=e;break;default:throw new Error("geojson is invalid")}if(v===null)return null;var m=v.coordinates;switch(v.type){case"Point":case"MultiPoint":return null;case"LineString":return s<0&&(s=m.length+s-1),lineString([m[s],m[s+1]],f,i);case"Polygon":return a<0&&(a=m.length+a),s<0&&(s=m[a].length+s-1),lineString([m[a][s],m[a][s+1]],f,i);case"MultiLineString":return n<0&&(n=m.length+n),s<0&&(s=m[n].length+s-1),lineString([m[n][s],m[n][s+1]],f,i);case"MultiPolygon":return n<0&&(n=m.length+n),a<0&&(a=m[n].length+a),s<0&&(s=m[n][a].length-s-1),lineString([m[n][a][s],m[n][a][s+1]],f,i)}throw new Error("geojson is invalid")}function Pt(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,a=i.geometryIndex||0,s=i.coordIndex||0,f=i.properties,v;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),f=f||e.features[r].properties,v=e.features[r].geometry;break;case"Feature":f=f||e.properties,v=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":v=e;break;default:throw new Error("geojson is invalid")}if(v===null)return null;var m=v.coordinates;switch(v.type){case"Point":return point(m,f,i);case"MultiPoint":return n<0&&(n=m.length+n),point(m[n],f,i);case"LineString":return s<0&&(s=m.length+s),point(m[s],f,i);case"Polygon":return a<0&&(a=m.length+a),s<0&&(s=m[a].length+s),point(m[a][s],f,i);case"MultiLineString":return n<0&&(n=m.length+n),s<0&&(s=m[n].length+s),point(m[n][s],f,i);case"MultiPolygon":return n<0&&(n=m.length+n),a<0&&(a=m[n].length+a),s<0&&(s=m[n][a].length-s),point(m[n][a][s],f,i)}throw new Error("geojson is invalid")}function en(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function zr(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?en(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):en(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Xr(e,i){var r=[],n={};if(!e.features)return e.features=[],{dataArray:[]};if(e.features=e.features.filter(function(s){var f=s.geometry;return s!=null&&f&&f.type&&f.coordinates&&f.coordinates.length>0}),He()(e,!0),e.features.length===0)return{dataArray:[],featureKeys:n};var a=0;return mt(e,function(s,f){var v=Bi(s),m=f,x=zr(zr({},s.properties),{},{coordinates:v,_id:m});r.push(x)}),{dataArray:r,featureKeys:n}}function mi(e){var i=131,r=137,n=0;e+="x";for(var a=Math.floor(9007199254740991/r),s=0;s<e.length;s++)n>a&&(n=Math.floor(n/r)),n=n*i+e.charCodeAt(s);return n}function tn(e){e=e.toString();for(var i=5381,r=e.length;r;)i=i*33^e.charCodeAt(--r);return i>>>0}var mn=W(28481),Xi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function hi(e){this.message=e}hi.prototype=new Error,hi.prototype.name="InvalidCharacterError";function Pi(e){var i=String(e).replace(/=+$/,"");if(i.length%4==1)throw new hi("'atob' failed: The string to be decoded is not correctly encoded.");for(var r="",n=0,a,s,f=0;s=i.charAt(f++);~s&&(a=n%4?a*64+s:s,n++%4)?r+=String.fromCharCode(255&a>>(-2*n&6)):0)s=Xi.indexOf(s);return r}function _i(e){e=String(e);for(var i,r,n,a,s="",f=0,v=e.length%3;f<e.length;){if((r=e.charCodeAt(f++))>255||(n=e.charCodeAt(f++))>255||(a=e.charCodeAt(f++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");i=r<<16|n<<8|a,s+=Xi.charAt(i>>18&63)+Xi.charAt(i>>12&63)+Xi.charAt(i>>6&63)+Xi.charAt(i&63)}return v?s.slice(0,v-3)+"===".substring(v):s}var dt=W(6610),It=W(5991),Ta=function(){function e(i,r){(0,dt.Z)(this,e),this.buffers=i,this.type=r}return(0,It.Z)(e,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(r,n,a){throw new Error("not implemented")}}]),e}(),Si;typeof window=="undefined"?Si={devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(i){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(i){return!0},Event:function(i,r){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:Si=window;var Ii=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,ji=Ii?my.getSystemInfoSync().pixelRatio:Si.devicePixelRatio,Ir=W(10379),un=W(46070),_t=W(77608),aa=(0,It.Z)(function e(i,r){(0,dt.Z)(this,e),(0,S.Z)(this,"cancelBubble",void 0),(0,S.Z)(this,"cancelable",void 0),(0,S.Z)(this,"target",void 0),(0,S.Z)(this,"currentTarget",void 0),(0,S.Z)(this,"preventDefault",void 0),(0,S.Z)(this,"stopPropagation",void 0),(0,S.Z)(this,"type",void 0),(0,S.Z)(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=i,this.timeStamp=Date.now()}),J=W(63349);function Ko(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=na(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function na(e,i){if(!!e){if(typeof e=="string")return bu(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return bu(e,i)}}function bu(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var za=new WeakMap,Ma=function(){function e(){(0,dt.Z)(this,e),za.set(this,{})}return(0,It.Z)(e,[{key:"addEventListener",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=za.get(this);s||(s={}),s[r]||(s[r]=[]),s[r].push(n),za.set(this,s),a.capture,a.once,a.passive}},{key:"removeEventListener",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=za.get(this);if(s){var f=s[r];if(f&&f.length>0){for(var v=f.length;v--;v>0)if(f[v]===n){f.splice(v,1);break}}}}},{key:"dispatchEvent",value:function(r){var n=za.get(this)[r.type];if(n){var a=Ko(n),s;try{for(a.s();!(s=a.n()).done;){var f=s.value;f(r)}}catch(v){a.e(v)}finally{a.f()}}}}]),e}();function qa(e){var i=oa();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function oa(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ao=function(e){(0,Ir.Z)(r,e);var i=qa(r);function r(){var n;return(0,dt.Z)(this,r),n=i.call(this),(0,S.Z)((0,J.Z)(n),"childNodes",void 0),n.childNodes=[],n}return(0,It.Z)(r,[{key:"appendChild",value:function(a){this.childNodes.push(a)}},{key:"cloneNode",value:function(){var a=Object.create(this);return Object.assign(a,this),a}},{key:"removeChild",value:function(a){var s=this.childNodes.findIndex(function(f){return f===a});return s>-1?this.childNodes.splice(s,1):null}}]),r}(Ma);function jo(e){var i=wu();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function wu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vo=function(e){(0,Ir.Z)(r,e);var i=jo(r);function r(){var n;return(0,dt.Z)(this,r),n=i.call(this),(0,S.Z)((0,J.Z)(n),"className",void 0),(0,S.Z)((0,J.Z)(n),"children",void 0),n.className="",n.children=[],n}return(0,It.Z)(r,[{key:"setAttribute",value:function(a,s){this[a]=s}},{key:"getAttribute",value:function(a){return this[a]}},{key:"setAttributeNS",value:function(a,s){this[a]=s}},{key:"getAttributeNS",value:function(a){return this[a]}}]),r}(Ao),Do=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,sa,Ka,Fo,$a;if(Do){var Ms=my.getSystemInfoSync();sa=Ms.screenWidth,Ka=Ms.screenHeight,Fo=Ms.windowWidth,$a=Ms.windowHeight}else{var Il=Si.innerWidth,_s=Si.innerHeight;sa=Il,Ka=_s,Fo=Il,$a=_s}var re={width:sa,height:Ka,availWidth:Fo,availHeight:$a,availLeft:0,availTop:0},Se=re.availWidth,Ye=re.availHeight,Rt={style:[]};function Or(e,i){if(!("parentNode"in e)){var r;i===0?r=function(){return null}:i===1?r=function(){return Rt}:r=function(){return null},Object.defineProperty(e,"parentNode",{enumerable:!0,get:r})}if(!("parentElement"in e)){var n;i===0?n=function(){return null}:i===1?n=function(){return Rt}:n=function(){return null},Object.defineProperty(e,"parentElement",{enumerable:!0,get:n})}}function kn(e){e.style=e.style||{},Object.assign(e.style,{top:"0px",left:"0px",width:Se+"px",height:Ye+"px",margin:"0px",padding:"0px"})}function Oi(e){"clientLeft"in e||(e.clientLeft=0,e.clientTop=0),"clientWidth"in e||(e.clientWidth=Se,e.clientHeight=Ye),"getBoundingClientRect"in e||(e.getBoundingClientRect=function(){var i={x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight};return i})}function ao(e){"offsetLeft"in e||(e.offsetLeft=0,e.offsetTop=0),"offsetWidth"in e||(e.offsetWidth=Se,e.offsetHeight=Ye)}function Ra(e){"scrollLeft"in e||(e.scrollLeft=0,e.scrollTop=0),"scrollWidth"in e||(e.scrollWidth=Se,e.scrollHeight=Ye)}function Za(e){var i=function(){return!0};e.classList=[],e.classList.add=i,e.classList.remove=i,e.classList.contains=i,e.classList.toggle=i}function Vo(e){var i=xs();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function xs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function uo(){}var wo=function(e){(0,Ir.Z)(r,e);var i=Vo(r);function r(){var n,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",s=arguments.length>1?arguments[1]:void 0;return(0,dt.Z)(this,r),n=i.call(this),(0,S.Z)((0,J.Z)(n),"className",void 0),(0,S.Z)((0,J.Z)(n),"children",void 0),(0,S.Z)((0,J.Z)(n),"focus",void 0),(0,S.Z)((0,J.Z)(n),"blur",void 0),(0,S.Z)((0,J.Z)(n),"insertBefore",void 0),(0,S.Z)((0,J.Z)(n),"appendChild",void 0),(0,S.Z)((0,J.Z)(n),"removeChild",void 0),(0,S.Z)((0,J.Z)(n),"remove",void 0),(0,S.Z)((0,J.Z)(n),"innerHTML",void 0),(0,S.Z)((0,J.Z)(n),"tagName",void 0),n.className="",n.children=[],n.focus=uo,n.blur=uo,n.insertBefore=uo,n.appendChild=uo,n.removeChild=uo,n.remove=uo,n.innerHTML="",n.tagName=a.toUpperCase(),Or((0,J.Z)(n),s),kn((0,J.Z)(n)),Za((0,J.Z)(n)),Oi((0,J.Z)(n)),ao((0,J.Z)(n)),Ra((0,J.Z)(n)),n}return(0,It.Z)(r)}(vo);function bs(e){var i=Ps();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function Ps(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Fs=function(e){(0,Ir.Z)(r,e);var i=bs(r);function r(n){return(0,dt.Z)(this,r),i.call(this,n)}return(0,It.Z)(r,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),r}(wo);function fu(e){var i=Es();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function Es(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ma=function(e){(0,Ir.Z)(r,e);var i=fu(r);function r(){return(0,dt.Z)(this,r),i.call(this,"video")}return(0,It.Z)(r)}(Fs),_a={},as={};function mf(e,i){_a=e,_a.id=i,"tagName"in _a||(_a.tagName="CANVAS"),_a.type="canvas",Mixin.parentNode(_a),Mixin.style(_a),Mixin.classList(_a),Mixin.clientRegion(_a),Mixin.offsetRegion(_a),_a.focus=function(){},_a.blur=function(){}}function Ol(e,i){var r=1024,n=1024;as={width:r,height:n,clientWidth:r/devicePixelRatio,clientHeight:n/devicePixelRatio,id:i,type:"canvas"},"tagName"in as||(as.tagName="CANVAS"),Mixin.parentNode(as),Mixin.style(as),Mixin.classList(as),Mixin.clientRegion(as),Mixin.offsetRegion(as),as.getContext=function(a){if(a==="2d")return e},as.focus=function(){},as.blur=function(){}}function qs(){return _a}function ac(){return as}var Yu=(0,It.Z)(function e(){(0,dt.Z)(this,e);var i=qs(),r=i.createImage&&i.createImage()||{};return"tagName"in r||(r.tagName="IMG",r.__proto__=e.prototype),Or(r),Za(r),Object.assign(r,{addEventListener:function(a,s){r["on".concat(a)]=s.bind(r)},removeEventListener:function(a){r["on".concat(a)]=null}}),r}),Ks={href:"",protocol:"",host:""};function ul(e){var i=_();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function _(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var M=function(e){(0,Ir.Z)(r,e);var i=ul(r);function r(){return(0,dt.Z)(this,r),i.call(this,"body",0)}return(0,It.Z)(r,[{key:"addEventListener",value:function(a,s){var f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(a,s,f){}},{key:"dispatchEvent",value:function(a){}}]),r}(wo),B=function(e){(0,Ir.Z)(r,e);var i=ul(r);function r(){return(0,dt.Z)(this,r),i.call(this,"html",0)}return(0,It.Z)(r,[{key:"addEventListener",value:function(a,s){var f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(a,s){}},{key:"dispatchEvent",value:function(a){}}]),r}(wo),R={},$={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:Ks,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(i){return i=i.toLowerCase(),i==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):i==="img"?new Yu:i==="video"?new ma:new wo(i)},createElementNS:function(i,r){return this.createElement(r)},createTextNode:function(i){return i},getElementById:function(i){return null},getElementsByTagName:function(i){return i=i.toLowerCase(),[]},getElementsByTagNameNS:function(i,r){return this.getElementsByTagName(r)},getElementsByName:function(i){return[]},querySelector:function(i){return null},querySelectorAll:function(i){return[]},addEventListener:function(i,r,n){R[i]||(R[i]=[]),R[i].push(r)},removeEventListener:function(i,r){var n=R[i];if(n&&n.length>0){for(var a=n.length;a--;a>0)if(n[a]===r){n.splice(a,1);break}}},dispatchEvent:function(i){var r=i.type,n=R[r];if(n)for(var a=0;a<n.length;a++)n[a](i);i.target&&typeof i.target["on"+r]=="function"&&i.target["on"+r](i)},createEvent:function(i){return new aa(i)}};$.documentElement=new B,$.head=new wo("head"),$.body=new M;var be=Object,We=W(90484),ht=function(){function e(){(0,dt.Z)(this,e),(0,S.Z)(this,"_w",void 0),(0,S.Z)(this,"_h",void 0),(0,S.Z)(this,"_data",void 0);var i=arguments.length;if(i===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){this._w=arguments[0],this._h=arguments[1],this._data=new Uint8ClampedArray(this._w*this._h*4);return}}else i===3&&(0,We.Z)(arguments[0])==="object"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number"&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return(0,It.Z)(e,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),e}(),vt=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,or,lr,Rn;if(vt){var ai=my.getSystemInfoSync();or=ai.system,lr=ai.platform,Rn=ai.language}else{var Fn={versions:function(){var e=Si.navigator.userAgent;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")===-1,mobile:!!e.match(/AppleWebKit.*Mobile.*/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:e.indexOf("Safari")===-1,weixin:e.indexOf("MicroMessenger")>-1,qq:e.match(/\sQQ/i)===" qq"}}(),language:(Si.navigator.browserLanguage||Si.navigator.language).toLowerCase()};Fn.versions.android?lr="android":Fn.versions.trident?lr="IE":Fn.versions.presto?lr="Opera":Fn.versions.webKit?lr="webKit":Fn.versions.gecko?lr="Firefox":Fn.versions.mobile?lr="mobile":Fn.versions.ios?lr="ios":Fn.versions.iPhone?lr="iPhone":Fn.versions.iPad?lr="ipad":Fn.versions.webApp?lr="webApp":Fn.versions.weixin?lr="weixin":Fn.versions.qq&&(lr="qq"),or=Si.navigator.userAgent,Rn=Fn.language}var Yi=or.toLowerCase().indexOf("android")!==-1,da=Yi?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",Ca="Mozilla/5.0 (".concat(da,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(Rn),Hi={platform:lr,language:Rn,appVersion:"5.0 (".concat(da,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:Ca},Ss={mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){}},hu=0,qu=0;function gf(e){var i=Date.now(),r=Math.max(hu+23,i);return qu=setTimeout(function(){e(hu=r)},r-i),qu}function ll(e){var i=qs();return i.requestAnimationFrame?i.requestAnimationFrame(e):gf(e)}function Bc(e){var i=qs();return i.cancelAnimationFrame?i.cancelAnimationFrame(e):clearTimeout(e)}var Tu=function(){function e(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if((0,dt.Z)(this,e),(0,S.Z)(this,"href",void 0),i.indexOf("http://")==0||i.indexOf("https://")==0){this.href=i;return}this.href=r+i}return(0,It.Z)(e,null,[{key:"createObjectURL",value:function(r){var n=r.buffers[0],a=r.type,s=Mu(n),f="data:".concat(a,";base64, ");return f+s}}]),e}();function Mu(e){for(var i="",r=new Uint8Array(e),n=r.byteLength,a=0;a<n;a++)i+=String.fromCharCode(r[a]);return _i(i)}var Pu={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:18446744073709552e3,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},lo={};function Gf(e){var i=Hf();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function Hf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $o=new Map,Nc=new Map,Iu=new Map,pu={json:"application/json",text:"application/text",arraybuffer:"application/octet-stream"};function yf(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{target:this};typeof this["on".concat(e)]=="function"&&this["on".concat(e)].call(this,i)}function Rl(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{readyState:e};this.readyState=e,yf.call(this,"readystatechange",i)}var zi=function(e){(0,Ir.Z)(r,e);var i=Gf(r);function r(){var n;return(0,dt.Z)(this,r),n=i.call(this),(0,S.Z)((0,J.Z)(n),"onabort",void 0),(0,S.Z)((0,J.Z)(n),"onerror",void 0),(0,S.Z)((0,J.Z)(n),"onload",void 0),(0,S.Z)((0,J.Z)(n),"onloadstart",void 0),(0,S.Z)((0,J.Z)(n),"onprogress",void 0),(0,S.Z)((0,J.Z)(n),"ontimeout",void 0),(0,S.Z)((0,J.Z)(n),"onloadend",void 0),(0,S.Z)((0,J.Z)(n),"onreadystatechange",void 0),(0,S.Z)((0,J.Z)(n),"readyState",void 0),(0,S.Z)((0,J.Z)(n),"response",void 0),(0,S.Z)((0,J.Z)(n),"responseText",void 0),(0,S.Z)((0,J.Z)(n),"_responseType",void 0),(0,S.Z)((0,J.Z)(n),"responseXML",void 0),(0,S.Z)((0,J.Z)(n),"status",void 0),(0,S.Z)((0,J.Z)(n),"statusText",void 0),(0,S.Z)((0,J.Z)(n),"upload",void 0),(0,S.Z)((0,J.Z)(n),"withCredentials",void 0),(0,S.Z)((0,J.Z)(n),"timeout",void 0),(0,S.Z)((0,J.Z)(n),"_url",void 0),(0,S.Z)((0,J.Z)(n),"_method",void 0),n.onabort=null,n.onerror=null,n.onload=null,n.onloadstart=null,n.onprogress=null,n.ontimeout=null,n.onloadend=null,n.onreadystatechange=null,n.readyState=0,n.response=null,n.responseText=null,n._responseType="text",n.responseXML=null,n.status=0,n.statusText="",n.upload={},n.withCredentials=!1,$o.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),n}return(0,It.Z)(r,[{key:"responseType",set:function(a){this._responseType=a}},{key:"abort",value:function(){var a=Iu.get("requestTask");a&&a.abort()}},{key:"getAllResponseHeaders",value:function(){var a=Nc.get("responseHeader");return Object.keys(a).map(function(s){return"".concat(s,": ").concat(a[s])}).join(`
`)}},{key:"getResponseHeader",value:function(a){return Nc.get("responseHeader")[a]}},{key:"open",value:function(a,s,f){this._method=a,this._url=s}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:""}},{key:"setRequestHeader",value:function(a,s){var f=$o.get("requestHeader");f[a]=s,$o.set("requestHeader",f)}},{key:"addEventListener",value:function(a,s){var f=this;typeof s=="function"&&(this["on"+a]=function(){var v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};v.target=v.target||f,s.call(f,v)})}},{key:"removeEventListener",value:function(a,s){this["on"+a]===s&&(this["on"+a]=null)}}]),r}(Ma);(0,S.Z)(zi,"UNSEND",void 0),(0,S.Z)(zi,"OPENED",void 0),(0,S.Z)(zi,"HEADERS_RECEIVED",void 0),(0,S.Z)(zi,"LOADING",void 0),(0,S.Z)(zi,"DONE",void 0),zi.UNSEND=0,zi.OPENED=1,zi.HEADERS_RECEIVED=2,zi.LOADING=3,zi.DONE=4;function kl(e){var i=Mh();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function Mh(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cl=function(e){(0,Ir.Z)(r,e);var i=kl(r);function r(n){var a;return(0,dt.Z)(this,r),a=i.call(this,n),(0,S.Z)((0,J.Z)(a),"touches",void 0),(0,S.Z)((0,J.Z)(a),"targetTouches",void 0),(0,S.Z)((0,J.Z)(a),"changedTouches",void 0),a.touches=[],a.targetTouches=[],a.changedTouches=[],a.target=qs(),a.currentTarget=qs(),a}return(0,It.Z)(r)}(aa);function zc(e){var i=e||{},r=i.x,n=r===void 0?0:r,a=i.y,s=a===void 0?0:a,f=i.clientX,v=f===void 0?0:f,m=i.clientY,x=m===void 0?0:m;Object.keys(e).indexOf("x")!==-1?(e.pageX=e.clientX=n,e.pageY=e.clientY=s):(e.x=v,e.y=x)}function Wf(e){return function(i){var r=new cl(e);r.changedTouches=i.changedTouches,r.touches=i.touches,r.targetTouches=Array.prototype.slice.call(i.touches),r.timeStamp=i.timeStamp,r.changedTouches.forEach(function(n){return zc(n)}),r.touches.forEach(function(n){return zc(n)}),r.targetTouches.forEach(function(n){return zc(n)}),$.dispatchEvent(r)}}function Ph(e){return function(i){i.type=e,$.dispatchEvent(i)}}var Xf=Wf("touchstart"),Zc=Wf("touchmove"),oc=Wf("touchend"),sc=Ph("mapCameaParams");function Ll(e){var i=fl();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function fl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Dl=function(e){(0,Ir.Z)(r,e);var i=Ll(r);function r(n){var a;return(0,dt.Z)(this,r),a=i.call(this,n),(0,S.Z)((0,J.Z)(a),"buttons",void 0),(0,S.Z)((0,J.Z)(a),"which",void 0),(0,S.Z)((0,J.Z)(a),"pointerId",void 0),(0,S.Z)((0,J.Z)(a),"bubbles",void 0),(0,S.Z)((0,J.Z)(a),"button",void 0),(0,S.Z)((0,J.Z)(a),"width",void 0),(0,S.Z)((0,J.Z)(a),"height",void 0),(0,S.Z)((0,J.Z)(a),"pressure",void 0),(0,S.Z)((0,J.Z)(a),"isPrimary",void 0),(0,S.Z)((0,J.Z)(a),"pointerType",void 0),(0,S.Z)((0,J.Z)(a),"altKey",void 0),(0,S.Z)((0,J.Z)(a),"ctrlKey",void 0),(0,S.Z)((0,J.Z)(a),"metaKey",void 0),(0,S.Z)((0,J.Z)(a),"shiftKey",void 0),a.target=qs(),a.currentTarget=qs(),a}return(0,It.Z)(r)}(aa),Ku=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],$s=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0],_f="touch";function xf(e,i,r){for(var n=new Dl(e),a=0;a<Ku.length;a++){var s=Ku[a];n[s]=i[s]||$s[a]}return n.type=e,n.target=qs(),n.currentTarget=qs(),n.buttons=Yf(e),n.which=n.buttons,n.pointerId=(i.identifier||0)+2,n.bubbles=!0,n.cancelable=!0,n.button=0,n.width=(i.radiusX||.5)*2,n.height=(i.radiusY||.5)*2,n.pressure=i.force||.5,n.isPrimary=uc(i),n.pointerType=_f,n.altKey=r.altKey,n.ctrlKey=r.ctrlKey,n.metaKey=r.metaKey,n.shiftKey=r.shiftKey,r.preventDefault&&(n.preventDefault=function(){r.preventDefault()}),n}function Yf(e){var i=0;return(e==="touchstart"||e==="touchmove"||e==="pointerdown"||e==="pointermove")&&(i=1),i}var du=null;function uc(e){return du===e.identifier}function Uc(e){du===null&&(du=e.identifier)}function bf(e){du===e.identifier&&(du=null)}function Fl(e){return function(i){for(var r=i.changedTouches,n=0;n<r.length;n++){var a=r[n];n===0&&e==="pointerdown"?Uc(a):(e==="pointerup"||e==="pointercancel")&&bf(a);var s=xf(e,a,i);$.dispatchEvent(s)}}}var hp=Fl("pointerdown"),Ef=Fl("pointermove"),Bl=Fl("pointerup");function Sf(e){var i=Cf();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function Cf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Nl=function(e){(0,Ir.Z)(r,e);var i=Sf(r);function r(n){return(0,dt.Z)(this,r),i.call(this,n)}return(0,It.Z)(r)}(aa);function jc(e){return function(i){i.type=e,$.dispatchEvent(i)}}var Ih=jc("mousedown"),Oh=jc("mousemove"),lc=jc("mouseup"),Rh=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,zl=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),Ji=Rh||zl,cc={atob:Pi,btoa:_i,devicePixelRatio:ji,Blob:Ta,document:$,Element:vo,Event:aa,EventTarget:Ma,HTMLCanvasElement:be,HTMLElement:wo,HTMLMediaElement:Fs,HTMLVideoElement:ma,Image:Yu,ImageData:ht,navigator:Hi,Node:Ao,requestAnimationFrame:ll,cancelAnimationFrame:Bc,screen:re,XMLHttpRequest:zi,performance:Ss,URL:Tu,WebGLRenderingContext:Pu,WebGL2RenderingContext:lo,addEventListener:function(i,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};$.addEventListener(i,r,n)},removeEventListener:function(i,r,n){$.removeEventListener(i,r)},dispatchEvent:function(i){$.dispatchEvent(i)},innerWidth:re.availWidth,innerHeight:re.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},ca=Ji?cc:Si,Ou=Ji?zi:Si.XMLHttpRequest,qi=Ji?Ks:Si.location;function Pa(e){var i=e;return typeof e=="string"&&(i=ca.document.getElementById(e)),i}function Cs(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Vc(e){return Cs(e).split(/\s+/)}function $u(e){var i,r,n=ca==null||(i=ca.document)===null||i===void 0||(r=i.documentElement)===null||r===void 0?void 0:r.style;if(!n)return e[0];for(var a in e)if(e[a]&&e[a]in n)return e[a];return e[0]}function Ua(e,i,r){var n=ca.document.createElement(e);return n.className=i||"",r&&r.appendChild(n),n}function fc(e){var i=e.parentNode;i&&i.removeChild(e)}function Zl(e,i){if(e.classList!==void 0)for(var r=Vc(i),n=0,a=r.length;n<a;n++)e.classList.add(r[n]);else if(!Gc(e,i)){var s=mo(e);Ru(e,(s?s+" ":"")+i)}}function Qu(e,i){e.classList!==void 0?e.classList.remove(i):Ru(e,Cs((" "+mo(e)+" ").replace(" "+i+" "," ")))}function Gc(e,i){if(e.classList!==void 0)return e.classList.contains(i);var r=mo(e);return r.length>0&&new RegExp("(^|\\s)"+i+"(\\s|$)").test(r)}function Ru(e,i){e instanceof HTMLElement?e.className=i:e.className.baseVal=i}function mo(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function Ul(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var hc=$u(["transform","WebkitTransform"]);function go(e,i){e.style[hc]=i}function gn(){if(typeof Event=="function")ca.dispatchEvent(new Event("resize"));else{var e=ca.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,ca,0),ca.dispatchEvent(e)}}function co(e){var i=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,i.join(""))}function Ju(){var e,i=ca.document.querySelector('meta[name="viewport"]');if(!i)return 1;var r=(e=i.content)===null||e===void 0?void 0:e.split(","),n=r.find(function(a){var s=a.split("="),f=(0,mn.Z)(s,2),v=f[0],m=f[1];return v==="initial-scale"});return n?n.split("=")[1]*1:1}var ka=Ju()<1?1:ca.devicePixelRatio,Qs=W(14665);function Is(e){return Function.toString.call(e).indexOf("[native code]")!==-1}var Af=W(51814);function Vr(e,i,r){return(0,Af.Z)()?Vr=Reflect.construct:Vr=function(a,s,f){var v=[null];v.push.apply(v,s);var m=Function.bind.apply(a,v),x=new m;return f&&(0,Qs.Z)(x,f.prototype),x},Vr.apply(null,arguments)}function pc(e){var i=typeof Map=="function"?new Map:void 0;return pc=function(n){if(n===null||!Is(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof i!="undefined"){if(i.has(n))return i.get(n);i.set(n,a)}function a(){return Vr(n,arguments,(0,_t.Z)(this).constructor)}return a.prototype=Object.create(n.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),(0,Qs.Z)(a,n)},pc(e)}function wf(e){var i=hl();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function hl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Aa=function(e){(0,Ir.Z)(r,e);var i=wf(r);function r(n,a,s){var f;return(0,dt.Z)(this,r),f=i.call(this,n),(0,S.Z)((0,J.Z)(f),"status",void 0),(0,S.Z)((0,J.Z)(f),"url",void 0),f.status=a,f.url=s,f.name=f.constructor.name,f.message=n,f}return(0,It.Z)(r,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),r}(pc(Error));function As(e){var i=new Ou;i.open("GET",e.url,!0);for(var r in e.headers)e.headers.hasOwnProperty(r)&&i.setRequestHeader(r,e.headers[r]);return i.withCredentials=e.credentials==="include",i}var Tf=function(i,r){var n=As(i);return n.setRequestHeader("Accept","application/json"),n.onerror=function(){r(new Error(n.statusText))},n.onload=function(){if(n.status>=200&&n.status<300&&n.response){var a;try{a=JSON.parse(n.response)}catch(s){return r(s)}r(null,a)}else n.status===401?r(new Aa("".concat(n.statusText),n.status,i.url)):r(new Aa(n.statusText,n.status,i.url))},n.send(),n},ku=function(i,r){var n=As(i);return n.responseType="arraybuffer",n.onerror=function(){r(new Error(n.statusText))},n.onload=function(){var a=n.response;if(a.byteLength===0&&n.status===200)return r(new Error("http status 200 returned without content."));n.status>=200&&n.status<300&&n.response?r(null,{data:a,cacheControl:n.getResponseHeader("Cache-Control"),expires:n.getResponseHeader("Expires")}):r(new Aa(n.statusText,n.status,i.url))},n.send(),n};function Bs(e){var i=$window.document.createElement("a");return i.href=e,i.protocol===$window.document.location.protocol&&i.host===$window.document.location.host}var Lu="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",qf=function(i,r){return ku(i,function(n,a){if(n)r(n);else if(a){var s=new ca.Image;s.crossOrigin="anonymous";var f=ca.URL||ca.webkitURL;s.onload=function(){r(null,s),f.revokeObjectURL(s.src)};var v=new ca.Blob([new Uint8Array(a.data)],{type:"image/png"});s.src=a.data.byteLength?f.createObjectURL(v):Lu}})},pl=2*Math.PI*6378137/2;function Kf(e){var i=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(r){var n=r.coordinates;Mf(i,n)}),i}function Mf(e,i){return Array.isArray(i[0])?i.forEach(function(r){Mf(e,r)}):(e[0]>i[0]&&(e[0]=i[0]),e[1]>i[1]&&(e[1]=i[1]),e[2]<i[0]&&(e[2]=i[0]),e[3]<i[1]&&(e[3]=i[1])),e}function vu(e,i){return Os(e,i)}function Os(e,i){return Array.isArray(e[0])?e.map(function(r){return Os(r,i)}):i(e)}function Mi(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=dl(e,i);var n=e[0],a=e[1],s=n*pl/180,f=Math.log(Math.tan((90+a)*Math.PI/360))/(Math.PI/180);return f=f*pl/180,r.enable&&(s=Number(s.toFixed(r.decimal)),f=Number(f.toFixed(r.decimal))),e.length===3?[s,f,e[2]]:[s,f]}function Du(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,r=e[0],n=e[1],a=r/pl*180,s=n/pl*180;return s=180/Math.PI*(2*Math.atan(Math.exp(s*Math.PI/180))-Math.PI/2),i!=null&&(a=Number(a.toFixed(i)),s=Number(s.toFixed(i))),e.length===3?[a,s,e[2]]:[a,s]}function mu(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function Go(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function dl(e,i){if(i===!1)return e;var r=mu(e[0]),n=Go(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[r,n,e[2]]:[r,n]}function os(e){var i=85.0511287798,r=Math.max(Math.min(i,e[1]),-i),n=256<<20,a=Math.PI/180,s=e[0]*a,f=r*a;f=Math.log(Math.tan(Math.PI/4+f/2));var v=.5/Math.PI,m=.5,x=-.5/Math.PI;return a=.5,s=n*(v*s+m),f=n*(x*f+a),[Math.floor(s),Math.floor(f)]}function Js(e){var i=.5/Math.PI,r=.5,n=-.5/Math.PI,a=.5,s=256<<20,f=_slicedToArray(e,2),v=f[0],m=f[1];v=(v/s-r)/i,m=(m/s-a)/n,m=(Math.atan(Math.pow(Math.E,m))-Math.PI/4)*2,a=Math.PI/180;var x=m/a,A=v/a;return[A,x]}function ws(e,i,r){var n=er(i[1]-e[1]),a=er(i[0]-e[0]),s=er(e[1]),f=er(i[1]),v=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(s)*Math.cos(f);return me(2*Math.atan2(Math.sqrt(v),Math.sqrt(1-v)),r="meters")}function Eu(e){var i=Math.PI/180,r=85.0511287798,n=6378137,a=Math.max(Math.min(r,e[1]),-r),s=Math.sin(a*i),f=n*e[0]*i,v=n*Math.log((1+s)/(1-s))/2;return[f,v]}function Ln(e,i){var r=Math.abs(e[1][1]-e[0][1])*i,n=Math.abs(e[1][0]-e[0][0])*i;return[[e[0][0]-n,e[0][1]-r],[e[1][0]+n,e[1][1]+r]]}function wn(e,i){return e[0][0]<=i[0][0]&&e[0][1]<=i[0][1]&&e[1][0]>=i[1][0]&&e[1][1]>=i[1][1]}function Hc(e){return[[e[0],e[1]],[e[2],e[3]]]}function Qo(e){var i=eu(e,[0,0]);return[e[0]/i,e[1]/i]}function eu(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))}function Ho(e,i){return e[0]*i[0]+e[1]*i[1]}function gu(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function $f(e,i){return Math.acos(Ho(e,i)/(gu(e)*gu(i)))*180/Math.PI}function Wc(e,i){return i[0]>0?i[1]>0?90-Math.atan(i[1]/i[0])*180/Math.PI:90+Math.atan(-i[1]/i[0])*180/Math.PI:i[1]<0?180+(90-Math.atan(i[1]/i[0])*180/Math.PI):270+Math.atan(i[1]/-i[0])*180/Math.PI}function ga(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!e||e.length<2)){for(var r=[0,1],n=0,a=[],s=0;s<e.length-1;s++){var f=e[s],v=e[s+1],m=eu(f,v);n+=m;var x=[f[0]-v[0],f[1]-v[1]],A=Wc(r,x);if(s>0){var T=a[s-1].rotation;T-A>360-T+A&&(A=A+360)}a.push({start:f,end:v,dis:m,rotation:A,duration:0})}return a.map(function(O){O.duration=i*(O.dis/n)}),a}}var La=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,r=arguments.length>1?arguments[1]:void 0;(0,dt.Z)(this,e),(0,S.Z)(this,"limit",void 0),(0,S.Z)(this,"cache",void 0),(0,S.Z)(this,"destroy",void 0),(0,S.Z)(this,"order",void 0),this.limit=i,this.destroy=r||this.defaultDestroy,this.order=[],this.clear()}return(0,It.Z)(e,[{key:"clear",value:function(){var r=this;this.order.forEach(function(n){r.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(r){var n=this.cache[r];return n&&(this.deleteOrder(r),this.appendOrder(r)),n}},{key:"set",value:function(r,n){this.cache[r]?(this.delete(r),this.cache[r]=n,this.appendOrder(r)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[r]=n,this.appendOrder(r))}},{key:"delete",value:function(r){var n=this.cache[r];n&&(this.deleteCache(r),this.deleteOrder(r),this.destroy(n,r))}},{key:"deleteCache",value:function(r){delete this.cache[r]}},{key:"deleteOrder",value:function(r){var n=this.order.findIndex(function(a){return a===r});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(r){this.order.push(r)}},{key:"defaultDestroy",value:function(r,n){return null}}]),e}();function vl(e,i){e.forEach(function(r){!i[r]||(i[r]=i[r].bind(i))})}var dc=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16;(0,dt.Z)(this,e),(0,S.Z)(this,"duration",16),(0,S.Z)(this,"timestamp",new Date().getTime()),this.duration=i}return(0,It.Z)(e,[{key:"run",value:function(r){var n=new Date().getTime(),a=n-this.timestamp;this.timestamp=n,a>=this.duration&&r()}}]),e}(),Ns=W(2650);function yu(e){return typeof e=="string"?!!Ns.ZP(e):!1}function pi(e){var i=Ns.ZP(e),r=[0,0,0,0];return i!=null&&(r[0]=i.r/255,r[1]=i.g/255,r[2]=i.b/255,r[3]=i.opacity),r}function zs(e){var i=e&&e[0],r=e&&e[1],n=e&&e[2],a=i+r*256+n*65536-1;return a}function ss(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function jl(e){var i=ca.document.createElement("canvas"),r=i.getContext("2d");i.width=256,i.height=1;for(var n=r.createLinearGradient(0,0,256,1),a=null,s=e.positions[0],f=e.positions[e.positions.length-1],v=0;v<e.colors.length;++v){var m=(e.positions[v]-s)/(f-s);n.addColorStop(m,e.colors[v])}if(r.fillStyle=n,r.fillRect(0,0,256,1),Ji)return a=new Uint8ClampedArray(r.getImageData(0,0,256,1).data),{data:a,width:256,height:1};a=r.getImageData(0,0,256,1).data;for(var x=r.createImageData(256,1),A=0;A<x.data.length;A+=4)x.data[A+0]=a[A+0],x.data[A+1]=a[A+1],x.data[A+2]=a[A+2],x.data[A+3]=a[A+3];return x}var Fu;(function(e){e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e.LEFT="left",e.RIGHT="right"})(Fu||(Fu={}));var el={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Xc(e,i,r){var n=e.classList;for(var a in el)el.hasOwnProperty(a)&&n.remove("l7-".concat(r,"-anchor-").concat(a));n.add("l7-".concat(r,"-anchor-").concat(i))}function Da(e,i){return{enable:e,mask:255,func:{cmp:514,ref:i?1:0,mask:255}}}var tu={BACK:1029,FRONT:1028};function Vl(e){switch(e){case"GAODE1.x":return tu.BACK;case"GAODE2.x":return tu.BACK;case"MAPBOX":return tu.FRONT;case"SIMPLE":return tu.FRONT;case"GLOBEL":return tu.BACK;case"L7MAP":return tu.FRONT;default:return tu.FRONT}}function ml(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i*1}function gl(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i*1}function Yc(e){if(e.length===0)return 0;for(var i=e[0]*1,r=1;r<e.length;r++)i+=e[r]*1;return i}function yl(e){if(e.length===0)throw new Error("mean requires at least one data point");return Yc(e)/e.length}function ru(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var i=e[0],r=NaN,n=0,a=1,s=1;s<e.length+1;s++)e[s]!==i?(a>n&&(n=a,r=i),a=1,i=e[s]):a++;return r*1}var vc={min:gl,max:ml,mean:yl,sum:Yc,mode:ru};function Gl(e,i){return e.map(function(r){return r[i]})}function Qf(e,i){return vc[e](i)}function Hl(e,i){var r=i.extent,n=r===void 0?[121.168,30.2828,121.384,30.4219]:r,a=new Promise(function(f){l(e,function(v){f(v)})}),s={originData:e,images:a,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return s}function l(e,i){var r=e,n=[];if(typeof r=="string")qf({url:r},function(f,v){n.push(v),i(n)});else{var a=r.length,s=0;r.forEach(function(f){qf({url:f},function(v,m){s++,n.push(m),s===a&&i(n)})})}return Hl}function h(e,i){var r=i.extent,n=i.width,a=i.height,s=i.min,f=i.max,v={_id:1,dataArray:[{_id:1,data:Array.from(e),width:n,height:a,min:s,max:f,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]};return v}var c=W(30236),d=W.n(c),E=W(47037),w=W.n(E),P=W(23560),L=W.n(P),Z=W(50361),X=W.n(Z),se=W(34155);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function fe(e,i,r,n){function a(s){return s instanceof r?s:new r(function(f){f(s)})}return new(r||(r=Promise))(function(s,f){function v(A){try{x(n.next(A))}catch(T){f(T)}}function m(A){try{x(n.throw(A))}catch(T){f(T)}}function x(A){A.done?s(A.value):a(A.value).then(v,m)}x((n=n.apply(e,i||[])).next())})}function de(e,i){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,a,s,f;return f={next:v(0),throw:v(1),return:v(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function v(x){return function(A){return m([x,A])}}function m(x){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(s=x[0]&2?a.return:x[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,x[1])).done)return s;switch(a=0,s&&(x=[x[0]&2,s.value]),x[0]){case 0:case 1:s=x;break;case 4:return r.label++,{value:x[1],done:!1};case 5:r.label++,a=x[1],x=[0];continue;case 7:x=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(x[0]===6||x[0]===2)){r=0;continue}if(x[0]===3&&(!s||x[1]>s[0]&&x[1]<s[3])){r.label=x[1];break}if(x[0]===6&&r.label<s[1]){r.label=s[1],s=x;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(x);break}s[2]&&r.ops.pop(),r.trys.pop();continue}x=i.call(e,r)}catch(A){x=[6,A],a=0}finally{n=s=0}if(x[0]&5)throw x[1];return{value:x[0]?x[1]:void 0,done:!0}}}function ke(e,i){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),a,s=[],f;try{for(;(i===void 0||i-- >0)&&!(a=n.next()).done;)s.push(a.value)}catch(v){f={error:v}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(f)throw f.error}}return s}function Oe(){for(var e=[],i=0;i<arguments.length;i++)e=e.concat(ke(arguments[i]));return e}function ze(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Ce(e,i){return i={exports:{}},e(i,i.exports),i.exports}var je=Ce(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return n&&typeof n.length=="number"&&n.length>=0&&n.length%1==0}e.exports=i.default});ze(je);var Qe=Ce(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return function(){for(var n=[],a=arguments.length;a--;)n[a]=arguments[a];var s=n.pop();return r.call(this,n,s)}},e.exports=i.default});ze(Qe);var gt=Ce(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.fallback=a,i.wrap=s;var r=i.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,n=i.hasNextTick=typeof se=="object"&&typeof se.nextTick=="function";function a(v){setTimeout(v,0)}function s(v){return function(m){for(var x=[],A=arguments.length-1;A-- >0;)x[A]=arguments[A+1];return v(function(){return m.apply(void 0,x)})}}var f;r?f=setImmediate:n?f=se.nextTick:f=a,i.default=s(f)});ze(gt);var Gt=gt.fallback,Ut=gt.wrap,Yt=gt.hasSetImmediate,vr=gt.hasNextTick,Dr=Ce(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(Qe),n=a(gt);function a(m){return m&&m.__esModule?m:{default:m}}function s(m){return(0,_r.isAsync)(m)?function(){for(var x=[],A=arguments.length;A--;)x[A]=arguments[A];var T=x.pop(),O=m.apply(this,x);return f(O,T)}:(0,r.default)(function(x,A){var T;try{T=m.apply(this,x)}catch(O){return A(O)}if(T&&typeof T.then=="function")return f(T,A);A(null,T)})}function f(m,x){return m.then(function(A){v(x,null,A)},function(A){v(x,A&&A.message?A:new Error(A))})}function v(m,x,A){try{m(x,A)}catch(T){(0,n.default)(function(O){throw O},T)}}e.exports=i.default});ze(Dr);var _r=Ce(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.isAsyncIterable=i.isAsyncGenerator=i.isAsync=void 0;var r=n(Dr);function n(m){return m&&m.__esModule?m:{default:m}}function a(m){return m[Symbol.toStringTag]==="AsyncFunction"}function s(m){return m[Symbol.toStringTag]==="AsyncGenerator"}function f(m){return typeof m[Symbol.asyncIterator]=="function"}function v(m){if(typeof m!="function")throw new Error("expected a function");return a(m)?(0,r.default)(m):m}i.default=v,i.isAsync=a,i.isAsyncGenerator=s,i.isAsyncIterable=f});ze(_r);var ln=_r.isAsyncIterable,Gn=_r.isAsyncGenerator,Hn=_r.isAsync,Bn=Ce(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n,a){if(a===void 0&&(a=n.length),!a)throw new Error("arity is undefined");function s(){for(var f=this,v=[],m=arguments.length;m--;)v[m]=arguments[m];return typeof v[a-1]=="function"?n.apply(this,v):new Promise(function(x,A){v[a-1]=function(T){for(var O=[],F=arguments.length-1;F-- >0;)O[F]=arguments[F+1];if(T)return A(T);x(O.length>1?O:O[0])},n.apply(f,v)})}return Object.defineProperty(s,"name",{configurable:!0,value:"awaitable("+n.name+")"}),s}e.exports=i.default});ze(Bn);var Di=Ce(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=s(je),n=s(_r),a=s(Bn);function s(f){return f&&f.__esModule?f:{default:f}}i.default=(0,a.default)(function(f,v,m){var x=(0,r.default)(v)?[]:{};f(v,function(A,T,O){(0,n.default)(A)(function(F){for(var j,Y=[],ee=arguments.length-1;ee-- >0;)Y[ee]=arguments[ee+1];Y.length<2&&(j=Y,Y=j[0]),x[T]=Y,O(F)})},function(A){return m(A,x)})},3),e.exports=i.default});ze(Di);var rn=Ce(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){function a(){for(var s=[],f=arguments.length;f--;)s[f]=arguments[f];if(n!==null){var v=n;n=null,v.apply(this,s)}}return Object.assign(a,n),a}e.exports=i.default});ze(rn);var oi=Ce(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return r[Symbol.iterator]&&r[Symbol.iterator]()},e.exports=i.default});ze(oi);var ci=Ce(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=m;var r=a(je),n=a(oi);function a(x){return x&&x.__esModule?x:{default:x}}function s(x){var A=-1,T=x.length;return function(){return++A<T?{value:x[A],key:A}:null}}function f(x){var A=-1;return function(){var O=x.next();return O.done?null:(A++,{value:O.value,key:A})}}function v(x){var A=x?Object.keys(x):[],T=-1,O=A.length;return function(){var j=A[++T];return T<O?{value:x[j],key:j}:null}}function m(x){if((0,r.default)(x))return s(x);var A=(0,n.default)(x);return A?f(A):v(x)}e.exports=i.default});ze(ci);var Qn=Ce(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];if(n===null)throw new Error("Callback was already called.");var f=n;n=null,f.apply(this,a)}}e.exports=i.default});ze(Qn);var Xn=Ce(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r={};i.default=r,e.exports=i.default});ze(Xn);var di=Ce(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=a;var r=n(Xn);function n(s){return s&&s.__esModule?s:{default:s}}function a(s,f,v,m){var x=!1,A=!1,T=!1,O=0,F=0;function j(){O>=f||T||x||(T=!0,s.next().then(function(Ae){var Fe=Ae.value,Xe=Ae.done;if(!(A||x)){if(T=!1,Xe){x=!0,O<=0&&m(null);return}O++,v(Fe,F,Y),F++,j()}}).catch(ee))}function Y(Ae,Fe){if(O-=1,!A){if(Ae)return ee(Ae);if(Ae===!1){x=!0,A=!0;return}if(Fe===r.default||x&&O<=0)return x=!0,m(null);j()}}function ee(Ae){A||(T=!1,x=!0,m(Ae))}j()}e.exports=i.default});ze(di);var $n=Ce(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=v(rn),n=v(ci),a=v(Qn),s=v(di),f=v(Xn);function v(m){return m&&m.__esModule?m:{default:m}}i.default=function(m){return function(x,A,T){if(T=(0,r.default)(T),m<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!x)return T(null);if((0,_r.isAsyncGenerator)(x))return(0,s.default)(x,m,A,T);if((0,_r.isAsyncIterable)(x))return(0,s.default)(x[Symbol.asyncIterator](),m,A,T);var O=(0,n.default)(x),F=!1,j=!1,Y=0,ee=!1;function Ae(Xe,nt){if(!j)if(Y-=1,Xe)F=!0,T(Xe);else if(Xe===!1)F=!0,j=!0;else{if(nt===f.default||F&&Y<=0)return F=!0,T(null);ee||Fe()}}function Fe(){for(ee=!0;Y<m&&!F;){var Xe=O();if(Xe===null){F=!0,Y<=0&&T(null);return}Y+=1,A(Xe.value,Xe.key,(0,a.default)(Ae))}ee=!1}Fe()}},e.exports=i.default});ze($n);var qn=Ce(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=s($n),n=s(_r),a=s(Bn);function s(v){return v&&v.__esModule?v:{default:v}}function f(v,m,x,A){return(0,r.default)(m)(v,(0,n.default)(x),A)}i.default=(0,a.default)(f,4),e.exports=i.default});ze(qn);var yo=Ce(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=a(qn),n=a(Bn);function a(f){return f&&f.__esModule?f:{default:f}}function s(f,v,m){return(0,r.default)(f,1,v,m)}i.default=(0,n.default)(s,3),e.exports=i.default});ze(yo);var Qa=Ce(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(Di),n=a(yo);function a(f){return f&&f.__esModule?f:{default:f}}function s(f,v){return(0,r.default)(n.default,f,v)}e.exports=i.default}),To=ze(Qa),ia=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return this.args=r,To(this.tasks)},e.prototype.tap=function(i,r){var n=this;this.tasks.push(function(a){r.apply(void 0,Oe(n.args)),a(null,i)})},e}(),Ha=Ce(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=x(je),n=x(Xn),a=x(qn),s=x(rn),f=x(Qn),v=x(_r),m=x(Bn);function x(F){return F&&F.__esModule?F:{default:F}}function A(F,j,Y){Y=(0,s.default)(Y);var ee=0,Ae=0,Fe=F.length,Xe=!1;Fe===0&&Y(null);function nt(Et,wt){Et===!1&&(Xe=!0),Xe!==!0&&(Et?Y(Et):(++Ae===Fe||wt===n.default)&&Y(null))}for(;ee<Fe;ee++)j(F[ee],ee,(0,f.default)(nt))}function T(F,j,Y){return(0,a.default)(F,Infinity,j,Y)}function O(F,j,Y){var ee=(0,r.default)(F)?A:T;return ee(F,(0,v.default)(j),Y)}i.default=(0,m.default)(O,3),e.exports=i.default});ze(Ha);var fo=Ce(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(Ha),n=a(Di);function a(f){return f&&f.__esModule?f:{default:f}}function s(f,v){return(0,n.default)(r.default,f,v)}e.exports=i.default}),Rs=ze(fo),us=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.promise=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return Rs(this.tasks)},e.prototype.tapPromise=function(i,r){var n=this;this.tasks.push(function(a){return fe(n,void 0,void 0,function(){return de(this,function(s){switch(s.label){case 0:return[4,r()];case 1:return s.sent(),a(null,i),[2]}})})})},e}(),Bu=Ce(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=f(rn),n=f(Qn),a=f(_r),s=f(Bn);function f(m){return m&&m.__esModule?m:{default:m}}function v(m,x){if(x=(0,r.default)(x),!Array.isArray(m))return x(new Error("First argument to waterfall must be an array of functions"));if(!m.length)return x();var A=0;function T(F){var j=(0,a.default)(m[A++]);j.apply(void 0,F.concat([(0,n.default)(O)]))}function O(F){for(var j=[],Y=arguments.length-1;Y-- >0;)j[Y]=arguments[Y+1];if(F!==!1){if(F||A===m.length)return x.apply(void 0,[F].concat(j));T(j)}}T([])}i.default=(0,s.default)(v),e.exports=i.default}),ls=ze(Bu),nu=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return ls(this.tasks)},e.prototype.tap=function(i,r){this.tasks.length===0?this.tasks.push(function(n){var a=r();n(a?null:!1,a)}):this.tasks.push(function(n,a){var s=r();a(s?null:!1,i)})},e}(),Jo=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return To(this.tasks)},e.prototype.tap=function(i,r){this.tasks.push(function(n){var a=r();n(a,i)})},e}(),cs=W(26729),Wl=W.n(cs),Nu=W(69848),_l=W.n(Nu);function Xl(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function iu(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Xl(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Xl(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function xl(e,i){var r=i.radius,n=r===void 0?40:r,a=i.maxZoom,s=a===void 0?18:a,f=i.minZoom,v=f===void 0?0:f,m=i.zoom,x=m===void 0?2:m;if(e.pointIndex){var A=e.pointIndex.getClusters(e.extent,Math.floor(x));return e.dataArray=Su(A),e}var T=new(_l())({radius:n,minZoom:v,maxZoom:s}),O={type:"FeatureCollection",features:[]};return O.features=e.dataArray.map(function(F){return{type:"Feature",geometry:{type:"Point",coordinates:F.coordinates},properties:iu({},F)}}),T.load(O.features),T}function Su(e){return e.map(function(i,r){return iu({coordinates:i.geometry.coordinates,_id:r+1},i.properties)})}function Eo(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i}function zu(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i}function Zu(e){if(e.length===0)return 0;for(var i=e[0],r=0,n,a=1;a<e.length;a++)n=i+e[a]*1,Math.abs(i)>=Math.abs(e[a])?r+=i-n+e[a]:r+=e[a]-n+i,i=n;return i+r*1}function tl(e){if(e.length===0)throw new Error("mean requires at least one data point");return Zu(e)/e.length}var ua={min:zu,max:Eo,mean:tl,sum:Zu};function Zs(e,i){return e.map(function(r){return r[i]*1})}function es(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function _u(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?es(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):es(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function qc(e){var i=Kc();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function Kc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Pf(e,i){if(Array.isArray(i))return i}var au=function(e){(0,Ir.Z)(r,e);var i=qc(r);function r(n,a){var s;return(0,dt.Z)(this,r),s=i.call(this),(0,S.Z)((0,J.Z)(s),"data",void 0),(0,S.Z)((0,J.Z)(s),"extent",void 0),(0,S.Z)((0,J.Z)(s),"hooks",{init:new ia}),(0,S.Z)((0,J.Z)(s),"parser",{type:"geojson"}),(0,S.Z)((0,J.Z)(s),"transforms",[]),(0,S.Z)((0,J.Z)(s),"cluster",!1),(0,S.Z)((0,J.Z)(s),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,S.Z)((0,J.Z)(s),"mapService",void 0),(0,S.Z)((0,J.Z)(s),"invalidExtent",!1),(0,S.Z)((0,J.Z)(s),"dataArrayChanged",!1),(0,S.Z)((0,J.Z)(s),"originData",void 0),(0,S.Z)((0,J.Z)(s),"rawData",void 0),(0,S.Z)((0,J.Z)(s),"cfg",{}),(0,S.Z)((0,J.Z)(s),"clusterIndex",void 0),s.originData=n,s.initCfg(a),s.hooks.init.tap("parser",function(){s.excuteParser()}),s.hooks.init.tap("cluster",function(){s.initCluster()}),s.hooks.init.tap("transform",function(){s.executeTrans()}),s.init(),s}return(0,It.Z)(r,[{key:"setData",value:function(a,s){this.originData=a,this.dataArrayChanged=!1,this.initCfg(s),this.init(),this.emit("update")}},{key:"getClusters",value:function(a){return this.clusterIndex.getClusters(this.caculClusterExtent(2),a)}},{key:"getClustersLeaves",value:function(a){return this.clusterIndex.getLeaves(a,Infinity)}},{key:"updateClusterData",value:function(a){var s=this,f=this.clusterOptions,v=f.method,m=v===void 0?"sum":v,x=f.field,A=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(a));this.clusterOptions.zoom=a,A.forEach(function(T){T.id||(T.properties.point_count=1)}),(x||L()(m))&&(A=A.map(function(T){var O=T.id;if(O){var F=s.clusterIndex.getLeaves(O,Infinity),j=F.map(function(Ae){return Ae.properties}),Y;if(w()(m)&&x){var ee=Zs(j,x);Y=ua[m](ee)}L()(m)&&(Y=m(j)),T.properties.stat=Y}else T.properties.point_count=1;return T})),this.data=le("geojson")({type:"FeatureCollection",features:A}),this.executeTrans()}},{key:"getFeatureById",value:function(a){var s=this.parser.type,f=s===void 0?"geojson":s;if(f==="geojson"&&!this.cluster){var v=a<this.originData.features.length?this.originData.features[a]:"null",m=X()(v);if(this.transforms.length!==0||this.dataArrayChanged){var x=this.data.dataArray.find(function(A){return A._id===a});m.properties=x}return m}else return a<this.data.dataArray.length?this.data.dataArray[a]:"null"}},{key:"updateFeaturePropertiesById",value:function(a,s){this.data.dataArray=this.data.dataArray.map(function(f){return f._id===a?_u(_u({},f),s):f}),this.dataArrayChanged=!0,this.emit("update")}},{key:"getFeatureId",value:function(a,s){var f=this.data.dataArray.find(function(v){return v[a]===s});return f==null?void 0:f._id}},{key:"destroy",value:function(){this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null}},{key:"caculClusterExtent",value:function(a){var s=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(s=Ln(Hc(this.extent),a)),s[0].concat(s[1])}},{key:"initCfg",value:function(a){this.cfg=d()(this.cfg,a,Pf);var s=this.cfg;s&&(s.parser&&(this.parser=s.parser),s.transforms&&(this.transforms=s.transforms),this.cluster=s.cluster||!1,s.clusterOptions&&(this.cluster=!0,this.clusterOptions=_u(_u({},this.clusterOptions),s.clusterOptions)))}},{key:"excuteParser",value:function(){var a=this.parser,s=a.type||"geojson";if(s==="imagetile"){this.data={tileurl:this.originData,dataArray:[]};return}var f=le(s);this.data=f(this.originData,a),this.extent=Kf(this.data.dataArray),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3]}},{key:"executeTrans",value:function(){var a=this,s=this.transforms;s.forEach(function(f){var v=f.type,m=ye(v)(a.data,f);Object.assign(a.data,m)})}},{key:"initCluster",value:function(){if(!!this.cluster){var a=this.clusterOptions||{};this.clusterIndex=xl(this.data,a)}}},{key:"init",value:function(){this.hooks.init.call(this)}}]),r}(cs.EventEmitter);function mc(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.filter(r)),e}function ou(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=bl(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function bl(e,i){if(!!e){if(typeof e=="string")return gc(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return gc(e,i)}}function gc(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var su=6378e3;function Bo(e,i){var r=e.dataArray,n=i.size,a=n===void 0?10:n,s=a/(2*Math.PI*su)*(256<<20)/2,f=$c(r,a),v=f.gridHash,m=f.gridOffset,x=pp(v,m,i);return{yOffset:s,xOffset:s,radius:s,type:"grid",dataArray:x}}function $c(e,i){var r=Infinity,n=-Infinity,a,s=ou(e),f;try{for(s.s();!(f=s.n()).done;){var v=f.value;a=v.coordinates[1],Number.isFinite(a)&&(r=a<r?a:r,n=a>n?a:n)}}catch(Xe){s.e(Xe)}finally{s.f()}var m=(r+n)/2,x=Jf(i,m);if(x.xOffset<=0||x.yOffset<=0)return{gridHash:{},gridOffset:x};var A={},T=ou(e),O;try{for(T.s();!(O=T.n()).done;){var F=O.value,j=F.coordinates[1],Y=F.coordinates[0];if(Number.isFinite(j)&&Number.isFinite(Y)){var ee=Math.floor((j+90)/x.yOffset),Ae=Math.floor((Y+180)/x.xOffset),Fe="".concat(ee,"-").concat(Ae);A[Fe]=A[Fe]||{count:0,points:[]},A[Fe].count+=1,A[Fe].points.push(F)}}}catch(Xe){T.e(Xe)}finally{T.f()}return{gridHash:A,gridOffset:x}}function Jf(e,i){var r=kh(e),n=eh(i,e);return{yOffset:r,xOffset:n}}function kh(e){return e/su*(180/Math.PI)}function eh(e,i){return i/su*(180/Math.PI)/Math.cos(e*Math.PI/180)}function pp(e,i,r){return Object.keys(e).reduce(function(n,a,s){var f=a.split("-"),v=parseInt(f[0],10),m=parseInt(f[1],10),x={};if(r.field&&r.method){var A=Gl(e[a].points,r.field);x[r.method]=vc[r.method](A)}return Object.assign(x,{_id:s,coordinates:os([-180+i.xOffset*(m+.5),-90+i.yOffset*(v+.5)]),rawData:e[a].points,count:e[a].count}),n.push(x),n},[])}var yc=Math.PI/3,_c=[0,yc,2*yc,3*yc,4*yc,5*yc];function If(e){return e[0]}function Lh(e){return e[1]}function qp(){var e=0,i=0,r=1,n=1,a=If,s=Lh,f,v,m;function x(T){var O={},F=[],j,Y=T.length;for(j=0;j<Y;++j)if(!(isNaN(Ae=+a.call(null,ee=T[j],j,T))||isNaN(Fe=+s.call(null,ee,j,T)))){var ee,Ae,Fe,Xe=Math.round(Fe=Fe/m),nt=Math.round(Ae=Ae/v-(Xe&1)/2),Et=Fe-Xe;if(Math.abs(Et)*3>1){var wt=Ae-nt,Wt=nt+(Ae<nt?-1:1)/2,ur=Xe+(Fe<Xe?-1:1),Ar=Ae-Wt,Jr=Fe-ur;wt*wt+Et*Et>Ar*Ar+Jr*Jr&&(nt=Wt+(Xe&1?1:-1)/2,Xe=ur)}var gr=nt+"-"+Xe,vn=O[gr];vn?vn.push(ee):(F.push(vn=O[gr]=[ee]),vn.x=(nt+(Xe&1)/2)*v,vn.y=Xe*m)}return F}function A(T){var O=0,F=0;return _c.map(function(j){var Y=Math.sin(j)*T,ee=-Math.cos(j)*T,Ae=Y-O,Fe=ee-F;return O=Y,F=ee,[Ae,Fe]})}return x.hexagon=function(T){return"m"+A(T==null?f:+T).join("l")+"z"},x.centers=function(){for(var T=[],O=Math.round(i/m),F=Math.round(e/v),j=O*m;j<n+f;j+=m,++O)for(var Y=F*v+(O&1)*v/2;Y<r+v/2;Y+=v)T.push([Y,j]);return T},x.mesh=function(){var T=A(f).slice(0,4).join("l");return x.centers().map(function(O){return"M"+O+"m"+T}).join("")},x.x=function(T){return arguments.length?(a=T,x):a},x.y=function(T){return arguments.length?(s=T,x):s},x.radius=function(T){return arguments.length?(f=+T,v=f*2*Math.sin(yc),m=f*1.5,x):f},x.size=function(T){return arguments.length?(e=i=0,r=+T[0],n=+T[1],x):[r-e,n-i]},x.extent=function(T){return arguments.length?(e=+T[0][0],i=+T[0][1],r=+T[1][0],n=+T[1][1],x):[[e,i],[r,n]]},x.radius(1)}function El(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Qc(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?El(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):El(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Kp=6378e3;function Pd(e,i){var r=e.dataArray,n=i.size,a=n===void 0?10:n,s=i.method,f=s===void 0?"sum":s,v=a/(2*Math.PI*Kp)*(256<<20)/2,m=r.map(function(O){var F=os(O.coordinates),j=(0,mn.Z)(F,2),Y=j[0],ee=j[1];return Qc(Qc({},O),{},{coordinates:[Y,ee]})}),x=qp().radius(v).x(function(O){return O.coordinates[0]}).y(function(O){return O.coordinates[1]}),A=x(m),T={dataArray:A.map(function(O,F){var j;if(i.field&&f){var Y=Gl(O,i.field);O[f]=vc[f](Y)}return j={},(0,S.Z)(j,i.method,O[f]),(0,S.Z)(j,"count",O.length),(0,S.Z)(j,"rawData",O),(0,S.Z)(j,"coordinates",[O.x,O.y]),(0,S.Z)(j,"_id",F),j}),radius:v,xOffset:v,yOffset:v,type:"hexagon"};return T}function Jc(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Dh(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Jc(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Jc(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Id(e,i){var r=i.sourceField,n=i.targetField,a=i.data,s={};return a.forEach(function(f){s[f[r]]=f}),e.dataArray=e.dataArray.map(function(f){var v=f[n];return Dh(Dh({},f),s[v])}),e}function Od(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.map(r)),e}Be("geojson",Xr),Be("image",Hl),Be("csv",wr),Be("json",bt),Be("raster",h),Je("cluster",xl),Je("filter",mc),Je("join",Id),Je("map",Od),Je("grid",Bo),Je("hexagon",Pd);var $p=nr,dp=Nr,Fh=au,th=W(28660),Yr=W(86700),Mo=W(84879),xt={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},Qp=W(31745),Bh=W.n(Qp);function rh(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Of(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?rh(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rh(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function nh(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=ih(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function ih(e,i){if(!!e){if(typeof e=="string")return Yl(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Yl(e,i)}}function Yl(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Sl=30;function ah(e){var i=e.characterSet,r=e.getFontWidth,n=e.fontHeight,a=e.buffer,s=e.maxCanvasWidth,f=e.mapping,v=f===void 0?{}:f,m=e.xOffset,x=m===void 0?0:m,A=e.yOffset,T=A===void 0?0:A,O=0,F=x;Array.from(i).forEach(function(Y,ee){if(!v[Y]){var Ae=r(Y,ee);F+Sl>s&&(F=0,O++),v[Y]={x:F,y:T+O*Sl,width:Sl,height:Sl,advance:Ae},F+=Sl}});var j=n+a*2;return{mapping:v,xOffset:F,yOffset:T+O*j,canvasHeight:oh(T+(O+1)*j)}}function Nh(e,i,r){var n=0,a=0,s=0,f=[],v={},m=nh(e),x;try{for(m.s();!(x=m.n()).done;){var A=x.value;if(!v[A.id]){var T=A.size;n+T+i>r&&(ql(v,f,a),n=0,a=s+a+i,s=0,f=[]),f.push({icon:A,xOffset:n}),n=n+T+i,s=Math.max(s,T)}}}catch(F){m.e(F)}finally{m.f()}f.length>0&&ql(v,f,a);var O=oh(s+a+i);return{mapping:v,canvasHeight:O}}function ql(e,i,r){var n=nh(i),a;try{for(n.s();!(a=n.n()).done;){var s=a.value,f=s.icon,v=s.xOffset;e[f.id]=Of(Of({},f),{},{x:v,y:r,image:f.image,width:f.width,height:f.height})}}catch(m){n.e(m)}finally{n.f()}}function oh(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var Rf,sh;function ef(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=kf(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function kf(e,i){if(!!e){if(typeof e=="string")return Us(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Us(e,i)}}function Us(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Lf(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function tf(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Lf(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Lf(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var uh=Uh(),lh="sans-serif",zh="normal",Cl=24,rf=3,Jp=.25,Zh=8,vp=1024,Rd=1,ed=1,Cu=3,kd=null;function Uh(){for(var e=[],i=32;i<128;i++)e.push(String.fromCharCode(i));return e}function nf(e,i,r,n){e.font="".concat(n," ").concat(r,"px ").concat(i),e.fillStyle="black",e.textBaseline="middle"}function Uu(e,i){for(var r=0;r<e.length;r++)i.data[4*r+3]=e[r]}var td=(Rf=(0,Yr.b2)(),Rf(sh=function(){function e(){(0,dt.Z)(this,e),(0,S.Z)(this,"fontAtlas",void 0),(0,S.Z)(this,"iconFontMap",void 0),(0,S.Z)(this,"iconFontGlyphs",{}),(0,S.Z)(this,"fontOptions",void 0),(0,S.Z)(this,"key",void 0),(0,S.Z)(this,"cache",new La(Cu))}return(0,It.Z)(e,[{key:"scale",get:function(){return ed}},{key:"canvas",get:function(){var r=this.cache.get(this.key);return r&&r.data}},{key:"mapping",get:function(){var r=this.cache.get(this.key);return r&&r.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:lh,fontWeight:zh,characterSet:uh,fontSize:Cl,buffer:rf,sdf:!0,cutoff:Jp,radius:Zh,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(r){var n=this;r.forEach(function(a){n.iconFontGlyphs[a.name]=a.unicode})}},{key:"addIconFont",value:function(r,n){this.iconFontMap.set(r,n)}},{key:"getIconFontKey",value:function(r){return this.iconFontMap.get(r)||r}},{key:"getGlyph",value:function(r){return this.iconFontGlyphs[r]?String.fromCharCode(parseInt(this.iconFontGlyphs[r],16)):""}},{key:"setFontOptions",value:function(r){this.fontOptions=tf(tf({},this.fontOptions),r),this.key=this.getKey();var n=this.getNewChars(this.key,this.fontOptions.characterSet),a=this.cache.get(this.key);if(!(a&&n.length===0)){var s=this.generateFontAtlas(this.key,n,a);this.fontAtlas=s,this.cache.set(this.key,s)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(r,n,a){var s=this.fontOptions,f=s.fontFamily,v=s.fontWeight,m=s.fontSize,x=s.buffer,A=s.sdf,T=s.radius,O=s.cutoff,F=s.iconfont,j=a&&a.data;j||(j=ca.document.createElement("canvas"),j.width=vp);var Y=j.getContext("2d");nf(Y,f,m,v);var ee=ah(tf({getFontWidth:function(Ls){return Y.measureText(Ls).width},fontHeight:m*ed,buffer:x,characterSet:n,maxCanvasWidth:vp},a&&{mapping:a.mapping,xOffset:a.xOffset,yOffset:a.yOffset})),Ae=ee.mapping,Fe=ee.canvasHeight,Xe=ee.xOffset,nt=ee.yOffset,Et=Y.getImageData(0,0,j.width,j.height);if(j.height=Fe,Y.putImageData(Et,0,0),nf(Y,f,m,v),A){var wt=new(Bh())(m,x,T,O,f,v),Wt=Y.getImageData(0,0,wt.size,wt.size),ur=ef(n),Ar;try{for(ur.s();!(Ar=ur.n()).done;){var Jr=Ar.value;if(F){var gr=String.fromCharCode(parseInt(Jr.replace("&#x","").replace(";",""),16)),vn=wt.draw(gr);Uu(vn,Wt)}else Uu(wt.draw(Jr),Wt);Y.putImageData(Wt,Ae[Jr].x,Ae[Jr].y)}}catch(qo){ur.e(qo)}finally{ur.f()}}else{var Pn=ef(n),Kn;try{for(Pn.s();!(Kn=Pn.n()).done;){var Ba=Kn.value;Y.fillText(Ba,Ae[Ba].x,Ae[Ba].y+m*Rd)}}catch(qo){Pn.e(qo)}finally{Pn.f()}}return{xOffset:Xe,yOffset:nt,mapping:Ae,data:j,width:j.width,height:j.height}}},{key:"getKey",value:function(){return"key";var r,n,a,s,f,v,m,x}},{key:"getNewChars",value:function(r,n){var a=this.cache.get(r);if(!a)return n;var s=[],f=a.mapping,v=new Set(Object.keys(f)),m=new Set(n);return m.forEach(function(x){v.has(x)||s.push(x)}),s}}]),e}())||sh),rd,rl;function Df(e){var i=af();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function af(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xc=3,mp=1024,of=64,jh=(rd=(0,Yr.b2)(),rd(rl=function(e){(0,Ir.Z)(r,e);var i=Df(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"canvasHeight",128),(0,S.Z)((0,J.Z)(n),"texture",void 0),(0,S.Z)((0,J.Z)(n),"canvas",void 0),(0,S.Z)((0,J.Z)(n),"iconData",void 0),(0,S.Z)((0,J.Z)(n),"iconMap",void 0),(0,S.Z)((0,J.Z)(n),"ctx",void 0),(0,S.Z)((0,J.Z)(n),"loadingImageCount",0),n}return(0,It.Z)(r,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=ca.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(a,s){var f=this,v=new Image;if(this.loadingImageCount++,this.hasImage(a))throw new Error("Image Id already exists");this.iconData.push({id:a,size:of}),this.updateIconMap(),this.loadImage(s).then(function(m){v=m;var x=f.iconData.find(function(A){return A.id===a});x&&(x.image=v,x.width=v.width,x.height=v.height),f.update()})}},{key:"addImageMini",value:function(a,s,f){var v=this,m=f.getSceneConfig().canvas,x=m.createImage();if(this.loadingImageCount++,this.hasImage(a))throw new Error("Image Id already exists");this.iconData.push({id:a,size:of}),this.updateIconMap(),this.loadImageMini(s,m).then(function(A){x=A;var T=v.iconData.find(function(O){return O.id===a});T&&(T.image=x,T.width=x.width,T.height=x.height),v.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(a){return this.iconMap.hasOwnProperty(a)}},{key:"removeImage",value:function(a){this.hasImage(a)&&(this.iconData=this.iconData.filter(function(s){return s.id!==a}),delete this.iconMap[a],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(a){return new Promise(function(s,f){if(a instanceof HTMLImageElement){s(a);return}var v=new Image;v.crossOrigin="anonymous",v.onload=function(){s(v)},v.onerror=function(){f(new Error("Could not load image at "+a))},v.src=a instanceof File?URL.createObjectURL(a):a})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var a=this;this.canvas.width=mp,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(s){var f=a.iconMap[s],v=f.x,m=f.y,x=f.image,A=f.width,T=A===void 0?64:A,O=f.height,F=O===void 0?64:O,j=Math.max(T,F),Y=j/of,ee=F/Y,Ae=T/Y;x&&a.ctx.drawImage(x,v+(of-Ae)/2,m+(of-ee)/2,Ae,ee)})}},{key:"updateIconMap",value:function(){var a=Nh(this.iconData,xc,mp),s=a.mapping,f=a.canvasHeight;this.iconMap=s,this.canvasHeight=f}},{key:"loadImageMini",value:function(a,s){return new Promise(function(f,v){var m=s.createImage();m.crossOrigin="anonymous",m.onload=function(){f(m)},m.onerror=function(){v(new Error("Could not load image at "+a))},m.src=a})}}]),r}(cs.EventEmitter))||rl),Ia=W(49685);function Ki(){var e=new Ia.WT(16);return Ia.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function bc(e){var i=new Ia.WT(16);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function Po(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function js(e,i,r,n,a,s,f,v,m,x,A,T,O,F,j,Y){var ee=new Ia.WT(16);return ee[0]=e,ee[1]=i,ee[2]=r,ee[3]=n,ee[4]=a,ee[5]=s,ee[6]=f,ee[7]=v,ee[8]=m,ee[9]=x,ee[10]=A,ee[11]=T,ee[12]=O,ee[13]=F,ee[14]=j,ee[15]=Y,ee}function nd(e,i,r,n,a,s,f,v,m,x,A,T,O,F,j,Y,ee){return e[0]=i,e[1]=r,e[2]=n,e[3]=a,e[4]=s,e[5]=f,e[6]=v,e[7]=m,e[8]=x,e[9]=A,e[10]=T,e[11]=O,e[12]=F,e[13]=j,e[14]=Y,e[15]=ee,e}function gp(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ld(e,i){if(e===i){var r=i[1],n=i[2],a=i[3],s=i[6],f=i[7],v=i[11];e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=r,e[6]=i[9],e[7]=i[13],e[8]=n,e[9]=s,e[11]=i[14],e[12]=a,e[13]=f,e[14]=v}else e[0]=i[0],e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=i[1],e[5]=i[5],e[6]=i[9],e[7]=i[13],e[8]=i[2],e[9]=i[6],e[10]=i[10],e[11]=i[14],e[12]=i[3],e[13]=i[7],e[14]=i[11],e[15]=i[15];return e}function Vh(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],f=i[4],v=i[5],m=i[6],x=i[7],A=i[8],T=i[9],O=i[10],F=i[11],j=i[12],Y=i[13],ee=i[14],Ae=i[15],Fe=r*v-n*f,Xe=r*m-a*f,nt=r*x-s*f,Et=n*m-a*v,wt=n*x-s*v,Wt=a*x-s*m,ur=A*Y-T*j,Ar=A*ee-O*j,Jr=A*Ae-F*j,gr=T*ee-O*Y,vn=T*Ae-F*Y,Pn=O*Ae-F*ee,Kn=Fe*Pn-Xe*vn+nt*gr+Et*Jr-wt*Ar+Wt*ur;return Kn?(Kn=1/Kn,e[0]=(v*Pn-m*vn+x*gr)*Kn,e[1]=(a*vn-n*Pn-s*gr)*Kn,e[2]=(Y*Wt-ee*wt+Ae*Et)*Kn,e[3]=(O*wt-T*Wt-F*Et)*Kn,e[4]=(m*Jr-f*Pn-x*Ar)*Kn,e[5]=(r*Pn-a*Jr+s*Ar)*Kn,e[6]=(ee*nt-j*Wt-Ae*Xe)*Kn,e[7]=(A*Wt-O*nt+F*Xe)*Kn,e[8]=(f*vn-v*Jr+x*ur)*Kn,e[9]=(n*Jr-r*vn-s*ur)*Kn,e[10]=(j*wt-Y*nt+Ae*Fe)*Kn,e[11]=(T*nt-A*wt-F*Fe)*Kn,e[12]=(v*Ar-f*gr-m*ur)*Kn,e[13]=(r*gr-n*Ar+a*ur)*Kn,e[14]=(Y*Xe-j*Et-ee*Fe)*Kn,e[15]=(A*Et-T*Xe+O*Fe)*Kn,e):null}function Dd(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],f=i[4],v=i[5],m=i[6],x=i[7],A=i[8],T=i[9],O=i[10],F=i[11],j=i[12],Y=i[13],ee=i[14],Ae=i[15];return e[0]=v*(O*Ae-F*ee)-T*(m*Ae-x*ee)+Y*(m*F-x*O),e[1]=-(n*(O*Ae-F*ee)-T*(a*Ae-s*ee)+Y*(a*F-s*O)),e[2]=n*(m*Ae-x*ee)-v*(a*Ae-s*ee)+Y*(a*x-s*m),e[3]=-(n*(m*F-x*O)-v*(a*F-s*O)+T*(a*x-s*m)),e[4]=-(f*(O*Ae-F*ee)-A*(m*Ae-x*ee)+j*(m*F-x*O)),e[5]=r*(O*Ae-F*ee)-A*(a*Ae-s*ee)+j*(a*F-s*O),e[6]=-(r*(m*Ae-x*ee)-f*(a*Ae-s*ee)+j*(a*x-s*m)),e[7]=r*(m*F-x*O)-f*(a*F-s*O)+A*(a*x-s*m),e[8]=f*(T*Ae-F*Y)-A*(v*Ae-x*Y)+j*(v*F-x*T),e[9]=-(r*(T*Ae-F*Y)-A*(n*Ae-s*Y)+j*(n*F-s*T)),e[10]=r*(v*Ae-x*Y)-f*(n*Ae-s*Y)+j*(n*x-s*v),e[11]=-(r*(v*F-x*T)-f*(n*F-s*T)+A*(n*x-s*v)),e[12]=-(f*(T*ee-O*Y)-A*(v*ee-m*Y)+j*(v*O-m*T)),e[13]=r*(T*ee-O*Y)-A*(n*ee-a*Y)+j*(n*O-a*T),e[14]=-(r*(v*ee-m*Y)-f*(n*ee-a*Y)+j*(n*m-a*v)),e[15]=r*(v*O-m*T)-f*(n*O-a*T)+A*(n*m-a*v),e}function yp(e){var i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],f=e[5],v=e[6],m=e[7],x=e[8],A=e[9],T=e[10],O=e[11],F=e[12],j=e[13],Y=e[14],ee=e[15],Ae=i*f-r*s,Fe=i*v-n*s,Xe=i*m-a*s,nt=r*v-n*f,Et=r*m-a*f,wt=n*m-a*v,Wt=x*j-A*F,ur=x*Y-T*F,Ar=x*ee-O*F,Jr=A*Y-T*j,gr=A*ee-O*j,vn=T*ee-O*Y;return Ae*vn-Fe*gr+Xe*Jr+nt*Ar-Et*ur+wt*Wt}function Al(e,i,r){var n=i[0],a=i[1],s=i[2],f=i[3],v=i[4],m=i[5],x=i[6],A=i[7],T=i[8],O=i[9],F=i[10],j=i[11],Y=i[12],ee=i[13],Ae=i[14],Fe=i[15],Xe=r[0],nt=r[1],Et=r[2],wt=r[3];return e[0]=Xe*n+nt*v+Et*T+wt*Y,e[1]=Xe*a+nt*m+Et*O+wt*ee,e[2]=Xe*s+nt*x+Et*F+wt*Ae,e[3]=Xe*f+nt*A+Et*j+wt*Fe,Xe=r[4],nt=r[5],Et=r[6],wt=r[7],e[4]=Xe*n+nt*v+Et*T+wt*Y,e[5]=Xe*a+nt*m+Et*O+wt*ee,e[6]=Xe*s+nt*x+Et*F+wt*Ae,e[7]=Xe*f+nt*A+Et*j+wt*Fe,Xe=r[8],nt=r[9],Et=r[10],wt=r[11],e[8]=Xe*n+nt*v+Et*T+wt*Y,e[9]=Xe*a+nt*m+Et*O+wt*ee,e[10]=Xe*s+nt*x+Et*F+wt*Ae,e[11]=Xe*f+nt*A+Et*j+wt*Fe,Xe=r[12],nt=r[13],Et=r[14],wt=r[15],e[12]=Xe*n+nt*v+Et*T+wt*Y,e[13]=Xe*a+nt*m+Et*O+wt*ee,e[14]=Xe*s+nt*x+Et*F+wt*Ae,e[15]=Xe*f+nt*A+Et*j+wt*Fe,e}function ch(e,i,r){var n=r[0],a=r[1],s=r[2],f,v,m,x,A,T,O,F,j,Y,ee,Ae;return i===e?(e[12]=i[0]*n+i[4]*a+i[8]*s+i[12],e[13]=i[1]*n+i[5]*a+i[9]*s+i[13],e[14]=i[2]*n+i[6]*a+i[10]*s+i[14],e[15]=i[3]*n+i[7]*a+i[11]*s+i[15]):(f=i[0],v=i[1],m=i[2],x=i[3],A=i[4],T=i[5],O=i[6],F=i[7],j=i[8],Y=i[9],ee=i[10],Ae=i[11],e[0]=f,e[1]=v,e[2]=m,e[3]=x,e[4]=A,e[5]=T,e[6]=O,e[7]=F,e[8]=j,e[9]=Y,e[10]=ee,e[11]=Ae,e[12]=f*n+A*a+j*s+i[12],e[13]=v*n+T*a+Y*s+i[13],e[14]=m*n+O*a+ee*s+i[14],e[15]=x*n+F*a+Ae*s+i[15]),e}function Kl(e,i,r){var n=r[0],a=r[1],s=r[2];return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=i[3]*n,e[4]=i[4]*a,e[5]=i[5]*a,e[6]=i[6]*a,e[7]=i[7]*a,e[8]=i[8]*s,e[9]=i[9]*s,e[10]=i[10]*s,e[11]=i[11]*s,e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function id(e,i,r,n){var a=n[0],s=n[1],f=n[2],v=Math.hypot(a,s,f),m,x,A,T,O,F,j,Y,ee,Ae,Fe,Xe,nt,Et,wt,Wt,ur,Ar,Jr,gr,vn,Pn,Kn,Ba;return v<Ia.Ib?null:(v=1/v,a*=v,s*=v,f*=v,m=Math.sin(r),x=Math.cos(r),A=1-x,T=i[0],O=i[1],F=i[2],j=i[3],Y=i[4],ee=i[5],Ae=i[6],Fe=i[7],Xe=i[8],nt=i[9],Et=i[10],wt=i[11],Wt=a*a*A+x,ur=s*a*A+f*m,Ar=f*a*A-s*m,Jr=a*s*A-f*m,gr=s*s*A+x,vn=f*s*A+a*m,Pn=a*f*A+s*m,Kn=s*f*A-a*m,Ba=f*f*A+x,e[0]=T*Wt+Y*ur+Xe*Ar,e[1]=O*Wt+ee*ur+nt*Ar,e[2]=F*Wt+Ae*ur+Et*Ar,e[3]=j*Wt+Fe*ur+wt*Ar,e[4]=T*Jr+Y*gr+Xe*vn,e[5]=O*Jr+ee*gr+nt*vn,e[6]=F*Jr+Ae*gr+Et*vn,e[7]=j*Jr+Fe*gr+wt*vn,e[8]=T*Pn+Y*Kn+Xe*Ba,e[9]=O*Pn+ee*Kn+nt*Ba,e[10]=F*Pn+Ae*Kn+Et*Ba,e[11]=j*Pn+Fe*Kn+wt*Ba,i!==e&&(e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e)}function fh(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[4],f=i[5],v=i[6],m=i[7],x=i[8],A=i[9],T=i[10],O=i[11];return i!==e&&(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[4]=s*a+x*n,e[5]=f*a+A*n,e[6]=v*a+T*n,e[7]=m*a+O*n,e[8]=x*a-s*n,e[9]=A*a-f*n,e[10]=T*a-v*n,e[11]=O*a-m*n,e}function sf(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[0],f=i[1],v=i[2],m=i[3],x=i[8],A=i[9],T=i[10],O=i[11];return i!==e&&(e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=s*a-x*n,e[1]=f*a-A*n,e[2]=v*a-T*n,e[3]=m*a-O*n,e[8]=s*n+x*a,e[9]=f*n+A*a,e[10]=v*n+T*a,e[11]=m*n+O*a,e}function ba(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[0],f=i[1],v=i[2],m=i[3],x=i[4],A=i[5],T=i[6],O=i[7];return i!==e&&(e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=s*a+x*n,e[1]=f*a+A*n,e[2]=v*a+T*n,e[3]=m*a+O*n,e[4]=x*a-s*n,e[5]=A*a-f*n,e[6]=T*a-v*n,e[7]=O*a-m*n,e}function Gh(e,i){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function $l(e,i){return e[0]=i[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=i[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ff(e,i,r){var n=r[0],a=r[1],s=r[2],f=Math.hypot(n,a,s),v,m,x;return f<Ia.Ib?null:(f=1/f,n*=f,a*=f,s*=f,v=Math.sin(i),m=Math.cos(i),x=1-m,e[0]=n*n*x+m,e[1]=a*n*x+s*v,e[2]=s*n*x-a*v,e[3]=0,e[4]=n*a*x-s*v,e[5]=a*a*x+m,e[6]=s*a*x+n*v,e[7]=0,e[8]=n*s*x+a*v,e[9]=a*s*x-n*v,e[10]=s*s*x+m,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function _p(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Fd(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function N(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ve(e,i,r){var n=i[0],a=i[1],s=i[2],f=i[3],v=n+n,m=a+a,x=s+s,A=n*v,T=n*m,O=n*x,F=a*m,j=a*x,Y=s*x,ee=f*v,Ae=f*m,Fe=f*x;return e[0]=1-(F+Y),e[1]=T+Fe,e[2]=O-Ae,e[3]=0,e[4]=T-Fe,e[5]=1-(A+Y),e[6]=j+ee,e[7]=0,e[8]=O+Ae,e[9]=j-ee,e[10]=1-(A+F),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Ne(e,i){var r=new Ia.WT(3),n=-i[0],a=-i[1],s=-i[2],f=i[3],v=i[4],m=i[5],x=i[6],A=i[7],T=n*n+a*a+s*s+f*f;return T>0?(r[0]=(v*f+A*n+m*s-x*a)*2/T,r[1]=(m*f+A*a+x*n-v*s)*2/T,r[2]=(x*f+A*s+v*a-m*n)*2/T):(r[0]=(v*f+A*n+m*s-x*a)*2,r[1]=(m*f+A*a+x*n-v*s)*2,r[2]=(x*f+A*s+v*a-m*n)*2),ve(e,i,r),e}function Dt(e,i){return e[0]=i[12],e[1]=i[13],e[2]=i[14],e}function ar(e,i){var r=i[0],n=i[1],a=i[2],s=i[4],f=i[5],v=i[6],m=i[8],x=i[9],A=i[10];return e[0]=Math.hypot(r,n,a),e[1]=Math.hypot(s,f,v),e[2]=Math.hypot(m,x,A),e}function kt(e,i){var r=new Ia.WT(3);ar(r,i);var n=1/r[0],a=1/r[1],s=1/r[2],f=i[0]*n,v=i[1]*a,m=i[2]*s,x=i[4]*n,A=i[5]*a,T=i[6]*s,O=i[8]*n,F=i[9]*a,j=i[10]*s,Y=f+A+j,ee=0;return Y>0?(ee=Math.sqrt(Y+1)*2,e[3]=.25*ee,e[0]=(T-F)/ee,e[1]=(O-m)/ee,e[2]=(v-x)/ee):f>A&&f>j?(ee=Math.sqrt(1+f-A-j)*2,e[3]=(T-F)/ee,e[0]=.25*ee,e[1]=(v+x)/ee,e[2]=(O+m)/ee):A>j?(ee=Math.sqrt(1+A-f-j)*2,e[3]=(O-m)/ee,e[0]=(v+x)/ee,e[1]=.25*ee,e[2]=(T+F)/ee):(ee=Math.sqrt(1+j-f-A)*2,e[3]=(v-x)/ee,e[0]=(O+m)/ee,e[1]=(T+F)/ee,e[2]=.25*ee),e}function qt(e,i,r,n){var a=i[0],s=i[1],f=i[2],v=i[3],m=a+a,x=s+s,A=f+f,T=a*m,O=a*x,F=a*A,j=s*x,Y=s*A,ee=f*A,Ae=v*m,Fe=v*x,Xe=v*A,nt=n[0],Et=n[1],wt=n[2];return e[0]=(1-(j+ee))*nt,e[1]=(O+Xe)*nt,e[2]=(F-Fe)*nt,e[3]=0,e[4]=(O-Xe)*Et,e[5]=(1-(T+ee))*Et,e[6]=(Y+Ae)*Et,e[7]=0,e[8]=(F+Fe)*wt,e[9]=(Y-Ae)*wt,e[10]=(1-(T+j))*wt,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function fr(e,i,r,n,a){var s=i[0],f=i[1],v=i[2],m=i[3],x=s+s,A=f+f,T=v+v,O=s*x,F=s*A,j=s*T,Y=f*A,ee=f*T,Ae=v*T,Fe=m*x,Xe=m*A,nt=m*T,Et=n[0],wt=n[1],Wt=n[2],ur=a[0],Ar=a[1],Jr=a[2],gr=(1-(Y+Ae))*Et,vn=(F+nt)*Et,Pn=(j-Xe)*Et,Kn=(F-nt)*wt,Ba=(1-(O+Ae))*wt,qo=(ee+Fe)*wt,Ls=(j+Xe)*Wt,Ds=(ee-Fe)*Wt,Ys=(1-(O+Y))*Wt;return e[0]=gr,e[1]=vn,e[2]=Pn,e[3]=0,e[4]=Kn,e[5]=Ba,e[6]=qo,e[7]=0,e[8]=Ls,e[9]=Ds,e[10]=Ys,e[11]=0,e[12]=r[0]+ur-(gr*ur+Kn*Ar+Ls*Jr),e[13]=r[1]+Ar-(vn*ur+Ba*Ar+Ds*Jr),e[14]=r[2]+Jr-(Pn*ur+qo*Ar+Ys*Jr),e[15]=1,e}function mr(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],f=r+r,v=n+n,m=a+a,x=r*f,A=n*f,T=n*v,O=a*f,F=a*v,j=a*m,Y=s*f,ee=s*v,Ae=s*m;return e[0]=1-T-j,e[1]=A+Ae,e[2]=O-ee,e[3]=0,e[4]=A-Ae,e[5]=1-x-j,e[6]=F+Y,e[7]=0,e[8]=O+ee,e[9]=F-Y,e[10]=1-x-T,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function xr(e,i,r,n,a,s,f){var v=1/(r-i),m=1/(a-n),x=1/(s-f);return e[0]=s*2*v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s*2*m,e[6]=0,e[7]=0,e[8]=(r+i)*v,e[9]=(a+n)*m,e[10]=(f+s)*x,e[11]=-1,e[12]=0,e[13]=0,e[14]=f*s*2*x,e[15]=0,e}function Tr(e,i,r,n,a){var s=1/Math.tan(i/2),f;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==Infinity?(f=1/(n-a),e[10]=(a+n)*f,e[14]=2*a*n*f):(e[10]=-1,e[14]=-2*n),e}var Mr=Tr;function Gr(e,i,r,n,a){var s=1/Math.tan(i/2),f;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==Infinity?(f=1/(n-a),e[10]=a*f,e[14]=a*n*f):(e[10]=-1,e[14]=-n),e}function yr(e,i,r,n){var a=Math.tan(i.upDegrees*Math.PI/180),s=Math.tan(i.downDegrees*Math.PI/180),f=Math.tan(i.leftDegrees*Math.PI/180),v=Math.tan(i.rightDegrees*Math.PI/180),m=2/(f+v),x=2/(a+s);return e[0]=m,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=x,e[6]=0,e[7]=0,e[8]=-((f-v)*m*.5),e[9]=(a-s)*x*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function Cr(e,i,r,n,a,s,f){var v=1/(i-r),m=1/(n-a),x=1/(s-f);return e[0]=-2*v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*m,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*x,e[11]=0,e[12]=(i+r)*v,e[13]=(a+n)*m,e[14]=(f+s)*x,e[15]=1,e}var ot=Cr;function jt(e,i,r,n,a,s,f){var v=1/(i-r),m=1/(n-a),x=1/(s-f);return e[0]=-2*v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*m,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=x,e[11]=0,e[12]=(i+r)*v,e[13]=(a+n)*m,e[14]=s*x,e[15]=1,e}function br(e,i,r,n){var a,s,f,v,m,x,A,T,O,F,j=i[0],Y=i[1],ee=i[2],Ae=n[0],Fe=n[1],Xe=n[2],nt=r[0],Et=r[1],wt=r[2];return Math.abs(j-nt)<Ia.Ib&&Math.abs(Y-Et)<Ia.Ib&&Math.abs(ee-wt)<Ia.Ib?gp(e):(A=j-nt,T=Y-Et,O=ee-wt,F=1/Math.hypot(A,T,O),A*=F,T*=F,O*=F,a=Fe*O-Xe*T,s=Xe*A-Ae*O,f=Ae*T-Fe*A,F=Math.hypot(a,s,f),F?(F=1/F,a*=F,s*=F,f*=F):(a=0,s=0,f=0),v=T*f-O*s,m=O*a-A*f,x=A*s-T*a,F=Math.hypot(v,m,x),F?(F=1/F,v*=F,m*=F,x*=F):(v=0,m=0,x=0),e[0]=a,e[1]=v,e[2]=A,e[3]=0,e[4]=s,e[5]=m,e[6]=T,e[7]=0,e[8]=f,e[9]=x,e[10]=O,e[11]=0,e[12]=-(a*j+s*Y+f*ee),e[13]=-(v*j+m*Y+x*ee),e[14]=-(A*j+T*Y+O*ee),e[15]=1,e)}function Zr(e,i,r,n){var a=i[0],s=i[1],f=i[2],v=n[0],m=n[1],x=n[2],A=a-r[0],T=s-r[1],O=f-r[2],F=A*A+T*T+O*O;F>0&&(F=1/Math.sqrt(F),A*=F,T*=F,O*=F);var j=m*O-x*T,Y=x*A-v*O,ee=v*T-m*A;return F=j*j+Y*Y+ee*ee,F>0&&(F=1/Math.sqrt(F),j*=F,Y*=F,ee*=F),e[0]=j,e[1]=Y,e[2]=ee,e[3]=0,e[4]=T*ee-O*Y,e[5]=O*j-A*ee,e[6]=A*Y-T*j,e[7]=0,e[8]=A,e[9]=T,e[10]=O,e[11]=0,e[12]=a,e[13]=s,e[14]=f,e[15]=1,e}function cr(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Rr(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Qr(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e[4]=i[4]+r[4],e[5]=i[5]+r[5],e[6]=i[6]+r[6],e[7]=i[7]+r[7],e[8]=i[8]+r[8],e[9]=i[9]+r[9],e[10]=i[10]+r[10],e[11]=i[11]+r[11],e[12]=i[12]+r[12],e[13]=i[13]+r[13],e[14]=i[14]+r[14],e[15]=i[15]+r[15],e}function Un(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e[4]=i[4]-r[4],e[5]=i[5]-r[5],e[6]=i[6]-r[6],e[7]=i[7]-r[7],e[8]=i[8]-r[8],e[9]=i[9]-r[9],e[10]=i[10]-r[10],e[11]=i[11]-r[11],e[12]=i[12]-r[12],e[13]=i[13]-r[13],e[14]=i[14]-r[14],e[15]=i[15]-r[15],e}function Kt(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=i[7]*r,e[8]=i[8]*r,e[9]=i[9]*r,e[10]=i[10]*r,e[11]=i[11]*r,e[12]=i[12]*r,e[13]=i[13]*r,e[14]=i[14]*r,e[15]=i[15]*r,e}function ir(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e[4]=i[4]+r[4]*n,e[5]=i[5]+r[5]*n,e[6]=i[6]+r[6]*n,e[7]=i[7]+r[7]*n,e[8]=i[8]+r[8]*n,e[9]=i[9]+r[9]*n,e[10]=i[10]+r[10]*n,e[11]=i[11]+r[11]*n,e[12]=i[12]+r[12]*n,e[13]=i[13]+r[13]*n,e[14]=i[14]+r[14]*n,e[15]=i[15]+r[15]*n,e}function En(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]&&e[4]===i[4]&&e[5]===i[5]&&e[6]===i[6]&&e[7]===i[7]&&e[8]===i[8]&&e[9]===i[9]&&e[10]===i[10]&&e[11]===i[11]&&e[12]===i[12]&&e[13]===i[13]&&e[14]===i[14]&&e[15]===i[15]}function Hr(e,i){var r=e[0],n=e[1],a=e[2],s=e[3],f=e[4],v=e[5],m=e[6],x=e[7],A=e[8],T=e[9],O=e[10],F=e[11],j=e[12],Y=e[13],ee=e[14],Ae=e[15],Fe=i[0],Xe=i[1],nt=i[2],Et=i[3],wt=i[4],Wt=i[5],ur=i[6],Ar=i[7],Jr=i[8],gr=i[9],vn=i[10],Pn=i[11],Kn=i[12],Ba=i[13],qo=i[14],Ls=i[15];return Math.abs(r-Fe)<=Ia.Ib*Math.max(1,Math.abs(r),Math.abs(Fe))&&Math.abs(n-Xe)<=Ia.Ib*Math.max(1,Math.abs(n),Math.abs(Xe))&&Math.abs(a-nt)<=Ia.Ib*Math.max(1,Math.abs(a),Math.abs(nt))&&Math.abs(s-Et)<=Ia.Ib*Math.max(1,Math.abs(s),Math.abs(Et))&&Math.abs(f-wt)<=Ia.Ib*Math.max(1,Math.abs(f),Math.abs(wt))&&Math.abs(v-Wt)<=Ia.Ib*Math.max(1,Math.abs(v),Math.abs(Wt))&&Math.abs(m-ur)<=Ia.Ib*Math.max(1,Math.abs(m),Math.abs(ur))&&Math.abs(x-Ar)<=Ia.Ib*Math.max(1,Math.abs(x),Math.abs(Ar))&&Math.abs(A-Jr)<=Ia.Ib*Math.max(1,Math.abs(A),Math.abs(Jr))&&Math.abs(T-gr)<=Ia.Ib*Math.max(1,Math.abs(T),Math.abs(gr))&&Math.abs(O-vn)<=Ia.Ib*Math.max(1,Math.abs(O),Math.abs(vn))&&Math.abs(F-Pn)<=Ia.Ib*Math.max(1,Math.abs(F),Math.abs(Pn))&&Math.abs(j-Kn)<=Ia.Ib*Math.max(1,Math.abs(j),Math.abs(Kn))&&Math.abs(Y-Ba)<=Ia.Ib*Math.max(1,Math.abs(Y),Math.abs(Ba))&&Math.abs(ee-qo)<=Ia.Ib*Math.max(1,Math.abs(ee),Math.abs(qo))&&Math.abs(Ae-Ls)<=Ia.Ib*Math.max(1,Math.abs(Ae),Math.abs(Ls))}var Sr=Al,qr=Un,Kr,gi,si=(Kr=(0,Yr.b2)(),Kr(gi=function(){function e(){(0,dt.Z)(this,e),(0,S.Z)(this,"viewport",void 0),(0,S.Z)(this,"overridedViewProjectionMatrix",void 0),(0,S.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,S.Z)(this,"jitteredProjectionMatrix",void 0),(0,S.Z)(this,"viewMatrixInverse",void 0),(0,S.Z)(this,"cameraPosition",void 0)}return(0,It.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(r){this.viewport=r,this.viewMatrixInverse=Ki(),Vh(this.viewMatrixInverse,r.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var r=this.viewport.getCenter(),n=(0,mn.Z)(r,2),a=n[0],s=n[1];return[a,s]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}},{key:"setViewProjectionMatrix",value:function(r){this.overridedViewProjectionMatrix=r}},{key:"jitterProjectionMatrix",value:function(r,n){var a=Gh(Ki(),[r,n,0]);this.jitteredProjectionMatrix=Al(Ki(),a,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=Al(Ki(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||gi),Wr,nn;function Jn(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=fi(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function fi(e,i){if(!!e){if(typeof e=="string")return Zi(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Zi(e,i)}}function Zi(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var oo=(Wr=(0,Yr.b2)(),Wr(nn=function(){function e(){(0,dt.Z)(this,e),(0,S.Z)(this,"container",void 0),(0,S.Z)(this,"controlCorners",void 0),(0,S.Z)(this,"controlContainer",void 0),(0,S.Z)(this,"scene",void 0),(0,S.Z)(this,"mapsService",void 0),(0,S.Z)(this,"controls",[]),(0,S.Z)(this,"unAddControls",[])}return(0,It.Z)(e,[{key:"init",value:function(r,n){this.container=r.container,this.scene=n,this.mapsService=n.get(xt.IMapService),this.initControlPos()}},{key:"addControl",value:function(r,n){var a=n.get(xt.IMapService);a.map?(r.addTo(this.scene),this.controls.push(r)):this.unAddControls.push(r)}},{key:"getControlByName",value:function(r){return this.controls.find(function(n){return n.controlOption.name===r})}},{key:"removeControl",value:function(r){var n=this.controls.indexOf(r);return n>-1&&this.controls.splice(n,1),r.remove(),this}},{key:"addControls",value:function(){var r=this;this.unAddControls.forEach(function(n){n.addTo(r.scene),r.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var r=Jn(this.controls),n;try{for(r.s();!(n=r.n()).done;){var a=n.value;a.remove()}}catch(s){r.e(s)}finally{r.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var r=this.controlCorners={},n="l7-",a=this.controlContainer=Ua("div",n+"control-container",this.container);function s(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],v=f.map(function(m){return n+m}).join(" ");r[f.join("")]=Ua("div",v,a)}s(["top","left"]),s(["top","right"]),s(["bottom","left"]),s(["bottom","right"]),s(["top","center"]),s(["right","center"]),s(["left","center"]),s(["bottom","center"])}},{key:"clearControlPos",value:function(){for(var r in this.controlCorners)this.controlCorners[r]&&fc(this.controlCorners[r]);this.controlContainer&&fc(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),e}())||nn),so,Ni,ts=(so=(0,Yr.b2)(),so(Ni=function(){function e(){(0,dt.Z)(this,e),(0,S.Z)(this,"container",void 0),(0,S.Z)(this,"scene",void 0),(0,S.Z)(this,"mapsService",void 0),(0,S.Z)(this,"markers",[]),(0,S.Z)(this,"markerLayers",[]),(0,S.Z)(this,"unAddMarkers",[]),(0,S.Z)(this,"unAddMarkerLayers",[])}return(0,It.Z)(e,[{key:"addMarkerLayer",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(r),r.addTo(this.scene)):this.unAddMarkerLayers.push(r)}},{key:"removeMarkerLayer",value:function(r){r.destroy(),this.markerLayers.indexOf(r);var n=this.markerLayers.indexOf(r);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(r),r.addTo(this.scene)):this.unAddMarkers.push(r)}},{key:"addMarkers",value:function(){var r=this;this.unAddMarkers.forEach(function(n){n.addTo(r.scene),r.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var r=this;this.unAddMarkerLayers.forEach(function(n){r.markerLayers.push(n),n.addTo(r.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(r){r.remove(),this.markers.indexOf(r);var n=this.markers.indexOf(r);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(xt.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(r){r.remove()}),this.markers=[],this.markerLayers.forEach(function(r){r.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(r){r.destroy()}}]),e}())||Ni),ja,No,So=(ja=(0,Yr.b2)(),ja(No=function(){function e(){(0,dt.Z)(this,e),(0,S.Z)(this,"scene",void 0),(0,S.Z)(this,"popup",void 0),(0,S.Z)(this,"mapsService",void 0),(0,S.Z)(this,"unAddPopup",void 0)}return(0,It.Z)(e,[{key:"removePopup",value:function(r){r.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(r){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(r.addTo(this.scene),this.popup=r):this.unAddPopup=r}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(xt.IMapService)}}]),e}())||No),Wo=W(82492),Io=W.n(Wo),fs={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},ho=fs,yi,Oo;function ea(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function zo(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ea(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ea(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var ri={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},Ui={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},va=(yi=(0,Yr.b2)(),yi(Oo=function(){function e(){(0,dt.Z)(this,e),(0,S.Z)(this,"sceneConfigCache",{}),(0,S.Z)(this,"layerConfigCache",{})}return(0,It.Z)(e,[{key:"getSceneConfig",value:function(r){return this.sceneConfigCache[r]}},{key:"getSceneWarninfo",value:function(r){return ho[r]}},{key:"setSceneConfig",value:function(r,n){this.sceneConfigCache[r]=zo(zo({},ri),n)}},{key:"getLayerConfig",value:function(r){return this.layerConfigCache[r]}},{key:"setLayerConfig",value:function(r,n,a){this.layerConfigCache[n]=zo({},Io()({},this.sceneConfigCache[r],Ui,a))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||Oo);function Nn(e,i,r,n){!r||Object.defineProperty(e,i,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}function ni(e,i,r,n,a){var s={};return Object.keys(n).forEach(function(f){s[f]=n[f]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=r.slice().reverse().reduce(function(f,v){return v(e,i,f)||f},s),a&&s.initializer!==void 0&&(s.value=s.initializer?s.initializer.call(a):void 0,s.initializer=void 0),s.initializer===void 0&&(Object.defineProperty(e,i,s),s=null),s}function Me(){var e=new Ia.WT(4);return Ia.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Nt(e){var i=new glMatrix.ARRAY_TYPE(4);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i}function At(e,i,r,n){var a=new Ia.WT(4);return a[0]=e,a[1]=i,a[2]=r,a[3]=n,a}function yn(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e}function Wi(e,i,r,n,a){return e[0]=i,e[1]=r,e[2]=n,e[3]=a,e}function we(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e}function oe(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e}function Ve(e,i,r){return e[0]=i[0]*r[0],e[1]=i[1]*r[1],e[2]=i[2]*r[2],e[3]=i[3]*r[3],e}function ct(e,i,r){return e[0]=i[0]/r[0],e[1]=i[1]/r[1],e[2]=i[2]/r[2],e[3]=i[3]/r[3],e}function Ot(e,i){return e[0]=Math.ceil(i[0]),e[1]=Math.ceil(i[1]),e[2]=Math.ceil(i[2]),e[3]=Math.ceil(i[3]),e}function qe(e,i){return e[0]=Math.floor(i[0]),e[1]=Math.floor(i[1]),e[2]=Math.floor(i[2]),e[3]=Math.floor(i[3]),e}function De(e,i,r){return e[0]=Math.min(i[0],r[0]),e[1]=Math.min(i[1],r[1]),e[2]=Math.min(i[2],r[2]),e[3]=Math.min(i[3],r[3]),e}function rt(e,i,r){return e[0]=Math.max(i[0],r[0]),e[1]=Math.max(i[1],r[1]),e[2]=Math.max(i[2],r[2]),e[3]=Math.max(i[3],r[3]),e}function xe(e,i){return e[0]=Math.round(i[0]),e[1]=Math.round(i[1]),e[2]=Math.round(i[2]),e[3]=Math.round(i[3]),e}function Ue(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e}function Te(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e}function ft(e,i){var r=i[0]-e[0],n=i[1]-e[1],a=i[2]-e[2],s=i[3]-e[3];return Math.hypot(r,n,a,s)}function Tt(e,i){var r=i[0]-e[0],n=i[1]-e[1],a=i[2]-e[2],s=i[3]-e[3];return r*r+n*n+a*a+s*s}function hr(e){var i=e[0],r=e[1],n=e[2],a=e[3];return Math.hypot(i,r,n,a)}function Ur(e){var i=e[0],r=e[1],n=e[2],a=e[3];return i*i+r*r+n*n+a*a}function jr(e,i){return e[0]=-i[0],e[1]=-i[1],e[2]=-i[2],e[3]=-i[3],e}function on(e,i){return e[0]=1/i[0],e[1]=1/i[1],e[2]=1/i[2],e[3]=1/i[3],e}function Fr(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],f=r*r+n*n+a*a+s*s;return f>0&&(f=1/Math.sqrt(f)),e[0]=r*f,e[1]=n*f,e[2]=a*f,e[3]=s*f,e}function Tn(e,i){return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]+e[3]*i[3]}function cn(e,i,r,n){var a=r[0]*n[1]-r[1]*n[0],s=r[0]*n[2]-r[2]*n[0],f=r[0]*n[3]-r[3]*n[0],v=r[1]*n[2]-r[2]*n[1],m=r[1]*n[3]-r[3]*n[1],x=r[2]*n[3]-r[3]*n[2],A=i[0],T=i[1],O=i[2],F=i[3];return e[0]=T*x-O*m+F*v,e[1]=-(A*x)+O*f-F*s,e[2]=A*m-T*f+F*a,e[3]=-(A*v)+T*s-O*a,e}function Cn(e,i,r,n){var a=i[0],s=i[1],f=i[2],v=i[3];return e[0]=a+n*(r[0]-a),e[1]=s+n*(r[1]-s),e[2]=f+n*(r[2]-f),e[3]=v+n*(r[3]-v),e}function Sn(e,i){i=i||1;var r,n,a,s,f,v;do r=glMatrix.RANDOM()*2-1,n=glMatrix.RANDOM()*2-1,f=r*r+n*n;while(f>=1);do a=glMatrix.RANDOM()*2-1,s=glMatrix.RANDOM()*2-1,v=a*a+s*s;while(v>=1);var m=Math.sqrt((1-f)/v);return e[0]=i*r,e[1]=i*n,e[2]=i*a*m,e[3]=i*s*m,e}function fn(e,i,r){var n=i[0],a=i[1],s=i[2],f=i[3];return e[0]=r[0]*n+r[4]*a+r[8]*s+r[12]*f,e[1]=r[1]*n+r[5]*a+r[9]*s+r[13]*f,e[2]=r[2]*n+r[6]*a+r[10]*s+r[14]*f,e[3]=r[3]*n+r[7]*a+r[11]*s+r[15]*f,e}function ei(e,i,r){var n=i[0],a=i[1],s=i[2],f=r[0],v=r[1],m=r[2],x=r[3],A=x*n+v*s-m*a,T=x*a+m*n-f*s,O=x*s+f*a-v*n,F=-f*n-v*a-m*s;return e[0]=A*x+F*-f+T*-m-O*-v,e[1]=T*x+F*-v+O*-f-A*-m,e[2]=O*x+F*-m+A*-v-T*-f,e[3]=i[3],e}function Ea(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function hs(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Va(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]}function ya(e,i){var r=e[0],n=e[1],a=e[2],s=e[3],f=i[0],v=i[1],m=i[2],x=i[3];return Math.abs(r-f)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(n-v)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(a-m)<=glMatrix.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(s-x)<=glMatrix.EPSILON*Math.max(1,Math.abs(s),Math.abs(x))}var Ql=null,Vs=null,wl=null,ju=null,ad=null,Vu=null,uf=null,Hh=function(){var e=Me();return function(i,r,n,a,s,f){var v,m;for(r||(r=4),n||(n=0),a?m=Math.min(a*r+n,i.length):m=i.length,v=n;v<m;v+=r)e[0]=i[v],e[1]=i[v+1],e[2]=i[v+2],e[3]=i[v+3],s(e,e,f),i[v]=e[0],i[v+1]=e[1],i[v+2]=e[2],i[v+3]=e[3];return i}}(),od=Math.PI/180,Xo=512,Wh=4003e4;function Ec(e){var i=e.latitude,r=i===void 0?0:i,n=e.zoom,a=n===void 0?0:n,s=e.scale,f=e.highPrecision,v=f===void 0?!1:f,m=e.flipY,x=m===void 0?!1:m;s=s!==void 0?s:Math.pow(2,a);var A={},T=Xo*s,O=Math.cos(r*od),F=T/360,j=F/O,Y=T/Wh/O;if(A.pixelsPerMeter=[Y,-Y,Y],A.metersPerPixel=[1/Y,-1/Y,1/Y],A.pixelsPerDegree=[F,-j,Y],A.degreesPerPixel=[1/F,-1/j,1/Y],v){var ee=od*Math.tan(r*od)/O,Ae=F*ee/2,Fe=T/Wh*ee,Xe=Fe/j*Y;A.pixelsPerDegree2=[0,-Ae,Fe],A.pixelsPerMeter2=[Xe,0,Xe],x&&(A.pixelsPerDegree2[1]=-A.pixelsPerDegree2[1],A.pixelsPerMeter2[1]=-A.pixelsPerMeter2[1])}return x&&(A.pixelsPerMeter[1]=-A.pixelsPerMeter[1],A.metersPerPixel[1]=-A.metersPerPixel[1],A.pixelsPerDegree[1]=-A.pixelsPerDegree[1],A.degreesPerPixel[1]=-A.degreesPerPixel[1]),A}var Jl;(function(e){e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2"})(Jl||(Jl={}));var Sc={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},sd,hh,Cc,ud,Bd,S0=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],ps=(sd=(0,Yr.b2)(),hh=(0,Yr.f3)(xt.ICameraService),sd(Cc=(ud=function(){function e(){(0,dt.Z)(this,e),(0,S.Z)(this,"needRefresh",!0),Nn(this,"cameraService",Bd,this),(0,S.Z)(this,"coordinateSystem",void 0),(0,S.Z)(this,"viewportCenter",void 0),(0,S.Z)(this,"viewportCenterProjection",void 0),(0,S.Z)(this,"pixelsPerDegree",void 0),(0,S.Z)(this,"pixelsPerDegree2",void 0),(0,S.Z)(this,"pixelsPerMeter",void 0)}return(0,It.Z)(e,[{key:"refresh",value:function(){var r=this.cameraService.getZoom(),n=this.cameraService.getZoomScale(),a=this.cameraService.getCenter(),s=Ec({latitude:a[1],zoom:r}),f=s.pixelsPerMeter,v=s.pixelsPerDegree;this.viewportCenter=a,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=f,this.pixelsPerDegree=v,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Jl.LNGLAT||this.coordinateSystem===Jl.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Jl.LNGLAT_OFFSET?this.calculateLnglatOffset(a,r):this.coordinateSystem===Jl.P20_OFFSET&&this.calculateLnglatOffset(a,r,n,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(r){this.coordinateSystem=r}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(r,n,a,s){var f=Ec({latitude:r[1],zoom:n,scale:a,flipY:s,highPrecision:!0}),v=f.pixelsPerMeter,m=f.pixelsPerDegree,x=f.pixelsPerDegree2,A=this.cameraService.getViewMatrix(),T=this.cameraService.getProjectionMatrix(),O=Al([],T,A),F=this.cameraService.projectFlat([Math.fround(r[0]),Math.fround(r[1])],Math.pow(2,n));this.viewportCenterProjection=fn([],[F[0],F[1],0,1],O),A=this.cameraService.getViewMatrixUncentered()||A,O=Al([],T,A),O=Al([],O,S0),this.cameraService.setViewProjectionMatrix(O),this.pixelsPerMeter=v,this.pixelsPerDegree=m,this.pixelsPerDegree2=x}}]),e}(),Bd=ni(ud.prototype,"cameraService",[hh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ud))||Cc),Bf=W(20396),Xh=W.n(Bf),t;(function(e){e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag"})(t||(t={}));var o,u,p,y,b;function C(e){var i=I();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function I(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var D={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},z=(o=(0,Yr.b2)(),u=(0,Yr.f3)(xt.IMapService),o(p=(y=function(e){(0,Ir.Z)(r,e);var i=C(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"indragging",!1),Nn((0,J.Z)(n),"mapService",b,(0,J.Z)(n)),(0,S.Z)((0,J.Z)(n),"hammertime",void 0),(0,S.Z)((0,J.Z)(n),"lastClickTime",0),(0,S.Z)((0,J.Z)(n),"lastClickXY",[-1,-1]),(0,S.Z)((0,J.Z)(n),"clickTimer",void 0),(0,S.Z)((0,J.Z)(n),"$containter",void 0),(0,S.Z)((0,J.Z)(n),"onDrag",function(v){var m=n.interactionEvent(v);m.type=D[m.type],m.type==="dragging"?n.indragging=!0:n.indragging=!1,n.emit(t.Drag,m)}),(0,S.Z)((0,J.Z)(n),"onHammer",function(v){v.srcEvent.stopPropagation();var m=n.interactionEvent(v);n.emit(t.Hover,m)}),(0,S.Z)((0,J.Z)(n),"onTouch",function(v){var m=v.touches[0];n.onHover({x:m.pageX,y:m.pageY,type:"touch"})}),(0,S.Z)((0,J.Z)(n),"onHover",function(v){var m=v.clientX,x=v.clientY,A=m,T=x,O=v.type,F=n.mapService.getMapContainer();if(F)if(Ji)A=A-F.left-0,T=T-F.top-0;else{var j=F.getBoundingClientRect(),Y=j.top,ee=j.left;A=A-ee-F.clientLeft,T=T-Y-F.clientTop}var Ae=n.mapService.containerToLngLat([A,T]);if(O==="click"){if(!Ji&&"ontouchstart"in document.documentElement)return;n.isDoubleTap(A,T,Ae);return}if(O==="touch"){n.isDoubleTap(A,T,Ae);return}O!=="click"&&O!=="dblclick"&&n.emit(t.Hover,{x:A,y:T,lngLat:Ae,type:O,target:v})}),n}return(0,It.Z)(r,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(t.Hover)}},{key:"triggerHover",value:function(a){var s=a.x,f=a.y;this.emit(t.Hover,{x:s,y:f})}},{key:"triggerSelect",value:function(a){this.emit(t.Select,{featureId:a})}},{key:"triggerActive",value:function(a){this.emit(t.Active,{featureId:a})}},{key:"handleMiniEvent",value:function(a){this.onHover({clientX:a.touches[0].pageX,clientY:a.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var a=this.mapService.getMapContainer();if(a)if(Ji)ca.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var s=new(Xh()).Manager(a);s.add(new(Xh()).Tap({event:"dblclick",taps:2})),s.add(new(Xh()).Tap({event:"click"})),s.add(new(Xh()).Pan({threshold:0,pointers:0})),s.add(new(Xh()).Press({})),s.on("dblclick click",this.onHammer),s.on("panstart panmove panend pancancel",this.onDrag),a.addEventListener("mousemove",this.onHover),a.addEventListener("mousedown",this.onHover,!0),a.addEventListener("mouseup",this.onHover),a.addEventListener("contextmenu",this.onHover),this.hammertime=s}}},{key:"removeEventListenerOnMap",value:function(){if(Ji)ca.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var a=this.mapService.getMapContainer();a&&(a.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),a.removeEventListener("mousedown",this.onHover),a.removeEventListener("mouseup",this.onHover),a.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(a){var s=a.type,f=a.pointerType,v,m;f==="touch"?(m=Math.floor(a.pointers[0].clientY),v=Math.floor(a.pointers[0].clientX)):(m=Math.floor(a.srcEvent.y),v=Math.floor(a.srcEvent.x));var x=this.mapService.getMapContainer();if(x){var A=x.getBoundingClientRect(),T=A.top,O=A.left;v-=O,m-=T}var F=this.mapService.containerToLngLat([v,m]);return{x:v,y:m,lngLat:F,type:s,target:a.srcEvent}}},{key:"isDoubleTap",value:function(a,s,f){var v=this,m=new Date().getTime(),x="click";m-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-a)<10&&Math.abs(this.lastClickXY[1]-s)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),x="dblclick",this.emit(t.Hover,{x:a,y:s,lngLat:f,type:x})):(this.lastClickTime=m,this.lastClickXY=[a,s],this.clickTimer=setTimeout(function(){x="click",v.emit(t.Hover,{x:a,y:s,lngLat:f,type:x})},400))}}]),r}(Wl()),b=ni(y.prototype,"mapService",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y))||p),U=W(92137),G=W(87757),q=W.n(G),ie=0;function Pe(e){if(Ji)return null;var i=e;if(typeof e=="string"&&(i=document.getElementById(e)),i){var r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,r.id="l7-scene-".concat(ie++),r.classList.add("l7-scene"),i.appendChild(r),r}return null}function Re(e){var i,r,n=!0;return e==null||(i=e.target)===null||i===void 0||(r=i.path)===null||r===void 0||r.map(function(a){if(a!=null&&a.classList){var s;a==null||(s=a.classList)===null||s===void 0||s.forEach(function(f){(f==="l7-marker"||f==="l7-popup")&&(n=!1)})}}),n}var k;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(k||(k={}));var Ze,at,Ct,zt,Vt,sr,Pr,Br,zn,hn,Wn,dn,Ri;function ti(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Mn(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ti(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ti(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Vi=(Ze=(0,Yr.b2)(),at=(0,Yr.f3)(xt.IMapService),Ct=(0,Yr.f3)(xt.IRendererService),zt=(0,Yr.f3)(xt.IGlobalConfigService),Vt=(0,Yr.f3)(xt.IInteractionService),sr=(0,Yr.f3)(xt.ILayerService),Ze(Pr=(Br=function(){function e(){var i=this;(0,dt.Z)(this,e),Nn(this,"mapService",zn,this),Nn(this,"rendererService",hn,this),Nn(this,"configService",Wn,this),Nn(this,"interactionService",dn,this),Nn(this,"layerService",Ri,this),(0,S.Z)(this,"pickingFBO",void 0),(0,S.Z)(this,"width",0),(0,S.Z)(this,"height",0),(0,S.Z)(this,"alreadyInPicking",!1),(0,S.Z)(this,"pickBufferScale",1),(0,S.Z)(this,"lastPickTime",new Date().getTime()),(0,S.Z)(this,"pickFromPickingFBO",function(r,n){var a,s=n.x,f=n.y,v=n.lngLat,m=n.type,x=n.target,A=!1,T=i.rendererService,O=T.getViewportSize,F=T.readPixels,j=T.getContainer,Y=i.getContainerSize(j()),ee=Y.width,Ae=Y.height;ee*=ka,Ae*=ka;var Fe=r.getLayerConfig(),Xe=Fe.enableHighlight,nt=Fe.enableSelect,Et=s*ka,wt=f*ka;if(Et>ee-1*ka||Et<0||wt>Ae-1*ka||wt<0)return!1;var Wt;if(Wt=F({x:Math.floor(Et/i.pickBufferScale),y:Math.floor((Ae-(f+1)*ka)/i.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:i.pickingFBO}),Wt[0]!==0||Wt[1]!==0||Wt[2]!==0){var ur=zs(Wt),Ar=r.getSource().getFeatureById(ur);ur!==r.getCurrentPickId()&&m==="mousemove"&&(m="mouseenter");var Jr={x:s,y:f,type:m,lngLat:v,featureId:ur,feature:Ar,target:x};Ar&&(A=!0,r.setCurrentPickId(ur),i.triggerHoverOnLayer(r,Jr))}else{var gr={x:s,y:f,lngLat:v,type:r.getCurrentPickId()!==null&&m==="mousemove"?"mouseout":"un"+m,featureId:null,target:x,feature:null};i.triggerHoverOnLayer(r,Mn(Mn({},gr),{},{type:"unpick"})),i.triggerHoverOnLayer(r,gr),r.setCurrentPickId(null)}if(Xe&&i.highlightPickedFeature(r,Wt),nt&&m==="click"&&((a=Wt)===null||a===void 0?void 0:a.toString())!==[0,0,0,0].toString()){var vn=zs(Wt);r.getCurrentSelectedId()===null||vn!==r.getCurrentSelectedId()?(i.selectFeature(r,Wt),r.setCurrentSelectedId(vn)):(i.selectFeature(r,new Uint8Array([0,0,0,0])),r.setCurrentSelectedId(null))}return A})}return(0,It.Z)(e,[{key:"init",value:function(r){var n=this.rendererService,a=n.createTexture2D,s=n.createFramebuffer,f=n.getViewportSize,v=n.getContainer,m=this.getContainerSize(v()),x=m.width,A=m.height;x*=ka,A*=ka,this.pickBufferScale=this.configService.getSceneConfig(r).pickBufferScale||1,this.pickingFBO=s({color:a({width:Math.round(x/this.pickBufferScale),height:Math.round(A/this.pickBufferScale),wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE})}),this.interactionService.on(t.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var i=(0,U.Z)(q().mark(function n(a,s,f){var v=this,m,x,A,T;return q().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:m=this.rendererService,x=m.useFramebuffer,A=m.clear,T=m.getContainer,this.resizePickingFBO(),x(this.pickingFBO,function(){A({framebuffer:v.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),a.hooks.beforePickingEncode.call(),a.renderModels(),a.hooks.afterPickingEncode.call();var j=v.pickBox(a,s);f(j)});case 3:case"end":return F.stop()}},n,this)}));function r(n,a,s){return i.apply(this,arguments)}return r}()},{key:"pickBox",value:function(r,n){var a=this,s=n.map(function(gr){var vn=gr<0?0:gr;return Math.floor(vn*ka/a.pickBufferScale)}),f=(0,mn.Z)(s,4),v=f[0],m=f[1],x=f[2],A=f[3],T=this.rendererService,O=T.getViewportSize,F=T.readPixels,j=T.getContainer,Y=this.getContainerSize(j()),ee=Y.width,Ae=Y.height;if(ee*=ka,Ae*=ka,v>(ee-1)*ka/this.pickBufferScale||x<0||m>(Ae-1)*ka/this.pickBufferScale||A<0)return[];var Fe,Xe=Math.min(ee/this.pickBufferScale,x)-v,nt=Math.min(Ae/this.pickBufferScale,A)-m;Fe=F({x:v,y:Math.floor(Ae/this.pickBufferScale-(A+1)),width:Xe,height:nt,data:new Uint8Array(Xe*nt*4),framebuffer:this.pickingFBO});for(var Et=[],wt={},Wt=0;Wt<Fe.length/4;Wt=Wt+1){var ur=Fe.slice(Wt*4,Wt*4+4),Ar=zs(ur);if(Ar!==-1&&!wt[Ar]){var Jr=r.getSource().getFeatureById(Ar);Et.push(Mn(Mn({},Jr),{},{pickedFeatureIdx:Ar})),wt[Ar]=!0}}return Et}},{key:"handleCursor",value:function(r,n){var a=r.getLayerConfig(),s=a.cursor,f=s===void 0?"":s,v=a.cursorEnabled;if(v){var m=this.mapService.version,x=m==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),A=x==null?void 0:x.style.getPropertyValue("cursor");n==="unmousemove"&&A!==""?x==null||x.style.setProperty("cursor",""):n==="mousemove"&&(x==null||x.style.setProperty("cursor",f))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(r){return r.getContext?{width:r.width/ka,height:r.height/ka}:r.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var i=(0,U.Z)(q().mark(function n(a){var s;return q().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())){v.next=2;break}return v.abrupt("return");case 2:if(this.alreadyInPicking=!0,s=new Date().getTime(),!(s-this.lastPickTime>10||a.type==="contextmenu"||a.type==="click")){v.next=7;break}return v.next=7,this.pickingLayers(a);case 7:this.lastPickTime=s,this.layerService.renderLayers(),this.alreadyInPicking=!1;case 10:case"end":return v.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resizePickingFBO",value:function(){var r=this.rendererService.getContainer,n=this.getContainerSize(r()),a=n.width,s=n.height;a*=ka,s*=ka,(this.width!==a||this.height!==s)&&(this.pickingFBO.resize({width:Math.round(a/this.pickBufferScale),height:Math.round(s/this.pickBufferScale)}),this.width=a,this.height=s)}},{key:"pickingLayers",value:function(){var i=(0,U.Z)(q().mark(function n(a){var s=this,f,v,m,x,A;return q().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:f=this.rendererService,v=f.getViewportSize,m=f.useFramebuffer,x=f.clear,A=f.getContainer,this.resizePickingFBO(),m(this.pickingFBO,function(){var F=s.layerService.getRenderList();F.filter(function(j){return j.needPick(a.type)}).reverse().some(function(j){x({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),j.hooks.beforePickingEncode.call(),j.masks.length>0&&j.masks.map(function(ee){ee.hooks.beforeRenderData.call(),ee.hooks.beforeRender.call(),ee.render(),ee.hooks.afterRender.call()}),j.renderModels(!0),j.hooks.afterPickingEncode.call();var Y=s.pickFromPickingFBO(j,a);return s.layerService.pickedLayerId=Y?+j.id:-1,Y&&!j.getLayerConfig().enablePropagation})});case 3:case"end":return O.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"triggerHoverOnLayer",value:function(r,n){Re(n)&&(this.handleCursor(r,n.type),r.emit(n.type,n))}},{key:"highlightPickedFeature",value:function(r,n){var a=(0,mn.Z)(n,3),s=a[0],f=a[1],v=a[2];r.hooks.beforeHighlight.call([s,f,v])}},{key:"selectFeature",value:function(r,n){var a=(0,mn.Z)(n,3),s=a[0],f=a[1],v=a[2];r.hooks.beforeSelect.call([s,f,v])}}]),e}(),zn=ni(Br.prototype,"mapService",[at],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hn=ni(Br.prototype,"rendererService",[Ct],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wn=ni(Br.prototype,"configService",[zt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dn=ni(Br.prototype,"interactionService",[Vt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ri=ni(Br.prototype,"layerService",[sr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Br))||Pr),Ci=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,dt.Z)(this,e),(0,S.Z)(this,"autoStart",void 0),(0,S.Z)(this,"startTime",0),(0,S.Z)(this,"oldTime",0),(0,S.Z)(this,"running",!1),(0,S.Z)(this,"elapsedTime",0),this.autoStart=i}return(0,It.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var r=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance=="undefined"?Date:performance).now();r=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=r}return r}}]),e}(),ta,Yn,fa,Ja,_o,Wa,eo,xo,Yo;function rs(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Gs(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function Gs(e,i){if(!!e){if(typeof e=="string")return ns(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ns(e,i)}}function ns(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Hs=(ta=(0,Yr.b2)(),Yn=(0,Yr.f3)(xt.IRendererService),fa=(0,Yr.f3)(xt.IMapService),Ja=(0,Yr.f3)(xt.IGlobalConfigService),ta(_o=(Wa=function(){function e(){(0,dt.Z)(this,e),(0,S.Z)(this,"pickedLayerId",-1),(0,S.Z)(this,"clock",new Ci),(0,S.Z)(this,"alreadyInRendering",!1),(0,S.Z)(this,"layers",[]),(0,S.Z)(this,"layerList",[]),(0,S.Z)(this,"layerRenderID",void 0),(0,S.Z)(this,"sceneInited",!1),(0,S.Z)(this,"animateInstanceCount",0),(0,S.Z)(this,"shaderPicking",!0),(0,S.Z)(this,"enableRender",!0),Nn(this,"renderService",eo,this),Nn(this,"mapService",xo,this),Nn(this,"configService",Yo,this)}return(0,It.Z)(e,[{key:"add",value:function(r){this.sceneInited&&r.init(),this.layers.push(r),this.updateLayerRenderList()}},{key:"addMask",value:function(r){this.sceneInited&&r.init()}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(r){r.inited||r.init()}),this.updateLayerRenderList()}},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(r){return this.layers.find(function(n){return n.id===r})}},{key:"getLayerByName",value:function(r){return this.layers.find(function(n){return n.name===r})}},{key:"cleanRemove",value:function(r,n){if(n){var a=n.layerChildren.indexOf(r);a>-1&&n.layerChildren.splice(a,1)}else{var s=this.layers.indexOf(r);s>-1&&this.layers.splice(s,1)}this.updateLayerRenderList(),this.renderLayers()}},{key:"remove",value:function(r,n){if(n){var a=n.layerChildren.indexOf(r);a>-1&&n.layerChildren.splice(a,1)}else{var s=this.layers.indexOf(r);s>-1&&this.layers.splice(s,1)}this.updateLayerRenderList(),r.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"setEnableRender",value:function(r){this.enableRender=r}},{key:"renderLayers",value:function(){var i=(0,U.Z)(q().mark(function n(){var a,s,f;return q().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){m.next=2;break}return m.abrupt("return");case 2:this.alreadyInRendering=!0,this.clear(),a=rs(this.layerList),m.prev=5,a.s();case 7:if((s=a.n()).done){m.next=21;break}if(f=s.value,f.hooks.beforeRenderData.call(),f.hooks.beforeRender.call(),!f.isLayerGroup&&f.masks.length>0&&(this.renderService.clear({stencil:0,depth:1,framebuffer:null}),f.masks.map(function(x){x.hooks.beforeRenderData.call(),x.hooks.beforeRender.call(),x.render(),x.hooks.afterRender.call()})),!f.getLayerConfig().enableMultiPassRenderer){m.next=17;break}return m.next=15,f.renderMultiPass();case 15:m.next=18;break;case 17:f.render();case 18:f.hooks.afterRender.call();case 19:m.next=7;break;case 21:m.next=26;break;case 23:m.prev=23,m.t0=m.catch(5),a.e(m.t0);case 26:return m.prev=26,a.f(),m.finish(26);case 29:this.alreadyInRendering=!1;case 30:case"end":return m.stop()}},n,this,[[5,23,26,29]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"updateLayerRenderList",value:function(){var r=this;this.layerList=[],this.layers.filter(function(n){return n.inited}).filter(function(n){return n.isVisible()}).sort(function(n,a){return n.zIndex-a.zIndex}).forEach(function(n){n.isLayerGroup?n.layerChildren.filter(function(a){return a.inited}).filter(function(a){return a.isVisible()}).sort(function(a,s){return a.zIndex-s.zIndex}).forEach(function(a){r.layerList.push(a)}):r.layerList.push(n)})}},{key:"destroy",value:function(){this.layers.forEach(function(r){r.destroy()}),this.layers=[],this.layerList=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var r=pi(this.mapService.bgColor);this.renderService.clear({color:r,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=ca.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){ca.cancelAnimationFrame(this.layerRenderID)}}]),e}(),eo=ni(Wa.prototype,"renderService",[Yn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xo=ni(Wa.prototype,"mapService",[fa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yo=ni(Wa.prototype,"configService",[Ja],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wa))||_o),Ga=W(81253),ds=W(14293),Ai=W.n(ds),Fa=function(){function e(i){var r=this;(0,dt.Z)(this,e),(0,S.Z)(this,"name",void 0),(0,S.Z)(this,"type",void 0),(0,S.Z)(this,"scale",void 0),(0,S.Z)(this,"descriptor",void 0),(0,S.Z)(this,"featureBufferLayout",[]),(0,S.Z)(this,"needRescale",!1),(0,S.Z)(this,"needRemapping",!1),(0,S.Z)(this,"needRegenerateVertices",!1),(0,S.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,S.Z)(this,"vertexAttribute",void 0),(0,S.Z)(this,"defaultCallback",function(n){if(n.length===0){var a;return((a=r.scale)===null||a===void 0?void 0:a.defaultValues)||[]}return n.map(function(s,f){var v,m=(v=r.scale)===null||v===void 0?void 0:v.scalers[f].func,x=m(s);return x})}),this.setProps(i)}return(0,It.Z)(e,[{key:"setProps",value:function(r){Object.assign(this,r)}},{key:"mapping",value:function(r){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var a,s=(a=this.scale)===null||a===void 0?void 0:a.callback.apply(a,(0,pe.Z)(r));if(!Ai()(s))return[s]}return this.defaultCallback(r)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),wa=["buffer","update","name"],la=["buffer","update","name"],vs,Ts,Xa,Ro,ms,ha;function ec(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function uu(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ec(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ec(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function lf(e){return new Promise(function(i){return setTimeout(i,e)})}var ko=(vs={},(0,S.Z)(vs,k.FLOAT,4),(0,S.Z)(vs,k.UNSIGNED_BYTE,1),(0,S.Z)(vs,k.UNSIGNED_SHORT,2),vs),Ac=(Ts=(0,Yr.b2)(),Xa=(0,Yr.f3)(xt.IRendererService),Ts(Ro=(ms=function(){function e(){(0,dt.Z)(this,e),(0,S.Z)(this,"attributesAndIndices",void 0),Nn(this,"rendererService",ha,this),(0,S.Z)(this,"attributes",[]),(0,S.Z)(this,"triangulation",void 0),(0,S.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,It.Z)(e,[{key:"registerStyleAttribute",value:function(r){var n=this.getLayerStyleAttribute(r.name||"");return n?n.setProps(r):(n=new Fa(r),this.attributes.push(n)),n}},{key:"updateStyleAttribute",value:function(r,n,a){var s=this.getLayerStyleAttribute(r);s||(s=this.registerStyleAttribute(uu(uu({},n),{},{name:r})));var f=n.scale;f&&s&&(s.scale=f,s.needRescale=!0,s.needRemapping=!0,s.needRegenerateVertices=!0,a&&a.featureRange&&(s.featureRange=a.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(r){return this.attributes.find(function(n){return n.name===r})}},{key:"getLayerAttributeScale",value:function(r){var n,a=this.getLayerStyleAttribute(r),s=a==null||(n=a.scale)===null||n===void 0?void 0:n.scalers;return s&&s[0]?s[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3?arguments[3]:void 0,f=this.attributes.find(function(nt){return nt.name===r});if(f&&f.descriptor){var v=f.descriptor,m=v.update,x=v.buffer,A=v.size,T=A===void 0?0:A,O=ko[x.type||k.FLOAT];if(m){var F=this.featureLayout,j=F.elements,Y=F.sizePerElement,ee=j.slice(a,s);if(!ee.length)return;var Ae=ee[0].offset,Fe=Ae*T*O,Xe=ee.map(function(nt,Et){for(var wt=nt.featureIdx,Wt=nt.vertices,ur=nt.normals,Ar=Wt.length/Y,Jr=[],gr=0;gr<Ar;gr++){var vn=ur?ur.slice(gr*3,gr*3+3):[];Jr.push.apply(Jr,(0,pe.Z)(m(n[wt],wt,Wt.slice(gr*Y,gr*Y+Y),Et,vn)))}return Jr}).reduce(function(nt,Et){return nt.push.apply(nt,(0,pe.Z)(Et)),nt},[]);f.vertexAttribute.updateBuffer({data:Xe,offset:Fe})}}}},{key:"createAttributesAndIndices",value:function(r,n,a){var s=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var f=this.attributes.map(function(Fe){return Fe.resetDescriptor(),Fe.descriptor}),v=0,m=[],x=[],A=[],T=3;r.forEach(function(Fe,Xe){var nt=s.triangulation(Fe,a),Et=nt.indices,wt=nt.vertices,Wt=nt.normals,ur=nt.size,Ar=nt.indexes;Et.forEach(function(Pn){x.push(Pn+v)}),T=ur;var Jr=wt.length/ur;s.featureLayout.sizePerElement=T,s.featureLayout.elements.push({featureIdx:Xe,vertices:wt,normals:Wt,offset:v}),v+=Jr;for(var gr=function(Kn){var Ba=(Wt==null?void 0:Wt.slice(Kn*3,Kn*3+3))||[],qo=wt.slice(Kn*ur,Kn*ur+ur),Ls=0;Ar&&Ar[Kn]!==void 0&&(Ls=Ar[Kn]),f.forEach(function(Ds,Ys){if(Ds&&Ds.update){var vf;(vf=Ds.buffer.data).push.apply(vf,(0,pe.Z)(Ds.update(Fe,Xe,qo,Kn,Ba,Ls)))}})},vn=0;vn<Jr;vn++)gr(vn)});var O=this.rendererService,F=O.createAttribute,j=O.createBuffer,Y=O.createElements,ee={};f.forEach(function(Fe,Xe){if(Fe){var nt=Fe.buffer,Et=Fe.update,wt=Fe.name,Wt=(0,Ga.Z)(Fe,wa),ur=F(uu({buffer:j(nt)},Wt));ee[Fe.name||""]=ur,s.attributes[Xe].vertexAttribute=ur}});var Ae=Y({data:x,type:k.UNSIGNED_INT,count:x.length});return this.attributesAndIndices={attributes:ee,elements:Ae},this.attributesAndIndices}},{key:"createAttributes",value:function(r,n){var a=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var s=this.attributes.map(function(F){return F.resetDescriptor(),F.descriptor}),f=0,v=[],m=3;r.forEach(function(F,j){var Y=a.triangulation(F),ee=Y.indices,Ae=Y.vertices,Fe=Y.normals,Xe=Y.size,nt=Y.indexes;ee.forEach(function(ur){v.push(ur+f)}),m=Xe;var Et=Ae.length/Xe;a.featureLayout.sizePerElement=m,a.featureLayout.elements.push({featureIdx:j,vertices:Ae,normals:Fe,offset:f}),f+=Et;for(var wt=function(Ar){var Jr=(Fe==null?void 0:Fe.slice(Ar*3,Ar*3+3))||[],gr=Ae.slice(Ar*Xe,Ar*Xe+Xe),vn=0;nt&&nt[Ar]!==void 0&&(vn=nt[Ar]),s.forEach(function(Pn,Kn){if(Pn&&Pn.update){var Ba;(Ba=Pn.buffer.data).push.apply(Ba,(0,pe.Z)(Pn.update(F,j,gr,Ar,Jr,vn)))}})},Wt=0;Wt<Et;Wt++)wt(Wt)});var x=this.rendererService,A=x.createAttribute,T=x.createBuffer,O={};return s.forEach(function(F,j){if(F){var Y=F.buffer,ee=F.update,Ae=F.name,Fe=(0,Ga.Z)(F,la),Xe=A(uu({buffer:T(Y)},Fe));O[F.name||""]=Xe,a.attributes[j].vertexAttribute=Xe}}),{attributes:O}}},{key:"clearAllAttributes",value:function(){var r;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(r=this.attributesAndIndices)===null||r===void 0||r.elements.destroy(),this.attributes=[]}}]),e}(),ha=ni(ms.prototype,"rendererService",[Xa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ms))||Ro),nl=W(67709),Yh=W.n(nl),Nf,ph,wc,dh,xp,vh,qh,bp,Ep,Tc,Kh,mh,cf,gh,Sp,Cp,$h,gs,Ap,Qh,Jh,ep,wp,yh,Tp,_h,tp,zf,rp,xh,ld,Nd,cd;function xv(e){var i=zd();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function zd(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var C0=(Nf=(0,Yr.b2)(),ph=(0,Yr.f3)(xt.SceneID),wc=(0,Yr.f3)(xt.IIconService),dh=(0,Yr.f3)(xt.IFontService),xp=(0,Yr.f3)(xt.IControlService),vh=(0,Yr.f3)(xt.IGlobalConfigService),qh=(0,Yr.f3)(xt.IMapService),bp=(0,Yr.f3)(xt.ICoordinateSystemService),Ep=(0,Yr.f3)(xt.IRendererService),Tc=(0,Yr.f3)(xt.ILayerService),Kh=(0,Yr.f3)(xt.ICameraService),mh=(0,Yr.f3)(xt.IInteractionService),cf=(0,Yr.f3)(xt.IPickingService),gh=(0,Yr.f3)(xt.IShaderModuleService),Sp=(0,Yr.f3)(xt.IMarkerService),Cp=(0,Yr.f3)(xt.IPopupService),Nf($h=(gs=function(e){(0,Ir.Z)(r,e);var i=xv(r);function r(){var n;return(0,dt.Z)(this,r),n=i.call(this),(0,S.Z)((0,J.Z)(n),"destroyed",!1),(0,S.Z)((0,J.Z)(n),"loaded",!1),(0,S.Z)((0,J.Z)(n),"loadFont",!1),(0,S.Z)((0,J.Z)(n),"fontFamily",""),Nn((0,J.Z)(n),"id",Ap,(0,J.Z)(n)),Nn((0,J.Z)(n),"iconService",Qh,(0,J.Z)(n)),Nn((0,J.Z)(n),"fontService",Jh,(0,J.Z)(n)),Nn((0,J.Z)(n),"controlService",ep,(0,J.Z)(n)),Nn((0,J.Z)(n),"configService",wp,(0,J.Z)(n)),Nn((0,J.Z)(n),"map",yh,(0,J.Z)(n)),Nn((0,J.Z)(n),"coordinateSystemService",Tp,(0,J.Z)(n)),Nn((0,J.Z)(n),"rendererService",_h,(0,J.Z)(n)),Nn((0,J.Z)(n),"layerService",tp,(0,J.Z)(n)),Nn((0,J.Z)(n),"cameraService",zf,(0,J.Z)(n)),Nn((0,J.Z)(n),"interactionService",rp,(0,J.Z)(n)),Nn((0,J.Z)(n),"pickingService",xh,(0,J.Z)(n)),Nn((0,J.Z)(n),"shaderModuleService",ld,(0,J.Z)(n)),Nn((0,J.Z)(n),"markerService",Nd,(0,J.Z)(n)),Nn((0,J.Z)(n),"popupService",cd,(0,J.Z)(n)),(0,S.Z)((0,J.Z)(n),"inited",!1),(0,S.Z)((0,J.Z)(n),"initPromise",void 0),(0,S.Z)((0,J.Z)(n),"rendering",!1),(0,S.Z)((0,J.Z)(n),"$container",void 0),(0,S.Z)((0,J.Z)(n),"canvas",void 0),(0,S.Z)((0,J.Z)(n),"markerContainer",void 0),(0,S.Z)((0,J.Z)(n),"hooks",void 0),(0,S.Z)((0,J.Z)(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),gn(),n.coordinateSystemService.needRefresh=!0,n.render())}),(0,S.Z)((0,J.Z)(n),"handleMapCameraChanged",function(a){n.cameraService.update(a),n.render()}),n.hooks={init:new us},n}return(0,It.Z)(r,[{key:"init",value:function(a){var s=this;this.configService.setSceneConfig(this.id,a),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return s.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,U.Z)(q().mark(function f(){return q().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,new Promise(function(x){s.map.onCameraChanged(function(A){s.cameraService.init(),s.cameraService.update(A),s.map.version!=="GAODE2.x"&&x()}),s.map.version!=="GAODE2.x"?s.map.init():x()});case 2:if(!(s.map.version==="GAODE2.x"&&s.map.initViewPort)){m.next=6;break}return m.next=5,s.map.init();case 5:s.map.initViewPort();case 6:s.map.onCameraChanged(s.handleMapCameraChanged),s.map.addMarkerContainer(),s.markerService.addMarkers(),s.markerService.addMarkerLayers(),s.popupService.initPopup(),s.interactionService.init(),s.interactionService.on(t.Drag,s.addSceneEvent.bind(s));case 13:case"end":return m.stop()}},f)}))),this.hooks.init.tapPromise("initRenderer",(0,U.Z)(q().mark(function f(){var v,m;return q().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(v=Pe(s.configService.getSceneConfig(s.id).id||""),s.$container=v,!v){A.next=11;break}return s.canvas=Ua("canvas","",v),s.setCanvas(),A.next=7,s.rendererService.init(s.canvas,s.configService.getSceneConfig(s.id));case 7:Yh()(s.$container,s.handleWindowResized),ca.matchMedia&&((m=ca.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||m===void 0||m.addListener(s.handleWindowResized)),A.next=12;break;case 11:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:s.pickingService.init(s.id);case 13:case"end":return A.stop()}},f)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"initMiniScene",value:function(a){var s=this;this.configService.setSceneConfig(this.id,a),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return s.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,U.Z)(q().mark(function f(){return q().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,new Promise(function(x){s.map.onCameraChanged(function(A){s.cameraService.init(),s.cameraService.update(A),s.map.version!=="GAODE2.x"&&x()}),s.map.initMiniMap()});case 2:s.map.onCameraChanged(s.handleMapCameraChanged),s.interactionService.init(),s.interactionService.on(t.Drag,s.addSceneEvent.bind(s));case 5:case"end":return m.stop()}},f)}))),this.hooks.init.tapPromise("initRenderer",(0,U.Z)(q().mark(function f(){var v;return q().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(v=a.canvas,s.$container=v||null,!s.$container){x.next=7;break}return x.next=5,s.rendererService.init(a.canvas,s.configService.getSceneConfig(s.id));case 5:x.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:s.pickingService.init(s.id);case 9:case"end":return x.stop()}},f)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(a){this.layerService.sceneService=this,this.layerService.add(a),this.render()}},{key:"addMask",value:function(a){this.layerService.sceneService=this,this.layerService.addMask(a),this.render()}},{key:"render",value:function(){var n=(0,U.Z)(q().mark(function s(){return q().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!(this.rendering||this.destroyed)){v.next=2;break}return v.abrupt("return");case 2:if(this.rendering=!0,this.inited){v.next=23;break}return v.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){v.next=18;break}return v.prev=8,v.next=11,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 11:v.next=18;break;case 13:v.prev=13,v.t0=v.catch(8),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(v.t0);case 18:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 23:this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this.rendering=!1;case 26:case"end":return v.stop()}},s,this,[[8,13]])}));function a(){return n.apply(this,arguments)}return a}()},{key:"addFontFace",value:function(a,s){this.fontFamily=a;var f=document.createElement("style");f.type="text/css",f.innerText=`
        @font-face{
            font-family: '`.concat(a,`';
            src: url('`).concat(s,`') format('woff2'),
            url('`).concat(s,`') format('woff'),
            url('`).concat(s,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(f),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(a){var s,f=(s=this.$container)===null||s===void 0?void 0:s.getElementsByTagName("canvas")[0];this.render();var v=a==="jpg"?f==null?void 0:f.toDataURL("image/jpeg"):f==null?void 0:f.toDataURL("image/png");return v}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var a=this.$container.parentElement;a!==null&&(this.markerContainer=Ua("div","l7-marker-container",a))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var a=this,s,f;if(!this.inited){this.destroyed=!0;return}if(this.emit("destroy"),this.pickingService.destroy(),this.layerService.destroy(),setTimeout(function(){var m;(m=a.$container)===null||m===void 0||m.removeChild(a.canvas),a.canvas=null,a.rendererService.destroy()}),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),(s=this.$container)===null||s===void 0||(f=s.parentNode)===null||f===void 0||f.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,(0,nl.unbind)(this.$container,this.handleWindowResized),ca.matchMedia){var v;(v=ca.matchMedia("screen and (min-resolution: 2dppx)"))===null||v===void 0||v.removeListener(this.handleWindowResized)}}},{key:"initContainer",value:function(){var a,s,f=ka,v=((a=this.$container)===null||a===void 0?void 0:a.clientWidth)||400,m=((s=this.$container)===null||s===void 0?void 0:s.clientHeight)||300,x=this.canvas;x&&(x.width=v*f,x.height=m*f),this.rendererService.viewport({x:0,y:0,width:f*v,height:f*m})}},{key:"setCanvas",value:function(){var a,s,f=ka,v=((a=this.$container)===null||a===void 0?void 0:a.clientWidth)||400,m=((s=this.$container)===null||s===void 0?void 0:s.clientHeight)||300,x=this.canvas;x.width=v*f,x.height=m*f,x.style.width="100%",x.style.height="100%"}},{key:"addSceneEvent",value:function(a){this.emit(a.type,a)}}]),r}(cs.EventEmitter),Ap=ni(gs.prototype,"id",[ph],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qh=ni(gs.prototype,"iconService",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jh=ni(gs.prototype,"fontService",[dh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ep=ni(gs.prototype,"controlService",[xp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wp=ni(gs.prototype,"configService",[vh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yh=ni(gs.prototype,"map",[qh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tp=ni(gs.prototype,"coordinateSystemService",[bp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_h=ni(gs.prototype,"rendererService",[Ep],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tp=ni(gs.prototype,"layerService",[Tc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zf=ni(gs.prototype,"cameraService",[Kh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rp=ni(gs.prototype,"interactionService",[mh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xh=ni(gs.prototype,"pickingService",[cf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ld=ni(gs.prototype,"shaderModuleService",[gh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nd=ni(gs.prototype,"markerService",[Sp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cd=ni(gs.prototype,"popupService",[Cp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gs))||$h),Mp=W(44908),Co=W.n(Mp);function tc(e){var i=0;switch(e){case"vec2":case"ivec2":i=2;break;case"vec3":case"ivec3":i=3;break;case"vec4":case"ivec4":case"mat2":i=4;break;case"mat3":i=9;break;case"mat4":i=16;break;default:}return i}var A0=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function ff(e){var i={};return e=e.replace(A0,function(r,n,a){var s=a.split(":"),f=s[0].trim(),v="";switch(s.length>1&&(v=s[1].trim()),n){case"bool":v=v==="true";break;case"float":case"int":v=Number(v);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":v?v=v.replace("[","").replace("]","").split(",").reduce(function(m,x){return m.push(Number(x.trim())),m},[]):v=new Array(tc(n)).fill(0);break;default:}return i[f]=v,"uniform ".concat(n," ").concat(f,`;
`)}),{content:e,uniforms:i}}var fd,Zd;function Pp(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Gu(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Pp(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Pp(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Ip="#define PI 3.14159265359",Op=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,hd=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,pd=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,Ud=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

uniform float u_activeMix: 0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,bv=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec3 u_CurrentSelectedId : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;
uniform float u_EnableSelect: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {
  //   // \u9009\u4E2D\u6001
  //   v_PickingResult.a = SELECT;
  // } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {
  //   // \u9AD8\u4EAE\u6001
  //   v_PickingResult.a = HIGHLIGHT;
  // } else {
  //   v_PickingResult.a = NORMAL;
  // }

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,Rp=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,Ev=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom));
  }
  return pixel * 2.0;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,Sv=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,Cv=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasThetaOffset() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 thetaOffset \u7684\u6570\u636E
  return u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 1.0, 0.0, 0.0, // offsets thetaOffset
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0 +  // offsets
          u_cellTypeLayout[2][1];         // thetaOffset
}`,Av=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,wv=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,Hu=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,dd=`
// \u8BA1\u7B97 thetaOffset \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasThetaOffset()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 thetaOffset \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_thetaOffset, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureThetaOffset, textureOffset + 1.0);
  }
}
`,Tv=/precision\s+(high|low|medium)p\s+float/,Mc=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,w0=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,Mv=(fd=(0,Yr.b2)(),fd(Zd=function(){function e(){(0,dt.Z)(this,e),(0,S.Z)(this,"moduleCache",{}),(0,S.Z)(this,"rawContentCache",{})}return(0,It.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:Ip,fs:Ip}),this.registerModule("decode",{vs:Op,fs:""}),this.registerModule("projection",{vs:Ev,fs:""}),this.registerModule("project",{vs:Rp,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:Sv}),this.registerModule("lighting",{vs:pd,fs:""}),this.registerModule("light",{vs:hd,fs:""}),this.registerModule("picking",{vs:bv,fs:Ud}),this.registerModule("styleMapping",{vs:Cv,fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:dd,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:Av,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:wv,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:Hu,fs:""})}},{key:"registerModule",value:function(r,n){if(!this.rawContentCache[r]){var a=n.vs,s=n.fs,f=n.uniforms,v=ff(a),m=v.content,x=v.uniforms,A=ff(s),T=A.content,O=A.uniforms;this.rawContentCache[r]={fs:T,uniforms:Gu(Gu(Gu({},x),O),f),vs:m}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(r){var n=this;if(this.moduleCache[r])return this.moduleCache[r];var a=this.rawContentCache[r].vs,s=this.rawContentCache[r].fs,f=this.processModule(a,[],"vs"),v=f.content,m=f.includeList,x=this.processModule(s,[],"fs"),A=x.content,T=x.includeList,O=A,F=Co()(m.concat(T).concat(r)).reduce(function(j,Y){return Gu(Gu({},j),n.rawContentCache[Y].uniforms)},{});return Tv.test(A)||(O=Mc+A),this.moduleCache[r]={fs:O.trim(),uniforms:F,vs:v.trim()},this.moduleCache[r]}},{key:"processModule",value:function(r,n,a){var s=this,f=r.replace(w0,function(v,m){var x=m.split(" "),A=x[0].replace(/"/g,"");if(n.indexOf(A)>-1)return"";var T=s.rawContentCache[A][a];n.push(A);var O=s.processModule(T,n,a),F=O.content;return F});return{content:f,includeList:n}}}]),e}())||Zd);function bh(e,i){for(;!Object.prototype.hasOwnProperty.call(e,i)&&(e=(0,_t.Z)(e),e!==null););return e}function Tl(){return typeof Reflect!="undefined"&&Reflect.get?Tl=Reflect.get:Tl=function(i,r,n){var a=bh(i,r);if(!!a){var s=Object.getOwnPropertyDescriptor(a,r);return s.get?s.get.call(arguments.length<3?i:n):s.value}},Tl.apply(this,arguments)}var il;(function(e){e.Normal="normal",e.PostProcessing="post-processing"})(il||(il={}));var Eh,Sh,kp=(Eh=(0,Yr.b2)(),Eh(Sh=function(){function e(){(0,dt.Z)(this,e),(0,S.Z)(this,"shaderModuleService",void 0),(0,S.Z)(this,"rendererService",void 0),(0,S.Z)(this,"cameraService",void 0),(0,S.Z)(this,"mapService",void 0),(0,S.Z)(this,"interactionService",void 0),(0,S.Z)(this,"layerService",void 0),(0,S.Z)(this,"config",void 0)}return(0,It.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return il.Normal}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(xt.IRendererService),this.cameraService=r.getContainer().get(xt.ICameraService),this.mapService=r.getContainer().get(xt.IMapService),this.interactionService=r.getContainer().get(xt.IInteractionService),this.layerService=r.getContainer().get(xt.ILayerService),this.shaderModuleService=r.getContainer().get(xt.IShaderModuleService)}},{key:"render",value:function(r){}}]),e}())||Sh),jd,Vd;function Pv(e){var i=Gd();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function Gd(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Hd=(jd=(0,Yr.b2)(),jd(Vd=function(e){(0,Ir.Z)(r,e);var i=Pv(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(a,s){Tl((0,_t.Z)(r.prototype),"init",this).call(this,a,s)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),r}(kp))||Vd),Pc,Wd,vd,Lp,Xd;function Yd(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Iv(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function Iv(e,i){if(!!e){if(typeof e=="string")return qd(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return qd(e,i)}}function qd(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Kd=(Pc=(0,Yr.b2)(),Wd=(0,Yr.f3)(xt.IPostProcessor),Pc(vd=(Lp=function(){function e(){(0,dt.Z)(this,e),(0,S.Z)(this,"passes",[]),Nn(this,"postProcessor",Xd,this),(0,S.Z)(this,"layer",void 0),(0,S.Z)(this,"renderFlag",void 0),(0,S.Z)(this,"width",0),(0,S.Z)(this,"height",0)}return(0,It.Z)(e,[{key:"setLayer",value:function(r){this.layer=r}},{key:"setRenderFlag",value:function(r){this.renderFlag=r}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var i=(0,U.Z)(q().mark(function n(){var a,s,f;return q().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:a=Yd(this.passes),m.prev=1,a.s();case 3:if((s=a.n()).done){m.next=9;break}return f=s.value,m.next=7,f.render(this.layer);case 7:m.next=3;break;case 9:m.next=14;break;case 11:m.prev=11,m.t0=m.catch(1),a.e(m.t0);case 14:return m.prev=14,a.f(),m.finish(14);case 17:return m.next=19,this.postProcessor.render(this.layer);case 19:case"end":return m.stop()}},n,this,[[1,11,14,17]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){(this.width!==r||this.height!==n)&&(this.postProcessor.resize(r,n),this.width=r,this.height=n)}},{key:"add",value:function(r,n){r.getType()===il.PostProcessing?this.postProcessor.add(r,this.layer,n):(r.init(this.layer,n),this.passes.push(r))}},{key:"insert",value:function(r,n,a){r.init(this.layer,n),this.passes.splice(a,0,r)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),Xd=ni(Lp.prototype,"postProcessor",[Wd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lp))||vd),$d,np;function Qd(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Dp(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Qd(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Qd(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function T0(e){var i=Ov();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function Ov(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var M0=($d=(0,Yr.b2)(),$d(np=function(e){(0,Ir.Z)(r,e);var i=T0(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"pickingFBO",void 0),(0,S.Z)((0,J.Z)(n),"layer",void 0),(0,S.Z)((0,J.Z)(n),"width",0),(0,S.Z)((0,J.Z)(n),"height",0),(0,S.Z)((0,J.Z)(n),"alreadyInRendering",!1),(0,S.Z)((0,J.Z)(n),"pickFromPickingFBO",function(v){var m=v.x,x=v.y,A=v.lngLat,T=v.type;if(!(!n.layer.isVisible()||!n.layer.needPick(T))){var O=n.rendererService,F=O.getViewportSize,j=O.readPixels,Y=O.useFramebuffer,ee=F(),Ae=ee.width,Fe=ee.height,Xe=n.layer.getLayerConfig(),nt=Xe.enableHighlight,Et=Xe.enableSelect,wt=m*ka,Wt=x*ka;if(!(wt>Ae||wt<0||Wt>Fe||Wt<0)){var ur;Y(n.pickingFBO,function(){var Ar;if(ur=j({x:Math.round(wt),y:Math.round(Fe-(x+1)*ka),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),ur[0]!==0||ur[1]!==0||ur[2]!==0){var Jr=zs(ur),gr=n.layer.getSource().getFeatureById(Jr),vn={x:m,y:x,type:T,lngLat:A,featureId:Jr,feature:gr};gr&&(n.layer.setCurrentPickId(Jr),n.triggerHoverOnLayer(vn))}else{var Pn={x:m,y:x,lngLat:A,type:n.layer.getCurrentPickId()===null?"un"+T:"mouseout",featureId:null,feature:null};n.triggerHoverOnLayer(Dp(Dp({},Pn),{},{type:"unpick"})),n.triggerHoverOnLayer(Pn),n.layer.setCurrentPickId(null)}nt&&n.highlightPickedFeature(ur),Et&&T==="click"&&((Ar=ur)===null||Ar===void 0?void 0:Ar.toString())!==[0,0,0,0].toString()&&n.selectFeature(ur)})}}}),n}return(0,It.Z)(r,[{key:"getType",value:function(){return il.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(a,s){Tl((0,_t.Z)(r.prototype),"init",this).call(this,a,s),this.layer=a;var f=this.rendererService,v=f.createTexture2D,m=f.createFramebuffer,x=f.getViewportSize,A=x(),T=A.width,O=A.height;this.pickingFBO=m({color:v({width:T,height:O,wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE})}),this.interactionService.on(t.Hover,this.pickFromPickingFBO),this.interactionService.on(t.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(t.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(a){var s=this;if(!this.alreadyInRendering){var f=this.rendererService,v=f.getViewportSize,m=f.useFramebuffer,x=f.clear,A=v(),T=A.width,O=A.height;this.alreadyInRendering=!0,(this.width!==T||this.height!==O)&&(this.pickingFBO.resize({width:T,height:O}),this.width=T,this.height=O),m(this.pickingFBO,function(){x({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var F=s.layer.multiPassRenderer.getRenderFlag();s.layer.multiPassRenderer.setRenderFlag(!1),a.hooks.beforePickingEncode.call(),a.render(),a.hooks.afterPickingEncode.call(),s.layer.multiPassRenderer.setRenderFlag(F),s.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(a){this.layer.emit(a.type,a)}},{key:"highlightPickedFeature",value:function(a){var s=(0,mn.Z)(a,3),f=s[0],v=s[1],m=s[2];this.layer.hooks.beforeHighlight.call([f,v,m]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(a){var s=(0,mn.Z)(a,3),f=s[0],v=s[1],m=s[2];this.layer.hooks.beforeSelect.call([f,v,m]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(a){var s=a.featureId,f=ss(s);this.selectFeature(new Uint8Array(f))}},{key:"highlightFeatureHandle",value:function(a){var s=a.featureId,f=ss(s);this.highlightPickedFeature(new Uint8Array(f))}}]),r}(kp))||np),P0=W(11700),I0=W.n(P0),O0=W(68929),R0=W.n(O0),Rv,kv,Lv,Ml,Fp;function Jd(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function hf(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Jd(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Jd(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Dv=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ch=(Rv=(0,Yr.b2)(),kv=(0,Yr.f3)(xt.IShaderModuleService),Rv(Lv=(Ml=function(){function e(){(0,dt.Z)(this,e),Nn(this,"shaderModuleService",Fp,this),(0,S.Z)(this,"rendererService",void 0),(0,S.Z)(this,"config",void 0),(0,S.Z)(this,"quad",Dv),(0,S.Z)(this,"enabled",!0),(0,S.Z)(this,"renderToScreen",!1),(0,S.Z)(this,"model",void 0),(0,S.Z)(this,"name",void 0),(0,S.Z)(this,"optionsToUpdate",{})}return(0,It.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(r){this.name=r}},{key:"getType",value:function(){return il.PostProcessing}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(xt.IRendererService),this.shaderModuleService=r.getContainer().get(xt.IShaderModuleService);var a=this.rendererService,s=a.createAttribute,f=a.createBuffer,v=a.createModel,m=this.setupShaders(),x=m.vs,A=m.fs,T=m.uniforms;this.model=v({vs:x,fs:A,attributes:{a_Position:s({buffer:f({data:[-4,-4,4,-4,0,4],type:k.FLOAT}),size:2})},uniforms:hf(hf({u_Texture:null},T),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(r,n){var a=this,s=r.multiPassRenderer.getPostProcessor(),f=this.rendererService,v=f.useFramebuffer,m=f.getViewportSize,x=f.clear,A=m(),T=A.width,O=A.height;v(this.renderToScreen?null:s.getWriteFBO(),function(){x({framebuffer:s.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var F=hf({u_BloomFinal:0,u_Texture:s.getReadFBO(),u_ViewportSize:[T,O]},a.convertOptionsToUniforms(a.optionsToUpdate));n&&(F.u_BloomFinal=1,F.u_Texture2=n),a.model.draw({uniforms:F})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(r){this.enabled=r}},{key:"setRenderToScreen",value:function(r){this.renderToScreen=r}},{key:"updateOptions",value:function(r){this.optionsToUpdate=hf(hf({},this.optionsToUpdate),r)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(r){var n={};return Object.keys(r).forEach(function(a){Ai()(r[a])||(n["u_".concat(I0()(R0()(a)))]=r[a])}),n}}]),e}(),Fp=ni(Ml.prototype,"shaderModuleService",[kv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ml))||Lv),_m,xm;function bm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Em(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?bm(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):bm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function qx(e){var i=Kx();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function Kx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $x=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,Qx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Jx=(_m=(0,Yr.b2)(),_m(xm=function(e){(0,Ir.Z)(r,e);var i=qx(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Qx,fs:$x});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,f=a.fs,v=a.uniforms,m=this.rendererService.getViewportSize(),x=m.width,A=m.height;return{vs:s,fs:f,uniforms:Em(Em({},v),{},{u_ViewportSize:[x,A]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return Ai()(a.bloomRadius)||(s.u_radius=a.bloomRadius),Ai()(a.bloomIntensity)||(s.u_intensity=a.bloomIntensity),Ai()(a.bloomBaseRadio)||(s.u_baseRadio=a.bloomBaseRadio),s}}]),r}(Ch))||xm),Sm,Cm;function Am(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function wm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Am(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Am(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function eb(e){var i=tb();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function tb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rb=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,nb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ib=(Sm=(0,Yr.b2)(),Sm(Cm=function(e){(0,Ir.Z)(r,e);var i=eb(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:nb,fs:rb});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,f=a.fs,v=a.uniforms,m=this.rendererService.getViewportSize(),x=m.width,A=m.height;return{vs:s,fs:f,uniforms:wm(wm({},v),{},{u_ViewportSize:[x,A]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return Ai()(a.blurRadius)||(s.u_BlurDir=[a.blurRadius,0]),s}}]),r}(Ch))||Cm),Tm,Mm;function Pm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Im(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Pm(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Pm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ab(e){var i=ob();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function ob(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sb=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,ub=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,lb=(Tm=(0,Yr.b2)(),Tm(Mm=function(e){(0,Ir.Z)(r,e);var i=ab(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:ub,fs:sb});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,f=a.fs,v=a.uniforms,m=this.rendererService.getViewportSize(),x=m.width,A=m.height;return{vs:s,fs:f,uniforms:Im(Im({},v),{},{u_ViewportSize:[x,A]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return Ai()(a.blurRadius)||(s.u_BlurDir=[0,a.blurRadius]),s}}]),r}(Ch))||Mm),Om,Rm;function km(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Lm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?km(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):km(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function cb(e){var i=fb();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function fb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hb=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,pb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,db=(Om=(0,Yr.b2)(),Om(Rm=function(e){(0,Ir.Z)(r,e);var i=cb(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:pb,fs:hb});var a=this.shaderModuleService.getModule("colorhalftone-pass"),s=a.vs,f=a.fs,v=a.uniforms,m=this.rendererService.getViewportSize(),x=m.width,A=m.height;return{vs:s,fs:f,uniforms:Lm(Lm({},v),{},{u_ViewportSize:[x,A]})}}}]),r}(Ch))||Rm),Dm,Fm;function vb(e){var i=mb();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function mb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gb=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,yb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,_b=(Dm=(0,Yr.b2)(),Dm(Fm=function(e){(0,Ir.Z)(r,e);var i=vb(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:yb,fs:gb}),this.shaderModuleService.getModule("copy-pass")}}]),r}(Ch))||Fm),Bm,Nm;function zm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Zm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?zm(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):zm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function xb(e){var i=bb();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function bb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Eb=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Sb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Cb=(Bm=(0,Yr.b2)(),Bm(Nm=function(e){(0,Ir.Z)(r,e);var i=xb(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:Sb,fs:Eb});var a=this.shaderModuleService.getModule("hexagonalpixelate-pass"),s=a.vs,f=a.fs,v=a.uniforms,m=this.rendererService.getViewportSize(),x=m.width,A=m.height;return{vs:s,fs:f,uniforms:Zm(Zm({},v),{},{u_ViewportSize:[x,A]})}}}]),r}(Ch))||Nm),Um,jm;function Vm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Gm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Vm(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Vm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Ab(e){var i=wb();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function wb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Tb=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Mb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Pb=(Um=(0,Yr.b2)(),Um(jm=function(e){(0,Ir.Z)(r,e);var i=Ab(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:Mb,fs:Tb});var a=this.shaderModuleService.getModule("ink-pass"),s=a.vs,f=a.fs,v=a.uniforms,m=this.rendererService.getViewportSize(),x=m.width,A=m.height;return{vs:s,fs:f,uniforms:Gm(Gm({},v),{},{u_ViewportSize:[x,A]})}}}]),r}(Ch))||jm),Hm,Wm;function Ib(e){var i=Ob();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function Ob(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Rb=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,kb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Lb=(Hm=(0,Yr.b2)(),Hm(Wm=function(e){(0,Ir.Z)(r,e);var i=Ib(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:kb,fs:Rb}),this.shaderModuleService.getModule("noise-pass")}}]),r}(Ch))||Wm),Xm,Ym;function Db(e){var i=Fb();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function Fb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Bb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Nb=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,zb=(Xm=(0,Yr.b2)(),Xm(Ym=function(e){(0,Ir.Z)(r,e);var i=Db(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:Bb,fs:Nb}),this.shaderModuleService.getModule("sepia-pass")}}]),r}(Ch))||Ym),qm,Km,$m,Qm,md,Jm,Zb=(qm=(0,Yr.b2)(),Km=(0,Yr.f3)(xt.IRendererService),$m=(0,Yr.zY)(),qm(Qm=(md=function(){function e(){(0,dt.Z)(this,e),Nn(this,"rendererService",Jm,this),(0,S.Z)(this,"passes",[]),(0,S.Z)(this,"readFBO",void 0),(0,S.Z)(this,"writeFBO",void 0)}return(0,It.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var r=this.rendererService,n=r.getViewportSize,a=r.createTexture2D,s=n(),f=s.width,v=s.height;return a({x:0,y:0,width:f,height:v,copy:!0})}},{key:"getReadFBOTex",value:function(){var r=this,n=this.rendererService.useFramebuffer;return new Promise(function(a,s){n(r.readFBO,(0,U.Z)(q().mark(function f(){return q().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:a(r.getCurrentFBOTex());case 1:case"end":return m.stop()}},f)})))})}},{key:"renderBloomPass",value:function(){var i=(0,U.Z)(q().mark(function n(a,s){var f,v;return q().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,this.getReadFBOTex();case 2:f=x.sent,v=0;case 4:if(!(v<4)){x.next=11;break}return x.next=7,s.render(a,f);case 7:this.swap(),v++,x.next=4;break;case 11:case"end":return x.stop()}},n,this)}));function r(n,a){return i.apply(this,arguments)}return r}()},{key:"render",value:function(){var i=(0,U.Z)(q().mark(function n(a){var s,f;return q().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:s=0;case 1:if(!(s<this.passes.length)){m.next=15;break}if(f=this.passes[s],f.setRenderToScreen(this.isLastEnabledPass(s)),f.getName()!=="bloom"){m.next=9;break}return m.next=7,this.renderBloomPass(a,f);case 7:m.next=12;break;case 9:return m.next=11,f.render(a);case 11:s!==this.passes.length-1&&this.swap();case 12:s++,m.next=1;break;case 15:case"end":return m.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){this.readFBO.resize({width:r,height:n}),this.writeFBO.resize({width:r,height:n})}},{key:"add",value:function(r,n,a){r.init(n,a),this.passes.push(r)}},{key:"insert",value:function(r,n,a,s){r.init(a,s),this.passes.splice(n,0,r)}},{key:"getPostProcessingPassByName",value:function(r){return this.passes.find(function(n){return n.getName()===r})}},{key:"init",value:function(){var r=this.rendererService,n=r.createFramebuffer,a=r.createTexture2D;this.readFBO=n({color:a({width:1,height:1,wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE})}),this.writeFBO=n({color:a({width:1,height:1,wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(r){for(var n=r+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var r=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=r}}]),e}(),Jm=ni(md.prototype,"rendererService",[Km],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ni(md.prototype,"init",[$m],Object.getOwnPropertyDescriptor(md.prototype,"init"),md.prototype),md))||Qm),eg,tg;function Ub(e){var i=jb();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function jb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Vb=(eg=(0,Yr.b2)(),eg(tg=function(e){(0,Ir.Z)(r,e);var i=Ub(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"getType",value:function(){return il.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(a,s){Tl((0,_t.Z)(r.prototype),"init",this).call(this,a,s)}},{key:"render",value:function(a){var s=this.rendererService,f=s.useFramebuffer,v=s.clear,m=a.multiPassRenderer.getPostProcessor().getReadFBO();f(m,function(){v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:m}),a.multiPassRenderer.setRenderFlag(!1),a.models.forEach(function(x){x.draw({uniforms:a.layerModel.getUninforms()})}),a.multiPassRenderer.setRenderFlag(!0)})}}]),r}(kp))||tg),rg,ng,ig,k0,ag;function og(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function sg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?og(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):og(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Gb(e){var i=Hb();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function Hb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Wb=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,ug=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,Xb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function lg(e,i){for(var r=0,n=1/i,a=e;a>0;)r=r+n*(a%i),a=Math.floor(a/i),n=n/i;return r}var Yb=1,qb=(rg=(0,Yr.b2)(),ng=(0,Yr.f3)(xt.IShaderModuleService),rg(ig=(k0=function(e){(0,Ir.Z)(r,e);var i=Gb(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),Nn((0,J.Z)(n),"shaderModuleService",ag,(0,J.Z)(n)),(0,S.Z)((0,J.Z)(n),"haltonSequence",[]),(0,S.Z)((0,J.Z)(n),"accumulatingId",0),(0,S.Z)((0,J.Z)(n),"frame",0),(0,S.Z)((0,J.Z)(n),"timer",void 0),(0,S.Z)((0,J.Z)(n),"sampleRenderTarget",void 0),(0,S.Z)((0,J.Z)(n),"prevRenderTarget",void 0),(0,S.Z)((0,J.Z)(n),"outputRenderTarget",void 0),(0,S.Z)((0,J.Z)(n),"copyRenderTarget",void 0),(0,S.Z)((0,J.Z)(n),"blendModel",void 0),(0,S.Z)((0,J.Z)(n),"outputModel",void 0),(0,S.Z)((0,J.Z)(n),"copyModel",void 0),n}return(0,It.Z)(r,[{key:"getType",value:function(){return il.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(a,s){Tl((0,_t.Z)(r.prototype),"init",this).call(this,a,s);var f=this.rendererService,v=f.createFramebuffer,m=f.createTexture2D;this.sampleRenderTarget=v({color:m({width:1,height:1,wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE})}),this.prevRenderTarget=v({color:m({width:1,height:1,wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE})}),this.outputRenderTarget=v({color:m({width:1,height:1,wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE})}),this.copyRenderTarget=v({color:m({width:1,height:1,wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE})});for(var x=0;x<30;x++)this.haltonSequence.push([lg(x,2),lg(x,3)]);this.blendModel=this.createTriangleModel("blend-pass",Wb),this.outputModel=this.createTriangleModel("copy-pass",ug,{blend:{enable:!0,func:{srcRGB:k.ONE,dstRGB:k.ONE_MINUS_SRC_ALPHA,srcAlpha:k.ONE,dstAlpha:k.ONE_MINUS_SRC_ALPHA},equation:{rgb:k.FUNC_ADD,alpha:k.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",ug)}},{key:"render",value:function(a){var s=this,f=this.rendererService,v=f.clear,m=f.getViewportSize,x=f.useFramebuffer,A=m(),T=A.width,O=A.height;this.sampleRenderTarget.resize({width:T,height:O}),this.prevRenderTarget.resize({width:T,height:O}),this.outputRenderTarget.resize({width:T,height:O}),this.copyRenderTarget.resize({width:T,height:O}),this.resetFrame(),this.stopAccumulating();var F=a.multiPassRenderer.getPostProcessor().getReadFBO();x(F,function(){v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:F}),a.multiPassRenderer.setRenderFlag(!1),a.render(),a.multiPassRenderer.setRenderFlag(!0)});var j=function Y(ee){!s.accumulatingId||ee!==s.accumulatingId||s.isFinished()||(s.doRender(a),ca.requestAnimationFrame(function(){Y(ee)}))};this.accumulatingId=Yb++,this.timer=ca.setTimeout(function(){j(s.accumulatingId)},50)}},{key:"doRender",value:function(a){var s=this,f=this.rendererService,v=f.clear,m=f.getViewportSize,x=f.useFramebuffer,A=m(),T=A.width,O=A.height,F=a.getLayerConfig(),j=F.jitterScale,Y=j===void 0?1:j,ee=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((ee[0]*2-1)/T*Y,(ee[1]*2-1)/O*Y),a.multiPassRenderer.setRenderFlag(!1),a.hooks.beforeRender.call(),x(this.sampleRenderTarget,function(){v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:s.sampleRenderTarget}),a.render()}),a.hooks.afterRender.call(),a.multiPassRenderer.setRenderFlag(!0);var Ae=a.getLayerConfig();x(this.outputRenderTarget,function(){s.blendModel.draw({uniforms:{u_opacity:Ae.opacity||1,u_MixRatio:s.frame===0?1:.9,u_Diffuse1:s.sampleRenderTarget,u_Diffuse2:s.frame===0?a.multiPassRenderer.getPostProcessor().getReadFBO():s.prevRenderTarget}})}),this.frame===0&&v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(x(this.copyRenderTarget,function(){s.outputModel.draw({uniforms:{u_Texture:s.outputRenderTarget}})}),x(a.multiPassRenderer.getPostProcessor().getReadFBO(),function(){s.copyModel.draw({uniforms:{u_Texture:s.copyRenderTarget}})}),a.multiPassRenderer.getPostProcessor().render(a));var Fe=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=Fe,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,ca.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(a,s,f){this.shaderModuleService.registerModule(a,{vs:Xb,fs:s});var v=this.shaderModuleService.getModule(a),m=v.vs,x=v.fs,A=v.uniforms,T=this.rendererService,O=T.createAttribute,F=T.createBuffer,j=T.createModel;return j(sg({vs:m,fs:x,attributes:{a_Position:O({buffer:F({data:[-4,-4,4,-4,0,4],type:k.FLOAT}),size:2})},uniforms:sg({},A),depth:{enable:!1},count:3},f))}}]),r}(kp),ag=ni(k0.prototype,"shaderModuleService",[ng],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k0))||ig),ev=new Yr.W2;ev.bind(xt.IGlobalConfigService).to(va).inSingletonScope(),(0,Yr.GW)((0,Yr.b2)(),cs.EventEmitter),ev.bind(xt.IEventEmitter).to(cs.EventEmitter);var cg=(0,Mo.Z)(ev,!1),tv=function(i){var r=cg.lazyInject(i);return function(n,a,s){r.call(this,n,a),s&&(s.initializer=function(){return n[a]})}},hP=function(i){var r=cg.lazyMultiInject(i);return function(n,a,s){r.call(this,n,a),s&&(s.initializer=function(){return n[a]})}},rc=ev,Kb=0;function $b(){var e=new Yr.W2;return e.parent=ev,e.bind(xt.SceneID).toConstantValue("".concat(Kb++)),e.bind(xt.IShaderModuleService).to(Mv).inSingletonScope(),e.bind(xt.ILayerService).to(Hs).inSingletonScope(),e.bind(xt.ISceneService).to(C0).inSingletonScope(),e.bind(xt.ICameraService).to(si).inSingletonScope(),e.bind(xt.ICoordinateSystemService).to(ps).inSingletonScope(),e.bind(xt.IInteractionService).to(z).inSingletonScope(),e.bind(xt.IPickingService).to(Vi).inSingletonScope(),e.bind(xt.IControlService).to(oo).inSingletonScope(),e.bind(xt.IMarkerService).to(ts).inSingletonScope(),e.bind(xt.IIconService).to(jh).inSingletonScope(),e.bind(xt.IFontService).to(td).inSingletonScope(),e.bind(xt.IPopupService).to(So).inSingletonScope(),e.bind(xt.INormalPass).to(Hd).whenTargetNamed("clear"),e.bind(xt.INormalPass).to(M0).whenTargetNamed("pixelPicking"),e.bind(xt.INormalPass).to(Vb).whenTargetNamed("render"),e.bind(xt.INormalPass).to(qb).whenTargetNamed("taa"),e.bind(xt.IFactoryNormalPass).toFactory(function(i){return function(r){return i.container.getNamed(xt.INormalPass,r)}}),e.bind(xt.IPostProcessingPass).to(_b).whenTargetNamed("copy"),e.bind(xt.IPostProcessingPass).to(Jx).whenTargetNamed("bloom"),e.bind(xt.IPostProcessingPass).to(ib).whenTargetNamed("blurH"),e.bind(xt.IPostProcessingPass).to(lb).whenTargetNamed("blurV"),e.bind(xt.IPostProcessingPass).to(Lb).whenTargetNamed("noise"),e.bind(xt.IPostProcessingPass).to(zb).whenTargetNamed("sepia"),e.bind(xt.IPostProcessingPass).to(db).whenTargetNamed("colorHalftone"),e.bind(xt.IPostProcessingPass).to(Cb).whenTargetNamed("hexagonalPixelate"),e.bind(xt.IPostProcessingPass).to(Pb).whenTargetNamed("ink"),e.bind(xt.IFactoryPostProcessingPass).toFactory(function(i){return function(r){var n=i.container.getNamed(xt.IPostProcessingPass,r);return n.setName(r),n}}),e}function fg(e){var i=new Yr.W2;return i.parent=e,i.bind(xt.IStyleAttributeService).to(Ac).inSingletonScope(),i.bind(xt.IMultiPassRenderer).to(Kd).inSingletonScope(),i.bind(xt.IPostProcessor).to(Zb).inSingletonScope(),i}var pP=W(74691),Qb=null;function dP(e){return Qb.indexOf(e)}var Jb=2,vP=4,e2=64,mP=128,t2=256,r2=512,gP=8192,yP=16384,_P=32768,n2=null,hg=131072,xP=262144,i2=524288,bP=1048576,a2=2097152,EP=4194304,o2=8388608,s2=16777216,u2=null;function Fv(e,i){return e=_clamp(Math.floor(e),0,255),i=_clamp(Math.floor(i),0,255),256*e+i}function SP(e){var i=e.color,r=e.radius,n=e.tileX,a=e.tileY,s=e.shape,f=e.opacity,v=e.stroke,m=e.strokeWidth,x=e.strokeOpacity,A=[],T=[],O=[],F=[Fv(i[0],i[1]),Fv(i[2],i[3])],j=[Fv(v[0],v[1]),Fv(v[2],v[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(Y){var ee=_slicedToArray(Y,2),Ae=ee[0],Fe=ee[1];A.push([].concat(F,[(Ae+1)*o2+(Fe+1)*a2+getShapeIndex(s)*hg+r,(n+512)*i2+(a+512)*e2])),T.push([].concat(j,[m,x])),O.push([f,0,0,0])}),{packedBuffer:A,packedBuffer2:T,packedBuffer3:O}}function CP(e,i){if(e===0&&!i)return 0;if(e===1&&i)return 4294967295;var r=i?1:0,n=Math.floor(e*127);return n*u2+r*s2+n*hg+r*n2+n*r2+r*t2+n*Jb+r}var Ws;(function(e){e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none"})(Ws||(Ws={}));var lu;(function(e){e.LINEAR="linear",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat"})(lu||(lu={}));var ip;(function(e){e.CONSTANT="constant",e.VARIABLE="variable"})(ip||(ip={}));var Zn;(function(e){e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform"})(Zn||(Zn={}));var l2=["mapload","mapchange","mapAfterFrameChange"],Bp={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},L0=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],ap;(function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter"})(ap||(ap={}));function pg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function dg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?pg(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function c2(e){var i=f2();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function f2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var h2=0,Bv=function(e){(0,Ir.Z)(r,e);var i=c2(r);function r(n){var a;return(0,dt.Z)(this,r),a=i.call(this),(0,S.Z)((0,J.Z)(a),"controlOption",void 0),(0,S.Z)((0,J.Z)(a),"container",void 0),(0,S.Z)((0,J.Z)(a),"sceneContainer",void 0),(0,S.Z)((0,J.Z)(a),"mapsService",void 0),(0,S.Z)((0,J.Z)(a),"renderService",void 0),(0,S.Z)((0,J.Z)(a),"layerService",void 0),(0,S.Z)((0,J.Z)(a),"controlService",void 0),(0,S.Z)((0,J.Z)(a),"isShow",void 0),a.controlOption=dg(dg({},a.getDefault()),n||{}),a}return(0,It.Z)(r,[{key:"getDefault",value:function(){return{position:ap.TOPRIGHT,name:"".concat(h2++)}}},{key:"setPosition",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ap.BOTTOMRIGHT,s=this.controlService;return s&&s.removeControl(this),this.controlOption.position=a,s&&s.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(a){this.mapsService=a.get(xt.IMapService),this.renderService=a.get(xt.IRendererService),this.layerService=a.get(xt.ILayerService),this.controlService=a.get(xt.IControlService),this.sceneContainer=a,this.isShow=!0,this.container=this.onAdd();var s=this.container,f=this.controlOption.position,v=this.controlService.controlCorners[f];return Zl(s,"l7-control"),f.indexOf("bottom")!==-1?v.insertBefore(s,v.firstChild):v.appendChild(s),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var a=this.container;Zl(a,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var a=this.container;Qu(a,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;fc(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(a){if(this.mapsService&&a&&a.screenX>0&&a.screenY>0){var s=this.mapsService.getContainer();s!==null&&s.focus()}}}]),r}(cs.EventEmitter);function p2(e){var i=d2();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function d2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var AP=function(e){(0,Ir.Z)(r,e);var i=p2(r);function r(n){var a;return(0,dt.Z)(this,r),a=i.call(this,n),(0,S.Z)((0,J.Z)(a),"layerControlInputs",void 0),(0,S.Z)((0,J.Z)(a),"layers",void 0),(0,S.Z)((0,J.Z)(a),"lastZIndex",void 0),(0,S.Z)((0,J.Z)(a),"handlingClick",void 0),(0,S.Z)((0,J.Z)(a),"layersLink",void 0),(0,S.Z)((0,J.Z)(a),"baseLayersList",void 0),(0,S.Z)((0,J.Z)(a),"separator",void 0),(0,S.Z)((0,J.Z)(a),"overlaysList",void 0),(0,S.Z)((0,J.Z)(a),"form",void 0),a.layerControlInputs=[],a.layers=[],a.lastZIndex=0,a.handlingClick=!1,a.initLayers(),vl(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,J.Z)(a)),a}return(0,It.Z)(r,[{key:"getDefault",value:function(){return{collapsed:!0,position:ap.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var a=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(s){s.layer.on("remove",a.onLayerChange),s.layer.on("add",a.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(a,s){return this.addLayer(a,s,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var a=this.renderService.getViewportSize(),s=a.height;Zl(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var f=s-(this.container.offsetTop+50);return f<this.form.clientHeight?(Zl(this.form,"l7-control-layers-scrollbar"),this.form.style.height=f+"px"):Qu(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return Qu(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var a=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(s){s.layer.off("remove",a.onLayerChange),s.layer.off("add",a.onLayerChange)}))}},{key:"initLayout",value:function(){var a="l7-control-layers",s=this.container=Ua("div",a),f=this.controlOption.collapsed;s.setAttribute("aria-haspopup","true");var v=this.form=Ua("form",a+"-list");f&&(this.mapsService.on("click",this.collapse),s.addEventListener("mouseenter",this.expand),s.addEventListener("mouseleave",this.collapse)),this.layersLink=Ua("a",a+"-toggle",s);var m=this.layersLink;m.title="Layers",f||this.expand(),this.baseLayersList=Ua("div",a+"-base",v),this.separator=Ua("div",a+"-separator",v),this.overlaysList=Ua("div",a+"-overlays",v),s.appendChild(v)}},{key:"initLayers",value:function(){var a=this,s=this.controlOption,f=s.baseLayers,v=f===void 0?{}:f,m=s.overlayers,x=m===void 0?{}:m;Object.keys(v).forEach(function(A,T){a.addLayer(v[A],A,!1)}),Object.keys(x).forEach(function(A,T){a.addLayer(x[A],A,!0)})}},{key:"update",value:function(){if(!this.container)return this;Ul(this.baseLayersList),Ul(this.overlaysList),this.layerControlInputs=[];var a,s,f,v,m=0;for(f=0;f<this.layers.length;f++)v=this.layers[f],this.addItem(v),s=s||v.overlay,a=a||!v.overlay,m+=v.overlay?0:1;return this.controlOption.hideSingleBase&&(a=a&&m>1,this.baseLayersList.style.display=a?"":"none"),this.separator.style.display=s&&a?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var a=this.layerControlInputs,s,f,v=this.mapsService.getZoom(),m=a.length-1;m>=0;m--)if(s=a[m],f=this.layerService.getLayer(s.layerId),f&&f.inited){var x=f.getMinZoom(),A=f.getMaxZoom();s.disabled=v<x||v>A}}},{key:"addLayer",value:function(a,s,f){this.mapsService&&(a.on("add",this.onLayerChange),a.on("remove",this.onLayerChange)),this.layers.push({layer:a,name:s,overlay:f});var v=this.controlOption,m=v.sortLayers,x=v.sortFunction,A=v.autoZIndex;m&&this.layers.sort(function(T,O){return x(T.layer,O.layer,T.name,O.name)}),A&&a.setZIndex&&(this.lastZIndex++,a.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(a){this.handlingClick||this.update();var s=this.layerService.getLayer(a.target.layerId),f=s!=null&&s.overlay?a.type==="add"?"overlayadd":"overlayremove":a.type==="add"?"baselayerchange":null;f&&this.emit(f,s)}},{key:"createRadioElement",value:function(a,s){var f='<input type="radio" class="l7-control-layers-selector" name="'+a+'"'+(s?' checked="checked"':"")+"/>",v=document.createElement("div");return v.innerHTML=f,v.firstChild}},{key:"addItem",value:function(a){var s=document.createElement("label"),f=this.layerService.getLayer(a.layer.id),v=f&&f.inited&&a.layer.isVisible(),m;a.overlay?(m=document.createElement("input"),m.type="checkbox",m.className="l7-control-layers-selector",m.defaultChecked=v):m=this.createRadioElement("l7-base-layers",v),this.layerControlInputs.push(m),m.layerId=a.layer.id,m.addEventListener("click",this.onInputClick);var x=document.createElement("span");x.innerHTML=" "+a.name;var A=document.createElement("div");s.appendChild(A),A.appendChild(m),A.appendChild(x);var T=a.overlay?this.overlaysList:this.baseLayersList;return T.appendChild(s),this.checkDisabledLayers(),s}},{key:"onInputClick",value:function(){var a=this.layerControlInputs,s,f,v=[],m=[];this.handlingClick=!0;for(var x=a.length-1;x>=0;x--)s=a[x],f=this.layerService.getLayer(s.layerId),s.checked?v.push(f):s.checked||m.push(f);m.forEach(function(A){A.hide()}),v.forEach(function(A){A.show()}),this.handlingClick=!1}}]),r}(Bv);function v2(e){var i=m2();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function m2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var g2=function(e){(0,Ir.Z)(r,e);var i=v2(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"getDefault",value:function(){return{position:ap.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var a="l7-control-logo",s=Ua("div",a),f=Ua("a","l7-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://antv.alipay.com/l7",f.setAttribute("aria-label","AntV logo"),f.setAttribute("rel","noopener nofollow"),s.appendChild(f),s}},{key:"onRemove",value:function(){return null}}]),r}(Bv);function y2(e){var i=_2();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function _2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wP=function(e){(0,Ir.Z)(r,e);var i=y2(r);function r(n){var a;return(0,dt.Z)(this,r),a=i.call(this,n),(0,S.Z)((0,J.Z)(a),"mScale",void 0),(0,S.Z)((0,J.Z)(a),"iScale",void 0),vl(["update"],(0,J.Z)(a)),a}return(0,It.Z)(r,[{key:"getDefault",value:function(){return{position:ap.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var a="l7-control-scale",s=Ua("div",a);this.addScales(a+"-line",s);var f=this.controlOption.updateWhenIdle;return this.mapsService.on(f?"moveend":"mapmove",this.update),this.mapsService.on(f?"zoomend":"zoomchange",this.update),this.update(),s}},{key:"onRemove",value:function(){var a=this.controlOption.updateWhenIdle;this.mapsService.off(a?"zoomend":"zoomchange",this.update),this.mapsService.off(a?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var a=this.mapsService,s=this.controlOption.maxWidth,f=a.getSize()[1]/2,v=a.containerToLngLat([0,f]),m=a.containerToLngLat([s,f]),x=ws([v.lng,v.lat],[m.lng,m.lat]);this.updateScales(x)}},{key:"updateScales",value:function(a){var s=this.controlOption,f=s.metric,v=s.imperial;f&&a&&this.updateMetric(a),v&&a&&this.updateImperial(a)}},{key:"updateMetric",value:function(a){var s=this.getRoundNum(a),f=s<1e3?s+" m":s/1e3+" km";this.updateScale(this.mScale,f,s/a)}},{key:"updateImperial",value:function(a){var s=a*3.2808399,f,v,m;s>5280?(f=s/5280,v=this.getRoundNum(f),this.updateScale(this.iScale,v+" mi",v/f)):(m=this.getRoundNum(s),this.updateScale(this.iScale,m+" ft",m/s))}},{key:"updateScale",value:function(a,s,f){var v=this.controlOption.maxWidth;a.style.width=Math.round(v*f)+"px",a.innerHTML=s}},{key:"getRoundNum",value:function(a){var s=Math.pow(10,(Math.floor(a)+"").length-1),f=a/s;return f=f>=10?10:f>=5?5:f>=3?3:f>=2?2:1,s*f}},{key:"addScales",value:function(a,s){var f=this.controlOption,v=f.metric,m=f.imperial;v&&(this.mScale=Ua("div",a,s)),m&&(this.iScale=Ua("div",a,s))}}]),r}(Bv);function x2(e){var i=b2();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function b2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var TP=function(e){(0,Ir.Z)(r,e);var i=x2(r);function r(n){var a;return(0,dt.Z)(this,r),a=i.call(this,n),(0,S.Z)((0,J.Z)(a),"disabled",void 0),(0,S.Z)((0,J.Z)(a),"zoomInButton",void 0),(0,S.Z)((0,J.Z)(a),"zoomOutButton",void 0),vl(["updateDisabled","zoomIn","zoomOut"],(0,J.Z)(a)),a}return(0,It.Z)(r,[{key:"getDefault",value:function(){return{position:ap.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var a="l7-control-zoom",s=Ua("div",a+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,a+"-in",s,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,a+"-out",s,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),s}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(a,s,f,v,m){var x=Ua("a",f,v);return x.innerHTML=a,x.title=s,x.href="javascript:void(0)",x.addEventListener("click",m),x}},{key:"updateDisabled",value:function(){var a=this.mapsService,s="l7-disabled";Qu(this.zoomInButton,s),Qu(this.zoomOutButton,s),(this.disabled||a.getZoom()<=a.getMinZoom())&&Zl(this.zoomOutButton,s),(this.disabled||a.getZoom()>=a.getMaxZoom())&&Zl(this.zoomInButton,s)}}]),r}(Bv);function vg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function mg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?vg(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):vg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function E2(e){var i=S2();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function S2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gg=function(e){(0,Ir.Z)(r,e);var i=E2(r);function r(n){var a;return(0,dt.Z)(this,r),a=i.call(this),(0,S.Z)((0,J.Z)(a),"markerOption",void 0),(0,S.Z)((0,J.Z)(a),"defaultMarker",void 0),(0,S.Z)((0,J.Z)(a),"popup",void 0),(0,S.Z)((0,J.Z)(a),"mapsService",void 0),(0,S.Z)((0,J.Z)(a),"sceneSerive",void 0),(0,S.Z)((0,J.Z)(a),"lngLat",void 0),(0,S.Z)((0,J.Z)(a),"scene",void 0),(0,S.Z)((0,J.Z)(a),"added",!1),(0,S.Z)((0,J.Z)(a),"eventHandle",function(s){a.emit(s.type,{target:s,data:a.markerOption.extData,lngLat:a.lngLat})}),a.markerOption=mg(mg({},a.getDefault()),n),vl(["update","onMove","onUp","addDragHandler","onMapClick"],(0,J.Z)(a)),a.init(),a}return(0,It.Z)(r,[{key:"getDefault",value:function(){return{element:void 0,anchor:Fu.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(a){this.scene=a,this.mapsService=a.get(xt.IMapService),this.sceneSerive=a.get(xt.ISceneService);var s=this.markerOption,f=s.element,v=s.draggable;return this.mapsService.getMarkerContainer().appendChild(f),this.registerMarkerEvent(f),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var a=this.markerOption.element;return a&&fc(a),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(a){return this.lngLat=a,Array.isArray(a)&&(this.lngLat={lng:a[0],lat:a[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(a){var s=this;if(!this.added)return this.once("added",function(){s.setElement(a)}),this;var f=this.markerOption.element;return f&&fc(f),this.markerOption.element=a,this.init(),this.mapsService.getMarkerContainer().appendChild(a),this.registerMarkerEvent(a),this.update(),this}},{key:"openPopup",value:function(){var a=this;if(!this.added)return this.once("added",function(){a.openPopup()}),this;var s=this.popup;return s?(s.isOpen()||s.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var a=this;this.added||this.once("added",function(){a.closePopup()});var s=this.popup;return s&&s.remove(),this}},{key:"setPopup",value:function(a){return this.popup=a,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var a=this.popup;if(a)a.isOpen()?a.remove():a.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(a){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(a){this.markerOption.extData=a}},{key:"update",value:function(){if(!!this.mapsService){var a=this.markerOption,s=a.element,f=a.anchor;this.updatePosition(),go(s,"".concat(el[f]))}}},{key:"onMapClick",value:function(a){var s=this.markerOption.element;this.popup&&s&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var a=this.markerOption,s=a.element,f=a.offsets,v=this.lngLat,m=v.lng,x=v.lat,A=this.mapsService.getBounds(),T=this.mapsService.lngLatToContainer([m,x]);if(s){s.style.display="block",s.style.whiteSpace="nowrap";var O=this.mapsService.getContainer(),F=0,j=0;if(O&&(F=O.scrollWidth,j=O.scrollHeight),Math.abs(A[0][0])>180||Math.abs(A[1][0])>180){if(T.x>F){var Y=this.mapsService.lngLatToContainer([m-360,x]);T.x=Y.x}if(T.x<0){var ee=this.mapsService.lngLatToContainer([m+360,x]);T.x=ee.x}}(T.x>F||T.x<0||T.y>j||T.y<0)&&(s.style.display="none"),s.style.left=T.x+f[0]+"px",s.style.top=T.y-f[1]+"px"}}}},{key:"init",value:function(){var a=this,s=this.markerOption.element,f=this.markerOption,v=f.color,m=f.anchor;if(!s){this.defaultMarker=!0,s=Ua("div"),this.markerOption.element=s;var x=document.createElementNS("http://www.w3.org/2000/svg","svg");x.setAttributeNS(null,"display","block"),x.setAttributeNS(null,"height","48px"),x.setAttributeNS(null,"width","48px"),x.setAttributeNS(null,"viewBox","0 0 1024 1024");var A=document.createElementNS("http://www.w3.org/2000/svg","path");A.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),A.setAttributeNS(null,"fill",v),x.appendChild(A),s.appendChild(x)}Zl(s,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(T){var O,F,j=((O=a.markerOption)===null||O===void 0?void 0:O.style)&&((F=a.markerOption)===null||F===void 0?void 0:F.style[T]);s&&(s.style[T]=j)}),s.addEventListener("click",function(T){a.onMapClick(T)}),s.addEventListener("click",this.eventHandle),Xc(s,m,"marker")}},{key:"registerMarkerEvent",value:function(a){a.addEventListener("mousemove",this.eventHandle),a.addEventListener("click",this.eventHandle),a.addEventListener("mousedown",this.eventHandle),a.addEventListener("mouseup",this.eventHandle),a.addEventListener("dblclick",this.eventHandle),a.addEventListener("contextmenu",this.eventHandle),a.addEventListener("mouseover",this.eventHandle),a.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var a=this.getElement();a.removeEventListener("mousemove",this.eventHandle),a.removeEventListener("click",this.eventHandle),a.removeEventListener("mousedown",this.eventHandle),a.removeEventListener("mouseup",this.eventHandle),a.removeEventListener("dblclick",this.eventHandle),a.removeEventListener("contextmenu",this.eventHandle),a.removeEventListener("mouseover",this.eventHandle),a.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(a){throw new Error("Method not implemented.")}},{key:"onUp",value:function(a){throw new Error("Method not implemented.")}}]),r}(cs.EventEmitter);function yg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function _g(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?yg(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function C2(e){var i=A2();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function A2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var MP=function(e){(0,Ir.Z)(r,e);var i=C2(r);function r(n){var a,s;return(0,dt.Z)(this,r),s=i.call(this),(0,S.Z)((0,J.Z)(s),"markers",[]),(0,S.Z)((0,J.Z)(s),"markerLayerOption",void 0),(0,S.Z)((0,J.Z)(s),"clusterIndex",void 0),(0,S.Z)((0,J.Z)(s),"points",[]),(0,S.Z)((0,J.Z)(s),"clusterMarkers",[]),(0,S.Z)((0,J.Z)(s),"mapsService",void 0),(0,S.Z)((0,J.Z)(s),"scene",void 0),(0,S.Z)((0,J.Z)(s),"zoom",void 0),(0,S.Z)((0,J.Z)(s),"bbox",void 0),s.markerLayerOption=Io()(s.getDefault(),n),vl(["update"],(0,J.Z)(s)),s.zoom=((a=s.markerLayerOption.clusterOption)===null||a===void 0?void 0:a.zoom)||-99,s}return(0,It.Z)(r,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(a){return this.scene=a,this.mapsService=a.get(xt.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(a){var s=this.markerLayerOption.cluster;if(s&&(this.addPoint(a,this.markers.length),this.mapsService)){var f=this.mapsService.getZoom(),v=this.mapsService.getBounds();this.bbox=Ln(v,.5),this.zoom=Math.floor(f),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(a)}},{key:"removeMarker",value:function(a){this.markers.indexOf(a);var s=this.markers.indexOf(a);s>-1&&this.markers.splice(s,1)}},{key:"hide",value:function(){this.markers.map(function(a){a.getElement().style.opacity="0"}),this.clusterMarkers.map(function(a){a.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(a){a.getElement().style.opacity="1"}),this.clusterMarkers.map(function(a){a.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var a=this.markerLayerOption.cluster;return a?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var a=this;this.getMarkers().forEach(function(s){s.addTo(a.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(a){a.remove()}),this.clusterMarkers.forEach(function(a){a.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(a,s){var f=a.getLnglat(),v=f.lng,m=f.lat,x={geometry:{type:"Point",coordinates:[v,m]},properties:_g(_g({},a.getExtData()),{},{marker_id:s})};this.points.push(x),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var a=this.markerLayerOption.clusterOption,s=a.radius,f=a.minZoom,v=f===void 0?0:f,m=a.maxZoom;this.clusterIndex=new(_l())({radius:s,minZoom:v,maxZoom:m}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(a,s){var f=this,v=a[0].concat(a[1]),m=this.clusterIndex.getClusters(v,s);this.clusterMarkers.forEach(function(x){x.remove()}),this.clusterMarkers=[],m.forEach(function(x){var A,T=f.markerLayerOption.clusterOption,O=T.field,F=T.method;if(x.properties&&(A=x.properties)!==null&&A!==void 0&&A.cluster_id){var j,Y=f.getLeaves((j=x.properties)===null||j===void 0?void 0:j.cluster_id);if(x.properties.clusterData=Y,O&&F){var ee=Y==null?void 0:Y.map(function(Et){var wt=(0,S.Z)({},O,Et.properties[O]);return wt}),Ae=Gl(ee,O),Fe=Qf(F,Ae),Xe="point_"+F;x.properties[Xe]=Fe.toFixed(2)}}var nt=f.clusterMarker(x);f.clusterMarkers.push(nt),nt.addTo(f.scene)})}},{key:"getLeaves",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return a?this.clusterIndex.getLeaves(a,s,f):null}},{key:"clusterMarker",value:function(a){var s=this.markerLayerOption.clusterOption,f=s,v=f.element,m=v===void 0?this.generateElement.bind(this):v,x=new gg({element:m(a)}).setLnglat({lng:a.geometry.coordinates[0],lat:a.geometry.coordinates[1]});return x}},{key:"normalMarker",value:function(a){var s=a.properties.marker_id;return this.markers[s]}},{key:"update",value:function(){if(!!this.mapsService){var a=this.mapsService.getZoom(),s=this.mapsService.getBounds();(!this.bbox||Math.abs(a-this.zoom)>=1||!wn(this.bbox,s))&&(this.bbox=Ln(s,.5),this.zoom=Math.floor(a),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(a){var s=Ua("div","l7-marker-cluster"),f=Ua("div","",s),v=Ua("span","",f),m=this.markerLayerOption.clusterOption,x=m.field,A=m.method;a.properties.point_count=a.properties.point_count||1;var T=x&&A?a.properties["point_"+A]||a.properties[x]:a.properties.point_count;return v.textContent=T,s}}]),r}(cs.EventEmitter);function xg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function bg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?xg(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function w2(e){var i=T2();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function T2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Eg=function(e){(0,Ir.Z)(r,e);var i=w2(r);function r(n){var a;return(0,dt.Z)(this,r),a=i.call(this),(0,S.Z)((0,J.Z)(a),"popupOption",void 0),(0,S.Z)((0,J.Z)(a),"mapsService",void 0),(0,S.Z)((0,J.Z)(a),"sceneSerive",void 0),(0,S.Z)((0,J.Z)(a),"lngLat",void 0),(0,S.Z)((0,J.Z)(a),"content",void 0),(0,S.Z)((0,J.Z)(a),"closeButton",void 0),(0,S.Z)((0,J.Z)(a),"timeoutInstance",void 0),(0,S.Z)((0,J.Z)(a),"container",void 0),(0,S.Z)((0,J.Z)(a),"tip",void 0),(0,S.Z)((0,J.Z)(a),"scene",void 0),a.popupOption=bg(bg({},a.getdefault()),n),vl(["update","onClickClose","remove"],(0,J.Z)(a)),a}return(0,It.Z)(r,[{key:"addTo",value:function(a){var s=this;return this.mapsService=a.get(xt.IMapService),this.sceneSerive=a.get(xt.ISceneService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=a,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){s.mapsService.on("click",s.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(a){var s=window.document.createDocumentFragment(),f=window.document.createElement("body"),v;for(f.innerHTML=a;v=f.firstChild,!!v;)s.appendChild(v);return this.setDOMContent(s)}},{key:"setLnglat",value:function(a){return this.lngLat=a,Array.isArray(a)&&(this.lngLat={lng:a[0],lat:a[1]}),this.mapsService&&(this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(a){return this.setDOMContent(window.document.createTextNode(a))}},{key:"setMaxWidth",value:function(a){return this.popupOption.maxWidth=a,this.update(),this}},{key:"setDOMContent",value:function(a){return this.createContent(),this.content.appendChild(a),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&fc(this.content),this.content=Ua("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=Ua("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(a,s,f){var v=window.document.createElement(a);return s!==void 0&&(v.className=s),f&&f.appendChild(v),v}},{key:"removeDom",value:function(a){a.parentNode&&a.parentNode.removeChild(a)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:Fu.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(a){a.stopPropagation&&a.stopPropagation(),this.remove()}},{key:"update",value:function(){var a=this,s=this.lngLat,f=this.popupOption,v=f.className,m=f.maxWidth,x=f.anchor;if(!(!this.mapsService||!s||!this.content)){var A=this.mapsService.getMarkerContainer();if(!this.container&&A){this.container=this.creatDom("div","l7-popup",A),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),v&&v.split(" ").forEach(function(O){return a.container.classList.add(O)});var T=this.popupOption.stopPropagation;T&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(O){a.container.addEventListener(O,function(F){F.stopPropagation()})}),this.container.style.whiteSpace="nowrap"}m&&this.container.style.maxWidth!==m&&(this.container.style.maxWidth=m),this.updatePosition(),go(this.container,"".concat(el[x])),Xc(this.container,x,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var a=this.lngLat,s=a.lng,f=a.lat,v=this.popupOption.offsets,m=this.mapsService.lngLatToContainer([s,f]);this.container.style.left=m.x+v[0]+"px",this.container.style.top=m.y-v[1]+"px"}}}]),r}(cs.EventEmitter);function M2(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var f=i.createElement("style");return f.type="text/css",f.styleSheet?f.styleSheet.cssText=e:f.appendChild(i.createTextNode(e)),a.appendChild(f),f}}M2(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
}

.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 5px;
}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}

.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-left: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-bottom: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-bottom: none;
  border-left: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-bottom: none;
  border-right: none;
  border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-left: none;
  border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  padding: 0;
  font-size: 25px;
  line-height: 20px;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
  display: none;
}

.l7-popup-track-pointer * {
  pointer-events: none;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}

.l7-map:active .l7-popup-track-pointer {
  display: none;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
  border-radius: 4px;
}
.l7-bar a,
.l7-bar a:hover {
  background-color: #fff;
  width: 30px;
  height: 30px;
  font-size: 20px;
  display: block;
  text-align: center;
  text-decoration: none;
  color: #8e9dab;
}
.l7-bar a,
.l7-control-layers-toggle {
  background-position: 50% 50%;
  background-repeat: no-repeat;
  display: block;
}
.l7-bar a:hover {
  background-color: #f4f4f4;
}
.l7-bar a:first-child {
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}
.l7-bar a:last-child {
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 2px;
  border-bottom: none;
}
.l7-bar a.l7-disabled {
  cursor: default;
  background-color: #f4f4f4;
  color: #bbb;
}

/* control positioning */

.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-hide {
  display: none;
}
.l7-control {
  position: relative;
  z-index: 800;
  pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control {
  float: left;
  clear: both;
}
.l7-top,
.l7-bottom {
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-top {
  top: 0;
}
.l7-right {
  right: 0;
}
.l7-bottom {
  bottom: 0;
}
.l7-left {
  left: 0;
}
.l7-center {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-bottom.l7-center,
.l7-top.l7-center {
  width: 100%;
}
.l7-right.l7-center,
.l7-left.l7-center {
  height: 100%;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-top.l7-center,
.l7-left.l7-center {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}

.l7-bottom.l7-center,
.l7-right.l7-center {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}

.l7-center .l7-control {
  margin-right: 10px;
  margin-bottom: 10px;
}

.l7-control {
  float: left;
  clear: both;
}
.l7-right .l7-control {
  float: right;
}
.l7-top .l7-control {
  margin-top: 10px;
}
.l7-bottom .l7-control {
  margin-bottom: 10px;
}
.l7-left .l7-control {
  margin-left: 10px;
}
.l7-right .l7-control {
  margin-right: 10px;
}

/* attribution and scale controls */

.l7-control-container .l7-control-attribution {
  background: #fff;
  background: rgba(59, 58, 58, 0.7);
  margin: 0;
}
.l7-control-attribution,
.l7-control-scale-line {
  padding: 0 5px;
  color: #333;
}
.l7-control-attribution a {
  text-decoration: none;
}
.l7-control-attribution a:hover {
  text-decoration: underline;
}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
}
.l7-left .l7-control-scale {
  margin-left: 5px;
}
.l7-bottom .l7-control-scale {
  margin-bottom: 5px;
}
.l7-control-scale-line {
  border: 2px solid #000;
  border-top: none;
  color: #000;
  line-height: 1.1;
  padding: 2px 5px 1px;
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;

  background: #fff;
}
.l7-control-scale-line:not(:first-child) {
  border-top: 2px solid #777;
  border-bottom: none;
  margin-top: -2px;
}
.l7-control-scale-line:not(:first-child):not(:last-child) {
  border-bottom: 2px solid #777;
}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  border: 2px solid rgba(0, 0, 0, 0.2);
  background-clip: padding-box;
}
/*logo */

.l7-ctrl-logo {
  background-size: 100% 100%;
  width: 89px;
  height: 16px;
  margin: 0 0 -3px -3px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  background-repeat: no-repeat;
  cursor: pointer;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 2px;
}
.l7-control-layers-toggle {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
  width: 30px;
  height: 30px;
  background-size: 20px 20px;
}

.l7-touch .l7-control-layers-toggle {
  width: 44px;
  height: 44px;
}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
  display: none;
}
.l7-control-layers-expanded .l7-control-layers-list {
  display: block;
  position: relative;
}
.l7-control-layers-expanded {
  padding: 6px 10px 6px 6px;
  color: #59626b;
  background: #fff;
}
.l7-control-layers-scrollbar {
  overflow-y: scroll;
  overflow-x: hidden;
  padding-right: 5px;
}
.l7-control-layers-selector {
  margin-top: 2px;
  position: relative;
  top: 1px;
}
.l7-control-layers label {
  display: block;
  padding: 8px;
}
.l7-control-layers label input[type='radio'],
.l7-control-layers label input[type='checkbox'] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
  height: 0;
  border-top: 1px solid #d8d8d8;
  margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
}
.amap-logo {
  display: none !important;
}
`);var P2=W(52353),Sg=W.n(P2),I2=W(13218),to=W.n(I2),op,Cg=(op={},(0,S.Z)(op,Ws.additive,{enable:!0,func:{srcRGB:k.ONE,dstRGB:k.ONE,srcAlpha:1,dstAlpha:1}}),(0,S.Z)(op,Ws.none,{enable:!1}),(0,S.Z)(op,Ws.normal,{enable:!0,func:{srcRGB:k.SRC_ALPHA,dstRGB:k.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,S.Z)(op,Ws.subtractive,{enable:!0,func:{srcRGB:k.ONE,dstRGB:k.ONE,srcAlpha:k.ZERO,dstAlpha:k.ONE_MINUS_SRC_COLOR},equation:{rgb:k.FUNC_SUBTRACT,alpha:k.FUNC_SUBTRACT}}),(0,S.Z)(op,Ws.max,{enable:!0,func:{srcRGB:k.ONE,dstRGB:k.ONE},equation:{rgb:k.MAX_EXT}}),(0,S.Z)(op,Ws.min,{enable:!0,func:{srcRGB:k.ONE,dstRGB:k.ONE},equation:{rgb:k.MIN_EXT}}),op),O2=W(81763),ki=W.n(O2),PP=1024;function al(e,i,r,n,a){i.updateStyleAttribute(e,r,n,a)}function R2(e,i){e.opacity&&Nv("opacity",i,e.opacity),e.strokeWidth&&Nv("strokeWidth",i,e.strokeWidth),e.strokeOpacity&&Nv("strokeOpacity",i,e.strokeOpacity),e.stroke&&k2("stroke",i,e.stroke),e.offsets&&Ag("offsets",i,e.offsets),e.textOffset&&Ag("textOffset",i,e.textOffset),e.thetaOffset&&Nv("thetaOffset",i,e.thetaOffset)}function Nv(e,i,r){w()(r)?al(e,i,r,function(n){return n}):ki()(r)?al(e,i,[r],void 0):Array.isArray(r)&&r.length===2?w()(r[0])&&L()(r[1])||w()(r[0])&&Array.isArray(r[1])&&ki()(r[1][0])&&ki()(r[1][1])?al(e,i,r[0],r[1]):al(e,i,[1],void 0):al(e,i,[1],void 0)}function Ag(e,i,r){w()(r)?al(e,i,r,function(n){return n}):Array.isArray(r)&&r.length===2&&w()(r[0])&&L()(r[1])?al(e,i,r[0],r[1]):Array.isArray(r)&&r.length===2&&ki()(r[0])&&ki()(r[1])?al(e,i,r,void 0):al(e,i,[0,0],void 0)}function k2(e,i,r){w()(r)?al(e,i,r,void 0):Array.isArray(r)&&r.length===2&&(w()(r[0])&&L()(r[1])||w()(r[0])&&Array.isArray(r[1])&&r[1].length>0)?al(e,i,r[0],r[1]):al(e,i,"#fff",void 0)}var ks;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL"})(ks||(ks={}));function L2(e,i){var r=[i[0]-e[0],i[1]-e[1]],n=Qo(r),a=[e[0]+n[0]*1e-4,e[1]+n[1]*1e-4];return a}function D2(e,i){var r=this;e.length>0&&i.version===ks["GAODE2.x"]&&(typeof e[0].coordinates[0]=="number"?e.filter(function(n){return!n.originCoordinates}).map(function(n){n.version=ks["GAODE2.x"],n.originCoordinates=cloneDeep(n.coordinates),n.coordinates=r.mapService.lngLatToCoord(n.coordinates)}):e.filter(function(n){return!n.originCoordinates}).map(function(n){n.version=ks["GAODE2.x"],n.originCoordinates=cloneDeep(n.coordinates),n.coordinates=r.mapService.lngLatToCoords(n.coordinates)}))}function F2(e,i){e.length>0&&i.version===ks.SIMPLE&&e.map(function(r){r.simpleCoordinate||(r.coordinates=B2(r.coordinates,i),r.simpleCoordinate=!0)})}function B2(e,i){if(typeof e[0]=="number")return i.simpleMapCoord.unproject(e);if(e[0]&&e[0][0]instanceof Array){var r=[];return e.map(function(a){var s=[];a.map(function(f){s.push(i.simpleMapCoord.unproject(f))}),r.push(s)}),r}else{var n=[];return e.map(function(a){n.push(i.simpleMapCoord.unproject(a))}),n}}function N2(e,i,r){var n;if(!e.scale)return[];var a=(e==null||(n=e.scale)===null||n===void 0?void 0:n.scalers)||[],s=[];a.forEach(function(v){var m,x=v.field;(i.hasOwnProperty(x)||((m=e.scale)===null||m===void 0?void 0:m.type)==="variable")&&s.push(i[x])});var f=e.mapping?e.mapping(s):[];return e.name==="color"&&!yu(f[0])?[r]:f}function z2(e,i,r,n,a,s){var f=s==null?void 0:s.getLayerConfig(),v=f.arrow,m=v===void 0?{enable:!1}:v,x=i.map(function(A){var T={id:A._id,coordinates:A.coordinates};if(e.filter(function(j){return j.scale!==void 0}).forEach(function(j){var Y=N2(j,A,a);j.needRemapping=!1,j.name==="color"&&(Y=Y.map(function(ee){return pi(ee)})),T[j.name]=Array.isArray(Y)&&Y.length===1?Y[0]:Y,j.name==="shape"&&(T.shape=r.getIconFontKey(T[j.name]))}),T.shape==="line"&&m.enable){var O=T.coordinates,F=L2(O[0],O[1]);T.coordinates.splice(1,0,F,F)}return T});return D2(x,n),F2(x,n),x}function Z2(e,i,r,n,a,s){var f=new Fh(a,s),v=e.getBottomColor(),m=n.getLayerStyleAttributes()||[],x=f.data.dataArray,A=x,T=z2(m,A,i,r,v,e);return f.destroy(),T}function wg(e){return e.map(function(i){return typeof i=="string"&&(i=[i,{}]),i})}function U2(e,i,r,n){var a=e.multiPassRenderer,s=e.getLayerConfig(),f=s.enablePicking,v=s.enableTAA;return v?a.add(n("taa")):a.add(n("render")),wg(i).forEach(function(m){var x=(0,mn.Z)(m,2),A=x[0],T=x[1];a.add(r(A),T)}),a.add(r("copy")),a}var j2=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]];function V2(e,i,r){if(typeof i=="string"&&typeof r=="string"&&i!==r){if(e.type==="PointLayer"){e.dataState.dataSourceNeedUpdate=!0;return}j2.map(function(n){if(n.includes(i)&&n.includes(r)){e.dataState.dataSourceNeedUpdate=!0;return}})}}var G2=["passes"],H2=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber"],Tg,D0,Mg;function W2(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=X2(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function X2(e,i){if(!!e){if(typeof e=="string")return Pg(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Pg(e,i)}}function Pg(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Ig(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Wu(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Ig(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ig(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Y2(e){var i=q2();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function q2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Og=0,K2=(Tg=tv(xt.IGlobalConfigService),D0=function(e){(0,Ir.Z)(r,e);var i=Y2(r);function r(){var n,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,dt.Z)(this,r),n=i.call(this),(0,S.Z)((0,J.Z)(n),"id","".concat(Og++)),(0,S.Z)((0,J.Z)(n),"name","".concat(Og)),(0,S.Z)((0,J.Z)(n),"type",void 0),(0,S.Z)((0,J.Z)(n),"visible",!0),(0,S.Z)((0,J.Z)(n),"zIndex",0),(0,S.Z)((0,J.Z)(n),"minZoom",void 0),(0,S.Z)((0,J.Z)(n),"maxZoom",void 0),(0,S.Z)((0,J.Z)(n),"inited",!1),(0,S.Z)((0,J.Z)(n),"layerModelNeedUpdate",!1),(0,S.Z)((0,J.Z)(n),"pickedFeatureID",null),(0,S.Z)((0,J.Z)(n),"selectedFeatureID",null),(0,S.Z)((0,J.Z)(n),"styleNeedUpdate",!1),(0,S.Z)((0,J.Z)(n),"rendering",void 0),(0,S.Z)((0,J.Z)(n),"clusterZoom",0),(0,S.Z)((0,J.Z)(n),"layerType",void 0),(0,S.Z)((0,J.Z)(n),"isLayerGroup",!1),(0,S.Z)((0,J.Z)(n),"triangulation",void 0),(0,S.Z)((0,J.Z)(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,S.Z)((0,J.Z)(n),"hooks",{init:new Jo,afterInit:new Jo,beforeRender:new Jo,beforeRenderData:new nu,afterRender:new ia,beforePickingEncode:new ia,afterPickingEncode:new ia,beforeHighlight:new ia(["pickedColor"]),afterHighlight:new ia,beforeSelect:new ia(["pickedColor"]),afterSelect:new ia,beforeDestroy:new ia,afterDestroy:new ia}),(0,S.Z)((0,J.Z)(n),"models",[]),(0,S.Z)((0,J.Z)(n),"multiPassRenderer",void 0),(0,S.Z)((0,J.Z)(n),"plugins",void 0),(0,S.Z)((0,J.Z)(n),"sourceOption",void 0),(0,S.Z)((0,J.Z)(n),"layerModel",void 0),(0,S.Z)((0,J.Z)(n),"shapeOption",void 0),(0,S.Z)((0,J.Z)(n),"sceneContainer",void 0),(0,S.Z)((0,J.Z)(n),"layerChildren",[]),(0,S.Z)((0,J.Z)(n),"masks",[]),Nn((0,J.Z)(n),"configService",Mg,(0,J.Z)(n)),(0,S.Z)((0,J.Z)(n),"shaderModuleService",void 0),(0,S.Z)((0,J.Z)(n),"cameraService",void 0),(0,S.Z)((0,J.Z)(n),"coordinateService",void 0),(0,S.Z)((0,J.Z)(n),"iconService",void 0),(0,S.Z)((0,J.Z)(n),"fontService",void 0),(0,S.Z)((0,J.Z)(n),"pickingService",void 0),(0,S.Z)((0,J.Z)(n),"rendererService",void 0),(0,S.Z)((0,J.Z)(n),"layerService",void 0),(0,S.Z)((0,J.Z)(n),"interactionService",void 0),(0,S.Z)((0,J.Z)(n),"mapService",void 0),(0,S.Z)((0,J.Z)(n),"styleAttributeService",void 0),(0,S.Z)((0,J.Z)(n),"layerSource",void 0),(0,S.Z)((0,J.Z)(n),"postProcessingPassFactory",void 0),(0,S.Z)((0,J.Z)(n),"normalPassFactory",void 0),(0,S.Z)((0,J.Z)(n),"animateOptions",{enable:!1}),(0,S.Z)((0,J.Z)(n),"container",void 0),(0,S.Z)((0,J.Z)(n),"encodedData",void 0),(0,S.Z)((0,J.Z)(n),"configSchema",void 0),(0,S.Z)((0,J.Z)(n),"currentPickId",null),(0,S.Z)((0,J.Z)(n),"rawConfig",void 0),(0,S.Z)((0,J.Z)(n),"needUpdateConfig",void 0),(0,S.Z)((0,J.Z)(n),"pendingStyleAttributes",[]),(0,S.Z)((0,J.Z)(n),"scaleOptions",{}),(0,S.Z)((0,J.Z)(n),"animateStartTime",void 0),(0,S.Z)((0,J.Z)(n),"aniamateStatus",!1),(0,S.Z)((0,J.Z)(n),"bottomColor","rgba(0, 0, 0, 0)"),(0,S.Z)((0,J.Z)(n),"isDestroied",!1),(0,S.Z)((0,J.Z)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var s=n.getLayerConfig(),f=s.autoFit,v=s.fitBoundsOptions;f&&n.fitBounds(v),n.reRender()}),n.name=a.name||n.id,n.zIndex=a.zIndex||0,n.rawConfig=a,n}return(0,It.Z)(r,[{key:"addMaskLayer",value:function(a){this.masks.push(a)}},{key:"removeMaskLayer",value:function(a){var s=this.masks.indexOf(a);s>-1&&this.masks.splice(s,1),a.destroy()}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(a){if(!this.inited)this.needUpdateConfig=Wu(Wu({},this.needUpdateConfig),a);else{var s=this.container.get(xt.SceneID);R2(a,this),this.configService.setLayerConfig(s,this.id,Wu(Wu(Wu({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),a)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(a,s){this.container=a,this.sceneContainer=s}},{key:"getContainer",value:function(){return this.container}},{key:"setBottomColor",value:function(a){this.bottomColor=a}},{key:"getBottomColor",value:function(){return this.bottomColor}},{key:"addPlugin",value:function(a){return this.plugins.push(a),this}},{key:"init",value:function(){var a=this,s=this.container.get(xt.SceneID);this.configService.setLayerConfig(s,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(xt.IIconService),this.fontService=this.container.get(xt.IFontService),this.rendererService=this.container.get(xt.IRendererService),this.layerService=this.container.get(xt.ILayerService),this.interactionService=this.container.get(xt.IInteractionService),this.pickingService=this.container.get(xt.IPickingService),this.mapService=this.container.get(xt.IMapService);var f=this.getLayerConfig(),v=f.enableMultiPassRenderer,m=f.passes;v&&m!==null&&m!==void 0&&m.length&&m.length>0&&this.mapService.on("mapAfterFrameChange",function(){a.renderLayers()}),this.cameraService=this.container.get(xt.ICameraService),this.coordinateService=this.container.get(xt.ICoordinateSystemService),this.shaderModuleService=this.container.get(xt.IShaderModuleService),this.postProcessingPassFactory=this.container.get(xt.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(xt.IFactoryNormalPass),this.styleAttributeService=this.container.get(xt.IStyleAttributeService),this.multiPassRenderer=this.container.get(xt.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(O){var F=O.attributeName,j=O.attributeField,Y=O.attributeValues,ee=O.updateOptions;a.styleAttributeService.updateStyleAttribute(F,{scale:Wu({field:j},a.splitValuesAndCallbackInAttribute(Y,a.getLayerConfig()[F]))},ee)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(xt.ILayerPlugin);var x=W2(this.plugins),A;try{for(x.s();!(A=x.n()).done;){var T=A.value;T.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(O){x.e(O)}finally{x.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"updateModelData",value:function(a){a.attributes&&a.elements?this.models.map(function(s){s.updateAttributesAndElements(a.attributes,a.elements)}):console.warn("data error")}},{key:"createModelData",value:function(a,s){if(this.layerModel.createModelData)return this.layerModel.createModelData(s);var f=this.calculateEncodeData(a,s),v=this.triangulation;return f&&v?this.styleAttributeService.createAttributesAndIndices(f,v):{attributes:void 0,elements:void 0}}},{key:"calculateEncodeData",value:function(a,s){return this.inited?Z2(this,this.fontService,this.mapService,this.styleAttributeService,a,s):(console.warn("layer not inited!"),null)}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(Wu(Wu({},this.getDefaultConfig()),this.rawConfig));var a=this.getLayerConfig(),s=a.animateOption;s!=null&&s.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(a,s,f){return this.updateStyleAttribute("color",a,s,f),this}},{key:"texture",value:function(a,s,f){return this.updateStyleAttribute("texture",a,s,f),this}},{key:"rotate",value:function(a,s,f){return this.updateStyleAttribute("rotate",a,s,f),this}},{key:"size",value:function(a,s,f){return this.updateStyleAttribute("size",a,s,f),this}},{key:"filter",value:function(a,s,f){return this.updateStyleAttribute("filter",a,s,f),this}},{key:"shape",value:function(a,s,f){var v,m,x,A=(v=this.styleAttributeService)===null||v===void 0||(m=v.getLayerStyleAttribute("shape"))===null||m===void 0||(x=m.scale)===null||x===void 0?void 0:x.field,T=a;return this.shapeOption={field:a,values:s},this.updateStyleAttribute("shape",a,s,f),V2(this,A,T),this}},{key:"label",value:function(a,s,f){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:a,attributeValues:s,updateOptions:f}),this}},{key:"animate",value:function(a){var s={};return to()(a)?(s.enable=!0,s=Wu(Wu({},s),a)):s.enable=a,this.updateLayerConfig({animateOption:s}),this}},{key:"source",value:function(a,s){return a!=null&&a.data?(this.setSource(a),this):(this.sourceOption={data:a,options:s},this.clusterZoom=0,this)}},{key:"setData",value:function(a,s){var f=this;return this.inited?this.layerSource.setData(a,s):this.on("inited",function(){var v=f.getSource();v?f.layerSource.setData(a,s):(f.source(new Fh(a,s)),f.sourceEvent())}),this}},{key:"style",value:function(a){var s=this,f=this.getLayerConfig(),v=a.passes,m=(0,Ga.Z)(a,G2);return v&&wg(v).forEach(function(x){var A=s.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(x[0]);A&&A.updateOptions(x[1])}),this.rawConfig=Wu(Wu({},this.rawConfig),m),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),f&&f.mask===!0&&a.mask===!1&&(this.clearModels(),this.models=this.layerModel.buildModels()),this}},{key:"scale",value:function(a,s){return to()(a)?this.scaleOptions=Wu(Wu({},this.scaleOptions),a):this.scaleOptions[a]=s,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.getEncodedData().length!==0&&this.renderModels(),this}},{key:"renderMultiPass",value:function(){var n=(0,U.Z)(q().mark(function s(){return q().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(this.getEncodedData().length===0){v.next=7;break}if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){v.next=6;break}return v.next=4,this.multiPassRenderer.render();case 4:v.next=7;break;case 6:this.multiPassRenderer?this.renderModels():this.renderModels();case 7:case"end":return v.stop()}},s,this)}));function a(){return n.apply(this,arguments)}return a}()},{key:"active",value:function(a){var s={};return s.enableHighlight=to()(a)?!0:a,to()(a)?(s.enableHighlight=!0,a.color&&(s.highlightColor=a.color),a.mix&&(s.activeMix=a.mix)):s.enableHighlight=!!a,this.updateLayerConfig(s),this}},{key:"setActive",value:function(a,s){var f=this;if(to()(a)){var v=a.x,m=v===void 0?0:v,x=a.y,A=x===void 0?0:x;this.updateLayerConfig({highlightColor:to()(s)?s.color:this.getLayerConfig().highlightColor,activeMix:to()(s)?s.mix:this.getLayerConfig().activeMix}),this.pick({x:m,y:A})}else this.updateLayerConfig({pickedFeatureID:a,highlightColor:to()(s)?s.color:this.getLayerConfig().highlightColor,activeMix:to()(s)?s.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call(ss(a)).then(function(){setTimeout(function(){f.reRender()},1)})}},{key:"select",value:function(a){var s={};return s.enableSelect=to()(a)?!0:a,to()(a)?(s.enableSelect=!0,a.color&&(s.selectColor=a.color),a.mix&&(s.selectMix=a.mix)):s.enableSelect=!!a,this.updateLayerConfig(s),this}},{key:"setSelect",value:function(a,s){var f=this;if(to()(a)){var v=a.x,m=v===void 0?0:v,x=a.y,A=x===void 0?0:x;this.updateLayerConfig({selectColor:to()(s)?s.color:this.getLayerConfig().selectColor,selectMix:to()(s)?s.mix:this.getLayerConfig().selectMix}),this.pick({x:m,y:A})}else this.updateLayerConfig({pickedFeatureID:a,selectColor:to()(s)?s.color:this.getLayerConfig().selectColor,selectMix:to()(s)?s.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(ss(a)).then(function(){setTimeout(function(){f.reRender()},1)})}},{key:"setBlend",value:function(a){return this.updateLayerConfig({blend:a}),this.layerModelNeedUpdate=!0,this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.type==="CanvasLayer"&&this.layerModel.clearCanvas&&this.layerModel.clearCanvas(),this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(a){return this.zIndex=a,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(a){this.currentPickId=a}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(a){this.selectedFeatureID=a}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var a=this.mapService.getZoom(),s=this.getLayerConfig(),f=s.visible,v=s.minZoom,m=v===void 0?-Infinity:v,x=s.maxZoom,A=x===void 0?Infinity:x;return!!f&&a>=m&&a<=A}},{key:"setMultiPass",value:function(a,s){if(this.updateLayerConfig({enableMultiPassRenderer:a}),s&&this.updateLayerConfig({passes:s}),a){var f=this.getLayerConfig(),v=f.passes,m=v===void 0?[]:v;this.multiPassRenderer=U2(this,m,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var x=this.rendererService.getViewportSize(),A=x.width,T=x.height;this.multiPassRenderer.resize(A,T)}return this}},{key:"setMinZoom",value:function(a){return this.updateLayerConfig({minZoom:a}),this}},{key:"getMinZoom",value:function(){var a=this.getLayerConfig(),s=a.minZoom;return s}},{key:"getMaxZoom",value:function(){var a=this.getLayerConfig(),s=a.maxZoom;return s}},{key:"get",value:function(a){var s=this.getLayerConfig();return s[a]}},{key:"setMaxZoom",value:function(a){return this.updateLayerConfig({maxZoom:a}),this}},{key:"setAutoFit",value:function(a){return this.updateLayerConfig({autoFit:a}),this}},{key:"fitBounds",value:function(a){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var s=this.getSource(),f=s.extent,v=f.some(function(m){return Math.abs(m)===Infinity});return v?this:(this.mapService.fitBounds([[f[0],f[1]],[f[2],f[3]]],a),this)}},{key:"destroy",value:function(){var a;this.isDestroied||(this.layerChildren.map(function(s){return s.destroy()}),this.layerChildren=[],this.masks.map(function(s){return s.destroy()}),this.masks=[],this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(a=this.layerModel)===null||a===void 0||a.clearModels(),this.models=[],this.layerService.cleanRemove(this),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroied=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(a){return a.destroy()}),this.layerModel.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(a){return a.needRescale||a.needRemapping||a.needRegenerateVertices}).length}},{key:"setSource",value:function(a){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=a,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var s=this.mapService.getZoom();this.layerSource.updateClusterData(s)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(a){this.encodedData=a}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(a){return this.styleAttributeService.getLayerAttributeScale(a)}},{key:"getLegendItems",value:function(a){var s=this.styleAttributeService.getLayerAttributeScale(a);if(!s)return[];if(s.invertExtent){var f=s.range().map(function(x){return(0,S.Z)({value:s.invertExtent(x)},a,x)});return f}else if(s.ticks){var v=s.ticks().map(function(x){return(0,S.Z)({value:x},a,s(x))});return v}else if(s!=null&&s.domain){var m=s.domain().filter(function(x){return!Sg()(x)}).map(function(x){return(0,S.Z)({value:x},a,s(x))});return m}return[]}},{key:"pick",value:function(a){var s=a.x,f=a.y;this.interactionService.triggerHover({x:s,y:f})}},{key:"boxSelect",value:function(a,s){this.pickingService.boxPickLayer(this,a,s)}},{key:"buildLayerModel",value:function(a){var s=a.moduleName,f=a.vertexShader,v=a.fragmentShader,m=a.triangulation,x=a.segmentNumber,A=(0,Ga.Z)(a,H2);this.shaderModuleService.registerModule(s,{vs:f,fs:v});var T=this.shaderModuleService.getModule(s),O=T.vs,F=T.fs,j=T.uniforms,Y=this.rendererService.createModel,ee=this.styleAttributeService.createAttributesAndIndices(this.encodedData,m,x),Ae=ee.attributes,Fe=ee.elements;return Y(Wu({attributes:Ae,uniforms:j,fs:F,vs:O,elements:Fe,blend:Cg[Ws.normal]},A))}},{key:"createAttrubutes",value:function(a){var s=a.triangulation,f=this.styleAttributeService.createAttributes(this.encodedData,s),v=f.attributes;return v}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(a){var s=this.getLayerConfig(),f=s.enableHighlight,v=f===void 0?!0:f,m=s.enableSelect,x=m===void 0?!0:m,A=this.eventNames().indexOf(a)!==-1||this.eventNames().indexOf("un"+a)!==-1;return(a==="click"||a==="dblclick")&&x&&(A=!0),a==="mousemove"&&(v||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(A=!0),this.isVisible()&&A}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderMulPass",value:function(){var n=(0,U.Z)(q().mark(function s(f){return q().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,f.render();case 2:case"end":return m.stop()}},s)}));function a(s){return n.apply(this,arguments)}return a}()},{key:"renderModels",value:function(a){var s=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.layerModel.renderUpdate&&this.layerModel.renderUpdate(),this.models.forEach(function(f){f.draw({uniforms:s.layerModel.getUninforms()},a)})),this}},{key:"updateStyleAttribute",value:function(a,s,f,v){this.inited?this.styleAttributeService.updateStyleAttribute(a,{scale:Wu({field:s},this.splitValuesAndCallbackInAttribute(f,this.getLayerConfig()[s]))},v):this.pendingStyleAttributes.push({attributeName:a,attributeField:s,attributeValues:f,updateOptions:v})}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(a){console.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&(this.layerService.updateLayerRenderList(),this.layerService.renderLayers())}},{key:"splitValuesAndCallbackInAttribute",value:function(a,s){return{values:L()(a)?void 0:a||s,callback:L()(a)?a:void 0}}}]),r}(cs.EventEmitter),Mg=ni(D0.prototype,"configService",[Tg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D0),$2=W(18446),Ic=W.n($2),Rg,F0,kg;function Q2(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=J2(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function J2(e,i){if(!!e){if(typeof e=="string")return Lg(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Lg(e,i)}}function Lg(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var eE=(Rg=tv(xt.IGlobalConfigService),F0=function(){function e(i){(0,dt.Z)(this,e),(0,S.Z)(this,"triangulation",void 0),(0,S.Z)(this,"createTexture2D",void 0),(0,S.Z)(this,"layer",void 0),(0,S.Z)(this,"dataTexture",void 0),(0,S.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,S.Z)(this,"rowCount",void 0),(0,S.Z)(this,"cacheStyleProperties",void 0),(0,S.Z)(this,"cellLength",void 0),(0,S.Z)(this,"cellProperties",void 0),(0,S.Z)(this,"cellTypeLayout",void 0),(0,S.Z)(this,"stylePropertyesExist",void 0),(0,S.Z)(this,"dataTextureTest",void 0),Nn(this,"configService",kg,this),(0,S.Z)(this,"shaderModuleService",void 0),(0,S.Z)(this,"rendererService",void 0),(0,S.Z)(this,"iconService",void 0),(0,S.Z)(this,"fontService",void 0),(0,S.Z)(this,"styleAttributeService",void 0),(0,S.Z)(this,"mapService",void 0),(0,S.Z)(this,"cameraService",void 0),(0,S.Z)(this,"layerService",void 0),this.layer=i,this.rendererService=i.getContainer().get(xt.IRendererService),this.shaderModuleService=i.getContainer().get(xt.IShaderModuleService),this.styleAttributeService=i.getContainer().get(xt.IStyleAttributeService),this.mapService=i.getContainer().get(xt.IMapService),this.iconService=i.getContainer().get(xt.IIconService),this.fontService=i.getContainer().get(xt.IFontService),this.cameraService=i.getContainer().get(xt.ICameraService),this.layerService=i.getContainer().get(xt.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var r=this.rendererService.createTexture2D;this.createTexture2D=r,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8Array(4),mag:k.NEAREST,min:k.NEAREST,width:1,height:1}))}return(0,It.Z)(e,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,this.stylePropertyesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(r){var n=!1;return Ic()(r.thetaOffset,this.cacheStyleProperties.thetaOffset)||(n=!0,this.cacheStyleProperties.thetaOffset=r.thetaOffset),Ic()(r.opacity,this.cacheStyleProperties.opacity)||(n=!0,this.cacheStyleProperties.opacity=r.opacity),Ic()(r.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(n=!0,this.cacheStyleProperties.strokeOpacity=r.strokeOpacity),Ic()(r.strokeWidth,this.cacheStyleProperties.strokeWidth)||(n=!0,this.cacheStyleProperties.strokeWidth=r.strokeWidth),Ic()(r.stroke,this.cacheStyleProperties.stroke)||(n=!0,this.cacheStyleProperties.stroke=r.stroke),Ic()(r.offsets,this.cacheStyleProperties.offsets)||(n=!0,this.cacheStyleProperties.offsets=r.offsets),this.dataTexture===void 0&&(n=!0),n}},{key:"judgeStyleAttributes",value:function(r){this.clearLastCalRes(),r.opacity!==void 0&&!ki()(r.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),r.strokeOpacity!==void 0&&!ki()(r.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),r.strokeWidth!==void 0&&!ki()(r.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),r.stroke!==void 0&&!this.isStaticColor(r.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),r.offsets!==void 0&&!this.isOffsetStatic(r.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2),r.thetaOffset!==void 0&&!ki()(r.thetaOffset)&&(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertyesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(r){return w()(r)?!!(0,Ns.ZP)(r):!1}},{key:"getStrokeColor",value:function(r){if(this.isStaticColor(r)){var n=pi(r);return n[0]=n[0]?n[0]:0,n[1]=n[1]?n[1]:0,n[2]=n[2]?n[2]:0,n[3]=n[3]?n[3]:0,n}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(r){return!!(Array.isArray(r)&&r.length===2&&ki()(r[0])&&ki()(r[1]))}},{key:"patchMod",value:function(r,n){for(var a=0;a<n;a++)r.push(-1)}},{key:"patchData",value:function(r,n,a){var s=Q2(a),f;try{for(s.s();!(f=s.n()).done;){var v=f.value,m=v.attr,x=v.count,A=n[m];A!==void 0?m==="stroke"?r.push.apply(r,(0,pe.Z)(pi(A))):m==="offsets"?this.isOffsetStatic(A)?r.push(-A[0],A[1]):r.push(0,0):r.push(ki()(A)?A:1):this.patchMod(r,x)}}catch(T){s.e(T)}finally{s.f()}}},{key:"calDataFrame",value:function(r,n,a){for(var s=n.length,f=Math.ceil(s*r/this.DATA_TEXTURE_WIDTH),v=f*this.DATA_TEXTURE_WIDTH,m=[],x=0;x<s;x++){var A=n[x];this.patchData(m,A,a)}for(var T=m.length;T<v;T++)m.push(-1);return{data:m,width:this.DATA_TEXTURE_WIDTH,height:f}}},{key:"getBlend",value:function(){var r=this.layer.getLayerConfig(),n=r.blend,a=n===void 0?"normal":n;return Cg[Ws[a]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.duration||4,r.interval||.2,r.trailLength||.1]}},{key:"startModelAnimate",value:function(){var r=this.layer.getLayerConfig(),n=r.animateOption;n.enable&&this.layer.setAnimateStartTime()}}]),e}(),kg=ni(F0.prototype,"configService",[Rg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F0),tE=W(9187),Oc=W.n(tE),zv={};function IP(e){var i=calculateCentroid(e.coordinates);return{vertices:[].concat(_toConsumableArray(i),_toConsumableArray(i),_toConsumableArray(i),_toConsumableArray(i)),indices:[0,1,2,2,3,0],size:i.length}}function OP(e){var i=calculateCentroid(e.coordinates),r=lglt2xyz(i);return{vertices:[].concat(_toConsumableArray(r),_toConsumableArray(r),_toConsumableArray(r),_toConsumableArray(r)),indices:[0,1,2,2,3,0],size:r.length}}function RP(e){var i=e.shape,r=iE(i,!1),n=r.positions,a=r.index,s=r.normals;return{vertices:n,indices:a,normals:s,size:5}}function kP(e){var i=calculateCentroid(e.coordinates);return{vertices:_toConsumableArray(i),indices:[0],size:i.length}}function LP(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,a=new ExtrudePolyline({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var s=i;Array.isArray(s[0][0])||(s=[i]);var f=r;Array.isArray(f[0][0])||(f=[r]);for(var v=0;v<s.length;v++){var m=s[v],x=f[v];a.extrude_gaode2(m,x)}}else{var A=i;A[0]&&!Array.isArray(A[0][0])&&(A=[i]),A.forEach(function(O){a.extrude(O)})}var T=a.complex;return{vertices:T.positions,indices:T.indices,normals:T.normals,indexes:T.indexes,size:6}}function DP(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,a=new ExtrudePolyline({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var s=i;Array.isArray(s[0][0])||(s=[i]);var f=r;Array.isArray(f[0][0])||(f=[r]);for(var v=0;v<s.length;v++){var m=s[v],x=f[v];a.simpleExtrude_gaode2(m,x)}}else{var A=i;A[0]&&!Array.isArray(A[0][0])&&(A=[i]),A.forEach(function(O){a.simpleExtrude(O)})}var T=a.complex;return{vertices:T.positions,indices:T.indices,normals:T.normals,size:6}}function rE(e){var i=e.coordinates,r=Oc().flatten(i),n=r.vertices,a=r.dimensions,s=r.holes;return{indices:Oc()(n,s,a),vertices:n,size:a}}function FP(e){var i=e.coordinates,r=earcut.flatten(i),n=r.vertices,a=r.dimensions,s=r.holes;return{indices:earcut(n,s,a),vertices:nE(n),size:a+4}}function nE(e){for(var i=[],r=calculatePointsCenterAndRadius(e),n=r.center,a=r.radius,s=0;s<e.length;s+=2){var f=e[s],v=e[s+1];i.push.apply(i,[f,v,0].concat(_toConsumableArray(n),[a]))}return i}function BP(e){var i=e.coordinates,r=extrude_PolygonNormal(i,!0),n=r.positions,a=r.index,s=r.normals;return{vertices:n,indices:a,normals:s,size:5}}function NP(e){var i=e.shape,r=oE(i),n=r.positions,a=r.index;return{vertices:n,indices:a,size:3}}function zP(e){var i=e.coordinates,r=[].concat(_toConsumableArray(i[0]),[0,0,1,i[1][0],i[0][1],0,1,1],_toConsumableArray(i[1]),[0,1,0],_toConsumableArray(i[0]),[0,0,1],_toConsumableArray(i[1]),[0,1,0,i[0][0],i[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:r,indices:n,size:5}}function ZP(e,i){for(var r=i||30,n=e.coordinates,a=[],s=[],f=function(x){a.push(x,1,x,n[0][0],n[0][1],n[1][0],n[1][1],x,-1,x,n[0][0],n[0][1],n[1][0],n[1][1]),x!==r-1&&s.push.apply(s,_toConsumableArray([0,1,2,1,3,2].map(function(A){return x*2+A})))},v=0;v<r;v++)f(v);return{vertices:a,indices:s,size:7}}function UP(e){var i=e.coordinates;i.length===2&&i.push(0);var r=e.size,n=Zv(-1,1),a=Zv(1,1),s=Zv(-1,-1),f=Zv(1,-1),v=[].concat(_toConsumableArray(i),_toConsumableArray(n),_toConsumableArray(i),_toConsumableArray(s),_toConsumableArray(i),_toConsumableArray(f),_toConsumableArray(i),_toConsumableArray(a)),m=[0,1,2,3,0,2];return{vertices:v,indices:m,size:5}}function iE(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(zv&&zv[e])return zv[e];var r=geometryShape[e]?geometryShape[e]():geometryShape.cylinder(),n=extrude_PolygonNormal([r],i);return zv[e]=n,n}function jP(e,i){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,a=new Float32Array(e.length/r*3),s,f,v,m=vec3.create(),x=vec3.create(),A=vec3.create(),T=0,O=i.length;T<O;T+=3){s=i[T+0]*3,f=i[T+1]*3,v=i[T+2]*3;var F=[e[s],e[s+1]],j=[e[f],e[f+1]],Y=[e[v],e[v+1]];n&&(F=lngLatToMeters(F),j=lngLatToMeters(j),Y=lngLatToMeters(Y));var ee=F,Ae=_slicedToArray(ee,2),Fe=Ae[0],Xe=Ae[1],nt=vec3.fromValues(Fe,Xe,e[s+2]),Et=j,wt=_slicedToArray(Et,2),Wt=wt[0],ur=wt[1],Ar=vec3.fromValues(Wt,ur,e[f+2]),Jr=Y,gr=_slicedToArray(Jr,2),vn=gr[0],Pn=gr[1],Kn=vec3.fromValues(vn,Pn,e[v+2]);vec3.sub(m,Kn,Ar),vec3.sub(x,nt,Ar),vec3.cross(A,m,x),a[s]+=m[0],a[s+1]+=m[1],a[s+2]+=m[2],a[f]+=m[0],a[f+1]+=m[1],a[f+2]+=m[2],a[v]+=m[0],a[v+1]+=m[1],a[v+2]+=m[2]}return aE(a),a}function aE(e){for(var i=0,r=e.length;i<r;i+=3){var n=vec3.fromValues(e[i],e[i+1],e[i+2]),a=vec3.create();vec3.normalize(a,n),e.set(a,i)}}function VP(e){var i=e[0][0],r=e[0][e[0].length-1];return i[0]===r[0]&&i[1]===r[1]}function oE(e){var i=["cylinder","triangleColumn","hexagonColumn","squareColumn"],r=geometryShape[e]?geometryShape[e]():geometryShape.circle(),n=i.indexOf(e)===-1?fillPolygon([r]):extrudePolygon([r]);return n}function Zv(e,i){var r=(e+1)/2,n=(i+1)/2;return[r,n]}function GP(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function HP(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function sE(e){var i=uE();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function uE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lE=`uniform float u_opacity;
varying vec4 v_Color;

void main() {
  gl_FragColor = v_Color;
  gl_FragColor.a *= u_opacity;
}
`,cE=`attribute vec4 a_Color;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;

#pragma include "projection"

void main() {

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,fE=function(e){(0,Ir.Z)(r,e);var i=sE(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?0:s;return{u_opacity:ki()(f)?f:0}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"mask",vertexShader:cE,fragmentShader:lE,triangulation:rE,blend:this.getBlend(),depth:{enable:!1},stencil:{enable:!0,mask:255,func:{cmp:k.ALWAYS,ref:1,mask:255},opFront:{fail:k.REPLACE,zfail:k.REPLACE,zpass:k.REPLACE}}})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy(),this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),r}(eE),hE={fill:fE},pE=hE;function dE(e){var i=vE();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function vE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mE=function(e){(0,Ir.Z)(r,e);var i=dE(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"type","MaskLayer"),n}return(0,It.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new pE[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"fill"}}]),r}(K2),gE=W(88307),yE=W.n(gE),_E=function(){function e(i,r){(0,dt.Z)(this,e),(0,S.Z)(this,"attribute",void 0),(0,S.Z)(this,"buffer",void 0);var n=r.buffer,a=r.offset,s=r.stride,f=r.normalized,v=r.size,m=r.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:a||0,stride:s||0,normalized:f||!1,divisor:m||0},v&&(this.attribute.size=v)}return(0,It.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),Ah,rv,wh,Rc,nv,sp,iv,Uv,Zf,Np,Au,Uf,jf,jv,xE=(Ah={},(0,S.Z)(Ah,k.POINTS,"points"),(0,S.Z)(Ah,k.LINES,"lines"),(0,S.Z)(Ah,k.LINE_LOOP,"line loop"),(0,S.Z)(Ah,k.LINE_STRIP,"line strip"),(0,S.Z)(Ah,k.TRIANGLES,"triangles"),(0,S.Z)(Ah,k.TRIANGLE_FAN,"triangle fan"),(0,S.Z)(Ah,k.TRIANGLE_STRIP,"triangle strip"),Ah),Dg=(rv={},(0,S.Z)(rv,k.STATIC_DRAW,"static"),(0,S.Z)(rv,k.DYNAMIC_DRAW,"dynamic"),(0,S.Z)(rv,k.STREAM_DRAW,"stream"),rv),B0=(wh={},(0,S.Z)(wh,k.BYTE,"int8"),(0,S.Z)(wh,k.UNSIGNED_INT,"int16"),(0,S.Z)(wh,k.INT,"int32"),(0,S.Z)(wh,k.UNSIGNED_BYTE,"uint8"),(0,S.Z)(wh,k.UNSIGNED_SHORT,"uint16"),(0,S.Z)(wh,k.UNSIGNED_INT,"uint32"),(0,S.Z)(wh,k.FLOAT,"float"),wh),bE=(Rc={},(0,S.Z)(Rc,k.ALPHA,"alpha"),(0,S.Z)(Rc,k.LUMINANCE,"luminance"),(0,S.Z)(Rc,k.LUMINANCE_ALPHA,"luminance alpha"),(0,S.Z)(Rc,k.RGB,"rgb"),(0,S.Z)(Rc,k.RGBA,"rgba"),(0,S.Z)(Rc,k.RGBA4,"rgba4"),(0,S.Z)(Rc,k.RGB5_A1,"rgb5 a1"),(0,S.Z)(Rc,k.RGB565,"rgb565"),(0,S.Z)(Rc,k.DEPTH_COMPONENT,"depth"),(0,S.Z)(Rc,k.DEPTH_STENCIL,"depth stencil"),Rc),EE=(nv={},(0,S.Z)(nv,k.DONT_CARE,"dont care"),(0,S.Z)(nv,k.NICEST,"nice"),(0,S.Z)(nv,k.FASTEST,"fast"),nv),Fg=(sp={},(0,S.Z)(sp,k.NEAREST,"nearest"),(0,S.Z)(sp,k.LINEAR,"linear"),(0,S.Z)(sp,k.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,S.Z)(sp,k.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,S.Z)(sp,k.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,S.Z)(sp,k.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),sp),Bg=(iv={},(0,S.Z)(iv,k.REPEAT,"repeat"),(0,S.Z)(iv,k.CLAMP_TO_EDGE,"clamp"),(0,S.Z)(iv,k.MIRRORED_REPEAT,"mirror"),iv),SE=(Uv={},(0,S.Z)(Uv,k.NONE,"none"),(0,S.Z)(Uv,k.BROWSER_DEFAULT_WEBGL,"browser"),Uv),CE=(Zf={},(0,S.Z)(Zf,k.NEVER,"never"),(0,S.Z)(Zf,k.ALWAYS,"always"),(0,S.Z)(Zf,k.LESS,"less"),(0,S.Z)(Zf,k.LEQUAL,"lequal"),(0,S.Z)(Zf,k.GREATER,"greater"),(0,S.Z)(Zf,k.GEQUAL,"gequal"),(0,S.Z)(Zf,k.EQUAL,"equal"),(0,S.Z)(Zf,k.NOTEQUAL,"notequal"),Zf),Ng=(Np={},(0,S.Z)(Np,k.FUNC_ADD,"add"),(0,S.Z)(Np,k.MIN_EXT,"min"),(0,S.Z)(Np,k.MAX_EXT,"max"),(0,S.Z)(Np,k.FUNC_SUBTRACT,"subtract"),(0,S.Z)(Np,k.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Np),Vv=(Au={},(0,S.Z)(Au,k.ZERO,"zero"),(0,S.Z)(Au,k.ONE,"one"),(0,S.Z)(Au,k.SRC_COLOR,"src color"),(0,S.Z)(Au,k.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,S.Z)(Au,k.SRC_ALPHA,"src alpha"),(0,S.Z)(Au,k.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,S.Z)(Au,k.DST_COLOR,"dst color"),(0,S.Z)(Au,k.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,S.Z)(Au,k.DST_ALPHA,"dst alpha"),(0,S.Z)(Au,k.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,S.Z)(Au,k.CONSTANT_COLOR,"constant color"),(0,S.Z)(Au,k.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,S.Z)(Au,k.CONSTANT_ALPHA,"constant alpha"),(0,S.Z)(Au,k.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,S.Z)(Au,k.SRC_ALPHA_SATURATE,"src alpha saturate"),Au),AE=(Uf={},(0,S.Z)(Uf,k.NEVER,"never"),(0,S.Z)(Uf,k.ALWAYS,"always"),(0,S.Z)(Uf,k.LESS,"less"),(0,S.Z)(Uf,k.LEQUAL,"lequal"),(0,S.Z)(Uf,k.GREATER,"greater"),(0,S.Z)(Uf,k.GEQUAL,"gequal"),(0,S.Z)(Uf,k.EQUAL,"equal"),(0,S.Z)(Uf,k.NOTEQUAL,"notequal"),Uf),gd=(jf={},(0,S.Z)(jf,k.ZERO,"zero"),(0,S.Z)(jf,k.KEEP,"keep"),(0,S.Z)(jf,k.REPLACE,"replace"),(0,S.Z)(jf,k.INVERT,"invert"),(0,S.Z)(jf,k.INCR,"increment"),(0,S.Z)(jf,k.DECR,"decrement"),(0,S.Z)(jf,k.INCR_WRAP,"increment wrap"),(0,S.Z)(jf,k.DECR_WRAP,"decrement wrap"),jf),wE=(jv={},(0,S.Z)(jv,k.FRONT,"front"),(0,S.Z)(jv,k.BACK,"back"),jv),TE=function(){function e(i,r){(0,dt.Z)(this,e),(0,S.Z)(this,"buffer",void 0);var n=r.data,a=r.usage,s=r.type;this.buffer=i.buffer({data:n,usage:Dg[a||k.STATIC_DRAW],type:B0[s||k.UNSIGNED_BYTE]})}return(0,It.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(r){var n=r.data,a=r.offset;this.buffer.subdata(n,a)}}]),e}(),ME=function(){function e(i,r){(0,dt.Z)(this,e),(0,S.Z)(this,"elements",void 0);var n=r.data,a=r.usage,s=r.type,f=r.count;this.elements=i.elements({data:n,usage:Dg[a||k.STATIC_DRAW],type:B0[s||k.UNSIGNED_BYTE],count:f})}return(0,It.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(r){var n=r.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),e}(),PE=function(){function e(i,r){(0,dt.Z)(this,e),(0,S.Z)(this,"framebuffer",void 0);var n=r.width,a=r.height,s=r.color,f=r.colors,v=r.depth,m=r.stencil,x={width:n,height:a};Array.isArray(f)&&(x.colors=f.map(function(A){return A.get()})),s&&typeof s!="boolean"&&(x.color=s.get()),this.framebuffer=i.framebuffer(x)}return(0,It.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(r){var n=r.width,a=r.height;this.framebuffer.resize(n,a)}}]),e}(),IE=W(36719),OE=W.n(IE),RE=W(68630),kE=W.n(RE);function zg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function kc(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?zg(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):zg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var LE=function(){function e(i,r){(0,dt.Z)(this,e),(0,S.Z)(this,"reGl",void 0),(0,S.Z)(this,"destroyed",!1),(0,S.Z)(this,"drawCommand",void 0),(0,S.Z)(this,"drawPickCommand",void 0),(0,S.Z)(this,"drawParams",void 0),(0,S.Z)(this,"options",void 0),(0,S.Z)(this,"uniforms",{}),this.reGl=i;var n=r.vs,a=r.fs,s=r.attributes,f=r.uniforms,v=r.primitive,m=r.count,x=r.elements,A=r.depth,T=r.blend,O=r.stencil,F=r.cull,j=r.instances,Y={};this.options=r,f&&(this.uniforms=this.extractUniforms(f),Object.keys(f).forEach(function(Xe){Y[Xe]=i.prop(Xe)}));var ee={};Object.keys(s).forEach(function(Xe){ee[Xe]=s[Xe].get()});var Ae={attributes:ee,frag:a,uniforms:Y,vert:n,blend:{},primitive:xE[v===void 0?k.TRIANGLES:v]};j&&(Ae.instances=j),m&&(Ae.count=m),x&&(Ae.elements=x.get()),this.initDepthDrawParams({depth:A},Ae),this.initBlendDrawParams({blend:T},Ae),this.initStencilDrawParams({stencil:O},Ae),this.initCullDrawParams({cull:F},Ae),this.drawCommand=i(Ae);var Fe=X()(Ae);Fe.blend=kc(kc({},Fe.blend),{},{enable:!1}),this.drawPickCommand=i(Fe),this.drawParams=Ae}return(0,It.Z)(e,[{key:"updateAttributesAndElements",value:function(r,n){var a={};Object.keys(r).forEach(function(f){a[f]=r[f].get()}),this.drawParams.attributes=a,this.drawParams.elements=n.get(),this.drawCommand=this.reGl(this.drawParams);var s=X()(this.drawParams);s.blend=kc(kc({},s.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(s)}},{key:"updateAttributes",value:function(r){var n={};Object.keys(r).forEach(function(s){n[s]=r[s].get()}),this.drawParams.attributes=n,this.drawCommand=this.reGl(this.drawParams);var a=X()(this.drawParams);a.blend=kc(kc({},a.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(a)}},{key:"addUniforms",value:function(r){this.uniforms=kc(kc({},this.uniforms),this.extractUniforms(r))}},{key:"draw",value:function(r,n){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var a=kc(kc({},this.uniforms),this.extractUniforms(r.uniforms||{})),s={};Object.keys(a).forEach(function(f){var v=(0,We.Z)(a[f]);v==="boolean"||v==="number"||Array.isArray(a[f])||a[f].BYTES_PER_ELEMENT?s[f]=a[f]:s[f]=a[f].get()}),n?this.drawPickCommand(s):this.drawCommand(s)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(r){r.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(r,n){var a=r.depth;a&&(n.depth={enable:a.enable===void 0?!0:!!a.enable,mask:a.mask===void 0?!0:!!a.mask,func:CE[a.func||k.LESS],range:a.range||[0,1]})}},{key:"initBlendDrawParams",value:function(r,n){var a=r.blend;if(a){var s=a.enable,f=a.func,v=a.equation,m=a.color,x=m===void 0?[0,0,0,0]:m;n.blend={enable:!!s,func:{srcRGB:Vv[f&&f.srcRGB||k.SRC_ALPHA],srcAlpha:Vv[f&&f.srcAlpha||k.SRC_ALPHA],dstRGB:Vv[f&&f.dstRGB||k.ONE_MINUS_SRC_ALPHA],dstAlpha:Vv[f&&f.dstAlpha||k.ONE_MINUS_SRC_ALPHA]},equation:{rgb:Ng[v&&v.rgb||k.FUNC_ADD],alpha:Ng[v&&v.alpha||k.FUNC_ADD]},color:x}}}},{key:"initStencilDrawParams",value:function(r,n){var a=r.stencil;if(a){var s=a.enable,f=a.mask,v=f===void 0?-1:f,m=a.func,x=m===void 0?{cmp:k.ALWAYS,ref:0,mask:-1}:m,A=a.opFront,T=A===void 0?{fail:k.KEEP,zfail:k.KEEP,zpass:k.KEEP}:A,O=a.opBack,F=O===void 0?{fail:k.KEEP,zfail:k.KEEP,zpass:k.KEEP}:O;n.stencil={enable:!!s,mask:v,func:kc(kc({},x),{},{cmp:AE[x.cmp]}),opFront:{fail:gd[T.fail],zfail:gd[T.zfail],zpass:gd[T.zpass]},opBack:{fail:gd[F.fail],zfail:gd[F.zfail],zpass:gd[F.zpass]}}}}},{key:"initCullDrawParams",value:function(r,n){var a=r.cull;if(a){var s=a.enable,f=a.face,v=f===void 0?k.BACK:f;n.cull={enable:!!s,face:wE[v]}}}},{key:"extractUniforms",value:function(r){var n=this,a={};return Object.keys(r).forEach(function(s){n.extractUniformsRecursively(s,r[s],a,"")}),a}},{key:"extractUniformsRecursively",value:function(r,n,a,s){var f=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||OE()(n)||n===""||"resize"in n){a["".concat(s&&s+".").concat(r)]=n;return}kE()(n)&&Object.keys(n).forEach(function(v){f.extractUniformsRecursively(v,n[v],a,"".concat(s&&s+".").concat(r))}),Array.isArray(n)&&n.forEach(function(v,m){Object.keys(v).forEach(function(x){f.extractUniformsRecursively(x,v[x],a,"".concat(s&&s+".").concat(r,"[").concat(m,"]"))})})}}]),e}(),DE=function(){function e(i,r){(0,dt.Z)(this,e),(0,S.Z)(this,"texture",void 0),(0,S.Z)(this,"width",void 0),(0,S.Z)(this,"height",void 0),(0,S.Z)(this,"isDistroy",!1);var n=r.data,a=r.type,s=a===void 0?k.UNSIGNED_BYTE:a,f=r.width,v=r.height,m=r.flipY,x=m===void 0?!1:m,A=r.format,T=A===void 0?k.RGBA:A,O=r.mipmap,F=O===void 0?!1:O,j=r.wrapS,Y=j===void 0?k.CLAMP_TO_EDGE:j,ee=r.wrapT,Ae=ee===void 0?k.CLAMP_TO_EDGE:ee,Fe=r.aniso,Xe=Fe===void 0?0:Fe,nt=r.alignment,Et=nt===void 0?1:nt,wt=r.premultiplyAlpha,Wt=wt===void 0?!1:wt,ur=r.mag,Ar=ur===void 0?k.NEAREST:ur,Jr=r.min,gr=Jr===void 0?k.NEAREST:Jr,vn=r.colorSpace,Pn=vn===void 0?k.BROWSER_DEFAULT_WEBGL:vn,Kn=r.x,Ba=Kn===void 0?0:Kn,qo=r.y,Ls=qo===void 0?0:qo,Ds=r.copy,Ys=Ds===void 0?!1:Ds;this.width=f,this.height=v;var vf={width:f,height:v,type:B0[s],format:bE[T],wrapS:Bg[Y],wrapT:Bg[Ae],mag:Fg[Ar],min:Fg[gr],alignment:Et,flipY:x,colorSpace:SE[Pn],premultiplyAlpha:Wt,aniso:Xe,x:Ba,y:Ls,copy:Ys};n&&(vf.data=n),typeof F=="number"?vf.mipmap=EE[F]:typeof F=="boolean"&&(vf.mipmap=F),this.texture=i.texture(vf)}return(0,It.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(r)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(r){var n=r.width,a=r.height;this.texture.resize(n,a),this.width=n,this.height=a}},{key:"destroy",value:function(){if(!this.isDistroy){var r;(r=this.texture)===null||r===void 0||r.destroy()}this.isDistroy=!0}}]),e}(),Zg,Ug,FE=(Zg=(0,Yr.b2)(),Zg(Ug=function(){function e(){var i=this;(0,dt.Z)(this,e),(0,S.Z)(this,"extensionObject",void 0),(0,S.Z)(this,"gl",void 0),(0,S.Z)(this,"$container",void 0),(0,S.Z)(this,"canvas",void 0),(0,S.Z)(this,"width",void 0),(0,S.Z)(this,"height",void 0),(0,S.Z)(this,"isDirty",void 0),(0,S.Z)(this,"createModel",function(r){return new LE(i.gl,r)}),(0,S.Z)(this,"createAttribute",function(r){return new _E(i.gl,r)}),(0,S.Z)(this,"createBuffer",function(r){return new TE(i.gl,r)}),(0,S.Z)(this,"createElements",function(r){return new ME(i.gl,r)}),(0,S.Z)(this,"createTexture2D",function(r){return new DE(i.gl,r)}),(0,S.Z)(this,"createFramebuffer",function(r){return new PE(i.gl,r)}),(0,S.Z)(this,"useFramebuffer",function(r,n){i.gl({framebuffer:r?r.get():null})(n)}),(0,S.Z)(this,"clear",function(r){var n=r.color,a=r.depth,s=r.stencil,f=r.framebuffer,v=f===void 0?null:f,m={color:n,depth:a,stencil:s};m.framebuffer=v===null?v:v.get(),i.gl.clear(m)}),(0,S.Z)(this,"viewport",function(r){var n=r.x,a=r.y,s=r.width,f=r.height;i.gl._gl.viewport(n,a,s,f),i.width=s,i.height=f,i.gl._refresh()}),(0,S.Z)(this,"readPixels",function(r){var n=r.framebuffer,a=r.x,s=r.y,f=r.width,v=r.height,m={x:a,y:s,width:f,height:v};return n&&(m.framebuffer=n.get()),i.gl.read(m)}),(0,S.Z)(this,"getViewportSize",function(){return{width:i.gl._gl.drawingBufferWidth,height:i.gl._gl.drawingBufferHeight}}),(0,S.Z)(this,"getContainer",function(){if(Ji)return i.canvas;var r;return(r=i.canvas)===null||r===void 0?void 0:r.parentElement}),(0,S.Z)(this,"getCanvas",function(){return i.canvas}),(0,S.Z)(this,"getGLContext",function(){return i.gl._gl}),(0,S.Z)(this,"destroy",function(){i.canvas=null,i.gl.destroy(),i.gl=null})}return(0,It.Z)(e,[{key:"init",value:function(){var i=(0,U.Z)(q().mark(function n(a,s){var f=this;return q().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return this.canvas=a,m.next=3,new Promise(function(x,A){yE()({canvas:f.canvas,attributes:{alpha:!0,antialias:s.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:s.preserveDrawingBuffer,stencil:s.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(O,F){(O||!F)&&A(O),x(F)}})});case 3:this.gl=m.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return m.stop()}},n,this)}));function r(n,a){return i.apply(this,arguments)}return r}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(r){return!!this.getGLContext().getExtension(r)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var r=this.getGLContext();r.disable(r.CULL_FACE)}},{key:"setDirty",value:function(r){this.isDirty=r}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||Ug);function jg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Vg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?jg(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):jg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var BE=function(){function e(i){(0,dt.Z)(this,e),(0,S.Z)(this,"sceneService",void 0),(0,S.Z)(this,"mapService",void 0),(0,S.Z)(this,"controlService",void 0),(0,S.Z)(this,"layerService",void 0),(0,S.Z)(this,"iconService",void 0),(0,S.Z)(this,"markerService",void 0),(0,S.Z)(this,"popupService",void 0),(0,S.Z)(this,"fontService",void 0),(0,S.Z)(this,"interactionService",void 0),(0,S.Z)(this,"container",void 0);var r=i.id,n=i.map,a=i.canvas,s=i.hasBaseMap,f=$b();this.container=f,n.setContainer(f,r,a,s),f.bind(xt.IRendererService).to(FE).inSingletonScope(),this.sceneService=f.get(xt.ISceneService),this.mapService=f.get(xt.IMapService),this.iconService=f.get(xt.IIconService),this.fontService=f.get(xt.IFontService),this.controlService=f.get(xt.IControlService),this.layerService=f.get(xt.ILayerService),this.markerService=f.get(xt.IMarkerService),this.interactionService=f.get(xt.IInteractionService),this.popupService=f.get(xt.IPopupService),Ji?this.sceneService.initMiniScene(i):(this.initComponent(r),this.sceneService.init(i),this.initControl())}return(0,It.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(r){return this.sceneService.exportPng(r)}},{key:"exportMap",value:function(r){return this.sceneService.exportPng(r)}},{key:"registerRenderService",value:function(r){var n=this;if(this.sceneService.loaded){var a=new r(this);a.init()}else this.on("loaded",function(){var s=new r(n);s.init()})}},{key:"setBgColor",value:function(r){this.mapService.setBgColor(r)}},{key:"addLayer",value:function(r){var n=fg(this.container);r.setContainer(n,this.container),this.sceneService.addLayer(r);var a=r.getLayerConfig();if(a){var s=a.mask,f=a.maskfence,v=a.maskColor,m=v===void 0?"#000":v,x=a.maskOpacity,A=x===void 0?0:x;if(s&&f){var T=new mE().source(f).shape("fill").color(m).style({opacity:A});this.addMask(T,r.id)}}else console.warn("addLayer should run after scene loaded!")}},{key:"addMask",value:function(r,n){var a=this.getLayer(n);if(a){var s=fg(this.container);r.setContainer(s,this.container),a.addMaskLayer(r),this.sceneService.addLayer(r)}else console.warn("parent layer not find!")}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(r){return this.layerService.getLayer(r)}},{key:"getLayerByName",value:function(r){return this.layerService.getLayerByName(r)}},{key:"removeLayer",value:function(r,n){this.layerService.remove(r,n)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(r){this.layerService.setEnableRender(r)}},{key:"addIconFont",value:function(r,n){this.fontService.addIconFont(r,n)}},{key:"addIconFonts",value:function(r){var n=this;r.forEach(function(a){var s=(0,mn.Z)(a,2),f=s[0],v=s[1];n.fontService.addIconFont(f,v)})}},{key:"addFontFace",value:function(r,n){this.sceneService.addFontFace(r,n)}},{key:"addImage",value:function(r,n){Ji?this.iconService.addImageMini(r,n,this.sceneService):this.iconService.addImage(r,n)}},{key:"hasImage",value:function(r){return this.iconService.hasImage(r)}},{key:"removeImage",value:function(r){this.iconService.removeImage(r)}},{key:"addIconFontGlyphs",value:function(r,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(r){this.controlService.addControl(r,this.container)}},{key:"removeControl",value:function(r){this.controlService.removeControl(r)}},{key:"getControlByName",value:function(r){return this.controlService.getControlByName(r)}},{key:"addMarker",value:function(r){this.markerService.addMarker(r)}},{key:"addMarkerLayer",value:function(r){this.markerService.addMarkerLayer(r)}},{key:"removeMarkerLayer",value:function(r){this.markerService.removeMarkerLayer(r)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(r){this.popupService.addPopup(r)}},{key:"on",value:function(r,n){L0.indexOf(r)===-1?this.mapService.on(r,n):this.sceneService.on(r,n)}},{key:"once",value:function(r,n){L0.indexOf(r)===-1?this.mapService.once(r,n):this.sceneService.once(r,n)}},{key:"off",value:function(r,n){L0.indexOf(r)===-1?this.mapService.off(r,n):this.sceneService.off(r,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(r){return this.mapService.getCenter(r)}},{key:"setCenter",value:function(r,n){return this.mapService.setCenter(r,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(r){return this.mapService.setPitch(r)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(r){this.mapService.setRotation(r)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(r){this.mapService.panTo(r)}},{key:"panBy",value:function(r,n){this.mapService.panBy(r,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(r){this.mapService.setZoom(r)}},{key:"fitBounds",value:function(r,n){var a=this.sceneService.getSceneConfig(),s=a.fitBoundsOptions,f=a.animate;this.mapService.fitBounds(r,n||Vg(Vg({},s),{},{animate:f}))}},{key:"setZoomAndCenter",value:function(r,n){this.mapService.setZoomAndCenter(r,n)}},{key:"setMapStyle",value:function(r){this.mapService.setMapStyle(r)}},{key:"setMapStatus",value:function(r){this.mapService.setMapStatus(r)}},{key:"pixelToLngLat",value:function(r){return this.mapService.pixelToLngLat(r)}},{key:"lngLatToPixel",value:function(r){return this.mapService.lngLatToPixel(r)}},{key:"containerToLngLat",value:function(r){return this.mapService.containerToLngLat(r)}},{key:"lngLatToContainer",value:function(r){return this.mapService.lngLatToContainer(r)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(r,n){this.container.bind(xt.IPostProcessingPass).to(r).whenTargetNamed(n)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(r){this.controlService.init({container:Pa(r)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var r=this.sceneService.getSceneConfig(),n=r.logoVisible,a=r.logoPosition;n&&this.addControl(new g2({position:a}))}}]),e}(),up,Gg=(up={},(0,S.Z)(up,Ws.additive,{enable:!0,func:{srcRGB:k.ONE,dstRGB:k.ONE,srcAlpha:1,dstAlpha:1}}),(0,S.Z)(up,Ws.none,{enable:!1}),(0,S.Z)(up,Ws.normal,{enable:!0,func:{srcRGB:k.SRC_ALPHA,dstRGB:k.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,S.Z)(up,Ws.subtractive,{enable:!0,func:{srcRGB:k.ONE,dstRGB:k.ONE,srcAlpha:k.ZERO,dstAlpha:k.ONE_MINUS_SRC_COLOR},equation:{rgb:k.FUNC_SUBTRACT,alpha:k.FUNC_SUBTRACT}}),(0,S.Z)(up,Ws.max,{enable:!0,func:{srcRGB:k.ONE,dstRGB:k.ONE},equation:{rgb:k.MAX_EXT}}),(0,S.Z)(up,Ws.min,{enable:!0,func:{srcRGB:k.ONE,dstRGB:k.ONE},equation:{rgb:k.MIN_EXT}}),up),WP=1024;function ol(e,i,r,n,a){i.updateStyleAttribute(e,r,n,a)}function NE(e,i){e.opacity&&Gv("opacity",i,e.opacity),e.strokeWidth&&Gv("strokeWidth",i,e.strokeWidth),e.strokeOpacity&&Gv("strokeOpacity",i,e.strokeOpacity),e.stroke&&zE("stroke",i,e.stroke),e.offsets&&Hg("offsets",i,e.offsets),e.textOffset&&Hg("textOffset",i,e.textOffset),e.thetaOffset&&Gv("thetaOffset",i,e.thetaOffset)}function Gv(e,i,r){w()(r)?ol(e,i,r,function(n){return n}):ki()(r)?ol(e,i,[r],void 0):Array.isArray(r)&&r.length===2?w()(r[0])&&L()(r[1])||w()(r[0])&&Array.isArray(r[1])&&ki()(r[1][0])&&ki()(r[1][1])?ol(e,i,r[0],r[1]):ol(e,i,[1],void 0):ol(e,i,[1],void 0)}function Hg(e,i,r){w()(r)?ol(e,i,r,function(n){return n}):Array.isArray(r)&&r.length===2&&w()(r[0])&&L()(r[1])?ol(e,i,r[0],r[1]):Array.isArray(r)&&r.length===2&&ki()(r[0])&&ki()(r[1])?ol(e,i,r,void 0):ol(e,i,[0,0],void 0)}function zE(e,i,r){w()(r)?ol(e,i,r,void 0):Array.isArray(r)&&r.length===2&&(w()(r[0])&&L()(r[1])||w()(r[0])&&Array.isArray(r[1])&&r[1].length>0)?ol(e,i,r[0],r[1]):ol(e,i,"#fff",void 0)}function Wg(e){return e.map(function(i){return typeof i=="string"&&(i=[i,{}]),i})}function Xg(e,i,r,n){var a=e.multiPassRenderer,s=e.getLayerConfig(),f=s.enablePicking,v=s.enableTAA;return v?a.add(n("taa")):a.add(n("render")),Wg(i).forEach(function(m){var x=(0,mn.Z)(m,2),A=x[0],T=x[1];a.add(r(A),T)}),a.add(r("copy")),a}var ZE=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]];function UE(e,i,r){if(typeof i=="string"&&typeof r=="string"&&i!==r){if(e.type==="PointLayer"){e.dataState.dataSourceNeedUpdate=!0;return}ZE.map(function(n){if(n.includes(i)&&n.includes(r)){e.dataState.dataSourceNeedUpdate=!0;return}})}}var jE=["passes"],VE=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber"],Yg,N0,qg;function GE(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=HE(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function HE(e,i){if(!!e){if(typeof e=="string")return Kg(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Kg(e,i)}}function Kg(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function $g(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Xu(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?$g(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$g(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function WE(e){var i=XE();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function XE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Qg=0,zp=(Yg=tv(xt.IGlobalConfigService),N0=function(e){(0,Ir.Z)(r,e);var i=WE(r);function r(){var n,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,dt.Z)(this,r),n=i.call(this),(0,S.Z)((0,J.Z)(n),"id","".concat(Qg++)),(0,S.Z)((0,J.Z)(n),"name","".concat(Qg)),(0,S.Z)((0,J.Z)(n),"type",void 0),(0,S.Z)((0,J.Z)(n),"visible",!0),(0,S.Z)((0,J.Z)(n),"zIndex",0),(0,S.Z)((0,J.Z)(n),"minZoom",void 0),(0,S.Z)((0,J.Z)(n),"maxZoom",void 0),(0,S.Z)((0,J.Z)(n),"inited",!1),(0,S.Z)((0,J.Z)(n),"layerModelNeedUpdate",!1),(0,S.Z)((0,J.Z)(n),"pickedFeatureID",null),(0,S.Z)((0,J.Z)(n),"selectedFeatureID",null),(0,S.Z)((0,J.Z)(n),"styleNeedUpdate",!1),(0,S.Z)((0,J.Z)(n),"rendering",void 0),(0,S.Z)((0,J.Z)(n),"clusterZoom",0),(0,S.Z)((0,J.Z)(n),"layerType",void 0),(0,S.Z)((0,J.Z)(n),"isLayerGroup",!1),(0,S.Z)((0,J.Z)(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,S.Z)((0,J.Z)(n),"hooks",{init:new Jo,afterInit:new Jo,beforeRender:new Jo,beforeRenderData:new nu,afterRender:new ia,beforePickingEncode:new ia,afterPickingEncode:new ia,beforeHighlight:new ia(["pickedColor"]),afterHighlight:new ia,beforeSelect:new ia(["pickedColor"]),afterSelect:new ia,beforeDestroy:new ia,afterDestroy:new ia}),(0,S.Z)((0,J.Z)(n),"models",[]),(0,S.Z)((0,J.Z)(n),"multiPassRenderer",void 0),(0,S.Z)((0,J.Z)(n),"plugins",void 0),(0,S.Z)((0,J.Z)(n),"sourceOption",void 0),(0,S.Z)((0,J.Z)(n),"layerModel",void 0),(0,S.Z)((0,J.Z)(n),"shapeOption",void 0),(0,S.Z)((0,J.Z)(n),"sceneContainer",void 0),(0,S.Z)((0,J.Z)(n),"layerChildren",[]),(0,S.Z)((0,J.Z)(n),"masks",[]),Nn((0,J.Z)(n),"configService",qg,(0,J.Z)(n)),(0,S.Z)((0,J.Z)(n),"shaderModuleService",void 0),(0,S.Z)((0,J.Z)(n),"cameraService",void 0),(0,S.Z)((0,J.Z)(n),"coordinateService",void 0),(0,S.Z)((0,J.Z)(n),"iconService",void 0),(0,S.Z)((0,J.Z)(n),"fontService",void 0),(0,S.Z)((0,J.Z)(n),"pickingService",void 0),(0,S.Z)((0,J.Z)(n),"rendererService",void 0),(0,S.Z)((0,J.Z)(n),"layerService",void 0),(0,S.Z)((0,J.Z)(n),"interactionService",void 0),(0,S.Z)((0,J.Z)(n),"mapService",void 0),(0,S.Z)((0,J.Z)(n),"styleAttributeService",void 0),(0,S.Z)((0,J.Z)(n),"layerSource",void 0),(0,S.Z)((0,J.Z)(n),"postProcessingPassFactory",void 0),(0,S.Z)((0,J.Z)(n),"normalPassFactory",void 0),(0,S.Z)((0,J.Z)(n),"animateOptions",{enable:!1}),(0,S.Z)((0,J.Z)(n),"container",void 0),(0,S.Z)((0,J.Z)(n),"encodedData",void 0),(0,S.Z)((0,J.Z)(n),"configSchema",void 0),(0,S.Z)((0,J.Z)(n),"currentPickId",null),(0,S.Z)((0,J.Z)(n),"rawConfig",void 0),(0,S.Z)((0,J.Z)(n),"needUpdateConfig",void 0),(0,S.Z)((0,J.Z)(n),"pendingStyleAttributes",[]),(0,S.Z)((0,J.Z)(n),"scaleOptions",{}),(0,S.Z)((0,J.Z)(n),"animateStartTime",void 0),(0,S.Z)((0,J.Z)(n),"aniamateStatus",!1),(0,S.Z)((0,J.Z)(n),"bottomColor","rgba(0, 0, 0, 0)"),(0,S.Z)((0,J.Z)(n),"isDestroied",!1),(0,S.Z)((0,J.Z)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var s=n.getLayerConfig(),f=s.autoFit,v=s.fitBoundsOptions;f&&n.fitBounds(v),n.reRender()}),n.name=a.name||n.id,n.zIndex=a.zIndex||0,n.rawConfig=a,n}return(0,It.Z)(r,[{key:"addMaskLayer",value:function(a){this.masks.push(a)}},{key:"removeMaskLayer",value:function(a){var s=this.masks.indexOf(a);s>-1&&this.masks.splice(s,1),a.destroy()}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(a){if(!this.inited)this.needUpdateConfig=Xu(Xu({},this.needUpdateConfig),a);else{var s=this.container.get(xt.SceneID);NE(a,this),this.configService.setLayerConfig(s,this.id,Xu(Xu(Xu({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),a)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(a,s){this.container=a,this.sceneContainer=s}},{key:"getContainer",value:function(){return this.container}},{key:"setBottomColor",value:function(a){this.bottomColor=a}},{key:"getBottomColor",value:function(){return this.bottomColor}},{key:"addPlugin",value:function(a){return this.plugins.push(a),this}},{key:"init",value:function(){var a=this,s=this.container.get(xt.SceneID);this.configService.setLayerConfig(s,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(xt.IIconService),this.fontService=this.container.get(xt.IFontService),this.rendererService=this.container.get(xt.IRendererService),this.layerService=this.container.get(xt.ILayerService),this.interactionService=this.container.get(xt.IInteractionService),this.pickingService=this.container.get(xt.IPickingService),this.mapService=this.container.get(xt.IMapService);var f=this.getLayerConfig(),v=f.enableMultiPassRenderer,m=f.passes;v&&m!==null&&m!==void 0&&m.length&&m.length>0&&this.mapService.on("mapAfterFrameChange",function(){a.renderLayers()}),this.cameraService=this.container.get(xt.ICameraService),this.coordinateService=this.container.get(xt.ICoordinateSystemService),this.shaderModuleService=this.container.get(xt.IShaderModuleService),this.postProcessingPassFactory=this.container.get(xt.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(xt.IFactoryNormalPass),this.styleAttributeService=this.container.get(xt.IStyleAttributeService),this.multiPassRenderer=this.container.get(xt.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(O){var F=O.attributeName,j=O.attributeField,Y=O.attributeValues,ee=O.updateOptions;a.styleAttributeService.updateStyleAttribute(F,{scale:Xu({field:j},a.splitValuesAndCallbackInAttribute(Y,a.getLayerConfig()[F]))},ee)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(xt.ILayerPlugin);var x=GE(this.plugins),A;try{for(x.s();!(A=x.n()).done;){var T=A.value;T.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(O){x.e(O)}finally{x.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(Xu(Xu({},this.getDefaultConfig()),this.rawConfig));var a=this.getLayerConfig(),s=a.animateOption;s!=null&&s.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(a,s,f){return this.updateStyleAttribute("color",a,s,f),this}},{key:"texture",value:function(a,s,f){return this.updateStyleAttribute("texture",a,s,f),this}},{key:"rotate",value:function(a,s,f){return this.updateStyleAttribute("rotate",a,s,f),this}},{key:"size",value:function(a,s,f){return this.updateStyleAttribute("size",a,s,f),this}},{key:"filter",value:function(a,s,f){return this.updateStyleAttribute("filter",a,s,f),this}},{key:"shape",value:function(a,s,f){var v,m,x,A=(v=this.styleAttributeService)===null||v===void 0||(m=v.getLayerStyleAttribute("shape"))===null||m===void 0||(x=m.scale)===null||x===void 0?void 0:x.field,T=a;return this.shapeOption={field:a,values:s},this.updateStyleAttribute("shape",a,s,f),UE(this,A,T),this}},{key:"label",value:function(a,s,f){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:a,attributeValues:s,updateOptions:f}),this}},{key:"animate",value:function(a){var s={};return to()(a)?(s.enable=!0,s=Xu(Xu({},s),a)):s.enable=a,this.updateLayerConfig({animateOption:s}),this}},{key:"source",value:function(a,s){return a!=null&&a.data?(this.setSource(a),this):(this.sourceOption={data:a,options:s},this.clusterZoom=0,this)}},{key:"setData",value:function(a,s){var f=this;return this.inited?this.layerSource.setData(a,s):this.on("inited",function(){var v=f.getSource();v?f.layerSource.setData(a,s):(f.source(new Fh(a,s)),f.sourceEvent())}),this}},{key:"style",value:function(a){var s=this,f=this.getLayerConfig(),v=a.passes,m=(0,Ga.Z)(a,jE);return v&&Wg(v).forEach(function(x){var A=s.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(x[0]);A&&A.updateOptions(x[1])}),this.rawConfig=Xu(Xu({},this.rawConfig),m),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),f&&f.mask===!0&&a.mask===!1&&(this.clearModels(),this.models=this.layerModel.buildModels()),this}},{key:"scale",value:function(a,s){return to()(a)?this.scaleOptions=Xu(Xu({},this.scaleOptions),a):this.scaleOptions[a]=s,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.getEncodedData().length!==0&&this.renderModels(),this}},{key:"renderMultiPass",value:function(){var n=(0,U.Z)(q().mark(function s(){return q().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(this.getEncodedData().length===0){v.next=7;break}if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){v.next=6;break}return v.next=4,this.multiPassRenderer.render();case 4:v.next=7;break;case 6:this.multiPassRenderer?this.renderModels():this.renderModels();case 7:case"end":return v.stop()}},s,this)}));function a(){return n.apply(this,arguments)}return a}()},{key:"active",value:function(a){var s={};return s.enableHighlight=to()(a)?!0:a,to()(a)?(s.enableHighlight=!0,a.color&&(s.highlightColor=a.color),a.mix&&(s.activeMix=a.mix)):s.enableHighlight=!!a,this.updateLayerConfig(s),this}},{key:"setActive",value:function(a,s){var f=this;if(to()(a)){var v=a.x,m=v===void 0?0:v,x=a.y,A=x===void 0?0:x;this.updateLayerConfig({highlightColor:to()(s)?s.color:this.getLayerConfig().highlightColor,activeMix:to()(s)?s.mix:this.getLayerConfig().activeMix}),this.pick({x:m,y:A})}else this.updateLayerConfig({pickedFeatureID:a,highlightColor:to()(s)?s.color:this.getLayerConfig().highlightColor,activeMix:to()(s)?s.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call(ss(a)).then(function(){setTimeout(function(){f.reRender()},1)})}},{key:"select",value:function(a){var s={};return s.enableSelect=to()(a)?!0:a,to()(a)?(s.enableSelect=!0,a.color&&(s.selectColor=a.color),a.mix&&(s.selectMix=a.mix)):s.enableSelect=!!a,this.updateLayerConfig(s),this}},{key:"setSelect",value:function(a,s){var f=this;if(to()(a)){var v=a.x,m=v===void 0?0:v,x=a.y,A=x===void 0?0:x;this.updateLayerConfig({selectColor:to()(s)?s.color:this.getLayerConfig().selectColor,selectMix:to()(s)?s.mix:this.getLayerConfig().selectMix}),this.pick({x:m,y:A})}else this.updateLayerConfig({pickedFeatureID:a,selectColor:to()(s)?s.color:this.getLayerConfig().selectColor,selectMix:to()(s)?s.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(ss(a)).then(function(){setTimeout(function(){f.reRender()},1)})}},{key:"setBlend",value:function(a){return this.updateLayerConfig({blend:a}),this.layerModelNeedUpdate=!0,this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(a){return this.zIndex=a,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(a){this.currentPickId=a}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(a){this.selectedFeatureID=a}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var a=this.mapService.getZoom(),s=this.getLayerConfig(),f=s.visible,v=s.minZoom,m=v===void 0?-Infinity:v,x=s.maxZoom,A=x===void 0?Infinity:x;return!!f&&a>=m&&a<=A}},{key:"setMultiPass",value:function(a,s){if(this.updateLayerConfig({enableMultiPassRenderer:a}),s&&this.updateLayerConfig({passes:s}),a){var f=this.getLayerConfig(),v=f.passes,m=v===void 0?[]:v;this.multiPassRenderer=Xg(this,m,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var x=this.rendererService.getViewportSize(),A=x.width,T=x.height;this.multiPassRenderer.resize(A,T)}return this}},{key:"setMinZoom",value:function(a){return this.updateLayerConfig({minZoom:a}),this}},{key:"getMinZoom",value:function(){var a=this.getLayerConfig(),s=a.minZoom;return s}},{key:"getMaxZoom",value:function(){var a=this.getLayerConfig(),s=a.maxZoom;return s}},{key:"get",value:function(a){var s=this.getLayerConfig();return s[a]}},{key:"setMaxZoom",value:function(a){return this.updateLayerConfig({maxZoom:a}),this}},{key:"setAutoFit",value:function(a){return this.updateLayerConfig({autoFit:a}),this}},{key:"fitBounds",value:function(a){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var s=this.getSource(),f=s.extent,v=f.some(function(m){return Math.abs(m)===Infinity});return v?this:(this.mapService.fitBounds([[f[0],f[1]],[f[2],f[3]]],a),this)}},{key:"destroy",value:function(){var a;this.isDestroied||(this.layerChildren.map(function(s){return s.destroy()}),this.layerChildren=[],this.masks.map(function(s){return s.destroy()}),this.masks=[],this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(a=this.layerModel)===null||a===void 0||a.clearModels(),this.models=[],this.layerService.cleanRemove(this),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroied=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(a){return a.destroy()}),this.layerModel.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(a){return a.needRescale||a.needRemapping||a.needRegenerateVertices}).length}},{key:"setSource",value:function(a){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=a,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var s=this.mapService.getZoom();this.layerSource.updateClusterData(s)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(a){this.encodedData=a}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(a){return this.styleAttributeService.getLayerAttributeScale(a)}},{key:"getLegendItems",value:function(a){var s=this.styleAttributeService.getLayerAttributeScale(a);if(!s)return[];if(s.invertExtent){var f=s.range().map(function(x){return(0,S.Z)({value:s.invertExtent(x)},a,x)});return f}else if(s.ticks){var v=s.ticks().map(function(x){return(0,S.Z)({value:x},a,s(x))});return v}else if(s!=null&&s.domain){var m=s.domain().filter(function(x){return!Sg()(x)}).map(function(x){return(0,S.Z)({value:x},a,s(x))});return m}return[]}},{key:"pick",value:function(a){var s=a.x,f=a.y;this.interactionService.triggerHover({x:s,y:f})}},{key:"boxSelect",value:function(a,s){this.pickingService.boxPickLayer(this,a,s)}},{key:"buildLayerModel",value:function(a){var s=a.moduleName,f=a.vertexShader,v=a.fragmentShader,m=a.triangulation,x=a.segmentNumber,A=(0,Ga.Z)(a,VE);this.shaderModuleService.registerModule(s,{vs:f,fs:v});var T=this.shaderModuleService.getModule(s),O=T.vs,F=T.fs,j=T.uniforms,Y=this.rendererService.createModel,ee=this.styleAttributeService.createAttributesAndIndices(this.encodedData,m,x),Ae=ee.attributes,Fe=ee.elements;return Y(Xu({attributes:Ae,uniforms:j,fs:F,vs:O,elements:Fe,blend:Gg[Ws.normal]},A))}},{key:"createAttrubutes",value:function(a){var s=a.triangulation,f=this.styleAttributeService.createAttributes(this.encodedData,s),v=f.attributes;return v}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(a){var s=this.getLayerConfig(),f=s.enableHighlight,v=f===void 0?!0:f,m=s.enableSelect,x=m===void 0?!0:m,A=this.eventNames().indexOf(a)!==-1||this.eventNames().indexOf("un"+a)!==-1;return(a==="click"||a==="dblclick")&&x&&(A=!0),a==="mousemove"&&(v||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(A=!0),this.isVisible()&&A}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderMulPass",value:function(){var n=(0,U.Z)(q().mark(function s(f){return q().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,f.render();case 2:case"end":return m.stop()}},s)}));function a(s){return n.apply(this,arguments)}return a}()},{key:"renderModels",value:function(a){var s=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.layerModel.renderUpdate&&this.layerModel.renderUpdate(),this.models.forEach(function(f){f.draw({uniforms:s.layerModel.getUninforms()},a)})),this}},{key:"updateStyleAttribute",value:function(a,s,f,v){this.inited?this.styleAttributeService.updateStyleAttribute(a,{scale:Xu({field:s},this.splitValuesAndCallbackInAttribute(f,this.getLayerConfig()[s]))},v):this.pendingStyleAttributes.push({attributeName:a,attributeField:s,attributeValues:f,updateOptions:v})}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(a){console.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&(this.layerService.updateLayerRenderList(),this.layerService.renderLayers())}},{key:"splitValuesAndCallbackInAttribute",value:function(a,s){return{values:L()(a)?void 0:a||s,callback:L()(a)?a:void 0}}}]),r}(cs.EventEmitter),qg=ni(N0.prototype,"configService",[Yg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N0),Jg,z0,ey;function YE(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=qE(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function qE(e,i){if(!!e){if(typeof e=="string")return ty(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ty(e,i)}}function ty(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Lo=(Jg=tv(xt.IGlobalConfigService),z0=function(){function e(i){(0,dt.Z)(this,e),(0,S.Z)(this,"triangulation",void 0),(0,S.Z)(this,"createTexture2D",void 0),(0,S.Z)(this,"layer",void 0),(0,S.Z)(this,"dataTexture",void 0),(0,S.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,S.Z)(this,"rowCount",void 0),(0,S.Z)(this,"cacheStyleProperties",void 0),(0,S.Z)(this,"cellLength",void 0),(0,S.Z)(this,"cellProperties",void 0),(0,S.Z)(this,"cellTypeLayout",void 0),(0,S.Z)(this,"stylePropertyesExist",void 0),(0,S.Z)(this,"dataTextureTest",void 0),Nn(this,"configService",ey,this),(0,S.Z)(this,"shaderModuleService",void 0),(0,S.Z)(this,"rendererService",void 0),(0,S.Z)(this,"iconService",void 0),(0,S.Z)(this,"fontService",void 0),(0,S.Z)(this,"styleAttributeService",void 0),(0,S.Z)(this,"mapService",void 0),(0,S.Z)(this,"cameraService",void 0),(0,S.Z)(this,"layerService",void 0),this.layer=i,this.rendererService=i.getContainer().get(xt.IRendererService),this.shaderModuleService=i.getContainer().get(xt.IShaderModuleService),this.styleAttributeService=i.getContainer().get(xt.IStyleAttributeService),this.mapService=i.getContainer().get(xt.IMapService),this.iconService=i.getContainer().get(xt.IIconService),this.fontService=i.getContainer().get(xt.IFontService),this.cameraService=i.getContainer().get(xt.ICameraService),this.layerService=i.getContainer().get(xt.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var r=this.rendererService.createTexture2D;this.createTexture2D=r,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8Array(4),mag:k.NEAREST,min:k.NEAREST,width:1,height:1}))}return(0,It.Z)(e,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,this.stylePropertyesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(r){var n=!1;return Ic()(r.thetaOffset,this.cacheStyleProperties.thetaOffset)||(n=!0,this.cacheStyleProperties.thetaOffset=r.thetaOffset),Ic()(r.opacity,this.cacheStyleProperties.opacity)||(n=!0,this.cacheStyleProperties.opacity=r.opacity),Ic()(r.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(n=!0,this.cacheStyleProperties.strokeOpacity=r.strokeOpacity),Ic()(r.strokeWidth,this.cacheStyleProperties.strokeWidth)||(n=!0,this.cacheStyleProperties.strokeWidth=r.strokeWidth),Ic()(r.stroke,this.cacheStyleProperties.stroke)||(n=!0,this.cacheStyleProperties.stroke=r.stroke),Ic()(r.offsets,this.cacheStyleProperties.offsets)||(n=!0,this.cacheStyleProperties.offsets=r.offsets),this.dataTexture===void 0&&(n=!0),n}},{key:"judgeStyleAttributes",value:function(r){this.clearLastCalRes(),r.opacity!==void 0&&!ki()(r.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),r.strokeOpacity!==void 0&&!ki()(r.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),r.strokeWidth!==void 0&&!ki()(r.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),r.stroke!==void 0&&!this.isStaticColor(r.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),r.offsets!==void 0&&!this.isOffsetStatic(r.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2),r.thetaOffset!==void 0&&!ki()(r.thetaOffset)&&(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertyesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(r){return w()(r)?!!(0,Ns.ZP)(r):!1}},{key:"getStrokeColor",value:function(r){if(this.isStaticColor(r)){var n=pi(r);return n[0]=n[0]?n[0]:0,n[1]=n[1]?n[1]:0,n[2]=n[2]?n[2]:0,n[3]=n[3]?n[3]:0,n}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(r){return!!(Array.isArray(r)&&r.length===2&&ki()(r[0])&&ki()(r[1]))}},{key:"patchMod",value:function(r,n){for(var a=0;a<n;a++)r.push(-1)}},{key:"patchData",value:function(r,n,a){var s=YE(a),f;try{for(s.s();!(f=s.n()).done;){var v=f.value,m=v.attr,x=v.count,A=n[m];A!==void 0?m==="stroke"?r.push.apply(r,(0,pe.Z)(pi(A))):m==="offsets"?this.isOffsetStatic(A)?r.push(-A[0],A[1]):r.push(0,0):r.push(ki()(A)?A:1):this.patchMod(r,x)}}catch(T){s.e(T)}finally{s.f()}}},{key:"calDataFrame",value:function(r,n,a){for(var s=n.length,f=Math.ceil(s*r/this.DATA_TEXTURE_WIDTH),v=f*this.DATA_TEXTURE_WIDTH,m=[],x=0;x<s;x++){var A=n[x];this.patchData(m,A,a)}for(var T=m.length;T<v;T++)m.push(-1);return{data:m,width:this.DATA_TEXTURE_WIDTH,height:f}}},{key:"getBlend",value:function(){var r=this.layer.getLayerConfig(),n=r.blend,a=n===void 0?"normal":n;return Gg[Ws[a]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.duration||4,r.interval||.2,r.trailLength||.1]}},{key:"startModelAnimate",value:function(){var r=this.layer.getLayerConfig(),n=r.animateOption;n.enable&&this.layer.setAnimateStartTime()}}]),e}(),ey=ni(z0.prototype,"configService",[Jg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z0),ry=100,XP=36,YP=40;function ny(e){return e/180*Math.acos(-1)}function iy(e){var i=ny(e[0])+Math.PI/2,r=ny(e[1]),n=ry+Math.random()*.4,a=n*Math.cos(r)*Math.cos(i),s=n*Math.cos(r)*Math.sin(i),f=n*Math.sin(r);return[s,f,a]}function qP(e,i){var r=mat4.create(),n=mat4.create(),a=vec3.fromValues(0,1,0),s=vec3.fromValues(0,0,0);i=i||{},e=typeof e!="undefined"?e:1;for(var f=typeof i.segments!="undefined"?i.segments:32,v=2+f,m=2*v,x=[],A=[],T=[],O=[],F=[],j=[],Y=0;Y<=v;Y++){for(var ee=Y/v,Ae=ee*Math.PI,Fe=0;Fe<=m;Fe++){var Xe=Fe/m,nt=Xe*Math.PI*2;mat4.identity(n),mat4.rotateZ(n,n,-Ae),mat4.identity(r),mat4.rotateY(r,r,nt),vec3.transformMat4(s,a,n),vec3.transformMat4(s,s,r),vec3.scale(s,s,-e),T.push(s.slice()),O.push.apply(O,_toConsumableArray(s.slice())),vec3.normalize(s,s),F.push.apply(F,_toConsumableArray(s.slice())),j.push([Xe,1-ee]),O.push(Xe,1-ee)}if(Y>0)for(var Et=T.length,wt=Et-2*(m+1);wt+m+2<Et;wt++)x.push([wt,wt+1,wt+m+1]),A.push(wt,wt+1,wt+m+1),x.push([wt+m+1,wt+1,wt+m+2]),A.push(wt+m+1,wt+1,wt+m+2)}return{cells:x,positions:T,uvs:j,positionsArr:O,indicesArr:A,normalArr:F}}var xi=W(31437),Hv=xi.create(),KP=xi.create(),Xs=xi.create(),lp=xi.create(),yd=xi.create();function Z0(e,i,r,n,a){xi.add(e,r,n),xi.normalize(e,e),i=xi.fromValues(-e[1],e[0]);var s=xi.fromValues(-r[1],r[0]);return[a/xi.dot(i,s),i]}function cp(e,i){return xi.set(e,-i[1],i[0])}function _d(e,i,r){return xi.sub(e,i,r),xi.normalize(e,e),e}function U0(e,i){return e[0]===i[0]&&e[1]===i[1]}function $P(e){for(var i=new Map,r=0;r<e.length;r++){var n=e[0].toString()+"-"+e[1].toString();i.get(n)?(e.splice(r,1),r++):i.set(n,n)}return e}var ay=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,dt.Z)(this,e),(0,S.Z)(this,"complex",void 0),(0,S.Z)(this,"join",void 0),(0,S.Z)(this,"cap",void 0),(0,S.Z)(this,"miterLimit",void 0),(0,S.Z)(this,"thickness",void 0),(0,S.Z)(this,"normal",void 0),(0,S.Z)(this,"lastFlip",-1),(0,S.Z)(this,"miter",xi.fromValues(0,0)),(0,S.Z)(this,"started",!1),(0,S.Z)(this,"dash",!1),(0,S.Z)(this,"totalDistance",0),(0,S.Z)(this,"currentIndex",0),this.join=i.join||"miter",this.cap=i.cap||"butt",this.miterLimit=i.miterLimit||10,this.thickness=i.thickness||1,this.dash=i.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,It.Z)(e,[{key:"extrude_gaode2",value:function(r,n){var a=this.complex;if(r.length<=1)return a;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var s=r.length,f=a.startIndex,v=1;v<s;v++){var m,x,A,T=r[v-1];T.push((m=n[v-1][2])!==null&&m!==void 0?m:0);var O=n[v-1],F=r[v];F.push((x=n[v][2])!==null&&x!==void 0?x:0);var j=n[v],Y=v<r.length-1?[].concat((0,pe.Z)(r[v+1]),[(A=n[v+1][2])!==null&&A!==void 0?A:0]):null,ee=v<n.length-1?n[v+1]:null,Ae=this.segment_gaode2(a,f,T,F,Y,O,j,ee);f+=Ae}if(this.dash)for(var Fe=0;Fe<a.positions.length/6;Fe++)a.positions[Fe*6+5]=this.totalDistance;return a.startIndex=a.positions.length/6,a}},{key:"simpleExtrude_gaode2",value:function(r,n){var a=this.complex;if(r.length<=1)return a;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var s=r.length,f=a.startIndex,v=1;v<s;v++){var m,x,A,T=r[v-1];T.push((m=n[v-1][2])!==null&&m!==void 0?m:0);var O=n[v-1],F=r[v];F.push((x=n[v][2])!==null&&x!==void 0?x:0);var j=n[v],Y=v<r.length-1?[].concat((0,pe.Z)(r[v+1]),[(A=n[v+1][2])!==null&&A!==void 0?A:0]):null,ee=v<n.length-1?n[v+1]:null,Ae=this.simpleSegment(a,f,T,F,Y,O,j,ee);f+=Ae}if(this.dash)for(var Fe=0;Fe<a.positions.length/6;Fe++)a.positions[Fe*6+5]=this.totalDistance;return a.startIndex=a.positions.length/6,a}},{key:"extrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=r.length,s=n.startIndex,f=1;f<a;f++){var v=r[f-1],m=r[f],x=f<r.length-1?r[f+1]:null,A=this.segment(n,s,v,m,x);s+=A}if(this.dash)for(var T=0;T<n.positions.length/6;T++)n.positions[T*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=r.length,s=n.startIndex,f=1;f<a;f++){var v=r[f-1],m=r[f],x=f<r.length-1?r[f+1]:null,A=this.simpleSegment(n,s,v,m,x);s+=A}if(this.dash)for(var T=0;T<n.positions.length/6;T++)n.positions[T*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(r,n,a,s,f,v,m,x){var A=0,T=r.indices,O=r.positions,F=r.normals,j=this.cap==="square",Y=this.join==="bevel",ee=os([m[0],m[1]]),Ae=os([v[0],v[1]]);_d(Xs,s,a);var Fe=0;if(this.dash&&(Fe=this.lineSegmentDistance(ee,Ae),this.totalDistance+=Fe),this.normal||(this.normal=xi.create(),cp(this.normal,Xs)),!this.started)if(this.started=!0,j){var Xe=xi.create(),nt=xi.create();xi.add(Xe,this.normal,Xs),xi.add(nt,this.normal,Xs),F.push(nt[0],nt[1],0),F.push(Xe[0],Xe[1],0),O.push(a[0],a[1],a[2]|0,this.totalDistance-Fe,-this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),O.push(a[0],a[1],a[2]|0,this.totalDistance-Fe,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(O,F,a,this.normal,this.thickness,this.totalDistance-Fe);if(T.push(n+0,n+1,n+2),f){U0(s,f)&&xi.add(f,s,xi.normalize(f,xi.subtract(f,s,a))),_d(lp,f,s);var Wt=Z0(yd,xi.create(),Xs,lp,this.thickness),ur=(0,mn.Z)(Wt,2),Ar=ur[0],Jr=ur[1],gr=xi.dot(yd,this.normal)<0?-1:1,vn=Y;if(!vn&&this.join==="miter"){var Pn=Ar;Pn>this.miterLimit&&(vn=!0)}vn?(F.push(this.normal[0],this.normal[1],0),F.push(Jr[0],Jr[1],0),O.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*gr,s[2]|0),this.complex.indexes.push(this.currentIndex),O.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness*gr,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,T.push.apply(T,(0,pe.Z)(this.lastFlip!==-gr?[n,n+2,n+3]:[n+2,n+1,n+3])),T.push(n+2,n+3,n+4),cp(Hv,lp),xi.copy(this.normal,Hv),F.push(this.normal[0],this.normal[1],0),O.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*gr,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,A+=3):(this.extrusions(O,F,s,Jr,Ar,this.totalDistance),T.push.apply(T,(0,pe.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),gr=-1,xi.copy(this.normal,Jr),A+=2),this.lastFlip=gr}else{if(cp(this.normal,Xs),j){var Et=xi.create(),wt=xi.create();xi.sub(wt,Xs,this.normal),xi.add(Et,Xs,this.normal),F.push(wt[0],wt[1],0),F.push(Et[0],Et[1],0),O.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),O.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(O,F,s,this.normal,this.thickness,this.totalDistance);T.push.apply(T,(0,pe.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),A+=2}return A}},{key:"simpleSegment",value:function(r,n,a,s,f){var v=0,m=r.indices,x=r.positions,A=r.normals,T=os([s[0],s[1]]),O=os([a[0],a[1]]);_d(Xs,T,O);var F=0;if(this.dash&&(F=this.lineSegmentDistance(T,O),this.totalDistance+=F),this.normal||(this.normal=xi.create(),cp(this.normal,Xs)),this.started||(this.started=!0,this.extrusions(x,A,a,this.normal,this.thickness,this.totalDistance-F)),m.push(n+0,n+1,n+2),!f)cp(this.normal,Xs),this.extrusions(x,A,s,this.normal,this.thickness,this.totalDistance),m.push.apply(m,(0,pe.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),v+=2;else{var j=os([f[0],f[1]]);U0(T,j)&&xi.add(j,T,xi.normalize(j,xi.subtract(j,T,O))),_d(lp,j,T);var Y=Z0(yd,xi.create(),Xs,lp,this.thickness),ee=(0,mn.Z)(Y,2),Ae=ee[0],Fe=ee[1],Xe=xi.dot(yd,this.normal)<0?-1:1;this.extrusions(x,A,s,Fe,Ae,this.totalDistance),m.push.apply(m,(0,pe.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Xe=-1,xi.copy(this.normal,Fe),v+=2,this.lastFlip=Xe}return v}},{key:"segment",value:function(r,n,a,s,f){var v=0,m=r.indices,x=r.positions,A=r.normals,T=this.cap==="square",O=this.join==="bevel",F=os([s[0],s[1]]),j=os([a[0],a[1]]);_d(Xs,F,j);var Y=0;if(this.dash&&(Y=this.lineSegmentDistance(F,j),this.totalDistance+=Y),this.normal||(this.normal=xi.create(),cp(this.normal,Xs)),!this.started)if(this.started=!0,T){var ee=xi.create(),Ae=xi.create();xi.add(ee,this.normal,Xs),xi.add(Ae,this.normal,Xs),A.push(Ae[0],Ae[1],0),A.push(ee[0],ee[1],0),x.push(a[0],a[1],a[2]|0,this.totalDistance-Y,-this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),x.push(a[0],a[1],a[2]|0,this.totalDistance-Y,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(x,A,a,this.normal,this.thickness,this.totalDistance-Y);if(m.push(n+0,n+1,n+2),f){var nt=os([f[0],f[1]]);U0(F,nt)&&xi.add(nt,F,xi.normalize(nt,xi.subtract(nt,F,j))),_d(lp,nt,F);var Et=Z0(yd,xi.create(),Xs,lp,this.thickness),wt=(0,mn.Z)(Et,2),Wt=wt[0],ur=wt[1],Ar=xi.dot(yd,this.normal)<0?-1:1,Jr=O;if(!Jr&&this.join==="miter"){var gr=Wt;gr>this.miterLimit&&(Jr=!0)}Jr?(A.push(this.normal[0],this.normal[1],0),A.push(ur[0],ur[1],0),x.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*Ar,s[2]|0),this.complex.indexes.push(this.currentIndex),x.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness*Ar,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,m.push.apply(m,(0,pe.Z)(this.lastFlip!==-Ar?[n,n+2,n+3]:[n+2,n+1,n+3])),m.push(n+2,n+3,n+4),cp(Hv,lp),xi.copy(this.normal,Hv),A.push(this.normal[0],this.normal[1],0),x.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*Ar,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,v+=3):(this.extrusions(x,A,s,ur,Wt,this.totalDistance),m.push.apply(m,(0,pe.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Ar=-1,xi.copy(this.normal,ur),v+=2),this.lastFlip=Ar}else{if(cp(this.normal,Xs),T){var Fe=xi.create(),Xe=xi.create();xi.sub(Xe,Xs,this.normal),xi.add(Fe,Xs,this.normal),A.push(Xe[0],Xe[1],0),A.push(Fe[0],Fe[1],0),x.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),x.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(x,A,s,this.normal,this.thickness,this.totalDistance);m.push.apply(m,(0,pe.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),v+=2}return v}},{key:"extrusions",value:function(r,n,a,s,f,v){n.push(s[0],s[1],0),n.push(s[0],s[1],0),r.push(a[0],a[1],a[2]|0,v,-f,a[2]|0),this.complex.indexes.push(this.currentIndex),r.push(a[0],a[1],a[2]|0,v,f,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(r,n){var a=n[0]-r[0],s=n[1]-r[1];return Math.sqrt(a*a+s*s)}}]),e}();function Zp(e){if(ki()(e[0]))return e;if(ki()(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(ki()(e[0][0][0])){var i=e,r=0,n=0,a=0;return i.forEach(function(s){s.forEach(function(f){r+=f[0],n+=f[1],a++})}),[r/a,n/a,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function KE(e){for(var i=e[0],r=e[1],n=e[0],a=e[1],s=0,f=0,v=0,m=0;m<e.length;m+=2){var x=e[m],A=e[m+1];x&&A&&(i=Math.max(x,i),r=Math.max(A,r),n=Math.min(x,n),a=Math.min(A,a),s+=x,f+=A,v++)}return{center:[s/v,f/v],radius:Math.sqrt(Math.pow(i-n,2)+Math.pow(r-a,2))/2}}var Ya=W(77160);function $E(e){var i=e[0][0],r=e[0][e[0].length-1];i[0]===r[0]&&i[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var n=e[0].length,a=Oc().flatten(e),s=a.vertices,f=a.dimensions,v=[],m=[],x=0;x<s.length/f;x++)f===2?v.push(s[x*2],s[x*2+1],1):v.push(s[x*3],s[x*3+1],1);var A=Oc()(a.vertices,a.holes,a.dimensions);m.push.apply(m,(0,pe.Z)(A));for(var T=function(j){var Y=a.vertices.slice(j*f,(j+1)*f),ee=a.vertices.slice((j+1)*f,(j+2)*f);ee.length===0&&(ee=a.vertices.slice(0,f));var Ae=v.length/3;v.push(Y[0],Y[1],1,ee[0],ee[1],1,Y[0],Y[1],0,ee[0],ee[1],0),m.push.apply(m,(0,pe.Z)([0,2,1,2,3,1].map(function(Fe){return Fe+Ae})))},O=0;O<n;O++)T(O);return{positions:v,index:m}}function QE(e){var i=Oc().flatten(e),r=Oc()(i.vertices,i.holes,i.dimensions);return{positions:i.vertices,index:r}}function oy(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=e[0][0],n=e[0][e[0].length-1];r[0]===n[0]&&r[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var a=e[0].length,s=Oc().flatten(e),f=s.vertices,v=s.dimensions,m=[],x=[],A=[],T=0;T<f.length/v;T++)v===2?m.push(f[T*2],f[T*2+1],1,-1,-1):m.push(f[T*3],f[T*3+1],1,-1,-1),A.push(0,0,1);var O=Oc()(s.vertices,s.holes,s.dimensions);x.push.apply(x,(0,pe.Z)(O));for(var F=function(ee){var Ae=s.vertices.slice(ee*v,(ee+1)*v),Fe=s.vertices.slice((ee+1)*v,(ee+2)*v);Fe.length===0&&(Fe=s.vertices.slice(0,v));var Xe=m.length/5;m.push(Ae[0],Ae[1],1,0,0,Fe[0],Fe[1],1,.1,0,Ae[0],Ae[1],0,0,.8,Fe[0],Fe[1],0,.1,.8);var nt=JE([Fe[0],Fe[1],1],[Ae[0],Ae[1],0],[Ae[0],Ae[1],1],i);A.push.apply(A,(0,pe.Z)(nt).concat((0,pe.Z)(nt),(0,pe.Z)(nt),(0,pe.Z)(nt))),x.push.apply(x,(0,pe.Z)([1,2,0,3,2,1].map(function(Et){return Et+Xe})))},j=0;j<a;j++)F(j);return{positions:m,index:x,normals:A}}function JE(e,i,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,a=Ya.create(),s=Ya.create(),f=Ya.create();n&&(e=Mi(e),i=Mi(i),r=Mi(r));var v=Ya.fromValues.apply(Ya,(0,pe.Z)(e)),m=Ya.fromValues.apply(Ya,(0,pe.Z)(i)),x=Ya.fromValues.apply(Ya,(0,pe.Z)(r));Ya.sub(a,x,m),Ya.sub(s,v,m),Ya.cross(f,a,s);var A=Ya.create();return Ya.normalize(A,f),A}var Lc,Up;(function(e){e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn"})(Up||(Up={}));var jp;(function(e){e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon"})(jp||(jp={}));function av(e){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=Math.PI*2/e,n=[],a=0;a<e;a++)n.push(r*a+i*Math.PI/12);var s=n.map(function(f){var v=Math.sin(f+Math.PI/4),m=Math.cos(f+Math.PI/4);return[v,m,0]});return s}function sy(){return av(30)}function uy(){return av(4)}function ly(){return av(3)}function cy(){return av(6,1)}function fy(){return av(5)}var xd=(Lc={},(0,S.Z)(Lc,jp.CIRCLE,sy),(0,S.Z)(Lc,jp.HEXAGON,cy),(0,S.Z)(Lc,jp.TRIANGLE,ly),(0,S.Z)(Lc,jp.SQUARE,uy),(0,S.Z)(Lc,jp.PENTAGON,fy),(0,S.Z)(Lc,Up.CYLINDER,sy),(0,S.Z)(Lc,Up.HEXAGONCOLUMN,cy),(0,S.Z)(Lc,Up.TRIANGLECOLUMN,ly),(0,S.Z)(Lc,Up.SQUARECOLUMN,uy),(0,S.Z)(Lc,Up.PENTAGONCOLUMN,fy),Lc),Wv={};function bd(e){var i=Zp(e.coordinates);return{vertices:[].concat((0,pe.Z)(i),(0,pe.Z)(i),(0,pe.Z)(i),(0,pe.Z)(i)),indices:[0,1,2,2,3,0],size:i.length}}function eS(e){var i=Zp(e.coordinates),r=iy(i);return{vertices:[].concat((0,pe.Z)(r),(0,pe.Z)(r),(0,pe.Z)(r),(0,pe.Z)(r)),indices:[0,1,2,2,3,0],size:r.length}}function hy(e){var i=e.shape,r=aS(i,!1),n=r.positions,a=r.index,s=r.normals;return{vertices:n,indices:a,normals:s,size:5}}function py(e){var i=Zp(e.coordinates);return{vertices:(0,pe.Z)(i),indices:[0],size:i.length}}function dy(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,a=new ay({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var s=i;Array.isArray(s[0][0])||(s=[i]);var f=r;Array.isArray(f[0][0])||(f=[r]);for(var v=0;v<s.length;v++){var m=s[v],x=f[v];a.extrude_gaode2(m,x)}}else{var A=i;A[0]&&!Array.isArray(A[0][0])&&(A=[i]),A.forEach(function(O){a.extrude(O)})}var T=a.complex;return{vertices:T.positions,indices:T.indices,normals:T.normals,indexes:T.indexes,size:6}}function tS(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,a=new ay({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var s=i;Array.isArray(s[0][0])||(s=[i]);var f=r;Array.isArray(f[0][0])||(f=[r]);for(var v=0;v<s.length;v++){var m=s[v],x=f[v];a.simpleExtrude_gaode2(m,x)}}else{var A=i;A[0]&&!Array.isArray(A[0][0])&&(A=[i]),A.forEach(function(O){a.simpleExtrude(O)})}var T=a.complex;return{vertices:T.positions,indices:T.indices,normals:T.normals,size:6}}function j0(e){var i=e.coordinates,r=Oc().flatten(i),n=r.vertices,a=r.dimensions,s=r.holes;return{indices:Oc()(n,s,a),vertices:n,size:a}}function rS(e){var i=e.coordinates,r=Oc().flatten(i),n=r.vertices,a=r.dimensions,s=r.holes;return{indices:Oc()(n,s,a),vertices:nS(n),size:a+4}}function nS(e){for(var i=[],r=KE(e),n=r.center,a=r.radius,s=0;s<e.length;s+=2){var f=e[s],v=e[s+1];i.push.apply(i,[f,v,0].concat((0,pe.Z)(n),[a]))}return i}function vy(e){var i=e.coordinates,r=oy(i,!0),n=r.positions,a=r.index,s=r.normals;return{vertices:n,indices:a,normals:s,size:5}}function gy(e){var i=e.shape,r=sS(i),n=r.positions,a=r.index;return{vertices:n,indices:a,size:3}}function yy(e){var i=e.coordinates,r=[].concat((0,pe.Z)(i[0]),[0,0,1,i[1][0],i[0][1],0,1,1],(0,pe.Z)(i[1]),[0,1,0],(0,pe.Z)(i[0]),[0,0,1],(0,pe.Z)(i[1]),[0,1,0,i[0][0],i[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:r,indices:n,size:5}}function Xv(e,i){for(var r=i||30,n=e.coordinates,a=[],s=[],f=function(x){a.push(x,1,x,n[0][0],n[0][1],n[1][0],n[1][1],x,-1,x,n[0][0],n[0][1],n[1][0],n[1][1]),x!==r-1&&s.push.apply(s,(0,pe.Z)([0,1,2,1,3,2].map(function(A){return x*2+A})))},v=0;v<r;v++)f(v);return{vertices:a,indices:s,size:7}}function iS(e){var i=e.coordinates;i.length===2&&i.push(0);var r=e.size,n=Yv(-1,1),a=Yv(1,1),s=Yv(-1,-1),f=Yv(1,-1),v=[].concat((0,pe.Z)(i),(0,pe.Z)(n),(0,pe.Z)(i),(0,pe.Z)(s),(0,pe.Z)(i),(0,pe.Z)(f),(0,pe.Z)(i),(0,pe.Z)(a)),m=[0,1,2,3,0,2];return{vertices:v,indices:m,size:5}}function aS(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(Wv&&Wv[e])return Wv[e];var r=xd[e]?xd[e]():xd.cylinder(),n=oy([r],i);return Wv[e]=n,n}function QP(e,i){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,a=new Float32Array(e.length/r*3),s,f,v,m=vec3.create(),x=vec3.create(),A=vec3.create(),T=0,O=i.length;T<O;T+=3){s=i[T+0]*3,f=i[T+1]*3,v=i[T+2]*3;var F=[e[s],e[s+1]],j=[e[f],e[f+1]],Y=[e[v],e[v+1]];n&&(F=lngLatToMeters(F),j=lngLatToMeters(j),Y=lngLatToMeters(Y));var ee=F,Ae=_slicedToArray(ee,2),Fe=Ae[0],Xe=Ae[1],nt=vec3.fromValues(Fe,Xe,e[s+2]),Et=j,wt=_slicedToArray(Et,2),Wt=wt[0],ur=wt[1],Ar=vec3.fromValues(Wt,ur,e[f+2]),Jr=Y,gr=_slicedToArray(Jr,2),vn=gr[0],Pn=gr[1],Kn=vec3.fromValues(vn,Pn,e[v+2]);vec3.sub(m,Kn,Ar),vec3.sub(x,nt,Ar),vec3.cross(A,m,x),a[s]+=m[0],a[s+1]+=m[1],a[s+2]+=m[2],a[f]+=m[0],a[f+1]+=m[1],a[f+2]+=m[2],a[v]+=m[0],a[v+1]+=m[1],a[v+2]+=m[2]}return oS(a),a}function oS(e){for(var i=0,r=e.length;i<r;i+=3){var n=vec3.fromValues(e[i],e[i+1],e[i+2]),a=vec3.create();vec3.normalize(a,n),e.set(a,i)}}function JP(e){var i=e[0][0],r=e[0][e[0].length-1];return i[0]===r[0]&&i[1]===r[1]}function sS(e){var i=["cylinder","triangleColumn","hexagonColumn","squareColumn"],r=xd[e]?xd[e]():xd.circle(),n=i.indexOf(e)===-1?QE([r]):$E([r]);return n}function Yv(e,i){var r=(e+1)/2,n=(i+1)/2;return[r,n]}function eI(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function tI(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function uS(e){var i=lS();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function lS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cS=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

uniform float u_circleSweep;
uniform float u_cityMinSize;
uniform vec3 u_circleSweepColor;
uniform float u_circleSweepSpeed;

varying float v_worldDis;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    gl_FragColor.rgb += r * r * u_circleSweepColor;
  }
   
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,fS=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

uniform float u_circleSweep;
uniform vec2 u_cityCenter;

varying float v_worldDis;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,hS=function(e){(0,Ir.Z)(r,e);var i=uS(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"cityCenter",void 0),(0,S.Z)((0,J.Z)(n),"cityMinSize",void 0),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.baseColor,m=v===void 0?"rgb(16,16,16)":v,x=a.brightColor,A=x===void 0?"rgb(255,176,38)":x,T=a.windowColor,O=T===void 0?"rgb(30,60,89)":T,F=a.time,j=F===void 0?0:F,Y=a.sweep,ee=Y===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:Y;return{u_cityCenter:ee.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*ee.sweepRadius,u_circleSweep:ee.enable?1:0,u_circleSweepColor:pi(ee.sweepColor).slice(0,3),u_circleSweepSpeed:ee.sweepSpeed,u_opacity:f,u_baseColor:pi(m),u_brightColor:pi(A),u_windowColor:pi(O),u_time:this.layer.getLayerAnimateTime()||j}}},{key:"calCityGeo",value:function(){var a=(0,mn.Z)(this.layer.getSource().extent,4),s=a[0],f=a[1],v=a[2],m=a[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(v+s)/2,(m+f)/2]);var x=this.mapService.lngLatToCoord([v,m]),A=this.mapService.lngLatToCoord([s,f]);this.cityMinSize=Math.sqrt(Math.pow(x[0]-A[0],2)+Math.pow(x[1]-A[1],2))/4}else{var T=v-s,O=m-f;this.cityCenter=[(v+s)/2,(m+f)/2],this.cityMinSize=Math.sqrt(Math.pow(T,2)+Math.pow(O,2))/4}}},{key:"initModels",value:function(){return this.calCityGeo(),this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:fS,fragmentShader:cS,triangulation:vy,cull:{enable:!0,face:k.BACK}})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:Zn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(s,f,v,m,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Zn.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,f,v,m){var x=s.size,A=x===void 0?10:x;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Zn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(s,f,v,m){var x=s.size;return[v[3],v[4]]}}})}}]),r}(Lo);function pS(e){var i=dS();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function dS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vS=function(e){(0,Ir.Z)(r,e);var i=pS(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"type","PolygonLayer"),n}return(0,It.Z)(r,[{key:"buildModels",value:function(){this.layerModel=new hS(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(a){this.updateLayerConfig({time:a})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),r}(zp);function mS(e){var i=gS();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function gS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yS=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,_S=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,xS=function(e){(0,Ir.Z)(r,e);var i=mS(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=a.coverage,v=a.angle;return{u_opacity:s||1,u_coverage:f||.9,u_angle:v||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:yS,fragmentShader:_S,triangulation:gy,depth:{enable:!1},primitive:k.TRIANGLES,blend:this.getBlend(),stencil:Da(f,m)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Zn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(s,f){var v=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[v[0],v[1],0]}}})}}]),r}(Lo);function bS(e){var i=ES();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function ES(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var SS=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,CS=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,AS=function(e){(0,Ir.Z)(r,e);var i=bS(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=a.coverage,v=a.angle;return{u_opacity:s||1,u_coverage:f||1,u_angle:v||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:SS,fragmentShader:CS,triangulation:hy,depth:{enable:!0},blend:this.getBlend(),stencil:Da(f,m)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Zn.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,f,v,m){var x=s.size;return Array.isArray(x)?[x[0]]:[x]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Zn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(s,f,v,m,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Zn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(s,f){var v=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[v[0],v[1],0]}}})}}]),r}(Lo);function wS(e,i){for(var r=[],n=[],a=[],s=e+1,f=i+1,v=e/2,m=i/2,x=0;x<f;x++)for(var A=x-m,T=0;T<s;T++){var O=T-v;n.push(O/v,-A/m,0),a.push(T/e),a.push(1-x/i)}for(var F=0;F<i;F++)for(var j=0;j<e;j++){var Y=j+s*F,ee=j+s*(F+1),Ae=j+1+s*(F+1),Fe=j+1+s*F;r.push(Y,ee,Fe),r.push(ee,Ae,Fe)}return{vertices:n,indices:r,uvs:a}}var _y,xy;function by(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Ey(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?by(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):by(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function TS(e){var i=MS();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function MS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var PS=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,IS=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,OS=`uniform sampler2D u_texture;        // \u70ED\u529B\u5F3A\u5EA6\u56FE
uniform sampler2D u_colorTexture;   // \u6839\u636E\u5F3A\u5EA6\u5206\u5E03\u7684\u8272\u5E26
uniform float u_opacity;
varying vec2 v_texCoord;

float getBlurIndusty() {
    float h = 2.0/512.0;
    vec2 vUv = v_texCoord;
    float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y + 1.0 * h) ).r;
    float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * h, vUv.y + 1.0 * h) ).r;
    float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y + 1.0 * h) ).r;

    float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y) ).r;
    float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;
    float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y) ).r;

    float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y-1.0*h) ).r;
    float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * h, vUv.y-1.0*h) ).r;
    float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y-1.0*h) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture2D(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));

    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,RS=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;

void main() {
  v_texCoord = a_Uv;

  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,kS=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,LS=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,Sy=(_y=(0,Yr.b2)(),_y(xy=function(e){(0,Ir.Z)(r,e);var i=TS(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"texture",void 0),(0,S.Z)((0,J.Z)(n),"colorTexture",void 0),(0,S.Z)((0,J.Z)(n),"heatmapFramerBuffer",void 0),(0,S.Z)((0,J.Z)(n),"intensityModel",void 0),(0,S.Z)((0,J.Z)(n),"colorModel",void 0),(0,S.Z)((0,J.Z)(n),"shapeType",void 0),n}return(0,It.Z)(r,[{key:"render",value:function(){var a=this,s=this.rendererService,f=s.clear,v=s.useFramebuffer;v(this.heatmapFramerBuffer,function(){f({color:[0,0,0,0],depth:1,stencil:0,framebuffer:a.heatmapFramerBuffer}),a.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var a,s=this.rendererService,f=s.createFramebuffer,v=s.clear,m=s.getViewportSize,x=s.createTexture2D,A=s.useFramebuffer,T=this.styleAttributeService.getLayerStyleAttribute("shape"),O=(T==null||(a=T.scale)===null||a===void 0?void 0:a.field)||"heatmap";this.shapeType=O,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=O==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var F=m(),j=F.width,Y=F.height;return this.heatmapFramerBuffer=f({color:x({width:Math.floor(j/4),height:Math.floor(Y/4),wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE,min:k.LINEAR,mag:k.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:Zn.Attribute,descriptor:{name:"a_Dir",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(s,f,v,m){return[v[3],v[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Zn.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,f,v,m){var x=s.size,A=x===void 0?1:x;return[A]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:LS,fragmentShader:kS,triangulation:iS,depth:{enable:!1},cull:{enable:!0,face:Vl(this.mapService.version)},blend:{enable:!0,func:{srcRGB:k.ONE,srcAlpha:1,dstRGB:k.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v;this.shaderModuleService.registerModule("heatmapColor",{vs:RS,fs:OS});var x=this.shaderModuleService.getModule("heatmapColor"),A=x.vs,T=x.fs,O=x.uniforms,F=this.rendererService,j=F.createAttribute,Y=F.createElements,ee=F.createBuffer,Ae=F.createModel;return Ae({vs:A,fs:T,attributes:{a_Position:j({buffer:ee({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:k.FLOAT}),size:3}),a_Uv:j({buffer:ee({data:[0,1,1,1,0,0,1,0],type:k.FLOAT}),size:2})},uniforms:Ey({},O),depth:{enable:!1},blend:this.getBlend(),count:6,elements:Y({data:[0,2,1,2,3,1],type:k.UNSIGNED_INT,count:6}),stencil:Da(f,m)})}},{key:"drawIntensityMode",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=a.intensity,v=f===void 0?10:f,m=a.radius,x=m===void 0?5:m;this.intensityModel.draw({uniforms:{u_opacity:s||1,u_radius:x,u_intensity:v}})}},{key:"drawColorMode",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;this.colorModel.draw({uniforms:{u_opacity:s||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=Ki();Vh(f,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:s||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,pe.Z)(f)}})}},{key:"build3dHeatMap",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v,x=this.rendererService.getViewportSize,A=x(),T=A.width,O=A.height,F=wS(T/4,O/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:IS,fs:PS});var j=this.shaderModuleService.getModule("heatmap3dColor"),Y=j.vs,ee=j.fs,Ae=j.uniforms,Fe=this.rendererService,Xe=Fe.createAttribute,nt=Fe.createElements,Et=Fe.createBuffer,wt=Fe.createModel;return wt({vs:Y,fs:ee,attributes:{a_Position:Xe({buffer:Et({data:F.vertices,type:k.FLOAT}),size:3}),a_Uv:Xe({buffer:Et({data:F.uvs,type:k.FLOAT}),size:2})},primitive:k.TRIANGLES,uniforms:Ey({},Ae),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:k.SRC_ALPHA,srcAlpha:1,dstRGB:k.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:nt({data:F.indices,type:k.UNSIGNED_INT,count:F.indices.length}),stencil:Da(f,m)})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var a=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var s=this.layer.getLayerConfig(),f=s.rampColors,v=jl(f);this.colorTexture=a({data:new Uint8Array(v.data),width:v.width,height:v.height,wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE,min:k.NEAREST,mag:k.NEAREST,flipY:!1})}}]),r}(Lo))||xy);function DS(e){var i=FS();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function FS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BS=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,NS=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,zS=function(e){(0,Ir.Z)(r,e);var i=DS(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=a.coverage,v=a.angle;return{u_opacity:s||1,u_coverage:f||.9,u_angle:v||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:NS,fragmentShader:BS,triangulation:gy,depth:{enable:!1},primitive:k.TRIANGLES,blend:this.getBlend(),stencil:Da(f,m)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Zn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(s,f){var v=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[v[0],v[1],0]}}})}}]),r}(Lo),ZS={heatmap:Sy,heatmap3d:Sy,grid:xS,grid3d:AS,hexagon:zS},US=ZS;function jS(e){var i=VS();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function VS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var GS=function(e){(0,Ir.Z)(r,e);var i=jS(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"type","HeatMapLayer"),n}return(0,It.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new US[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var a=this,s=this.getModelType();return s==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(f){return f.draw({uniforms:a.layerModel.getUninforms()})}),this)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),f=this.getLayerConfig(),v=f.shape3d,m=this.getSource(),x=m.data.type,A=(s==null||(a=s.scale)===null||a===void 0?void 0:a.field)||"heatmap";return A==="heatmap"||A==="heatmap3d"?"heatmap":x==="hexagon"?(v==null?void 0:v.indexOf(A))===-1?"hexagon":"grid3d":x==="grid"?(v==null?void 0:v.indexOf(A))===-1?"grid":"grid3d":"heatmap"}}]),r}(zp);function HS(e){var i=WS();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function WS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var XS=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,YS=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,qS=function(e){(0,Ir.Z)(r,e);var i=HS(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"texture",void 0),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;return{u_opacity:s||1,u_texture:this.texture}}},{key:"initModels",value:function(){var a=this,s=this.layer.getLayerConfig(),f=s.mask,v=f===void 0?!1:f,m=s.maskInside,x=m===void 0?!0:m,A=this.layer.getSource(),T=this.rendererService.createTexture2D;if(this.texture=T({height:0,width:0}),Ji){var O=this.layerService.sceneService.getSceneConfig().canvas,F=O.createImage();F.crossOrigin="anonymous",F.src=A.data.originData,F.onload=function(){a.texture=T({data:F,width:F.width,height:F.height}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}else A.data.images.then(function(j){a.texture=T({data:j[0],width:j[0].width,height:j[0].height}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()});return[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:YS,fragmentShader:XS,triangulation:yy,primitive:k.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:Da(v,x)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Zn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(s,f,v,m){return[v[3],v[4]]}}})}}]),r}(Lo),KS={image:qS},$S=KS;function QS(e){var i=JS();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function JS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var eC=function(e){(0,Ir.Z)(r,e);var i=QS(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"type","ImageLayer"),n}return(0,It.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new $S[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={image:{}};return s[a]}},{key:"getModelType",value:function(){return"image"}}]),r}(zp);function tC(e){var i=rC();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function rC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nC=`
uniform float u_opacity;

varying vec4 v_dash_array;
varying vec4 v_color;

uniform float segmentNumber;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity;

  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  }
  gl_FragColor.a *=flag;
  
  gl_FragColor = filterColor(gl_FragColor);
}`,iC=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;


uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  vec2 s = source;
  vec2 t = target;
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  

   styleMappingMat[3].b = segmentIndex / segmentNumber;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,aC=`
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  
  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = styleMappingMat[3].g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = styleMappingMat[3].a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);
}`,oC=`#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
     styleMappingMat[3].g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,sC=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}`,uC=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,lC={solid:0,dash:1},cC=function(e){(0,Ir.Z)(r,e);var i=tC(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"texture",void 0),(0,S.Z)((0,J.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:k.NEAREST,min:k.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=a.sourceColor,v=a.targetColor,m=a.textureBlend,x=m===void 0?"normal":m,A=a.lineType,T=A===void 0?"solid":A,O=a.dashArray,F=O===void 0?[10,5]:O,j=a.forward,Y=j===void 0?!0:j,ee=a.lineTexture,Ae=ee===void 0?!1:ee,Fe=a.iconStep,Xe=Fe===void 0?100:Fe,nt=a.segmentNumber,Et=nt===void 0?30:nt,wt=a.thetaOffset,Wt=wt===void 0?.314:wt;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s,thetaOffset:Wt})){this.judgeStyleAttributes({opacity:s,thetaOffset:Wt});var ur=this.layer.getEncodedData(),Ar=this.calDataFrame(this.cellLength,ur,this.cellProperties),Jr=Ar.data,gr=Ar.width,vn=Ar.height;this.rowCount=vn,this.dataTexture=this.cellLength>0&&Jr.length>0?this.createTexture2D({flipY:!0,data:Jr,format:k.LUMINANCE,type:k.FLOAT,width:gr,height:vn}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}F.length===2&&F.push(0,0);var Pn=0,Kn=[0,0,0,0],Ba=[0,0,0,0];return f&&v&&(Kn=pi(f),Ba=pi(v),Pn=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:ki()(Wt)?Wt:0,u_opacity:ki()(s)?s:1,u_textureBlend:x==="normal"?0:1,segmentNumber:Et,u_line_type:lC[T||"solid"],u_dash_array:F,u_blur:.9,u_lineDir:Y?1:-1,u_texture:this.texture,u_line_texture:Ae?1:0,u_icon_step:Xe,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Pn,u_sourceColor:Kn,u_targetColor:Ba}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,f=a.targetColor,v=a.lineType;return v==="dash"?{frag:nC,vert:iC,type:"dash"}:s&&f?{frag:sC,vert:uC,type:"linear"}:{frag:aC,vert:oC,type:"normal"}}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,f=s===void 0?30:s,v=a.mask,m=v===void 0?!1:v,x=a.maskInside,A=x===void 0?!0:x,T=this.getShaders(),O=T.frag,F=T.vert,j=T.type;return[this.layer.buildLayerModel({moduleName:"arc2dline"+j,vertexShader:F,fragmentShader:O,triangulation:Xv,depth:{enable:!1},blend:this.getBlend(),segmentNumber:f,stencil:Da(m,A)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Zn.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(f,v,m,x){var A=f.size,T=A===void 0?1:A;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Zn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:4,update:function(f,v,m,x){return[m[3],m[4],m[5],m[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Zn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(f,v,m,x){var A=a.iconService.getIconMap(),T=f.texture,O=A[T]||{x:0,y:0},F=O.x,j=O.y;return[F,j]}}})}}]),r}(Lo);function fC(e){var i=hC();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function hC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,dC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,vC=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;


uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,mC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,gC={solid:0,dash:1},yC=function(e){(0,Ir.Z)(r,e);var i=fC(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"texture",void 0),(0,S.Z)((0,J.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:k.NEAREST,min:k.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=a.sourceColor,v=a.targetColor,m=a.textureBlend,x=m===void 0?"normal":m,A=a.lineType,T=A===void 0?"solid":A,O=a.dashArray,F=O===void 0?[10,5]:O,j=a.lineTexture,Y=j===void 0?!1:j,ee=a.iconStep,Ae=ee===void 0?100:ee,Fe=a.segmentNumber,Xe=Fe===void 0?30:Fe,nt=a.globalArcHeight,Et=nt===void 0?10:nt;F.length===2&&F.push(0,0);var wt=0,Wt=[0,0,0,0],ur=[0,0,0,0];if(f&&v&&(Wt=pi(f),ur=pi(v),wt=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var Ar=this.layer.getEncodedData(),Jr=this.calDataFrame(this.cellLength,Ar,this.cellProperties),gr=Jr.data,vn=Jr.width,Pn=Jr.height;this.rowCount=Pn,this.dataTexture=this.cellLength>0&&gr.length>0?this.createTexture2D({flipY:!0,data:gr,format:k.LUMINANCE,type:k.FLOAT,width:vn,height:Pn}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:ry,u_global_height:Et,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ki()(s)?s:1,u_textureBlend:x==="normal"?0:1,segmentNumber:Xe,u_line_type:gC[T]||0,u_dash_array:F,u_texture:this.texture,u_line_texture:Y?1:0,u_icon_step:Ae,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:wt,u_sourceColor:Wt,u_targetColor:ur}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,f=a.targetColor,v=a.lineType;return s&&f?{frag:vC,vert:mC,type:"linear"}:{frag:pC,vert:dC,type:"normal"}}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,f=s===void 0?30:s,v=a.mask,m=v===void 0?!1:v,x=a.maskInside,A=x===void 0?!0:x,T=this.getShaders(),O=T.frag,F=T.vert,j=T.type;return[this.layer.buildLayerModel({moduleName:"arc3Dline"+j,vertexShader:F,fragmentShader:O,triangulation:Xv,blend:this.getBlend(),segmentNumber:f,stencil:Da(m,A)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Zn.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(f,v,m,x){var A=f.size,T=A===void 0?1:A;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Zn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:4,update:function(f,v,m,x){return[m[3],m[4],m[5],m[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Zn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(f,v,m,x){var A=a.iconService.getIconMap(),T=f.texture,O=A[T]||{x:0,y:0},F=O.x,j=O.y;return[F,j]}}})}}]),r}(Lo);function _C(e){var i=xC();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function xC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bC=`#define LineTypeSolid 0.0
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
// varying vec2 v_normal;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float segmentNumber;
varying float v_distance_ratio;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
 
  gl_FragColor.a *= u_opacity;

  if(u_aimate.x == Animate) {
      float animateSpeed = u_time / u_aimate.y; // \u8FD0\u52A8\u901F\u5EA6
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }
}`,EC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

uniform float u_lineDir: 1.0;

// \u504F\u79FB\u91CF
uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = u_thetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  v_distance_ratio = segmentIndex / segmentNumber;
  
  if(u_aimate.x == Animate && u_lineDir != 1.0) {
      v_distance_ratio = 1.0 - v_distance_ratio;
  }

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
}
`,SC=function(e){(0,Ir.Z)(r,e);var i=_C(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=a.sourceColor,v=a.targetColor,m=a.forward,x=m===void 0?!0:m,A=a.segmentNumber,T=A===void 0?30:A,O=a.thetaOffset,F=O===void 0?.314:O,j=0,Y=[0,0,0,0],ee=[0,0,0,0];return f&&v&&(Y=pi(f),ee=pi(v),j=1),{u_thetaOffset:F,u_opacity:ki()(s)?s:1,segmentNumber:T,u_blur:.9,u_lineDir:x?1:-1,u_linearColor:j,u_sourceColor:Y,u_targetColor:ee}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,f=s===void 0?30:s;return[this.layer.buildLayerModel({moduleName:"arc2dminiline",vertexShader:EC,fragmentShader:bC,triangulation:Xv,depth:{enable:!1},blend:this.getBlend(),segmentNumber:f})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Zn.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,f,v,m){var x=s.size,A=x===void 0?1:x;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Zn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:4,update:function(s,f,v,m){return[v[3],v[4],v[5],v[6]]}}})}}]),r}(Lo);function CC(e){var i=AC();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function AC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = styleMappingMat[3].g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,TC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  styleMappingMat[3].g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,MC={solid:0,dash:1},PC=function(e){(0,Ir.Z)(r,e);var i=CC(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"texture",void 0),(0,S.Z)((0,J.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:k.NEAREST,min:k.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=a.sourceColor,v=a.targetColor,m=a.textureBlend,x=m===void 0?"normal":m,A=a.lineType,T=A===void 0?"solid":A,O=a.dashArray,F=O===void 0?[10,5]:O,j=a.lineTexture,Y=j===void 0?!1:j,ee=a.iconStep,Ae=ee===void 0?100:ee,Fe=a.segmentNumber,Xe=Fe===void 0?30:Fe;F.length===2&&F.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var nt=0,Et=[0,0,0,0],wt=[0,0,0,0];if(f&&v&&(Et=pi(f),wt=pi(v),nt=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var Wt=this.layer.getEncodedData(),ur=this.calDataFrame(this.cellLength,Wt,this.cellProperties),Ar=ur.data,Jr=ur.width,gr=ur.height;this.rowCount=gr,this.dataTexture=this.cellLength>0&&Ar.length>0?this.createTexture2D({flipY:!0,data:Ar,format:k.LUMINANCE,type:k.FLOAT,width:Jr,height:gr}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ki()(s)?s:1,u_textureBlend:x==="normal"?0:1,segmentNumber:Xe,u_line_type:MC[T]||0,u_dash_array:F,u_texture:this.texture,u_line_texture:Y?1:0,u_icon_step:Ae,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:nt,u_sourceColor:Et,u_targetColor:wt}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"greatcircleline",vertexShader:TC,fragmentShader:wC,triangulation:Xv,depth:{enable:!1},blend:this.getBlend(),stencil:Da(f,m)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Zn.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(f,v,m,x){var A=f.size,T=A===void 0?1:A;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Zn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:4,update:function(f,v,m,x){return[m[3],m[4],m[5],m[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Zn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(f,v,m,x){var A=a.iconService.getIconMap(),T=f.texture,O=A[T]||{x:0,y:0},F=O.x,j=O.y;return[F,j]}}})}}]),r}(Lo);function IC(e){var i=OC();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function OC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var RC=`#define LineTypeSolid 0.0
uniform float u_opacity : 1.0;

varying vec4 v_color;

// dash
varying vec4 v_dash_array;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
 // dash line
 
  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  }
  gl_FragColor.a *=flag;

  gl_FragColor = filterColor(gl_FragColor);
}
`,kC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  vec2 offset = project_pixel(size.xy);

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = a_DistanceAndIndex.x / a_Total_Distance; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_DistanceAndIndex.x;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));
  } else {
    float lineHeight = a_Size.y;
 
    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,LC=`#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = styleMappingMat[3].a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth/2.0;

    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) {
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,Cy=`
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,DC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;

varying vec4 v_color;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"


varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,FC={solid:0,dash:1},Ay=function(e){(0,Ir.Z)(r,e);var i=IC(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"texture",void 0),(0,S.Z)((0,J.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:k.NEAREST,min:k.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=a.sourceColor,v=a.targetColor,m=a.textureBlend,x=m===void 0?"normal":m,A=a.lineType,T=A===void 0?"solid":A,O=a.dashArray,F=O===void 0?[10,5,0,0]:O,j=a.lineTexture,Y=j===void 0?!1:j,ee=a.iconStep,Ae=ee===void 0?100:ee,Fe=a.vertexHeightScale,Xe=Fe===void 0?20:Fe,nt=a.borderWidth,Et=nt===void 0?0:nt,wt=a.borderColor,Wt=wt===void 0?"#ccc":wt,ur=a.raisingHeight,Ar=ur===void 0?0:ur,Jr=a.heightfixed,gr=Jr===void 0?!1:Jr,vn=a.arrow,Pn=vn===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:vn;F.length===2&&F.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Kn=0,Ba=[0,0,0,0],qo=[0,0,0,0];if(f&&v&&(Ba=pi(f),qo=pi(v),Kn=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var Ls=this.layer.getEncodedData(),Ds=this.calDataFrame(this.cellLength,Ls,this.cellProperties),Ys=Ds.data,vf=Ds.width,E0=Ds.height;this.rowCount=E0,this.dataTexture=this.cellLength>0&&Ys.length>0?this.createTexture2D({flipY:!0,data:Ys,format:k.LUMINANCE,type:k.FLOAT,width:vf,height:E0}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ki()(s)?s:1,u_textureBlend:x==="normal"?0:1,u_line_type:FC[T],u_dash_array:F,u_texture:this.texture,u_line_texture:Y?1:0,u_icon_step:Ae,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:Et,u_borderColor:pi(Wt),u_linearColor:Kn,u_sourceColor:Ba,u_targetColor:qo,u_heightfixed:Number(gr),u_vertexScale:Xe,u_raisingHeight:Number(Ar),u_arrow:Number(Pn.enable),u_arrowHeight:Pn.arrowHeight||3,u_arrowWidth:Pn.arrowWidth||2,u_tailWidth:Pn.tailWidth===void 0?1:Pn.tailWidth}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v,x=a.depth,A=x===void 0?!1:x,T=this.getShaders(),O=T.frag,F=T.vert,j=T.type;return[this.layer.buildLayerModel({moduleName:"line_"+j,vertexShader:F,fragmentShader:O,triangulation:dy,primitive:k.TRIANGLES,blend:this.getBlend(),depth:{enable:A},stencil:Da(f,m)})]}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,f=a.targetColor,v=a.lineType;return v==="dash"?{frag:RC,vert:kC,type:"dash"}:s&&f?{frag:DC,vert:Cy,type:"linear"}:{frag:LC,vert:Cy,type:"normal"}}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:Zn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(f,v,m,x,A,T){return T===void 0?[m[3],10]:[m[3],T]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Zn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(f,v,m,x){return[m[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Zn.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(f,v,m,x){var A=f.size,T=A===void 0?1:A;return Array.isArray(T)?[T[0],T[1]]:[T,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Zn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(f,v,m,x,A){return A}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Zn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(f,v,m,x){return[m[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Zn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(f,v,m,x){var A=a.iconService.getIconMap(),T=f.texture,O=A[T]||{x:0,y:0},F=O.x,j=O.y;return[F,j]}}})}}]),r}(Lo);function BC(e){var i=NC();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function NC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zC=`

uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,ZC=`
varying vec4 v_color;
varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,wy=`
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Position;


// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_vertexScale: 1.0;

#pragma include "projection"

varying vec4 v_color;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_color = a_Color;  

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
  }
}
`,UC=function(e){(0,Ir.Z)(r,e);var i=BC(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=a.sourceColor,v=a.targetColor,m=a.vertexHeightScale,x=m===void 0?20:m,A=0,T=[0,0,0,0],O=[0,0,0,0];if(f&&v&&(T=pi(f),O=pi(v),A=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var F=this.layer.getEncodedData(),j=this.calDataFrame(this.cellLength,F,this.cellProperties),Y=j.data,ee=j.width,Ae=j.height;this.rowCount=Ae,this.dataTexture=this.cellLength>0&&Y.length>0?this.createTexture2D({flipY:!0,data:Y,format:k.LUMINANCE,type:k.FLOAT,width:ee,height:Ae}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ki()(s)?s:1,u_linearColor:A,u_sourceColor:T,u_targetColor:O,u_vertexScale:x}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,f=a.targetColor;return s&&f?{frag:zC,vert:wy,type:"linear"}:{frag:ZC,vert:wy,type:"normal"}}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v,x=this.getShaders(),A=x.frag,T=x.vert,O=x.type;return[this.layer.buildLayerModel({moduleName:"simpleline"+O,vertexShader:T,fragmentShader:A,triangulation:tS,primitive:k.LINES,blend:this.getBlend(),depth:{enable:!1},stencil:Da(f,m)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:Zn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,f,v,m){return[v[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Zn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,f,v,m){return[v[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Zn.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(s,f,v,m){var x=s.size,A=x===void 0?1:x;return Array.isArray(A)?[A[0],A[1]]:[A,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Zn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(s,f,v,m,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Zn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,f,v,m){return[v[4]]}}})}}]),r}(Lo);function jC(e){var i=VC();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function VC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var GC=`#define LineTypeSolid 0.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity : 1.0;
uniform float u_textureBlend;
uniform float u_iconStepCount;

varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

// dash
uniform float u_dash_offset : 0.0;
uniform float u_dash_ratio : 0.1;

varying vec2 v_iconMapUV;
varying float v_blur;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = styleMappingMat[3].a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);

    
  
  
}
`,HC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

varying vec4 v_color;
varying float v_blur;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "light"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    originSize = project_float_pixel(a_Size.x);
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);

  // v_lightWeight = lightWeight;
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);
  // v_color = a_Color;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,WC=function(e){(0,Ir.Z)(r,e);var i=jC(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"texture",void 0),(0,S.Z)((0,J.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:k.NEAREST,min:k.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=a.sourceColor,v=a.targetColor,m=a.textureBlend,x=m===void 0?"normal":m,A=a.heightfixed,T=A===void 0?!1:A,O=a.lineTexture,F=O===void 0?!1:O,j=a.iconStep,Y=j===void 0?100:j,ee=a.iconStepCount,Ae=ee===void 0?1:ee;this.rendererService.getDirty()&&this.texture.bind();var Fe=0,Xe=[0,0,0,0],nt=[0,0,0,0];if(f&&v&&(Xe=pi(f),nt=pi(v),Fe=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var Et=this.layer.getEncodedData(),wt=this.calDataFrame(this.cellLength,Et,this.cellProperties),Wt=wt.data,ur=wt.width,Ar=wt.height;this.rowCount=Ar,this.dataTexture=this.cellLength>0&&Wt.length>0?this.createTexture2D({flipY:!0,data:Wt,format:k.LUMINANCE,type:k.FLOAT,width:ur,height:Ar}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_heightfixed:Number(T),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ki()(s)?s:1,u_textureBlend:x==="normal"?0:1,u_texture:this.texture,u_line_texture:F?1:0,u_iconStepCount:Ae,u_icon_step:Y,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Fe,u_sourceColor:Xe,u_targetColor:nt}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"linewall",vertexShader:HC,fragmentShader:GC,triangulation:dy,primitive:k.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:Zn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(f,v,m,x){return[m[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Zn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(f,v,m,x){return[m[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Zn.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(f,v,m,x){var A=f.size,T=A===void 0?1:A;return Array.isArray(T)?[T[0],T[1]]:[T,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Zn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(f,v,m,x,A){return A}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Zn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(f,v,m,x){return[m[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Zn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(f,v,m,x){var A=a.iconService.getIconMap(),T=f.texture,O=A[T]||{x:0,y:0},F=O.x,j=O.y;return[F,j]}}})}}]),r}(Lo),XC={arc:cC,arcmini:SC,arc3d:yC,greatcircle:PC,wall:WC,line:Ay,simple:UC},YC=XC;function qC(e){var i=KC();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function KC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $C=function(e){(0,Ir.Z)(r,e);var i=qC(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"type","LineLayer"),n}return(0,It.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new YC[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={line:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},arcmini:{blend:"additive"},greatcircle:{blend:"additive"}};return s[a]}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),f=s==null||(a=s.scale)===null||a===void 0?void 0:a.field;return f||"line"}}]),r}(zp);function QC(e){var i=JC();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function JC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var eA=`varying vec4 v_color;
uniform float u_opacity: 1.0;

varying float v_z;
varying float v_lightWeight;
uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_z);
    gl_FragColor.rgb *= v_lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_z): v_z;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, v_lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,tA=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

varying float v_z;
varying float v_lightWeight;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  v_z = a_Position.z;

 

  // vec2 offset = project_pixel(size.xy);
  // vec2 offset = (size.xy);

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    // offset = project_pixel(offset);
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // vec4 pos = vec4(project_pos.xy + offset, project_pixel(size.z) * u_r, 1.0);
  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  // float lightWeight = u_lightEnable > 0.0 ? calc_lighting(pos): 1.0;
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  v_lightWeight = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  
  if(u_globel > 0.0) {
    // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
    //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
    float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
    float xRadian = getXRadian(a_Pos.y, r);
    float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 mx = mat4(
      1,0,0,0,  
      0,xcos,-xsin,0,  
      0,xsin,xcos,0,  
      0,0,0,1);

    //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
    float yRadian = getYRadian(a_Pos.x, a_Pos.z);
    float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 my = mat4(
      ycos,0,-ysin,0,  
      0,1,0,0,  
      ysin,0,ycos,0,  
      0,0,0,1);

    gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  }

  setPickingColor(a_PickingColor);
}
`,Ty=function(e){(0,Ir.Z)(r,e);var i=QC(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"raiseCount",0),(0,S.Z)((0,J.Z)(n),"raiserepeat",0),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,f=s===void 0?{enable:!1,speed:.01,repeat:!1}:s,v=a.opacity,m=v===void 0?1:v,x=a.sourceColor,A=a.targetColor,T=a.pickLight,O=T===void 0?!1:T,F=a.heightfixed,j=F===void 0?!1:F,Y=a.opacityLinear,ee=Y===void 0?{enable:!1,dir:"up"}:Y,Ae=a.lightEnable,Fe=Ae===void 0?!0:Ae;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:m})){this.judgeStyleAttributes({opacity:m});var Xe=this.layer.getEncodedData(),nt=this.calDataFrame(this.cellLength,Xe,this.cellProperties),Et=nt.data,wt=nt.width,Wt=nt.height;this.rowCount=Wt,this.dataTexture=this.cellLength>0&&Et.length>0?this.createTexture2D({flipY:!0,data:Et,format:k.LUMINANCE,type:k.FLOAT,width:wt,height:Wt}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}var ur=0,Ar=[0,0,0,0],Jr=[0,0,0,0];if(x&&A&&(Ar=pi(x),Jr=pi(A),ur=1),this.raiseCount<1&&this.raiserepeat>0&&f.enable){var gr=f.speed,vn=gr===void 0?.01:gr,Pn=f.repeat,Kn=Pn===void 0?!1:Pn;this.raiseCount+=vn,this.raiseCount>=1&&(this.raiserepeat>1?(this.raiseCount=0,this.raiserepeat--):this.raiseCount=1)}return{u_pickLight:Number(O),u_heightfixed:Number(j),u_r:f.enable&&this.raiserepeat>0?this.raiseCount:1,u_globel:this.mapService.version==="GLOBEL"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ki()(m)?m:1,u_linearColor:ur,u_sourceColor:Ar,u_targetColor:Jr,u_opacitylinear:Number(ee.enable),u_opacitylinear_dir:ee.dir==="up"?1:0,u_lightEnable:Number(Fe)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.depth,f=s===void 0?!0:s,v=a.animateOption.repeat,m=v===void 0?1:v;return this.raiserepeat=m,[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:tA,fragmentShader:eA,triangulation:hy,blend:this.getBlend(),cull:{enable:!0,face:Vl(this.mapService.version)},depth:{enable:f}})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"size",type:Zn.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(f,v,m,x){var A=f.size;if(A){var T=[];return Array.isArray(A)&&(T=A.length===2?[A[0],A[0],A[1]]:A),Array.isArray(A)||(T=[A,A,A]),T}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Zn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(f,v,m,x,A){return A}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Zn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(f,v){var m=Zp(f.coordinates);return a?iy([m[0],m[1]]):[m[0],m[1],0]}}})}}]),r}(Lo);function rA(e){var i=nA();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function nA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var My=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  
  outer_df = sdCircle(v_data.xy, 1.0);
  inner_df = sdCircle(v_data.xy, r);


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

 gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  float d = length(v_data.xy);
  if(d > 0.5) {
    discard;
  }
  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
  
  // TODO: \u6839\u636E\u53E0\u52A0\u6A21\u5F0F\u9009\u62E9\u6548\u679C
  if(u_additive > 0.0) {
    gl_FragColor *= intensity;
    // TODO: \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,iA=`
uniform float u_globel;
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(u_globel > 0.0) {
    // TODO: \u5730\u7403\u6A21\u5F0F\u4E0B\u907F\u514D\u591A\u4F59\u7247\u5143\u7ED8\u5236\uFF0C\u540C\u65F6\u4E5F\u80FD\u907F\u514D\u6709\u7528\u7247\u5143\u5728\u900F\u660E\u4E14\u91CD\u53E0\u7684\u60C5\u51B5\u4E0B\u65E0\u6CD5\u5199\u5165
    // \u4ED8\u51FA\u7684\u4EE3\u4EF7\u662F\u8FB9\u7F18\u4F1A\u6709\u4E00\u4E9B\u952F\u9F7F
    if(outer_df > antialiasblur + 0.018) discard;
  }
  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,V0=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;
uniform float u_raisingHeight: 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raiseHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, u_raisingHeight, 1.0));
  }

  if(u_globel > 0.0) {
    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,Py=function(e){(0,Ir.Z)(r,e);var i=rA(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"meter2coord",1),(0,S.Z)((0,J.Z)(n),"isMeter",!1),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.strokeOpacity,m=v===void 0?1:v,x=a.strokeWidth,A=x===void 0?0:x,T=a.stroke,O=T===void 0?"rgba(0,0,0,0)":T,F=a.offsets,j=F===void 0?[0,0]:F,Y=a.blend,ee=a.blur,Ae=ee===void 0?0:ee,Fe=a.raisingHeight,Xe=Fe===void 0?0:Fe;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,strokeOpacity:m,strokeWidth:A,stroke:O,offsets:j})){this.judgeStyleAttributes({opacity:f,strokeOpacity:m,strokeWidth:A,stroke:O,offsets:j});var nt=this.layer.getEncodedData(),Et=this.calDataFrame(this.cellLength,nt,this.cellProperties),wt=Et.data,Wt=Et.width,ur=Et.height;this.rowCount=ur,this.dataTexture=this.cellLength>0&&wt.length>0?this.createTexture2D({flipY:!0,data:wt,format:k.LUMINANCE,type:k.FLOAT,width:Wt,height:ur}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(Xe),u_isMeter:Number(this.isMeter),u_blur:Ae,u_additive:Y==="additive"?1:0,u_globel:this.mapService.version===ks.GLOBEL?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ki()(f)?f:1,u_stroke_opacity:ki()(m)?m:1,u_stroke_width:ki()(A)?A:0,u_stroke_color:this.getStrokeColor(O),u_offsets:this.isOffsetStatic(j)?j:[0,0]}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,f=s===void 0?{enable:!1}:s;return{u_aimate:this.animateOption2Array(f),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),bd)}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.unit,f=s===void 0?"l7size":s,v=this.mapService.version;return f==="meter"&&v!==ks.L7MAP&&v!==ks.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,mn.Z)(this.layer.getSource().extent,4),s=a[0],f=a[1],v=a[2],m=a[3],x=[(s+v)/2,(f+m)/2],A=this.mapService.version;if(A===ks.MAPBOX&&window.mapboxgl.MercatorCoordinate){var T=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:x[0],lat:x[1]},0),O=1,F=O*T.meterInMercatorCoordinateUnits(),j=new window.mapboxgl.MercatorCoordinate(T.x-F,T.y,T.z),Y=j.toLngLat();this.meter2coord=x[0]-Y.lng;return}var ee=this.mapService.meterToCoord(x,[s,f]),Ae=this.mapService.meterToCoord(x,[v===s?v+.1:v,m===f?f+.1:m]);this.meter2coord=(ee+Ae)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v,x=a.animateOption,A=x===void 0?{enable:!1}:x,T=this.getShaders(A),O=T.frag,F=T.vert,j=T.type,Y=this.mapService.version==="GLOBEL";return[this.layer.buildLayerModel({moduleName:"pointfill_"+j,vertexShader:F,fragmentShader:O,triangulation:Y?eS:bd,depth:{enable:Y},blend:this.getBlend(),stencil:Da(f,m),cull:{enable:!0,face:Vl(this.mapService.version)}})]}},{key:"getShaders",value:function(a){if(a.enable)switch(a.type){case"wave":return{frag:My,vert:V0,type:"wave"};default:return{frag:My,vert:V0,type:"wave"}}else return{frag:iA,vert:V0,type:"normal"}}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"animateOption2Array",value:function(a){return[a.enable?0:1,a.speed||1,a.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var a=this,s=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Zn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(v,m,x,A){var T;if(s){var O=(0,mn.Z)(x,3),F=O[0],j=O[1],Y=O[2],ee=Ya.fromValues(0,0,1),Ae=Ya.fromValues(F,0,Y),Fe=F>=0?Ya.angle(ee,Ae):Math.PI*2-Ya.angle(ee,Ae),Xe=Math.PI*2-Math.asin(j/100),nt=Ki();sf(nt,nt,Fe),fh(nt,nt,Xe);var Et=Ya.fromValues(1,1,0);Ya.transformMat4(Et,Et,nt),Ya.normalize(Et,Et);var wt=Ya.fromValues(-1,1,0);Ya.transformMat4(wt,wt,nt),Ya.normalize(wt,wt);var Wt=Ya.fromValues(-1,-1,0);Ya.transformMat4(Wt,Wt,nt),Ya.normalize(Wt,Wt);var ur=Ya.fromValues(1,-1,0);Ya.transformMat4(ur,ur,nt),Ya.normalize(ur,ur),T=[].concat((0,pe.Z)(Et),(0,pe.Z)(wt),(0,pe.Z)(Wt),(0,pe.Z)(ur))}else T=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var Ar=A%4*3;return[T[Ar],T[Ar+1],T[Ar+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Zn.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(v,m,x,A){var T=v.size,O=T===void 0?5:T;return Array.isArray(O)?[O[0]*a.meter2coord]:[O*a.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Zn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(v,m,x,A){var T=v.shape,O=T===void 0?2:T,F=a.layer.getLayerConfig().shape2d,j=F.indexOf(O);return[j]}}})}}]),r}(Lo);function aA(e){var i=oA();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function oA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sA=`uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv;

void main() {

  float opacity = styleMappingMat[0][0];

  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  gl_FragColor = texture2D(u_texture, pos);
  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,uA=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute vec2 a_Uv;
attribute float a_Rotate;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform mat2 u_RotateMatrix;
uniform float u_isMeter;

varying float v_radius;
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv; // icon \u8D34\u56FE\u7684 uv \u5750\u6807

uniform float u_opacity : 1;
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;

  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // radius(16-bit)
  v_radius = a_Size;

  // TODO: billboard
  // anti-alias
  

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);

  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (rotation_matrix * u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,lA=function(e){(0,Ir.Z)(r,e);var i=aA(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"meter2coord",1),(0,S.Z)((0,J.Z)(n),"texture",void 0),(0,S.Z)((0,J.Z)(n),"isMeter",!1),(0,S.Z)((0,J.Z)(n),"radian",0),(0,S.Z)((0,J.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layer.renderLayers();return}n.texture=v({data:n.iconService.getCanvas(),mag:k.LINEAR,min:k.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.strokeOpacity,m=v===void 0?1:v,x=a.strokeWidth,A=x===void 0?0:x,T=a.stroke,O=T===void 0?"rgba(0,0,0,0)":T,F=a.offsets,j=F===void 0?[0,0]:F,Y=a.blend,ee=a.rotation;this.rendererService.getDirty()&&this.texture.bind();var Ae=1;if((this.mapService.version==="GAODE2.x"||this.mapService.version==="GAODE1.x")&&(Ae=-1),this.radian=ee!==void 0?Ae*Math.PI*ee/180:Ae*Math.PI*(this.mapService.getRotation()%360)/180,this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,strokeOpacity:m,strokeWidth:A,stroke:O,offsets:j})){this.judgeStyleAttributes({opacity:f,strokeOpacity:m,strokeWidth:A,stroke:O,offsets:j});var Fe=this.layer.getEncodedData(),Xe=this.calDataFrame(this.cellLength,Fe,this.cellProperties),nt=Xe.data,Et=Xe.width,wt=Xe.height;this.rowCount=wt,this.dataTexture=this.cellLength>0&&nt.length>0?this.createTexture2D({flipY:!0,data:nt,format:k.LUMINANCE,type:k.FLOAT,width:Et,height:wt}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_additive:Y==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:ki()(f)?f:1,u_offsets:this.isOffsetStatic(j)?j:[0,0]}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),bd)}},{key:"initModels",value:function(){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture);var a=this.layer.getLayerConfig(),s=a.unit,f=s===void 0?"l7size":s,v=this.mapService.version;return f==="meter"&&v!==ks.L7MAP&&v!==ks.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,mn.Z)(this.layer.getSource().extent,4),s=a[0],f=a[1],v=a[2],m=a[3],x=[(s+v)/2,(f+m)/2],A=this.mapService.version;if(A===ks.MAPBOX&&window.mapboxgl.MercatorCoordinate){var T=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:x[0],lat:x[1]},0),O=1,F=O*T.meterInMercatorCoordinateUnits(),j=new window.mapboxgl.MercatorCoordinate(T.x-F,T.y,T.z),Y=j.toLngLat();this.meter2coord=x[0]-Y.lng;return}var ee=this.mapService.meterToCoord(x,[s,f]),Ae=this.mapService.meterToCoord(x,[v===s?v+.1:v,m===f?f+.1:m]);this.meter2coord=(ee+Ae)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v,x=this.getShaders(),A=x.frag,T=x.vert,O=x.type;return[this.layer.buildLayerModel({moduleName:"pointfill_"+O,vertexShader:T,fragmentShader:A,triangulation:bd,depth:{enable:!1},blend:this.getBlend(),stencil:Da(f,m),cull:{enable:!0,face:Vl(this.mapService.version)}})]}},{key:"getShaders",value:function(){return{frag:sA,vert:uA,type:"normal"}}},{key:"clearModels",value:function(){var a,s;this.iconService.off("imageUpdate",this.updateTexture),(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"rotate",type:Zn.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(f,v,m,x){var A=f.rotate,T=A===void 0?0:A;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Zn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(f,v,m,x){var A=a.iconService.getIconMap(),T=f.shape,O=A[T]||{x:0,y:0},F=O.x,j=O.y;return[F,j]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Zn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(f,v,m,x){var A=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],T=x%4*3;return[A[T],A[T+1],A[T+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Zn.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(f,v,m,x){var A=f.size,T=A===void 0?5:A;return Array.isArray(T)?[T[0]*a.meter2coord]:[T*a.meter2coord]}}})}}]),r}(Lo);function cA(e){var i=fA();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function fA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hA=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,pA=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,dA=function(e){(0,Ir.Z)(r,e);var i=cA(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"texture",void 0),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;return{u_opacity:s||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var a=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){a.updateTexture(),a.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:pA,fragmentShader:hA,triangulation:py,primitive:k.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Zn.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(f,v,m,x){var A=f.size;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Zn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(f,v,m,x){var A=a.fontService.mapping,T=f.shape,O=a.fontService.getGlyph(T),F=A[O],j=F.x,Y=F.y;return[j,Y]}}})}},{key:"updateTexture",value:function(){var a=this.rendererService.createTexture2D,s=this.fontService.canvas;this.texture=a({data:s,mag:k.LINEAR,min:k.LINEAR,width:s.width,height:s.height})}},{key:"initIconFontGlyphs",value:function(){var a=this,s=this.layer.getLayerConfig(),f=s.fontWeight,v=f===void 0?"normal":f,m=s.fontFamily,x=m===void 0?"sans-serif":m,A=this.layer.getEncodedData(),T=[];A.forEach(function(O){var F=O.shape,j=F===void 0?"":F;j=j.toString();var Y=a.fontService.getGlyph(j);T.indexOf(Y)===-1&&T.push(Y)}),this.fontService.setFontOptions({characterSet:T,fontWeight:v,fontFamily:x,fontSize:48})}}]),r}(Lo);function vA(e){var i=mA();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function mA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gA=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,yA=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,Iy=function(e){(0,Ir.Z)(r,e);var i=vA(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"texture",void 0),(0,S.Z)((0,J.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layer.renderLayers();return}n.texture=v({data:n.iconService.getCanvas(),mag:k.LINEAR,min:k.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=a.offsets,v=f===void 0?[0,0]:f;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s,offsets:v})){this.judgeStyleAttributes({opacity:s,offsets:v});var m=this.layer.getEncodedData(),x=this.calDataFrame(this.cellLength,m,this.cellProperties),A=x.data,T=x.width,O=x.height;this.rowCount=O,this.dataTexture=this.cellLength>0&&A.length>0?this.createTexture2D({flipY:!0,data:A,format:k.LUMINANCE,type:k.FLOAT,width:T,height:O}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:ki()(s)?s:1,u_offsets:this.isOffsetStatic(v)?v:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:yA,fragmentShader:gA,triangulation:py,primitive:k.POINTS,depth:{enable:!1},blend:this.getBlend(),stencil:Da(f,m)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Zn.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(f,v,m,x){var A=f.size,T=A===void 0?5:A;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Zn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(f,v,m,x){var A=a.iconService.getIconMap(),T=f.shape,O=A[T]||{x:0,y:0},F=O.x,j=O.y;return[F,j]}}})}}]),r}(Lo);function _A(e){var i=xA();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function xA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bA=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,EA=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function SA(e){var i=e.coordinates;return{vertices:(0,pe.Z)(i),indices:[0],size:i.length}}var Oy=function(e){(0,Ir.Z)(r,e);var i=_A(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.offsets,m=v===void 0?[0,0]:v;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,offsets:m})){this.judgeStyleAttributes({opacity:f,offsets:m});var x=this.layer.getEncodedData(),A=this.calDataFrame(this.cellLength,x,this.cellProperties),T=A.data,O=A.width,F=A.height;this.rowCount=F,this.dataTexture=this.cellLength>0&&T.length>0?this.createTexture2D({flipY:!0,data:T,format:k.LUMINANCE,type:k.FLOAT,width:O,height:F}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ki()(f)?f:1,u_offsets:this.isOffsetStatic(m)?m:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:EA,fragmentShader:bA,triangulation:SA,depth:{enable:!1},primitive:k.POINTS,blend:this.getBlend(),stencil:Da(f,m)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Zn.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,f,v,m){var x=s.size,A=x===void 0?1:x;return Array.isArray(A)?[A[0]]:[A]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:Ws.additive}}}]),r}(Lo);function CA(e){var i=AA();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function AA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wA=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }

  vec2 extrude =  styleMappingMat[2].ba;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  // full circle
  // float rades = dot(dir, baseDir);
  // float flag = sign(dir.y);
  // float radar_v = (flag - 1.0) * -0.5 + flag * acos(rades)/pi/2.0;
  
  // half circle
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }



  gl_FragColor.a *= radar_v;
}
`,TA=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;
uniform float u_speed: 1.0;
uniform float u_time;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - a_Extrude.x - a_Extrude.y
    0.0, 0.0, 0.0, 0.0  // 
  );

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  styleMappingMat[2].ba = rotateMatrix * a_Extrude.xy;

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> empty -> empty ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;


  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  v_data = vec4(extrude.x, extrude.y, antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  if(u_globel > 0.0) {
    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);
  }

  setPickingColor(a_PickingColor);
}
`,MA=function(e){(0,Ir.Z)(r,e);var i=CA(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"meter2coord",1),(0,S.Z)((0,J.Z)(n),"isMeter",!1),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.strokeOpacity,m=v===void 0?1:v,x=a.strokeWidth,A=x===void 0?0:x,T=a.stroke,O=T===void 0?"rgba(0,0,0,0)":T,F=a.offsets,j=F===void 0?[0,0]:F,Y=a.blend,ee=a.speed,Ae=ee===void 0?1:ee;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,strokeOpacity:m,strokeWidth:A,stroke:O,offsets:j})){this.judgeStyleAttributes({opacity:f,strokeOpacity:m,strokeWidth:A,stroke:O,offsets:j});var Fe=this.layer.getEncodedData(),Xe=this.calDataFrame(this.cellLength,Fe,this.cellProperties),nt=Xe.data,Et=Xe.width,wt=Xe.height;this.rowCount=wt,this.dataTexture=this.cellLength>0&&nt.length>0?this.createTexture2D({flipY:!0,data:nt,format:k.LUMINANCE,type:k.FLOAT,width:Et,height:wt}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_speed:Ae,u_additive:Y==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ki()(f)?f:1,u_offsets:this.isOffsetStatic(j)?j:[0,0]}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,f=s===void 0?{enable:!1}:s;return{u_aimate:this.animateOption2Array(f),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),bd)}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.unit,f=s===void 0?"l7size":s,v=this.mapService.version;return f==="meter"&&v!==ks.L7MAP&&v!==ks.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,mn.Z)(this.layer.getSource().extent,4),s=a[0],f=a[1],v=a[2],m=a[3],x=[(s+v)/2,(f+m)/2],A=this.mapService.version;if(A===ks.MAPBOX&&window.mapboxgl.MercatorCoordinate){var T=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:x[0],lat:x[1]},0),O=1,F=O*T.meterInMercatorCoordinateUnits(),j=new window.mapboxgl.MercatorCoordinate(T.x-F,T.y,T.z),Y=j.toLngLat();this.meter2coord=x[0]-Y.lng;return}var ee=this.mapService.meterToCoord(x,[s,f]),Ae=this.mapService.meterToCoord(x,[v===s?v+.1:v,m===f?f+.1:m]);this.meter2coord=(ee+Ae)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v,x=this.getShaders(),A=x.frag,T=x.vert,O=x.type;return[this.layer.buildLayerModel({moduleName:"pointfill_"+O,vertexShader:T,fragmentShader:A,triangulation:bd,depth:{enable:!1},blend:this.getBlend(),stencil:Da(f,m),cull:{enable:!0,face:Vl(this.mapService.version)}})]}},{key:"getShaders",value:function(){return{frag:wA,vert:TA,type:"radar"}}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"animateOption2Array",value:function(a){return[a.enable?0:1,a.speed||1,a.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Zn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(f,v,m,x){var A;A=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var T=x%4*3;return[A[T],A[T+1],A[T+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Zn.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(f,v,m,x){var A=f.size,T=A===void 0?5:A;return Array.isArray(T)?[T[0]*a.meter2coord]:[T*a.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Zn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(f,v,m,x){var A=f.shape,T=A===void 0?2:A,O=a.layer.getLayerConfig().shape2d,F=O.indexOf(T);return[F]}}})}}]),r}(Lo);function PA(e){var i=IA();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function IA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var OA=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_additive;

uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  float opacity = styleMappingMat[0][0];
  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);

  

  
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,RA=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143
varying float v_blur;
varying float v_innerRadius;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function kA(e){var i=e.coordinates;return{vertices:(0,pe.Z)(i),indices:[0],size:i.length}}var LA=function(e){(0,Ir.Z)(r,e);var i=PA(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.offsets,m=v===void 0?[0,0]:v,x=a.blend,A=a.strokeOpacity,T=A===void 0?1:A,O=a.strokeWidth,F=O===void 0?0:O,j=a.stroke,Y=j===void 0?"#fff":j;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,offsets:m})){this.judgeStyleAttributes({opacity:f,offsets:m});var ee=this.layer.getEncodedData(),Ae=this.calDataFrame(this.cellLength,ee,this.cellProperties),Fe=Ae.data,Xe=Ae.width,nt=Ae.height;this.rowCount=nt,this.dataTexture=this.cellLength>0&&Fe.length>0?this.createTexture2D({flipY:!0,data:Fe,format:k.LUMINANCE,type:k.FLOAT,width:Xe,height:nt}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_additive:x==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ki()(f)?f:1,u_offsets:this.isOffsetStatic(m)?m:[0,0],u_stroke_opacity:ki()(T)?T:1,u_stroke_width:ki()(F)?F:0,u_stroke_color:this.getStrokeColor(Y)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"simplepoint",vertexShader:RA,fragmentShader:OA,triangulation:kA,depth:{enable:!1},primitive:k.POINTS,blend:this.getBlend(),stencil:Da(f,m)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Zn.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,f,v,m){var x=s.size,A=x===void 0?1:x;return Array.isArray(A)?[A[0]]:[A]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:Ws.additive}}}]),r}(Lo);function DA(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=FA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function FA(e,i){if(!!e){if(typeof e=="string")return Ry(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ry(e,i)}}function Ry(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var BA=function(){function e(i,r,n){(0,dt.Z)(this,e),(0,S.Z)(this,"boxCells",[]),(0,S.Z)(this,"xCellCount",void 0),(0,S.Z)(this,"yCellCount",void 0),(0,S.Z)(this,"boxKeys",void 0),(0,S.Z)(this,"bboxes",void 0),(0,S.Z)(this,"width",void 0),(0,S.Z)(this,"height",void 0),(0,S.Z)(this,"xScale",void 0),(0,S.Z)(this,"yScale",void 0),(0,S.Z)(this,"boxUid",void 0);var a=this.boxCells;this.xCellCount=Math.ceil(i/n),this.yCellCount=Math.ceil(r/n);for(var s=0;s<this.xCellCount*this.yCellCount;s++)a.push([]);this.boxKeys=[],this.bboxes=[],this.width=i,this.height=r,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/r,this.boxUid=0}return(0,It.Z)(e,[{key:"insert",value:function(r,n,a,s,f){this.forEachCell(n,a,s,f,this.insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(s),this.bboxes.push(f)}},{key:"query",value:function(r,n,a,s,f){return this.queryHitTest(r,n,a,s,!1,f)}},{key:"hitTest",value:function(r,n,a,s,f){return this.queryHitTest(r,n,a,s,!0,f)}},{key:"insertBoxCell",value:function(r,n,a,s,f,v){this.boxCells[f].push(v)}},{key:"queryHitTest",value:function(r,n,a,s,f,v){if(a<0||r>this.width||s<0||n>this.height)return f?!1:[];var m=[];if(r<=0&&n<=0&&this.width<=a&&this.height<=s){if(f)return!0;for(var x=0;x<this.boxKeys.length;x++)m.push({key:this.boxKeys[x],x1:this.bboxes[x*4],y1:this.bboxes[x*4+1],x2:this.bboxes[x*4+2],y2:this.bboxes[x*4+3]});return v?m.filter(v):m}var A={hitTest:f,seenUids:{box:{},circle:{}}};return this.forEachCell(r,n,a,s,this.queryCell,m,A,v),f?m.length>0:m}},{key:"queryCell",value:function(r,n,a,s,f,v,m,x){var A=m.seenUids,T=this.boxCells[f];if(T!==null){var O=this.bboxes,F=DA(T),j;try{for(F.s();!(j=F.n()).done;){var Y=j.value;if(!A.box[Y]){A.box[Y]=!0;var ee=Y*4;if(r<=O[ee+2]&&n<=O[ee+3]&&a>=O[ee+0]&&s>=O[ee+1]&&(!x||x(this.boxKeys[Y]))){if(m.hitTest)return v.push(!0),!0;v.push({key:this.boxKeys[Y],x1:O[ee],y1:O[ee+1],x2:O[ee+2],y2:O[ee+3]})}}}}catch(Ae){F.e(Ae)}finally{F.f()}}return!1}},{key:"forEachCell",value:function(r,n,a,s,f,v,m,x){for(var A=this.convertToXCellCoord(r),T=this.convertToYCellCoord(n),O=this.convertToXCellCoord(a),F=this.convertToYCellCoord(s),j=A;j<=O;j++)for(var Y=T;Y<=F;Y++){var ee=this.xCellCount*Y+j;if(f.call(this,r,n,a,s,ee,v,m,x))return}}},{key:"convertToXCellCoord",value:function(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}},{key:"convertToYCellCoord",value:function(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}}]),e}(),NA=BA,zA=function(){function e(i,r){(0,dt.Z)(this,e),(0,S.Z)(this,"width",void 0),(0,S.Z)(this,"height",void 0),(0,S.Z)(this,"grid",void 0),(0,S.Z)(this,"viewportPadding",100),(0,S.Z)(this,"screenRightBoundary",void 0),(0,S.Z)(this,"screenBottomBoundary",void 0),(0,S.Z)(this,"gridRightBoundary",void 0),(0,S.Z)(this,"gridBottomBoundary",void 0),this.width=i,this.height=r,this.viewportPadding=Math.max(i,r),this.grid=new NA(i+this.viewportPadding,r+this.viewportPadding,25),this.screenRightBoundary=i+this.viewportPadding,this.screenBottomBoundary=r+this.viewportPadding,this.gridRightBoundary=i+2*this.viewportPadding,this.gridBottomBoundary=r+2*this.viewportPadding}return(0,It.Z)(e,[{key:"placeCollisionBox",value:function(r){var n=r.x1+r.anchorPointX+this.viewportPadding,a=r.y1+r.anchorPointY+this.viewportPadding,s=r.x2+r.anchorPointX+this.viewportPadding,f=r.y2+r.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,a,s,f)||this.grid.hitTest(n,a,s,f)?{box:[]}:{box:[n,a,s,f]}}},{key:"insertCollisionBox",value:function(r,n){var a={featureIndex:n};this.grid.insert(a,r[0],r[1],r[2],r[3])}},{key:"project",value:function(r,n,a){var s=At(n,a,0,1),f=Me(),v=js.apply(_e,(0,pe.Z)(r));return fn(f,s,v),{x:(f[0]/f[3]+1)/2*this.width+this.viewportPadding,y:(-f[1]/f[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(r,n,a,s){return a>=0&&r<this.gridRightBoundary&&s>=0&&n<this.gridBottomBoundary}}]),e}();function ky(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=ZA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function ZA(e,i){if(!!e){if(typeof e=="string")return Ly(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ly(e,i)}}function Ly(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Dy(e){var i=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0;break;default:i=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0;break;default:r=.5}return{horizontalAlign:i,verticalAlign:r}}function Fy(e,i,r,n,a){if(!!a){var s=e[n],f=s.glyph;if(f)for(var v=i[f].advance*s.scale,m=(e[n].x+v)*a,x=r;x<=n;x++)e[x].x-=m}}function By(e,i,r,n,a,s,f){var v=(i-r)*a,m=(-n*f+.5)*s,x=ky(e),A;try{for(x.s();!(A=x.n()).done;){var T=A.value;T.x+=v,T.y+=m}}catch(O){x.e(O)}finally{x.f()}}function UA(e,i,r,n,a,s,f){var v=-8,m=0,x=v,A=0,T=e.positionedGlyphs,O=s==="right"?1:s==="left"?0:.5,F=T.length;r.forEach(function(Fe){if(Fe.split("").forEach(function(nt){var Et=i[nt],wt=0;Et&&(T.push({glyph:nt,x:m,y:x+wt,vertical:!1,scale:1,metrics:Et}),m+=Et.advance+f)}),T.length!==F){var Xe=m-f;A=Math.max(Xe,A),Fy(T,i,F,T.length-1,O)}m=0,x-=n+5});var j=Dy(a),Y=j.horizontalAlign,ee=j.verticalAlign;By(T,O,Y,ee,A,n,r.length);var Ae=x-v;e.top+=-ee*Ae,e.bottom=e.top-Ae,e.left+=-Y*A,e.right=e.left+A}function jA(e,i,r,n,a,s,f){var v=-8,m=0,x=v,A=0,T=e.positionedGlyphs,O=s==="right"?1:s==="left"?0:.5,F=T.length;r.forEach(function(Fe){var Xe=i[Fe],nt=0;if(Xe&&(T.push({glyph:Fe,x:Xe.advance/2,y:x+nt,vertical:!1,scale:1,metrics:Xe}),m+=Xe.advance+f),T.length!==F){var Et=m-f;A=Math.max(Et,A),Fy(T,i,F,T.length-1,O)}m=0,x-=n+5});var j=Dy(a),Y=j.horizontalAlign,ee=j.verticalAlign;By(T,O,Y,ee,A,n,r.length);var Ae=x-v;e.top+=-ee*Ae,e.bottom=e.top-Ae,e.left+=-Y*A,e.right=e.left+A}function VA(e,i,r,n,a,s){var f=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],v=arguments.length>7?arguments[7]:void 0,m=e.split(`
`),x=[],A={positionedGlyphs:x,top:f[1],bottom:f[1],left:f[0],right:f[0],lineCount:m.length,text:e};return v?jA(A,i,m,r,n,a,s):UA(A,i,m,r,n,a,s),x.length?A:!1}function GA(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,n=e.positionedGlyphs,a=n===void 0?[]:n,s=[],f=ky(a),v;try{for(f.s();!(v=f.n()).done;){var m=v.value,x=m.metrics,A=4,T=x.advance*m.scale/2,O=r?[m.x+T,m.y]:[0,0],F=r?[0,0]:[m.x+T+i[0],m.y+i[1]],j=(0-A)*m.scale-T+F[0],Y=(0-A)*m.scale+F[1],ee=j+x.width*m.scale,Ae=Y+x.height*m.scale,Fe={x:j,y:Y},Xe={x:ee,y:Y},nt={x:j,y:Ae},Et={x:ee,y:Ae};s.push({tl:Fe,tr:Xe,bl:nt,br:Et,tex:x,glyphOffset:O})}}catch(wt){f.e(wt)}finally{f.f()}return s}function HA(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=WA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function WA(e,i){if(!!e){if(typeof e=="string")return Ny(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ny(e,i)}}function Ny(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function XA(e){var i=YA();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function YA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zy=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Zy=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_raisingHeight: 0.0;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function Uy(e){var i=this,r=e.id,n=[],a=[];if(!i.glyphInfoMap||!i.glyphInfoMap[r])return{vertices:[],indices:[],size:7};var s=i.glyphInfoMap[r].centroid,f=s.length===2?[s[0],s[1],0]:s;return i.glyphInfoMap[r].glyphQuads.forEach(function(v,m){n.push.apply(n,(0,pe.Z)(f).concat([v.tex.x,v.tex.y+v.tex.height,v.tl.x,v.tl.y],(0,pe.Z)(f),[v.tex.x+v.tex.width,v.tex.y+v.tex.height,v.tr.x,v.tr.y],(0,pe.Z)(f),[v.tex.x+v.tex.width,v.tex.y,v.br.x,v.br.y],(0,pe.Z)(f),[v.tex.x,v.tex.y,v.bl.x,v.bl.y])),a.push(0+m*4,1+m*4,2+m*4,2+m*4,3+m*4,0+m*4)}),{vertices:n,indices:a,size:7}}var jy=function(e){(0,Ir.Z)(r,e);var i=XA(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"glyphInfo",void 0),(0,S.Z)((0,J.Z)(n),"glyphInfoMap",{}),(0,S.Z)((0,J.Z)(n),"texture",void 0),(0,S.Z)((0,J.Z)(n),"currentZoom",-1),(0,S.Z)((0,J.Z)(n),"extent",void 0),(0,S.Z)((0,J.Z)(n),"textureHeight",0),(0,S.Z)((0,J.Z)(n),"textCount",0),(0,S.Z)((0,J.Z)(n),"preTextStyle",{}),(0,S.Z)((0,J.Z)(n),"buildModels",function(){var v=n.layer.getLayerConfig(),m=v.mask,x=m===void 0?!1:m,A=v.maskInside,T=A===void 0?!0:A;return n.initGlyph(),n.updateTexture(),n.filterGlyphs(),n.reBuildModel(),[n.layer.buildLayerModel({moduleName:"pointText",vertexShader:Zy,fragmentShader:zy,triangulation:Uy.bind((0,J.Z)(n)),depth:{enable:!1},blend:n.getBlend(),stencil:Da(x,T)})]}),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.stroke,m=v===void 0?"#fff":v,x=a.strokeWidth,A=x===void 0?0:x,T=a.textAnchor,O=T===void 0?"center":T,F=a.textAllowOverlap,j=F===void 0?!1:F,Y=a.halo,ee=Y===void 0?.5:Y,Ae=a.gamma,Fe=Ae===void 0?2:Ae,Xe=a.raisingHeight,nt=Xe===void 0?0:Xe,Et=this.fontService,wt=Et.canvas,Wt=Et.mapping;if(Object.keys(Wt).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(Wt).length),this.preTextStyle={textAnchor:O,textAllowOverlap:j},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,strokeWidth:A,stroke:m})){this.judgeStyleAttributes({opacity:f,strokeWidth:A,stroke:m});var ur=this.layer.getEncodedData(),Ar=this.calDataFrame(this.cellLength,ur,this.cellProperties),Jr=Ar.data,gr=Ar.width,vn=Ar.height;this.rowCount=vn,this.dataTexture=this.cellLength>0&&Jr.length>0?this.createTexture2D({flipY:!0,data:Jr,format:k.LUMINANCE,type:k.FLOAT,width:gr,height:vn}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(nt),u_opacity:ki()(f)?f:1,u_stroke_width:ki()(A)?A:0,u_stroke_color:this.getStrokeColor(m),u_sdf_map:this.texture,u_halo_blur:ee,u_gamma_scale:Fe,u_sdf_map_size:[wt.width,wt.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var a=this.layer.getLayerConfig(),s=a.textAnchor,f=s===void 0?"center":s,v=a.textAllowOverlap,m=v===void 0?!0:v;return this.preTextStyle={textAnchor:f,textAllowOverlap:m},this.buildModels()}},{key:"needUpdate",value:function(){var a=this.layer.getLayerConfig(),s=a.textAllowOverlap,f=s===void 0?!1:s,v=this.mapService.getZoom(),m=this.mapService.getBounds(),x=wn(this.extent,m);return!f&&(Math.abs(this.currentZoom-v)>1||!x)||f!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:Zn.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,f,v,m){var x=s.rotate,A=x===void 0?0:x;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:Zn.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(s,f,v,m){return[v[5],v[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Zn.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,f,v,m){var x=s.size,A=x===void 0?12:x;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:Zn.Attribute,descriptor:{name:"a_tex",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(s,f,v,m){return[v[3],v[4]]}}})}},{key:"textExtent",value:function(){var a=this.mapService.getBounds();return Ln(a,.5)}},{key:"initTextFont",value:function(){var a=this.layer.getLayerConfig(),s=a.fontWeight,f=s===void 0?"400":s,v=a.fontFamily,m=v===void 0?"sans-serif":v,x=this.layer.getEncodedData(),A=[];x.forEach(function(T){var O=T.shape,F=O===void 0?"":O;F=F.toString();var j=HA(F),Y;try{for(j.s();!(Y=j.n()).done;){var ee=Y.value;A.indexOf(ee)===-1&&A.push(ee)}}catch(Ae){j.e(Ae)}finally{j.f()}}),this.fontService.setFontOptions({characterSet:A,fontWeight:f,fontFamily:m,iconfont:!1})}},{key:"initIconFontTex",value:function(){var a=this.layer.getLayerConfig(),s=a.fontWeight,f=s===void 0?"400":s,v=a.fontFamily,m=v===void 0?"sans-serif":v,x=this.layer.getEncodedData(),A=[];x.forEach(function(T){var O=T.shape,F=O===void 0?"":O;F="".concat(F),A.indexOf(F)===-1&&A.push(F)}),this.fontService.setFontOptions({characterSet:A,fontWeight:f,fontFamily:m,iconfont:!0})}},{key:"generateGlyphLayout",value:function(a){var s=this,f=this.fontService.mapping,v=this.layer.getLayerConfig(),m=v.spacing,x=m===void 0?2:m,A=v.textAnchor,T=A===void 0?"center":A,O=this.layer.getEncodedData();this.glyphInfo=O.map(function(F){var j=F.shape,Y=j===void 0?"":j,ee=F.id,Ae=F.size,Fe=Ae===void 0?1:Ae,Xe=F.textOffset,nt=Xe===void 0?[0,0]:Xe,Et=VA(Y.toString(),f,Fe,T,"left",x,nt,a),wt=GA(Et,nt,!1);return F.shaping=Et,F.glyphQuads=wt,F.centroid=Zp(F.coordinates),F.originCentroid=F.version==="GAODE2.x"?Zp(F.originCoordinates):F.originCentroid=F.centroid,s.glyphInfoMap[ee]={shaping:Et,glyphQuads:wt,centroid:Zp(F.coordinates)},F})}},{key:"filterGlyphs",value:function(){var a=this,s=this.layer.getLayerConfig(),f=s.padding,v=f===void 0?[4,4]:f,m=s.textAllowOverlap,x=m===void 0?!1:m;if(!x){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var A=this.rendererService.getViewportSize(),T=A.width,O=A.height,F=new zA(T,O),j=this.glyphInfo.filter(function(Y){var ee=Y.shaping,Ae=Y.id,Fe=Ae===void 0?0:Ae,Xe=Y.version==="GAODE2.x"?Y.originCentroid:Y.centroid,nt=Y.size,Et=nt/24,wt=a.mapService.lngLatToContainer(Xe),Wt=F.placeCollisionBox({x1:ee.left*Et-v[0],x2:ee.right*Et+v[0],y1:ee.top*Et-v[1],y2:ee.bottom*Et+v[1],anchorPointX:wt.x,anchorPointY:wt.y}),ur=Wt.box;return ur&&ur.length?(F.insertCollisionBox(ur,Fe),!0):!1});j.forEach(function(Y){a.glyphInfoMap[Y.id]=Y})}}},{key:"initGlyph",value:function(){var a=this.layer.getLayerConfig(),s=a.iconfont,f=s===void 0?!1:s;f?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(f)}},{key:"updateTexture",value:function(){var a=this.rendererService.createTexture2D,s=this.fontService.canvas;this.textureHeight=s.height,this.texture&&this.texture.destroy(),this.texture=a({data:s,mag:k.LINEAR,min:k.LINEAR,width:s.width,height:s.height})}},{key:"reBuildModel",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v;this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:Zy,fragmentShader:zy,triangulation:Uy.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:Da(f,m)})]}}]),r}(Lo),qA={fillImage:lA,fill:Py,radar:MA,image:Iy,normal:Oy,simplePoint:LA,extrude:Ty,text:jy,icon:dA},KA=qA;function $A(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=QA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function QA(e,i){if(!!e){if(typeof e=="string")return Vy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Vy(e,i)}}function Vy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function JA(e){var i=ew();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function ew(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tw=function(e){(0,Ir.Z)(r,e);var i=JA(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"type","PointLayer"),n}return(0,It.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new KA[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var a=this.shapeOption,s=a.field,f=a.values,v=this.getLayerConfig(),m=v.shape2d,x=v.shape3d,A=this.iconService.getIconMap();if(s&&(m==null?void 0:m.indexOf(s))!==-1)return"fill";if(f&&f instanceof Array){var T=$A(f),O;try{for(T.s();!(O=T.n()).done;){var F=O.value;if(typeof F=="string"&&A.hasOwnProperty(F))return"image"}}catch(j){T.e(j)}finally{T.f()}}}return"normal"}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}};return s[a]}},{key:"getModelType",value:function(){var a=["fillImage","fill","radar","image","normal","simplePoint","extrude","text","icon"];if(this.layerType&&a.includes(this.layerType))return this.layerType;var s=this.getEncodedData(),f=this.getLayerConfig(),v=f.shape2d,m=f.shape3d,x=this.iconService.getIconMap(),A=s.find(function(O){return O.hasOwnProperty("shape")});if(A){var T=A.shape;return T==="dot"?"normal":T==="simple"?"simplePoint":T==="radar"?"radar":T==="fillImage"?"fillImage":(v==null?void 0:v.indexOf(T))!==-1?"fill":(m==null?void 0:m.indexOf(T))!==-1?"extrude":x.hasOwnProperty(T)?"image":this.fontService.getGlyph(T)!==""?"icon":"text"}else return this.getModelTypeWillEmptyData()}}]),r}(zp);function rw(e){var i=nw();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function nw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var iw=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];  
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }

  } else {
     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,aw=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  if(styleMappingMat[0][3] < 1.0 ) {
    // side
    styleMappingMat[0][0] = 0.0;
  } else {

  }

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,ow=`uniform sampler2D u_texture;
uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float lightWeight = styleMappingMat[3][1];
  float topU = styleMappingMat[2][2];
  float topV = styleMappingMat[2][3];

  float sidey = styleMappingMat[3][0];
  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }
  } else {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = texture2D(u_texture, vec2(topU, topV));
  }
  

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,sw=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  v_Color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - a_Position.z(judge side by a_Position.z)
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - u - v
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[2][2] = a_uvs[0];
  styleMappingMat[2][3] = 1.0 - a_uvs[1];
  styleMappingMat[3][0] = a_uvs[2];


  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,uw=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      // side notuse linear
       gl_FragColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
}
`,lw=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,cw=function(e){(0,Ir.Z)(r,e);var i=rw(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"texture",void 0),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.heightfixed,m=v===void 0?!1:v,x=a.raisingHeight,A=x===void 0?0:x,T=a.topsurface,O=T===void 0?!0:T,F=a.sidesurface,j=F===void 0?!0:F,Y=a.sourceColor,ee=a.targetColor;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var Ae=this.layer.getEncodedData(),Fe=this.calDataFrame(this.cellLength,Ae,this.cellProperties),Xe=Fe.data,nt=Fe.width,Et=Fe.height;this.rowCount=Et,this.dataTexture=this.cellLength>0&&Xe.length>0?this.createTexture2D({flipY:!0,data:Xe,format:k.LUMINANCE,type:k.FLOAT,width:nt,height:Et}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}var wt=0,Wt=[1,1,1,1],ur=[1,1,1,1];return Y&&ee&&(Wt=pi(Y),ur=pi(ee),wt=1),{u_topsurface:Number(O),u_sidesurface:Number(j),u_heightfixed:Number(m),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(A),u_opacity:ki()(f)?f:1,u_linearColor:wt,u_sourceColor:Wt,u_targetColor:ur,u_texture:this.texture}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v,x=this.getShaders(),A=x.frag,T=x.vert,O=x.type;return[this.layer.buildLayerModel({moduleName:O,vertexShader:T,fragmentShader:A,triangulation:vy,stencil:Da(f,m),cull:{enable:!0,face:k.BACK}})]}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.pickLight,f=a.mapTexture;return f?{frag:ow,vert:sw,type:"polygonExtrudeTexture"}:s?{frag:uw,vert:lw,type:"polygonExtrude"}:{frag:iw,vert:aw,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var a,s;(a=this.dataTexture)===null||a===void 0||a.destroy(),(s=this.texture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getSource().extent,s=(0,mn.Z)(a,4),f=s[0],v=s[1],m=s[2],x=s[3],A=m-f,T=x-v;this.styleAttributeService.registerStyleAttribute({name:"uvs",type:Zn.Attribute,descriptor:{name:"a_uvs",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(F,j,Y,ee,Ae){var Fe=Y[0],Xe=Y[1];return[(Fe-f)/A,(Xe-v)/T,Y[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Zn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(F,j,Y,ee,Ae){return Ae}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Zn.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(F,j,Y,ee){var Ae=F.size,Fe=Ae===void 0?10:Ae;return Array.isArray(Fe)?[Fe[0]]:[Fe]}}})}},{key:"loadTexture",value:function(){var a=this,s=this.layer.getLayerConfig(),f=s.mapTexture,v=this.rendererService.createTexture2D;if(this.texture=v({height:0,width:0}),f){var m=new Image;m.crossOrigin="",m.src=f,m.onload=function(){a.texture=v({data:m,width:m.width,height:m.height,wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE,min:k.LINEAR,mag:k.LINEAR}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}}}]),r}(Lo);function fw(e){var i=hw();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function hw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pw=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,dw=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;


void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,vw=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}`,mw=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,gw=function(e){(0,Ir.Z)(r,e);var i=fw(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.raisingHeight,f=s===void 0?0:s,v=a.opacity,m=v===void 0?1:v,x=a.opacityLinear,A=x===void 0?{enable:!1,dir:"in"}:x;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:m})){this.judgeStyleAttributes({opacity:m});var T=this.layer.getEncodedData(),O=this.calDataFrame(this.cellLength,T,this.cellProperties),F=O.data,j=O.width,Y=O.height;this.rowCount=Y,this.dataTexture=this.cellLength>0&&F.length>0?this.createTexture2D({flipY:!0,data:F,format:k.LUMINANCE,type:k.FLOAT,width:j,height:Y}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(f),u_opacity:ki()(m)?m:1,u_opacitylinear:Number(A.enable),u_dir:A.dir==="in"?1:0}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.opacityLinear,f=s===void 0?{enable:!1,dir:"in"}:s,v=a.mask,m=v===void 0?!1:v,x=a.maskInside,A=x===void 0?!0:x;return[this.layer.buildLayerModel({moduleName:"polygon",vertexShader:f.enable?vw:mw,fragmentShader:f.enable?dw:pw,triangulation:f.enable?rS:j0,blend:this.getBlend(),depth:{enable:!1},cull:{enable:!0,face:k.BACK},stencil:Da(m,A)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getLayerConfig(),s=a.opacityLinear,f=s===void 0?{enable:!1,dir:"in"}:s;f.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:Zn.Attribute,descriptor:{name:"a_linear",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(m,x,A,T,O){return[A[3],A[4],A[5]]}}})}}]),r}(Lo);function yw(e){var i=_w();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function _w(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xw=`
uniform float u_time;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;
// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)
// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)
uniform vec4 u_watercolor;
uniform vec4 u_watercolor2;
vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture2D(u_texture2,p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture2D(u_texture1,fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    

  float opacity = styleMappingMat[0][0];
  gl_FragColor = vec4(col, opacity);

  // gl_FragColor = v_Color;
  
}
`,bw=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,Ew=function(e){(0,Ir.Z)(r,e);var i=yw(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"texture1",void 0),(0,S.Z)((0,J.Z)(n),"texture2",void 0),(0,S.Z)((0,J.Z)(n),"texture3",void 0),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.watercolor,m=v===void 0?"#6D99A8":v,x=a.watercolor2,A=x===void 0?"#0F121C":x;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var T=this.layer.getEncodedData(),O=this.calDataFrame(this.cellLength,T,this.cellProperties),F=O.data,j=O.width,Y=O.height;this.rowCount=Y,this.dataTexture=this.cellLength>0&&F.length>0?this.createTexture2D({flipY:!0,data:F,format:k.LUMINANCE,type:k.FLOAT,width:j,height:Y}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:pi(m),u_watercolor2:pi(A),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ki()(f)?f:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"polygon_ocean",vertexShader:bw,fragmentShader:xw,triangulation:j0,depth:{enable:!1},stencil:Da(f,m)})]}},{key:"clearModels",value:function(){var a,s,f,v;(a=this.texture1)===null||a===void 0||a.destroy(),(s=this.texture2)===null||s===void 0||s.destroy(),(f=this.texture3)===null||f===void 0||f.destroy(),(v=this.dataTexture)===null||v===void 0||v.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getSource().extent,s=(0,mn.Z)(a,4),f=s[0],v=s[1],m=s[2],x=s[3],A=m-f,T=x-v;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:Zn.Attribute,descriptor:{name:"a_uv",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(F,j,Y,ee,Ae){var Fe=(0,mn.Z)(Y,2),Xe=Fe[0],nt=Fe[1];return[(Xe-f)/A,(nt-v)/T]}}})}},{key:"loadTexture",value:function(){var a=this,s=this.rendererService.createTexture2D,f={height:0,width:0};this.texture1=s(f),this.texture2=s(f),this.texture3=s(f),v(function(x){a.texture1=m(x[0]),a.texture2=m(x[1]),a.texture3=m(x[2]),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()});function v(x){var A=0,T=[],O=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];O.map(function(F){var j=new Image;j.crossOrigin="",j.src=F,T.push(j),j.onload=function(){A++,A===3&&x(T)}})}function m(x){return s({data:x,width:x.width,height:x.height,wrapS:k.MIRRORED_REPEAT,wrapT:k.MIRRORED_REPEAT,min:k.LINEAR,mag:k.LINEAR})}}}]),r}(Lo);function Sw(e){var i=Cw();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function Cw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Aw=`
uniform sampler2D u_texture;
uniform float u_time;
uniform float u_speed: 1.0;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

  float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

  float water(vec3 p) {
    float t = u_time * u_speed;
    p.z += t * 2.; p.x += t * 2.;
    vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;
    p.z += t * 3.; p.x += t * 0.52;
    vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;
    p.z += t * 4.; p.x += t * 0.8;
    vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;
    c1 += c2 - c3;
    float z = (c1.x + c1.y + c1.z) / 3.;
    return p.y + z / 4.;
  }

  float map(vec3 p) {
    float d = 100.0;
    d = water(p);
    return d;
  }

  float intersect(vec3 ro, vec3 rd) {
    float d = 0.0;
    for (int i = 0; i <= 100; i++) {
      float h = map(ro + rd * d);
      if (h < 0.1) return  d;
      d += h;
    }
    return 0.0;
  }
  
  vec3 norm(vec3 p) {
    float eps = .1;
    return normalize(vec3(
      map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
      map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
      map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
    ));
  } 

  float calSpc() {
    vec3 l1 = normalize(vec3(1, 1, 1));
    vec3 ro = vec3(-3, 20, -8);
    vec3 rc = vec3(0, 0, 0);
    vec3 ww = normalize(rc - ro);
    vec3 uu = normalize(cross(vec3(0,1,0), ww));
    vec3 vv = normalize(cross(rc - ro, uu));
    vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
    float d = intersect(ro, rd);
    vec3 p = ro + rd * d;
    vec3 n = norm(p);
    float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
    return spc;
  }

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;

  float spc = calSpc();
  gl_FragColor += spc * 0.4;
}
`,ww=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,Tw=function(e){(0,Ir.Z)(r,e);var i=Sw(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"texture",void 0),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.speed,m=v===void 0?.5:v;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var x=this.layer.getEncodedData(),A=this.calDataFrame(this.cellLength,x,this.cellProperties),T=A.data,O=A.width,F=A.height;this.rowCount=F,this.dataTexture=this.cellLength>0&&T.length>0?this.createTexture2D({flipY:!0,data:T,format:k.LUMINANCE,type:k.FLOAT,width:O,height:F}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_texture:this.texture,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_speed:m,u_opacity:ki()(f)?f:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"polygon_water",vertexShader:ww,fragmentShader:Aw,triangulation:j0,depth:{enable:!1},stencil:Da(f,m)})]}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getSource().extent,s=(0,mn.Z)(a,4),f=s[0],v=s[1],m=s[2],x=s[3],A=m-f,T=x-v;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:Zn.Attribute,descriptor:{name:"a_uv",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(F,j,Y,ee,Ae){var Fe=(0,mn.Z)(Y,2),Xe=Fe[0],nt=Fe[1];return[(Xe-f)/A,(nt-v)/T]}}})}},{key:"loadTexture",value:function(){var a=this,s=this.layer.getLayerConfig(),f=s.waterTexture,v=this.rendererService.createTexture2D;this.texture=v({height:0,width:0});var m=new Image;m.crossOrigin="",f?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),m.src=f):m.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",m.onload=function(){a.texture=v({data:m,width:m.width,height:m.height,wrapS:k.MIRRORED_REPEAT,wrapT:k.MIRRORED_REPEAT,min:k.LINEAR,mag:k.LINEAR}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}}]),r}(Lo),Mw={fill:gw,line:Ay,extrude:cw,text:jy,point_fill:Py,point_image:Iy,point_normal:Oy,point_extrude:Ty,water:Tw,ocean:Ew},Pw=Mw;function Iw(e){var i=Ow();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function Ow(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Gy=function(e){(0,Ir.Z)(r,e);var i=Iw(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"type","PolygonLayer"),n}return(0,It.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new Pw[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),f=s==null||(a=s.scale)===null||a===void 0?void 0:a.field;return f==="fill"?"fill":f==="extrude"?"extrude":f==="water"?"water":f==="ocean"?"ocean":f==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var a=this.getEncodedData(),s=this.getLayerConfig(),f=s.shape2d,v=s.shape3d,m=this.iconService.getIconMap(),x=a.find(function(T){return T.hasOwnProperty("shape")});if(x){var A=x.shape;return A==="dot"?"point_normal":(f==null?void 0:f.indexOf(A))!==-1?"point_fill":(v==null?void 0:v.indexOf(A))!==-1?"point_extrude":m.hasOwnProperty(A)?"point_image":"text"}else return"fill"}}]),r}(zp);function Rw(e){var i=kw();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function kw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Lw=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,Dw=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,Hy=function(e){(0,Ir.Z)(r,e);var i=Rw(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"texture",void 0),(0,S.Z)((0,J.Z)(n),"colorTexture",void 0),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.clampLow,m=v===void 0?!0:v,x=a.clampHigh,A=x===void 0?!0:x,T=a.noDataValue,O=T===void 0?-9999999:T,F=a.domain,j=F===void 0?[0,1]:F;return this.updateColorTexure(),{u_opacity:f||1,u_texture:this.texture,u_domain:j,u_clampLow:m,u_clampHigh:typeof A!="undefined"?A:m,u_noDataValue:O,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v,x=this.layer.getSource(),A=this.rendererService.createTexture2D,T=x.data.dataArray[0];this.texture=A({data:T.data,width:T.width,height:T.height,format:k.LUMINANCE,type:k.FLOAT});var O=this.layer.getLayerConfig(),F=O.rampColors,j=jl(F);return this.colorTexture=A({data:j.data,width:j.width,height:j.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:Dw,fragmentShader:Lw,triangulation:yy,primitive:k.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:Da(f,m)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Zn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(s,f,v,m){return[v[3],v[4]]}}})}},{key:"updateColorTexure",value:function(){var a=this.rendererService.createTexture2D,s=this.layer.getLayerConfig(),f=s.rampColors,v=jl(f);this.colorTexture=a({data:v.data,width:v.width,height:v.height,flipY:!1})}}]),r}(Lo),Fw={raster:Hy,raster3d:Hy},Bw=Fw;function Nw(e){var i=zw();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function zw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Zw=function(e){(0,Ir.Z)(r,e);var i=Nw(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"type","RasterLayer"),n}return(0,It.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new Bw[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={raster:{},raster3d:{}};return s[a]}},{key:"getModelType",value:function(){return"raster"}}]),r}(zp),Wy,Xy,Yy,qy,Ky,ov,$y,Qy,Jy;function e_(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Uw(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?e_(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):e_(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var jw=(Wy=(0,Yr.b2)(),Xy=(0,Yr.f3)(xt.IGlobalConfigService),Yy=(0,Yr.f3)(xt.IMapService),qy=(0,Yr.f3)(xt.IFontService),Wy(Ky=(ov=function(){function e(){(0,dt.Z)(this,e),Nn(this,"configService",$y,this),Nn(this,"mapService",Qy,this),Nn(this,"fontService",Jy,this)}return(0,It.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("DataMappingPlugin",function(){a.generateMaping(r,{styleAttributeService:s})}),r.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return r.dataState.dataMappingNeedUpdate=!1,a.generateMaping(r,{styleAttributeService:s}),!0}),r.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!r.layerModelNeedUpdate){var f=r.getBottomColor(),v=s.getLayerStyleAttributes()||[],m=s.getLayerStyleAttribute("filter"),x=r.getSource().data.dataArray,A=v.filter(function(O){return O.needRemapping}),T=x;m!=null&&m.needRemapping&&m!==null&&m!==void 0&&m.scale&&(T=x.filter(function(O){return a.applyAttributeMapping(m,O,f)[0]})),A.length&&(m!=null&&m.needRemapping?(r.setEncodedData(a.mapping(v,T,void 0,f,r)),m.needRemapping=!1):r.setEncodedData(a.mapping(A,T,r.getEncodedData(),f,r)),r.emit("remapping",null))}})}},{key:"generateMaping",value:function(r,n){var a=this,s=n.styleAttributeService,f=r.getBottomColor(),v=s.getLayerStyleAttributes()||[],m=s.getLayerStyleAttribute("filter"),x=r.getSource().data.dataArray,A=x;m!=null&&m.scale&&(A=x.filter(function(T){return a.applyAttributeMapping(m,T,f)[0]})),r.setEncodedData(this.mapping(v,A,void 0,f,r)),r.emit("dataUpdate",null)}},{key:"getArrowPoints",value:function(r,n){var a=[n[0]-r[0],n[1]-r[1]],s=Qo(a),f=[r[0]+s[0]*1e-4,r[1]+s[1]*1e-4];return f}},{key:"mapping",value:function(r,n,a,s,f){var v=this,m=f==null?void 0:f.getLayerConfig(),x=m.arrow,A=x===void 0?{enable:!1}:x,T=n.map(function(O,F){var j=a?a[F]:{},Y=Uw({id:O._id,coordinates:O.coordinates},j);if(r.filter(function(Fe){return Fe.scale!==void 0}).forEach(function(Fe){var Xe=v.applyAttributeMapping(Fe,O,s);Fe.needRemapping=!1,Fe.name==="color"&&(Xe=Xe.map(function(nt){return pi(nt)})),Y[Fe.name]=Array.isArray(Xe)&&Xe.length===1?Xe[0]:Xe,Fe.name==="shape"&&(Y.shape=v.fontService.getIconFontKey(Y[Fe.name]))}),Y.shape==="line"&&A.enable){var ee=Y.coordinates,Ae=v.getArrowPoints(ee[0],ee[1]);Y.coordinates.splice(1,0,Ae,Ae)}return Y});return this.adjustData2Amap2Coordinates(T),this.adjustData2SimpleCoordinates(T),T}},{key:"adjustData2Amap2Coordinates",value:function(r){var n=this;r.length>0&&this.mapService.version===ks["GAODE2.x"]&&(typeof r[0].coordinates[0]=="number"?r.filter(function(a){return!a.originCoordinates}).map(function(a){a.version=ks["GAODE2.x"],a.originCoordinates=X()(a.coordinates),a.coordinates=n.mapService.lngLatToCoord(a.coordinates)}):r.filter(function(a){return!a.originCoordinates}).map(function(a){a.version=ks["GAODE2.x"],a.originCoordinates=X()(a.coordinates),a.coordinates=n.mapService.lngLatToCoords(a.coordinates)}))}},{key:"adjustData2SimpleCoordinates",value:function(r){var n=this;r.length>0&&this.mapService.version===ks.SIMPLE&&r.map(function(a){a.simpleCoordinate||(a.coordinates=n.unProjectCoordinates(a.coordinates),a.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(r){var n=this;if(typeof r[0]=="number")return this.mapService.simpleMapCoord.unproject(r);if(r[0]&&r[0][0]instanceof Array){var a=[];return r.map(function(f){var v=[];f.map(function(m){v.push(n.mapService.simpleMapCoord.unproject(m))}),a.push(v)}),a}else{var s=[];return r.map(function(f){s.push(n.mapService.simpleMapCoord.unproject(f))}),s}}},{key:"applyAttributeMapping",value:function(r,n,a){var s;if(!r.scale)return[];var f=(r==null||(s=r.scale)===null||s===void 0?void 0:s.scalers)||[],v=[];f.forEach(function(x){var A,T=x.field;(n.hasOwnProperty(T)||((A=r.scale)===null||A===void 0?void 0:A.type)==="variable")&&v.push(n[T])});var m=r.mapping?r.mapping(v):[];return r.name==="color"&&!yu(m[0])?[a]:m}}]),e}(),$y=ni(ov.prototype,"configService",[Xy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qy=ni(ov.prototype,"mapService",[Yy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jy=ni(ov.prototype,"fontService",[qy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ov))||Ky),t_,r_,Vw=(t_=(0,Yr.b2)(),t_(r_=function(){function e(){(0,dt.Z)(this,e),(0,S.Z)(this,"mapService",void 0)}return(0,It.Z)(e,[{key:"apply",value:function(r){var n=this;this.mapService=r.getContainer().get(xt.IMapService),r.hooks.init.tap("DataSourcePlugin",function(){var a=r.getSource();if(!a){var s=r.sourceOption||{data:$p,options:dp},f=s.data,v=s.options;r.setSource(new Fh(f,v))}n.updateClusterData(r)}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var a=n.updateClusterData(r),s=r.dataState.dataSourceNeedUpdate;return r.dataState.dataSourceNeedUpdate=!1,a||s})}},{key:"updateClusterData",value:function(r){var n=r.getSource(),a=n.cluster,s=n.clusterOptions,f=s.zoom,v=f===void 0?0:f,m=s.maxZoom,x=m===void 0?16:m,A=this.mapService.getZoom()-1,T=r.dataState.dataSourceNeedUpdate;return a&&(T||Math.abs(r.clusterZoom-A)>=1)?(v!==Math.floor(A)&&n.updateClusterData(Math.floor(A)),r.clusterZoom=A,!0):!1}}]),e}())||r_);function G0(e,i){return e<i?-1:e>i?1:e>=i?0:NaN}function n_(e){return e.length===1&&(e=Gw(e)),{left:function(i,r,n,a){for(n==null&&(n=0),a==null&&(a=i.length);n<a;){var s=n+a>>>1;e(i[s],r)<0?n=s+1:a=s}return n},right:function(i,r,n,a){for(n==null&&(n=0),a==null&&(a=i.length);n<a;){var s=n+a>>>1;e(i[s],r)>0?a=s:n=s+1}return n}}}function Gw(e){return function(i,r){return G0(e(i),r)}}var i_=n_(G0),Hw=i_.right,rI=i_.left,qv=Hw;function Ww(e,i){var r=e.length,n=-1,a,s,f;if(i==null){for(;++n<r;)if((a=e[n])!=null&&a>=a)for(s=f=a;++n<r;)(a=e[n])!=null&&(s>a&&(s=a),f<a&&(f=a))}else for(;++n<r;)if((a=i(e[n],n,e))!=null&&a>=a)for(s=f=a;++n<r;)(a=i(e[n],n,e))!=null&&(s>a&&(s=a),f<a&&(f=a));return[s,f]}var a_=Array.prototype,nI=a_.slice,iI=a_.map,H0=Math.sqrt(50),W0=Math.sqrt(10),X0=Math.sqrt(2);function o_(e,i,r){var n,a=-1,s,f,v;if(i=+i,e=+e,r=+r,e===i&&r>0)return[e];if((n=i<e)&&(s=e,e=i,i=s),(v=Kv(e,i,r))===0||!isFinite(v))return[];if(v>0)for(e=Math.ceil(e/v),i=Math.floor(i/v),f=new Array(s=Math.ceil(i-e+1));++a<s;)f[a]=(e+a)*v;else for(e=Math.floor(e*v),i=Math.ceil(i*v),f=new Array(s=Math.ceil(e-i+1));++a<s;)f[a]=(e-a)/v;return n&&f.reverse(),f}function Kv(e,i,r){var n=(i-e)/Math.max(0,r),a=Math.floor(Math.log(n)/Math.LN10),s=n/Math.pow(10,a);return a>=0?(s>=H0?10:s>=W0?5:s>=X0?2:1)*Math.pow(10,a):-Math.pow(10,-a)/(s>=H0?10:s>=W0?5:s>=X0?2:1)}function Y0(e,i,r){var n=Math.abs(i-e)/Math.max(0,r),a=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),s=n/a;return s>=H0?a*=10:s>=W0?a*=5:s>=X0&&(a*=2),i<e?-a:a}function aI(){var e=identity,i=extent,r=sturges;function n(a){var s,f=a.length,v,m=new Array(f);for(s=0;s<f;++s)m[s]=e(a[s],s,a);var x=i(m),A=x[0],T=x[1],O=r(m,A,T);Array.isArray(O)||(O=tickStep(A,T,O),O=range(Math.ceil(A/O)*O,T,O));for(var F=O.length;O[0]<=A;)O.shift(),--F;for(;O[F-1]>T;)O.pop(),--F;var j=new Array(F+1),Y;for(s=0;s<=F;++s)Y=j[s]=[],Y.x0=s>0?O[s-1]:A,Y.x1=s<F?O[s]:T;for(s=0;s<f;++s)v=m[s],A<=v&&v<=T&&j[bisect(O,v,0,F)].push(a[s]);return j}return n.value=function(a){return arguments.length?(e=typeof a=="function"?a:constant(a),n):e},n.domain=function(a){return arguments.length?(i=typeof a=="function"?a:constant([a[0],a[1]]),n):i},n.thresholds=function(a){return arguments.length?(r=typeof a=="function"?a:Array.isArray(a)?constant(slice.call(a)):constant(a),n):r},n}function oI(e,i,r){return e=map.call(e,number).sort(ascending),Math.ceil((r-i)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function Xw(e){return e===null?NaN:+e}function Yw(e,i,r){if(r==null&&(r=Xw),!!(n=e.length)){if((i=+i)<=0||n<2)return+r(e[0],0,e);if(i>=1)return+r(e[n-1],n-1,e);var n,a=(n-1)*i,s=Math.floor(a),f=+r(e[s],s,e),v=+r(e[s+1],s+1,e);return f+(v-f)*(a-s)}}var Dc="$";function $v(){}$v.prototype=s_.prototype={constructor:$v,has:function(e){return Dc+e in this},get:function(e){return this[Dc+e]},set:function(e,i){return this[Dc+e]=i,this},remove:function(e){var i=Dc+e;return i in this&&delete this[i]},clear:function(){for(var e in this)e[0]===Dc&&delete this[e]},keys:function(){var e=[];for(var i in this)i[0]===Dc&&e.push(i.slice(1));return e},values:function(){var e=[];for(var i in this)i[0]===Dc&&e.push(this[i]);return e},entries:function(){var e=[];for(var i in this)i[0]===Dc&&e.push({key:i.slice(1),value:this[i]});return e},size:function(){var e=0;for(var i in this)i[0]===Dc&&++e;return e},empty:function(){for(var e in this)if(e[0]===Dc)return!1;return!0},each:function(e){for(var i in this)i[0]===Dc&&e(this[i],i.slice(1),this)}};function s_(e,i){var r=new $v;if(e instanceof $v)e.each(function(v,m){r.set(m,v)});else if(Array.isArray(e)){var n=-1,a=e.length,s;if(i==null)for(;++n<a;)r.set(n,e[n]);else for(;++n<a;)r.set(i(s=e[n],n,e),s)}else if(e)for(var f in e)r.set(f,e[f]);return r}var q0=s_;function sI(){var e=[],i=[],r,n,a;function s(v,m,x,A){if(m>=e.length)return r!=null&&v.sort(r),n!=null?n(v):v;for(var T=-1,O=v.length,F=e[m++],j,Y,ee=map(),Ae,Fe=x();++T<O;)(Ae=ee.get(j=F(Y=v[T])+""))?Ae.push(Y):ee.set(j,[Y]);return ee.each(function(Xe,nt){A(Fe,nt,s(Xe,m,x,A))}),Fe}function f(v,m){if(++m>e.length)return v;var x,A=i[m-1];return n!=null&&m>=e.length?x=v.entries():(x=[],v.each(function(T,O){x.push({key:O,values:f(T,m)})})),A!=null?x.sort(function(T,O){return A(T.key,O.key)}):x}return a={object:function(v){return s(v,0,qw,Kw)},map:function(v){return s(v,0,u_,l_)},entries:function(v){return f(s(v,0,u_,l_),0)},key:function(v){return e.push(v),a},sortKeys:function(v){return i[e.length-1]=v,a},sortValues:function(v){return r=v,a},rollup:function(v){return n=v,a}}}function qw(){return{}}function Kw(e,i,r){e[i]=r}function u_(){return map()}function l_(e,i,r){e.set(i,r)}function Qv(){}var Vp=q0.prototype;Qv.prototype=$w.prototype={constructor:Qv,has:Vp.has,add:function(e){return e+="",this[Dc+e]=e,this},remove:Vp.remove,clear:Vp.clear,values:Vp.keys,size:Vp.size,empty:Vp.empty,each:Vp.each};function $w(e,i){var r=new Qv;if(e instanceof Qv)e.each(function(s){r.add(s)});else if(e){var n=-1,a=e.length;if(i==null)for(;++n<a;)r.add(e[n]);else for(;++n<a;)r.add(i(e[n],n,e))}return r}var uI=null,c_=Array.prototype,Jv=c_.map,Gp=c_.slice;function fp(e,i){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(i).domain(e);break}return this}function lI(e,i){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(i).domain(e);break}return this}var f_={name:"implicit"};function e0(){var e=q0(),i=[],r=[],n=f_;function a(s){var f=s+"",v=e.get(f);if(!v){if(n!==f_)return n;e.set(f,v=i.push(s))}return r[(v-1)%r.length]}return a.domain=function(s){if(!arguments.length)return i.slice();i=[],e=q0();for(var f=-1,v=s.length,m,x;++f<v;)e.has(x=(m=s[f])+"")||e.set(x,i.push(m));return a},a.range=function(s){return arguments.length?(r=Gp.call(s),a):r.slice()},a.unknown=function(s){return arguments.length?(n=s,a):n},a.copy=function(){return e0(i,r).unknown(n)},fp.apply(a,arguments),a}function h_(){var e=ordinal().unknown(void 0),i=e.domain,r=e.range,n=[0,1],a,s,f=!1,v=0,m=0,x=.5;delete e.unknown;function A(){var T=i().length,O=n[1]<n[0],F=n[O-0],j=n[1-O];a=(j-F)/Math.max(1,T-v+m*2),f&&(a=Math.floor(a)),F+=(j-F-a*(T-v))*x,s=a*(1-v),f&&(F=Math.round(F),s=Math.round(s));var Y=sequence(T).map(function(ee){return F+a*ee});return r(O?Y.reverse():Y)}return e.domain=function(T){return arguments.length?(i(T),A()):i()},e.range=function(T){return arguments.length?(n=[+T[0],+T[1]],A()):n.slice()},e.rangeRound=function(T){return n=[+T[0],+T[1]],f=!0,A()},e.bandwidth=function(){return s},e.step=function(){return a},e.round=function(T){return arguments.length?(f=!!T,A()):f},e.padding=function(T){return arguments.length?(v=Math.min(1,m=+T),A()):v},e.paddingInner=function(T){return arguments.length?(v=Math.min(1,T),A()):v},e.paddingOuter=function(T){return arguments.length?(m=+T,A()):m},e.align=function(T){return arguments.length?(x=Math.max(0,Math.min(1,T)),A()):x},e.copy=function(){return h_(i(),n).round(f).paddingInner(v).paddingOuter(m).align(x)},initRange.apply(A(),arguments)}function p_(e){var i=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return p_(i())},e}function cI(){return p_(h_.apply(null,arguments).paddingInner(1))}var Qw=W(26257),Jw=W(73626);function eT(e,i){return e=+e,i=+i,function(r){return Math.round(e*(1-r)+i*r)}}function tT(e){return function(){return e}}function K0(e){return+e}var d_=[0,1];function Fc(e){return e}function $0(e,i){return(i-=e=+e)?function(r){return(r-e)/i}:tT(isNaN(i)?NaN:.5)}function v_(e){var i=e[0],r=e[e.length-1],n;return i>r&&(n=i,i=r,r=n),function(a){return Math.max(i,Math.min(r,a))}}function rT(e,i,r){var n=e[0],a=e[1],s=i[0],f=i[1];return a<n?(n=$0(a,n),s=r(f,s)):(n=$0(n,a),s=r(s,f)),function(v){return s(n(v))}}function nT(e,i,r){var n=Math.min(e.length,i.length)-1,a=new Array(n),s=new Array(n),f=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),i=i.slice().reverse());++f<n;)a[f]=$0(e[f],e[f+1]),s[f]=r(i[f],i[f+1]);return function(v){var m=qv(e,v,1,n)-1;return s[m](a[m](v))}}function t0(e,i){return i.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Q0(){var e=d_,i=d_,r=Qw.Z,n,a,s,f=Fc,v,m,x;function A(){return v=Math.min(e.length,i.length)>2?nT:rT,m=x=null,T}function T(O){return isNaN(O=+O)?s:(m||(m=v(e.map(n),i,r)))(n(f(O)))}return T.invert=function(O){return f(a((x||(x=v(i,e.map(n),Jw.Z)))(O)))},T.domain=function(O){return arguments.length?(e=Jv.call(O,K0),f===Fc||(f=v_(e)),A()):e.slice()},T.range=function(O){return arguments.length?(i=Gp.call(O),A()):i.slice()},T.rangeRound=function(O){return i=Gp.call(O),r=eT,A()},T.clamp=function(O){return arguments.length?(f=O?v_(e):Fc,T):f!==Fc},T.interpolate=function(O){return arguments.length?(r=O,A()):r},T.unknown=function(O){return arguments.length?(s=O,T):s},function(O,F){return n=O,a=F,A()}}function m_(e,i){return Q0()(e,i)}var iT=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function r0(e){if(!(i=iT.exec(e)))throw new Error("invalid format: "+e);var i;return new J0({fill:i[1],align:i[2],sign:i[3],symbol:i[4],zero:i[5],width:i[6],comma:i[7],precision:i[8]&&i[8].slice(1),trim:i[9],type:i[10]})}r0.prototype=J0.prototype;function J0(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}J0.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function aT(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function n0(e,i){if((r=(e=i?e.toExponential(i-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function Ed(e){return e=n0(Math.abs(e)),e?e[1]:NaN}function oT(e,i){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Ed(i)/3)))*3-Ed(Math.abs(e)))}function sT(e,i){return function(r,n){for(var a=r.length,s=[],f=0,v=e[0],m=0;a>0&&v>0&&(m+v+1>n&&(v=Math.max(1,n-m)),s.push(r.substring(a-=v,a+v)),!((m+=v+1)>n));)v=e[f=(f+1)%e.length];return s.reverse().join(i)}}function uT(e){return function(i){return i.replace(/[0-9]/g,function(r){return e[+r]})}}function lT(e){e:for(var i=e.length,r=1,n=-1,a;r<i;++r)switch(e[r]){case".":n=a=r;break;case"0":n===0&&(n=r),a=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(a+1):e}var g_;function cT(e,i){var r=n0(e,i);if(!r)return e+"";var n=r[0],a=r[1],s=a-(g_=Math.max(-8,Math.min(8,Math.floor(a/3)))*3)+1,f=n.length;return s===f?n:s>f?n+new Array(s-f+1).join("0"):s>0?n.slice(0,s)+"."+n.slice(s):"0."+new Array(1-s).join("0")+n0(e,Math.max(0,i+s-1))[0]}function y_(e,i){var r=n0(e,i);if(!r)return e+"";var n=r[0],a=r[1];return a<0?"0."+new Array(-a).join("0")+n:n.length>a+1?n.slice(0,a+1)+"."+n.slice(a+1):n+new Array(a-n.length+2).join("0")}var __={"%":function(e,i){return(e*100).toFixed(i)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:aT,e:function(e,i){return e.toExponential(i)},f:function(e,i){return e.toFixed(i)},g:function(e,i){return e.toPrecision(i)},o:function(e){return Math.round(e).toString(8)},p:function(e,i){return y_(e*100,i)},r:y_,s:cT,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function x_(e){return e}var b_=Array.prototype.map,E_=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function fT(e){var i=e.grouping===void 0||e.thousands===void 0?x_:sT(b_.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",a=e.decimal===void 0?".":e.decimal+"",s=e.numerals===void 0?x_:uT(b_.call(e.numerals,String)),f=e.percent===void 0?"%":e.percent+"",v=e.minus===void 0?"-":e.minus+"",m=e.nan===void 0?"NaN":e.nan+"";function x(T){T=r0(T);var O=T.fill,F=T.align,j=T.sign,Y=T.symbol,ee=T.zero,Ae=T.width,Fe=T.comma,Xe=T.precision,nt=T.trim,Et=T.type;Et==="n"?(Fe=!0,Et="g"):__[Et]||(Xe===void 0&&(Xe=12),nt=!0,Et="g"),(ee||O==="0"&&F==="=")&&(ee=!0,O="0",F="=");var wt=Y==="$"?r:Y==="#"&&/[boxX]/.test(Et)?"0"+Et.toLowerCase():"",Wt=Y==="$"?n:/[%p]/.test(Et)?f:"",ur=__[Et],Ar=/[defgprs%]/.test(Et);Xe=Xe===void 0?6:/[gprs]/.test(Et)?Math.max(1,Math.min(21,Xe)):Math.max(0,Math.min(20,Xe));function Jr(gr){var vn=wt,Pn=Wt,Kn,Ba,qo;if(Et==="c")Pn=ur(gr)+Pn,gr="";else{gr=+gr;var Ls=gr<0||1/gr<0;if(gr=isNaN(gr)?m:ur(Math.abs(gr),Xe),nt&&(gr=lT(gr)),Ls&&+gr==0&&j!=="+"&&(Ls=!1),vn=(Ls?j==="("?j:v:j==="-"||j==="("?"":j)+vn,Pn=(Et==="s"?E_[8+g_/3]:"")+Pn+(Ls&&j==="("?")":""),Ar){for(Kn=-1,Ba=gr.length;++Kn<Ba;)if(qo=gr.charCodeAt(Kn),48>qo||qo>57){Pn=(qo===46?a+gr.slice(Kn+1):gr.slice(Kn))+Pn,gr=gr.slice(0,Kn);break}}}Fe&&!ee&&(gr=i(gr,Infinity));var Ds=vn.length+gr.length+Pn.length,Ys=Ds<Ae?new Array(Ae-Ds+1).join(O):"";switch(Fe&&ee&&(gr=i(Ys+gr,Ys.length?Ae-Pn.length:Infinity),Ys=""),F){case"<":gr=vn+gr+Pn+Ys;break;case"=":gr=vn+Ys+gr+Pn;break;case"^":gr=Ys.slice(0,Ds=Ys.length>>1)+vn+gr+Pn+Ys.slice(Ds);break;default:gr=Ys+vn+gr+Pn;break}return s(gr)}return Jr.toString=function(){return T+""},Jr}function A(T,O){var F=x((T=r0(T),T.type="f",T)),j=Math.max(-8,Math.min(8,Math.floor(Ed(O)/3)))*3,Y=Math.pow(10,-j),ee=E_[8+j/3];return function(Ae){return F(Y*Ae)+ee}}return{format:x,formatPrefix:A}}var i0,em,S_;hT({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function hT(e){return i0=fT(e),em=i0.format,S_=i0.formatPrefix,i0}function pT(e,i){return e=Math.abs(e),i=Math.abs(i)-e,Math.max(0,Ed(i)-Ed(e))+1}function dT(e){return Math.max(0,-Ed(Math.abs(e)))}function vT(e,i,r,n){var a=Y0(e,i,r),s;switch(n=r0(n==null?",f":n),n.type){case"s":{var f=Math.max(Math.abs(e),Math.abs(i));return n.precision==null&&!isNaN(s=oT(a,f))&&(n.precision=s),S_(n,f)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(s=pT(a,Math.max(Math.abs(e),Math.abs(i))))&&(n.precision=s-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(s=dT(a))&&(n.precision=s-(n.type==="%")*2);break}}return em(n)}function a0(e){var i=e.domain;return e.ticks=function(r){var n=i();return o_(n[0],n[n.length-1],r==null?10:r)},e.tickFormat=function(r,n){var a=i();return vT(a[0],a[a.length-1],r==null?10:r,n)},e.nice=function(r){r==null&&(r=10);var n=i(),a=0,s=n.length-1,f=n[a],v=n[s],m;return v<f&&(m=f,f=v,v=m,m=a,a=s,s=m),m=Kv(f,v,r),m>0?(f=Math.floor(f/m)*m,v=Math.ceil(v/m)*m,m=Kv(f,v,r)):m<0&&(f=Math.ceil(f*m)/m,v=Math.floor(v*m)/m,m=Kv(f,v,r)),m>0?(n[a]=Math.floor(f/m)*m,n[s]=Math.ceil(v/m)*m,i(n)):m<0&&(n[a]=Math.ceil(f*m)/m,n[s]=Math.floor(v*m)/m,i(n)),e},e}function C_(){var e=m_(Fc,Fc);return e.copy=function(){return t0(e,C_())},fp.apply(e,arguments),a0(e)}function A_(e){var i;function r(n){return isNaN(n=+n)?i:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=Jv.call(n,K0),r):e.slice()},r.unknown=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return A_(e).unknown(i)},e=arguments.length?Jv.call(e,K0):[0,1],a0(r)}function w_(e,i){e=e.slice();var r=0,n=e.length-1,a=e[r],s=e[n],f;return s<a&&(f=r,r=n,n=f,f=a,a=s,s=f),e[r]=i.floor(a),e[n]=i.ceil(s),e}function T_(e){return Math.log(e)}function M_(e){return Math.exp(e)}function mT(e){return-Math.log(-e)}function gT(e){return-Math.exp(-e)}function yT(e){return isFinite(e)?+("1e"+e):e<0?0:e}function _T(e){return e===10?yT:e===Math.E?Math.exp:function(i){return Math.pow(e,i)}}function xT(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(i){return Math.log(i)/e})}function P_(e){return function(i){return-e(-i)}}function bT(e){var i=e(T_,M_),r=i.domain,n=10,a,s;function f(){return a=xT(n),s=_T(n),r()[0]<0?(a=P_(a),s=P_(s),e(mT,gT)):e(T_,M_),i}return i.base=function(v){return arguments.length?(n=+v,f()):n},i.domain=function(v){return arguments.length?(r(v),f()):r()},i.ticks=function(v){var m=r(),x=m[0],A=m[m.length-1],T;(T=A<x)&&(O=x,x=A,A=O);var O=a(x),F=a(A),j,Y,ee,Ae=v==null?10:+v,Fe=[];if(!(n%1)&&F-O<Ae){if(O=Math.round(O)-1,F=Math.round(F)+1,x>0){for(;O<F;++O)for(Y=1,j=s(O);Y<n;++Y)if(ee=j*Y,!(ee<x)){if(ee>A)break;Fe.push(ee)}}else for(;O<F;++O)for(Y=n-1,j=s(O);Y>=1;--Y)if(ee=j*Y,!(ee<x)){if(ee>A)break;Fe.push(ee)}}else Fe=o_(O,F,Math.min(F-O,Ae)).map(s);return T?Fe.reverse():Fe},i.tickFormat=function(v,m){if(m==null&&(m=n===10?".0e":","),typeof m!="function"&&(m=em(m)),v===Infinity)return m;v==null&&(v=10);var x=Math.max(1,n*v/i.ticks().length);return function(A){var T=A/s(Math.round(a(A)));return T*n<n-.5&&(T*=n),T<=x?m(A):""}},i.nice=function(){return r(w_(r(),{floor:function(v){return s(Math.floor(a(v)))},ceil:function(v){return s(Math.ceil(a(v)))}}))},i}function I_(){var e=bT(Q0()).domain([1,10]);return e.copy=function(){return t0(e,I_()).base(e.base())},fp.apply(e,arguments),e}function O_(e){return function(i){return Math.sign(i)*Math.log1p(Math.abs(i/e))}}function R_(e){return function(i){return Math.sign(i)*Math.expm1(Math.abs(i))*e}}function ET(e){var i=1,r=e(O_(i),R_(i));return r.constant=function(n){return arguments.length?e(O_(i=+n),R_(i)):i},linearish(r)}function ST(){var e=ET(transformer());return e.copy=function(){return copy(e,ST()).constant(e.constant())},initRange.apply(e,arguments)}function k_(e){return function(i){return i<0?-Math.pow(-i,e):Math.pow(i,e)}}function CT(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function AT(e){return e<0?-e*e:e*e}function wT(e){var i=e(Fc,Fc),r=1;function n(){return r===1?e(Fc,Fc):r===.5?e(CT,AT):e(k_(r),k_(1/r))}return i.exponent=function(a){return arguments.length?(r=+a,n()):r},a0(i)}function tm(){var e=wT(Q0());return e.copy=function(){return t0(e,tm()).exponent(e.exponent())},fp.apply(e,arguments),e}function fI(){return tm.apply(null,arguments).exponent(.5)}function L_(){var e=[],i=[],r=[],n;function a(){var f=0,v=Math.max(1,i.length);for(r=new Array(v-1);++f<v;)r[f-1]=Yw(e,f/v);return s}function s(f){return isNaN(f=+f)?n:i[qv(r,f)]}return s.invertExtent=function(f){var v=i.indexOf(f);return v<0?[NaN,NaN]:[v>0?r[v-1]:e[0],v<r.length?r[v]:e[e.length-1]]},s.domain=function(f){if(!arguments.length)return e.slice();e=[];for(var v=0,m=f.length,x;v<m;++v)x=f[v],x!=null&&!isNaN(x=+x)&&e.push(x);return e.sort(G0),a()},s.range=function(f){return arguments.length?(i=Gp.call(f),a()):i.slice()},s.unknown=function(f){return arguments.length?(n=f,s):n},s.quantiles=function(){return r.slice()},s.copy=function(){return L_().domain(e).range(i).unknown(n)},fp.apply(s,arguments)}function D_(){var e=0,i=1,r=1,n=[.5],a=[0,1],s;function f(m){return m<=m?a[qv(n,m,0,r)]:s}function v(){var m=-1;for(n=new Array(r);++m<r;)n[m]=((m+1)*i-(m-r)*e)/(r+1);return f}return f.domain=function(m){return arguments.length?(e=+m[0],i=+m[1],v()):[e,i]},f.range=function(m){return arguments.length?(r=(a=Gp.call(m)).length-1,v()):a.slice()},f.invertExtent=function(m){var x=a.indexOf(m);return x<0?[NaN,NaN]:x<1?[e,n[0]]:x>=r?[n[r-1],i]:[n[x-1],n[x]]},f.unknown=function(m){return arguments.length&&(s=m),f},f.thresholds=function(){return n.slice()},f.copy=function(){return D_().domain([e,i]).range(a).unknown(s)},fp.apply(a0(f),arguments)}function F_(){var e=[.5],i=[0,1],r,n=1;function a(s){return s<=s?i[qv(e,s,0,n)]:r}return a.domain=function(s){return arguments.length?(e=Gp.call(s),n=Math.min(e.length,i.length-1),a):e.slice()},a.range=function(s){return arguments.length?(i=Gp.call(s),n=Math.min(e.length,i.length-1),a):i.slice()},a.invertExtent=function(s){var f=i.indexOf(s);return[e[f-1],e[f]]},a.unknown=function(s){return arguments.length?(r=s,a):r},a.copy=function(){return F_().domain(e).range(i).unknown(r)},fp.apply(a,arguments)}var rm=new Date,nm=new Date;function sl(e,i,r,n){function a(s){return e(s=arguments.length===0?new Date:new Date(+s)),s}return a.floor=function(s){return e(s=new Date(+s)),s},a.ceil=function(s){return e(s=new Date(s-1)),i(s,1),e(s),s},a.round=function(s){var f=a(s),v=a.ceil(s);return s-f<v-s?f:v},a.offset=function(s,f){return i(s=new Date(+s),f==null?1:Math.floor(f)),s},a.range=function(s,f,v){var m=[],x;if(s=a.ceil(s),v=v==null?1:Math.floor(v),!(s<f)||!(v>0))return m;do m.push(x=new Date(+s)),i(s,v),e(s);while(x<s&&s<f);return m},a.filter=function(s){return sl(function(f){if(f>=f)for(;e(f),!s(f);)f.setTime(f-1)},function(f,v){if(f>=f)if(v<0)for(;++v<=0;)for(;i(f,-1),!s(f););else for(;--v>=0;)for(;i(f,1),!s(f););})},r&&(a.count=function(s,f){return rm.setTime(+s),nm.setTime(+f),e(rm),e(nm),Math.floor(r(rm,nm))},a.every=function(s){return s=Math.floor(s),!isFinite(s)||!(s>0)?null:s>1?a.filter(n?function(f){return n(f)%s==0}:function(f){return a.count(0,f)%s==0}):a}),a}var im=sl(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,i){e.setFullYear(e.getFullYear()+i)},function(e,i){return i.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});im.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:sl(function(i){i.setFullYear(Math.floor(i.getFullYear()/e)*e),i.setMonth(0,1),i.setHours(0,0,0,0)},function(i,r){i.setFullYear(i.getFullYear()+r*e)})};var Sd=im,hI=im.range,B_=sl(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,i){e.setMonth(e.getMonth()+i)},function(e,i){return i.getMonth()-e.getMonth()+(i.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),TT=B_,pI=B_.range,o0=1e3,sv=6e4,N_=36e5,z_=864e5,Z_=6048e5;function Hp(e){return sl(function(i){i.setDate(i.getDate()-(i.getDay()+7-e)%7),i.setHours(0,0,0,0)},function(i,r){i.setDate(i.getDate()+r*7)},function(i,r){return(r-i-(r.getTimezoneOffset()-i.getTimezoneOffset())*sv)/Z_})}var am=Hp(0),s0=Hp(1),MT=Hp(2),PT=Hp(3),Cd=Hp(4),IT=Hp(5),OT=Hp(6),dI=am.range,vI=s0.range,mI=MT.range,gI=PT.range,yI=Cd.range,_I=IT.range,xI=OT.range,U_=sl(function(e){e.setHours(0,0,0,0)},function(e,i){e.setDate(e.getDate()+i)},function(e,i){return(i-e-(i.getTimezoneOffset()-e.getTimezoneOffset())*sv)/z_},function(e){return e.getDate()-1}),om=U_,bI=U_.range,j_=sl(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*o0-e.getMinutes()*sv)},function(e,i){e.setTime(+e+i*N_)},function(e,i){return(i-e)/N_},function(e){return e.getHours()}),RT=j_,EI=j_.range,V_=sl(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*o0)},function(e,i){e.setTime(+e+i*sv)},function(e,i){return(i-e)/sv},function(e){return e.getMinutes()}),kT=V_,SI=V_.range,G_=sl(function(e){e.setTime(e-e.getMilliseconds())},function(e,i){e.setTime(+e+i*o0)},function(e,i){return(i-e)/o0},function(e){return e.getUTCSeconds()}),LT=G_,CI=G_.range,u0=sl(function(){},function(e,i){e.setTime(+e+i)},function(e,i){return i-e});u0.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?sl(function(i){i.setTime(Math.floor(i/e)*e)},function(i,r){i.setTime(+i+r*e)},function(i,r){return(r-i)/e}):u0};var DT=u0,AI=u0.range;function Wp(e){return sl(function(i){i.setUTCDate(i.getUTCDate()-(i.getUTCDay()+7-e)%7),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCDate(i.getUTCDate()+r*7)},function(i,r){return(r-i)/Z_})}var H_=Wp(0),l0=Wp(1),FT=Wp(2),BT=Wp(3),Ad=Wp(4),NT=Wp(5),zT=Wp(6),wI=H_.range,TI=l0.range,MI=FT.range,PI=BT.range,II=Ad.range,OI=NT.range,RI=zT.range,W_=sl(function(e){e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCDate(e.getUTCDate()+i)},function(e,i){return(i-e)/z_},function(e){return e.getUTCDate()-1}),X_=W_,kI=W_.range,sm=sl(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCFullYear(e.getUTCFullYear()+i)},function(e,i){return i.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});sm.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:sl(function(i){i.setUTCFullYear(Math.floor(i.getUTCFullYear()/e)*e),i.setUTCMonth(0,1),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCFullYear(i.getUTCFullYear()+r*e)})};var uv=sm,LI=sm.range;function um(e){if(0<=e.y&&e.y<100){var i=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return i.setFullYear(e.y),i}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function lm(e){if(0<=e.y&&e.y<100){var i=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return i.setUTCFullYear(e.y),i}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function lv(e,i,r){return{y:e,m:i,d:r,H:0,M:0,S:0,L:0}}function ZT(e){var i=e.dateTime,r=e.date,n=e.time,a=e.periods,s=e.days,f=e.shortDays,v=e.months,m=e.shortMonths,x=cv(a),A=fv(a),T=cv(s),O=fv(s),F=cv(f),j=fv(f),Y=cv(v),ee=fv(v),Ae=cv(m),Fe=fv(m),Xe={a:Ls,A:Ds,b:Ys,B:vf,c:null,d:J_,e:J_,f:lM,g:_M,G:bM,H:oM,I:sM,j:uM,L:e1,m:cM,M:fM,p:E0,q:aP,Q:o1,s:s1,S:hM,u:pM,U:dM,V:vM,w:mM,W:gM,x:null,X:null,y:yM,Y:xM,Z:EM,"%":a1},nt={a:oP,A:sP,b:uP,B:lP,c:null,d:r1,e:r1,f:wM,g:FM,G:NM,H:SM,I:CM,j:AM,L:n1,m:TM,M:MM,p:cP,q:fP,Q:o1,s:s1,S:PM,u:IM,U:OM,V:RM,w:kM,W:LM,x:null,X:null,y:DM,Y:BM,Z:zM,"%":a1},Et={a:Jr,A:gr,b:vn,B:Pn,c:Kn,d:$_,e:$_,f:rM,g:K_,G:q_,H:Q_,I:Q_,j:QT,L:tM,m:$T,M:JT,p:Ar,q:KT,Q:iM,s:aM,S:eM,u:HT,U:WT,V:XT,w:GT,W:YT,x:Ba,X:qo,y:K_,Y:q_,Z:qT,"%":nM};Xe.x=wt(r,Xe),Xe.X=wt(n,Xe),Xe.c=wt(i,Xe),nt.x=wt(r,nt),nt.X=wt(n,nt),nt.c=wt(i,nt);function wt(ui,Oa){return function(no){var _n=[],Pl=-1,Zo=0,nc=ui.length,ic,Yp,Yx;for(no instanceof Date||(no=new Date(+no));++Pl<nc;)ui.charCodeAt(Pl)===37&&(_n.push(ui.slice(Zo,Pl)),(Yp=Y_[ic=ui.charAt(++Pl)])!=null?ic=ui.charAt(++Pl):Yp=ic==="e"?" ":"0",(Yx=Oa[ic])&&(ic=Yx(no,Yp)),_n.push(ic),Zo=Pl+1);return _n.push(ui.slice(Zo,Pl)),_n.join("")}}function Wt(ui,Oa){return function(no){var _n=lv(1900,void 0,1),Pl=ur(_n,ui,no+="",0),Zo,nc;if(Pl!=no.length)return null;if("Q"in _n)return new Date(_n.Q);if("s"in _n)return new Date(_n.s*1e3+("L"in _n?_n.L:0));if(Oa&&!("Z"in _n)&&(_n.Z=0),"p"in _n&&(_n.H=_n.H%12+_n.p*12),_n.m===void 0&&(_n.m="q"in _n?_n.q:0),"V"in _n){if(_n.V<1||_n.V>53)return null;"w"in _n||(_n.w=1),"Z"in _n?(Zo=lm(lv(_n.y,0,1)),nc=Zo.getUTCDay(),Zo=nc>4||nc===0?l0.ceil(Zo):l0(Zo),Zo=X_.offset(Zo,(_n.V-1)*7),_n.y=Zo.getUTCFullYear(),_n.m=Zo.getUTCMonth(),_n.d=Zo.getUTCDate()+(_n.w+6)%7):(Zo=um(lv(_n.y,0,1)),nc=Zo.getDay(),Zo=nc>4||nc===0?s0.ceil(Zo):s0(Zo),Zo=om.offset(Zo,(_n.V-1)*7),_n.y=Zo.getFullYear(),_n.m=Zo.getMonth(),_n.d=Zo.getDate()+(_n.w+6)%7)}else("W"in _n||"U"in _n)&&("w"in _n||(_n.w="u"in _n?_n.u%7:"W"in _n?1:0),nc="Z"in _n?lm(lv(_n.y,0,1)).getUTCDay():um(lv(_n.y,0,1)).getDay(),_n.m=0,_n.d="W"in _n?(_n.w+6)%7+_n.W*7-(nc+5)%7:_n.w+_n.U*7-(nc+6)%7);return"Z"in _n?(_n.H+=_n.Z/100|0,_n.M+=_n.Z%100,lm(_n)):um(_n)}}function ur(ui,Oa,no,_n){for(var Pl=0,Zo=Oa.length,nc=no.length,ic,Yp;Pl<Zo;){if(_n>=nc)return-1;if(ic=Oa.charCodeAt(Pl++),ic===37){if(ic=Oa.charAt(Pl++),Yp=Et[ic in Y_?Oa.charAt(Pl++):ic],!Yp||(_n=Yp(ui,no,_n))<0)return-1}else if(ic!=no.charCodeAt(_n++))return-1}return _n}function Ar(ui,Oa,no){var _n=x.exec(Oa.slice(no));return _n?(ui.p=A[_n[0].toLowerCase()],no+_n[0].length):-1}function Jr(ui,Oa,no){var _n=F.exec(Oa.slice(no));return _n?(ui.w=j[_n[0].toLowerCase()],no+_n[0].length):-1}function gr(ui,Oa,no){var _n=T.exec(Oa.slice(no));return _n?(ui.w=O[_n[0].toLowerCase()],no+_n[0].length):-1}function vn(ui,Oa,no){var _n=Ae.exec(Oa.slice(no));return _n?(ui.m=Fe[_n[0].toLowerCase()],no+_n[0].length):-1}function Pn(ui,Oa,no){var _n=Y.exec(Oa.slice(no));return _n?(ui.m=ee[_n[0].toLowerCase()],no+_n[0].length):-1}function Kn(ui,Oa,no){return ur(ui,i,Oa,no)}function Ba(ui,Oa,no){return ur(ui,r,Oa,no)}function qo(ui,Oa,no){return ur(ui,n,Oa,no)}function Ls(ui){return f[ui.getDay()]}function Ds(ui){return s[ui.getDay()]}function Ys(ui){return m[ui.getMonth()]}function vf(ui){return v[ui.getMonth()]}function E0(ui){return a[+(ui.getHours()>=12)]}function aP(ui){return 1+~~(ui.getMonth()/3)}function oP(ui){return f[ui.getUTCDay()]}function sP(ui){return s[ui.getUTCDay()]}function uP(ui){return m[ui.getUTCMonth()]}function lP(ui){return v[ui.getUTCMonth()]}function cP(ui){return a[+(ui.getUTCHours()>=12)]}function fP(ui){return 1+~~(ui.getUTCMonth()/3)}return{format:function(ui){var Oa=wt(ui+="",Xe);return Oa.toString=function(){return ui},Oa},parse:function(ui){var Oa=Wt(ui+="",!1);return Oa.toString=function(){return ui},Oa},utcFormat:function(ui){var Oa=wt(ui+="",nt);return Oa.toString=function(){return ui},Oa},utcParse:function(ui){var Oa=Wt(ui+="",!0);return Oa.toString=function(){return ui},Oa}}}var Y_={"-":"",_:" ","0":"0"},xu=/^\s*\d+/,UT=/^%/,jT=/[\\^$*+?|[\]().{}]/g;function ro(e,i,r){var n=e<0?"-":"",a=(n?-e:e)+"",s=a.length;return n+(s<r?new Array(r-s+1).join(i)+a:a)}function VT(e){return e.replace(jT,"\\$&")}function cv(e){return new RegExp("^(?:"+e.map(VT).join("|")+")","i")}function fv(e){for(var i={},r=-1,n=e.length;++r<n;)i[e[r].toLowerCase()]=r;return i}function GT(e,i,r){var n=xu.exec(i.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function HT(e,i,r){var n=xu.exec(i.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function WT(e,i,r){var n=xu.exec(i.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function XT(e,i,r){var n=xu.exec(i.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function YT(e,i,r){var n=xu.exec(i.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function q_(e,i,r){var n=xu.exec(i.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function K_(e,i,r){var n=xu.exec(i.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function qT(e,i,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(i.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function KT(e,i,r){var n=xu.exec(i.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function $T(e,i,r){var n=xu.exec(i.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function $_(e,i,r){var n=xu.exec(i.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function QT(e,i,r){var n=xu.exec(i.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function Q_(e,i,r){var n=xu.exec(i.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function JT(e,i,r){var n=xu.exec(i.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function eM(e,i,r){var n=xu.exec(i.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function tM(e,i,r){var n=xu.exec(i.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function rM(e,i,r){var n=xu.exec(i.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function nM(e,i,r){var n=UT.exec(i.slice(r,r+1));return n?r+n[0].length:-1}function iM(e,i,r){var n=xu.exec(i.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function aM(e,i,r){var n=xu.exec(i.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function J_(e,i){return ro(e.getDate(),i,2)}function oM(e,i){return ro(e.getHours(),i,2)}function sM(e,i){return ro(e.getHours()%12||12,i,2)}function uM(e,i){return ro(1+om.count(Sd(e),e),i,3)}function e1(e,i){return ro(e.getMilliseconds(),i,3)}function lM(e,i){return e1(e,i)+"000"}function cM(e,i){return ro(e.getMonth()+1,i,2)}function fM(e,i){return ro(e.getMinutes(),i,2)}function hM(e,i){return ro(e.getSeconds(),i,2)}function pM(e){var i=e.getDay();return i===0?7:i}function dM(e,i){return ro(am.count(Sd(e)-1,e),i,2)}function t1(e){var i=e.getDay();return i>=4||i===0?Cd(e):Cd.ceil(e)}function vM(e,i){return e=t1(e),ro(Cd.count(Sd(e),e)+(Sd(e).getDay()===4),i,2)}function mM(e){return e.getDay()}function gM(e,i){return ro(s0.count(Sd(e)-1,e),i,2)}function yM(e,i){return ro(e.getFullYear()%100,i,2)}function _M(e,i){return e=t1(e),ro(e.getFullYear()%100,i,2)}function xM(e,i){return ro(e.getFullYear()%1e4,i,4)}function bM(e,i){var r=e.getDay();return e=r>=4||r===0?Cd(e):Cd.ceil(e),ro(e.getFullYear()%1e4,i,4)}function EM(e){var i=e.getTimezoneOffset();return(i>0?"-":(i*=-1,"+"))+ro(i/60|0,"0",2)+ro(i%60,"0",2)}function r1(e,i){return ro(e.getUTCDate(),i,2)}function SM(e,i){return ro(e.getUTCHours(),i,2)}function CM(e,i){return ro(e.getUTCHours()%12||12,i,2)}function AM(e,i){return ro(1+X_.count(uv(e),e),i,3)}function n1(e,i){return ro(e.getUTCMilliseconds(),i,3)}function wM(e,i){return n1(e,i)+"000"}function TM(e,i){return ro(e.getUTCMonth()+1,i,2)}function MM(e,i){return ro(e.getUTCMinutes(),i,2)}function PM(e,i){return ro(e.getUTCSeconds(),i,2)}function IM(e){var i=e.getUTCDay();return i===0?7:i}function OM(e,i){return ro(H_.count(uv(e)-1,e),i,2)}function i1(e){var i=e.getUTCDay();return i>=4||i===0?Ad(e):Ad.ceil(e)}function RM(e,i){return e=i1(e),ro(Ad.count(uv(e),e)+(uv(e).getUTCDay()===4),i,2)}function kM(e){return e.getUTCDay()}function LM(e,i){return ro(l0.count(uv(e)-1,e),i,2)}function DM(e,i){return ro(e.getUTCFullYear()%100,i,2)}function FM(e,i){return e=i1(e),ro(e.getUTCFullYear()%100,i,2)}function BM(e,i){return ro(e.getUTCFullYear()%1e4,i,4)}function NM(e,i){var r=e.getUTCDay();return e=r>=4||r===0?Ad(e):Ad.ceil(e),ro(e.getUTCFullYear()%1e4,i,4)}function zM(){return"+0000"}function a1(){return"%"}function o1(e){return+e}function s1(e){return Math.floor(+e/1e3)}var wd,u1,ZM,UM,jM;VM({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function VM(e){return wd=ZT(e),u1=wd.format,ZM=wd.parse,UM=wd.utcFormat,jM=wd.utcParse,wd}var hv=1e3,pv=hv*60,dv=pv*60,vv=dv*24,GM=vv*7,l1=vv*30,cm=vv*365;function HM(e){return new Date(e)}function WM(e){return e instanceof Date?+e:+new Date(+e)}function c1(e,i,r,n,a,s,f,v,m){var x=m_(Fc,Fc),A=x.invert,T=x.domain,O=m(".%L"),F=m(":%S"),j=m("%I:%M"),Y=m("%I %p"),ee=m("%a %d"),Ae=m("%b %d"),Fe=m("%B"),Xe=m("%Y"),nt=[[f,1,hv],[f,5,5*hv],[f,15,15*hv],[f,30,30*hv],[s,1,pv],[s,5,5*pv],[s,15,15*pv],[s,30,30*pv],[a,1,dv],[a,3,3*dv],[a,6,6*dv],[a,12,12*dv],[n,1,vv],[n,2,2*vv],[r,1,GM],[i,1,l1],[i,3,3*l1],[e,1,cm]];function Et(Wt){return(f(Wt)<Wt?O:s(Wt)<Wt?F:a(Wt)<Wt?j:n(Wt)<Wt?Y:i(Wt)<Wt?r(Wt)<Wt?ee:Ae:e(Wt)<Wt?Fe:Xe)(Wt)}function wt(Wt,ur,Ar,Jr){if(Wt==null&&(Wt=10),typeof Wt=="number"){var gr=Math.abs(Ar-ur)/Wt,vn=n_(function(Pn){return Pn[2]}).right(nt,gr);vn===nt.length?(Jr=Y0(ur/cm,Ar/cm,Wt),Wt=e):vn?(vn=nt[gr/nt[vn-1][2]<nt[vn][2]/gr?vn-1:vn],Jr=vn[1],Wt=vn[0]):(Jr=Math.max(Y0(ur,Ar,Wt),1),Wt=v)}return Jr==null?Wt:Wt.every(Jr)}return x.invert=function(Wt){return new Date(A(Wt))},x.domain=function(Wt){return arguments.length?T(Jv.call(Wt,WM)):T().map(HM)},x.ticks=function(Wt,ur){var Ar=T(),Jr=Ar[0],gr=Ar[Ar.length-1],vn=gr<Jr,Pn;return vn&&(Pn=Jr,Jr=gr,gr=Pn),Pn=wt(Wt,Jr,gr,ur),Pn=Pn?Pn.range(Jr,gr+1):[],vn?Pn.reverse():Pn},x.tickFormat=function(Wt,ur){return ur==null?Et:m(ur)},x.nice=function(Wt,ur){var Ar=T();return(Wt=wt(Wt,Ar[0],Ar[Ar.length-1],ur))?T(w_(Ar,Wt)):x},x.copy=function(){return t0(x,c1(e,i,r,n,a,s,f,v,m))},x}function XM(){return fp.apply(c1(Sd,TT,am,om,RT,kT,LT,DT,u1).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function DI(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function c0(){var e=0,i=1,r,n,a,s,f=identity,v=!1,m;function x(A){return isNaN(A=+A)?m:f(a===0?.5:(A=(s(A)-r)*a,v?Math.max(0,Math.min(1,A)):A))}return x.domain=function(A){return arguments.length?(r=s(e=+A[0]),n=s(i=+A[1]),a=r===n?0:1/(n-r),x):[e,i]},x.clamp=function(A){return arguments.length?(v=!!A,x):v},x.interpolator=function(A){return arguments.length?(f=A,x):f},x.unknown=function(A){return arguments.length?(m=A,x):m},function(A){return s=A,r=A(e),n=A(i),a=r===n?0:1/(n-r),x}}function f0(e,i){return i.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function YM(){var e=linearish(c0()(identity));return e.copy=function(){return f0(e,YM())},initInterpolator.apply(e,arguments)}function qM(){var e=loggish(c0()).domain([1,10]);return e.copy=function(){return f0(e,qM()).base(e.base())},initInterpolator.apply(e,arguments)}function KM(){var e=symlogish(c0());return e.copy=function(){return f0(e,KM()).constant(e.constant())},initInterpolator.apply(e,arguments)}function f1(){var e=powish(c0());return e.copy=function(){return f0(e,f1()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function FI(){return f1.apply(null,arguments).exponent(.5)}function $M(){var e=[],i=identity;function r(n){if(!isNaN(n=+n))return i((bisect(e,n)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(var a=0,s=n.length,f;a<s;++a)f=n[a],f!=null&&!isNaN(f=+f)&&e.push(f);return e.sort(ascending),r},r.interpolator=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return $M(i).domain(e)},initInterpolator.apply(r,arguments)}function h0(){var e=0,i=.5,r=1,n,a,s,f,v,m=identity,x,A=!1,T;function O(F){return isNaN(F=+F)?T:(F=.5+((F=+x(F))-a)*(F<a?f:v),m(A?Math.max(0,Math.min(1,F)):F))}return O.domain=function(F){return arguments.length?(n=x(e=+F[0]),a=x(i=+F[1]),s=x(r=+F[2]),f=n===a?0:.5/(a-n),v=a===s?0:.5/(s-a),O):[e,i,r]},O.clamp=function(F){return arguments.length?(A=!!F,O):A},O.interpolator=function(F){return arguments.length?(m=F,O):m},O.unknown=function(F){return arguments.length?(T=F,O):T},function(F){return x=F,n=F(e),a=F(i),s=F(r),f=n===a?0:.5/(a-n),v=a===s?0:.5/(s-a),O}}function QM(){var e=linearish(h0()(identity));return e.copy=function(){return copy(e,QM())},initInterpolator.apply(e,arguments)}function JM(){var e=loggish(h0()).domain([.1,1,10]);return e.copy=function(){return copy(e,JM()).base(e.base())},initInterpolator.apply(e,arguments)}function e5(){var e=symlogish(h0());return e.copy=function(){return copy(e,e5()).constant(e.constant())},initInterpolator.apply(e,arguments)}function h1(){var e=powish(h0());return e.copy=function(){return copy(e,h1()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function BI(){return h1.apply(null,arguments).exponent(.5)}var pf,p1,d1,v1,fm,m1,t5=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,r5=(pf={},(0,S.Z)(pf,lu.LINEAR,C_),(0,S.Z)(pf,lu.POWER,tm),(0,S.Z)(pf,lu.LOG,I_),(0,S.Z)(pf,lu.IDENTITY,A_),(0,S.Z)(pf,lu.TIME,XM),(0,S.Z)(pf,lu.QUANTILE,L_),(0,S.Z)(pf,lu.QUANTIZE,D_),(0,S.Z)(pf,lu.THRESHOLD,F_),(0,S.Z)(pf,lu.CAT,e0),pf),n5=(p1=(0,Yr.b2)(),d1=(0,Yr.f3)(xt.IGlobalConfigService),p1(v1=(fm=function(){function e(){(0,dt.Z)(this,e),Nn(this,"configService",m1,this),(0,S.Z)(this,"scaleCache",{}),(0,S.Z)(this,"scaleOptions",{})}return(0,It.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("FeatureScalePlugin",function(){a.scaleOptions=r.getScaleOptions();var f=s.getLayerStyleAttributes(),v=r.getSource().data.dataArray;v.length!==0&&a.caculateScalesForAttributes(f||[],v)}),r.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){a.scaleOptions=r.getScaleOptions();var f=s.getLayerStyleAttributes(),v=r.getSource().data.dataArray;return a.caculateScalesForAttributes(f||[],v),r.layerModelNeedUpdate=!0,!0}),r.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!r.layerModelNeedUpdate){a.scaleOptions=r.getScaleOptions();var f=s.getLayerStyleAttributes();if(f){var v=r.getSource().data.dataArray;if(v.length===0)return;var m=f.filter(function(x){return x.needRescale});m.length&&a.caculateScalesForAttributes(m,v)}}})}},{key:"isNumber",value:function(r){return!isNaN(parseFloat(r))&&isFinite(r)}},{key:"caculateScalesForAttributes",value:function(r,n){var a=this;this.scaleCache={},r.forEach(function(s){if(s.scale){var f=s.scale,v=s.name;f.names=a.parseFields(s.scale.field||[]);var m=[];f.names.forEach(function(x){m.push(a.getOrCreateScale(x,s,n))}),m.some(function(x){return x.type===ip.VARIABLE})?(f.type=ip.VARIABLE,m.forEach(function(x){if(!f.callback){var A;if(f.values&&f.values!=="text"){var T;if(((T=x.option)===null||T===void 0?void 0:T.type)==="linear"&&f.values.length>2){var O=x.scale.ticks(f.values.length);v==="color"&&x.scale.domain(O)}x.scale.range(f.values)}else((A=x.option)===null||A===void 0?void 0:A.type)==="cat"&&x.scale.range(x.option.domain)}})):(f.type=ip.CONSTANT,f.defaultValues=m.map(function(x,A){return x.scale(f.names[A])})),f.scalers=m.map(function(x){return{field:x.field,func:x.scale,option:x.option}}),s.needRescale=!1}})}},{key:"getOrCreateScale",value:function(r,n,a){var s,f=[r,n.name].join("_"),v=(s=n.scale)===null||s===void 0?void 0:s.values,m=this.createScale(r,n.name,v,a);return m}},{key:"parseFields",value:function(r){return Array.isArray(r)?r:w()(r)?r.split("*"):[r]}},{key:"createScale",value:function(r,n,a,s){var f,v,m=this.scaleOptions[n]&&((f=this.scaleOptions[n])===null||f===void 0?void 0:f.field)===r?this.scaleOptions[n]:this.scaleOptions[r],x={field:r,scale:void 0,type:ip.VARIABLE,option:m};if(!s||!s.length)return m&&m.type?x.scale=this.createDefaultScale(m):(x.scale=e0([r]),x.type=ip.CONSTANT),x;var A=(v=s.find(function(F){return!Ai()(F[r])}))===null||v===void 0?void 0:v[r];if(this.isNumber(r)||Ai()(A)&&!m)x.scale=e0([r]),x.type=ip.CONSTANT;else{var T=m&&m.type||this.getDefaultType(A);a==="text"&&(T=lu.CAT);var O=this.createDefaultScaleConfig(T,r,s);Object.assign(O,m),x.scale=this.createDefaultScale(O),x.option=O}return x}},{key:"getDefaultType",value:function(r){var n=lu.LINEAR;return typeof r=="string"&&(n=t5.test(r)?lu.TIME:lu.CAT),n}},{key:"createDefaultScaleConfig",value:function(r,n,a){var s={type:r},f=(a==null?void 0:a.map(function(v){return v[n]}))||[];return r!==lu.CAT&&r!==lu.QUANTILE?s.domain=Ww(f):r===lu.CAT?s.domain=Co()(f):r===lu.QUANTILE&&(s.domain=f),s}},{key:"createDefaultScale",value:function(r){var n=r.type,a=r.domain,s=r5[n]();return a&&s.domain(a),s}}]),e}(),m1=ni(fm.prototype,"configService",[d1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fm))||v1),g1,y1,_1,x1,p0,b1,E1;function S1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function i5(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?S1(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):S1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var a5=(g1=(0,Yr.b2)(),y1=(0,Yr.f3)(xt.ICameraService),_1=(0,Yr.f3)(xt.IRendererService),g1(x1=(p0=function(){function e(){(0,dt.Z)(this,e),Nn(this,"cameraService",b1,this),Nn(this,"rendererService",E1,this)}return(0,It.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){r.models.forEach(function(n){n.addUniforms(i5({},r.layerModel.getAnimateUniforms()))})})}}]),e}(),b1=ni(p0.prototype,"cameraService",[y1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E1=ni(p0.prototype,"rendererService",[_1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),p0))||x1),C1,A1,o5=(C1=(0,Yr.b2)(),C1(A1=function(){function e(){(0,dt.Z)(this,e)}return(0,It.Z)(e,[{key:"apply",value:function(r){r.hooks.init.tap("LayerModelPlugin",function(){r.prepareBuildModel(),r.buildModels(),r.styleNeedUpdate=!1}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return r.prepareBuildModel(),r.clearModels(),r.buildModels(),r.layerModelNeedUpdate=!1,!1})}}]),e}())||A1),w1,T1,s5=(w1=(0,Yr.b2)(),w1(T1=function(){function e(){(0,dt.Z)(this,e)}return(0,It.Z)(e,[{key:"apply",value:function(r){r.hooks.afterInit.tap("LayerStylePlugin",function(){r.updateLayerConfig({});var n=r.getLayerConfig(),a=n.autoFit,s=n.fitBoundsOptions;a&&setTimeout(function(){r.fitBounds(s)},100)})}}]),e}())||T1),M1,P1,u5=["type"];function I1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function mv(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?I1(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):I1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var O1={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},l5={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},c5={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},f5={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},NI=null;function h5(e){var i={u_DirectionalLights:new Array(3).fill(mv({},c5)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(mv({},f5)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[l5]),e.forEach(function(r,n){var a=r.type,s=a===void 0?"directional":a,f=(0,Ga.Z)(r,u5),v=O1[s].lights,m=O1[s].num,x=i[m];i[v][x]=mv(mv({},i[v][x]),f),i[m]++}),i}var p5=(M1=(0,Yr.b2)(),M1(P1=function(){function e(){(0,dt.Z)(this,e)}return(0,It.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LightingPlugin",function(){var n=r.getLayerConfig(),a=n.enableLighting;a&&r.models.forEach(function(s){return s.addUniforms(mv({},h5()))})})}}]),e}())||P1),R1,k1,L1,hm,D1,d5=(R1=(0,Yr.b2)(),k1=(0,Yr.f3)(xt.IGlobalConfigService),R1(L1=(hm=function(){function e(){(0,dt.Z)(this,e),Nn(this,"configService",D1,this),(0,S.Z)(this,"enabled",void 0)}return(0,It.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.rendererService,f=n.postProcessingPassFactory,v=n.normalPassFactory;r.hooks.init.tap("MultiPassRendererPlugin",function(){var m=r.getLayerConfig(),x=m.enableMultiPassRenderer,A=m.passes,T=A===void 0?[]:A;a.enabled=!!x&&r.getLayerConfig().enableMultiPassRenderer!==!1,a.enabled&&(r.multiPassRenderer=Xg(r,T,f,v),r.multiPassRenderer.setRenderFlag(!0))}),r.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(a.enabled){var m=s.getViewportSize(),x=m.width,A=m.height;r.multiPassRenderer.resize(x,A)}})}}]),e}(),D1=ni(hm.prototype,"configService",[k1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hm))||L1),F1,B1,d0={NONE:0,ENCODE:1,HIGHLIGHT:2},v5=(F1=(0,Yr.b2)(),F1(B1=function(){function e(){(0,dt.Z)(this,e)}return(0,It.Z)(e,[{key:"apply",value:function(r,n){var a=n.rendererService,s=n.styleAttributeService;r.hooks.init.tap("PixelPickingPlugin",function(){var f=!0;s.registerStyleAttribute({name:"pickingColor",type:Zn.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:k.FLOAT},size:3,update:function(m,x){var A=m.id;return f?ss(A):[0,0,0]}}})}),r.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var f=r.getLayerConfig(),v=f.enablePicking;v&&r.isVisible()&&r.models.forEach(function(m){return m.addUniforms({u_PickingStage:d0.ENCODE})})}),r.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var f=r.getLayerConfig(),v=f.enablePicking;v&&r.isVisible()&&r.models.forEach(function(m){return m.addUniforms({u_PickingStage:d0.HIGHLIGHT})})}),r.hooks.beforeHighlight.tap("PixelPickingPlugin",function(f){var v=r.getLayerConfig(),m=v.highlightColor,x=v.activeMix,A=x===void 0?0:x,T=typeof m=="string"?pi(m):m||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:zs(new Uint8Array(f))}),r.models.forEach(function(O){return O.addUniforms({u_PickingStage:d0.HIGHLIGHT,u_PickingColor:f,u_HighlightColor:T.map(function(F){return F*255}),u_activeMix:A})})}),r.hooks.beforeSelect.tap("PixelPickingPlugin",function(f){var v=r.getLayerConfig(),m=v.selectColor,x=v.selectMix,A=x===void 0?0:x,T=typeof m=="string"?pi(m):m||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:zs(new Uint8Array(f))}),r.models.forEach(function(O){return O.addUniforms({u_PickingStage:d0.HIGHLIGHT,u_PickingColor:f,u_HighlightColor:T.map(function(F){return F*255}),u_activeMix:A,u_CurrentSelectedId:f,u_SelectColor:T.map(function(F){return F*255}),u_EnableSelect:1})})})}}]),e}())||B1),N1,z1,m5=(N1=(0,Yr.b2)(),N1(z1=function(){function e(){(0,dt.Z)(this,e)}return(0,It.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("RegisterStyleAttributePlugin",function(){a.registerBuiltinAttributes(s)})}},{key:"registerBuiltinAttributes",value:function(r){r.registerStyleAttribute({name:"position",type:Zn.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:k.FLOAT},size:3,update:function(a,s,f){return f.length===2?[f[0],f[1],0]:[f[0],f[1],f[2]]}}}),r.registerStyleAttribute({name:"filter",type:Zn.Attribute,descriptor:{name:"filter",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(a,s){var f=a.filter;return f?[1]:[0]}}}),r.registerStyleAttribute({name:"color",type:Zn.Attribute,descriptor:{name:"a_Color",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:4,update:function(a,s){var f=a.color;return!f||!f.length?[1,1,1,1]:f}}}),r.registerStyleAttribute({name:"vertexId",type:Zn.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(a,s,f,v){return[s]}}})}}]),e}())||z1),Z1,U1,j1,V1,G1,H1,Td,W1,X1,Y1,q1,g5=(Z1=(0,Yr.b2)(),U1=(0,Yr.f3)(xt.ICameraService),j1=(0,Yr.f3)(xt.ICoordinateSystemService),V1=(0,Yr.f3)(xt.IRendererService),G1=(0,Yr.f3)(xt.IMapService),Z1(H1=(Td=function(){function e(){(0,dt.Z)(this,e),Nn(this,"cameraService",W1,this),Nn(this,"coordinateSystemService",X1,this),Nn(this,"rendererService",Y1,this),Nn(this,"mapService",q1,this)}return(0,It.Z)(e,[{key:"apply",value:function(r){var n=this,a=this.mapService.version,s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],f=[0,0];r.hooks.beforeRender.tap("ShaderUniformPlugin",function(){n.coordinateSystemService.refresh(),a==="GAODE2.x"&&(s=n.mapService.map.customCoords.getMVPMatrix(),f=n.mapService.getCustomCoordCenter());var v=n.rendererService.getViewportSize(),m=v.width,x=v.height;r.models.forEach(function(A){var T;A.addUniforms((T={},(0,S.Z)(T,Bp.ProjectionMatrix,n.cameraService.getProjectionMatrix()),(0,S.Z)(T,Bp.ViewMatrix,n.cameraService.getViewMatrix()),(0,S.Z)(T,Bp.ViewProjectionMatrix,n.cameraService.getViewProjectionMatrix()),(0,S.Z)(T,Bp.Zoom,n.cameraService.getZoom()),(0,S.Z)(T,Bp.ZoomScale,n.cameraService.getZoomScale()),(0,S.Z)(T,Bp.FocalDistance,n.cameraService.getFocalDistance()),(0,S.Z)(T,Bp.CameraPosition,n.cameraService.getCameraPosition()),(0,S.Z)(T,Sc.CoordinateSystem,n.coordinateSystemService.getCoordinateSystem()),(0,S.Z)(T,Sc.ViewportCenter,n.coordinateSystemService.getViewportCenter()),(0,S.Z)(T,Sc.ViewportCenterProjection,n.coordinateSystemService.getViewportCenterProjection()),(0,S.Z)(T,Sc.PixelsPerDegree,n.coordinateSystemService.getPixelsPerDegree()),(0,S.Z)(T,Sc.PixelsPerDegree2,n.coordinateSystemService.getPixelsPerDegree2()),(0,S.Z)(T,Sc.PixelsPerMeter,n.coordinateSystemService.getPixelsPerMeter()),(0,S.Z)(T,Sc.Mvp,s),(0,S.Z)(T,"u_SceneCenterMKT",f),(0,S.Z)(T,"u_ViewportSize",[m,x]),(0,S.Z)(T,"u_ModelMatrix",n.cameraService.getModelMatrix()),(0,S.Z)(T,"u_DevicePixelRatio",ca.devicePixelRatio),(0,S.Z)(T,"u_PickingBuffer",r.getLayerConfig().pickingBuffer||0),(0,S.Z)(T,"u_shaderPick",Number(r.getShaderPickStat())),T))})})}}]),e}(),W1=ni(Td.prototype,"cameraService",[U1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),X1=ni(Td.prototype,"coordinateSystemService",[j1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Y1=ni(Td.prototype,"rendererService",[V1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q1=ni(Td.prototype,"mapService",[G1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Td))||H1),K1,$1,y5=(K1=(0,Yr.b2)(),K1($1=function(){function e(){(0,dt.Z)(this,e)}return(0,It.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("UpdateModelPlugin",function(){r.layerModel&&r.layerModel.needUpdate()})}}]),e}())||$1),Q1,J1,_5=(Q1=(0,Yr.b2)(),Q1(J1=function(){function e(){(0,dt.Z)(this,e)}return(0,It.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("UpdateStyleAttributePlugin",function(){a.initStyleAttribute(r,{styleAttributeService:s})}),r.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){r.layerModelNeedUpdate||a.updateStyleAtrribute(r,{styleAttributeService:s})})}},{key:"updateStyleAtrribute",value:function(r,n){var a=n.styleAttributeService,s=a.getLayerStyleAttributes()||[],f=a.getLayerStyleAttribute("filter"),v=a.getLayerStyleAttribute("shape");if(f&&f.needRegenerateVertices){r.layerModelNeedUpdate=!0,s.forEach(function(m){return m.needRegenerateVertices=!1});return}s.filter(function(m){return m.needRegenerateVertices}).forEach(function(m){a.updateAttributeByFeatureRange(m.name,r.getEncodedData(),m.featureRange.startIndex,m.featureRange.endIndex),m.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(r,n){var a=n.styleAttributeService,s=a.getLayerStyleAttributes()||[];s.filter(function(f){return f.needRegenerateVertices}).forEach(function(f){a.updateAttributeByFeatureRange(f.name,r.getEncodedData(),f.featureRange.startIndex,f.featureRange.endIndex),f.needRegenerateVertices=!1})}}]),e}())||J1);rc.bind(xt.ILayerPlugin).to(Vw).inRequestScope(),rc.bind(xt.ILayerPlugin).to(m5).inRequestScope(),rc.bind(xt.ILayerPlugin).to(n5).inRequestScope(),rc.bind(xt.ILayerPlugin).to(jw).inRequestScope(),rc.bind(xt.ILayerPlugin).to(s5).inRequestScope(),rc.bind(xt.ILayerPlugin).to(_5).inRequestScope(),rc.bind(xt.ILayerPlugin).to(y5).inRequestScope(),rc.bind(xt.ILayerPlugin).to(d5).inRequestScope(),rc.bind(xt.ILayerPlugin).to(g5).inRequestScope(),rc.bind(xt.ILayerPlugin).to(a5).inRequestScope(),rc.bind(xt.ILayerPlugin).to(p5).inRequestScope(),rc.bind(xt.ILayerPlugin).to(v5).inRequestScope(),rc.bind(xt.ILayerPlugin).to(o5).inRequestScope();var zI="2.8.32";function ex(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ZI(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ex(Object(r),!0).forEach(function(n){x5(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ex(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function x5(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function UI(e,i){return C5(e)||S5(e,i)||E5(e,i)||b5()}function b5(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function E5(e,i){if(!!e){if(typeof e=="string")return tx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return tx(e,i)}}function tx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function S5(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(m){s=!0,v=m}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function C5(e){if(Array.isArray(e))return e}var jI=null,VI=null,rx,pm,nx;function ix(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ax(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ix(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ix(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var A5=(rx=tv(xt.IGlobalConfigService),pm=function(){function e(i){(0,dt.Z)(this,e),Nn(this,"configService",nx,this),(0,S.Z)(this,"config",void 0),this.config=i}return(0,It.Z)(e,[{key:"setContainer",value:function(r,n,a,s){r.bind(xt.MapConfig).toConstantValue(ax(ax({},this.config),{},{id:n,canvas:a,hasBaseMap:s})),r.bind(xt.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),nx=ni(pm.prototype,"configService",[rx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pm),w5=W(6158),gv=W.n(w5);function yv(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function v0(e,i){var r=fn([],i,e);return Ue(r,r,1/r[3]),r}function GI(e,i){var r=e%i;return r<0?i+r:r}function HI(e,i,r){return r*i+(1-r)*e}function Xp(e,i){if(!e)throw new Error(i||"viewport-mercator-project: assertion failed.")}var df=Math.PI,ox=df/4,Th=df/180,sx=180/df,dm=512,vm=4003e4,T5=1.5;function ux(e){return Math.pow(2,e)}function M5(e){return Math.log2(e)}function m0(e,i){var r=(0,mn.Z)(e,2),n=r[0],a=r[1];Xp(Number.isFinite(n)&&Number.isFinite(i)),Xp(Number.isFinite(a)&&a>=-90&&a<=90,"invalid latitude"),i*=dm;var s=n*Th,f=a*Th,v=i*(s+df)/(2*df),m=i*(df-Math.log(Math.tan(ox+f*.5)))/(2*df);return[v,m]}function mm(e,i){var r=(0,mn.Z)(e,2),n=r[0],a=r[1];i*=dm;var s=n/i*(2*df)-df,f=2*(Math.atan(Math.exp(df-a/i*(2*df)))-ox);return[s*sx,f*sx]}function WI(e){var i=e.latitude;assert(Number.isFinite(i));var r=Math.cos(i*Th);return M5(vm*r)-9}function lx(e){var i=e.latitude,r=e.longitude,n=e.zoom,a=e.scale,s=e.highPrecision,f=s===void 0?!1:s;a=a!==void 0?a:ux(n),Xp(Number.isFinite(i)&&Number.isFinite(r)&&Number.isFinite(a));var v={},m=dm*a,x=Math.cos(i*Th),A=m/360,T=A/x,O=m/vm/x;if(v.pixelsPerMeter=[O,-O,O],v.metersPerPixel=[1/O,-1/O,1/O],v.pixelsPerDegree=[A,-T,O],v.degreesPerPixel=[1/A,-1/T,1/O],f){var F=Th*Math.tan(i*Th)/x,j=A*F/2,Y=m/vm*F,ee=Y/T*O;v.pixelsPerDegree2=[0,-j,Y],v.pixelsPerMeter2=[ee,0,ee]}return v}function XI(e,i){var r=_slicedToArray(e,3),n=r[0],a=r[1],s=r[2],f=_slicedToArray(i,3),v=f[0],m=f[1],x=f[2],A=1,T=lx({longitude:n,latitude:a,scale:A,highPrecision:!0}),O=T.pixelsPerMeter,F=T.pixelsPerMeter2,j=m0(e,A);j[0]+=v*(O[0]+F[0]*m),j[1]+=m*(O[1]+F[1]*m);var Y=mm(j,A),ee=(s||0)+(x||0);return Number.isFinite(s)||Number.isFinite(x)?[Y[0],Y[1],ee]:Y}function P5(e){var i=e.height,r=e.pitch,n=e.bearing,a=e.altitude,s=e.center,f=s===void 0?null:s,v=e.flipY,m=v===void 0?!1:v,x=yv();return ch(x,x,[0,0,-a]),Kl(x,x,[1,1,1/i]),fh(x,x,-r*Th),ba(x,x,n*Th),m&&Kl(x,x,[1,-1,1]),f&&ch(x,x,Ya.negate([],f)),x}function I5(e){var i=e.width,r=e.height,n=e.altitude,a=n===void 0?T5:n,s=e.pitch,f=s===void 0?0:s,v=e.nearZMultiplier,m=v===void 0?1:v,x=e.farZMultiplier,A=x===void 0?1:x,T=f*Th,O=Math.atan(.5/a),F=Math.sin(O)*a/Math.sin(Math.PI/2-T-O),j=Math.cos(Math.PI/2-T)*F+a;return{fov:2*Math.atan(r/2/a),aspect:i/r,focalDistance:a,near:m,far:j*A}}function O5(e){var i=e.width,r=e.height,n=e.pitch,a=e.altitude,s=e.nearZMultiplier,f=e.farZMultiplier,v=I5({width:i,height:r,altitude:a,pitch:n,nearZMultiplier:s,farZMultiplier:f}),m=v.fov,x=v.aspect,A=v.near,T=v.far,O=Mr([],m,x,A,T);return O}function R5(e,i){var r=(0,mn.Z)(e,3),n=r[0],a=r[1],s=r[2],f=s===void 0?0:s;return Xp(Number.isFinite(n)&&Number.isFinite(a)&&Number.isFinite(f)),v0(i,[n,a,f,1])}function cx(e,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=(0,mn.Z)(e,3),a=n[0],s=n[1],f=n[2];if(Xp(Number.isFinite(a)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(f)){var v=v0(i,[a,s,f,1]);return v}var m=v0(i,[a,s,0,1]),x=v0(i,[a,s,1,1]),A=m[2],T=x[2],O=A===T?0:((r||0)-A)/(T-A);return xi.lerp([],m,x,O)}var fx=yv(),k5=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=i.width,n=i.height,a=i.viewMatrix,s=a===void 0?fx:a,f=i.projectionMatrix,v=f===void 0?fx:f;(0,dt.Z)(this,e),this.width=r||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=s,this.projectionMatrix=v;var m=yv();Al(m,m,this.projectionMatrix),Al(m,m,this.viewMatrix),this.viewProjectionMatrix=m;var x=yv();Kl(x,x,[this.width/2,-this.height/2,1]),ch(x,x,[1,-1,0]),Al(x,x,this.viewProjectionMatrix);var A=Vh(yv(),x);if(!A)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=x,this.pixelUnprojectionMatrix=A,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,It.Z)(e,[{key:"equals",value:function(r){return r instanceof e?r.width===this.width&&r.height===this.height&&Hr(r.projectionMatrix,this.projectionMatrix)&&Hr(r.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=n.topLeft,s=a===void 0?!0:a,f=this.projectPosition(r),v=R5(f,this.pixelProjectionMatrix),m=(0,mn.Z)(v,2),x=m[0],A=m[1],T=s?A:this.height-A;return r.length===2?[x,T]:[x,T,v[2]]}},{key:"unproject",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=n.topLeft,s=a===void 0?!0:a,f=n.targetZ,v=(0,mn.Z)(r,3),m=v[0],x=v[1],A=v[2],T=s?x:this.height-x,O=f&&f*this.pixelsPerMeter,F=cx([m,T,A],this.pixelUnprojectionMatrix,O),j=this.unprojectPosition(F),Y=(0,mn.Z)(j,3),ee=Y[0],Ae=Y[1],Fe=Y[2];return Number.isFinite(A)?[ee,Ae,Fe]:Number.isFinite(f)?[ee,Ae,f]:[ee,Ae]}},{key:"projectPosition",value:function(r){var n=this.projectFlat(r),a=(0,mn.Z)(n,2),s=a[0],f=a[1],v=(r[2]||0)*this.pixelsPerMeter;return[s,f,v]}},{key:"unprojectPosition",value:function(r){var n=this.unprojectFlat(r),a=(0,mn.Z)(n,2),s=a[0],f=a[1],v=(r[2]||0)/this.pixelsPerMeter;return[s,f,v]}},{key:"projectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}},{key:"unprojectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}}]),e}();function L5(e){var i=e.width,r=e.height,n=e.bounds,a=e.minExtent,s=a===void 0?0:a,f=e.maxZoom,v=f===void 0?24:f,m=e.padding,x=m===void 0?0:m,A=e.offset,T=A===void 0?[0,0]:A,O=(0,mn.Z)(n,2),F=(0,mn.Z)(O[0],2),j=F[0],Y=F[1],ee=(0,mn.Z)(O[1],2),Ae=ee[0],Fe=ee[1];if(Number.isFinite(x)){var Xe=x;x={top:Xe,bottom:Xe,left:Xe,right:Xe}}else Xp(Number.isFinite(x.top)&&Number.isFinite(x.bottom)&&Number.isFinite(x.left)&&Number.isFinite(x.right));var nt=new hx({width:i,height:r,longitude:0,latitude:0,zoom:0}),Et=nt.project([j,Fe]),wt=nt.project([Ae,Y]),Wt=[Math.max(Math.abs(wt[0]-Et[0]),s),Math.max(Math.abs(wt[1]-Et[1]),s)],ur=[i-x.left-x.right-Math.abs(T[0])*2,r-x.top-x.bottom-Math.abs(T[1])*2];Xp(ur[0]>0&&ur[1]>0);var Ar=ur[0]/Wt[0],Jr=ur[1]/Wt[1],gr=(x.right-x.left)/2/Ar,vn=(x.bottom-x.top)/2/Jr,Pn=[(wt[0]+Et[0])/2+gr,(wt[1]+Et[1])/2+vn],Kn=nt.unproject(Pn),Ba=nt.zoom+Math.log2(Math.abs(Math.min(Ar,Jr)));return{longitude:Kn[0],latitude:Kn[1],zoom:Math.min(Ba,v)}}var hx=function(e){(0,Ir.Z)(i,e);function i(){var r,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=n.width,s=n.height,f=n.latitude,v=f===void 0?0:f,m=n.longitude,x=m===void 0?0:m,A=n.zoom,T=A===void 0?0:A,O=n.pitch,F=O===void 0?0:O,j=n.bearing,Y=j===void 0?0:j,ee=n.altitude,Ae=ee===void 0?1.5:ee,Fe=n.nearZMultiplier,Xe=n.farZMultiplier;(0,dt.Z)(this,i),a=a||1,s=s||1;var nt=ux(T);Ae=Math.max(.75,Ae);var Et=m0([x,v],nt);Et[2]=0;var wt=O5({width:a,height:s,pitch:F,bearing:Y,altitude:Ae,nearZMultiplier:Fe||1/s,farZMultiplier:Xe||1.01}),Wt=P5({height:s,center:Et,pitch:F,bearing:Y,altitude:Ae,flipY:!0});return r=(0,un.Z)(this,(0,_t.Z)(i).call(this,{width:a,height:s,viewMatrix:Wt,projectionMatrix:wt})),r.latitude=v,r.longitude=x,r.zoom=T,r.pitch=F,r.bearing=Y,r.altitude=Ae,r.scale=nt,r.center=Et,r.pixelsPerMeter=lx((0,J.Z)((0,J.Z)(r))).pixelsPerMeter[2],Object.freeze((0,J.Z)((0,J.Z)(r))),r}return(0,It.Z)(i,[{key:"projectFlat",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return m0(n,a)}},{key:"unprojectFlat",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return mm(n,a)}},{key:"getMapCenterByLngLatPosition",value:function(n){var a=n.lngLat,s=n.pos,f=cx(s,this.pixelUnprojectionMatrix),v=m0(a,this.scale),m=xi.add([],v,xi.negate([],f)),x=xi.add([],this.center,m);return mm(x,this.scale)}},{key:"getLocationAtPoint",value:function(n){var a=n.lngLat,s=n.pos;return this.getMapCenterByLngLatPosition({lngLat:a,pos:s})}},{key:"fitBounds",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=this.width,f=this.height,v=L5(Object.assign({width:s,height:f,bounds:n},a)),m=v.longitude,x=v.latitude,A=v.zoom;return new i({width:s,height:f,longitude:m,latitude:x,zoom:A})}}]),i}(k5),D5=function(){function e(){(0,dt.Z)(this,e),(0,S.Z)(this,"viewport",void 0)}return(0,It.Z)(e,[{key:"syncWithMapCamera",value:function(r){var n=r.center,a=r.zoom,s=r.pitch,f=r.bearing,v=r.viewportHeight,m=r.viewportWidth;this.viewport=new hx({width:m,height:v,longitude:n&&n[0],latitude:n&&n[1],zoom:a,pitch:s,bearing:f})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}}]),e}(),F5=function(){function e(i){(0,dt.Z)(this,e),(0,S.Z)(this,"size",1e4),this.size=i||1e4}return(0,It.Z)(e,[{key:"setSize",value:function(r){this.size=r}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(r){return(180+r)/360*this.size}},{key:"mercatorYfromLat",value:function(r){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(r){return r/this.size*360-180}},{key:"latFromMercatorY",value:function(r){var n=180-(1-r/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90}},{key:"project",value:function(r){var n=this.mercatorXfromLng(r[0]),a=this.mercatorYfromLat(r[1]);return[n,a]}},{key:"unproject",value:function(r){var n=this.lngFromMercatorX(r[0]),a=this.latFromMercatorY(r[1]);return[n,a]}}]),e}(),px={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},B5=["id","attributionControl","style","token","rotation","mapInstance"],dx,vx,mx,gx,yx,_x,Md,xx,bx,Ex,Sx;function Cx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function N5(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Cx(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Cx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function z5(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var f=i.createElement("style");return f.type="text/css",f.styleSheet?f.styleSheet.cssText=e:f.appendChild(i.createTextNode(e)),a.appendChild(f),f}}z5(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=gv();var Ax={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},Z5=0,U5=12,Tx="pk.eyJ1IjoibHp4dWUiLCJhIjoiY2tvaWZuM2s4MWZuYjJ1dHI5ZGduYTlrdiJ9.DQCfMRbZzx0VSwecQ69McA",j5=(dx=(0,Yr.b2)(),vx=(0,Yr.f3)(xt.MapConfig),mx=(0,Yr.f3)(xt.IGlobalConfigService),gx=(0,Yr.f3)(xt.ICoordinateSystemService),yx=(0,Yr.f3)(xt.IEventEmitter),dx(_x=(Md=function(){function e(){var i=this;(0,dt.Z)(this,e),(0,S.Z)(this,"version",ks.MAPBOX),(0,S.Z)(this,"map",void 0),(0,S.Z)(this,"simpleMapCoord",new F5),(0,S.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),Nn(this,"config",xx,this),Nn(this,"configService",bx,this),Nn(this,"coordinateSystemService",Ex,this),Nn(this,"eventEmitter",Sx,this),(0,S.Z)(this,"viewport",void 0),(0,S.Z)(this,"markerContainer",void 0),(0,S.Z)(this,"cameraChangedCallback",void 0),(0,S.Z)(this,"$mapContainer",void 0),(0,S.Z)(this,"handleCameraChanged",function(){var r=i.map.getCenter().wrap(),n=r.lat,a=r.lng;i.emit("mapchange"),i.viewport.syncWithMapCamera({bearing:i.map.getBearing(),center:[a,n],viewportHeight:i.map.transform.height,pitch:i.map.getPitch(),viewportWidth:i.map.transform.width,zoom:i.map.getZoom(),cameraHeight:0});var s=i.config.offsetZoom,f=s===void 0?U5:s;i.viewport.getZoom()>f?i.coordinateSystemService.setCoordinateSystem(Jl.LNGLAT_OFFSET):i.coordinateSystemService.setCoordinateSystem(Jl.LNGLAT),i.cameraChangedCallback(i.viewport)})}return(0,It.Z)(e,[{key:"setBgColor",value:function(r){this.bgColor=r}},{key:"addMarkerContainer",value:function(){var r=this.map.getCanvasContainer();this.markerContainer=Ua("div","l7-marker-container",r),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(r,n){l2.indexOf(r)!==-1?this.eventEmitter.on(r,n):this.map.on(Ax[r]||r,n)}},{key:"off",value:function(r,n){this.map.off(Ax[r]||r,n),this.eventEmitter.off(r,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var r=this.map.transform;return[r.width,r.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(r){return this.map.setZoom(r)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(r){this.map.setCenter(r)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(r){this.map.setBearing(r)}},{key:"zoomIn",value:function(r,n){this.map.zoomIn(r,n)}},{key:"zoomOut",value:function(r,n){this.map.zoomOut(r,n)}},{key:"setPitch",value:function(r){return this.map.setPitch(r)}},{key:"panTo",value:function(r){this.map.panTo(r)}},{key:"panBy",value:function(r,n){this.panTo([r,n])}},{key:"fitBounds",value:function(r,n){this.map.fitBounds(r,n)}},{key:"setMaxZoom",value:function(r){this.map.setMaxZoom(r)}},{key:"setMinZoom",value:function(r){this.map.setMinZoom(r)}},{key:"setMapStatus",value:function(r){r.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),r.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),r.dragEnable===!1&&this.map.dragPan.disable(),r.dragEnable===!0&&this.map.dragPan.enable(),r.rotateEnable===!1&&this.map.dragRotate.disable(),r.rotateEnable===!0&&this.map.dragRotate.enable(),r.keyboardEnable===!1&&this.map.keyboard.disable(),r.keyboardEnable===!0&&this.map.keyboard.enable(),r.zoomEnable===!1&&this.map.scrollZoom.disable(),r.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(r,n){this.map.flyTo({zoom:r,center:n})}},{key:"setMapStyle",value:function(r){this.map.setStyle(this.getMapStyle(r))}},{key:"pixelToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToPixel",value:function(r){return this.map.project(r)}},{key:"containerToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToContainer",value:function(r){return this.map.project(r)}},{key:"lngLatToCoord",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},a=this.lngLatToMercator(r,0),s=a.x,f=a.y;return[s-n.x,f-n.y]}},{key:"lngLatToMercator",value:function(r,n){var a=window.mapboxgl.MercatorCoordinate.fromLngLat(r,n),s=a.x,f=s===void 0?0:s,v=a.y,m=v===void 0?0:v,x=a.z,A=x===void 0?0:x;return{x:f,y:m,z:A}}},{key:"getModelMatrix",value:function(r,n,a){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],f=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},v=window.mapboxgl.MercatorCoordinate.fromLngLat(r,n),m=v.meterInMercatorCoordinateUnits(),x=Ki();return ch(x,x,Ya.fromValues(v.x-f.x,v.y-f.y,v.z||0-f.z)),Kl(x,x,Ya.fromValues(m*s[0],-m*s[1],m*s[2])),fh(x,x,a[0]),sf(x,x,a[1]),ba(x,x,a[2]),x}},{key:"init",value:function(){var i=(0,U.Z)(q().mark(function n(){var a,s,f,v,m,x,A,T,O,F,j,Y,ee;return q().wrap(function(Fe){for(;;)switch(Fe.prev=Fe.next){case 0:a=this.config,s=a.id,f=s===void 0?"map":s,v=a.attributionControl,m=v===void 0?!1:v,x=a.style,A=x===void 0?"light":x,T=a.token,O=T===void 0?Tx:T,F=a.rotation,j=F===void 0?0:F,Y=a.mapInstance,ee=(0,Ga.Z)(a,B5),this.viewport=new D5,!Y&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),O===Tx&&A!=="blank"&&!window.mapboxgl.accessToken&&!Y&&console.warn(this.configService.getSceneWarninfo("MapToken")),!Y&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=O),Y?(this.map=Y,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(f),this.map=new window.mapboxgl.Map(N5({container:this.$mapContainer,style:this.getMapStyle(A),attributionControl:m,bearing:j},ee))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return Fe.stop()}},n,this)}));function r(){return i.apply(this,arguments)}return r}()},{key:"destroy",value:function(){var r,n;(r=this.$mapContainer)===null||r===void 0||(n=r.parentNode)===null||n===void 0||n.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(r){for(var n,a=arguments.length,s=new Array(a>1?a-1:0),f=1;f<a;f++)s[f-1]=arguments[f];(n=this.eventEmitter).emit.apply(n,[r].concat(s))}},{key:"once",value:function(r){for(var n,a=arguments.length,s=new Array(a>1?a-1:0),f=1;f<a;f++)s[f-1]=arguments[f];(n=this.eventEmitter).once.apply(n,[r].concat(s))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(r,n){var a=new(gv()).LngLat(r[0],r[1]),s=new(gv()).LngLat(n[0],n[1]),f=a.distanceTo(s),v=gv().MercatorCoordinate.fromLngLat({lng:r[0],lat:r[1]}),m=gv().MercatorCoordinate.fromLngLat({lng:n[0],lat:n[1]}),x=v.x,A=v.y,T=m.x,O=m.y,F=Math.sqrt(Math.pow(x-T,2)+Math.pow(A-O,2))*4194304*2;return F/f}},{key:"exportMap",value:function(r){var n=this.map.getCanvas(),a=r==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return a}},{key:"onCameraChanged",value:function(r){this.cameraChangedCallback=r}},{key:"creatAmapContainer",value:function(r){var n=r;typeof r=="string"&&(n=document.getElementById(r));var a=document.createElement("div");return a.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,a.id="l7_mapbox_div"+Z5++,n.appendChild(a),a}},{key:"getMapStyle",value:function(r){return typeof r!="string"?r:px[r]?px[r]:r}}]),e}(),xx=ni(Md.prototype,"config",[vx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bx=ni(Md.prototype,"configService",[mx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ex=ni(Md.prototype,"coordinateSystemService",[gx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sx=ni(Md.prototype,"eventEmitter",[yx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Md))||_x);function V5(e){var i=G5();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,un.Z)(this,a)}}function G5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function H5(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var f=i.createElement("style");return f.type="text/css",f.styleSheet?f.styleSheet.cssText=e:f.appendChild(i.createTextNode(e)),a.appendChild(f),f}}H5(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var W5=function(e){(0,Ir.Z)(r,e);var i=V5(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"getServiceConstructor",value:function(){return j5}}]),r}(A5);function Mx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Px(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Mx(Object(r),!0).forEach(function(n){X5(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Mx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function X5(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function Y5(e,i){return Q5(e)||$5(e,i)||K5(e,i)||q5()}function q5(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function K5(e,i){if(!!e){if(typeof e=="string")return Ix(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ix(e,i)}}function Ix(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function $5(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(m){s=!0,v=m}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function Q5(e){if(Array.isArray(e))return e}var J5=ue.memo(function(e){var i=e.style,r=e.className,n=e.map,a=e.option,s=e.onSceneLoaded,f=(0,ue.createRef)(),v=(0,ue.useState)(),m=Y5(v,2),x=m[0],A=m[1];return(0,ue.useEffect)(function(){var T=new BE(Px(Px({id:f.current},a),{},{map:new W5(n)}));return T.on("loaded",function(){A(T),s&&s(T)}),function(){T.destroy()}},[]),(0,ue.useEffect)(function(){x&&n.style&&x.setMapStyle(n.style)},[JSON.stringify(n.style)]),(0,ue.useEffect)(function(){x&&n.zoom&&x.setZoom(n.zoom)},[n.zoom]),(0,ue.useEffect)(function(){x&&n.center&&x.setCenter(n.center)},[JSON.stringify(n.center)]),(0,ue.useEffect)(function(){x&&n.pitch!==void 0&&x.setPitch(n.pitch||0)},[n.pitch]),(0,ue.useEffect)(function(){x&&n.rotation&&x.setRotation(n.rotation)},[n.rotation]),ue.createElement(g.Provider,{value:x},(0,ue.createElement)("div",{ref:f,style:i,className:r},x&&e.children))}),e3=J5;function Ox(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function YI(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Ox(Object(r),!0).forEach(function(n){t3(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ox(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function t3(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function qI(e,i){return a3(e)||i3(e,i)||n3(e,i)||r3()}function r3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function n3(e,i){if(!!e){if(typeof e=="string")return Rx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Rx(e,i)}}function Rx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function i3(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(m){s=!0,v=m}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function a3(e){if(Array.isArray(e))return e}var KI=null,$I=null;function kx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function QI(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?kx(Object(r),!0).forEach(function(n){o3(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):kx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function o3(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function JI(e,i){return c3(e)||l3(e,i)||u3(e,i)||s3()}function s3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function u3(e,i){if(!!e){if(typeof e=="string")return Lx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Lx(e,i)}}function Lx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function l3(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(m){s=!0,v=m}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function c3(e){if(Array.isArray(e))return e}var eO=null,tO=null;function rO(e,i){return d3(e)||p3(e,i)||h3(e,i)||f3()}function f3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function h3(e,i){if(!!e){if(typeof e=="string")return Dx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Dx(e,i)}}function Dx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function p3(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(m){s=!0,v=m}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function d3(e){if(Array.isArray(e))return e}var nO=null,iO=null;function Fx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function aO(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Fx(Object(r),!0).forEach(function(n){v3(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Fx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function v3(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function oO(e,i){if(e==null)return{};var r=m3(e,i),n,a;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function m3(e,i){if(e==null)return{};var r={},n=Object.keys(e),a,s;for(s=0;s<n.length;s++)a=n[s],!(i.indexOf(a)>=0)&&(r[a]=e[a]);return r}var sO=null,Bx=W(73935);function Nx(e,i){return x3(e)||_3(e,i)||y3(e,i)||g3()}function g3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function y3(e,i){if(!!e){if(typeof e=="string")return zx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return zx(e,i)}}function zx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function _3(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(m){s=!0,v=m}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function x3(e){if(Array.isArray(e))return e}var Zx=ue.useEffect,Ux=ue.useState,b3=/\B([A-Z])/g,E3=function(i){return i.replace(b3,"-$1").toLowerCase()};function uO(e){var i=e.className,r=e.style,n=e.children,a=e.position,s=Ux(),f=Nx(s,2),v=f[0],m=f[1],x=useSceneValue(),A=Ux(function(){return document.createElement("div")}),T=Nx(A,1),O=T[0];return Zx(function(){var F=new Control({position:a});return F.onAdd=function(){if(i&&(O.className=i),r){var j=Object.keys(r).map(function(Y){return"".concat(E3(Y),":").concat(r[Y])}).join(";");O.style.cssText=j}return O},F.onRemove=function(){},m(F),x.addControl(F),function(){x.removeControl(F)}},[]),Zx(function(){v&&v.setPosition(a||"bottomleft")},[a]),createPortal(n,O)}var jx=(0,ue.createContext)({});function lO(){return useContext(jx)}var Vf=W(96486),cO=ue.useEffect,S3=ue.memo(function(i){var r=i.layer,n=i.active;return r.active(n.option),null},Vf.isEqual),fO=ue.useEffect,C3=ue.memo(function(i){var r=i.layer,n=i.animate;return r.animate(n),null},Vf.isEqual),hO=ue.useEffect,A3=ue.memo(function(i){var r=i.layer,n=i.color;return n.field?r.color(n.field,n.values):r.color(n.values),null},Vf.isEqual),w3=ue.memo(function(i){var r=i.layer,n=i.filter;return n.field&&r.filter(n.field,n.values),null},Vf.isEqual),T3=ue.memo(function(i){var r=i.layer,n=i.scale;return r.scale(n.values),null},Vf.isEqual),pO=ue.useEffect,M3=ue.memo(function(i){var r=i.layer,n=i.select;return r.select(n.option),null},Vf.isEqual),P3=ue.memo(function(i){var r=i.layer,n=i.shape;return n.field?r.shape(n.field,n.values):r.shape(n.values),null},Vf.isEqual),I3=ue.memo(function(i){var r=i.layer,n=i.size;return n.field?r.size(n.field,n.values):r.size(n.values),null},Vf.isEqual),O3=["data"];function R3(e,i){if(e==null)return{};var r=k3(e,i),n,a;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function k3(e,i){if(e==null)return{};var r={},n=Object.keys(e),a,s;for(s=0;s<n.length;s++)a=n[s],!(i.indexOf(a)>=0)&&(r[a]=e[a]);return r}var L3=ue.memo(function(i){var r=i.layer,n=i.source,a=n.data,s=R3(n,O3);return r.inited?r.setData(a,s):r.source(a,s),s.autoFit&&r.fitBounds(s&&s.fitBoundsOptions),null},Vf.isEqual),dO=ue.useEffect,D3=ue.memo(function(i){var r=i.layer,n=i.style;return r.style(n),null},Vf.isEqual);function F3(e,i){return Z3(e)||z3(e,i)||N3(e,i)||B3()}function B3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function N3(e,i){if(!!e){if(typeof e=="string")return Vx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Vx(e,i)}}function Vx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function z3(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(m){s=!0,v=m}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function Z3(e){if(Array.isArray(e))return e}var _v=ue.useEffect,U3=ue.useState;function Gx(e,i){var r=i.source,n=i.color,a=i.shape,s=i.style,f=i.size,v=i.scale,m=i.active,x=i.select,A=i.filter,T=i.animate,O=i.options,F=i.onLayerLoaded,j=Ee(),Y=U3(function(){var Fe;switch(e){case"polygonLayer":Fe=new Gy(O);break;case"lineLayer":Fe=new $C(O);break;case"pointLayer":Fe=new tw(O);break;case"heatmapLayer":Fe=new GS(O);break;case"rasterLayer":Fe=new Zw(O);break;case"imageLayer":Fe=new eC(O);break;case"citybuildingLayer":Fe=new vS(O);break;default:Fe=new Gy(O)}return Fe.on("inited",function(){F&&F(Fe,j)}),Fe}),ee=F3(Y,1),Ae=ee[0];return _v(function(){return j.addLayer(Ae),function(){j.removeLayer(Ae)}},[]),_v(function(){Ae.inited&&O&&Ae.updateLayerConfig(O)},[O==null?void 0:O.minZoom,O==null?void 0:O.maxZoom,O==null?void 0:O.visible]),_v(function(){Ae.inited&&(O==null?void 0:O.zIndex)&&Ae.setIndex(O.zIndex)},[O==null?void 0:O.zIndex]),_v(function(){Ae.inited&&(O==null?void 0:O.blend)&&Ae.setBlend(O.blend)},[O==null?void 0:O.blend]),_v(function(){j.render()}),ue.createElement(jx.Provider,{value:Ae},ue.createElement(L3,{layer:Ae,source:r}),v&&ue.createElement(T3,{layer:Ae,scale:v}),n&&ue.createElement(A3,{layer:Ae,color:n}),f&&ue.createElement(I3,{layer:Ae,size:f}),a&&ue.createElement(P3,{layer:Ae,shape:a}),s&&ue.createElement(D3,{layer:Ae,style:s}),m&&ue.createElement(S3,{layer:Ae,active:m}),x&&ue.createElement(M3,{layer:Ae,select:x}),A&&ue.createElement(w3,{layer:Ae,filter:A}),T&&ue.createElement(C3,{layer:Ae,animate:T}),i.children)}var vO=null,mO=null,j3=ue.memo(function(i){return Gx("pointLayer",i)}),V3=ue.memo(function(i){return Gx("heatmapLayer",i)}),gO=null,yO=null,_O=null,xO=ue.useEffect,bO=null,EO=null;function g0(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?g0=function(r){return typeof r}:g0=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},g0(e)}function Hx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function y0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Hx(Object(r),!0).forEach(function(n){G3(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Hx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function G3(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function H3(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function Wx(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function W3(e,i,r){return i&&Wx(e.prototype,i),r&&Wx(e,r),e}function X3(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&gm(e,i)}function gm(e,i){return gm=Object.setPrototypeOf||function(n,a){return n.__proto__=a,n},gm(e,i)}function Y3(e){var i=$3();return function(){var n=_0(e),a;if(i){var s=_0(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return q3(this,a)}}function q3(e,i){if(i&&(g0(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return K3(e)}function K3(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function $3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function _0(e){return _0=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},_0(e)}var SO=function(e){X3(r,e);var i=Y3(r);function r(n){var a;return H3(this,r),a=i.call(this,n),a.el=void 0,a.scene=void 0,a.popup=void 0,a.el=document.createElement("div"),a}return W3(r,[{key:"componentDidMount",value:function(){var a,s=this.props,f=s.lnglat,v=s.children,m=s.option,x=s.lngLat,A=new Eg(y0(y0({},m),{},{stopPropagation:(a=this.props.option)===null||a===void 0?void 0:a.stopPropagation}));f&&A.setLnglat(f),x&&A.setLnglat(x),v&&A.setDOMContent(this.el),this.popup=A,this.scene.addPopup(A)}},{key:"componentDidUpdate",value:function(a){var s,f,v,m,x,A,T=Array.isArray(a.lnglat)?a.lnglat:[a==null||(s=a.lnglat)===null||s===void 0?void 0:s.lng,a==null||(f=a.lnglat)===null||f===void 0?void 0:f.lat],O=Array.isArray(this.props.lnglat)?this.props.lnglat:[(v=this.props)===null||v===void 0||(m=v.lnglat)===null||m===void 0?void 0:m.lng,(x=this.props)===null||x===void 0||(A=x.lnglat)===null||A===void 0?void 0:A.lat],F=T.toString()!==O.toString();if(F){var j;this.popup.remove(),this.popup=new Eg(y0(y0({},this.props.option),{},{stopPropagation:(j=this.props.option)===null||j===void 0?void 0:j.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var a=this;return ue.createElement(g.Consumer,{},function(s){return s&&(a.scene=s),(0,Bx.createPortal)(a.props.children,a.el)})}}]),r}(ue.PureComponent);function x0(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?x0=function(r){return typeof r}:x0=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},x0(e)}function Q3(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function Xx(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function J3(e,i,r){return i&&Xx(e.prototype,i),r&&Xx(e,r),e}function eP(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&ym(e,i)}function ym(e,i){return ym=Object.setPrototypeOf||function(n,a){return n.__proto__=a,n},ym(e,i)}function tP(e){var i=iP();return function(){var n=b0(e),a;if(i){var s=b0(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return rP(this,a)}}function rP(e,i){if(i&&(x0(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return nP(e)}function nP(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function iP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function b0(e){return b0=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},b0(e)}var CO=function(e){eP(r,e);var i=tP(r);function r(n){var a;return Q3(this,r),a=i.call(this,n),a.el=void 0,a.scene=void 0,a.marker=void 0,a.el=document.createElement("div"),a}return J3(r,[{key:"componentDidMount",value:function(){var a=this.props,s=a.lnglat,f=a.children,v=a.option,m=a.onMarkerLoaded,x=new gg(v);s&&x.setLnglat(s),f&&x.setElement(this.el),this.marker=x,m&&m(x),this.scene.addMarker(x)}},{key:"componentDidUpdate",value:function(a){var s,f=(a==null?void 0:a.lnglat.toString())!==((s=this.props)===null||s===void 0?void 0:s.lnglat.toString());f&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var a=this;return ue.createElement(g.Consumer,{},function(s){return s&&(a.scene=s),(0,Bx.createPortal)(a.props.children,a.el)})}}]),r}(ue.PureComponent),AO=ue.useEffect,wO=null,TO=null,MO=ue.useEffect,PO=null},31795:function(Jt,te,W){var _e=W(75752);Jt.exports.geometry=ue,Jt.exports.ring=Ee;function ue(ae){var le=0,Be;switch(ae.type){case"Polygon":return g(ae.coordinates);case"MultiPolygon":for(Be=0;Be<ae.coordinates.length;Be++)le+=g(ae.coordinates[Be]);return le;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(Be=0;Be<ae.geometries.length;Be++)le+=ue(ae.geometries[Be]);return le}}function g(ae){var le=0;if(ae&&ae.length>0){le+=Math.abs(Ee(ae[0]));for(var Be=1;Be<ae.length;Be++)le-=Math.abs(Ee(ae[Be]))}return le}function Ee(ae){var le,Be,ye,Je,st,yt,$t,tr=0,Mt=ae.length;if(Mt>2){for($t=0;$t<Mt;$t++)$t===Mt-2?(Je=Mt-2,st=Mt-1,yt=0):$t===Mt-1?(Je=Mt-1,st=0,yt=1):(Je=$t,st=$t+1,yt=$t+2),le=ae[Je],Be=ae[st],ye=ae[yt],tr+=(H(ye[0])-H(le[0]))*Math.sin(H(Be[1]));tr=tr*_e.RADIUS*_e.RADIUS/2}return tr}function H(ae){return ae*Math.PI/180}},38163:function(Jt,te,W){var _e=W(31795);Jt.exports=ue;function ue(Be,ye){switch(Be&&Be.type||null){case"FeatureCollection":return Be.features=Be.features.map(g(ue,ye)),Be;case"GeometryCollection":return Be.geometries=Be.geometries.map(g(ue,ye)),Be;case"Feature":return Be.geometry=ue(Be.geometry,ye),Be;case"Polygon":case"MultiPolygon":return Ee(Be,ye);default:return Be}}function g(Be,ye){return function(Je){return Be(Je,ye)}}function Ee(Be,ye){return Be.type==="Polygon"?Be.coordinates=H(Be.coordinates,ye):Be.type==="MultiPolygon"&&(Be.coordinates=Be.coordinates.map(g(H,ye))),Be}function H(Be,ye){ye=!!ye,Be[0]=ae(Be[0],ye);for(var Je=1;Je<Be.length;Je++)Be[Je]=ae(Be[Je],!ye);return Be}function ae(Be,ye){return le(Be)===ye?Be:Be.reverse()}function le(Be){return _e.ring(Be)>=0}},53645:function(Jt){Jt.exports={"ant-pro-grid-content":"ant-pro-grid-content",wide:"wide"}},18067:function(Jt){Jt.exports={"ant-skeleton":"ant-skeleton","ant-skeleton-header":"ant-skeleton-header","ant-skeleton-avatar":"ant-skeleton-avatar","ant-skeleton-avatar-circle":"ant-skeleton-avatar-circle","ant-skeleton-avatar-lg":"ant-skeleton-avatar-lg","ant-skeleton-avatar-sm":"ant-skeleton-avatar-sm","ant-skeleton-content":"ant-skeleton-content","ant-skeleton-title":"ant-skeleton-title","ant-skeleton-paragraph":"ant-skeleton-paragraph","ant-skeleton-with-avatar":"ant-skeleton-with-avatar","ant-skeleton-round":"ant-skeleton-round","ant-skeleton-active":"ant-skeleton-active","ant-skeleton-loading":"ant-skeleton-loading","ant-skeleton-button":"ant-skeleton-button","ant-skeleton-input":"ant-skeleton-input","ant-skeleton-image":"ant-skeleton-image","ant-skeleton-block":"ant-skeleton-block","ant-skeleton-element":"ant-skeleton-element","ant-skeleton-button-circle":"ant-skeleton-button-circle","ant-skeleton-button-round":"ant-skeleton-button-round","ant-skeleton-button-lg":"ant-skeleton-button-lg","ant-skeleton-button-sm":"ant-skeleton-button-sm","ant-skeleton-input-lg":"ant-skeleton-input-lg","ant-skeleton-input-sm":"ant-skeleton-input-sm","ant-skeleton-image-circle":"ant-skeleton-image-circle","ant-skeleton-image-path":"ant-skeleton-image-path","ant-skeleton-image-svg":"ant-skeleton-image-svg","ant-skeleton-rtl":"ant-skeleton-rtl","ant-skeleton-loading-rtl":"ant-skeleton-loading-rtl"}},81903:function(Jt){Jt.exports={"ant-statistic":"ant-statistic","ant-statistic-title":"ant-statistic-title","ant-statistic-content":"ant-statistic-content","ant-statistic-content-value":"ant-statistic-content-value","ant-statistic-content-prefix":"ant-statistic-content-prefix","ant-statistic-content-suffix":"ant-statistic-content-suffix","ant-statistic-rtl":"ant-statistic-rtl"}},15746:function(Jt,te,W){"use strict";var _e=W(21584);te.Z=_e.Z},89032:function(Jt,te,W){"use strict";var _e=W(38663),ue=W.n(_e),g=W(6999)},71230:function(Jt,te,W){"use strict";var _e=W(92820);te.Z=_e.Z},13062:function(Jt,te,W){"use strict";var _e=W(38663),ue=W.n(_e),g=W(6999)},33860:function(Jt,te,W){"use strict";W.d(te,{Z:function(){return S}});var _e=W(96156),ue=W(22122),g=W(90484),Ee=W(67294),H=W(94184),ae=W.n(H),le=function(he){var He=he.prefixCls,Ke=he.className,it=he.width,bt=he.style;return Ee.createElement("h3",{className:ae()(He,Ke),style:(0,ue.Z)({width:it},bt)})},Be=le,ye=W(85061),Je=function(he){var He=function(xn){var an=he.width,Dn=he.rows,jn=Dn===void 0?2:Dn;if(Array.isArray(an))return an[xn];if(jn-1===xn)return an},Ke=he.prefixCls,it=he.className,bt=he.style,nr=he.rows,Nr=(0,ye.Z)(Array(nr)).map(function(wr,xn){return Ee.createElement("li",{key:xn,style:{width:He(xn)}})});return Ee.createElement("ul",{className:ae()(Ke,it),style:bt},Nr)},st=Je,yt=W(65632),$t=function(he){var He,Ke,it=he.prefixCls,bt=he.className,nr=he.style,Nr=he.size,wr=he.shape,xn=ae()((He={},(0,_e.Z)(He,"".concat(it,"-lg"),Nr==="large"),(0,_e.Z)(He,"".concat(it,"-sm"),Nr==="small"),He)),an=ae()((Ke={},(0,_e.Z)(Ke,"".concat(it,"-circle"),wr==="circle"),(0,_e.Z)(Ke,"".concat(it,"-square"),wr==="square"),(0,_e.Z)(Ke,"".concat(it,"-round"),wr==="round"),Ke)),Dn=typeof Nr=="number"?{width:Nr,height:Nr,lineHeight:"".concat(Nr,"px")}:{};return Ee.createElement("span",{className:ae()(it,xn,an,bt),style:(0,ue.Z)((0,ue.Z)({},Dn),nr)})},tr=$t,Mt=W(98423),Qt=function(he){var He=he.prefixCls,Ke=he.className,it=he.active,bt=Ee.useContext(yt.E_),nr=bt.getPrefixCls,Nr=nr("skeleton",He),wr=(0,Mt.Z)(he,["prefixCls","className"]),xn=ae()(Nr,"".concat(Nr,"-element"),(0,_e.Z)({},"".concat(Nr,"-active"),it),Ke);return Ee.createElement("div",{className:xn},Ee.createElement(tr,(0,ue.Z)({prefixCls:"".concat(Nr,"-avatar")},wr)))};Qt.defaultProps={size:"default",shape:"circle"};var Bt=Qt,ut=function(he){var He,Ke=he.prefixCls,it=he.className,bt=he.active,nr=he.block,Nr=nr===void 0?!1:nr,wr=Ee.useContext(yt.E_),xn=wr.getPrefixCls,an=xn("skeleton",Ke),Dn=(0,Mt.Z)(he,["prefixCls"]),jn=ae()(an,"".concat(an,"-element"),(He={},(0,_e.Z)(He,"".concat(an,"-active"),bt),(0,_e.Z)(He,"".concat(an,"-block"),Nr),He),it);return Ee.createElement("div",{className:jn},Ee.createElement(tr,(0,ue.Z)({prefixCls:"".concat(an,"-button")},Dn)))};ut.defaultProps={size:"default"};var pt=ut,rr=function(he){var He,Ke=he.prefixCls,it=he.className,bt=he.active,nr=he.block,Nr=Ee.useContext(yt.E_),wr=Nr.getPrefixCls,xn=wr("skeleton",Ke),an=(0,Mt.Z)(he,["prefixCls"]),Dn=ae()(xn,"".concat(xn,"-element"),(He={},(0,_e.Z)(He,"".concat(xn,"-active"),bt),(0,_e.Z)(He,"".concat(xn,"-block"),nr),He),it);return Ee.createElement("div",{className:Dn},Ee.createElement(tr,(0,ue.Z)({prefixCls:"".concat(xn,"-input")},an)))};rr.defaultProps={size:"default"};var K=rr,Xt="M365.714286 329.142857q0 45.714286-32.036571 77.677714t-77.677714 32.036571-77.677714-32.036571-32.036571-77.677714 32.036571-77.677714 77.677714-32.036571 77.677714 32.036571 32.036571 77.677714zM950.857143 548.571429l0 256-804.571429 0 0-109.714286 182.857143-182.857143 91.428571 91.428571 292.571429-292.571429zM1005.714286 146.285714l-914.285714 0q-7.460571 0-12.873143 5.412571t-5.412571 12.873143l0 694.857143q0 7.460571 5.412571 12.873143t12.873143 5.412571l914.285714 0q7.460571 0 12.873143-5.412571t5.412571-12.873143l0-694.857143q0-7.460571-5.412571-12.873143t-12.873143-5.412571zM1097.142857 164.571429l0 694.857143q0 37.741714-26.843429 64.585143t-64.585143 26.843429l-914.285714 0q-37.741714 0-64.585143-26.843429t-26.843429-64.585143l0-694.857143q0-37.741714 26.843429-64.585143t64.585143-26.843429l914.285714 0q37.741714 0 64.585143 26.843429t26.843429 64.585143z",lt=function(he){var He=he.prefixCls,Ke=he.className,it=he.style,bt=Ee.useContext(yt.E_),nr=bt.getPrefixCls,Nr=nr("skeleton",He),wr=ae()(Nr,"".concat(Nr,"-element"),Ke);return Ee.createElement("div",{className:wr},Ee.createElement("div",{className:ae()("".concat(Nr,"-image"),Ke),style:it},Ee.createElement("svg",{viewBox:"0 0 1098 1024",xmlns:"http://www.w3.org/2000/svg",className:"".concat(Nr,"-image-svg")},Ee.createElement("path",{d:Xt,className:"".concat(Nr,"-image-path")}))))},$e=lt;function St(pe){return pe&&(0,g.Z)(pe)==="object"?pe:{}}function et(pe,he){return pe&&!he?{size:"large",shape:"square"}:{size:"large",shape:"circle"}}function Ht(pe,he){return!pe&&he?{width:"38%"}:pe&&he?{width:"50%"}:{}}function Er(pe,he){var He={};return(!pe||!he)&&(He.width="61%"),!pe&&he?He.rows=3:He.rows=2,He}var kr=function(he){var He=he.prefixCls,Ke=he.loading,it=he.className,bt=he.style,nr=he.children,Nr=he.avatar,wr=he.title,xn=he.paragraph,an=he.active,Dn=he.round,jn=Ee.useContext(yt.E_),In=jn.getPrefixCls,ii=jn.direction,wi=In("skeleton",He);if(Ke||!("loading"in he)){var Ei,Ti=!!Nr,Gi=!!wr,Qi=!!xn,po;if(Ti){var Sa=(0,ue.Z)((0,ue.Z)({prefixCls:"".concat(wi,"-avatar")},et(Gi,Qi)),St(Nr));po=Ee.createElement("div",{className:"".concat(wi,"-header")},Ee.createElement(tr,Sa))}var pa;if(Gi||Qi){var Fi;if(Gi){var ra=(0,ue.Z)((0,ue.Z)({prefixCls:"".concat(wi,"-title")},Ht(Ti,Qi)),St(wr));Fi=Ee.createElement(Be,ra)}var $i;if(Qi){var is=(0,ue.Z)((0,ue.Z)({prefixCls:"".concat(wi,"-paragraph")},Er(Ti,Gi)),St(xn));$i=Ee.createElement(st,is)}pa=Ee.createElement("div",{className:"".concat(wi,"-content")},Fi,$i)}var me=ae()(wi,(Ei={},(0,_e.Z)(Ei,"".concat(wi,"-with-avatar"),Ti),(0,_e.Z)(Ei,"".concat(wi,"-active"),an),(0,_e.Z)(Ei,"".concat(wi,"-rtl"),ii==="rtl"),(0,_e.Z)(Ei,"".concat(wi,"-round"),Dn),Ei),it);return Ee.createElement("div",{className:me,style:bt},po,pa)}return typeof nr!="undefined"?nr:null};kr.defaultProps={avatar:!1,title:!0,paragraph:!0},kr.Button=pt,kr.Avatar=Bt,kr.Input=K,kr.Image=$e;var $r=kr,S=$r},71748:function(Jt,te,W){"use strict";var _e=W(38663),ue=W.n(_e),g=W(18067),Ee=W.n(g)},7277:function(Jt,te,W){"use strict";W.d(te,{Z:function(){return $r}});var _e=W(96156),ue=W(22122),g=W(67294),Ee=W(94184),H=W.n(Ee),ae=W(65632),le=W(33860),Be=W(11726),ye=W.n(Be),Je=function(pe){var he=pe.value,He=pe.formatter,Ke=pe.precision,it=pe.decimalSeparator,bt=pe.groupSeparator,nr=bt===void 0?"":bt,Nr=pe.prefixCls,wr;if(typeof He=="function")wr=He(he);else{var xn=String(he),an=xn.match(/^(-?)(\d*)(\.(\d+))?$/);if(!an||xn==="-")wr=xn;else{var Dn=an[1],jn=an[2]||"0",In=an[4]||"";jn=jn.replace(/\B(?=(\d{3})+(?!\d))/g,nr),typeof Ke=="number"&&(In=ye()(In,Ke,"0").slice(0,Ke)),In&&(In="".concat(it).concat(In)),wr=[g.createElement("span",{key:"int",className:"".concat(Nr,"-content-value-int")},Dn,jn),In&&g.createElement("span",{key:"decimal",className:"".concat(Nr,"-content-value-decimal")},In)]}}return g.createElement("span",{className:"".concat(Nr,"-content-value")},wr)},st=Je,yt=function(pe){var he=pe.prefixCls,He=pe.className,Ke=pe.style,it=pe.valueStyle,bt=pe.value,nr=bt===void 0?0:bt,Nr=pe.title,wr=pe.valueRender,xn=pe.prefix,an=pe.suffix,Dn=pe.loading,jn=pe.direction,In=pe.onMouseEnter,ii=pe.onMouseLeave,wi=g.createElement(st,(0,ue.Z)({},pe,{value:nr})),Ei=H()(he,(0,_e.Z)({},"".concat(he,"-rtl"),jn==="rtl"),He);return g.createElement("div",{className:Ei,style:Ke,onMouseEnter:In,onMouseLeave:ii},Nr&&g.createElement("div",{className:"".concat(he,"-title")},Nr),g.createElement(le.Z,{paragraph:!1,loading:Dn},g.createElement("div",{style:it,className:"".concat(he,"-content")},xn&&g.createElement("span",{className:"".concat(he,"-content-prefix")},xn),wr?wr(wi):wi,an&&g.createElement("span",{className:"".concat(he,"-content-suffix")},an))))};yt.defaultProps={decimalSeparator:".",groupSeparator:",",loading:!1};var $t=(0,ae.PG)({prefixCls:"statistic"})(yt),tr=$t,Mt=W(6610),Qt=W(5991),Bt=W(10379),ut=W(60446),pt=W(28481),rr=W(32475),K=W.n(rr),Xt=[["Y",1e3*60*60*24*365],["M",1e3*60*60*24*30],["D",1e3*60*60*24],["H",1e3*60*60],["m",1e3*60],["s",1e3],["S",1]];function lt(S,pe){var he=S,He=/\[[^\]]*]/g,Ke=(pe.match(He)||[]).map(function(Nr){return Nr.slice(1,-1)}),it=pe.replace(He,"[]"),bt=Xt.reduce(function(Nr,wr){var xn=(0,pt.Z)(wr,2),an=xn[0],Dn=xn[1];if(Nr.indexOf(an)!==-1){var jn=Math.floor(he/Dn);return he-=jn*Dn,Nr.replace(new RegExp("".concat(an,"+"),"g"),function(In){var ii=In.length;return K()(jn.toString(),ii,"0")})}return Nr},it),nr=0;return bt.replace(He,function(){var Nr=Ke[nr];return nr+=1,Nr})}function $e(S,pe){var he=pe.format,He=he===void 0?"":he,Ke=new Date(S).getTime(),it=Date.now(),bt=Math.max(Ke-it,0);return lt(bt,He)}var St=W(96159),et=1e3/30;function Ht(S){return new Date(S).getTime()}var Er=function(S){(0,Bt.Z)(he,S);var pe=(0,ut.Z)(he);function he(){var He;return(0,Mt.Z)(this,he),He=pe.apply(this,arguments),He.syncTimer=function(){var Ke=He.props.value,it=Ht(Ke);it>=Date.now()?He.startTimer():He.stopTimer()},He.startTimer=function(){if(!He.countdownId){var Ke=He.props,it=Ke.onChange,bt=Ke.value,nr=Ht(bt);He.countdownId=window.setInterval(function(){He.forceUpdate(),it&&nr>Date.now()&&it(nr-Date.now())},et)}},He.stopTimer=function(){var Ke=He.props,it=Ke.onFinish,bt=Ke.value;if(He.countdownId){clearInterval(He.countdownId),He.countdownId=void 0;var nr=Ht(bt);it&&nr<Date.now()&&it()}},He.formatCountdown=function(Ke,it){var bt=He.props.format;return $e(Ke,(0,ue.Z)((0,ue.Z)({},it),{format:bt}))},He.valueRender=function(Ke){return(0,St.Tm)(Ke,{title:void 0})},He}return(0,Qt.Z)(he,[{key:"componentDidMount",value:function(){this.syncTimer()}},{key:"componentDidUpdate",value:function(){this.syncTimer()}},{key:"componentWillUnmount",value:function(){this.stopTimer()}},{key:"render",value:function(){return g.createElement(tr,(0,ue.Z)({valueRender:this.valueRender},this.props,{formatter:this.formatCountdown}))}}]),he}(g.Component);Er.defaultProps={format:"HH:mm:ss"};var kr=Er;tr.Countdown=kr;var $r=tr},95300:function(Jt,te,W){"use strict";var _e=W(38663),ue=W.n(_e),g=W(81903),Ee=W.n(g),H=W(71748)},9187:function(Jt){"use strict";Jt.exports=te,Jt.exports.default=te;function te(S,pe,he){he=he||2;var He=pe&&pe.length,Ke=He?pe[0]*he:S.length,it=W(S,0,Ke,he,!0),bt=[];if(!it||it.next===it.prev)return bt;var nr,Nr,wr,xn,an,Dn,jn;if(He&&(it=le(S,pe,it,he)),S.length>80*he){nr=wr=S[0],Nr=xn=S[1];for(var In=he;In<Ke;In+=he)an=S[In],Dn=S[In+1],an<nr&&(nr=an),Dn<Nr&&(Nr=Dn),an>wr&&(wr=an),Dn>xn&&(xn=Dn);jn=Math.max(wr-nr,xn-Nr),jn=jn!==0?1/jn:0}return ue(it,bt,he,nr,Nr,jn),bt}function W(S,pe,he,He,Ke){var it,bt;if(Ke===$r(S,pe,he,He)>0)for(it=pe;it<he;it+=He)bt=Ht(it,S[it],S[it+1],bt);else for(it=he-He;it>=pe;it-=He)bt=Ht(it,S[it],S[it+1],bt);return bt&&pt(bt,bt.next)&&(Er(bt),bt=bt.next),bt}function _e(S,pe){if(!S)return S;pe||(pe=S);var he=S,He;do if(He=!1,!he.steiner&&(pt(he,he.next)||ut(he.prev,he,he.next)===0)){if(Er(he),he=pe=he.prev,he===he.next)break;He=!0}else he=he.next;while(He||he!==pe);return pe}function ue(S,pe,he,He,Ke,it,bt){if(!!S){!bt&&it&&yt(S,He,Ke,it);for(var nr=S,Nr,wr;S.prev!==S.next;){if(Nr=S.prev,wr=S.next,it?Ee(S,He,Ke,it):g(S)){pe.push(Nr.i/he),pe.push(S.i/he),pe.push(wr.i/he),Er(S),S=wr.next,nr=wr.next;continue}if(S=wr,S===nr){bt?bt===1?(S=H(_e(S),pe,he),ue(S,pe,he,He,Ke,it,2)):bt===2&&ae(S,pe,he,He,Ke,it):ue(_e(S),pe,he,He,Ke,it,1);break}}}}function g(S){var pe=S.prev,he=S,He=S.next;if(ut(pe,he,He)>=0)return!1;for(var Ke=S.next.next;Ke!==S.prev;){if(Qt(pe.x,pe.y,he.x,he.y,He.x,He.y,Ke.x,Ke.y)&&ut(Ke.prev,Ke,Ke.next)>=0)return!1;Ke=Ke.next}return!0}function Ee(S,pe,he,He){var Ke=S.prev,it=S,bt=S.next;if(ut(Ke,it,bt)>=0)return!1;for(var nr=Ke.x<it.x?Ke.x<bt.x?Ke.x:bt.x:it.x<bt.x?it.x:bt.x,Nr=Ke.y<it.y?Ke.y<bt.y?Ke.y:bt.y:it.y<bt.y?it.y:bt.y,wr=Ke.x>it.x?Ke.x>bt.x?Ke.x:bt.x:it.x>bt.x?it.x:bt.x,xn=Ke.y>it.y?Ke.y>bt.y?Ke.y:bt.y:it.y>bt.y?it.y:bt.y,an=tr(nr,Nr,pe,he,He),Dn=tr(wr,xn,pe,he,He),jn=S.prevZ,In=S.nextZ;jn&&jn.z>=an&&In&&In.z<=Dn;){if(jn!==S.prev&&jn!==S.next&&Qt(Ke.x,Ke.y,it.x,it.y,bt.x,bt.y,jn.x,jn.y)&&ut(jn.prev,jn,jn.next)>=0||(jn=jn.prevZ,In!==S.prev&&In!==S.next&&Qt(Ke.x,Ke.y,it.x,it.y,bt.x,bt.y,In.x,In.y)&&ut(In.prev,In,In.next)>=0))return!1;In=In.nextZ}for(;jn&&jn.z>=an;){if(jn!==S.prev&&jn!==S.next&&Qt(Ke.x,Ke.y,it.x,it.y,bt.x,bt.y,jn.x,jn.y)&&ut(jn.prev,jn,jn.next)>=0)return!1;jn=jn.prevZ}for(;In&&In.z<=Dn;){if(In!==S.prev&&In!==S.next&&Qt(Ke.x,Ke.y,it.x,it.y,bt.x,bt.y,In.x,In.y)&&ut(In.prev,In,In.next)>=0)return!1;In=In.nextZ}return!0}function H(S,pe,he){var He=S;do{var Ke=He.prev,it=He.next.next;!pt(Ke,it)&&rr(Ke,He,He.next,it)&&$e(Ke,it)&&$e(it,Ke)&&(pe.push(Ke.i/he),pe.push(He.i/he),pe.push(it.i/he),Er(He),Er(He.next),He=S=it),He=He.next}while(He!==S);return _e(He)}function ae(S,pe,he,He,Ke,it){var bt=S;do{for(var nr=bt.next.next;nr!==bt.prev;){if(bt.i!==nr.i&&Bt(bt,nr)){var Nr=et(bt,nr);bt=_e(bt,bt.next),Nr=_e(Nr,Nr.next),ue(bt,pe,he,He,Ke,it),ue(Nr,pe,he,He,Ke,it);return}nr=nr.next}bt=bt.next}while(bt!==S)}function le(S,pe,he,He){var Ke=[],it,bt,nr,Nr,wr;for(it=0,bt=pe.length;it<bt;it++)nr=pe[it]*He,Nr=it<bt-1?pe[it+1]*He:S.length,wr=W(S,nr,Nr,He,!1),wr===wr.next&&(wr.steiner=!0),Ke.push(Mt(wr));for(Ke.sort(Be),it=0;it<Ke.length;it++)he=ye(Ke[it],he),he=_e(he,he.next);return he}function Be(S,pe){return S.x-pe.x}function ye(S,pe){var he=Je(S,pe);if(!he)return pe;var He=et(he,S),Ke=_e(he,he.next);return _e(He,He.next),pe===he?Ke:pe}function Je(S,pe){var he=pe,He=S.x,Ke=S.y,it=-Infinity,bt;do{if(Ke<=he.y&&Ke>=he.next.y&&he.next.y!==he.y){var nr=he.x+(Ke-he.y)*(he.next.x-he.x)/(he.next.y-he.y);if(nr<=He&&nr>it){if(it=nr,nr===He){if(Ke===he.y)return he;if(Ke===he.next.y)return he.next}bt=he.x<he.next.x?he:he.next}}he=he.next}while(he!==pe);if(!bt)return null;if(He===it)return bt;var Nr=bt,wr=bt.x,xn=bt.y,an=Infinity,Dn;he=bt;do He>=he.x&&he.x>=wr&&He!==he.x&&Qt(Ke<xn?He:it,Ke,wr,xn,Ke<xn?it:He,Ke,he.x,he.y)&&(Dn=Math.abs(Ke-he.y)/(He-he.x),$e(he,S)&&(Dn<an||Dn===an&&(he.x>bt.x||he.x===bt.x&&st(bt,he)))&&(bt=he,an=Dn)),he=he.next;while(he!==Nr);return bt}function st(S,pe){return ut(S.prev,S,pe.prev)<0&&ut(pe.next,S,S.next)<0}function yt(S,pe,he,He){var Ke=S;do Ke.z===null&&(Ke.z=tr(Ke.x,Ke.y,pe,he,He)),Ke.prevZ=Ke.prev,Ke.nextZ=Ke.next,Ke=Ke.next;while(Ke!==S);Ke.prevZ.nextZ=null,Ke.prevZ=null,$t(Ke)}function $t(S){var pe,he,He,Ke,it,bt,nr,Nr,wr=1;do{for(he=S,S=null,it=null,bt=0;he;){for(bt++,He=he,nr=0,pe=0;pe<wr&&(nr++,He=He.nextZ,!!He);pe++);for(Nr=wr;nr>0||Nr>0&&He;)nr!==0&&(Nr===0||!He||he.z<=He.z)?(Ke=he,he=he.nextZ,nr--):(Ke=He,He=He.nextZ,Nr--),it?it.nextZ=Ke:S=Ke,Ke.prevZ=it,it=Ke;he=He}it.nextZ=null,wr*=2}while(bt>1);return S}function tr(S,pe,he,He,Ke){return S=32767*(S-he)*Ke,pe=32767*(pe-He)*Ke,S=(S|S<<8)&16711935,S=(S|S<<4)&252645135,S=(S|S<<2)&858993459,S=(S|S<<1)&1431655765,pe=(pe|pe<<8)&16711935,pe=(pe|pe<<4)&252645135,pe=(pe|pe<<2)&858993459,pe=(pe|pe<<1)&1431655765,S|pe<<1}function Mt(S){var pe=S,he=S;do(pe.x<he.x||pe.x===he.x&&pe.y<he.y)&&(he=pe),pe=pe.next;while(pe!==S);return he}function Qt(S,pe,he,He,Ke,it,bt,nr){return(Ke-bt)*(pe-nr)-(S-bt)*(it-nr)>=0&&(S-bt)*(He-nr)-(he-bt)*(pe-nr)>=0&&(he-bt)*(it-nr)-(Ke-bt)*(He-nr)>=0}function Bt(S,pe){return S.next.i!==pe.i&&S.prev.i!==pe.i&&!lt(S,pe)&&($e(S,pe)&&$e(pe,S)&&St(S,pe)&&(ut(S.prev,S,pe.prev)||ut(S,pe.prev,pe))||pt(S,pe)&&ut(S.prev,S,S.next)>0&&ut(pe.prev,pe,pe.next)>0)}function ut(S,pe,he){return(pe.y-S.y)*(he.x-pe.x)-(pe.x-S.x)*(he.y-pe.y)}function pt(S,pe){return S.x===pe.x&&S.y===pe.y}function rr(S,pe,he,He){var Ke=Xt(ut(S,pe,he)),it=Xt(ut(S,pe,He)),bt=Xt(ut(he,He,S)),nr=Xt(ut(he,He,pe));return!!(Ke!==it&&bt!==nr||Ke===0&&K(S,he,pe)||it===0&&K(S,He,pe)||bt===0&&K(he,S,He)||nr===0&&K(he,pe,He))}function K(S,pe,he){return pe.x<=Math.max(S.x,he.x)&&pe.x>=Math.min(S.x,he.x)&&pe.y<=Math.max(S.y,he.y)&&pe.y>=Math.min(S.y,he.y)}function Xt(S){return S>0?1:S<0?-1:0}function lt(S,pe){var he=S;do{if(he.i!==S.i&&he.next.i!==S.i&&he.i!==pe.i&&he.next.i!==pe.i&&rr(he,he.next,S,pe))return!0;he=he.next}while(he!==S);return!1}function $e(S,pe){return ut(S.prev,S,S.next)<0?ut(S,pe,S.next)>=0&&ut(S,S.prev,pe)>=0:ut(S,pe,S.prev)<0||ut(S,S.next,pe)<0}function St(S,pe){var he=S,He=!1,Ke=(S.x+pe.x)/2,it=(S.y+pe.y)/2;do he.y>it!=he.next.y>it&&he.next.y!==he.y&&Ke<(he.next.x-he.x)*(it-he.y)/(he.next.y-he.y)+he.x&&(He=!He),he=he.next;while(he!==S);return He}function et(S,pe){var he=new kr(S.i,S.x,S.y),He=new kr(pe.i,pe.x,pe.y),Ke=S.next,it=pe.prev;return S.next=pe,pe.prev=S,he.next=Ke,Ke.prev=he,He.next=he,he.prev=He,it.next=He,He.prev=it,He}function Ht(S,pe,he,He){var Ke=new kr(S,pe,he);return He?(Ke.next=He.next,Ke.prev=He,He.next.prev=Ke,He.next=Ke):(Ke.prev=Ke,Ke.next=Ke),Ke}function Er(S){S.next.prev=S.prev,S.prev.next=S.next,S.prevZ&&(S.prevZ.nextZ=S.nextZ),S.nextZ&&(S.nextZ.prevZ=S.prevZ)}function kr(S,pe,he){this.i=S,this.x=pe,this.y=he,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}te.deviation=function(S,pe,he,He){var Ke=pe&&pe.length,it=Ke?pe[0]*he:S.length,bt=Math.abs($r(S,0,it,he));if(Ke)for(var nr=0,Nr=pe.length;nr<Nr;nr++){var wr=pe[nr]*he,xn=nr<Nr-1?pe[nr+1]*he:S.length;bt-=Math.abs($r(S,wr,xn,he))}var an=0;for(nr=0;nr<He.length;nr+=3){var Dn=He[nr]*he,jn=He[nr+1]*he,In=He[nr+2]*he;an+=Math.abs((S[Dn]-S[In])*(S[jn+1]-S[Dn+1])-(S[Dn]-S[jn])*(S[In+1]-S[Dn+1]))}return bt===0&&an===0?0:Math.abs((an-bt)/bt)};function $r(S,pe,he,He){for(var Ke=0,it=pe,bt=he-He;it<he;it+=He)Ke+=(S[bt]-S[it])*(S[it+1]+S[bt+1]),bt=it;return Ke}te.flatten=function(S){for(var pe=S[0][0].length,he={vertices:[],holes:[],dimensions:pe},He=0,Ke=0;Ke<S.length;Ke++){for(var it=0;it<S[Ke].length;it++)for(var bt=0;bt<pe;bt++)he.vertices.push(S[Ke][it][bt]);Ke>0&&(He+=S[Ke-1].length,he.holes.push(He))}return he}},67709:function(Jt){function te(_e){var ue=_e.target||_e.srcElement;ue.__resizeRAF__&&cancelAnimationFrame(ue.__resizeRAF__),ue.__resizeRAF__=requestAnimationFrame(function(){var g=ue.__resizeTrigger__,Ee=g&&g.__resizeListeners__;Ee&&Ee.forEach(function(H){H.call(g,_e)})})}var W=function(ue,g){var Ee=this,H=Ee.document,ae,le=H.attachEvent;typeof navigator!="undefined"&&(ae=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function Be(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",te)}if(!ue.__resizeListeners__)if(ue.__resizeListeners__=[],le)ue.__resizeTrigger__=ue,ue.attachEvent("onresize",te);else{getComputedStyle(ue).position==="static"&&(ue.style.position="relative");var ye=ue.__resizeTrigger__=H.createElement("object");ye.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),ye.setAttribute("class","resize-sensor"),ye.setAttribute("tabindex","-1"),ye.setAttribute("title",""),ye.__resizeElement__=ue,ye.onload=Be,ye.type="text/html",ae&&ue.appendChild(ye),ye.data="about:blank",ae||ue.appendChild(ye)}ue.__resizeListeners__.push(g)};Jt.exports=typeof window=="undefined"?W:W.bind(window),Jt.exports.unbind=function(_e,ue){var g=document.attachEvent,Ee=_e.__resizeListeners__||[];if(ue){var H=Ee.indexOf(ue);H!==-1&&Ee.splice(H,1)}else Ee=_e.__resizeListeners__=[];if(!Ee.length){if(g)_e.detachEvent("onresize",te);else if(_e.__resizeTrigger__){var ae=_e.__resizeTrigger__.contentDocument,le=ae&&ae.defaultView;le&&(le.removeEventListener("resize",te),delete le.__resizeTrigger__),_e.__resizeTrigger__=!_e.removeChild(_e.__resizeTrigger__)}delete _e.__resizeListeners__}}},26729:function(Jt){"use strict";var te=Object.prototype.hasOwnProperty,W="~";function _e(){}Object.create&&(_e.prototype=Object.create(null),new _e().__proto__||(W=!1));function ue(ae,le,Be){this.fn=ae,this.context=le,this.once=Be||!1}function g(ae,le,Be,ye,Je){if(typeof Be!="function")throw new TypeError("The listener must be a function");var st=new ue(Be,ye||ae,Je),yt=W?W+le:le;return ae._events[yt]?ae._events[yt].fn?ae._events[yt]=[ae._events[yt],st]:ae._events[yt].push(st):(ae._events[yt]=st,ae._eventsCount++),ae}function Ee(ae,le){--ae._eventsCount==0?ae._events=new _e:delete ae._events[le]}function H(){this._events=new _e,this._eventsCount=0}H.prototype.eventNames=function(){var le=[],Be,ye;if(this._eventsCount===0)return le;for(ye in Be=this._events)te.call(Be,ye)&&le.push(W?ye.slice(1):ye);return Object.getOwnPropertySymbols?le.concat(Object.getOwnPropertySymbols(Be)):le},H.prototype.listeners=function(le){var Be=W?W+le:le,ye=this._events[Be];if(!ye)return[];if(ye.fn)return[ye.fn];for(var Je=0,st=ye.length,yt=new Array(st);Je<st;Je++)yt[Je]=ye[Je].fn;return yt},H.prototype.listenerCount=function(le){var Be=W?W+le:le,ye=this._events[Be];return ye?ye.fn?1:ye.length:0},H.prototype.emit=function(le,Be,ye,Je,st,yt){var $t=W?W+le:le;if(!this._events[$t])return!1;var tr=this._events[$t],Mt=arguments.length,Qt,Bt;if(tr.fn){switch(tr.once&&this.removeListener(le,tr.fn,void 0,!0),Mt){case 1:return tr.fn.call(tr.context),!0;case 2:return tr.fn.call(tr.context,Be),!0;case 3:return tr.fn.call(tr.context,Be,ye),!0;case 4:return tr.fn.call(tr.context,Be,ye,Je),!0;case 5:return tr.fn.call(tr.context,Be,ye,Je,st),!0;case 6:return tr.fn.call(tr.context,Be,ye,Je,st,yt),!0}for(Bt=1,Qt=new Array(Mt-1);Bt<Mt;Bt++)Qt[Bt-1]=arguments[Bt];tr.fn.apply(tr.context,Qt)}else{var ut=tr.length,pt;for(Bt=0;Bt<ut;Bt++)switch(tr[Bt].once&&this.removeListener(le,tr[Bt].fn,void 0,!0),Mt){case 1:tr[Bt].fn.call(tr[Bt].context);break;case 2:tr[Bt].fn.call(tr[Bt].context,Be);break;case 3:tr[Bt].fn.call(tr[Bt].context,Be,ye);break;case 4:tr[Bt].fn.call(tr[Bt].context,Be,ye,Je);break;default:if(!Qt)for(pt=1,Qt=new Array(Mt-1);pt<Mt;pt++)Qt[pt-1]=arguments[pt];tr[Bt].fn.apply(tr[Bt].context,Qt)}}return!0},H.prototype.on=function(le,Be,ye){return g(this,le,Be,ye,!1)},H.prototype.once=function(le,Be,ye){return g(this,le,Be,ye,!0)},H.prototype.removeListener=function(le,Be,ye,Je){var st=W?W+le:le;if(!this._events[st])return this;if(!Be)return Ee(this,st),this;var yt=this._events[st];if(yt.fn)yt.fn===Be&&(!Je||yt.once)&&(!ye||yt.context===ye)&&Ee(this,st);else{for(var $t=0,tr=[],Mt=yt.length;$t<Mt;$t++)(yt[$t].fn!==Be||Je&&!yt[$t].once||ye&&yt[$t].context!==ye)&&tr.push(yt[$t]);tr.length?this._events[st]=tr.length===1?tr[0]:tr:Ee(this,st)}return this},H.prototype.removeAllListeners=function(le){var Be;return le?(Be=W?W+le:le,this._events[Be]&&Ee(this,Be)):(this._events=new _e,this._eventsCount=0),this},H.prototype.off=H.prototype.removeListener,H.prototype.addListener=H.prototype.on,H.prefixed=W,H.EventEmitter=H,Jt.exports=H},7375:function(Jt,te){"use strict";Object.defineProperty(te,"__esModule",{value:!0});var W=Symbol.for("INJECTION");function _e(ae,le,Be,ye){function Je(){return ye&&!Reflect.hasMetadata(W,this,le)&&Reflect.defineMetadata(W,Be(),this,le),Reflect.hasMetadata(W,this,le)?Reflect.getMetadata(W,this,le):Be()}function st(yt){Reflect.defineMetadata(W,yt,this,le)}Object.defineProperty(ae,le,{configurable:!0,enumerable:!0,get:Je,set:st})}function ue(ae,le){return function(Be){return function(ye,Je){var st=function(){return ae.get(Be)};_e(ye,Je,st,le)}}}te.makePropertyInjectDecorator=ue;function g(ae,le){return function(Be,ye){return function(Je,st){var yt=function(){return ae.getNamed(Be,ye)};_e(Je,st,yt,le)}}}te.makePropertyInjectNamedDecorator=g;function Ee(ae,le){return function(Be,ye,Je){return function(st,yt){var $t=function(){return ae.getTagged(Be,ye,Je)};_e(st,yt,$t,le)}}}te.makePropertyInjectTaggedDecorator=Ee;function H(ae,le){return function(Be){return function(ye,Je){var st=function(){return ae.getAll(Be)};_e(ye,Je,st,le)}}}te.makePropertyMultiInjectDecorator=H},84879:function(Jt,te,W){"use strict";var _e;_e={value:!0};var ue=W(7375);function g(Ee,H){H===void 0&&(H=!0);var ae=ue.makePropertyInjectDecorator(Ee,H),le=ue.makePropertyInjectNamedDecorator(Ee,H),Be=ue.makePropertyInjectTaggedDecorator(Ee,H),ye=ue.makePropertyMultiInjectDecorator(Ee,H);return{lazyInject:ae,lazyInjectNamed:le,lazyInjectTagged:Be,lazyMultiInject:ye}}te.Z=g},99934:function(Jt,te,W){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.tagProperty=te.tagParameter=te.decorate=void 0;var _e=W(16674),ue=W(6867);function g(ye,Je,st,yt){var $t=ue.TAGGED;H($t,ye,Je,yt,st)}te.tagParameter=g;function Ee(ye,Je,st){var yt=ue.TAGGED_PROP;H(yt,ye.constructor,Je,st)}te.tagProperty=Ee;function H(ye,Je,st,yt,$t){var tr={},Mt=typeof $t=="number",Qt=$t!==void 0&&Mt?$t.toString():st;if(Mt&&st!==void 0)throw new Error(_e.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(ye,Je)&&(tr=Reflect.getMetadata(ye,Je));var Bt=tr[Qt];if(!Array.isArray(Bt))Bt=[];else for(var ut=0,pt=Bt;ut<pt.length;ut++){var rr=pt[ut];if(rr.key===yt.key)throw new Error(_e.DUPLICATED_METADATA+" "+rr.key.toString())}Bt.push(yt),tr[Qt]=Bt,Reflect.defineMetadata(ye,tr,Je)}function ae(ye,Je){Reflect.decorate(ye,Je)}function le(ye,Je){return function(st,yt){Je(st,yt,ye)}}function Be(ye,Je,st){typeof st=="number"?ae([le(st,ye)],Je):typeof st=="string"?Reflect.decorate([ye],Je,st):ae([ye],Je)}te.decorate=Be},5744:function(Jt,te,W){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.inject=te.LazyServiceIdentifer=void 0;var _e=W(16674),ue=W(6867),g=W(47738),Ee=W(99934),H=function(){function le(Be){this._cb=Be}return le.prototype.unwrap=function(){return this._cb()},le}();te.LazyServiceIdentifer=H;function ae(le){return function(Be,ye,Je){if(le===void 0)throw new Error(_e.UNDEFINED_INJECT_ANNOTATION(Be.name));var st=new g.Metadata(ue.INJECT_TAG,le);typeof Je=="number"?Ee.tagParameter(Be,ye,Je,st):Ee.tagProperty(Be,ye,st)}}te.inject=ae},64315:function(Jt,te,W){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.injectable=void 0;var _e=W(16674),ue=W(6867);function g(){return function(Ee){if(Reflect.hasOwnMetadata(ue.PARAM_TYPES,Ee))throw new Error(_e.DUPLICATED_INJECTABLE_DECORATOR);var H=Reflect.getMetadata(ue.DESIGN_PARAM_TYPES,Ee)||[];return Reflect.defineMetadata(ue.PARAM_TYPES,H,Ee),Ee}}te.injectable=g},71693:function(Jt,te,W){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.multiInject=void 0;var _e=W(6867),ue=W(47738),g=W(99934);function Ee(H){return function(ae,le,Be){var ye=new ue.Metadata(_e.MULTI_INJECT_TAG,H);typeof Be=="number"?g.tagParameter(ae,le,Be,ye):g.tagProperty(ae,le,ye)}}te.multiInject=Ee},38085:function(Jt,te,W){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.named=void 0;var _e=W(6867),ue=W(47738),g=W(99934);function Ee(H){return function(ae,le,Be){var ye=new ue.Metadata(_e.NAMED_TAG,H);typeof Be=="number"?g.tagParameter(ae,le,Be,ye):g.tagProperty(ae,le,ye)}}te.named=Ee},6515:function(Jt,te,W){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.optional=void 0;var _e=W(6867),ue=W(47738),g=W(99934);function Ee(){return function(H,ae,le){var Be=new ue.Metadata(_e.OPTIONAL_TAG,!0);typeof le=="number"?g.tagParameter(H,ae,le,Be):g.tagProperty(H,ae,Be)}}te.optional=Ee},7014:function(Jt,te,W){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.postConstruct=void 0;var _e=W(16674),ue=W(6867),g=W(47738);function Ee(){return function(H,ae,le){var Be=new g.Metadata(ue.POST_CONSTRUCT,ae);if(Reflect.hasOwnMetadata(ue.POST_CONSTRUCT,H.constructor))throw new Error(_e.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(ue.POST_CONSTRUCT,Be,H.constructor)}}te.postConstruct=Ee},32052:function(Jt,te,W){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.tagged=void 0;var _e=W(47738),ue=W(99934);function g(Ee,H){return function(ae,le,Be){var ye=new _e.Metadata(Ee,H);typeof Be=="number"?ue.tagParameter(ae,le,Be,ye):ue.tagProperty(ae,le,ye)}}te.tagged=g},55638:function(Jt,te,W){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.targetName=void 0;var _e=W(6867),ue=W(47738),g=W(99934);function Ee(H){return function(ae,le,Be){var ye=new ue.Metadata(_e.NAME_TAG,H);g.tagParameter(ae,le,Be,ye)}}te.targetName=Ee},86757:function(Jt,te,W){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.unmanaged=void 0;var _e=W(6867),ue=W(47738),g=W(99934);function Ee(){return function(H,ae,le){var Be=new ue.Metadata(_e.UNMANAGED_TAG,!0);g.tagParameter(H,ae,le,Be)}}te.unmanaged=Ee},44290:function(Jt,te,W){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.Binding=void 0;var _e=W(28421),ue=W(37791),g=function(){function Ee(H,ae){this.id=ue.id(),this.activated=!1,this.serviceIdentifier=H,this.scope=ae,this.type=_e.BindingTypeEnum.Invalid,this.constraint=function(le){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return Ee.prototype.clone=function(){var H=new Ee(this.serviceIdentifier,this.scope);return H.activated=H.scope===_e.BindingScopeEnum.Singleton?this.activated:!1,H.implementationType=this.implementationType,H.dynamicValue=this.dynamicValue,H.scope=this.scope,H.type=this.type,H.factory=this.factory,H.provider=this.provider,H.constraint=this.constraint,H.onActivation=this.onActivation,H.cache=this.cache,H},Ee}();te.Binding=g},23184:function(Jt,te){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.BindingCount=void 0;var W={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};te.BindingCount=W},16674:function(Jt,te){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.STACK_OVERFLOW=te.CIRCULAR_DEPENDENCY_IN_FACTORY=te.POST_CONSTRUCT_ERROR=te.MULTIPLE_POST_CONSTRUCT_METHODS=te.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=te.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=te.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=te.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=te.ARGUMENTS_LENGTH_MISMATCH=te.INVALID_DECORATOR_OPERATION=te.INVALID_TO_SELF_VALUE=te.INVALID_FUNCTION_BINDING=te.INVALID_MIDDLEWARE_RETURN=te.NO_MORE_SNAPSHOTS_AVAILABLE=te.INVALID_BINDING_TYPE=te.NOT_IMPLEMENTED=te.CIRCULAR_DEPENDENCY=te.UNDEFINED_INJECT_ANNOTATION=te.MISSING_INJECT_ANNOTATION=te.MISSING_INJECTABLE_ANNOTATION=te.NOT_REGISTERED=te.CANNOT_UNBIND=te.AMBIGUOUS_MATCH=te.KEY_NOT_FOUND=te.NULL_ARGUMENT=te.DUPLICATED_METADATA=te.DUPLICATED_INJECTABLE_DECORATOR=void 0,te.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",te.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",te.NULL_ARGUMENT="NULL argument",te.KEY_NOT_FOUND="Key Not Found",te.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",te.CANNOT_UNBIND="Could not unbind serviceIdentifier:",te.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",te.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",te.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var W=function(Ee){return"@inject called with undefined this could mean that the class "+Ee+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};te.UNDEFINED_INJECT_ANNOTATION=W,te.CIRCULAR_DEPENDENCY="Circular dependency found:",te.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",te.INVALID_BINDING_TYPE="Invalid binding type:",te.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",te.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",te.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",te.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",te.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var _e=function(){for(var Ee=[],H=0;H<arguments.length;H++)Ee[H]=arguments[H];return"The number of constructor arguments in the derived class "+(Ee[0]+" must be >= than the number of constructor arguments of its base class.")};te.ARGUMENTS_LENGTH_MISMATCH=_e,te.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",te.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",te.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",te.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",te.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var ue=function(){for(var Ee=[],H=0;H<arguments.length;H++)Ee[H]=arguments[H];return"@postConstruct error in class "+Ee[0]+": "+Ee[1]};te.POST_CONSTRUCT_ERROR=ue;var g=function(){for(var Ee=[],H=0;H<arguments.length;H++)Ee[H]=arguments[H];return"It looks like there is a circular dependency "+("in one of the '"+Ee[0]+"' bindings. Please investigate bindings with")+("service identifier '"+Ee[1]+"'.")};te.CIRCULAR_DEPENDENCY_IN_FACTORY=g,te.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(Jt,te){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.TargetTypeEnum=te.BindingTypeEnum=te.BindingScopeEnum=void 0;var W={Request:"Request",Singleton:"Singleton",Transient:"Transient"};te.BindingScopeEnum=W;var _e={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};te.BindingTypeEnum=_e;var ue={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};te.TargetTypeEnum=ue},6867:function(Jt,te){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.NON_CUSTOM_TAG_KEYS=te.POST_CONSTRUCT=te.DESIGN_PARAM_TYPES=te.PARAM_TYPES=te.TAGGED_PROP=te.TAGGED=te.MULTI_INJECT_TAG=te.INJECT_TAG=te.OPTIONAL_TAG=te.UNMANAGED_TAG=te.NAME_TAG=te.NAMED_TAG=void 0,te.NAMED_TAG="named",te.NAME_TAG="name",te.UNMANAGED_TAG="unmanaged",te.OPTIONAL_TAG="optional",te.INJECT_TAG="inject",te.MULTI_INJECT_TAG="multi_inject",te.TAGGED="inversify:tagged",te.TAGGED_PROP="inversify:tagged_props",te.PARAM_TYPES="inversify:paramtypes",te.DESIGN_PARAM_TYPES="design:paramtypes",te.POST_CONSTRUCT="post_construct";function W(){return[te.INJECT_TAG,te.MULTI_INJECT_TAG,te.NAME_TAG,te.UNMANAGED_TAG,te.NAMED_TAG,te.OPTIONAL_TAG]}te.NON_CUSTOM_TAG_KEYS=W()},51389:function(Jt,te,W){"use strict";var _e=this&&this.__awaiter||function(Bt,ut,pt,rr){function K(Xt){return Xt instanceof pt?Xt:new pt(function(lt){lt(Xt)})}return new(pt||(pt=Promise))(function(Xt,lt){function $e(Ht){try{et(rr.next(Ht))}catch(Er){lt(Er)}}function St(Ht){try{et(rr.throw(Ht))}catch(Er){lt(Er)}}function et(Ht){Ht.done?Xt(Ht.value):K(Ht.value).then($e,St)}et((rr=rr.apply(Bt,ut||[])).next())})},ue=this&&this.__generator||function(Bt,ut){var pt={label:0,sent:function(){if(Xt[0]&1)throw Xt[1];return Xt[1]},trys:[],ops:[]},rr,K,Xt,lt;return lt={next:$e(0),throw:$e(1),return:$e(2)},typeof Symbol=="function"&&(lt[Symbol.iterator]=function(){return this}),lt;function $e(et){return function(Ht){return St([et,Ht])}}function St(et){if(rr)throw new TypeError("Generator is already executing.");for(;pt;)try{if(rr=1,K&&(Xt=et[0]&2?K.return:et[0]?K.throw||((Xt=K.return)&&Xt.call(K),0):K.next)&&!(Xt=Xt.call(K,et[1])).done)return Xt;switch(K=0,Xt&&(et=[et[0]&2,Xt.value]),et[0]){case 0:case 1:Xt=et;break;case 4:return pt.label++,{value:et[1],done:!1};case 5:pt.label++,K=et[1],et=[0];continue;case 7:et=pt.ops.pop(),pt.trys.pop();continue;default:if(Xt=pt.trys,!(Xt=Xt.length>0&&Xt[Xt.length-1])&&(et[0]===6||et[0]===2)){pt=0;continue}if(et[0]===3&&(!Xt||et[1]>Xt[0]&&et[1]<Xt[3])){pt.label=et[1];break}if(et[0]===6&&pt.label<Xt[1]){pt.label=Xt[1],Xt=et;break}if(Xt&&pt.label<Xt[2]){pt.label=Xt[2],pt.ops.push(et);break}Xt[2]&&pt.ops.pop(),pt.trys.pop();continue}et=ut.call(Bt,pt)}catch(Ht){et=[6,Ht],K=0}finally{rr=Xt=0}if(et[0]&5)throw et[1];return{value:et[0]?et[1]:void 0,done:!0}}},g=this&&this.__spreadArray||function(Bt,ut){for(var pt=0,rr=ut.length,K=Bt.length;pt<rr;pt++,K++)Bt[K]=ut[pt];return Bt};Object.defineProperty(te,"__esModule",{value:!0}),te.Container=void 0;var Ee=W(44290),H=W(16674),ae=W(28421),le=W(6867),Be=W(51377),ye=W(86311),Je=W(31927),st=W(15451),yt=W(37791),$t=W(55800),tr=W(85700),Mt=W(80175),Qt=function(){function Bt(ut){this._appliedMiddleware=[];var pt=ut||{};if(typeof pt!="object")throw new Error(""+H.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(pt.defaultScope===void 0)pt.defaultScope=ae.BindingScopeEnum.Transient;else if(pt.defaultScope!==ae.BindingScopeEnum.Singleton&&pt.defaultScope!==ae.BindingScopeEnum.Transient&&pt.defaultScope!==ae.BindingScopeEnum.Request)throw new Error(""+H.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(pt.autoBindInjectable===void 0)pt.autoBindInjectable=!1;else if(typeof pt.autoBindInjectable!="boolean")throw new Error(""+H.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(pt.skipBaseClassChecks===void 0)pt.skipBaseClassChecks=!1;else if(typeof pt.skipBaseClassChecks!="boolean")throw new Error(""+H.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:pt.autoBindInjectable,defaultScope:pt.defaultScope,skipBaseClassChecks:pt.skipBaseClassChecks},this.id=yt.id(),this._bindingDictionary=new Mt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new Be.MetadataReader}return Bt.merge=function(ut,pt){for(var rr=[],K=2;K<arguments.length;K++)rr[K-2]=arguments[K];var Xt=new Bt,lt=g([ut,pt],rr).map(function(et){return ye.getBindingDictionary(et)}),$e=ye.getBindingDictionary(Xt);function St(et,Ht){et.traverse(function(Er,kr){kr.forEach(function($r){Ht.add($r.serviceIdentifier,$r.clone())})})}return lt.forEach(function(et){St(et,$e)}),Xt},Bt.prototype.load=function(){for(var ut=[],pt=0;pt<arguments.length;pt++)ut[pt]=arguments[pt];for(var rr=this._getContainerModuleHelpersFactory(),K=0,Xt=ut;K<Xt.length;K++){var lt=Xt[K],$e=rr(lt.id);lt.registry($e.bindFunction,$e.unbindFunction,$e.isboundFunction,$e.rebindFunction)}},Bt.prototype.loadAsync=function(){for(var ut=[],pt=0;pt<arguments.length;pt++)ut[pt]=arguments[pt];return _e(this,void 0,void 0,function(){var rr,K,Xt,lt,$e;return ue(this,function(St){switch(St.label){case 0:rr=this._getContainerModuleHelpersFactory(),K=0,Xt=ut,St.label=1;case 1:return K<Xt.length?(lt=Xt[K],$e=rr(lt.id),[4,lt.registry($e.bindFunction,$e.unbindFunction,$e.isboundFunction,$e.rebindFunction)]):[3,4];case 2:St.sent(),St.label=3;case 3:return K++,[3,1];case 4:return[2]}})})},Bt.prototype.unload=function(){for(var ut=this,pt=[],rr=0;rr<arguments.length;rr++)pt[rr]=arguments[rr];var K=function(Xt){return function(lt){return lt.moduleId===Xt}};pt.forEach(function(Xt){var lt=K(Xt.id);ut._bindingDictionary.removeByCondition(lt)})},Bt.prototype.bind=function(ut){var pt=this.options.defaultScope||ae.BindingScopeEnum.Transient,rr=new Ee.Binding(ut,pt);return this._bindingDictionary.add(ut,rr),new st.BindingToSyntax(rr)},Bt.prototype.rebind=function(ut){return this.unbind(ut),this.bind(ut)},Bt.prototype.unbind=function(ut){try{this._bindingDictionary.remove(ut)}catch(pt){throw new Error(H.CANNOT_UNBIND+" "+$t.getServiceIdentifierAsString(ut))}},Bt.prototype.unbindAll=function(){this._bindingDictionary=new Mt.Lookup},Bt.prototype.isBound=function(ut){var pt=this._bindingDictionary.hasKey(ut);return!pt&&this.parent&&(pt=this.parent.isBound(ut)),pt},Bt.prototype.isBoundNamed=function(ut,pt){return this.isBoundTagged(ut,le.NAMED_TAG,pt)},Bt.prototype.isBoundTagged=function(ut,pt,rr){var K=!1;if(this._bindingDictionary.hasKey(ut)){var Xt=this._bindingDictionary.get(ut),lt=ye.createMockRequest(this,ut,pt,rr);K=Xt.some(function($e){return $e.constraint(lt)})}return!K&&this.parent&&(K=this.parent.isBoundTagged(ut,pt,rr)),K},Bt.prototype.snapshot=function(){this._snapshots.push(tr.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},Bt.prototype.restore=function(){var ut=this._snapshots.pop();if(ut===void 0)throw new Error(H.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=ut.bindings,this._middleware=ut.middleware},Bt.prototype.createChild=function(ut){var pt=new Bt(ut||this.options);return pt.parent=this,pt},Bt.prototype.applyMiddleware=function(){for(var ut=[],pt=0;pt<arguments.length;pt++)ut[pt]=arguments[pt];this._appliedMiddleware=this._appliedMiddleware.concat(ut);var rr=this._middleware?this._middleware:this._planAndResolve();this._middleware=ut.reduce(function(K,Xt){return Xt(K)},rr)},Bt.prototype.applyCustomMetadataReader=function(ut){this._metadataReader=ut},Bt.prototype.get=function(ut){return this._get(!1,!1,ae.TargetTypeEnum.Variable,ut)},Bt.prototype.getTagged=function(ut,pt,rr){return this._get(!1,!1,ae.TargetTypeEnum.Variable,ut,pt,rr)},Bt.prototype.getNamed=function(ut,pt){return this.getTagged(ut,le.NAMED_TAG,pt)},Bt.prototype.getAll=function(ut){return this._get(!0,!0,ae.TargetTypeEnum.Variable,ut)},Bt.prototype.getAllTagged=function(ut,pt,rr){return this._get(!1,!0,ae.TargetTypeEnum.Variable,ut,pt,rr)},Bt.prototype.getAllNamed=function(ut,pt){return this.getAllTagged(ut,le.NAMED_TAG,pt)},Bt.prototype.resolve=function(ut){var pt=this.createChild();return pt.bind(ut).toSelf(),this._appliedMiddleware.forEach(function(rr){pt.applyMiddleware(rr)}),pt.get(ut)},Bt.prototype._getContainerModuleHelpersFactory=function(){var ut=this,pt=function($e,St){$e._binding.moduleId=St},rr=function($e){return function(St){var et=ut.bind.bind(ut),Ht=et(St);return pt(Ht,$e),Ht}},K=function($e){return function(St){var et=ut.unbind.bind(ut);et(St)}},Xt=function($e){return function(St){var et=ut.isBound.bind(ut);return et(St)}},lt=function($e){return function(St){var et=ut.rebind.bind(ut),Ht=et(St);return pt(Ht,$e),Ht}};return function($e){return{bindFunction:rr($e),isboundFunction:Xt($e),rebindFunction:lt($e),unbindFunction:K($e)}}},Bt.prototype._get=function(ut,pt,rr,K,Xt,lt){var $e=null,St={avoidConstraints:ut,contextInterceptor:function(et){return et},isMultiInject:pt,key:Xt,serviceIdentifier:K,targetType:rr,value:lt};if(this._middleware){if($e=this._middleware(St),$e==null)throw new Error(H.INVALID_MIDDLEWARE_RETURN)}else $e=this._planAndResolve()(St);return $e},Bt.prototype._planAndResolve=function(){var ut=this;return function(pt){var rr=ye.plan(ut._metadataReader,ut,pt.isMultiInject,pt.targetType,pt.serviceIdentifier,pt.key,pt.value,pt.avoidConstraints);rr=pt.contextInterceptor(rr);var K=Je.resolve(rr);return K}},Bt}();te.Container=Qt},33244:function(Jt,te,W){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.AsyncContainerModule=te.ContainerModule=void 0;var _e=W(37791),ue=function(){function Ee(H){this.id=_e.id(),this.registry=H}return Ee}();te.ContainerModule=ue;var g=function(){function Ee(H){this.id=_e.id(),this.registry=H}return Ee}();te.AsyncContainerModule=g},85700:function(Jt,te){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.ContainerSnapshot=void 0;var W=function(){function _e(){}return _e.of=function(ue,g){var Ee=new _e;return Ee.bindings=ue,Ee.middleware=g,Ee},_e}();te.ContainerSnapshot=W},80175:function(Jt,te,W){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.Lookup=void 0;var _e=W(16674),ue=function(){function g(){this._map=new Map}return g.prototype.getMap=function(){return this._map},g.prototype.add=function(Ee,H){if(Ee==null)throw new Error(_e.NULL_ARGUMENT);if(H==null)throw new Error(_e.NULL_ARGUMENT);var ae=this._map.get(Ee);ae!==void 0?(ae.push(H),this._map.set(Ee,ae)):this._map.set(Ee,[H])},g.prototype.get=function(Ee){if(Ee==null)throw new Error(_e.NULL_ARGUMENT);var H=this._map.get(Ee);if(H!==void 0)return H;throw new Error(_e.KEY_NOT_FOUND)},g.prototype.remove=function(Ee){if(Ee==null)throw new Error(_e.NULL_ARGUMENT);if(!this._map.delete(Ee))throw new Error(_e.KEY_NOT_FOUND)},g.prototype.removeByCondition=function(Ee){var H=this;this._map.forEach(function(ae,le){var Be=ae.filter(function(ye){return!Ee(ye)});Be.length>0?H._map.set(le,Be):H._map.delete(le)})},g.prototype.hasKey=function(Ee){if(Ee==null)throw new Error(_e.NULL_ARGUMENT);return this._map.has(Ee)},g.prototype.clone=function(){var Ee=new g;return this._map.forEach(function(H,ae){H.forEach(function(le){return Ee.add(ae,le.clone())})}),Ee},g.prototype.traverse=function(Ee){this._map.forEach(function(H,ae){Ee(ae,H)})},g}();te.Lookup=ue},86700:function(Jt,te,W){"use strict";var _e;_e={value:!0},_e=_e=_e=_e=_e=_e=te.GW=_e=_e=te.zY=_e=_e=_e=_e=_e=te.f3=_e=_e=te.b2=_e=_e=_e=_e=_e=te.W2=_e=void 0;var ue=W(6867);_e=ue;var g=W(51389);Object.defineProperty(te,"W2",{enumerable:!0,get:function(){return g.Container}});var Ee=W(28421);_e={enumerable:!0,get:function(){return Ee.BindingScopeEnum}},_e={enumerable:!0,get:function(){return Ee.BindingTypeEnum}},_e={enumerable:!0,get:function(){return Ee.TargetTypeEnum}};var H=W(33244);_e={enumerable:!0,get:function(){return H.AsyncContainerModule}},_e={enumerable:!0,get:function(){return H.ContainerModule}};var ae=W(64315);Object.defineProperty(te,"b2",{enumerable:!0,get:function(){return ae.injectable}});var le=W(32052);_e={enumerable:!0,get:function(){return le.tagged}};var Be=W(38085);_e={enumerable:!0,get:function(){return Be.named}};var ye=W(5744);Object.defineProperty(te,"f3",{enumerable:!0,get:function(){return ye.inject}}),_e={enumerable:!0,get:function(){return ye.LazyServiceIdentifer}};var Je=W(6515);_e={enumerable:!0,get:function(){return Je.optional}};var st=W(86757);_e={enumerable:!0,get:function(){return st.unmanaged}};var yt=W(71693);_e={enumerable:!0,get:function(){return yt.multiInject}};var $t=W(55638);_e={enumerable:!0,get:function(){return $t.targetName}};var tr=W(7014);Object.defineProperty(te,"zY",{enumerable:!0,get:function(){return tr.postConstruct}});var Mt=W(51377);_e={enumerable:!0,get:function(){return Mt.MetadataReader}};var Qt=W(37791);_e={enumerable:!0,get:function(){return Qt.id}};var Bt=W(99934);Object.defineProperty(te,"GW",{enumerable:!0,get:function(){return Bt.decorate}});var ut=W(80758);_e={enumerable:!0,get:function(){return ut.traverseAncerstors}},_e={enumerable:!0,get:function(){return ut.taggedConstraint}},_e={enumerable:!0,get:function(){return ut.namedConstraint}},_e={enumerable:!0,get:function(){return ut.typeConstraint}};var pt=W(55800);_e={enumerable:!0,get:function(){return pt.getServiceIdentifierAsString}};var rr=W(70600);_e={enumerable:!0,get:function(){return rr.multiBindToService}}},95228:function(Jt,te,W){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.Context=void 0;var _e=W(37791),ue=function(){function g(Ee){this.id=_e.id(),this.container=Ee}return g.prototype.addPlan=function(Ee){this.plan=Ee},g.prototype.setCurrentRequest=function(Ee){this.currentRequest=Ee},g}();te.Context=ue},47738:function(Jt,te,W){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.Metadata=void 0;var _e=W(6867),ue=function(){function g(Ee,H){this.key=Ee,this.value=H}return g.prototype.toString=function(){return this.key===_e.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},g}();te.Metadata=ue},51377:function(Jt,te,W){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.MetadataReader=void 0;var _e=W(6867),ue=function(){function g(){}return g.prototype.getConstructorMetadata=function(Ee){var H=Reflect.getMetadata(_e.PARAM_TYPES,Ee),ae=Reflect.getMetadata(_e.TAGGED,Ee);return{compilerGeneratedMetadata:H,userGeneratedMetadata:ae||{}}},g.prototype.getPropertiesMetadata=function(Ee){var H=Reflect.getMetadata(_e.TAGGED_PROP,Ee)||[];return H},g}();te.MetadataReader=ue},55314:function(Jt,te){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.Plan=void 0;var W=function(){function _e(ue,g){this.parentContext=ue,this.rootRequest=g}return _e}();te.Plan=W},86311:function(Jt,te,W){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.getBindingDictionary=te.createMockRequest=te.plan=void 0;var _e=W(23184),ue=W(16674),g=W(28421),Ee=W(6867),H=W(85265),ae=W(55800),le=W(95228),Be=W(47738),ye=W(55314),Je=W(6e3),st=W(6748),yt=W(18924);function $t(K){return K._bindingDictionary}te.getBindingDictionary=$t;function tr(K,Xt,lt,$e,St,et){var Ht=K?Ee.MULTI_INJECT_TAG:Ee.INJECT_TAG,Er=new Be.Metadata(Ht,lt),kr=new yt.Target(Xt,$e,lt,Er);if(St!==void 0){var $r=new Be.Metadata(St,et);kr.metadata.push($r)}return kr}function Mt(K,Xt,lt,$e,St){var et=ut(lt.container,St.serviceIdentifier),Ht=[];return et.length===_e.BindingCount.NoBindingsAvailable&&lt.container.options.autoBindInjectable&&typeof St.serviceIdentifier=="function"&&K.getConstructorMetadata(St.serviceIdentifier).compilerGeneratedMetadata&&(lt.container.bind(St.serviceIdentifier).toSelf(),et=ut(lt.container,St.serviceIdentifier)),Xt?Ht=et:Ht=et.filter(function(Er){var kr=new st.Request(Er.serviceIdentifier,lt,$e,Er,St);return Er.constraint(kr)}),Qt(St.serviceIdentifier,Ht,St,lt.container),Ht}function Qt(K,Xt,lt,$e){switch(Xt.length){case _e.BindingCount.NoBindingsAvailable:if(lt.isOptional())return Xt;var St=ae.getServiceIdentifierAsString(K),et=ue.NOT_REGISTERED;throw et+=ae.listMetadataForTarget(St,lt),et+=ae.listRegisteredBindingsForServiceIdentifier($e,St,ut),new Error(et);case _e.BindingCount.OnlyOneBindingAvailable:if(!lt.isArray())return Xt;case _e.BindingCount.MultipleBindingsAvailable:default:if(lt.isArray())return Xt;var St=ae.getServiceIdentifierAsString(K),et=ue.AMBIGUOUS_MATCH+" "+St;throw et+=ae.listRegisteredBindingsForServiceIdentifier($e,St,ut),new Error(et)}}function Bt(K,Xt,lt,$e,St,et){var Ht,Er;if(St===null){Ht=Mt(K,Xt,$e,null,et),Er=new st.Request(lt,$e,null,Ht,et);var kr=new ye.Plan($e,Er);$e.addPlan(kr)}else Ht=Mt(K,Xt,$e,St,et),Er=St.addChildRequest(et.serviceIdentifier,Ht,et);Ht.forEach(function($r){var S=null;if(et.isArray())S=Er.addChildRequest($r.serviceIdentifier,$r,et);else{if($r.cache)return;S=Er}if($r.type===g.BindingTypeEnum.Instance&&$r.implementationType!==null){var pe=Je.getDependencies(K,$r.implementationType);if(!$e.container.options.skipBaseClassChecks){var he=Je.getBaseClassDependencyCount(K,$r.implementationType);if(pe.length<he){var He=ue.ARGUMENTS_LENGTH_MISMATCH(Je.getFunctionName($r.implementationType));throw new Error(He)}}pe.forEach(function(Ke){Bt(K,!1,Ke.serviceIdentifier,$e,S,Ke)})}})}function ut(K,Xt){var lt=[],$e=$t(K);return $e.hasKey(Xt)?lt=$e.get(Xt):K.parent!==null&&(lt=ut(K.parent,Xt)),lt}function pt(K,Xt,lt,$e,St,et,Ht,Er){Er===void 0&&(Er=!1);var kr=new le.Context(Xt),$r=tr(lt,$e,St,"",et,Ht);try{return Bt(K,Er,St,kr,null,$r),kr}catch(S){throw H.isStackOverflowExeption(S)&&kr.plan&&ae.circularDependencyToException(kr.plan.rootRequest),S}}te.plan=pt;function rr(K,Xt,lt,$e){var St=new yt.Target(g.TargetTypeEnum.Variable,"",Xt,new Be.Metadata(lt,$e)),et=new le.Context(K),Ht=new st.Request(Xt,et,null,[],St);return Ht}te.createMockRequest=rr},88460:function(Jt,te){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.QueryableString=void 0;var W=function(){function _e(ue){this.str=ue}return _e.prototype.startsWith=function(ue){return this.str.indexOf(ue)===0},_e.prototype.endsWith=function(ue){var g="",Ee=ue.split("").reverse().join("");return g=this.str.split("").reverse().join(""),this.startsWith.call({str:g},Ee)},_e.prototype.contains=function(ue){return this.str.indexOf(ue)!==-1},_e.prototype.equals=function(ue){return this.str===ue},_e.prototype.value=function(){return this.str},_e}();te.QueryableString=W},6e3:function(Jt,te,W){"use strict";var _e=this&&this.__spreadArray||function(Mt,Qt){for(var Bt=0,ut=Qt.length,pt=Mt.length;Bt<ut;Bt++,pt++)Mt[pt]=Qt[Bt];return Mt};Object.defineProperty(te,"__esModule",{value:!0}),te.getFunctionName=te.getBaseClassDependencyCount=te.getDependencies=void 0;var ue=W(5744),g=W(16674),Ee=W(28421),H=W(6867),ae=W(55800);Object.defineProperty(te,"getFunctionName",{enumerable:!0,get:function(){return ae.getFunctionName}});var le=W(18924);function Be(Mt,Qt){var Bt=ae.getFunctionName(Qt),ut=ye(Mt,Bt,Qt,!1);return ut}te.getDependencies=Be;function ye(Mt,Qt,Bt,ut){var pt=Mt.getConstructorMetadata(Bt),rr=pt.compilerGeneratedMetadata;if(rr===void 0){var K=g.MISSING_INJECTABLE_ANNOTATION+" "+Qt+".";throw new Error(K)}var Xt=pt.userGeneratedMetadata,lt=Object.keys(Xt),$e=Bt.length===0&&lt.length>0,St=lt.length>Bt.length,et=$e||St?lt.length:Bt.length,Ht=st(ut,Qt,rr,Xt,et),Er=yt(Mt,Bt),kr=_e(_e([],Ht),Er);return kr}function Je(Mt,Qt,Bt,ut,pt){var rr=pt[Mt.toString()]||[],K=tr(rr),Xt=K.unmanaged!==!0,lt=ut[Mt],$e=K.inject||K.multiInject;if(lt=$e||lt,lt instanceof ue.LazyServiceIdentifer&&(lt=lt.unwrap()),Xt){var St=lt===Object,et=lt===Function,Ht=lt===void 0,Er=St||et||Ht;if(!Qt&&Er){var kr=g.MISSING_INJECT_ANNOTATION+" argument "+Mt+" in class "+Bt+".";throw new Error(kr)}var $r=new le.Target(Ee.TargetTypeEnum.ConstructorArgument,K.targetName,lt);return $r.metadata=rr,$r}return null}function st(Mt,Qt,Bt,ut,pt){for(var rr=[],K=0;K<pt;K++){var Xt=K,lt=Je(Xt,Mt,Qt,Bt,ut);lt!==null&&rr.push(lt)}return rr}function yt(Mt,Qt){for(var Bt=Mt.getPropertiesMetadata(Qt),ut=[],pt=Object.keys(Bt),rr=0,K=pt;rr<K.length;rr++){var Xt=K[rr],lt=Bt[Xt],$e=tr(Bt[Xt]),St=$e.targetName||Xt,et=$e.inject||$e.multiInject,Ht=new le.Target(Ee.TargetTypeEnum.ClassProperty,St,et);Ht.metadata=lt,ut.push(Ht)}var Er=Object.getPrototypeOf(Qt.prototype).constructor;if(Er!==Object){var kr=yt(Mt,Er);ut=_e(_e([],ut),kr)}return ut}function $t(Mt,Qt){var Bt=Object.getPrototypeOf(Qt.prototype).constructor;if(Bt!==Object){var ut=ae.getFunctionName(Bt),pt=ye(Mt,ut,Bt,!0),rr=pt.map(function(lt){return lt.metadata.filter(function($e){return $e.key===H.UNMANAGED_TAG})}),K=[].concat.apply([],rr).length,Xt=pt.length-K;return Xt>0?Xt:$t(Mt,Bt)}else return 0}te.getBaseClassDependencyCount=$t;function tr(Mt){var Qt={};return Mt.forEach(function(Bt){Qt[Bt.key.toString()]=Bt.value}),{inject:Qt[H.INJECT_TAG],multiInject:Qt[H.MULTI_INJECT_TAG],targetName:Qt[H.NAME_TAG],unmanaged:Qt[H.UNMANAGED_TAG]}}},6748:function(Jt,te,W){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.Request=void 0;var _e=W(37791),ue=function(){function g(Ee,H,ae,le,Be){this.id=_e.id(),this.serviceIdentifier=Ee,this.parentContext=H,this.parentRequest=ae,this.target=Be,this.childRequests=[],this.bindings=Array.isArray(le)?le:[le],this.requestScope=ae===null?new Map:null}return g.prototype.addChildRequest=function(Ee,H,ae){var le=new g(Ee,this.parentContext,this,H,ae);return this.childRequests.push(le),le},g}();te.Request=ue},18924:function(Jt,te,W){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.Target=void 0;var _e=W(6867),ue=W(37791),g=W(47738),Ee=W(88460),H=function(){function ae(le,Be,ye,Je){this.id=ue.id(),this.type=le,this.serviceIdentifier=ye,this.name=new Ee.QueryableString(Be||""),this.metadata=new Array;var st=null;typeof Je=="string"?st=new g.Metadata(_e.NAMED_TAG,Je):Je instanceof g.Metadata&&(st=Je),st!==null&&this.metadata.push(st)}return ae.prototype.hasTag=function(le){for(var Be=0,ye=this.metadata;Be<ye.length;Be++){var Je=ye[Be];if(Je.key===le)return!0}return!1},ae.prototype.isArray=function(){return this.hasTag(_e.MULTI_INJECT_TAG)},ae.prototype.matchesArray=function(le){return this.matchesTag(_e.MULTI_INJECT_TAG)(le)},ae.prototype.isNamed=function(){return this.hasTag(_e.NAMED_TAG)},ae.prototype.isTagged=function(){return this.metadata.some(function(le){return _e.NON_CUSTOM_TAG_KEYS.every(function(Be){return le.key!==Be})})},ae.prototype.isOptional=function(){return this.matchesTag(_e.OPTIONAL_TAG)(!0)},ae.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(le){return le.key===_e.NAMED_TAG})[0]:null},ae.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(le){return _e.NON_CUSTOM_TAG_KEYS.every(function(Be){return le.key!==Be})}):null},ae.prototype.matchesNamedTag=function(le){return this.matchesTag(_e.NAMED_TAG)(le)},ae.prototype.matchesTag=function(le){var Be=this;return function(ye){for(var Je=0,st=Be.metadata;Je<st.length;Je++){var yt=st[Je];if(yt.key===le&&yt.value===ye)return!0}return!1}},ae}();te.Target=H},52279:function(Jt,te,W){"use strict";var _e=this&&this.__spreadArray||function(ye,Je){for(var st=0,yt=Je.length,$t=ye.length;st<yt;st++,$t++)ye[$t]=Je[st];return ye};Object.defineProperty(te,"__esModule",{value:!0}),te.resolveInstance=void 0;var ue=W(16674),g=W(28421),Ee=W(6867);function H(ye,Je,st){var yt=Je.filter(function(tr){return tr.target!==null&&tr.target.type===g.TargetTypeEnum.ClassProperty}),$t=yt.map(st);return yt.forEach(function(tr,Mt){var Qt="";Qt=tr.target.name.value();var Bt=$t[Mt];ye[Qt]=Bt}),ye}function ae(ye,Je){return new(ye.bind.apply(ye,_e([void 0],Je)))}function le(ye,Je){if(Reflect.hasMetadata(Ee.POST_CONSTRUCT,ye)){var st=Reflect.getMetadata(Ee.POST_CONSTRUCT,ye);try{Je[st.value]()}catch(yt){throw new Error(ue.POST_CONSTRUCT_ERROR(ye.name,yt.message))}}}function Be(ye,Je,st){var yt=null;if(Je.length>0){var $t=Je.filter(function(Mt){return Mt.target!==null&&Mt.target.type===g.TargetTypeEnum.ConstructorArgument}),tr=$t.map(st);yt=ae(ye,tr),yt=H(yt,Je,st)}else yt=new ye;return le(ye,yt),yt}te.resolveInstance=Be},31927:function(Jt,te,W){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.resolve=void 0;var _e=W(16674),ue=W(28421),g=W(85265),Ee=W(55800),H=W(52279),ae=function(ye,Je,st){try{return st()}catch(yt){throw g.isStackOverflowExeption(yt)?new Error(_e.CIRCULAR_DEPENDENCY_IN_FACTORY(ye,Je.toString())):yt}},le=function(ye){return function(Je){Je.parentContext.setCurrentRequest(Je);var st=Je.bindings,yt=Je.childRequests,$t=Je.target&&Je.target.isArray(),tr=!Je.parentRequest||!Je.parentRequest.target||!Je.target||!Je.parentRequest.target.matchesArray(Je.target.serviceIdentifier);if($t&&tr)return yt.map(function(rr){var K=le(ye);return K(rr)});var Mt=null;if(Je.target.isOptional()&&st.length===0)return;var Qt=st[0],Bt=Qt.scope===ue.BindingScopeEnum.Singleton,ut=Qt.scope===ue.BindingScopeEnum.Request;if(Bt&&Qt.activated)return Qt.cache;if(ut&&ye!==null&&ye.has(Qt.id))return ye.get(Qt.id);if(Qt.type===ue.BindingTypeEnum.ConstantValue)Mt=Qt.cache,Qt.activated=!0;else if(Qt.type===ue.BindingTypeEnum.Function)Mt=Qt.cache,Qt.activated=!0;else if(Qt.type===ue.BindingTypeEnum.Constructor)Mt=Qt.implementationType;else if(Qt.type===ue.BindingTypeEnum.DynamicValue&&Qt.dynamicValue!==null)Mt=ae("toDynamicValue",Qt.serviceIdentifier,function(){return Qt.dynamicValue(Je.parentContext)});else if(Qt.type===ue.BindingTypeEnum.Factory&&Qt.factory!==null)Mt=ae("toFactory",Qt.serviceIdentifier,function(){return Qt.factory(Je.parentContext)});else if(Qt.type===ue.BindingTypeEnum.Provider&&Qt.provider!==null)Mt=ae("toProvider",Qt.serviceIdentifier,function(){return Qt.provider(Je.parentContext)});else if(Qt.type===ue.BindingTypeEnum.Instance&&Qt.implementationType!==null)Mt=H.resolveInstance(Qt.implementationType,yt,le(ye));else{var pt=Ee.getServiceIdentifierAsString(Je.serviceIdentifier);throw new Error(_e.INVALID_BINDING_TYPE+" "+pt)}return typeof Qt.onActivation=="function"&&(Mt=Qt.onActivation(Je.parentContext,Mt)),Bt&&(Qt.cache=Mt,Qt.activated=!0),ut&&ye!==null&&!ye.has(Qt.id)&&ye.set(Qt.id,Mt),Mt}};function Be(ye){var Je=le(ye.plan.rootRequest.requestScope);return Je(ye.plan.rootRequest)}te.resolve=Be},83366:function(Jt,te,W){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.BindingInSyntax=void 0;var _e=W(28421),ue=W(71325),g=function(){function Ee(H){this._binding=H}return Ee.prototype.inRequestScope=function(){return this._binding.scope=_e.BindingScopeEnum.Request,new ue.BindingWhenOnSyntax(this._binding)},Ee.prototype.inSingletonScope=function(){return this._binding.scope=_e.BindingScopeEnum.Singleton,new ue.BindingWhenOnSyntax(this._binding)},Ee.prototype.inTransientScope=function(){return this._binding.scope=_e.BindingScopeEnum.Transient,new ue.BindingWhenOnSyntax(this._binding)},Ee}();te.BindingInSyntax=g},74889:function(Jt,te,W){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.BindingInWhenOnSyntax=void 0;var _e=W(83366),ue=W(51811),g=W(98370),Ee=function(){function H(ae){this._binding=ae,this._bindingWhenSyntax=new g.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new ue.BindingOnSyntax(this._binding),this._bindingInSyntax=new _e.BindingInSyntax(ae)}return H.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},H.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},H.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},H.prototype.when=function(ae){return this._bindingWhenSyntax.when(ae)},H.prototype.whenTargetNamed=function(ae){return this._bindingWhenSyntax.whenTargetNamed(ae)},H.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},H.prototype.whenTargetTagged=function(ae,le){return this._bindingWhenSyntax.whenTargetTagged(ae,le)},H.prototype.whenInjectedInto=function(ae){return this._bindingWhenSyntax.whenInjectedInto(ae)},H.prototype.whenParentNamed=function(ae){return this._bindingWhenSyntax.whenParentNamed(ae)},H.prototype.whenParentTagged=function(ae,le){return this._bindingWhenSyntax.whenParentTagged(ae,le)},H.prototype.whenAnyAncestorIs=function(ae){return this._bindingWhenSyntax.whenAnyAncestorIs(ae)},H.prototype.whenNoAncestorIs=function(ae){return this._bindingWhenSyntax.whenNoAncestorIs(ae)},H.prototype.whenAnyAncestorNamed=function(ae){return this._bindingWhenSyntax.whenAnyAncestorNamed(ae)},H.prototype.whenAnyAncestorTagged=function(ae,le){return this._bindingWhenSyntax.whenAnyAncestorTagged(ae,le)},H.prototype.whenNoAncestorNamed=function(ae){return this._bindingWhenSyntax.whenNoAncestorNamed(ae)},H.prototype.whenNoAncestorTagged=function(ae,le){return this._bindingWhenSyntax.whenNoAncestorTagged(ae,le)},H.prototype.whenAnyAncestorMatches=function(ae){return this._bindingWhenSyntax.whenAnyAncestorMatches(ae)},H.prototype.whenNoAncestorMatches=function(ae){return this._bindingWhenSyntax.whenNoAncestorMatches(ae)},H.prototype.onActivation=function(ae){return this._bindingOnSyntax.onActivation(ae)},H}();te.BindingInWhenOnSyntax=Ee},51811:function(Jt,te,W){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.BindingOnSyntax=void 0;var _e=W(98370),ue=function(){function g(Ee){this._binding=Ee}return g.prototype.onActivation=function(Ee){return this._binding.onActivation=Ee,new _e.BindingWhenSyntax(this._binding)},g}();te.BindingOnSyntax=ue},15451:function(Jt,te,W){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.BindingToSyntax=void 0;var _e=W(16674),ue=W(28421),g=W(74889),Ee=W(71325),H=function(){function ae(le){this._binding=le}return ae.prototype.to=function(le){return this._binding.type=ue.BindingTypeEnum.Instance,this._binding.implementationType=le,new g.BindingInWhenOnSyntax(this._binding)},ae.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+_e.INVALID_TO_SELF_VALUE);var le=this._binding.serviceIdentifier;return this.to(le)},ae.prototype.toConstantValue=function(le){return this._binding.type=ue.BindingTypeEnum.ConstantValue,this._binding.cache=le,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=ue.BindingScopeEnum.Singleton,new Ee.BindingWhenOnSyntax(this._binding)},ae.prototype.toDynamicValue=function(le){return this._binding.type=ue.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=le,this._binding.implementationType=null,new g.BindingInWhenOnSyntax(this._binding)},ae.prototype.toConstructor=function(le){return this._binding.type=ue.BindingTypeEnum.Constructor,this._binding.implementationType=le,this._binding.scope=ue.BindingScopeEnum.Singleton,new Ee.BindingWhenOnSyntax(this._binding)},ae.prototype.toFactory=function(le){return this._binding.type=ue.BindingTypeEnum.Factory,this._binding.factory=le,this._binding.scope=ue.BindingScopeEnum.Singleton,new Ee.BindingWhenOnSyntax(this._binding)},ae.prototype.toFunction=function(le){if(typeof le!="function")throw new Error(_e.INVALID_FUNCTION_BINDING);var Be=this.toConstantValue(le);return this._binding.type=ue.BindingTypeEnum.Function,this._binding.scope=ue.BindingScopeEnum.Singleton,Be},ae.prototype.toAutoFactory=function(le){return this._binding.type=ue.BindingTypeEnum.Factory,this._binding.factory=function(Be){var ye=function(){return Be.container.get(le)};return ye},this._binding.scope=ue.BindingScopeEnum.Singleton,new Ee.BindingWhenOnSyntax(this._binding)},ae.prototype.toProvider=function(le){return this._binding.type=ue.BindingTypeEnum.Provider,this._binding.provider=le,this._binding.scope=ue.BindingScopeEnum.Singleton,new Ee.BindingWhenOnSyntax(this._binding)},ae.prototype.toService=function(le){this.toDynamicValue(function(Be){return Be.container.get(le)})},ae}();te.BindingToSyntax=H},71325:function(Jt,te,W){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.BindingWhenOnSyntax=void 0;var _e=W(51811),ue=W(98370),g=function(){function Ee(H){this._binding=H,this._bindingWhenSyntax=new ue.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new _e.BindingOnSyntax(this._binding)}return Ee.prototype.when=function(H){return this._bindingWhenSyntax.when(H)},Ee.prototype.whenTargetNamed=function(H){return this._bindingWhenSyntax.whenTargetNamed(H)},Ee.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},Ee.prototype.whenTargetTagged=function(H,ae){return this._bindingWhenSyntax.whenTargetTagged(H,ae)},Ee.prototype.whenInjectedInto=function(H){return this._bindingWhenSyntax.whenInjectedInto(H)},Ee.prototype.whenParentNamed=function(H){return this._bindingWhenSyntax.whenParentNamed(H)},Ee.prototype.whenParentTagged=function(H,ae){return this._bindingWhenSyntax.whenParentTagged(H,ae)},Ee.prototype.whenAnyAncestorIs=function(H){return this._bindingWhenSyntax.whenAnyAncestorIs(H)},Ee.prototype.whenNoAncestorIs=function(H){return this._bindingWhenSyntax.whenNoAncestorIs(H)},Ee.prototype.whenAnyAncestorNamed=function(H){return this._bindingWhenSyntax.whenAnyAncestorNamed(H)},Ee.prototype.whenAnyAncestorTagged=function(H,ae){return this._bindingWhenSyntax.whenAnyAncestorTagged(H,ae)},Ee.prototype.whenNoAncestorNamed=function(H){return this._bindingWhenSyntax.whenNoAncestorNamed(H)},Ee.prototype.whenNoAncestorTagged=function(H,ae){return this._bindingWhenSyntax.whenNoAncestorTagged(H,ae)},Ee.prototype.whenAnyAncestorMatches=function(H){return this._bindingWhenSyntax.whenAnyAncestorMatches(H)},Ee.prototype.whenNoAncestorMatches=function(H){return this._bindingWhenSyntax.whenNoAncestorMatches(H)},Ee.prototype.onActivation=function(H){return this._bindingOnSyntax.onActivation(H)},Ee}();te.BindingWhenOnSyntax=g},98370:function(Jt,te,W){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.BindingWhenSyntax=void 0;var _e=W(51811),ue=W(80758),g=function(){function Ee(H){this._binding=H}return Ee.prototype.when=function(H){return this._binding.constraint=H,new _e.BindingOnSyntax(this._binding)},Ee.prototype.whenTargetNamed=function(H){return this._binding.constraint=ue.namedConstraint(H),new _e.BindingOnSyntax(this._binding)},Ee.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(H){var ae=H.target!==null&&!H.target.isNamed()&&!H.target.isTagged();return ae},new _e.BindingOnSyntax(this._binding)},Ee.prototype.whenTargetTagged=function(H,ae){return this._binding.constraint=ue.taggedConstraint(H)(ae),new _e.BindingOnSyntax(this._binding)},Ee.prototype.whenInjectedInto=function(H){return this._binding.constraint=function(ae){return ue.typeConstraint(H)(ae.parentRequest)},new _e.BindingOnSyntax(this._binding)},Ee.prototype.whenParentNamed=function(H){return this._binding.constraint=function(ae){return ue.namedConstraint(H)(ae.parentRequest)},new _e.BindingOnSyntax(this._binding)},Ee.prototype.whenParentTagged=function(H,ae){return this._binding.constraint=function(le){return ue.taggedConstraint(H)(ae)(le.parentRequest)},new _e.BindingOnSyntax(this._binding)},Ee.prototype.whenAnyAncestorIs=function(H){return this._binding.constraint=function(ae){return ue.traverseAncerstors(ae,ue.typeConstraint(H))},new _e.BindingOnSyntax(this._binding)},Ee.prototype.whenNoAncestorIs=function(H){return this._binding.constraint=function(ae){return!ue.traverseAncerstors(ae,ue.typeConstraint(H))},new _e.BindingOnSyntax(this._binding)},Ee.prototype.whenAnyAncestorNamed=function(H){return this._binding.constraint=function(ae){return ue.traverseAncerstors(ae,ue.namedConstraint(H))},new _e.BindingOnSyntax(this._binding)},Ee.prototype.whenNoAncestorNamed=function(H){return this._binding.constraint=function(ae){return!ue.traverseAncerstors(ae,ue.namedConstraint(H))},new _e.BindingOnSyntax(this._binding)},Ee.prototype.whenAnyAncestorTagged=function(H,ae){return this._binding.constraint=function(le){return ue.traverseAncerstors(le,ue.taggedConstraint(H)(ae))},new _e.BindingOnSyntax(this._binding)},Ee.prototype.whenNoAncestorTagged=function(H,ae){return this._binding.constraint=function(le){return!ue.traverseAncerstors(le,ue.taggedConstraint(H)(ae))},new _e.BindingOnSyntax(this._binding)},Ee.prototype.whenAnyAncestorMatches=function(H){return this._binding.constraint=function(ae){return ue.traverseAncerstors(ae,H)},new _e.BindingOnSyntax(this._binding)},Ee.prototype.whenNoAncestorMatches=function(H){return this._binding.constraint=function(ae){return!ue.traverseAncerstors(ae,H)},new _e.BindingOnSyntax(this._binding)},Ee}();te.BindingWhenSyntax=g},80758:function(Jt,te,W){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.typeConstraint=te.namedConstraint=te.taggedConstraint=te.traverseAncerstors=void 0;var _e=W(6867),ue=W(47738),g=function(le,Be){var ye=le.parentRequest;return ye!==null?Be(ye)?!0:g(ye,Be):!1};te.traverseAncerstors=g;var Ee=function(le){return function(Be){var ye=function(Je){return Je!==null&&Je.target!==null&&Je.target.matchesTag(le)(Be)};return ye.metaData=new ue.Metadata(le,Be),ye}};te.taggedConstraint=Ee;var H=Ee(_e.NAMED_TAG);te.namedConstraint=H;var ae=function(le){return function(Be){var ye=null;if(Be!==null)if(ye=Be.bindings[0],typeof le=="string"){var Je=ye.serviceIdentifier;return Je===le}else{var st=Be.bindings[0].implementationType;return le===st}return!1}};te.typeConstraint=ae},70600:function(Jt,te){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.multiBindToService=void 0;var W=function(_e){return function(ue){return function(){for(var g=[],Ee=0;Ee<arguments.length;Ee++)g[Ee]=arguments[Ee];return g.forEach(function(H){return _e.bind(H).toService(ue)})}}};te.multiBindToService=W},85265:function(Jt,te,W){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.isStackOverflowExeption=void 0;var _e=W(16674);function ue(g){return g instanceof RangeError||g.message===_e.STACK_OVERFLOW}te.isStackOverflowExeption=ue},37791:function(Jt,te){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.id=void 0;var W=0;function _e(){return W++}te.id=_e},55800:function(Jt,te,W){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.circularDependencyToException=te.listMetadataForTarget=te.listRegisteredBindingsForServiceIdentifier=te.getServiceIdentifierAsString=te.getFunctionName=void 0;var _e=W(16674);function ue(ye){if(typeof ye=="function"){var Je=ye;return Je.name}else{if(typeof ye=="symbol")return ye.toString();var Je=ye;return Je}}te.getServiceIdentifierAsString=ue;function g(ye,Je,st){var yt="",$t=st(ye,Je);return $t.length!==0&&(yt=`
Registered bindings:`,$t.forEach(function(tr){var Mt="Object";tr.implementationType!==null&&(Mt=Be(tr.implementationType)),yt=yt+`
 `+Mt,tr.constraint.metaData&&(yt=yt+" - "+tr.constraint.metaData)})),yt}te.listRegisteredBindingsForServiceIdentifier=g;function Ee(ye,Je){return ye.parentRequest===null?!1:ye.parentRequest.serviceIdentifier===Je?!0:Ee(ye.parentRequest,Je)}function H(ye){function Je(yt,$t){$t===void 0&&($t=[]);var tr=ue(yt.serviceIdentifier);return $t.push(tr),yt.parentRequest!==null?Je(yt.parentRequest,$t):$t}var st=Je(ye);return st.reverse().join(" --> ")}function ae(ye){ye.childRequests.forEach(function(Je){if(Ee(Je,Je.serviceIdentifier)){var st=H(Je);throw new Error(_e.CIRCULAR_DEPENDENCY+" "+st)}else ae(Je)})}te.circularDependencyToException=ae;function le(ye,Je){if(Je.isTagged()||Je.isNamed()){var st="",yt=Je.getNamedTag(),$t=Je.getCustomTags();return yt!==null&&(st+=yt.toString()+`
`),$t!==null&&$t.forEach(function(tr){st+=tr.toString()+`
`})," "+ye+`
 `+ye+" - "+st}else return" "+ye}te.listMetadataForTarget=le;function Be(ye){if(ye.name)return ye.name;var Je=ye.toString(),st=Je.match(/^function\s*([^\s(]+)/);return st?st[1]:"Anonymous function: "+Je}te.getFunctionName=Be},31745:function(Jt){"use strict";Jt.exports=W,Jt.exports.default=W;var te=1e20;function W(H,ae,le,Be,ye,Je){this.fontSize=H||24,this.buffer=ae===void 0?3:ae,this.cutoff=Be||.25,this.fontFamily=ye||"sans-serif",this.fontWeight=Je||"normal",this.radius=le||8;var st=this.size=this.fontSize+this.buffer*2,yt=st+this.buffer*2,$t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;$t?this.canvas=my.createOffscreenCanvas(st,st,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=st),this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(yt*yt),this.gridInner=new Float64Array(yt*yt),this.f=new Float64Array(yt),this.z=new Float64Array(yt+1),this.v=new Uint16Array(yt),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,$t?this.middle=Math.round(st/2*1):this.middle=Math.round(st/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function _e(H,ae,le,Be,ye,Je,st){Je.fill(te,0,ae*le),st.fill(0,0,ae*le);for(var yt=(ae-Be)/2,$t=0;$t<ye;$t++)for(var tr=0;tr<Be;tr++){var Mt=($t+yt)*ae+tr+yt,Qt=H.data[4*($t*Be+tr)+3]/255;if(Qt===1)Je[Mt]=0,st[Mt]=te;else if(Qt===0)Je[Mt]=te,st[Mt]=0;else{var Bt=Math.max(0,.5-Qt),ut=Math.max(0,Qt-.5);Je[Mt]=Bt*Bt,st[Mt]=ut*ut}}}function ue(H,ae,le,Be,ye,Je,st){for(var yt=0;yt<ae*le;yt++){var $t=Math.sqrt(Be[yt])-Math.sqrt(ye[yt]);H[yt]=Math.round(255-255*($t/Je+st))}}W.prototype._draw=function(H,ae){var le=this.ctx.measureText(H),Be=le.width,ye=2*this.buffer,Je,st,yt,$t,tr,Mt,Qt,Bt;ae&&this.useMetrics?(tr=Math.floor(le.actualBoundingBoxAscent),Bt=this.buffer+Math.ceil(le.actualBoundingBoxAscent),Mt=this.buffer,Qt=this.buffer,st=Math.min(this.size,Math.ceil(le.actualBoundingBoxRight-le.actualBoundingBoxLeft)),$t=Math.min(this.size-Mt,Math.ceil(le.actualBoundingBoxAscent+le.actualBoundingBoxDescent)),Je=st+ye,yt=$t+ye,this.ctx.textBaseline="alphabetic"):(Je=st=this.size,yt=$t=this.size,tr=19*this.fontSize/24,Mt=Qt=0,Bt=this.middle,this.ctx.textBaseline="middle");var ut;st&&$t&&(this.ctx.clearRect(Qt,Mt,st,$t),this.ctx.fillText(H,this.buffer,Bt),ut=this.ctx.getImageData(Qt,Mt,st,$t));var pt=new Uint8ClampedArray(Je*yt);return _e(ut,Je,yt,st,$t,this.gridOuter,this.gridInner),g(this.gridOuter,Je,yt,this.f,this.v,this.z),g(this.gridInner,Je,yt,this.f,this.v,this.z),ue(pt,Je,yt,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:pt,metrics:{width:st,height:$t,sdfWidth:Je,sdfHeight:yt,top:tr,left:0,advance:Be}}},W.prototype.draw=function(H){return this._draw(H,!1).data},W.prototype.drawWithMetrics=function(H){return this._draw(H,!0)};function g(H,ae,le,Be,ye,Je){for(var st=0;st<ae;st++)Ee(H,st,ae,le,Be,ye,Je);for(var yt=0;yt<le;yt++)Ee(H,yt*ae,1,ae,Be,ye,Je)}function Ee(H,ae,le,Be,ye,Je,st){var yt,$t,tr,Mt;for(Je[0]=0,st[0]=-te,st[1]=te,yt=0;yt<Be;yt++)ye[yt]=H[ae+yt*le];for(yt=1,$t=0,tr=0;yt<Be;yt++){do Mt=Je[$t],tr=(ye[yt]-ye[Mt]+yt*yt-Mt*Mt)/(yt-Mt)/2;while(tr<=st[$t]&&--$t>-1);$t++,Je[$t]=yt,st[$t]=tr,st[$t+1]=te}for(yt=0,$t=0;yt<Be;yt++){for(;st[$t+1]<yt;)$t++;Mt=Je[$t],H[ae+yt*le]=ye[Mt]+(yt-Mt)*(yt-Mt)}}},18857:function(Jt,te,W){"use strict";W.r(te),W.d(te,{Function:function(){return Ks},Interpreter:function(){return _a},default:function(){return ul},evaluate:function(){return Yu},vm:function(){return _e}});var _e={};W.r(_e),W.d(_e,{Script:function(){return ac},compileFunction:function(){return mf},createContext:function(){return as},runInContext:function(){return Ol},runInNewContext:function(){return qs}});var ue={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},g="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",Ee={5:g,"5module":g+" export import",6:g+" const class extends export import super"},H=/^in(stanceof)?$/,ae="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",le="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",Be=new RegExp("["+ae+"]"),ye=new RegExp("["+ae+le+"]");ae=le=null;var Je=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],st=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function yt(_,M){for(var B=65536,R=0;R<M.length;R+=2){if(B+=M[R],B>_)return!1;if(B+=M[R+1],B>=_)return!0}}function $t(_,M){return _<65?_===36:_<91?!0:_<97?_===95:_<123?!0:_<=65535?_>=170&&Be.test(String.fromCharCode(_)):M===!1?!1:yt(_,Je)}function tr(_,M){return _<48?_===36:_<58?!0:_<65?!1:_<91?!0:_<97?_===95:_<123?!0:_<=65535?_>=170&&ye.test(String.fromCharCode(_)):M===!1?!1:yt(_,Je)||yt(_,st)}var Mt=function(M,B){B===void 0&&(B={}),this.label=M,this.keyword=B.keyword,this.beforeExpr=!!B.beforeExpr,this.startsExpr=!!B.startsExpr,this.isLoop=!!B.isLoop,this.isAssign=!!B.isAssign,this.prefix=!!B.prefix,this.postfix=!!B.postfix,this.binop=B.binop||null,this.updateContext=null};function Qt(_,M){return new Mt(_,{beforeExpr:!0,binop:M})}var Bt={beforeExpr:!0},ut={startsExpr:!0},pt={};function rr(_,M){return M===void 0&&(M={}),M.keyword=_,pt[_]=new Mt(_,M)}var K={num:new Mt("num",ut),regexp:new Mt("regexp",ut),string:new Mt("string",ut),name:new Mt("name",ut),eof:new Mt("eof"),bracketL:new Mt("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new Mt("]"),braceL:new Mt("{",{beforeExpr:!0,startsExpr:!0}),braceR:new Mt("}"),parenL:new Mt("(",{beforeExpr:!0,startsExpr:!0}),parenR:new Mt(")"),comma:new Mt(",",Bt),semi:new Mt(";",Bt),colon:new Mt(":",Bt),dot:new Mt("."),question:new Mt("?",Bt),questionDot:new Mt("?."),arrow:new Mt("=>",Bt),template:new Mt("template"),invalidTemplate:new Mt("invalidTemplate"),ellipsis:new Mt("...",Bt),backQuote:new Mt("`",ut),dollarBraceL:new Mt("${",{beforeExpr:!0,startsExpr:!0}),eq:new Mt("=",{beforeExpr:!0,isAssign:!0}),assign:new Mt("_=",{beforeExpr:!0,isAssign:!0}),incDec:new Mt("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new Mt("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:Qt("||",1),logicalAND:Qt("&&",2),bitwiseOR:Qt("|",3),bitwiseXOR:Qt("^",4),bitwiseAND:Qt("&",5),equality:Qt("==/!=/===/!==",6),relational:Qt("</>/<=/>=",7),bitShift:Qt("<</>>/>>>",8),plusMin:new Mt("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:Qt("%",10),star:Qt("*",10),slash:Qt("/",10),starstar:new Mt("**",{beforeExpr:!0}),coalesce:Qt("??",1),_break:rr("break"),_case:rr("case",Bt),_catch:rr("catch"),_continue:rr("continue"),_debugger:rr("debugger"),_default:rr("default",Bt),_do:rr("do",{isLoop:!0,beforeExpr:!0}),_else:rr("else",Bt),_finally:rr("finally"),_for:rr("for",{isLoop:!0}),_function:rr("function",ut),_if:rr("if"),_return:rr("return",Bt),_switch:rr("switch"),_throw:rr("throw",Bt),_try:rr("try"),_var:rr("var"),_const:rr("const"),_while:rr("while",{isLoop:!0}),_with:rr("with"),_new:rr("new",{beforeExpr:!0,startsExpr:!0}),_this:rr("this",ut),_super:rr("super",ut),_class:rr("class",ut),_extends:rr("extends",Bt),_export:rr("export"),_import:rr("import",ut),_null:rr("null",ut),_true:rr("true",ut),_false:rr("false",ut),_in:rr("in",{beforeExpr:!0,binop:7}),_instanceof:rr("instanceof",{beforeExpr:!0,binop:7}),_typeof:rr("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:rr("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:rr("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},Xt=/\r\n?|\n|\u2028|\u2029/,lt=new RegExp(Xt.source,"g");function $e(_,M){return _===10||_===13||!M&&(_===8232||_===8233)}var St=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,et=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,Ht=Object.prototype,Er=Ht.hasOwnProperty,kr=Ht.toString;function $r(_,M){return Er.call(_,M)}var S=Array.isArray||function(_){return kr.call(_)==="[object Array]"};function pe(_){return new RegExp("^(?:"+_.replace(/ /g,"|")+")$")}var he=function(M,B){this.line=M,this.column=B};he.prototype.offset=function(M){return new he(this.line,this.column+M)};var He=function(M,B,R){this.start=B,this.end=R,M.sourceFile!==null&&(this.source=M.sourceFile)};function Ke(_,M){for(var B=1,R=0;;){lt.lastIndex=R;var $=lt.exec(_);if($&&$.index<M)++B,R=$.index+$[0].length;else return new he(B,M-R)}}var it={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function bt(_){var M={};for(var B in it)M[B]=_&&$r(_,B)?_[B]:it[B];if(M.ecmaVersion>=2015&&(M.ecmaVersion-=2009),M.allowReserved==null&&(M.allowReserved=M.ecmaVersion<5),S(M.onToken)){var R=M.onToken;M.onToken=function($){return R.push($)}}return S(M.onComment)&&(M.onComment=nr(M,M.onComment)),M}function nr(_,M){return function(B,R,$,be,We,ht){var vt={type:B?"Block":"Line",value:R,start:$,end:be};_.locations&&(vt.loc=new He(this,We,ht)),_.ranges&&(vt.range=[$,be]),M.push(vt)}}var Nr=1,wr=2,xn=Nr|wr,an=4,Dn=8,jn=16,In=32,ii=64,wi=128;function Ei(_,M){return wr|(_?an:0)|(M?Dn:0)}var Ti=0,Gi=1,Qi=2,po=3,Sa=4,pa=5,Fi=function(M,B,R){this.options=M=bt(M),this.sourceFile=M.sourceFile,this.keywords=pe(Ee[M.ecmaVersion>=6?6:M.sourceType==="module"?"5module":5]);var $="";if(M.allowReserved!==!0){for(var be=M.ecmaVersion;!($=ue[be]);be--);M.sourceType==="module"&&($+=" await")}this.reservedWords=pe($);var We=($?$+" ":"")+ue.strict;this.reservedWordsStrict=pe(We),this.reservedWordsStrictBind=pe(We+" "+ue.strictBind),this.input=String(B),this.containsEsc=!1,R?(this.pos=R,this.lineStart=this.input.lastIndexOf(`
`,R-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(Xt).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=K.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=M.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&M.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(Nr),this.regexpState=null},ra={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};Fi.prototype.parse=function(){var M=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(M)},ra.inFunction.get=function(){return(this.currentVarScope().flags&wr)>0},ra.inGenerator.get=function(){return(this.currentVarScope().flags&Dn)>0},ra.inAsync.get=function(){return(this.currentVarScope().flags&an)>0},ra.allowSuper.get=function(){return(this.currentThisScope().flags&ii)>0},ra.allowDirectSuper.get=function(){return(this.currentThisScope().flags&wi)>0},ra.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},Fi.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&wr)>0},Fi.extend=function(){for(var M=[],B=arguments.length;B--;)M[B]=arguments[B];for(var R=this,$=0;$<M.length;$++)R=M[$](R);return R},Fi.parse=function(M,B){return new this(B,M).parse()},Fi.parseExpressionAt=function(M,B,R){var $=new this(R,M,B);return $.nextToken(),$.parseExpression()},Fi.tokenizer=function(M,B){return new this(B,M)},Object.defineProperties(Fi.prototype,ra);var $i=Fi.prototype,is=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;$i.strictDirective=function(_){for(;;){et.lastIndex=_,_+=et.exec(this.input)[0].length;var M=is.exec(this.input.slice(_));if(!M)return!1;if((M[1]||M[2])==="use strict"){et.lastIndex=_+M[0].length;var B=et.exec(this.input),R=B.index+B[0].length,$=this.input.charAt(R);return $===";"||$==="}"||Xt.test(B[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test($)||$==="!"&&this.input.charAt(R+1)==="=")}_+=M[0].length,et.lastIndex=_,_+=et.exec(this.input)[0].length,this.input[_]===";"&&_++}},$i.eat=function(_){return this.type===_?(this.next(),!0):!1},$i.isContextual=function(_){return this.type===K.name&&this.value===_&&!this.containsEsc},$i.eatContextual=function(_){return this.isContextual(_)?(this.next(),!0):!1},$i.expectContextual=function(_){this.eatContextual(_)||this.unexpected()},$i.canInsertSemicolon=function(){return this.type===K.eof||this.type===K.braceR||Xt.test(this.input.slice(this.lastTokEnd,this.start))},$i.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},$i.semicolon=function(){!this.eat(K.semi)&&!this.insertSemicolon()&&this.unexpected()},$i.afterTrailingComma=function(_,M){if(this.type===_)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),M||this.next(),!0},$i.expect=function(_){this.eat(_)||this.unexpected()},$i.unexpected=function(_){this.raise(_!=null?_:this.start,"Unexpected token")};function me(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}$i.checkPatternErrors=function(_,M){if(!!_){_.trailingComma>-1&&this.raiseRecoverable(_.trailingComma,"Comma is not permitted after the rest element");var B=M?_.parenthesizedAssign:_.parenthesizedBind;B>-1&&this.raiseRecoverable(B,"Parenthesized pattern")}},$i.checkExpressionErrors=function(_,M){if(!_)return!1;var B=_.shorthandAssign,R=_.doubleProto;if(!M)return B>=0||R>=0;B>=0&&this.raise(B,"Shorthand property assignments are valid only in destructuring patterns"),R>=0&&this.raiseRecoverable(R,"Redefinition of __proto__ property")},$i.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},$i.isSimpleAssignTarget=function(_){return _.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(_.expression):_.type==="Identifier"||_.type==="MemberExpression"};var li=Fi.prototype;li.parseTopLevel=function(_){var M={};for(_.body||(_.body=[]);this.type!==K.eof;){var B=this.parseStatement(null,!0,M);_.body.push(B)}if(this.inModule)for(var R=0,$=Object.keys(this.undefinedExports);R<$.length;R+=1){var be=$[R];this.raiseRecoverable(this.undefinedExports[be].start,"Export '"+be+"' is not defined")}return this.adaptDirectivePrologue(_.body),this.next(),_.sourceType=this.options.sourceType,this.finishNode(_,"Program")};var bo={kind:"loop"},cu={kind:"switch"};li.isLet=function(_){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;et.lastIndex=this.pos;var M=et.exec(this.input),B=this.pos+M[0].length,R=this.input.charCodeAt(B);if(R===91)return!0;if(_)return!1;if(R===123)return!0;if($t(R,!0)){for(var $=B+1;tr(this.input.charCodeAt($),!0);)++$;var be=this.input.slice(B,$);if(!H.test(be))return!0}return!1},li.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;et.lastIndex=this.pos;var _=et.exec(this.input),M=this.pos+_[0].length;return!Xt.test(this.input.slice(this.pos,M))&&this.input.slice(M,M+8)==="function"&&(M+8===this.input.length||!tr(this.input.charAt(M+8)))},li.parseStatement=function(_,M,B){var R=this.type,$=this.startNode(),be;switch(this.isLet(_)&&(R=K._var,be="let"),R){case K._break:case K._continue:return this.parseBreakContinueStatement($,R.keyword);case K._debugger:return this.parseDebuggerStatement($);case K._do:return this.parseDoStatement($);case K._for:return this.parseForStatement($);case K._function:return _&&(this.strict||_!=="if"&&_!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement($,!1,!_);case K._class:return _&&this.unexpected(),this.parseClass($,!0);case K._if:return this.parseIfStatement($);case K._return:return this.parseReturnStatement($);case K._switch:return this.parseSwitchStatement($);case K._throw:return this.parseThrowStatement($);case K._try:return this.parseTryStatement($);case K._const:case K._var:return be=be||this.value,_&&be!=="var"&&this.unexpected(),this.parseVarStatement($,be);case K._while:return this.parseWhileStatement($);case K._with:return this.parseWithStatement($);case K.braceL:return this.parseBlock(!0,$);case K.semi:return this.parseEmptyStatement($);case K._export:case K._import:if(this.options.ecmaVersion>10&&R===K._import){et.lastIndex=this.pos;var We=et.exec(this.input),ht=this.pos+We[0].length,vt=this.input.charCodeAt(ht);if(vt===40||vt===46)return this.parseExpressionStatement($,this.parseExpression())}return this.options.allowImportExportEverywhere||(M||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),R===K._import?this.parseImport($):this.parseExport($,B);default:if(this.isAsyncFunction())return _&&this.unexpected(),this.next(),this.parseFunctionStatement($,!0,!_);var or=this.value,lr=this.parseExpression();return R===K.name&&lr.type==="Identifier"&&this.eat(K.colon)?this.parseLabeledStatement($,or,lr,_):this.parseExpressionStatement($,lr)}},li.parseBreakContinueStatement=function(_,M){var B=M==="break";this.next(),this.eat(K.semi)||this.insertSemicolon()?_.label=null:this.type!==K.name?this.unexpected():(_.label=this.parseIdent(),this.semicolon());for(var R=0;R<this.labels.length;++R){var $=this.labels[R];if((_.label==null||$.name===_.label.name)&&($.kind!=null&&(B||$.kind==="loop")||_.label&&B))break}return R===this.labels.length&&this.raise(_.start,"Unsyntactic "+M),this.finishNode(_,B?"BreakStatement":"ContinueStatement")},li.parseDebuggerStatement=function(_){return this.next(),this.semicolon(),this.finishNode(_,"DebuggerStatement")},li.parseDoStatement=function(_){return this.next(),this.labels.push(bo),_.body=this.parseStatement("do"),this.labels.pop(),this.expect(K._while),_.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(K.semi):this.semicolon(),this.finishNode(_,"DoWhileStatement")},li.parseForStatement=function(_){this.next();var M=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(bo),this.enterScope(0),this.expect(K.parenL),this.type===K.semi)return M>-1&&this.unexpected(M),this.parseFor(_,null);var B=this.isLet();if(this.type===K._var||this.type===K._const||B){var R=this.startNode(),$=B?"let":this.value;return this.next(),this.parseVar(R,!0,$),this.finishNode(R,"VariableDeclaration"),(this.type===K._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&R.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===K._in?M>-1&&this.unexpected(M):_.await=M>-1),this.parseForIn(_,R)):(M>-1&&this.unexpected(M),this.parseFor(_,R))}var be=new me,We=this.parseExpression(!0,be);return this.type===K._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===K._in?M>-1&&this.unexpected(M):_.await=M>-1),this.toAssignable(We,!1,be),this.checkLVal(We),this.parseForIn(_,We)):(this.checkExpressionErrors(be,!0),M>-1&&this.unexpected(M),this.parseFor(_,We))},li.parseFunctionStatement=function(_,M,B){return this.next(),this.parseFunction(_,er|(B?0:Lr),!1,M)},li.parseIfStatement=function(_){return this.next(),_.test=this.parseParenExpression(),_.consequent=this.parseStatement("if"),_.alternate=this.eat(K._else)?this.parseStatement("if"):null,this.finishNode(_,"IfStatement")},li.parseReturnStatement=function(_){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(K.semi)||this.insertSemicolon()?_.argument=null:(_.argument=this.parseExpression(),this.semicolon()),this.finishNode(_,"ReturnStatement")},li.parseSwitchStatement=function(_){this.next(),_.discriminant=this.parseParenExpression(),_.cases=[],this.expect(K.braceL),this.labels.push(cu),this.enterScope(0);for(var M,B=!1;this.type!==K.braceR;)if(this.type===K._case||this.type===K._default){var R=this.type===K._case;M&&this.finishNode(M,"SwitchCase"),_.cases.push(M=this.startNode()),M.consequent=[],this.next(),R?M.test=this.parseExpression():(B&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),B=!0,M.test=null),this.expect(K.colon)}else M||this.unexpected(),M.consequent.push(this.parseStatement(null));return this.exitScope(),M&&this.finishNode(M,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(_,"SwitchStatement")},li.parseThrowStatement=function(_){return this.next(),Xt.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),_.argument=this.parseExpression(),this.semicolon(),this.finishNode(_,"ThrowStatement")};var Zt=[];li.parseTryStatement=function(_){if(this.next(),_.block=this.parseBlock(),_.handler=null,this.type===K._catch){var M=this.startNode();if(this.next(),this.eat(K.parenL)){M.param=this.parseBindingAtom();var B=M.param.type==="Identifier";this.enterScope(B?In:0),this.checkLVal(M.param,B?Sa:Qi),this.expect(K.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),M.param=null,this.enterScope(0);M.body=this.parseBlock(!1),this.exitScope(),_.handler=this.finishNode(M,"CatchClause")}return _.finalizer=this.eat(K._finally)?this.parseBlock():null,!_.handler&&!_.finalizer&&this.raise(_.start,"Missing catch or finally clause"),this.finishNode(_,"TryStatement")},li.parseVarStatement=function(_,M){return this.next(),this.parseVar(_,!1,M),this.semicolon(),this.finishNode(_,"VariableDeclaration")},li.parseWhileStatement=function(_){return this.next(),_.test=this.parseParenExpression(),this.labels.push(bo),_.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(_,"WhileStatement")},li.parseWithStatement=function(_){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),_.object=this.parseParenExpression(),_.body=this.parseStatement("with"),this.finishNode(_,"WithStatement")},li.parseEmptyStatement=function(_){return this.next(),this.finishNode(_,"EmptyStatement")},li.parseLabeledStatement=function(_,M,B,R){for(var $=0,be=this.labels;$<be.length;$+=1){var We=be[$];We.name===M&&this.raise(B.start,"Label '"+M+"' is already declared")}for(var ht=this.type.isLoop?"loop":this.type===K._switch?"switch":null,vt=this.labels.length-1;vt>=0;vt--){var or=this.labels[vt];if(or.statementStart===_.start)or.statementStart=this.start,or.kind=ht;else break}return this.labels.push({name:M,kind:ht,statementStart:this.start}),_.body=this.parseStatement(R?R.indexOf("label")===-1?R+"label":R:"label"),this.labels.pop(),_.label=B,this.finishNode(_,"LabeledStatement")},li.parseExpressionStatement=function(_,M){return _.expression=M,this.semicolon(),this.finishNode(_,"ExpressionStatement")},li.parseBlock=function(_,M,B){for(_===void 0&&(_=!0),M===void 0&&(M=this.startNode()),M.body=[],this.expect(K.braceL),_&&this.enterScope(0);this.type!==K.braceR;){var R=this.parseStatement(null);M.body.push(R)}return B&&(this.strict=!1),this.next(),_&&this.exitScope(),this.finishNode(M,"BlockStatement")},li.parseFor=function(_,M){return _.init=M,this.expect(K.semi),_.test=this.type===K.semi?null:this.parseExpression(),this.expect(K.semi),_.update=this.type===K.parenR?null:this.parseExpression(),this.expect(K.parenR),_.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(_,"ForStatement")},li.parseForIn=function(_,M){var B=this.type===K._in;return this.next(),M.type==="VariableDeclaration"&&M.declarations[0].init!=null&&(!B||this.options.ecmaVersion<8||this.strict||M.kind!=="var"||M.declarations[0].id.type!=="Identifier")?this.raise(M.start,(B?"for-in":"for-of")+" loop variable declaration may not have an initializer"):M.type==="AssignmentPattern"&&this.raise(M.start,"Invalid left-hand side in for-loop"),_.left=M,_.right=B?this.parseExpression():this.parseMaybeAssign(),this.expect(K.parenR),_.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(_,B?"ForInStatement":"ForOfStatement")},li.parseVar=function(_,M,B){for(_.declarations=[],_.kind=B;;){var R=this.startNode();if(this.parseVarId(R,B),this.eat(K.eq)?R.init=this.parseMaybeAssign(M):B==="const"&&!(this.type===K._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():R.id.type!=="Identifier"&&!(M&&(this.type===K._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):R.init=null,_.declarations.push(this.finishNode(R,"VariableDeclarator")),!this.eat(K.comma))break}return _},li.parseVarId=function(_,M){_.id=this.parseBindingAtom(),this.checkLVal(_.id,M==="var"?Gi:Qi,!1)};var er=1,Lr=2,sn=4;li.parseFunction=function(_,M,B,R){this.initFunction(_),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!R)&&(this.type===K.star&&M&Lr&&this.unexpected(),_.generator=this.eat(K.star)),this.options.ecmaVersion>=8&&(_.async=!!R),M&er&&(_.id=M&sn&&this.type!==K.name?null:this.parseIdent(),_.id&&!(M&Lr)&&this.checkLVal(_.id,this.strict||_.generator||_.async?this.treatFunctionsAsVar?Gi:Qi:po));var $=this.yieldPos,be=this.awaitPos,We=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Ei(_.async,_.generator)),M&er||(_.id=this.type===K.name?this.parseIdent():null),this.parseFunctionParams(_),this.parseFunctionBody(_,B,!1),this.yieldPos=$,this.awaitPos=be,this.awaitIdentPos=We,this.finishNode(_,M&er?"FunctionDeclaration":"FunctionExpression")},li.parseFunctionParams=function(_){this.expect(K.parenL),_.params=this.parseBindingList(K.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},li.parseClass=function(_,M){this.next();var B=this.strict;this.strict=!0,this.parseClassId(_,M),this.parseClassSuper(_);var R=this.startNode(),$=!1;for(R.body=[],this.expect(K.braceL);this.type!==K.braceR;){var be=this.parseClassElement(_.superClass!==null);be&&(R.body.push(be),be.type==="MethodDefinition"&&be.kind==="constructor"&&($&&this.raise(be.start,"Duplicate constructor in the same class"),$=!0))}return this.strict=B,this.next(),_.body=this.finishNode(R,"ClassBody"),this.finishNode(_,M?"ClassDeclaration":"ClassExpression")},li.parseClassElement=function(_){var M=this;if(this.eat(K.semi))return null;var B=this.startNode(),R=function(vt,or){or===void 0&&(or=!1);var lr=M.start,Rn=M.startLoc;return M.eatContextual(vt)?M.type!==K.parenL&&(!or||!M.canInsertSemicolon())?!0:(B.key&&M.unexpected(),B.computed=!1,B.key=M.startNodeAt(lr,Rn),B.key.name=vt,M.finishNode(B.key,"Identifier"),!1):!1};B.kind="method",B.static=R("static");var $=this.eat(K.star),be=!1;$||(this.options.ecmaVersion>=8&&R("async",!0)?(be=!0,$=this.options.ecmaVersion>=9&&this.eat(K.star)):R("get")?B.kind="get":R("set")&&(B.kind="set")),B.key||this.parsePropertyName(B);var We=B.key,ht=!1;return!B.computed&&!B.static&&(We.type==="Identifier"&&We.name==="constructor"||We.type==="Literal"&&We.value==="constructor")?(B.kind!=="method"&&this.raise(We.start,"Constructor can't have get/set modifier"),$&&this.raise(We.start,"Constructor can't be a generator"),be&&this.raise(We.start,"Constructor can't be an async method"),B.kind="constructor",ht=_):B.static&&We.type==="Identifier"&&We.name==="prototype"&&this.raise(We.start,"Classes may not have a static property named prototype"),this.parseClassMethod(B,$,be,ht),B.kind==="get"&&B.value.params.length!==0&&this.raiseRecoverable(B.value.start,"getter should have no params"),B.kind==="set"&&B.value.params.length!==1&&this.raiseRecoverable(B.value.start,"setter should have exactly one param"),B.kind==="set"&&B.value.params[0].type==="RestElement"&&this.raiseRecoverable(B.value.params[0].start,"Setter cannot use rest params"),B},li.parseClassMethod=function(_,M,B,R){return _.value=this.parseMethod(M,B,R),this.finishNode(_,"MethodDefinition")},li.parseClassId=function(_,M){this.type===K.name?(_.id=this.parseIdent(),M&&this.checkLVal(_.id,Qi,!1)):(M===!0&&this.unexpected(),_.id=null)},li.parseClassSuper=function(_){_.superClass=this.eat(K._extends)?this.parseExprSubscripts():null},li.parseExport=function(_,M){if(this.next(),this.eat(K.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(_.exported=this.parseIdent(!0),this.checkExport(M,_.exported.name,this.lastTokStart)):_.exported=null),this.expectContextual("from"),this.type!==K.string&&this.unexpected(),_.source=this.parseExprAtom(),this.semicolon(),this.finishNode(_,"ExportAllDeclaration");if(this.eat(K._default)){this.checkExport(M,"default",this.lastTokStart);var B;if(this.type===K._function||(B=this.isAsyncFunction())){var R=this.startNode();this.next(),B&&this.next(),_.declaration=this.parseFunction(R,er|sn,!1,B)}else if(this.type===K._class){var $=this.startNode();_.declaration=this.parseClass($,"nullableID")}else _.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(_,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())_.declaration=this.parseStatement(null),_.declaration.type==="VariableDeclaration"?this.checkVariableExport(M,_.declaration.declarations):this.checkExport(M,_.declaration.id.name,_.declaration.id.start),_.specifiers=[],_.source=null;else{if(_.declaration=null,_.specifiers=this.parseExportSpecifiers(M),this.eatContextual("from"))this.type!==K.string&&this.unexpected(),_.source=this.parseExprAtom();else{for(var be=0,We=_.specifiers;be<We.length;be+=1){var ht=We[be];this.checkUnreserved(ht.local),this.checkLocalExport(ht.local)}_.source=null}this.semicolon()}return this.finishNode(_,"ExportNamedDeclaration")},li.checkExport=function(_,M,B){!_||($r(_,M)&&this.raiseRecoverable(B,"Duplicate export '"+M+"'"),_[M]=!0)},li.checkPatternExport=function(_,M){var B=M.type;if(B==="Identifier")this.checkExport(_,M.name,M.start);else if(B==="ObjectPattern")for(var R=0,$=M.properties;R<$.length;R+=1){var be=$[R];this.checkPatternExport(_,be)}else if(B==="ArrayPattern")for(var We=0,ht=M.elements;We<ht.length;We+=1){var vt=ht[We];vt&&this.checkPatternExport(_,vt)}else B==="Property"?this.checkPatternExport(_,M.value):B==="AssignmentPattern"?this.checkPatternExport(_,M.left):B==="RestElement"?this.checkPatternExport(_,M.argument):B==="ParenthesizedExpression"&&this.checkPatternExport(_,M.expression)},li.checkVariableExport=function(_,M){if(!!_)for(var B=0,R=M;B<R.length;B+=1){var $=R[B];this.checkPatternExport(_,$.id)}},li.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},li.parseExportSpecifiers=function(_){var M=[],B=!0;for(this.expect(K.braceL);!this.eat(K.braceR);){if(B)B=!1;else if(this.expect(K.comma),this.afterTrailingComma(K.braceR))break;var R=this.startNode();R.local=this.parseIdent(!0),R.exported=this.eatContextual("as")?this.parseIdent(!0):R.local,this.checkExport(_,R.exported.name,R.exported.start),M.push(this.finishNode(R,"ExportSpecifier"))}return M},li.parseImport=function(_){return this.next(),this.type===K.string?(_.specifiers=Zt,_.source=this.parseExprAtom()):(_.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),_.source=this.type===K.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(_,"ImportDeclaration")},li.parseImportSpecifiers=function(){var _=[],M=!0;if(this.type===K.name){var B=this.startNode();if(B.local=this.parseIdent(),this.checkLVal(B.local,Qi),_.push(this.finishNode(B,"ImportDefaultSpecifier")),!this.eat(K.comma))return _}if(this.type===K.star){var R=this.startNode();return this.next(),this.expectContextual("as"),R.local=this.parseIdent(),this.checkLVal(R.local,Qi),_.push(this.finishNode(R,"ImportNamespaceSpecifier")),_}for(this.expect(K.braceL);!this.eat(K.braceR);){if(M)M=!1;else if(this.expect(K.comma),this.afterTrailingComma(K.braceR))break;var $=this.startNode();$.imported=this.parseIdent(!0),this.eatContextual("as")?$.local=this.parseIdent():(this.checkUnreserved($.imported),$.local=$.imported),this.checkLVal($.local,Qi),_.push(this.finishNode($,"ImportSpecifier"))}return _},li.adaptDirectivePrologue=function(_){for(var M=0;M<_.length&&this.isDirectiveCandidate(_[M]);++M)_[M].directive=_[M].expression.raw.slice(1,-1)},li.isDirectiveCandidate=function(_){return _.type==="ExpressionStatement"&&_.expression.type==="Literal"&&typeof _.expression.value=="string"&&(this.input[_.start]==='"'||this.input[_.start]==="'")};var On=Fi.prototype;On.toAssignable=function(_,M,B){if(this.options.ecmaVersion>=6&&_)switch(_.type){case"Identifier":this.inAsync&&_.name==="await"&&this.raise(_.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":_.type="ObjectPattern",B&&this.checkPatternErrors(B,!0);for(var R=0,$=_.properties;R<$.length;R+=1){var be=$[R];this.toAssignable(be,M),be.type==="RestElement"&&(be.argument.type==="ArrayPattern"||be.argument.type==="ObjectPattern")&&this.raise(be.argument.start,"Unexpected token")}break;case"Property":_.kind!=="init"&&this.raise(_.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(_.value,M);break;case"ArrayExpression":_.type="ArrayPattern",B&&this.checkPatternErrors(B,!0),this.toAssignableList(_.elements,M);break;case"SpreadElement":_.type="RestElement",this.toAssignable(_.argument,M),_.argument.type==="AssignmentPattern"&&this.raise(_.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":_.operator!=="="&&this.raise(_.left.end,"Only '=' operator can be used for specifying default value."),_.type="AssignmentPattern",delete _.operator,this.toAssignable(_.left,M);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(_.expression,M,B);break;case"ChainExpression":this.raiseRecoverable(_.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!M)break;default:this.raise(_.start,"Assigning to rvalue")}else B&&this.checkPatternErrors(B,!0);return _},On.toAssignableList=function(_,M){for(var B=_.length,R=0;R<B;R++){var $=_[R];$&&this.toAssignable($,M)}if(B){var be=_[B-1];this.options.ecmaVersion===6&&M&&be&&be.type==="RestElement"&&be.argument.type!=="Identifier"&&this.unexpected(be.argument.start)}return _},On.parseSpread=function(_){var M=this.startNode();return this.next(),M.argument=this.parseMaybeAssign(!1,_),this.finishNode(M,"SpreadElement")},On.parseRestBinding=function(){var _=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==K.name&&this.unexpected(),_.argument=this.parseBindingAtom(),this.finishNode(_,"RestElement")},On.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case K.bracketL:var _=this.startNode();return this.next(),_.elements=this.parseBindingList(K.bracketR,!0,!0),this.finishNode(_,"ArrayPattern");case K.braceL:return this.parseObj(!0)}return this.parseIdent()},On.parseBindingList=function(_,M,B){for(var R=[],$=!0;!this.eat(_);)if($?$=!1:this.expect(K.comma),M&&this.type===K.comma)R.push(null);else{if(B&&this.afterTrailingComma(_))break;if(this.type===K.ellipsis){var be=this.parseRestBinding();this.parseBindingListItem(be),R.push(be),this.type===K.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(_);break}else{var We=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(We),R.push(We)}}return R},On.parseBindingListItem=function(_){return _},On.parseMaybeDefault=function(_,M,B){if(B=B||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(K.eq))return B;var R=this.startNodeAt(_,M);return R.left=B,R.right=this.parseMaybeAssign(),this.finishNode(R,"AssignmentPattern")},On.checkLVal=function(_,M,B){switch(M===void 0&&(M=Ti),_.type){case"Identifier":M===Qi&&_.name==="let"&&this.raiseRecoverable(_.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(_.name)&&this.raiseRecoverable(_.start,(M?"Binding ":"Assigning to ")+_.name+" in strict mode"),B&&($r(B,_.name)&&this.raiseRecoverable(_.start,"Argument name clash"),B[_.name]=!0),M!==Ti&&M!==pa&&this.declareName(_.name,M,_.start);break;case"ChainExpression":this.raiseRecoverable(_.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":M&&this.raiseRecoverable(_.start,"Binding member expression");break;case"ObjectPattern":for(var R=0,$=_.properties;R<$.length;R+=1){var be=$[R];this.checkLVal(be,M,B)}break;case"Property":this.checkLVal(_.value,M,B);break;case"ArrayPattern":for(var We=0,ht=_.elements;We<ht.length;We+=1){var vt=ht[We];vt&&this.checkLVal(vt,M,B)}break;case"AssignmentPattern":this.checkLVal(_.left,M,B);break;case"RestElement":this.checkLVal(_.argument,M,B);break;case"ParenthesizedExpression":this.checkLVal(_.expression,M,B);break;default:this.raise(_.start,(M?"Binding":"Assigning to")+" rvalue")}};var Vn=Fi.prototype;Vn.checkPropClash=function(_,M,B){if(!(this.options.ecmaVersion>=9&&_.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(_.computed||_.method||_.shorthand))){var R=_.key,$;switch(R.type){case"Identifier":$=R.name;break;case"Literal":$=String(R.value);break;default:return}var be=_.kind;if(this.options.ecmaVersion>=6){$==="__proto__"&&be==="init"&&(M.proto&&(B?B.doubleProto<0&&(B.doubleProto=R.start):this.raiseRecoverable(R.start,"Redefinition of __proto__ property")),M.proto=!0);return}$="$"+$;var We=M[$];if(We){var ht;be==="init"?ht=this.strict&&We.init||We.get||We.set:ht=We.init||We[be],ht&&this.raiseRecoverable(R.start,"Redefinition of property")}else We=M[$]={init:!1,get:!1,set:!1};We[be]=!0}},Vn.parseExpression=function(_,M){var B=this.start,R=this.startLoc,$=this.parseMaybeAssign(_,M);if(this.type===K.comma){var be=this.startNodeAt(B,R);for(be.expressions=[$];this.eat(K.comma);)be.expressions.push(this.parseMaybeAssign(_,M));return this.finishNode(be,"SequenceExpression")}return $},Vn.parseMaybeAssign=function(_,M,B){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(_);this.exprAllowed=!1}var R=!1,$=-1,be=-1;M?($=M.parenthesizedAssign,be=M.trailingComma,M.parenthesizedAssign=M.trailingComma=-1):(M=new me,R=!0);var We=this.start,ht=this.startLoc;(this.type===K.parenL||this.type===K.name)&&(this.potentialArrowAt=this.start);var vt=this.parseMaybeConditional(_,M);if(B&&(vt=B.call(this,vt,We,ht)),this.type.isAssign){var or=this.startNodeAt(We,ht);return or.operator=this.value,or.left=this.type===K.eq?this.toAssignable(vt,!1,M):vt,R||(M.parenthesizedAssign=M.trailingComma=M.doubleProto=-1),M.shorthandAssign>=or.left.start&&(M.shorthandAssign=-1),this.checkLVal(vt),this.next(),or.right=this.parseMaybeAssign(_),this.finishNode(or,"AssignmentExpression")}else R&&this.checkExpressionErrors(M,!0);return $>-1&&(M.parenthesizedAssign=$),be>-1&&(M.trailingComma=be),vt},Vn.parseMaybeConditional=function(_,M){var B=this.start,R=this.startLoc,$=this.parseExprOps(_,M);if(this.checkExpressionErrors(M))return $;if(this.eat(K.question)){var be=this.startNodeAt(B,R);return be.test=$,be.consequent=this.parseMaybeAssign(),this.expect(K.colon),be.alternate=this.parseMaybeAssign(_),this.finishNode(be,"ConditionalExpression")}return $},Vn.parseExprOps=function(_,M){var B=this.start,R=this.startLoc,$=this.parseMaybeUnary(M,!1);return this.checkExpressionErrors(M)||$.start===B&&$.type==="ArrowFunctionExpression"?$:this.parseExprOp($,B,R,-1,_)},Vn.parseExprOp=function(_,M,B,R,$){var be=this.type.binop;if(be!=null&&(!$||this.type!==K._in)&&be>R){var We=this.type===K.logicalOR||this.type===K.logicalAND,ht=this.type===K.coalesce;ht&&(be=K.logicalAND.binop);var vt=this.value;this.next();var or=this.start,lr=this.startLoc,Rn=this.parseExprOp(this.parseMaybeUnary(null,!1),or,lr,be,$),ai=this.buildBinary(M,B,_,Rn,vt,We||ht);return(We&&this.type===K.coalesce||ht&&(this.type===K.logicalOR||this.type===K.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(ai,M,B,R,$)}return _},Vn.buildBinary=function(_,M,B,R,$,be){var We=this.startNodeAt(_,M);return We.left=B,We.operator=$,We.right=R,this.finishNode(We,be?"LogicalExpression":"BinaryExpression")},Vn.parseMaybeUnary=function(_,M){var B=this.start,R=this.startLoc,$;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))$=this.parseAwait(),M=!0;else if(this.type.prefix){var be=this.startNode(),We=this.type===K.incDec;be.operator=this.value,be.prefix=!0,this.next(),be.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(_,!0),We?this.checkLVal(be.argument):this.strict&&be.operator==="delete"&&be.argument.type==="Identifier"?this.raiseRecoverable(be.start,"Deleting local variable in strict mode"):M=!0,$=this.finishNode(be,We?"UpdateExpression":"UnaryExpression")}else{if($=this.parseExprSubscripts(_),this.checkExpressionErrors(_))return $;for(;this.type.postfix&&!this.canInsertSemicolon();){var ht=this.startNodeAt(B,R);ht.operator=this.value,ht.prefix=!1,ht.argument=$,this.checkLVal($),this.next(),$=this.finishNode(ht,"UpdateExpression")}}return!M&&this.eat(K.starstar)?this.buildBinary(B,R,$,this.parseMaybeUnary(null,!1),"**",!1):$},Vn.parseExprSubscripts=function(_){var M=this.start,B=this.startLoc,R=this.parseExprAtom(_);if(R.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return R;var $=this.parseSubscripts(R,M,B);return _&&$.type==="MemberExpression"&&(_.parenthesizedAssign>=$.start&&(_.parenthesizedAssign=-1),_.parenthesizedBind>=$.start&&(_.parenthesizedBind=-1)),$},Vn.parseSubscripts=function(_,M,B,R){for(var $=this.options.ecmaVersion>=8&&_.type==="Identifier"&&_.name==="async"&&this.lastTokEnd===_.end&&!this.canInsertSemicolon()&&_.end-_.start==5&&this.potentialArrowAt===_.start,be=!1;;){var We=this.parseSubscript(_,M,B,R,$,be);if(We.optional&&(be=!0),We===_||We.type==="ArrowFunctionExpression"){if(be){var ht=this.startNodeAt(M,B);ht.expression=We,We=this.finishNode(ht,"ChainExpression")}return We}_=We}},Vn.parseSubscript=function(_,M,B,R,$,be){var We=this.options.ecmaVersion>=11,ht=We&&this.eat(K.questionDot);R&&ht&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var vt=this.eat(K.bracketL);if(vt||ht&&this.type!==K.parenL&&this.type!==K.backQuote||this.eat(K.dot)){var or=this.startNodeAt(M,B);or.object=_,or.property=vt?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),or.computed=!!vt,vt&&this.expect(K.bracketR),We&&(or.optional=ht),_=this.finishNode(or,"MemberExpression")}else if(!R&&this.eat(K.parenL)){var lr=new me,Rn=this.yieldPos,ai=this.awaitPos,Fn=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var Yi=this.parseExprList(K.parenR,this.options.ecmaVersion>=8,!1,lr);if($&&!ht&&!this.canInsertSemicolon()&&this.eat(K.arrow))return this.checkPatternErrors(lr,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=Rn,this.awaitPos=ai,this.awaitIdentPos=Fn,this.parseArrowExpression(this.startNodeAt(M,B),Yi,!0);this.checkExpressionErrors(lr,!0),this.yieldPos=Rn||this.yieldPos,this.awaitPos=ai||this.awaitPos,this.awaitIdentPos=Fn||this.awaitIdentPos;var da=this.startNodeAt(M,B);da.callee=_,da.arguments=Yi,We&&(da.optional=ht),_=this.finishNode(da,"CallExpression")}else if(this.type===K.backQuote){(ht||be)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var Ca=this.startNodeAt(M,B);Ca.tag=_,Ca.quasi=this.parseTemplate({isTagged:!0}),_=this.finishNode(Ca,"TaggedTemplateExpression")}return _},Vn.parseExprAtom=function(_){this.type===K.slash&&this.readRegexp();var M,B=this.potentialArrowAt===this.start;switch(this.type){case K._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),M=this.startNode(),this.next(),this.type===K.parenL&&!this.allowDirectSuper&&this.raise(M.start,"super() call outside constructor of a subclass"),this.type!==K.dot&&this.type!==K.bracketL&&this.type!==K.parenL&&this.unexpected(),this.finishNode(M,"Super");case K._this:return M=this.startNode(),this.next(),this.finishNode(M,"ThisExpression");case K.name:var R=this.start,$=this.startLoc,be=this.containsEsc,We=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!be&&We.name==="async"&&!this.canInsertSemicolon()&&this.eat(K._function))return this.parseFunction(this.startNodeAt(R,$),0,!1,!0);if(B&&!this.canInsertSemicolon()){if(this.eat(K.arrow))return this.parseArrowExpression(this.startNodeAt(R,$),[We],!1);if(this.options.ecmaVersion>=8&&We.name==="async"&&this.type===K.name&&!be)return We=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(K.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(R,$),[We],!0)}return We;case K.regexp:var ht=this.value;return M=this.parseLiteral(ht.value),M.regex={pattern:ht.pattern,flags:ht.flags},M;case K.num:case K.string:return this.parseLiteral(this.value);case K._null:case K._true:case K._false:return M=this.startNode(),M.value=this.type===K._null?null:this.type===K._true,M.raw=this.type.keyword,this.next(),this.finishNode(M,"Literal");case K.parenL:var vt=this.start,or=this.parseParenAndDistinguishExpression(B);return _&&(_.parenthesizedAssign<0&&!this.isSimpleAssignTarget(or)&&(_.parenthesizedAssign=vt),_.parenthesizedBind<0&&(_.parenthesizedBind=vt)),or;case K.bracketL:return M=this.startNode(),this.next(),M.elements=this.parseExprList(K.bracketR,!0,!0,_),this.finishNode(M,"ArrayExpression");case K.braceL:return this.parseObj(!1,_);case K._function:return M=this.startNode(),this.next(),this.parseFunction(M,0);case K._class:return this.parseClass(this.startNode(),!1);case K._new:return this.parseNew();case K.backQuote:return this.parseTemplate();case K._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},Vn.parseExprImport=function(){var _=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var M=this.parseIdent(!0);switch(this.type){case K.parenL:return this.parseDynamicImport(_);case K.dot:return _.meta=M,this.parseImportMeta(_);default:this.unexpected()}},Vn.parseDynamicImport=function(_){if(this.next(),_.source=this.parseMaybeAssign(),!this.eat(K.parenR)){var M=this.start;this.eat(K.comma)&&this.eat(K.parenR)?this.raiseRecoverable(M,"Trailing comma is not allowed in import()"):this.unexpected(M)}return this.finishNode(_,"ImportExpression")},Vn.parseImportMeta=function(_){this.next();var M=this.containsEsc;return _.property=this.parseIdent(!0),_.property.name!=="meta"&&this.raiseRecoverable(_.property.start,"The only valid meta property for import is 'import.meta'"),M&&this.raiseRecoverable(_.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(_.start,"Cannot use 'import.meta' outside a module"),this.finishNode(_,"MetaProperty")},Vn.parseLiteral=function(_){var M=this.startNode();return M.value=_,M.raw=this.input.slice(this.start,this.end),M.raw.charCodeAt(M.raw.length-1)===110&&(M.bigint=M.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(M,"Literal")},Vn.parseParenExpression=function(){this.expect(K.parenL);var _=this.parseExpression();return this.expect(K.parenR),_},Vn.parseParenAndDistinguishExpression=function(_){var M=this.start,B=this.startLoc,R,$=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var be=this.start,We=this.startLoc,ht=[],vt=!0,or=!1,lr=new me,Rn=this.yieldPos,ai=this.awaitPos,Fn;for(this.yieldPos=0,this.awaitPos=0;this.type!==K.parenR;)if(vt?vt=!1:this.expect(K.comma),$&&this.afterTrailingComma(K.parenR,!0)){or=!0;break}else if(this.type===K.ellipsis){Fn=this.start,ht.push(this.parseParenItem(this.parseRestBinding())),this.type===K.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else ht.push(this.parseMaybeAssign(!1,lr,this.parseParenItem));var Yi=this.start,da=this.startLoc;if(this.expect(K.parenR),_&&!this.canInsertSemicolon()&&this.eat(K.arrow))return this.checkPatternErrors(lr,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=Rn,this.awaitPos=ai,this.parseParenArrowList(M,B,ht);(!ht.length||or)&&this.unexpected(this.lastTokStart),Fn&&this.unexpected(Fn),this.checkExpressionErrors(lr,!0),this.yieldPos=Rn||this.yieldPos,this.awaitPos=ai||this.awaitPos,ht.length>1?(R=this.startNodeAt(be,We),R.expressions=ht,this.finishNodeAt(R,"SequenceExpression",Yi,da)):R=ht[0]}else R=this.parseParenExpression();if(this.options.preserveParens){var Ca=this.startNodeAt(M,B);return Ca.expression=R,this.finishNode(Ca,"ParenthesizedExpression")}else return R},Vn.parseParenItem=function(_){return _},Vn.parseParenArrowList=function(_,M,B){return this.parseArrowExpression(this.startNodeAt(_,M),B)};var bi=[];Vn.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var _=this.startNode(),M=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(K.dot)){_.meta=M;var B=this.containsEsc;return _.property=this.parseIdent(!0),_.property.name!=="target"&&this.raiseRecoverable(_.property.start,"The only valid meta property for new is 'new.target'"),B&&this.raiseRecoverable(_.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(_.start,"'new.target' can only be used in functions"),this.finishNode(_,"MetaProperty")}var R=this.start,$=this.startLoc,be=this.type===K._import;return _.callee=this.parseSubscripts(this.parseExprAtom(),R,$,!0),be&&_.callee.type==="ImportExpression"&&this.raise(R,"Cannot use new with import()"),this.eat(K.parenL)?_.arguments=this.parseExprList(K.parenR,this.options.ecmaVersion>=8,!1):_.arguments=bi,this.finishNode(_,"NewExpression")},Vn.parseTemplateElement=function(_){var M=_.isTagged,B=this.startNode();return this.type===K.invalidTemplate?(M||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),B.value={raw:this.value,cooked:null}):B.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),B.tail=this.type===K.backQuote,this.finishNode(B,"TemplateElement")},Vn.parseTemplate=function(_){_===void 0&&(_={});var M=_.isTagged;M===void 0&&(M=!1);var B=this.startNode();this.next(),B.expressions=[];var R=this.parseTemplateElement({isTagged:M});for(B.quasis=[R];!R.tail;)this.type===K.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(K.dollarBraceL),B.expressions.push(this.parseExpression()),this.expect(K.braceR),B.quasis.push(R=this.parseTemplateElement({isTagged:M}));return this.next(),this.finishNode(B,"TemplateLiteral")},Vn.isAsyncProp=function(_){return!_.computed&&_.key.type==="Identifier"&&_.key.name==="async"&&(this.type===K.name||this.type===K.num||this.type===K.string||this.type===K.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===K.star)&&!Xt.test(this.input.slice(this.lastTokEnd,this.start))},Vn.parseObj=function(_,M){var B=this.startNode(),R=!0,$={};for(B.properties=[],this.next();!this.eat(K.braceR);){if(R)R=!1;else if(this.expect(K.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(K.braceR))break;var be=this.parseProperty(_,M);_||this.checkPropClash(be,$,M),B.properties.push(be)}return this.finishNode(B,_?"ObjectPattern":"ObjectExpression")},Vn.parseProperty=function(_,M){var B=this.startNode(),R,$,be,We;if(this.options.ecmaVersion>=9&&this.eat(K.ellipsis))return _?(B.argument=this.parseIdent(!1),this.type===K.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(B,"RestElement")):(this.type===K.parenL&&M&&(M.parenthesizedAssign<0&&(M.parenthesizedAssign=this.start),M.parenthesizedBind<0&&(M.parenthesizedBind=this.start)),B.argument=this.parseMaybeAssign(!1,M),this.type===K.comma&&M&&M.trailingComma<0&&(M.trailingComma=this.start),this.finishNode(B,"SpreadElement"));this.options.ecmaVersion>=6&&(B.method=!1,B.shorthand=!1,(_||M)&&(be=this.start,We=this.startLoc),_||(R=this.eat(K.star)));var ht=this.containsEsc;return this.parsePropertyName(B),!_&&!ht&&this.options.ecmaVersion>=8&&!R&&this.isAsyncProp(B)?($=!0,R=this.options.ecmaVersion>=9&&this.eat(K.star),this.parsePropertyName(B,M)):$=!1,this.parsePropertyValue(B,_,R,$,be,We,M,ht),this.finishNode(B,"Property")},Vn.parsePropertyValue=function(_,M,B,R,$,be,We,ht){if((B||R)&&this.type===K.colon&&this.unexpected(),this.eat(K.colon))_.value=M?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,We),_.kind="init";else if(this.options.ecmaVersion>=6&&this.type===K.parenL)M&&this.unexpected(),_.kind="init",_.method=!0,_.value=this.parseMethod(B,R);else if(!M&&!ht&&this.options.ecmaVersion>=5&&!_.computed&&_.key.type==="Identifier"&&(_.key.name==="get"||_.key.name==="set")&&this.type!==K.comma&&this.type!==K.braceR&&this.type!==K.eq){(B||R)&&this.unexpected(),_.kind=_.key.name,this.parsePropertyName(_),_.value=this.parseMethod(!1);var vt=_.kind==="get"?0:1;if(_.value.params.length!==vt){var or=_.value.start;_.kind==="get"?this.raiseRecoverable(or,"getter should have no params"):this.raiseRecoverable(or,"setter should have exactly one param")}else _.kind==="set"&&_.value.params[0].type==="RestElement"&&this.raiseRecoverable(_.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!_.computed&&_.key.type==="Identifier"?((B||R)&&this.unexpected(),this.checkUnreserved(_.key),_.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=$),_.kind="init",M?_.value=this.parseMaybeDefault($,be,_.key):this.type===K.eq&&We?(We.shorthandAssign<0&&(We.shorthandAssign=this.start),_.value=this.parseMaybeDefault($,be,_.key)):_.value=_.key,_.shorthand=!0):this.unexpected()},Vn.parsePropertyName=function(_){if(this.options.ecmaVersion>=6){if(this.eat(K.bracketL))return _.computed=!0,_.key=this.parseMaybeAssign(),this.expect(K.bracketR),_.key;_.computed=!1}return _.key=this.type===K.num||this.type===K.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},Vn.initFunction=function(_){_.id=null,this.options.ecmaVersion>=6&&(_.generator=_.expression=!1),this.options.ecmaVersion>=8&&(_.async=!1)},Vn.parseMethod=function(_,M,B){var R=this.startNode(),$=this.yieldPos,be=this.awaitPos,We=this.awaitIdentPos;return this.initFunction(R),this.options.ecmaVersion>=6&&(R.generator=_),this.options.ecmaVersion>=8&&(R.async=!!M),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Ei(M,R.generator)|ii|(B?wi:0)),this.expect(K.parenL),R.params=this.parseBindingList(K.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(R,!1,!0),this.yieldPos=$,this.awaitPos=be,this.awaitIdentPos=We,this.finishNode(R,"FunctionExpression")},Vn.parseArrowExpression=function(_,M,B){var R=this.yieldPos,$=this.awaitPos,be=this.awaitIdentPos;return this.enterScope(Ei(B,!1)|jn),this.initFunction(_),this.options.ecmaVersion>=8&&(_.async=!!B),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,_.params=this.toAssignableList(M,!0),this.parseFunctionBody(_,!0,!1),this.yieldPos=R,this.awaitPos=$,this.awaitIdentPos=be,this.finishNode(_,"ArrowFunctionExpression")},Vn.parseFunctionBody=function(_,M,B){var R=M&&this.type!==K.braceL,$=this.strict,be=!1;if(R)_.body=this.parseMaybeAssign(),_.expression=!0,this.checkParams(_,!1);else{var We=this.options.ecmaVersion>=7&&!this.isSimpleParamList(_.params);(!$||We)&&(be=this.strictDirective(this.end),be&&We&&this.raiseRecoverable(_.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var ht=this.labels;this.labels=[],be&&(this.strict=!0),this.checkParams(_,!$&&!be&&!M&&!B&&this.isSimpleParamList(_.params)),this.strict&&_.id&&this.checkLVal(_.id,pa),_.body=this.parseBlock(!1,void 0,be&&!$),_.expression=!1,this.adaptDirectivePrologue(_.body.body),this.labels=ht}this.exitScope()},Vn.isSimpleParamList=function(_){for(var M=0,B=_;M<B.length;M+=1){var R=B[M];if(R.type!=="Identifier")return!1}return!0},Vn.checkParams=function(_,M){for(var B={},R=0,$=_.params;R<$.length;R+=1){var be=$[R];this.checkLVal(be,Gi,M?null:B)}},Vn.parseExprList=function(_,M,B,R){for(var $=[],be=!0;!this.eat(_);){if(be)be=!1;else if(this.expect(K.comma),M&&this.afterTrailingComma(_))break;var We=void 0;B&&this.type===K.comma?We=null:this.type===K.ellipsis?(We=this.parseSpread(R),R&&this.type===K.comma&&R.trailingComma<0&&(R.trailingComma=this.start)):We=this.parseMaybeAssign(!1,R),$.push(We)}return $},Vn.checkUnreserved=function(_){var M=_.start,B=_.end,R=_.name;if(this.inGenerator&&R==="yield"&&this.raiseRecoverable(M,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&R==="await"&&this.raiseRecoverable(M,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(R)&&this.raise(M,"Unexpected keyword '"+R+"'"),!(this.options.ecmaVersion<6&&this.input.slice(M,B).indexOf("\\")!==-1)){var $=this.strict?this.reservedWordsStrict:this.reservedWords;$.test(R)&&(!this.inAsync&&R==="await"&&this.raiseRecoverable(M,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(M,"The keyword '"+R+"' is reserved"))}},Vn.parseIdent=function(_,M){var B=this.startNode();return this.type===K.name?B.name=this.value:this.type.keyword?(B.name=this.type.keyword,(B.name==="class"||B.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!_),this.finishNode(B,"Identifier"),_||(this.checkUnreserved(B),B.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=B.start)),B},Vn.parseYield=function(_){this.yieldPos||(this.yieldPos=this.start);var M=this.startNode();return this.next(),this.type===K.semi||this.canInsertSemicolon()||this.type!==K.star&&!this.type.startsExpr?(M.delegate=!1,M.argument=null):(M.delegate=this.eat(K.star),M.argument=this.parseMaybeAssign(_)),this.finishNode(M,"YieldExpression")},Vn.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var _=this.startNode();return this.next(),_.argument=this.parseMaybeUnary(null,!1),this.finishNode(_,"AwaitExpression")};var vi=Fi.prototype;vi.raise=function(_,M){var B=Ke(this.input,_);M+=" ("+B.line+":"+B.column+")";var R=new SyntaxError(M);throw R.pos=_,R.loc=B,R.raisedAt=this.pos,R},vi.raiseRecoverable=vi.raise,vi.curPosition=function(){if(this.options.locations)return new he(this.curLine,this.pos-this.lineStart)};var An=Fi.prototype,Bi=function(M){this.flags=M,this.var=[],this.lexical=[],this.functions=[]};An.enterScope=function(_){this.scopeStack.push(new Bi(_))},An.exitScope=function(){this.scopeStack.pop()},An.treatFunctionsAsVarInScope=function(_){return _.flags&wr||!this.inModule&&_.flags&Nr},An.declareName=function(_,M,B){var R=!1;if(M===Qi){var $=this.currentScope();R=$.lexical.indexOf(_)>-1||$.functions.indexOf(_)>-1||$.var.indexOf(_)>-1,$.lexical.push(_),this.inModule&&$.flags&Nr&&delete this.undefinedExports[_]}else if(M===Sa){var be=this.currentScope();be.lexical.push(_)}else if(M===po){var We=this.currentScope();this.treatFunctionsAsVar?R=We.lexical.indexOf(_)>-1:R=We.lexical.indexOf(_)>-1||We.var.indexOf(_)>-1,We.functions.push(_)}else for(var ht=this.scopeStack.length-1;ht>=0;--ht){var vt=this.scopeStack[ht];if(vt.lexical.indexOf(_)>-1&&!(vt.flags&In&&vt.lexical[0]===_)||!this.treatFunctionsAsVarInScope(vt)&&vt.functions.indexOf(_)>-1){R=!0;break}if(vt.var.push(_),this.inModule&&vt.flags&Nr&&delete this.undefinedExports[_],vt.flags&xn)break}R&&this.raiseRecoverable(B,"Identifier '"+_+"' has already been declared")},An.checkLocalExport=function(_){this.scopeStack[0].lexical.indexOf(_.name)===-1&&this.scopeStack[0].var.indexOf(_.name)===-1&&(this.undefinedExports[_.name]=_)},An.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},An.currentVarScope=function(){for(var _=this.scopeStack.length-1;;_--){var M=this.scopeStack[_];if(M.flags&xn)return M}},An.currentThisScope=function(){for(var _=this.scopeStack.length-1;;_--){var M=this.scopeStack[_];if(M.flags&xn&&!(M.flags&jn))return M}};var Li=function(M,B,R){this.type="",this.start=B,this.end=0,M.options.locations&&(this.loc=new He(M,R)),M.options.directSourceFile&&(this.sourceFile=M.options.directSourceFile),M.options.ranges&&(this.range=[B,0])},io=Fi.prototype;io.startNode=function(){return new Li(this,this.start,this.startLoc)},io.startNodeAt=function(_,M){return new Li(this,_,M)};function ys(_,M,B,R){return _.type=M,_.end=B,this.options.locations&&(_.loc.end=R),this.options.ranges&&(_.range[1]=B),_}io.finishNode=function(_,M){return ys.call(this,_,M,this.lastTokEnd,this.lastTokEndLoc)},io.finishNodeAt=function(_,M,B,R){return ys.call(this,_,M,B,R)};var Uo=function(M,B,R,$,be){this.token=M,this.isExpr=!!B,this.preserveSpace=!!R,this.override=$,this.generator=!!be},Na={b_stat:new Uo("{",!1),b_expr:new Uo("{",!0),b_tmpl:new Uo("${",!1),p_stat:new Uo("(",!1),p_expr:new Uo("(",!0),q_tmpl:new Uo("`",!0,!0,function(_){return _.tryReadTemplateToken()}),f_stat:new Uo("function",!1),f_expr:new Uo("function",!0),f_expr_gen:new Uo("function",!0,!1,null,!0),f_gen:new Uo("function",!1,!1,null,!0)},xa=Fi.prototype;xa.initialContext=function(){return[Na.b_stat]},xa.braceIsBlock=function(_){var M=this.curContext();return M===Na.f_expr||M===Na.f_stat?!0:_===K.colon&&(M===Na.b_stat||M===Na.b_expr)?!M.isExpr:_===K._return||_===K.name&&this.exprAllowed?Xt.test(this.input.slice(this.lastTokEnd,this.start)):_===K._else||_===K.semi||_===K.eof||_===K.parenR||_===K.arrow?!0:_===K.braceL?M===Na.b_stat:_===K._var||_===K._const||_===K.name?!1:!this.exprAllowed},xa.inGeneratorContext=function(){for(var _=this.context.length-1;_>=1;_--){var M=this.context[_];if(M.token==="function")return M.generator}return!1},xa.updateContext=function(_){var M,B=this.type;B.keyword&&_===K.dot?this.exprAllowed=!1:(M=B.updateContext)?M.call(this,_):this.exprAllowed=B.beforeExpr},K.parenR.updateContext=K.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var _=this.context.pop();_===Na.b_stat&&this.curContext().token==="function"&&(_=this.context.pop()),this.exprAllowed=!_.isExpr},K.braceL.updateContext=function(_){this.context.push(this.braceIsBlock(_)?Na.b_stat:Na.b_expr),this.exprAllowed=!0},K.dollarBraceL.updateContext=function(){this.context.push(Na.b_tmpl),this.exprAllowed=!0},K.parenL.updateContext=function(_){var M=_===K._if||_===K._for||_===K._with||_===K._while;this.context.push(M?Na.p_stat:Na.p_expr),this.exprAllowed=!0},K.incDec.updateContext=function(){},K._function.updateContext=K._class.updateContext=function(_){_.beforeExpr&&_!==K.semi&&_!==K._else&&!(_===K._return&&Xt.test(this.input.slice(this.lastTokEnd,this.start)))&&!((_===K.colon||_===K.braceL)&&this.curContext()===Na.b_stat)?this.context.push(Na.f_expr):this.context.push(Na.f_stat),this.exprAllowed=!1},K.backQuote.updateContext=function(){this.curContext()===Na.q_tmpl?this.context.pop():this.context.push(Na.q_tmpl),this.exprAllowed=!1},K.star.updateContext=function(_){if(_===K._function){var M=this.context.length-1;this.context[M]===Na.f_expr?this.context[M]=Na.f_expr_gen:this.context[M]=Na.f_gen}this.exprAllowed=!0},K.name.updateContext=function(_){var M=!1;this.options.ecmaVersion>=6&&_!==K.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(M=!0),this.exprAllowed=M};var V="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",Q=V+" Extended_Pictographic",ne=Q,ge={9:V,10:Q,11:ne},Ie="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",Ge="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",tt=Ge+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",ce=tt+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",Le={9:Ge,10:tt,11:ce},mt={};function pr(_){var M=mt[_]={binary:pe(ge[_]+" "+Ie),nonBinary:{General_Category:pe(Ie),Script:pe(Le[_])}};M.nonBinary.Script_Extensions=M.nonBinary.Script,M.nonBinary.gc=M.nonBinary.General_Category,M.nonBinary.sc=M.nonBinary.Script,M.nonBinary.scx=M.nonBinary.Script_Extensions}pr(9),pr(10),pr(11);var Lt=Fi.prototype,Ft=function(M){this.parser=M,this.validFlags="gim"+(M.options.ecmaVersion>=6?"uy":"")+(M.options.ecmaVersion>=9?"s":""),this.unicodeProperties=mt[M.options.ecmaVersion>=11?11:M.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};Ft.prototype.reset=function(M,B,R){var $=R.indexOf("u")!==-1;this.start=M|0,this.source=B+"",this.flags=R,this.switchU=$&&this.parser.options.ecmaVersion>=6,this.switchN=$&&this.parser.options.ecmaVersion>=9},Ft.prototype.raise=function(M){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+M)},Ft.prototype.at=function(M,B){B===void 0&&(B=!1);var R=this.source,$=R.length;if(M>=$)return-1;var be=R.charCodeAt(M);if(!(B||this.switchU)||be<=55295||be>=57344||M+1>=$)return be;var We=R.charCodeAt(M+1);return We>=56320&&We<=57343?(be<<10)+We-56613888:be},Ft.prototype.nextIndex=function(M,B){B===void 0&&(B=!1);var R=this.source,$=R.length;if(M>=$)return $;var be=R.charCodeAt(M),We;return!(B||this.switchU)||be<=55295||be>=57344||M+1>=$||(We=R.charCodeAt(M+1))<56320||We>57343?M+1:M+2},Ft.prototype.current=function(M){return M===void 0&&(M=!1),this.at(this.pos,M)},Ft.prototype.lookahead=function(M){return M===void 0&&(M=!1),this.at(this.nextIndex(this.pos,M),M)},Ft.prototype.advance=function(M){M===void 0&&(M=!1),this.pos=this.nextIndex(this.pos,M)},Ft.prototype.eat=function(M,B){return B===void 0&&(B=!1),this.current(B)===M?(this.advance(B),!0):!1};function dr(_){return _<=65535?String.fromCharCode(_):(_-=65536,String.fromCharCode((_>>10)+55296,(_&1023)+56320))}Lt.validateRegExpFlags=function(_){for(var M=_.validFlags,B=_.flags,R=0;R<B.length;R++){var $=B.charAt(R);M.indexOf($)===-1&&this.raise(_.start,"Invalid regular expression flag"),B.indexOf($,R+1)>-1&&this.raise(_.start,"Duplicate regular expression flag")}},Lt.validateRegExpPattern=function(_){this.regexp_pattern(_),!_.switchN&&this.options.ecmaVersion>=9&&_.groupNames.length>0&&(_.switchN=!0,this.regexp_pattern(_))},Lt.regexp_pattern=function(_){_.pos=0,_.lastIntValue=0,_.lastStringValue="",_.lastAssertionIsQuantifiable=!1,_.numCapturingParens=0,_.maxBackReference=0,_.groupNames.length=0,_.backReferenceNames.length=0,this.regexp_disjunction(_),_.pos!==_.source.length&&(_.eat(41)&&_.raise("Unmatched ')'"),(_.eat(93)||_.eat(125))&&_.raise("Lone quantifier brackets")),_.maxBackReference>_.numCapturingParens&&_.raise("Invalid escape");for(var M=0,B=_.backReferenceNames;M<B.length;M+=1){var R=B[M];_.groupNames.indexOf(R)===-1&&_.raise("Invalid named capture referenced")}},Lt.regexp_disjunction=function(_){for(this.regexp_alternative(_);_.eat(124);)this.regexp_alternative(_);this.regexp_eatQuantifier(_,!0)&&_.raise("Nothing to repeat"),_.eat(123)&&_.raise("Lone quantifier brackets")},Lt.regexp_alternative=function(_){for(;_.pos<_.source.length&&this.regexp_eatTerm(_););},Lt.regexp_eatTerm=function(_){return this.regexp_eatAssertion(_)?(_.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(_)&&_.switchU&&_.raise("Invalid quantifier"),!0):(_.switchU?this.regexp_eatAtom(_):this.regexp_eatExtendedAtom(_))?(this.regexp_eatQuantifier(_),!0):!1},Lt.regexp_eatAssertion=function(_){var M=_.pos;if(_.lastAssertionIsQuantifiable=!1,_.eat(94)||_.eat(36))return!0;if(_.eat(92)){if(_.eat(66)||_.eat(98))return!0;_.pos=M}if(_.eat(40)&&_.eat(63)){var B=!1;if(this.options.ecmaVersion>=9&&(B=_.eat(60)),_.eat(61)||_.eat(33))return this.regexp_disjunction(_),_.eat(41)||_.raise("Unterminated group"),_.lastAssertionIsQuantifiable=!B,!0}return _.pos=M,!1},Lt.regexp_eatQuantifier=function(_,M){return M===void 0&&(M=!1),this.regexp_eatQuantifierPrefix(_,M)?(_.eat(63),!0):!1},Lt.regexp_eatQuantifierPrefix=function(_,M){return _.eat(42)||_.eat(43)||_.eat(63)||this.regexp_eatBracedQuantifier(_,M)},Lt.regexp_eatBracedQuantifier=function(_,M){var B=_.pos;if(_.eat(123)){var R=0,$=-1;if(this.regexp_eatDecimalDigits(_)&&(R=_.lastIntValue,_.eat(44)&&this.regexp_eatDecimalDigits(_)&&($=_.lastIntValue),_.eat(125)))return $!==-1&&$<R&&!M&&_.raise("numbers out of order in {} quantifier"),!0;_.switchU&&!M&&_.raise("Incomplete quantifier"),_.pos=B}return!1},Lt.regexp_eatAtom=function(_){return this.regexp_eatPatternCharacters(_)||_.eat(46)||this.regexp_eatReverseSolidusAtomEscape(_)||this.regexp_eatCharacterClass(_)||this.regexp_eatUncapturingGroup(_)||this.regexp_eatCapturingGroup(_)},Lt.regexp_eatReverseSolidusAtomEscape=function(_){var M=_.pos;if(_.eat(92)){if(this.regexp_eatAtomEscape(_))return!0;_.pos=M}return!1},Lt.regexp_eatUncapturingGroup=function(_){var M=_.pos;if(_.eat(40)){if(_.eat(63)&&_.eat(58)){if(this.regexp_disjunction(_),_.eat(41))return!0;_.raise("Unterminated group")}_.pos=M}return!1},Lt.regexp_eatCapturingGroup=function(_){if(_.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(_):_.current()===63&&_.raise("Invalid group"),this.regexp_disjunction(_),_.eat(41))return _.numCapturingParens+=1,!0;_.raise("Unterminated group")}return!1},Lt.regexp_eatExtendedAtom=function(_){return _.eat(46)||this.regexp_eatReverseSolidusAtomEscape(_)||this.regexp_eatCharacterClass(_)||this.regexp_eatUncapturingGroup(_)||this.regexp_eatCapturingGroup(_)||this.regexp_eatInvalidBracedQuantifier(_)||this.regexp_eatExtendedPatternCharacter(_)},Lt.regexp_eatInvalidBracedQuantifier=function(_){return this.regexp_eatBracedQuantifier(_,!0)&&_.raise("Nothing to repeat"),!1},Lt.regexp_eatSyntaxCharacter=function(_){var M=_.current();return bn(M)?(_.lastIntValue=M,_.advance(),!0):!1};function bn(_){return _===36||_>=40&&_<=43||_===46||_===63||_>=91&&_<=94||_>=123&&_<=125}Lt.regexp_eatPatternCharacters=function(_){for(var M=_.pos,B=0;(B=_.current())!==-1&&!bn(B);)_.advance();return _.pos!==M},Lt.regexp_eatExtendedPatternCharacter=function(_){var M=_.current();return M!==-1&&M!==36&&!(M>=40&&M<=43)&&M!==46&&M!==63&&M!==91&&M!==94&&M!==124?(_.advance(),!0):!1},Lt.regexp_groupSpecifier=function(_){if(_.eat(63)){if(this.regexp_eatGroupName(_)){_.groupNames.indexOf(_.lastStringValue)!==-1&&_.raise("Duplicate capture group name"),_.groupNames.push(_.lastStringValue);return}_.raise("Invalid group")}},Lt.regexp_eatGroupName=function(_){if(_.lastStringValue="",_.eat(60)){if(this.regexp_eatRegExpIdentifierName(_)&&_.eat(62))return!0;_.raise("Invalid capture group name")}return!1},Lt.regexp_eatRegExpIdentifierName=function(_){if(_.lastStringValue="",this.regexp_eatRegExpIdentifierStart(_)){for(_.lastStringValue+=dr(_.lastIntValue);this.regexp_eatRegExpIdentifierPart(_);)_.lastStringValue+=dr(_.lastIntValue);return!0}return!1},Lt.regexp_eatRegExpIdentifierStart=function(_){var M=_.pos,B=this.options.ecmaVersion>=11,R=_.current(B);return _.advance(B),R===92&&this.regexp_eatRegExpUnicodeEscapeSequence(_,B)&&(R=_.lastIntValue),pn(R)?(_.lastIntValue=R,!0):(_.pos=M,!1)};function pn(_){return $t(_,!0)||_===36||_===95}Lt.regexp_eatRegExpIdentifierPart=function(_){var M=_.pos,B=this.options.ecmaVersion>=11,R=_.current(B);return _.advance(B),R===92&&this.regexp_eatRegExpUnicodeEscapeSequence(_,B)&&(R=_.lastIntValue),Pt(R)?(_.lastIntValue=R,!0):(_.pos=M,!1)};function Pt(_){return tr(_,!0)||_===36||_===95||_===8204||_===8205}Lt.regexp_eatAtomEscape=function(_){return this.regexp_eatBackReference(_)||this.regexp_eatCharacterClassEscape(_)||this.regexp_eatCharacterEscape(_)||_.switchN&&this.regexp_eatKGroupName(_)?!0:(_.switchU&&(_.current()===99&&_.raise("Invalid unicode escape"),_.raise("Invalid escape")),!1)},Lt.regexp_eatBackReference=function(_){var M=_.pos;if(this.regexp_eatDecimalEscape(_)){var B=_.lastIntValue;if(_.switchU)return B>_.maxBackReference&&(_.maxBackReference=B),!0;if(B<=_.numCapturingParens)return!0;_.pos=M}return!1},Lt.regexp_eatKGroupName=function(_){if(_.eat(107)){if(this.regexp_eatGroupName(_))return _.backReferenceNames.push(_.lastStringValue),!0;_.raise("Invalid named reference")}return!1},Lt.regexp_eatCharacterEscape=function(_){return this.regexp_eatControlEscape(_)||this.regexp_eatCControlLetter(_)||this.regexp_eatZero(_)||this.regexp_eatHexEscapeSequence(_)||this.regexp_eatRegExpUnicodeEscapeSequence(_,!1)||!_.switchU&&this.regexp_eatLegacyOctalEscapeSequence(_)||this.regexp_eatIdentityEscape(_)},Lt.regexp_eatCControlLetter=function(_){var M=_.pos;if(_.eat(99)){if(this.regexp_eatControlLetter(_))return!0;_.pos=M}return!1},Lt.regexp_eatZero=function(_){return _.current()===48&&!mn(_.lookahead())?(_.lastIntValue=0,_.advance(),!0):!1},Lt.regexp_eatControlEscape=function(_){var M=_.current();return M===116?(_.lastIntValue=9,_.advance(),!0):M===110?(_.lastIntValue=10,_.advance(),!0):M===118?(_.lastIntValue=11,_.advance(),!0):M===102?(_.lastIntValue=12,_.advance(),!0):M===114?(_.lastIntValue=13,_.advance(),!0):!1},Lt.regexp_eatControlLetter=function(_){var M=_.current();return en(M)?(_.lastIntValue=M%32,_.advance(),!0):!1};function en(_){return _>=65&&_<=90||_>=97&&_<=122}Lt.regexp_eatRegExpUnicodeEscapeSequence=function(_,M){M===void 0&&(M=!1);var B=_.pos,R=M||_.switchU;if(_.eat(117)){if(this.regexp_eatFixedHexDigits(_,4)){var $=_.lastIntValue;if(R&&$>=55296&&$<=56319){var be=_.pos;if(_.eat(92)&&_.eat(117)&&this.regexp_eatFixedHexDigits(_,4)){var We=_.lastIntValue;if(We>=56320&&We<=57343)return _.lastIntValue=($-55296)*1024+(We-56320)+65536,!0}_.pos=be,_.lastIntValue=$}return!0}if(R&&_.eat(123)&&this.regexp_eatHexDigits(_)&&_.eat(125)&&zr(_.lastIntValue))return!0;R&&_.raise("Invalid unicode escape"),_.pos=B}return!1};function zr(_){return _>=0&&_<=1114111}Lt.regexp_eatIdentityEscape=function(_){if(_.switchU)return this.regexp_eatSyntaxCharacter(_)?!0:_.eat(47)?(_.lastIntValue=47,!0):!1;var M=_.current();return M!==99&&(!_.switchN||M!==107)?(_.lastIntValue=M,_.advance(),!0):!1},Lt.regexp_eatDecimalEscape=function(_){_.lastIntValue=0;var M=_.current();if(M>=49&&M<=57){do _.lastIntValue=10*_.lastIntValue+(M-48),_.advance();while((M=_.current())>=48&&M<=57);return!0}return!1},Lt.regexp_eatCharacterClassEscape=function(_){var M=_.current();if(Xr(M))return _.lastIntValue=-1,_.advance(),!0;if(_.switchU&&this.options.ecmaVersion>=9&&(M===80||M===112)){if(_.lastIntValue=-1,_.advance(),_.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(_)&&_.eat(125))return!0;_.raise("Invalid property name")}return!1};function Xr(_){return _===100||_===68||_===115||_===83||_===119||_===87}Lt.regexp_eatUnicodePropertyValueExpression=function(_){var M=_.pos;if(this.regexp_eatUnicodePropertyName(_)&&_.eat(61)){var B=_.lastStringValue;if(this.regexp_eatUnicodePropertyValue(_)){var R=_.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(_,B,R),!0}}if(_.pos=M,this.regexp_eatLoneUnicodePropertyNameOrValue(_)){var $=_.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(_,$),!0}return!1},Lt.regexp_validateUnicodePropertyNameAndValue=function(_,M,B){$r(_.unicodeProperties.nonBinary,M)||_.raise("Invalid property name"),_.unicodeProperties.nonBinary[M].test(B)||_.raise("Invalid property value")},Lt.regexp_validateUnicodePropertyNameOrValue=function(_,M){_.unicodeProperties.binary.test(M)||_.raise("Invalid property name")},Lt.regexp_eatUnicodePropertyName=function(_){var M=0;for(_.lastStringValue="";mi(M=_.current());)_.lastStringValue+=dr(M),_.advance();return _.lastStringValue!==""};function mi(_){return en(_)||_===95}Lt.regexp_eatUnicodePropertyValue=function(_){var M=0;for(_.lastStringValue="";tn(M=_.current());)_.lastStringValue+=dr(M),_.advance();return _.lastStringValue!==""};function tn(_){return mi(_)||mn(_)}Lt.regexp_eatLoneUnicodePropertyNameOrValue=function(_){return this.regexp_eatUnicodePropertyValue(_)},Lt.regexp_eatCharacterClass=function(_){if(_.eat(91)){if(_.eat(94),this.regexp_classRanges(_),_.eat(93))return!0;_.raise("Unterminated character class")}return!1},Lt.regexp_classRanges=function(_){for(;this.regexp_eatClassAtom(_);){var M=_.lastIntValue;if(_.eat(45)&&this.regexp_eatClassAtom(_)){var B=_.lastIntValue;_.switchU&&(M===-1||B===-1)&&_.raise("Invalid character class"),M!==-1&&B!==-1&&M>B&&_.raise("Range out of order in character class")}}},Lt.regexp_eatClassAtom=function(_){var M=_.pos;if(_.eat(92)){if(this.regexp_eatClassEscape(_))return!0;if(_.switchU){var B=_.current();(B===99||Pi(B))&&_.raise("Invalid class escape"),_.raise("Invalid escape")}_.pos=M}var R=_.current();return R!==93?(_.lastIntValue=R,_.advance(),!0):!1},Lt.regexp_eatClassEscape=function(_){var M=_.pos;if(_.eat(98))return _.lastIntValue=8,!0;if(_.switchU&&_.eat(45))return _.lastIntValue=45,!0;if(!_.switchU&&_.eat(99)){if(this.regexp_eatClassControlLetter(_))return!0;_.pos=M}return this.regexp_eatCharacterClassEscape(_)||this.regexp_eatCharacterEscape(_)},Lt.regexp_eatClassControlLetter=function(_){var M=_.current();return mn(M)||M===95?(_.lastIntValue=M%32,_.advance(),!0):!1},Lt.regexp_eatHexEscapeSequence=function(_){var M=_.pos;if(_.eat(120)){if(this.regexp_eatFixedHexDigits(_,2))return!0;_.switchU&&_.raise("Invalid escape"),_.pos=M}return!1},Lt.regexp_eatDecimalDigits=function(_){var M=_.pos,B=0;for(_.lastIntValue=0;mn(B=_.current());)_.lastIntValue=10*_.lastIntValue+(B-48),_.advance();return _.pos!==M};function mn(_){return _>=48&&_<=57}Lt.regexp_eatHexDigits=function(_){var M=_.pos,B=0;for(_.lastIntValue=0;Xi(B=_.current());)_.lastIntValue=16*_.lastIntValue+hi(B),_.advance();return _.pos!==M};function Xi(_){return _>=48&&_<=57||_>=65&&_<=70||_>=97&&_<=102}function hi(_){return _>=65&&_<=70?10+(_-65):_>=97&&_<=102?10+(_-97):_-48}Lt.regexp_eatLegacyOctalEscapeSequence=function(_){if(this.regexp_eatOctalDigit(_)){var M=_.lastIntValue;if(this.regexp_eatOctalDigit(_)){var B=_.lastIntValue;M<=3&&this.regexp_eatOctalDigit(_)?_.lastIntValue=M*64+B*8+_.lastIntValue:_.lastIntValue=M*8+B}else _.lastIntValue=M;return!0}return!1},Lt.regexp_eatOctalDigit=function(_){var M=_.current();return Pi(M)?(_.lastIntValue=M-48,_.advance(),!0):(_.lastIntValue=0,!1)};function Pi(_){return _>=48&&_<=55}Lt.regexp_eatFixedHexDigits=function(_,M){var B=_.pos;_.lastIntValue=0;for(var R=0;R<M;++R){var $=_.current();if(!Xi($))return _.pos=B,!1;_.lastIntValue=16*_.lastIntValue+hi($),_.advance()}return!0};var _i=function(M){this.type=M.type,this.value=M.value,this.start=M.start,this.end=M.end,M.options.locations&&(this.loc=new He(M,M.startLoc,M.endLoc)),M.options.ranges&&(this.range=[M.start,M.end])},dt=Fi.prototype;dt.next=function(_){!_&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new _i(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},dt.getToken=function(){return this.next(),new _i(this)},typeof Symbol!="undefined"&&(dt[Symbol.iterator]=function(){var _=this;return{next:function(){var M=_.getToken();return{done:M.type===K.eof,value:M}}}}),dt.curContext=function(){return this.context[this.context.length-1]},dt.nextToken=function(){var _=this.curContext();if((!_||!_.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(K.eof);if(_.override)return _.override(this);this.readToken(this.fullCharCodeAtPos())},dt.readToken=function(_){return $t(_,this.options.ecmaVersion>=6)||_===92?this.readWord():this.getTokenFromCode(_)},dt.fullCharCodeAtPos=function(){var _=this.input.charCodeAt(this.pos);if(_<=55295||_>=57344)return _;var M=this.input.charCodeAt(this.pos+1);return(_<<10)+M-56613888},dt.skipBlockComment=function(){var _=this.options.onComment&&this.curPosition(),M=this.pos,B=this.input.indexOf("*/",this.pos+=2);if(B===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=B+2,this.options.locations){lt.lastIndex=M;for(var R;(R=lt.exec(this.input))&&R.index<this.pos;)++this.curLine,this.lineStart=R.index+R[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(M+2,B),M,this.pos,_,this.curPosition())},dt.skipLineComment=function(_){for(var M=this.pos,B=this.options.onComment&&this.curPosition(),R=this.input.charCodeAt(this.pos+=_);this.pos<this.input.length&&!$e(R);)R=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(M+_,this.pos),M,this.pos,B,this.curPosition())},dt.skipSpace=function(){e:for(;this.pos<this.input.length;){var _=this.input.charCodeAt(this.pos);switch(_){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(_>8&&_<14||_>=5760&&St.test(String.fromCharCode(_)))++this.pos;else break e}}},dt.finishToken=function(_,M){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var B=this.type;this.type=_,this.value=M,this.updateContext(B)},dt.readToken_dot=function(){var _=this.input.charCodeAt(this.pos+1);if(_>=48&&_<=57)return this.readNumber(!0);var M=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&_===46&&M===46?(this.pos+=3,this.finishToken(K.ellipsis)):(++this.pos,this.finishToken(K.dot))},dt.readToken_slash=function(){var _=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):_===61?this.finishOp(K.assign,2):this.finishOp(K.slash,1)},dt.readToken_mult_modulo_exp=function(_){var M=this.input.charCodeAt(this.pos+1),B=1,R=_===42?K.star:K.modulo;return this.options.ecmaVersion>=7&&_===42&&M===42&&(++B,R=K.starstar,M=this.input.charCodeAt(this.pos+2)),M===61?this.finishOp(K.assign,B+1):this.finishOp(R,B)},dt.readToken_pipe_amp=function(_){var M=this.input.charCodeAt(this.pos+1);if(M===_){if(this.options.ecmaVersion>=12){var B=this.input.charCodeAt(this.pos+2);if(B===61)return this.finishOp(K.assign,3)}return this.finishOp(_===124?K.logicalOR:K.logicalAND,2)}return M===61?this.finishOp(K.assign,2):this.finishOp(_===124?K.bitwiseOR:K.bitwiseAND,1)},dt.readToken_caret=function(){var _=this.input.charCodeAt(this.pos+1);return _===61?this.finishOp(K.assign,2):this.finishOp(K.bitwiseXOR,1)},dt.readToken_plus_min=function(_){var M=this.input.charCodeAt(this.pos+1);return M===_?M===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||Xt.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(K.incDec,2):M===61?this.finishOp(K.assign,2):this.finishOp(K.plusMin,1)},dt.readToken_lt_gt=function(_){var M=this.input.charCodeAt(this.pos+1),B=1;return M===_?(B=_===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+B)===61?this.finishOp(K.assign,B+1):this.finishOp(K.bitShift,B)):M===33&&_===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(M===61&&(B=2),this.finishOp(K.relational,B))},dt.readToken_eq_excl=function(_){var M=this.input.charCodeAt(this.pos+1);return M===61?this.finishOp(K.equality,this.input.charCodeAt(this.pos+2)===61?3:2):_===61&&M===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(K.arrow)):this.finishOp(_===61?K.eq:K.prefix,1)},dt.readToken_question=function(){var _=this.options.ecmaVersion;if(_>=11){var M=this.input.charCodeAt(this.pos+1);if(M===46){var B=this.input.charCodeAt(this.pos+2);if(B<48||B>57)return this.finishOp(K.questionDot,2)}if(M===63){if(_>=12){var R=this.input.charCodeAt(this.pos+2);if(R===61)return this.finishOp(K.assign,3)}return this.finishOp(K.coalesce,2)}}return this.finishOp(K.question,1)},dt.getTokenFromCode=function(_){switch(_){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(K.parenL);case 41:return++this.pos,this.finishToken(K.parenR);case 59:return++this.pos,this.finishToken(K.semi);case 44:return++this.pos,this.finishToken(K.comma);case 91:return++this.pos,this.finishToken(K.bracketL);case 93:return++this.pos,this.finishToken(K.bracketR);case 123:return++this.pos,this.finishToken(K.braceL);case 125:return++this.pos,this.finishToken(K.braceR);case 58:return++this.pos,this.finishToken(K.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(K.backQuote);case 48:var M=this.input.charCodeAt(this.pos+1);if(M===120||M===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(M===111||M===79)return this.readRadixNumber(8);if(M===98||M===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(_);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(_);case 124:case 38:return this.readToken_pipe_amp(_);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(_);case 60:case 62:return this.readToken_lt_gt(_);case 61:case 33:return this.readToken_eq_excl(_);case 63:return this.readToken_question();case 126:return this.finishOp(K.prefix,1)}this.raise(this.pos,"Unexpected character '"+Si(_)+"'")},dt.finishOp=function(_,M){var B=this.input.slice(this.pos,this.pos+M);return this.pos+=M,this.finishToken(_,B)},dt.readRegexp=function(){for(var _,M,B=this.pos;;){this.pos>=this.input.length&&this.raise(B,"Unterminated regular expression");var R=this.input.charAt(this.pos);if(Xt.test(R)&&this.raise(B,"Unterminated regular expression"),_)_=!1;else{if(R==="[")M=!0;else if(R==="]"&&M)M=!1;else if(R==="/"&&!M)break;_=R==="\\"}++this.pos}var $=this.input.slice(B,this.pos);++this.pos;var be=this.pos,We=this.readWord1();this.containsEsc&&this.unexpected(be);var ht=this.regexpState||(this.regexpState=new Ft(this));ht.reset(B,$,We),this.validateRegExpFlags(ht),this.validateRegExpPattern(ht);var vt=null;try{vt=new RegExp($,We)}catch(or){}return this.finishToken(K.regexp,{pattern:$,flags:We,value:vt})},dt.readInt=function(_,M,B){for(var R=this.options.ecmaVersion>=12&&M===void 0,$=B&&this.input.charCodeAt(this.pos)===48,be=this.pos,We=0,ht=0,vt=0,or=M==null?Infinity:M;vt<or;++vt,++this.pos){var lr=this.input.charCodeAt(this.pos),Rn=void 0;if(R&&lr===95){$&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),ht===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),vt===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),ht=lr;continue}if(lr>=97?Rn=lr-97+10:lr>=65?Rn=lr-65+10:lr>=48&&lr<=57?Rn=lr-48:Rn=Infinity,Rn>=_)break;ht=lr,We=We*_+Rn}return R&&ht===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===be||M!=null&&this.pos-be!==M?null:We};function It(_,M){return M?parseInt(_,8):parseFloat(_.replace(/_/g,""))}function Ta(_){return typeof BigInt!="function"?null:BigInt(_.replace(/_/g,""))}dt.readRadixNumber=function(_){var M=this.pos;this.pos+=2;var B=this.readInt(_);return B==null&&this.raise(this.start+2,"Expected number in radix "+_),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(B=Ta(this.input.slice(M,this.pos)),++this.pos):$t(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(K.num,B)},dt.readNumber=function(_){var M=this.pos;!_&&this.readInt(10,void 0,!0)===null&&this.raise(M,"Invalid number");var B=this.pos-M>=2&&this.input.charCodeAt(M)===48;B&&this.strict&&this.raise(M,"Invalid number");var R=this.input.charCodeAt(this.pos);if(!B&&!_&&this.options.ecmaVersion>=11&&R===110){var $=Ta(this.input.slice(M,this.pos));return++this.pos,$t(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(K.num,$)}B&&/[89]/.test(this.input.slice(M,this.pos))&&(B=!1),R===46&&!B&&(++this.pos,this.readInt(10),R=this.input.charCodeAt(this.pos)),(R===69||R===101)&&!B&&(R=this.input.charCodeAt(++this.pos),(R===43||R===45)&&++this.pos,this.readInt(10)===null&&this.raise(M,"Invalid number")),$t(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var be=It(this.input.slice(M,this.pos),B);return this.finishToken(K.num,be)},dt.readCodePoint=function(){var _=this.input.charCodeAt(this.pos),M;if(_===123){this.options.ecmaVersion<6&&this.unexpected();var B=++this.pos;M=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,M>1114111&&this.invalidStringToken(B,"Code point out of bounds")}else M=this.readHexChar(4);return M};function Si(_){return _<=65535?String.fromCharCode(_):(_-=65536,String.fromCharCode((_>>10)+55296,(_&1023)+56320))}dt.readString=function(_){for(var M="",B=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var R=this.input.charCodeAt(this.pos);if(R===_)break;R===92?(M+=this.input.slice(B,this.pos),M+=this.readEscapedChar(!1),B=this.pos):($e(R,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return M+=this.input.slice(B,this.pos++),this.finishToken(K.string,M)};var Ii={};dt.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(_){if(_===Ii)this.readInvalidTemplateToken();else throw _}this.inTemplateElement=!1},dt.invalidStringToken=function(_,M){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Ii;this.raise(_,M)},dt.readTmplToken=function(){for(var _="",M=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var B=this.input.charCodeAt(this.pos);if(B===96||B===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===K.template||this.type===K.invalidTemplate)?B===36?(this.pos+=2,this.finishToken(K.dollarBraceL)):(++this.pos,this.finishToken(K.backQuote)):(_+=this.input.slice(M,this.pos),this.finishToken(K.template,_));if(B===92)_+=this.input.slice(M,this.pos),_+=this.readEscapedChar(!0),M=this.pos;else if($e(B)){switch(_+=this.input.slice(M,this.pos),++this.pos,B){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:_+=`
`;break;default:_+=String.fromCharCode(B);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),M=this.pos}else++this.pos}},dt.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(K.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},dt.readEscapedChar=function(_){var M=this.input.charCodeAt(++this.pos);switch(++this.pos,M){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return Si(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(_){var B=this.pos-1;return this.invalidStringToken(B,"Invalid escape sequence in template string"),null}default:if(M>=48&&M<=55){var R=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],$=parseInt(R,8);return $>255&&(R=R.slice(0,-1),$=parseInt(R,8)),this.pos+=R.length-1,M=this.input.charCodeAt(this.pos),(R!=="0"||M===56||M===57)&&(this.strict||_)&&this.invalidStringToken(this.pos-1-R.length,_?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode($)}return $e(M)?"":String.fromCharCode(M)}},dt.readHexChar=function(_){var M=this.pos,B=this.readInt(16,_);return B===null&&this.invalidStringToken(M,"Bad character escape sequence"),B},dt.readWord1=function(){this.containsEsc=!1;for(var _="",M=!0,B=this.pos,R=this.options.ecmaVersion>=6;this.pos<this.input.length;){var $=this.fullCharCodeAtPos();if(tr($,R))this.pos+=$<=65535?1:2;else if($===92){this.containsEsc=!0,_+=this.input.slice(B,this.pos);var be=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var We=this.readCodePoint();(M?$t:tr)(We,R)||this.invalidStringToken(be,"Invalid Unicode escape"),_+=Si(We),B=this.pos}else break;M=!1}return _+this.input.slice(B,this.pos)},dt.readWord=function(){var _=this.readWord1(),M=K.name;return this.keywords.test(_)&&(M=pt[_]),this.finishToken(M,_)};var ji="7.4.1";Fi.acorn={Parser:Fi,version:ji,defaultOptions:it,Position:he,SourceLocation:He,getLineInfo:Ke,Node:Li,TokenType:Mt,tokTypes:K,keywordTypes:pt,TokContext:Uo,tokContexts:Na,isIdentifierChar:tr,isIdentifierStart:$t,Token:_i,isNewLine:$e,lineBreak:Xt,lineBreakG:lt,nonASCIIwhitespace:St};function Ir(_,M){return Fi.parse(_,M)}function un(_,M,B){return Fi.parseExpressionAt(_,M,B)}function _t(_,M){return Fi.tokenizer(_,M)}function aa(_,M){_.prototype=Object.create(M.prototype),_.prototype.constructor=_,_.__proto__=M}function J(_){var M=typeof Map=="function"?new Map:void 0;return J=function(R){if(R===null||!bu(R))return R;if(typeof R!="function")throw new TypeError("Super expression must either be null or a function");if(typeof M!="undefined"){if(M.has(R))return M.get(R);M.set(R,$)}function $(){return na(R,arguments,Ma(this).constructor)}return $.prototype=Object.create(R.prototype,{constructor:{value:$,enumerable:!1,writable:!0,configurable:!0}}),za($,R)},J(_)}function Ko(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(_){return!1}}function na(_,M,B){return Ko()?na=Reflect.construct:na=function($,be,We){var ht=[null];ht.push.apply(ht,be);var vt=Function.bind.apply($,ht),or=new vt;return We&&za(or,We.prototype),or},na.apply(null,arguments)}function bu(_){return Function.toString.call(_).indexOf("[native code]")!==-1}function za(_,M){return za=Object.setPrototypeOf||function(R,$){return R.__proto__=$,R},za(_,M)}function Ma(_){return Ma=Object.setPrototypeOf?Object.getPrototypeOf:function(B){return B.__proto__||Object.getPrototypeOf(B)},Ma(_)}var qa=function(_){aa(M,_);function M(){return _.apply(this,arguments)||this}return M}(J(Error)),oa=function(_){aa(M,_);function M(){return _.apply(this,arguments)||this}return M}(J(SyntaxError)),Ao=function(_){aa(M,_);function M(){return _.apply(this,arguments)||this}return M}(J(ReferenceError)),jo=function(_){aa(M,_);function M(){return _.apply(this,arguments)||this}return M}(J(TypeError)),wu=function(_){aa(M,_);function M(){return _.apply(this,arguments)||this}return M}(qa),vo=function(_){aa(M,_);function M(){return _.apply(this,arguments)||this}return M}(oa),Do=function(_){aa(M,_);function M(){return _.apply(this,arguments)||this}return M}(Ao),sa={UnknownError:[3001,"%0",wu],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",wu],NodeTypeSyntaxError:[1001,"Unknown node type: %0",Do],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",Do],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",Do],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",Do],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",Do],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",Do],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",Do],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",Do],ParamTypeSyntaxError:[1009,"Unknown param type: %0",Do],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",Do],FunctionUndefinedReferenceError:[2001,"%0 is not a function",Ao],VariableUndefinedReferenceError:[2002,"%0 is not defined",Ao],IsNotConstructor:[2003,"%0 is not a constructor",jo]};function Ka(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(_){return!1}}function Fo(_,M,B){return Ka()?Fo=Reflect.construct:Fo=function($,be,We){var ht=[null];ht.push.apply(ht,be);var vt=Function.bind.apply($,ht),or=new vt;return We&&$a(or,We.prototype),or},Fo.apply(null,arguments)}function $a(_,M){return $a=Object.setPrototypeOf||function(R,$){return R.__proto__=$,R},$a(_,M)}var Ms="0.0.3";function Il(_,M){Object.defineProperty(_,"name",{value:M,writable:!1,enumerable:!1,configurable:!0})}var _s=Object.prototype.hasOwnProperty,re=Symbol("Break"),Se=Symbol("Continue"),Ye=Symbol("DefaultCase"),Rt=Symbol("EmptyStatementReturn"),Or=Symbol("WithScopeName"),kn=Symbol("SuperScopeName"),Oi=Symbol("RootScopeName"),ao=Symbol("GlobalScopeName");function Ra(_){return typeof _=="function"}var Za=function(){function _(B){this.interpreter=B}var M=_.prototype;return M.generator=function(){var R=this.interpreter;function $(){return this.getCurrentScope()}function be(){return this.getGlobalScope()}function We(){return this.getCurrentContext()}return{getOptions:R.getOptions.bind(R),getCurrentScope:$.bind(R),getGlobalScope:be.bind(R),getCurrentContext:We.bind(R),getExecStartTime:R.getExecStartTime.bind(R)}},_}();function Vo(_,M,B){if(B===void 0&&(B=!0),!(_ instanceof Za))throw new Error("Illegal call");if(typeof M!="string")return M;if(!!M){var R=_.generator(),$=R.getOptions(),be={timeout:$.timeout,_initEnv:function(){B||this.setCurrentContext(R.getCurrentContext()),this.execStartTime=R.getExecStartTime(),this.execEndTime=this.execStartTime}},We=B?R.getGlobalScope():R.getCurrentScope(),ht=new _a(We,be);return ht.evaluate(M)}}Object.defineProperty(Vo,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function xs(_){if(!(_ instanceof Za))throw new Error("Illegal call");for(var M=_.generator(),B=arguments.length,R=new Array(B>1?B-1:0),$=1;$<B;$++)R[$-1]=arguments[$];var be=R.pop(),We=new _a(M.getGlobalScope(),M.getOptions()),ht=`
		    (function anonymous(`+R.join(",")+`){
		        `+be+`
		    });
		    `;return We.evaluate(ht)}Object.defineProperty(xs,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var uo=function(M){this.value=M},wo=function(M){this.value=M},bs=function(M){this.value=M},Ps=function(M,B,R){B===void 0&&(B=null),this.name=R,this.parent=B,this.data=M,this.labelStack=[]};function Fs(){}function fu(_,M){return _===void 0&&(_=null),new Ps(Object.create(null),_,M)}function Es(_){return Object.create(_)}var ma={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Float64Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:Vo,Function:xs};typeof JSON!="undefined"&&(ma.JSON=JSON),typeof Promise!="undefined"&&(ma.Promise=Promise),typeof Set!="undefined"&&(ma.Set=Set),typeof Map!="undefined"&&(ma.Map=Map),typeof Symbol!="undefined"&&(ma.Symbol=Symbol),typeof Proxy!="undefined"&&(ma.Proxy=Proxy),typeof WeakMap!="undefined"&&(ma.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(ma.WeakSet=WeakSet),typeof Reflect!="undefined"&&(ma.Reflect=Reflect);var _a=function(){function _(B,R){B===void 0&&(B=_.global),R===void 0&&(R={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:R.ecmaVersion||_.ecmaVersion,timeout:R.timeout||0,rootContext:R.rootContext,globalContextInFunction:R.globalContextInFunction===void 0?_.globalContextInFunction:R.globalContextInFunction,_initEnv:R._initEnv},this.context=B||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var M=_.prototype;return M.initEnvironment=function(R){var $;if(R instanceof Ps)$=R;else{var be=null,We=this.createSuperScope(R);this.options.rootContext&&(be=new Ps(Es(this.options.rootContext),We,Oi)),$=new Ps(R,be||We,ao)}this.globalScope=$,this.currentScope=this.globalScope,this.globalContext=$.data,this.currentContext=$.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var ht=this.options._initEnv;ht&&ht.call(this)},M.getExecStartTime=function(){return this.execStartTime},M.getExecutionTime=function(){return this.execEndTime-this.execStartTime},M.setExecTimeout=function(R){R===void 0&&(R=0),this.options.timeout=R},M.getOptions=function(){return this.options},M.getGlobalScope=function(){return this.globalScope},M.getCurrentScope=function(){return this.currentScope},M.getCurrentContext=function(){return this.currentContext},M.isInterruptThrow=function(R){return R instanceof wu||R instanceof Do||R instanceof vo},M.createSuperScope=function(R){var $=Object.assign({},ma),be=Object.keys($);return be.forEach(function(We){We in R&&delete $[We]}),new Ps($,null,kn)},M.setCurrentContext=function(R){this.currentContext=R},M.setCurrentScope=function(R){this.currentScope=R},M.evaluate=function(R){R===void 0&&(R="");var $;if(!!R)return $=Ir(R,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||_.ecmaVersion}),this.evaluateNode($,R)},M.appendCode=function(R){return this.evaluate(R)},M.evaluateNode=function(R,$){var be=this;$===void 0&&($=""),this.value=void 0,this.source=$,this.sourceList.push($),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var We=this.getCurrentScope(),ht=this.getCurrentContext(),vt=We.labelStack.concat([]),or=this.callStack.concat([]),lr=function(){be.setCurrentScope(We),be.setCurrentContext(ht),We.labelStack=vt,be.callStack=or};try{var Rn=this.createClosure(R);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),Rn()}catch(ai){throw ai}finally{lr(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},M.createErrorMessage=function(R,$,be){var We=R[1].replace("%0",String($));return be!==null&&(We+=this.getNodePosition(be||this.lastExecNode)),We},M.createError=function(R,$){return new $(R)},M.createThrowError=function(R,$){return this.createError(R,$)},M.createInternalThrowError=function(R,$,be){return this.createError(this.createErrorMessage(R,$,be),R[2])},M.checkTimeout=function(){if(!this.isRunning)return!1;var R=this.options.timeout||0,$=Date.now();return $-this.execStartTime>R},M.getNodePosition=function(R){if(R){var $="";return R.loc?" ["+R.loc.start.line+":"+R.loc.start.column+"]"+$:""}return""},M.createClosure=function(R){var $=this,be;switch(R.type){case"BinaryExpression":be=this.binaryExpressionHandler(R);break;case"LogicalExpression":be=this.logicalExpressionHandler(R);break;case"UnaryExpression":be=this.unaryExpressionHandler(R);break;case"UpdateExpression":be=this.updateExpressionHandler(R);break;case"ObjectExpression":be=this.objectExpressionHandler(R);break;case"ArrayExpression":be=this.arrayExpressionHandler(R);break;case"CallExpression":be=this.callExpressionHandler(R);break;case"NewExpression":be=this.newExpressionHandler(R);break;case"MemberExpression":be=this.memberExpressionHandler(R);break;case"ThisExpression":be=this.thisExpressionHandler(R);break;case"SequenceExpression":be=this.sequenceExpressionHandler(R);break;case"Literal":be=this.literalHandler(R);break;case"Identifier":be=this.identifierHandler(R);break;case"AssignmentExpression":be=this.assignmentExpressionHandler(R);break;case"FunctionDeclaration":be=this.functionDeclarationHandler(R);break;case"VariableDeclaration":be=this.variableDeclarationHandler(R);break;case"BlockStatement":case"Program":be=this.programHandler(R);break;case"ExpressionStatement":be=this.expressionStatementHandler(R);break;case"EmptyStatement":be=this.emptyStatementHandler(R);break;case"ReturnStatement":be=this.returnStatementHandler(R);break;case"FunctionExpression":be=this.functionExpressionHandler(R);break;case"IfStatement":be=this.ifStatementHandler(R);break;case"ConditionalExpression":be=this.conditionalExpressionHandler(R);break;case"ForStatement":be=this.forStatementHandler(R);break;case"WhileStatement":be=this.whileStatementHandler(R);break;case"DoWhileStatement":be=this.doWhileStatementHandler(R);break;case"ForInStatement":be=this.forInStatementHandler(R);break;case"WithStatement":be=this.withStatementHandler(R);break;case"ThrowStatement":be=this.throwStatementHandler(R);break;case"TryStatement":be=this.tryStatementHandler(R);break;case"ContinueStatement":be=this.continueStatementHandler(R);break;case"BreakStatement":be=this.breakStatementHandler(R);break;case"SwitchStatement":be=this.switchStatementHandler(R);break;case"LabeledStatement":be=this.labeledStatementHandler(R);break;case"DebuggerStatement":be=this.debuggerStatementHandler(R);break;default:throw this.createInternalThrowError(sa.NodeTypeSyntaxError,R.type,R)}return function(){var We=$.options.timeout;if(We&&We>0&&$.checkTimeout())throw $.createInternalThrowError(sa.ExecutionTimeOutError,We,null);return $.lastExecNode=R,be.apply(void 0,arguments)}},M.binaryExpressionHandler=function(R){var $=this,be=this.createClosure(R.left),We=this.createClosure(R.right);return function(){var ht=be(),vt=We();switch(R.operator){case"==":return ht==vt;case"!=":return ht!=vt;case"===":return ht===vt;case"!==":return ht!==vt;case"<":return ht<vt;case"<=":return ht<=vt;case">":return ht>vt;case">=":return ht>=vt;case"<<":return ht<<vt;case">>":return ht>>vt;case">>>":return ht>>>vt;case"+":return ht+vt;case"-":return ht-vt;case"*":return ht*vt;case"**":return Math.pow(ht,vt);case"/":return ht/vt;case"%":return ht%vt;case"|":return ht|vt;case"^":return ht^vt;case"&":return ht&vt;case"in":return ht in vt;case"instanceof":return ht instanceof vt;default:throw $.createInternalThrowError(sa.BinaryOperatorSyntaxError,R.operator,R)}}},M.logicalExpressionHandler=function(R){var $=this,be=this.createClosure(R.left),We=this.createClosure(R.right);return function(){switch(R.operator){case"||":return be()||We();case"&&":return be()&&We();default:throw $.createInternalThrowError(sa.LogicalOperatorSyntaxError,R.operator,R)}}},M.unaryExpressionHandler=function(R){var $=this;switch(R.operator){case"delete":var be=this.createObjectGetter(R.argument),We=this.createNameGetter(R.argument);return function(){var lr=be(),Rn=We();return delete lr[Rn]};default:var ht;if(R.operator==="typeof"&&R.argument.type==="Identifier"){var vt=this.createObjectGetter(R.argument),or=this.createNameGetter(R.argument);ht=function(){return vt()[or()]}}else ht=this.createClosure(R.argument);return function(){var lr=ht();switch(R.operator){case"-":return-lr;case"+":return+lr;case"!":return!lr;case"~":return~lr;case"void":return;case"typeof":return typeof lr;default:throw $.createInternalThrowError(sa.UnaryOperatorSyntaxError,R.operator,R)}}}},M.updateExpressionHandler=function(R){var $=this,be=this.createObjectGetter(R.argument),We=this.createNameGetter(R.argument);return function(){var ht=be(),vt=We();switch($.assertVariable(ht,vt,R),R.operator){case"++":return R.prefix?++ht[vt]:ht[vt]++;case"--":return R.prefix?--ht[vt]:ht[vt]--;default:throw $.createInternalThrowError(sa.UpdateOperatorSyntaxError,R.operator,R)}}},M.objectExpressionHandler=function(R){var $=this,be=[];function We(vt){return vt.type==="Identifier"?vt.name:vt.type==="Literal"?vt.value:this.throwError(sa.ObjectStructureSyntaxError,vt.type,vt)}var ht=Object.create(null);return R.properties.forEach(function(vt){var or=vt.kind,lr=We(vt.key);(!ht[lr]||or==="init")&&(ht[lr]={}),ht[lr][or]=$.createClosure(vt.value),be.push({key:lr,property:vt})}),function(){for(var vt={},or=be.length,lr=0;lr<or;lr++){var Rn=be[lr],ai=Rn.key,Fn=ht[ai],Yi=Fn.init?Fn.init():void 0,da=Fn.get?Fn.get():function(){},Ca=Fn.set?Fn.set():function(qu){};if("set"in Fn||"get"in Fn){var Hi={configurable:!0,enumerable:!0,get:da,set:Ca};Object.defineProperty(vt,ai,Hi)}else{var Ss=Rn.property,hu=Ss.kind;Ss.key.type==="Identifier"&&Ss.value.type==="FunctionExpression"&&hu==="init"&&!Ss.value.id&&Il(Yi,Ss.key.name),vt[ai]=Yi}}return vt}},M.arrayExpressionHandler=function(R){var $=this,be=R.elements.map(function(We){return We&&$.createClosure(We)});return function(){for(var We=be.length,ht=Array(We),vt=0;vt<We;vt++){var or=be[vt];or&&(ht[vt]=or())}return ht}},M.safeObjectGet=function(R,$,be){return R[$]},M.createCallFunctionGetter=function(R){var $=this;switch(R.type){case"MemberExpression":var be=this.createClosure(R.object),We=this.createMemberKeyGetter(R),ht=this.source;return function(){var or=be(),lr=We(),Rn=$.safeObjectGet(or,lr,R);if(!Rn||!Ra(Rn)){var ai=ht.slice(R.start,R.end);throw $.createInternalThrowError(sa.FunctionUndefinedReferenceError,ai,R)}return Rn.__IS_EVAL_FUNC?function(Fn){return Rn(new Za($),Fn,!0)}:Rn.__IS_FUNCTION_FUNC?function(){for(var Fn=arguments.length,Yi=new Array(Fn),da=0;da<Fn;da++)Yi[da]=arguments[da];return Rn.apply(void 0,[new Za($)].concat(Yi))}:Rn.bind(or)};default:var vt=this.createClosure(R);return function(){var or="";R.type==="Identifier"&&(or=R.name);var lr=vt();if(!lr||!Ra(lr))throw $.createInternalThrowError(sa.FunctionUndefinedReferenceError,or,R);if(R.type==="Identifier"&&lr.__IS_EVAL_FUNC&&or==="eval")return function(Fn){var Yi=$.getScopeFromName(or,$.getCurrentScope()),da=Yi.name===kn||Yi.name===ao||Yi.name===Oi;return lr(new Za($),Fn,!da)};if(lr.__IS_EVAL_FUNC)return function(Fn){return lr(new Za($),Fn,!0)};if(lr.__IS_FUNCTION_FUNC)return function(){for(var Fn=arguments.length,Yi=new Array(Fn),da=0;da<Fn;da++)Yi[da]=arguments[da];return lr.apply(void 0,[new Za($)].concat(Yi))};var Rn=$.options.globalContextInFunction;if(R.type==="Identifier"){var ai=$.getIdentifierScope(R);ai.name===Or&&(Rn=ai.data)}return lr.bind(Rn)}}},M.callExpressionHandler=function(R){var $=this,be=this.createCallFunctionGetter(R.callee),We=R.arguments.map(function(ht){return $.createClosure(ht)});return function(){return be().apply(void 0,We.map(function(ht){return ht()}))}},M.functionExpressionHandler=function(R){var $=this,be=this,We=this.source,ht=this.collectDeclVars,vt=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var or=R.id?R.id.name:"",lr=R.params.length,Rn=R.params.map(function(da){return $.createParamNameGetter(da)}),ai=this.createClosure(R.body),Fn=this.collectDeclVars,Yi=this.collectDeclFuncs;return this.collectDeclVars=ht,this.collectDeclFuncs=vt,function(){var da=be.getCurrentScope(),Ca=function Hi(){for(var Ss=arguments.length,hu=new Array(Ss),qu=0;qu<Ss;qu++)hu[qu]=arguments[qu];be.callStack.push(""+or);var gf=be.getCurrentScope(),ll=fu(da,"FunctionScope("+or+")");be.setCurrentScope(ll),be.addDeclarationsToScope(Fn,Yi,ll),or&&(ll.data[or]=Hi),ll.data.arguments=arguments,Rn.forEach(function(Mu,Pu){ll.data[Mu()]=hu[Pu]});var Bc=be.getCurrentContext();be.setCurrentContext(this);var Tu=ai();if(be.setCurrentContext(Bc),be.setCurrentScope(gf),be.callStack.pop(),Tu instanceof uo)return Tu.value};return Il(Ca,or),Object.defineProperty(Ca,"length",{value:lr,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(Ca,"toString",{value:function(){return We.slice(R.start,R.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(Ca,"valueOf",{value:function(){return We.slice(R.start,R.end)},writable:!0,configurable:!0,enumerable:!1}),Ca}},M.newExpressionHandler=function(R){var $=this,be=this.source,We=this.createClosure(R.callee),ht=R.arguments.map(function(vt){return $.createClosure(vt)});return function(){var vt=We();if(!Ra(vt)||vt.__IS_EVAL_FUNC){var or=R.callee,lr=be.slice(or.start,or.end);throw $.createInternalThrowError(sa.IsNotConstructor,lr,R)}return vt.__IS_FUNCTION_FUNC?vt.apply(void 0,[new Za($)].concat(ht.map(function(Rn){return Rn()}))):Fo(vt,ht.map(function(Rn){return Rn()}))}},M.memberExpressionHandler=function(R){var $=this.createClosure(R.object),be=this.createMemberKeyGetter(R);return function(){var We=$(),ht=be();return We[ht]}},M.thisExpressionHandler=function(R){var $=this;return function(){return $.getCurrentContext()}},M.sequenceExpressionHandler=function(R){var $=this,be=R.expressions.map(function(We){return $.createClosure(We)});return function(){for(var We,ht=be.length,vt=0;vt<ht;vt++){var or=be[vt];We=or()}return We}},M.literalHandler=function(R){return function(){return R.regex?new RegExp(R.regex.pattern,R.regex.flags):R.value}},M.identifierHandler=function(R){var $=this;return function(){var be=$.getCurrentScope(),We=$.getScopeDataFromName(R.name,be);return $.assertVariable(We,R.name,R),We[R.name]}},M.getIdentifierScope=function(R){var $=this.getCurrentScope(),be=this.getScopeFromName(R.name,$);return be},M.assignmentExpressionHandler=function(R){var $=this;R.left.type==="Identifier"&&R.right.type==="FunctionExpression"&&!R.right.id&&(R.right.id={type:"Identifier",name:R.left.name});var be=this.createObjectGetter(R.left),We=this.createNameGetter(R.left),ht=this.createClosure(R.right);return function(){var vt=be(),or=We(),lr=ht();switch(R.operator!=="="&&$.assertVariable(vt,or,R),R.operator){case"=":return vt[or]=lr;case"+=":return vt[or]+=lr;case"-=":return vt[or]-=lr;case"*=":return vt[or]*=lr;case"**=":return vt[or]=Math.pow(vt[or],lr);case"/=":return vt[or]/=lr;case"%=":return vt[or]%=lr;case"<<=":return vt[or]<<=lr;case">>=":return vt[or]>>=lr;case">>>=":return vt[or]>>>=lr;case"&=":return vt[or]&=lr;case"^=":return vt[or]^=lr;case"|=":return vt[or]|=lr;default:throw $.createInternalThrowError(sa.AssignmentExpressionSyntaxError,R.type,R)}}},M.functionDeclarationHandler=function(R){if(R.id){var $=this.functionExpressionHandler(R);Object.defineProperty($,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(R.id.name,$)}return function(){return Rt}},M.getVariableName=function(R){if(R.type==="Identifier")return R.name;throw this.createInternalThrowError(sa.VariableTypeSyntaxError,R.type,R)},M.variableDeclarationHandler=function(R){for(var $=this,be,We=[],ht=0;ht<R.declarations.length;ht++){var vt=R.declarations[ht];this.varDeclaration(this.getVariableName(vt.id)),vt.init&&We.push({type:"AssignmentExpression",operator:"=",left:vt.id,right:vt.init})}return We.length&&(be=this.createClosure({type:"BlockStatement",body:We})),function(){if(be){var or=$.isVarDeclMode;$.isVarDeclMode=!0,be(),$.isVarDeclMode=or}return Rt}},M.assertVariable=function(R,$,be){if(R===this.globalScope.data&&!($ in R))throw this.createInternalThrowError(sa.VariableUndefinedReferenceError,$,be)},M.programHandler=function(R){var $=this,be=R.body.map(function(We){return $.createClosure(We)});return function(){for(var We=Rt,ht=0;ht<be.length;ht++){var vt=be[ht],or=$.setValue(vt());if(or!==Rt&&(We=or,We instanceof uo||We instanceof wo||We instanceof bs||We===re||We===Se))break}return We}},M.expressionStatementHandler=function(R){return this.createClosure(R.expression)},M.emptyStatementHandler=function(R){return function(){return Rt}},M.returnStatementHandler=function(R){var $=R.argument?this.createClosure(R.argument):Fs;return function(){return new uo($())}},M.ifStatementHandler=function(R){var $=this.createClosure(R.test),be=this.createClosure(R.consequent),We=R.alternate?this.createClosure(R.alternate):function(){return Rt};return function(){return $()?be():We()}},M.conditionalExpressionHandler=function(R){return this.ifStatementHandler(R)},M.forStatementHandler=function(R){var $=this,be=Fs,We=R.test?this.createClosure(R.test):function(){return!0},ht=Fs,vt=this.createClosure(R.body);return R.type==="ForStatement"&&(be=R.init?this.createClosure(R.init):be,ht=R.update?this.createClosure(R.update):Fs),function(or){var lr,Rn=Rt,ai=R.type==="DoWhileStatement";for(or&&or.type==="LabeledStatement"&&(lr=or.label.name),be();ai||We();ht()){ai=!1;var Fn=$.setValue(vt());if(!(Fn===Rt||Fn===Se)){if(Fn===re)break;if(Rn=Fn,Rn instanceof bs&&Rn.value===lr){Rn=Rt;continue}if(Rn instanceof uo||Rn instanceof wo||Rn instanceof bs)break}}return Rn}},M.whileStatementHandler=function(R){return this.forStatementHandler(R)},M.doWhileStatementHandler=function(R){return this.forStatementHandler(R)},M.forInStatementHandler=function(R){var $=this,be=R.left,We=this.createClosure(R.right),ht=this.createClosure(R.body);return R.left.type==="VariableDeclaration"&&(this.createClosure(R.left)(),be=R.left.declarations[0].id),function(vt){var or,lr=Rt,Rn;vt&&vt.type==="LabeledStatement"&&(or=vt.label.name);var ai=We();for(Rn in ai){$.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:be,right:{type:"Literal",value:Rn}})();var Fn=$.setValue(ht());if(!(Fn===Rt||Fn===Se)){if(Fn===re)break;if(lr=Fn,lr instanceof bs&&lr.value===or){lr=Rt;continue}if(lr instanceof uo||lr instanceof wo||lr instanceof bs)break}}return lr}},M.withStatementHandler=function(R){var $=this,be=this.createClosure(R.object),We=this.createClosure(R.body);return function(){var ht=be(),vt=$.getCurrentScope(),or=new Ps(ht,vt,Or);$.setCurrentScope(or);var lr=$.setValue(We());return $.setCurrentScope(vt),lr}},M.throwStatementHandler=function(R){var $=this,be=this.createClosure(R.argument);return function(){throw $.setValue(void 0),be()}},M.tryStatementHandler=function(R){var $=this,be=this.createClosure(R.block),We=R.handler?this.catchClauseHandler(R.handler):null,ht=R.finalizer?this.createClosure(R.finalizer):null;return function(){var vt=$.getCurrentScope(),or=$.getCurrentContext(),lr=vt.labelStack.concat([]),Rn=$.callStack.concat([]),ai=Rt,Fn,Yi,da=function(){$.setCurrentScope(vt),$.setCurrentContext(or),vt.labelStack=lr,$.callStack=Rn};try{ai=$.setValue(be()),ai instanceof uo&&(Fn=ai)}catch(Ca){if(da(),$.isInterruptThrow(Ca))throw Ca;if(We)try{ai=$.setValue(We(Ca)),ai instanceof uo&&(Fn=ai)}catch(Hi){if(da(),$.isInterruptThrow(Hi))throw Hi;Yi=Hi}}if(ht)try{ai=ht(),ai instanceof uo&&(Fn=ai)}catch(Ca){if(da(),$.isInterruptThrow(Ca))throw Ca;Yi=Ca}if(Yi)throw Yi;return Fn||ai}},M.catchClauseHandler=function(R){var $=this,be=this.createParamNameGetter(R.param),We=this.createClosure(R.body);return function(ht){var vt,or=$.getCurrentScope(),lr=or.data,Rn=be(),ai=_s.call(lr,Rn),Fn=lr[Rn];return lr[Rn]=ht,vt=We(),ai?lr[Rn]=Fn:delete lr[Rn],vt}},M.continueStatementHandler=function(R){return function(){return R.label?new bs(R.label.name):Se}},M.breakStatementHandler=function(R){return function(){return R.label?new wo(R.label.name):re}},M.switchStatementHandler=function(R){var $=this,be=this.createClosure(R.discriminant),We=R.cases.map(function(ht){return $.switchCaseHandler(ht)});return function(){for(var ht=be(),vt=!1,or,lr,Rn,ai=0;ai<We.length;ai++){var Fn=We[ai](),Yi=Fn.testClosure();if(Yi===Ye){Rn=Fn;continue}if(vt||Yi===ht){if(vt=!0,lr=$.setValue(Fn.bodyClosure()),lr===Rt)continue;if(lr===re||(or=lr,or instanceof uo||or instanceof wo||or instanceof bs||or===Se))break}}if(!vt&&Rn){lr=$.setValue(Rn.bodyClosure());var da=lr===Rt||lr===re||lr===Se;da||(or=lr)}return or}},M.switchCaseHandler=function(R){var $=R.test?this.createClosure(R.test):function(){return Ye},be=this.createClosure({type:"BlockStatement",body:R.consequent});return function(){return{testClosure:$,bodyClosure:be}}},M.labeledStatementHandler=function(R){var $=this,be=R.label.name,We=this.createClosure(R.body);return function(){var ht,vt=$.getCurrentScope();return vt.labelStack.push(be),ht=We(R),ht instanceof wo&&ht.value===be&&(ht=Rt),vt.labelStack.pop(),ht}},M.debuggerStatementHandler=function(R){return function(){debugger;return Rt}},M.createParamNameGetter=function(R){if(R.type==="Identifier")return function(){return R.name};throw this.createInternalThrowError(sa.ParamTypeSyntaxError,R.type,R)},M.createObjectKeyGetter=function(R){var $;return R.type==="Identifier"?$=function(){return R.name}:$=this.createClosure(R),function(){return $()}},M.createMemberKeyGetter=function(R){return R.computed?this.createClosure(R.property):this.createObjectKeyGetter(R.property)},M.createObjectGetter=function(R){var $=this;switch(R.type){case"Identifier":return function(){return $.getScopeDataFromName(R.name,$.getCurrentScope())};case"MemberExpression":return this.createClosure(R.object);default:throw this.createInternalThrowError(sa.AssignmentTypeSyntaxError,R.type,R)}},M.createNameGetter=function(R){switch(R.type){case"Identifier":return function(){return R.name};case"MemberExpression":return this.createMemberKeyGetter(R);default:throw this.createInternalThrowError(sa.AssignmentTypeSyntaxError,R.type,R)}},M.varDeclaration=function(R){var $=this.collectDeclVars;$[R]=void 0},M.funcDeclaration=function(R,$){var be=this.collectDeclFuncs;be[R]=$},M.addDeclarationsToScope=function(R,$,be){var We=be.data;for(var ht in $){var vt=$[ht];We[ht]=vt&&vt()}for(var or in R)or in We||(We[or]=void 0)},M.getScopeValue=function(R,$){var be=this.getScopeFromName(R,$);return be.data[R]},M.getScopeDataFromName=function(R,$){return this.getScopeFromName(R,$).data},M.getScopeFromName=function(R,$){var be=$;do if(R in be.data)return be;while(be=be.parent);return this.globalScope},M.setValue=function(R){var $=this.callStack.length;return this.isVarDeclMode||$||R===Rt||R===re||R===Se||R instanceof wo||R instanceof bs||(this.value=R instanceof uo?R.value:R),R},M.getValue=function(){return this.value},_}();_a.version=Ms,_a.eval=Vo,_a.Function=xs,_a.ecmaVersion=5,_a.globalContextInFunction=void 0,_a.global=Object.create(null);function as(_){return _===void 0&&(_=Object.create(null)),_}function mf(_,M,B){M===void 0&&(M=[]),B===void 0&&(B={});var R=B.parsingContext,$=B.timeout===void 0?0:B.timeout,be=`
    (function anonymous(`+M.join(",")+`){
         `+_+`
    });
    `,We=new _a(R,{ecmaVersion:B.ecmaVersion,timeout:$,rootContext:B.rootContext,globalContextInFunction:B.globalContextInFunction});return We.evaluate(be)}function Ol(_,M,B){var R=new _a(M,B);return R.evaluate(_)}var qs=Ol,ac=function(){function _(B){this._code=B}var M=_.prototype;return M.runInContext=function(R){return Ol(this._code,R)},M.runInNewContext=function(R){return Ol(this._code,R)},_}(),Yu=function(_,M,B){return Ol(_,M,B)};function Ks(){for(var _=arguments.length,M=new Array(_),B=0;B<_;B++)M[B]=arguments[B];var R=M.pop();return mf(R||"",M)}var ul=Yu},20396:function(Jt,te,W){var _e;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(ue,g,Ee,H){"use strict";var ae=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,le=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),Be=ae||le,ye=["","webkit","Moz","MS","ms","o"],Je=Be?"":g.createElement("div"),st="function",yt=Math.round,$t=Math.abs,tr=Date.now;function Mt(re,Se,Ye){return setTimeout(lt(re,Ye),Se)}function Qt(re,Se,Ye){return Array.isArray(re)?(Bt(re,Ye[Se],Ye),!0):!1}function Bt(re,Se,Ye){var Rt;if(!!re)if(re.forEach)re.forEach(Se,Ye);else if(re.length!==H)for(Rt=0;Rt<re.length;)Se.call(Ye,re[Rt],Rt,re),Rt++;else for(Rt in re)re.hasOwnProperty(Rt)&&Se.call(Ye,re[Rt],Rt,re)}function ut(re,Se,Ye){var Rt="DEPRECATED METHOD: "+Se+`
`+Ye+` AT 
`;return function(){var Or=new Error("get-stack-trace"),kn=Or&&Or.stack?Or.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Oi=ue.console&&(ue.console.warn||ue.console.log);return Oi&&Oi.call(ue.console,Rt,kn),re.apply(this,arguments)}}var pt;typeof Object.assign!="function"?pt=function(Se){if(Se===H||Se===null)throw new TypeError("Cannot convert undefined or null to object");for(var Ye=Object(Se),Rt=1;Rt<arguments.length;Rt++){var Or=arguments[Rt];if(Or!==H&&Or!==null)for(var kn in Or)Or.hasOwnProperty(kn)&&(Ye[kn]=Or[kn])}return Ye}:pt=Object.assign;var rr=ut(function(Se,Ye,Rt){for(var Or=Object.keys(Ye),kn=0;kn<Or.length;)(!Rt||Rt&&Se[Or[kn]]===H)&&(Se[Or[kn]]=Ye[Or[kn]]),kn++;return Se},"extend","Use `assign`."),K=ut(function(Se,Ye){return rr(Se,Ye,!0)},"merge","Use `assign`.");function Xt(re,Se,Ye){var Rt=Se.prototype,Or;Or=re.prototype=Object.create(Rt),Or.constructor=re,Or._super=Rt,Ye&&pt(Or,Ye)}function lt(re,Se){return function(){return re.apply(Se,arguments)}}function $e(re,Se){return typeof re==st?re.apply(Se&&Se[0]||H,Se):re}function St(re,Se){return re===H?Se:re}function et(re,Se,Ye){Bt($r(Se),function(Rt){re.addEventListener(Rt,Ye,!1)})}function Ht(re,Se,Ye){Bt($r(Se),function(Rt){re.removeEventListener(Rt,Ye,!1)})}function Er(re,Se){for(;re;){if(re==Se)return!0;re=re.parentNode}return!1}function kr(re,Se){return re.indexOf(Se)>-1}function $r(re){return re.trim().split(/\s+/g)}function S(re,Se,Ye){if(re.indexOf&&!Ye)return re.indexOf(Se);for(var Rt=0;Rt<re.length;){if(Ye&&re[Rt][Ye]==Se||!Ye&&re[Rt]===Se)return Rt;Rt++}return-1}function pe(re){return Array.prototype.slice.call(re,0)}function he(re,Se,Ye){for(var Rt=[],Or=[],kn=0;kn<re.length;){var Oi=Se?re[kn][Se]:re[kn];S(Or,Oi)<0&&Rt.push(re[kn]),Or[kn]=Oi,kn++}return Ye&&(Se?Rt=Rt.sort(function(Ra,Za){return Ra[Se]>Za[Se]}):Rt=Rt.sort()),Rt}function He(re,Se){for(var Ye,Rt,Or=Se[0].toUpperCase()+Se.slice(1),kn=0;kn<ye.length;){if(Ye=ye[kn],Rt=Ye?Ye+Or:Se,Rt in re)return Rt;kn++}return H}var Ke=1;function it(){return Ke++}function bt(re){var Se=re.ownerDocument||re;return Se.defaultView||Se.parentWindow||ue}var nr=/mobile|tablet|ip(ad|hone|od)|android/i,Nr="ontouchstart"in ue,wr=He(ue,"PointerEvent")!==H,xn=Nr&&nr.test(navigator.userAgent),an="touch",Dn="pen",jn="mouse",In="kinect",ii=25,wi=1,Ei=2,Ti=4,Gi=8,Qi=1,po=2,Sa=4,pa=8,Fi=16,ra=po|Sa,$i=pa|Fi,is=ra|$i,me=["x","y"],li=["clientX","clientY"];function bo(re,Se){var Ye=this;this.manager=re,this.callback=Se,this.element=re.element,this.target=re.options.inputTarget,this.domHandler=function(Rt){$e(re.options.enable,[re])&&Ye.handler(Rt)},this.init()}bo.prototype={handler:function(){},init:function(){this.evEl&&et(this.element,this.evEl,this.domHandler),this.evTarget&&et(this.target,this.evTarget,this.domHandler),this.evWin&&et(bt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Ht(this.element,this.evEl,this.domHandler),this.evTarget&&Ht(this.target,this.evTarget,this.domHandler),this.evWin&&Ht(bt(this.element),this.evWin,this.domHandler)}};function cu(re){var Se,Ye=re.options.inputClass;return Ye?Se=Ye:wr?Se=Ie:xn?Se=Ft:Nr?Se=Pt:Se=xa,new Se(re,Zt)}function Zt(re,Se,Ye){var Rt=Ye.pointers.length,Or=Ye.changedPointers.length,kn=Se&wi&&Rt-Or==0,Oi=Se&(Ti|Gi)&&Rt-Or==0;Ye.isFirst=!!kn,Ye.isFinal=!!Oi,kn&&(re.session={}),Ye.eventType=Se,er(re,Ye),re.emit("hammer.input",Ye),re.recognize(Ye),re.session.prevInput=Ye}function er(re,Se){var Ye=re.session,Rt=Se.pointers,Or=Rt.length;Ye.firstInput||(Ye.firstInput=On(Se)),Or>1&&!Ye.firstMultiple?Ye.firstMultiple=On(Se):Or===1&&(Ye.firstMultiple=!1);var kn=Ye.firstInput,Oi=Ye.firstMultiple,ao=Oi?Oi.center:kn.center,Ra=Se.center=Vn(Rt);Se.timeStamp=tr(),Se.deltaTime=Se.timeStamp-kn.timeStamp,Se.angle=Bi(ao,Ra),Se.distance=An(ao,Ra),Lr(Ye,Se),Se.offsetDirection=vi(Se.deltaX,Se.deltaY);var Za=bi(Se.deltaTime,Se.deltaX,Se.deltaY);Se.overallVelocityX=Za.x,Se.overallVelocityY=Za.y,Se.overallVelocity=$t(Za.x)>$t(Za.y)?Za.x:Za.y,Se.scale=Oi?io(Oi.pointers,Rt):1,Se.rotation=Oi?Li(Oi.pointers,Rt):0,Se.maxPointers=Ye.prevInput?Se.pointers.length>Ye.prevInput.maxPointers?Se.pointers.length:Ye.prevInput.maxPointers:Se.pointers.length,sn(Ye,Se);var Vo=re.element;Er(Se.srcEvent.target,Vo)&&(Vo=Se.srcEvent.target),Se.target=Vo}function Lr(re,Se){var Ye=Se.center,Rt=re.offsetDelta||{},Or=re.prevDelta||{},kn=re.prevInput||{};(Se.eventType===wi||kn.eventType===Ti)&&(Or=re.prevDelta={x:kn.deltaX||0,y:kn.deltaY||0},Rt=re.offsetDelta={x:Ye.x,y:Ye.y}),Se.deltaX=Or.x+(Ye.x-Rt.x),Se.deltaY=Or.y+(Ye.y-Rt.y)}function sn(re,Se){var Ye=re.lastInterval||Se,Rt=Se.timeStamp-Ye.timeStamp,Or,kn,Oi,ao;if(Se.eventType!=Gi&&(Rt>ii||Ye.velocity===H)){var Ra=Se.deltaX-Ye.deltaX,Za=Se.deltaY-Ye.deltaY,Vo=bi(Rt,Ra,Za);kn=Vo.x,Oi=Vo.y,Or=$t(Vo.x)>$t(Vo.y)?Vo.x:Vo.y,ao=vi(Ra,Za),re.lastInterval=Se}else Or=Ye.velocity,kn=Ye.velocityX,Oi=Ye.velocityY,ao=Ye.direction;Se.velocity=Or,Se.velocityX=kn,Se.velocityY=Oi,Se.direction=ao}function On(re){for(var Se=[],Ye=0;Ye<re.pointers.length;)Se[Ye]={clientX:yt(re.pointers[Ye].clientX),clientY:yt(re.pointers[Ye].clientY)},Ye++;return{timeStamp:tr(),pointers:Se,center:Vn(Se),deltaX:re.deltaX,deltaY:re.deltaY}}function Vn(re){var Se=re.length;if(Se===1)return{x:yt(re[0].clientX),y:yt(re[0].clientY)};for(var Ye=0,Rt=0,Or=0;Or<Se;)Ye+=re[Or].clientX,Rt+=re[Or].clientY,Or++;return{x:yt(Ye/Se),y:yt(Rt/Se)}}function bi(re,Se,Ye){return{x:Se/re||0,y:Ye/re||0}}function vi(re,Se){return re===Se?Qi:$t(re)>=$t(Se)?re<0?po:Sa:Se<0?pa:Fi}function An(re,Se,Ye){Ye||(Ye=me);var Rt=Se[Ye[0]]-re[Ye[0]],Or=Se[Ye[1]]-re[Ye[1]];return Math.sqrt(Rt*Rt+Or*Or)}function Bi(re,Se,Ye){Ye||(Ye=me);var Rt=Se[Ye[0]]-re[Ye[0]],Or=Se[Ye[1]]-re[Ye[1]];return Math.atan2(Or,Rt)*180/Math.PI}function Li(re,Se){return Bi(Se[1],Se[0],li)+Bi(re[1],re[0],li)}function io(re,Se){return An(Se[0],Se[1],li)/An(re[0],re[1],li)}var ys={mousedown:wi,mousemove:Ei,mouseup:Ti},Uo="mousedown",Na="mousemove mouseup";function xa(){this.evEl=Uo,this.evWin=Na,this.pressed=!1,bo.apply(this,arguments)}Xt(xa,bo,{handler:function(Se){var Ye=ys[Se.type];Ye&wi&&Se.button===0&&(this.pressed=!0),Ye&Ei&&Se.which!==1&&(Ye=Ti),!!this.pressed&&(Ye&Ti&&(this.pressed=!1),this.callback(this.manager,Ye,{pointers:[Se],changedPointers:[Se],pointerType:jn,srcEvent:Se}))}});var V={pointerdown:wi,pointermove:Ei,pointerup:Ti,pointercancel:Gi,pointerout:Gi},Q={2:an,3:Dn,4:jn,5:In},ne="pointerdown",ge="pointermove pointerup pointercancel";!Be&&ue.MSPointerEvent&&!ue.PointerEvent&&(ne="MSPointerDown",ge="MSPointerMove MSPointerUp MSPointerCancel");function Ie(){this.evEl=ne,this.evWin=ge,bo.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}Xt(Ie,bo,{handler:function(Se){var Ye=this.store,Rt=!1,Or=Se.type.toLowerCase().replace("ms",""),kn=V[Or],Oi=Q[Se.pointerType]||Se.pointerType,ao=Oi==an,Ra=S(Ye,Se.pointerId,"pointerId");kn&wi&&(Se.button===0||ao)?Ra<0&&(Ye.push(Se),Ra=Ye.length-1):kn&(Ti|Gi)&&(Rt=!0),!(Ra<0)&&(Ye[Ra]=Se,this.callback(this.manager,kn,{pointers:Ye,changedPointers:[Se],pointerType:Oi,srcEvent:Se}),Rt&&Ye.splice(Ra,1))}});var Ge={touchstart:wi,touchmove:Ei,touchend:Ti,touchcancel:Gi},tt="touchstart",ce="touchstart touchmove touchend touchcancel";function Le(){this.evTarget=tt,this.evWin=ce,this.started=!1,bo.apply(this,arguments)}Xt(Le,bo,{handler:function(Se){var Ye=Ge[Se.type];if(Ye===wi&&(this.started=!0),!!this.started){var Rt=mt.call(this,Se,Ye);Ye&(Ti|Gi)&&Rt[0].length-Rt[1].length==0&&(this.started=!1),this.callback(this.manager,Ye,{pointers:Rt[0],changedPointers:Rt[1],pointerType:an,srcEvent:Se})}}});function mt(re,Se){var Ye=pe(re.touches),Rt=pe(re.changedTouches);return Se&(Ti|Gi)&&(Ye=he(Ye.concat(Rt),"identifier",!0)),[Ye,Rt]}var pr={touchstart:wi,touchmove:Ei,touchend:Ti,touchcancel:Gi},Lt="touchstart touchmove touchend touchcancel";function Ft(){this.evTarget=Lt,this.targetIds={},bo.apply(this,arguments)}Xt(Ft,bo,{handler:function(Se){var Ye=pr[Se.type],Rt=dr.call(this,Se,Ye);!Rt||this.callback(this.manager,Ye,{pointers:Rt[0],changedPointers:Rt[1],pointerType:an,srcEvent:Se})}});function dr(re,Se){var Ye=pe(re.touches),Rt=this.targetIds;if(Se&(wi|Ei)&&Ye.length===1)return Rt[Ye[0].identifier]=!0,[Ye,Ye];var Or,kn,Oi=pe(re.changedTouches),ao=[],Ra=this.target;if(kn=Ye.filter(function(Za){return Er(Za.target,Ra)}),Se===wi)for(Or=0;Or<kn.length;)Rt[kn[Or].identifier]=!0,Or++;for(Or=0;Or<Oi.length;)Rt[Oi[Or].identifier]&&ao.push(Oi[Or]),Se&(Ti|Gi)&&delete Rt[Oi[Or].identifier],Or++;if(!!ao.length)return[he(kn.concat(ao),"identifier",!0),ao]}var bn=2500,pn=25;function Pt(){bo.apply(this,arguments);var re=lt(this.handler,this);this.touch=new Ft(this.manager,re),this.mouse=new xa(this.manager,re),this.primaryTouch=null,this.lastTouches=[]}Xt(Pt,bo,{handler:function(Se,Ye,Rt){var Or=Rt.pointerType==an,kn=Rt.pointerType==jn;if(!(kn&&Rt.sourceCapabilities&&Rt.sourceCapabilities.firesTouchEvents)){if(Or)en.call(this,Ye,Rt);else if(kn&&Xr.call(this,Rt))return;this.callback(Se,Ye,Rt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function en(re,Se){re&wi?(this.primaryTouch=Se.changedPointers[0].identifier,zr.call(this,Se)):re&(Ti|Gi)&&zr.call(this,Se)}function zr(re){var Se=re.changedPointers[0];if(Se.identifier===this.primaryTouch){var Ye={x:Se.clientX,y:Se.clientY};this.lastTouches.push(Ye);var Rt=this.lastTouches,Or=function(){var kn=Rt.indexOf(Ye);kn>-1&&Rt.splice(kn,1)};setTimeout(Or,bn)}}function Xr(re){for(var Se=re.srcEvent.clientX,Ye=re.srcEvent.clientY,Rt=0;Rt<this.lastTouches.length;Rt++){var Or=this.lastTouches[Rt],kn=Math.abs(Se-Or.x),Oi=Math.abs(Ye-Or.y);if(kn<=pn&&Oi<=pn)return!0}return!1}var mi=Be?H:He(Je.style,"touchAction"),tn=mi!==H,mn="compute",Xi="auto",hi="manipulation",Pi="none",_i="pan-x",dt="pan-y",It=Ii();function Ta(re,Se){this.manager=re,this.set(Se)}Ta.prototype={set:function(re){re==mn&&(re=this.compute()),tn&&this.manager.element.style&&It[re]&&(this.manager.element.style[mi]=re),this.actions=re.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var re=[];return Bt(this.manager.recognizers,function(Se){$e(Se.options.enable,[Se])&&(re=re.concat(Se.getTouchAction()))}),Si(re.join(" "))},preventDefaults:function(re){var Se=re.srcEvent,Ye=re.offsetDirection;if(this.manager.session.prevented){Se.preventDefault();return}var Rt=this.actions,Or=kr(Rt,Pi)&&!It[Pi],kn=kr(Rt,dt)&&!It[dt],Oi=kr(Rt,_i)&&!It[_i];if(Or){var ao=re.pointers.length===1,Ra=re.distance<2,Za=re.deltaTime<250;if(ao&&Ra&&Za)return}if(!(Oi&&kn)&&(Or||kn&&Ye&ra||Oi&&Ye&$i))return this.preventSrc(Se)},preventSrc:function(re){this.manager.session.prevented=!0,re.preventDefault()}};function Si(re){if(kr(re,Pi))return Pi;var Se=kr(re,_i),Ye=kr(re,dt);return Se&&Ye?Pi:Se||Ye?Se?_i:dt:kr(re,hi)?hi:Xi}function Ii(){if(!tn)return!1;var re={};if(Be)return re;var Se=ue.CSS&&ue.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(Ye){re[Ye]=Se?ue.CSS.supports("touch-action",Ye):!0}),re}var ji=1,Ir=2,un=4,_t=8,aa=_t,J=16,Ko=32;function na(re){this.options=pt({},this.defaults,re||{}),this.id=it(),this.manager=null,this.options.enable=St(this.options.enable,!0),this.state=ji,this.simultaneous={},this.requireFail=[]}na.prototype={defaults:{},set:function(re){return pt(this.options,re),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(re){if(Qt(re,"recognizeWith",this))return this;var Se=this.simultaneous;return re=Ma(re,this),Se[re.id]||(Se[re.id]=re,re.recognizeWith(this)),this},dropRecognizeWith:function(re){return Qt(re,"dropRecognizeWith",this)?this:(re=Ma(re,this),delete this.simultaneous[re.id],this)},requireFailure:function(re){if(Qt(re,"requireFailure",this))return this;var Se=this.requireFail;return re=Ma(re,this),S(Se,re)===-1&&(Se.push(re),re.requireFailure(this)),this},dropRequireFailure:function(re){if(Qt(re,"dropRequireFailure",this))return this;re=Ma(re,this);var Se=S(this.requireFail,re);return Se>-1&&this.requireFail.splice(Se,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(re){return!!this.simultaneous[re.id]},emit:function(re){var Se=this,Ye=this.state;function Rt(Or){Se.manager.emit(Or,re)}Ye<_t&&Rt(Se.options.event+bu(Ye)),Rt(Se.options.event),re.additionalEvent&&Rt(re.additionalEvent),Ye>=_t&&Rt(Se.options.event+bu(Ye))},tryEmit:function(re){if(this.canEmit())return this.emit(re);this.state=Ko},canEmit:function(){for(var re=0;re<this.requireFail.length;){if(!(this.requireFail[re].state&(Ko|ji)))return!1;re++}return!0},recognize:function(re){var Se=pt({},re);if(!$e(this.options.enable,[this,Se])){this.reset(),this.state=Ko;return}this.state&(aa|J|Ko)&&(this.state=ji),this.state=this.process(Se),this.state&(Ir|un|_t|J)&&this.tryEmit(Se)},process:function(re){},getTouchAction:function(){},reset:function(){}};function bu(re){return re&J?"cancel":re&_t?"end":re&un?"move":re&Ir?"start":""}function za(re){return re==Fi?"down":re==pa?"up":re==po?"left":re==Sa?"right":""}function Ma(re,Se){var Ye=Se.manager;return Ye?Ye.get(re):re}function qa(){na.apply(this,arguments)}Xt(qa,na,{defaults:{pointers:1},attrTest:function(re){var Se=this.options.pointers;return Se===0||re.pointers.length===Se},process:function(re){var Se=this.state,Ye=re.eventType,Rt=Se&(Ir|un),Or=this.attrTest(re);return Rt&&(Ye&Gi||!Or)?Se|J:Rt||Or?Ye&Ti?Se|_t:Se&Ir?Se|un:Ir:Ko}});function oa(){qa.apply(this,arguments),this.pX=null,this.pY=null}Xt(oa,qa,{defaults:{event:"pan",threshold:10,pointers:1,direction:is},getTouchAction:function(){var re=this.options.direction,Se=[];return re&ra&&Se.push(dt),re&$i&&Se.push(_i),Se},directionTest:function(re){var Se=this.options,Ye=!0,Rt=re.distance,Or=re.direction,kn=re.deltaX,Oi=re.deltaY;return Or&Se.direction||(Se.direction&ra?(Or=kn===0?Qi:kn<0?po:Sa,Ye=kn!=this.pX,Rt=Math.abs(re.deltaX)):(Or=Oi===0?Qi:Oi<0?pa:Fi,Ye=Oi!=this.pY,Rt=Math.abs(re.deltaY))),re.direction=Or,Ye&&Rt>Se.threshold&&Or&Se.direction},attrTest:function(re){return qa.prototype.attrTest.call(this,re)&&(this.state&Ir||!(this.state&Ir)&&this.directionTest(re))},emit:function(re){this.pX=re.deltaX,this.pY=re.deltaY;var Se=za(re.direction);Se&&(re.additionalEvent=this.options.event+Se),this._super.emit.call(this,re)}});function Ao(){qa.apply(this,arguments)}Xt(Ao,qa,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Pi]},attrTest:function(re){return this._super.attrTest.call(this,re)&&(Math.abs(re.scale-1)>this.options.threshold||this.state&Ir)},emit:function(re){if(re.scale!==1){var Se=re.scale<1?"in":"out";re.additionalEvent=this.options.event+Se}this._super.emit.call(this,re)}});function jo(){na.apply(this,arguments),this._timer=null,this._input=null}Xt(jo,na,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Xi]},process:function(re){var Se=this.options,Ye=re.pointers.length===Se.pointers,Rt=re.distance<Se.threshold,Or=re.deltaTime>Se.time;if(this._input=re,!Rt||!Ye||re.eventType&(Ti|Gi)&&!Or)this.reset();else if(re.eventType&wi)this.reset(),this._timer=Mt(function(){this.state=aa,this.tryEmit()},Se.time,this);else if(re.eventType&Ti)return aa;return Ko},reset:function(){clearTimeout(this._timer)},emit:function(re){this.state===aa&&(re&&re.eventType&Ti?this.manager.emit(this.options.event+"up",re):(this._input.timeStamp=tr(),this.manager.emit(this.options.event,this._input)))}});function wu(){qa.apply(this,arguments)}Xt(wu,qa,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Pi]},attrTest:function(re){return this._super.attrTest.call(this,re)&&(Math.abs(re.rotation)>this.options.threshold||this.state&Ir)}});function vo(){qa.apply(this,arguments)}Xt(vo,qa,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:ra|$i,pointers:1},getTouchAction:function(){return oa.prototype.getTouchAction.call(this)},attrTest:function(re){var Se=this.options.direction,Ye;return Se&(ra|$i)?Ye=re.overallVelocity:Se&ra?Ye=re.overallVelocityX:Se&$i&&(Ye=re.overallVelocityY),this._super.attrTest.call(this,re)&&Se&re.offsetDirection&&re.distance>this.options.threshold&&re.maxPointers==this.options.pointers&&$t(Ye)>this.options.velocity&&re.eventType&Ti},emit:function(re){var Se=za(re.offsetDirection);Se&&this.manager.emit(this.options.event+Se,re),this.manager.emit(this.options.event,re)}});function Do(){na.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}Xt(Do,na,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[hi]},process:function(re){var Se=this.options,Ye=re.pointers.length===Se.pointers,Rt=re.distance<Se.threshold,Or=re.deltaTime<Se.time;if(this.reset(),re.eventType&wi&&this.count===0)return this.failTimeout();if(Rt&&Or&&Ye){if(re.eventType!=Ti)return this.failTimeout();var kn=this.pTime?re.timeStamp-this.pTime<Se.interval:!0,Oi=!this.pCenter||An(this.pCenter,re.center)<Se.posThreshold;this.pTime=re.timeStamp,this.pCenter=re.center,!Oi||!kn?this.count=1:this.count+=1,this._input=re;var ao=this.count%Se.taps;if(ao===0)return this.hasRequireFailures()?(this._timer=Mt(function(){this.state=aa,this.tryEmit()},Se.interval,this),Ir):aa}return Ko},failTimeout:function(){return this._timer=Mt(function(){this.state=Ko},this.options.interval,this),Ko},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==aa&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function sa(re,Se){return Se=Se||{},Se.recognizers=St(Se.recognizers,sa.defaults.preset),new $a(re,Se)}sa.VERSION="2.0.7",sa.defaults={domEvents:!1,touchAction:mn,enable:!0,inputTarget:null,inputClass:null,preset:[[wu,{enable:!1}],[Ao,{enable:!1},["rotate"]],[vo,{direction:ra}],[oa,{direction:ra},["swipe"]],[Do],[Do,{event:"doubletap",taps:2},["tap"]],[jo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Ka=1,Fo=2;function $a(re,Se){this.options=pt({},sa.defaults,Se||{}),this.options.inputTarget=this.options.inputTarget||re,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=re,this.input=cu(this),this.touchAction=new Ta(this,this.options.touchAction),Ms(this,!0),Bt(this.options.recognizers,function(Ye){var Rt=this.add(new Ye[0](Ye[1]));Ye[2]&&Rt.recognizeWith(Ye[2]),Ye[3]&&Rt.requireFailure(Ye[3])},this)}$a.prototype={set:function(re){return pt(this.options,re),re.touchAction&&this.touchAction.update(),re.inputTarget&&(this.input.destroy(),this.input.target=re.inputTarget,this.input.init()),this},stop:function(re){this.session.stopped=re?Fo:Ka},recognize:function(re){var Se=this.session;if(!Se.stopped){this.touchAction.preventDefaults(re);var Ye,Rt=this.recognizers,Or=Se.curRecognizer;(!Or||Or&&Or.state&aa)&&(Or=Se.curRecognizer=null);for(var kn=0;kn<Rt.length;)Ye=Rt[kn],Se.stopped!==Fo&&(!Or||Ye==Or||Ye.canRecognizeWith(Or))?Ye.recognize(re):Ye.reset(),!Or&&Ye.state&(Ir|un|_t)&&(Or=Se.curRecognizer=Ye),kn++}},get:function(re){if(re instanceof na)return re;for(var Se=this.recognizers,Ye=0;Ye<Se.length;Ye++)if(Se[Ye].options.event==re)return Se[Ye];return null},add:function(re){if(Qt(re,"add",this))return this;var Se=this.get(re.options.event);return Se&&this.remove(Se),this.recognizers.push(re),re.manager=this,this.touchAction.update(),re},remove:function(re){if(Qt(re,"remove",this))return this;if(re=this.get(re),re){var Se=this.recognizers,Ye=S(Se,re);Ye!==-1&&(Se.splice(Ye,1),this.touchAction.update())}return this},on:function(re,Se){if(re!==H&&Se!==H){var Ye=this.handlers;return Bt($r(re),function(Rt){Ye[Rt]=Ye[Rt]||[],Ye[Rt].push(Se)}),this}},off:function(re,Se){if(re!==H){var Ye=this.handlers;return Bt($r(re),function(Rt){Se?Ye[Rt]&&Ye[Rt].splice(S(Ye[Rt],Se),1):delete Ye[Rt]}),this}},emit:function(re,Se){this.options.domEvents&&Il(re,Se);var Ye=this.handlers[re]&&this.handlers[re].slice();if(!(!Ye||!Ye.length)){Se.type=re,Se.preventDefault=function(){Se.srcEvent.preventDefault()};for(var Rt=0;Rt<Ye.length;)Ye[Rt](Se),Rt++}},destroy:function(){this.element&&Ms(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Ms(re,Se){var Ye=re.element;if(!!Ye.style){var Rt;Bt(re.options.cssProps,function(Or,kn){Rt=He(Ye.style,kn),Se?(re.oldCssProps[Rt]=Ye.style[Rt],Ye.style[Rt]=Or):Ye.style[Rt]=re.oldCssProps[Rt]||""}),Se||(re.oldCssProps={})}}function Il(re,Se){if(!Be){var Ye=g.createEvent("Event");Ye.initEvent(re,!0,!0),Ye.gesture=Se,Se.target.dispatchEvent(Ye)}}if(!Be){pt(sa,{INPUT_START:wi,INPUT_MOVE:Ei,INPUT_END:Ti,INPUT_CANCEL:Gi,STATE_POSSIBLE:ji,STATE_BEGAN:Ir,STATE_CHANGED:un,STATE_ENDED:_t,STATE_RECOGNIZED:aa,STATE_CANCELLED:J,STATE_FAILED:Ko,DIRECTION_NONE:Qi,DIRECTION_LEFT:po,DIRECTION_RIGHT:Sa,DIRECTION_UP:pa,DIRECTION_DOWN:Fi,DIRECTION_HORIZONTAL:ra,DIRECTION_VERTICAL:$i,DIRECTION_ALL:is,Manager:$a,Input:bo,TouchAction:Ta,TouchInput:Ft,MouseInput:xa,PointerEventInput:Ie,TouchMouseInput:Pt,SingleTouchInput:Le,Recognizer:na,AttrRecognizer:qa,Tap:Do,Pan:oa,Swipe:vo,Pinch:Ao,Rotate:wu,Press:jo,on:et,off:Ht,each:Bt,merge:K,extend:rr,assign:pt,inherit:Xt,bindFn:lt,prefixed:He});var _s=typeof window!="undefined"?window:typeof self!="undefined"?self:{};_s.Hammer=sa,_e=function(){return sa}.call(te,W,te,Jt),_e!==H&&(Jt.exports=_e)}})(typeof window!="undefined"?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document,"Hammer")},88307:function(Jt,te,W){(function(_e,ue){Jt.exports=ue(W(18857))})(this,function(_e){"use strict";var ue=function(N){return N instanceof Uint8Array||N instanceof Uint16Array||N instanceof Uint32Array||N instanceof Int8Array||N instanceof Int16Array||N instanceof Int32Array||N instanceof Float32Array||N instanceof Float64Array||N instanceof Uint8ClampedArray},g=function(N,ve){for(var Ne=Object.keys(ve),Dt=0;Dt<Ne.length;++Dt)N[Ne[Dt]]=ve[Ne[Dt]];return N},Ee=`
`;function H(N){return typeof atob!="undefined"?atob(N):"base64:"+N}function ae(N){var ve=new Error("(regl) "+N);throw console.error(ve),ve}function le(N,ve){N||ae(ve)}function Be(N){return N?": "+N:""}function ye(N,ve,Ne){N in ve||ae("unknown parameter ("+N+")"+Be(Ne)+". possible values: "+Object.keys(ve).join())}function Je(N,ve){ue(N)||ae("invalid parameter type"+Be(ve)+". must be a typed array")}function st(N,ve){switch(ve){case"number":return typeof N=="number";case"object":return typeof N=="object";case"string":return typeof N=="string";case"boolean":return typeof N=="boolean";case"function":return typeof N=="function";case"undefined":return typeof N=="undefined";case"symbol":return typeof N=="symbol"}}function yt(N,ve,Ne){st(N,ve)||ae("invalid parameter type"+Be(Ne)+". expected "+ve+", got "+typeof N)}function $t(N,ve){N>=0&&(N|0)===N||ae("invalid parameter type, ("+N+")"+Be(ve)+". must be a nonnegative integer")}function tr(N,ve,Ne){ve.indexOf(N)<0&&ae("invalid value"+Be(Ne)+". must be one of: "+ve)}var Mt=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Qt(N){Object.keys(N).forEach(function(ve){Mt.indexOf(ve)<0&&ae('invalid regl constructor argument "'+ve+'". must be one of '+Mt)})}function Bt(N,ve){for(N=N+"";N.length<ve;)N=" "+N;return N}function ut(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function pt(N,ve){this.number=N,this.line=ve,this.errors=[]}function rr(N,ve,Ne){this.file=N,this.line=ve,this.message=Ne}function K(){var N=new Error,ve=(N.stack||N).toString(),Ne=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(ve);if(Ne)return Ne[1];var Dt=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(ve);return Dt?Dt[1]:"unknown"}function Xt(){var N=new Error,ve=(N.stack||N).toString(),Ne=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(ve);if(Ne)return Ne[1];var Dt=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(ve);return Dt?Dt[1]:"unknown"}function lt(N,ve){var Ne=N.split(`
`),Dt=1,ar=0,kt={unknown:new ut,0:new ut};kt.unknown.name=kt[0].name=ve||K(),kt.unknown.lines.push(new pt(0,""));for(var qt=0;qt<Ne.length;++qt){var fr=Ne[qt],mr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(fr);if(mr)switch(mr[1]){case"line":var xr=/(\d+)(\s+\d+)?/.exec(mr[2]);xr&&(Dt=xr[1]|0,xr[2]&&(ar=xr[2]|0,ar in kt||(kt[ar]=new ut)));break;case"define":var Tr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(mr[2]);Tr&&(kt[ar].name=Tr[1]?H(Tr[2]):Tr[2]);break}kt[ar].lines.push(new pt(Dt++,fr))}return Object.keys(kt).forEach(function(Mr){var Gr=kt[Mr];Gr.lines.forEach(function(yr){Gr.index[yr.number]=yr})}),kt}function $e(N){var ve=[];return N.split(`
`).forEach(function(Ne){if(!(Ne.length<5)){var Dt=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(Ne);Dt?ve.push(new rr(Dt[1]|0,Dt[2]|0,Dt[3].trim())):Ne.length>0&&ve.push(new rr("unknown",0,Ne))}}),ve}function St(N,ve){ve.forEach(function(Ne){var Dt=N[Ne.file];if(Dt){var ar=Dt.index[Ne.line];if(ar){ar.errors.push(Ne),Dt.hasErrors=!0;return}}N.unknown.hasErrors=!0,N.unknown.lines[0].errors.push(Ne)})}function et(N,ve,Ne,Dt,ar){if(!N.getShaderParameter(ve,N.COMPILE_STATUS)){var kt=N.getShaderInfoLog(ve),qt=Dt===N.FRAGMENT_SHADER?"fragment":"vertex";he(Ne,"string",qt+" shader source must be a string",ar);var fr=lt(Ne,ar),mr=$e(kt);St(fr,mr),Object.keys(fr).forEach(function(xr){var Tr=fr[xr];if(!Tr.hasErrors)return;var Mr=[""],Gr=[""];function yr(Cr,ot){Mr.push(Cr),Gr.push(ot||"")}yr("file number "+xr+": "+Tr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Tr.lines.forEach(function(Cr){if(Cr.errors.length>0){yr(Bt(Cr.number,4)+"|  ","background-color:yellow; font-weight:bold"),yr(Cr.line+Ee,"color:red; background-color:yellow; font-weight:bold");var ot=0;Cr.errors.forEach(function(jt){var br=jt.message,Zr=/^\s*'(.*)'\s*:\s*(.*)$/.exec(br);if(Zr){var cr=Zr[1];switch(br=Zr[2],cr){case"assign":cr="=";break}ot=Math.max(Cr.line.indexOf(cr,ot),0)}else ot=0;yr(Bt("| ",6)),yr(Bt("^^^",ot+3)+Ee,"font-weight:bold"),yr(Bt("| ",6)),yr(br+Ee,"font-weight:bold")}),yr(Bt("| ",6)+Ee)}else yr(Bt(Cr.number,4)+"|  "),yr(Cr.line+Ee,"color:red")}),typeof document!="undefined"&&!window.chrome?(Gr[0]=Mr.join("%c"),console.log.apply(console,Gr)):console.log(Mr.join(""))}),le.raise("Error compiling "+qt+" shader, "+fr[0].name)}}function Ht(N,ve,Ne,Dt,ar){if(!N.getProgramParameter(ve,N.LINK_STATUS)){var kt=N.getProgramInfoLog(ve),qt=lt(Ne,ar),fr=lt(Dt,ar),mr='Error linking program with vertex shader, "'+fr[0].name+'", and fragment shader "'+qt[0].name+'"';typeof document!="undefined"?console.log("%c"+mr+Ee+"%c"+kt,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(mr+Ee+kt),le.raise(mr)}}function Er(N){N._commandRef=K()}function kr(N,ve,Ne,Dt){Er(N);function ar(mr){return mr?Dt.id(mr):0}N._fragId=ar(N.static.frag),N._vertId=ar(N.static.vert);function kt(mr,xr){Object.keys(xr).forEach(function(Tr){mr[Dt.id(Tr)]=!0})}var qt=N._uniformSet={};kt(qt,ve.static),kt(qt,ve.dynamic);var fr=N._attributeSet={};kt(fr,Ne.static),kt(fr,Ne.dynamic),N._hasCount="count"in N.static||"count"in N.dynamic||"elements"in N.static||"elements"in N.dynamic}function $r(N,ve){var Ne=Xt();ae(N+" in command "+(ve||K())+(Ne==="unknown"?"":" called from "+Ne))}function S(N,ve,Ne){N||$r(ve,Ne||K())}function pe(N,ve,Ne,Dt){N in ve||$r("unknown parameter ("+N+")"+Be(Ne)+". possible values: "+Object.keys(ve).join(),Dt||K())}function he(N,ve,Ne,Dt){st(N,ve)||$r("invalid parameter type"+Be(Ne)+". expected "+ve+", got "+typeof N,Dt||K())}function He(N){N()}function Ke(N,ve,Ne){N.texture?tr(N.texture._texture.internalformat,ve,"unsupported texture format for attachment"):tr(N.renderbuffer._renderbuffer.format,Ne,"unsupported renderbuffer format for attachment")}var it=33071,bt=9728,nr=9984,Nr=9985,wr=9986,xn=9987,an=5120,Dn=5121,jn=5122,In=5123,ii=5124,wi=5125,Ei=5126,Ti=32819,Gi=32820,Qi=33635,po=34042,Sa=36193,pa={};pa[an]=pa[Dn]=1,pa[jn]=pa[In]=pa[Sa]=pa[Qi]=pa[Ti]=pa[Gi]=2,pa[ii]=pa[wi]=pa[Ei]=pa[po]=4;function Fi(N,ve){return N===Gi||N===Ti||N===Qi?2:N===po?4:pa[N]*ve}function ra(N){return!(N&N-1)&&!!N}function $i(N,ve,Ne){var Dt,ar=ve.width,kt=ve.height,qt=ve.channels;le(ar>0&&ar<=Ne.maxTextureSize&&kt>0&&kt<=Ne.maxTextureSize,"invalid texture shape"),(N.wrapS!==it||N.wrapT!==it)&&le(ra(ar)&&ra(kt),"incompatible wrap mode for texture, both width and height must be power of 2"),ve.mipmask===1?ar!==1&&kt!==1&&le(N.minFilter!==nr&&N.minFilter!==wr&&N.minFilter!==Nr&&N.minFilter!==xn,"min filter requires mipmap"):(le(ra(ar)&&ra(kt),"texture must be a square power of 2 to support mipmapping"),le(ve.mipmask===(ar<<1)-1,"missing or incomplete mipmap data")),ve.type===Ei&&(Ne.extensions.indexOf("oes_texture_float_linear")<0&&le(N.minFilter===bt&&N.magFilter===bt,"filter not supported, must enable oes_texture_float_linear"),le(!N.genMipmaps,"mipmap generation not supported with float textures"));var fr=ve.images;for(Dt=0;Dt<16;++Dt)if(fr[Dt]){var mr=ar>>Dt,xr=kt>>Dt;le(ve.mipmask&1<<Dt,"missing mipmap data");var Tr=fr[Dt];if(le(Tr.width===mr&&Tr.height===xr,"invalid shape for mip images"),le(Tr.format===ve.format&&Tr.internalformat===ve.internalformat&&Tr.type===ve.type,"incompatible type for mip image"),!Tr.compressed)if(Tr.data){var Mr=Math.ceil(Fi(Tr.type,qt)*mr/Tr.unpackAlignment)*Tr.unpackAlignment;le(Tr.data.byteLength===Mr*xr,"invalid data for image, buffer size is inconsistent with image format")}else Tr.element||Tr.copy}else N.genMipmaps||le((ve.mipmask&1<<Dt)==0,"extra mipmap data");ve.compressed&&le(!N.genMipmaps,"mipmap generation for compressed images not supported")}function is(N,ve,Ne,Dt){var ar=N.width,kt=N.height,qt=N.channels;le(ar>0&&ar<=Dt.maxTextureSize&&kt>0&&kt<=Dt.maxTextureSize,"invalid texture shape"),le(ar===kt,"cube map must be square"),le(ve.wrapS===it&&ve.wrapT===it,"wrap mode not supported by cube map");for(var fr=0;fr<Ne.length;++fr){var mr=Ne[fr];le(mr.width===ar&&mr.height===kt,"inconsistent cube map face shape"),ve.genMipmaps&&(le(!mr.compressed,"can not generate mipmap for compressed textures"),le(mr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var xr=mr.images,Tr=0;Tr<16;++Tr){var Mr=xr[Tr];if(Mr){var Gr=ar>>Tr,yr=kt>>Tr;le(mr.mipmask&1<<Tr,"missing mipmap data"),le(Mr.width===Gr&&Mr.height===yr,"invalid shape for mip images"),le(Mr.format===N.format&&Mr.internalformat===N.internalformat&&Mr.type===N.type,"incompatible type for mip image"),Mr.compressed||(Mr.data?le(Mr.data.byteLength===Gr*yr*Math.max(Fi(Mr.type,qt),Mr.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):Mr.element||Mr.copy)}}}}var me=g(le,{optional:He,raise:ae,commandRaise:$r,command:S,parameter:ye,commandParameter:pe,constructor:Qt,type:yt,commandType:he,isTypedArray:Je,nni:$t,oneOf:tr,shaderError:et,linkError:Ht,callSite:Xt,saveCommandRef:Er,saveDrawInfo:kr,framebufferFormat:Ke,guessCommand:K,texture2D:$i,textureCube:is}),li=0,bo=0,cu=5,Zt=6;function er(N,ve){this.id=li++,this.type=N,this.data=ve}function Lr(N){return N.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function sn(N){if(N.length===0)return[];var ve=N.charAt(0),Ne=N.charAt(N.length-1);if(N.length>1&&ve===Ne&&(ve==='"'||ve==="'"))return['"'+Lr(N.substr(1,N.length-2))+'"'];var Dt=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(N);if(Dt)return sn(N.substr(0,Dt.index)).concat(sn(Dt[1])).concat(sn(N.substr(Dt.index+Dt[0].length)));var ar=N.split(".");if(ar.length===1)return['"'+Lr(N)+'"'];for(var kt=[],qt=0;qt<ar.length;++qt)kt=kt.concat(sn(ar[qt]));return kt}function On(N){return"["+sn(N).join("][")+"]"}function Vn(N,ve){return new er(N,On(ve+""))}function bi(N){return typeof N=="function"&&!N._reglType||N instanceof er}function vi(N,ve){if(typeof N=="function")return new er(bo,N);if(typeof N=="number"||typeof N=="boolean")return new er(cu,N);if(Array.isArray(N))return new er(Zt,N.map(function(Ne,Dt){return vi(Ne,ve+"["+Dt+"]")}));if(N instanceof er)return N;me(!1,"invalid option type in uniform "+ve)}var An={DynamicVariable:er,define:Vn,isDynamic:bi,unbox:vi,accessor:On},Bi={next:typeof requestAnimationFrame=="function"?function(N){return requestAnimationFrame(N)}:function(N){return setTimeout(N,16)},cancel:typeof cancelAnimationFrame=="function"?function(N){return cancelAnimationFrame(N)}:clearTimeout},Li=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,io=Li?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function ys(){var N={"":0},ve=[""];return{id:function(Ne){var Dt=N[Ne];return Dt||(Dt=N[Ne]=ve.length,ve.push(Ne),Dt)},str:function(Ne){return ve[Ne]}}}function Uo(N,ve,Ne){var Dt=document.createElement("canvas");g(Dt.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),N.appendChild(Dt),N===document.body&&(Dt.style.position="absolute",g(N.style,{margin:0,padding:0}));function ar(){var fr=window.innerWidth,mr=window.innerHeight;if(N!==document.body){var xr=Dt.getBoundingClientRect();fr=xr.right-xr.left,mr=xr.bottom-xr.top}Dt.width=Ne*fr,Dt.height=Ne*mr}var kt;N!==document.body&&typeof ResizeObserver=="function"?(kt=new ResizeObserver(function(){setTimeout(ar)}),kt.observe(N)):window.addEventListener("resize",ar,!1);function qt(){kt?kt.disconnect():window.removeEventListener("resize",ar),N.removeChild(Dt)}return ar(),{canvas:Dt,onDestroy:qt}}function Na(N,ve){function Ne(Dt){try{return N.getContext(Dt,ve)}catch(ar){return null}}return Ne("webgl")||Ne("experimental-webgl")||Ne("webgl-experimental")}function xa(N){return typeof N.nodeName=="string"&&typeof N.appendChild=="function"&&typeof N.getBoundingClientRect=="function"}function V(N){return typeof N.drawArrays=="function"||typeof N.drawElements=="function"}function Q(N){return typeof N=="string"?N.split():(me(Array.isArray(N),"invalid extension array"),N)}function ne(N){return typeof N=="string"?(me(typeof document!="undefined","not supported outside of DOM"),document.querySelector(N)):N}function ge(N){var ve=N||{},Ne,Dt,ar,kt,qt={},fr=[],mr=[],xr=typeof window=="undefined"?1:window.devicePixelRatio,Tr=!1,Mr=function(Cr){Cr&&me.raise(Cr)},Gr=function(){};if(typeof ve=="string"?(me(typeof document!="undefined","selector queries only supported in DOM environments"),Ne=document.querySelector(ve),me(Ne,"invalid query string for element")):typeof ve=="object"?xa(ve)?Ne=ve:V(ve)?(kt=ve,ar=kt.canvas):(me.constructor(ve),"gl"in ve?kt=ve.gl:"canvas"in ve?ar=ne(ve.canvas):"container"in ve&&(Dt=ne(ve.container)),"attributes"in ve&&(qt=ve.attributes,me.type(qt,"object","invalid context attributes")),"extensions"in ve&&(fr=Q(ve.extensions)),"optionalExtensions"in ve&&(mr=Q(ve.optionalExtensions)),"onDone"in ve&&(me.type(ve.onDone,"function","invalid or missing onDone callback"),Mr=ve.onDone),"profile"in ve&&(Tr=!!ve.profile),"pixelRatio"in ve&&(xr=+ve.pixelRatio,me(xr>0,"invalid pixel ratio"))):me.raise("invalid arguments to regl"),Ne&&(Ne.nodeName.toLowerCase()==="canvas"?ar=Ne:Dt=Ne),!kt){if(!ar){me(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var yr=Uo(Dt||document.body,Mr,xr);if(!yr)return null;ar=yr.canvas,Gr=yr.onDestroy}qt.premultipliedAlpha===void 0&&(qt.premultipliedAlpha=!0),kt=Na(ar,qt)}return kt?{gl:kt,canvas:ar,container:Dt,extensions:fr,optionalExtensions:mr,pixelRatio:xr,profile:Tr,onDone:Mr,onDestroy:Gr}:(Gr(),Mr("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Ie(N,ve){var Ne={};function Dt(fr){me.type(fr,"string","extension name must be string");var mr=fr.toLowerCase(),xr;try{xr=Ne[mr]=ar(fr)}catch(Tr){}return!!xr}function ar(fr){return N.getExtension(fr)?N.getExtension(fr):N.getExtension(fr.toLowerCase())?N.getExtension(fr.toLowerCase()):null}for(var kt=0;kt<ve.extensions.length;++kt){var qt=ve.extensions[kt];if(!Dt(qt))return ve.onDestroy(),ve.onDone('"'+qt+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return ve.optionalExtensions.forEach(Dt),{extensions:Ne,restore:function(){Object.keys(Ne).forEach(function(fr){if(Ne[fr]&&!Dt(fr))throw new Error("(regl): error restoring extension "+fr)})}}}function Ge(N,ve){for(var Ne=Array(N),Dt=0;Dt<N;++Dt)Ne[Dt]=ve(Dt);return Ne}var tt=5120,ce=5121,Le=5122,mt=5123,pr=5124,Lt=5125,Ft=5126;function dr(N){for(var ve=16;ve<=1<<28;ve*=16)if(N<=ve)return ve;return 0}function bn(N){var ve,Ne;return ve=(N>65535)<<4,N>>>=ve,Ne=(N>255)<<3,N>>>=Ne,ve|=Ne,Ne=(N>15)<<2,N>>>=Ne,ve|=Ne,Ne=(N>3)<<1,N>>>=Ne,ve|=Ne,ve|N>>1}function pn(){var N=Ge(8,function(){return[]});function ve(kt){var qt=dr(kt),fr=N[bn(qt)>>2];return fr.length>0?fr.pop():new ArrayBuffer(qt)}function Ne(kt){N[bn(kt.byteLength)>>2].push(kt)}function Dt(kt,qt){var fr=null;switch(kt){case tt:fr=new Int8Array(ve(qt),0,qt);break;case ce:fr=new Uint8Array(ve(qt),0,qt);break;case Le:fr=new Int16Array(ve(2*qt),0,qt);break;case mt:fr=new Uint16Array(ve(2*qt),0,qt);break;case pr:fr=new Int32Array(ve(4*qt),0,qt);break;case Lt:fr=new Uint32Array(ve(4*qt),0,qt);break;case Ft:fr=new Float32Array(ve(4*qt),0,qt);break;default:return null}return fr.length!==qt?fr.subarray(0,qt):fr}function ar(kt){Ne(kt.buffer)}return{alloc:ve,free:Ne,allocType:Dt,freeType:ar}}var Pt=pn();Pt.zero=pn();var en=3408,zr=3410,Xr=3411,mi=3412,tn=3413,mn=3414,Xi=3415,hi=33901,Pi=33902,_i=3379,dt=3386,It=34921,Ta=36347,Si=36348,Ii=35661,ji=35660,Ir=34930,un=36349,_t=34076,aa=34024,J=7936,Ko=7937,na=7938,bu=35724,za=34047,Ma=36063,qa=34852,oa=3553,Ao=34067,jo=34069,wu=33984,vo=6408,Do=5126,sa=5121,Ka=36160,Fo=36053,$a=36064,Ms=16384,Il=function(N,ve){var Ne=1;ve.ext_texture_filter_anisotropic&&(Ne=N.getParameter(za));var Dt=1,ar=1;ve.webgl_draw_buffers&&(Dt=N.getParameter(qa),ar=N.getParameter(Ma));var kt=!!ve.oes_texture_float;if(kt){var qt=N.createTexture();N.bindTexture(oa,qt),N.texImage2D(oa,0,vo,1,1,0,vo,Do,null);var fr=N.createFramebuffer();if(N.bindFramebuffer(Ka,fr),N.framebufferTexture2D(Ka,$a,oa,qt,0),N.bindTexture(oa,null),N.checkFramebufferStatus(Ka)!==Fo)kt=!1;else{N.viewport(0,0,1,1),N.clearColor(1,0,0,1),N.clear(Ms);var mr=Pt.allocType(Do,4);N.readPixels(0,0,1,1,vo,Do,mr),N.getError()?kt=!1:(N.deleteFramebuffer(fr),N.deleteTexture(qt),kt=mr[0]===1),Pt.freeType(mr)}}var xr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Tr=!0;if(!xr){var Mr=N.createTexture(),Gr=Pt.allocType(sa,36);N.activeTexture(wu),N.bindTexture(Ao,Mr),N.texImage2D(jo,0,vo,3,3,0,vo,sa,Gr),Pt.freeType(Gr),N.bindTexture(Ao,null),N.deleteTexture(Mr),Tr=!N.getError()}return{colorBits:[N.getParameter(zr),N.getParameter(Xr),N.getParameter(mi),N.getParameter(tn)],depthBits:N.getParameter(mn),stencilBits:N.getParameter(Xi),subpixelBits:N.getParameter(en),extensions:Object.keys(ve).filter(function(yr){return!!ve[yr]}),maxAnisotropic:Ne,maxDrawbuffers:Dt,maxColorAttachments:ar,pointSizeDims:N.getParameter(hi),lineWidthDims:N.getParameter(Pi),maxViewportDims:N.getParameter(dt),maxCombinedTextureUnits:N.getParameter(Ii),maxCubeMapSize:N.getParameter(_t),maxRenderbufferSize:N.getParameter(aa),maxTextureUnits:N.getParameter(Ir),maxTextureSize:N.getParameter(_i),maxAttributes:N.getParameter(It),maxVertexUniforms:N.getParameter(Ta),maxVertexTextureUnits:N.getParameter(ji),maxVaryingVectors:N.getParameter(Si),maxFragmentUniforms:N.getParameter(un),glsl:N.getParameter(bu),renderer:N.getParameter(Ko),vendor:N.getParameter(J),version:N.getParameter(na),readFloat:kt,npotTextureCube:Tr}};function _s(N){return!!N&&typeof N=="object"&&Array.isArray(N.shape)&&Array.isArray(N.stride)&&typeof N.offset=="number"&&N.shape.length===N.stride.length&&(Array.isArray(N.data)||ue(N.data))}var re=function(N){return Object.keys(N).map(function(ve){return N[ve]})},Se={shape:ao,flatten:Oi};function Ye(N,ve,Ne){for(var Dt=0;Dt<ve;++Dt)Ne[Dt]=N[Dt]}function Rt(N,ve,Ne,Dt){for(var ar=0,kt=0;kt<ve;++kt)for(var qt=N[kt],fr=0;fr<Ne;++fr)Dt[ar++]=qt[fr]}function Or(N,ve,Ne,Dt,ar,kt){for(var qt=kt,fr=0;fr<ve;++fr)for(var mr=N[fr],xr=0;xr<Ne;++xr)for(var Tr=mr[xr],Mr=0;Mr<Dt;++Mr)ar[qt++]=Tr[Mr]}function kn(N,ve,Ne,Dt,ar){for(var kt=1,qt=Ne+1;qt<ve.length;++qt)kt*=ve[qt];var fr=ve[Ne];if(ve.length-Ne==4){var mr=ve[Ne+1],xr=ve[Ne+2],Tr=ve[Ne+3];for(qt=0;qt<fr;++qt)Or(N[qt],mr,xr,Tr,Dt,ar),ar+=kt}else for(qt=0;qt<fr;++qt)kn(N[qt],ve,Ne+1,Dt,ar),ar+=kt}function Oi(N,ve,Ne,Dt){var ar=1;if(ve.length)for(var kt=0;kt<ve.length;++kt)ar*=ve[kt];else ar=0;var qt=Dt||Pt.allocType(Ne,ar);switch(ve.length){case 0:break;case 1:Ye(N,ve[0],qt);break;case 2:Rt(N,ve[0],ve[1],qt);break;case 3:Or(N,ve[0],ve[1],ve[2],qt,0);break;default:kn(N,ve,0,qt,0)}return qt}function ao(N){for(var ve=[],Ne=N;Ne.length;Ne=Ne[0])ve.push(Ne.length);return ve}var Ra={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Za=5120,Vo=5122,xs=5124,uo=5121,wo=5123,bs=5125,Ps=5126,Fs=5126,fu={int8:Za,int16:Vo,int32:xs,uint8:uo,uint16:wo,uint32:bs,float:Ps,float32:Fs},Es=35048,ma=35040,_a={dynamic:Es,stream:ma,static:35044},as=Se.flatten,mf=Se.shape,Ol=35044,qs=35040,ac=5121,Yu=5126,Ks=[];Ks[5120]=1,Ks[5122]=2,Ks[5124]=4,Ks[5121]=1,Ks[5123]=2,Ks[5125]=4,Ks[5126]=4;function ul(N){return Ra[Object.prototype.toString.call(N)]|0}function _(N,ve){for(var Ne=0;Ne<ve.length;++Ne)N[Ne]=ve[Ne]}function M(N,ve,Ne,Dt,ar,kt,qt){for(var fr=0,mr=0;mr<Ne;++mr)for(var xr=0;xr<Dt;++xr)N[fr++]=ve[ar*mr+kt*xr+qt]}function B(N,ve,Ne,Dt){var ar=0,kt={};function qt(ot){this.id=ar++,this.buffer=N.createBuffer(),this.type=ot,this.usage=Ol,this.byteLength=0,this.dimension=1,this.dtype=ac,this.persistentData=null,Ne.profile&&(this.stats={size:0})}qt.prototype.bind=function(){N.bindBuffer(this.type,this.buffer)},qt.prototype.destroy=function(){Gr(this)};var fr=[];function mr(ot,jt){var br=fr.pop();return br||(br=new qt(ot)),br.bind(),Mr(br,jt,qs,0,1,!1),br}function xr(ot){fr.push(ot)}function Tr(ot,jt,br){ot.byteLength=jt.byteLength,N.bufferData(ot.type,jt,br)}function Mr(ot,jt,br,Zr,cr,Rr){var Qr;if(ot.usage=br,Array.isArray(jt)){if(ot.dtype=Zr||Yu,jt.length>0){var Un;if(Array.isArray(jt[0])){Qr=mf(jt);for(var Kt=1,ir=1;ir<Qr.length;++ir)Kt*=Qr[ir];ot.dimension=Kt,Un=as(jt,Qr,ot.dtype),Tr(ot,Un,br),Rr?ot.persistentData=Un:Pt.freeType(Un)}else if(typeof jt[0]=="number"){ot.dimension=cr;var En=Pt.allocType(ot.dtype,jt.length);_(En,jt),Tr(ot,En,br),Rr?ot.persistentData=En:Pt.freeType(En)}else ue(jt[0])?(ot.dimension=jt[0].length,ot.dtype=Zr||ul(jt[0])||Yu,Un=as(jt,[jt.length,jt[0].length],ot.dtype),Tr(ot,Un,br),Rr?ot.persistentData=Un:Pt.freeType(Un)):me.raise("invalid buffer data")}}else if(ue(jt))ot.dtype=Zr||ul(jt),ot.dimension=cr,Tr(ot,jt,br),Rr&&(ot.persistentData=new Uint8Array(new Uint8Array(jt.buffer)));else if(_s(jt)){Qr=jt.shape;var Hr=jt.stride,Sr=jt.offset,qr=0,Kr=0,gi=0,si=0;Qr.length===1?(qr=Qr[0],Kr=1,gi=Hr[0],si=0):Qr.length===2?(qr=Qr[0],Kr=Qr[1],gi=Hr[0],si=Hr[1]):me.raise("invalid shape"),ot.dtype=Zr||ul(jt.data)||Yu,ot.dimension=Kr;var Wr=Pt.allocType(ot.dtype,qr*Kr);M(Wr,jt.data,qr,Kr,gi,si,Sr),Tr(ot,Wr,br),Rr?ot.persistentData=Wr:Pt.freeType(Wr)}else jt instanceof ArrayBuffer?(ot.dtype=ac,ot.dimension=cr,Tr(ot,jt,br),Rr&&(ot.persistentData=new Uint8Array(new Uint8Array(jt)))):me.raise("invalid buffer data")}function Gr(ot){ve.bufferCount--,Dt(ot);var jt=ot.buffer;me(jt,"buffer must not be deleted already"),N.deleteBuffer(jt),ot.buffer=null,delete kt[ot.id]}function yr(ot,jt,br,Zr){ve.bufferCount++;var cr=new qt(jt);kt[cr.id]=cr;function Rr(Kt){var ir=Ol,En=null,Hr=0,Sr=0,qr=1;return Array.isArray(Kt)||ue(Kt)||_s(Kt)||Kt instanceof ArrayBuffer?En=Kt:typeof Kt=="number"?Hr=Kt|0:Kt&&(me.type(Kt,"object","buffer arguments must be an object, a number or an array"),"data"in Kt&&(me(En===null||Array.isArray(En)||ue(En)||_s(En),"invalid data for buffer"),En=Kt.data),"usage"in Kt&&(me.parameter(Kt.usage,_a,"invalid buffer usage"),ir=_a[Kt.usage]),"type"in Kt&&(me.parameter(Kt.type,fu,"invalid buffer type"),Sr=fu[Kt.type]),"dimension"in Kt&&(me.type(Kt.dimension,"number","invalid dimension"),qr=Kt.dimension|0),"length"in Kt&&(me.nni(Hr,"buffer length must be a nonnegative integer"),Hr=Kt.length|0)),cr.bind(),En?Mr(cr,En,ir,Sr,qr,Zr):(Hr&&N.bufferData(cr.type,Hr,ir),cr.dtype=Sr||ac,cr.usage=ir,cr.dimension=qr,cr.byteLength=Hr),Ne.profile&&(cr.stats.size=cr.byteLength*Ks[cr.dtype]),Rr}function Qr(Kt,ir){me(ir+Kt.byteLength<=cr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+Kt.byteLength+" starting from offset "+ir+" to a buffer of size "+cr.byteLength),N.bufferSubData(cr.type,ir,Kt)}function Un(Kt,ir){var En=(ir||0)|0,Hr;if(cr.bind(),ue(Kt)||Kt instanceof ArrayBuffer)Qr(Kt,En);else if(Array.isArray(Kt)){if(Kt.length>0)if(typeof Kt[0]=="number"){var Sr=Pt.allocType(cr.dtype,Kt.length);_(Sr,Kt),Qr(Sr,En),Pt.freeType(Sr)}else if(Array.isArray(Kt[0])||ue(Kt[0])){Hr=mf(Kt);var qr=as(Kt,Hr,cr.dtype);Qr(qr,En),Pt.freeType(qr)}else me.raise("invalid buffer data")}else if(_s(Kt)){Hr=Kt.shape;var Kr=Kt.stride,gi=0,si=0,Wr=0,nn=0;Hr.length===1?(gi=Hr[0],si=1,Wr=Kr[0],nn=0):Hr.length===2?(gi=Hr[0],si=Hr[1],Wr=Kr[0],nn=Kr[1]):me.raise("invalid shape");var Jn=Array.isArray(Kt.data)?cr.dtype:ul(Kt.data),fi=Pt.allocType(Jn,gi*si);M(fi,Kt.data,gi,si,Wr,nn,Kt.offset),Qr(fi,En),Pt.freeType(fi)}else me.raise("invalid data for buffer subdata");return Rr}return br||Rr(ot),Rr._reglType="buffer",Rr._buffer=cr,Rr.subdata=Un,Ne.profile&&(Rr.stats=cr.stats),Rr.destroy=function(){Gr(cr)},Rr}function Cr(){re(kt).forEach(function(ot){ot.buffer=N.createBuffer(),N.bindBuffer(ot.type,ot.buffer),N.bufferData(ot.type,ot.persistentData||ot.byteLength,ot.usage)})}return Ne.profile&&(ve.getTotalBufferSize=function(){var ot=0;return Object.keys(kt).forEach(function(jt){ot+=kt[jt].stats.size}),ot}),{create:yr,createStream:mr,destroyStream:xr,clear:function(){re(kt).forEach(Gr),fr.forEach(Gr)},getBuffer:function(ot){return ot&&ot._buffer instanceof qt?ot._buffer:null},restore:Cr,_initBuffer:Mr}}var R=0,$=0,be=1,We=1,ht=4,vt=4,or={points:R,point:$,lines:be,line:We,triangles:ht,triangle:vt,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},lr=0,Rn=1,ai=4,Fn=5120,Yi=5121,da=5122,Ca=5123,Hi=5124,Ss=5125,hu=34963,qu=35040,gf=35044;function ll(N,ve,Ne,Dt){var ar={},kt=0,qt={uint8:Yi,uint16:Ca};ve.oes_element_index_uint&&(qt.uint32=Ss);function fr(Cr){this.id=kt++,ar[this.id]=this,this.buffer=Cr,this.primType=ai,this.vertCount=0,this.type=0}fr.prototype.bind=function(){this.buffer.bind()};var mr=[];function xr(Cr){var ot=mr.pop();return ot||(ot=new fr(Ne.create(null,hu,!0,!1)._buffer)),Mr(ot,Cr,qu,-1,-1,0,0),ot}function Tr(Cr){mr.push(Cr)}function Mr(Cr,ot,jt,br,Zr,cr,Rr){Cr.buffer.bind();var Qr;if(ot){var Un=Rr;!Rr&&(!ue(ot)||_s(ot)&&!ue(ot.data))&&(Un=ve.oes_element_index_uint?Ss:Ca),Ne._initBuffer(Cr.buffer,ot,jt,Un,3)}else N.bufferData(hu,cr,jt),Cr.buffer.dtype=Qr||Yi,Cr.buffer.usage=jt,Cr.buffer.dimension=3,Cr.buffer.byteLength=cr;if(Qr=Rr,!Rr){switch(Cr.buffer.dtype){case Yi:case Fn:Qr=Yi;break;case Ca:case da:Qr=Ca;break;case Ss:case Hi:Qr=Ss;break;default:me.raise("unsupported type for element array")}Cr.buffer.dtype=Qr}Cr.type=Qr,me(Qr!==Ss||!!ve.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var Kt=Zr;Kt<0&&(Kt=Cr.buffer.byteLength,Qr===Ca?Kt>>=1:Qr===Ss&&(Kt>>=2)),Cr.vertCount=Kt;var ir=br;if(br<0){ir=ai;var En=Cr.buffer.dimension;En===1&&(ir=lr),En===2&&(ir=Rn),En===3&&(ir=ai)}Cr.primType=ir}function Gr(Cr){Dt.elementsCount--,me(Cr.buffer!==null,"must not double destroy elements"),delete ar[Cr.id],Cr.buffer.destroy(),Cr.buffer=null}function yr(Cr,ot){var jt=Ne.create(null,hu,!0),br=new fr(jt._buffer);Dt.elementsCount++;function Zr(cr){if(!cr)jt(),br.primType=ai,br.vertCount=0,br.type=Yi;else if(typeof cr=="number")jt(cr),br.primType=ai,br.vertCount=cr|0,br.type=Yi;else{var Rr=null,Qr=gf,Un=-1,Kt=-1,ir=0,En=0;Array.isArray(cr)||ue(cr)||_s(cr)?Rr=cr:(me.type(cr,"object","invalid arguments for elements"),"data"in cr&&(Rr=cr.data,me(Array.isArray(Rr)||ue(Rr)||_s(Rr),"invalid data for element buffer")),"usage"in cr&&(me.parameter(cr.usage,_a,"invalid element buffer usage"),Qr=_a[cr.usage]),"primitive"in cr&&(me.parameter(cr.primitive,or,"invalid element buffer primitive"),Un=or[cr.primitive]),"count"in cr&&(me(typeof cr.count=="number"&&cr.count>=0,"invalid vertex count for elements"),Kt=cr.count|0),"type"in cr&&(me.parameter(cr.type,qt,"invalid buffer type"),En=qt[cr.type]),"length"in cr?ir=cr.length|0:(ir=Kt,En===Ca||En===da?ir*=2:(En===Ss||En===Hi)&&(ir*=4))),Mr(br,Rr,Qr,Un,Kt,ir,En)}return Zr}return Zr(Cr),Zr._reglType="elements",Zr._elements=br,Zr.subdata=function(cr,Rr){return jt.subdata(cr,Rr),Zr},Zr.destroy=function(){Gr(br)},Zr}return{create:yr,createStream:xr,destroyStream:Tr,getElements:function(Cr){return typeof Cr=="function"&&Cr._elements instanceof fr?Cr._elements:null},clear:function(){re(ar).forEach(Gr)}}}var Bc=new Float32Array(1),Tu=new Uint32Array(Bc.buffer),Mu=5123;function Pu(N){for(var ve=Pt.allocType(Mu,N.length),Ne=0;Ne<N.length;++Ne)if(isNaN(N[Ne]))ve[Ne]=65535;else if(N[Ne]===Infinity)ve[Ne]=31744;else if(N[Ne]===-Infinity)ve[Ne]=64512;else{Bc[0]=N[Ne];var Dt=Tu[0],ar=Dt>>>31<<15,kt=(Dt<<1>>>24)-127,qt=Dt>>13&(1<<10)-1;if(kt<-24)ve[Ne]=ar;else if(kt<-14){var fr=-14-kt;ve[Ne]=ar+(qt+(1<<10)>>fr)}else kt>15?ve[Ne]=ar+31744:ve[Ne]=ar+(kt+15<<10)+qt}return ve}function lo(N){return Array.isArray(N)||ue(N)}var Gf=function(N){return!(N&N-1)&&!!N},Hf=34467,$o=3553,Nc=34067,Iu=34069,pu=6408,yf=6406,Rl=6407,zi=6409,kl=6410,Mh=32854,cl=32855,zc=36194,Wf=32819,Ph=32820,Xf=33635,Zc=34042,oc=6402,sc=34041,Ll=35904,fl=35906,Dl=36193,Ku=33776,$s=33777,_f=33778,xf=33779,Yf=35986,du=35987,uc=34798,Uc=35840,bf=35841,Fl=35842,hp=35843,Ef=36196,Bl=5121,Sf=5123,Cf=5125,Nl=5126,jc=10242,Ih=10243,Oh=10497,lc=33071,Rh=33648,zl=10240,Ji=10241,cc=9728,ca=9729,Ou=9984,qi=9985,Pa=9986,Cs=9987,Vc=33170,$u=4352,Ua=4353,fc=4354,Zl=34046,Qu=3317,Gc=37440,Ru=37441,mo=37443,Ul=37444,hc=33984,go=[Ou,Pa,qi,Cs],gn=[0,zi,kl,Rl,pu],co={};co[zi]=co[yf]=co[oc]=1,co[sc]=co[kl]=2,co[Rl]=co[Ll]=3,co[pu]=co[fl]=4;function Ju(N){return"[object "+N+"]"}var ka=Ju("HTMLCanvasElement"),Qs=Ju("OffscreenCanvas"),Is=Ju("CanvasRenderingContext2D"),Af=Ju("ImageBitmap"),Vr=Ju("HTMLImageElement"),pc=Ju("HTMLVideoElement"),wf=Object.keys(Ra).concat([ka,Qs,Is,Af,Vr,pc]),hl=[];hl[Bl]=1,hl[Nl]=4,hl[Dl]=2,hl[Sf]=2,hl[Cf]=4;var Aa=[];Aa[Mh]=2,Aa[cl]=2,Aa[zc]=2,Aa[sc]=4,Aa[Ku]=.5,Aa[$s]=.5,Aa[_f]=1,Aa[xf]=1,Aa[Yf]=.5,Aa[du]=1,Aa[uc]=1,Aa[Uc]=.5,Aa[bf]=.25,Aa[Fl]=.5,Aa[hp]=.25,Aa[Ef]=.5;function As(N){return Array.isArray(N)&&(N.length===0||typeof N[0]=="number")}function Tf(N){if(!Array.isArray(N))return!1;var ve=N.length;return!(ve===0||!lo(N[0]))}function ku(N){return Object.prototype.toString.call(N)}function Bs(N){return ku(N)===ka}function Lu(N){return ku(N)===Qs}function qf(N){return ku(N)===Is}function pl(N){return ku(N)===Af}function Kf(N){return ku(N)===Vr}function Mf(N){return ku(N)===pc}function vu(N){var ve=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(ve&&N&&N.getContext)}function Os(N){var ve=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(ve&&N&&"src"in N&&"crossOrigin"in N)}function Mi(N){if(!N)return!1;if(vu(N)||Os(N))return!0;var ve=ku(N);return wf.indexOf(ve)>=0?!0:As(N)||Tf(N)||_s(N)}function Du(N){return Ra[Object.prototype.toString.call(N)]|0}function mu(N,ve){var Ne=ve.length;switch(N.type){case Bl:case Sf:case Cf:case Nl:var Dt=Pt.allocType(N.type,Ne);Dt.set(ve),N.data=Dt;break;case Dl:N.data=Pu(ve);break;default:me.raise("unsupported texture type, must specify a typed array")}}function Go(N,ve){return Pt.allocType(N.type===Dl?Nl:N.type,ve)}function dl(N,ve){N.type===Dl?(N.data=Pu(ve),Pt.freeType(ve)):N.data=ve}function os(N,ve,Ne,Dt,ar,kt){for(var qt=N.width,fr=N.height,mr=N.channels,xr=qt*fr*mr,Tr=Go(N,xr),Mr=0,Gr=0;Gr<fr;++Gr)for(var yr=0;yr<qt;++yr)for(var Cr=0;Cr<mr;++Cr)Tr[Mr++]=ve[Ne*yr+Dt*Gr+ar*Cr+kt];dl(N,Tr)}function Js(N,ve,Ne,Dt,ar,kt){var qt;if(typeof Aa[N]!="undefined"?qt=Aa[N]:qt=co[N]*hl[ve],kt&&(qt*=6),ar){for(var fr=0,mr=Ne;mr>=1;)fr+=qt*mr*mr,mr/=2;return fr}else return qt*Ne*Dt}function ws(N,ve,Ne,Dt,ar,kt,qt){var fr={"don't care":$u,"dont care":$u,nice:fc,fast:Ua},mr={repeat:Oh,clamp:lc,mirror:Rh},xr={nearest:cc,linear:ca},Tr=g({mipmap:Cs,"nearest mipmap nearest":Ou,"linear mipmap nearest":qi,"nearest mipmap linear":Pa,"linear mipmap linear":Cs},xr),Mr={none:0,browser:Ul},Gr={uint8:Bl,rgba4:Wf,rgb565:Xf,"rgb5 a1":Ph},yr={alpha:yf,luminance:zi,"luminance alpha":kl,rgb:Rl,rgba:pu,rgba4:Mh,"rgb5 a1":cl,rgb565:zc},Cr={};ve.ext_srgb&&(yr.srgb=Ll,yr.srgba=fl),ve.oes_texture_float&&(Gr.float32=Gr.float=Nl),ve.oes_texture_half_float&&(Gr.float16=Gr["half float"]=Dl),ve.webgl_depth_texture&&(g(yr,{depth:oc,"depth stencil":sc}),g(Gr,{uint16:Sf,uint32:Cf,"depth stencil":Zc})),ve.webgl_compressed_texture_s3tc&&g(Cr,{"rgb s3tc dxt1":Ku,"rgba s3tc dxt1":$s,"rgba s3tc dxt3":_f,"rgba s3tc dxt5":xf}),ve.webgl_compressed_texture_atc&&g(Cr,{"rgb atc":Yf,"rgba atc explicit alpha":du,"rgba atc interpolated alpha":uc}),ve.webgl_compressed_texture_pvrtc&&g(Cr,{"rgb pvrtc 4bppv1":Uc,"rgb pvrtc 2bppv1":bf,"rgba pvrtc 4bppv1":Fl,"rgba pvrtc 2bppv1":hp}),ve.webgl_compressed_texture_etc1&&(Cr["rgb etc1"]=Ef);var ot=Array.prototype.slice.call(N.getParameter(Hf)||new Uint32Array(0));Object.keys(Cr).forEach(function(Me){var Nt=Cr[Me];ot.indexOf(Nt)>=0&&(yr[Me]=Nt)});var jt=Object.keys(yr);Ne.textureFormats=jt;var br=[];Object.keys(yr).forEach(function(Me){var Nt=yr[Me];br[Nt]=Me});var Zr=[];Object.keys(Gr).forEach(function(Me){var Nt=Gr[Me];Zr[Nt]=Me});var cr=[];Object.keys(xr).forEach(function(Me){var Nt=xr[Me];cr[Nt]=Me});var Rr=[];Object.keys(Tr).forEach(function(Me){var Nt=Tr[Me];Rr[Nt]=Me});var Qr=[];Object.keys(mr).forEach(function(Me){var Nt=mr[Me];Qr[Nt]=Me});var Un=jt.reduce(function(Me,Nt){var At=yr[Nt];return At===zi||At===yf||At===zi||At===kl||At===oc||At===sc||ve.ext_srgb&&(At===Ll||At===fl)?Me[At]=At:At===cl||Nt.indexOf("rgba")>=0?Me[At]=pu:Me[At]=Rl,Me},{});function Kt(){this.internalformat=pu,this.format=pu,this.type=Bl,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Ul,this.width=0,this.height=0,this.channels=0}function ir(Me,Nt){Me.internalformat=Nt.internalformat,Me.format=Nt.format,Me.type=Nt.type,Me.compressed=Nt.compressed,Me.premultiplyAlpha=Nt.premultiplyAlpha,Me.flipY=Nt.flipY,Me.unpackAlignment=Nt.unpackAlignment,Me.colorSpace=Nt.colorSpace,Me.width=Nt.width,Me.height=Nt.height,Me.channels=Nt.channels}function En(Me,Nt){if(!(typeof Nt!="object"||!Nt)){if("premultiplyAlpha"in Nt&&(me.type(Nt.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Me.premultiplyAlpha=Nt.premultiplyAlpha),"flipY"in Nt&&(me.type(Nt.flipY,"boolean","invalid texture flip"),Me.flipY=Nt.flipY),"alignment"in Nt&&(me.oneOf(Nt.alignment,[1,2,4,8],"invalid texture unpack alignment"),Me.unpackAlignment=Nt.alignment),"colorSpace"in Nt&&(me.parameter(Nt.colorSpace,Mr,"invalid colorSpace"),Me.colorSpace=Mr[Nt.colorSpace]),"type"in Nt){var At=Nt.type;me(ve.oes_texture_float||!(At==="float"||At==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),me(ve.oes_texture_half_float||!(At==="half float"||At==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),me(ve.webgl_depth_texture||!(At==="uint16"||At==="uint32"||At==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),me.parameter(At,Gr,"invalid texture type"),Me.type=Gr[At]}var yn=Me.width,Wi=Me.height,we=Me.channels,oe=!1;"shape"in Nt?(me(Array.isArray(Nt.shape)&&Nt.shape.length>=2,"shape must be an array"),yn=Nt.shape[0],Wi=Nt.shape[1],Nt.shape.length===3&&(we=Nt.shape[2],me(we>0&&we<=4,"invalid number of channels"),oe=!0),me(yn>=0&&yn<=Ne.maxTextureSize,"invalid width"),me(Wi>=0&&Wi<=Ne.maxTextureSize,"invalid height")):("radius"in Nt&&(yn=Wi=Nt.radius,me(yn>=0&&yn<=Ne.maxTextureSize,"invalid radius")),"width"in Nt&&(yn=Nt.width,me(yn>=0&&yn<=Ne.maxTextureSize,"invalid width")),"height"in Nt&&(Wi=Nt.height,me(Wi>=0&&Wi<=Ne.maxTextureSize,"invalid height")),"channels"in Nt&&(we=Nt.channels,me(we>0&&we<=4,"invalid number of channels"),oe=!0)),Me.width=yn|0,Me.height=Wi|0,Me.channels=we|0;var Ve=!1;if("format"in Nt){var ct=Nt.format;me(ve.webgl_depth_texture||!(ct==="depth"||ct==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),me.parameter(ct,yr,"invalid texture format");var Ot=Me.internalformat=yr[ct];Me.format=Un[Ot],ct in Gr&&("type"in Nt||(Me.type=Gr[ct])),ct in Cr&&(Me.compressed=!0),Ve=!0}!oe&&Ve?Me.channels=co[Me.format]:oe&&!Ve?Me.channels!==gn[Me.format]&&(Me.format=Me.internalformat=gn[Me.channels]):Ve&&oe&&me(Me.channels===co[Me.format],"number of channels inconsistent with specified format")}}function Hr(Me){N.pixelStorei(Gc,Me.flipY),N.pixelStorei(Ru,Me.premultiplyAlpha),N.pixelStorei(mo,Me.colorSpace),N.pixelStorei(Qu,Me.unpackAlignment)}function Sr(){Kt.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function qr(Me,Nt){var At=null;if(Mi(Nt)?At=Nt:Nt&&(me.type(Nt,"object","invalid pixel data type"),En(Me,Nt),"x"in Nt&&(Me.xOffset=Nt.x|0),"y"in Nt&&(Me.yOffset=Nt.y|0),Mi(Nt.data)&&(At=Nt.data)),me(!Me.compressed||At instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),Nt.copy){me(!At,"can not specify copy and data field for the same texture");var yn=ar.viewportWidth,Wi=ar.viewportHeight;Me.width=Me.width||yn-Me.xOffset,Me.height=Me.height||Wi-Me.yOffset,Me.needsCopy=!0,me(Me.xOffset>=0&&Me.xOffset<yn&&Me.yOffset>=0&&Me.yOffset<Wi&&Me.width>0&&Me.width<=yn&&Me.height>0&&Me.height<=Wi,"copy texture read out of bounds")}else if(!At)Me.width=Me.width||1,Me.height=Me.height||1,Me.channels=Me.channels||4;else if(ue(At))Me.channels=Me.channels||4,Me.data=At,!("type"in Nt)&&Me.type===Bl&&(Me.type=Du(At));else if(As(At))Me.channels=Me.channels||4,mu(Me,At),Me.alignment=1,Me.needsFree=!0;else if(_s(At)){var we=At.data;!Array.isArray(we)&&Me.type===Bl&&(Me.type=Du(we));var oe=At.shape,Ve=At.stride,ct,Ot,qe,De,rt,xe;oe.length===3?(qe=oe[2],xe=Ve[2]):(me(oe.length===2,"invalid ndarray pixel data, must be 2 or 3D"),qe=1,xe=1),ct=oe[0],Ot=oe[1],De=Ve[0],rt=Ve[1],Me.alignment=1,Me.width=ct,Me.height=Ot,Me.channels=qe,Me.format=Me.internalformat=gn[qe],Me.needsFree=!0,os(Me,we,De,rt,xe,At.offset)}else if(vu(At)||Bs(At)||Lu(At)||qf(At))vu(At)||Bs(At)||Lu(At)?Me.element=At:Me.element=At.canvas,Me.width=Me.element.width,Me.height=Me.element.height,Me.channels=4;else if(pl(At))Me.element=At,Me.width=At.width,Me.height=At.height,Me.channels=4;else if(Kf(At))Me.element=At,Me.width=At.naturalWidth,Me.height=At.naturalHeight,Me.channels=4;else if(Os(At))Me.element=At,Me.width=At.width,Me.height=At.height,Me.channels=4;else if(Mf(At))Me.element=At,Me.width=At.videoWidth,Me.height=At.videoHeight,Me.channels=4;else if(Tf(At)){var Ue=Me.width||At[0].length,Te=Me.height||At.length,ft=Me.channels;lo(At[0][0])?ft=ft||At[0][0].length:ft=ft||1;for(var Tt=Se.shape(At),hr=1,Ur=0;Ur<Tt.length;++Ur)hr*=Tt[Ur];var jr=Go(Me,hr);Se.flatten(At,Tt,"",jr),dl(Me,jr),Me.alignment=1,Me.width=Ue,Me.height=Te,Me.channels=ft,Me.format=Me.internalformat=gn[ft],Me.needsFree=!0}Me.type===Nl?me(Ne.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Me.type===Dl&&me(Ne.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Kr(Me,Nt,At){var yn=Me.element,Wi=Me.data,we=Me.internalformat,oe=Me.format,Ve=Me.type,ct=Me.width,Ot=Me.height;Hr(Me),yn?N.texImage2D(Nt,At,oe,oe,Ve,yn):Me.compressed?N.compressedTexImage2D(Nt,At,we,ct,Ot,0,Wi):Me.needsCopy?(Dt(),N.copyTexImage2D(Nt,At,oe,Me.xOffset,Me.yOffset,ct,Ot,0)):N.texImage2D(Nt,At,oe,ct,Ot,0,oe,Ve,Wi||null)}function gi(Me,Nt,At,yn,Wi){var we=Me.element,oe=Me.data,Ve=Me.internalformat,ct=Me.format,Ot=Me.type,qe=Me.width,De=Me.height;Hr(Me),we?N.texSubImage2D(Nt,Wi,At,yn,ct,Ot,we):Me.compressed?N.compressedTexSubImage2D(Nt,Wi,At,yn,Ve,qe,De,oe):Me.needsCopy?(Dt(),N.copyTexSubImage2D(Nt,Wi,At,yn,Me.xOffset,Me.yOffset,qe,De)):N.texSubImage2D(Nt,Wi,At,yn,qe,De,ct,Ot,oe)}var si=[];function Wr(){return si.pop()||new Sr}function nn(Me){Me.needsFree&&Pt.freeType(Me.data),Sr.call(Me),si.push(Me)}function Jn(){Kt.call(this),this.genMipmaps=!1,this.mipmapHint=$u,this.mipmask=0,this.images=Array(16)}function fi(Me,Nt,At){var yn=Me.images[0]=Wr();Me.mipmask=1,yn.width=Me.width=Nt,yn.height=Me.height=At,yn.channels=Me.channels=4}function Zi(Me,Nt){var At=null;if(Mi(Nt))At=Me.images[0]=Wr(),ir(At,Me),qr(At,Nt),Me.mipmask=1;else if(En(Me,Nt),Array.isArray(Nt.mipmap))for(var yn=Nt.mipmap,Wi=0;Wi<yn.length;++Wi)At=Me.images[Wi]=Wr(),ir(At,Me),At.width>>=Wi,At.height>>=Wi,qr(At,yn[Wi]),Me.mipmask|=1<<Wi;else At=Me.images[0]=Wr(),ir(At,Me),qr(At,Nt),Me.mipmask=1;ir(Me,Me.images[0]),Me.compressed&&(Me.internalformat===Ku||Me.internalformat===$s||Me.internalformat===_f||Me.internalformat===xf)&&me(Me.width%4==0&&Me.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function oo(Me,Nt){for(var At=Me.images,yn=0;yn<At.length;++yn){if(!At[yn])return;Kr(At[yn],Nt,yn)}}var so=[];function Ni(){var Me=so.pop()||new Jn;Kt.call(Me),Me.mipmask=0;for(var Nt=0;Nt<16;++Nt)Me.images[Nt]=null;return Me}function ts(Me){for(var Nt=Me.images,At=0;At<Nt.length;++At)Nt[At]&&nn(Nt[At]),Nt[At]=null;so.push(Me)}function ja(){this.minFilter=cc,this.magFilter=cc,this.wrapS=lc,this.wrapT=lc,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=$u}function No(Me,Nt){if("min"in Nt){var At=Nt.min;me.parameter(At,Tr),Me.minFilter=Tr[At],go.indexOf(Me.minFilter)>=0&&!("faces"in Nt)&&(Me.genMipmaps=!0)}if("mag"in Nt){var yn=Nt.mag;me.parameter(yn,xr),Me.magFilter=xr[yn]}var Wi=Me.wrapS,we=Me.wrapT;if("wrap"in Nt){var oe=Nt.wrap;typeof oe=="string"?(me.parameter(oe,mr),Wi=we=mr[oe]):Array.isArray(oe)&&(me.parameter(oe[0],mr),me.parameter(oe[1],mr),Wi=mr[oe[0]],we=mr[oe[1]])}else{if("wrapS"in Nt){var Ve=Nt.wrapS;me.parameter(Ve,mr),Wi=mr[Ve]}if("wrapT"in Nt){var ct=Nt.wrapT;me.parameter(ct,mr),we=mr[ct]}}if(Me.wrapS=Wi,Me.wrapT=we,"anisotropic"in Nt){var Ot=Nt.anisotropic;me(typeof Ot=="number"&&Ot>=1&&Ot<=Ne.maxAnisotropic,"aniso samples must be between 1 and "),Me.anisotropic=Nt.anisotropic}if("mipmap"in Nt){var qe=!1;switch(typeof Nt.mipmap){case"string":me.parameter(Nt.mipmap,fr,"invalid mipmap hint"),Me.mipmapHint=fr[Nt.mipmap],Me.genMipmaps=!0,qe=!0;break;case"boolean":qe=Me.genMipmaps=Nt.mipmap;break;case"object":me(Array.isArray(Nt.mipmap),"invalid mipmap type"),Me.genMipmaps=!1,qe=!0;break;default:me.raise("invalid mipmap type")}qe&&!("min"in Nt)&&(Me.minFilter=Ou)}}function So(Me,Nt){N.texParameteri(Nt,Ji,Me.minFilter),N.texParameteri(Nt,zl,Me.magFilter),N.texParameteri(Nt,jc,Me.wrapS),N.texParameteri(Nt,Ih,Me.wrapT),ve.ext_texture_filter_anisotropic&&N.texParameteri(Nt,Zl,Me.anisotropic),Me.genMipmaps&&(N.hint(Vc,Me.mipmapHint),N.generateMipmap(Nt))}var Wo=0,Io={},fs=Ne.maxTextureUnits,ho=Array(fs).map(function(){return null});function yi(Me){Kt.call(this),this.mipmask=0,this.internalformat=pu,this.id=Wo++,this.refCount=1,this.target=Me,this.texture=N.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new ja,qt.profile&&(this.stats={size:0})}function Oo(Me){N.activeTexture(hc),N.bindTexture(Me.target,Me.texture)}function ea(){var Me=ho[0];Me?N.bindTexture(Me.target,Me.texture):N.bindTexture($o,null)}function zo(Me){var Nt=Me.texture;me(Nt,"must not double destroy texture");var At=Me.unit,yn=Me.target;At>=0&&(N.activeTexture(hc+At),N.bindTexture(yn,null),ho[At]=null),N.deleteTexture(Nt),Me.texture=null,Me.params=null,Me.pixels=null,Me.refCount=0,delete Io[Me.id],kt.textureCount--}g(yi.prototype,{bind:function(){var Me=this;Me.bindCount+=1;var Nt=Me.unit;if(Nt<0){for(var At=0;At<fs;++At){var yn=ho[At];if(yn){if(yn.bindCount>0)continue;yn.unit=-1}ho[At]=Me,Nt=At;break}Nt>=fs&&me.raise("insufficient number of texture units"),qt.profile&&kt.maxTextureUnits<Nt+1&&(kt.maxTextureUnits=Nt+1),Me.unit=Nt,N.activeTexture(hc+Nt),N.bindTexture(Me.target,Me.texture)}return Nt},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&zo(this)}});function ri(Me,Nt){var At=new yi($o);Io[At.id]=At,kt.textureCount++;function yn(oe,Ve){var ct=At.texInfo;ja.call(ct);var Ot=Ni();return typeof oe=="number"?typeof Ve=="number"?fi(Ot,oe|0,Ve|0):fi(Ot,oe|0,oe|0):oe?(me.type(oe,"object","invalid arguments to regl.texture"),No(ct,oe),Zi(Ot,oe)):fi(Ot,1,1),ct.genMipmaps&&(Ot.mipmask=(Ot.width<<1)-1),At.mipmask=Ot.mipmask,ir(At,Ot),me.texture2D(ct,Ot,Ne),At.internalformat=Ot.internalformat,yn.width=Ot.width,yn.height=Ot.height,Oo(At),oo(Ot,$o),So(ct,$o),ea(),ts(Ot),qt.profile&&(At.stats.size=Js(At.internalformat,At.type,Ot.width,Ot.height,ct.genMipmaps,!1)),yn.format=br[At.internalformat],yn.type=Zr[At.type],yn.mag=cr[ct.magFilter],yn.min=Rr[ct.minFilter],yn.wrapS=Qr[ct.wrapS],yn.wrapT=Qr[ct.wrapT],yn}function Wi(oe,Ve,ct,Ot){me(!!oe,"must specify image data");var qe=Ve|0,De=ct|0,rt=Ot|0,xe=Wr();return ir(xe,At),xe.width=0,xe.height=0,qr(xe,oe),xe.width=xe.width||(At.width>>rt)-qe,xe.height=xe.height||(At.height>>rt)-De,me(At.type===xe.type&&At.format===xe.format&&At.internalformat===xe.internalformat,"incompatible format for texture.subimage"),me(qe>=0&&De>=0&&qe+xe.width<=At.width&&De+xe.height<=At.height,"texture.subimage write out of bounds"),me(At.mipmask&1<<rt,"missing mipmap data"),me(xe.data||xe.element||xe.needsCopy,"missing image data"),Oo(At),gi(xe,$o,qe,De,rt),ea(),nn(xe),yn}function we(oe,Ve){var ct=oe|0,Ot=Ve|0||ct;if(ct===At.width&&Ot===At.height)return yn;yn.width=At.width=ct,yn.height=At.height=Ot,Oo(At);for(var qe=0;At.mipmask>>qe;++qe){var De=ct>>qe,rt=Ot>>qe;if(!De||!rt)break;N.texImage2D($o,qe,At.format,De,rt,0,At.format,At.type,null)}return ea(),qt.profile&&(At.stats.size=Js(At.internalformat,At.type,ct,Ot,!1,!1)),yn}return yn(Me,Nt),yn.subimage=Wi,yn.resize=we,yn._reglType="texture2d",yn._texture=At,qt.profile&&(yn.stats=At.stats),yn.destroy=function(){At.decRef()},yn}function Ui(Me,Nt,At,yn,Wi,we){var oe=new yi(Nc);Io[oe.id]=oe,kt.cubeCount++;var Ve=new Array(6);function ct(De,rt,xe,Ue,Te,ft){var Tt,hr=oe.texInfo;for(ja.call(hr),Tt=0;Tt<6;++Tt)Ve[Tt]=Ni();if(typeof De=="number"||!De){var Ur=De|0||1;for(Tt=0;Tt<6;++Tt)fi(Ve[Tt],Ur,Ur)}else if(typeof De=="object")if(rt)Zi(Ve[0],De),Zi(Ve[1],rt),Zi(Ve[2],xe),Zi(Ve[3],Ue),Zi(Ve[4],Te),Zi(Ve[5],ft);else if(No(hr,De),En(oe,De),"faces"in De){var jr=De.faces;for(me(Array.isArray(jr)&&jr.length===6,"cube faces must be a length 6 array"),Tt=0;Tt<6;++Tt)me(typeof jr[Tt]=="object"&&!!jr[Tt],"invalid input for cube map face"),ir(Ve[Tt],oe),Zi(Ve[Tt],jr[Tt])}else for(Tt=0;Tt<6;++Tt)Zi(Ve[Tt],De);else me.raise("invalid arguments to cube map");for(ir(oe,Ve[0]),me.optional(function(){Ne.npotTextureCube||me(Gf(oe.width)&&Gf(oe.height),"your browser does not support non power or two texture dimensions")}),hr.genMipmaps?oe.mipmask=(Ve[0].width<<1)-1:oe.mipmask=Ve[0].mipmask,me.textureCube(oe,hr,Ve,Ne),oe.internalformat=Ve[0].internalformat,ct.width=Ve[0].width,ct.height=Ve[0].height,Oo(oe),Tt=0;Tt<6;++Tt)oo(Ve[Tt],Iu+Tt);for(So(hr,Nc),ea(),qt.profile&&(oe.stats.size=Js(oe.internalformat,oe.type,ct.width,ct.height,hr.genMipmaps,!0)),ct.format=br[oe.internalformat],ct.type=Zr[oe.type],ct.mag=cr[hr.magFilter],ct.min=Rr[hr.minFilter],ct.wrapS=Qr[hr.wrapS],ct.wrapT=Qr[hr.wrapT],Tt=0;Tt<6;++Tt)ts(Ve[Tt]);return ct}function Ot(De,rt,xe,Ue,Te){me(!!rt,"must specify image data"),me(typeof De=="number"&&De===(De|0)&&De>=0&&De<6,"invalid face");var ft=xe|0,Tt=Ue|0,hr=Te|0,Ur=Wr();return ir(Ur,oe),Ur.width=0,Ur.height=0,qr(Ur,rt),Ur.width=Ur.width||(oe.width>>hr)-ft,Ur.height=Ur.height||(oe.height>>hr)-Tt,me(oe.type===Ur.type&&oe.format===Ur.format&&oe.internalformat===Ur.internalformat,"incompatible format for texture.subimage"),me(ft>=0&&Tt>=0&&ft+Ur.width<=oe.width&&Tt+Ur.height<=oe.height,"texture.subimage write out of bounds"),me(oe.mipmask&1<<hr,"missing mipmap data"),me(Ur.data||Ur.element||Ur.needsCopy,"missing image data"),Oo(oe),gi(Ur,Iu+De,ft,Tt,hr),ea(),nn(Ur),ct}function qe(De){var rt=De|0;if(rt!==oe.width){ct.width=oe.width=rt,ct.height=oe.height=rt,Oo(oe);for(var xe=0;xe<6;++xe)for(var Ue=0;oe.mipmask>>Ue;++Ue)N.texImage2D(Iu+xe,Ue,oe.format,rt>>Ue,rt>>Ue,0,oe.format,oe.type,null);return ea(),qt.profile&&(oe.stats.size=Js(oe.internalformat,oe.type,ct.width,ct.height,!1,!0)),ct}}return ct(Me,Nt,At,yn,Wi,we),ct.subimage=Ot,ct.resize=qe,ct._reglType="textureCube",ct._texture=oe,qt.profile&&(ct.stats=oe.stats),ct.destroy=function(){oe.decRef()},ct}function va(){for(var Me=0;Me<fs;++Me)N.activeTexture(hc+Me),N.bindTexture($o,null),ho[Me]=null;re(Io).forEach(zo),kt.cubeCount=0,kt.textureCount=0}qt.profile&&(kt.getTotalTextureSize=function(){var Me=0;return Object.keys(Io).forEach(function(Nt){Me+=Io[Nt].stats.size}),Me});function Nn(){for(var Me=0;Me<fs;++Me){var Nt=ho[Me];Nt&&(Nt.bindCount=0,Nt.unit=-1,ho[Me]=null)}re(Io).forEach(function(At){At.texture=N.createTexture(),N.bindTexture(At.target,At.texture);for(var yn=0;yn<32;++yn)if((At.mipmask&1<<yn)!=0)if(At.target===$o)N.texImage2D($o,yn,At.internalformat,At.width>>yn,At.height>>yn,0,At.internalformat,At.type,null);else for(var Wi=0;Wi<6;++Wi)N.texImage2D(Iu+Wi,yn,At.internalformat,At.width>>yn,At.height>>yn,0,At.internalformat,At.type,null);So(At.texInfo,At.target)})}function ni(){for(var Me=0;Me<fs;++Me){var Nt=ho[Me];Nt&&(Nt.bindCount=0,Nt.unit=-1,ho[Me]=null),N.activeTexture(hc+Me),N.bindTexture($o,null),N.bindTexture(Nc,null)}}return{create2D:ri,createCube:Ui,clear:va,getTexture:function(Me){return null},restore:Nn,refresh:ni}}var Eu=36161,Ln=32854,wn=32855,Hc=36194,Qo=33189,eu=36168,Ho=34041,gu=35907,$f=34836,Wc=34842,ga=34843,La=[];La[Ln]=2,La[wn]=2,La[Hc]=2,La[Qo]=2,La[eu]=1,La[Ho]=4,La[gu]=4,La[$f]=16,La[Wc]=8,La[ga]=6;function vl(N,ve,Ne){return La[N]*ve*Ne}var dc=function(N,ve,Ne,Dt,ar){var kt={rgba4:Ln,rgb565:Hc,"rgb5 a1":wn,depth:Qo,stencil:eu,"depth stencil":Ho};ve.ext_srgb&&(kt.srgba=gu),ve.ext_color_buffer_half_float&&(kt.rgba16f=Wc,kt.rgb16f=ga),ve.webgl_color_buffer_float&&(kt.rgba32f=$f);var qt=[];Object.keys(kt).forEach(function(yr){var Cr=kt[yr];qt[Cr]=yr});var fr=0,mr={};function xr(yr){this.id=fr++,this.refCount=1,this.renderbuffer=yr,this.format=Ln,this.width=0,this.height=0,ar.profile&&(this.stats={size:0})}xr.prototype.decRef=function(){--this.refCount<=0&&Tr(this)};function Tr(yr){var Cr=yr.renderbuffer;me(Cr,"must not double destroy renderbuffer"),N.bindRenderbuffer(Eu,null),N.deleteRenderbuffer(Cr),yr.renderbuffer=null,yr.refCount=0,delete mr[yr.id],Dt.renderbufferCount--}function Mr(yr,Cr){var ot=new xr(N.createRenderbuffer());mr[ot.id]=ot,Dt.renderbufferCount++;function jt(Zr,cr){var Rr=0,Qr=0,Un=Ln;if(typeof Zr=="object"&&Zr){var Kt=Zr;if("shape"in Kt){var ir=Kt.shape;me(Array.isArray(ir)&&ir.length>=2,"invalid renderbuffer shape"),Rr=ir[0]|0,Qr=ir[1]|0}else"radius"in Kt&&(Rr=Qr=Kt.radius|0),"width"in Kt&&(Rr=Kt.width|0),"height"in Kt&&(Qr=Kt.height|0);"format"in Kt&&(me.parameter(Kt.format,kt,"invalid renderbuffer format"),Un=kt[Kt.format])}else typeof Zr=="number"?(Rr=Zr|0,typeof cr=="number"?Qr=cr|0:Qr=Rr):Zr?me.raise("invalid arguments to renderbuffer constructor"):Rr=Qr=1;if(me(Rr>0&&Qr>0&&Rr<=Ne.maxRenderbufferSize&&Qr<=Ne.maxRenderbufferSize,"invalid renderbuffer size"),!(Rr===ot.width&&Qr===ot.height&&Un===ot.format))return jt.width=ot.width=Rr,jt.height=ot.height=Qr,ot.format=Un,N.bindRenderbuffer(Eu,ot.renderbuffer),N.renderbufferStorage(Eu,Un,Rr,Qr),me(N.getError()===0,"invalid render buffer format"),ar.profile&&(ot.stats.size=vl(ot.format,ot.width,ot.height)),jt.format=qt[ot.format],jt}function br(Zr,cr){var Rr=Zr|0,Qr=cr|0||Rr;return Rr===ot.width&&Qr===ot.height||(me(Rr>0&&Qr>0&&Rr<=Ne.maxRenderbufferSize&&Qr<=Ne.maxRenderbufferSize,"invalid renderbuffer size"),jt.width=ot.width=Rr,jt.height=ot.height=Qr,N.bindRenderbuffer(Eu,ot.renderbuffer),N.renderbufferStorage(Eu,ot.format,Rr,Qr),me(N.getError()===0,"invalid render buffer format"),ar.profile&&(ot.stats.size=vl(ot.format,ot.width,ot.height))),jt}return jt(yr,Cr),jt.resize=br,jt._reglType="renderbuffer",jt._renderbuffer=ot,ar.profile&&(jt.stats=ot.stats),jt.destroy=function(){ot.decRef()},jt}ar.profile&&(Dt.getTotalRenderbufferSize=function(){var yr=0;return Object.keys(mr).forEach(function(Cr){yr+=mr[Cr].stats.size}),yr});function Gr(){re(mr).forEach(function(yr){yr.renderbuffer=N.createRenderbuffer(),N.bindRenderbuffer(Eu,yr.renderbuffer),N.renderbufferStorage(Eu,yr.format,yr.width,yr.height)}),N.bindRenderbuffer(Eu,null)}return{create:Mr,clear:function(){re(mr).forEach(Tr)},restore:Gr}},Ns=36160,yu=36161,pi=3553,zs=34069,ss=36064,jl=36096,Fu=36128,el=33306,Xc=36053,Da=36054,tu=36055,Vl=36057,ml=36061,gl=36193,Yc=5121,yl=5126,ru=6407,vc=6408,Gl=6402,Qf=[ru,vc],Hl=[];Hl[vc]=4,Hl[ru]=3;var l=[];l[Yc]=1,l[yl]=4,l[gl]=2;var h=32854,c=32855,d=36194,E=33189,w=36168,P=34041,L=35907,Z=34836,X=34842,se=34843,fe=[h,c,d,L,X,se,Z],de={};de[Xc]="complete",de[Da]="incomplete attachment",de[Vl]="incomplete dimensions",de[tu]="incomplete, missing attachment",de[ml]="unsupported";function ke(N,ve,Ne,Dt,ar,kt){var qt={cur:null,next:null,dirty:!1,setFBO:null},fr=["rgba"],mr=["rgba4","rgb565","rgb5 a1"];ve.ext_srgb&&mr.push("srgba"),ve.ext_color_buffer_half_float&&mr.push("rgba16f","rgb16f"),ve.webgl_color_buffer_float&&mr.push("rgba32f");var xr=["uint8"];ve.oes_texture_half_float&&xr.push("half float","float16"),ve.oes_texture_float&&xr.push("float","float32");function Tr(Sr,qr,Kr){this.target=Sr,this.texture=qr,this.renderbuffer=Kr;var gi=0,si=0;qr?(gi=qr.width,si=qr.height):Kr&&(gi=Kr.width,si=Kr.height),this.width=gi,this.height=si}function Mr(Sr){Sr&&(Sr.texture&&Sr.texture._texture.decRef(),Sr.renderbuffer&&Sr.renderbuffer._renderbuffer.decRef())}function Gr(Sr,qr,Kr){if(!!Sr)if(Sr.texture){var gi=Sr.texture._texture,si=Math.max(1,gi.width),Wr=Math.max(1,gi.height);me(si===qr&&Wr===Kr,"inconsistent width/height for supplied texture"),gi.refCount+=1}else{var nn=Sr.renderbuffer._renderbuffer;me(nn.width===qr&&nn.height===Kr,"inconsistent width/height for renderbuffer"),nn.refCount+=1}}function yr(Sr,qr){qr&&(qr.texture?N.framebufferTexture2D(Ns,Sr,qr.target,qr.texture._texture.texture,0):N.framebufferRenderbuffer(Ns,Sr,yu,qr.renderbuffer._renderbuffer.renderbuffer))}function Cr(Sr){var qr=pi,Kr=null,gi=null,si=Sr;typeof Sr=="object"&&(si=Sr.data,"target"in Sr&&(qr=Sr.target|0)),me.type(si,"function","invalid attachment data");var Wr=si._reglType;return Wr==="texture2d"?(Kr=si,me(qr===pi)):Wr==="textureCube"?(Kr=si,me(qr>=zs&&qr<zs+6,"invalid cube map target")):Wr==="renderbuffer"?(gi=si,qr=yu):me.raise("invalid regl object for attachment"),new Tr(qr,Kr,gi)}function ot(Sr,qr,Kr,gi,si){if(Kr){var Wr=Dt.create2D({width:Sr,height:qr,format:gi,type:si});return Wr._texture.refCount=0,new Tr(pi,Wr,null)}else{var nn=ar.create({width:Sr,height:qr,format:gi});return nn._renderbuffer.refCount=0,new Tr(yu,null,nn)}}function jt(Sr){return Sr&&(Sr.texture||Sr.renderbuffer)}function br(Sr,qr,Kr){Sr&&(Sr.texture?Sr.texture.resize(qr,Kr):Sr.renderbuffer&&Sr.renderbuffer.resize(qr,Kr),Sr.width=qr,Sr.height=Kr)}var Zr=0,cr={};function Rr(){this.id=Zr++,cr[this.id]=this,this.framebuffer=N.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function Qr(Sr){Sr.colorAttachments.forEach(Mr),Mr(Sr.depthAttachment),Mr(Sr.stencilAttachment),Mr(Sr.depthStencilAttachment)}function Un(Sr){var qr=Sr.framebuffer;me(qr,"must not double destroy framebuffer"),N.deleteFramebuffer(qr),Sr.framebuffer=null,kt.framebufferCount--,delete cr[Sr.id]}function Kt(Sr){var qr;N.bindFramebuffer(Ns,Sr.framebuffer);var Kr=Sr.colorAttachments;for(qr=0;qr<Kr.length;++qr)yr(ss+qr,Kr[qr]);for(qr=Kr.length;qr<Ne.maxColorAttachments;++qr)N.framebufferTexture2D(Ns,ss+qr,pi,null,0);N.framebufferTexture2D(Ns,el,pi,null,0),N.framebufferTexture2D(Ns,jl,pi,null,0),N.framebufferTexture2D(Ns,Fu,pi,null,0),yr(jl,Sr.depthAttachment),yr(Fu,Sr.stencilAttachment),yr(el,Sr.depthStencilAttachment);var gi=N.checkFramebufferStatus(Ns);!N.isContextLost()&&gi!==Xc&&me.raise("framebuffer configuration not supported, status = "+de[gi]),N.bindFramebuffer(Ns,qt.next?qt.next.framebuffer:null),qt.cur=qt.next,N.getError()}function ir(Sr,qr){var Kr=new Rr;kt.framebufferCount++;function gi(Wr,nn){var Jn;me(qt.next!==Kr,"can not update framebuffer which is currently in use");var fi=0,Zi=0,oo=!0,so=!0,Ni=null,ts=!0,ja="rgba",No="uint8",So=1,Wo=null,Io=null,fs=null,ho=!1;if(typeof Wr=="number")fi=Wr|0,Zi=nn|0||fi;else if(!Wr)fi=Zi=1;else{me.type(Wr,"object","invalid arguments for framebuffer");var yi=Wr;if("shape"in yi){var Oo=yi.shape;me(Array.isArray(Oo)&&Oo.length>=2,"invalid shape for framebuffer"),fi=Oo[0],Zi=Oo[1]}else"radius"in yi&&(fi=Zi=yi.radius),"width"in yi&&(fi=yi.width),"height"in yi&&(Zi=yi.height);("color"in yi||"colors"in yi)&&(Ni=yi.color||yi.colors,Array.isArray(Ni)&&me(Ni.length===1||ve.webgl_draw_buffers,"multiple render targets not supported")),Ni||("colorCount"in yi&&(So=yi.colorCount|0,me(So>0,"invalid color buffer count")),"colorTexture"in yi&&(ts=!!yi.colorTexture,ja="rgba4"),"colorType"in yi&&(No=yi.colorType,ts?(me(ve.oes_texture_float||!(No==="float"||No==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),me(ve.oes_texture_half_float||!(No==="half float"||No==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):No==="half float"||No==="float16"?(me(ve.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),ja="rgba16f"):(No==="float"||No==="float32")&&(me(ve.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),ja="rgba32f"),me.oneOf(No,xr,"invalid color type")),"colorFormat"in yi&&(ja=yi.colorFormat,fr.indexOf(ja)>=0?ts=!0:mr.indexOf(ja)>=0?ts=!1:me.optional(function(){ts?me.oneOf(yi.colorFormat,fr,"invalid color format for texture"):me.oneOf(yi.colorFormat,mr,"invalid color format for renderbuffer")}))),("depthTexture"in yi||"depthStencilTexture"in yi)&&(ho=!!(yi.depthTexture||yi.depthStencilTexture),me(!ho||ve.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in yi&&(typeof yi.depth=="boolean"?oo=yi.depth:(Wo=yi.depth,so=!1)),"stencil"in yi&&(typeof yi.stencil=="boolean"?so=yi.stencil:(Io=yi.stencil,oo=!1)),"depthStencil"in yi&&(typeof yi.depthStencil=="boolean"?oo=so=yi.depthStencil:(fs=yi.depthStencil,oo=!1,so=!1))}var ea=null,zo=null,ri=null,Ui=null;if(Array.isArray(Ni))ea=Ni.map(Cr);else if(Ni)ea=[Cr(Ni)];else for(ea=new Array(So),Jn=0;Jn<So;++Jn)ea[Jn]=ot(fi,Zi,ts,ja,No);me(ve.webgl_draw_buffers||ea.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),me(ea.length<=Ne.maxColorAttachments,"too many color attachments, not supported"),fi=fi||ea[0].width,Zi=Zi||ea[0].height,Wo?zo=Cr(Wo):oo&&!so&&(zo=ot(fi,Zi,ho,"depth","uint32")),Io?ri=Cr(Io):so&&!oo&&(ri=ot(fi,Zi,!1,"stencil","uint8")),fs?Ui=Cr(fs):!Wo&&!Io&&so&&oo&&(Ui=ot(fi,Zi,ho,"depth stencil","depth stencil")),me(!!Wo+!!Io+!!fs<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var va=null;for(Jn=0;Jn<ea.length;++Jn)if(Gr(ea[Jn],fi,Zi),me(!ea[Jn]||ea[Jn].texture&&Qf.indexOf(ea[Jn].texture._texture.format)>=0||ea[Jn].renderbuffer&&fe.indexOf(ea[Jn].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Jn+" is invalid"),ea[Jn]&&ea[Jn].texture){var Nn=Hl[ea[Jn].texture._texture.format]*l[ea[Jn].texture._texture.type];va===null?va=Nn:me(va===Nn,"all color attachments much have the same number of bits per pixel.")}return Gr(zo,fi,Zi),me(!zo||zo.texture&&zo.texture._texture.format===Gl||zo.renderbuffer&&zo.renderbuffer._renderbuffer.format===E,"invalid depth attachment for framebuffer object"),Gr(ri,fi,Zi),me(!ri||ri.renderbuffer&&ri.renderbuffer._renderbuffer.format===w,"invalid stencil attachment for framebuffer object"),Gr(Ui,fi,Zi),me(!Ui||Ui.texture&&Ui.texture._texture.format===P||Ui.renderbuffer&&Ui.renderbuffer._renderbuffer.format===P,"invalid depth-stencil attachment for framebuffer object"),Qr(Kr),Kr.width=fi,Kr.height=Zi,Kr.colorAttachments=ea,Kr.depthAttachment=zo,Kr.stencilAttachment=ri,Kr.depthStencilAttachment=Ui,gi.color=ea.map(jt),gi.depth=jt(zo),gi.stencil=jt(ri),gi.depthStencil=jt(Ui),gi.width=Kr.width,gi.height=Kr.height,Kt(Kr),gi}function si(Wr,nn){me(qt.next!==Kr,"can not resize a framebuffer which is currently in use");var Jn=Math.max(Wr|0,1),fi=Math.max(nn|0||Jn,1);if(Jn===Kr.width&&fi===Kr.height)return gi;for(var Zi=Kr.colorAttachments,oo=0;oo<Zi.length;++oo)br(Zi[oo],Jn,fi);return br(Kr.depthAttachment,Jn,fi),br(Kr.stencilAttachment,Jn,fi),br(Kr.depthStencilAttachment,Jn,fi),Kr.width=gi.width=Jn,Kr.height=gi.height=fi,Kt(Kr),gi}return gi(Sr,qr),g(gi,{resize:si,_reglType:"framebuffer",_framebuffer:Kr,destroy:function(){Un(Kr),Qr(Kr)},use:function(Wr){qt.setFBO({framebuffer:gi},Wr)}})}function En(Sr){var qr=Array(6);function Kr(si){var Wr;me(qr.indexOf(qt.next)<0,"can not update framebuffer which is currently in use");var nn={color:null},Jn=0,fi=null,Zi="rgba",oo="uint8",so=1;if(typeof si=="number")Jn=si|0;else if(!si)Jn=1;else{me.type(si,"object","invalid arguments for framebuffer");var Ni=si;if("shape"in Ni){var ts=Ni.shape;me(Array.isArray(ts)&&ts.length>=2,"invalid shape for framebuffer"),me(ts[0]===ts[1],"cube framebuffer must be square"),Jn=ts[0]}else"radius"in Ni&&(Jn=Ni.radius|0),"width"in Ni?(Jn=Ni.width|0,"height"in Ni&&me(Ni.height===Jn,"must be square")):"height"in Ni&&(Jn=Ni.height|0);("color"in Ni||"colors"in Ni)&&(fi=Ni.color||Ni.colors,Array.isArray(fi)&&me(fi.length===1||ve.webgl_draw_buffers,"multiple render targets not supported")),fi||("colorCount"in Ni&&(so=Ni.colorCount|0,me(so>0,"invalid color buffer count")),"colorType"in Ni&&(me.oneOf(Ni.colorType,xr,"invalid color type"),oo=Ni.colorType),"colorFormat"in Ni&&(Zi=Ni.colorFormat,me.oneOf(Ni.colorFormat,fr,"invalid color format for texture"))),"depth"in Ni&&(nn.depth=Ni.depth),"stencil"in Ni&&(nn.stencil=Ni.stencil),"depthStencil"in Ni&&(nn.depthStencil=Ni.depthStencil)}var ja;if(fi)if(Array.isArray(fi))for(ja=[],Wr=0;Wr<fi.length;++Wr)ja[Wr]=fi[Wr];else ja=[fi];else{ja=Array(so);var No={radius:Jn,format:Zi,type:oo};for(Wr=0;Wr<so;++Wr)ja[Wr]=Dt.createCube(No)}for(nn.color=Array(ja.length),Wr=0;Wr<ja.length;++Wr){var So=ja[Wr];me(typeof So=="function"&&So._reglType==="textureCube","invalid cube map"),Jn=Jn||So.width,me(So.width===Jn&&So.height===Jn,"invalid cube map shape"),nn.color[Wr]={target:zs,data:ja[Wr]}}for(Wr=0;Wr<6;++Wr){for(var Wo=0;Wo<ja.length;++Wo)nn.color[Wo].target=zs+Wr;Wr>0&&(nn.depth=qr[0].depth,nn.stencil=qr[0].stencil,nn.depthStencil=qr[0].depthStencil),qr[Wr]?qr[Wr](nn):qr[Wr]=ir(nn)}return g(Kr,{width:Jn,height:Jn,color:ja})}function gi(si){var Wr,nn=si|0;if(me(nn>0&&nn<=Ne.maxCubeMapSize,"invalid radius for cube fbo"),nn===Kr.width)return Kr;var Jn=Kr.color;for(Wr=0;Wr<Jn.length;++Wr)Jn[Wr].resize(nn);for(Wr=0;Wr<6;++Wr)qr[Wr].resize(nn);return Kr.width=Kr.height=nn,Kr}return Kr(Sr),g(Kr,{faces:qr,resize:gi,_reglType:"framebufferCube",destroy:function(){qr.forEach(function(si){si.destroy()})}})}function Hr(){qt.cur=null,qt.next=null,qt.dirty=!0,re(cr).forEach(function(Sr){Sr.framebuffer=N.createFramebuffer(),Kt(Sr)})}return g(qt,{getFramebuffer:function(Sr){if(typeof Sr=="function"&&Sr._reglType==="framebuffer"){var qr=Sr._framebuffer;if(qr instanceof Rr)return qr}return null},create:ir,createCube:En,clear:function(){re(cr).forEach(Un)},restore:Hr})}var Oe=5126,ze=34962,Ce=34963,je=["attributes","elements","offset","count","primitive","instances"];function Qe(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Oe,this.offset=0,this.stride=0,this.divisor=0}function gt(N,ve,Ne,Dt,ar,kt,qt){for(var fr=Ne.maxAttributes,mr=new Array(fr),xr=0;xr<fr;++xr)mr[xr]=new Qe;var Tr=0,Mr={},Gr={Record:Qe,scope:{},state:mr,currentVAO:null,targetVAO:null,restore:Cr()?Qr:function(){},createVAO:Un,getVAO:jt,destroyBuffer:yr,setVAO:Cr()?br:Zr,clear:Cr()?cr:function(){}};function yr(Kt){for(var ir=0;ir<mr.length;++ir){var En=mr[ir];En.buffer===Kt&&(N.disableVertexAttribArray(ir),En.buffer=null)}}function Cr(){return ve.oes_vertex_array_object}function ot(){return ve.angle_instanced_arrays}function jt(Kt){return typeof Kt=="function"&&Kt._vao?Kt._vao:null}function br(Kt){if(Kt!==Gr.currentVAO){var ir=Cr();Kt?ir.bindVertexArrayOES(Kt.vao):ir.bindVertexArrayOES(null),Gr.currentVAO=Kt}}function Zr(Kt){if(Kt!==Gr.currentVAO){if(Kt)Kt.bindAttrs();else{for(var ir=ot(),En=0;En<mr.length;++En){var Hr=mr[En];Hr.buffer?(N.enableVertexAttribArray(En),Hr.buffer.bind(),N.vertexAttribPointer(En,Hr.size,Hr.type,Hr.normalized,Hr.stride,Hr.offfset),ir&&Hr.divisor&&ir.vertexAttribDivisorANGLE(En,Hr.divisor)):(N.disableVertexAttribArray(En),N.vertexAttrib4f(En,Hr.x,Hr.y,Hr.z,Hr.w))}qt.elements?N.bindBuffer(Ce,qt.elements.buffer.buffer):N.bindBuffer(Ce,null)}Gr.currentVAO=Kt}}function cr(){re(Mr).forEach(function(Kt){Kt.destroy()})}function Rr(){this.id=++Tr,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var Kt=Cr();Kt?this.vao=Kt.createVertexArrayOES():this.vao=null,Mr[this.id]=this,this.buffers=[]}Rr.prototype.bindAttrs=function(){for(var Kt=ot(),ir=this.attributes,En=0;En<ir.length;++En){var Hr=ir[En];Hr.buffer?(N.enableVertexAttribArray(En),N.bindBuffer(ze,Hr.buffer.buffer),N.vertexAttribPointer(En,Hr.size,Hr.type,Hr.normalized,Hr.stride,Hr.offset),Kt&&Hr.divisor&&Kt.vertexAttribDivisorANGLE(En,Hr.divisor)):(N.disableVertexAttribArray(En),N.vertexAttrib4f(En,Hr.x,Hr.y,Hr.z,Hr.w))}for(var Sr=ir.length;Sr<fr;++Sr)N.disableVertexAttribArray(Sr);var qr=kt.getElements(this.elements);qr?N.bindBuffer(Ce,qr.buffer.buffer):N.bindBuffer(Ce,null)},Rr.prototype.refresh=function(){var Kt=Cr();Kt&&(Kt.bindVertexArrayOES(this.vao),this.bindAttrs(),Gr.currentVAO=null,Kt.bindVertexArrayOES(null))},Rr.prototype.destroy=function(){if(this.vao){var Kt=Cr();this===Gr.currentVAO&&(Gr.currentVAO=null,Kt.bindVertexArrayOES(null)),Kt.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),Mr[this.id]&&(delete Mr[this.id],Dt.vaoCount-=1)};function Qr(){var Kt=Cr();Kt&&re(Mr).forEach(function(ir){ir.refresh()})}function Un(Kt){var ir=new Rr;Dt.vaoCount+=1;function En(Hr){var Sr;if(Array.isArray(Hr))Sr=Hr,ir.elements&&ir.ownsElements&&ir.elements.destroy(),ir.elements=null,ir.ownsElements=!1,ir.offset=0,ir.count=0,ir.instances=-1,ir.primitive=4;else{if(me(typeof Hr=="object","invalid arguments for create vao"),me("attributes"in Hr,"must specify attributes for vao"),Hr.elements){var qr=Hr.elements;ir.ownsElements?typeof qr=="function"&&qr._reglType==="elements"?(ir.elements.destroy(),ir.ownsElements=!1):(ir.elements(qr),ir.ownsElements=!1):kt.getElements(Hr.elements)?(ir.elements=Hr.elements,ir.ownsElements=!1):(ir.elements=kt.create(Hr.elements),ir.ownsElements=!0)}else ir.elements=null,ir.ownsElements=!1;Sr=Hr.attributes,ir.offset=0,ir.count=-1,ir.instances=-1,ir.primitive=4,ir.elements&&(ir.count=ir.elements._elements.vertCount,ir.primitive=ir.elements._elements.primType),"offset"in Hr&&(ir.offset=Hr.offset|0),"count"in Hr&&(ir.count=Hr.count|0),"instances"in Hr&&(ir.instances=Hr.instances|0),"primitive"in Hr&&(me(Hr.primitive in or,"bad primitive type: "+Hr.primitive),ir.primitive=or[Hr.primitive]),me.optional(function(){for(var oo=Object.keys(Hr),so=0;so<oo.length;++so)me(je.indexOf(oo[so])>=0,'invalid option for vao: "'+oo[so]+'" valid options are '+je)}),me(Array.isArray(Sr),"attributes must be an array")}me(Sr.length<fr,"too many attributes"),me(Sr.length>0,"must specify at least one attribute");var Kr={},gi=ir.attributes;gi.length=Sr.length;for(var si=0;si<Sr.length;++si){var Wr=Sr[si],nn=gi[si]=new Qe,Jn=Wr.data||Wr;if(Array.isArray(Jn)||ue(Jn)||_s(Jn)){var fi;ir.buffers[si]&&(fi=ir.buffers[si],ue(Jn)&&fi._buffer.byteLength>=Jn.byteLength?fi.subdata(Jn):(fi.destroy(),ir.buffers[si]=null)),ir.buffers[si]||(fi=ir.buffers[si]=ar.create(Wr,ze,!1,!0)),nn.buffer=ar.getBuffer(fi),nn.size=nn.buffer.dimension|0,nn.normalized=!1,nn.type=nn.buffer.dtype,nn.offset=0,nn.stride=0,nn.divisor=0,nn.state=1,Kr[si]=1}else ar.getBuffer(Wr)?(nn.buffer=ar.getBuffer(Wr),nn.size=nn.buffer.dimension|0,nn.normalized=!1,nn.type=nn.buffer.dtype,nn.offset=0,nn.stride=0,nn.divisor=0,nn.state=1):ar.getBuffer(Wr.buffer)?(nn.buffer=ar.getBuffer(Wr.buffer),nn.size=(+Wr.size||nn.buffer.dimension)|0,nn.normalized=!!Wr.normalized||!1,"type"in Wr?(me.parameter(Wr.type,fu,"invalid buffer type"),nn.type=fu[Wr.type]):nn.type=nn.buffer.dtype,nn.offset=(Wr.offset||0)|0,nn.stride=(Wr.stride||0)|0,nn.divisor=(Wr.divisor||0)|0,nn.state=1,me(nn.size>=1&&nn.size<=4,"size must be between 1 and 4"),me(nn.offset>=0,"invalid offset"),me(nn.stride>=0&&nn.stride<=255,"stride must be between 0 and 255"),me(nn.divisor>=0,"divisor must be positive"),me(!nn.divisor||!!ve.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Wr?(me(si>0,"first attribute must not be a constant"),nn.x=+Wr.x||0,nn.y=+Wr.y||0,nn.z=+Wr.z||0,nn.w=+Wr.w||0,nn.state=2):me(!1,"invalid attribute spec for location "+si)}for(var Zi=0;Zi<ir.buffers.length;++Zi)!Kr[Zi]&&ir.buffers[Zi]&&(ir.buffers[Zi].destroy(),ir.buffers[Zi]=null);return ir.refresh(),En}return En.destroy=function(){for(var Hr=0;Hr<ir.buffers.length;++Hr)ir.buffers[Hr]&&ir.buffers[Hr].destroy();ir.buffers.length=0,ir.ownsElements&&(ir.elements.destroy(),ir.elements=null,ir.ownsElements=!1),ir.destroy()},En._vao=ir,En._reglType="vao",En(Kt)}return Gr}var Gt=35632,Ut=35633,Yt=35718,vr=35721;function Dr(N,ve,Ne,Dt){var ar={},kt={};function qt(ot,jt,br,Zr){this.name=ot,this.id=jt,this.location=br,this.info=Zr}function fr(ot,jt){for(var br=0;br<ot.length;++br)if(ot[br].id===jt.id){ot[br].location=jt.location;return}ot.push(jt)}function mr(ot,jt,br){var Zr=ot===Gt?ar:kt,cr=Zr[jt];if(!cr){var Rr=ve.str(jt);cr=N.createShader(ot),N.shaderSource(cr,Rr),N.compileShader(cr),me.shaderError(N,cr,Rr,ot,br),Zr[jt]=cr}return cr}var xr={},Tr=[],Mr=0;function Gr(ot,jt){this.id=Mr++,this.fragId=ot,this.vertId=jt,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,Dt.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function yr(ot,jt,br){var Zr,cr,Rr=mr(Gt,ot.fragId),Qr=mr(Ut,ot.vertId),Un=ot.program=N.createProgram();if(N.attachShader(Un,Rr),N.attachShader(Un,Qr),br)for(Zr=0;Zr<br.length;++Zr){var Kt=br[Zr];N.bindAttribLocation(Un,Kt[0],Kt[1])}N.linkProgram(Un),me.linkError(N,Un,ve.str(ot.fragId),ve.str(ot.vertId),jt);var ir=N.getProgramParameter(Un,Yt);Dt.profile&&(ot.stats.uniformsCount=ir);var En=ot.uniforms;for(Zr=0;Zr<ir;++Zr)if(cr=N.getActiveUniform(Un,Zr),cr)if(cr.size>1)for(var Hr=0;Hr<cr.size;++Hr){var Sr=cr.name.replace("[0]","["+Hr+"]");fr(En,new qt(Sr,ve.id(Sr),N.getUniformLocation(Un,Sr),cr))}else fr(En,new qt(cr.name,ve.id(cr.name),N.getUniformLocation(Un,cr.name),cr));var qr=N.getProgramParameter(Un,vr);Dt.profile&&(ot.stats.attributesCount=qr);var Kr=ot.attributes;for(Zr=0;Zr<qr;++Zr)cr=N.getActiveAttrib(Un,Zr),cr&&fr(Kr,new qt(cr.name,ve.id(cr.name),N.getAttribLocation(Un,cr.name),cr))}Dt.profile&&(Ne.getMaxUniformsCount=function(){var ot=0;return Tr.forEach(function(jt){jt.stats.uniformsCount>ot&&(ot=jt.stats.uniformsCount)}),ot},Ne.getMaxAttributesCount=function(){var ot=0;return Tr.forEach(function(jt){jt.stats.attributesCount>ot&&(ot=jt.stats.attributesCount)}),ot});function Cr(){ar={},kt={};for(var ot=0;ot<Tr.length;++ot)yr(Tr[ot],null,Tr[ot].attributes.map(function(jt){return[jt.location,jt.name]}))}return{clear:function(){var ot=N.deleteShader.bind(N);re(ar).forEach(ot),ar={},re(kt).forEach(ot),kt={},Tr.forEach(function(jt){N.deleteProgram(jt.program)}),Tr.length=0,xr={},Ne.shaderCount=0},program:function(ot,jt,br,Zr){me.command(ot>=0,"missing vertex shader",br),me.command(jt>=0,"missing fragment shader",br);var cr=xr[jt];cr||(cr=xr[jt]={});var Rr=cr[ot];if(Rr&&(Rr.refCount++,!Zr))return Rr;var Qr=new Gr(jt,ot);return Ne.shaderCount++,yr(Qr,br,Zr),Rr||(cr[ot]=Qr),Tr.push(Qr),g(Qr,{destroy:function(){if(Qr.refCount--,Qr.refCount<=0){N.deleteProgram(Qr.program);var Un=Tr.indexOf(Qr);Tr.splice(Un,1),Ne.shaderCount--}cr[Qr.vertId].refCount<=0&&(N.deleteShader(kt[Qr.vertId]),delete kt[Qr.vertId],delete xr[Qr.fragId][Qr.vertId]),Object.keys(xr[Qr.fragId]).length||(N.deleteShader(ar[Qr.fragId]),delete ar[Qr.fragId],delete xr[Qr.fragId])}})},restore:Cr,shader:mr,frag:-1,vert:-1}}var _r=6408,ln=5121,Gn=3333,Hn=5126;function Bn(N,ve,Ne,Dt,ar,kt,qt){function fr(Tr){var Mr;ve.next===null?(me(ar.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),Mr=ln):(me(ve.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),Mr=ve.next.colorAttachments[0].texture._texture.type,me.optional(function(){kt.oes_texture_float?(me(Mr===ln||Mr===Hn,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),Mr===Hn&&me(qt.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):me(Mr===ln,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var Gr=0,yr=0,Cr=Dt.framebufferWidth,ot=Dt.framebufferHeight,jt=null;ue(Tr)?jt=Tr:Tr&&(me.type(Tr,"object","invalid arguments to regl.read()"),Gr=Tr.x|0,yr=Tr.y|0,me(Gr>=0&&Gr<Dt.framebufferWidth,"invalid x offset for regl.read"),me(yr>=0&&yr<Dt.framebufferHeight,"invalid y offset for regl.read"),Cr=(Tr.width||Dt.framebufferWidth-Gr)|0,ot=(Tr.height||Dt.framebufferHeight-yr)|0,jt=Tr.data||null),jt&&(Mr===ln?me(jt instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):Mr===Hn&&me(jt instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),me(Cr>0&&Cr+Gr<=Dt.framebufferWidth,"invalid width for read pixels"),me(ot>0&&ot+yr<=Dt.framebufferHeight,"invalid height for read pixels"),Ne();var br=Cr*ot*4;return jt||(Mr===ln?jt=new Uint8Array(br):Mr===Hn&&(jt=jt||new Float32Array(br))),me.isTypedArray(jt,"data buffer for regl.read() must be a typedarray"),me(jt.byteLength>=br,"data buffer for regl.read() too small"),N.pixelStorei(Gn,4),N.readPixels(Gr,yr,Cr,ot,_r,Mr,jt),jt}function mr(Tr){var Mr;return ve.setFBO({framebuffer:Tr.framebuffer},function(){Mr=fr(Tr)}),Mr}function xr(Tr){return!Tr||!("framebuffer"in Tr)?fr(Tr):mr(Tr)}return xr}function Di(N){return Array.prototype.slice.call(N)}function rn(N){return Di(N).join("")}function oi(){var N=0,ve=[],Ne=[];function Dt(Mr){for(var Gr=0;Gr<Ne.length;++Gr)if(Ne[Gr]===Mr)return ve[Gr];var yr="g"+N++;return ve.push(yr),Ne.push(Mr),yr}function ar(){var Mr=[];function Gr(){Mr.push.apply(Mr,Di(arguments))}var yr=[];function Cr(){var ot="v"+N++;return yr.push(ot),arguments.length>0&&(Mr.push(ot,"="),Mr.push.apply(Mr,Di(arguments)),Mr.push(";")),ot}return g(Gr,{def:Cr,toString:function(){return rn([yr.length>0?"var "+yr.join(",")+";":"",rn(Mr)])}})}function kt(){var Mr=ar(),Gr=ar(),yr=Mr.toString,Cr=Gr.toString;function ot(jt,br){Gr(jt,br,"=",Mr.def(jt,br),";")}return g(function(){Mr.apply(Mr,Di(arguments))},{def:Mr.def,entry:Mr,exit:Gr,save:ot,set:function(jt,br,Zr){ot(jt,br),Mr(jt,br,"=",Zr,";")},toString:function(){return yr()+Cr()}})}function qt(){var Mr=rn(arguments),Gr=kt(),yr=kt(),Cr=Gr.toString,ot=yr.toString;return g(Gr,{then:function(){return Gr.apply(Gr,Di(arguments)),this},else:function(){return yr.apply(yr,Di(arguments)),this},toString:function(){var jt=ot();return jt&&(jt="else{"+jt+"}"),rn(["if(",Mr,"){",Cr(),"}",jt])}})}var fr=ar(),mr={};function xr(Mr,Gr){var yr=[];function Cr(){var cr="a"+yr.length;return yr.push(cr),cr}Gr=Gr||0;for(var ot=0;ot<Gr;++ot)Cr();var jt=kt(),br=jt.toString,Zr=mr[Mr]=g(jt,{arg:Cr,toString:function(){return rn(["function(",yr.join(),"){",br(),"}"])}});return Zr}function Tr(){var Mr=['"use strict";',fr,"return {"];Object.keys(mr).forEach(function(ot){Mr.push('"',ot,'":',mr[ot].toString(),",")}),Mr.push("}");var Gr=rn(Mr).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),yr=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Cr=yr?_e.Function.apply(null,ve.concat(Gr)):Function.apply(null,ve.concat(Gr));return Cr.apply(null,Ne)}return{global:fr,link:Dt,block:ar,proc:xr,scope:kt,cond:qt,compile:Tr}}var ci="xyzw".split(""),Qn=5121,Xn=1,di=2,$n=0,qn=1,yo=2,Qa=3,To=4,ia=5,Ha=6,fo="dither",Rs="blend.enable",us="blend.color",Bu="blend.equation",ls="blend.func",nu="depth.enable",Jo="depth.func",cs="depth.range",Wl="depth.mask",Nu="colorMask",_l="cull.enable",Xl="cull.face",iu="frontFace",xl="lineWidth",Su="polygonOffset.enable",Eo="polygonOffset.offset",zu="sample.alpha",Zu="sample.enable",tl="sample.coverage",ua="stencil.enable",Zs="stencil.mask",es="stencil.func",_u="stencil.opFront",qc="stencil.opBack",Kc="scissor.enable",Pf="scissor.box",au="viewport",mc="profile",ou="framebuffer",bl="vert",gc="frag",su="elements",Bo="primitive",$c="count",Jf="offset",kh="instances",eh="vao",pp="Width",yc="Height",_c=ou+pp,If=ou+yc,Lh=au+pp,qp=au+yc,El="drawingBuffer",Qc=El+pp,Kp=El+yc,Pd=[ls,Bu,es,_u,qc,tl,au,Pf,Eo],Jc=34962,Dh=34963,Id=35632,Od=35633,$p=3553,dp=34067,Fh=2884,th=3042,Yr=3024,Mo=2960,xt=2929,Qp=3089,Bh=32823,rh=32926,Of=32928,nh=5126,ih=35664,Yl=35665,Sl=35666,ah=5124,Nh=35667,ql=35668,oh=35669,Rf=35670,sh=35671,ef=35672,kf=35673,Us=35674,Lf=35675,tf=35676,uh=35678,lh=35680,zh=4,Cl=1028,rf=1029,Jp=2304,Zh=2305,vp=32775,Rd=32776,ed=519,Cu=7680,kd=0,Uh=1,nf=32774,Uu=513,td=36160,rd=36064,rl={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Df=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],af={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},xc={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},mp={frag:Id,vert:Od},of={cw:Jp,ccw:Zh};function jh(N){return Array.isArray(N)||ue(N)||_s(N)}function Ia(N){return N.sort(function(ve,Ne){return ve===au?-1:Ne===au?1:ve<Ne?-1:1})}function Ki(N,ve,Ne,Dt){this.thisDep=N,this.contextDep=ve,this.propDep=Ne,this.append=Dt}function bc(N){return N&&!(N.thisDep||N.contextDep||N.propDep)}function Po(N){return new Ki(!1,!1,!1,N)}function js(N,ve){var Ne=N.type;if(Ne===$n){var Dt=N.data.length;return new Ki(!0,Dt>=1,Dt>=2,ve)}else if(Ne===To){var ar=N.data;return new Ki(ar.thisDep,ar.contextDep,ar.propDep,ve)}else{if(Ne===ia)return new Ki(!1,!1,!1,ve);if(Ne===Ha){for(var kt=!1,qt=!1,fr=!1,mr=0;mr<N.data.length;++mr){var xr=N.data[mr];if(xr.type===qn)fr=!0;else if(xr.type===yo)qt=!0;else if(xr.type===Qa)kt=!0;else if(xr.type===$n){kt=!0;var Tr=xr.data;Tr>=1&&(qt=!0),Tr>=2&&(fr=!0)}else xr.type===To&&(kt=kt||xr.data.thisDep,qt=qt||xr.data.contextDep,fr=fr||xr.data.propDep)}return new Ki(kt,qt,fr,ve)}else return new Ki(Ne===Qa,Ne===yo,Ne===qn,ve)}}var nd=new Ki(!1,!1,!1,function(){});function gp(N,ve,Ne,Dt,ar,kt,qt,fr,mr,xr,Tr,Mr,Gr,yr,Cr){var ot=xr.Record,jt={add:32774,subtract:32778,"reverse subtract":32779};Ne.ext_blend_minmax&&(jt.min=vp,jt.max=Rd);var br=Ne.angle_instanced_arrays,Zr=Ne.webgl_draw_buffers,cr=Ne.oes_vertex_array_object,Rr={dirty:!0,profile:Cr.profile},Qr={},Un=[],Kt={},ir={};function En(we){return we.replace(".","_")}function Hr(we,oe,Ve){var ct=En(we);Un.push(we),Qr[ct]=Rr[ct]=!!Ve,Kt[ct]=oe}function Sr(we,oe,Ve){var ct=En(we);Un.push(we),Array.isArray(Ve)?(Rr[ct]=Ve.slice(),Qr[ct]=Ve.slice()):Rr[ct]=Qr[ct]=Ve,ir[ct]=oe}Hr(fo,Yr),Hr(Rs,th),Sr(us,"blendColor",[0,0,0,0]),Sr(Bu,"blendEquationSeparate",[nf,nf]),Sr(ls,"blendFuncSeparate",[Uh,kd,Uh,kd]),Hr(nu,xt,!0),Sr(Jo,"depthFunc",Uu),Sr(cs,"depthRange",[0,1]),Sr(Wl,"depthMask",!0),Sr(Nu,Nu,[!0,!0,!0,!0]),Hr(_l,Fh),Sr(Xl,"cullFace",rf),Sr(iu,iu,Zh),Sr(xl,xl,1),Hr(Su,Bh),Sr(Eo,"polygonOffset",[0,0]),Hr(zu,rh),Hr(Zu,Of),Sr(tl,"sampleCoverage",[1,!1]),Hr(ua,Mo),Sr(Zs,"stencilMask",-1),Sr(es,"stencilFunc",[ed,0,-1]),Sr(_u,"stencilOpSeparate",[Cl,Cu,Cu,Cu]),Sr(qc,"stencilOpSeparate",[rf,Cu,Cu,Cu]),Hr(Kc,Qp),Sr(Pf,"scissor",[0,0,N.drawingBufferWidth,N.drawingBufferHeight]),Sr(au,au,[0,0,N.drawingBufferWidth,N.drawingBufferHeight]);var qr={gl:N,context:Gr,strings:ve,next:Qr,current:Rr,draw:Mr,elements:kt,buffer:ar,shader:Tr,attributes:xr.state,vao:xr,uniforms:mr,framebuffer:fr,extensions:Ne,timer:yr,isBufferArgs:jh},Kr={primTypes:or,compareFuncs:af,blendFuncs:rl,blendEquations:jt,stencilOps:xc,glTypes:fu,orientationType:of};me.optional(function(){qr.isArrayLike=lo}),Zr&&(Kr.backBuffer=[rf],Kr.drawBuffer=Ge(Dt.maxDrawbuffers,function(we){return we===0?[0]:Ge(we,function(oe){return rd+oe})}));var gi=0;function si(){var we=oi(),oe=we.link,Ve=we.global;we.id=gi++,we.batchId="0";var ct=oe(qr),Ot=we.shared={props:"a0"};Object.keys(qr).forEach(function(Ue){Ot[Ue]=Ve.def(ct,".",Ue)}),me.optional(function(){we.CHECK=oe(me),we.commandStr=me.guessCommand(),we.command=oe(we.commandStr),we.assert=function(Ue,Te,ft){Ue("if(!(",Te,"))",this.CHECK,".commandRaise(",oe(ft),",",this.command,");")},Kr.invalidBlendCombinations=Df});var qe=we.next={},De=we.current={};Object.keys(ir).forEach(function(Ue){Array.isArray(Rr[Ue])&&(qe[Ue]=Ve.def(Ot.next,".",Ue),De[Ue]=Ve.def(Ot.current,".",Ue))});var rt=we.constants={};Object.keys(Kr).forEach(function(Ue){rt[Ue]=Ve.def(JSON.stringify(Kr[Ue]))}),we.invoke=function(Ue,Te){switch(Te.type){case $n:var ft=["this",Ot.context,Ot.props,we.batchId];return Ue.def(oe(Te.data),".call(",ft.slice(0,Math.max(Te.data.length+1,4)),")");case qn:return Ue.def(Ot.props,Te.data);case yo:return Ue.def(Ot.context,Te.data);case Qa:return Ue.def("this",Te.data);case To:return Te.data.append(we,Ue),Te.data.ref;case ia:return Te.data.toString();case Ha:return Te.data.map(function(Tt){return we.invoke(Ue,Tt)})}},we.attribCache={};var xe={};return we.scopeAttrib=function(Ue){var Te=ve.id(Ue);if(Te in xe)return xe[Te];var ft=xr.scope[Te];ft||(ft=xr.scope[Te]=new ot);var Tt=xe[Te]=oe(ft);return Tt},we}function Wr(we){var oe=we.static,Ve=we.dynamic,ct;if(mc in oe){var Ot=!!oe[mc];ct=Po(function(De,rt){return Ot}),ct.enable=Ot}else if(mc in Ve){var qe=Ve[mc];ct=js(qe,function(De,rt){return De.invoke(rt,qe)})}return ct}function nn(we,oe){var Ve=we.static,ct=we.dynamic;if(ou in Ve){var Ot=Ve[ou];return Ot?(Ot=fr.getFramebuffer(Ot),me.command(Ot,"invalid framebuffer object"),Po(function(De,rt){var xe=De.link(Ot),Ue=De.shared;rt.set(Ue.framebuffer,".next",xe);var Te=Ue.context;return rt.set(Te,"."+_c,xe+".width"),rt.set(Te,"."+If,xe+".height"),xe})):Po(function(De,rt){var xe=De.shared;rt.set(xe.framebuffer,".next","null");var Ue=xe.context;return rt.set(Ue,"."+_c,Ue+"."+Qc),rt.set(Ue,"."+If,Ue+"."+Kp),"null"})}else if(ou in ct){var qe=ct[ou];return js(qe,function(De,rt){var xe=De.invoke(rt,qe),Ue=De.shared,Te=Ue.framebuffer,ft=rt.def(Te,".getFramebuffer(",xe,")");me.optional(function(){De.assert(rt,"!"+xe+"||"+ft,"invalid framebuffer object")}),rt.set(Te,".next",ft);var Tt=Ue.context;return rt.set(Tt,"."+_c,ft+"?"+ft+".width:"+Tt+"."+Qc),rt.set(Tt,"."+If,ft+"?"+ft+".height:"+Tt+"."+Kp),ft})}else return null}function Jn(we,oe,Ve){var ct=we.static,Ot=we.dynamic;function qe(xe){if(xe in ct){var Ue=ct[xe];me.commandType(Ue,"object","invalid "+xe,Ve.commandStr);var Te=!0,ft=Ue.x|0,Tt=Ue.y|0,hr,Ur;return"width"in Ue?(hr=Ue.width|0,me.command(hr>=0,"invalid "+xe,Ve.commandStr)):Te=!1,"height"in Ue?(Ur=Ue.height|0,me.command(Ur>=0,"invalid "+xe,Ve.commandStr)):Te=!1,new Ki(!Te&&oe&&oe.thisDep,!Te&&oe&&oe.contextDep,!Te&&oe&&oe.propDep,function(Fr,Tn){var cn=Fr.shared.context,Cn=hr;"width"in Ue||(Cn=Tn.def(cn,".",_c,"-",ft));var Sn=Ur;return"height"in Ue||(Sn=Tn.def(cn,".",If,"-",Tt)),[ft,Tt,Cn,Sn]})}else if(xe in Ot){var jr=Ot[xe],on=js(jr,function(Fr,Tn){var cn=Fr.invoke(Tn,jr);me.optional(function(){Fr.assert(Tn,cn+"&&typeof "+cn+'==="object"',"invalid "+xe)});var Cn=Fr.shared.context,Sn=Tn.def(cn,".x|0"),fn=Tn.def(cn,".y|0"),ei=Tn.def('"width" in ',cn,"?",cn,".width|0:","(",Cn,".",_c,"-",Sn,")"),Ea=Tn.def('"height" in ',cn,"?",cn,".height|0:","(",Cn,".",If,"-",fn,")");return me.optional(function(){Fr.assert(Tn,ei+">=0&&"+Ea+">=0","invalid "+xe)}),[Sn,fn,ei,Ea]});return oe&&(on.thisDep=on.thisDep||oe.thisDep,on.contextDep=on.contextDep||oe.contextDep,on.propDep=on.propDep||oe.propDep),on}else return oe?new Ki(oe.thisDep,oe.contextDep,oe.propDep,function(Fr,Tn){var cn=Fr.shared.context;return[0,0,Tn.def(cn,".",_c),Tn.def(cn,".",If)]}):null}var De=qe(au);if(De){var rt=De;De=new Ki(De.thisDep,De.contextDep,De.propDep,function(xe,Ue){var Te=rt.append(xe,Ue),ft=xe.shared.context;return Ue.set(ft,"."+Lh,Te[2]),Ue.set(ft,"."+qp,Te[3]),Te})}return{viewport:De,scissor_box:qe(Pf)}}function fi(we,oe){var Ve=we.static,ct=typeof Ve[gc]=="string"&&typeof Ve[bl]=="string";if(ct){if(Object.keys(oe.dynamic).length>0)return null;var Ot=oe.static,qe=Object.keys(Ot);if(qe.length>0&&typeof Ot[qe[0]]=="number"){for(var De=[],rt=0;rt<qe.length;++rt)me(typeof Ot[qe[rt]]=="number","must specify all vertex attribute locations when using vaos"),De.push([Ot[qe[rt]]|0,qe[rt]]);return De}}return null}function Zi(we,oe,Ve){var ct=we.static,Ot=we.dynamic;function qe(Te){if(Te in ct){var ft=ve.id(ct[Te]);me.optional(function(){Tr.shader(mp[Te],ft,me.guessCommand())});var Tt=Po(function(){return ft});return Tt.id=ft,Tt}else if(Te in Ot){var hr=Ot[Te];return js(hr,function(Ur,jr){var on=Ur.invoke(jr,hr),Fr=jr.def(Ur.shared.strings,".id(",on,")");return me.optional(function(){jr(Ur.shared.shader,".shader(",mp[Te],",",Fr,",",Ur.command,");")}),Fr})}return null}var De=qe(gc),rt=qe(bl),xe=null,Ue;return bc(De)&&bc(rt)?(xe=Tr.program(rt.id,De.id,null,Ve),Ue=Po(function(Te,ft){return Te.link(xe)})):Ue=new Ki(De&&De.thisDep||rt&&rt.thisDep,De&&De.contextDep||rt&&rt.contextDep,De&&De.propDep||rt&&rt.propDep,function(Te,ft){var Tt=Te.shared.shader,hr;De?hr=De.append(Te,ft):hr=ft.def(Tt,".",gc);var Ur;rt?Ur=rt.append(Te,ft):Ur=ft.def(Tt,".",bl);var jr=Tt+".program("+Ur+","+hr;return me.optional(function(){jr+=","+Te.command}),ft.def(jr+")")}),{frag:De,vert:rt,progVar:Ue,program:xe}}function oo(we,oe){var Ve=we.static,ct=we.dynamic,Ot={},qe=!1;function De(){if(eh in Ve){var Tn=Ve[eh];return Tn!==null&&xr.getVAO(Tn)===null&&(Tn=xr.createVAO(Tn)),qe=!0,Ot.vao=Tn,Po(function(Cn){var Sn=xr.getVAO(Tn);return Sn?Cn.link(Sn):"null"})}else if(eh in ct){qe=!0;var cn=ct[eh];return js(cn,function(Cn,Sn){var fn=Cn.invoke(Sn,cn);return Sn.def(Cn.shared.vao+".getVAO("+fn+")")})}return null}var rt=De(),xe=!1;function Ue(){if(su in Ve){var Tn=Ve[su];if(Ot.elements=Tn,jh(Tn)){var cn=Ot.elements=kt.create(Tn,!0);Tn=kt.getElements(cn),xe=!0}else Tn&&(Tn=kt.getElements(Tn),xe=!0,me.command(Tn,"invalid elements",oe.commandStr));var Cn=Po(function(fn,ei){if(Tn){var Ea=fn.link(Tn);return fn.ELEMENTS=Ea,Ea}return fn.ELEMENTS=null,null});return Cn.value=Tn,Cn}else if(su in ct){xe=!0;var Sn=ct[su];return js(Sn,function(fn,ei){var Ea=fn.shared,hs=Ea.isBufferArgs,Va=Ea.elements,ya=fn.invoke(ei,Sn),Ql=ei.def("null"),Vs=ei.def(hs,"(",ya,")"),wl=fn.cond(Vs).then(Ql,"=",Va,".createStream(",ya,");").else(Ql,"=",Va,".getElements(",ya,");");return me.optional(function(){fn.assert(wl.else,"!"+ya+"||"+Ql,"invalid elements")}),ei.entry(wl),ei.exit(fn.cond(Vs).then(Va,".destroyStream(",Ql,");")),fn.ELEMENTS=Ql,Ql})}else if(qe)return new Ki(rt.thisDep,rt.contextDep,rt.propDep,function(fn,ei){return ei.def(fn.shared.vao+".currentVAO?"+fn.shared.elements+".getElements("+fn.shared.vao+".currentVAO.elements):null")});return null}var Te=Ue();function ft(){if(Bo in Ve){var Tn=Ve[Bo];return Ot.primitive=Tn,me.commandParameter(Tn,or,"invalid primitve",oe.commandStr),Po(function(Cn,Sn){return or[Tn]})}else if(Bo in ct){var cn=ct[Bo];return js(cn,function(Cn,Sn){var fn=Cn.constants.primTypes,ei=Cn.invoke(Sn,cn);return me.optional(function(){Cn.assert(Sn,ei+" in "+fn,"invalid primitive, must be one of "+Object.keys(or))}),Sn.def(fn,"[",ei,"]")})}else{if(xe)return bc(Te)?Te.value?Po(function(Cn,Sn){return Sn.def(Cn.ELEMENTS,".primType")}):Po(function(){return zh}):new Ki(Te.thisDep,Te.contextDep,Te.propDep,function(Cn,Sn){var fn=Cn.ELEMENTS;return Sn.def(fn,"?",fn,".primType:",zh)});if(qe)return new Ki(rt.thisDep,rt.contextDep,rt.propDep,function(Cn,Sn){return Sn.def(Cn.shared.vao+".currentVAO?"+Cn.shared.vao+".currentVAO.primitive:"+zh)})}return null}function Tt(Tn,cn){if(Tn in Ve){var Cn=Ve[Tn]|0;return cn?Ot.offset=Cn:Ot.instances=Cn,me.command(!cn||Cn>=0,"invalid "+Tn,oe.commandStr),Po(function(fn,ei){return cn&&(fn.OFFSET=Cn),Cn})}else if(Tn in ct){var Sn=ct[Tn];return js(Sn,function(fn,ei){var Ea=fn.invoke(ei,Sn);return cn&&(fn.OFFSET=Ea,me.optional(function(){fn.assert(ei,Ea+">=0","invalid "+Tn)})),Ea})}else if(cn){if(xe)return Po(function(fn,ei){return fn.OFFSET=0,0});if(qe)return new Ki(rt.thisDep,rt.contextDep,rt.propDep,function(fn,ei){return ei.def(fn.shared.vao+".currentVAO?"+fn.shared.vao+".currentVAO.offset:0")})}else if(qe)return new Ki(rt.thisDep,rt.contextDep,rt.propDep,function(fn,ei){return ei.def(fn.shared.vao+".currentVAO?"+fn.shared.vao+".currentVAO.instances:-1")});return null}var hr=Tt(Jf,!0);function Ur(){if($c in Ve){var Tn=Ve[$c]|0;return Ot.count=Tn,me.command(typeof Tn=="number"&&Tn>=0,"invalid vertex count",oe.commandStr),Po(function(){return Tn})}else if($c in ct){var cn=ct[$c];return js(cn,function(ei,Ea){var hs=ei.invoke(Ea,cn);return me.optional(function(){ei.assert(Ea,"typeof "+hs+'==="number"&&'+hs+">=0&&"+hs+"===("+hs+"|0)","invalid vertex count")}),hs})}else if(xe)if(bc(Te)){if(Te)return hr?new Ki(hr.thisDep,hr.contextDep,hr.propDep,function(ei,Ea){var hs=Ea.def(ei.ELEMENTS,".vertCount-",ei.OFFSET);return me.optional(function(){ei.assert(Ea,hs+">=0","invalid vertex offset/element buffer too small")}),hs}):Po(function(ei,Ea){return Ea.def(ei.ELEMENTS,".vertCount")});var Cn=Po(function(){return-1});return me.optional(function(){Cn.MISSING=!0}),Cn}else{var Sn=new Ki(Te.thisDep||hr.thisDep,Te.contextDep||hr.contextDep,Te.propDep||hr.propDep,function(ei,Ea){var hs=ei.ELEMENTS;return ei.OFFSET?Ea.def(hs,"?",hs,".vertCount-",ei.OFFSET,":-1"):Ea.def(hs,"?",hs,".vertCount:-1")});return me.optional(function(){Sn.DYNAMIC=!0}),Sn}else if(qe){var fn=new Ki(rt.thisDep,rt.contextDep,rt.propDep,function(ei,Ea){return Ea.def(ei.shared.vao,".currentVAO?",ei.shared.vao,".currentVAO.count:-1")});return fn}return null}var jr=ft(),on=Ur(),Fr=Tt(kh,!1);return{elements:Te,primitive:jr,count:on,instances:Fr,offset:hr,vao:rt,vaoActive:qe,elementsActive:xe,static:Ot}}function so(we,oe){var Ve=we.static,ct=we.dynamic,Ot={};return Un.forEach(function(qe){var De=En(qe);function rt(xe,Ue){if(qe in Ve){var Te=xe(Ve[qe]);Ot[De]=Po(function(){return Te})}else if(qe in ct){var ft=ct[qe];Ot[De]=js(ft,function(Tt,hr){return Ue(Tt,hr,Tt.invoke(hr,ft))})}}switch(qe){case _l:case Rs:case fo:case ua:case nu:case Kc:case Su:case zu:case Zu:case Wl:return rt(function(xe){return me.commandType(xe,"boolean",qe,oe.commandStr),xe},function(xe,Ue,Te){return me.optional(function(){xe.assert(Ue,"typeof "+Te+'==="boolean"',"invalid flag "+qe,xe.commandStr)}),Te});case Jo:return rt(function(xe){return me.commandParameter(xe,af,"invalid "+qe,oe.commandStr),af[xe]},function(xe,Ue,Te){var ft=xe.constants.compareFuncs;return me.optional(function(){xe.assert(Ue,Te+" in "+ft,"invalid "+qe+", must be one of "+Object.keys(af))}),Ue.def(ft,"[",Te,"]")});case cs:return rt(function(xe){return me.command(lo(xe)&&xe.length===2&&typeof xe[0]=="number"&&typeof xe[1]=="number"&&xe[0]<=xe[1],"depth range is 2d array",oe.commandStr),xe},function(xe,Ue,Te){me.optional(function(){xe.assert(Ue,xe.shared.isArrayLike+"("+Te+")&&"+Te+".length===2&&typeof "+Te+'[0]==="number"&&typeof '+Te+'[1]==="number"&&'+Te+"[0]<="+Te+"[1]","depth range must be a 2d array")});var ft=Ue.def("+",Te,"[0]"),Tt=Ue.def("+",Te,"[1]");return[ft,Tt]});case ls:return rt(function(xe){me.commandType(xe,"object","blend.func",oe.commandStr);var Ue="srcRGB"in xe?xe.srcRGB:xe.src,Te="srcAlpha"in xe?xe.srcAlpha:xe.src,ft="dstRGB"in xe?xe.dstRGB:xe.dst,Tt="dstAlpha"in xe?xe.dstAlpha:xe.dst;return me.commandParameter(Ue,rl,De+".srcRGB",oe.commandStr),me.commandParameter(Te,rl,De+".srcAlpha",oe.commandStr),me.commandParameter(ft,rl,De+".dstRGB",oe.commandStr),me.commandParameter(Tt,rl,De+".dstAlpha",oe.commandStr),me.command(Df.indexOf(Ue+", "+ft)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+Ue+", "+ft+")",oe.commandStr),[rl[Ue],rl[ft],rl[Te],rl[Tt]]},function(xe,Ue,Te){var ft=xe.constants.blendFuncs;me.optional(function(){xe.assert(Ue,Te+"&&typeof "+Te+'==="object"',"invalid blend func, must be an object")});function Tt(cn,Cn){var Sn=Ue.def('"',cn,Cn,'" in ',Te,"?",Te,".",cn,Cn,":",Te,".",cn);return me.optional(function(){xe.assert(Ue,Sn+" in "+ft,"invalid "+qe+"."+cn+Cn+", must be one of "+Object.keys(rl))}),Sn}var hr=Tt("src","RGB"),Ur=Tt("dst","RGB");me.optional(function(){var cn=xe.constants.invalidBlendCombinations;xe.assert(Ue,cn+".indexOf("+hr+'+", "+'+Ur+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var jr=Ue.def(ft,"[",hr,"]"),on=Ue.def(ft,"[",Tt("src","Alpha"),"]"),Fr=Ue.def(ft,"[",Ur,"]"),Tn=Ue.def(ft,"[",Tt("dst","Alpha"),"]");return[jr,Fr,on,Tn]});case Bu:return rt(function(xe){if(typeof xe=="string")return me.commandParameter(xe,jt,"invalid "+qe,oe.commandStr),[jt[xe],jt[xe]];if(typeof xe=="object")return me.commandParameter(xe.rgb,jt,qe+".rgb",oe.commandStr),me.commandParameter(xe.alpha,jt,qe+".alpha",oe.commandStr),[jt[xe.rgb],jt[xe.alpha]];me.commandRaise("invalid blend.equation",oe.commandStr)},function(xe,Ue,Te){var ft=xe.constants.blendEquations,Tt=Ue.def(),hr=Ue.def(),Ur=xe.cond("typeof ",Te,'==="string"');return me.optional(function(){function jr(on,Fr,Tn){xe.assert(on,Tn+" in "+ft,"invalid "+Fr+", must be one of "+Object.keys(jt))}jr(Ur.then,qe,Te),xe.assert(Ur.else,Te+"&&typeof "+Te+'==="object"',"invalid "+qe),jr(Ur.else,qe+".rgb",Te+".rgb"),jr(Ur.else,qe+".alpha",Te+".alpha")}),Ur.then(Tt,"=",hr,"=",ft,"[",Te,"];"),Ur.else(Tt,"=",ft,"[",Te,".rgb];",hr,"=",ft,"[",Te,".alpha];"),Ue(Ur),[Tt,hr]});case us:return rt(function(xe){return me.command(lo(xe)&&xe.length===4,"blend.color must be a 4d array",oe.commandStr),Ge(4,function(Ue){return+xe[Ue]})},function(xe,Ue,Te){return me.optional(function(){xe.assert(Ue,xe.shared.isArrayLike+"("+Te+")&&"+Te+".length===4","blend.color must be a 4d array")}),Ge(4,function(ft){return Ue.def("+",Te,"[",ft,"]")})});case Zs:return rt(function(xe){return me.commandType(xe,"number",De,oe.commandStr),xe|0},function(xe,Ue,Te){return me.optional(function(){xe.assert(Ue,"typeof "+Te+'==="number"',"invalid stencil.mask")}),Ue.def(Te,"|0")});case es:return rt(function(xe){me.commandType(xe,"object",De,oe.commandStr);var Ue=xe.cmp||"keep",Te=xe.ref||0,ft="mask"in xe?xe.mask:-1;return me.commandParameter(Ue,af,qe+".cmp",oe.commandStr),me.commandType(Te,"number",qe+".ref",oe.commandStr),me.commandType(ft,"number",qe+".mask",oe.commandStr),[af[Ue],Te,ft]},function(xe,Ue,Te){var ft=xe.constants.compareFuncs;me.optional(function(){function jr(){xe.assert(Ue,Array.prototype.join.call(arguments,""),"invalid stencil.func")}jr(Te+"&&typeof ",Te,'==="object"'),jr('!("cmp" in ',Te,")||(",Te,".cmp in ",ft,")")});var Tt=Ue.def('"cmp" in ',Te,"?",ft,"[",Te,".cmp]",":",Cu),hr=Ue.def(Te,".ref|0"),Ur=Ue.def('"mask" in ',Te,"?",Te,".mask|0:-1");return[Tt,hr,Ur]});case _u:case qc:return rt(function(xe){me.commandType(xe,"object",De,oe.commandStr);var Ue=xe.fail||"keep",Te=xe.zfail||"keep",ft=xe.zpass||"keep";return me.commandParameter(Ue,xc,qe+".fail",oe.commandStr),me.commandParameter(Te,xc,qe+".zfail",oe.commandStr),me.commandParameter(ft,xc,qe+".zpass",oe.commandStr),[qe===qc?rf:Cl,xc[Ue],xc[Te],xc[ft]]},function(xe,Ue,Te){var ft=xe.constants.stencilOps;me.optional(function(){xe.assert(Ue,Te+"&&typeof "+Te+'==="object"',"invalid "+qe)});function Tt(hr){return me.optional(function(){xe.assert(Ue,'!("'+hr+'" in '+Te+")||("+Te+"."+hr+" in "+ft+")","invalid "+qe+"."+hr+", must be one of "+Object.keys(xc))}),Ue.def('"',hr,'" in ',Te,"?",ft,"[",Te,".",hr,"]:",Cu)}return[qe===qc?rf:Cl,Tt("fail"),Tt("zfail"),Tt("zpass")]});case Eo:return rt(function(xe){me.commandType(xe,"object",De,oe.commandStr);var Ue=xe.factor|0,Te=xe.units|0;return me.commandType(Ue,"number",De+".factor",oe.commandStr),me.commandType(Te,"number",De+".units",oe.commandStr),[Ue,Te]},function(xe,Ue,Te){me.optional(function(){xe.assert(Ue,Te+"&&typeof "+Te+'==="object"',"invalid "+qe)});var ft=Ue.def(Te,".factor|0"),Tt=Ue.def(Te,".units|0");return[ft,Tt]});case Xl:return rt(function(xe){var Ue=0;return xe==="front"?Ue=Cl:xe==="back"&&(Ue=rf),me.command(!!Ue,De,oe.commandStr),Ue},function(xe,Ue,Te){return me.optional(function(){xe.assert(Ue,Te+'==="front"||'+Te+'==="back"',"invalid cull.face")}),Ue.def(Te,'==="front"?',Cl,":",rf)});case xl:return rt(function(xe){return me.command(typeof xe=="number"&&xe>=Dt.lineWidthDims[0]&&xe<=Dt.lineWidthDims[1],"invalid line width, must be a positive number between "+Dt.lineWidthDims[0]+" and "+Dt.lineWidthDims[1],oe.commandStr),xe},function(xe,Ue,Te){return me.optional(function(){xe.assert(Ue,"typeof "+Te+'==="number"&&'+Te+">="+Dt.lineWidthDims[0]+"&&"+Te+"<="+Dt.lineWidthDims[1],"invalid line width")}),Te});case iu:return rt(function(xe){return me.commandParameter(xe,of,De,oe.commandStr),of[xe]},function(xe,Ue,Te){return me.optional(function(){xe.assert(Ue,Te+'==="cw"||'+Te+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),Ue.def(Te+'==="cw"?'+Jp+":"+Zh)});case Nu:return rt(function(xe){return me.command(lo(xe)&&xe.length===4,"color.mask must be length 4 array",oe.commandStr),xe.map(function(Ue){return!!Ue})},function(xe,Ue,Te){return me.optional(function(){xe.assert(Ue,xe.shared.isArrayLike+"("+Te+")&&"+Te+".length===4","invalid color.mask")}),Ge(4,function(ft){return"!!"+Te+"["+ft+"]"})});case tl:return rt(function(xe){me.command(typeof xe=="object"&&xe,De,oe.commandStr);var Ue="value"in xe?xe.value:1,Te=!!xe.invert;return me.command(typeof Ue=="number"&&Ue>=0&&Ue<=1,"sample.coverage.value must be a number between 0 and 1",oe.commandStr),[Ue,Te]},function(xe,Ue,Te){me.optional(function(){xe.assert(Ue,Te+"&&typeof "+Te+'==="object"',"invalid sample.coverage")});var ft=Ue.def('"value" in ',Te,"?+",Te,".value:1"),Tt=Ue.def("!!",Te,".invert");return[ft,Tt]})}}),Ot}function Ni(we,oe){var Ve=we.static,ct=we.dynamic,Ot={};return Object.keys(Ve).forEach(function(qe){var De=Ve[qe],rt;if(typeof De=="number"||typeof De=="boolean")rt=Po(function(){return De});else if(typeof De=="function"){var xe=De._reglType;xe==="texture2d"||xe==="textureCube"?rt=Po(function(Ue){return Ue.link(De)}):xe==="framebuffer"||xe==="framebufferCube"?(me.command(De.color.length>0,'missing color attachment for framebuffer sent to uniform "'+qe+'"',oe.commandStr),rt=Po(function(Ue){return Ue.link(De.color[0])})):me.commandRaise('invalid data for uniform "'+qe+'"',oe.commandStr)}else lo(De)?rt=Po(function(Ue){var Te=Ue.global.def("[",Ge(De.length,function(ft){return me.command(typeof De[ft]=="number"||typeof De[ft]=="boolean","invalid uniform "+qe,Ue.commandStr),De[ft]}),"]");return Te}):me.commandRaise('invalid or missing data for uniform "'+qe+'"',oe.commandStr);rt.value=De,Ot[qe]=rt}),Object.keys(ct).forEach(function(qe){var De=ct[qe];Ot[qe]=js(De,function(rt,xe){return rt.invoke(xe,De)})}),Ot}function ts(we,oe){var Ve=we.static,ct=we.dynamic,Ot={};return Object.keys(Ve).forEach(function(qe){var De=Ve[qe],rt=ve.id(qe),xe=new ot;if(jh(De))xe.state=Xn,xe.buffer=ar.getBuffer(ar.create(De,Jc,!1,!0)),xe.type=0;else{var Ue=ar.getBuffer(De);if(Ue)xe.state=Xn,xe.buffer=Ue,xe.type=0;else if(me.command(typeof De=="object"&&De,"invalid data for attribute "+qe,oe.commandStr),"constant"in De){var Te=De.constant;xe.buffer="null",xe.state=di,typeof Te=="number"?xe.x=Te:(me.command(lo(Te)&&Te.length>0&&Te.length<=4,"invalid constant for attribute "+qe,oe.commandStr),ci.forEach(function(Fr,Tn){Tn<Te.length&&(xe[Fr]=Te[Tn])}))}else{jh(De.buffer)?Ue=ar.getBuffer(ar.create(De.buffer,Jc,!1,!0)):Ue=ar.getBuffer(De.buffer),me.command(!!Ue,'missing buffer for attribute "'+qe+'"',oe.commandStr);var ft=De.offset|0;me.command(ft>=0,'invalid offset for attribute "'+qe+'"',oe.commandStr);var Tt=De.stride|0;me.command(Tt>=0&&Tt<256,'invalid stride for attribute "'+qe+'", must be integer betweeen [0, 255]',oe.commandStr);var hr=De.size|0;me.command(!("size"in De)||hr>0&&hr<=4,'invalid size for attribute "'+qe+'", must be 1,2,3,4',oe.commandStr);var Ur=!!De.normalized,jr=0;"type"in De&&(me.commandParameter(De.type,fu,"invalid type for attribute "+qe,oe.commandStr),jr=fu[De.type]);var on=De.divisor|0;me.optional(function(){"divisor"in De&&(me.command(on===0||br,'cannot specify divisor for attribute "'+qe+'", instancing not supported',oe.commandStr),me.command(on>=0,'invalid divisor for attribute "'+qe+'"',oe.commandStr));var Fr=oe.commandStr,Tn=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(De).forEach(function(cn){me.command(Tn.indexOf(cn)>=0,'unknown parameter "'+cn+'" for attribute pointer "'+qe+'" (valid parameters are '+Tn+")",Fr)})}),xe.buffer=Ue,xe.state=Xn,xe.size=hr,xe.normalized=Ur,xe.type=jr||Ue.dtype,xe.offset=ft,xe.stride=Tt,xe.divisor=on}}Ot[qe]=Po(function(Fr,Tn){var cn=Fr.attribCache;if(rt in cn)return cn[rt];var Cn={isStream:!1};return Object.keys(xe).forEach(function(Sn){Cn[Sn]=xe[Sn]}),xe.buffer&&(Cn.buffer=Fr.link(xe.buffer),Cn.type=Cn.type||Cn.buffer+".dtype"),cn[rt]=Cn,Cn})}),Object.keys(ct).forEach(function(qe){var De=ct[qe];function rt(xe,Ue){var Te=xe.invoke(Ue,De),ft=xe.shared,Tt=xe.constants,hr=ft.isBufferArgs,Ur=ft.buffer;me.optional(function(){xe.assert(Ue,Te+"&&(typeof "+Te+'==="object"||typeof '+Te+'==="function")&&('+hr+"("+Te+")||"+Ur+".getBuffer("+Te+")||"+Ur+".getBuffer("+Te+".buffer)||"+hr+"("+Te+'.buffer)||("constant" in '+Te+"&&(typeof "+Te+'.constant==="number"||'+ft.isArrayLike+"("+Te+".constant))))",'invalid dynamic attribute "'+qe+'"')});var jr={isStream:Ue.def(!1)},on=new ot;on.state=Xn,Object.keys(on).forEach(function(Cn){jr[Cn]=Ue.def(""+on[Cn])});var Fr=jr.buffer,Tn=jr.type;Ue("if(",hr,"(",Te,")){",jr.isStream,"=true;",Fr,"=",Ur,".createStream(",Jc,",",Te,");",Tn,"=",Fr,".dtype;","}else{",Fr,"=",Ur,".getBuffer(",Te,");","if(",Fr,"){",Tn,"=",Fr,".dtype;",'}else if("constant" in ',Te,"){",jr.state,"=",di,";","if(typeof "+Te+'.constant === "number"){',jr[ci[0]],"=",Te,".constant;",ci.slice(1).map(function(Cn){return jr[Cn]}).join("="),"=0;","}else{",ci.map(function(Cn,Sn){return jr[Cn]+"="+Te+".constant.length>"+Sn+"?"+Te+".constant["+Sn+"]:0;"}).join(""),"}}else{","if(",hr,"(",Te,".buffer)){",Fr,"=",Ur,".createStream(",Jc,",",Te,".buffer);","}else{",Fr,"=",Ur,".getBuffer(",Te,".buffer);","}",Tn,'="type" in ',Te,"?",Tt.glTypes,"[",Te,".type]:",Fr,".dtype;",jr.normalized,"=!!",Te,".normalized;");function cn(Cn){Ue(jr[Cn],"=",Te,".",Cn,"|0;")}return cn("size"),cn("offset"),cn("stride"),cn("divisor"),Ue("}}"),Ue.exit("if(",jr.isStream,"){",Ur,".destroyStream(",Fr,");","}"),jr}Ot[qe]=js(De,rt)}),Ot}function ja(we){var oe=we.static,Ve=we.dynamic,ct={};return Object.keys(oe).forEach(function(Ot){var qe=oe[Ot];ct[Ot]=Po(function(De,rt){return typeof qe=="number"||typeof qe=="boolean"?""+qe:De.link(qe)})}),Object.keys(Ve).forEach(function(Ot){var qe=Ve[Ot];ct[Ot]=js(qe,function(De,rt){return De.invoke(rt,qe)})}),ct}function No(we,oe,Ve,ct,Ot){var qe=we.static,De=we.dynamic;me.optional(function(){var cn=[ou,bl,gc,su,Bo,Jf,$c,kh,mc,eh].concat(Un);function Cn(Sn){Object.keys(Sn).forEach(function(fn){me.command(cn.indexOf(fn)>=0,'unknown parameter "'+fn+'"',Ot.commandStr)})}Cn(qe),Cn(De)});var rt=fi(we,oe),xe=nn(we,Ot),Ue=Jn(we,xe,Ot),Te=oo(we,Ot),ft=so(we,Ot),Tt=Zi(we,Ot,rt);function hr(cn){var Cn=Ue[cn];Cn&&(ft[cn]=Cn)}hr(au),hr(En(Pf));var Ur=Object.keys(ft).length>0,jr={framebuffer:xe,draw:Te,shader:Tt,state:ft,dirty:Ur,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(jr.profile=Wr(we,Ot),jr.uniforms=Ni(Ve,Ot),jr.drawVAO=jr.scopeVAO=Te.vao,!jr.drawVAO&&Tt.program&&!rt&&Ne.angle_instanced_arrays&&Te.static.elements){var on=!0,Fr=Tt.program.attributes.map(function(cn){var Cn=oe.static[cn];return on=on&&!!Cn,Cn});if(on&&Fr.length>0){var Tn=xr.getVAO(xr.createVAO({attributes:Fr,elements:Te.static.elements}));jr.drawVAO=new Ki(null,null,null,function(cn,Cn){return cn.link(Tn)}),jr.useVAO=!0}}return rt?jr.useVAO=!0:jr.attributes=ts(oe,Ot),jr.context=ja(ct,Ot),jr}function So(we,oe,Ve){var ct=we.shared,Ot=ct.context,qe=we.scope();Object.keys(Ve).forEach(function(De){oe.save(Ot,"."+De);var rt=Ve[De],xe=rt.append(we,oe);Array.isArray(xe)?qe(Ot,".",De,"=[",xe.join(),"];"):qe(Ot,".",De,"=",xe,";")}),oe(qe)}function Wo(we,oe,Ve,ct){var Ot=we.shared,qe=Ot.gl,De=Ot.framebuffer,rt;Zr&&(rt=oe.def(Ot.extensions,".webgl_draw_buffers"));var xe=we.constants,Ue=xe.drawBuffer,Te=xe.backBuffer,ft;Ve?ft=Ve.append(we,oe):ft=oe.def(De,".next"),ct||oe("if(",ft,"!==",De,".cur){"),oe("if(",ft,"){",qe,".bindFramebuffer(",td,",",ft,".framebuffer);"),Zr&&oe(rt,".drawBuffersWEBGL(",Ue,"[",ft,".colorAttachments.length]);"),oe("}else{",qe,".bindFramebuffer(",td,",null);"),Zr&&oe(rt,".drawBuffersWEBGL(",Te,");"),oe("}",De,".cur=",ft,";"),ct||oe("}")}function Io(we,oe,Ve){var ct=we.shared,Ot=ct.gl,qe=we.current,De=we.next,rt=ct.current,xe=ct.next,Ue=we.cond(rt,".dirty");Un.forEach(function(Te){var ft=En(Te);if(!(ft in Ve.state)){var Tt,hr;if(ft in De){Tt=De[ft],hr=qe[ft];var Ur=Ge(Rr[ft].length,function(on){return Ue.def(Tt,"[",on,"]")});Ue(we.cond(Ur.map(function(on,Fr){return on+"!=="+hr+"["+Fr+"]"}).join("||")).then(Ot,".",ir[ft],"(",Ur,");",Ur.map(function(on,Fr){return hr+"["+Fr+"]="+on}).join(";"),";"))}else{Tt=Ue.def(xe,".",ft);var jr=we.cond(Tt,"!==",rt,".",ft);Ue(jr),ft in Kt?jr(we.cond(Tt).then(Ot,".enable(",Kt[ft],");").else(Ot,".disable(",Kt[ft],");"),rt,".",ft,"=",Tt,";"):jr(Ot,".",ir[ft],"(",Tt,");",rt,".",ft,"=",Tt,";")}}}),Object.keys(Ve.state).length===0&&Ue(rt,".dirty=false;"),oe(Ue)}function fs(we,oe,Ve,ct){var Ot=we.shared,qe=we.current,De=Ot.current,rt=Ot.gl;Ia(Object.keys(Ve)).forEach(function(xe){var Ue=Ve[xe];if(!(ct&&!ct(Ue))){var Te=Ue.append(we,oe);if(Kt[xe]){var ft=Kt[xe];bc(Ue)?Te?oe(rt,".enable(",ft,");"):oe(rt,".disable(",ft,");"):oe(we.cond(Te).then(rt,".enable(",ft,");").else(rt,".disable(",ft,");")),oe(De,".",xe,"=",Te,";")}else if(lo(Te)){var Tt=qe[xe];oe(rt,".",ir[xe],"(",Te,");",Te.map(function(hr,Ur){return Tt+"["+Ur+"]="+hr}).join(";"),";")}else oe(rt,".",ir[xe],"(",Te,");",De,".",xe,"=",Te,";")}})}function ho(we,oe){br&&(we.instancing=oe.def(we.shared.extensions,".angle_instanced_arrays"))}function yi(we,oe,Ve,ct,Ot){var qe=we.shared,De=we.stats,rt=qe.current,xe=qe.timer,Ue=Ve.profile;function Te(){var cn=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return cn||typeof performance=="undefined"?"Date.now()":"performance.now()"}var ft,Tt;function hr(cn){ft=oe.def(),cn(ft,"=",Te(),";"),typeof Ot=="string"?cn(De,".count+=",Ot,";"):cn(De,".count++;"),yr&&(ct?(Tt=oe.def(),cn(Tt,"=",xe,".getNumPendingQueries();")):cn(xe,".beginQuery(",De,");"))}function Ur(cn){cn(De,".cpuTime+=",Te(),"-",ft,";"),yr&&(ct?cn(xe,".pushScopeStats(",Tt,",",xe,".getNumPendingQueries(),",De,");"):cn(xe,".endQuery();"))}function jr(cn){var Cn=oe.def(rt,".profile");oe(rt,".profile=",cn,";"),oe.exit(rt,".profile=",Cn,";")}var on;if(Ue){if(bc(Ue)){Ue.enable?(hr(oe),Ur(oe.exit),jr("true")):jr("false");return}on=Ue.append(we,oe),jr(on)}else on=oe.def(rt,".profile");var Fr=we.block();hr(Fr),oe("if(",on,"){",Fr,"}");var Tn=we.block();Ur(Tn),oe.exit("if(",on,"){",Tn,"}")}function Oo(we,oe,Ve,ct,Ot){var qe=we.shared;function De(xe){switch(xe){case ih:case Nh:case sh:return 2;case Yl:case ql:case ef:return 3;case Sl:case oh:case kf:return 4;default:return 1}}function rt(xe,Ue,Te){var ft=qe.gl,Tt=oe.def(xe,".location"),hr=oe.def(qe.attributes,"[",Tt,"]"),Ur=Te.state,jr=Te.buffer,on=[Te.x,Te.y,Te.z,Te.w],Fr=["buffer","normalized","offset","stride"];function Tn(){oe("if(!",hr,".buffer){",ft,".enableVertexAttribArray(",Tt,");}");var Cn=Te.type,Sn;if(Te.size?Sn=oe.def(Te.size,"||",Ue):Sn=Ue,oe("if(",hr,".type!==",Cn,"||",hr,".size!==",Sn,"||",Fr.map(function(ei){return hr+"."+ei+"!=="+Te[ei]}).join("||"),"){",ft,".bindBuffer(",Jc,",",jr,".buffer);",ft,".vertexAttribPointer(",[Tt,Sn,Cn,Te.normalized,Te.stride,Te.offset],");",hr,".type=",Cn,";",hr,".size=",Sn,";",Fr.map(function(ei){return hr+"."+ei+"="+Te[ei]+";"}).join(""),"}"),br){var fn=Te.divisor;oe("if(",hr,".divisor!==",fn,"){",we.instancing,".vertexAttribDivisorANGLE(",[Tt,fn],");",hr,".divisor=",fn,";}")}}function cn(){oe("if(",hr,".buffer){",ft,".disableVertexAttribArray(",Tt,");",hr,".buffer=null;","}if(",ci.map(function(Cn,Sn){return hr+"."+Cn+"!=="+on[Sn]}).join("||"),"){",ft,".vertexAttrib4f(",Tt,",",on,");",ci.map(function(Cn,Sn){return hr+"."+Cn+"="+on[Sn]+";"}).join(""),"}")}Ur===Xn?Tn():Ur===di?cn():(oe("if(",Ur,"===",Xn,"){"),Tn(),oe("}else{"),cn(),oe("}"))}ct.forEach(function(xe){var Ue=xe.name,Te=Ve.attributes[Ue],ft;if(Te){if(!Ot(Te))return;ft=Te.append(we,oe)}else{if(!Ot(nd))return;var Tt=we.scopeAttrib(Ue);me.optional(function(){we.assert(oe,Tt+".state","missing attribute "+Ue)}),ft={},Object.keys(new ot).forEach(function(hr){ft[hr]=oe.def(Tt,".",hr)})}rt(we.link(xe),De(xe.info.type),ft)})}function ea(we,oe,Ve,ct,Ot,qe){for(var De=we.shared,rt=De.gl,xe,Ue=0;Ue<ct.length;++Ue){var Te=ct[Ue],ft=Te.name,Tt=Te.info.type,hr=Ve.uniforms[ft],Ur=we.link(Te),jr=Ur+".location",on;if(hr){if(!Ot(hr))continue;if(bc(hr)){var Fr=hr.value;if(me.command(Fr!==null&&typeof Fr!="undefined",'missing uniform "'+ft+'"',we.commandStr),Tt===uh||Tt===lh){me.command(typeof Fr=="function"&&(Tt===uh&&(Fr._reglType==="texture2d"||Fr._reglType==="framebuffer")||Tt===lh&&(Fr._reglType==="textureCube"||Fr._reglType==="framebufferCube")),"invalid texture for uniform "+ft,we.commandStr);var Tn=we.link(Fr._texture||Fr.color[0]._texture);oe(rt,".uniform1i(",jr,",",Tn+".bind());"),oe.exit(Tn,".unbind();")}else if(Tt===Us||Tt===Lf||Tt===tf){me.optional(function(){me.command(lo(Fr),"invalid matrix for uniform "+ft,we.commandStr),me.command(Tt===Us&&Fr.length===4||Tt===Lf&&Fr.length===9||Tt===tf&&Fr.length===16,"invalid length for matrix uniform "+ft,we.commandStr)});var cn=we.global.def("new Float32Array(["+Array.prototype.slice.call(Fr)+"])"),Cn=2;Tt===Lf?Cn=3:Tt===tf&&(Cn=4),oe(rt,".uniformMatrix",Cn,"fv(",jr,",false,",cn,");")}else{switch(Tt){case nh:me.commandType(Fr,"number","uniform "+ft,we.commandStr),xe="1f";break;case ih:me.command(lo(Fr)&&Fr.length===2,"uniform "+ft,we.commandStr),xe="2f";break;case Yl:me.command(lo(Fr)&&Fr.length===3,"uniform "+ft,we.commandStr),xe="3f";break;case Sl:me.command(lo(Fr)&&Fr.length===4,"uniform "+ft,we.commandStr),xe="4f";break;case Rf:me.commandType(Fr,"boolean","uniform "+ft,we.commandStr),xe="1i";break;case ah:me.commandType(Fr,"number","uniform "+ft,we.commandStr),xe="1i";break;case sh:me.command(lo(Fr)&&Fr.length===2,"uniform "+ft,we.commandStr),xe="2i";break;case Nh:me.command(lo(Fr)&&Fr.length===2,"uniform "+ft,we.commandStr),xe="2i";break;case ef:me.command(lo(Fr)&&Fr.length===3,"uniform "+ft,we.commandStr),xe="3i";break;case ql:me.command(lo(Fr)&&Fr.length===3,"uniform "+ft,we.commandStr),xe="3i";break;case kf:me.command(lo(Fr)&&Fr.length===4,"uniform "+ft,we.commandStr),xe="4i";break;case oh:me.command(lo(Fr)&&Fr.length===4,"uniform "+ft,we.commandStr),xe="4i";break}oe(rt,".uniform",xe,"(",jr,",",lo(Fr)?Array.prototype.slice.call(Fr):Fr,");")}continue}else on=hr.append(we,oe)}else{if(!Ot(nd))continue;on=oe.def(De.uniforms,"[",ve.id(ft),"]")}Tt===uh?(me(!Array.isArray(on),"must specify a scalar prop for textures"),oe("if(",on,"&&",on,'._reglType==="framebuffer"){',on,"=",on,".color[0];","}")):Tt===lh&&(me(!Array.isArray(on),"must specify a scalar prop for cube maps"),oe("if(",on,"&&",on,'._reglType==="framebufferCube"){',on,"=",on,".color[0];","}")),me.optional(function(){function Vs(Vu,uf){we.assert(oe,Vu,'bad data or missing for uniform "'+ft+'".  '+uf)}function wl(Vu){me(!Array.isArray(on),"must not specify an array type for uniform"),Vs("typeof "+on+'==="'+Vu+'"',"invalid type, expected "+Vu)}function ju(Vu,uf){Array.isArray(on)?me(on.length===Vu,"must have length "+Vu):Vs(De.isArrayLike+"("+on+")&&"+on+".length==="+Vu,"invalid vector, should have length "+Vu,we.commandStr)}function ad(Vu){me(!Array.isArray(on),"must not specify a value type"),Vs("typeof "+on+'==="function"&&'+on+'._reglType==="texture'+(Vu===$p?"2d":"Cube")+'"',"invalid texture type",we.commandStr)}switch(Tt){case ah:wl("number");break;case Nh:ju(2,"number");break;case ql:ju(3,"number");break;case oh:ju(4,"number");break;case nh:wl("number");break;case ih:ju(2,"number");break;case Yl:ju(3,"number");break;case Sl:ju(4,"number");break;case Rf:wl("boolean");break;case sh:ju(2,"boolean");break;case ef:ju(3,"boolean");break;case kf:ju(4,"boolean");break;case Us:ju(4,"number");break;case Lf:ju(9,"number");break;case tf:ju(16,"number");break;case uh:ad($p);break;case lh:ad(dp);break}});var Sn=1;switch(Tt){case uh:case lh:var fn=oe.def(on,"._texture");oe(rt,".uniform1i(",jr,",",fn,".bind());"),oe.exit(fn,".unbind();");continue;case ah:case Rf:xe="1i";break;case Nh:case sh:xe="2i",Sn=2;break;case ql:case ef:xe="3i",Sn=3;break;case oh:case kf:xe="4i",Sn=4;break;case nh:xe="1f";break;case ih:xe="2f",Sn=2;break;case Yl:xe="3f",Sn=3;break;case Sl:xe="4f",Sn=4;break;case Us:xe="Matrix2fv";break;case Lf:xe="Matrix3fv";break;case tf:xe="Matrix4fv";break}if(xe.charAt(0)==="M"){oe(rt,".uniform",xe,"(",jr,",");var ei=Math.pow(Tt-Us+2,2),Ea=we.global.def("new Float32Array(",ei,")");Array.isArray(on)?oe("false,(",Ge(ei,function(Vs){return Ea+"["+Vs+"]="+on[Vs]}),",",Ea,")"):oe("false,(Array.isArray(",on,")||",on," instanceof Float32Array)?",on,":(",Ge(ei,function(Vs){return Ea+"["+Vs+"]="+on+"["+Vs+"]"}),",",Ea,")"),oe(");")}else if(Sn>1){for(var hs=[],Va=[],ya=0;ya<Sn;++ya)Array.isArray(on)?Va.push(on[ya]):Va.push(oe.def(on+"["+ya+"]")),qe&&hs.push(oe.def());qe&&oe("if(!",we.batchId,"||",hs.map(function(Vs,wl){return Vs+"!=="+Va[wl]}).join("||"),"){",hs.map(function(Vs,wl){return Vs+"="+Va[wl]+";"}).join("")),oe(rt,".uniform",xe,"(",jr,",",Va.join(","),");"),qe&&oe("}")}else{if(me(!Array.isArray(on),"uniform value must not be an array"),qe){var Ql=oe.def();oe("if(!",we.batchId,"||",Ql,"!==",on,"){",Ql,"=",on,";")}oe(rt,".uniform",xe,"(",jr,",",on,");"),qe&&oe("}")}}}function zo(we,oe,Ve,ct){var Ot=we.shared,qe=Ot.gl,De=Ot.draw,rt=ct.draw;function xe(){var Sn=rt.elements,fn,ei=oe;return Sn?((Sn.contextDep&&ct.contextDynamic||Sn.propDep)&&(ei=Ve),fn=Sn.append(we,ei),rt.elementsActive&&ei("if("+fn+")"+qe+".bindBuffer("+Dh+","+fn+".buffer.buffer);")):(fn=ei.def(),ei(fn,"=",De,".",su,";","if(",fn,"){",qe,".bindBuffer(",Dh,",",fn,".buffer.buffer);}","else if(",Ot.vao,".currentVAO){",fn,"=",we.shared.elements+".getElements("+Ot.vao,".currentVAO.elements);",cr?"":"if("+fn+")"+qe+".bindBuffer("+Dh+","+fn+".buffer.buffer);","}")),fn}function Ue(){var Sn=rt.count,fn,ei=oe;return Sn?((Sn.contextDep&&ct.contextDynamic||Sn.propDep)&&(ei=Ve),fn=Sn.append(we,ei),me.optional(function(){Sn.MISSING&&we.assert(oe,"false","missing vertex count"),Sn.DYNAMIC&&we.assert(ei,fn+">=0","missing vertex count")})):(fn=ei.def(De,".",$c),me.optional(function(){we.assert(ei,fn+">=0","missing vertex count")})),fn}var Te=xe();function ft(Sn){var fn=rt[Sn];return fn?fn.contextDep&&ct.contextDynamic||fn.propDep?fn.append(we,Ve):fn.append(we,oe):oe.def(De,".",Sn)}var Tt=ft(Bo),hr=ft(Jf),Ur=Ue();if(typeof Ur=="number"){if(Ur===0)return}else Ve("if(",Ur,"){"),Ve.exit("}");var jr,on;br&&(jr=ft(kh),on=we.instancing);var Fr=Te+".type",Tn=rt.elements&&bc(rt.elements)&&!rt.vaoActive;function cn(){function Sn(){Ve(on,".drawElementsInstancedANGLE(",[Tt,Ur,Fr,hr+"<<(("+Fr+"-"+Qn+")>>1)",jr],");")}function fn(){Ve(on,".drawArraysInstancedANGLE(",[Tt,hr,Ur,jr],");")}Te&&Te!=="null"?Tn?Sn():(Ve("if(",Te,"){"),Sn(),Ve("}else{"),fn(),Ve("}")):fn()}function Cn(){function Sn(){Ve(qe+".drawElements("+[Tt,Ur,Fr,hr+"<<(("+Fr+"-"+Qn+")>>1)"]+");")}function fn(){Ve(qe+".drawArrays("+[Tt,hr,Ur]+");")}Te&&Te!=="null"?Tn?Sn():(Ve("if(",Te,"){"),Sn(),Ve("}else{"),fn(),Ve("}")):fn()}br&&(typeof jr!="number"||jr>=0)?typeof jr=="string"?(Ve("if(",jr,">0){"),cn(),Ve("}else if(",jr,"<0){"),Cn(),Ve("}")):cn():Cn()}function ri(we,oe,Ve,ct,Ot){var qe=si(),De=qe.proc("body",Ot);return me.optional(function(){qe.commandStr=oe.commandStr,qe.command=qe.link(oe.commandStr)}),br&&(qe.instancing=De.def(qe.shared.extensions,".angle_instanced_arrays")),we(qe,De,Ve,ct),qe.compile().body}function Ui(we,oe,Ve,ct){ho(we,oe),Ve.useVAO?Ve.drawVAO?oe(we.shared.vao,".setVAO(",Ve.drawVAO.append(we,oe),");"):oe(we.shared.vao,".setVAO(",we.shared.vao,".targetVAO);"):(oe(we.shared.vao,".setVAO(null);"),Oo(we,oe,Ve,ct.attributes,function(){return!0})),ea(we,oe,Ve,ct.uniforms,function(){return!0},!1),zo(we,oe,oe,Ve)}function va(we,oe){var Ve=we.proc("draw",1);ho(we,Ve),So(we,Ve,oe.context),Wo(we,Ve,oe.framebuffer),Io(we,Ve,oe),fs(we,Ve,oe.state),yi(we,Ve,oe,!1,!0);var ct=oe.shader.progVar.append(we,Ve);if(Ve(we.shared.gl,".useProgram(",ct,".program);"),oe.shader.program)Ui(we,Ve,oe,oe.shader.program);else{Ve(we.shared.vao,".setVAO(null);");var Ot=we.global.def("{}"),qe=Ve.def(ct,".id"),De=Ve.def(Ot,"[",qe,"]");Ve(we.cond(De).then(De,".call(this,a0);").else(De,"=",Ot,"[",qe,"]=",we.link(function(rt){return ri(Ui,we,oe,rt,1)}),"(",ct,");",De,".call(this,a0);"))}Object.keys(oe.state).length>0&&Ve(we.shared.current,".dirty=true;"),we.shared.vao&&Ve(we.shared.vao,".setVAO(null);")}function Nn(we,oe,Ve,ct){we.batchId="a1",ho(we,oe);function Ot(){return!0}Oo(we,oe,Ve,ct.attributes,Ot),ea(we,oe,Ve,ct.uniforms,Ot,!1),zo(we,oe,oe,Ve)}function ni(we,oe,Ve,ct){ho(we,oe);var Ot=Ve.contextDep,qe=oe.def(),De="a0",rt="a1",xe=oe.def();we.shared.props=xe,we.batchId=qe;var Ue=we.scope(),Te=we.scope();oe(Ue.entry,"for(",qe,"=0;",qe,"<",rt,";++",qe,"){",xe,"=",De,"[",qe,"];",Te,"}",Ue.exit);function ft(Fr){return Fr.contextDep&&Ot||Fr.propDep}function Tt(Fr){return!ft(Fr)}if(Ve.needsContext&&So(we,Te,Ve.context),Ve.needsFramebuffer&&Wo(we,Te,Ve.framebuffer),fs(we,Te,Ve.state,ft),Ve.profile&&ft(Ve.profile)&&yi(we,Te,Ve,!1,!0),ct)Ve.useVAO?Ve.drawVAO?ft(Ve.drawVAO)?Te(we.shared.vao,".setVAO(",Ve.drawVAO.append(we,Te),");"):Ue(we.shared.vao,".setVAO(",Ve.drawVAO.append(we,Ue),");"):Ue(we.shared.vao,".setVAO(",we.shared.vao,".targetVAO);"):(Ue(we.shared.vao,".setVAO(null);"),Oo(we,Ue,Ve,ct.attributes,Tt),Oo(we,Te,Ve,ct.attributes,ft)),ea(we,Ue,Ve,ct.uniforms,Tt,!1),ea(we,Te,Ve,ct.uniforms,ft,!0),zo(we,Ue,Te,Ve);else{var hr=we.global.def("{}"),Ur=Ve.shader.progVar.append(we,Te),jr=Te.def(Ur,".id"),on=Te.def(hr,"[",jr,"]");Te(we.shared.gl,".useProgram(",Ur,".program);","if(!",on,"){",on,"=",hr,"[",jr,"]=",we.link(function(Fr){return ri(Nn,we,Ve,Fr,2)}),"(",Ur,");}",on,".call(this,a0[",qe,"],",qe,");")}}function Me(we,oe){var Ve=we.proc("batch",2);we.batchId="0",ho(we,Ve);var ct=!1,Ot=!0;Object.keys(oe.context).forEach(function(hr){ct=ct||oe.context[hr].propDep}),ct||(So(we,Ve,oe.context),Ot=!1);var qe=oe.framebuffer,De=!1;qe?(qe.propDep?ct=De=!0:qe.contextDep&&ct&&(De=!0),De||Wo(we,Ve,qe)):Wo(we,Ve,null),oe.state.viewport&&oe.state.viewport.propDep&&(ct=!0);function rt(hr){return hr.contextDep&&ct||hr.propDep}Io(we,Ve,oe),fs(we,Ve,oe.state,function(hr){return!rt(hr)}),(!oe.profile||!rt(oe.profile))&&yi(we,Ve,oe,!1,"a1"),oe.contextDep=ct,oe.needsContext=Ot,oe.needsFramebuffer=De;var xe=oe.shader.progVar;if(xe.contextDep&&ct||xe.propDep)ni(we,Ve,oe,null);else{var Ue=xe.append(we,Ve);if(Ve(we.shared.gl,".useProgram(",Ue,".program);"),oe.shader.program)ni(we,Ve,oe,oe.shader.program);else{Ve(we.shared.vao,".setVAO(null);");var Te=we.global.def("{}"),ft=Ve.def(Ue,".id"),Tt=Ve.def(Te,"[",ft,"]");Ve(we.cond(Tt).then(Tt,".call(this,a0,a1);").else(Tt,"=",Te,"[",ft,"]=",we.link(function(hr){return ri(ni,we,oe,hr,2)}),"(",Ue,");",Tt,".call(this,a0,a1);"))}}Object.keys(oe.state).length>0&&Ve(we.shared.current,".dirty=true;"),we.shared.vao&&Ve(we.shared.vao,".setVAO(null);")}function Nt(we,oe){var Ve=we.proc("scope",3);we.batchId="a2";var ct=we.shared,Ot=ct.current;So(we,Ve,oe.context),oe.framebuffer&&oe.framebuffer.append(we,Ve),Ia(Object.keys(oe.state)).forEach(function(De){var rt=oe.state[De],xe=rt.append(we,Ve);lo(xe)?xe.forEach(function(Ue,Te){Ve.set(we.next[De],"["+Te+"]",Ue)}):Ve.set(ct.next,"."+De,xe)}),yi(we,Ve,oe,!0,!0),[su,Jf,$c,kh,Bo].forEach(function(De){var rt=oe.draw[De];!rt||Ve.set(ct.draw,"."+De,""+rt.append(we,Ve))}),Object.keys(oe.uniforms).forEach(function(De){var rt=oe.uniforms[De].append(we,Ve);Array.isArray(rt)&&(rt="["+rt.join()+"]"),Ve.set(ct.uniforms,"["+ve.id(De)+"]",rt)}),Object.keys(oe.attributes).forEach(function(De){var rt=oe.attributes[De].append(we,Ve),xe=we.scopeAttrib(De);Object.keys(new ot).forEach(function(Ue){Ve.set(xe,"."+Ue,rt[Ue])})}),oe.scopeVAO&&Ve.set(ct.vao,".targetVAO",oe.scopeVAO.append(we,Ve));function qe(De){var rt=oe.shader[De];rt&&Ve.set(ct.shader,"."+De,rt.append(we,Ve))}qe(bl),qe(gc),Object.keys(oe.state).length>0&&(Ve(Ot,".dirty=true;"),Ve.exit(Ot,".dirty=true;")),Ve("a1(",we.shared.context,",a0,",we.batchId,");")}function At(we){if(!(typeof we!="object"||lo(we))){for(var oe=Object.keys(we),Ve=0;Ve<oe.length;++Ve)if(An.isDynamic(we[oe[Ve]]))return!0;return!1}}function yn(we,oe,Ve){var ct=oe.static[Ve];if(!ct||!At(ct))return;var Ot=we.global,qe=Object.keys(ct),De=!1,rt=!1,xe=!1,Ue=we.global.def("{}");qe.forEach(function(ft){var Tt=ct[ft];if(An.isDynamic(Tt)){typeof Tt=="function"&&(Tt=ct[ft]=An.unbox(Tt));var hr=js(Tt,null);De=De||hr.thisDep,xe=xe||hr.propDep,rt=rt||hr.contextDep}else{switch(Ot(Ue,".",ft,"="),typeof Tt){case"number":Ot(Tt);break;case"string":Ot('"',Tt,'"');break;case"object":Array.isArray(Tt)&&Ot("[",Tt.join(),"]");break;default:Ot(we.link(Tt));break}Ot(";")}});function Te(ft,Tt){qe.forEach(function(hr){var Ur=ct[hr];if(!!An.isDynamic(Ur)){var jr=ft.invoke(Tt,Ur);Tt(Ue,".",hr,"=",jr,";")}})}oe.dynamic[Ve]=new An.DynamicVariable(To,{thisDep:De,contextDep:rt,propDep:xe,ref:Ue,append:Te}),delete oe.static[Ve]}function Wi(we,oe,Ve,ct,Ot){var qe=si();qe.stats=qe.link(Ot),Object.keys(oe.static).forEach(function(rt){yn(qe,oe,rt)}),Pd.forEach(function(rt){yn(qe,we,rt)});var De=No(we,oe,Ve,ct,qe);return va(qe,De),Nt(qe,De),Me(qe,De),g(qe.compile(),{destroy:function(){De.shader.program.destroy()}})}return{next:Qr,current:Rr,procs:function(){var we=si(),oe=we.proc("poll"),Ve=we.proc("refresh"),ct=we.block();oe(ct),Ve(ct);var Ot=we.shared,qe=Ot.gl,De=Ot.next,rt=Ot.current;ct(rt,".dirty=false;"),Wo(we,oe),Wo(we,Ve,null,!0);var xe;br&&(xe=we.link(br)),Ne.oes_vertex_array_object&&Ve(we.link(Ne.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var Ue=0;Ue<Dt.maxAttributes;++Ue){var Te=Ve.def(Ot.attributes,"[",Ue,"]"),ft=we.cond(Te,".buffer");ft.then(qe,".enableVertexAttribArray(",Ue,");",qe,".bindBuffer(",Jc,",",Te,".buffer.buffer);",qe,".vertexAttribPointer(",Ue,",",Te,".size,",Te,".type,",Te,".normalized,",Te,".stride,",Te,".offset);").else(qe,".disableVertexAttribArray(",Ue,");",qe,".vertexAttrib4f(",Ue,",",Te,".x,",Te,".y,",Te,".z,",Te,".w);",Te,".buffer=null;"),Ve(ft),br&&Ve(xe,".vertexAttribDivisorANGLE(",Ue,",",Te,".divisor);")}return Ve(we.shared.vao,".currentVAO=null;",we.shared.vao,".setVAO(",we.shared.vao,".targetVAO);"),Object.keys(Kt).forEach(function(Tt){var hr=Kt[Tt],Ur=ct.def(De,".",Tt),jr=we.block();jr("if(",Ur,"){",qe,".enable(",hr,")}else{",qe,".disable(",hr,")}",rt,".",Tt,"=",Ur,";"),Ve(jr),oe("if(",Ur,"!==",rt,".",Tt,"){",jr,"}")}),Object.keys(ir).forEach(function(Tt){var hr=ir[Tt],Ur=Rr[Tt],jr,on,Fr=we.block();if(Fr(qe,".",hr,"("),lo(Ur)){var Tn=Ur.length;jr=we.global.def(De,".",Tt),on=we.global.def(rt,".",Tt),Fr(Ge(Tn,function(cn){return jr+"["+cn+"]"}),");",Ge(Tn,function(cn){return on+"["+cn+"]="+jr+"["+cn+"];"}).join("")),oe("if(",Ge(Tn,function(cn){return jr+"["+cn+"]!=="+on+"["+cn+"]"}).join("||"),"){",Fr,"}")}else jr=ct.def(De,".",Tt),on=ct.def(rt,".",Tt),Fr(jr,");",rt,".",Tt,"=",jr,";"),oe("if(",jr,"!==",on,"){",Fr,"}");Ve(Fr)}),we.compile()}(),compile:Wi}}function Ld(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Vh=34918,Dd=34919,yp=35007,Al=function(N,ve){if(!ve.ext_disjoint_timer_query)return null;var Ne=[];function Dt(){return Ne.pop()||ve.ext_disjoint_timer_query.createQueryEXT()}function ar(br){Ne.push(br)}var kt=[];function qt(br){var Zr=Dt();ve.ext_disjoint_timer_query.beginQueryEXT(yp,Zr),kt.push(Zr),yr(kt.length-1,kt.length,br)}function fr(){ve.ext_disjoint_timer_query.endQueryEXT(yp)}function mr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var xr=[];function Tr(){return xr.pop()||new mr}function Mr(br){xr.push(br)}var Gr=[];function yr(br,Zr,cr){var Rr=Tr();Rr.startQueryIndex=br,Rr.endQueryIndex=Zr,Rr.sum=0,Rr.stats=cr,Gr.push(Rr)}var Cr=[],ot=[];function jt(){var br,Zr,cr=kt.length;if(cr!==0){ot.length=Math.max(ot.length,cr+1),Cr.length=Math.max(Cr.length,cr+1),Cr[0]=0,ot[0]=0;var Rr=0;for(br=0,Zr=0;Zr<kt.length;++Zr){var Qr=kt[Zr];ve.ext_disjoint_timer_query.getQueryObjectEXT(Qr,Dd)?(Rr+=ve.ext_disjoint_timer_query.getQueryObjectEXT(Qr,Vh),ar(Qr)):kt[br++]=Qr,Cr[Zr+1]=Rr,ot[Zr+1]=br}for(kt.length=br,br=0,Zr=0;Zr<Gr.length;++Zr){var Un=Gr[Zr],Kt=Un.startQueryIndex,ir=Un.endQueryIndex;Un.sum+=Cr[ir]-Cr[Kt];var En=ot[Kt],Hr=ot[ir];Hr===En?(Un.stats.gpuTime+=Un.sum/1e6,Mr(Un)):(Un.startQueryIndex=En,Un.endQueryIndex=Hr,Gr[br++]=Un)}Gr.length=br}}return{beginQuery:qt,endQuery:fr,pushScopeStats:yr,update:jt,getNumPendingQueries:function(){return kt.length},clear:function(){Ne.push.apply(Ne,kt);for(var br=0;br<Ne.length;br++)ve.ext_disjoint_timer_query.deleteQueryEXT(Ne[br]);kt.length=0,Ne.length=0},restore:function(){kt.length=0,Ne.length=0}}},ch=16384,Kl=256,id=1024,fh=34962,sf="webglcontextlost",ba="webglcontextrestored",Gh=1,$l=2,Ff=3;function _p(N,ve){for(var Ne=0;Ne<N.length;++Ne)if(N[Ne]===ve)return Ne;return-1}function Fd(N){var ve=ge(N);if(!ve)return null;var Ne=ve.gl,Dt=Ne.getContextAttributes(),ar=Ne.isContextLost(),kt=Ie(Ne,ve);if(!kt)return null;var qt=ys(),fr=Ld(),mr=kt.extensions,xr=Al(Ne,mr),Tr=io(),Mr=Ne.drawingBufferWidth,Gr=Ne.drawingBufferHeight,yr={tick:0,time:0,viewportWidth:Mr,viewportHeight:Gr,framebufferWidth:Mr,framebufferHeight:Gr,drawingBufferWidth:Mr,drawingBufferHeight:Gr,pixelRatio:ve.pixelRatio},Cr={},ot={elements:null,primitive:4,count:-1,offset:0,instances:-1},jt=Il(Ne,mr),br=B(Ne,fr,ve,Rr),Zr=ll(Ne,mr,br,fr),cr=gt(Ne,mr,jt,fr,br,Zr,ot);function Rr(ri){return cr.destroyBuffer(ri)}var Qr=Dr(Ne,qt,fr,ve),Un=ws(Ne,mr,jt,function(){En.procs.poll()},yr,fr,ve),Kt=dc(Ne,mr,jt,fr,ve),ir=ke(Ne,mr,jt,Un,Kt,fr),En=gp(Ne,qt,mr,jt,br,Zr,Un,ir,Cr,cr,Qr,ot,yr,xr,ve),Hr=Bn(Ne,ir,En.procs.poll,yr,Dt,mr,jt),Sr=En.next,qr=Ne.canvas,Kr=[],gi=[],si=[],Wr=[ve.onDestroy],nn=null;function Jn(){if(Kr.length===0){xr&&xr.update(),nn=null;return}nn=Bi.next(Jn),ho();for(var ri=Kr.length-1;ri>=0;--ri){var Ui=Kr[ri];Ui&&Ui(yr,null,0)}Ne.flush(),xr&&xr.update()}function fi(){!nn&&Kr.length>0&&(nn=Bi.next(Jn))}function Zi(){nn&&(Bi.cancel(Jn),nn=null)}function oo(ri){ri.preventDefault(),ar=!0,Zi(),gi.forEach(function(Ui){Ui()})}function so(ri){Ne.getError(),ar=!1,kt.restore(),Qr.restore(),br.restore(),Un.restore(),Kt.restore(),ir.restore(),cr.restore(),xr&&xr.restore(),En.procs.refresh(),fi(),si.forEach(function(Ui){Ui()})}var Ni=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;!Ni&&qr&&(qr.addEventListener(sf,oo,!1),qr.addEventListener(ba,so,!1));function ts(){Kr.length=0,Zi(),!Ni&&qr&&(qr.removeEventListener(sf,oo),qr.removeEventListener(ba,so)),Qr.clear(),ir.clear(),Kt.clear(),cr.clear(),Un.clear(),Zr.clear(),br.clear(),xr&&xr.clear(),Wr.forEach(function(ri){ri()})}function ja(ri){me(!!ri,"invalid args to regl({...})"),me.type(ri,"object","invalid args to regl({...})");function Ui(qe){var De=g({},qe);delete De.uniforms,delete De.attributes,delete De.context,delete De.vao,"stencil"in De&&De.stencil.op&&(De.stencil.opBack=De.stencil.opFront=De.stencil.op,delete De.stencil.op);function rt(xe){if(xe in De){var Ue=De[xe];delete De[xe],Object.keys(Ue).forEach(function(Te){De[xe+"."+Te]=Ue[Te]})}}return rt("blend"),rt("depth"),rt("cull"),rt("stencil"),rt("polygonOffset"),rt("scissor"),rt("sample"),"vao"in qe&&(De.vao=qe.vao),De}function va(qe,De){var rt={},xe={};return Object.keys(qe).forEach(function(Ue){var Te=qe[Ue];if(An.isDynamic(Te)){xe[Ue]=An.unbox(Te,Ue);return}else if(De&&Array.isArray(Te)){for(var ft=0;ft<Te.length;++ft)if(An.isDynamic(Te[ft])){xe[Ue]=An.unbox(Te,Ue);return}}rt[Ue]=Te}),{dynamic:xe,static:rt}}var Nn=va(ri.context||{},!0),ni=va(ri.uniforms||{},!0),Me=va(ri.attributes||{},!1),Nt=va(Ui(ri),!1),At={gpuTime:0,cpuTime:0,count:0},yn=En.compile(Nt,Me,ni,Nn,At),Wi=yn.draw,we=yn.batch,oe=yn.scope,Ve=[];function ct(qe){for(;Ve.length<qe;)Ve.push(null);return Ve}function Ot(qe,De){var rt;if(ar&&me.raise("context lost"),typeof qe=="function")return oe.call(this,null,qe,0);if(typeof De=="function")if(typeof qe=="number")for(rt=0;rt<qe;++rt)oe.call(this,null,De,rt);else if(Array.isArray(qe))for(rt=0;rt<qe.length;++rt)oe.call(this,qe[rt],De,rt);else return oe.call(this,qe,De,0);else if(typeof qe=="number"){if(qe>0)return we.call(this,ct(qe|0),qe|0)}else if(Array.isArray(qe)){if(qe.length)return we.call(this,qe,qe.length)}else return Wi.call(this,qe)}return g(Ot,{stats:At,destroy:function(){yn.destroy()}})}var No=ir.setFBO=ja({framebuffer:An.define.call(null,Gh,"framebuffer")});function So(ri,Ui){var va=0;En.procs.poll();var Nn=Ui.color;Nn&&(Ne.clearColor(+Nn[0]||0,+Nn[1]||0,+Nn[2]||0,+Nn[3]||0),va|=ch),"depth"in Ui&&(Ne.clearDepth(+Ui.depth),va|=Kl),"stencil"in Ui&&(Ne.clearStencil(Ui.stencil|0),va|=id),me(!!va,"called regl.clear with no buffer specified"),Ne.clear(va)}function Wo(ri){if(me(typeof ri=="object"&&ri,"regl.clear() takes an object as input"),"framebuffer"in ri)if(ri.framebuffer&&ri.framebuffer_reglType==="framebufferCube")for(var Ui=0;Ui<6;++Ui)No(g({framebuffer:ri.framebuffer.faces[Ui]},ri),So);else No(ri,So);else So(null,ri)}function Io(ri){me.type(ri,"function","regl.frame() callback must be a function"),Kr.push(ri);function Ui(){var va=_p(Kr,ri);me(va>=0,"cannot cancel a frame twice");function Nn(){var ni=_p(Kr,Nn);Kr[ni]=Kr[Kr.length-1],Kr.length-=1,Kr.length<=0&&Zi()}Kr[va]=Nn}return fi(),{cancel:Ui}}function fs(){var ri=Sr.viewport,Ui=Sr.scissor_box;ri[0]=ri[1]=Ui[0]=Ui[1]=0,yr.viewportWidth=yr.framebufferWidth=yr.drawingBufferWidth=ri[2]=Ui[2]=Ne.drawingBufferWidth,yr.viewportHeight=yr.framebufferHeight=yr.drawingBufferHeight=ri[3]=Ui[3]=Ne.drawingBufferHeight}function ho(){yr.tick+=1,yr.time=Oo(),fs(),En.procs.poll()}function yi(){Un.refresh(),fs(),En.procs.refresh(),xr&&xr.update()}function Oo(){return(io()-Tr)/1e3}yi();function ea(ri,Ui){me.type(Ui,"function","listener callback must be a function");var va;switch(ri){case"frame":return Io(Ui);case"lost":va=gi;break;case"restore":va=si;break;case"destroy":va=Wr;break;default:me.raise("invalid event, must be one of frame,lost,restore,destroy")}return va.push(Ui),{cancel:function(){for(var Nn=0;Nn<va.length;++Nn)if(va[Nn]===Ui){va[Nn]=va[va.length-1],va.pop();return}}}}var zo=g(ja,{clear:Wo,prop:An.define.bind(null,Gh),context:An.define.bind(null,$l),this:An.define.bind(null,Ff),draw:ja({}),buffer:function(ri){return br.create(ri,fh,!1,!1)},elements:function(ri){return Zr.create(ri,!1)},texture:Un.create2D,cube:Un.createCube,renderbuffer:Kt.create,framebuffer:ir.create,framebufferCube:ir.createCube,vao:cr.createVAO,attributes:Dt,frame:Io,on:ea,limits:jt,hasExtension:function(ri){return jt.extensions.indexOf(ri.toLowerCase())>=0},read:Hr,destroy:ts,_gl:Ne,_refresh:yi,poll:function(){ho(),xr&&xr.update()},now:Oo,stats:fr});return ve.onDone(null,zo),zo}return Fd})},44286:function(Jt){function te(W){return W.split("")}Jt.exports=te},49029:function(Jt){var te=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function W(_e){return _e.match(te)||[]}Jt.exports=W},29750:function(Jt){function te(W,_e,ue){return W===W&&(ue!==void 0&&(W=W<=ue?W:ue),_e!==void 0&&(W=W>=_e?W:_e)),W}Jt.exports=te},18674:function(Jt){function te(W){return function(_e){return W==null?void 0:W[_e]}}Jt.exports=te},18190:function(Jt){var te=9007199254740991,W=Math.floor;function _e(ue,g){var Ee="";if(!ue||g<1||g>te)return Ee;do g%2&&(Ee+=ue),g=W(g/2),g&&(ue+=ue);while(g);return Ee}Jt.exports=_e},14259:function(Jt){function te(W,_e,ue){var g=-1,Ee=W.length;_e<0&&(_e=-_e>Ee?0:Ee+_e),ue=ue>Ee?Ee:ue,ue<0&&(ue+=Ee),Ee=_e>ue?0:ue-_e>>>0,_e>>>=0;for(var H=Array(Ee);++g<Ee;)H[g]=W[g+_e];return H}Jt.exports=te},40180:function(Jt,te,W){var _e=W(14259);function ue(g,Ee,H){var ae=g.length;return H=H===void 0?ae:H,!Ee&&H>=ae?g:_e(g,Ee,H)}Jt.exports=ue},98805:function(Jt,te,W){var _e=W(40180),ue=W(62689),g=W(83140),Ee=W(79833);function H(ae){return function(le){le=Ee(le);var Be=ue(le)?g(le):void 0,ye=Be?Be[0]:le.charAt(0),Je=Be?_e(Be,1).join(""):le.slice(1);return ye[ae]()+Je}}Jt.exports=H},35393:function(Jt,te,W){var _e=W(62663),ue=W(53816),g=W(58748),Ee="['\u2019]",H=RegExp(Ee,"g");function ae(le){return function(Be){return _e(g(ue(Be).replace(H,"")),le,"")}}Jt.exports=ae},78302:function(Jt,te,W){var _e=W(18190),ue=W(80531),g=W(40180),Ee=W(62689),H=W(88016),ae=W(83140),le=Math.ceil;function Be(ye,Je){Je=Je===void 0?" ":ue(Je);var st=Je.length;if(st<2)return st?_e(Je,ye):Je;var yt=_e(Je,le(ye/H(Je)));return Ee(Je)?g(ae(yt),0,ye).join(""):yt.slice(0,ye)}Jt.exports=Be},69389:function(Jt,te,W){var _e=W(18674),ue={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},g=_e(ue);Jt.exports=g},93157:function(Jt){var te=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function W(_e){return te.test(_e)}Jt.exports=W},83140:function(Jt,te,W){var _e=W(44286),ue=W(62689),g=W(676);function Ee(H){return ue(H)?g(H):_e(H)}Jt.exports=Ee},676:function(Jt){var te="\\ud800-\\udfff",W="\\u0300-\\u036f",_e="\\ufe20-\\ufe2f",ue="\\u20d0-\\u20ff",g=W+_e+ue,Ee="\\ufe0e\\ufe0f",H="["+te+"]",ae="["+g+"]",le="\\ud83c[\\udffb-\\udfff]",Be="(?:"+ae+"|"+le+")",ye="[^"+te+"]",Je="(?:\\ud83c[\\udde6-\\uddff]){2}",st="[\\ud800-\\udbff][\\udc00-\\udfff]",yt="\\u200d",$t=Be+"?",tr="["+Ee+"]?",Mt="(?:"+yt+"(?:"+[ye,Je,st].join("|")+")"+tr+$t+")*",Qt=tr+$t+Mt,Bt="(?:"+[ye+ae+"?",ae,Je,st,H].join("|")+")",ut=RegExp(le+"(?="+le+")|"+Bt+Qt,"g");function pt(rr){return rr.match(ut)||[]}Jt.exports=pt},2757:function(Jt){var te="\\ud800-\\udfff",W="\\u0300-\\u036f",_e="\\ufe20-\\ufe2f",ue="\\u20d0-\\u20ff",g=W+_e+ue,Ee="\\u2700-\\u27bf",H="a-z\\xdf-\\xf6\\xf8-\\xff",ae="\\xac\\xb1\\xd7\\xf7",le="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Be="\\u2000-\\u206f",ye=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Je="A-Z\\xc0-\\xd6\\xd8-\\xde",st="\\ufe0e\\ufe0f",yt=ae+le+Be+ye,$t="['\u2019]",tr="["+yt+"]",Mt="["+g+"]",Qt="\\d+",Bt="["+Ee+"]",ut="["+H+"]",pt="[^"+te+yt+Qt+Ee+H+Je+"]",rr="\\ud83c[\\udffb-\\udfff]",K="(?:"+Mt+"|"+rr+")",Xt="[^"+te+"]",lt="(?:\\ud83c[\\udde6-\\uddff]){2}",$e="[\\ud800-\\udbff][\\udc00-\\udfff]",St="["+Je+"]",et="\\u200d",Ht="(?:"+ut+"|"+pt+")",Er="(?:"+St+"|"+pt+")",kr="(?:"+$t+"(?:d|ll|m|re|s|t|ve))?",$r="(?:"+$t+"(?:D|LL|M|RE|S|T|VE))?",S=K+"?",pe="["+st+"]?",he="(?:"+et+"(?:"+[Xt,lt,$e].join("|")+")"+pe+S+")*",He="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Ke="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",it=pe+S+he,bt="(?:"+[Bt,lt,$e].join("|")+")"+it,nr=RegExp([St+"?"+ut+"+"+kr+"(?="+[tr,St,"$"].join("|")+")",Er+"+"+$r+"(?="+[tr,St+Ht,"$"].join("|")+")",St+"?"+Ht+"+"+kr,St+"+"+$r,Ke,He,Qt,bt].join("|"),"g");function Nr(wr){return wr.match(nr)||[]}Jt.exports=Nr},68929:function(Jt,te,W){var _e=W(48403),ue=W(35393),g=ue(function(Ee,H,ae){return H=H.toLowerCase(),Ee+(ae?_e(H):H)});Jt.exports=g},48403:function(Jt,te,W){var _e=W(79833),ue=W(11700);function g(Ee){return ue(_e(Ee).toLowerCase())}Jt.exports=g},74691:function(Jt,te,W){var _e=W(29750),ue=W(14841);function g(Ee,H,ae){return ae===void 0&&(ae=H,H=void 0),ae!==void 0&&(ae=ue(ae),ae=ae===ae?ae:0),H!==void 0&&(H=ue(H),H=H===H?H:0),_e(ue(Ee),H,ae)}Jt.exports=g},53816:function(Jt,te,W){var _e=W(69389),ue=W(79833),g=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Ee="\\u0300-\\u036f",H="\\ufe20-\\ufe2f",ae="\\u20d0-\\u20ff",le=Ee+H+ae,Be="["+le+"]",ye=RegExp(Be,"g");function Je(st){return st=ue(st),st&&st.replace(g,_e).replace(ye,"")}Jt.exports=Je},14293:function(Jt){function te(W){return W==null}Jt.exports=te},81763:function(Jt,te,W){var _e=W(44239),ue=W(37005),g="[object Number]";function Ee(H){return typeof H=="number"||ue(H)&&_e(H)==g}Jt.exports=Ee},30236:function(Jt,te,W){var _e=W(42980),ue=W(21463),g=ue(function(Ee,H,ae,le){_e(Ee,H,ae,le)});Jt.exports=g},11726:function(Jt,te,W){var _e=W(78302),ue=W(88016),g=W(40554),Ee=W(79833);function H(ae,le,Be){ae=Ee(ae),le=g(le);var ye=le?ue(ae):0;return le&&ye<le?ae+_e(le-ye,Be):ae}Jt.exports=H},32475:function(Jt,te,W){var _e=W(78302),ue=W(88016),g=W(40554),Ee=W(79833);function H(ae,le,Be){ae=Ee(ae),le=g(le);var ye=le?ue(ae):0;return le&&ye<le?_e(le-ye,Be)+ae:ae}Jt.exports=H},44908:function(Jt,te,W){var _e=W(45652);function ue(g){return g&&g.length?_e(g):[]}Jt.exports=ue},11700:function(Jt,te,W){var _e=W(98805),ue=_e("toUpperCase");Jt.exports=ue},58748:function(Jt,te,W){var _e=W(49029),ue=W(93157),g=W(79833),Ee=W(2757);function H(ae,le,Be){return ae=g(ae),le=Be?void 0:le,le===void 0?ue(ae)?Ee(ae):_e(ae):ae.match(le)||[]}Jt.exports=H},6158:function(Jt){(function(te,W){Jt.exports=W()})(this,function(){"use strict";var te,W,_e;function ue(g,Ee){if(!te)te=Ee;else if(!W)W=Ee;else{var H="var sharedChunk = {}; ("+te+")(sharedChunk); ("+W+")(sharedChunk);",ae={};te(ae),_e=Ee(ae),typeof window!="undefined"&&(_e.workerUrl=window.URL.createObjectURL(new Blob([H],{type:"text/javascript"})))}}return ue(["exports"],function(g){"use strict";function Ee(t,o){return t(o={exports:{}},o.exports),o.exports}var H=ae;function ae(t,o,u,p){this.cx=3*t,this.bx=3*(u-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(p-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=p,this.p2x=u,this.p2y=p}ae.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},ae.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},ae.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},ae.prototype.solveCurveX=function(t,o){var u,p,y,b,C;for(o===void 0&&(o=1e-6),y=t,C=0;C<8;C++){if(b=this.sampleCurveX(y)-t,Math.abs(b)<o)return y;var I=this.sampleCurveDerivativeX(y);if(Math.abs(I)<1e-6)break;y-=b/I}if((y=t)<(u=0))return u;if(y>(p=1))return p;for(;u<p;){if(b=this.sampleCurveX(y),Math.abs(b-t)<o)return y;t>b?u=y:p=y,y=.5*(p-u)+u}return y},ae.prototype.solve=function(t,o){return this.sampleCurveY(this.solveCurveX(t,o))};var le=Be;function Be(t,o){this.x=t,this.y=o}Be.prototype={clone:function(){return new Be(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,o){return this.clone()._rotateAround(t,o)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var o=t.x-this.x,u=t.y-this.y;return o*o+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,o){return Math.atan2(this.x*o-this.y*t,this.x*t+this.y*o)},_matMult:function(t){var o=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=o,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var o=Math.cos(t),u=Math.sin(t),p=u*this.x+o*this.y;return this.x=o*this.x-u*this.y,this.y=p,this},_rotateAround:function(t,o){var u=Math.cos(t),p=Math.sin(t),y=o.y+p*(this.x-o.x)+u*(this.y-o.y);return this.x=o.x+u*(this.x-o.x)-p*(this.y-o.y),this.y=y,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Be.convert=function(t){return t instanceof Be?t:Array.isArray(t)?new Be(t[0],t[1]):t};var ye=typeof self!="undefined"?self:{},Je=Math.pow(2,53)-1;function st(t,o,u,p){var y=new H(t,o,u,p);return function(b){return y.solve(b)}}var yt=st(.25,.1,.25,1);function $t(t,o,u){return Math.min(u,Math.max(o,t))}function tr(t,o,u){var p=u-o,y=((t-o)%p+p)%p+o;return y===o?u:y}function Mt(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];for(var p=0,y=o;p<y.length;p+=1){var b=y[p];for(var C in b)t[C]=b[C]}return t}var Qt=1;function Bt(){return Qt++}function ut(){return function t(o){return o?(o^16*Math.random()>>o/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function pt(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function rr(t,o){t.forEach(function(u){o[u]&&(o[u]=o[u].bind(o))})}function K(t,o){return t.indexOf(o,t.length-o.length)!==-1}function Xt(t,o,u){var p={};for(var y in t)p[y]=o.call(u||this,t[y],y,t);return p}function lt(t,o,u){var p={};for(var y in t)o.call(u||this,t[y],y,t)&&(p[y]=t[y]);return p}function $e(t){return Array.isArray(t)?t.map($e):typeof t=="object"&&t?Xt(t,$e):t}var St={};function et(t){St[t]||(typeof console!="undefined"&&console.warn(t),St[t]=!0)}function Ht(t,o,u){return(u.y-t.y)*(o.x-t.x)>(o.y-t.y)*(u.x-t.x)}function Er(t){for(var o=0,u=0,p=t.length,y=p-1,b=void 0,C=void 0;u<p;y=u++)o+=((C=t[y]).x-(b=t[u]).x)*(b.y+C.y);return o}function kr(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function $r(t){var o={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(p,y,b,C){var I=b||C;return o[y]=!I||I.toLowerCase(),""}),o["max-age"]){var u=parseInt(o["max-age"],10);isNaN(u)?delete o["max-age"]:o["max-age"]=u}return o}var S=null;function pe(t){if(S==null){var o=t.navigator?t.navigator.userAgent:null;S=!!t.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return S}function he(t){try{var o=ye[t];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch(u){return!1}}var He,Ke,it,bt,nr=ye.performance&&ye.performance.now?ye.performance.now.bind(ye.performance):Date.now.bind(Date),Nr=ye.requestAnimationFrame||ye.mozRequestAnimationFrame||ye.webkitRequestAnimationFrame||ye.msRequestAnimationFrame,wr=ye.cancelAnimationFrame||ye.mozCancelAnimationFrame||ye.webkitCancelAnimationFrame||ye.msCancelAnimationFrame,xn={now:nr,frame:function(t){var o=Nr(t);return{cancel:function(){return wr(o)}}},getImageData:function(t,o){o===void 0&&(o=0);var u=ye.document.createElement("canvas"),p=u.getContext("2d");if(!p)throw new Error("failed to create canvas 2d context");return u.width=t.width,u.height=t.height,p.drawImage(t,0,0,t.width,t.height),p.getImageData(-o,-o,t.width+2*o,t.height+2*o)},resolveURL:function(t){return He||(He=ye.document.createElement("a")),He.href=t,He.href},hardwareConcurrency:ye.navigator&&ye.navigator.hardwareConcurrency||4,get devicePixelRatio(){return ye.devicePixelRatio},get prefersReducedMotion(){return!!ye.matchMedia&&(Ke==null&&(Ke=ye.matchMedia("(prefers-reduced-motion: reduce)")),Ke.matches)}},an={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Dn={supported:!1,testSupport:function(t){!jn&&bt&&(In?ii(t):it=t)}},jn=!1,In=!1;function ii(t){var o=t.createTexture();t.bindTexture(t.TEXTURE_2D,o);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,bt),t.isContextLost())return;Dn.supported=!0}catch(u){}t.deleteTexture(o),jn=!0}ye.document&&((bt=ye.document.createElement("img")).onload=function(){it&&ii(it),it=null,In=!0},bt.onerror=function(){jn=!0,it=null},bt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var wi="01",Ei=function(t,o){this._transformRequestFn=t,this._customAccessToken=o,this._createSkuToken()};function Ti(t){return t.indexOf("mapbox:")===0}Ei.prototype._createSkuToken=function(){var t=function(){for(var o="",u=0;u<10;u++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",wi,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},Ei.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Ei.prototype.transformRequest=function(t,o){return this._transformRequestFn&&this._transformRequestFn(t,o)||{url:t}},Ei.prototype.normalizeStyleURL=function(t,o){if(!Ti(t))return t;var u=Sa(t);return u.path="/styles/v1"+u.path,this._makeAPIURL(u,this._customAccessToken||o)},Ei.prototype.normalizeGlyphsURL=function(t,o){if(!Ti(t))return t;var u=Sa(t);return u.path="/fonts/v1"+u.path,this._makeAPIURL(u,this._customAccessToken||o)},Ei.prototype.normalizeSourceURL=function(t,o){if(!Ti(t))return t;var u=Sa(t);return u.path="/v4/"+u.authority+".json",u.params.push("secure"),this._makeAPIURL(u,this._customAccessToken||o)},Ei.prototype.normalizeSpriteURL=function(t,o,u,p){var y=Sa(t);return Ti(t)?(y.path="/styles/v1"+y.path+"/sprite"+o+u,this._makeAPIURL(y,this._customAccessToken||p)):(y.path+=""+o+u,pa(y))},Ei.prototype.normalizeTileURL=function(t,o){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Ti(t))return t;var u=Sa(t);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,(xn.devicePixelRatio>=2||o===512?"@2x":"")+(Dn.supported?".webp":"$1")),u.path=u.path.replace(/^.+\/v4\//,"/"),u.path="/v4"+u.path;var p=this._customAccessToken||function(y){for(var b=0,C=y;b<C.length;b+=1){var I=C[b].match(/^access_token=(.*)$/);if(I)return I[1]}return null}(u.params)||an.ACCESS_TOKEN;return an.REQUIRE_ACCESS_TOKEN&&p&&this._skuToken&&u.params.push("sku="+this._skuToken),this._makeAPIURL(u,p)},Ei.prototype.canonicalizeTileURL=function(t,o){var u=Sa(t);if(!u.path.match(/(^\/v4\/)/)||!u.path.match(/\.[\w]+$/))return t;var p="mapbox://tiles/";p+=u.path.replace("/v4/","");var y=u.params;return o&&(y=y.filter(function(b){return!b.match(/^access_token=/)})),y.length&&(p+="?"+y.join("&")),p},Ei.prototype.canonicalizeTileset=function(t,o){for(var u=!!o&&Ti(o),p=[],y=0,b=t.tiles||[];y<b.length;y+=1){var C=b[y];Qi(C)?p.push(this.canonicalizeTileURL(C,u)):p.push(C)}return p},Ei.prototype._makeAPIURL=function(t,o){var u="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",p=Sa(an.API_URL);if(t.protocol=p.protocol,t.authority=p.authority,t.protocol==="http"){var y=t.params.indexOf("secure");y>=0&&t.params.splice(y,1)}if(p.path!=="/"&&(t.path=""+p.path+t.path),!an.REQUIRE_ACCESS_TOKEN)return pa(t);if(!(o=o||an.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+u);if(o[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+u);return t.params=t.params.filter(function(b){return b.indexOf("access_token")===-1}),t.params.push("access_token="+o),pa(t)};var Gi=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function Qi(t){return Gi.test(t)}var po=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Sa(t){var o=t.match(po);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function pa(t){var o=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+o}function Fi(t){if(!t)return null;var o=t.split(".");if(!o||o.length!==3)return null;try{return JSON.parse(decodeURIComponent(ye.atob(o[1]).split("").map(function(u){return"%"+("00"+u.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(u){return null}}var ra=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};ra.prototype.getStorageKey=function(t){var o,u=Fi(an.ACCESS_TOKEN);return o=u&&u.u?ye.btoa(encodeURIComponent(u.u).replace(/%([0-9A-F]{2})/g,function(p,y){return String.fromCharCode(Number("0x"+y))})):an.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+o:"mapbox.eventData:"+o},ra.prototype.fetchEventData=function(){var t=he("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{var p=ye.localStorage.getItem(o);p&&(this.eventData=JSON.parse(p));var y=ye.localStorage.getItem(u);y&&(this.anonId=y)}catch(b){et("Unable to read from LocalStorage")}},ra.prototype.saveEventData=function(){var t=he("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{ye.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&ye.localStorage.setItem(o,JSON.stringify(this.eventData))}catch(p){et("Unable to write to LocalStorage")}},ra.prototype.processRequests=function(t){},ra.prototype.postEvent=function(t,o,u,p){var y=this;if(an.EVENTS_URL){var b=Sa(an.EVENTS_URL);b.params.push("access_token="+(p||an.ACCESS_TOKEN||""));var C={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:wi,userId:this.anonId},I=o?Mt(C,o):C,D={url:pa(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([I])};this.pendingRequest=xa(D,function(z){y.pendingRequest=null,u(z),y.saveEventData(),y.processRequests(p)})}},ra.prototype.queueRequest=function(t,o){this.queue.push(t),this.processRequests(o)};var $i,is,me=function(t){function o(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.postMapLoadEvent=function(u,p,y,b){this.skuToken=y,(an.EVENTS_URL&&b||an.ACCESS_TOKEN&&Array.isArray(u)&&u.some(function(C){return Ti(C)||Qi(C)}))&&this.queueRequest({id:p,timestamp:Date.now()},b)},o.prototype.processRequests=function(u){var p=this;if(!this.pendingRequest&&this.queue.length!==0){var y=this.queue.shift(),b=y.id,C=y.timestamp;b&&this.success[b]||(this.anonId||this.fetchEventData(),pt(this.anonId)||(this.anonId=ut()),this.postEvent(C,{skuToken:this.skuToken},function(I){I||b&&(p.success[b]=!0)},u))}},o}(ra),li=new(function(t){function o(u){t.call(this,"appUserTurnstile"),this._customAccessToken=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.postTurnstileEvent=function(u,p){an.EVENTS_URL&&an.ACCESS_TOKEN&&Array.isArray(u)&&u.some(function(y){return Ti(y)||Qi(y)})&&this.queueRequest(Date.now(),p)},o.prototype.processRequests=function(u){var p=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var y=Fi(an.ACCESS_TOKEN),b=y?y.u:an.ACCESS_TOKEN,C=b!==this.eventData.tokenU;pt(this.anonId)||(this.anonId=ut(),C=!0);var I=this.queue.shift();if(this.eventData.lastSuccess){var D=new Date(this.eventData.lastSuccess),z=new Date(I),U=(I-this.eventData.lastSuccess)/864e5;C=C||U>=1||U<-1||D.getDate()!==z.getDate()}else C=!0;if(!C)return this.processRequests();this.postEvent(I,{"enabled.telemetry":!1},function(G){G||(p.eventData.lastSuccess=I,p.eventData.tokenU=b)},u)}},o}(ra)),bo=li.postTurnstileEvent.bind(li),cu=new me,Zt=cu.postMapLoadEvent.bind(cu),er=500,Lr=50;function sn(){ye.caches&&!$i&&($i=ye.caches.open("mapbox-tiles"))}function On(t){var o=t.indexOf("?");return o<0?t:t.slice(0,o)}var Vn,bi=1/0;function vi(){return Vn==null&&(Vn=ye.OffscreenCanvas&&new ye.OffscreenCanvas(1,1).getContext("2d")&&typeof ye.createImageBitmap=="function"),Vn}var An={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(An);var Bi=function(t){function o(u,p,y){p===401&&Qi(y)&&(u+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,u),this.status=p,this.url=y,this.name=this.constructor.name,this.message=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},o}(Error),Li=kr()?function(){return self.worker&&self.worker.referrer}:function(){return(ye.location.protocol==="blob:"?ye.parent:ye).location.href},io,ys,Uo=function(t,o){if(!(/^file:/.test(u=t.url)||/^file:/.test(Li())&&!/^\w+:/.test(u))){if(ye.fetch&&ye.Request&&ye.AbortController&&ye.Request.prototype.hasOwnProperty("signal"))return function(p,y){var b,C=new ye.AbortController,I=new ye.Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,referrer:Li(),signal:C.signal}),D=!1,z=!1,U=(b=I.url).indexOf("sku=")>0&&Qi(b);p.type==="json"&&I.headers.set("Accept","application/json");var G=function(ie,Pe,Re){if(!z){if(ie&&ie.message!=="SecurityError"&&et(ie),Pe&&Re)return q(Pe);var k=Date.now();ye.fetch(I).then(function(Ze){if(Ze.ok){var at=U?Ze.clone():null;return q(Ze,at,k)}return y(new Bi(Ze.statusText,Ze.status,p.url))}).catch(function(Ze){Ze.code!==20&&y(new Error(Ze.message))})}},q=function(ie,Pe,Re){(p.type==="arrayBuffer"?ie.arrayBuffer():p.type==="json"?ie.json():ie.text()).then(function(k){z||(Pe&&Re&&function(Ze,at,Ct){if(sn(),$i){var zt={status:at.status,statusText:at.statusText,headers:new ye.Headers};at.headers.forEach(function(sr,Pr){return zt.headers.set(Pr,sr)});var Vt=$r(at.headers.get("Cache-Control")||"");Vt["no-store"]||(Vt["max-age"]&&zt.headers.set("Expires",new Date(Ct+1e3*Vt["max-age"]).toUTCString()),new Date(zt.headers.get("Expires")).getTime()-Ct<42e4||function(sr,Pr){if(is===void 0)try{new Response(new ReadableStream),is=!0}catch(Br){is=!1}is?Pr(sr.body):sr.blob().then(Pr)}(at,function(sr){var Pr=new ye.Response(sr,zt);sn(),$i&&$i.then(function(Br){return Br.put(On(Ze.url),Pr)}).catch(function(Br){return et(Br.message)})}))}}(I,Pe,Re),D=!0,y(null,k,ie.headers.get("Cache-Control"),ie.headers.get("Expires")))}).catch(function(k){z||y(new Error(k.message))})};return U?function(ie,Pe){if(sn(),!$i)return Pe(null);var Re=On(ie.url);$i.then(function(k){k.match(Re).then(function(Ze){var at=function(Ct){if(!Ct)return!1;var zt=new Date(Ct.headers.get("Expires")||0),Vt=$r(Ct.headers.get("Cache-Control")||"");return zt>Date.now()&&!Vt["no-cache"]}(Ze);k.delete(Re),at&&k.put(Re,Ze.clone()),Pe(null,Ze,at)}).catch(Pe)}).catch(Pe)}(I,G):G(null,null),{cancel:function(){z=!0,D||C.abort()}}}(t,o);if(kr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,o,void 0,!0)}var u;return function(p,y){var b=new ye.XMLHttpRequest;for(var C in b.open(p.method||"GET",p.url,!0),p.type==="arrayBuffer"&&(b.responseType="arraybuffer"),p.headers)b.setRequestHeader(C,p.headers[C]);return p.type==="json"&&(b.responseType="text",b.setRequestHeader("Accept","application/json")),b.withCredentials=p.credentials==="include",b.onerror=function(){y(new Error(b.statusText))},b.onload=function(){if((b.status>=200&&b.status<300||b.status===0)&&b.response!==null){var I=b.response;if(p.type==="json")try{I=JSON.parse(b.response)}catch(D){return y(D)}y(null,I,b.getResponseHeader("Cache-Control"),b.getResponseHeader("Expires"))}else y(new Bi(b.statusText,b.status,p.url))},b.send(p.body),{cancel:function(){return b.abort()}}}(t,o)},Na=function(t,o){return Uo(Mt(t,{type:"arrayBuffer"}),o)},xa=function(t,o){return Uo(Mt(t,{method:"POST"}),o)},V="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";io=[],ys=0;var Q=function(t,o){if(Dn.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),ys>=an.MAX_PARALLEL_IMAGE_REQUESTS){var u={requestParameters:t,callback:o,cancelled:!1,cancel:function(){this.cancelled=!0}};return io.push(u),u}ys++;var p=!1,y=function(){if(!p)for(p=!0,ys--;io.length&&ys<an.MAX_PARALLEL_IMAGE_REQUESTS;){var C=io.shift();C.cancelled||(C.cancel=Q(C.requestParameters,C.callback).cancel)}},b=Na(t,function(C,I,D,z){y(),C?o(C):I&&(vi()?function(U,G){var q=new ye.Blob([new Uint8Array(U)],{type:"image/png"});ye.createImageBitmap(q).then(function(ie){G(null,ie)}).catch(function(ie){G(new Error("Could not load image because of "+ie.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(I,o):function(U,G,q,ie){var Pe=new ye.Image,Re=ye.URL;Pe.onload=function(){G(null,Pe),Re.revokeObjectURL(Pe.src),Pe.onload=null,ye.requestAnimationFrame(function(){Pe.src=V})},Pe.onerror=function(){return G(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var k=new ye.Blob([new Uint8Array(U)],{type:"image/png"});Pe.cacheControl=q,Pe.expires=ie,Pe.src=U.byteLength?Re.createObjectURL(k):V}(I,o,D,z))});return{cancel:function(){b.cancel(),y()}}};function ne(t,o,u){u[t]&&u[t].indexOf(o)!==-1||(u[t]=u[t]||[],u[t].push(o))}function ge(t,o,u){if(u&&u[t]){var p=u[t].indexOf(o);p!==-1&&u[t].splice(p,1)}}var Ie=function(t,o){o===void 0&&(o={}),Mt(this,o),this.type=t},Ge=function(t){function o(u,p){p===void 0&&(p={}),t.call(this,"error",Mt({error:u},p))}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Ie),tt=function(){};tt.prototype.on=function(t,o){return this._listeners=this._listeners||{},ne(t,o,this._listeners),this},tt.prototype.off=function(t,o){return ge(t,o,this._listeners),ge(t,o,this._oneTimeListeners),this},tt.prototype.once=function(t,o){return this._oneTimeListeners=this._oneTimeListeners||{},ne(t,o,this._oneTimeListeners),this},tt.prototype.fire=function(t,o){typeof t=="string"&&(t=new Ie(t,o||{}));var u=t.type;if(this.listens(u)){t.target=this;for(var p=0,y=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];p<y.length;p+=1)y[p].call(this,t);for(var b=0,C=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];b<C.length;b+=1){var I=C[b];ge(u,I,this._oneTimeListeners),I.call(this,t)}var D=this._eventedParent;D&&(Mt(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),D.fire(t))}else t instanceof Ge&&console.error(t.error);return this},tt.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},tt.prototype.setEventedParent=function(t,o){return this._eventedParent=t,this._eventedParentData=o,this};var ce={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Le=function(t,o,u,p){this.message=(t?t+": ":"")+u,p&&(this.identifier=p),o!=null&&o.__line__&&(this.line=o.__line__)};function mt(t){var o=t.value;return o?[new Le(t.key,o,"constants have been deprecated as of v8")]:[]}function pr(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];for(var p=0,y=o;p<y.length;p+=1){var b=y[p];for(var C in b)t[C]=b[C]}return t}function Lt(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Ft(t){if(Array.isArray(t))return t.map(Ft);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var o={};for(var u in t)o[u]=Ft(t[u]);return o}return Lt(t)}var dr=function(t){function o(u,p){t.call(this,p),this.message=p,this.key=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Error),bn=function(t,o){o===void 0&&(o=[]),this.parent=t,this.bindings={};for(var u=0,p=o;u<p.length;u+=1){var y=p[u];this.bindings[y[0]]=y[1]}};bn.prototype.concat=function(t){return new bn(this,t)},bn.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},bn.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var pn={kind:"null"},Pt={kind:"number"},en={kind:"string"},zr={kind:"boolean"},Xr={kind:"color"},mi={kind:"object"},tn={kind:"value"},mn={kind:"collator"},Xi={kind:"formatted"},hi={kind:"resolvedImage"};function Pi(t,o){return{kind:"array",itemType:t,N:o}}function _i(t){if(t.kind==="array"){var o=_i(t.itemType);return typeof t.N=="number"?"array<"+o+", "+t.N+">":t.itemType.kind==="value"?"array":"array<"+o+">"}return t.kind}var dt=[pn,Pt,en,zr,Xr,Xi,mi,Pi(tn),hi];function It(t,o){if(o.kind==="error")return null;if(t.kind==="array"){if(o.kind==="array"&&(o.N===0&&o.itemType.kind==="value"||!It(t.itemType,o.itemType))&&(typeof t.N!="number"||t.N===o.N))return null}else{if(t.kind===o.kind)return null;if(t.kind==="value"){for(var u=0,p=dt;u<p.length;u+=1)if(!It(p[u],o))return null}}return"Expected "+_i(t)+" but found "+_i(o)+" instead."}function Ta(t,o){return o.some(function(u){return u.kind===t.kind})}function Si(t,o){return o.some(function(u){return u==="null"?t===null:u==="array"?Array.isArray(t):u==="object"?t&&!Array.isArray(t)&&typeof t=="object":u===typeof t})}var Ii=Ee(function(t,o){var u={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function p(I){return(I=Math.round(I))<0?0:I>255?255:I}function y(I){return p(I[I.length-1]==="%"?parseFloat(I)/100*255:parseInt(I))}function b(I){return(D=I[I.length-1]==="%"?parseFloat(I)/100:parseFloat(I))<0?0:D>1?1:D;var D}function C(I,D,z){return z<0?z+=1:z>1&&(z-=1),6*z<1?I+(D-I)*z*6:2*z<1?D:3*z<2?I+(D-I)*(2/3-z)*6:I}try{o.parseCSSColor=function(I){var D,z=I.replace(/ /g,"").toLowerCase();if(z in u)return u[z].slice();if(z[0]==="#")return z.length===4?(D=parseInt(z.substr(1),16))>=0&&D<=4095?[(3840&D)>>4|(3840&D)>>8,240&D|(240&D)>>4,15&D|(15&D)<<4,1]:null:z.length===7&&(D=parseInt(z.substr(1),16))>=0&&D<=16777215?[(16711680&D)>>16,(65280&D)>>8,255&D,1]:null;var U=z.indexOf("("),G=z.indexOf(")");if(U!==-1&&G+1===z.length){var q=z.substr(0,U),ie=z.substr(U+1,G-(U+1)).split(","),Pe=1;switch(q){case"rgba":if(ie.length!==4)return null;Pe=b(ie.pop());case"rgb":return ie.length!==3?null:[y(ie[0]),y(ie[1]),y(ie[2]),Pe];case"hsla":if(ie.length!==4)return null;Pe=b(ie.pop());case"hsl":if(ie.length!==3)return null;var Re=(parseFloat(ie[0])%360+360)%360/360,k=b(ie[1]),Ze=b(ie[2]),at=Ze<=.5?Ze*(k+1):Ze+k-Ze*k,Ct=2*Ze-at;return[p(255*C(Ct,at,Re+1/3)),p(255*C(Ct,at,Re)),p(255*C(Ct,at,Re-1/3)),Pe];default:return null}}return null}}catch(I){}}).parseCSSColor,ji=function(t,o,u,p){p===void 0&&(p=1),this.r=t,this.g=o,this.b=u,this.a=p};ji.parse=function(t){if(t){if(t instanceof ji)return t;if(typeof t=="string"){var o=Ii(t);if(o)return new ji(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3])}}},ji.prototype.toString=function(){var t=this.toArray(),o=t[1],u=t[2],p=t[3];return"rgba("+Math.round(t[0])+","+Math.round(o)+","+Math.round(u)+","+p+")"},ji.prototype.toArray=function(){var t=this.a;return t===0?[0,0,0,0]:[255*this.r/t,255*this.g/t,255*this.b/t,t]},ji.black=new ji(0,0,0,1),ji.white=new ji(1,1,1,1),ji.transparent=new ji(0,0,0,0),ji.red=new ji(1,0,0,1);var Ir=function(t,o,u){this.sensitivity=t?o?"variant":"case":o?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Ir.prototype.compare=function(t,o){return this.collator.compare(t,o)},Ir.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var un=function(t,o,u,p,y){this.text=t,this.image=o,this.scale=u,this.fontStack=p,this.textColor=y},_t=function(t){this.sections=t};_t.fromString=function(t){return new _t([new un(t,null,null,null,null)])},_t.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(t){return t.text.length!==0||t.image&&t.image.name.length!==0})},_t.factory=function(t){return t instanceof _t?t:_t.fromString(t)},_t.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(t){return t.text}).join("")},_t.prototype.serialize=function(){for(var t=["format"],o=0,u=this.sections;o<u.length;o+=1){var p=u[o];if(p.image)t.push(["image",p.image.name]);else{t.push(p.text);var y={};p.fontStack&&(y["text-font"]=["literal",p.fontStack.split(",")]),p.scale&&(y["font-scale"]=p.scale),p.textColor&&(y["text-color"]=["rgba"].concat(p.textColor.toArray())),t.push(y)}}return t};var aa=function(t){this.name=t.name,this.available=t.available};function J(t,o,u,p){return typeof t=="number"&&t>=0&&t<=255&&typeof o=="number"&&o>=0&&o<=255&&typeof u=="number"&&u>=0&&u<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:"Invalid rgba value ["+[t,o,u,p].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof p=="number"?[t,o,u,p]:[t,o,u]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Ko(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof ji||t instanceof Ir||t instanceof _t||t instanceof aa)return!0;if(Array.isArray(t)){for(var o=0,u=t;o<u.length;o+=1)if(!Ko(u[o]))return!1;return!0}if(typeof t=="object"){for(var p in t)if(!Ko(t[p]))return!1;return!0}return!1}function na(t){if(t===null)return pn;if(typeof t=="string")return en;if(typeof t=="boolean")return zr;if(typeof t=="number")return Pt;if(t instanceof ji)return Xr;if(t instanceof Ir)return mn;if(t instanceof _t)return Xi;if(t instanceof aa)return hi;if(Array.isArray(t)){for(var o,u=t.length,p=0,y=t;p<y.length;p+=1){var b=na(y[p]);if(o){if(o===b)continue;o=tn;break}o=b}return Pi(o||tn,u)}return mi}function bu(t){var o=typeof t;return t===null?"":o==="string"||o==="number"||o==="boolean"?String(t):t instanceof ji||t instanceof _t||t instanceof aa?t.toString():JSON.stringify(t)}aa.prototype.toString=function(){return this.name},aa.fromString=function(t){return t?new aa({name:t,available:!1}):null},aa.prototype.serialize=function(){return["image",this.name]};var za=function(t,o){this.type=t,this.value=o};za.parse=function(t,o){if(t.length!==2)return o.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!Ko(t[1]))return o.error("invalid value");var u=t[1],p=na(u),y=o.expectedType;return p.kind!=="array"||p.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(p=y),new za(p,u)},za.prototype.evaluate=function(){return this.value},za.prototype.eachChild=function(){},za.prototype.outputDefined=function(){return!0},za.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof ji?["rgba"].concat(this.value.toArray()):this.value instanceof _t?this.value.serialize():this.value};var Ma=function(t){this.name="ExpressionEvaluationError",this.message=t};Ma.prototype.toJSON=function(){return this.message};var qa={string:en,number:Pt,boolean:zr,object:mi},oa=function(t,o){this.type=t,this.args=o};oa.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u,p=1,y=t[0];if(y==="array"){var b,C;if(t.length>2){var I=t[1];if(typeof I!="string"||!(I in qa)||I==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);b=qa[I],p++}else b=tn;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return o.error('The length argument to "array" must be a positive integer literal',2);C=t[2],p++}u=Pi(b,C)}else u=qa[y];for(var D=[];p<t.length;p++){var z=o.parse(t[p],p,tn);if(!z)return null;D.push(z)}return new oa(u,D)},oa.prototype.evaluate=function(t){for(var o=0;o<this.args.length;o++){var u=this.args[o].evaluate(t);if(!It(this.type,na(u)))return u;if(o===this.args.length-1)throw new Ma("Expected value to be of type "+_i(this.type)+", but found "+_i(na(u))+" instead.")}return null},oa.prototype.eachChild=function(t){this.args.forEach(t)},oa.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},oa.prototype.serialize=function(){var t=this.type,o=[t.kind];if(t.kind==="array"){var u=t.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){o.push(u.kind);var p=t.N;(typeof p=="number"||this.args.length>1)&&o.push(p)}}return o.concat(this.args.map(function(y){return y.serialize()}))};var Ao=function(t){this.type=Xi,this.sections=t};Ao.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u=t[1];if(!Array.isArray(u)&&typeof u=="object")return o.error("First argument must be an image or text section.");for(var p=[],y=!1,b=1;b<=t.length-1;++b){var C=t[b];if(y&&typeof C=="object"&&!Array.isArray(C)){y=!1;var I=null;if(C["font-scale"]&&!(I=o.parse(C["font-scale"],1,Pt)))return null;var D=null;if(C["text-font"]&&!(D=o.parse(C["text-font"],1,Pi(en))))return null;var z=null;if(C["text-color"]&&!(z=o.parse(C["text-color"],1,Xr)))return null;var U=p[p.length-1];U.scale=I,U.font=D,U.textColor=z}else{var G=o.parse(t[b],1,tn);if(!G)return null;var q=G.type.kind;if(q!=="string"&&q!=="value"&&q!=="null"&&q!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,p.push({content:G,scale:null,font:null,textColor:null})}}return new Ao(p)},Ao.prototype.evaluate=function(t){return new _t(this.sections.map(function(o){var u=o.content.evaluate(t);return na(u)===hi?new un("",u,null,null,null):new un(bu(u),null,o.scale?o.scale.evaluate(t):null,o.font?o.font.evaluate(t).join(","):null,o.textColor?o.textColor.evaluate(t):null)}))},Ao.prototype.eachChild=function(t){for(var o=0,u=this.sections;o<u.length;o+=1){var p=u[o];t(p.content),p.scale&&t(p.scale),p.font&&t(p.font),p.textColor&&t(p.textColor)}},Ao.prototype.outputDefined=function(){return!1},Ao.prototype.serialize=function(){for(var t=["format"],o=0,u=this.sections;o<u.length;o+=1){var p=u[o];t.push(p.content.serialize());var y={};p.scale&&(y["font-scale"]=p.scale.serialize()),p.font&&(y["text-font"]=p.font.serialize()),p.textColor&&(y["text-color"]=p.textColor.serialize()),t.push(y)}return t};var jo=function(t){this.type=hi,this.input=t};jo.parse=function(t,o){if(t.length!==2)return o.error("Expected two arguments.");var u=o.parse(t[1],1,en);return u?new jo(u):o.error("No image name provided.")},jo.prototype.evaluate=function(t){var o=this.input.evaluate(t),u=aa.fromString(o);return u&&t.availableImages&&(u.available=t.availableImages.indexOf(o)>-1),u},jo.prototype.eachChild=function(t){t(this.input)},jo.prototype.outputDefined=function(){return!1},jo.prototype.serialize=function(){return["image",this.input.serialize()]};var wu={"to-boolean":zr,"to-color":Xr,"to-number":Pt,"to-string":en},vo=function(t,o){this.type=t,this.args=o};vo.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u=t[0];if((u==="to-boolean"||u==="to-string")&&t.length!==2)return o.error("Expected one argument.");for(var p=wu[u],y=[],b=1;b<t.length;b++){var C=o.parse(t[b],b,tn);if(!C)return null;y.push(C)}return new vo(p,y)},vo.prototype.evaluate=function(t){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(t));if(this.type.kind==="color"){for(var o,u,p=0,y=this.args;p<y.length;p+=1){if(u=null,(o=y[p].evaluate(t))instanceof ji)return o;if(typeof o=="string"){var b=t.parseColor(o);if(b)return b}else if(Array.isArray(o)&&!(u=o.length<3||o.length>4?"Invalid rbga value "+JSON.stringify(o)+": expected an array containing either three or four numeric values.":J(o[0],o[1],o[2],o[3])))return new ji(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new Ma(u||"Could not parse color from value '"+(typeof o=="string"?o:String(JSON.stringify(o)))+"'")}if(this.type.kind==="number"){for(var C=null,I=0,D=this.args;I<D.length;I+=1){if((C=D[I].evaluate(t))===null)return 0;var z=Number(C);if(!isNaN(z))return z}throw new Ma("Could not convert "+JSON.stringify(C)+" to number.")}return this.type.kind==="formatted"?_t.fromString(bu(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?aa.fromString(bu(this.args[0].evaluate(t))):bu(this.args[0].evaluate(t))},vo.prototype.eachChild=function(t){this.args.forEach(t)},vo.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},vo.prototype.serialize=function(){if(this.type.kind==="formatted")return new Ao([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new jo(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild(function(o){t.push(o.serialize())}),t};var Do=["Unknown","Point","LineString","Polygon"],sa=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};sa.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},sa.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Do[this.feature.type]:this.feature.type:null},sa.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},sa.prototype.canonicalID=function(){return this.canonical},sa.prototype.properties=function(){return this.feature&&this.feature.properties||{}},sa.prototype.parseColor=function(t){var o=this._parseColorCache[t];return o||(o=this._parseColorCache[t]=ji.parse(t)),o};var Ka=function(t,o,u,p){this.name=t,this.type=o,this._evaluate=u,this.args=p};Ka.prototype.evaluate=function(t){return this._evaluate(t,this.args)},Ka.prototype.eachChild=function(t){this.args.forEach(t)},Ka.prototype.outputDefined=function(){return!1},Ka.prototype.serialize=function(){return[this.name].concat(this.args.map(function(t){return t.serialize()}))},Ka.parse=function(t,o){var u,p=t[0],y=Ka.definitions[p];if(!y)return o.error('Unknown expression "'+p+'". If you wanted a literal array, use ["literal", [...]].',0);for(var b=Array.isArray(y)?y[0]:y.type,C=Array.isArray(y)?[[y[1],y[2]]]:y.overloads,I=C.filter(function(Wn){var dn=Wn[0];return!Array.isArray(dn)||dn.length===t.length-1}),D=null,z=0,U=I;z<U.length;z+=1){var G=U[z],q=G[0],ie=G[1];D=new Fs(o.registry,o.path,null,o.scope);for(var Pe=[],Re=!1,k=1;k<t.length;k++){var Ze=t[k],at=Array.isArray(q)?q[k-1]:q.type,Ct=D.parse(Ze,1+Pe.length,at);if(!Ct){Re=!0;break}Pe.push(Ct)}if(!Re)if(Array.isArray(q)&&q.length!==Pe.length)D.error("Expected "+q.length+" arguments, but found "+Pe.length+" instead.");else{for(var zt=0;zt<Pe.length;zt++){var Vt=Array.isArray(q)?q[zt]:q.type,sr=Pe[zt];D.concat(zt+1).checkSubtype(Vt,sr.type)}if(D.errors.length===0)return new Ka(p,b,ie,Pe)}}if(I.length===1)(u=o.errors).push.apply(u,D.errors);else{for(var Pr=(I.length?I:C).map(function(Wn){var dn;return dn=Wn[0],Array.isArray(dn)?"("+dn.map(_i).join(", ")+")":"("+_i(dn.type)+"...)"}).join(" | "),Br=[],zn=1;zn<t.length;zn++){var hn=o.parse(t[zn],1+Br.length);if(!hn)return null;Br.push(_i(hn.type))}o.error("Expected arguments of type "+Pr+", but found ("+Br.join(", ")+") instead.")}return null},Ka.register=function(t,o){for(var u in Ka.definitions=o,o)t[u]=Ka};var Fo=function(t,o,u){this.type=mn,this.locale=u,this.caseSensitive=t,this.diacriticSensitive=o};function $a(t,o){t[0]=Math.min(t[0],o[0]),t[1]=Math.min(t[1],o[1]),t[2]=Math.max(t[2],o[0]),t[3]=Math.max(t[3],o[1])}function Ms(t,o){return!(t[0]<=o[0]||t[2]>=o[2]||t[1]<=o[1]||t[3]>=o[3])}function Il(t,o){var u=(180+t[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,y=Math.pow(2,o.z);return[Math.round(u*y*8192),Math.round(p*y*8192)]}function _s(t,o,u){return o[1]>t[1]!=u[1]>t[1]&&t[0]<(u[0]-o[0])*(t[1]-o[1])/(u[1]-o[1])+o[0]}function re(t,o){for(var u,p,y,b,C,I,D,z=!1,U=0,G=o.length;U<G;U++)for(var q=o[U],ie=0,Pe=q.length;ie<Pe-1;ie++){if((b=(u=t)[0]-(p=q[ie])[0])*(D=u[1]-(y=q[ie+1])[1])-(I=u[0]-y[0])*(C=u[1]-p[1])==0&&b*I<=0&&C*D<=0)return!1;_s(t,q[ie],q[ie+1])&&(z=!z)}return z}function Se(t,o){for(var u=0;u<o.length;u++)if(re(t,o[u]))return!0;return!1}function Ye(t,o,u,p){var y=p[0]-u[0],b=p[1]-u[1],C=(t[0]-u[0])*b-y*(t[1]-u[1]),I=(o[0]-u[0])*b-y*(o[1]-u[1]);return C>0&&I<0||C<0&&I>0}function Rt(t,o,u){for(var p=0,y=u;p<y.length;p+=1)for(var b=y[p],C=0;C<b.length-1;++C)if((G=[(U=b[C+1])[0]-(z=b[C])[0],U[1]-z[1]])[0]*(q=[(D=o)[0]-(I=t)[0],D[1]-I[1]])[1]-G[1]*q[0]!=0&&Ye(I,D,z,U)&&Ye(z,U,I,D))return!0;var I,D,z,U,G,q;return!1}function Or(t,o){for(var u=0;u<t.length;++u)if(!re(t[u],o))return!1;for(var p=0;p<t.length-1;++p)if(Rt(t[p],t[p+1],o))return!1;return!0}function kn(t,o){for(var u=0;u<o.length;u++)if(Or(t,o[u]))return!0;return!1}function Oi(t,o,u){for(var p=[],y=0;y<t.length;y++){for(var b=[],C=0;C<t[y].length;C++){var I=Il(t[y][C],u);$a(o,I),b.push(I)}p.push(b)}return p}function ao(t,o,u){for(var p=[],y=0;y<t.length;y++){var b=Oi(t[y],o,u);p.push(b)}return p}function Ra(t,o,u,p){if(t[0]<u[0]||t[0]>u[2]){var y=.5*p,b=t[0]-u[0]>y?-p:u[0]-t[0]>y?p:0;b===0&&(b=t[0]-u[2]>y?-p:u[2]-t[0]>y?p:0),t[0]+=b}$a(o,t)}function Za(t,o,u,p){for(var y=8192*Math.pow(2,p.z),b=[8192*p.x,8192*p.y],C=[],I=0,D=t;I<D.length;I+=1)for(var z=0,U=D[I];z<U.length;z+=1){var G=U[z],q=[G.x+b[0],G.y+b[1]];Ra(q,o,u,y),C.push(q)}return C}function Vo(t,o,u,p){for(var y,b=8192*Math.pow(2,p.z),C=[8192*p.x,8192*p.y],I=[],D=0,z=t;D<z.length;D+=1){for(var U=[],G=0,q=z[D];G<q.length;G+=1){var ie=q[G],Pe=[ie.x+C[0],ie.y+C[1]];$a(o,Pe),U.push(Pe)}I.push(U)}if(o[2]-o[0]<=b/2){(y=o)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(var Re=0,k=I;Re<k.length;Re+=1)for(var Ze=0,at=k[Re];Ze<at.length;Ze+=1)Ra(at[Ze],o,u,b)}return I}Fo.parse=function(t,o){if(t.length!==2)return o.error("Expected one argument.");var u=t[1];if(typeof u!="object"||Array.isArray(u))return o.error("Collator options argument must be an object.");var p=o.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,zr);if(!p)return null;var y=o.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,zr);if(!y)return null;var b=null;return u.locale&&!(b=o.parse(u.locale,1,en))?null:new Fo(p,y,b)},Fo.prototype.evaluate=function(t){return new Ir(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},Fo.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},Fo.prototype.outputDefined=function(){return!1},Fo.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var xs=function(t,o){this.type=zr,this.geojson=t,this.geometries=o};function uo(t){if(t instanceof Ka&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof xs)return!1;var o=!0;return t.eachChild(function(u){o&&!uo(u)&&(o=!1)}),o}function wo(t){if(t instanceof Ka&&t.name==="feature-state")return!1;var o=!0;return t.eachChild(function(u){o&&!wo(u)&&(o=!1)}),o}function bs(t,o){if(t instanceof Ka&&o.indexOf(t.name)>=0)return!1;var u=!0;return t.eachChild(function(p){u&&!bs(p,o)&&(u=!1)}),u}xs.parse=function(t,o){if(t.length!==2)return o.error("'within' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(Ko(t[1])){var u=t[1];if(u.type==="FeatureCollection")for(var p=0;p<u.features.length;++p){var y=u.features[p].geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new xs(u,u.features[p].geometry)}else if(u.type==="Feature"){var b=u.geometry.type;if(b==="Polygon"||b==="MultiPolygon")return new xs(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new xs(u,u)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")},xs.prototype.evaluate=function(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(o,u){var p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=o.canonicalID();if(u.type==="Polygon"){var C=Oi(u.coordinates,y,b),I=Za(o.geometry(),p,y,b);if(!Ms(p,y))return!1;for(var D=0,z=I;D<z.length;D+=1)if(!re(z[D],C))return!1}if(u.type==="MultiPolygon"){var U=ao(u.coordinates,y,b),G=Za(o.geometry(),p,y,b);if(!Ms(p,y))return!1;for(var q=0,ie=G;q<ie.length;q+=1)if(!Se(ie[q],U))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(o,u){var p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=o.canonicalID();if(u.type==="Polygon"){var C=Oi(u.coordinates,y,b),I=Vo(o.geometry(),p,y,b);if(!Ms(p,y))return!1;for(var D=0,z=I;D<z.length;D+=1)if(!Or(z[D],C))return!1}if(u.type==="MultiPolygon"){var U=ao(u.coordinates,y,b),G=Vo(o.geometry(),p,y,b);if(!Ms(p,y))return!1;for(var q=0,ie=G;q<ie.length;q+=1)if(!kn(ie[q],U))return!1}return!0}(t,this.geometries)}return!1},xs.prototype.eachChild=function(){},xs.prototype.outputDefined=function(){return!0},xs.prototype.serialize=function(){return["within",this.geojson]};var Ps=function(t,o){this.type=o.type,this.name=t,this.boundExpression=o};Ps.parse=function(t,o){if(t.length!==2||typeof t[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");var u=t[1];return o.scope.has(u)?new Ps(u,o.scope.get(u)):o.error('Unknown variable "'+u+'". Make sure "'+u+'" has been bound in an enclosing "let" expression before using it.',1)},Ps.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},Ps.prototype.eachChild=function(){},Ps.prototype.outputDefined=function(){return!1},Ps.prototype.serialize=function(){return["var",this.name]};var Fs=function(t,o,u,p,y){o===void 0&&(o=[]),p===void 0&&(p=new bn),y===void 0&&(y=[]),this.registry=t,this.path=o,this.key=o.map(function(b){return"["+b+"]"}).join(""),this.scope=p,this.errors=y,this.expectedType=u};function fu(t,o){for(var u,p=t.length-1,y=0,b=p,C=0;y<=b;)if((u=t[C=Math.floor((y+b)/2)])<=o){if(C===p||o<t[C+1])return C;y=C+1}else{if(!(u>o))throw new Ma("Input is not a number.");b=C-1}return 0}Fs.prototype.parse=function(t,o,u,p,y){return y===void 0&&(y={}),o?this.concat(o,u,p)._parse(t,y):this._parse(t,y)},Fs.prototype._parse=function(t,o){function u(z,U,G){return G==="assert"?new oa(U,[z]):G==="coerce"?new vo(U,[z]):z}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var p=t[0];if(typeof p!="string")return this.error("Expression name must be a string, but found "+typeof p+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var y=this.registry[p];if(y){var b=y.parse(t,this);if(!b)return null;if(this.expectedType){var C=this.expectedType,I=b.type;if(C.kind!=="string"&&C.kind!=="number"&&C.kind!=="boolean"&&C.kind!=="object"&&C.kind!=="array"||I.kind!=="value")if(C.kind!=="color"&&C.kind!=="formatted"&&C.kind!=="resolvedImage"||I.kind!=="value"&&I.kind!=="string"){if(this.checkSubtype(C,I))return null}else b=u(b,C,o.typeAnnotation||"coerce");else b=u(b,C,o.typeAnnotation||"assert")}if(!(b instanceof za)&&b.type.kind!=="resolvedImage"&&function z(U){if(U instanceof Ps)return z(U.boundExpression);if(U instanceof Ka&&U.name==="error"||U instanceof Fo||U instanceof xs)return!1;var G=U instanceof vo||U instanceof oa,q=!0;return U.eachChild(function(ie){q=G?q&&z(ie):q&&ie instanceof za}),!!q&&uo(U)&&bs(U,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(b)){var D=new sa;try{b=new za(b.type,b.evaluate(D))}catch(z){return this.error(z.message),null}}return b}return this.error('Unknown expression "'+p+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof t+" instead.")},Fs.prototype.concat=function(t,o,u){var p=typeof t=="number"?this.path.concat(t):this.path,y=u?this.scope.concat(u):this.scope;return new Fs(this.registry,p,o||null,y,this.errors)},Fs.prototype.error=function(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];var p=""+this.key+o.map(function(y){return"["+y+"]"}).join("");this.errors.push(new dr(p,t))},Fs.prototype.checkSubtype=function(t,o){var u=It(t,o);return u&&this.error(u),u};var Es=function(t,o,u){this.type=t,this.input=o,this.labels=[],this.outputs=[];for(var p=0,y=u;p<y.length;p+=1){var b=y[p],C=b[1];this.labels.push(b[0]),this.outputs.push(C)}};function ma(t,o,u){return t*(1-u)+o*u}Es.parse=function(t,o){if(t.length-1<4)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");var u=o.parse(t[1],1,Pt);if(!u)return null;var p=[],y=null;o.expectedType&&o.expectedType.kind!=="value"&&(y=o.expectedType);for(var b=1;b<t.length;b+=2){var C=b===1?-1/0:t[b],I=t[b+1],D=b,z=b+1;if(typeof C!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(p.length&&p[p.length-1][0]>=C)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);var U=o.parse(I,z,y);if(!U)return null;y=y||U.type,p.push([C,U])}return new Es(y,u,p)},Es.prototype.evaluate=function(t){var o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(t);var p=this.input.evaluate(t);if(p<=o[0])return u[0].evaluate(t);var y=o.length;return p>=o[y-1]?u[y-1].evaluate(t):u[fu(o,p)].evaluate(t)},Es.prototype.eachChild=function(t){t(this.input);for(var o=0,u=this.outputs;o<u.length;o+=1)t(u[o])},Es.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},Es.prototype.serialize=function(){for(var t=["step",this.input.serialize()],o=0;o<this.labels.length;o++)o>0&&t.push(this.labels[o]),t.push(this.outputs[o].serialize());return t};var _a=Object.freeze({__proto__:null,number:ma,color:function(t,o,u){return new ji(ma(t.r,o.r,u),ma(t.g,o.g,u),ma(t.b,o.b,u),ma(t.a,o.a,u))},array:function(t,o,u){return t.map(function(p,y){return ma(p,o[y],u)})}}),as=6/29*3*(6/29),mf=Math.PI/180,Ol=180/Math.PI;function qs(t){return t>.008856451679035631?Math.pow(t,1/3):t/as+4/29}function ac(t){return t>6/29?t*t*t:as*(t-4/29)}function Yu(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Ks(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function ul(t){var o=Ks(t.r),u=Ks(t.g),p=Ks(t.b),y=qs((.4124564*o+.3575761*u+.1804375*p)/.95047),b=qs((.2126729*o+.7151522*u+.072175*p)/1);return{l:116*b-16,a:500*(y-b),b:200*(b-qs((.0193339*o+.119192*u+.9503041*p)/1.08883)),alpha:t.a}}function _(t){var o=(t.l+16)/116,u=isNaN(t.a)?o:o+t.a/500,p=isNaN(t.b)?o:o-t.b/200;return o=1*ac(o),u=.95047*ac(u),p=1.08883*ac(p),new ji(Yu(3.2404542*u-1.5371385*o-.4985314*p),Yu(-.969266*u+1.8760108*o+.041556*p),Yu(.0556434*u-.2040259*o+1.0572252*p),t.alpha)}function M(t,o,u){var p=o-t;return t+u*(p>180||p<-180?p-360*Math.round(p/360):p)}var B={forward:ul,reverse:_,interpolate:function(t,o,u){return{l:ma(t.l,o.l,u),a:ma(t.a,o.a,u),b:ma(t.b,o.b,u),alpha:ma(t.alpha,o.alpha,u)}}},R={forward:function(t){var o=ul(t),u=o.l,p=o.a,y=o.b,b=Math.atan2(y,p)*Ol;return{h:b<0?b+360:b,c:Math.sqrt(p*p+y*y),l:u,alpha:t.a}},reverse:function(t){var o=t.h*mf,u=t.c;return _({l:t.l,a:Math.cos(o)*u,b:Math.sin(o)*u,alpha:t.alpha})},interpolate:function(t,o,u){return{h:M(t.h,o.h,u),c:ma(t.c,o.c,u),l:ma(t.l,o.l,u),alpha:ma(t.alpha,o.alpha,u)}}},$=Object.freeze({__proto__:null,lab:B,hcl:R}),be=function(t,o,u,p,y){this.type=t,this.operator=o,this.interpolation=u,this.input=p,this.labels=[],this.outputs=[];for(var b=0,C=y;b<C.length;b+=1){var I=C[b],D=I[1];this.labels.push(I[0]),this.outputs.push(D)}};function We(t,o,u,p){var y=p-u,b=t-u;return y===0?0:o===1?b/y:(Math.pow(o,b)-1)/(Math.pow(o,y)-1)}be.interpolationFactor=function(t,o,u,p){var y=0;if(t.name==="exponential")y=We(o,t.base,u,p);else if(t.name==="linear")y=We(o,1,u,p);else if(t.name==="cubic-bezier"){var b=t.controlPoints;y=new H(b[0],b[1],b[2],b[3]).solve(We(o,1,u,p))}return y},be.parse=function(t,o){var u=t[0],p=t[1],y=t[2],b=t.slice(3);if(!Array.isArray(p)||p.length===0)return o.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){var C=p[1];if(typeof C!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:C}}else{if(p[0]!=="cubic-bezier")return o.error("Unknown interpolation type "+String(p[0]),1,0);var I=p.slice(1);if(I.length!==4||I.some(function(k){return typeof k!="number"||k<0||k>1}))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:I}}if(t.length-1<4)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(!(y=o.parse(y,2,Pt)))return null;var D=[],z=null;u==="interpolate-hcl"||u==="interpolate-lab"?z=Xr:o.expectedType&&o.expectedType.kind!=="value"&&(z=o.expectedType);for(var U=0;U<b.length;U+=2){var G=b[U],q=b[U+1],ie=U+3,Pe=U+4;if(typeof G!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ie);if(D.length&&D[D.length-1][0]>=G)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ie);var Re=o.parse(q,Pe,z);if(!Re)return null;z=z||Re.type,D.push([G,Re])}return z.kind==="number"||z.kind==="color"||z.kind==="array"&&z.itemType.kind==="number"&&typeof z.N=="number"?new be(z,u,p,y,D):o.error("Type "+_i(z)+" is not interpolatable.")},be.prototype.evaluate=function(t){var o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(t);var p=this.input.evaluate(t);if(p<=o[0])return u[0].evaluate(t);var y=o.length;if(p>=o[y-1])return u[y-1].evaluate(t);var b=fu(o,p),C=be.interpolationFactor(this.interpolation,p,o[b],o[b+1]),I=u[b].evaluate(t),D=u[b+1].evaluate(t);return this.operator==="interpolate"?_a[this.type.kind.toLowerCase()](I,D,C):this.operator==="interpolate-hcl"?R.reverse(R.interpolate(R.forward(I),R.forward(D),C)):B.reverse(B.interpolate(B.forward(I),B.forward(D),C))},be.prototype.eachChild=function(t){t(this.input);for(var o=0,u=this.outputs;o<u.length;o+=1)t(u[o])},be.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},be.prototype.serialize=function(){var t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var o=[this.operator,t,this.input.serialize()],u=0;u<this.labels.length;u++)o.push(this.labels[u],this.outputs[u].serialize());return o};var ht=function(t,o){this.type=t,this.args=o};ht.parse=function(t,o){if(t.length<2)return o.error("Expectected at least one argument.");var u=null,p=o.expectedType;p&&p.kind!=="value"&&(u=p);for(var y=[],b=0,C=t.slice(1);b<C.length;b+=1){var I=o.parse(C[b],1+y.length,u,void 0,{typeAnnotation:"omit"});if(!I)return null;u=u||I.type,y.push(I)}var D=p&&y.some(function(z){return It(p,z.type)});return new ht(D?tn:u,y)},ht.prototype.evaluate=function(t){for(var o,u=null,p=0,y=0,b=this.args;y<b.length&&(p++,(u=b[y].evaluate(t))&&u instanceof aa&&!u.available&&(o||(o=u.name),u=null,p===this.args.length&&(u=o)),u===null);y+=1);return u},ht.prototype.eachChild=function(t){this.args.forEach(t)},ht.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},ht.prototype.serialize=function(){var t=["coalesce"];return this.eachChild(function(o){t.push(o.serialize())}),t};var vt=function(t,o){this.type=o.type,this.bindings=[].concat(t),this.result=o};vt.prototype.evaluate=function(t){return this.result.evaluate(t)},vt.prototype.eachChild=function(t){for(var o=0,u=this.bindings;o<u.length;o+=1)t(u[o][1]);t(this.result)},vt.parse=function(t,o){if(t.length<4)return o.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var u=[],p=1;p<t.length-1;p+=2){var y=t[p];if(typeof y!="string")return o.error("Expected string, but found "+typeof y+" instead.",p);if(/[^a-zA-Z0-9_]/.test(y))return o.error("Variable names must contain only alphanumeric characters or '_'.",p);var b=o.parse(t[p+1],p+1);if(!b)return null;u.push([y,b])}var C=o.parse(t[t.length-1],t.length-1,o.expectedType,u);return C?new vt(u,C):null},vt.prototype.outputDefined=function(){return this.result.outputDefined()},vt.prototype.serialize=function(){for(var t=["let"],o=0,u=this.bindings;o<u.length;o+=1){var p=u[o];t.push(p[0],p[1].serialize())}return t.push(this.result.serialize()),t};var or=function(t,o,u){this.type=t,this.index=o,this.input=u};or.parse=function(t,o){if(t.length!==3)return o.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,Pt),p=o.parse(t[2],2,Pi(o.expectedType||tn));return u&&p?new or(p.type.itemType,u,p):null},or.prototype.evaluate=function(t){var o=this.index.evaluate(t),u=this.input.evaluate(t);if(o<0)throw new Ma("Array index out of bounds: "+o+" < 0.");if(o>=u.length)throw new Ma("Array index out of bounds: "+o+" > "+(u.length-1)+".");if(o!==Math.floor(o))throw new Ma("Array index must be an integer, but found "+o+" instead.");return u[o]},or.prototype.eachChild=function(t){t(this.index),t(this.input)},or.prototype.outputDefined=function(){return!1},or.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var lr=function(t,o){this.type=zr,this.needle=t,this.haystack=o};lr.parse=function(t,o){if(t.length!==3)return o.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,tn),p=o.parse(t[2],2,tn);return u&&p?Ta(u.type,[zr,en,Pt,pn,tn])?new lr(u,p):o.error("Expected first argument to be of type boolean, string, number or null, but found "+_i(u.type)+" instead"):null},lr.prototype.evaluate=function(t){var o=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!u)return!1;if(!Si(o,["boolean","string","number","null"]))throw new Ma("Expected first argument to be of type boolean, string, number or null, but found "+_i(na(o))+" instead.");if(!Si(u,["string","array"]))throw new Ma("Expected second argument to be of type array or string, but found "+_i(na(u))+" instead.");return u.indexOf(o)>=0},lr.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},lr.prototype.outputDefined=function(){return!0},lr.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Rn=function(t,o,u){this.type=Pt,this.needle=t,this.haystack=o,this.fromIndex=u};Rn.parse=function(t,o){if(t.length<=2||t.length>=5)return o.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,tn),p=o.parse(t[2],2,tn);if(!u||!p)return null;if(!Ta(u.type,[zr,en,Pt,pn,tn]))return o.error("Expected first argument to be of type boolean, string, number or null, but found "+_i(u.type)+" instead");if(t.length===4){var y=o.parse(t[3],3,Pt);return y?new Rn(u,p,y):null}return new Rn(u,p)},Rn.prototype.evaluate=function(t){var o=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!Si(o,["boolean","string","number","null"]))throw new Ma("Expected first argument to be of type boolean, string, number or null, but found "+_i(na(o))+" instead.");if(!Si(u,["string","array"]))throw new Ma("Expected second argument to be of type array or string, but found "+_i(na(u))+" instead.");if(this.fromIndex){var p=this.fromIndex.evaluate(t);return u.indexOf(o,p)}return u.indexOf(o)},Rn.prototype.eachChild=function(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)},Rn.prototype.outputDefined=function(){return!1},Rn.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var ai=function(t,o,u,p,y,b){this.inputType=t,this.type=o,this.input=u,this.cases=p,this.outputs=y,this.otherwise=b};ai.parse=function(t,o){if(t.length<5)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return o.error("Expected an even number of arguments.");var u,p;o.expectedType&&o.expectedType.kind!=="value"&&(p=o.expectedType);for(var y={},b=[],C=2;C<t.length-1;C+=2){var I=t[C],D=t[C+1];Array.isArray(I)||(I=[I]);var z=o.concat(C);if(I.length===0)return z.error("Expected at least one branch label.");for(var U=0,G=I;U<G.length;U+=1){var q=G[U];if(typeof q!="number"&&typeof q!="string")return z.error("Branch labels must be numbers or strings.");if(typeof q=="number"&&Math.abs(q)>Number.MAX_SAFE_INTEGER)return z.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof q=="number"&&Math.floor(q)!==q)return z.error("Numeric branch labels must be integer values.");if(u){if(z.checkSubtype(u,na(q)))return null}else u=na(q);if(y[String(q)]!==void 0)return z.error("Branch labels must be unique.");y[String(q)]=b.length}var ie=o.parse(D,C,p);if(!ie)return null;p=p||ie.type,b.push(ie)}var Pe=o.parse(t[1],1,tn);if(!Pe)return null;var Re=o.parse(t[t.length-1],t.length-1,p);return Re?Pe.type.kind!=="value"&&o.concat(1).checkSubtype(u,Pe.type)?null:new ai(u,p,Pe,y,b,Re):null},ai.prototype.evaluate=function(t){var o=this.input.evaluate(t);return(na(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(t)},ai.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},ai.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})&&this.otherwise.outputDefined()},ai.prototype.serialize=function(){for(var t=this,o=["match",this.input.serialize()],u=[],p={},y=0,b=Object.keys(this.cases).sort();y<b.length;y+=1){var C=b[y];(G=p[this.cases[C]])===void 0?(p[this.cases[C]]=u.length,u.push([this.cases[C],[C]])):u[G][1].push(C)}for(var I=function(ie){return t.inputType.kind==="number"?Number(ie):ie},D=0,z=u;D<z.length;D+=1){var U=z[D],G=U[0],q=U[1];o.push(q.length===1?I(q[0]):q.map(I)),o.push(this.outputs[outputIndex$1].serialize())}return o.push(this.otherwise.serialize()),o};var Fn=function(t,o,u){this.type=t,this.branches=o,this.otherwise=u};Fn.parse=function(t,o){if(t.length<4)return o.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return o.error("Expected an odd number of arguments.");var u;o.expectedType&&o.expectedType.kind!=="value"&&(u=o.expectedType);for(var p=[],y=1;y<t.length-1;y+=2){var b=o.parse(t[y],y,zr);if(!b)return null;var C=o.parse(t[y+1],y+1,u);if(!C)return null;p.push([b,C]),u=u||C.type}var I=o.parse(t[t.length-1],t.length-1,u);return I?new Fn(u,p,I):null},Fn.prototype.evaluate=function(t){for(var o=0,u=this.branches;o<u.length;o+=1){var p=u[o],y=p[1];if(p[0].evaluate(t))return y.evaluate(t)}return this.otherwise.evaluate(t)},Fn.prototype.eachChild=function(t){for(var o=0,u=this.branches;o<u.length;o+=1){var p=u[o],y=p[1];t(p[0]),t(y)}t(this.otherwise)},Fn.prototype.outputDefined=function(){return this.branches.every(function(t){return t[1].outputDefined()})&&this.otherwise.outputDefined()},Fn.prototype.serialize=function(){var t=["case"];return this.eachChild(function(o){t.push(o.serialize())}),t};var Yi=function(t,o,u,p){this.type=t,this.input=o,this.beginIndex=u,this.endIndex=p};function da(t,o){return t==="=="||t==="!="?o.kind==="boolean"||o.kind==="string"||o.kind==="number"||o.kind==="null"||o.kind==="value":o.kind==="string"||o.kind==="number"||o.kind==="value"}function Ca(t,o,u,p){return p.compare(o,u)===0}function Hi(t,o,u){var p=t!=="=="&&t!=="!=";return function(){function y(b,C,I){this.type=zr,this.lhs=b,this.rhs=C,this.collator=I,this.hasUntypedArgument=b.type.kind==="value"||C.type.kind==="value"}return y.parse=function(b,C){if(b.length!==3&&b.length!==4)return C.error("Expected two or three arguments.");var I=b[0],D=C.parse(b[1],1,tn);if(!D)return null;if(!da(I,D.type))return C.concat(1).error('"'+I+`" comparisons are not supported for type '`+_i(D.type)+"'.");var z=C.parse(b[2],2,tn);if(!z)return null;if(!da(I,z.type))return C.concat(2).error('"'+I+`" comparisons are not supported for type '`+_i(z.type)+"'.");if(D.type.kind!==z.type.kind&&D.type.kind!=="value"&&z.type.kind!=="value")return C.error("Cannot compare types '"+_i(D.type)+"' and '"+_i(z.type)+"'.");p&&(D.type.kind==="value"&&z.type.kind!=="value"?D=new oa(z.type,[D]):D.type.kind!=="value"&&z.type.kind==="value"&&(z=new oa(D.type,[z])));var U=null;if(b.length===4){if(D.type.kind!=="string"&&z.type.kind!=="string"&&D.type.kind!=="value"&&z.type.kind!=="value")return C.error("Cannot use collator to compare non-string types.");if(!(U=C.parse(b[3],3,mn)))return null}return new y(D,z,U)},y.prototype.evaluate=function(b){var C=this.lhs.evaluate(b),I=this.rhs.evaluate(b);if(p&&this.hasUntypedArgument){var D=na(C),z=na(I);if(D.kind!==z.kind||D.kind!=="string"&&D.kind!=="number")throw new Ma('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+D.kind+", "+z.kind+") instead.")}if(this.collator&&!p&&this.hasUntypedArgument){var U=na(C),G=na(I);if(U.kind!=="string"||G.kind!=="string")return o(b,C,I)}return this.collator?u(b,C,I,this.collator.evaluate(b)):o(b,C,I)},y.prototype.eachChild=function(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)},y.prototype.outputDefined=function(){return!0},y.prototype.serialize=function(){var b=[t];return this.eachChild(function(C){b.push(C.serialize())}),b},y}()}Yi.parse=function(t,o){if(t.length<=2||t.length>=5)return o.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,tn),p=o.parse(t[2],2,Pt);if(!u||!p)return null;if(!Ta(u.type,[Pi(tn),en,tn]))return o.error("Expected first argument to be of type array or string, but found "+_i(u.type)+" instead");if(t.length===4){var y=o.parse(t[3],3,Pt);return y?new Yi(u.type,u,p,y):null}return new Yi(u.type,u,p)},Yi.prototype.evaluate=function(t){var o=this.input.evaluate(t),u=this.beginIndex.evaluate(t);if(!Si(o,["string","array"]))throw new Ma("Expected first argument to be of type array or string, but found "+_i(na(o))+" instead.");if(this.endIndex){var p=this.endIndex.evaluate(t);return o.slice(u,p)}return o.slice(u)},Yi.prototype.eachChild=function(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)},Yi.prototype.outputDefined=function(){return!1},Yi.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var Ss=Hi("==",function(t,o,u){return o===u},Ca),hu=Hi("!=",function(t,o,u){return o!==u},function(t,o,u,p){return!Ca(0,o,u,p)}),qu=Hi("<",function(t,o,u){return o<u},function(t,o,u,p){return p.compare(o,u)<0}),gf=Hi(">",function(t,o,u){return o>u},function(t,o,u,p){return p.compare(o,u)>0}),ll=Hi("<=",function(t,o,u){return o<=u},function(t,o,u,p){return p.compare(o,u)<=0}),Bc=Hi(">=",function(t,o,u){return o>=u},function(t,o,u,p){return p.compare(o,u)>=0}),Tu=function(t,o,u,p,y){this.type=en,this.number=t,this.locale=o,this.currency=u,this.minFractionDigits=p,this.maxFractionDigits=y};Tu.parse=function(t,o){if(t.length!==3)return o.error("Expected two arguments.");var u=o.parse(t[1],1,Pt);if(!u)return null;var p=t[2];if(typeof p!="object"||Array.isArray(p))return o.error("NumberFormat options argument must be an object.");var y=null;if(p.locale&&!(y=o.parse(p.locale,1,en)))return null;var b=null;if(p.currency&&!(b=o.parse(p.currency,1,en)))return null;var C=null;if(p["min-fraction-digits"]&&!(C=o.parse(p["min-fraction-digits"],1,Pt)))return null;var I=null;return p["max-fraction-digits"]&&!(I=o.parse(p["max-fraction-digits"],1,Pt))?null:new Tu(u,y,b,C,I)},Tu.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},Tu.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},Tu.prototype.outputDefined=function(){return!1},Tu.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var Mu=function(t){this.type=Pt,this.input=t};Mu.parse=function(t,o){if(t.length!==2)return o.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?o.error("Expected argument of type string or array, but found "+_i(u.type)+" instead."):new Mu(u):null},Mu.prototype.evaluate=function(t){var o=this.input.evaluate(t);if(typeof o=="string"||Array.isArray(o))return o.length;throw new Ma("Expected value to be of type string or array, but found "+_i(na(o))+" instead.")},Mu.prototype.eachChild=function(t){t(this.input)},Mu.prototype.outputDefined=function(){return!1},Mu.prototype.serialize=function(){var t=["length"];return this.eachChild(function(o){t.push(o.serialize())}),t};var Pu={"==":Ss,"!=":hu,">":gf,"<":qu,">=":Bc,"<=":ll,array:oa,at:or,boolean:oa,case:Fn,coalesce:ht,collator:Fo,format:Ao,image:jo,in:lr,"index-of":Rn,interpolate:be,"interpolate-hcl":be,"interpolate-lab":be,length:Mu,let:vt,literal:za,match:ai,number:oa,"number-format":Tu,object:oa,slice:Yi,step:Es,string:oa,"to-boolean":vo,"to-color":vo,"to-number":vo,"to-string":vo,var:Ps,within:xs};function lo(t,o){var u=o[0],p=o[1],y=o[2],b=o[3];u=u.evaluate(t),p=p.evaluate(t),y=y.evaluate(t);var C=b?b.evaluate(t):1,I=J(u,p,y,C);if(I)throw new Ma(I);return new ji(u/255*C,p/255*C,y/255*C,C)}function Gf(t,o){return t in o}function Hf(t,o){var u=o[t];return u===void 0?null:u}function $o(t){return{type:t}}function Nc(t){return{result:"success",value:t}}function Iu(t){return{result:"error",value:t}}function pu(t){return t["property-type"]==="data-driven"||t["property-type"]==="cross-faded-data-driven"}function yf(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Rl(t){return!!t.expression&&t.expression.interpolated}function zi(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function kl(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function Mh(t){return t}function cl(t,o,u){return t!==void 0?t:o!==void 0?o:u!==void 0?u:void 0}function zc(t,o,u,p,y){return cl(typeof u===y?p[u]:void 0,t.default,o.default)}function Wf(t,o,u){if(zi(u)!=="number")return cl(t.default,o.default);var p=t.stops.length;if(p===1||u<=t.stops[0][0])return t.stops[0][1];if(u>=t.stops[p-1][0])return t.stops[p-1][1];var y=fu(t.stops.map(function(b){return b[0]}),u);return t.stops[y][1]}function Ph(t,o,u){var p=t.base!==void 0?t.base:1;if(zi(u)!=="number")return cl(t.default,o.default);var y=t.stops.length;if(y===1||u<=t.stops[0][0])return t.stops[0][1];if(u>=t.stops[y-1][0])return t.stops[y-1][1];var b=fu(t.stops.map(function(G){return G[0]}),u),C=function(G,q,ie,Pe){var Re=Pe-ie,k=G-ie;return Re===0?0:q===1?k/Re:(Math.pow(q,k)-1)/(Math.pow(q,Re)-1)}(u,p,t.stops[b][0],t.stops[b+1][0]),I=t.stops[b][1],D=t.stops[b+1][1],z=_a[o.type]||Mh;if(t.colorSpace&&t.colorSpace!=="rgb"){var U=$[t.colorSpace];z=function(G,q){return U.reverse(U.interpolate(U.forward(G),U.forward(q),C))}}return typeof I.evaluate=="function"?{evaluate:function(){for(var G=[],q=arguments.length;q--;)G[q]=arguments[q];var ie=I.evaluate.apply(void 0,G),Pe=D.evaluate.apply(void 0,G);if(ie!==void 0&&Pe!==void 0)return z(ie,Pe,C)}}:z(I,D,C)}function Xf(t,o,u){return o.type==="color"?u=ji.parse(u):o.type==="formatted"?u=_t.fromString(u.toString()):o.type==="resolvedImage"?u=aa.fromString(u.toString()):zi(u)===o.type||o.type==="enum"&&o.values[u]||(u=void 0),cl(u,t.default,o.default)}Ka.register(Pu,{error:[{kind:"error"},[en],function(t,o){throw new Ma(o[0].evaluate(t))}],typeof:[en,[tn],function(t,o){return _i(na(o[0].evaluate(t)))}],"to-rgba":[Pi(Pt,4),[Xr],function(t,o){return o[0].evaluate(t).toArray()}],rgb:[Xr,[Pt,Pt,Pt],lo],rgba:[Xr,[Pt,Pt,Pt,Pt],lo],has:{type:zr,overloads:[[[en],function(t,o){return Gf(o[0].evaluate(t),t.properties())}],[[en,mi],function(t,o){var u=o[1];return Gf(o[0].evaluate(t),u.evaluate(t))}]]},get:{type:tn,overloads:[[[en],function(t,o){return Hf(o[0].evaluate(t),t.properties())}],[[en,mi],function(t,o){var u=o[1];return Hf(o[0].evaluate(t),u.evaluate(t))}]]},"feature-state":[tn,[en],function(t,o){return Hf(o[0].evaluate(t),t.featureState||{})}],properties:[mi,[],function(t){return t.properties()}],"geometry-type":[en,[],function(t){return t.geometryType()}],id:[tn,[],function(t){return t.id()}],zoom:[Pt,[],function(t){return t.globals.zoom}],"heatmap-density":[Pt,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[Pt,[],function(t){return t.globals.lineProgress||0}],accumulated:[tn,[],function(t){return t.globals.accumulated===void 0?null:t.globals.accumulated}],"+":[Pt,$o(Pt),function(t,o){for(var u=0,p=0,y=o;p<y.length;p+=1)u+=y[p].evaluate(t);return u}],"*":[Pt,$o(Pt),function(t,o){for(var u=1,p=0,y=o;p<y.length;p+=1)u*=y[p].evaluate(t);return u}],"-":{type:Pt,overloads:[[[Pt,Pt],function(t,o){var u=o[1];return o[0].evaluate(t)-u.evaluate(t)}],[[Pt],function(t,o){return-o[0].evaluate(t)}]]},"/":[Pt,[Pt,Pt],function(t,o){var u=o[1];return o[0].evaluate(t)/u.evaluate(t)}],"%":[Pt,[Pt,Pt],function(t,o){var u=o[1];return o[0].evaluate(t)%u.evaluate(t)}],ln2:[Pt,[],function(){return Math.LN2}],pi:[Pt,[],function(){return Math.PI}],e:[Pt,[],function(){return Math.E}],"^":[Pt,[Pt,Pt],function(t,o){var u=o[1];return Math.pow(o[0].evaluate(t),u.evaluate(t))}],sqrt:[Pt,[Pt],function(t,o){return Math.sqrt(o[0].evaluate(t))}],log10:[Pt,[Pt],function(t,o){return Math.log(o[0].evaluate(t))/Math.LN10}],ln:[Pt,[Pt],function(t,o){return Math.log(o[0].evaluate(t))}],log2:[Pt,[Pt],function(t,o){return Math.log(o[0].evaluate(t))/Math.LN2}],sin:[Pt,[Pt],function(t,o){return Math.sin(o[0].evaluate(t))}],cos:[Pt,[Pt],function(t,o){return Math.cos(o[0].evaluate(t))}],tan:[Pt,[Pt],function(t,o){return Math.tan(o[0].evaluate(t))}],asin:[Pt,[Pt],function(t,o){return Math.asin(o[0].evaluate(t))}],acos:[Pt,[Pt],function(t,o){return Math.acos(o[0].evaluate(t))}],atan:[Pt,[Pt],function(t,o){return Math.atan(o[0].evaluate(t))}],min:[Pt,$o(Pt),function(t,o){return Math.min.apply(Math,o.map(function(u){return u.evaluate(t)}))}],max:[Pt,$o(Pt),function(t,o){return Math.max.apply(Math,o.map(function(u){return u.evaluate(t)}))}],abs:[Pt,[Pt],function(t,o){return Math.abs(o[0].evaluate(t))}],round:[Pt,[Pt],function(t,o){var u=o[0].evaluate(t);return u<0?-Math.round(-u):Math.round(u)}],floor:[Pt,[Pt],function(t,o){return Math.floor(o[0].evaluate(t))}],ceil:[Pt,[Pt],function(t,o){return Math.ceil(o[0].evaluate(t))}],"filter-==":[zr,[en,tn],function(t,o){var u=o[0],p=o[1];return t.properties()[u.value]===p.value}],"filter-id-==":[zr,[tn],function(t,o){var u=o[0];return t.id()===u.value}],"filter-type-==":[zr,[en],function(t,o){var u=o[0];return t.geometryType()===u.value}],"filter-<":[zr,[en,tn],function(t,o){var u=o[0],p=o[1],y=t.properties()[u.value],b=p.value;return typeof y==typeof b&&y<b}],"filter-id-<":[zr,[tn],function(t,o){var u=o[0],p=t.id(),y=u.value;return typeof p==typeof y&&p<y}],"filter->":[zr,[en,tn],function(t,o){var u=o[0],p=o[1],y=t.properties()[u.value],b=p.value;return typeof y==typeof b&&y>b}],"filter-id->":[zr,[tn],function(t,o){var u=o[0],p=t.id(),y=u.value;return typeof p==typeof y&&p>y}],"filter-<=":[zr,[en,tn],function(t,o){var u=o[0],p=o[1],y=t.properties()[u.value],b=p.value;return typeof y==typeof b&&y<=b}],"filter-id-<=":[zr,[tn],function(t,o){var u=o[0],p=t.id(),y=u.value;return typeof p==typeof y&&p<=y}],"filter->=":[zr,[en,tn],function(t,o){var u=o[0],p=o[1],y=t.properties()[u.value],b=p.value;return typeof y==typeof b&&y>=b}],"filter-id->=":[zr,[tn],function(t,o){var u=o[0],p=t.id(),y=u.value;return typeof p==typeof y&&p>=y}],"filter-has":[zr,[tn],function(t,o){return o[0].value in t.properties()}],"filter-has-id":[zr,[],function(t){return t.id()!==null&&t.id()!==void 0}],"filter-type-in":[zr,[Pi(en)],function(t,o){return o[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[zr,[Pi(tn)],function(t,o){return o[0].value.indexOf(t.id())>=0}],"filter-in-small":[zr,[en,Pi(tn)],function(t,o){var u=o[0];return o[1].value.indexOf(t.properties()[u.value])>=0}],"filter-in-large":[zr,[en,Pi(tn)],function(t,o){var u=o[0],p=o[1];return function(y,b,C,I){for(;C<=I;){var D=C+I>>1;if(b[D]===y)return!0;b[D]>y?I=D-1:C=D+1}return!1}(t.properties()[u.value],p.value,0,p.value.length-1)}],all:{type:zr,overloads:[[[zr,zr],function(t,o){var u=o[1];return o[0].evaluate(t)&&u.evaluate(t)}],[$o(zr),function(t,o){for(var u=0,p=o;u<p.length;u+=1)if(!p[u].evaluate(t))return!1;return!0}]]},any:{type:zr,overloads:[[[zr,zr],function(t,o){var u=o[1];return o[0].evaluate(t)||u.evaluate(t)}],[$o(zr),function(t,o){for(var u=0,p=o;u<p.length;u+=1)if(p[u].evaluate(t))return!0;return!1}]]},"!":[zr,[zr],function(t,o){return!o[0].evaluate(t)}],"is-supported-script":[zr,[en],function(t,o){var u=t.globals&&t.globals.isSupportedScript;return!u||u(o[0].evaluate(t))}],upcase:[en,[en],function(t,o){return o[0].evaluate(t).toUpperCase()}],downcase:[en,[en],function(t,o){return o[0].evaluate(t).toLowerCase()}],concat:[en,$o(tn),function(t,o){return o.map(function(u){return bu(u.evaluate(t))}).join("")}],"resolved-locale":[en,[mn],function(t,o){return o[0].evaluate(t).resolvedLocale()}]});var Zc=function(t,o){this.expression=t,this._warningHistory={},this._evaluator=new sa,this._defaultValue=o?function(u){return u.type==="color"&&kl(u.default)?new ji(0,0,0,0):u.type==="color"?ji.parse(u.default)||null:u.default===void 0?null:u.default}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null};function oc(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Pu}function sc(t,o){var u=new Fs(Pu,[],o?function(y){var b={color:Xr,string:en,number:Pt,enum:en,boolean:zr,formatted:Xi,resolvedImage:hi};return y.type==="array"?Pi(b[y.value]||tn,y.length):b[y.type]}(o):void 0),p=u.parse(t,void 0,void 0,void 0,o&&o.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?Nc(new Zc(p,o)):Iu(u.errors)}Zc.prototype.evaluateWithoutErrorHandling=function(t,o,u,p,y,b){return this._evaluator.globals=t,this._evaluator.feature=o,this._evaluator.featureState=u,this._evaluator.canonical=p,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)},Zc.prototype.evaluate=function(t,o,u,p,y,b){this._evaluator.globals=t,this._evaluator.feature=o||null,this._evaluator.featureState=u||null,this._evaluator.canonical=p,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b||null;try{var C=this.expression.evaluate(this._evaluator);if(C==null||typeof C=="number"&&C!=C)return this._defaultValue;if(this._enumValues&&!(C in this._enumValues))throw new Ma("Expected value to be one of "+Object.keys(this._enumValues).map(function(I){return JSON.stringify(I)}).join(", ")+", but found "+JSON.stringify(C)+" instead.");return C}catch(I){return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,typeof console!="undefined"&&console.warn(I.message)),this._defaultValue}};var Ll=function(t,o){this.kind=t,this._styleExpression=o,this.isStateDependent=t!=="constant"&&!wo(o.expression)};Ll.prototype.evaluateWithoutErrorHandling=function(t,o,u,p,y,b){return this._styleExpression.evaluateWithoutErrorHandling(t,o,u,p,y,b)},Ll.prototype.evaluate=function(t,o,u,p,y,b){return this._styleExpression.evaluate(t,o,u,p,y,b)};var fl=function(t,o,u,p){this.kind=t,this.zoomStops=u,this._styleExpression=o,this.isStateDependent=t!=="camera"&&!wo(o.expression),this.interpolationType=p};function Dl(t,o){if((t=sc(t,o)).result==="error")return t;var u=t.value.expression,p=uo(u);if(!p&&!pu(o))return Iu([new dr("","data expressions not supported")]);var y=bs(u,["zoom"]);if(!y&&!yf(o))return Iu([new dr("","zoom expressions not supported")]);var b=function C(I){var D=null;if(I instanceof vt)D=C(I.result);else if(I instanceof ht)for(var z=0,U=I.args;z<U.length&&!(D=C(U[z]));z+=1);else(I instanceof Es||I instanceof be)&&I.input instanceof Ka&&I.input.name==="zoom"&&(D=I);return D instanceof dr||I.eachChild(function(G){var q=C(G);q instanceof dr?D=q:!D&&q?D=new dr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):D&&q&&D!==q&&(D=new dr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),D}(u);return b||y?b instanceof dr?Iu([b]):b instanceof be&&!Rl(o)?Iu([new dr("",'"interpolate" expressions cannot be used with this property')]):Nc(b?new fl(p?"camera":"composite",t.value,b.labels,b instanceof be?b.interpolation:void 0):new Ll(p?"constant":"source",t.value)):Iu([new dr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}fl.prototype.evaluateWithoutErrorHandling=function(t,o,u,p,y,b){return this._styleExpression.evaluateWithoutErrorHandling(t,o,u,p,y,b)},fl.prototype.evaluate=function(t,o,u,p,y,b){return this._styleExpression.evaluate(t,o,u,p,y,b)},fl.prototype.interpolationFactor=function(t,o,u){return this.interpolationType?be.interpolationFactor(this.interpolationType,t,o,u):0};var Ku=function(t,o){this._parameters=t,this._specification=o,pr(this,function u(p,y){var b,C,I,D=y.type==="color",z=p.stops&&typeof p.stops[0][0]=="object",U=z||!(z||p.property!==void 0),G=p.type||(Rl(y)?"exponential":"interval");if(D&&((p=pr({},p)).stops&&(p.stops=p.stops.map(function(hn){return[hn[0],ji.parse(hn[1])]})),p.default=ji.parse(p.default?p.default:y.default)),p.colorSpace&&p.colorSpace!=="rgb"&&!$[p.colorSpace])throw new Error("Unknown color space: "+p.colorSpace);if(G==="exponential")b=Ph;else if(G==="interval")b=Wf;else if(G==="categorical"){b=zc,C=Object.create(null);for(var q=0,ie=p.stops;q<ie.length;q+=1){var Pe=ie[q];C[Pe[0]]=Pe[1]}I=typeof p.stops[0][0]}else{if(G!=="identity")throw new Error('Unknown function type "'+G+'"');b=Xf}if(z){for(var Re={},k=[],Ze=0;Ze<p.stops.length;Ze++){var at=p.stops[Ze],Ct=at[0].zoom;Re[Ct]===void 0&&(Re[Ct]={zoom:Ct,type:p.type,property:p.property,default:p.default,stops:[]},k.push(Ct)),Re[Ct].stops.push([at[0].value,at[1]])}for(var zt=[],Vt=0,sr=k;Vt<sr.length;Vt+=1){var Pr=sr[Vt];zt.push([Re[Pr].zoom,u(Re[Pr],y)])}var Br={name:"linear"};return{kind:"composite",interpolationType:Br,interpolationFactor:be.interpolationFactor.bind(void 0,Br),zoomStops:zt.map(function(hn){return hn[0]}),evaluate:function(hn,Wn){var dn=hn.zoom;return Ph({stops:zt,base:p.base},y,dn).evaluate(dn,Wn)}}}if(U){var zn=G==="exponential"?{name:"exponential",base:p.base!==void 0?p.base:1}:null;return{kind:"camera",interpolationType:zn,interpolationFactor:be.interpolationFactor.bind(void 0,zn),zoomStops:p.stops.map(function(hn){return hn[0]}),evaluate:function(hn){return b(p,y,hn.zoom,C,I)}}}return{kind:"source",evaluate:function(hn,Wn){var dn=Wn&&Wn.properties?Wn.properties[p.property]:void 0;return dn===void 0?cl(p.default,y.default):b(p,y,dn,C,I)}}}(this._parameters,this._specification))};function $s(t){var o=t.key,u=t.value,p=t.valueSpec||{},y=t.objectElementValidators||{},b=t.style,C=t.styleSpec,I=[],D=zi(u);if(D!=="object")return[new Le(o,u,"object expected, "+D+" found")];for(var z in u){var U=z.split(".")[0],G=p[U]||p["*"],q=void 0;if(y[U])q=y[U];else if(p[U])q=qi;else if(y["*"])q=y["*"];else{if(!p["*"]){I.push(new Le(o,u[z],'unknown property "'+z+'"'));continue}q=qi}I=I.concat(q({key:(o&&o+".")+z,value:u[z],valueSpec:G,style:b,styleSpec:C,object:u,objectKey:z},u))}for(var ie in p)y[ie]||p[ie].required&&p[ie].default===void 0&&u[ie]===void 0&&I.push(new Le(o,u,'missing required property "'+ie+'"'));return I}function _f(t){var o=t.value,u=t.valueSpec,p=t.style,y=t.styleSpec,b=t.key,C=t.arrayElementValidator||qi;if(zi(o)!=="array")return[new Le(b,o,"array expected, "+zi(o)+" found")];if(u.length&&o.length!==u.length)return[new Le(b,o,"array length "+u.length+" expected, length "+o.length+" found")];if(u["min-length"]&&o.length<u["min-length"])return[new Le(b,o,"array length at least "+u["min-length"]+" expected, length "+o.length+" found")];var I={type:u.value,values:u.values};y.$version<7&&(I.function=u.function),zi(u.value)==="object"&&(I=u.value);for(var D=[],z=0;z<o.length;z++)D=D.concat(C({array:o,arrayIndex:z,value:o[z],valueSpec:I,style:p,styleSpec:y,key:b+"["+z+"]"}));return D}function xf(t){var o=t.key,u=t.value,p=t.valueSpec,y=zi(u);return y==="number"&&u!=u&&(y="NaN"),y!=="number"?[new Le(o,u,"number expected, "+y+" found")]:"minimum"in p&&u<p.minimum?[new Le(o,u,u+" is less than the minimum value "+p.minimum)]:"maximum"in p&&u>p.maximum?[new Le(o,u,u+" is greater than the maximum value "+p.maximum)]:[]}function Yf(t){var o,u,p,y=t.valueSpec,b=Lt(t.value.type),C={},I=b!=="categorical"&&t.value.property===void 0,D=!I,z=zi(t.value.stops)==="array"&&zi(t.value.stops[0])==="array"&&zi(t.value.stops[0][0])==="object",U=$s({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(ie){if(b==="identity")return[new Le(ie.key,ie.value,'identity function may not have a "stops" property')];var Pe=[],Re=ie.value;return Pe=Pe.concat(_f({key:ie.key,value:Re,valueSpec:ie.valueSpec,style:ie.style,styleSpec:ie.styleSpec,arrayElementValidator:G})),zi(Re)==="array"&&Re.length===0&&Pe.push(new Le(ie.key,Re,"array must have at least one stop")),Pe},default:function(ie){return qi({key:ie.key,value:ie.value,valueSpec:y,style:ie.style,styleSpec:ie.styleSpec})}}});return b==="identity"&&I&&U.push(new Le(t.key,t.value,'missing required property "property"')),b==="identity"||t.value.stops||U.push(new Le(t.key,t.value,'missing required property "stops"')),b==="exponential"&&t.valueSpec.expression&&!Rl(t.valueSpec)&&U.push(new Le(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(D&&!pu(t.valueSpec)?U.push(new Le(t.key,t.value,"property functions not supported")):I&&!yf(t.valueSpec)&&U.push(new Le(t.key,t.value,"zoom functions not supported"))),b!=="categorical"&&!z||t.value.property!==void 0||U.push(new Le(t.key,t.value,'"property" property is required')),U;function G(ie){var Pe=[],Re=ie.value,k=ie.key;if(zi(Re)!=="array")return[new Le(k,Re,"array expected, "+zi(Re)+" found")];if(Re.length!==2)return[new Le(k,Re,"array length 2 expected, length "+Re.length+" found")];if(z){if(zi(Re[0])!=="object")return[new Le(k,Re,"object expected, "+zi(Re[0])+" found")];if(Re[0].zoom===void 0)return[new Le(k,Re,"object stop key must have zoom")];if(Re[0].value===void 0)return[new Le(k,Re,"object stop key must have value")];if(p&&p>Lt(Re[0].zoom))return[new Le(k,Re[0].zoom,"stop zoom values must appear in ascending order")];Lt(Re[0].zoom)!==p&&(p=Lt(Re[0].zoom),u=void 0,C={}),Pe=Pe.concat($s({key:k+"[0]",value:Re[0],valueSpec:{zoom:{}},style:ie.style,styleSpec:ie.styleSpec,objectElementValidators:{zoom:xf,value:q}}))}else Pe=Pe.concat(q({key:k+"[0]",value:Re[0],valueSpec:{},style:ie.style,styleSpec:ie.styleSpec},Re));return oc(Ft(Re[1]))?Pe.concat([new Le(k+"[1]",Re[1],"expressions are not allowed in function stops.")]):Pe.concat(qi({key:k+"[1]",value:Re[1],valueSpec:y,style:ie.style,styleSpec:ie.styleSpec}))}function q(ie,Pe){var Re=zi(ie.value),k=Lt(ie.value),Ze=ie.value!==null?ie.value:Pe;if(o){if(Re!==o)return[new Le(ie.key,Ze,Re+" stop domain type must match previous stop domain type "+o)]}else o=Re;if(Re!=="number"&&Re!=="string"&&Re!=="boolean")return[new Le(ie.key,Ze,"stop domain value must be a number, string, or boolean")];if(Re!=="number"&&b!=="categorical"){var at="number expected, "+Re+" found";return pu(y)&&b===void 0&&(at+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Le(ie.key,Ze,at)]}return b!=="categorical"||Re!=="number"||isFinite(k)&&Math.floor(k)===k?b!=="categorical"&&Re==="number"&&u!==void 0&&k<u?[new Le(ie.key,Ze,"stop domain values must appear in ascending order")]:(u=k,b==="categorical"&&k in C?[new Le(ie.key,Ze,"stop domain values must be unique")]:(C[k]=!0,[])):[new Le(ie.key,Ze,"integer expected, found "+k)]}}function du(t){var o=(t.expressionContext==="property"?Dl:sc)(Ft(t.value),t.valueSpec);if(o.result==="error")return o.value.map(function(p){return new Le(""+t.key+p.key,t.value,p.message)});var u=o.value.expression||o.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!u.outputDefined())return[new Le(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!wo(u))return[new Le(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter"&&!wo(u))return[new Le(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!bs(u,["zoom","feature-state"]))return[new Le(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!uo(u))return[new Le(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function uc(t){var o=t.key,u=t.value,p=t.valueSpec,y=[];return Array.isArray(p.values)?p.values.indexOf(Lt(u))===-1&&y.push(new Le(o,u,"expected one of ["+p.values.join(", ")+"], "+JSON.stringify(u)+" found")):Object.keys(p.values).indexOf(Lt(u))===-1&&y.push(new Le(o,u,"expected one of ["+Object.keys(p.values).join(", ")+"], "+JSON.stringify(u)+" found")),y}function Uc(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var o=0,u=t.slice(1);o<u.length;o+=1){var p=u[o];if(!Uc(p)&&typeof p!="boolean")return!1}return!0;default:return!0}}Ku.deserialize=function(t){return new Ku(t._parameters,t._specification)},Ku.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var bf={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Fl(t){if(t==null)return{filter:function(){return!0},needGeometry:!1};Uc(t)||(t=Ef(t));var o=sc(t,bf);if(o.result==="error")throw new Error(o.value.map(function(u){return u.key+": "+u.message}).join(", "));return{filter:function(u,p,y){return o.value.evaluate(u,p,{},y)},needGeometry:function u(p){if(!Array.isArray(p))return!1;if(p[0]==="within")return!0;for(var y=1;y<p.length;y++)if(u(p[y]))return!0;return!1}(t)}}function hp(t,o){return t<o?-1:t>o?1:0}function Ef(t){if(!t)return!0;var o,u=t[0];return t.length<=1?u!=="any":u==="=="?Bl(t[1],t[2],"=="):u==="!="?Nl(Bl(t[1],t[2],"==")):u==="<"||u===">"||u==="<="||u===">="?Bl(t[1],t[2],u):u==="any"?(o=t.slice(1),["any"].concat(o.map(Ef))):u==="all"?["all"].concat(t.slice(1).map(Ef)):u==="none"?["all"].concat(t.slice(1).map(Ef).map(Nl)):u==="in"?Sf(t[1],t.slice(2)):u==="!in"?Nl(Sf(t[1],t.slice(2))):u==="has"?Cf(t[1]):u==="!has"?Nl(Cf(t[1])):u!=="within"||t}function Bl(t,o,u){switch(t){case"$type":return["filter-type-"+u,o];case"$id":return["filter-id-"+u,o];default:return["filter-"+u,t,o]}}function Sf(t,o){if(o.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(function(u){return typeof u!=typeof o[0]})?["filter-in-large",t,["literal",o.sort(hp)]]:["filter-in-small",t,["literal",o]]}}function Cf(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Nl(t){return["!",t]}function jc(t){return Uc(Ft(t.value))?du(pr({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function o(u){var p=u.value,y=u.key;if(zi(p)!=="array")return[new Le(y,p,"array expected, "+zi(p)+" found")];var b,C=u.styleSpec,I=[];if(p.length<1)return[new Le(y,p,"filter array must have at least 1 element")];switch(I=I.concat(uc({key:y+"[0]",value:p[0],valueSpec:C.filter_operator,style:u.style,styleSpec:u.styleSpec})),Lt(p[0])){case"<":case"<=":case">":case">=":p.length>=2&&Lt(p[1])==="$type"&&I.push(new Le(y,p,'"$type" cannot be use with operator "'+p[0]+'"'));case"==":case"!=":p.length!==3&&I.push(new Le(y,p,'filter array for operator "'+p[0]+'" must have 3 elements'));case"in":case"!in":p.length>=2&&(b=zi(p[1]))!=="string"&&I.push(new Le(y+"[1]",p[1],"string expected, "+b+" found"));for(var D=2;D<p.length;D++)b=zi(p[D]),Lt(p[1])==="$type"?I=I.concat(uc({key:y+"["+D+"]",value:p[D],valueSpec:C.geometry_type,style:u.style,styleSpec:u.styleSpec})):b!=="string"&&b!=="number"&&b!=="boolean"&&I.push(new Le(y+"["+D+"]",p[D],"string, number, or boolean expected, "+b+" found"));break;case"any":case"all":case"none":for(var z=1;z<p.length;z++)I=I.concat(o({key:y+"["+z+"]",value:p[z],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":b=zi(p[1]),p.length!==2?I.push(new Le(y,p,'filter array for "'+p[0]+'" operator must have 2 elements')):b!=="string"&&I.push(new Le(y+"[1]",p[1],"string expected, "+b+" found"));break;case"within":b=zi(p[1]),p.length!==2?I.push(new Le(y,p,'filter array for "'+p[0]+'" operator must have 2 elements')):b!=="object"&&I.push(new Le(y+"[1]",p[1],"object expected, "+b+" found"))}return I}(t)}function Ih(t,o){var u=t.key,p=t.style,y=t.styleSpec,b=t.value,C=t.objectKey,I=y[o+"_"+t.layerType];if(!I)return[];var D=C.match(/^(.*)-transition$/);if(o==="paint"&&D&&I[D[1]]&&I[D[1]].transition)return qi({key:u,value:b,valueSpec:y.transition,style:p,styleSpec:y});var z,U=t.valueSpec||I[C];if(!U)return[new Le(u,b,'unknown property "'+C+'"')];if(zi(b)==="string"&&pu(U)&&!U.tokens&&(z=/^{([^}]+)}$/.exec(b)))return[new Le(u,b,'"'+C+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(z[1])+" }`.")];var G=[];return t.layerType==="symbol"&&(C==="text-field"&&p&&!p.glyphs&&G.push(new Le(u,b,'use of "text-field" requires a style "glyphs" property')),C==="text-font"&&kl(Ft(b))&&Lt(b.type)==="identity"&&G.push(new Le(u,b,'"text-font" does not support identity functions'))),G.concat(qi({key:t.key,value:b,valueSpec:U,style:p,styleSpec:y,expressionContext:"property",propertyType:o,propertyKey:C}))}function Oh(t){return Ih(t,"paint")}function lc(t){return Ih(t,"layout")}function Rh(t){var o=[],u=t.value,p=t.key,y=t.style,b=t.styleSpec;u.type||u.ref||o.push(new Le(p,u,'either "type" or "ref" is required'));var C,I=Lt(u.type),D=Lt(u.ref);if(u.id)for(var z=Lt(u.id),U=0;U<t.arrayIndex;U++){var G=y.layers[U];Lt(G.id)===z&&o.push(new Le(p,u.id,'duplicate layer id "'+u.id+'", previously used at line '+G.id.__line__))}if("ref"in u)["type","source","source-layer","filter","layout"].forEach(function(Pe){Pe in u&&o.push(new Le(p,u[Pe],'"'+Pe+'" is prohibited for ref layers'))}),y.layers.forEach(function(Pe){Lt(Pe.id)===D&&(C=Pe)}),C?C.ref?o.push(new Le(p,u.ref,"ref cannot reference another ref layer")):I=Lt(C.type):o.push(new Le(p,u.ref,'ref layer "'+D+'" not found'));else if(I!=="background")if(u.source){var q=y.sources&&y.sources[u.source],ie=q&&Lt(q.type);q?ie==="vector"&&I==="raster"?o.push(new Le(p,u.source,'layer "'+u.id+'" requires a raster source')):ie==="raster"&&I!=="raster"?o.push(new Le(p,u.source,'layer "'+u.id+'" requires a vector source')):ie!=="vector"||u["source-layer"]?ie==="raster-dem"&&I!=="hillshade"?o.push(new Le(p,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):I!=="line"||!u.paint||!u.paint["line-gradient"]||ie==="geojson"&&q.lineMetrics||o.push(new Le(p,u,'layer "'+u.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):o.push(new Le(p,u,'layer "'+u.id+'" must specify a "source-layer"')):o.push(new Le(p,u.source,'source "'+u.source+'" not found'))}else o.push(new Le(p,u,'missing required property "source"'));return o=o.concat($s({key:p,value:u,valueSpec:b.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return qi({key:p+".type",value:u.type,valueSpec:b.layer.type,style:t.style,styleSpec:t.styleSpec,object:u,objectKey:"type"})},filter:jc,layout:function(Pe){return $s({layer:u,key:Pe.key,value:Pe.value,style:Pe.style,styleSpec:Pe.styleSpec,objectElementValidators:{"*":function(Re){return lc(pr({layerType:I},Re))}}})},paint:function(Pe){return $s({layer:u,key:Pe.key,value:Pe.value,style:Pe.style,styleSpec:Pe.styleSpec,objectElementValidators:{"*":function(Re){return Oh(pr({layerType:I},Re))}}})}}}))}function zl(t){var o=t.value,u=t.key,p=zi(o);return p!=="string"?[new Le(u,o,"string expected, "+p+" found")]:[]}var Ji={promoteId:function(t){var o=t.key,u=t.value;if(zi(u)==="string")return zl({key:o,value:u});var p=[];for(var y in u)p.push.apply(p,zl({key:o+"."+y,value:u[y]}));return p}};function cc(t){var o=t.value,u=t.key,p=t.styleSpec,y=t.style;if(!o.type)return[new Le(u,o,'"type" is required')];var b,C=Lt(o.type);switch(C){case"vector":case"raster":case"raster-dem":return $s({key:u,value:o,valueSpec:p["source_"+C.replace("-","_")],style:t.style,styleSpec:p,objectElementValidators:Ji});case"geojson":if(b=$s({key:u,value:o,valueSpec:p.source_geojson,style:y,styleSpec:p,objectElementValidators:Ji}),o.cluster)for(var I in o.clusterProperties){var D=o.clusterProperties[I],z=D[0],U=typeof z=="string"?[z,["accumulated"],["get",I]]:z;b.push.apply(b,du({key:u+"."+I+".map",value:D[1],expressionContext:"cluster-map"})),b.push.apply(b,du({key:u+"."+I+".reduce",value:U,expressionContext:"cluster-reduce"}))}return b;case"video":return $s({key:u,value:o,valueSpec:p.source_video,style:y,styleSpec:p});case"image":return $s({key:u,value:o,valueSpec:p.source_image,style:y,styleSpec:p});case"canvas":return[new Le(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return uc({key:u+".type",value:o.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:y,styleSpec:p})}}function ca(t){var o=t.value,u=t.styleSpec,p=u.light,y=t.style,b=[],C=zi(o);if(o===void 0)return b;if(C!=="object")return b.concat([new Le("light",o,"object expected, "+C+" found")]);for(var I in o){var D=I.match(/^(.*)-transition$/);b=b.concat(D&&p[D[1]]&&p[D[1]].transition?qi({key:I,value:o[I],valueSpec:u.transition,style:y,styleSpec:u}):p[I]?qi({key:I,value:o[I],valueSpec:p[I],style:y,styleSpec:u}):[new Le(I,o[I],'unknown property "'+I+'"')])}return b}var Ou={"*":function(){return[]},array:_f,boolean:function(t){var o=t.value,u=t.key,p=zi(o);return p!=="boolean"?[new Le(u,o,"boolean expected, "+p+" found")]:[]},number:xf,color:function(t){var o=t.key,u=t.value,p=zi(u);return p!=="string"?[new Le(o,u,"color expected, "+p+" found")]:Ii(u)===null?[new Le(o,u,'color expected, "'+u+'" found')]:[]},constants:mt,enum:uc,filter:jc,function:Yf,layer:Rh,object:$s,source:cc,light:ca,string:zl,formatted:function(t){return zl(t).length===0?[]:du(t)},resolvedImage:function(t){return zl(t).length===0?[]:du(t)}};function qi(t){var o=t.value,u=t.valueSpec,p=t.styleSpec;return u.expression&&kl(Lt(o))?Yf(t):u.expression&&oc(Ft(o))?du(t):u.type&&Ou[u.type]?Ou[u.type](t):$s(pr({},t,{valueSpec:u.type?p[u.type]:u}))}function Pa(t){var o=t.value,u=t.key,p=zl(t);return p.length||(o.indexOf("{fontstack}")===-1&&p.push(new Le(u,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&p.push(new Le(u,o,'"glyphs" url must include a "{range}" token'))),p}function Cs(t,o){o===void 0&&(o=ce);var u=[];return u=u.concat(qi({key:"",value:t,valueSpec:o.$root,styleSpec:o,style:t,objectElementValidators:{glyphs:Pa,"*":function(){return[]}}})),t.constants&&(u=u.concat(mt({key:"constants",value:t.constants,style:t,styleSpec:o}))),Vc(u)}function Vc(t){return[].concat(t).sort(function(o,u){return o.line-u.line})}function $u(t){return function(){for(var o=[],u=arguments.length;u--;)o[u]=arguments[u];return Vc(t.apply(this,o))}}Cs.source=$u(cc),Cs.light=$u(ca),Cs.layer=$u(Rh),Cs.filter=$u(jc),Cs.paintProperty=$u(Oh),Cs.layoutProperty=$u(lc);var Ua=Cs,fc=Ua.light,Zl=Ua.paintProperty,Qu=Ua.layoutProperty;function Gc(t,o){var u=!1;if(o&&o.length)for(var p=0,y=o;p<y.length;p+=1)t.fire(new Ge(new Error(y[p].message))),u=!0;return u}var Ru=mo;function mo(t,o,u){var p=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var y=new Int32Array(this.arrayBuffer);t=y[0],this.d=(o=y[1])+2*(u=y[2]);for(var b=0;b<this.d*this.d;b++){var C=y[3+b],I=y[3+b+1];p.push(C===I?null:y.subarray(C,I))}var D=y[3+p.length+1];this.keys=y.subarray(y[3+p.length],D),this.bboxes=y.subarray(D),this.insert=this._insertReadonly}else{this.d=o+2*u;for(var z=0;z<this.d*this.d;z++)p.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=t,this.padding=u,this.scale=o/t,this.uid=0;var U=u/o*t;this.min=-U,this.max=t+U}mo.prototype.insert=function(t,o,u,p,y){this._forEachCell(o,u,p,y,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(y)},mo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},mo.prototype._insertCell=function(t,o,u,p,y,b){this.cells[y].push(b)},mo.prototype.query=function(t,o,u,p,y){var b=this.min,C=this.max;if(t<=b&&o<=b&&C<=u&&C<=p&&!y)return Array.prototype.slice.call(this.keys);var I=[];return this._forEachCell(t,o,u,p,this._queryCell,I,{},y),I},mo.prototype._queryCell=function(t,o,u,p,y,b,C,I){var D=this.cells[y];if(D!==null)for(var z=this.keys,U=this.bboxes,G=0;G<D.length;G++){var q=D[G];if(C[q]===void 0){var ie=4*q;(I?I(U[ie+0],U[ie+1],U[ie+2],U[ie+3]):t<=U[ie+2]&&o<=U[ie+3]&&u>=U[ie+0]&&p>=U[ie+1])?(C[q]=!0,b.push(z[q])):C[q]=!1}}},mo.prototype._forEachCell=function(t,o,u,p,y,b,C,I){for(var D=this._convertToCellCoord(t),z=this._convertToCellCoord(o),U=this._convertToCellCoord(u),G=this._convertToCellCoord(p),q=D;q<=U;q++)for(var ie=z;ie<=G;ie++){var Pe=this.d*ie+q;if((!I||I(this._convertFromCellCoord(q),this._convertFromCellCoord(ie),this._convertFromCellCoord(q+1),this._convertFromCellCoord(ie+1)))&&y.call(this,t,o,u,p,Pe,b,C,I))return}},mo.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},mo.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},mo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,o=3+this.cells.length+1+1,u=0,p=0;p<this.cells.length;p++)u+=this.cells[p].length;var y=new Int32Array(o+u+this.keys.length+this.bboxes.length);y[0]=this.extent,y[1]=this.n,y[2]=this.padding;for(var b=o,C=0;C<t.length;C++){var I=t[C];y[3+C]=b,y.set(I,b),b+=I.length}return y[3+t.length]=b,y.set(this.keys,b),y[3+t.length+1]=b+=this.keys.length,y.set(this.bboxes,b),b+=this.bboxes.length,y.buffer};var Ul=ye.ImageData,hc=ye.ImageBitmap,go={};function gn(t,o,u){u===void 0&&(u={}),Object.defineProperty(o,"_classRegistryKey",{value:t,writeable:!1}),go[t]={klass:o,omit:u.omit||[],shallow:u.shallow||[]}}for(var co in gn("Object",Object),Ru.serialize=function(t,o){var u=t.toArrayBuffer();return o&&o.push(u),{buffer:u}},Ru.deserialize=function(t){return new Ru(t.buffer)},gn("Grid",Ru),gn("Color",ji),gn("Error",Error),gn("ResolvedImage",aa),gn("StylePropertyFunction",Ku),gn("StyleExpression",Zc,{omit:["_evaluator"]}),gn("ZoomDependentExpression",fl),gn("ZoomConstantExpression",Ll),gn("CompoundExpression",Ka,{omit:["_evaluate"]}),Pu)Pu[co]._classRegistryKey||gn("Expression_"+co,Pu[co]);function Ju(t){return t&&typeof ArrayBuffer!="undefined"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function ka(t){return hc&&t instanceof hc}function Qs(t,o){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Ju(t)||ka(t))return o&&o.push(t),t;if(ArrayBuffer.isView(t)){var u=t;return o&&o.push(u.buffer),u}if(t instanceof Ul)return o&&o.push(t.data.buffer),t;if(Array.isArray(t)){for(var p=[],y=0,b=t;y<b.length;y+=1)p.push(Qs(b[y],o));return p}if(typeof t=="object"){var C=t.constructor,I=C._classRegistryKey;if(!I)throw new Error("can't serialize object of unregistered class");var D=C.serialize?C.serialize(t,o):{};if(!C.serialize){for(var z in t)if(t.hasOwnProperty(z)&&!(go[I].omit.indexOf(z)>=0)){var U=t[z];D[z]=go[I].shallow.indexOf(z)>=0?U:Qs(U,o)}t instanceof Error&&(D.message=t.message)}if(D.$name)throw new Error("$name property is reserved for worker serialization logic.");return I!=="Object"&&(D.$name=I),D}throw new Error("can't serialize object of type "+typeof t)}function Is(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Ju(t)||ka(t)||ArrayBuffer.isView(t)||t instanceof Ul)return t;if(Array.isArray(t))return t.map(Is);if(typeof t=="object"){var o=t.$name||"Object",u=go[o].klass;if(!u)throw new Error("can't deserialize unregistered class "+o);if(u.deserialize)return u.deserialize(t);for(var p=Object.create(u.prototype),y=0,b=Object.keys(t);y<b.length;y+=1){var C=b[y];if(C!=="$name"){var I=t[C];p[C]=go[o].shallow.indexOf(C)>=0?I:Is(I)}}return p}throw new Error("can't deserialize object of type "+typeof t)}var Af=function(){this.first=!0};Af.prototype.update=function(t,o){var u=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=o):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=o),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=u,!0))};var Vr={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function pc(t){for(var o=0,u=t;o<u.length;o+=1)if(wf(u[o].charCodeAt(0)))return!0;return!1}function wf(t){return!(t!==746&&t!==747&&(t<4352||!(Vr["Bopomofo Extended"](t)||Vr.Bopomofo(t)||Vr["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Vr["CJK Compatibility Ideographs"](t)||Vr["CJK Compatibility"](t)||Vr["CJK Radicals Supplement"](t)||Vr["CJK Strokes"](t)||!(!Vr["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||Vr["CJK Unified Ideographs Extension A"](t)||Vr["CJK Unified Ideographs"](t)||Vr["Enclosed CJK Letters and Months"](t)||Vr["Hangul Compatibility Jamo"](t)||Vr["Hangul Jamo Extended-A"](t)||Vr["Hangul Jamo Extended-B"](t)||Vr["Hangul Jamo"](t)||Vr["Hangul Syllables"](t)||Vr.Hiragana(t)||Vr["Ideographic Description Characters"](t)||Vr.Kanbun(t)||Vr["Kangxi Radicals"](t)||Vr["Katakana Phonetic Extensions"](t)||Vr.Katakana(t)&&t!==12540||!(!Vr["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!Vr["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Vr["Unified Canadian Aboriginal Syllabics"](t)||Vr["Unified Canadian Aboriginal Syllabics Extended"](t)||Vr["Vertical Forms"](t)||Vr["Yijing Hexagram Symbols"](t)||Vr["Yi Syllables"](t)||Vr["Yi Radicals"](t))))}function hl(t){return!(wf(t)||function(o){return!!(Vr["Latin-1 Supplement"](o)&&(o===167||o===169||o===174||o===177||o===188||o===189||o===190||o===215||o===247)||Vr["General Punctuation"](o)&&(o===8214||o===8224||o===8225||o===8240||o===8241||o===8251||o===8252||o===8258||o===8263||o===8264||o===8265||o===8273)||Vr["Letterlike Symbols"](o)||Vr["Number Forms"](o)||Vr["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||o===9003||o>=9085&&o<=9114||o>=9150&&o<=9165||o===9167||o>=9169&&o<=9179||o>=9186&&o<=9215)||Vr["Control Pictures"](o)&&o!==9251||Vr["Optical Character Recognition"](o)||Vr["Enclosed Alphanumerics"](o)||Vr["Geometric Shapes"](o)||Vr["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||Vr["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||Vr["CJK Symbols and Punctuation"](o)||Vr.Katakana(o)||Vr["Private Use Area"](o)||Vr["CJK Compatibility Forms"](o)||Vr["Small Form Variants"](o)||Vr["Halfwidth and Fullwidth Forms"](o)||o===8734||o===8756||o===8757||o>=9984&&o<=10087||o>=10102&&o<=10131||o===65532||o===65533)}(t))}function Aa(t){return t>=1424&&t<=2303||Vr["Arabic Presentation Forms-A"](t)||Vr["Arabic Presentation Forms-B"](t)}function As(t,o){return!(!o&&Aa(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Vr.Khmer(t))}function Tf(t){for(var o=0,u=t;o<u.length;o+=1)if(Aa(u[o].charCodeAt(0)))return!0;return!1}var ku=null,Bs="unavailable",Lu=null,qf=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(Bs="error"),ku&&ku(t)};function pl(){Kf.fire(new Ie("pluginStateChange",{pluginStatus:Bs,pluginURL:Lu}))}var Kf=new tt,Mf=function(){return Bs},vu=function(){if(Bs!=="deferred"||!Lu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Bs="loading",pl(),Lu&&Na({url:Lu},function(t){t?qf(t):(Bs="loaded",pl())})},Os={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Bs==="loaded"||Os.applyArabicShaping!=null},isLoading:function(){return Bs==="loading"},setState:function(t){Bs=t.pluginStatus,Lu=t.pluginURL},isParsed:function(){return Os.applyArabicShaping!=null&&Os.processBidirectionalText!=null&&Os.processStyledBidirectionalText!=null},getPluginURL:function(){return Lu}},Mi=function(t,o){this.zoom=t,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.zoomHistory=o.zoomHistory,this.transition=o.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Af,this.transition={})};Mi.prototype.isSupportedScript=function(t){return function(o,u){for(var p=0,y=o;p<y.length;p+=1)if(!As(y[p].charCodeAt(0),u))return!1;return!0}(t,Os.isLoaded())},Mi.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Mi.prototype.getCrossfadeParameters=function(){var t=this.zoom,o=t-Math.floor(t),u=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:o+(1-o)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*o}};var Du=function(t,o){this.property=t,this.value=o,this.expression=function(u,p){if(kl(u))return new Ku(u,p);if(oc(u)){var y=Dl(u,p);if(y.result==="error")throw new Error(y.value.map(function(C){return C.key+": "+C.message}).join(", "));return y.value}var b=u;return typeof u=="string"&&p.type==="color"&&(b=ji.parse(u)),{kind:"constant",evaluate:function(){return b}}}(o===void 0?t.specification.default:o,t.specification)};Du.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Du.prototype.possiblyEvaluate=function(t,o,u){return this.property.possiblyEvaluate(this,t,o,u)};var mu=function(t){this.property=t,this.value=new Du(t,void 0)};mu.prototype.transitioned=function(t,o){return new dl(this.property,this.value,o,Mt({},t.transition,this.transition),t.now)},mu.prototype.untransitioned=function(){return new dl(this.property,this.value,null,{},0)};var Go=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};Go.prototype.getValue=function(t){return $e(this._values[t].value.value)},Go.prototype.setValue=function(t,o){this._values.hasOwnProperty(t)||(this._values[t]=new mu(this._values[t].property)),this._values[t].value=new Du(this._values[t].property,o===null?void 0:$e(o))},Go.prototype.getTransition=function(t){return $e(this._values[t].transition)},Go.prototype.setTransition=function(t,o){this._values.hasOwnProperty(t)||(this._values[t]=new mu(this._values[t].property)),this._values[t].transition=$e(o)||void 0},Go.prototype.serialize=function(){for(var t={},o=0,u=Object.keys(this._values);o<u.length;o+=1){var p=u[o],y=this.getValue(p);y!==void 0&&(t[p]=y);var b=this.getTransition(p);b!==void 0&&(t[p+"-transition"]=b)}return t},Go.prototype.transitioned=function(t,o){for(var u=new os(this._properties),p=0,y=Object.keys(this._values);p<y.length;p+=1){var b=y[p];u._values[b]=this._values[b].transitioned(t,o._values[b])}return u},Go.prototype.untransitioned=function(){for(var t=new os(this._properties),o=0,u=Object.keys(this._values);o<u.length;o+=1){var p=u[o];t._values[p]=this._values[p].untransitioned()}return t};var dl=function(t,o,u,p,y){this.property=t,this.value=o,this.begin=y+p.delay||0,this.end=this.begin+p.duration||0,t.specification.transition&&(p.delay||p.duration)&&(this.prior=u)};dl.prototype.possiblyEvaluate=function(t,o,u){var p=t.now||0,y=this.value.possiblyEvaluate(t,o,u),b=this.prior;if(b){if(p>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(p<this.begin)return b.possiblyEvaluate(t,o,u);var C=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(t,o,u),y,function(I){if(I<=0)return 0;if(I>=1)return 1;var D=I*I,z=D*I;return 4*(I<.5?z:3*(I-D)+z-.75)}(C))}return y};var os=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};os.prototype.possiblyEvaluate=function(t,o,u){for(var p=new Eu(this._properties),y=0,b=Object.keys(this._values);y<b.length;y+=1){var C=b[y];p._values[C]=this._values[C].possiblyEvaluate(t,o,u)}return p},os.prototype.hasTransition=function(){for(var t=0,o=Object.keys(this._values);t<o.length;t+=1)if(this._values[o[t]].prior)return!0;return!1};var Js=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};Js.prototype.getValue=function(t){return $e(this._values[t].value)},Js.prototype.setValue=function(t,o){this._values[t]=new Du(this._values[t].property,o===null?void 0:$e(o))},Js.prototype.serialize=function(){for(var t={},o=0,u=Object.keys(this._values);o<u.length;o+=1){var p=u[o],y=this.getValue(p);y!==void 0&&(t[p]=y)}return t},Js.prototype.possiblyEvaluate=function(t,o,u){for(var p=new Eu(this._properties),y=0,b=Object.keys(this._values);y<b.length;y+=1){var C=b[y];p._values[C]=this._values[C].possiblyEvaluate(t,o,u)}return p};var ws=function(t,o,u){this.property=t,this.value=o,this.parameters=u};ws.prototype.isConstant=function(){return this.value.kind==="constant"},ws.prototype.constantOr=function(t){return this.value.kind==="constant"?this.value.value:t},ws.prototype.evaluate=function(t,o,u,p){return this.property.evaluate(this.value,this.parameters,t,o,u,p)};var Eu=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};Eu.prototype.get=function(t){return this._values[t]};var Ln=function(t){this.specification=t};Ln.prototype.possiblyEvaluate=function(t,o){return t.expression.evaluate(o)},Ln.prototype.interpolate=function(t,o,u){var p=_a[this.specification.type];return p?p(t,o,u):t};var wn=function(t,o){this.specification=t,this.overrides=o};wn.prototype.possiblyEvaluate=function(t,o,u,p){return new ws(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(o,null,{},u,p)}:t.expression,o)},wn.prototype.interpolate=function(t,o,u){if(t.value.kind!=="constant"||o.value.kind!=="constant")return t;if(t.value.value===void 0||o.value.value===void 0)return new ws(this,{kind:"constant",value:void 0},t.parameters);var p=_a[this.specification.type];return p?new ws(this,{kind:"constant",value:p(t.value.value,o.value.value,u)},t.parameters):t},wn.prototype.evaluate=function(t,o,u,p,y,b){return t.kind==="constant"?t.value:t.evaluate(o,u,p,y,b)};var Hc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.possiblyEvaluate=function(u,p,y,b){if(u.value===void 0)return new ws(this,{kind:"constant",value:void 0},p);if(u.expression.kind==="constant"){var C=u.expression.evaluate(p,null,{},y,b),I=u.property.specification.type==="resolvedImage"&&typeof C!="string"?C.name:C,D=this._calculate(I,I,I,p);return new ws(this,{kind:"constant",value:D},p)}if(u.expression.kind==="camera"){var z=this._calculate(u.expression.evaluate({zoom:p.zoom-1}),u.expression.evaluate({zoom:p.zoom}),u.expression.evaluate({zoom:p.zoom+1}),p);return new ws(this,{kind:"constant",value:z},p)}return new ws(this,u.expression,p)},o.prototype.evaluate=function(u,p,y,b,C,I){if(u.kind==="source"){var D=u.evaluate(p,y,b,C,I);return this._calculate(D,D,D,p)}return u.kind==="composite"?this._calculate(u.evaluate({zoom:Math.floor(p.zoom)-1},y,b),u.evaluate({zoom:Math.floor(p.zoom)},y,b),u.evaluate({zoom:Math.floor(p.zoom)+1},y,b),p):u.value},o.prototype._calculate=function(u,p,y,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:u,to:p}:{from:y,to:p}},o.prototype.interpolate=function(u){return u},o}(wn),Qo=function(t){this.specification=t};Qo.prototype.possiblyEvaluate=function(t,o,u,p){if(t.value!==void 0){if(t.expression.kind==="constant"){var y=t.expression.evaluate(o,null,{},u,p);return this._calculate(y,y,y,o)}return this._calculate(t.expression.evaluate(new Mi(Math.floor(o.zoom-1),o)),t.expression.evaluate(new Mi(Math.floor(o.zoom),o)),t.expression.evaluate(new Mi(Math.floor(o.zoom+1),o)),o)}},Qo.prototype._calculate=function(t,o,u,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:t,to:o}:{from:u,to:o}},Qo.prototype.interpolate=function(t){return t};var eu=function(t){this.specification=t};eu.prototype.possiblyEvaluate=function(t,o,u,p){return!!t.expression.evaluate(o,null,{},u,p)},eu.prototype.interpolate=function(){return!1};var Ho=function(t){for(var o in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var u=t[o];u.specification.overridable&&this.overridableProperties.push(o);var p=this.defaultPropertyValues[o]=new Du(u,void 0),y=this.defaultTransitionablePropertyValues[o]=new mu(u);this.defaultTransitioningPropertyValues[o]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=p.possiblyEvaluate({})}};gn("DataDrivenProperty",wn),gn("DataConstantProperty",Ln),gn("CrossFadedDataDrivenProperty",Hc),gn("CrossFadedProperty",Qo),gn("ColorRampProperty",eu);var gu=function(t){function o(u,p){if(t.call(this),this.id=u.id,this.type=u.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},u.type!=="custom"&&(this.metadata=(u=u).metadata,this.minzoom=u.minzoom,this.maxzoom=u.maxzoom,u.type!=="background"&&(this.source=u.source,this.sourceLayer=u["source-layer"],this.filter=u.filter),p.layout&&(this._unevaluatedLayout=new Js(p.layout)),p.paint)){for(var y in this._transitionablePaint=new Go(p.paint),u.paint)this.setPaintProperty(y,u.paint[y],{validate:!1});for(var b in u.layout)this.setLayoutProperty(b,u.layout[b],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Eu(p.paint)}}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},o.prototype.getLayoutProperty=function(u){return u==="visibility"?this.visibility:this._unevaluatedLayout.getValue(u)},o.prototype.setLayoutProperty=function(u,p,y){y===void 0&&(y={}),p!=null&&this._validate(Qu,"layers."+this.id+".layout."+u,u,p,y)||(u!=="visibility"?this._unevaluatedLayout.setValue(u,p):this.visibility=p)},o.prototype.getPaintProperty=function(u){return K(u,"-transition")?this._transitionablePaint.getTransition(u.slice(0,-"-transition".length)):this._transitionablePaint.getValue(u)},o.prototype.setPaintProperty=function(u,p,y){if(y===void 0&&(y={}),p!=null&&this._validate(Zl,"layers."+this.id+".paint."+u,u,p,y))return!1;if(K(u,"-transition"))return this._transitionablePaint.setTransition(u.slice(0,-"-transition".length),p||void 0),!1;var b=this._transitionablePaint._values[u],C=b.property.specification["property-type"]==="cross-faded-data-driven",I=b.value.isDataDriven(),D=b.value;this._transitionablePaint.setValue(u,p),this._handleSpecialPaintPropertyUpdate(u);var z=this._transitionablePaint._values[u].value;return z.isDataDriven()||I||C||this._handleOverridablePaintPropertyUpdate(u,D,z)},o.prototype._handleSpecialPaintPropertyUpdate=function(u){},o.prototype._handleOverridablePaintPropertyUpdate=function(u,p,y){return!1},o.prototype.isHidden=function(u){return!!(this.minzoom&&u<this.minzoom)||!!(this.maxzoom&&u>=this.maxzoom)||this.visibility==="none"},o.prototype.updateTransitions=function(u){this._transitioningPaint=this._transitionablePaint.transitioned(u,this._transitioningPaint)},o.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},o.prototype.recalculate=function(u,p){u.getCrossfadeParameters&&(this._crossfadeParameters=u.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(u,void 0,p)),this.paint=this._transitioningPaint.possiblyEvaluate(u,void 0,p)},o.prototype.serialize=function(){var u={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(u.layout=u.layout||{},u.layout.visibility=this.visibility),lt(u,function(p,y){return!(p===void 0||y==="layout"&&!Object.keys(p).length||y==="paint"&&!Object.keys(p).length)})},o.prototype._validate=function(u,p,y,b,C){return C===void 0&&(C={}),(!C||C.validate!==!1)&&Gc(this,u.call(Ua,{key:p,layerType:this.type,objectKey:y,value:b,styleSpec:ce,style:{glyphs:!0,sprite:!0}}))},o.prototype.is3D=function(){return!1},o.prototype.isTileClipped=function(){return!1},o.prototype.hasOffscreenPass=function(){return!1},o.prototype.resize=function(){},o.prototype.isStateDependent=function(){for(var u in this.paint._values){var p=this.paint.get(u);if(p instanceof ws&&pu(p.property.specification)&&(p.value.kind==="source"||p.value.kind==="composite")&&p.value.isStateDependent)return!0}return!1},o}(tt),$f={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Wc=function(t,o){this._structArray=t,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},ga=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function La(t,o){o===void 0&&(o=1);var u=0,p=0;return{members:t.map(function(y){var b=$f[y.type].BYTES_PER_ELEMENT,C=u=vl(u,Math.max(o,b)),I=y.components||1;return p=Math.max(p,b),u+=b*I,{name:y.name,type:y.type,components:I,offset:C}}),size:vl(u,Math.max(p,o)),alignment:o}}function vl(t,o){return Math.ceil(t/o)*o}ga.serialize=function(t,o){return t._trim(),o&&(t.isTransferred=!0,o.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},ga.deserialize=function(t){var o=Object.create(this.prototype);return o.arrayBuffer=t.arrayBuffer,o.length=t.length,o.capacity=t.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o},ga.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},ga.prototype.clear=function(){this.length=0},ga.prototype.resize=function(t){this.reserve(t),this.length=t},ga.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}},ga.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var dc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p){var y=this.length;return this.resize(y+1),this.emplace(y,u,p)},o.prototype.emplace=function(u,p,y){var b=2*u;return this.int16[b+0]=p,this.int16[b+1]=y,u},o}(ga);dc.prototype.bytesPerElement=4,gn("StructArrayLayout2i4",dc);var Ns=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b){var C=this.length;return this.resize(C+1),this.emplace(C,u,p,y,b)},o.prototype.emplace=function(u,p,y,b,C){var I=4*u;return this.int16[I+0]=p,this.int16[I+1]=y,this.int16[I+2]=b,this.int16[I+3]=C,u},o}(ga);Ns.prototype.bytesPerElement=8,gn("StructArrayLayout4i8",Ns);var yu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,C,I){var D=this.length;return this.resize(D+1),this.emplace(D,u,p,y,b,C,I)},o.prototype.emplace=function(u,p,y,b,C,I,D){var z=6*u;return this.int16[z+0]=p,this.int16[z+1]=y,this.int16[z+2]=b,this.int16[z+3]=C,this.int16[z+4]=I,this.int16[z+5]=D,u},o}(ga);yu.prototype.bytesPerElement=12,gn("StructArrayLayout2i4i12",yu);var pi=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,C,I){var D=this.length;return this.resize(D+1),this.emplace(D,u,p,y,b,C,I)},o.prototype.emplace=function(u,p,y,b,C,I,D){var z=4*u,U=8*u;return this.int16[z+0]=p,this.int16[z+1]=y,this.uint8[U+4]=b,this.uint8[U+5]=C,this.uint8[U+6]=I,this.uint8[U+7]=D,u},o}(ga);pi.prototype.bytesPerElement=8,gn("StructArrayLayout2i4ub8",pi);var zs=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p){var y=this.length;return this.resize(y+1),this.emplace(y,u,p)},o.prototype.emplace=function(u,p,y){var b=2*u;return this.float32[b+0]=p,this.float32[b+1]=y,u},o}(ga);zs.prototype.bytesPerElement=8,gn("StructArrayLayout2f8",zs);var ss=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,C,I,D,z,U,G){var q=this.length;return this.resize(q+1),this.emplace(q,u,p,y,b,C,I,D,z,U,G)},o.prototype.emplace=function(u,p,y,b,C,I,D,z,U,G,q){var ie=10*u;return this.uint16[ie+0]=p,this.uint16[ie+1]=y,this.uint16[ie+2]=b,this.uint16[ie+3]=C,this.uint16[ie+4]=I,this.uint16[ie+5]=D,this.uint16[ie+6]=z,this.uint16[ie+7]=U,this.uint16[ie+8]=G,this.uint16[ie+9]=q,u},o}(ga);ss.prototype.bytesPerElement=20,gn("StructArrayLayout10ui20",ss);var jl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,C,I,D,z,U,G,q,ie){var Pe=this.length;return this.resize(Pe+1),this.emplace(Pe,u,p,y,b,C,I,D,z,U,G,q,ie)},o.prototype.emplace=function(u,p,y,b,C,I,D,z,U,G,q,ie,Pe){var Re=12*u;return this.int16[Re+0]=p,this.int16[Re+1]=y,this.int16[Re+2]=b,this.int16[Re+3]=C,this.uint16[Re+4]=I,this.uint16[Re+5]=D,this.uint16[Re+6]=z,this.uint16[Re+7]=U,this.int16[Re+8]=G,this.int16[Re+9]=q,this.int16[Re+10]=ie,this.int16[Re+11]=Pe,u},o}(ga);jl.prototype.bytesPerElement=24,gn("StructArrayLayout4i4ui4i24",jl);var Fu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,p,y)},o.prototype.emplace=function(u,p,y,b){var C=3*u;return this.float32[C+0]=p,this.float32[C+1]=y,this.float32[C+2]=b,u},o}(ga);Fu.prototype.bytesPerElement=12,gn("StructArrayLayout3f12",Fu);var el=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var p=this.length;return this.resize(p+1),this.emplace(p,u)},o.prototype.emplace=function(u,p){return this.uint32[1*u+0]=p,u},o}(ga);el.prototype.bytesPerElement=4,gn("StructArrayLayout1ul4",el);var Xc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,C,I,D,z,U){var G=this.length;return this.resize(G+1),this.emplace(G,u,p,y,b,C,I,D,z,U)},o.prototype.emplace=function(u,p,y,b,C,I,D,z,U,G){var q=10*u,ie=5*u;return this.int16[q+0]=p,this.int16[q+1]=y,this.int16[q+2]=b,this.int16[q+3]=C,this.int16[q+4]=I,this.int16[q+5]=D,this.uint32[ie+3]=z,this.uint16[q+8]=U,this.uint16[q+9]=G,u},o}(ga);Xc.prototype.bytesPerElement=20,gn("StructArrayLayout6i1ul2ui20",Xc);var Da=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,C,I){var D=this.length;return this.resize(D+1),this.emplace(D,u,p,y,b,C,I)},o.prototype.emplace=function(u,p,y,b,C,I,D){var z=6*u;return this.int16[z+0]=p,this.int16[z+1]=y,this.int16[z+2]=b,this.int16[z+3]=C,this.int16[z+4]=I,this.int16[z+5]=D,u},o}(ga);Da.prototype.bytesPerElement=12,gn("StructArrayLayout2i2i2i12",Da);var tu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,C){var I=this.length;return this.resize(I+1),this.emplace(I,u,p,y,b,C)},o.prototype.emplace=function(u,p,y,b,C,I){var D=4*u,z=8*u;return this.float32[D+0]=p,this.float32[D+1]=y,this.float32[D+2]=b,this.int16[z+6]=C,this.int16[z+7]=I,u},o}(ga);tu.prototype.bytesPerElement=16,gn("StructArrayLayout2f1f2i16",tu);var Vl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b){var C=this.length;return this.resize(C+1),this.emplace(C,u,p,y,b)},o.prototype.emplace=function(u,p,y,b,C){var I=12*u,D=3*u;return this.uint8[I+0]=p,this.uint8[I+1]=y,this.float32[D+1]=b,this.float32[D+2]=C,u},o}(ga);Vl.prototype.bytesPerElement=12,gn("StructArrayLayout2ub2f12",Vl);var ml=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,p,y)},o.prototype.emplace=function(u,p,y,b){var C=3*u;return this.uint16[C+0]=p,this.uint16[C+1]=y,this.uint16[C+2]=b,u},o}(ga);ml.prototype.bytesPerElement=6,gn("StructArrayLayout3ui6",ml);var gl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,C,I,D,z,U,G,q,ie,Pe,Re,k,Ze,at){var Ct=this.length;return this.resize(Ct+1),this.emplace(Ct,u,p,y,b,C,I,D,z,U,G,q,ie,Pe,Re,k,Ze,at)},o.prototype.emplace=function(u,p,y,b,C,I,D,z,U,G,q,ie,Pe,Re,k,Ze,at,Ct){var zt=24*u,Vt=12*u,sr=48*u;return this.int16[zt+0]=p,this.int16[zt+1]=y,this.uint16[zt+2]=b,this.uint16[zt+3]=C,this.uint32[Vt+2]=I,this.uint32[Vt+3]=D,this.uint32[Vt+4]=z,this.uint16[zt+10]=U,this.uint16[zt+11]=G,this.uint16[zt+12]=q,this.float32[Vt+7]=ie,this.float32[Vt+8]=Pe,this.uint8[sr+36]=Re,this.uint8[sr+37]=k,this.uint8[sr+38]=Ze,this.uint32[Vt+10]=at,this.int16[zt+22]=Ct,u},o}(ga);gl.prototype.bytesPerElement=48,gn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",gl);var Yc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,C,I,D,z,U,G,q,ie,Pe,Re,k,Ze,at,Ct,zt,Vt,sr,Pr,Br,zn,hn,Wn,dn,Ri){var ti=this.length;return this.resize(ti+1),this.emplace(ti,u,p,y,b,C,I,D,z,U,G,q,ie,Pe,Re,k,Ze,at,Ct,zt,Vt,sr,Pr,Br,zn,hn,Wn,dn,Ri)},o.prototype.emplace=function(u,p,y,b,C,I,D,z,U,G,q,ie,Pe,Re,k,Ze,at,Ct,zt,Vt,sr,Pr,Br,zn,hn,Wn,dn,Ri,ti){var Mn=34*u,Vi=17*u;return this.int16[Mn+0]=p,this.int16[Mn+1]=y,this.int16[Mn+2]=b,this.int16[Mn+3]=C,this.int16[Mn+4]=I,this.int16[Mn+5]=D,this.int16[Mn+6]=z,this.int16[Mn+7]=U,this.uint16[Mn+8]=G,this.uint16[Mn+9]=q,this.uint16[Mn+10]=ie,this.uint16[Mn+11]=Pe,this.uint16[Mn+12]=Re,this.uint16[Mn+13]=k,this.uint16[Mn+14]=Ze,this.uint16[Mn+15]=at,this.uint16[Mn+16]=Ct,this.uint16[Mn+17]=zt,this.uint16[Mn+18]=Vt,this.uint16[Mn+19]=sr,this.uint16[Mn+20]=Pr,this.uint16[Mn+21]=Br,this.uint16[Mn+22]=zn,this.uint32[Vi+12]=hn,this.float32[Vi+13]=Wn,this.float32[Vi+14]=dn,this.float32[Vi+15]=Ri,this.float32[Vi+16]=ti,u},o}(ga);Yc.prototype.bytesPerElement=68,gn("StructArrayLayout8i15ui1ul4f68",Yc);var yl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var p=this.length;return this.resize(p+1),this.emplace(p,u)},o.prototype.emplace=function(u,p){return this.float32[1*u+0]=p,u},o}(ga);yl.prototype.bytesPerElement=4,gn("StructArrayLayout1f4",yl);var ru=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,p,y)},o.prototype.emplace=function(u,p,y,b){var C=3*u;return this.int16[C+0]=p,this.int16[C+1]=y,this.int16[C+2]=b,u},o}(ga);ru.prototype.bytesPerElement=6,gn("StructArrayLayout3i6",ru);var vc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,p,y)},o.prototype.emplace=function(u,p,y,b){var C=4*u;return this.uint32[2*u+0]=p,this.uint16[C+2]=y,this.uint16[C+3]=b,u},o}(ga);vc.prototype.bytesPerElement=8,gn("StructArrayLayout1ul2ui8",vc);var Gl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p){var y=this.length;return this.resize(y+1),this.emplace(y,u,p)},o.prototype.emplace=function(u,p,y){var b=2*u;return this.uint16[b+0]=p,this.uint16[b+1]=y,u},o}(ga);Gl.prototype.bytesPerElement=4,gn("StructArrayLayout2ui4",Gl);var Qf=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var p=this.length;return this.resize(p+1),this.emplace(p,u)},o.prototype.emplace=function(u,p){return this.uint16[1*u+0]=p,u},o}(ga);Qf.prototype.bytesPerElement=2,gn("StructArrayLayout1ui2",Qf);var Hl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b){var C=this.length;return this.resize(C+1),this.emplace(C,u,p,y,b)},o.prototype.emplace=function(u,p,y,b,C){var I=4*u;return this.float32[I+0]=p,this.float32[I+1]=y,this.float32[I+2]=b,this.float32[I+3]=C,u},o}(ga);Hl.prototype.bytesPerElement=16,gn("StructArrayLayout4f16",Hl);var l=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return u.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},u.x1.get=function(){return this._structArray.int16[this._pos2+2]},u.y1.get=function(){return this._structArray.int16[this._pos2+3]},u.x2.get=function(){return this._structArray.int16[this._pos2+4]},u.y2.get=function(){return this._structArray.int16[this._pos2+5]},u.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},u.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},u.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},u.anchorPoint.get=function(){return new le(this.anchorPointX,this.anchorPointY)},Object.defineProperties(o.prototype,u),o}(Wc);l.prototype.size=20;var h=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new l(this,u)},o}(Xc);gn("CollisionBoxArray",h);var c=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return u.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},u.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},u.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},u.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},u.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},u.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},u.segment.get=function(){return this._structArray.uint16[this._pos2+10]},u.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},u.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},u.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},u.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},u.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},u.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},u.placedOrientation.set=function(p){this._structArray.uint8[this._pos1+37]=p},u.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},u.hidden.set=function(p){this._structArray.uint8[this._pos1+38]=p},u.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},u.crossTileID.set=function(p){this._structArray.uint32[this._pos4+10]=p},u.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(o.prototype,u),o}(Wc);c.prototype.size=48;var d=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new c(this,u)},o}(gl);gn("PlacedSymbolArray",d);var E=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return u.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},u.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},u.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},u.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},u.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},u.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},u.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},u.key.get=function(){return this._structArray.uint16[this._pos2+8]},u.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},u.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},u.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},u.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},u.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},u.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},u.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},u.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},u.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},u.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},u.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},u.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},u.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},u.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},u.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},u.crossTileID.set=function(p){this._structArray.uint32[this._pos4+12]=p},u.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},u.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},u.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},u.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(o.prototype,u),o}(Wc);E.prototype.size=68;var w=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new E(this,u)},o}(Yc);gn("SymbolInstanceArray",w);var P=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getoffsetX=function(u){return this.float32[1*u+0]},o}(yl);gn("GlyphOffsetArray",P);var L=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getx=function(u){return this.int16[3*u+0]},o.prototype.gety=function(u){return this.int16[3*u+1]},o.prototype.gettileUnitDistanceFromAnchor=function(u){return this.int16[3*u+2]},o}(ru);gn("SymbolLineVertexArray",L);var Z=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return u.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},u.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},u.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(o.prototype,u),o}(Wc);Z.prototype.size=8;var X=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new Z(this,u)},o}(vc);gn("FeatureIndexArray",X);var se=La([{name:"a_pos",components:2,type:"Int16"}],4).members,fe=function(t){t===void 0&&(t=[]),this.segments=t};function de(t,o){return 256*(t=$t(Math.floor(t),0,255))+$t(Math.floor(o),0,255)}fe.prototype.prepareSegment=function(t,o,u,p){var y=this.segments[this.segments.length-1];return t>fe.MAX_VERTEX_ARRAY_LENGTH&&et("Max vertices per segment is "+fe.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!y||y.vertexLength+t>fe.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==p)&&(y={vertexOffset:o.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},p!==void 0&&(y.sortKey=p),this.segments.push(y)),y},fe.prototype.get=function(){return this.segments},fe.prototype.destroy=function(){for(var t=0,o=this.segments;t<o.length;t+=1){var u=o[t];for(var p in u.vaos)u.vaos[p].destroy()}},fe.simpleSegment=function(t,o,u,p){return new fe([{vertexOffset:t,primitiveOffset:o,vertexLength:u,primitiveLength:p,vaos:{},sortKey:0}])},fe.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,gn("SegmentVector",fe);var ke=La([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Oe=Ee(function(t){t.exports=function(o,u){var p,y,b,C,I,D,z,U;for(y=o.length-(p=3&o.length),b=u,I=3432918353,D=461845907,U=0;U<y;)z=255&o.charCodeAt(U)|(255&o.charCodeAt(++U))<<8|(255&o.charCodeAt(++U))<<16|(255&o.charCodeAt(++U))<<24,++U,b=27492+(65535&(C=5*(65535&(b=(b^=z=(65535&(z=(z=(65535&z)*I+(((z>>>16)*I&65535)<<16)&4294967295)<<15|z>>>17))*D+(((z>>>16)*D&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(C>>>16)&65535)<<16);switch(z=0,p){case 3:z^=(255&o.charCodeAt(U+2))<<16;case 2:z^=(255&o.charCodeAt(U+1))<<8;case 1:b^=z=(65535&(z=(z=(65535&(z^=255&o.charCodeAt(U)))*I+(((z>>>16)*I&65535)<<16)&4294967295)<<15|z>>>17))*D+(((z>>>16)*D&65535)<<16)&4294967295}return b^=o.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0}}),ze=Ee(function(t){t.exports=function(o,u){for(var p,y=o.length,b=u^y,C=0;y>=4;)p=1540483477*(65535&(p=255&o.charCodeAt(C)|(255&o.charCodeAt(++C))<<8|(255&o.charCodeAt(++C))<<16|(255&o.charCodeAt(++C))<<24))+((1540483477*(p>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),y-=4,++C;switch(y){case 3:b^=(255&o.charCodeAt(C+2))<<16;case 2:b^=(255&o.charCodeAt(C+1))<<8;case 1:b=1540483477*(65535&(b^=255&o.charCodeAt(C)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0}}),Ce=Oe,je=ze;Ce.murmur3=Oe,Ce.murmur2=je;var Qe=function(){this.ids=[],this.positions=[],this.indexed=!1};Qe.prototype.add=function(t,o,u,p){this.ids.push(Gt(t)),this.positions.push(o,u,p)},Qe.prototype.getPositions=function(t){for(var o=Gt(t),u=0,p=this.ids.length-1;u<p;){var y=u+p>>1;this.ids[y]>=o?p=y:u=y+1}for(var b=[];this.ids[u]===o;)b.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return b},Qe.serialize=function(t,o){var u=new Float64Array(t.ids),p=new Uint32Array(t.positions);return function y(b,C,I,D){for(;I<D;){for(var z=b[I+D>>1],U=I-1,G=D+1;;){do U++;while(b[U]<z);do G--;while(b[G]>z);if(U>=G)break;Ut(b,U,G),Ut(C,3*U,3*G),Ut(C,3*U+1,3*G+1),Ut(C,3*U+2,3*G+2)}G-I<D-G?(y(b,C,I,G),I=G+1):(y(b,C,G+1,D),D=G)}}(u,p,0,u.length-1),o&&o.push(u.buffer,p.buffer),{ids:u,positions:p}},Qe.deserialize=function(t){var o=new Qe;return o.ids=t.ids,o.positions=t.positions,o.indexed=!0,o};var gt=Math.pow(2,53)-1;function Gt(t){var o=+t;return!isNaN(o)&&o<=gt?o:Ce(String(t))}function Ut(t,o,u){var p=t[o];t[o]=t[u],t[u]=p}gn("FeaturePositionMap",Qe);var Yt=function(t,o){this.gl=t.gl,this.location=o},vr=function(t){function o(u,p){t.call(this,u,p),this.current=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))},o}(Yt),Dr=function(t){function o(u,p){t.call(this,u,p),this.current=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))},o}(Yt),_r=function(t){function o(u,p){t.call(this,u,p),this.current=[0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1]))},o}(Yt),ln=function(t){function o(u,p){t.call(this,u,p),this.current=[0,0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2]))},o}(Yt),Gn=function(t){function o(u,p){t.call(this,u,p),this.current=[0,0,0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3]))},o}(Yt),Hn=function(t){function o(u,p){t.call(this,u,p),this.current=ji.transparent}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a))},o}(Yt),Bn=new Float32Array(16),Di=function(t){function o(u,p){t.call(this,u,p),this.current=Bn}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(var p=1;p<16;p++)if(u[p]!==this.current[p]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}},o}(Yt);function rn(t){return[de(255*t.r,255*t.g),de(255*t.b,255*t.a)]}var oi=function(t,o,u){this.value=t,this.uniformNames=o.map(function(p){return"u_"+p}),this.type=u};oi.prototype.setUniform=function(t,o,u){t.set(u.constantOr(this.value))},oi.prototype.getBinding=function(t,o,u){return this.type==="color"?new Hn(t,o):new Dr(t,o)};var ci=function(t,o){this.uniformNames=o.map(function(u){return"u_"+u}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};ci.prototype.setConstantPatternPositions=function(t,o){this.pixelRatioFrom=o.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=o.tlbr,this.patternTo=t.tlbr},ci.prototype.setUniform=function(t,o,u,p){var y=p==="u_pattern_to"?this.patternTo:p==="u_pattern_from"?this.patternFrom:p==="u_pixel_ratio_to"?this.pixelRatioTo:p==="u_pixel_ratio_from"?this.pixelRatioFrom:null;y&&t.set(y)},ci.prototype.getBinding=function(t,o,u){return u.substr(0,9)==="u_pattern"?new Gn(t,o):new Dr(t,o)};var Qn=function(t,o,u,p){this.expression=t,this.type=u,this.maxValue=0,this.paintVertexAttributes=o.map(function(y){return{name:"a_"+y,type:"Float32",components:u==="color"?2:1,offset:0}}),this.paintVertexArray=new p};Qn.prototype.populatePaintArray=function(t,o,u,p,y){var b=this.paintVertexArray.length,C=this.expression.evaluate(new Mi(0),o,{},p,[],y);this.paintVertexArray.resize(t),this._setPaintValue(b,t,C)},Qn.prototype.updatePaintArray=function(t,o,u,p){var y=this.expression.evaluate({zoom:0},u,p);this._setPaintValue(t,o,y)},Qn.prototype._setPaintValue=function(t,o,u){if(this.type==="color")for(var p=rn(u),y=t;y<o;y++)this.paintVertexArray.emplace(y,p[0],p[1]);else{for(var b=t;b<o;b++)this.paintVertexArray.emplace(b,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}},Qn.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Qn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Xn=function(t,o,u,p,y,b){this.expression=t,this.uniformNames=o.map(function(C){return"u_"+C+"_t"}),this.type=u,this.useIntegerZoom=p,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=o.map(function(C){return{name:"a_"+C,type:"Float32",components:u==="color"?4:2,offset:0}}),this.paintVertexArray=new b};Xn.prototype.populatePaintArray=function(t,o,u,p,y){var b=this.expression.evaluate(new Mi(this.zoom),o,{},p,[],y),C=this.expression.evaluate(new Mi(this.zoom+1),o,{},p,[],y),I=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(I,t,b,C)},Xn.prototype.updatePaintArray=function(t,o,u,p){var y=this.expression.evaluate({zoom:this.zoom},u,p),b=this.expression.evaluate({zoom:this.zoom+1},u,p);this._setPaintValue(t,o,y,b)},Xn.prototype._setPaintValue=function(t,o,u,p){if(this.type==="color")for(var y=rn(u),b=rn(p),C=t;C<o;C++)this.paintVertexArray.emplace(C,y[0],y[1],b[0],b[1]);else{for(var I=t;I<o;I++)this.paintVertexArray.emplace(I,u,p);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(p))}},Xn.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Xn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Xn.prototype.setUniform=function(t,o){var u=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,p=$t(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);t.set(p)},Xn.prototype.getBinding=function(t,o,u){return new Dr(t,o)};var di=function(t,o,u,p,y,b){this.expression=t,this.type=o,this.useIntegerZoom=u,this.zoom=p,this.layerId=b,this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y};di.prototype.populatePaintArray=function(t,o,u){var p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(p,t,o.patterns&&o.patterns[this.layerId],u)},di.prototype.updatePaintArray=function(t,o,u,p,y){this._setPaintValues(t,o,u.patterns&&u.patterns[this.layerId],y)},di.prototype._setPaintValues=function(t,o,u,p){if(p&&u){var y=p[u.min],b=p[u.mid],C=p[u.max];if(y&&b&&C)for(var I=t;I<o;I++)this.zoomInPaintVertexArray.emplace(I,b.tl[0],b.tl[1],b.br[0],b.br[1],y.tl[0],y.tl[1],y.br[0],y.br[1],b.pixelRatio,y.pixelRatio),this.zoomOutPaintVertexArray.emplace(I,b.tl[0],b.tl[1],b.br[0],b.br[1],C.tl[0],C.tl[1],C.br[0],C.br[1],b.pixelRatio,C.pixelRatio)}},di.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,ke.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,ke.members,this.expression.isStateDependent))},di.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var $n=function(t,o,u){this.binders={},this._buffers=[];var p=[];for(var y in t.paint._values)if(u(y)){var b=t.paint.get(y);if(b instanceof ws&&pu(b.property.specification)){var C=yo(y,t.type),I=b.value,D=b.property.specification.type,z=b.property.useIntegerZoom,U=b.property.specification["property-type"],G=U==="cross-faded"||U==="cross-faded-data-driven";if(I.kind==="constant")this.binders[y]=G?new ci(I.value,C):new oi(I.value,C,D),p.push("/u_"+y);else if(I.kind==="source"||G){var q=Qa(y,D,"source");this.binders[y]=G?new di(I,D,z,o,q,t.id):new Qn(I,C,D,q),p.push("/a_"+y)}else{var ie=Qa(y,D,"composite");this.binders[y]=new Xn(I,C,D,z,o,ie),p.push("/z_"+y)}}}this.cacheKey=p.sort().join("")};$n.prototype.getMaxValue=function(t){var o=this.binders[t];return o instanceof Qn||o instanceof Xn?o.maxValue:0},$n.prototype.populatePaintArrays=function(t,o,u,p,y){for(var b in this.binders){var C=this.binders[b];(C instanceof Qn||C instanceof Xn||C instanceof di)&&C.populatePaintArray(t,o,u,p,y)}},$n.prototype.setConstantPatternPositions=function(t,o){for(var u in this.binders){var p=this.binders[u];p instanceof ci&&p.setConstantPatternPositions(t,o)}},$n.prototype.updatePaintArrays=function(t,o,u,p,y){var b=!1;for(var C in t)for(var I=0,D=o.getPositions(C);I<D.length;I+=1){var z=D[I],U=u.feature(z.index);for(var G in this.binders){var q=this.binders[G];if((q instanceof Qn||q instanceof Xn||q instanceof di)&&q.expression.isStateDependent===!0){var ie=p.paint.get(G);q.expression=ie.value,q.updatePaintArray(z.start,z.end,U,t[C],y),b=!0}}}return b},$n.prototype.defines=function(){var t=[];for(var o in this.binders){var u=this.binders[o];(u instanceof oi||u instanceof ci)&&t.push.apply(t,u.uniformNames.map(function(p){return"#define HAS_UNIFORM_"+p}))}return t},$n.prototype.getBinderAttributes=function(){var t=[];for(var o in this.binders){var u=this.binders[o];if(u instanceof Qn||u instanceof Xn)for(var p=0;p<u.paintVertexAttributes.length;p++)t.push(u.paintVertexAttributes[p].name);else if(u instanceof di)for(var y=0;y<ke.members.length;y++)t.push(ke.members[y].name)}return t},$n.prototype.getBinderUniforms=function(){var t=[];for(var o in this.binders){var u=this.binders[o];if(u instanceof oi||u instanceof ci||u instanceof Xn)for(var p=0,y=u.uniformNames;p<y.length;p+=1)t.push(y[p])}return t},$n.prototype.getPaintVertexBuffers=function(){return this._buffers},$n.prototype.getUniforms=function(t,o){var u=[];for(var p in this.binders){var y=this.binders[p];if(y instanceof oi||y instanceof ci||y instanceof Xn)for(var b=0,C=y.uniformNames;b<C.length;b+=1){var I=C[b];if(o[I]){var D=y.getBinding(t,o[I],I);u.push({name:I,property:p,binding:D})}}}return u},$n.prototype.setUniforms=function(t,o,u,p){for(var y=0,b=o;y<b.length;y+=1){var C=b[y],I=C.name,D=C.property;this.binders[D].setUniform(C.binding,p,u.get(D),I)}},$n.prototype.updatePaintBuffers=function(t){for(var o in this._buffers=[],this.binders){var u=this.binders[o];if(t&&u instanceof di){var p=t.fromScale===2?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(u instanceof Qn||u instanceof Xn)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}},$n.prototype.upload=function(t){for(var o in this.binders){var u=this.binders[o];(u instanceof Qn||u instanceof Xn||u instanceof di)&&u.upload(t)}this.updatePaintBuffers()},$n.prototype.destroy=function(){for(var t in this.binders){var o=this.binders[t];(o instanceof Qn||o instanceof Xn||o instanceof di)&&o.destroy()}};var qn=function(t,o,u){u===void 0&&(u=function(){return!0}),this.programConfigurations={};for(var p=0,y=t;p<y.length;p+=1){var b=y[p];this.programConfigurations[b.id]=new $n(b,o,u)}this.needsUpload=!1,this._featureMap=new Qe,this._bufferOffset=0};function yo(t,o){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(o+"-","").replace(/-/g,"_")]}function Qa(t,o,u){var p={color:{source:zs,composite:Hl},number:{source:yl,composite:zs}},y=function(b){return{"line-pattern":{source:ss,composite:ss},"fill-pattern":{source:ss,composite:ss},"fill-extrusion-pattern":{source:ss,composite:ss}}[b]}(t);return y&&y[u]||p[o][u]}qn.prototype.populatePaintArrays=function(t,o,u,p,y,b){for(var C in this.programConfigurations)this.programConfigurations[C].populatePaintArrays(t,o,p,y,b);o.id!==void 0&&this._featureMap.add(o.id,u,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0},qn.prototype.updatePaintArrays=function(t,o,u,p){for(var y=0,b=u;y<b.length;y+=1){var C=b[y];this.needsUpload=this.programConfigurations[C.id].updatePaintArrays(t,this._featureMap,o,C,p)||this.needsUpload}},qn.prototype.get=function(t){return this.programConfigurations[t]},qn.prototype.upload=function(t){if(this.needsUpload){for(var o in this.programConfigurations)this.programConfigurations[o].upload(t);this.needsUpload=!1}},qn.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},gn("ConstantBinder",oi),gn("CrossFadedConstantBinder",ci),gn("SourceExpressionBinder",Qn),gn("CrossFadedCompositeBinder",di),gn("CompositeExpressionBinder",Xn),gn("ProgramConfiguration",$n,{omit:["_buffers"]}),gn("ProgramConfigurationSet",qn);var To=Math.pow(2,14)-1,ia=-To-1;function Ha(t){for(var o=8192/t.extent,u=t.loadGeometry(),p=0;p<u.length;p++)for(var y=u[p],b=0;b<y.length;b++){var C=y[b],I=Math.round(C.x*o),D=Math.round(C.y*o);C.x=$t(I,ia,To),C.y=$t(D,ia,To),(I<C.x||I>C.x+1||D<C.y||D>C.y+1)&&et("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return u}function fo(t,o){return{type:t.type,id:t.id,properties:t.properties,geometry:o?Ha(t):[]}}function Rs(t,o,u,p,y){t.emplaceBack(2*o+(p+1)/2,2*u+(y+1)/2)}var us=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new dc,this.indexArray=new ml,this.segments=new fe,this.programConfigurations=new qn(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};function Bu(t,o){for(var u=0;u<t.length;u++)if(iu(o,t[u]))return!0;for(var p=0;p<o.length;p++)if(iu(t,o[p]))return!0;return!!cs(t,o)}function ls(t,o,u){return!!iu(t,o)||!!Nu(o,t,u)}function nu(t,o){if(t.length===1)return Xl(o,t[0]);for(var u=0;u<o.length;u++)for(var p=o[u],y=0;y<p.length;y++)if(iu(t,p[y]))return!0;for(var b=0;b<t.length;b++)if(Xl(o,t[b]))return!0;for(var C=0;C<o.length;C++)if(cs(t,o[C]))return!0;return!1}function Jo(t,o,u){if(t.length>1){if(cs(t,o))return!0;for(var p=0;p<o.length;p++)if(Nu(o[p],t,u))return!0}for(var y=0;y<t.length;y++)if(Nu(t[y],o,u))return!0;return!1}function cs(t,o){if(t.length===0||o.length===0)return!1;for(var u=0;u<t.length-1;u++)for(var p=t[u],y=t[u+1],b=0;b<o.length-1;b++)if(Wl(p,y,o[b],o[b+1]))return!0;return!1}function Wl(t,o,u,p){return Ht(t,u,p)!==Ht(o,u,p)&&Ht(t,o,u)!==Ht(t,o,p)}function Nu(t,o,u){var p=u*u;if(o.length===1)return t.distSqr(o[0])<p;for(var y=1;y<o.length;y++)if(_l(t,o[y-1],o[y])<p)return!0;return!1}function _l(t,o,u){var p=o.distSqr(u);if(p===0)return t.distSqr(o);var y=((t.x-o.x)*(u.x-o.x)+(t.y-o.y)*(u.y-o.y))/p;return t.distSqr(y<0?o:y>1?u:u.sub(o)._mult(y)._add(o))}function Xl(t,o){for(var u,p,y,b=!1,C=0;C<t.length;C++)for(var I=0,D=(u=t[C]).length-1;I<u.length;D=I++)(p=u[I]).y>o.y!=(y=u[D]).y>o.y&&o.x<(y.x-p.x)*(o.y-p.y)/(y.y-p.y)+p.x&&(b=!b);return b}function iu(t,o){for(var u=!1,p=0,y=t.length-1;p<t.length;y=p++){var b=t[p],C=t[y];b.y>o.y!=C.y>o.y&&o.x<(C.x-b.x)*(o.y-b.y)/(C.y-b.y)+b.x&&(u=!u)}return u}function xl(t,o,u){var p=u[0],y=u[2];if(t.x<p.x&&o.x<p.x||t.x>y.x&&o.x>y.x||t.y<p.y&&o.y<p.y||t.y>y.y&&o.y>y.y)return!1;var b=Ht(t,o,u[0]);return b!==Ht(t,o,u[1])||b!==Ht(t,o,u[2])||b!==Ht(t,o,u[3])}function Su(t,o,u){var p=o.paint.get(t).value;return p.kind==="constant"?p.value:u.programConfigurations.get(o.id).getMaxValue(t)}function Eo(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function zu(t,o,u,p,y){if(!o[0]&&!o[1])return t;var b=le.convert(o)._mult(y);u==="viewport"&&b._rotate(-p);for(var C=[],I=0;I<t.length;I++)C.push(t[I].sub(b));return C}us.prototype.populate=function(t,o,u){var p=this.layers[0],y=[],b=null;p.type==="circle"&&(b=p.layout.get("circle-sort-key"));for(var C=0,I=t;C<I.length;C+=1){var D=I[C],z=D.feature,U=D.id,G=D.index,q=D.sourceLayerIndex,ie=this.layers[0]._featureFilter.needGeometry,Pe=fo(z,ie);if(this.layers[0]._featureFilter.filter(new Mi(this.zoom),Pe,u)){var Re=b?b.evaluate(Pe,{},u):void 0,k={id:U,properties:z.properties,type:z.type,sourceLayerIndex:q,index:G,geometry:ie?Pe.geometry:Ha(z),patterns:{},sortKey:Re};y.push(k)}}b&&y.sort(function(Br,zn){return Br.sortKey-zn.sortKey});for(var Ze=0,at=y;Ze<at.length;Ze+=1){var Ct=at[Ze],zt=Ct.geometry,Vt=Ct.index,sr=Ct.sourceLayerIndex,Pr=t[Vt].feature;this.addFeature(Ct,zt,Vt,u),o.featureIndex.insert(Pr,zt,Vt,sr,this.index)}},us.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},us.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},us.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},us.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,se),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},us.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},us.prototype.addFeature=function(t,o,u,p){for(var y=0,b=o;y<b.length;y+=1)for(var C=0,I=b[y];C<I.length;C+=1){var D=I[C],z=D.x,U=D.y;if(!(z<0||z>=8192||U<0||U>=8192)){var G=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),q=G.vertexLength;Rs(this.layoutVertexArray,z,U,-1,-1),Rs(this.layoutVertexArray,z,U,1,-1),Rs(this.layoutVertexArray,z,U,1,1),Rs(this.layoutVertexArray,z,U,-1,1),this.indexArray.emplaceBack(q,q+1,q+2),this.indexArray.emplaceBack(q,q+3,q+2),G.vertexLength+=4,G.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,{},p)},gn("CircleBucket",us,{omit:["layers"]});var Zu=new Ho({"circle-sort-key":new wn(ce.layout_circle["circle-sort-key"])}),tl={paint:new Ho({"circle-radius":new wn(ce.paint_circle["circle-radius"]),"circle-color":new wn(ce.paint_circle["circle-color"]),"circle-blur":new wn(ce.paint_circle["circle-blur"]),"circle-opacity":new wn(ce.paint_circle["circle-opacity"]),"circle-translate":new Ln(ce.paint_circle["circle-translate"]),"circle-translate-anchor":new Ln(ce.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ln(ce.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ln(ce.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new wn(ce.paint_circle["circle-stroke-width"]),"circle-stroke-color":new wn(ce.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new wn(ce.paint_circle["circle-stroke-opacity"])}),layout:Zu},ua=typeof Float32Array!="undefined"?Float32Array:Array;function Zs(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function es(t,o,u){var p=o[0],y=o[1],b=o[2],C=o[3],I=o[4],D=o[5],z=o[6],U=o[7],G=o[8],q=o[9],ie=o[10],Pe=o[11],Re=o[12],k=o[13],Ze=o[14],at=o[15],Ct=u[0],zt=u[1],Vt=u[2],sr=u[3];return t[0]=Ct*p+zt*I+Vt*G+sr*Re,t[1]=Ct*y+zt*D+Vt*q+sr*k,t[2]=Ct*b+zt*z+Vt*ie+sr*Ze,t[3]=Ct*C+zt*U+Vt*Pe+sr*at,t[4]=(Ct=u[4])*p+(zt=u[5])*I+(Vt=u[6])*G+(sr=u[7])*Re,t[5]=Ct*y+zt*D+Vt*q+sr*k,t[6]=Ct*b+zt*z+Vt*ie+sr*Ze,t[7]=Ct*C+zt*U+Vt*Pe+sr*at,t[8]=(Ct=u[8])*p+(zt=u[9])*I+(Vt=u[10])*G+(sr=u[11])*Re,t[9]=Ct*y+zt*D+Vt*q+sr*k,t[10]=Ct*b+zt*z+Vt*ie+sr*Ze,t[11]=Ct*C+zt*U+Vt*Pe+sr*at,t[12]=(Ct=u[12])*p+(zt=u[13])*I+(Vt=u[14])*G+(sr=u[15])*Re,t[13]=Ct*y+zt*D+Vt*q+sr*k,t[14]=Ct*b+zt*z+Vt*ie+sr*Ze,t[15]=Ct*C+zt*U+Vt*Pe+sr*at,t}Math.hypot||(Math.hypot=function(){for(var t=arguments,o=0,u=arguments.length;u--;)o+=t[u]*t[u];return Math.sqrt(o)});var _u,qc=es;function Kc(t,o,u){var p=o[0],y=o[1],b=o[2],C=o[3];return t[0]=u[0]*p+u[4]*y+u[8]*b+u[12]*C,t[1]=u[1]*p+u[5]*y+u[9]*b+u[13]*C,t[2]=u[2]*p+u[6]*y+u[10]*b+u[14]*C,t[3]=u[3]*p+u[7]*y+u[11]*b+u[15]*C,t}_u=new ua(3),ua!=Float32Array&&(_u[0]=0,_u[1]=0,_u[2]=0),function(){var t=new ua(4);ua!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var Pf=(function(){var t=new ua(2);ua!=Float32Array&&(t[0]=0,t[1]=0)}(),function(t){function o(u){t.call(this,u,tl)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new us(u)},o.prototype.queryRadius=function(u){var p=u;return Su("circle-radius",this,p)+Su("circle-stroke-width",this,p)+Eo(this.paint.get("circle-translate"))},o.prototype.queryIntersectsFeature=function(u,p,y,b,C,I,D,z){for(var U=zu(u,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),I.angle,D),G=this.paint.get("circle-radius").evaluate(p,y)+this.paint.get("circle-stroke-width").evaluate(p,y),q=this.paint.get("circle-pitch-alignment")==="map",ie=q?U:function(Pr,Br){return Pr.map(function(zn){return au(zn,Br)})}(U,z),Pe=q?G*D:G,Re=0,k=b;Re<k.length;Re+=1)for(var Ze=0,at=k[Re];Ze<at.length;Ze+=1){var Ct=at[Ze],zt=q?Ct:au(Ct,z),Vt=Pe,sr=Kc([],[Ct.x,Ct.y,0,1],z);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Vt*=sr[3]/I.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Vt*=I.cameraToCenterDistance/sr[3]),ls(ie,zt,Vt))return!0}return!1},o}(gu));function au(t,o){var u=Kc([],[t.x,t.y,0,1],o);return new le(u[0]/u[3],u[1]/u[3])}var mc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(us);function ou(t,o,u,p){var y=o.width,b=o.height;if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==y*b*u)throw new RangeError("mismatched image size")}else p=new Uint8Array(y*b*u);return t.width=y,t.height=b,t.data=p,t}function bl(t,o,u){var p=o.width,y=o.height;if(p!==t.width||y!==t.height){var b=ou({},{width:p,height:y},u);gc(t,b,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,p),height:Math.min(t.height,y)},u),t.width=p,t.height=y,t.data=b.data}}function gc(t,o,u,p,y,b){if(y.width===0||y.height===0)return o;if(y.width>t.width||y.height>t.height||u.x>t.width-y.width||u.y>t.height-y.height)throw new RangeError("out of range source coordinates for image copy");if(y.width>o.width||y.height>o.height||p.x>o.width-y.width||p.y>o.height-y.height)throw new RangeError("out of range destination coordinates for image copy");for(var C=t.data,I=o.data,D=0;D<y.height;D++)for(var z=((u.y+D)*t.width+u.x)*b,U=((p.y+D)*o.width+p.x)*b,G=0;G<y.width*b;G++)I[U+G]=C[z+G];return o}gn("HeatmapBucket",mc,{omit:["layers"]});var su=function(t,o){ou(this,t,1,o)};su.prototype.resize=function(t){bl(this,t,1)},su.prototype.clone=function(){return new su({width:this.width,height:this.height},new Uint8Array(this.data))},su.copy=function(t,o,u,p,y){gc(t,o,u,p,y,1)};var Bo=function(t,o){ou(this,t,4,o)};Bo.prototype.resize=function(t){bl(this,t,4)},Bo.prototype.replace=function(t,o){o?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t},Bo.prototype.clone=function(){return new Bo({width:this.width,height:this.height},new Uint8Array(this.data))},Bo.copy=function(t,o,u,p,y){gc(t,o,u,p,y,4)},gn("AlphaImage",su),gn("RGBAImage",Bo);var $c={paint:new Ho({"heatmap-radius":new wn(ce.paint_heatmap["heatmap-radius"]),"heatmap-weight":new wn(ce.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ln(ce.paint_heatmap["heatmap-intensity"]),"heatmap-color":new eu(ce.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ln(ce.paint_heatmap["heatmap-opacity"])})};function Jf(t){var o={},u=t.resolution||256,p=t.clips?t.clips.length:1,y=t.image||new Bo({width:u,height:p}),b=function(Pe,Re,k){o[t.evaluationKey]=k;var Ze=t.expression.evaluate(o);y.data[Pe+Re+0]=Math.floor(255*Ze.r/Ze.a),y.data[Pe+Re+1]=Math.floor(255*Ze.g/Ze.a),y.data[Pe+Re+2]=Math.floor(255*Ze.b/Ze.a),y.data[Pe+Re+3]=Math.floor(255*Ze.a)};if(t.clips)for(var C=0,I=0;C<p;++C,I+=4*u)for(var D=0,z=0;D<u;D++,z+=4){var U=D/(u-1),G=t.clips[C];b(I,z,G.start*(1-U)+G.end*U)}else for(var q=0,ie=0;q<u;q++,ie+=4)b(0,ie,q/(u-1));return y}var kh=function(t){function o(u){t.call(this,u,$c),this._updateColorRamp()}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new mc(u)},o.prototype._handleSpecialPaintPropertyUpdate=function(u){u==="heatmap-color"&&this._updateColorRamp()},o.prototype._updateColorRamp=function(){this.colorRamp=Jf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},o.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},o.prototype.queryRadius=function(){return 0},o.prototype.queryIntersectsFeature=function(){return!1},o.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},o}(gu),eh={paint:new Ho({"hillshade-illumination-direction":new Ln(ce.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ln(ce.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ln(ce.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ln(ce.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ln(ce.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ln(ce.paint_hillshade["hillshade-accent-color"])})},pp=function(t){function o(u){t.call(this,u,eh)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},o}(gu),yc=La([{name:"a_pos",components:2,type:"Int16"}],4).members,_c=Lh,If=Lh;function Lh(t,o,u){u=u||2;var p,y,b,C,I,D,z,U=o&&o.length,G=U?o[0]*u:t.length,q=qp(t,0,G,u,!0),ie=[];if(!q||q.next===q.prev)return ie;if(U&&(q=function(Re,k,Ze,at){var Ct,zt,Vt,sr=[];for(Ct=0,zt=k.length;Ct<zt;Ct++)(Vt=qp(Re,k[Ct]*at,Ct<zt-1?k[Ct+1]*at:Re.length,at,!1))===Vt.next&&(Vt.steiner=!0),sr.push(Fh(Vt));for(sr.sort(Id),Ct=0;Ct<sr.length;Ct++)Od(sr[Ct],Ze),Ze=El(Ze,Ze.next);return Ze}(t,o,q,u)),t.length>80*u){p=b=t[0],y=C=t[1];for(var Pe=u;Pe<G;Pe+=u)(I=t[Pe])<p&&(p=I),(D=t[Pe+1])<y&&(y=D),I>b&&(b=I),D>C&&(C=D);z=(z=Math.max(b-p,C-y))!==0?1/z:0}return Qc(q,ie,u,p,y,z),ie}function qp(t,o,u,p,y){var b,C;if(y===ah(t,o,u,p)>0)for(b=o;b<u;b+=p)C=ih(b,t[b],t[b+1],C);else for(b=u-p;b>=o;b-=p)C=ih(b,t[b],t[b+1],C);return C&&xt(C,C.next)&&(Yl(C),C=C.next),C}function El(t,o){if(!t)return t;o||(o=t);var u,p=t;do if(u=!1,p.steiner||!xt(p,p.next)&&Mo(p.prev,p,p.next)!==0)p=p.next;else{if(Yl(p),(p=o=p.prev)===p.next)break;u=!0}while(u||p!==o);return o}function Qc(t,o,u,p,y,b,C){if(t){!C&&b&&function(U,G,q,ie){var Pe=U;do Pe.z===null&&(Pe.z=dp(Pe.x,Pe.y,G,q,ie)),Pe.prevZ=Pe.prev,Pe.nextZ=Pe.next,Pe=Pe.next;while(Pe!==U);Pe.prevZ.nextZ=null,Pe.prevZ=null,function(Re){var k,Ze,at,Ct,zt,Vt,sr,Pr,Br=1;do{for(Ze=Re,Re=null,zt=null,Vt=0;Ze;){for(Vt++,at=Ze,sr=0,k=0;k<Br&&(sr++,at=at.nextZ);k++);for(Pr=Br;sr>0||Pr>0&&at;)sr!==0&&(Pr===0||!at||Ze.z<=at.z)?(Ct=Ze,Ze=Ze.nextZ,sr--):(Ct=at,at=at.nextZ,Pr--),zt?zt.nextZ=Ct:Re=Ct,Ct.prevZ=zt,zt=Ct;Ze=at}zt.nextZ=null,Br*=2}while(Vt>1)}(Pe)}(t,p,y,b);for(var I,D,z=t;t.prev!==t.next;)if(I=t.prev,D=t.next,b?Pd(t,p,y,b):Kp(t))o.push(I.i/u),o.push(t.i/u),o.push(D.i/u),Yl(t),t=D.next,z=D.next;else if((t=D)===z){C?C===1?Qc(t=Jc(El(t),o,u),o,u,p,y,b,2):C===2&&Dh(t,o,u,p,y,b):Qc(El(t),o,u,p,y,b,1);break}}}function Kp(t){var o=t.prev,u=t,p=t.next;if(Mo(o,u,p)>=0)return!1;for(var y=t.next.next;y!==t.prev;){if(th(o.x,o.y,u.x,u.y,p.x,p.y,y.x,y.y)&&Mo(y.prev,y,y.next)>=0)return!1;y=y.next}return!0}function Pd(t,o,u,p){var y=t.prev,b=t,C=t.next;if(Mo(y,b,C)>=0)return!1;for(var I=y.x>b.x?y.x>C.x?y.x:C.x:b.x>C.x?b.x:C.x,D=y.y>b.y?y.y>C.y?y.y:C.y:b.y>C.y?b.y:C.y,z=dp(y.x<b.x?y.x<C.x?y.x:C.x:b.x<C.x?b.x:C.x,y.y<b.y?y.y<C.y?y.y:C.y:b.y<C.y?b.y:C.y,o,u,p),U=dp(I,D,o,u,p),G=t.prevZ,q=t.nextZ;G&&G.z>=z&&q&&q.z<=U;){if(G!==t.prev&&G!==t.next&&th(y.x,y.y,b.x,b.y,C.x,C.y,G.x,G.y)&&Mo(G.prev,G,G.next)>=0||(G=G.prevZ,q!==t.prev&&q!==t.next&&th(y.x,y.y,b.x,b.y,C.x,C.y,q.x,q.y)&&Mo(q.prev,q,q.next)>=0))return!1;q=q.nextZ}for(;G&&G.z>=z;){if(G!==t.prev&&G!==t.next&&th(y.x,y.y,b.x,b.y,C.x,C.y,G.x,G.y)&&Mo(G.prev,G,G.next)>=0)return!1;G=G.prevZ}for(;q&&q.z<=U;){if(q!==t.prev&&q!==t.next&&th(y.x,y.y,b.x,b.y,C.x,C.y,q.x,q.y)&&Mo(q.prev,q,q.next)>=0)return!1;q=q.nextZ}return!0}function Jc(t,o,u){var p=t;do{var y=p.prev,b=p.next.next;!xt(y,b)&&Qp(y,p,p.next,b)&&Of(y,b)&&Of(b,y)&&(o.push(y.i/u),o.push(p.i/u),o.push(b.i/u),Yl(p),Yl(p.next),p=t=b),p=p.next}while(p!==t);return El(p)}function Dh(t,o,u,p,y,b){var C=t;do{for(var I=C.next.next;I!==C.prev;){if(C.i!==I.i&&Yr(C,I)){var D=nh(C,I);return C=El(C,C.next),D=El(D,D.next),Qc(C,o,u,p,y,b),void Qc(D,o,u,p,y,b)}I=I.next}C=C.next}while(C!==t)}function Id(t,o){return t.x-o.x}function Od(t,o){if(o=function(p,y){var b,C=y,I=p.x,D=p.y,z=-1/0;do{if(D<=C.y&&D>=C.next.y&&C.next.y!==C.y){var U=C.x+(D-C.y)*(C.next.x-C.x)/(C.next.y-C.y);if(U<=I&&U>z){if(z=U,U===I){if(D===C.y)return C;if(D===C.next.y)return C.next}b=C.x<C.next.x?C:C.next}}C=C.next}while(C!==y);if(!b)return null;if(I===z)return b;var G,q=b,ie=b.x,Pe=b.y,Re=1/0;C=b;do I>=C.x&&C.x>=ie&&I!==C.x&&th(D<Pe?I:z,D,ie,Pe,D<Pe?z:I,D,C.x,C.y)&&(G=Math.abs(D-C.y)/(I-C.x),Of(C,p)&&(G<Re||G===Re&&(C.x>b.x||C.x===b.x&&$p(b,C)))&&(b=C,Re=G)),C=C.next;while(C!==q);return b}(t,o)){var u=nh(o,t);El(o,o.next),El(u,u.next)}}function $p(t,o){return Mo(t.prev,t,o.prev)<0&&Mo(o.next,t,t.next)<0}function dp(t,o,u,p,y){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-u)*y)|t<<8))|t<<4))|t<<2))|t<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-p)*y)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function Fh(t){var o=t,u=t;do(o.x<u.x||o.x===u.x&&o.y<u.y)&&(u=o),o=o.next;while(o!==t);return u}function th(t,o,u,p,y,b,C,I){return(y-C)*(o-I)-(t-C)*(b-I)>=0&&(t-C)*(p-I)-(u-C)*(o-I)>=0&&(u-C)*(b-I)-(y-C)*(p-I)>=0}function Yr(t,o){return t.next.i!==o.i&&t.prev.i!==o.i&&!function(u,p){var y=u;do{if(y.i!==u.i&&y.next.i!==u.i&&y.i!==p.i&&y.next.i!==p.i&&Qp(y,y.next,u,p))return!0;y=y.next}while(y!==u);return!1}(t,o)&&(Of(t,o)&&Of(o,t)&&function(u,p){var y=u,b=!1,C=(u.x+p.x)/2,I=(u.y+p.y)/2;do y.y>I!=y.next.y>I&&y.next.y!==y.y&&C<(y.next.x-y.x)*(I-y.y)/(y.next.y-y.y)+y.x&&(b=!b),y=y.next;while(y!==u);return b}(t,o)&&(Mo(t.prev,t,o.prev)||Mo(t,o.prev,o))||xt(t,o)&&Mo(t.prev,t,t.next)>0&&Mo(o.prev,o,o.next)>0)}function Mo(t,o,u){return(o.y-t.y)*(u.x-o.x)-(o.x-t.x)*(u.y-o.y)}function xt(t,o){return t.x===o.x&&t.y===o.y}function Qp(t,o,u,p){var y=rh(Mo(t,o,u)),b=rh(Mo(t,o,p)),C=rh(Mo(u,p,t)),I=rh(Mo(u,p,o));return y!==b&&C!==I||!(y!==0||!Bh(t,u,o))||!(b!==0||!Bh(t,p,o))||!(C!==0||!Bh(u,t,p))||!(I!==0||!Bh(u,o,p))}function Bh(t,o,u){return o.x<=Math.max(t.x,u.x)&&o.x>=Math.min(t.x,u.x)&&o.y<=Math.max(t.y,u.y)&&o.y>=Math.min(t.y,u.y)}function rh(t){return t>0?1:t<0?-1:0}function Of(t,o){return Mo(t.prev,t,t.next)<0?Mo(t,o,t.next)>=0&&Mo(t,t.prev,o)>=0:Mo(t,o,t.prev)<0||Mo(t,t.next,o)<0}function nh(t,o){var u=new Sl(t.i,t.x,t.y),p=new Sl(o.i,o.x,o.y),y=t.next,b=o.prev;return t.next=o,o.prev=t,u.next=y,y.prev=u,p.next=u,u.prev=p,b.next=p,p.prev=b,p}function ih(t,o,u,p){var y=new Sl(t,o,u);return p?(y.next=p.next,y.prev=p,p.next.prev=y,p.next=y):(y.prev=y,y.next=y),y}function Yl(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Sl(t,o,u){this.i=t,this.x=o,this.y=u,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ah(t,o,u,p){for(var y=0,b=o,C=u-p;b<u;b+=p)y+=(t[C]-t[b])*(t[b+1]+t[C+1]),C=b;return y}function Nh(t,o,u,p,y){(function b(C,I,D,z,U){for(;z>D;){if(z-D>600){var G=z-D+1,q=I-D+1,ie=Math.log(G),Pe=.5*Math.exp(2*ie/3),Re=.5*Math.sqrt(ie*Pe*(G-Pe)/G)*(q-G/2<0?-1:1);b(C,I,Math.max(D,Math.floor(I-q*Pe/G+Re)),Math.min(z,Math.floor(I+(G-q)*Pe/G+Re)),U)}var k=C[I],Ze=D,at=z;for(ql(C,D,I),U(C[z],k)>0&&ql(C,D,z);Ze<at;){for(ql(C,Ze,at),Ze++,at--;U(C[Ze],k)<0;)Ze++;for(;U(C[at],k)>0;)at--}U(C[D],k)===0?ql(C,D,at):ql(C,++at,z),at<=I&&(D=at+1),I<=at&&(z=at-1)}})(t,o,u||0,p||t.length-1,y||oh)}function ql(t,o,u){var p=t[o];t[o]=t[u],t[u]=p}function oh(t,o){return t<o?-1:t>o?1:0}function Rf(t,o){var u=t.length;if(u<=1)return[t];for(var p,y,b=[],C=0;C<u;C++){var I=Er(t[C]);I!==0&&(t[C].area=Math.abs(I),y===void 0&&(y=I<0),y===I<0?(p&&b.push(p),p=[t[C]]):p.push(t[C]))}if(p&&b.push(p),o>1)for(var D=0;D<b.length;D++)b[D].length<=o||(Nh(b[D],o,1,b[D].length-1,sh),b[D]=b[D].slice(0,o));return b}function sh(t,o){return o.area-t.area}function ef(t,o,u){for(var p=u.patternDependencies,y=!1,b=0,C=o;b<C.length;b+=1){var I=C[b].paint.get(t+"-pattern");I.isConstant()||(y=!0);var D=I.constantOr(null);D&&(y=!0,p[D.to]=!0,p[D.from]=!0)}return y}function kf(t,o,u,p,y){for(var b=y.patternDependencies,C=0,I=o;C<I.length;C+=1){var D=I[C],z=D.paint.get(t+"-pattern").value;if(z.kind!=="constant"){var U=z.evaluate({zoom:p-1},u,{},y.availableImages),G=z.evaluate({zoom:p},u,{},y.availableImages),q=z.evaluate({zoom:p+1},u,{},y.availableImages);G=G&&G.name?G.name:G,q=q&&q.name?q.name:q,b[U=U&&U.name?U.name:U]=!0,b[G]=!0,b[q]=!0,u.patterns[D.id]={min:U,mid:G,max:q}}}return u}Lh.deviation=function(t,o,u,p){var y=o&&o.length,b=Math.abs(ah(t,0,y?o[0]*u:t.length,u));if(y)for(var C=0,I=o.length;C<I;C++)b-=Math.abs(ah(t,o[C]*u,C<I-1?o[C+1]*u:t.length,u));var D=0;for(C=0;C<p.length;C+=3){var z=p[C]*u,U=p[C+1]*u,G=p[C+2]*u;D+=Math.abs((t[z]-t[G])*(t[U+1]-t[z+1])-(t[z]-t[U])*(t[G+1]-t[z+1]))}return b===0&&D===0?0:Math.abs((D-b)/b)},Lh.flatten=function(t){for(var o=t[0][0].length,u={vertices:[],holes:[],dimensions:o},p=0,y=0;y<t.length;y++){for(var b=0;b<t[y].length;b++)for(var C=0;C<o;C++)u.vertices.push(t[y][b][C]);y>0&&u.holes.push(p+=t[y-1].length)}return u},_c.default=If;var Us=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new dc,this.indexArray=new ml,this.indexArray2=new Gl,this.programConfigurations=new qn(t.layers,t.zoom),this.segments=new fe,this.segments2=new fe,this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};Us.prototype.populate=function(t,o,u){this.hasPattern=ef("fill",this.layers,o);for(var p=this.layers[0].layout.get("fill-sort-key"),y=[],b=0,C=t;b<C.length;b+=1){var I=C[b],D=I.feature,z=I.id,U=I.index,G=I.sourceLayerIndex,q=this.layers[0]._featureFilter.needGeometry,ie=fo(D,q);if(this.layers[0]._featureFilter.filter(new Mi(this.zoom),ie,u)){var Pe=p?p.evaluate(ie,{},u,o.availableImages):void 0,Re={id:z,properties:D.properties,type:D.type,sourceLayerIndex:G,index:U,geometry:q?ie.geometry:Ha(D),patterns:{},sortKey:Pe};y.push(Re)}}p&&y.sort(function(Pr,Br){return Pr.sortKey-Br.sortKey});for(var k=0,Ze=y;k<Ze.length;k+=1){var at=Ze[k],Ct=at.geometry,zt=at.index,Vt=at.sourceLayerIndex;if(this.hasPattern){var sr=kf("fill",this.layers,at,this.zoom,o);this.patternFeatures.push(sr)}else this.addFeature(at,Ct,zt,u,{});o.featureIndex.insert(t[zt].feature,Ct,zt,Vt,this.index)}},Us.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},Us.prototype.addFeatures=function(t,o,u){for(var p=0,y=this.patternFeatures;p<y.length;p+=1){var b=y[p];this.addFeature(b,b.geometry,b.index,o,u)}},Us.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Us.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Us.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,yc),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},Us.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Us.prototype.addFeature=function(t,o,u,p,y){for(var b=0,C=Rf(o,500);b<C.length;b+=1){for(var I=C[b],D=0,z=0,U=I;z<U.length;z+=1)D+=U[z].length;for(var G=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray),q=G.vertexLength,ie=[],Pe=[],Re=0,k=I;Re<k.length;Re+=1){var Ze=k[Re];if(Ze.length!==0){Ze!==I[0]&&Pe.push(ie.length/2);var at=this.segments2.prepareSegment(Ze.length,this.layoutVertexArray,this.indexArray2),Ct=at.vertexLength;this.layoutVertexArray.emplaceBack(Ze[0].x,Ze[0].y),this.indexArray2.emplaceBack(Ct+Ze.length-1,Ct),ie.push(Ze[0].x),ie.push(Ze[0].y);for(var zt=1;zt<Ze.length;zt++)this.layoutVertexArray.emplaceBack(Ze[zt].x,Ze[zt].y),this.indexArray2.emplaceBack(Ct+zt-1,Ct+zt),ie.push(Ze[zt].x),ie.push(Ze[zt].y);at.vertexLength+=Ze.length,at.primitiveLength+=Ze.length}}for(var Vt=_c(ie,Pe),sr=0;sr<Vt.length;sr+=3)this.indexArray.emplaceBack(q+Vt[sr],q+Vt[sr+1],q+Vt[sr+2]);G.vertexLength+=D,G.primitiveLength+=Vt.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,p)},gn("FillBucket",Us,{omit:["layers","patternFeatures"]});var Lf=new Ho({"fill-sort-key":new wn(ce.layout_fill["fill-sort-key"])}),tf={paint:new Ho({"fill-antialias":new Ln(ce.paint_fill["fill-antialias"]),"fill-opacity":new wn(ce.paint_fill["fill-opacity"]),"fill-color":new wn(ce.paint_fill["fill-color"]),"fill-outline-color":new wn(ce.paint_fill["fill-outline-color"]),"fill-translate":new Ln(ce.paint_fill["fill-translate"]),"fill-translate-anchor":new Ln(ce.paint_fill["fill-translate-anchor"]),"fill-pattern":new Hc(ce.paint_fill["fill-pattern"])}),layout:Lf},uh=function(t){function o(u){t.call(this,u,tf)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.recalculate=function(u,p){t.prototype.recalculate.call(this,u,p);var y=this.paint._values["fill-outline-color"];y.value.kind==="constant"&&y.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},o.prototype.createBucket=function(u){return new Us(u)},o.prototype.queryRadius=function(){return Eo(this.paint.get("fill-translate"))},o.prototype.queryIntersectsFeature=function(u,p,y,b,C,I,D){return nu(zu(u,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),I.angle,D),b)},o.prototype.isTileClipped=function(){return!0},o}(gu),lh=La([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,zh=Cl;function Cl(t,o,u,p,y){this.properties={},this.extent=u,this.type=0,this._pbf=t,this._geometry=-1,this._keys=p,this._values=y,t.readFields(rf,this,o)}function rf(t,o,u){t==1?o.id=u.readVarint():t==2?function(p,y){for(var b=p.readVarint()+p.pos;p.pos<b;){var C=y._keys[p.readVarint()],I=y._values[p.readVarint()];y.properties[C]=I}}(u,o):t==3?o.type=u.readVarint():t==4&&(o._geometry=u.pos)}function Jp(t){for(var o,u,p=0,y=0,b=t.length,C=b-1;y<b;C=y++)p+=((u=t[C]).x-(o=t[y]).x)*(o.y+u.y);return p}Cl.types=["Unknown","Point","LineString","Polygon"],Cl.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var o,u=t.readVarint()+t.pos,p=1,y=0,b=0,C=0,I=[];t.pos<u;){if(y<=0){var D=t.readVarint();p=7&D,y=D>>3}if(y--,p===1||p===2)b+=t.readSVarint(),C+=t.readSVarint(),p===1&&(o&&I.push(o),o=[]),o.push(new le(b,C));else{if(p!==7)throw new Error("unknown command "+p);o&&o.push(o[0].clone())}}return o&&I.push(o),I},Cl.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var o=t.readVarint()+t.pos,u=1,p=0,y=0,b=0,C=1/0,I=-1/0,D=1/0,z=-1/0;t.pos<o;){if(p<=0){var U=t.readVarint();u=7&U,p=U>>3}if(p--,u===1||u===2)(y+=t.readSVarint())<C&&(C=y),y>I&&(I=y),(b+=t.readSVarint())<D&&(D=b),b>z&&(z=b);else if(u!==7)throw new Error("unknown command "+u)}return[C,D,I,z]},Cl.prototype.toGeoJSON=function(t,o,u){var p,y,b=this.extent*Math.pow(2,u),C=this.extent*t,I=this.extent*o,D=this.loadGeometry(),z=Cl.types[this.type];function U(ie){for(var Pe=0;Pe<ie.length;Pe++){var Re=ie[Pe];ie[Pe]=[360*(Re.x+C)/b-180,360/Math.PI*Math.atan(Math.exp((180-360*(Re.y+I)/b)*Math.PI/180))-90]}}switch(this.type){case 1:var G=[];for(p=0;p<D.length;p++)G[p]=D[p][0];U(D=G);break;case 2:for(p=0;p<D.length;p++)U(D[p]);break;case 3:for(D=function(ie){var Pe=ie.length;if(Pe<=1)return[ie];for(var Re,k,Ze=[],at=0;at<Pe;at++){var Ct=Jp(ie[at]);Ct!==0&&(k===void 0&&(k=Ct<0),k===Ct<0?(Re&&Ze.push(Re),Re=[ie[at]]):Re.push(ie[at]))}return Re&&Ze.push(Re),Ze}(D),p=0;p<D.length;p++)for(y=0;y<D[p].length;y++)U(D[p][y])}D.length===1?D=D[0]:z="Multi"+z;var q={type:"Feature",geometry:{type:z,coordinates:D},properties:this.properties};return"id"in this&&(q.id=this.id),q};var Zh=vp;function vp(t,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Rd,this,o),this.length=this._features.length}function Rd(t,o,u){t===15?o.version=u.readVarint():t===1?o.name=u.readString():t===5?o.extent=u.readVarint():t===2?o._features.push(u.pos):t===3?o._keys.push(u.readString()):t===4&&o._values.push(function(p){for(var y=null,b=p.readVarint()+p.pos;p.pos<b;){var C=p.readVarint()>>3;y=C===1?p.readString():C===2?p.readFloat():C===3?p.readDouble():C===4?p.readVarint64():C===5?p.readVarint():C===6?p.readSVarint():C===7?p.readBoolean():null}return y}(u))}function ed(t,o,u){if(t===3){var p=new Zh(u,u.readVarint()+u.pos);p.length&&(o[p.name]=p)}}vp.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var o=this._pbf.readVarint()+this._pbf.pos;return new zh(this._pbf,o,this.extent,this._keys,this._values)};var Cu={VectorTile:function(t,o){this.layers=t.readFields(ed,{},o)},VectorTileFeature:zh,VectorTileLayer:Zh},kd=Cu.VectorTileFeature.types,Uh=Math.pow(2,13);function nf(t,o,u,p,y,b,C,I){t.emplaceBack(o,u,2*Math.floor(p*Uh)+C,y*Uh*2,b*Uh*2,Math.round(I))}var Uu=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new yu,this.indexArray=new ml,this.programConfigurations=new qn(t.layers,t.zoom),this.segments=new fe,this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};function td(t,o){return t.x===o.x&&(t.x<0||t.x>8192)||t.y===o.y&&(t.y<0||t.y>8192)}Uu.prototype.populate=function(t,o,u){this.features=[],this.hasPattern=ef("fill-extrusion",this.layers,o);for(var p=0,y=t;p<y.length;p+=1){var b=y[p],C=b.feature,I=b.id,D=b.index,z=b.sourceLayerIndex,U=this.layers[0]._featureFilter.needGeometry,G=fo(C,U);if(this.layers[0]._featureFilter.filter(new Mi(this.zoom),G,u)){var q={id:I,sourceLayerIndex:z,index:D,geometry:U?G.geometry:Ha(C),properties:C.properties,type:C.type,patterns:{}};this.hasPattern?this.features.push(kf("fill-extrusion",this.layers,q,this.zoom,o)):this.addFeature(q,q.geometry,D,u,{}),o.featureIndex.insert(C,q.geometry,D,z,this.index,!0)}}},Uu.prototype.addFeatures=function(t,o,u){for(var p=0,y=this.features;p<y.length;p+=1){var b=y[p];this.addFeature(b,b.geometry,b.index,o,u)}},Uu.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},Uu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Uu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Uu.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,lh),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Uu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Uu.prototype.addFeature=function(t,o,u,p,y){for(var b=0,C=Rf(o,500);b<C.length;b+=1){for(var I=C[b],D=0,z=0,U=I;z<U.length;z+=1)D+=U[z].length;for(var G=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),q=0,ie=I;q<ie.length;q+=1){var Pe=ie[q];if(Pe.length!==0&&!((Vi=Pe).every(function(Ci){return Ci.x<0})||Vi.every(function(Ci){return Ci.x>8192})||Vi.every(function(Ci){return Ci.y<0})||Vi.every(function(Ci){return Ci.y>8192})))for(var Re=0,k=0;k<Pe.length;k++){var Ze=Pe[k];if(k>=1){var at=Pe[k-1];if(!td(Ze,at)){G.vertexLength+4>fe.MAX_VERTEX_ARRAY_LENGTH&&(G=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var Ct=Ze.sub(at)._perp()._unit(),zt=at.dist(Ze);Re+zt>32768&&(Re=0),nf(this.layoutVertexArray,Ze.x,Ze.y,Ct.x,Ct.y,0,0,Re),nf(this.layoutVertexArray,Ze.x,Ze.y,Ct.x,Ct.y,0,1,Re),nf(this.layoutVertexArray,at.x,at.y,Ct.x,Ct.y,0,0,Re+=zt),nf(this.layoutVertexArray,at.x,at.y,Ct.x,Ct.y,0,1,Re);var Vt=G.vertexLength;this.indexArray.emplaceBack(Vt,Vt+2,Vt+1),this.indexArray.emplaceBack(Vt+1,Vt+2,Vt+3),G.vertexLength+=4,G.primitiveLength+=2}}}}if(G.vertexLength+D>fe.MAX_VERTEX_ARRAY_LENGTH&&(G=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray)),kd[t.type]==="Polygon"){for(var sr=[],Pr=[],Br=G.vertexLength,zn=0,hn=I;zn<hn.length;zn+=1){var Wn=hn[zn];if(Wn.length!==0){Wn!==I[0]&&Pr.push(sr.length/2);for(var dn=0;dn<Wn.length;dn++){var Ri=Wn[dn];nf(this.layoutVertexArray,Ri.x,Ri.y,0,0,1,1,0),sr.push(Ri.x),sr.push(Ri.y)}}}for(var ti=_c(sr,Pr),Mn=0;Mn<ti.length;Mn+=3)this.indexArray.emplaceBack(Br+ti[Mn],Br+ti[Mn+2],Br+ti[Mn+1]);G.primitiveLength+=ti.length/3,G.vertexLength+=D}}var Vi;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,p)},gn("FillExtrusionBucket",Uu,{omit:["layers","features"]});var rd={paint:new Ho({"fill-extrusion-opacity":new Ln(ce["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new wn(ce["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ln(ce["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ln(ce["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Hc(ce["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new wn(ce["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new wn(ce["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ln(ce["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},rl=function(t){function o(u){t.call(this,u,rd)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new Uu(u)},o.prototype.queryRadius=function(){return Eo(this.paint.get("fill-extrusion-translate"))},o.prototype.is3D=function(){return!0},o.prototype.queryIntersectsFeature=function(u,p,y,b,C,I,D,z){var U=zu(u,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),I.angle,D),G=this.paint.get("fill-extrusion-height").evaluate(p,y),q=this.paint.get("fill-extrusion-base").evaluate(p,y),ie=function(Re,k,Ze,at){for(var Ct=[],zt=0,Vt=Re;zt<Vt.length;zt+=1){var sr=Vt[zt],Pr=[sr.x,sr.y,0,1];Kc(Pr,Pr,k),Ct.push(new le(Pr[0]/Pr[3],Pr[1]/Pr[3]))}return Ct}(U,z),Pe=function(Re,k,Ze,at){for(var Ct=[],zt=[],Vt=at[8]*k,sr=at[9]*k,Pr=at[10]*k,Br=at[11]*k,zn=at[8]*Ze,hn=at[9]*Ze,Wn=at[10]*Ze,dn=at[11]*Ze,Ri=0,ti=Re;Ri<ti.length;Ri+=1){for(var Mn=[],Vi=[],Ci=0,ta=ti[Ri];Ci<ta.length;Ci+=1){var Yn=ta[Ci],fa=Yn.x,Ja=Yn.y,_o=at[0]*fa+at[4]*Ja+at[12],Wa=at[1]*fa+at[5]*Ja+at[13],eo=at[2]*fa+at[6]*Ja+at[14],xo=at[3]*fa+at[7]*Ja+at[15],Yo=eo+Pr,rs=xo+Br,Gs=_o+zn,ns=Wa+hn,Hs=eo+Wn,Ga=xo+dn,ds=new le((_o+Vt)/rs,(Wa+sr)/rs);ds.z=Yo/rs,Mn.push(ds);var Ai=new le(Gs/Ga,ns/Ga);Ai.z=Hs/Ga,Vi.push(Ai)}Ct.push(Mn),zt.push(Vi)}return[Ct,zt]}(b,q,G,z);return function(Re,k,Ze){var at=1/0;nu(Ze,k)&&(at=af(Ze,k[0]));for(var Ct=0;Ct<k.length;Ct++)for(var zt=k[Ct],Vt=Re[Ct],sr=0;sr<zt.length-1;sr++){var Pr=zt[sr],Br=[Pr,zt[sr+1],Vt[sr+1],Vt[sr],Pr];Bu(Ze,Br)&&(at=Math.min(at,af(Ze,Br)))}return at!==1/0&&at}(Pe[0],Pe[1],ie)},o}(gu);function Df(t,o){return t.x*o.x+t.y*o.y}function af(t,o){if(t.length===1){for(var u,p=0,y=o[p++];!u||y.equals(u);)if(!(u=o[p++]))return 1/0;for(;p<o.length;p++){var b=o[p],C=t[0],I=u.sub(y),D=b.sub(y),z=C.sub(y),U=Df(I,I),G=Df(I,D),q=Df(D,D),ie=Df(z,I),Pe=Df(z,D),Re=U*q-G*G,k=(q*ie-G*Pe)/Re,Ze=(U*Pe-G*ie)/Re,at=y.z*(1-k-Ze)+u.z*k+b.z*Ze;if(isFinite(at))return at}return 1/0}for(var Ct=1/0,zt=0,Vt=o;zt<Vt.length;zt+=1)Ct=Math.min(Ct,Vt[zt].z);return Ct}var xc=La([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,mp=La([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,of=Cu.VectorTileFeature.types,jh=Math.cos(Math.PI/180*37.5),Ia=Math.pow(2,14)/.5,Ki=function(t){var o=this;this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(u){o.gradients[u.id]={}}),this.layoutVertexArray=new pi,this.layoutVertexArray2=new zs,this.indexArray=new ml,this.programConfigurations=new qn(t.layers,t.zoom),this.segments=new fe,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};Ki.prototype.populate=function(t,o,u){this.hasPattern=ef("line",this.layers,o);for(var p=this.layers[0].layout.get("line-sort-key"),y=[],b=0,C=t;b<C.length;b+=1){var I=C[b],D=I.feature,z=I.id,U=I.index,G=I.sourceLayerIndex,q=this.layers[0]._featureFilter.needGeometry,ie=fo(D,q);if(this.layers[0]._featureFilter.filter(new Mi(this.zoom),ie,u)){var Pe=p?p.evaluate(ie,{},u):void 0,Re={id:z,properties:D.properties,type:D.type,sourceLayerIndex:G,index:U,geometry:q?ie.geometry:Ha(D),patterns:{},sortKey:Pe};y.push(Re)}}p&&y.sort(function(Pr,Br){return Pr.sortKey-Br.sortKey});for(var k=0,Ze=y;k<Ze.length;k+=1){var at=Ze[k],Ct=at.geometry,zt=at.index,Vt=at.sourceLayerIndex;if(this.hasPattern){var sr=kf("line",this.layers,at,this.zoom,o);this.patternFeatures.push(sr)}else this.addFeature(at,Ct,zt,u,{});o.featureIndex.insert(t[zt].feature,Ct,zt,Vt,this.index)}},Ki.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},Ki.prototype.addFeatures=function(t,o,u){for(var p=0,y=this.patternFeatures;p<y.length;p+=1){var b=y[p];this.addFeature(b,b.geometry,b.index,o,u)}},Ki.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Ki.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ki.prototype.upload=function(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,mp)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,xc),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Ki.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ki.prototype.lineFeatureClips=function(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}},Ki.prototype.addFeature=function(t,o,u,p,y){var b=this.layers[0].layout,C=b.get("line-join").evaluate(t,{}),I=b.get("line-cap"),D=b.get("line-miter-limit"),z=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(var U=0,G=o;U<G.length;U+=1)this.addLine(G[U],t,C,I,D,z);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,p)},Ki.prototype.addLine=function(t,o,u,p,y,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var C=0;C<t.length-1;C++)this.totalDistance+=t[C].dist(t[C+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var I=of[o.type]==="Polygon",D=t.length;D>=2&&t[D-1].equals(t[D-2]);)D--;for(var z=0;z<D-1&&t[z].equals(t[z+1]);)z++;if(!(D<(I?3:2))){u==="bevel"&&(y=1.05);var U,G=this.overscaling<=16?122880/(512*this.overscaling):0,q=this.segments.prepareSegment(10*D,this.layoutVertexArray,this.indexArray),ie=void 0,Pe=void 0,Re=void 0,k=void 0;this.e1=this.e2=-1,I&&(k=t[z].sub(U=t[D-2])._unit()._perp());for(var Ze=z;Ze<D;Ze++)if(!(Pe=Ze===D-1?I?t[z+1]:void 0:t[Ze+1])||!t[Ze].equals(Pe)){k&&(Re=k),U&&(ie=U),U=t[Ze],k=Pe?Pe.sub(U)._unit()._perp():Re;var at=(Re=Re||k).add(k);at.x===0&&at.y===0||at._unit();var Ct=Re.x*k.x+Re.y*k.y,zt=at.x*k.x+at.y*k.y,Vt=zt!==0?1/zt:1/0,sr=2*Math.sqrt(2-2*zt),Pr=zt<jh&&ie&&Pe,Br=Re.x*k.y-Re.y*k.x>0;if(Pr&&Ze>z){var zn=U.dist(ie);if(zn>2*G){var hn=U.sub(U.sub(ie)._mult(G/zn)._round());this.updateDistance(ie,hn),this.addCurrentVertex(hn,Re,0,0,q),ie=hn}}var Wn=ie&&Pe,dn=Wn?u:I?"butt":p;if(Wn&&dn==="round"&&(Vt<b?dn="miter":Vt<=2&&(dn="fakeround")),dn==="miter"&&Vt>y&&(dn="bevel"),dn==="bevel"&&(Vt>2&&(dn="flipbevel"),Vt<y&&(dn="miter")),ie&&this.updateDistance(ie,U),dn==="miter")at._mult(Vt),this.addCurrentVertex(U,at,0,0,q);else if(dn==="flipbevel"){if(Vt>100)at=k.mult(-1);else{var Ri=Vt*Re.add(k).mag()/Re.sub(k).mag();at._perp()._mult(Ri*(Br?-1:1))}this.addCurrentVertex(U,at,0,0,q),this.addCurrentVertex(U,at.mult(-1),0,0,q)}else if(dn==="bevel"||dn==="fakeround"){var ti=-Math.sqrt(Vt*Vt-1),Mn=Br?ti:0,Vi=Br?0:ti;if(ie&&this.addCurrentVertex(U,Re,Mn,Vi,q),dn==="fakeround")for(var Ci=Math.round(180*sr/Math.PI/20),ta=1;ta<Ci;ta++){var Yn=ta/Ci;if(Yn!==.5){var fa=Yn-.5;Yn+=Yn*fa*(Yn-1)*((1.0904+Ct*(Ct*(3.55645-1.43519*Ct)-3.2452))*fa*fa+(.848013+Ct*(.215638*Ct-1.06021)))}var Ja=k.sub(Re)._mult(Yn)._add(Re)._unit()._mult(Br?-1:1);this.addHalfVertex(U,Ja.x,Ja.y,!1,Br,0,q)}Pe&&this.addCurrentVertex(U,k,-Mn,-Vi,q)}else if(dn==="butt")this.addCurrentVertex(U,at,0,0,q);else if(dn==="square"){var _o=ie?1:-1;this.addCurrentVertex(U,at,_o,_o,q)}else dn==="round"&&(ie&&(this.addCurrentVertex(U,Re,0,0,q),this.addCurrentVertex(U,Re,1,1,q,!0)),Pe&&(this.addCurrentVertex(U,k,-1,-1,q,!0),this.addCurrentVertex(U,k,0,0,q)));if(Pr&&Ze<D-1){var Wa=U.dist(Pe);if(Wa>2*G){var eo=U.add(Pe.sub(U)._mult(G/Wa)._round());this.updateDistance(U,eo),this.addCurrentVertex(eo,k,0,0,q),U=eo}}}}},Ki.prototype.addCurrentVertex=function(t,o,u,p,y,b){b===void 0&&(b=!1);var C=o.y*p-o.x,I=-o.y-o.x*p;this.addHalfVertex(t,o.x+o.y*u,o.y-o.x*u,b,!1,u,y),this.addHalfVertex(t,C,I,b,!0,-p,y),this.distance>Ia/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(t,o,u,p,y,b))},Ki.prototype.addHalfVertex=function(t,o,u,p,y,b,C){var I=.5*(this.lineClips?this.scaledDistance*(Ia-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t.x<<1)+(p?1:0),(t.y<<1)+(y?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(b===0?0:b<0?-1:1)|(63&I)<<2,I>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var D=C.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),C.primitiveLength++),y?this.e2=D:this.e1=D},Ki.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Ki.prototype.updateDistance=function(t,o){this.distance+=t.dist(o),this.updateScaledDistance()},gn("LineBucket",Ki,{omit:["layers","patternFeatures"]});var bc=new Ho({"line-cap":new Ln(ce.layout_line["line-cap"]),"line-join":new wn(ce.layout_line["line-join"]),"line-miter-limit":new Ln(ce.layout_line["line-miter-limit"]),"line-round-limit":new Ln(ce.layout_line["line-round-limit"]),"line-sort-key":new wn(ce.layout_line["line-sort-key"])}),Po={paint:new Ho({"line-opacity":new wn(ce.paint_line["line-opacity"]),"line-color":new wn(ce.paint_line["line-color"]),"line-translate":new Ln(ce.paint_line["line-translate"]),"line-translate-anchor":new Ln(ce.paint_line["line-translate-anchor"]),"line-width":new wn(ce.paint_line["line-width"]),"line-gap-width":new wn(ce.paint_line["line-gap-width"]),"line-offset":new wn(ce.paint_line["line-offset"]),"line-blur":new wn(ce.paint_line["line-blur"]),"line-dasharray":new Qo(ce.paint_line["line-dasharray"]),"line-pattern":new Hc(ce.paint_line["line-pattern"]),"line-gradient":new eu(ce.paint_line["line-gradient"])}),layout:bc},js=new(function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.possiblyEvaluate=function(u,p){return p=new Mi(Math.floor(p.zoom),{now:p.now,fadeDuration:p.fadeDuration,zoomHistory:p.zoomHistory,transition:p.transition}),t.prototype.possiblyEvaluate.call(this,u,p)},o.prototype.evaluate=function(u,p,y,b){return p=Mt({},p,{zoom:Math.floor(p.zoom)}),t.prototype.evaluate.call(this,u,p,y,b)},o}(wn))(Po.paint.properties["line-width"].specification);js.useIntegerZoom=!0;var nd=function(t){function o(u){t.call(this,u,Po),this.gradientVersion=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._handleSpecialPaintPropertyUpdate=function(u){u==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Es,this.gradientVersion=(this.gradientVersion+1)%Je)},o.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},o.prototype.recalculate=function(u,p){t.prototype.recalculate.call(this,u,p),this.paint._values["line-floorwidth"]=js.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)},o.prototype.createBucket=function(u){return new Ki(u)},o.prototype.queryRadius=function(u){var p=u,y=gp(Su("line-width",this,p),Su("line-gap-width",this,p)),b=Su("line-offset",this,p);return y/2+Math.abs(b)+Eo(this.paint.get("line-translate"))},o.prototype.queryIntersectsFeature=function(u,p,y,b,C,I,D){var z=zu(u,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),I.angle,D),U=D/2*gp(this.paint.get("line-width").evaluate(p,y),this.paint.get("line-gap-width").evaluate(p,y)),G=this.paint.get("line-offset").evaluate(p,y);return G&&(b=function(q,ie){for(var Pe=[],Re=new le(0,0),k=0;k<q.length;k++){for(var Ze=q[k],at=[],Ct=0;Ct<Ze.length;Ct++){var zt=Ze[Ct],Vt=Ze[Ct+1],sr=Ct===0?Re:zt.sub(Ze[Ct-1])._unit()._perp(),Pr=Ct===Ze.length-1?Re:Vt.sub(zt)._unit()._perp(),Br=sr._add(Pr)._unit();Br._mult(1/(Br.x*Pr.x+Br.y*Pr.y)),at.push(Br._mult(ie)._add(zt))}Pe.push(at)}return Pe}(b,G*D)),function(q,ie,Pe){for(var Re=0;Re<ie.length;Re++){var k=ie[Re];if(q.length>=3){for(var Ze=0;Ze<k.length;Ze++)if(iu(q,k[Ze]))return!0}if(Jo(q,k,Pe))return!0}return!1}(z,b,U)},o.prototype.isTileClipped=function(){return!0},o}(gu);function gp(t,o){return o>0?o+2*t:t}var Ld=La([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Vh=La([{name:"a_projected_pos",components:3,type:"Float32"}],4),Dd=(La([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),La([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),yp=(La([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),La([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Al=La([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function ch(t,o,u){return t.sections.forEach(function(p){p.text=function(y,b,C){var I=b.layout.get("text-transform").evaluate(C,{});return I==="uppercase"?y=y.toLocaleUpperCase():I==="lowercase"&&(y=y.toLocaleLowerCase()),Os.applyArabicShaping&&(y=Os.applyArabicShaping(y)),y}(p.text,o,u)}),t}La([{name:"triangle",components:3,type:"Uint16"}]),La([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),La([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),La([{type:"Float32",name:"offsetX"}]),La([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Kl={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},id=function(t,o,u,p,y){var b,C,I=8*y-p-1,D=(1<<I)-1,z=D>>1,U=-7,G=u?y-1:0,q=u?-1:1,ie=t[o+G];for(G+=q,b=ie&(1<<-U)-1,ie>>=-U,U+=I;U>0;b=256*b+t[o+G],G+=q,U-=8);for(C=b&(1<<-U)-1,b>>=-U,U+=p;U>0;C=256*C+t[o+G],G+=q,U-=8);if(b===0)b=1-z;else{if(b===D)return C?NaN:1/0*(ie?-1:1);C+=Math.pow(2,p),b-=z}return(ie?-1:1)*C*Math.pow(2,b-p)},fh=function(t,o,u,p,y,b){var C,I,D,z=8*b-y-1,U=(1<<z)-1,G=U>>1,q=y===23?Math.pow(2,-24)-Math.pow(2,-77):0,ie=p?0:b-1,Pe=p?1:-1,Re=o<0||o===0&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(I=isNaN(o)?1:0,C=U):(C=Math.floor(Math.log(o)/Math.LN2),o*(D=Math.pow(2,-C))<1&&(C--,D*=2),(o+=C+G>=1?q/D:q*Math.pow(2,1-G))*D>=2&&(C++,D/=2),C+G>=U?(I=0,C=U):C+G>=1?(I=(o*D-1)*Math.pow(2,y),C+=G):(I=o*Math.pow(2,G-1)*Math.pow(2,y),C=0));y>=8;t[u+ie]=255&I,ie+=Pe,I/=256,y-=8);for(C=C<<y|I,z+=y;z>0;t[u+ie]=255&C,ie+=Pe,C/=256,z-=8);t[u+ie-Pe]|=128*Re},sf=ba;function ba(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}ba.Varint=0,ba.Fixed64=1,ba.Bytes=2,ba.Fixed32=5;var Gh=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function $l(t){return t.type===ba.Bytes?t.readVarint()+t.pos:t.pos+1}function Ff(t,o,u){return u?4294967296*o+(t>>>0):4294967296*(o>>>0)+(t>>>0)}function _p(t,o,u){var p=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));u.realloc(p);for(var y=u.pos-1;y>=t;y--)u.buf[y+p]=u.buf[y]}function Fd(t,o){for(var u=0;u<t.length;u++)o.writeVarint(t[u])}function N(t,o){for(var u=0;u<t.length;u++)o.writeSVarint(t[u])}function ve(t,o){for(var u=0;u<t.length;u++)o.writeFloat(t[u])}function Ne(t,o){for(var u=0;u<t.length;u++)o.writeDouble(t[u])}function Dt(t,o){for(var u=0;u<t.length;u++)o.writeBoolean(t[u])}function ar(t,o){for(var u=0;u<t.length;u++)o.writeFixed32(t[u])}function kt(t,o){for(var u=0;u<t.length;u++)o.writeSFixed32(t[u])}function qt(t,o){for(var u=0;u<t.length;u++)o.writeFixed64(t[u])}function fr(t,o){for(var u=0;u<t.length;u++)o.writeSFixed64(t[u])}function mr(t,o){return(t[o]|t[o+1]<<8|t[o+2]<<16)+16777216*t[o+3]}function xr(t,o,u){t[u]=o,t[u+1]=o>>>8,t[u+2]=o>>>16,t[u+3]=o>>>24}function Tr(t,o){return(t[o]|t[o+1]<<8|t[o+2]<<16)+(t[o+3]<<24)}function Mr(t,o,u){t===1&&u.readMessage(Gr,o)}function Gr(t,o,u){if(t===3){var p=u.readMessage(yr,{}),y=p.width,b=p.height,C=p.left,I=p.top,D=p.advance;o.push({id:p.id,bitmap:new su({width:y+6,height:b+6},p.bitmap),metrics:{width:y,height:b,left:C,top:I,advance:D}})}}function yr(t,o,u){t===1?o.id=u.readVarint():t===2?o.bitmap=u.readBytes():t===3?o.width=u.readVarint():t===4?o.height=u.readVarint():t===5?o.left=u.readSVarint():t===6?o.top=u.readSVarint():t===7&&(o.advance=u.readVarint())}function Cr(t){for(var o=0,u=0,p=0,y=t;p<y.length;p+=1){var b=y[p];o+=b.w*b.h,u=Math.max(u,b.w)}t.sort(function(Re,k){return k.h-Re.h});for(var C=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),u),h:1/0}],I=0,D=0,z=0,U=t;z<U.length;z+=1)for(var G=U[z],q=C.length-1;q>=0;q--){var ie=C[q];if(!(G.w>ie.w||G.h>ie.h)){if(G.x=ie.x,G.y=ie.y,D=Math.max(D,G.y+G.h),I=Math.max(I,G.x+G.w),G.w===ie.w&&G.h===ie.h){var Pe=C.pop();q<C.length&&(C[q]=Pe)}else G.h===ie.h?(ie.x+=G.w,ie.w-=G.w):G.w===ie.w?(ie.y+=G.h,ie.h-=G.h):(C.push({x:ie.x+G.w,y:ie.y,w:ie.w-G.w,h:G.h}),ie.y+=G.h,ie.h-=G.h);break}}return{w:I,h:D,fill:o/(I*D)||0}}ba.prototype={destroy:function(){this.buf=null},readFields:function(t,o,u){for(u=u||this.length;this.pos<u;){var p=this.readVarint(),y=p>>3,b=this.pos;this.type=7&p,t(y,o,this),this.pos===b&&this.skip(p)}return o},readMessage:function(t,o){return this.readFields(t,o,this.readVarint()+this.pos)},readFixed32:function(){var t=mr(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Tr(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=mr(this.buf,this.pos)+4294967296*mr(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=mr(this.buf,this.pos)+4294967296*Tr(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=id(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=id(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var o,u,p=this.buf;return o=127&(u=p[this.pos++]),u<128?o:(o|=(127&(u=p[this.pos++]))<<7,u<128?o:(o|=(127&(u=p[this.pos++]))<<14,u<128?o:(o|=(127&(u=p[this.pos++]))<<21,u<128?o:function(y,b,C){var I,D,z=C.buf;if(I=(112&(D=z[C.pos++]))>>4,D<128||(I|=(127&(D=z[C.pos++]))<<3,D<128)||(I|=(127&(D=z[C.pos++]))<<10,D<128)||(I|=(127&(D=z[C.pos++]))<<17,D<128)||(I|=(127&(D=z[C.pos++]))<<24,D<128)||(I|=(1&(D=z[C.pos++]))<<31,D<128))return Ff(y,I,b);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(u=p[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,o=this.pos;return this.pos=t,t-o>=12&&Gh?function(u,p,y){return Gh.decode(u.subarray(p,y))}(this.buf,o,t):function(u,p,y){for(var b="",C=p;C<y;){var I,D,z,U=u[C],G=null,q=U>239?4:U>223?3:U>191?2:1;if(C+q>y)break;q===1?U<128&&(G=U):q===2?(192&(I=u[C+1]))==128&&(G=(31&U)<<6|63&I)<=127&&(G=null):q===3?(D=u[C+2],(192&(I=u[C+1]))==128&&(192&D)==128&&((G=(15&U)<<12|(63&I)<<6|63&D)<=2047||G>=55296&&G<=57343)&&(G=null)):q===4&&(D=u[C+2],z=u[C+3],(192&(I=u[C+1]))==128&&(192&D)==128&&(192&z)==128&&((G=(15&U)<<18|(63&I)<<12|(63&D)<<6|63&z)<=65535||G>=1114112)&&(G=null)),G===null?(G=65533,q=1):G>65535&&(G-=65536,b+=String.fromCharCode(G>>>10&1023|55296),G=56320|1023&G),b+=String.fromCharCode(G),C+=q}return b}(this.buf,o,t)},readBytes:function(){var t=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,t);return this.pos=t,o},readPackedVarint:function(t,o){if(this.type!==ba.Bytes)return t.push(this.readVarint(o));var u=$l(this);for(t=t||[];this.pos<u;)t.push(this.readVarint(o));return t},readPackedSVarint:function(t){if(this.type!==ba.Bytes)return t.push(this.readSVarint());var o=$l(this);for(t=t||[];this.pos<o;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==ba.Bytes)return t.push(this.readBoolean());var o=$l(this);for(t=t||[];this.pos<o;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==ba.Bytes)return t.push(this.readFloat());var o=$l(this);for(t=t||[];this.pos<o;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==ba.Bytes)return t.push(this.readDouble());var o=$l(this);for(t=t||[];this.pos<o;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==ba.Bytes)return t.push(this.readFixed32());var o=$l(this);for(t=t||[];this.pos<o;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==ba.Bytes)return t.push(this.readSFixed32());var o=$l(this);for(t=t||[];this.pos<o;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==ba.Bytes)return t.push(this.readFixed64());var o=$l(this);for(t=t||[];this.pos<o;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==ba.Bytes)return t.push(this.readSFixed64());var o=$l(this);for(t=t||[];this.pos<o;)t.push(this.readSFixed64());return t},skip:function(t){var o=7&t;if(o===ba.Varint)for(;this.buf[this.pos++]>127;);else if(o===ba.Bytes)this.pos=this.readVarint()+this.pos;else if(o===ba.Fixed32)this.pos+=4;else{if(o!==ba.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(t,o){this.writeVarint(t<<3|o)},realloc:function(t){for(var o=this.length||16;o<this.pos+t;)o*=2;if(o!==this.length){var u=new Uint8Array(o);u.set(this.buf),this.buf=u,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),xr(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),xr(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),xr(this.buf,-1&t,this.pos),xr(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),xr(this.buf,-1&t,this.pos),xr(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(o,u){var p,y;if(o>=0?(p=o%4294967296|0,y=o/4294967296|0):(y=~(-o/4294967296),4294967295^(p=~(-o%4294967296))?p=p+1|0:(p=0,y=y+1|0)),o>=18446744073709552e3||o<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),function(b,C,I){I.buf[I.pos++]=127&b|128,b>>>=7,I.buf[I.pos++]=127&b|128,b>>>=7,I.buf[I.pos++]=127&b|128,b>>>=7,I.buf[I.pos++]=127&b|128,I.buf[I.pos]=127&(b>>>=7)}(p,0,u),function(b,C){var I=(7&b)<<4;C.buf[C.pos++]|=I|((b>>>=3)?128:0),b&&(C.buf[C.pos++]=127&b|((b>>>=7)?128:0),b&&(C.buf[C.pos++]=127&b|((b>>>=7)?128:0),b&&(C.buf[C.pos++]=127&b|((b>>>=7)?128:0),b&&(C.buf[C.pos++]=127&b|((b>>>=7)?128:0),b&&(C.buf[C.pos++]=127&b)))))}(y,u)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var o=this.pos;this.pos=function(p,y,b){for(var C,I,D=0;D<y.length;D++){if((C=y.charCodeAt(D))>55295&&C<57344){if(!I){C>56319||D+1===y.length?(p[b++]=239,p[b++]=191,p[b++]=189):I=C;continue}if(C<56320){p[b++]=239,p[b++]=191,p[b++]=189,I=C;continue}C=I-55296<<10|C-56320|65536,I=null}else I&&(p[b++]=239,p[b++]=191,p[b++]=189,I=null);C<128?p[b++]=C:(C<2048?p[b++]=C>>6|192:(C<65536?p[b++]=C>>12|224:(p[b++]=C>>18|240,p[b++]=C>>12&63|128),p[b++]=C>>6&63|128),p[b++]=63&C|128)}return b}(this.buf,t,this.pos);var u=this.pos-o;u>=128&&_p(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u},writeFloat:function(t){this.realloc(4),fh(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),fh(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var o=t.length;this.writeVarint(o),this.realloc(o);for(var u=0;u<o;u++)this.buf[this.pos++]=t[u]},writeRawMessage:function(t,o){this.pos++;var u=this.pos;t(o,this);var p=this.pos-u;p>=128&&_p(u,p,this),this.pos=u-1,this.writeVarint(p),this.pos+=p},writeMessage:function(t,o,u){this.writeTag(t,ba.Bytes),this.writeRawMessage(o,u)},writePackedVarint:function(t,o){o.length&&this.writeMessage(t,Fd,o)},writePackedSVarint:function(t,o){o.length&&this.writeMessage(t,N,o)},writePackedBoolean:function(t,o){o.length&&this.writeMessage(t,Dt,o)},writePackedFloat:function(t,o){o.length&&this.writeMessage(t,ve,o)},writePackedDouble:function(t,o){o.length&&this.writeMessage(t,Ne,o)},writePackedFixed32:function(t,o){o.length&&this.writeMessage(t,ar,o)},writePackedSFixed32:function(t,o){o.length&&this.writeMessage(t,kt,o)},writePackedFixed64:function(t,o){o.length&&this.writeMessage(t,qt,o)},writePackedSFixed64:function(t,o){o.length&&this.writeMessage(t,fr,o)},writeBytesField:function(t,o){this.writeTag(t,ba.Bytes),this.writeBytes(o)},writeFixed32Field:function(t,o){this.writeTag(t,ba.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(t,o){this.writeTag(t,ba.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(t,o){this.writeTag(t,ba.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(t,o){this.writeTag(t,ba.Fixed64),this.writeSFixed64(o)},writeVarintField:function(t,o){this.writeTag(t,ba.Varint),this.writeVarint(o)},writeSVarintField:function(t,o){this.writeTag(t,ba.Varint),this.writeSVarint(o)},writeStringField:function(t,o){this.writeTag(t,ba.Bytes),this.writeString(o)},writeFloatField:function(t,o){this.writeTag(t,ba.Fixed32),this.writeFloat(o)},writeDoubleField:function(t,o){this.writeTag(t,ba.Fixed64),this.writeDouble(o)},writeBooleanField:function(t,o){this.writeVarintField(t,Boolean(o))}};var ot=function(t,o){var u=o.pixelRatio,p=o.version,y=o.stretchX,b=o.stretchY,C=o.content;this.paddedRect=t,this.pixelRatio=u,this.stretchX=y,this.stretchY=b,this.content=C,this.version=p},jt={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};jt.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},jt.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},jt.tlbr.get=function(){return this.tl.concat(this.br)},jt.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(ot.prototype,jt);var br=function(t,o){var u={},p={};this.haveRenderCallbacks=[];var y=[];this.addImages(t,u,y),this.addImages(o,p,y);var b=Cr(y),C=new Bo({width:b.w||1,height:b.h||1});for(var I in t){var D=t[I],z=u[I].paddedRect;Bo.copy(D.data,C,{x:0,y:0},{x:z.x+1,y:z.y+1},D.data)}for(var U in o){var G=o[U],q=p[U].paddedRect,ie=q.x+1,Pe=q.y+1,Re=G.data.width,k=G.data.height;Bo.copy(G.data,C,{x:0,y:0},{x:ie,y:Pe},G.data),Bo.copy(G.data,C,{x:0,y:k-1},{x:ie,y:Pe-1},{width:Re,height:1}),Bo.copy(G.data,C,{x:0,y:0},{x:ie,y:Pe+k},{width:Re,height:1}),Bo.copy(G.data,C,{x:Re-1,y:0},{x:ie-1,y:Pe},{width:1,height:k}),Bo.copy(G.data,C,{x:0,y:0},{x:ie+Re,y:Pe},{width:1,height:k})}this.image=C,this.iconPositions=u,this.patternPositions=p};br.prototype.addImages=function(t,o,u){for(var p in t){var y=t[p],b={x:0,y:0,w:y.data.width+2,h:y.data.height+2};u.push(b),o[p]=new ot(b,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(p)}},br.prototype.patchUpdatedImages=function(t,o){for(var u in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[u],t.getImage(u),o),this.patchUpdatedImage(this.patternPositions[u],t.getImage(u),o)},br.prototype.patchUpdatedImage=function(t,o,u){if(t&&o&&t.version!==o.version){t.version=o.version;var p=t.tl;u.update(o.data,void 0,{x:p[0],y:p[1]})}},gn("ImagePosition",ot),gn("ImageAtlas",br);var Zr={horizontal:1,vertical:2,horizontalOnly:3},cr=function(){this.scale=1,this.fontStack="",this.imageName=null};cr.forText=function(t,o){var u=new cr;return u.scale=t||1,u.fontStack=o,u},cr.forImage=function(t){var o=new cr;return o.imageName=t,o};var Rr=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Qr(t,o,u,p,y,b,C,I,D,z,U,G,q,ie,Pe,Re){var k,Ze=Rr.fromFeature(t,y);G===Zr.vertical&&Ze.verticalizePunctuation();var at=Os.processBidirectionalText,Ct=Os.processStyledBidirectionalText;if(at&&Ze.sections.length===1){k=[];for(var zt=0,Vt=at(Ze.toString(),qr(Ze,z,b,o,p,ie,Pe));zt<Vt.length;zt+=1){var sr=Vt[zt],Pr=new Rr;Pr.text=sr,Pr.sections=Ze.sections;for(var Br=0;Br<sr.length;Br++)Pr.sectionIndex.push(0);k.push(Pr)}}else if(Ct){k=[];for(var zn=0,hn=Ct(Ze.text,Ze.sectionIndex,qr(Ze,z,b,o,p,ie,Pe));zn<hn.length;zn+=1){var Wn=hn[zn],dn=new Rr;dn.text=Wn[0],dn.sectionIndex=Wn[1],dn.sections=Ze.sections,k.push(dn)}}else k=function(Mn,Vi){for(var Ci=[],ta=Mn.text,Yn=0,fa=0,Ja=Vi;fa<Ja.length;fa+=1){var _o=Ja[fa];Ci.push(Mn.substring(Yn,_o)),Yn=_o}return Yn<ta.length&&Ci.push(Mn.substring(Yn,ta.length)),Ci}(Ze,qr(Ze,z,b,o,p,ie,Pe));var Ri=[],ti={positionedLines:Ri,text:Ze.toString(),top:U[1],bottom:U[1],left:U[0],right:U[0],writingMode:G,iconsInText:!1,verticalizable:!1};return function(Mn,Vi,Ci,ta,Yn,fa,Ja,_o,Wa,eo,xo,Yo){for(var rs=0,Gs=-17,ns=0,Hs=0,Ga=_o==="right"?1:_o==="left"?0:.5,ds=0,Ai=0,Fa=Yn;Ai<Fa.length;Ai+=1){var wa=Fa[Ai];wa.trim();var la=wa.getMaxScale(),vs=24*(la-1),Ts={positionedGlyphs:[],lineOffset:0};Mn.positionedLines[ds]=Ts;var Xa=Ts.positionedGlyphs,Ro=0;if(wa.length()){for(var ms=0;ms<wa.length();ms++){var ha=wa.getSection(ms),ec=wa.getSectionIndex(ms),uu=wa.getCharCode(ms),lf=0,ko=null,Ac=null,nl=null,Yh=24,Nf=!(Wa===Zr.horizontal||!xo&&!wf(uu)||xo&&(Un[uu]||(Tc=uu,Vr.Arabic(Tc)||Vr["Arabic Supplement"](Tc)||Vr["Arabic Extended-A"](Tc)||Vr["Arabic Presentation Forms-A"](Tc)||Vr["Arabic Presentation Forms-B"](Tc))));if(ha.imageName){var ph=ta[ha.imageName];if(!ph)continue;nl=ha.imageName,Mn.iconsInText=Mn.iconsInText||!0,Ac=ph.paddedRect;var wc=ph.displaySize;ha.scale=24*ha.scale/Yo,lf=vs+(24-wc[1]*ha.scale),Yh=(ko={width:wc[0],height:wc[1],left:1,top:-3,advance:Nf?wc[1]:wc[0]}).advance;var dh=Nf?wc[0]*ha.scale-24*la:wc[1]*ha.scale-24*la;dh>0&&dh>Ro&&(Ro=dh)}else{var xp=Ci[ha.fontStack],vh=xp&&xp[uu];if(vh&&vh.rect)Ac=vh.rect,ko=vh.metrics;else{var qh=Vi[ha.fontStack],bp=qh&&qh[uu];if(!bp)continue;ko=bp.metrics}lf=24*(la-ha.scale)}Nf?(Mn.verticalizable=!0,Xa.push({glyph:uu,imageName:nl,x:rs,y:Gs+lf,vertical:Nf,scale:ha.scale,fontStack:ha.fontStack,sectionIndex:ec,metrics:ko,rect:Ac}),rs+=Yh*ha.scale+eo):(Xa.push({glyph:uu,imageName:nl,x:rs,y:Gs+lf,vertical:Nf,scale:ha.scale,fontStack:ha.fontStack,sectionIndex:ec,metrics:ko,rect:Ac}),rs+=ko.advance*ha.scale+eo)}Xa.length!==0&&(ns=Math.max(rs-eo,ns),gi(Xa,0,Xa.length-1,Ga,Ro)),rs=0;var Ep=fa*la+Ro;Ts.lineOffset=Math.max(Ro,vs),Gs+=Ep,Hs=Math.max(Ep,Hs),++ds}else Gs+=fa,++ds}var Tc,Kh=Gs- -17,mh=Kr(Ja),cf=mh.horizontalAlign,gh=mh.verticalAlign;(function(Sp,Cp,$h,gs,Ap,Qh,Jh,ep,wp){var yh,Tp=(Cp-$h)*Ap;yh=Qh!==Jh?-ep*gs- -17:(-gs*wp+.5)*Jh;for(var _h=0,tp=Sp;_h<tp.length;_h+=1)for(var zf=0,rp=tp[_h].positionedGlyphs;zf<rp.length;zf+=1){var xh=rp[zf];xh.x+=Tp,xh.y+=yh}})(Mn.positionedLines,Ga,cf,gh,ns,Hs,fa,Kh,Yn.length),Mn.top+=-gh*Kh,Mn.bottom=Mn.top+Kh,Mn.left+=-cf*ns,Mn.right=Mn.left+ns}(ti,o,u,p,k,C,I,D,G,z,q,Re),!function(Mn){for(var Vi=0,Ci=Mn;Vi<Ci.length;Vi+=1)if(Ci[Vi].positionedGlyphs.length!==0)return!1;return!0}(Ri)&&ti}Rr.fromFeature=function(t,o){for(var u=new Rr,p=0;p<t.sections.length;p++){var y=t.sections[p];y.image?u.addImageSection(y):u.addTextSection(y,o)}return u},Rr.prototype.length=function(){return this.text.length},Rr.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},Rr.prototype.getSectionIndex=function(t){return this.sectionIndex[t]},Rr.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},Rr.prototype.verticalizePunctuation=function(){this.text=function(t){for(var o="",u=0;u<t.length;u++){var p=t.charCodeAt(u+1)||null,y=t.charCodeAt(u-1)||null;o+=p&&hl(p)&&!Kl[t[u+1]]||y&&hl(y)&&!Kl[t[u-1]]||!Kl[t[u]]?t[u]:Kl[t[u]]}return o}(this.text)},Rr.prototype.trim=function(){for(var t=0,o=0;o<this.text.length&&Un[this.text.charCodeAt(o)];o++)t++;for(var u=this.text.length,p=this.text.length-1;p>=0&&p>=t&&Un[this.text.charCodeAt(p)];p--)u--;this.text=this.text.substring(t,u),this.sectionIndex=this.sectionIndex.slice(t,u)},Rr.prototype.substring=function(t,o){var u=new Rr;return u.text=this.text.substring(t,o),u.sectionIndex=this.sectionIndex.slice(t,o),u.sections=this.sections,u},Rr.prototype.toString=function(){return this.text},Rr.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce(function(o,u){return Math.max(o,t.sections[u].scale)},0)},Rr.prototype.addTextSection=function(t,o){this.text+=t.text,this.sections.push(cr.forText(t.scale,t.fontStack||o));for(var u=this.sections.length-1,p=0;p<t.text.length;++p)this.sectionIndex.push(u)},Rr.prototype.addImageSection=function(t){var o=t.image?t.image.name:"";if(o.length!==0){var u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(cr.forImage(o)),this.sectionIndex.push(this.sections.length-1)):et("Reached maximum number of images 6401")}else et("Can't add FormattedSection with an empty image.")},Rr.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Un={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Kt={};function ir(t,o,u,p,y,b){if(o.imageName){var C=p[o.imageName];return C?C.displaySize[0]*o.scale*24/b+y:0}var I=u[o.fontStack],D=I&&I[t];return D?D.metrics.advance*o.scale+y:0}function En(t,o,u,p){var y=Math.pow(t-o,2);return p?t<o?y/2:2*y:y+Math.abs(u)*u}function Hr(t,o,u){var p=0;return t===10&&(p-=1e4),u&&(p+=150),t!==40&&t!==65288||(p+=50),o!==41&&o!==65289||(p+=50),p}function Sr(t,o,u,p,y,b){for(var C=null,I=En(o,u,y,b),D=0,z=p;D<z.length;D+=1){var U=z[D],G=En(o-U.x,u,y,b)+U.badness;G<=I&&(C=U,I=G)}return{index:t,x:o,priorBreak:C,badness:I}}function qr(t,o,u,p,y,b,C){if(b!=="point")return[];if(!t)return[];for(var I,D=[],z=function(k,Ze,at,Ct,zt,Vt){for(var sr=0,Pr=0;Pr<k.length();Pr++){var Br=k.getSection(Pr);sr+=ir(k.getCharCode(Pr),Br,Ct,zt,Ze,Vt)}return sr/Math.max(1,Math.ceil(sr/at))}(t,o,u,p,y,C),U=t.text.indexOf("\u200B")>=0,G=0,q=0;q<t.length();q++){var ie=t.getSection(q),Pe=t.getCharCode(q);if(Un[Pe]||(G+=ir(Pe,ie,p,y,o,C)),q<t.length()-1){var Re=!((I=Pe)<11904||!(Vr["Bopomofo Extended"](I)||Vr.Bopomofo(I)||Vr["CJK Compatibility Forms"](I)||Vr["CJK Compatibility Ideographs"](I)||Vr["CJK Compatibility"](I)||Vr["CJK Radicals Supplement"](I)||Vr["CJK Strokes"](I)||Vr["CJK Symbols and Punctuation"](I)||Vr["CJK Unified Ideographs Extension A"](I)||Vr["CJK Unified Ideographs"](I)||Vr["Enclosed CJK Letters and Months"](I)||Vr["Halfwidth and Fullwidth Forms"](I)||Vr.Hiragana(I)||Vr["Ideographic Description Characters"](I)||Vr["Kangxi Radicals"](I)||Vr["Katakana Phonetic Extensions"](I)||Vr.Katakana(I)||Vr["Vertical Forms"](I)||Vr["Yi Radicals"](I)||Vr["Yi Syllables"](I)));(Kt[Pe]||Re||ie.imageName)&&D.push(Sr(q+1,G,z,D,Hr(Pe,t.getCharCode(q+1),Re&&U),!1))}}return function k(Ze){return Ze?k(Ze.priorBreak).concat(Ze.index):[]}(Sr(t.length(),G,z,D,0,!0))}function Kr(t){var o=.5,u=.5;switch(t){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:o,verticalAlign:u}}function gi(t,o,u,p,y){if(p||y)for(var b=t[u],C=(t[u].x+b.metrics.advance*b.scale)*p,I=o;I<=u;I++)t[I].x-=C,t[I].y+=y}function si(t,o,u,p,y,b){var C,I=t.image;if(I.content){var D=I.content,z=I.pixelRatio||1;C=[D[0]/z,D[1]/z,I.displaySize[0]-D[2]/z,I.displaySize[1]-D[3]/z]}var U,G,q,ie,Pe=o.left*b,Re=o.right*b;u==="width"||u==="both"?(ie=y[0]+Pe-p[3],G=y[0]+Re+p[1]):G=(ie=y[0]+(Pe+Re-I.displaySize[0])/2)+I.displaySize[0];var k=o.top*b,Ze=o.bottom*b;return u==="height"||u==="both"?(U=y[1]+k-p[0],q=y[1]+Ze+p[2]):q=(U=y[1]+(k+Ze-I.displaySize[1])/2)+I.displaySize[1],{image:I,top:U,right:G,bottom:q,left:ie,collisionPadding:C}}Kt[10]=!0,Kt[32]=!0,Kt[38]=!0,Kt[40]=!0,Kt[41]=!0,Kt[43]=!0,Kt[45]=!0,Kt[47]=!0,Kt[173]=!0,Kt[183]=!0,Kt[8203]=!0,Kt[8208]=!0,Kt[8211]=!0,Kt[8231]=!0;var Wr=function(t){function o(u,p,y,b){t.call(this,u,p),this.angle=y,b!==void 0&&(this.segment=b)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.clone=function(){return new o(this.x,this.y,this.angle,this.segment)},o}(le);function nn(t,o){var u=o.expression;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new Mi(t+1))};if(u.kind==="source")return{kind:"source"};for(var p=u.zoomStops,y=u.interpolationType,b=0;b<p.length&&p[b]<=t;)b++;for(var C=b=Math.max(0,b-1);C<p.length&&p[C]<t+1;)C++;C=Math.min(p.length-1,C);var I=p[b],D=p[C];return u.kind==="composite"?{kind:"composite",minZoom:I,maxZoom:D,interpolationType:y}:{kind:"camera",minZoom:I,maxZoom:D,minSize:u.evaluate(new Mi(I)),maxSize:u.evaluate(new Mi(D)),interpolationType:y}}function Jn(t,o,u){var p=o.uSize,y=u.lowerSize;return t.kind==="source"?y/128:t.kind==="composite"?ma(y/128,u.upperSize/128,o.uSizeT):p}function fi(t,o){var u=0,p=0;if(t.kind==="constant")p=t.layoutSize;else if(t.kind!=="source"){var y=t.interpolationType,b=y?$t(be.interpolationFactor(y,o,t.minZoom,t.maxZoom),0,1):0;t.kind==="camera"?p=ma(t.minSize,t.maxSize,b):u=b}return{uSizeT:u,uSize:p}}gn("Anchor",Wr);var Zi=Object.freeze({__proto__:null,getSizeData:nn,evaluateSizeForFeature:Jn,evaluateSizeForZoom:fi,SIZE_PACK_FACTOR:128});function oo(t,o,u,p,y){if(o.segment===void 0)return!0;for(var b=o,C=o.segment+1,I=0;I>-u/2;){if(--C<0)return!1;I-=t[C].dist(b),b=t[C]}I+=t[C].dist(t[C+1]),C++;for(var D=[],z=0;I<u/2;){var U=t[C],G=t[C+1];if(!G)return!1;var q=t[C-1].angleTo(U)-U.angleTo(G);for(q=Math.abs((q+3*Math.PI)%(2*Math.PI)-Math.PI),D.push({distance:I,angleDelta:q}),z+=q;I-D[0].distance>p;)z-=D.shift().angleDelta;if(z>y)return!1;C++,I+=U.dist(G)}return!0}function so(t){for(var o=0,u=0;u<t.length-1;u++)o+=t[u].dist(t[u+1]);return o}function Ni(t,o,u){return t?.6*o*u:0}function ts(t,o){return Math.max(t?t.right-t.left:0,o?o.right-o.left:0)}function ja(t,o,u,p,y,b){for(var C=Ni(u,y,b),I=ts(u,p)*b,D=0,z=so(t)/2,U=0;U<t.length-1;U++){var G=t[U],q=t[U+1],ie=G.dist(q);if(D+ie>z){var Pe=(z-D)/ie,Re=ma(G.x,q.x,Pe),k=ma(G.y,q.y,Pe),Ze=new Wr(Re,k,q.angleTo(G),U);return Ze._round(),!C||oo(t,Ze,I,C,o)?Ze:void 0}D+=ie}}function No(t,o,u,p,y,b,C,I,D){var z=Ni(p,b,C),U=ts(p,y),G=U*C,q=t[0].x===0||t[0].x===D||t[0].y===0||t[0].y===D;return o-G<o/4&&(o=G+o/4),function ie(Pe,Re,k,Ze,at,Ct,zt,Vt,sr){for(var Pr=Ct/2,Br=so(Pe),zn=0,hn=Re-k,Wn=[],dn=0;dn<Pe.length-1;dn++){for(var Ri=Pe[dn],ti=Pe[dn+1],Mn=Ri.dist(ti),Vi=ti.angleTo(Ri);hn+k<zn+Mn;){var Ci=((hn+=k)-zn)/Mn,ta=ma(Ri.x,ti.x,Ci),Yn=ma(Ri.y,ti.y,Ci);if(ta>=0&&ta<sr&&Yn>=0&&Yn<sr&&hn-Pr>=0&&hn+Pr<=Br){var fa=new Wr(ta,Yn,Vi,dn);fa._round(),Ze&&!oo(Pe,fa,Ct,Ze,at)||Wn.push(fa)}}zn+=Mn}return Vt||Wn.length||zt||(Wn=ie(Pe,zn/2,k,Ze,at,Ct,zt,!0,sr)),Wn}(t,q?o/2*I%o:(U/2+2*b)*C*I%o,o,z,u,G,q,!1,D)}function So(t,o,u,p,y){for(var b=[],C=0;C<t.length;C++)for(var I=t[C],D=void 0,z=0;z<I.length-1;z++){var U=I[z],G=I[z+1];U.x<o&&G.x<o||(U.x<o?U=new le(o,U.y+(o-U.x)/(G.x-U.x)*(G.y-U.y))._round():G.x<o&&(G=new le(o,U.y+(o-U.x)/(G.x-U.x)*(G.y-U.y))._round()),U.y<u&&G.y<u||(U.y<u?U=new le(U.x+(u-U.y)/(G.y-U.y)*(G.x-U.x),u)._round():G.y<u&&(G=new le(U.x+(u-U.y)/(G.y-U.y)*(G.x-U.x),u)._round()),U.x>=p&&G.x>=p||(U.x>=p?U=new le(p,U.y+(p-U.x)/(G.x-U.x)*(G.y-U.y))._round():G.x>=p&&(G=new le(p,U.y+(p-U.x)/(G.x-U.x)*(G.y-U.y))._round()),U.y>=y&&G.y>=y||(U.y>=y?U=new le(U.x+(y-U.y)/(G.y-U.y)*(G.x-U.x),y)._round():G.y>=y&&(G=new le(U.x+(y-U.y)/(G.y-U.y)*(G.x-U.x),y)._round()),D&&U.equals(D[D.length-1])||b.push(D=[U]),D.push(G)))))}return b}function Wo(t,o,u,p){var y=[],b=t.image,C=b.pixelRatio,I=b.paddedRect.w-2,D=b.paddedRect.h-2,z=t.right-t.left,U=t.bottom-t.top,G=b.stretchX||[[0,I]],q=b.stretchY||[[0,D]],ie=function(ta,Yn){return ta+Yn[1]-Yn[0]},Pe=G.reduce(ie,0),Re=q.reduce(ie,0),k=I-Pe,Ze=D-Re,at=0,Ct=Pe,zt=0,Vt=Re,sr=0,Pr=k,Br=0,zn=Ze;if(b.content&&p){var hn=b.content;at=Io(G,0,hn[0]),zt=Io(q,0,hn[1]),Ct=Io(G,hn[0],hn[2]),Vt=Io(q,hn[1],hn[3]),sr=hn[0]-at,Br=hn[1]-zt,Pr=hn[2]-hn[0]-Ct,zn=hn[3]-hn[1]-Vt}var Wn=function(ta,Yn,fa,Ja){var _o=ho(ta.stretch-at,Ct,z,t.left),Wa=yi(ta.fixed-sr,Pr,ta.stretch,Pe),eo=ho(Yn.stretch-zt,Vt,U,t.top),xo=yi(Yn.fixed-Br,zn,Yn.stretch,Re),Yo=ho(fa.stretch-at,Ct,z,t.left),rs=yi(fa.fixed-sr,Pr,fa.stretch,Pe),Gs=ho(Ja.stretch-zt,Vt,U,t.top),ns=yi(Ja.fixed-Br,zn,Ja.stretch,Re),Hs=new le(_o,eo),Ga=new le(Yo,eo),ds=new le(Yo,Gs),Ai=new le(_o,Gs),Fa=new le(Wa/C,xo/C),wa=new le(rs/C,ns/C),la=o*Math.PI/180;if(la){var vs=Math.sin(la),Ts=Math.cos(la),Xa=[Ts,-vs,vs,Ts];Hs._matMult(Xa),Ga._matMult(Xa),Ai._matMult(Xa),ds._matMult(Xa)}var Ro=ta.stretch+ta.fixed,ms=Yn.stretch+Yn.fixed;return{tl:Hs,tr:Ga,bl:Ai,br:ds,tex:{x:b.paddedRect.x+1+Ro,y:b.paddedRect.y+1+ms,w:fa.stretch+fa.fixed-Ro,h:Ja.stretch+Ja.fixed-ms},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Fa,pixelOffsetBR:wa,minFontScaleX:Pr/C/z,minFontScaleY:zn/C/U,isSDF:u}};if(p&&(b.stretchX||b.stretchY))for(var dn=fs(G,k,Pe),Ri=fs(q,Ze,Re),ti=0;ti<dn.length-1;ti++)for(var Mn=dn[ti],Vi=dn[ti+1],Ci=0;Ci<Ri.length-1;Ci++)y.push(Wn(Mn,Ri[Ci],Vi,Ri[Ci+1]));else y.push(Wn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:I+1},{fixed:0,stretch:D+1}));return y}function Io(t,o,u){for(var p=0,y=0,b=t;y<b.length;y+=1){var C=b[y];p+=Math.max(o,Math.min(u,C[1]))-Math.max(o,Math.min(u,C[0]))}return p}function fs(t,o,u){for(var p=[{fixed:-1,stretch:0}],y=0,b=t;y<b.length;y+=1){var C=b[y],I=C[0],D=C[1],z=p[p.length-1];p.push({fixed:I-z.stretch,stretch:z.stretch}),p.push({fixed:I-z.stretch,stretch:z.stretch+(D-I)})}return p.push({fixed:o+1,stretch:u}),p}function ho(t,o,u,p){return t/o*u+p}function yi(t,o,u,p){return t-o*u/p}var Oo=function(t,o,u,p,y,b,C,I,D,z){if(this.boxStartIndex=t.length,D){var U=b.top,G=b.bottom,q=b.collisionPadding;q&&(U-=q[1],G+=q[3]);var ie=G-U;ie>0&&(ie=Math.max(10,ie),this.circleDiameter=ie)}else{var Pe=b.top*C-I,Re=b.bottom*C+I,k=b.left*C-I,Ze=b.right*C+I,at=b.collisionPadding;if(at&&(k-=at[0]*C,Pe-=at[1]*C,Ze+=at[2]*C,Re+=at[3]*C),z){var Ct=new le(k,Pe),zt=new le(Ze,Pe),Vt=new le(k,Re),sr=new le(Ze,Re),Pr=z*Math.PI/180;Ct._rotate(Pr),zt._rotate(Pr),Vt._rotate(Pr),sr._rotate(Pr),k=Math.min(Ct.x,zt.x,Vt.x,sr.x),Ze=Math.max(Ct.x,zt.x,Vt.x,sr.x),Pe=Math.min(Ct.y,zt.y,Vt.y,sr.y),Re=Math.max(Ct.y,zt.y,Vt.y,sr.y)}t.emplaceBack(o.x,o.y,k,Pe,Ze,Re,u,p,y)}this.boxEndIndex=t.length},ea=function(t,o){if(t===void 0&&(t=[]),o===void 0&&(o=zo),this.data=t,this.length=this.data.length,this.compare=o,this.length>0)for(var u=(this.length>>1)-1;u>=0;u--)this._down(u)};function zo(t,o){return t<o?-1:t>o?1:0}function ri(t,o,u){o===void 0&&(o=1),u===void 0&&(u=!1);for(var p=1/0,y=1/0,b=-1/0,C=-1/0,I=t[0],D=0;D<I.length;D++){var z=I[D];(!D||z.x<p)&&(p=z.x),(!D||z.y<y)&&(y=z.y),(!D||z.x>b)&&(b=z.x),(!D||z.y>C)&&(C=z.y)}var U=Math.min(b-p,C-y),G=U/2,q=new ea([],Ui);if(U===0)return new le(p,y);for(var ie=p;ie<b;ie+=U)for(var Pe=y;Pe<C;Pe+=U)q.push(new va(ie+G,Pe+G,G,t));for(var Re=function(at){for(var Ct=0,zt=0,Vt=0,sr=at[0],Pr=0,Br=sr.length,zn=Br-1;Pr<Br;zn=Pr++){var hn=sr[Pr],Wn=sr[zn],dn=hn.x*Wn.y-Wn.x*hn.y;zt+=(hn.x+Wn.x)*dn,Vt+=(hn.y+Wn.y)*dn,Ct+=3*dn}return new va(zt/Ct,Vt/Ct,0,at)}(t),k=q.length;q.length;){var Ze=q.pop();(Ze.d>Re.d||!Re.d)&&(Re=Ze,u&&console.log("found best %d after %d probes",Math.round(1e4*Ze.d)/1e4,k)),Ze.max-Re.d<=o||(q.push(new va(Ze.p.x-(G=Ze.h/2),Ze.p.y-G,G,t)),q.push(new va(Ze.p.x+G,Ze.p.y-G,G,t)),q.push(new va(Ze.p.x-G,Ze.p.y+G,G,t)),q.push(new va(Ze.p.x+G,Ze.p.y+G,G,t)),k+=4)}return u&&(console.log("num probes: "+k),console.log("best distance: "+Re.d)),Re.p}function Ui(t,o){return o.max-t.max}function va(t,o,u,p){this.p=new le(t,o),this.h=u,this.d=function(y,b){for(var C=!1,I=1/0,D=0;D<b.length;D++)for(var z=b[D],U=0,G=z.length,q=G-1;U<G;q=U++){var ie=z[U],Pe=z[q];ie.y>y.y!=Pe.y>y.y&&y.x<(Pe.x-ie.x)*(y.y-ie.y)/(Pe.y-ie.y)+ie.x&&(C=!C),I=Math.min(I,_l(y,ie,Pe))}return(C?1:-1)*Math.sqrt(I)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}ea.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},ea.prototype.pop=function(){if(this.length!==0){var t=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),t}},ea.prototype.peek=function(){return this.data[0]},ea.prototype._up=function(t){for(var o=this.data,u=this.compare,p=o[t];t>0;){var y=t-1>>1,b=o[y];if(u(p,b)>=0)break;o[t]=b,t=y}o[t]=p},ea.prototype._down=function(t){for(var o=this.data,u=this.compare,p=this.length>>1,y=o[t];t<p;){var b=1+(t<<1),C=o[b],I=b+1;if(I<this.length&&u(o[I],C)<0&&(b=I,C=o[I]),u(C,y)>=0)break;o[t]=C,t=b}o[t]=y};var Nn=Number.POSITIVE_INFINITY;function ni(t,o){return o[1]!==Nn?function(u,p,y){var b=0,C=0;switch(p=Math.abs(p),y=Math.abs(y),u){case"top-right":case"top-left":case"top":C=y-7;break;case"bottom-right":case"bottom-left":case"bottom":C=7-y}switch(u){case"top-right":case"bottom-right":case"right":b=-p;break;case"top-left":case"bottom-left":case"left":b=p}return[b,C]}(t,o[0],o[1]):function(u,p){var y=0,b=0;p<0&&(p=0);var C=p/Math.sqrt(2);switch(u){case"top-right":case"top-left":b=C-7;break;case"bottom-right":case"bottom-left":b=7-C;break;case"bottom":b=7-p;break;case"top":b=p-7}switch(u){case"top-right":case"bottom-right":y=-C;break;case"top-left":case"bottom-left":y=C;break;case"left":y=p;break;case"right":y=-p}return[y,b]}(t,o[0])}function Me(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Nt(t,o,u,p,y,b,C,I,D,z,U,G,q,ie,Pe){var Re=function(zt,Vt,sr,Pr,Br,zn,hn,Wn){for(var dn=Pr.layout.get("text-rotate").evaluate(zn,{})*Math.PI/180,Ri=[],ti=0,Mn=Vt.positionedLines;ti<Mn.length;ti+=1)for(var Vi=Mn[ti],Ci=0,ta=Vi.positionedGlyphs;Ci<ta.length;Ci+=1){var Yn=ta[Ci];if(Yn.rect){var fa=Yn.rect||{},Ja=4,_o=!0,Wa=1,eo=0,xo=(Br||Wn)&&Yn.vertical,Yo=Yn.metrics.advance*Yn.scale/2;if(Wn&&Vt.verticalizable&&(eo=Vi.lineOffset/2-(Yn.imageName?-(24-Yn.metrics.width*Yn.scale)/2:24*(Yn.scale-1))),Yn.imageName){var rs=hn[Yn.imageName];_o=rs.sdf,Ja=1/(Wa=rs.pixelRatio)}var Gs=Br?[Yn.x+Yo,Yn.y]:[0,0],ns=Br?[0,0]:[Yn.x+Yo+sr[0],Yn.y+sr[1]-eo],Hs=[0,0];xo&&(Hs=ns,ns=[0,0]);var Ga=(Yn.metrics.left-Ja)*Yn.scale-Yo+ns[0],ds=(-Yn.metrics.top-Ja)*Yn.scale+ns[1],Ai=Ga+fa.w*Yn.scale/Wa,Fa=ds+fa.h*Yn.scale/Wa,wa=new le(Ga,ds),la=new le(Ai,ds),vs=new le(Ga,Fa),Ts=new le(Ai,Fa);if(xo){var Xa=new le(-Yo,Yo- -17),Ro=-Math.PI/2,ms=12-Yo,ha=new le(22-ms,-(Yn.imageName?ms:0)),ec=new(Function.prototype.bind.apply(le,[null].concat(Hs)));wa._rotateAround(Ro,Xa)._add(ha)._add(ec),la._rotateAround(Ro,Xa)._add(ha)._add(ec),vs._rotateAround(Ro,Xa)._add(ha)._add(ec),Ts._rotateAround(Ro,Xa)._add(ha)._add(ec)}if(dn){var uu=Math.sin(dn),lf=Math.cos(dn),ko=[lf,-uu,uu,lf];wa._matMult(ko),la._matMult(ko),vs._matMult(ko),Ts._matMult(ko)}var Ac=new le(0,0),nl=new le(0,0);Ri.push({tl:wa,tr:la,bl:vs,br:Ts,tex:fa,writingMode:Vt.writingMode,glyphOffset:Gs,sectionIndex:Yn.sectionIndex,isSDF:_o,pixelOffsetTL:Ac,pixelOffsetBR:nl,minFontScaleX:0,minFontScaleY:0})}}return Ri}(0,u,I,y,b,C,p,t.allowVerticalPlacement),k=t.textSizeData,Ze=null;k.kind==="source"?(Ze=[128*y.layout.get("text-size").evaluate(C,{})])[0]>32640&&et(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):k.kind==="composite"&&((Ze=[128*ie.compositeTextSizes[0].evaluate(C,{},Pe),128*ie.compositeTextSizes[1].evaluate(C,{},Pe)])[0]>32640||Ze[1]>32640)&&et(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),t.addSymbols(t.text,Re,Ze,I,b,C,z,o,D.lineStartIndex,D.lineLength,q,Pe);for(var at=0,Ct=U;at<Ct.length;at+=1)G[Ct[at]]=t.text.placedSymbolArray.length-1;return 4*Re.length}function At(t){for(var o in t)return t[o];return null}function yn(t,o,u,p){var y=t.compareText;if(o in y){for(var b=y[o],C=b.length-1;C>=0;C--)if(p.dist(b[C])<u)return!0}else y[o]=[];return y[o].push(p),!1}var Wi=Cu.VectorTileFeature.types,we=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function oe(t,o,u,p,y,b,C,I,D,z,U,G,q){var ie=I?Math.min(32640,Math.round(I[0])):0,Pe=I?Math.min(32640,Math.round(I[1])):0;t.emplaceBack(o,u,Math.round(32*p),Math.round(32*y),b,C,(ie<<1)+(D?1:0),Pe,16*z,16*U,256*G,256*q)}function Ve(t,o,u){t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u)}function ct(t){for(var o=0,u=t.sections;o<u.length;o+=1)if(Tf(u[o].text))return!0;return!1}var Ot=function(t){this.layoutVertexArray=new jl,this.indexArray=new ml,this.programConfigurations=t,this.segments=new fe,this.dynamicLayoutVertexArray=new Fu,this.opacityVertexArray=new el,this.placedSymbolArray=new d};Ot.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Ot.prototype.upload=function(t,o,u,p){this.isEmpty()||(u&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ld.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Vh.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,we,!0),this.opacityVertexBuffer.itemSize=1),(u||p)&&this.programConfigurations.upload(t))},Ot.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},gn("SymbolBuffers",Ot);var qe=function(t,o,u){this.layoutVertexArray=new t,this.layoutAttributes=o,this.indexArray=new u,this.segments=new fe,this.collisionVertexArray=new Vl};qe.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Dd.members,!0)},qe.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},gn("CollisionBuffers",qe);var De=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(b){return b.id}),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Zs([]),this.placementViewportMatrix=Zs([]);var o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=nn(this.zoom,o["text-size"]),this.iconSizeData=nn(this.zoom,o["icon-size"]);var u=this.layers[0].layout,p=u.get("symbol-sort-key"),y=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,u.get("symbol-placement")==="point"&&(this.writingModes=u.get("text-writing-mode").map(function(b){return Zr[b]})),this.stateDependentLayerIds=this.layers.filter(function(b){return b.isStateDependent()}).map(function(b){return b.id}),this.sourceID=t.sourceID};De.prototype.createArrays=function(){this.text=new Ot(new qn(this.layers,this.zoom,function(t){return/^text/.test(t)})),this.icon=new Ot(new qn(this.layers,this.zoom,function(t){return/^icon/.test(t)})),this.glyphOffsetArray=new P,this.lineVertexArray=new L,this.symbolInstances=new w},De.prototype.calculateGlyphDependencies=function(t,o,u,p,y){for(var b=0;b<t.length;b++)if(o[t.charCodeAt(b)]=!0,(u||p)&&y){var C=Kl[t.charAt(b)];C&&(o[C.charCodeAt(0)]=!0)}},De.prototype.populate=function(t,o,u){var p=this.layers[0],y=p.layout,b=y.get("text-font"),C=y.get("text-field"),I=y.get("icon-image"),D=(C.value.kind!=="constant"||C.value.value instanceof _t&&!C.value.value.isEmpty()||C.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),z=I.value.kind!=="constant"||!!I.value.value||Object.keys(I.parameters).length>0,U=y.get("symbol-sort-key");if(this.features=[],D||z){for(var G=o.iconDependencies,q=o.glyphDependencies,ie=o.availableImages,Pe=new Mi(this.zoom),Re=0,k=t;Re<k.length;Re+=1){var Ze=k[Re],at=Ze.feature,Ct=Ze.id,zt=Ze.index,Vt=Ze.sourceLayerIndex,sr=p._featureFilter.needGeometry,Pr=fo(at,sr);if(p._featureFilter.filter(Pe,Pr,u)){sr||(Pr.geometry=Ha(at));var Br=void 0;if(D){var zn=p.getValueAndResolveTokens("text-field",Pr,u,ie),hn=_t.factory(zn);ct(hn)&&(this.hasRTLText=!0),(!this.hasRTLText||Mf()==="unavailable"||this.hasRTLText&&Os.isParsed())&&(Br=ch(hn,p,Pr))}var Wn=void 0;if(z){var dn=p.getValueAndResolveTokens("icon-image",Pr,u,ie);Wn=dn instanceof aa?dn:aa.fromString(dn)}if(Br||Wn){var Ri=this.sortFeaturesByKey?U.evaluate(Pr,{},u):void 0;if(this.features.push({id:Ct,text:Br,icon:Wn,index:zt,sourceLayerIndex:Vt,geometry:Pr.geometry,properties:at.properties,type:Wi[at.type],sortKey:Ri}),Wn&&(G[Wn.name]=!0),Br){var ti=b.evaluate(Pr,{},u).join(","),Mn=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Zr.vertical)>=0;for(var Vi=0,Ci=Br.sections;Vi<Ci.length;Vi+=1){var ta=Ci[Vi];if(ta.image)G[ta.image.name]=!0;else{var Yn=pc(Br.toString()),fa=ta.fontStack||ti,Ja=q[fa]=q[fa]||{};this.calculateGlyphDependencies(ta.text,Ja,Mn,this.allowVerticalPlacement,Yn)}}}}}}y.get("symbol-placement")==="line"&&(this.features=function(_o){var Wa={},eo={},xo=[],Yo=0;function rs(Xa){xo.push(_o[Xa]),Yo++}function Gs(Xa,Ro,ms){var ha=eo[Xa];return delete eo[Xa],eo[Ro]=ha,xo[ha].geometry[0].pop(),xo[ha].geometry[0]=xo[ha].geometry[0].concat(ms[0]),ha}function ns(Xa,Ro,ms){var ha=Wa[Ro];return delete Wa[Ro],Wa[Xa]=ha,xo[ha].geometry[0].shift(),xo[ha].geometry[0]=ms[0].concat(xo[ha].geometry[0]),ha}function Hs(Xa,Ro,ms){var ha=ms?Ro[0][Ro[0].length-1]:Ro[0][0];return Xa+":"+ha.x+":"+ha.y}for(var Ga=0;Ga<_o.length;Ga++){var ds=_o[Ga],Ai=ds.geometry,Fa=ds.text?ds.text.toString():null;if(Fa){var wa=Hs(Fa,Ai),la=Hs(Fa,Ai,!0);if(wa in eo&&la in Wa&&eo[wa]!==Wa[la]){var vs=ns(wa,la,Ai),Ts=Gs(wa,la,xo[vs].geometry);delete Wa[wa],delete eo[la],eo[Hs(Fa,xo[Ts].geometry,!0)]=Ts,xo[vs].geometry=null}else wa in eo?Gs(wa,la,Ai):la in Wa?ns(wa,la,Ai):(rs(Ga),Wa[wa]=Yo-1,eo[la]=Yo-1)}else rs(Ga)}return xo.filter(function(Xa){return Xa.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(_o,Wa){return _o.sortKey-Wa.sortKey})}},De.prototype.update=function(t,o,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,o,this.layers,u),this.icon.programConfigurations.updatePaintArrays(t,o,this.layers,u))},De.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},De.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},De.prototype.upload=function(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},De.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},De.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},De.prototype.addToLineVertexArray=function(t,o){var u=this.lineVertexArray.length;if(t.segment!==void 0){for(var p=t.dist(o[t.segment+1]),y=t.dist(o[t.segment]),b={},C=t.segment+1;C<o.length;C++)b[C]={x:o[C].x,y:o[C].y,tileUnitDistanceFromAnchor:p},C<o.length-1&&(p+=o[C+1].dist(o[C]));for(var I=t.segment||0;I>=0;I--)b[I]={x:o[I].x,y:o[I].y,tileUnitDistanceFromAnchor:y},I>0&&(y+=o[I-1].dist(o[I]));for(var D=0;D<o.length;D++){var z=b[D];this.lineVertexArray.emplaceBack(z.x,z.y,z.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}},De.prototype.addSymbols=function(t,o,u,p,y,b,C,I,D,z,U,G){for(var q=t.indexArray,ie=t.layoutVertexArray,Pe=t.segments.prepareSegment(4*o.length,ie,q,this.canOverlap?b.sortKey:void 0),Re=this.glyphOffsetArray.length,k=Pe.vertexLength,Ze=this.allowVerticalPlacement&&C===Zr.vertical?Math.PI/2:0,at=b.text&&b.text.sections,Ct=0;Ct<o.length;Ct++){var zt=o[Ct],Vt=zt.tl,sr=zt.tr,Pr=zt.bl,Br=zt.br,zn=zt.tex,hn=zt.pixelOffsetTL,Wn=zt.pixelOffsetBR,dn=zt.minFontScaleX,Ri=zt.minFontScaleY,ti=zt.glyphOffset,Mn=zt.isSDF,Vi=zt.sectionIndex,Ci=Pe.vertexLength,ta=ti[1];oe(ie,I.x,I.y,Vt.x,ta+Vt.y,zn.x,zn.y,u,Mn,hn.x,hn.y,dn,Ri),oe(ie,I.x,I.y,sr.x,ta+sr.y,zn.x+zn.w,zn.y,u,Mn,Wn.x,hn.y,dn,Ri),oe(ie,I.x,I.y,Pr.x,ta+Pr.y,zn.x,zn.y+zn.h,u,Mn,hn.x,Wn.y,dn,Ri),oe(ie,I.x,I.y,Br.x,ta+Br.y,zn.x+zn.w,zn.y+zn.h,u,Mn,Wn.x,Wn.y,dn,Ri),Ve(t.dynamicLayoutVertexArray,I,Ze),q.emplaceBack(Ci,Ci+1,Ci+2),q.emplaceBack(Ci+1,Ci+2,Ci+3),Pe.vertexLength+=4,Pe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ti[0]),Ct!==o.length-1&&Vi===o[Ct+1].sectionIndex||t.programConfigurations.populatePaintArrays(ie.length,b,b.index,{},G,at&&at[Vi])}t.placedSymbolArray.emplaceBack(I.x,I.y,Re,this.glyphOffsetArray.length-Re,k,D,z,I.segment,u?u[0]:0,u?u[1]:0,p[0],p[1],C,0,!1,0,U)},De.prototype._addCollisionDebugVertex=function(t,o,u,p,y,b){return o.emplaceBack(0,0),t.emplaceBack(u.x,u.y,p,y,Math.round(b.x),Math.round(b.y))},De.prototype.addCollisionDebugVertices=function(t,o,u,p,y,b,C){var I=y.segments.prepareSegment(4,y.layoutVertexArray,y.indexArray),D=I.vertexLength,z=y.layoutVertexArray,U=y.collisionVertexArray,G=C.anchorX,q=C.anchorY;this._addCollisionDebugVertex(z,U,b,G,q,new le(t,o)),this._addCollisionDebugVertex(z,U,b,G,q,new le(u,o)),this._addCollisionDebugVertex(z,U,b,G,q,new le(u,p)),this._addCollisionDebugVertex(z,U,b,G,q,new le(t,p)),I.vertexLength+=4;var ie=y.indexArray;ie.emplaceBack(D,D+1),ie.emplaceBack(D+1,D+2),ie.emplaceBack(D+2,D+3),ie.emplaceBack(D+3,D),I.primitiveLength+=4},De.prototype.addDebugCollisionBoxes=function(t,o,u,p){for(var y=t;y<o;y++){var b=this.collisionBoxArray.get(y);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,p?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,u)}},De.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new qe(Da,yp.members,Gl),this.iconCollisionBox=new qe(Da,yp.members,Gl);for(var t=0;t<this.symbolInstances.length;t++){var o=this.symbolInstances.get(t);this.addDebugCollisionBoxes(o.textBoxStartIndex,o.textBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.iconBoxStartIndex,o.iconBoxEndIndex,o,!1),this.addDebugCollisionBoxes(o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o,!1)}},De.prototype._deserializeCollisionBoxesForSymbol=function(t,o,u,p,y,b,C,I,D){for(var z={},U=o;U<u;U++){var G=t.get(U);z.textBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,anchorPointX:G.anchorPointX,anchorPointY:G.anchorPointY},z.textFeatureIndex=G.featureIndex;break}for(var q=p;q<y;q++){var ie=t.get(q);z.verticalTextBox={x1:ie.x1,y1:ie.y1,x2:ie.x2,y2:ie.y2,anchorPointX:ie.anchorPointX,anchorPointY:ie.anchorPointY},z.verticalTextFeatureIndex=ie.featureIndex;break}for(var Pe=b;Pe<C;Pe++){var Re=t.get(Pe);z.iconBox={x1:Re.x1,y1:Re.y1,x2:Re.x2,y2:Re.y2,anchorPointX:Re.anchorPointX,anchorPointY:Re.anchorPointY},z.iconFeatureIndex=Re.featureIndex;break}for(var k=I;k<D;k++){var Ze=t.get(k);z.verticalIconBox={x1:Ze.x1,y1:Ze.y1,x2:Ze.x2,y2:Ze.y2,anchorPointX:Ze.anchorPointX,anchorPointY:Ze.anchorPointY},z.verticalIconFeatureIndex=Ze.featureIndex;break}return z},De.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var o=0;o<this.symbolInstances.length;o++){var u=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}},De.prototype.hasTextData=function(){return this.text.segments.get().length>0},De.prototype.hasIconData=function(){return this.icon.segments.get().length>0},De.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},De.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},De.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},De.prototype.addIndicesForPlacedSymbol=function(t,o){for(var u=t.placedSymbolArray.get(o),p=u.vertexStartIndex+4*u.numGlyphs,y=u.vertexStartIndex;y<p;y+=4)t.indexArray.emplaceBack(y,y+1,y+2),t.indexArray.emplaceBack(y+1,y+2,y+3)},De.prototype.getSortedSymbolIndexes=function(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var o=Math.sin(t),u=Math.cos(t),p=[],y=[],b=[],C=0;C<this.symbolInstances.length;++C){b.push(C);var I=this.symbolInstances.get(C);p.push(0|Math.round(o*I.anchorX+u*I.anchorY)),y.push(I.featureIndex)}return b.sort(function(D,z){return p[D]-p[z]||y[z]-y[D]}),b},De.prototype.addToSortKeyRanges=function(t,o){var u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===o?u.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:t,symbolInstanceEnd:t+1})},De.prototype.sortFeatures=function(t){var o=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var u=0,p=this.symbolInstanceIndexes;u<p.length;u+=1){var y=this.symbolInstances.get(p[u]);this.featureSortOrder.push(y.featureIndex),[y.rightJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.leftJustifiedTextSymbolIndex].forEach(function(b,C,I){b>=0&&I.indexOf(b)===C&&o.addIndicesForPlacedSymbol(o.text,b)}),y.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,y.verticalPlacedTextSymbolIndex),y.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,y.placedIconSymbolIndex),y.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,y.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},gn("SymbolBucket",De,{omit:["layers","collisionBoxArray","features","compareText"]}),De.MAX_GLYPHS=65535,De.addDynamicAttributes=Ve;var rt=new Ho({"symbol-placement":new Ln(ce.layout_symbol["symbol-placement"]),"symbol-spacing":new Ln(ce.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ln(ce.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new wn(ce.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ln(ce.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ln(ce.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ln(ce.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ln(ce.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ln(ce.layout_symbol["icon-rotation-alignment"]),"icon-size":new wn(ce.layout_symbol["icon-size"]),"icon-text-fit":new Ln(ce.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ln(ce.layout_symbol["icon-text-fit-padding"]),"icon-image":new wn(ce.layout_symbol["icon-image"]),"icon-rotate":new wn(ce.layout_symbol["icon-rotate"]),"icon-padding":new Ln(ce.layout_symbol["icon-padding"]),"icon-keep-upright":new Ln(ce.layout_symbol["icon-keep-upright"]),"icon-offset":new wn(ce.layout_symbol["icon-offset"]),"icon-anchor":new wn(ce.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ln(ce.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ln(ce.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ln(ce.layout_symbol["text-rotation-alignment"]),"text-field":new wn(ce.layout_symbol["text-field"]),"text-font":new wn(ce.layout_symbol["text-font"]),"text-size":new wn(ce.layout_symbol["text-size"]),"text-max-width":new wn(ce.layout_symbol["text-max-width"]),"text-line-height":new Ln(ce.layout_symbol["text-line-height"]),"text-letter-spacing":new wn(ce.layout_symbol["text-letter-spacing"]),"text-justify":new wn(ce.layout_symbol["text-justify"]),"text-radial-offset":new wn(ce.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ln(ce.layout_symbol["text-variable-anchor"]),"text-anchor":new wn(ce.layout_symbol["text-anchor"]),"text-max-angle":new Ln(ce.layout_symbol["text-max-angle"]),"text-writing-mode":new Ln(ce.layout_symbol["text-writing-mode"]),"text-rotate":new wn(ce.layout_symbol["text-rotate"]),"text-padding":new Ln(ce.layout_symbol["text-padding"]),"text-keep-upright":new Ln(ce.layout_symbol["text-keep-upright"]),"text-transform":new wn(ce.layout_symbol["text-transform"]),"text-offset":new wn(ce.layout_symbol["text-offset"]),"text-allow-overlap":new Ln(ce.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ln(ce.layout_symbol["text-ignore-placement"]),"text-optional":new Ln(ce.layout_symbol["text-optional"])}),xe={paint:new Ho({"icon-opacity":new wn(ce.paint_symbol["icon-opacity"]),"icon-color":new wn(ce.paint_symbol["icon-color"]),"icon-halo-color":new wn(ce.paint_symbol["icon-halo-color"]),"icon-halo-width":new wn(ce.paint_symbol["icon-halo-width"]),"icon-halo-blur":new wn(ce.paint_symbol["icon-halo-blur"]),"icon-translate":new Ln(ce.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ln(ce.paint_symbol["icon-translate-anchor"]),"text-opacity":new wn(ce.paint_symbol["text-opacity"]),"text-color":new wn(ce.paint_symbol["text-color"],{runtimeType:Xr,getOverride:function(t){return t.textColor},hasOverride:function(t){return!!t.textColor}}),"text-halo-color":new wn(ce.paint_symbol["text-halo-color"]),"text-halo-width":new wn(ce.paint_symbol["text-halo-width"]),"text-halo-blur":new wn(ce.paint_symbol["text-halo-blur"]),"text-translate":new Ln(ce.paint_symbol["text-translate"]),"text-translate-anchor":new Ln(ce.paint_symbol["text-translate-anchor"])}),layout:rt},Ue=function(t){this.type=t.property.overrides?t.property.overrides.runtimeType:pn,this.defaultValue=t};Ue.prototype.evaluate=function(t){if(t.formattedSection){var o=this.defaultValue.property.overrides;if(o&&o.hasOverride(t.formattedSection))return o.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default},Ue.prototype.eachChild=function(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)},Ue.prototype.outputDefined=function(){return!1},Ue.prototype.serialize=function(){return null},gn("FormatSectionOverride",Ue,{omit:["defaultValue"]});var Te=function(t){function o(u){t.call(this,u,xe)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.recalculate=function(u,p){if(t.prototype.recalculate.call(this,u,p),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var y=this.layout.get("text-writing-mode");if(y){for(var b=[],C=0,I=y;C<I.length;C+=1){var D=I[C];b.indexOf(D)<0&&b.push(D)}this.layout._values["text-writing-mode"]=b}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},o.prototype.getValueAndResolveTokens=function(u,p,y,b){var C=this.layout.get(u).evaluate(p,{},y,b),I=this._unevaluatedLayout._values[u];return I.isDataDriven()||oc(I.value)||!C?C:function(D,z){return z.replace(/{([^{}]+)}/g,function(U,G){return G in D?String(D[G]):""})}(p.properties,C)},o.prototype.createBucket=function(u){return new De(u)},o.prototype.queryRadius=function(){return 0},o.prototype.queryIntersectsFeature=function(){return!1},o.prototype._setPaintOverrides=function(){for(var u=0,p=xe.paint.overridableProperties;u<p.length;u+=1){var y=p[u];if(o.hasPaintOverride(this.layout,y)){var b,C=this.paint.get(y),I=new Ue(C),D=new Zc(I,C.property.specification);b=C.value.kind==="constant"||C.value.kind==="source"?new Ll("source",D):new fl("composite",D,C.value.zoomStops,C.value._interpolationType),this.paint._values[y]=new ws(C.property,b,C.parameters)}}},o.prototype._handleOverridablePaintPropertyUpdate=function(u,p,y){return!(!this.layout||p.isDataDriven()||y.isDataDriven())&&o.hasPaintOverride(this.layout,u)},o.hasPaintOverride=function(u,p){var y=u.get("text-field"),b=xe.paint.properties[p],C=!1,I=function(U){for(var G=0,q=U;G<q.length;G+=1)if(b.overrides&&b.overrides.hasOverride(q[G]))return void(C=!0)};if(y.value.kind==="constant"&&y.value.value instanceof _t)I(y.value.value.sections);else if(y.value.kind==="source"){var D=function(U){C||(U instanceof za&&na(U.value)===Xi?I(U.value.sections):U instanceof Ao?I(U.sections):U.eachChild(D))},z=y.value;z._styleExpression&&D(z._styleExpression.expression)}return C},o}(gu),ft={paint:new Ho({"background-color":new Ln(ce.paint_background["background-color"]),"background-pattern":new Qo(ce.paint_background["background-pattern"]),"background-opacity":new Ln(ce.paint_background["background-opacity"])})},Tt=function(t){function o(u){t.call(this,u,ft)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(gu),hr={paint:new Ho({"raster-opacity":new Ln(ce.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ln(ce.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ln(ce.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ln(ce.paint_raster["raster-brightness-max"]),"raster-saturation":new Ln(ce.paint_raster["raster-saturation"]),"raster-contrast":new Ln(ce.paint_raster["raster-contrast"]),"raster-resampling":new Ln(ce.paint_raster["raster-resampling"]),"raster-fade-duration":new Ln(ce.paint_raster["raster-fade-duration"])})},Ur=function(t){function o(u){t.call(this,u,hr)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(gu),jr=function(t){function o(u){t.call(this,u,{}),this.implementation=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},o.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},o.prototype.recalculate=function(){},o.prototype.updateTransitions=function(){},o.prototype.hasTransition=function(){},o.prototype.serialize=function(){},o.prototype.onAdd=function(u){this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},o.prototype.onRemove=function(u){this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},o}(gu),on={circle:Pf,heatmap:kh,hillshade:pp,fill:uh,"fill-extrusion":rl,line:nd,symbol:Te,background:Tt,raster:Ur},Fr=ye.HTMLImageElement,Tn=ye.HTMLCanvasElement,cn=ye.HTMLVideoElement,Cn=ye.ImageData,Sn=ye.ImageBitmap,fn=function(t,o,u,p){this.context=t,this.format=u,this.texture=t.gl.createTexture(),this.update(o,p)};fn.prototype.update=function(t,o,u){var p=t.width,y=t.height,b=!(this.size&&this.size[0]===p&&this.size[1]===y||u),C=this.context,I=C.gl;if(this.useMipmap=Boolean(o&&o.useMipmap),I.bindTexture(I.TEXTURE_2D,this.texture),C.pixelStoreUnpackFlipY.set(!1),C.pixelStoreUnpack.set(1),C.pixelStoreUnpackPremultiplyAlpha.set(this.format===I.RGBA&&(!o||o.premultiply!==!1)),b)this.size=[p,y],t instanceof Fr||t instanceof Tn||t instanceof cn||t instanceof Cn||Sn&&t instanceof Sn?I.texImage2D(I.TEXTURE_2D,0,this.format,this.format,I.UNSIGNED_BYTE,t):I.texImage2D(I.TEXTURE_2D,0,this.format,p,y,0,this.format,I.UNSIGNED_BYTE,t.data);else{var D=u||{x:0,y:0},z=D.x,U=D.y;t instanceof Fr||t instanceof Tn||t instanceof cn||t instanceof Cn||Sn&&t instanceof Sn?I.texSubImage2D(I.TEXTURE_2D,0,z,U,I.RGBA,I.UNSIGNED_BYTE,t):I.texSubImage2D(I.TEXTURE_2D,0,z,U,p,y,I.RGBA,I.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&I.generateMipmap(I.TEXTURE_2D)},fn.prototype.bind=function(t,o,u){var p=this.context.gl;p.bindTexture(p.TEXTURE_2D,this.texture),u!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=p.LINEAR),t!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,t),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,u||t),this.filter=t),o!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,o),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,o),this.wrap=o)},fn.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},fn.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var ei=function(t){var o=this;this._callback=t,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){o._triggered=!1,o._callback()})};ei.prototype.trigger=function(){var t=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){t._triggered=!1,t._callback()},0))},ei.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Ea=function(t,o,u){this.target=t,this.parent=o,this.mapId=u,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},rr(["receive","process"],this),this.invoker=new ei(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=kr()?t:ye};function hs(t,o,u){var p=2*Math.PI*6378137/256/Math.pow(2,u);return[t*p-2*Math.PI*6378137/2,o*p-2*Math.PI*6378137/2]}Ea.prototype.send=function(t,o,u,p,y){var b=this;y===void 0&&(y=!1);var C=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(this.callbacks[C]=u);var I=pe(this.globalScope)?void 0:[];return this.target.postMessage({id:C,type:t,hasCallback:!!u,targetMapId:p,mustQueue:y,sourceMapId:this.mapId,data:Qs(o,I)},I),{cancel:function(){u&&delete b.callbacks[C],b.target.postMessage({id:C,type:"<cancel>",targetMapId:p,sourceMapId:b.mapId})}}},Ea.prototype.receive=function(t){var o=t.data,u=o.id;if(u&&(!o.targetMapId||this.mapId===o.targetMapId))if(o.type==="<cancel>"){delete this.tasks[u];var p=this.cancelCallbacks[u];delete this.cancelCallbacks[u],p&&p()}else kr()||o.mustQueue?(this.tasks[u]=o,this.taskQueue.push(u),this.invoker.trigger()):this.processTask(u,o)},Ea.prototype.process=function(){if(this.taskQueue.length){var t=this.taskQueue.shift(),o=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),o&&this.processTask(t,o)}},Ea.prototype.processTask=function(t,o){var u=this;if(o.type==="<response>"){var p=this.callbacks[t];delete this.callbacks[t],p&&(o.error?p(Is(o.error)):p(null,Is(o.data)))}else{var y=!1,b=pe(this.globalScope)?void 0:[],C=o.hasCallback?function(U,G){y=!0,delete u.cancelCallbacks[t],u.target.postMessage({id:t,type:"<response>",sourceMapId:u.mapId,error:U?Qs(U):null,data:Qs(G,b)},b)}:function(U){y=!0},I=null,D=Is(o.data);if(this.parent[o.type])I=this.parent[o.type](o.sourceMapId,D,C);else if(this.parent.getWorkerSource){var z=o.type.split(".");I=this.parent.getWorkerSource(o.sourceMapId,z[0],D.source)[z[1]](D,C)}else C(new Error("Could not find function "+o.type));!y&&I&&I.cancel&&(this.cancelCallbacks[t]=I.cancel)}},Ea.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Va=function(t,o){t&&(o?this.setSouthWest(t).setNorthEast(o):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};Va.prototype.setNorthEast=function(t){return this._ne=t instanceof ya?new ya(t.lng,t.lat):ya.convert(t),this},Va.prototype.setSouthWest=function(t){return this._sw=t instanceof ya?new ya(t.lng,t.lat):ya.convert(t),this},Va.prototype.extend=function(t){var o,u,p=this._sw,y=this._ne;if(t instanceof ya)o=t,u=t;else{if(!(t instanceof Va))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Va.convert(t)):this.extend(ya.convert(t)):this;if(u=t._ne,!(o=t._sw)||!u)return this}return p||y?(p.lng=Math.min(o.lng,p.lng),p.lat=Math.min(o.lat,p.lat),y.lng=Math.max(u.lng,y.lng),y.lat=Math.max(u.lat,y.lat)):(this._sw=new ya(o.lng,o.lat),this._ne=new ya(u.lng,u.lat)),this},Va.prototype.getCenter=function(){return new ya((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Va.prototype.getSouthWest=function(){return this._sw},Va.prototype.getNorthEast=function(){return this._ne},Va.prototype.getNorthWest=function(){return new ya(this.getWest(),this.getNorth())},Va.prototype.getSouthEast=function(){return new ya(this.getEast(),this.getSouth())},Va.prototype.getWest=function(){return this._sw.lng},Va.prototype.getSouth=function(){return this._sw.lat},Va.prototype.getEast=function(){return this._ne.lng},Va.prototype.getNorth=function(){return this._ne.lat},Va.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Va.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Va.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Va.prototype.contains=function(t){var o=ya.convert(t),u=o.lng,p=o.lat,y=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(y=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&y},Va.convert=function(t){return!t||t instanceof Va?t:new Va(t)};var ya=function(t,o){if(isNaN(t)||isNaN(o))throw new Error("Invalid LngLat object: ("+t+", "+o+")");if(this.lng=+t,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};ya.prototype.wrap=function(){return new ya(tr(this.lng,-180,180),this.lat)},ya.prototype.toArray=function(){return[this.lng,this.lat]},ya.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},ya.prototype.distanceTo=function(t){var o=Math.PI/180,u=this.lat*o,p=t.lat*o,y=Math.sin(u)*Math.sin(p)+Math.cos(u)*Math.cos(p)*Math.cos((t.lng-this.lng)*o);return 63710088e-1*Math.acos(Math.min(y,1))},ya.prototype.toBounds=function(t){t===void 0&&(t=0);var o=360*t/40075017,u=o/Math.cos(Math.PI/180*this.lat);return new Va(new ya(this.lng-u,this.lat-o),new ya(this.lng+u,this.lat+o))},ya.convert=function(t){if(t instanceof ya)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new ya(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new ya(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Ql=2*Math.PI*63710088e-1;function Vs(t){return Ql*Math.cos(t*Math.PI/180)}function wl(t){return(180+t)/360}function ju(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function ad(t,o){return t/Vs(o)}function Vu(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}var uf=function(t,o,u){u===void 0&&(u=0),this.x=+t,this.y=+o,this.z=+u};uf.fromLngLat=function(t,o){o===void 0&&(o=0);var u=ya.convert(t);return new uf(wl(u.lng),ju(u.lat),ad(o,u.lat))},uf.prototype.toLngLat=function(){return new ya(360*this.x-180,Vu(this.y))},uf.prototype.toAltitude=function(){return this.z*Vs(Vu(this.y))},uf.prototype.meterInMercatorCoordinateUnits=function(){return 1/Ql*(t=Vu(this.y),1/Math.cos(t*Math.PI/180));var t};var Hh=function(t,o,u){this.z=t,this.x=o,this.y=u,this.key=Wh(0,t,t,o,u)};Hh.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},Hh.prototype.url=function(t,o){var u,p,y,b,C,I=(p=this.y,y=this.z,b=hs(256*(u=this.x),256*(p=Math.pow(2,y)-p-1),y),C=hs(256*(u+1),256*(p+1),y),b[0]+","+b[1]+","+C[0]+","+C[1]),D=function(z,U,G){for(var q,ie="",Pe=z;Pe>0;Pe--)ie+=(U&(q=1<<Pe-1)?1:0)+(G&q?2:0);return ie}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",D).replace("{bbox-epsg-3857}",I)},Hh.prototype.getTilePoint=function(t){var o=Math.pow(2,this.z);return new le(8192*(t.x*o-this.x),8192*(t.y*o-this.y))},Hh.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var od=function(t,o){this.wrap=t,this.canonical=o,this.key=Wh(t,o.z,o.z,o.x,o.y)},Xo=function(t,o,u,p,y){this.overscaledZ=t,this.wrap=o,this.canonical=new Hh(u,+p,+y),this.key=Wh(o,t,u,p,y)};function Wh(t,o,u,p,y){(t*=2)<0&&(t=-1*t-1);var b=1<<u;return(b*b*t+b*y+p).toString(36)+u.toString(36)+o.toString(36)}Xo.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},Xo.prototype.scaledTo=function(t){var o=this.canonical.z-t;return t>this.canonical.z?new Xo(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Xo(t,this.wrap,t,this.canonical.x>>o,this.canonical.y>>o)},Xo.prototype.calculateScaledKey=function(t,o){var u=this.canonical.z-t;return t>this.canonical.z?Wh(this.wrap*+o,t,this.canonical.z,this.canonical.x,this.canonical.y):Wh(this.wrap*+o,t,t,this.canonical.x>>u,this.canonical.y>>u)},Xo.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var o=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>o&&t.canonical.y===this.canonical.y>>o},Xo.prototype.children=function(t){if(this.overscaledZ>=t)return[new Xo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var o=this.canonical.z+1,u=2*this.canonical.x,p=2*this.canonical.y;return[new Xo(o,this.wrap,o,u,p),new Xo(o,this.wrap,o,u+1,p),new Xo(o,this.wrap,o,u,p+1),new Xo(o,this.wrap,o,u+1,p+1)]},Xo.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},Xo.prototype.wrapped=function(){return new Xo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Xo.prototype.unwrapTo=function(t){return new Xo(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},Xo.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Xo.prototype.toUnwrapped=function(){return new od(this.wrap,this.canonical)},Xo.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Xo.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new uf(t.x-this.wrap,t.y))},gn("CanonicalTileID",Hh),gn("OverscaledTileID",Xo,{omit:["posMatrix"]});var Ec=function(t,o,u){if(this.uid=t,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return et('"'+u+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=o.height;var p=this.dim=o.height-2;this.data=new Uint32Array(o.data.buffer),this.encoding=u||"mapbox";for(var y=0;y<p;y++)this.data[this._idx(-1,y)]=this.data[this._idx(0,y)],this.data[this._idx(p,y)]=this.data[this._idx(p-1,y)],this.data[this._idx(y,-1)]=this.data[this._idx(y,0)],this.data[this._idx(y,p)]=this.data[this._idx(y,p-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(p,-1)]=this.data[this._idx(p-1,0)],this.data[this._idx(-1,p)]=this.data[this._idx(0,p-1)],this.data[this._idx(p,p)]=this.data[this._idx(p-1,p-1)]};Ec.prototype.get=function(t,o){var u=new Uint8Array(this.data.buffer),p=4*this._idx(t,o);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(u[p],u[p+1],u[p+2])},Ec.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Ec.prototype._idx=function(t,o){if(t<-1||t>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(t+1)},Ec.prototype._unpackMapbox=function(t,o,u){return(256*t*256+256*o+u)/10-1e4},Ec.prototype._unpackTerrarium=function(t,o,u){return 256*t+o+u/256-32768},Ec.prototype.getPixels=function(){return new Bo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Ec.prototype.backfillBorder=function(t,o,u){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var p=o*this.dim,y=o*this.dim+this.dim,b=u*this.dim,C=u*this.dim+this.dim;switch(o){case-1:p=y-1;break;case 1:y=p+1}switch(u){case-1:b=C-1;break;case 1:C=b+1}for(var I=-o*this.dim,D=-u*this.dim,z=b;z<C;z++)for(var U=p;U<y;U++)this.data[this._idx(U,z)]=t.data[this._idx(U+I,z+D)]},gn("DEMData",Ec);var Jl=function(t){this._stringToNumber={},this._numberToString=[];for(var o=0;o<t.length;o++){var u=t[o];this._stringToNumber[u]=o,this._numberToString[o]=u}};Jl.prototype.encode=function(t){return this._stringToNumber[t]},Jl.prototype.decode=function(t){return this._numberToString[t]};var Sc=function(t,o,u,p,y){this.type="Feature",this._vectorTileFeature=t,t._z=o,t._x=u,t._y=p,this.properties=t.properties,this.id=y},sd={geometry:{configurable:!0}};sd.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},sd.geometry.set=function(t){this._geometry=t},Sc.prototype.toJSON=function(){var t={geometry:this.geometry};for(var o in this)o!=="_geometry"&&o!=="_vectorTileFeature"&&(t[o]=this[o]);return t},Object.defineProperties(Sc.prototype,sd);var hh=function(){this.state={},this.stateChanges={},this.deletedStates={}};hh.prototype.updateState=function(t,o,u){var p=String(o);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][p]=this.stateChanges[t][p]||{},Mt(this.stateChanges[t][p],u),this.deletedStates[t]===null)for(var y in this.deletedStates[t]={},this.state[t])y!==p&&(this.deletedStates[t][y]=null);else if(this.deletedStates[t]&&this.deletedStates[t][p]===null)for(var b in this.deletedStates[t][p]={},this.state[t][p])u[b]||(this.deletedStates[t][p][b]=null);else for(var C in u)this.deletedStates[t]&&this.deletedStates[t][p]&&this.deletedStates[t][p][C]===null&&delete this.deletedStates[t][p][C]},hh.prototype.removeFeatureState=function(t,o,u){if(this.deletedStates[t]!==null){var p=String(o);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&o!==void 0)this.deletedStates[t][p]!==null&&(this.deletedStates[t][p]=this.deletedStates[t][p]||{},this.deletedStates[t][p][u]=null);else if(o!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][p])for(u in this.deletedStates[t][p]={},this.stateChanges[t][p])this.deletedStates[t][p][u]=null;else this.deletedStates[t][p]=null;else this.deletedStates[t]=null}},hh.prototype.getState=function(t,o){var u=String(o),p=Mt({},(this.state[t]||{})[u],(this.stateChanges[t]||{})[u]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){var y=this.deletedStates[t][o];if(y===null)return{};for(var b in y)delete p[b]}return p},hh.prototype.initializeTileState=function(t,o){t.setFeatureState(this.state,o)},hh.prototype.coalesceChanges=function(t,o){var u={};for(var p in this.stateChanges){this.state[p]=this.state[p]||{};var y={};for(var b in this.stateChanges[p])this.state[p][b]||(this.state[p][b]={}),Mt(this.state[p][b],this.stateChanges[p][b]),y[b]=this.state[p][b];u[p]=y}for(var C in this.deletedStates){this.state[C]=this.state[C]||{};var I={};if(this.deletedStates[C]===null)for(var D in this.state[C])I[D]={},this.state[C][D]={};else for(var z in this.deletedStates[C]){if(this.deletedStates[C][z]===null)this.state[C][z]={};else for(var U=0,G=Object.keys(this.deletedStates[C][z]);U<G.length;U+=1)delete this.state[C][z][G[U]];I[z]=this.state[C][z]}u[C]=u[C]||{},Mt(u[C],I)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(var q in t)t[q].setFeatureState(u,o)};var Cc=function(t,o){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Ru(8192,16,0),this.grid3D=new Ru(8192,16,0),this.featureIndexArray=new X,this.promoteId=o};function ud(t,o,u,p,y){return Xt(t,function(b,C){var I=o instanceof Eu?o.get(C):null;return I&&I.evaluate?I.evaluate(u,p,y):I})}function Bd(t){for(var o=1/0,u=1/0,p=-1/0,y=-1/0,b=0,C=t;b<C.length;b+=1){var I=C[b];o=Math.min(o,I.x),u=Math.min(u,I.y),p=Math.max(p,I.x),y=Math.max(y,I.y)}return{minX:o,minY:u,maxX:p,maxY:y}}function S0(t,o){return o-t}Cc.prototype.insert=function(t,o,u,p,y,b){var C=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,p,y);for(var I=b?this.grid3D:this.grid,D=0;D<o.length;D++){for(var z=o[D],U=[1/0,1/0,-1/0,-1/0],G=0;G<z.length;G++){var q=z[G];U[0]=Math.min(U[0],q.x),U[1]=Math.min(U[1],q.y),U[2]=Math.max(U[2],q.x),U[3]=Math.max(U[3],q.y)}U[0]<8192&&U[1]<8192&&U[2]>=0&&U[3]>=0&&I.insert(C,U[0],U[1],U[2],U[3])}},Cc.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Cu.VectorTile(new sf(this.rawTileData)).layers,this.sourceLayerCoder=new Jl(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Cc.prototype.query=function(t,o,u,p){var y=this;this.loadVTLayers();for(var b=t.params||{},C=8192/t.tileSize/t.scale,I=Fl(b.filter),D=t.queryGeometry,z=t.queryPadding*C,U=Bd(D),G=this.grid.query(U.minX-z,U.minY-z,U.maxX+z,U.maxY+z),q=Bd(t.cameraQueryGeometry),ie=this.grid3D.query(q.minX-z,q.minY-z,q.maxX+z,q.maxY+z,function(zt,Vt,sr,Pr){return function(Br,zn,hn,Wn,dn){for(var Ri=0,ti=Br;Ri<ti.length;Ri+=1){var Mn=ti[Ri];if(zn<=Mn.x&&hn<=Mn.y&&Wn>=Mn.x&&dn>=Mn.y)return!0}var Vi=[new le(zn,hn),new le(zn,dn),new le(Wn,dn),new le(Wn,hn)];if(Br.length>2){for(var Ci=0,ta=Vi;Ci<ta.length;Ci+=1)if(iu(Br,ta[Ci]))return!0}for(var Yn=0;Yn<Br.length-1;Yn++)if(xl(Br[Yn],Br[Yn+1],Vi))return!0;return!1}(t.cameraQueryGeometry,zt-z,Vt-z,sr+z,Pr+z)}),Pe=0,Re=ie;Pe<Re.length;Pe+=1)G.push(Re[Pe]);G.sort(S0);for(var k,Ze={},at=function(zt){var Vt=G[zt];if(Vt!==k){k=Vt;var sr=y.featureIndexArray.get(Vt),Pr=null;y.loadMatchingFeature(Ze,sr.bucketIndex,sr.sourceLayerIndex,sr.featureIndex,I,b.layers,b.availableImages,o,u,p,function(Br,zn,hn){return Pr||(Pr=Ha(Br)),zn.queryIntersectsFeature(D,Br,hn,Pr,y.z,t.transform,C,t.pixelPosMatrix)})}},Ct=0;Ct<G.length;Ct++)at(Ct);return Ze},Cc.prototype.loadMatchingFeature=function(t,o,u,p,y,b,C,I,D,z,U){var G=this.bucketLayerIDs[o];if(!b||function(Br,zn){for(var hn=0;hn<Br.length;hn++)if(zn.indexOf(Br[hn])>=0)return!0;return!1}(b,G)){var q=this.sourceLayerCoder.decode(u),ie=this.vtLayers[q].feature(p);if(y.needGeometry){var Pe=fo(ie,!0);if(!y.filter(new Mi(this.tileID.overscaledZ),Pe,this.tileID.canonical))return}else if(!y.filter(new Mi(this.tileID.overscaledZ),ie))return;for(var Re=this.getId(ie,q),k=0;k<G.length;k++){var Ze=G[k];if(!(b&&b.indexOf(Ze)<0)){var at=I[Ze];if(at){var Ct={};Re!==void 0&&z&&(Ct=z.getState(at.sourceLayer||"_geojsonTileLayer",Re));var zt=Mt({},D[Ze]);zt.paint=ud(zt.paint,at.paint,ie,Ct,C),zt.layout=ud(zt.layout,at.layout,ie,Ct,C);var Vt=!U||U(ie,at,Ct);if(Vt){var sr=new Sc(ie,this.z,this.x,this.y,Re);sr.layer=zt;var Pr=t[Ze];Pr===void 0&&(Pr=t[Ze]=[]),Pr.push({featureIndex:p,feature:sr,intersectionZ:Vt})}}}}}},Cc.prototype.lookupSymbolFeatures=function(t,o,u,p,y,b,C,I){var D={};this.loadVTLayers();for(var z=Fl(y),U=0,G=t;U<G.length;U+=1)this.loadMatchingFeature(D,u,p,G[U],z,b,C,I,o);return D},Cc.prototype.hasLayer=function(t){for(var o=0,u=this.bucketLayerIDs;o<u.length;o+=1)for(var p=0,y=u[o];p<y.length;p+=1)if(t===y[p])return!0;return!1},Cc.prototype.getId=function(t,o){var u=t.id;return this.promoteId&&typeof(u=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[o]])=="boolean"&&(u=Number(u)),u},gn("FeatureIndex",Cc,{omit:["rawTileData","sourceLayerCoder"]});var ps=function(t,o){this.tileID=t,this.uid=Bt(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};ps.prototype.registerFadeDuration=function(t){var o=t+this.timeAdded;o<xn.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)},ps.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},ps.prototype.loadVectorData=function(t,o,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var p in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(z,U){var G={};if(!U)return G;for(var q=function(){var Re=Pe[ie],k=Re.layerIds.map(function(Ct){return U.getLayer(Ct)}).filter(Boolean);if(k.length!==0){Re.layers=k,Re.stateDependentLayerIds&&(Re.stateDependentLayers=Re.stateDependentLayerIds.map(function(Ct){return k.filter(function(zt){return zt.id===Ct})[0]}));for(var Ze=0,at=k;Ze<at.length;Ze+=1)G[at[Ze].id]=Re}},ie=0,Pe=z;ie<Pe.length;ie+=1)q();return G}(t.buckets,o.style),this.hasSymbolBuckets=!1,this.buckets){var y=this.buckets[p];if(y instanceof De){if(this.hasSymbolBuckets=!0,!u)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var b in this.buckets){var C=this.buckets[b];if(C instanceof De&&C.hasRTLText){this.hasRTLText=!0,Os.isLoading()||Os.isLoaded()||Mf()!=="deferred"||vu();break}}for(var I in this.queryPadding=0,this.buckets){var D=this.buckets[I];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(I).queryRadius(D))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new h},ps.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},ps.prototype.getBucket=function(t){return this.buckets[t.id]},ps.prototype.upload=function(t){for(var o in this.buckets){var u=this.buckets[o];u.uploadPending()&&u.upload(t)}var p=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new fn(t,this.imageAtlas.image,p.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new fn(t,this.glyphAtlasImage,p.ALPHA),this.glyphAtlasImage=null)},ps.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},ps.prototype.queryRenderedFeatures=function(t,o,u,p,y,b,C,I,D,z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:y,scale:b,tileSize:this.tileSize,pixelPosMatrix:z,transform:I,params:C,queryPadding:this.queryPadding*D},t,o,u):{}},ps.prototype.querySourceFeatures=function(t,o){var u=this.latestFeatureIndex;if(u&&u.rawTileData){var p=u.loadVTLayers(),y=o?o.sourceLayer:"",b=p._geojsonTileLayer||p[y];if(b)for(var C=Fl(o&&o.filter),I=this.tileID.canonical,D=I.z,z=I.x,U=I.y,G={z:D,x:z,y:U},q=0;q<b.length;q++){var ie=b.feature(q);if(C.needGeometry){var Pe=fo(ie,!0);if(!C.filter(new Mi(this.tileID.overscaledZ),Pe,this.tileID.canonical))continue}else if(!C.filter(new Mi(this.tileID.overscaledZ),ie))continue;var Re=u.getId(ie,y),k=new Sc(ie,D,z,U,Re);k.tile=G,t.push(k)}}},ps.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},ps.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},ps.prototype.setExpiryData=function(t){var o=this.expirationTime;if(t.cacheControl){var u=$r(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var p=Date.now(),y=!1;if(this.expirationTime>p)y=!1;else if(o)if(this.expirationTime<o)y=!0;else{var b=this.expirationTime-o;b?this.expirationTime=p+Math.max(b,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},ps.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},ps.prototype.setFeatureState=function(t,o){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(t).length!==0){var u=this.latestFeatureIndex.loadVTLayers();for(var p in this.buckets)if(o.style.hasLayer(p)){var y=this.buckets[p],b=y.layers[0].sourceLayer||"_geojsonTileLayer",C=u[b],I=t[b];if(C&&I&&Object.keys(I).length!==0){y.update(I,C,this.imageAtlas&&this.imageAtlas.patternPositions||{});var D=o&&o.style&&o.style.getLayer(p);D&&(this.queryPadding=Math.max(this.queryPadding,D.queryRadius(y)))}}}},ps.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},ps.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<xn.now()},ps.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},ps.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=xn.now()+t},ps.prototype.setDependencies=function(t,o){for(var u={},p=0,y=o;p<y.length;p+=1)u[y[p]]=!0;this.dependencies[t]=u},ps.prototype.hasDependency=function(t,o){for(var u=0,p=t;u<p.length;u+=1){var y=this.dependencies[p[u]];if(y){for(var b=0,C=o;b<C.length;b+=1)if(y[C[b]])return!0}}return!1};var Bf=ye.performance,Xh=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},Bf.mark(this._marks.start)};Xh.prototype.finish=function(){Bf.mark(this._marks.end);var t=Bf.getEntriesByName(this._marks.measure);return t.length===0&&(Bf.measure(this._marks.measure,this._marks.start,this._marks.end),t=Bf.getEntriesByName(this._marks.measure),Bf.clearMarks(this._marks.start),Bf.clearMarks(this._marks.end),Bf.clearMeasures(this._marks.measure)),t},g.Actor=Ea,g.AlphaImage=su,g.CanonicalTileID=Hh,g.CollisionBoxArray=h,g.Color=ji,g.DEMData=Ec,g.DataConstantProperty=Ln,g.DictionaryCoder=Jl,g.EXTENT=8192,g.ErrorEvent=Ge,g.EvaluationParameters=Mi,g.Event=Ie,g.Evented=tt,g.FeatureIndex=Cc,g.FillBucket=Us,g.FillExtrusionBucket=Uu,g.ImageAtlas=br,g.ImagePosition=ot,g.LineBucket=Ki,g.LngLat=ya,g.LngLatBounds=Va,g.MercatorCoordinate=uf,g.ONE_EM=24,g.OverscaledTileID=Xo,g.Point=le,g.Point$1=le,g.Properties=Ho,g.Protobuf=sf,g.RGBAImage=Bo,g.RequestManager=Ei,g.RequestPerformance=Xh,g.ResourceType=An,g.SegmentVector=fe,g.SourceFeatureState=hh,g.StructArrayLayout1ui2=Qf,g.StructArrayLayout2f1f2i16=tu,g.StructArrayLayout2i4=dc,g.StructArrayLayout3ui6=ml,g.StructArrayLayout4i8=Ns,g.SymbolBucket=De,g.Texture=fn,g.Tile=ps,g.Transitionable=Go,g.Uniform1f=Dr,g.Uniform1i=vr,g.Uniform2f=_r,g.Uniform3f=ln,g.Uniform4f=Gn,g.UniformColor=Hn,g.UniformMatrix4f=Di,g.UnwrappedTileID=od,g.ValidationError=Le,g.WritingMode=Zr,g.ZoomHistory=Af,g.add=function(t,o,u){return t[0]=o[0]+u[0],t[1]=o[1]+u[1],t[2]=o[2]+u[2],t},g.addDynamicAttributes=Ve,g.asyncAll=function(t,o,u){if(!t.length)return u(null,[]);var p=t.length,y=new Array(t.length),b=null;t.forEach(function(C,I){o(C,function(D,z){D&&(b=D),y[I]=z,--p==0&&u(b,y)})})},g.bezier=st,g.bindAll=rr,g.browser=xn,g.cacheEntryPossiblyAdded=function(t){++bi>Lr&&(t.getActor().send("enforceCacheSizeLimit",er),bi=0)},g.clamp=$t,g.clearTileCache=function(t){var o=ye.caches.delete("mapbox-tiles");t&&o.catch(t).then(function(){return t()})},g.clipLine=So,g.clone=function(t){var o=new ua(16);return o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15],o},g.clone$1=$e,g.clone$2=function(t){var o=new ua(3);return o[0]=t[0],o[1]=t[1],o[2]=t[2],o},g.collisionCircleLayout=Al,g.config=an,g.create=function(){var t=new ua(16);return ua!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},g.create$1=function(){var t=new ua(9);return ua!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},g.create$2=function(){var t=new ua(4);return ua!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},g.createCommonjsModule=Ee,g.createExpression=sc,g.createLayout=La,g.createStyleLayer=function(t){return t.type==="custom"?new jr(t):new on[t.type](t)},g.cross=function(t,o,u){var p=o[0],y=o[1],b=o[2],C=u[0],I=u[1],D=u[2];return t[0]=y*D-b*I,t[1]=b*C-p*D,t[2]=p*I-y*C,t},g.deepEqual=function t(o,u){if(Array.isArray(o)){if(!Array.isArray(u)||o.length!==u.length)return!1;for(var p=0;p<o.length;p++)if(!t(o[p],u[p]))return!1;return!0}if(typeof o=="object"&&o!==null&&u!==null){if(typeof u!="object"||Object.keys(o).length!==Object.keys(u).length)return!1;for(var y in o)if(!t(o[y],u[y]))return!1;return!0}return o===u},g.dot=function(t,o){return t[0]*o[0]+t[1]*o[1]+t[2]*o[2]},g.dot$1=function(t,o){return t[0]*o[0]+t[1]*o[1]+t[2]*o[2]+t[3]*o[3]},g.ease=yt,g.emitValidationErrors=Gc,g.endsWith=K,g.enforceCacheSizeLimit=function(t){sn(),$i&&$i.then(function(o){o.keys().then(function(u){for(var p=0;p<u.length-t;p++)o.delete(u[p])})})},g.evaluateSizeForFeature=Jn,g.evaluateSizeForZoom=fi,g.evaluateVariableOffset=ni,g.evented=Kf,g.extend=Mt,g.featureFilter=Fl,g.filterObject=lt,g.fromRotation=function(t,o){var u=Math.sin(o),p=Math.cos(o);return t[0]=p,t[1]=u,t[2]=0,t[3]=-u,t[4]=p,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},g.getAnchorAlignment=Kr,g.getAnchorJustification=Me,g.getArrayBuffer=Na,g.getImage=Q,g.getJSON=function(t,o){return Uo(Mt(t,{type:"json"}),o)},g.getRTLTextPluginStatus=Mf,g.getReferrer=Li,g.getVideo=function(t,o){var u,p,y=ye.document.createElement("video");y.muted=!0,y.onloadstart=function(){o(null,y)};for(var b=0;b<t.length;b++){var C=ye.document.createElement("source");u=t[b],p=void 0,(p=ye.document.createElement("a")).href=u,(p.protocol!==ye.document.location.protocol||p.host!==ye.document.location.host)&&(y.crossOrigin="Anonymous"),C.src=t[b],y.appendChild(C)}return{cancel:function(){}}},g.identity=Zs,g.invert=function(t,o){var u=o[0],p=o[1],y=o[2],b=o[3],C=o[4],I=o[5],D=o[6],z=o[7],U=o[8],G=o[9],q=o[10],ie=o[11],Pe=o[12],Re=o[13],k=o[14],Ze=o[15],at=u*I-p*C,Ct=u*D-y*C,zt=u*z-b*C,Vt=p*D-y*I,sr=p*z-b*I,Pr=y*z-b*D,Br=U*Re-G*Pe,zn=U*k-q*Pe,hn=U*Ze-ie*Pe,Wn=G*k-q*Re,dn=G*Ze-ie*Re,Ri=q*Ze-ie*k,ti=at*Ri-Ct*dn+zt*Wn+Vt*hn-sr*zn+Pr*Br;return ti?(t[0]=(I*Ri-D*dn+z*Wn)*(ti=1/ti),t[1]=(y*dn-p*Ri-b*Wn)*ti,t[2]=(Re*Pr-k*sr+Ze*Vt)*ti,t[3]=(q*sr-G*Pr-ie*Vt)*ti,t[4]=(D*hn-C*Ri-z*zn)*ti,t[5]=(u*Ri-y*hn+b*zn)*ti,t[6]=(k*zt-Pe*Pr-Ze*Ct)*ti,t[7]=(U*Pr-q*zt+ie*Ct)*ti,t[8]=(C*dn-I*hn+z*Br)*ti,t[9]=(p*hn-u*dn-b*Br)*ti,t[10]=(Pe*sr-Re*zt+Ze*at)*ti,t[11]=(G*zt-U*sr-ie*at)*ti,t[12]=(I*zn-C*Wn-D*Br)*ti,t[13]=(u*Wn-p*zn+y*Br)*ti,t[14]=(Re*Ct-Pe*Vt-k*at)*ti,t[15]=(U*Vt-G*Ct+q*at)*ti,t):null},g.isChar=Vr,g.isMapboxURL=Ti,g.keysDifference=function(t,o){var u=[];for(var p in t)p in o||u.push(p);return u},g.makeRequest=Uo,g.mapObject=Xt,g.mercatorXfromLng=wl,g.mercatorYfromLat=ju,g.mercatorZfromAltitude=ad,g.mul=qc,g.multiply=es,g.mvt=Cu,g.nextPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},g.normalize=function(t,o){var u=o[0],p=o[1],y=o[2],b=u*u+p*p+y*y;return b>0&&(b=1/Math.sqrt(b)),t[0]=o[0]*b,t[1]=o[1]*b,t[2]=o[2]*b,t},g.number=ma,g.offscreenCanvasSupported=vi,g.ortho=function(t,o,u,p,y,b,C){var I=1/(o-u),D=1/(p-y),z=1/(b-C);return t[0]=-2*I,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*D,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*z,t[11]=0,t[12]=(o+u)*I,t[13]=(y+p)*D,t[14]=(C+b)*z,t[15]=1,t},g.parseGlyphPBF=function(t){return new sf(t).readFields(Mr,[])},g.pbf=sf,g.performSymbolLayout=function(t,o,u,p,y,b,C){t.createArrays(),t.tilePixelRatio=8192/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;var I=t.layers[0].layout,D=t.layers[0]._unevaluatedLayout._values,z={};if(t.textSizeData.kind==="composite"){var U=t.textSizeData,G=U.maxZoom;z.compositeTextSizes=[D["text-size"].possiblyEvaluate(new Mi(U.minZoom),C),D["text-size"].possiblyEvaluate(new Mi(G),C)]}if(t.iconSizeData.kind==="composite"){var q=t.iconSizeData,ie=q.maxZoom;z.compositeIconSizes=[D["icon-size"].possiblyEvaluate(new Mi(q.minZoom),C),D["icon-size"].possiblyEvaluate(new Mi(ie),C)]}z.layoutTextSize=D["text-size"].possiblyEvaluate(new Mi(t.zoom+1),C),z.layoutIconSize=D["icon-size"].possiblyEvaluate(new Mi(t.zoom+1),C),z.textMaxSize=D["text-size"].possiblyEvaluate(new Mi(18));for(var Pe=24*I.get("text-line-height"),Re=I.get("text-rotation-alignment")==="map"&&I.get("symbol-placement")!=="point",k=I.get("text-keep-upright"),Ze=I.get("text-size"),at=function(){var Vt=zt[Ct],sr=I.get("text-font").evaluate(Vt,{},C).join(","),Pr=Ze.evaluate(Vt,{},C),Br=z.layoutTextSize.evaluate(Vt,{},C),zn=z.layoutIconSize.evaluate(Vt,{},C),hn={horizontal:{},vertical:void 0},Wn=Vt.text,dn=[0,0];if(Wn){var Ri=Wn.toString(),ti=24*I.get("text-letter-spacing").evaluate(Vt,{},C),Mn=function(Ai){for(var Fa=0,wa=Ai;Fa<wa.length;Fa+=1)if(la=wa[Fa].charCodeAt(0),Vr.Arabic(la)||Vr["Arabic Supplement"](la)||Vr["Arabic Extended-A"](la)||Vr["Arabic Presentation Forms-A"](la)||Vr["Arabic Presentation Forms-B"](la))return!1;var la;return!0}(Ri)?ti:0,Vi=I.get("text-anchor").evaluate(Vt,{},C),Ci=I.get("text-variable-anchor");if(!Ci){var ta=I.get("text-radial-offset").evaluate(Vt,{},C);dn=ta?ni(Vi,[24*ta,Nn]):I.get("text-offset").evaluate(Vt,{},C).map(function(Ai){return 24*Ai})}var Yn=Re?"center":I.get("text-justify").evaluate(Vt,{},C),fa=I.get("symbol-placement"),Ja=fa==="point"?24*I.get("text-max-width").evaluate(Vt,{},C):0,_o=function(){t.allowVerticalPlacement&&pc(Ri)&&(hn.vertical=Qr(Wn,o,u,y,sr,Ja,Pe,Vi,"left",Mn,dn,Zr.vertical,!0,fa,Br,Pr))};if(!Re&&Ci){for(var Wa=Yn==="auto"?Ci.map(function(Ai){return Me(Ai)}):[Yn],eo=!1,xo=0;xo<Wa.length;xo++){var Yo=Wa[xo];if(!hn.horizontal[Yo])if(eo)hn.horizontal[Yo]=hn.horizontal[0];else{var rs=Qr(Wn,o,u,y,sr,Ja,Pe,"center",Yo,Mn,dn,Zr.horizontal,!1,fa,Br,Pr);rs&&(hn.horizontal[Yo]=rs,eo=rs.positionedLines.length===1)}}_o()}else{Yn==="auto"&&(Yn=Me(Vi));var Gs=Qr(Wn,o,u,y,sr,Ja,Pe,Vi,Yn,Mn,dn,Zr.horizontal,!1,fa,Br,Pr);Gs&&(hn.horizontal[Yn]=Gs),_o(),pc(Ri)&&Re&&k&&(hn.vertical=Qr(Wn,o,u,y,sr,Ja,Pe,Vi,Yn,Mn,dn,Zr.vertical,!1,fa,Br,Pr))}}var ns=void 0,Hs=!1;if(Vt.icon&&Vt.icon.name){var Ga=p[Vt.icon.name];Ga&&(ns=function(Ai,Fa,wa){var la=Kr(wa),vs=Fa[0]-Ai.displaySize[0]*la.horizontalAlign,Ts=Fa[1]-Ai.displaySize[1]*la.verticalAlign;return{image:Ai,top:Ts,bottom:Ts+Ai.displaySize[1],left:vs,right:vs+Ai.displaySize[0]}}(y[Vt.icon.name],I.get("icon-offset").evaluate(Vt,{},C),I.get("icon-anchor").evaluate(Vt,{},C)),Hs=Ga.sdf,t.sdfIcons===void 0?t.sdfIcons=Ga.sdf:t.sdfIcons!==Ga.sdf&&et("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ga.pixelRatio!==t.pixelRatio||I.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}var ds=At(hn.horizontal)||hn.vertical;t.iconsInText=!!ds&&ds.iconsInText,(ds||ns)&&function(Ai,Fa,wa,la,vs,Ts,Xa,Ro,ms,ha,ec){var uu=Ts.textMaxSize.evaluate(Fa,{});uu===void 0&&(uu=Xa);var lf,ko=Ai.layers[0].layout,Ac=ko.get("icon-offset").evaluate(Fa,{},ec),nl=At(wa.horizontal),Yh=Xa/24,Nf=Ai.tilePixelRatio*Yh,ph=Ai.tilePixelRatio*uu/24,wc=Ai.tilePixelRatio*Ro,dh=Ai.tilePixelRatio*ko.get("symbol-spacing"),xp=ko.get("text-padding")*Ai.tilePixelRatio,vh=ko.get("icon-padding")*Ai.tilePixelRatio,qh=ko.get("text-max-angle")/180*Math.PI,bp=ko.get("text-rotation-alignment")==="map"&&ko.get("symbol-placement")!=="point",Ep=ko.get("icon-rotation-alignment")==="map"&&ko.get("symbol-placement")!=="point",Tc=ko.get("symbol-placement"),Kh=dh/2,mh=ko.get("icon-text-fit");la&&mh!=="none"&&(Ai.allowVerticalPlacement&&wa.vertical&&(lf=si(la,wa.vertical,mh,ko.get("icon-text-fit-padding"),Ac,Yh)),nl&&(la=si(la,nl,mh,ko.get("icon-text-fit-padding"),Ac,Yh)));var cf=function(C0,Mp){Mp.x<0||Mp.x>=8192||Mp.y<0||Mp.y>=8192||function(Co,tc,A0,ff,fd,Zd,Pp,Gu,Ip,Op,hd,pd,Ud,bv,Rp,Ev,Sv,Cv,Av,wv,Hu,dd,Tv,Mc,w0){var Mv,bh,Tl,il,Eh,Sh=Co.addToLineVertexArray(tc,A0),kp=0,jd=0,Vd=0,Pv=0,Gd=-1,Hd=-1,Pc={},Wd=Ce(""),vd=0,Lp=0;if(Gu._unevaluatedLayout.getValue("text-radial-offset")===void 0?(vd=(Mv=Gu.layout.get("text-offset").evaluate(Hu,{},Mc).map(function(hf){return 24*hf}))[0],Lp=Mv[1]):(vd=24*Gu.layout.get("text-radial-offset").evaluate(Hu,{},Mc),Lp=Nn),Co.allowVerticalPlacement&&ff.vertical){var Xd=Gu.layout.get("text-rotate").evaluate(Hu,{},Mc)+90;il=new Oo(Ip,tc,Op,hd,pd,ff.vertical,Ud,bv,Rp,Xd),Pp&&(Eh=new Oo(Ip,tc,Op,hd,pd,Pp,Sv,Cv,Rp,Xd))}if(fd){var Yd=Gu.layout.get("icon-rotate").evaluate(Hu,{}),Iv=Gu.layout.get("icon-text-fit")!=="none",qd=Wo(fd,Yd,Tv,Iv),Kd=Pp?Wo(Pp,Yd,Tv,Iv):void 0;Tl=new Oo(Ip,tc,Op,hd,pd,fd,Sv,Cv,!1,Yd),kp=4*qd.length;var $d=Co.iconSizeData,np=null;$d.kind==="source"?(np=[128*Gu.layout.get("icon-size").evaluate(Hu,{})])[0]>32640&&et(Co.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):$d.kind==="composite"&&((np=[128*dd.compositeIconSizes[0].evaluate(Hu,{},Mc),128*dd.compositeIconSizes[1].evaluate(Hu,{},Mc)])[0]>32640||np[1]>32640)&&et(Co.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Co.addSymbols(Co.icon,qd,np,wv,Av,Hu,!1,tc,Sh.lineStartIndex,Sh.lineLength,-1,Mc),Gd=Co.icon.placedSymbolArray.length-1,Kd&&(jd=4*Kd.length,Co.addSymbols(Co.icon,Kd,np,wv,Av,Hu,Zr.vertical,tc,Sh.lineStartIndex,Sh.lineLength,-1,Mc),Hd=Co.icon.placedSymbolArray.length-1)}for(var Qd in ff.horizontal){var Dp=ff.horizontal[Qd];if(!bh){Wd=Ce(Dp.text);var T0=Gu.layout.get("text-rotate").evaluate(Hu,{},Mc);bh=new Oo(Ip,tc,Op,hd,pd,Dp,Ud,bv,Rp,T0)}var Ov=Dp.positionedLines.length===1;if(Vd+=Nt(Co,tc,Dp,Zd,Gu,Rp,Hu,Ev,Sh,ff.vertical?Zr.horizontal:Zr.horizontalOnly,Ov?Object.keys(ff.horizontal):[Qd],Pc,Gd,dd,Mc),Ov)break}ff.vertical&&(Pv+=Nt(Co,tc,ff.vertical,Zd,Gu,Rp,Hu,Ev,Sh,Zr.vertical,["vertical"],Pc,Hd,dd,Mc));var M0=bh?bh.boxStartIndex:Co.collisionBoxArray.length,P0=bh?bh.boxEndIndex:Co.collisionBoxArray.length,I0=il?il.boxStartIndex:Co.collisionBoxArray.length,O0=il?il.boxEndIndex:Co.collisionBoxArray.length,R0=Tl?Tl.boxStartIndex:Co.collisionBoxArray.length,Rv=Tl?Tl.boxEndIndex:Co.collisionBoxArray.length,kv=Eh?Eh.boxStartIndex:Co.collisionBoxArray.length,Lv=Eh?Eh.boxEndIndex:Co.collisionBoxArray.length,Ml=-1,Fp=function(hf,Dv){return hf&&hf.circleDiameter?Math.max(hf.circleDiameter,Dv):Dv};Ml=Fp(bh,Ml),Ml=Fp(il,Ml),Ml=Fp(Tl,Ml);var Jd=(Ml=Fp(Eh,Ml))>-1?1:0;Jd&&(Ml*=w0/24),Co.glyphOffsetArray.length>=De.MAX_GLYPHS&&et("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Hu.sortKey!==void 0&&Co.addToSortKeyRanges(Co.symbolInstances.length,Hu.sortKey),Co.symbolInstances.emplaceBack(tc.x,tc.y,Pc.right>=0?Pc.right:-1,Pc.center>=0?Pc.center:-1,Pc.left>=0?Pc.left:-1,Pc.vertical||-1,Gd,Hd,Wd,M0,P0,I0,O0,R0,Rv,kv,Lv,Op,Vd,Pv,kp,jd,Jd,0,Ud,vd,Lp,Ml)}(Ai,Mp,C0,wa,la,vs,lf,Ai.layers[0],Ai.collisionBoxArray,Fa.index,Fa.sourceLayerIndex,Ai.index,Nf,xp,bp,ms,wc,vh,Ep,Ac,Fa,Ts,ha,ec,Xa)};if(Tc==="line")for(var gh=0,Sp=So(Fa.geometry,0,0,8192,8192);gh<Sp.length;gh+=1)for(var Cp=Sp[gh],$h=0,gs=No(Cp,dh,qh,wa.vertical||nl,la,24,ph,Ai.overscaling,8192);$h<gs.length;$h+=1){var Ap=gs[$h];nl&&yn(Ai,nl.text,Kh,Ap)||cf(Cp,Ap)}else if(Tc==="line-center")for(var Qh=0,Jh=Fa.geometry;Qh<Jh.length;Qh+=1){var ep=Jh[Qh];if(ep.length>1){var wp=ja(ep,qh,wa.vertical||nl,la,24,ph);wp&&cf(ep,wp)}}else if(Fa.type==="Polygon")for(var yh=0,Tp=Rf(Fa.geometry,0);yh<Tp.length;yh+=1){var _h=Tp[yh],tp=ri(_h,16);cf(_h[0],new Wr(tp.x,tp.y,0))}else if(Fa.type==="LineString")for(var zf=0,rp=Fa.geometry;zf<rp.length;zf+=1){var xh=rp[zf];cf(xh,new Wr(xh[0].x,xh[0].y,0))}else if(Fa.type==="Point")for(var ld=0,Nd=Fa.geometry;ld<Nd.length;ld+=1)for(var cd=0,xv=Nd[ld];cd<xv.length;cd+=1){var zd=xv[cd];cf([zd],new Wr(zd.x,zd.y,0))}}(t,Vt,hn,ns,p,z,Br,zn,dn,Hs,C)},Ct=0,zt=t.features;Ct<zt.length;Ct+=1)at();b&&t.generateCollisionDebugBuffers()},g.perspective=function(t,o,u,p,y){var b,C=1/Math.tan(o/2);return t[0]=C/u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=C,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,y!=null&&y!==1/0?(t[10]=(y+p)*(b=1/(p-y)),t[14]=2*y*p*b):(t[10]=-1,t[14]=-2*p),t},g.pick=function(t,o){for(var u={},p=0;p<o.length;p++){var y=o[p];y in t&&(u[y]=t[y])}return u},g.plugin=Os,g.polygonIntersectsPolygon=Bu,g.postMapLoadEvent=Zt,g.postTurnstileEvent=bo,g.potpack=Cr,g.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],g.register=gn,g.registerForPluginStateChange=function(t){return t({pluginStatus:Bs,pluginURL:Lu}),Kf.on("pluginStateChange",t),t},g.renderColorRamp=Jf,g.rotate=function(t,o,u){var p=o[0],y=o[1],b=o[2],C=o[3],I=Math.sin(u),D=Math.cos(u);return t[0]=p*D+b*I,t[1]=y*D+C*I,t[2]=p*-I+b*D,t[3]=y*-I+C*D,t},g.rotateX=function(t,o,u){var p=Math.sin(u),y=Math.cos(u),b=o[4],C=o[5],I=o[6],D=o[7],z=o[8],U=o[9],G=o[10],q=o[11];return o!==t&&(t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=o[3],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15]),t[4]=b*y+z*p,t[5]=C*y+U*p,t[6]=I*y+G*p,t[7]=D*y+q*p,t[8]=z*y-b*p,t[9]=U*y-C*p,t[10]=G*y-I*p,t[11]=q*y-D*p,t},g.rotateZ=function(t,o,u){var p=Math.sin(u),y=Math.cos(u),b=o[0],C=o[1],I=o[2],D=o[3],z=o[4],U=o[5],G=o[6],q=o[7];return o!==t&&(t[8]=o[8],t[9]=o[9],t[10]=o[10],t[11]=o[11],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15]),t[0]=b*y+z*p,t[1]=C*y+U*p,t[2]=I*y+G*p,t[3]=D*y+q*p,t[4]=z*y-b*p,t[5]=U*y-C*p,t[6]=G*y-I*p,t[7]=q*y-D*p,t},g.scale=function(t,o,u){var p=u[0],y=u[1],b=u[2];return t[0]=o[0]*p,t[1]=o[1]*p,t[2]=o[2]*p,t[3]=o[3]*p,t[4]=o[4]*y,t[5]=o[5]*y,t[6]=o[6]*y,t[7]=o[7]*y,t[8]=o[8]*b,t[9]=o[9]*b,t[10]=o[10]*b,t[11]=o[11]*b,t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15],t},g.scale$1=function(t,o,u){return t[0]=o[0]*u,t[1]=o[1]*u,t[2]=o[2]*u,t[3]=o[3]*u,t},g.scale$2=function(t,o,u){return t[0]=o[0]*u,t[1]=o[1]*u,t[2]=o[2]*u,t},g.setCacheLimits=function(t,o){er=t,Lr=o},g.setRTLTextPlugin=function(t,o,u){if(u===void 0&&(u=!1),Bs==="deferred"||Bs==="loading"||Bs==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");Lu=xn.resolveURL(t),Bs="deferred",ku=o,pl(),u||vu()},g.sphericalToCartesian=function(t){var o=t[0],u=t[1],p=t[2];return u+=90,u*=Math.PI/180,p*=Math.PI/180,{x:o*Math.cos(u)*Math.sin(p),y:o*Math.sin(u)*Math.sin(p),z:o*Math.cos(p)}},g.sqrLen=function(t){var o=t[0],u=t[1];return o*o+u*u},g.styleSpec=ce,g.sub=function(t,o,u){return t[0]=o[0]-u[0],t[1]=o[1]-u[1],t[2]=o[2]-u[2],t},g.symbolSize=Zi,g.transformMat3=function(t,o,u){var p=o[0],y=o[1],b=o[2];return t[0]=p*u[0]+y*u[3]+b*u[6],t[1]=p*u[1]+y*u[4]+b*u[7],t[2]=p*u[2]+y*u[5]+b*u[8],t},g.transformMat4=Kc,g.translate=function(t,o,u){var p,y,b,C,I,D,z,U,G,q,ie,Pe,Re=u[0],k=u[1],Ze=u[2];return o===t?(t[12]=o[0]*Re+o[4]*k+o[8]*Ze+o[12],t[13]=o[1]*Re+o[5]*k+o[9]*Ze+o[13],t[14]=o[2]*Re+o[6]*k+o[10]*Ze+o[14],t[15]=o[3]*Re+o[7]*k+o[11]*Ze+o[15]):(y=o[1],b=o[2],C=o[3],I=o[4],D=o[5],z=o[6],U=o[7],G=o[8],q=o[9],ie=o[10],Pe=o[11],t[0]=p=o[0],t[1]=y,t[2]=b,t[3]=C,t[4]=I,t[5]=D,t[6]=z,t[7]=U,t[8]=G,t[9]=q,t[10]=ie,t[11]=Pe,t[12]=p*Re+I*k+G*Ze+o[12],t[13]=y*Re+D*k+q*Ze+o[13],t[14]=b*Re+z*k+ie*Ze+o[14],t[15]=C*Re+U*k+Pe*Ze+o[15]),t},g.triggerPluginCompletionEvent=qf,g.uniqueId=Bt,g.validateCustomStyleLayer=function(t){var o=[],u=t.id;return u===void 0&&o.push({message:"layers."+u+': missing required property "id"'}),t.render===void 0&&o.push({message:"layers."+u+': missing required method "render"'}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&o.push({message:"layers."+u+': property "renderingMode" must be either "2d" or "3d"'}),o},g.validateLight=fc,g.validateStyle=Ua,g.values=function(t){var o=[];for(var u in t)o.push(t[u]);return o},g.vectorTile=Cu,g.version="1.13.2",g.warnOnce=et,g.webpSupported=Dn,g.window=ye,g.wrap=tr}),ue(["./shared"],function(g){"use strict";function Ee(V){var Q=typeof V;if(Q==="number"||Q==="boolean"||Q==="string"||V==null)return JSON.stringify(V);if(Array.isArray(V)){for(var ne="[",ge=0,Ie=V;ge<Ie.length;ge+=1)ne+=Ee(Ie[ge])+",";return ne+"]"}for(var Ge=Object.keys(V).sort(),tt="{",ce=0;ce<Ge.length;ce++)tt+=JSON.stringify(Ge[ce])+":"+Ee(V[Ge[ce]])+",";return tt+"}"}function H(V){for(var Q="",ne=0,ge=g.refProperties;ne<ge.length;ne+=1)Q+="/"+Ee(V[ge[ne]]);return Q}var ae=function(V){this.keyCache={},V&&this.replace(V)};ae.prototype.replace=function(V){this._layerConfigs={},this._layers={},this.update(V,[])},ae.prototype.update=function(V,Q){for(var ne=this,ge=0,Ie=V;ge<Ie.length;ge+=1){var Ge=Ie[ge];this._layerConfigs[Ge.id]=Ge;var tt=this._layers[Ge.id]=g.createStyleLayer(Ge);tt._featureFilter=g.featureFilter(tt.filter),this.keyCache[Ge.id]&&delete this.keyCache[Ge.id]}for(var ce=0,Le=Q;ce<Le.length;ce+=1){var mt=Le[ce];delete this.keyCache[mt],delete this._layerConfigs[mt],delete this._layers[mt]}this.familiesBySource={};for(var pr=0,Lt=function(zr,Xr){for(var mi={},tn=0;tn<zr.length;tn++){var mn=Xr&&Xr[zr[tn].id]||H(zr[tn]);Xr&&(Xr[zr[tn].id]=mn);var Xi=mi[mn];Xi||(Xi=mi[mn]=[]),Xi.push(zr[tn])}var hi=[];for(var Pi in mi)hi.push(mi[Pi]);return hi}(g.values(this._layerConfigs),this.keyCache);pr<Lt.length;pr+=1){var Ft=Lt[pr].map(function(zr){return ne._layers[zr.id]}),dr=Ft[0];if(dr.visibility!=="none"){var bn=dr.source||"",pn=this.familiesBySource[bn];pn||(pn=this.familiesBySource[bn]={});var Pt=dr.sourceLayer||"_geojsonTileLayer",en=pn[Pt];en||(en=pn[Pt]=[]),en.push(Ft)}}};var le=function(V){var Q={},ne=[];for(var ge in V){var Ie=V[ge],Ge=Q[ge]={};for(var tt in Ie){var ce=Ie[+tt];if(ce&&ce.bitmap.width!==0&&ce.bitmap.height!==0){var Le={x:0,y:0,w:ce.bitmap.width+2,h:ce.bitmap.height+2};ne.push(Le),Ge[tt]={rect:Le,metrics:ce.metrics}}}}var mt=g.potpack(ne),pr=new g.AlphaImage({width:mt.w||1,height:mt.h||1});for(var Lt in V){var Ft=V[Lt];for(var dr in Ft){var bn=Ft[+dr];if(bn&&bn.bitmap.width!==0&&bn.bitmap.height!==0){var pn=Q[Lt][dr].rect;g.AlphaImage.copy(bn.bitmap,pr,{x:0,y:0},{x:pn.x+1,y:pn.y+1},bn.bitmap)}}}this.image=pr,this.positions=Q};g.register("GlyphAtlas",le);var Be=function(V){this.tileID=new g.OverscaledTileID(V.tileID.overscaledZ,V.tileID.wrap,V.tileID.canonical.z,V.tileID.canonical.x,V.tileID.canonical.y),this.uid=V.uid,this.zoom=V.zoom,this.pixelRatio=V.pixelRatio,this.tileSize=V.tileSize,this.source=V.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=V.showCollisionBoxes,this.collectResourceTiming=!!V.collectResourceTiming,this.returnDependencies=!!V.returnDependencies,this.promoteId=V.promoteId};function ye(V,Q,ne){for(var ge=new g.EvaluationParameters(Q),Ie=0,Ge=V;Ie<Ge.length;Ie+=1)Ge[Ie].recalculate(ge,ne)}function Je(V,Q){var ne=g.getArrayBuffer(V.request,function(ge,Ie,Ge,tt){ge?Q(ge):Ie&&Q(null,{vectorTile:new g.vectorTile.VectorTile(new g.pbf(Ie)),rawData:Ie,cacheControl:Ge,expires:tt})});return function(){ne.cancel(),Q()}}Be.prototype.parse=function(V,Q,ne,ge,Ie){var Ge=this;this.status="parsing",this.data=V,this.collisionBoxArray=new g.CollisionBoxArray;var tt=new g.DictionaryCoder(Object.keys(V.layers).sort()),ce=new g.FeatureIndex(this.tileID,this.promoteId);ce.bucketLayerIDs=[];var Le,mt,pr,Lt,Ft={},dr={featureIndex:ce,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ne},bn=Q.familiesBySource[this.source];for(var pn in bn){var Pt=V.layers[pn];if(Pt){Pt.version===1&&g.warnOnce('Vector tile source "'+this.source+'" layer "'+pn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var en=tt.encode(pn),zr=[],Xr=0;Xr<Pt.length;Xr++){var mi=Pt.feature(Xr),tn=ce.getId(mi,pn);zr.push({feature:mi,id:tn,index:Xr,sourceLayerIndex:en})}for(var mn=0,Xi=bn[pn];mn<Xi.length;mn+=1){var hi=Xi[mn],Pi=hi[0];Pi.minzoom&&this.zoom<Math.floor(Pi.minzoom)||Pi.maxzoom&&this.zoom>=Pi.maxzoom||Pi.visibility!=="none"&&(ye(hi,this.zoom,ne),(Ft[Pi.id]=Pi.createBucket({index:ce.bucketLayerIDs.length,layers:hi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:en,sourceID:this.source})).populate(zr,dr,this.tileID.canonical),ce.bucketLayerIDs.push(hi.map(function(Si){return Si.id})))}}}var _i=g.mapObject(dr.glyphDependencies,function(Si){return Object.keys(Si).map(Number)});Object.keys(_i).length?ge.send("getGlyphs",{uid:this.uid,stacks:_i},function(Si,Ii){Le||(Le=Si,mt=Ii,Ta.call(Ge))}):mt={};var dt=Object.keys(dr.iconDependencies);dt.length?ge.send("getImages",{icons:dt,source:this.source,tileID:this.tileID,type:"icons"},function(Si,Ii){Le||(Le=Si,pr=Ii,Ta.call(Ge))}):pr={};var It=Object.keys(dr.patternDependencies);function Ta(){if(Le)return Ie(Le);if(mt&&pr&&Lt){var Si=new le(mt),Ii=new g.ImageAtlas(pr,Lt);for(var ji in Ft){var Ir=Ft[ji];Ir instanceof g.SymbolBucket?(ye(Ir.layers,this.zoom,ne),g.performSymbolLayout(Ir,mt,Si.positions,pr,Ii.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Ir.hasPattern&&(Ir instanceof g.LineBucket||Ir instanceof g.FillBucket||Ir instanceof g.FillExtrusionBucket)&&(ye(Ir.layers,this.zoom,ne),Ir.addFeatures(dr,this.tileID.canonical,Ii.patternPositions))}this.status="done",Ie(null,{buckets:g.values(Ft).filter(function(un){return!un.isEmpty()}),featureIndex:ce,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Si.image,imageAtlas:Ii,glyphMap:this.returnDependencies?mt:null,iconMap:this.returnDependencies?pr:null,glyphPositions:this.returnDependencies?Si.positions:null})}}It.length?ge.send("getImages",{icons:It,source:this.source,tileID:this.tileID,type:"patterns"},function(Si,Ii){Le||(Le=Si,Lt=Ii,Ta.call(Ge))}):Lt={},Ta.call(this)};var st=function(V,Q,ne,ge){this.actor=V,this.layerIndex=Q,this.availableImages=ne,this.loadVectorData=ge||Je,this.loading={},this.loaded={}};st.prototype.loadTile=function(V,Q){var ne=this,ge=V.uid;this.loading||(this.loading={});var Ie=!!(V&&V.request&&V.request.collectResourceTiming)&&new g.RequestPerformance(V.request),Ge=this.loading[ge]=new Be(V);Ge.abort=this.loadVectorData(V,function(tt,ce){if(delete ne.loading[ge],tt||!ce)return Ge.status="done",ne.loaded[ge]=Ge,Q(tt);var Le=ce.rawData,mt={};ce.expires&&(mt.expires=ce.expires),ce.cacheControl&&(mt.cacheControl=ce.cacheControl);var pr={};if(Ie){var Lt=Ie.finish();Lt&&(pr.resourceTiming=JSON.parse(JSON.stringify(Lt)))}Ge.vectorTile=ce.vectorTile,Ge.parse(ce.vectorTile,ne.layerIndex,ne.availableImages,ne.actor,function(Ft,dr){if(Ft||!dr)return Q(Ft);Q(null,g.extend({rawTileData:Le.slice(0)},dr,mt,pr))}),ne.loaded=ne.loaded||{},ne.loaded[ge]=Ge})},st.prototype.reloadTile=function(V,Q){var ne=this,ge=this.loaded,Ie=V.uid,Ge=this;if(ge&&ge[Ie]){var tt=ge[Ie];tt.showCollisionBoxes=V.showCollisionBoxes;var ce=function(Le,mt){var pr=tt.reloadCallback;pr&&(delete tt.reloadCallback,tt.parse(tt.vectorTile,Ge.layerIndex,ne.availableImages,Ge.actor,pr)),Q(Le,mt)};tt.status==="parsing"?tt.reloadCallback=ce:tt.status==="done"&&(tt.vectorTile?tt.parse(tt.vectorTile,this.layerIndex,this.availableImages,this.actor,ce):ce())}},st.prototype.abortTile=function(V,Q){var ne=this.loading,ge=V.uid;ne&&ne[ge]&&ne[ge].abort&&(ne[ge].abort(),delete ne[ge]),Q()},st.prototype.removeTile=function(V,Q){var ne=this.loaded,ge=V.uid;ne&&ne[ge]&&delete ne[ge],Q()};var yt=g.window.ImageBitmap,$t=function(){this.loaded={}};function tr(V,Q){if(V.length!==0){Mt(V[0],Q);for(var ne=1;ne<V.length;ne++)Mt(V[ne],!Q)}}function Mt(V,Q){for(var ne=0,ge=0,Ie=V.length,Ge=Ie-1;ge<Ie;Ge=ge++)ne+=(V[ge][0]-V[Ge][0])*(V[Ge][1]+V[ge][1]);ne>=0!=!!Q&&V.reverse()}$t.prototype.loadTile=function(V,Q){var ne=V.uid,ge=V.encoding,Ie=V.rawImageData,Ge=yt&&Ie instanceof yt?this.getImageData(Ie):Ie,tt=new g.DEMData(ne,Ge,ge);this.loaded=this.loaded||{},this.loaded[ne]=tt,Q(null,tt)},$t.prototype.getImageData=function(V){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(V.width,V.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=V.width,this.offscreenCanvas.height=V.height,this.offscreenCanvasContext.drawImage(V,0,0,V.width,V.height);var Q=this.offscreenCanvasContext.getImageData(-1,-1,V.width+2,V.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new g.RGBAImage({width:Q.width,height:Q.height},Q.data)},$t.prototype.removeTile=function(V){var Q=this.loaded,ne=V.uid;Q&&Q[ne]&&delete Q[ne]};var Qt=g.vectorTile.VectorTileFeature.prototype.toGeoJSON,Bt=function(V){this._feature=V,this.extent=g.EXTENT,this.type=V.type,this.properties=V.tags,"id"in V&&!isNaN(V.id)&&(this.id=parseInt(V.id,10))};Bt.prototype.loadGeometry=function(){if(this._feature.type===1){for(var V=[],Q=0,ne=this._feature.geometry;Q<ne.length;Q+=1){var ge=ne[Q];V.push([new g.Point$1(ge[0],ge[1])])}return V}for(var Ie=[],Ge=0,tt=this._feature.geometry;Ge<tt.length;Ge+=1){for(var ce=[],Le=0,mt=tt[Ge];Le<mt.length;Le+=1){var pr=mt[Le];ce.push(new g.Point$1(pr[0],pr[1]))}Ie.push(ce)}return Ie},Bt.prototype.toGeoJSON=function(V,Q,ne){return Qt.call(this,V,Q,ne)};var ut=function(V){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=g.EXTENT,this.length=V.length,this._features=V};ut.prototype.feature=function(V){return new Bt(this._features[V])};var pt=g.vectorTile.VectorTileFeature,rr=K;function K(V,Q){this.options=Q||{},this.features=V,this.length=V.length}function Xt(V,Q){this.id=typeof V.id=="number"?V.id:void 0,this.type=V.type,this.rawGeometry=V.type===1?[V.geometry]:V.geometry,this.properties=V.tags,this.extent=Q||4096}K.prototype.feature=function(V){return new Xt(this.features[V],this.options.extent)},Xt.prototype.loadGeometry=function(){var V=this.rawGeometry;this.geometry=[];for(var Q=0;Q<V.length;Q++){for(var ne=V[Q],ge=[],Ie=0;Ie<ne.length;Ie++)ge.push(new g.Point$1(ne[Ie][0],ne[Ie][1]));this.geometry.push(ge)}return this.geometry},Xt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var V=this.geometry,Q=1/0,ne=-1/0,ge=1/0,Ie=-1/0,Ge=0;Ge<V.length;Ge++)for(var tt=V[Ge],ce=0;ce<tt.length;ce++){var Le=tt[ce];Q=Math.min(Q,Le.x),ne=Math.max(ne,Le.x),ge=Math.min(ge,Le.y),Ie=Math.max(Ie,Le.y)}return[Q,ge,ne,Ie]},Xt.prototype.toGeoJSON=pt.prototype.toGeoJSON;var lt=St,$e=rr;function St(V){var Q=new g.pbf;return function(ne,ge){for(var Ie in ne.layers)ge.writeMessage(3,et,ne.layers[Ie])}(V,Q),Q.finish()}function et(V,Q){var ne;Q.writeVarintField(15,V.version||1),Q.writeStringField(1,V.name||""),Q.writeVarintField(5,V.extent||4096);var ge={keys:[],values:[],keycache:{},valuecache:{}};for(ne=0;ne<V.length;ne++)ge.feature=V.feature(ne),Q.writeMessage(2,Ht,ge);var Ie=ge.keys;for(ne=0;ne<Ie.length;ne++)Q.writeStringField(3,Ie[ne]);var Ge=ge.values;for(ne=0;ne<Ge.length;ne++)Q.writeMessage(4,pe,Ge[ne])}function Ht(V,Q){var ne=V.feature;ne.id!==void 0&&Q.writeVarintField(1,ne.id),Q.writeMessage(2,Er,V),Q.writeVarintField(3,ne.type),Q.writeMessage(4,S,ne)}function Er(V,Q){var ne=V.feature,ge=V.keys,Ie=V.values,Ge=V.keycache,tt=V.valuecache;for(var ce in ne.properties){var Le=Ge[ce];Le===void 0&&(ge.push(ce),Ge[ce]=Le=ge.length-1),Q.writeVarint(Le);var mt=ne.properties[ce],pr=typeof mt;pr!=="string"&&pr!=="boolean"&&pr!=="number"&&(mt=JSON.stringify(mt));var Lt=pr+":"+mt,Ft=tt[Lt];Ft===void 0&&(Ie.push(mt),tt[Lt]=Ft=Ie.length-1),Q.writeVarint(Ft)}}function kr(V,Q){return(Q<<3)+(7&V)}function $r(V){return V<<1^V>>31}function S(V,Q){for(var ne=V.loadGeometry(),ge=V.type,Ie=0,Ge=0,tt=ne.length,ce=0;ce<tt;ce++){var Le=ne[ce],mt=1;ge===1&&(mt=Le.length),Q.writeVarint(kr(1,mt));for(var pr=ge===3?Le.length-1:Le.length,Lt=0;Lt<pr;Lt++){Lt===1&&ge!==1&&Q.writeVarint(kr(2,pr-1));var Ft=Le[Lt].x-Ie,dr=Le[Lt].y-Ge;Q.writeVarint($r(Ft)),Q.writeVarint($r(dr)),Ie+=Ft,Ge+=dr}ge===3&&Q.writeVarint(kr(7,1))}}function pe(V,Q){var ne=typeof V;ne==="string"?Q.writeStringField(1,V):ne==="boolean"?Q.writeBooleanField(7,V):ne==="number"&&(V%1!=0?Q.writeDoubleField(3,V):V<0?Q.writeSVarintField(6,V):Q.writeVarintField(5,V))}function he(V,Q,ne,ge){He(V,ne,ge),He(Q,2*ne,2*ge),He(Q,2*ne+1,2*ge+1)}function He(V,Q,ne){var ge=V[Q];V[Q]=V[ne],V[ne]=ge}function Ke(V,Q,ne,ge){var Ie=V-ne,Ge=Q-ge;return Ie*Ie+Ge*Ge}lt.fromVectorTileJs=St,lt.fromGeojsonVt=function(V,Q){Q=Q||{};var ne={};for(var ge in V)ne[ge]=new rr(V[ge].features,Q),ne[ge].name=ge,ne[ge].version=Q.version,ne[ge].extent=Q.extent;return St({layers:ne})},lt.GeoJSONWrapper=$e;var it=function(V){return V[0]},bt=function(V){return V[1]},nr=function(V,Q,ne,ge,Ie){Q===void 0&&(Q=it),ne===void 0&&(ne=bt),ge===void 0&&(ge=64),Ie===void 0&&(Ie=Float64Array),this.nodeSize=ge,this.points=V;for(var Ge=V.length<65536?Uint16Array:Uint32Array,tt=this.ids=new Ge(V.length),ce=this.coords=new Ie(2*V.length),Le=0;Le<V.length;Le++)tt[Le]=Le,ce[2*Le]=Q(V[Le]),ce[2*Le+1]=ne(V[Le]);(function mt(pr,Lt,Ft,dr,bn,pn){if(!(bn-dr<=Ft)){var Pt=dr+bn>>1;(function en(zr,Xr,mi,tn,mn,Xi){for(;mn>tn;){if(mn-tn>600){var hi=mn-tn+1,Pi=mi-tn+1,_i=Math.log(hi),dt=.5*Math.exp(2*_i/3),It=.5*Math.sqrt(_i*dt*(hi-dt)/hi)*(Pi-hi/2<0?-1:1);en(zr,Xr,mi,Math.max(tn,Math.floor(mi-Pi*dt/hi+It)),Math.min(mn,Math.floor(mi+(hi-Pi)*dt/hi+It)),Xi)}var Ta=Xr[2*mi+Xi],Si=tn,Ii=mn;for(he(zr,Xr,tn,mi),Xr[2*mn+Xi]>Ta&&he(zr,Xr,tn,mn);Si<Ii;){for(he(zr,Xr,Si,Ii),Si++,Ii--;Xr[2*Si+Xi]<Ta;)Si++;for(;Xr[2*Ii+Xi]>Ta;)Ii--}Xr[2*tn+Xi]===Ta?he(zr,Xr,tn,Ii):he(zr,Xr,++Ii,mn),Ii<=mi&&(tn=Ii+1),mi<=Ii&&(mn=Ii-1)}})(pr,Lt,Pt,dr,bn,pn%2),mt(pr,Lt,Ft,dr,Pt-1,pn+1),mt(pr,Lt,Ft,Pt+1,bn,pn+1)}})(tt,ce,ge,0,tt.length-1,0)};nr.prototype.range=function(V,Q,ne,ge){return function(Ie,Ge,tt,ce,Le,mt,pr){for(var Lt,Ft,dr=[0,Ie.length-1,0],bn=[];dr.length;){var pn=dr.pop(),Pt=dr.pop(),en=dr.pop();if(Pt-en<=pr)for(var zr=en;zr<=Pt;zr++)Ft=Ge[2*zr+1],(Lt=Ge[2*zr])>=tt&&Lt<=Le&&Ft>=ce&&Ft<=mt&&bn.push(Ie[zr]);else{var Xr=Math.floor((en+Pt)/2);Ft=Ge[2*Xr+1],(Lt=Ge[2*Xr])>=tt&&Lt<=Le&&Ft>=ce&&Ft<=mt&&bn.push(Ie[Xr]);var mi=(pn+1)%2;(pn===0?tt<=Lt:ce<=Ft)&&(dr.push(en),dr.push(Xr-1),dr.push(mi)),(pn===0?Le>=Lt:mt>=Ft)&&(dr.push(Xr+1),dr.push(Pt),dr.push(mi))}}return bn}(this.ids,this.coords,V,Q,ne,ge,this.nodeSize)},nr.prototype.within=function(V,Q,ne){return function(ge,Ie,Ge,tt,ce,Le){for(var mt=[0,ge.length-1,0],pr=[],Lt=ce*ce;mt.length;){var Ft=mt.pop(),dr=mt.pop(),bn=mt.pop();if(dr-bn<=Le)for(var pn=bn;pn<=dr;pn++)Ke(Ie[2*pn],Ie[2*pn+1],Ge,tt)<=Lt&&pr.push(ge[pn]);else{var Pt=Math.floor((bn+dr)/2),en=Ie[2*Pt],zr=Ie[2*Pt+1];Ke(en,zr,Ge,tt)<=Lt&&pr.push(ge[Pt]);var Xr=(Ft+1)%2;(Ft===0?Ge-ce<=en:tt-ce<=zr)&&(mt.push(bn),mt.push(Pt-1),mt.push(Xr)),(Ft===0?Ge+ce>=en:tt+ce>=zr)&&(mt.push(Pt+1),mt.push(dr),mt.push(Xr))}}return pr}(this.ids,this.coords,V,Q,ne,this.nodeSize)};var Nr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(V){return V}},wr=function(V){this.options=wi(Object.create(Nr),V),this.trees=new Array(this.options.maxZoom+1)};function xn(V,Q,ne,ge,Ie){return{x:V,y:Q,zoom:1/0,id:ne,parentId:-1,numPoints:ge,properties:Ie}}function an(V,Q){var ne=V.geometry.coordinates,ge=ne[1];return{x:In(ne[0]),y:ii(ge),zoom:1/0,index:Q,parentId:-1}}function Dn(V){return{type:"Feature",id:V.id,properties:jn(V),geometry:{type:"Point",coordinates:[(ge=V.x,360*(ge-.5)),(Q=V.y,ne=(180-360*Q)*Math.PI/180,360*Math.atan(Math.exp(ne))/Math.PI-90)]}};var Q,ne,ge}function jn(V){var Q=V.numPoints,ne=Q>=1e4?Math.round(Q/1e3)+"k":Q>=1e3?Math.round(Q/100)/10+"k":Q;return wi(wi({},V.properties),{cluster:!0,cluster_id:V.id,point_count:Q,point_count_abbreviated:ne})}function In(V){return V/360+.5}function ii(V){var Q=Math.sin(V*Math.PI/180),ne=.5-.25*Math.log((1+Q)/(1-Q))/Math.PI;return ne<0?0:ne>1?1:ne}function wi(V,Q){for(var ne in Q)V[ne]=Q[ne];return V}function Ei(V){return V.x}function Ti(V){return V.y}function Gi(V,Q,ne,ge,Ie,Ge){var tt=Ie-ne,ce=Ge-ge;if(tt!==0||ce!==0){var Le=((V-ne)*tt+(Q-ge)*ce)/(tt*tt+ce*ce);Le>1?(ne=Ie,ge=Ge):Le>0&&(ne+=tt*Le,ge+=ce*Le)}return(tt=V-ne)*tt+(ce=Q-ge)*ce}function Qi(V,Q,ne,ge){var Ie={id:V===void 0?null:V,type:Q,geometry:ne,tags:ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ge){var tt=Ge.geometry,ce=Ge.type;if(ce==="Point"||ce==="MultiPoint"||ce==="LineString")po(Ge,tt);else if(ce==="Polygon"||ce==="MultiLineString")for(var Le=0;Le<tt.length;Le++)po(Ge,tt[Le]);else if(ce==="MultiPolygon")for(Le=0;Le<tt.length;Le++)for(var mt=0;mt<tt[Le].length;mt++)po(Ge,tt[Le][mt])}(Ie),Ie}function po(V,Q){for(var ne=0;ne<Q.length;ne+=3)V.minX=Math.min(V.minX,Q[ne]),V.minY=Math.min(V.minY,Q[ne+1]),V.maxX=Math.max(V.maxX,Q[ne]),V.maxY=Math.max(V.maxY,Q[ne+1])}function Sa(V,Q,ne,ge){if(Q.geometry){var Ie=Q.geometry.coordinates,Ge=Q.geometry.type,tt=Math.pow(ne.tolerance/((1<<ne.maxZoom)*ne.extent),2),ce=[],Le=Q.id;if(ne.promoteId?Le=Q.properties[ne.promoteId]:ne.generateId&&(Le=ge||0),Ge==="Point")pa(Ie,ce);else if(Ge==="MultiPoint")for(var mt=0;mt<Ie.length;mt++)pa(Ie[mt],ce);else if(Ge==="LineString")Fi(Ie,ce,tt,!1);else if(Ge==="MultiLineString"){if(ne.lineMetrics){for(mt=0;mt<Ie.length;mt++)Fi(Ie[mt],ce=[],tt,!1),V.push(Qi(Le,"LineString",ce,Q.properties));return}ra(Ie,ce,tt,!1)}else if(Ge==="Polygon")ra(Ie,ce,tt,!0);else{if(Ge!=="MultiPolygon"){if(Ge==="GeometryCollection"){for(mt=0;mt<Q.geometry.geometries.length;mt++)Sa(V,{id:Le,geometry:Q.geometry.geometries[mt],properties:Q.properties},ne,ge);return}throw new Error("Input data is not a valid GeoJSON object.")}for(mt=0;mt<Ie.length;mt++){var pr=[];ra(Ie[mt],pr,tt,!0),ce.push(pr)}}V.push(Qi(Le,Ge,ce,Q.properties))}}function pa(V,Q){Q.push($i(V[0])),Q.push(is(V[1])),Q.push(0)}function Fi(V,Q,ne,ge){for(var Ie,Ge,tt=0,ce=0;ce<V.length;ce++){var Le=$i(V[ce][0]),mt=is(V[ce][1]);Q.push(Le),Q.push(mt),Q.push(0),ce>0&&(tt+=ge?(Ie*mt-Le*Ge)/2:Math.sqrt(Math.pow(Le-Ie,2)+Math.pow(mt-Ge,2))),Ie=Le,Ge=mt}var pr=Q.length-3;Q[2]=1,function Lt(Ft,dr,bn,pn){for(var Pt,en=pn,zr=bn-dr>>1,Xr=bn-dr,mi=Ft[dr],tn=Ft[dr+1],mn=Ft[bn],Xi=Ft[bn+1],hi=dr+3;hi<bn;hi+=3){var Pi=Gi(Ft[hi],Ft[hi+1],mi,tn,mn,Xi);if(Pi>en)Pt=hi,en=Pi;else if(Pi===en){var _i=Math.abs(hi-zr);_i<Xr&&(Pt=hi,Xr=_i)}}en>pn&&(Pt-dr>3&&Lt(Ft,dr,Pt,pn),Ft[Pt+2]=en,bn-Pt>3&&Lt(Ft,Pt,bn,pn))}(Q,0,pr,ne),Q[pr+2]=1,Q.size=Math.abs(tt),Q.start=0,Q.end=Q.size}function ra(V,Q,ne,ge){for(var Ie=0;Ie<V.length;Ie++){var Ge=[];Fi(V[Ie],Ge,ne,ge),Q.push(Ge)}}function $i(V){return V/360+.5}function is(V){var Q=Math.sin(V*Math.PI/180),ne=.5-.25*Math.log((1+Q)/(1-Q))/Math.PI;return ne<0?0:ne>1?1:ne}function me(V,Q,ne,ge,Ie,Ge,tt,ce){if(ge/=Q,Ge>=(ne/=Q)&&tt<ge)return V;if(tt<ne||Ge>=ge)return null;for(var Le=[],mt=0;mt<V.length;mt++){var pr=V[mt],Lt=pr.geometry,Ft=pr.type,dr=Ie===0?pr.minX:pr.minY,bn=Ie===0?pr.maxX:pr.maxY;if(dr>=ne&&bn<ge)Le.push(pr);else if(!(bn<ne||dr>=ge)){var pn=[];if(Ft==="Point"||Ft==="MultiPoint")li(Lt,pn,ne,ge,Ie);else if(Ft==="LineString")bo(Lt,pn,ne,ge,Ie,!1,ce.lineMetrics);else if(Ft==="MultiLineString")Zt(Lt,pn,ne,ge,Ie,!1);else if(Ft==="Polygon")Zt(Lt,pn,ne,ge,Ie,!0);else if(Ft==="MultiPolygon")for(var Pt=0;Pt<Lt.length;Pt++){var en=[];Zt(Lt[Pt],en,ne,ge,Ie,!0),en.length&&pn.push(en)}if(pn.length){if(ce.lineMetrics&&Ft==="LineString"){for(Pt=0;Pt<pn.length;Pt++)Le.push(Qi(pr.id,Ft,pn[Pt],pr.tags));continue}Ft!=="LineString"&&Ft!=="MultiLineString"||(pn.length===1?(Ft="LineString",pn=pn[0]):Ft="MultiLineString"),Ft!=="Point"&&Ft!=="MultiPoint"||(Ft=pn.length===3?"Point":"MultiPoint"),Le.push(Qi(pr.id,Ft,pn,pr.tags))}}}return Le.length?Le:null}function li(V,Q,ne,ge,Ie){for(var Ge=0;Ge<V.length;Ge+=3){var tt=V[Ge+Ie];tt>=ne&&tt<=ge&&(Q.push(V[Ge]),Q.push(V[Ge+1]),Q.push(V[Ge+2]))}}function bo(V,Q,ne,ge,Ie,Ge,tt){for(var ce,Le,mt=cu(V),pr=Ie===0?Lr:sn,Lt=V.start,Ft=0;Ft<V.length-3;Ft+=3){var dr=V[Ft],bn=V[Ft+1],pn=V[Ft+2],Pt=V[Ft+3],en=V[Ft+4],zr=Ie===0?dr:bn,Xr=Ie===0?Pt:en,mi=!1;tt&&(ce=Math.sqrt(Math.pow(dr-Pt,2)+Math.pow(bn-en,2))),zr<ne?Xr>ne&&(Le=pr(mt,dr,bn,Pt,en,ne),tt&&(mt.start=Lt+ce*Le)):zr>ge?Xr<ge&&(Le=pr(mt,dr,bn,Pt,en,ge),tt&&(mt.start=Lt+ce*Le)):er(mt,dr,bn,pn),Xr<ne&&zr>=ne&&(Le=pr(mt,dr,bn,Pt,en,ne),mi=!0),Xr>ge&&zr<=ge&&(Le=pr(mt,dr,bn,Pt,en,ge),mi=!0),!Ge&&mi&&(tt&&(mt.end=Lt+ce*Le),Q.push(mt),mt=cu(V)),tt&&(Lt+=ce)}var tn=V.length-3;dr=V[tn],bn=V[tn+1],pn=V[tn+2],(zr=Ie===0?dr:bn)>=ne&&zr<=ge&&er(mt,dr,bn,pn),tn=mt.length-3,Ge&&tn>=3&&(mt[tn]!==mt[0]||mt[tn+1]!==mt[1])&&er(mt,mt[0],mt[1],mt[2]),mt.length&&Q.push(mt)}function cu(V){var Q=[];return Q.size=V.size,Q.start=V.start,Q.end=V.end,Q}function Zt(V,Q,ne,ge,Ie,Ge){for(var tt=0;tt<V.length;tt++)bo(V[tt],Q,ne,ge,Ie,Ge,!1)}function er(V,Q,ne,ge){V.push(Q),V.push(ne),V.push(ge)}function Lr(V,Q,ne,ge,Ie,Ge){var tt=(Ge-Q)/(ge-Q);return V.push(Ge),V.push(ne+(Ie-ne)*tt),V.push(1),tt}function sn(V,Q,ne,ge,Ie,Ge){var tt=(Ge-ne)/(Ie-ne);return V.push(Q+(ge-Q)*tt),V.push(Ge),V.push(1),tt}function On(V,Q){for(var ne=[],ge=0;ge<V.length;ge++){var Ie,Ge=V[ge],tt=Ge.type;if(tt==="Point"||tt==="MultiPoint"||tt==="LineString")Ie=Vn(Ge.geometry,Q);else if(tt==="MultiLineString"||tt==="Polygon"){Ie=[];for(var ce=0;ce<Ge.geometry.length;ce++)Ie.push(Vn(Ge.geometry[ce],Q))}else if(tt==="MultiPolygon")for(Ie=[],ce=0;ce<Ge.geometry.length;ce++){for(var Le=[],mt=0;mt<Ge.geometry[ce].length;mt++)Le.push(Vn(Ge.geometry[ce][mt],Q));Ie.push(Le)}ne.push(Qi(Ge.id,tt,Ie,Ge.tags))}return ne}function Vn(V,Q){var ne=[];ne.size=V.size,V.start!==void 0&&(ne.start=V.start,ne.end=V.end);for(var ge=0;ge<V.length;ge+=3)ne.push(V[ge]+Q,V[ge+1],V[ge+2]);return ne}function bi(V,Q){if(V.transformed)return V;var ne,ge,Ie,Ge=1<<V.z,tt=V.x,ce=V.y;for(ne=0;ne<V.features.length;ne++){var Le=V.features[ne],mt=Le.geometry,pr=Le.type;if(Le.geometry=[],pr===1)for(ge=0;ge<mt.length;ge+=2)Le.geometry.push(vi(mt[ge],mt[ge+1],Q,Ge,tt,ce));else for(ge=0;ge<mt.length;ge++){var Lt=[];for(Ie=0;Ie<mt[ge].length;Ie+=2)Lt.push(vi(mt[ge][Ie],mt[ge][Ie+1],Q,Ge,tt,ce));Le.geometry.push(Lt)}}return V.transformed=!0,V}function vi(V,Q,ne,ge,Ie,Ge){return[Math.round(ne*(V*ge-Ie)),Math.round(ne*(Q*ge-Ge))]}function An(V,Q,ne,ge,Ie){for(var Ge=Q===Ie.maxZoom?0:Ie.tolerance/((1<<Q)*Ie.extent),tt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ne,y:ge,z:Q,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ce=0;ce<V.length;ce++){tt.numFeatures++,Bi(tt,V[ce],Ge,Ie);var Le=V[ce].minX,mt=V[ce].minY,pr=V[ce].maxX,Lt=V[ce].maxY;Le<tt.minX&&(tt.minX=Le),mt<tt.minY&&(tt.minY=mt),pr>tt.maxX&&(tt.maxX=pr),Lt>tt.maxY&&(tt.maxY=Lt)}return tt}function Bi(V,Q,ne,ge){var Ie=Q.geometry,Ge=Q.type,tt=[];if(Ge==="Point"||Ge==="MultiPoint")for(var ce=0;ce<Ie.length;ce+=3)tt.push(Ie[ce]),tt.push(Ie[ce+1]),V.numPoints++,V.numSimplified++;else if(Ge==="LineString")Li(tt,Ie,V,ne,!1,!1);else if(Ge==="MultiLineString"||Ge==="Polygon")for(ce=0;ce<Ie.length;ce++)Li(tt,Ie[ce],V,ne,Ge==="Polygon",ce===0);else if(Ge==="MultiPolygon")for(var Le=0;Le<Ie.length;Le++){var mt=Ie[Le];for(ce=0;ce<mt.length;ce++)Li(tt,mt[ce],V,ne,!0,ce===0)}if(tt.length){var pr=Q.tags||null;if(Ge==="LineString"&&ge.lineMetrics){for(var Lt in pr={},Q.tags)pr[Lt]=Q.tags[Lt];pr.mapbox_clip_start=Ie.start/Ie.size,pr.mapbox_clip_end=Ie.end/Ie.size}var Ft={geometry:tt,type:Ge==="Polygon"||Ge==="MultiPolygon"?3:Ge==="LineString"||Ge==="MultiLineString"?2:1,tags:pr};Q.id!==null&&(Ft.id=Q.id),V.features.push(Ft)}}function Li(V,Q,ne,ge,Ie,Ge){var tt=ge*ge;if(ge>0&&Q.size<(Ie?tt:ge))ne.numPoints+=Q.length/3;else{for(var ce=[],Le=0;Le<Q.length;Le+=3)(ge===0||Q[Le+2]>tt)&&(ne.numSimplified++,ce.push(Q[Le]),ce.push(Q[Le+1])),ne.numPoints++;Ie&&function(mt,pr){for(var Lt=0,Ft=0,dr=mt.length,bn=dr-2;Ft<dr;bn=Ft,Ft+=2)Lt+=(mt[Ft]-mt[bn])*(mt[Ft+1]+mt[bn+1]);if(Lt>0===pr)for(Ft=0,dr=mt.length;Ft<dr/2;Ft+=2){var pn=mt[Ft],Pt=mt[Ft+1];mt[Ft]=mt[dr-2-Ft],mt[Ft+1]=mt[dr-1-Ft],mt[dr-2-Ft]=pn,mt[dr-1-Ft]=Pt}}(ce,Ge),V.push(ce)}}function io(V,Q){var ne=(Q=this.options=function(Ie,Ge){for(var tt in Ge)Ie[tt]=Ge[tt];return Ie}(Object.create(this.options),Q)).debug;if(ne&&console.time("preprocess data"),Q.maxZoom<0||Q.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Q.promoteId&&Q.generateId)throw new Error("promoteId and generateId cannot be used together.");var ge=function(Ie,Ge){var tt=[];if(Ie.type==="FeatureCollection")for(var ce=0;ce<Ie.features.length;ce++)Sa(tt,Ie.features[ce],Ge,ce);else Sa(tt,Ie.type==="Feature"?Ie:{geometry:Ie},Ge);return tt}(V,Q);this.tiles={},this.tileCoords=[],ne&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Q.indexMaxZoom,Q.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(ge=function(Ie,Ge){var tt=Ge.buffer/Ge.extent,ce=Ie,Le=me(Ie,1,-1-tt,tt,0,-1,2,Ge),mt=me(Ie,1,1-tt,2+tt,0,-1,2,Ge);return(Le||mt)&&(ce=me(Ie,1,-tt,1+tt,0,-1,2,Ge)||[],Le&&(ce=On(Le,1).concat(ce)),mt&&(ce=ce.concat(On(mt,-1)))),ce}(ge,Q)).length&&this.splitTile(ge,0,0,0),ne&&(ge.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ys(V,Q,ne){return 32*((1<<V)*ne+Q)+V}function Uo(V,Q){var ne=V.tileID.canonical;if(!this._geoJSONIndex)return Q(null,null);var ge=this._geoJSONIndex.getTile(ne.z,ne.x,ne.y);if(!ge)return Q(null,null);var Ie=new ut(ge.features),Ge=lt(Ie);Ge.byteOffset===0&&Ge.byteLength===Ge.buffer.byteLength||(Ge=new Uint8Array(Ge)),Q(null,{vectorTile:Ie,rawData:Ge.buffer})}wr.prototype.load=function(V){var Q=this.options,ne=Q.log,ge=Q.minZoom,Ie=Q.maxZoom,Ge=Q.nodeSize;ne&&console.time("total time");var tt="prepare "+V.length+" points";ne&&console.time(tt),this.points=V;for(var ce=[],Le=0;Le<V.length;Le++)V[Le].geometry&&ce.push(an(V[Le],Le));this.trees[Ie+1]=new nr(ce,Ei,Ti,Ge,Float32Array),ne&&console.timeEnd(tt);for(var mt=Ie;mt>=ge;mt--){var pr=+Date.now();ce=this._cluster(ce,mt),this.trees[mt]=new nr(ce,Ei,Ti,Ge,Float32Array),ne&&console.log("z%d: %d clusters in %dms",mt,ce.length,+Date.now()-pr)}return ne&&console.timeEnd("total time"),this},wr.prototype.getClusters=function(V,Q){var ne=((V[0]+180)%360+360)%360-180,ge=Math.max(-90,Math.min(90,V[1])),Ie=V[2]===180?180:((V[2]+180)%360+360)%360-180,Ge=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)ne=-180,Ie=180;else if(ne>Ie){var tt=this.getClusters([ne,ge,180,Ge],Q),ce=this.getClusters([-180,ge,Ie,Ge],Q);return tt.concat(ce)}for(var Le=this.trees[this._limitZoom(Q)],mt=[],pr=0,Lt=Le.range(In(ne),ii(Ge),In(Ie),ii(ge));pr<Lt.length;pr+=1){var Ft=Le.points[Lt[pr]];mt.push(Ft.numPoints?Dn(Ft):this.points[Ft.index])}return mt},wr.prototype.getChildren=function(V){var Q=this._getOriginId(V),ne=this._getOriginZoom(V),ge="No cluster with the specified id.",Ie=this.trees[ne];if(!Ie)throw new Error(ge);var Ge=Ie.points[Q];if(!Ge)throw new Error(ge);for(var tt=this.options.radius/(this.options.extent*Math.pow(2,ne-1)),ce=[],Le=0,mt=Ie.within(Ge.x,Ge.y,tt);Le<mt.length;Le+=1){var pr=Ie.points[mt[Le]];pr.parentId===V&&ce.push(pr.numPoints?Dn(pr):this.points[pr.index])}if(ce.length===0)throw new Error(ge);return ce},wr.prototype.getLeaves=function(V,Q,ne){var ge=[];return this._appendLeaves(ge,V,Q=Q||10,ne=ne||0,0),ge},wr.prototype.getTile=function(V,Q,ne){var ge=this.trees[this._limitZoom(V)],Ie=Math.pow(2,V),Ge=this.options,tt=Ge.radius/Ge.extent,ce=(ne-tt)/Ie,Le=(ne+1+tt)/Ie,mt={features:[]};return this._addTileFeatures(ge.range((Q-tt)/Ie,ce,(Q+1+tt)/Ie,Le),ge.points,Q,ne,Ie,mt),Q===0&&this._addTileFeatures(ge.range(1-tt/Ie,ce,1,Le),ge.points,Ie,ne,Ie,mt),Q===Ie-1&&this._addTileFeatures(ge.range(0,ce,tt/Ie,Le),ge.points,-1,ne,Ie,mt),mt.features.length?mt:null},wr.prototype.getClusterExpansionZoom=function(V){for(var Q=this._getOriginZoom(V)-1;Q<=this.options.maxZoom;){var ne=this.getChildren(V);if(Q++,ne.length!==1)break;V=ne[0].properties.cluster_id}return Q},wr.prototype._appendLeaves=function(V,Q,ne,ge,Ie){for(var Ge=0,tt=this.getChildren(Q);Ge<tt.length;Ge+=1){var ce=tt[Ge],Le=ce.properties;if(Le&&Le.cluster?Ie+Le.point_count<=ge?Ie+=Le.point_count:Ie=this._appendLeaves(V,Le.cluster_id,ne,ge,Ie):Ie<ge?Ie++:V.push(ce),V.length===ne)break}return Ie},wr.prototype._addTileFeatures=function(V,Q,ne,ge,Ie,Ge){for(var tt=0,ce=V;tt<ce.length;tt+=1){var Le=Q[ce[tt]],mt=Le.numPoints,pr={type:1,geometry:[[Math.round(this.options.extent*(Le.x*Ie-ne)),Math.round(this.options.extent*(Le.y*Ie-ge))]],tags:mt?jn(Le):this.points[Le.index].properties},Lt=void 0;mt?Lt=Le.id:this.options.generateId?Lt=Le.index:this.points[Le.index].id&&(Lt=this.points[Le.index].id),Lt!==void 0&&(pr.id=Lt),Ge.features.push(pr)}},wr.prototype._limitZoom=function(V){return Math.max(this.options.minZoom,Math.min(+V,this.options.maxZoom+1))},wr.prototype._cluster=function(V,Q){for(var ne=[],ge=this.options,Ie=ge.reduce,Ge=ge.minPoints,tt=ge.radius/(ge.extent*Math.pow(2,Q)),ce=0;ce<V.length;ce++){var Le=V[ce];if(!(Le.zoom<=Q)){Le.zoom=Q;for(var mt=this.trees[Q+1],pr=mt.within(Le.x,Le.y,tt),Lt=Le.numPoints||1,Ft=Lt,dr=0,bn=pr;dr<bn.length;dr+=1){var pn=mt.points[bn[dr]];pn.zoom>Q&&(Ft+=pn.numPoints||1)}if(Ft>=Ge){for(var Pt=Le.x*Lt,en=Le.y*Lt,zr=Ie&&Lt>1?this._map(Le,!0):null,Xr=(ce<<5)+(Q+1)+this.points.length,mi=0,tn=pr;mi<tn.length;mi+=1){var mn=mt.points[tn[mi]];if(!(mn.zoom<=Q)){mn.zoom=Q;var Xi=mn.numPoints||1;Pt+=mn.x*Xi,en+=mn.y*Xi,mn.parentId=Xr,Ie&&(zr||(zr=this._map(Le,!0)),Ie(zr,this._map(mn)))}}Le.parentId=Xr,ne.push(xn(Pt/Ft,en/Ft,Xr,Ft,zr))}else if(ne.push(Le),Ft>1)for(var hi=0,Pi=pr;hi<Pi.length;hi+=1){var _i=mt.points[Pi[hi]];_i.zoom<=Q||(_i.zoom=Q,ne.push(_i))}}}return ne},wr.prototype._getOriginId=function(V){return V-this.points.length>>5},wr.prototype._getOriginZoom=function(V){return(V-this.points.length)%32},wr.prototype._map=function(V,Q){if(V.numPoints)return Q?wi({},V.properties):V.properties;var ne=this.points[V.index].properties,ge=this.options.map(ne);return Q&&ge===ne?wi({},ge):ge},io.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},io.prototype.splitTile=function(V,Q,ne,ge,Ie,Ge,tt){for(var ce=[V,Q,ne,ge],Le=this.options,mt=Le.debug;ce.length;){ge=ce.pop(),ne=ce.pop(),Q=ce.pop(),V=ce.pop();var pr=1<<Q,Lt=ys(Q,ne,ge),Ft=this.tiles[Lt];if(!Ft&&(mt>1&&console.time("creation"),Ft=this.tiles[Lt]=An(V,Q,ne,ge,Le),this.tileCoords.push({z:Q,x:ne,y:ge}),mt)){mt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Q,ne,ge,Ft.numFeatures,Ft.numPoints,Ft.numSimplified),console.timeEnd("creation"));var dr="z"+Q;this.stats[dr]=(this.stats[dr]||0)+1,this.total++}if(Ft.source=V,Ie){if(Q===Le.maxZoom||Q===Ie)continue;var bn=1<<Ie-Q;if(ne!==Math.floor(Ge/bn)||ge!==Math.floor(tt/bn))continue}else if(Q===Le.indexMaxZoom||Ft.numPoints<=Le.indexMaxPoints)continue;if(Ft.source=null,V.length!==0){mt>1&&console.time("clipping");var pn,Pt,en,zr,Xr,mi,tn=.5*Le.buffer/Le.extent,mn=.5-tn,Xi=.5+tn,hi=1+tn;pn=Pt=en=zr=null,Xr=me(V,pr,ne-tn,ne+Xi,0,Ft.minX,Ft.maxX,Le),mi=me(V,pr,ne+mn,ne+hi,0,Ft.minX,Ft.maxX,Le),V=null,Xr&&(pn=me(Xr,pr,ge-tn,ge+Xi,1,Ft.minY,Ft.maxY,Le),Pt=me(Xr,pr,ge+mn,ge+hi,1,Ft.minY,Ft.maxY,Le),Xr=null),mi&&(en=me(mi,pr,ge-tn,ge+Xi,1,Ft.minY,Ft.maxY,Le),zr=me(mi,pr,ge+mn,ge+hi,1,Ft.minY,Ft.maxY,Le),mi=null),mt>1&&console.timeEnd("clipping"),ce.push(pn||[],Q+1,2*ne,2*ge),ce.push(Pt||[],Q+1,2*ne,2*ge+1),ce.push(en||[],Q+1,2*ne+1,2*ge),ce.push(zr||[],Q+1,2*ne+1,2*ge+1)}}},io.prototype.getTile=function(V,Q,ne){var ge=this.options,Ie=ge.extent,Ge=ge.debug;if(V<0||V>24)return null;var tt=1<<V,ce=ys(V,Q=(Q%tt+tt)%tt,ne);if(this.tiles[ce])return bi(this.tiles[ce],Ie);Ge>1&&console.log("drilling down to z%d-%d-%d",V,Q,ne);for(var Le,mt=V,pr=Q,Lt=ne;!Le&&mt>0;)mt--,pr=Math.floor(pr/2),Lt=Math.floor(Lt/2),Le=this.tiles[ys(mt,pr,Lt)];return Le&&Le.source?(Ge>1&&console.log("found parent tile z%d-%d-%d",mt,pr,Lt),Ge>1&&console.time("drilling down"),this.splitTile(Le.source,mt,pr,Lt,V,Q,ne),Ge>1&&console.timeEnd("drilling down"),this.tiles[ce]?bi(this.tiles[ce],Ie):null):null};var Na=function(V){function Q(ne,ge,Ie,Ge){V.call(this,ne,ge,Ie,Uo),Ge&&(this.loadGeoJSON=Ge)}return V&&(Q.__proto__=V),(Q.prototype=Object.create(V&&V.prototype)).constructor=Q,Q.prototype.loadData=function(ne,ge){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=ge,this._pendingLoadDataParams=ne,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},Q.prototype._loadData=function(){var ne=this;if(this._pendingCallback&&this._pendingLoadDataParams){var ge=this._pendingCallback,Ie=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var Ge=!!(Ie&&Ie.request&&Ie.request.collectResourceTiming)&&new g.RequestPerformance(Ie.request);this.loadGeoJSON(Ie,function(tt,ce){if(tt||!ce)return ge(tt);if(typeof ce!="object")return ge(new Error("Input data given to '"+Ie.source+"' is not a valid GeoJSON object."));(function Ft(dr,bn){var pn,Pt=dr&&dr.type;if(Pt==="FeatureCollection")for(pn=0;pn<dr.features.length;pn++)Ft(dr.features[pn],bn);else if(Pt==="GeometryCollection")for(pn=0;pn<dr.geometries.length;pn++)Ft(dr.geometries[pn],bn);else if(Pt==="Feature")Ft(dr.geometry,bn);else if(Pt==="Polygon")tr(dr.coordinates,bn);else if(Pt==="MultiPolygon")for(pn=0;pn<dr.coordinates.length;pn++)tr(dr.coordinates[pn],bn);return dr})(ce,!0);try{if(Ie.filter){var Le=g.createExpression(Ie.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Le.result==="error")throw new Error(Le.value.map(function(Ft){return Ft.key+": "+Ft.message}).join(", "));var mt=ce.features.filter(function(Ft){return Le.value.evaluate({zoom:0},Ft)});ce={type:"FeatureCollection",features:mt}}ne._geoJSONIndex=Ie.cluster?new wr(function(Ft){var dr=Ft.superclusterOptions,bn=Ft.clusterProperties;if(!bn||!dr)return dr;for(var pn={},Pt={},en={accumulated:null,zoom:0},zr={properties:null},Xr=Object.keys(bn),mi=0,tn=Xr;mi<tn.length;mi+=1){var mn=tn[mi],Xi=bn[mn],hi=Xi[0],Pi=g.createExpression(Xi[1]),_i=g.createExpression(typeof hi=="string"?[hi,["accumulated"],["get",mn]]:hi);pn[mn]=Pi.value,Pt[mn]=_i.value}return dr.map=function(dt){zr.properties=dt;for(var It={},Ta=0,Si=Xr;Ta<Si.length;Ta+=1){var Ii=Si[Ta];It[Ii]=pn[Ii].evaluate(en,zr)}return It},dr.reduce=function(dt,It){zr.properties=It;for(var Ta=0,Si=Xr;Ta<Si.length;Ta+=1){var Ii=Si[Ta];en.accumulated=dt[Ii],dt[Ii]=Pt[Ii].evaluate(en,zr)}},dr}(Ie)).load(ce.features):function(Ft,dr){return new io(Ft,dr)}(ce,Ie.geojsonVtOptions)}catch(Ft){return ge(Ft)}ne.loaded={};var pr={};if(Ge){var Lt=Ge.finish();Lt&&(pr.resourceTiming={},pr.resourceTiming[Ie.source]=JSON.parse(JSON.stringify(Lt)))}ge(null,pr)})}},Q.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},Q.prototype.reloadTile=function(ne,ge){var Ie=this.loaded;return Ie&&Ie[ne.uid]?V.prototype.reloadTile.call(this,ne,ge):this.loadTile(ne,ge)},Q.prototype.loadGeoJSON=function(ne,ge){if(ne.request)g.getJSON(ne.request,ge);else{if(typeof ne.data!="string")return ge(new Error("Input data given to '"+ne.source+"' is not a valid GeoJSON object."));try{return ge(null,JSON.parse(ne.data))}catch(Ie){return ge(new Error("Input data given to '"+ne.source+"' is not a valid GeoJSON object."))}}},Q.prototype.removeSource=function(ne,ge){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),ge()},Q.prototype.getClusterExpansionZoom=function(ne,ge){try{ge(null,this._geoJSONIndex.getClusterExpansionZoom(ne.clusterId))}catch(Ie){ge(Ie)}},Q.prototype.getClusterChildren=function(ne,ge){try{ge(null,this._geoJSONIndex.getChildren(ne.clusterId))}catch(Ie){ge(Ie)}},Q.prototype.getClusterLeaves=function(ne,ge){try{ge(null,this._geoJSONIndex.getLeaves(ne.clusterId,ne.limit,ne.offset))}catch(Ie){ge(Ie)}},Q}(st),xa=function(V){var Q=this;this.self=V,this.actor=new g.Actor(V,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:st,geojson:Na},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(ne,ge){if(Q.workerSourceTypes[ne])throw new Error('Worker source with name "'+ne+'" already registered.');Q.workerSourceTypes[ne]=ge},this.self.registerRTLTextPlugin=function(ne){if(g.plugin.isParsed())throw new Error("RTL text plugin already registered.");g.plugin.applyArabicShaping=ne.applyArabicShaping,g.plugin.processBidirectionalText=ne.processBidirectionalText,g.plugin.processStyledBidirectionalText=ne.processStyledBidirectionalText}};return xa.prototype.setReferrer=function(V,Q){this.referrer=Q},xa.prototype.setImages=function(V,Q,ne){for(var ge in this.availableImages[V]=Q,this.workerSources[V]){var Ie=this.workerSources[V][ge];for(var Ge in Ie)Ie[Ge].availableImages=Q}ne()},xa.prototype.setLayers=function(V,Q,ne){this.getLayerIndex(V).replace(Q),ne()},xa.prototype.updateLayers=function(V,Q,ne){this.getLayerIndex(V).update(Q.layers,Q.removedIds),ne()},xa.prototype.loadTile=function(V,Q,ne){this.getWorkerSource(V,Q.type,Q.source).loadTile(Q,ne)},xa.prototype.loadDEMTile=function(V,Q,ne){this.getDEMWorkerSource(V,Q.source).loadTile(Q,ne)},xa.prototype.reloadTile=function(V,Q,ne){this.getWorkerSource(V,Q.type,Q.source).reloadTile(Q,ne)},xa.prototype.abortTile=function(V,Q,ne){this.getWorkerSource(V,Q.type,Q.source).abortTile(Q,ne)},xa.prototype.removeTile=function(V,Q,ne){this.getWorkerSource(V,Q.type,Q.source).removeTile(Q,ne)},xa.prototype.removeDEMTile=function(V,Q){this.getDEMWorkerSource(V,Q.source).removeTile(Q)},xa.prototype.removeSource=function(V,Q,ne){if(this.workerSources[V]&&this.workerSources[V][Q.type]&&this.workerSources[V][Q.type][Q.source]){var ge=this.workerSources[V][Q.type][Q.source];delete this.workerSources[V][Q.type][Q.source],ge.removeSource!==void 0?ge.removeSource(Q,ne):ne()}},xa.prototype.loadWorkerSource=function(V,Q,ne){try{this.self.importScripts(Q.url),ne()}catch(ge){ne(ge.toString())}},xa.prototype.syncRTLPluginState=function(V,Q,ne){try{g.plugin.setState(Q);var ge=g.plugin.getPluginURL();if(g.plugin.isLoaded()&&!g.plugin.isParsed()&&ge!=null){this.self.importScripts(ge);var Ie=g.plugin.isParsed();ne(Ie?void 0:new Error("RTL Text Plugin failed to import scripts from "+ge),Ie)}}catch(Ge){ne(Ge.toString())}},xa.prototype.getAvailableImages=function(V){var Q=this.availableImages[V];return Q||(Q=[]),Q},xa.prototype.getLayerIndex=function(V){var Q=this.layerIndexes[V];return Q||(Q=this.layerIndexes[V]=new ae),Q},xa.prototype.getWorkerSource=function(V,Q,ne){var ge=this;return this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][Q]||(this.workerSources[V][Q]={}),this.workerSources[V][Q][ne]||(this.workerSources[V][Q][ne]=new this.workerSourceTypes[Q]({send:function(Ie,Ge,tt){ge.actor.send(Ie,Ge,tt,V)}},this.getLayerIndex(V),this.getAvailableImages(V))),this.workerSources[V][Q][ne]},xa.prototype.getDEMWorkerSource=function(V,Q){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][Q]||(this.demWorkerSources[V][Q]=new $t),this.demWorkerSources[V][Q]},xa.prototype.enforceCacheSizeLimit=function(V,Q){g.enforceCacheSizeLimit(Q)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new xa(self)),xa}),ue(["./shared"],function(g){"use strict";var Ee=g.createCommonjsModule(function(l){function h(E){return!c(E)}function c(E){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var P,L,Z=new Blob([""],{type:"text/javascript"}),X=URL.createObjectURL(Z);try{L=new Worker(X),P=!0}catch(se){P=!1}return L&&L.terminate(),URL.revokeObjectURL(X),P}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var P=document.createElement("canvas");P.width=P.height=1;var L=P.getContext("2d");if(!L)return!1;var Z=L.getImageData(0,0,1,1);return Z&&Z.width===P.width}()?(d[w=E&&E.failIfMajorPerformanceCaveat]===void 0&&(d[w]=function(P){var L=function(X){var se=document.createElement("canvas"),fe=Object.create(h.webGLContextAttributes);return fe.failIfMajorPerformanceCaveat=X,se.probablySupportsContext?se.probablySupportsContext("webgl",fe)||se.probablySupportsContext("experimental-webgl",fe):se.supportsContext?se.supportsContext("webgl",fe)||se.supportsContext("experimental-webgl",fe):se.getContext("webgl",fe)||se.getContext("experimental-webgl",fe)}(P);if(!L)return!1;var Z=L.createShader(L.VERTEX_SHADER);return!(!Z||L.isContextLost())&&(L.shaderSource(Z,"void main() {}"),L.compileShader(Z),L.getShaderParameter(Z,L.COMPILE_STATUS)===!0)}(w)),d[w]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var w}l.exports?l.exports=h:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=h,window.mapboxgl.notSupportedReason=c);var d={};h.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),H={create:function(l,h,c){var d=g.window.document.createElement(l);return h!==void 0&&(d.className=h),c&&c.appendChild(d),d},createNS:function(l,h){return g.window.document.createElementNS(l,h)}},ae=g.window.document&&g.window.document.documentElement.style;function le(l){if(!ae)return l[0];for(var h=0;h<l.length;h++)if(l[h]in ae)return l[h];return l[0]}var Be,ye=le(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);H.disableDrag=function(){ae&&ye&&(Be=ae[ye],ae[ye]="none")},H.enableDrag=function(){ae&&ye&&(ae[ye]=Be)};var Je=le(["transform","WebkitTransform"]);H.setTransform=function(l,h){l.style[Je]=h};var st=!1;try{var yt=Object.defineProperty({},"passive",{get:function(){st=!0}});g.window.addEventListener("test",yt,yt),g.window.removeEventListener("test",yt,yt)}catch(l){st=!1}H.addEventListener=function(l,h,c,d){d===void 0&&(d={}),l.addEventListener(h,c,"passive"in d&&st?d:d.capture)},H.removeEventListener=function(l,h,c,d){d===void 0&&(d={}),l.removeEventListener(h,c,"passive"in d&&st?d:d.capture)};var $t=function(l){l.preventDefault(),l.stopPropagation(),g.window.removeEventListener("click",$t,!0)};function tr(l){var h=l.userImage;return!!(h&&h.render&&h.render())&&(l.data.replace(new Uint8Array(h.data.buffer)),!0)}H.suppressClick=function(){g.window.addEventListener("click",$t,!0),g.window.setTimeout(function(){g.window.removeEventListener("click",$t,!0)},0)},H.mousePos=function(l,h){var c=l.getBoundingClientRect();return new g.Point(h.clientX-c.left-l.clientLeft,h.clientY-c.top-l.clientTop)},H.touchPos=function(l,h){for(var c=l.getBoundingClientRect(),d=[],E=0;E<h.length;E++)d.push(new g.Point(h[E].clientX-c.left-l.clientLeft,h[E].clientY-c.top-l.clientTop));return d},H.mouseButton=function(l){return g.window.InstallTrigger!==void 0&&l.button===2&&l.ctrlKey&&g.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:l.button},H.remove=function(l){l.parentNode&&l.parentNode.removeChild(l)};var Mt=function(l){function h(){l.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new g.RGBAImage({width:1,height:1}),this.dirty=!0}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.isLoaded=function(){return this.loaded},h.prototype.setLoaded=function(c){if(this.loaded!==c&&(this.loaded=c,c)){for(var d=0,E=this.requestors;d<E.length;d+=1){var w=E[d];this._notify(w.ids,w.callback)}this.requestors=[]}},h.prototype.getImage=function(c){return this.images[c]},h.prototype.addImage=function(c,d){this._validate(c,d)&&(this.images[c]=d)},h.prototype._validate=function(c,d){var E=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new g.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchX" value'))),E=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new g.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchY" value'))),E=!1),this._validateContent(d.content,d)||(this.fire(new g.ErrorEvent(new Error('Image "'+c+'" has invalid "content" value'))),E=!1),E},h.prototype._validateStretch=function(c,d){if(!c)return!0;for(var E=0,w=0,P=c;w<P.length;w+=1){var L=P[w];if(L[0]<E||L[1]<L[0]||d<L[1])return!1;E=L[1]}return!0},h.prototype._validateContent=function(c,d){return!(c&&(c.length!==4||c[0]<0||d.data.width<c[0]||c[1]<0||d.data.height<c[1]||c[2]<0||d.data.width<c[2]||c[3]<0||d.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))},h.prototype.updateImage=function(c,d){d.version=this.images[c].version+1,this.images[c]=d,this.updatedImages[c]=!0},h.prototype.removeImage=function(c){var d=this.images[c];delete this.images[c],delete this.patterns[c],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()},h.prototype.listImages=function(){return Object.keys(this.images)},h.prototype.getImages=function(c,d){var E=!0;if(!this.isLoaded())for(var w=0,P=c;w<P.length;w+=1)this.images[P[w]]||(E=!1);this.isLoaded()||E?this._notify(c,d):this.requestors.push({ids:c,callback:d})},h.prototype._notify=function(c,d){for(var E={},w=0,P=c;w<P.length;w+=1){var L=P[w];this.images[L]||this.fire(new g.Event("styleimagemissing",{id:L}));var Z=this.images[L];Z?E[L]={data:Z.data.clone(),pixelRatio:Z.pixelRatio,sdf:Z.sdf,version:Z.version,stretchX:Z.stretchX,stretchY:Z.stretchY,content:Z.content,hasRenderCallback:Boolean(Z.userImage&&Z.userImage.render)}:g.warnOnce('Image "'+L+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}d(null,E)},h.prototype.getPixelSize=function(){var c=this.atlasImage;return{width:c.width,height:c.height}},h.prototype.getPattern=function(c){var d=this.patterns[c],E=this.getImage(c);if(!E)return null;if(d&&d.position.version===E.version)return d.position;if(d)d.position.version=E.version;else{var w={w:E.data.width+2,h:E.data.height+2,x:0,y:0},P=new g.ImagePosition(w,E);this.patterns[c]={bin:w,position:P}}return this._updatePatternAtlas(),this.patterns[c].position},h.prototype.bind=function(c){var d=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new g.Texture(c,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)},h.prototype._updatePatternAtlas=function(){var c=[];for(var d in this.patterns)c.push(this.patterns[d].bin);var E=g.potpack(c),w=E.w,P=E.h,L=this.atlasImage;for(var Z in L.resize({width:w||1,height:P||1}),this.patterns){var X=this.patterns[Z].bin,se=X.x+1,fe=X.y+1,de=this.images[Z].data,ke=de.width,Oe=de.height;g.RGBAImage.copy(de,L,{x:0,y:0},{x:se,y:fe},{width:ke,height:Oe}),g.RGBAImage.copy(de,L,{x:0,y:Oe-1},{x:se,y:fe-1},{width:ke,height:1}),g.RGBAImage.copy(de,L,{x:0,y:0},{x:se,y:fe+Oe},{width:ke,height:1}),g.RGBAImage.copy(de,L,{x:ke-1,y:0},{x:se-1,y:fe},{width:1,height:Oe}),g.RGBAImage.copy(de,L,{x:0,y:0},{x:se+ke,y:fe},{width:1,height:Oe})}this.dirty=!0},h.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},h.prototype.dispatchRenderCallbacks=function(c){for(var d=0,E=c;d<E.length;d+=1){var w=E[d];if(!this.callbackDispatchedThisFrame[w]){this.callbackDispatchedThisFrame[w]=!0;var P=this.images[w];tr(P)&&this.updateImage(w,P)}}},h}(g.Evented),Qt=pt,Bt=pt,ut=1e20;function pt(l,h,c,d,E,w){this.fontSize=l||24,this.buffer=h===void 0?3:h,this.cutoff=d||.25,this.fontFamily=E||"sans-serif",this.fontWeight=w||"normal",this.radius=c||8;var P=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=P,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(P*P),this.gridInner=new Float64Array(P*P),this.f=new Float64Array(P),this.d=new Float64Array(P),this.z=new Float64Array(P+1),this.v=new Int16Array(P),this.middle=Math.round(P/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function rr(l,h,c,d,E,w,P){for(var L=0;L<h;L++){for(var Z=0;Z<c;Z++)d[Z]=l[Z*h+L];for(K(d,E,w,P,c),Z=0;Z<c;Z++)l[Z*h+L]=E[Z]}for(Z=0;Z<c;Z++){for(L=0;L<h;L++)d[L]=l[Z*h+L];for(K(d,E,w,P,h),L=0;L<h;L++)l[Z*h+L]=Math.sqrt(E[L])}}function K(l,h,c,d,E){c[0]=0,d[0]=-ut,d[1]=+ut;for(var w=1,P=0;w<E;w++){for(var L=(l[w]+w*w-(l[c[P]]+c[P]*c[P]))/(2*w-2*c[P]);L<=d[P];)P--,L=(l[w]+w*w-(l[c[P]]+c[P]*c[P]))/(2*w-2*c[P]);c[++P]=w,d[P]=L,d[P+1]=+ut}for(w=0,P=0;w<E;w++){for(;d[P+1]<w;)P++;h[w]=(w-c[P])*(w-c[P])+l[c[P]]}}pt.prototype.draw=function(l){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(l,this.buffer,this.middle);for(var h=this.ctx.getImageData(0,0,this.size,this.size),c=new Uint8ClampedArray(this.size*this.size),d=0;d<this.size*this.size;d++){var E=h.data[4*d+3]/255;this.gridOuter[d]=E===1?0:E===0?ut:Math.pow(Math.max(0,.5-E),2),this.gridInner[d]=E===1?ut:E===0?0:Math.pow(Math.max(0,E-.5),2)}for(rr(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),rr(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),d=0;d<this.size*this.size;d++)c[d]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[d]-this.gridInner[d])/this.radius+this.cutoff))));return c},Qt.default=Bt;var Xt=function(l,h){this.requestManager=l,this.localIdeographFontFamily=h,this.entries={}};Xt.prototype.setURL=function(l){this.url=l},Xt.prototype.getGlyphs=function(l,h){var c=this,d=[];for(var E in l)for(var w=0,P=l[E];w<P.length;w+=1)d.push({stack:E,id:P[w]});g.asyncAll(d,function(L,Z){var X=L.stack,se=L.id,fe=c.entries[X];fe||(fe=c.entries[X]={glyphs:{},requests:{},ranges:{}});var de=fe.glyphs[se];if(de===void 0){if(de=c._tinySDF(fe,X,se))return fe.glyphs[se]=de,void Z(null,{stack:X,id:se,glyph:de});var ke=Math.floor(se/256);if(256*ke>65535)Z(new Error("glyphs > 65535 not supported"));else if(fe.ranges[ke])Z(null,{stack:X,id:se,glyph:de});else{var Oe=fe.requests[ke];Oe||(Oe=fe.requests[ke]=[],Xt.loadGlyphRange(X,ke,c.url,c.requestManager,function(ze,Ce){if(Ce){for(var je in Ce)c._doesCharSupportLocalGlyph(+je)||(fe.glyphs[+je]=Ce[+je]);fe.ranges[ke]=!0}for(var Qe=0,gt=Oe;Qe<gt.length;Qe+=1)(0,gt[Qe])(ze,Ce);delete fe.requests[ke]})),Oe.push(function(ze,Ce){ze?Z(ze):Ce&&Z(null,{stack:X,id:se,glyph:Ce[se]||null})})}}else Z(null,{stack:X,id:se,glyph:de})},function(L,Z){if(L)h(L);else if(Z){for(var X={},se=0,fe=Z;se<fe.length;se+=1){var de=fe[se],ke=de.stack,Oe=de.id,ze=de.glyph;(X[ke]||(X[ke]={}))[Oe]=ze&&{id:ze.id,bitmap:ze.bitmap.clone(),metrics:ze.metrics}}h(null,X)}})},Xt.prototype._doesCharSupportLocalGlyph=function(l){return!!this.localIdeographFontFamily&&(g.isChar["CJK Unified Ideographs"](l)||g.isChar["Hangul Syllables"](l)||g.isChar.Hiragana(l)||g.isChar.Katakana(l))},Xt.prototype._tinySDF=function(l,h,c){var d=this.localIdeographFontFamily;if(d&&this._doesCharSupportLocalGlyph(c)){var E=l.tinySDF;if(!E){var w="400";/bold/i.test(h)?w="900":/medium/i.test(h)?w="500":/light/i.test(h)&&(w="200"),E=l.tinySDF=new Xt.TinySDF(24,3,8,.25,d,w)}return{id:c,bitmap:new g.AlphaImage({width:30,height:30},E.draw(String.fromCharCode(c))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},Xt.loadGlyphRange=function(l,h,c,d,E){var w=256*h,P=w+255,L=d.transformRequest(d.normalizeGlyphsURL(c).replace("{fontstack}",l).replace("{range}",w+"-"+P),g.ResourceType.Glyphs);g.getArrayBuffer(L,function(Z,X){if(Z)E(Z);else if(X){for(var se={},fe=0,de=g.parseGlyphPBF(X);fe<de.length;fe+=1){var ke=de[fe];se[ke.id]=ke}E(null,se)}})},Xt.TinySDF=Qt;var lt=function(){this.specification=g.styleSpec.light.position};lt.prototype.possiblyEvaluate=function(l,h){return g.sphericalToCartesian(l.expression.evaluate(h))},lt.prototype.interpolate=function(l,h,c){return{x:g.number(l.x,h.x,c),y:g.number(l.y,h.y,c),z:g.number(l.z,h.z,c)}};var $e=new g.Properties({anchor:new g.DataConstantProperty(g.styleSpec.light.anchor),position:new lt,color:new g.DataConstantProperty(g.styleSpec.light.color),intensity:new g.DataConstantProperty(g.styleSpec.light.intensity)}),St=function(l){function h(c){l.call(this),this._transitionable=new g.Transitionable($e),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getLight=function(){return this._transitionable.serialize()},h.prototype.setLight=function(c,d){if(d===void 0&&(d={}),!this._validate(g.validateLight,c,d))for(var E in c){var w=c[E];g.endsWith(E,"-transition")?this._transitionable.setTransition(E.slice(0,-"-transition".length),w):this._transitionable.setValue(E,w)}},h.prototype.updateTransitions=function(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)},h.prototype.hasTransition=function(){return this._transitioning.hasTransition()},h.prototype.recalculate=function(c){this.properties=this._transitioning.possiblyEvaluate(c)},h.prototype._validate=function(c,d,E){return(!E||E.validate!==!1)&&g.emitValidationErrors(this,c.call(g.validateStyle,g.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:g.styleSpec})))},h}(g.Evented),et=function(l,h){this.width=l,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};et.prototype.getDash=function(l,h){var c=l.join(",")+String(h);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(l,h)),this.dashEntry[c]},et.prototype.getDashRanges=function(l,h,c){var d=[],E=l.length%2==1?-l[l.length-1]*c:0,w=l[0]*c,P=!0;d.push({left:E,right:w,isDash:P,zeroLength:l[0]===0});for(var L=l[0],Z=1;Z<l.length;Z++){var X=l[Z];d.push({left:E=L*c,right:w=(L+=X)*c,isDash:P=!P,zeroLength:X===0})}return d},et.prototype.addRoundDash=function(l,h,c){for(var d=h/2,E=-c;E<=c;E++)for(var w=this.width*(this.nextRow+c+E),P=0,L=l[P],Z=0;Z<this.width;Z++){Z/L.right>1&&(L=l[++P]);var X=Math.abs(Z-L.left),se=Math.abs(Z-L.right),fe=Math.min(X,se),de=void 0,ke=E/c*(d+1);if(L.isDash){var Oe=d-Math.abs(ke);de=Math.sqrt(fe*fe+Oe*Oe)}else de=d-Math.sqrt(fe*fe+ke*ke);this.data[w+Z]=Math.max(0,Math.min(255,de+128))}},et.prototype.addRegularDash=function(l){for(var h=l.length-1;h>=0;--h){var c=l[h],d=l[h+1];c.zeroLength?l.splice(h,1):d&&d.isDash===c.isDash&&(d.left=c.left,l.splice(h,1))}var E=l[0],w=l[l.length-1];E.isDash===w.isDash&&(E.left=w.left-this.width,w.right=E.right+this.width);for(var P=this.width*this.nextRow,L=0,Z=l[L],X=0;X<this.width;X++){X/Z.right>1&&(Z=l[++L]);var se=Math.abs(X-Z.left),fe=Math.abs(X-Z.right),de=Math.min(se,fe);this.data[P+X]=Math.max(0,Math.min(255,(Z.isDash?de:-de)+128))}},et.prototype.addDash=function(l,h){var c=h?7:0,d=2*c+1;if(this.nextRow+d>this.height)return g.warnOnce("LineAtlas out of space"),null;for(var E=0,w=0;w<l.length;w++)E+=l[w];if(E!==0){var P=this.width/E,L=this.getDashRanges(l,this.width,P);h?this.addRoundDash(L,P,c):this.addRegularDash(L)}var Z={y:(this.nextRow+c+.5)/this.height,height:2*c/this.height,width:E};return this.nextRow+=d,this.dirty=!0,Z},et.prototype.bind=function(l){var h=l.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))};var Ht=function l(h,c){this.workerPool=h,this.actors=[],this.currentActor=0,this.id=g.uniqueId();for(var d=this.workerPool.acquire(this.id),E=0;E<d.length;E++){var w=new l.Actor(d[E],c,this.id);w.name="Worker "+E,this.actors.push(w)}};function Er(l,h,c){var d=function(E,w){if(E)return c(E);if(w){var P=g.pick(g.extend(w,l),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);w.vector_layers&&(P.vectorLayers=w.vector_layers,P.vectorLayerIds=P.vectorLayers.map(function(L){return L.id})),P.tiles=h.canonicalizeTileset(P,l.url),c(null,P)}};return l.url?g.getJSON(h.transformRequest(h.normalizeSourceURL(l.url),g.ResourceType.Source),d):g.browser.frame(function(){return d(null,l)})}Ht.prototype.broadcast=function(l,h,c){g.asyncAll(this.actors,function(d,E){d.send(l,h,E)},c=c||function(){})},Ht.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Ht.prototype.remove=function(){this.actors.forEach(function(l){l.remove()}),this.actors=[],this.workerPool.release(this.id)},Ht.Actor=g.Actor;var kr=function(l,h,c){this.bounds=g.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=h||0,this.maxzoom=c||24};kr.prototype.validateBounds=function(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]},kr.prototype.contains=function(l){var h=Math.pow(2,l.z),c=Math.floor(g.mercatorXfromLng(this.bounds.getWest())*h),d=Math.floor(g.mercatorYfromLat(this.bounds.getNorth())*h),E=Math.ceil(g.mercatorXfromLng(this.bounds.getEast())*h),w=Math.ceil(g.mercatorYfromLat(this.bounds.getSouth())*h);return l.x>=c&&l.x<E&&l.y>=d&&l.y<w};var $r=function(l){function h(c,d,E,w){if(l.call(this),this.id=c,this.dispatcher=E,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,g.extend(this,g.pick(d,["url","scheme","tileSize","promoteId"])),this._options=g.extend({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new g.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Er(this._options,this.map._requestManager,function(d,E){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new g.ErrorEvent(d)):E&&(g.extend(c,E),E.bounds&&(c.tileBounds=new kr(E.bounds,c.minzoom,c.maxzoom)),g.postTurnstileEvent(E.tiles,c.map._requestManager._customAccessToken),g.postMapLoadEvent(E.tiles,c.map._getMapId(),c.map._requestManager._skuToken,c.map._requestManager._customAccessToken),c.fire(new g.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new g.Event("data",{dataType:"source",sourceDataType:"content"})))})},h.prototype.loaded=function(){return this._loaded},h.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},h.prototype.onAdd=function(c){this.map=c,this.load()},h.prototype.setSourceProperty=function(c){this._tileJSONRequest&&this._tileJSONRequest.cancel(),c(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},h.prototype.setTiles=function(c){var d=this;return this.setSourceProperty(function(){d._options.tiles=c}),this},h.prototype.setUrl=function(c){var d=this;return this.setSourceProperty(function(){d.url=c,d._options.url=c}),this},h.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},h.prototype.serialize=function(){return g.extend({},this._options)},h.prototype.loadTile=function(c,d){var E=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),w={request:this.map._requestManager.transformRequest(E,g.ResourceType.Tile),uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:g.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function P(L,Z){return delete c.request,c.aborted?d(null):L&&L.status!==404?d(L):(Z&&Z.resourceTiming&&(c.resourceTiming=Z.resourceTiming),this.map._refreshExpiredTiles&&Z&&c.setExpiryData(Z),c.loadVectorData(Z,this.map.painter),g.cacheEntryPossiblyAdded(this.dispatcher),d(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}w.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired"?c.state==="loading"?c.reloadCallback=d:c.request=c.actor.send("reloadTile",w,P.bind(this)):(c.actor=this.dispatcher.getActor(),c.request=c.actor.send("loadTile",w,P.bind(this)))},h.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id},void 0)},h.prototype.unloadTile=function(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id},void 0)},h.prototype.hasTransition=function(){return!1},h}(g.Evented),S=function(l){function h(c,d,E,w){l.call(this),this.id=c,this.dispatcher=E,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=g.extend({type:"raster"},d),g.extend(this,g.pick(d,["url","scheme","tileSize"]))}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new g.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Er(this._options,this.map._requestManager,function(d,E){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new g.ErrorEvent(d)):E&&(g.extend(c,E),E.bounds&&(c.tileBounds=new kr(E.bounds,c.minzoom,c.maxzoom)),g.postTurnstileEvent(E.tiles),g.postMapLoadEvent(E.tiles,c.map._getMapId(),c.map._requestManager._skuToken),c.fire(new g.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new g.Event("data",{dataType:"source",sourceDataType:"content"})))})},h.prototype.loaded=function(){return this._loaded},h.prototype.onAdd=function(c){this.map=c,this.load()},h.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},h.prototype.serialize=function(){return g.extend({},this._options)},h.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},h.prototype.loadTile=function(c,d){var E=this,w=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);c.request=g.getImage(this.map._requestManager.transformRequest(w,g.ResourceType.Tile),function(P,L){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(P)c.state="errored",d(P);else if(L){E.map._refreshExpiredTiles&&c.setExpiryData(L),delete L.cacheControl,delete L.expires;var Z=E.map.painter.context,X=Z.gl;c.texture=E.map.painter.getTileTexture(L.width),c.texture?c.texture.update(L,{useMipmap:!0}):(c.texture=new g.Texture(Z,L,X.RGBA,{useMipmap:!0}),c.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE,X.LINEAR_MIPMAP_NEAREST),Z.extTextureFilterAnisotropic&&X.texParameterf(X.TEXTURE_2D,Z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Z.extTextureFilterAnisotropicMax)),c.state="loaded",g.cacheEntryPossiblyAdded(E.dispatcher),d(null)}})},h.prototype.abortTile=function(c,d){c.request&&(c.request.cancel(),delete c.request),d()},h.prototype.unloadTile=function(c,d){c.texture&&this.map.painter.saveTileTexture(c.texture),d()},h.prototype.hasTransition=function(){return!1},h}(g.Evented),pe=function(l){function h(c,d,E,w){l.call(this,c,d,E,w),this.type="raster-dem",this.maxzoom=22,this._options=g.extend({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox"}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},h.prototype.loadTile=function(c,d){var E=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function w(P,L){P&&(c.state="errored",d(P)),L&&(c.dem=L,c.needsHillshadePrepare=!0,c.state="loaded",d(null))}c.request=g.getImage(this.map._requestManager.transformRequest(E,g.ResourceType.Tile),function(P,L){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(P)c.state="errored",d(P);else if(L){this.map._refreshExpiredTiles&&c.setExpiryData(L),delete L.cacheControl,delete L.expires;var Z=g.window.ImageBitmap&&L instanceof g.window.ImageBitmap&&g.offscreenCanvasSupported()?L:g.browser.getImageData(L,1),X={uid:c.uid,coord:c.tileID,source:this.id,rawImageData:Z,encoding:this.encoding};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",X,w.bind(this)))}}.bind(this)),c.neighboringTiles=this._getNeighboringTiles(c.tileID)},h.prototype._getNeighboringTiles=function(c){var d=c.canonical,E=Math.pow(2,d.z),w=(d.x-1+E)%E,P=d.x===0?c.wrap-1:c.wrap,L=(d.x+1+E)%E,Z=d.x+1===E?c.wrap+1:c.wrap,X={};return X[new g.OverscaledTileID(c.overscaledZ,P,d.z,w,d.y).key]={backfilled:!1},X[new g.OverscaledTileID(c.overscaledZ,Z,d.z,L,d.y).key]={backfilled:!1},d.y>0&&(X[new g.OverscaledTileID(c.overscaledZ,P,d.z,w,d.y-1).key]={backfilled:!1},X[new g.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},X[new g.OverscaledTileID(c.overscaledZ,Z,d.z,L,d.y-1).key]={backfilled:!1}),d.y+1<E&&(X[new g.OverscaledTileID(c.overscaledZ,P,d.z,w,d.y+1).key]={backfilled:!1},X[new g.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},X[new g.OverscaledTileID(c.overscaledZ,Z,d.z,L,d.y+1).key]={backfilled:!1}),X},h.prototype.unloadTile=function(c){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded",c.actor&&c.actor.send("removeDEMTile",{uid:c.uid,source:this.id})},h}(S),he=function(l){function h(c,d,E,w){l.call(this),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=E.getActor(),this.setEventedParent(w),this._data=d.data,this._options=g.extend({},d),this._collectResourceTiming=d.collectResourceTiming,this._resourceTiming=[],d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;var P=g.EXTENT/this.tileSize;this.workerOptions=g.extend({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*P,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*P,extent:g.EXTENT,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?Math.min(d.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:g.EXTENT,radius:(d.clusterRadius||50)*P,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.load=function(){var c=this;this.fire(new g.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(d){if(d)c.fire(new g.ErrorEvent(d));else{var E={dataType:"source",sourceDataType:"metadata"};c._collectResourceTiming&&c._resourceTiming&&c._resourceTiming.length>0&&(E.resourceTiming=c._resourceTiming,c._resourceTiming=[]),c.fire(new g.Event("data",E))}})},h.prototype.onAdd=function(c){this.map=c,this.load()},h.prototype.setData=function(c){var d=this;return this._data=c,this.fire(new g.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(E){if(E)d.fire(new g.ErrorEvent(E));else{var w={dataType:"source",sourceDataType:"content"};d._collectResourceTiming&&d._resourceTiming&&d._resourceTiming.length>0&&(w.resourceTiming=d._resourceTiming,d._resourceTiming=[]),d.fire(new g.Event("data",w))}}),this},h.prototype.getClusterExpansionZoom=function(c,d){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id},d),this},h.prototype.getClusterChildren=function(c,d){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id},d),this},h.prototype.getClusterLeaves=function(c,d,E,w){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:c,limit:d,offset:E},w),this},h.prototype._updateWorkerData=function(c){var d=this;this._loaded=!1;var E=g.extend({},this.workerOptions),w=this._data;typeof w=="string"?(E.request=this.map._requestManager.transformRequest(g.browser.resolveURL(w),g.ResourceType.Source),E.request.collectResourceTiming=this._collectResourceTiming):E.data=JSON.stringify(w),this.actor.send(this.type+".loadData",E,function(P,L){d._removed||L&&L.abandoned||(d._loaded=!0,L&&L.resourceTiming&&L.resourceTiming[d.id]&&(d._resourceTiming=L.resourceTiming[d.id].slice(0)),d.actor.send(d.type+".coalesce",{source:E.source},null),c(P))})},h.prototype.loaded=function(){return this._loaded},h.prototype.loadTile=function(c,d){var E=this,w=c.actor?"reloadTile":"loadTile";c.actor=this.actor,c.request=this.actor.send(w,{type:this.type,uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:g.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(P,L){return delete c.request,c.unloadVectorData(),c.aborted?d(null):P?d(P):(c.loadVectorData(L,E.map.painter,w==="reloadTile"),d(null))})},h.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0},h.prototype.unloadTile=function(c){c.unloadVectorData(),this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})},h.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},h.prototype.serialize=function(){return g.extend({},this._options,{type:this.type,data:this._data})},h.prototype.hasTransition=function(){return!1},h}(g.Evented),He=g.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),Ke=function(l){function h(c,d,E,w){l.call(this),this.id=c,this.dispatcher=E,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(w),this.options=d}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.load=function(c,d){var E=this;this._loaded=!1,this.fire(new g.Event("dataloading",{dataType:"source"})),this.url=this.options.url,g.getImage(this.map._requestManager.transformRequest(this.url,g.ResourceType.Image),function(w,P){E._loaded=!0,w?E.fire(new g.ErrorEvent(w)):P&&(E.image=P,c&&(E.coordinates=c),d&&d(),E._finishLoading())})},h.prototype.loaded=function(){return this._loaded},h.prototype.updateImage=function(c){var d=this;return this.image&&c.url?(this.options.url=c.url,this.load(c.coordinates,function(){d.texture=null}),this):this},h.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new g.Event("data",{dataType:"source",sourceDataType:"metadata"})))},h.prototype.onAdd=function(c){this.map=c,this.load()},h.prototype.setCoordinates=function(c){var d=this;this.coordinates=c;var E=c.map(g.MercatorCoordinate.fromLngLat);this.tileID=function(P){for(var L=1/0,Z=1/0,X=-1/0,se=-1/0,fe=0,de=P;fe<de.length;fe+=1){var ke=de[fe];L=Math.min(L,ke.x),Z=Math.min(Z,ke.y),X=Math.max(X,ke.x),se=Math.max(se,ke.y)}var Oe=Math.max(X-L,se-Z),ze=Math.max(0,Math.floor(-Math.log(Oe)/Math.LN2)),Ce=Math.pow(2,ze);return new g.CanonicalTileID(ze,Math.floor((L+X)/2*Ce),Math.floor((Z+se)/2*Ce))}(E),this.minzoom=this.maxzoom=this.tileID.z;var w=E.map(function(P){return d.tileID.getTilePoint(P)._round()});return this._boundsArray=new g.StructArrayLayout4i8,this._boundsArray.emplaceBack(w[0].x,w[0].y,0,0),this._boundsArray.emplaceBack(w[1].x,w[1].y,g.EXTENT,0),this._boundsArray.emplaceBack(w[3].x,w[3].y,0,g.EXTENT),this._boundsArray.emplaceBack(w[2].x,w[2].y,g.EXTENT,g.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new g.Event("data",{dataType:"source",sourceDataType:"content"})),this},h.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var c=this.map.painter.context,d=c.gl;for(var E in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,He.members)),this.boundsSegments||(this.boundsSegments=g.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new g.Texture(c,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[E];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},h.prototype.loadTile=function(c,d){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},d(null)):(c.state="errored",d(null))},h.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},h.prototype.hasTransition=function(){return!1},h}(g.Evented),it=function(l){function h(c,d,E,w){l.call(this,c,d,E,w),this.roundZoom=!0,this.type="video",this.options=d}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.load=function(){var c=this;this._loaded=!1;var d=this.options;this.urls=[];for(var E=0,w=d.urls;E<w.length;E+=1)this.urls.push(this.map._requestManager.transformRequest(w[E],g.ResourceType.Source).url);g.getVideo(this.urls,function(P,L){c._loaded=!0,P?c.fire(new g.ErrorEvent(P)):L&&(c.video=L,c.video.loop=!0,c.video.addEventListener("playing",function(){c.map.triggerRepaint()}),c.map&&c.video.play(),c._finishLoading())})},h.prototype.pause=function(){this.video&&this.video.pause()},h.prototype.play=function(){this.video&&this.video.play()},h.prototype.seek=function(c){if(this.video){var d=this.video.seekable;c<d.start(0)||c>d.end(0)?this.fire(new g.ErrorEvent(new g.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+d.start(0)+" and "+d.end(0)+"-second mark."))):this.video.currentTime=c}},h.prototype.getVideo=function(){return this.video},h.prototype.onAdd=function(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},h.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var c=this.map.painter.context,d=c.gl;for(var E in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,He.members)),this.boundsSegments||(this.boundsSegments=g.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new g.Texture(c,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[E];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},h.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},h.prototype.hasTransition=function(){return this.video&&!this.video.paused},h}(Ke),bt=function(l){function h(c,d,E,w){l.call(this,c,d,E,w),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(function(P){return!Array.isArray(P)||P.length!==2||P.some(function(L){return typeof L!="number"})})||this.fire(new g.ErrorEvent(new g.ValidationError("sources."+c,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new g.ErrorEvent(new g.ValidationError("sources."+c,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new g.ErrorEvent(new g.ValidationError("sources."+c,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof g.window.HTMLCanvasElement||this.fire(new g.ErrorEvent(new g.ValidationError("sources."+c,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new g.ErrorEvent(new g.ValidationError("sources."+c,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof g.window.HTMLCanvasElement?this.options.canvas:g.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new g.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},h.prototype.getCanvas=function(){return this.canvas},h.prototype.onAdd=function(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()},h.prototype.onRemove=function(){this.pause()},h.prototype.prepare=function(){var c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var d=this.map.painter.context,E=d.gl;for(var w in this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,He.members)),this.boundsSegments||(this.boundsSegments=g.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new g.Texture(d,this.canvas,E.RGBA,{premultiply:!0}),this.tiles){var P=this.tiles[w];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture)}}},h.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},h.prototype.hasTransition=function(){return this._playing},h.prototype._hasInvalidDimensions=function(){for(var c=0,d=[this.canvas.width,this.canvas.height];c<d.length;c+=1){var E=d[c];if(isNaN(E)||E<=0)return!0}return!1},h}(Ke),nr={vector:$r,raster:S,"raster-dem":pe,geojson:he,video:it,image:Ke,canvas:bt};function Nr(l,h){var c=g.identity([]);return g.translate(c,c,[1,1,0]),g.scale(c,c,[.5*l.width,.5*l.height,1]),g.multiply(c,c,l.calculatePosMatrix(h.toUnwrapped()))}function wr(l,h,c,d,E,w){var P=function(ze,Ce,je){if(ze)for(var Qe=0,gt=ze;Qe<gt.length;Qe+=1){var Gt=Ce[gt[Qe]];if(Gt&&Gt.source===je&&Gt.type==="fill-extrusion")return!0}else for(var Ut in Ce){var Yt=Ce[Ut];if(Yt.source===je&&Yt.type==="fill-extrusion")return!0}return!1}(E&&E.layers,h,l.id),L=w.maxPitchScaleFactor(),Z=l.tilesIn(d,L,P);Z.sort(xn);for(var X=[],se=0,fe=Z;se<fe.length;se+=1){var de=fe[se];X.push({wrappedTileID:de.tileID.wrapped().key,queryResults:de.tile.queryRenderedFeatures(h,c,l._state,de.queryGeometry,de.cameraQueryGeometry,de.scale,E,w,L,Nr(l.transform,de.tileID))})}var ke=function(ze){for(var Ce={},je={},Qe=0,gt=ze;Qe<gt.length;Qe+=1){var Gt=gt[Qe],Ut=Gt.queryResults,Yt=Gt.wrappedTileID,vr=je[Yt]=je[Yt]||{};for(var Dr in Ut)for(var _r=Ut[Dr],ln=vr[Dr]=vr[Dr]||{},Gn=Ce[Dr]=Ce[Dr]||[],Hn=0,Bn=_r;Hn<Bn.length;Hn+=1){var Di=Bn[Hn];ln[Di.featureIndex]||(ln[Di.featureIndex]=!0,Gn.push(Di))}}return Ce}(X);for(var Oe in ke)ke[Oe].forEach(function(ze){var Ce=ze.feature,je=l.getFeatureState(Ce.layer["source-layer"],Ce.id);Ce.source=Ce.layer.source,Ce.layer["source-layer"]&&(Ce.sourceLayer=Ce.layer["source-layer"]),Ce.state=je});return ke}function xn(l,h){var c=l.tileID,d=h.tileID;return c.overscaledZ-d.overscaledZ||c.canonical.y-d.canonical.y||c.wrap-d.wrap||c.canonical.x-d.canonical.x}var an=function(l,h){this.max=l,this.onRemove=h,this.reset()};an.prototype.reset=function(){for(var l in this.data)for(var h=0,c=this.data[l];h<c.length;h+=1){var d=c[h];d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value)}return this.data={},this.order=[],this},an.prototype.add=function(l,h,c){var d=this,E=l.wrapped().key;this.data[E]===void 0&&(this.data[E]=[]);var w={value:h,timeout:void 0};if(c!==void 0&&(w.timeout=setTimeout(function(){d.remove(l,w)},c)),this.data[E].push(w),this.order.push(E),this.order.length>this.max){var P=this._getAndRemoveByKey(this.order[0]);P&&this.onRemove(P)}return this},an.prototype.has=function(l){return l.wrapped().key in this.data},an.prototype.getAndRemove=function(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null},an.prototype._getAndRemoveByKey=function(l){var h=this.data[l].shift();return h.timeout&&clearTimeout(h.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),h.value},an.prototype.getByKey=function(l){var h=this.data[l];return h?h[0].value:null},an.prototype.get=function(l){return this.has(l)?this.data[l.wrapped().key][0].value:null},an.prototype.remove=function(l,h){if(!this.has(l))return this;var c=l.wrapped().key,d=h===void 0?0:this.data[c].indexOf(h),E=this.data[c][d];return this.data[c].splice(d,1),E.timeout&&clearTimeout(E.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(E.value),this.order.splice(this.order.indexOf(c),1),this},an.prototype.setMaxSize=function(l){for(this.max=l;this.order.length>this.max;){var h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this},an.prototype.filter=function(l){var h=[];for(var c in this.data)for(var d=0,E=this.data[c];d<E.length;d+=1){var w=E[d];l(w.value)||h.push(w)}for(var P=0,L=h;P<L.length;P+=1){var Z=L[P];this.remove(Z.value.tileID,Z)}};var Dn=function(l,h,c){this.context=l;var d=l.gl;this.buffer=d.createBuffer(),this.dynamicDraw=Boolean(c),this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer};Dn.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},Dn.prototype.updateData=function(l){var h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)},Dn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var jn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},In=function(l,h,c,d){this.length=h.length,this.attributes=c,this.itemSize=h.bytesPerElement,this.dynamicDraw=d,this.context=l;var E=l.gl;this.buffer=E.createBuffer(),l.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer};In.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},In.prototype.updateData=function(l){var h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,l.arrayBuffer)},In.prototype.enableAttributes=function(l,h){for(var c=0;c<this.attributes.length;c++){var d=h.attributes[this.attributes[c].name];d!==void 0&&l.enableVertexAttribArray(d)}},In.prototype.setVertexAttribPointers=function(l,h,c){for(var d=0;d<this.attributes.length;d++){var E=this.attributes[d],w=h.attributes[E.name];w!==void 0&&l.vertexAttribPointer(w,E.components,l[jn[E.type]],!1,this.itemSize,E.offset+this.itemSize*(c||0))}},In.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var ii=function(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};ii.prototype.get=function(){return this.current},ii.prototype.set=function(l){},ii.prototype.getDefault=function(){return this.default},ii.prototype.setDefault=function(){this.set(this.default)};var wi=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return g.Color.transparent},h.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},h}(ii),Ei=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return 1},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)},h}(ii),Ti=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return 0},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)},h}(ii),Gi=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return[!0,!0,!0,!0]},h.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},h}(ii),Qi=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!0},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)},h}(ii),po=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return 255},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)},h}(ii),Sa=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},h.prototype.set=function(c){var d=this.current;(c.func!==d.func||c.ref!==d.ref||c.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)},h}(ii),pa=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){var c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]},h.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)},h}(ii),Fi=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=c,this.dirty=!1}},h}(ii),ra=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return[0,1]},h.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)},h}(ii),$i=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=c,this.dirty=!1}},h}(ii),is=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.LESS},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)},h}(ii),me=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.BLEND):d.disable(d.BLEND),this.current=c,this.dirty=!1}},h}(ii),li=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){var c=this.gl;return[c.ONE,c.ZERO]},h.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)},h}(ii),bo=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return g.Color.transparent},h.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},h}(ii),cu=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.FUNC_ADD},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)},h}(ii),Zt=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=c,this.dirty=!1}},h}(ii),er=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.BACK},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)},h}(ii),Lr=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.CCW},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)},h}(ii),sn=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)},h}(ii),On=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.TEXTURE0},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)},h}(ii),Vn=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){var c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]},h.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},h}(ii),bi=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,c),this.current=c,this.dirty=!1}},h}(ii),vi=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},h}(ii),An=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindTexture(d.TEXTURE_2D,c),this.current=c,this.dirty=!1}},h}(ii),Bi=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}},h}(ii),Li=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){var d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1},h}(ii),io=function(l){function h(c){l.call(this,c),this.vao=c.extVertexArrayObject}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){this.vao&&(c!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(c),this.current=c,this.dirty=!1)},h}(ii),ys=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return 4},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}},h}(ii),Uo=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}},h}(ii),Na=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}},h}(ii),xa=function(l){function h(c,d){l.call(this,c),this.context=c,this.parent=d}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h}(ii),V=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.setDirty=function(){this.dirty=!0},h.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}},h}(xa),Q=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},h}(xa),ne=function(l,h,c,d){this.context=l,this.width=h,this.height=c;var E=this.framebuffer=l.gl.createFramebuffer();this.colorAttachment=new V(l,E),d&&(this.depthAttachment=new Q(l,E))};ne.prototype.destroy=function(){var l=this.context.gl,h=this.colorAttachment.get();if(h&&l.deleteTexture(h),this.depthAttachment){var c=this.depthAttachment.get();c&&l.deleteRenderbuffer(c)}l.deleteFramebuffer(this.framebuffer)};var ge=function(l,h,c){this.func=l,this.mask=h,this.range=c};ge.ReadOnly=!1,ge.ReadWrite=!0,ge.disabled=new ge(519,ge.ReadOnly,[0,1]);var Ie=function(l,h,c,d,E,w){this.test=l,this.ref=h,this.mask=c,this.fail=d,this.depthFail=E,this.pass=w};Ie.disabled=new Ie({func:519,mask:0},0,0,7680,7680,7680);var Ge=function(l,h,c){this.blendFunction=l,this.blendColor=h,this.mask=c};Ge.disabled=new Ge(Ge.Replace=[1,0],g.Color.transparent,[!1,!1,!1,!1]),Ge.unblended=new Ge(Ge.Replace,g.Color.transparent,[!0,!0,!0,!0]),Ge.alphaBlended=new Ge([1,771],g.Color.transparent,[!0,!0,!0,!0]);var tt=function(l,h,c){this.enable=l,this.mode=h,this.frontFace=c};tt.disabled=new tt(!1,1029,2305),tt.backCCW=new tt(!0,1029,2305);var ce=function(l){this.gl=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new wi(this),this.clearDepth=new Ei(this),this.clearStencil=new Ti(this),this.colorMask=new Gi(this),this.depthMask=new Qi(this),this.stencilMask=new po(this),this.stencilFunc=new Sa(this),this.stencilOp=new pa(this),this.stencilTest=new Fi(this),this.depthRange=new ra(this),this.depthTest=new $i(this),this.depthFunc=new is(this),this.blend=new me(this),this.blendFunc=new li(this),this.blendColor=new bo(this),this.blendEquation=new cu(this),this.cullFace=new Zt(this),this.cullFaceSide=new er(this),this.frontFace=new Lr(this),this.program=new sn(this),this.activeTexture=new On(this),this.viewport=new Vn(this),this.bindFramebuffer=new bi(this),this.bindRenderbuffer=new vi(this),this.bindTexture=new An(this),this.bindVertexBuffer=new Bi(this),this.bindElementBuffer=new Li(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new io(this),this.pixelStoreUnpack=new ys(this),this.pixelStoreUnpackPremultiplyAlpha=new Uo(this),this.pixelStoreUnpackFlipY=new Na(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=l.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(l.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)};ce.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},ce.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},ce.prototype.createIndexBuffer=function(l,h){return new Dn(this,l,h)},ce.prototype.createVertexBuffer=function(l,h,c){return new In(this,l,h,c)},ce.prototype.createRenderbuffer=function(l,h,c){var d=this.gl,E=d.createRenderbuffer();return this.bindRenderbuffer.set(E),d.renderbufferStorage(d.RENDERBUFFER,l,h,c),this.bindRenderbuffer.set(null),E},ce.prototype.createFramebuffer=function(l,h,c){return new ne(this,l,h,c)},ce.prototype.clear=function(l){var h=l.color,c=l.depth,d=this.gl,E=0;h&&(E|=d.COLOR_BUFFER_BIT,this.clearColor.set(h),this.colorMask.set([!0,!0,!0,!0])),c!==void 0&&(E|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),d.clear(E)},ce.prototype.setCullFace=function(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))},ce.prototype.setDepthMode=function(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)},ce.prototype.setStencilMode=function(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)},ce.prototype.setColorMode=function(l){g.deepEqual(l.blendFunction,Ge.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)},ce.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Le=function(l){function h(c,d,E){var w=this;l.call(this),this.id=c,this.dispatcher=E,this.on("data",function(P){P.dataType==="source"&&P.sourceDataType==="metadata"&&(w._sourceLoaded=!0),w._sourceLoaded&&!w._paused&&P.dataType==="source"&&P.sourceDataType==="content"&&(w.reload(),w.transform&&w.update(w.transform))}),this.on("error",function(){w._sourceErrored=!0}),this._source=function(P,L,Z,X){var se=new nr[L.type](P,L,Z,X);if(se.id!==P)throw new Error("Expected Source id to be "+P+" instead of "+se.id);return g.bindAll(["load","abort","unload","serialize","prepare"],se),se}(c,d,E,this),this._tiles={},this._cache=new an(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new g.SourceFeatureState}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.onAdd=function(c){this.map=c,this._maxTileCacheSize=c?c._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(c)},h.prototype.onRemove=function(c){this._source&&this._source.onRemove&&this._source.onRemove(c)},h.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var c in this._tiles){var d=this._tiles[c];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0},h.prototype.getSource=function(){return this._source},h.prototype.pause=function(){this._paused=!0},h.prototype.resume=function(){if(this._paused){var c=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,c&&this.reload(),this.transform&&this.update(this.transform)}},h.prototype._loadTile=function(c,d){return this._source.loadTile(c,d)},h.prototype._unloadTile=function(c){if(this._source.unloadTile)return this._source.unloadTile(c,function(){})},h.prototype._abortTile=function(c){if(this._source.abortTile)return this._source.abortTile(c,function(){})},h.prototype.serialize=function(){return this._source.serialize()},h.prototype.prepare=function(c){for(var d in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var E=this._tiles[d];E.upload(c),E.prepare(this.map.style.imageManager)}},h.prototype.getIds=function(){return g.values(this._tiles).map(function(c){return c.tileID}).sort(mt).map(function(c){return c.key})},h.prototype.getRenderableIds=function(c){var d=this,E=[];for(var w in this._tiles)this._isIdRenderable(w,c)&&E.push(this._tiles[w]);return c?E.sort(function(P,L){var Z=P.tileID,X=L.tileID,se=new g.Point(Z.canonical.x,Z.canonical.y)._rotate(d.transform.angle),fe=new g.Point(X.canonical.x,X.canonical.y)._rotate(d.transform.angle);return Z.overscaledZ-X.overscaledZ||fe.y-se.y||fe.x-se.x}).map(function(P){return P.tileID.key}):E.map(function(P){return P.tileID}).sort(mt).map(function(P){return P.key})},h.prototype.hasRenderableParent=function(c){var d=this.findLoadedParent(c,0);return!!d&&this._isIdRenderable(d.tileID.key)},h.prototype._isIdRenderable=function(c,d){return this._tiles[c]&&this._tiles[c].hasData()&&!this._coveredTiles[c]&&(d||!this._tiles[c].holdingForFade())},h.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var c in this._cache.reset(),this._tiles)this._tiles[c].state!=="errored"&&this._reloadTile(c,"reloading")},h.prototype._reloadTile=function(c,d){var E=this._tiles[c];E&&(E.state!=="loading"&&(E.state=d),this._loadTile(E,this._tileLoaded.bind(this,E,c,d)))},h.prototype._tileLoaded=function(c,d,E,w){if(w)return c.state="errored",void(w.status!==404?this._source.fire(new g.ErrorEvent(w,{tile:c})):this.update(this.transform));c.timeAdded=g.browser.now(),E==="expired"&&(c.refreshedUponExpiration=!0),this._setTileReloadTimer(d,c),this.getSource().type==="raster-dem"&&c.dem&&this._backfillDEM(c),this._state.initializeTileState(c,this.map?this.map.painter:null),this._source.fire(new g.Event("data",{dataType:"source",tile:c,coord:c.tileID}))},h.prototype._backfillDEM=function(c){for(var d=this.getRenderableIds(),E=0;E<d.length;E++){var w=d[E];if(c.neighboringTiles&&c.neighboringTiles[w]){var P=this.getTileByID(w);L(c,P),L(P,c)}}function L(Z,X){Z.needsHillshadePrepare=!0;var se=X.tileID.canonical.x-Z.tileID.canonical.x,fe=X.tileID.canonical.y-Z.tileID.canonical.y,de=Math.pow(2,Z.tileID.canonical.z),ke=X.tileID.key;se===0&&fe===0||Math.abs(fe)>1||(Math.abs(se)>1&&(Math.abs(se+de)===1?se+=de:Math.abs(se-de)===1&&(se-=de)),X.dem&&Z.dem&&(Z.dem.backfillBorder(X.dem,se,fe),Z.neighboringTiles&&Z.neighboringTiles[ke]&&(Z.neighboringTiles[ke].backfilled=!0)))}},h.prototype.getTile=function(c){return this.getTileByID(c.key)},h.prototype.getTileByID=function(c){return this._tiles[c]},h.prototype._retainLoadedChildren=function(c,d,E,w){for(var P in this._tiles){var L=this._tiles[P];if(!(w[P]||!L.hasData()||L.tileID.overscaledZ<=d||L.tileID.overscaledZ>E)){for(var Z=L.tileID;L&&L.tileID.overscaledZ>d+1;){var X=L.tileID.scaledTo(L.tileID.overscaledZ-1);(L=this._tiles[X.key])&&L.hasData()&&(Z=X)}for(var se=Z;se.overscaledZ>d;)if(c[(se=se.scaledTo(se.overscaledZ-1)).key]){w[Z.key]=Z;break}}}},h.prototype.findLoadedParent=function(c,d){if(c.key in this._loadedParentTiles){var E=this._loadedParentTiles[c.key];return E&&E.tileID.overscaledZ>=d?E:null}for(var w=c.overscaledZ-1;w>=d;w--){var P=c.scaledTo(w),L=this._getLoadedTile(P);if(L)return L}},h.prototype._getLoadedTile=function(c){var d=this._tiles[c.key];return d&&d.hasData()?d:this._cache.getByKey(c.wrapped().key)},h.prototype.updateCacheSize=function(c){var d=Math.ceil(c.width/this._source.tileSize)+1,E=Math.ceil(c.height/this._source.tileSize)+1,w=Math.floor(d*E*5),P=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(P)},h.prototype.handleWrapJump=function(c){var d=Math.round((c-(this._prevLng===void 0?c:this._prevLng))/360);if(this._prevLng=c,d){var E={};for(var w in this._tiles){var P=this._tiles[w];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+d),E[P.tileID.key]=P}for(var L in this._tiles=E,this._timers)clearTimeout(this._timers[L]),delete this._timers[L];for(var Z in this._tiles)this._setTileReloadTimer(Z,this._tiles[Z])}},h.prototype.update=function(c){var d=this;if(this.transform=c,this._sourceLoaded&&!this._paused){var E;this.updateCacheSize(c),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?E=c.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(vr){return new g.OverscaledTileID(vr.canonical.z,vr.wrap,vr.canonical.z,vr.canonical.x,vr.canonical.y)}):(E=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(E=E.filter(function(vr){return d._source.hasTile(vr)}))):E=[];var w=c.coveringZoomLevel(this._source),P=Math.max(w-h.maxOverzooming,this._source.minzoom),L=Math.max(w+h.maxUnderzooming,this._source.minzoom),Z=this._updateRetainedTiles(E,w);if(pr(this._source.type)){for(var X={},se={},fe=0,de=Object.keys(Z);fe<de.length;fe+=1){var ke=de[fe],Oe=Z[ke],ze=this._tiles[ke];if(ze&&!(ze.fadeEndTime&&ze.fadeEndTime<=g.browser.now())){var Ce=this.findLoadedParent(Oe,P);Ce&&(this._addTile(Ce.tileID),X[Ce.tileID.key]=Ce.tileID),se[ke]=Oe}}for(var je in this._retainLoadedChildren(se,w,L,Z),X)Z[je]||(this._coveredTiles[je]=!0,Z[je]=X[je])}for(var Qe in Z)this._tiles[Qe].clearFadeHold();for(var gt=0,Gt=g.keysDifference(this._tiles,Z);gt<Gt.length;gt+=1){var Ut=Gt[gt],Yt=this._tiles[Ut];Yt.hasSymbolBuckets&&!Yt.holdingForFade()?Yt.setHoldDuration(this.map._fadeDuration):Yt.hasSymbolBuckets&&!Yt.symbolFadeFinished()||this._removeTile(Ut)}this._updateLoadedParentTileCache()}},h.prototype.releaseSymbolFadeTiles=function(){for(var c in this._tiles)this._tiles[c].holdingForFade()&&this._removeTile(c)},h.prototype._updateRetainedTiles=function(c,d){for(var E={},w={},P=Math.max(d-h.maxOverzooming,this._source.minzoom),L=Math.max(d+h.maxUnderzooming,this._source.minzoom),Z={},X=0,se=c;X<se.length;X+=1){var fe=se[X],de=this._addTile(fe);E[fe.key]=fe,de.hasData()||d<this._source.maxzoom&&(Z[fe.key]=fe)}this._retainLoadedChildren(Z,d,L,E);for(var ke=0,Oe=c;ke<Oe.length;ke+=1){var ze=Oe[ke],Ce=this._tiles[ze.key];if(!Ce.hasData()){if(d+1>this._source.maxzoom){var je=ze.children(this._source.maxzoom)[0],Qe=this.getTile(je);if(Qe&&Qe.hasData()){E[je.key]=je;continue}}else{var gt=ze.children(this._source.maxzoom);if(E[gt[0].key]&&E[gt[1].key]&&E[gt[2].key]&&E[gt[3].key])continue}for(var Gt=Ce.wasRequested(),Ut=ze.overscaledZ-1;Ut>=P;--Ut){var Yt=ze.scaledTo(Ut);if(w[Yt.key]||(w[Yt.key]=!0,!(Ce=this.getTile(Yt))&&Gt&&(Ce=this._addTile(Yt)),Ce&&(E[Yt.key]=Yt,Gt=Ce.wasRequested(),Ce.hasData())))break}}}return E},h.prototype._updateLoadedParentTileCache=function(){for(var c in this._loadedParentTiles={},this._tiles){for(var d=[],E=void 0,w=this._tiles[c].tileID;w.overscaledZ>0;){if(w.key in this._loadedParentTiles){E=this._loadedParentTiles[w.key];break}d.push(w.key);var P=w.scaledTo(w.overscaledZ-1);if(E=this._getLoadedTile(P))break;w=P}for(var L=0,Z=d;L<Z.length;L+=1)this._loadedParentTiles[Z[L]]=E}},h.prototype._addTile=function(c){var d=this._tiles[c.key];if(d)return d;(d=this._cache.getAndRemove(c))&&(this._setTileReloadTimer(c.key,d),d.tileID=c,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[c.key]&&(clearTimeout(this._cacheTimers[c.key]),delete this._cacheTimers[c.key],this._setTileReloadTimer(c.key,d)));var E=Boolean(d);return E||(d=new g.Tile(c,this._source.tileSize*c.overscaleFactor()),this._loadTile(d,this._tileLoaded.bind(this,d,c.key,d.state))),d?(d.uses++,this._tiles[c.key]=d,E||this._source.fire(new g.Event("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d):null},h.prototype._setTileReloadTimer=function(c,d){var E=this;c in this._timers&&(clearTimeout(this._timers[c]),delete this._timers[c]);var w=d.getExpiryTimeout();w&&(this._timers[c]=setTimeout(function(){E._reloadTile(c,"expired"),delete E._timers[c]},w))},h.prototype._removeTile=function(c){var d=this._tiles[c];d&&(d.uses--,delete this._tiles[c],this._timers[c]&&(clearTimeout(this._timers[c]),delete this._timers[c]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))},h.prototype.clearTiles=function(){for(var c in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(c);this._cache.reset()},h.prototype.tilesIn=function(c,d,E){var w=this,P=[],L=this.transform;if(!L)return P;for(var Z=E?L.getCameraQueryGeometry(c):c,X=c.map(function(Ut){return L.pointCoordinate(Ut)}),se=Z.map(function(Ut){return L.pointCoordinate(Ut)}),fe=this.getIds(),de=1/0,ke=1/0,Oe=-1/0,ze=-1/0,Ce=0,je=se;Ce<je.length;Ce+=1){var Qe=je[Ce];de=Math.min(de,Qe.x),ke=Math.min(ke,Qe.y),Oe=Math.max(Oe,Qe.x),ze=Math.max(ze,Qe.y)}for(var gt=function(Ut){var Yt=w._tiles[fe[Ut]];if(!Yt.holdingForFade()){var vr=Yt.tileID,Dr=Math.pow(2,L.zoom-Yt.tileID.overscaledZ),_r=d*Yt.queryPadding*g.EXTENT/Yt.tileSize/Dr,ln=[vr.getTilePoint(new g.MercatorCoordinate(de,ke)),vr.getTilePoint(new g.MercatorCoordinate(Oe,ze))];if(ln[0].x-_r<g.EXTENT&&ln[0].y-_r<g.EXTENT&&ln[1].x+_r>=0&&ln[1].y+_r>=0){var Gn=X.map(function(Bn){return vr.getTilePoint(Bn)}),Hn=se.map(function(Bn){return vr.getTilePoint(Bn)});P.push({tile:Yt,tileID:vr,queryGeometry:Gn,cameraQueryGeometry:Hn,scale:Dr})}}},Gt=0;Gt<fe.length;Gt++)gt(Gt);return P},h.prototype.getVisibleCoordinates=function(c){for(var d=this,E=this.getRenderableIds(c).map(function(Z){return d._tiles[Z].tileID}),w=0,P=E;w<P.length;w+=1){var L=P[w];L.posMatrix=this.transform.calculatePosMatrix(L.toUnwrapped())}return E},h.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(pr(this._source.type))for(var c in this._tiles){var d=this._tiles[c];if(d.fadeEndTime!==void 0&&d.fadeEndTime>=g.browser.now())return!0}return!1},h.prototype.setFeatureState=function(c,d,E){this._state.updateState(c=c||"_geojsonTileLayer",d,E)},h.prototype.removeFeatureState=function(c,d,E){this._state.removeFeatureState(c=c||"_geojsonTileLayer",d,E)},h.prototype.getFeatureState=function(c,d){return this._state.getState(c=c||"_geojsonTileLayer",d)},h.prototype.setDependencies=function(c,d,E){var w=this._tiles[c];w&&w.setDependencies(d,E)},h.prototype.reloadTilesForDependencies=function(c,d){for(var E in this._tiles)this._tiles[E].hasDependency(c,d)&&this._reloadTile(E,"reloading");this._cache.filter(function(w){return!w.hasDependency(c,d)})},h}(g.Evented);function mt(l,h){var c=Math.abs(2*l.wrap)-+(l.wrap<0),d=Math.abs(2*h.wrap)-+(h.wrap<0);return l.overscaledZ-h.overscaledZ||d-c||h.canonical.y-l.canonical.y||h.canonical.x-l.canonical.x}function pr(l){return l==="raster"||l==="image"||l==="video"}function Lt(){return new g.window.Worker(Hl.workerUrl)}Le.maxOverzooming=10,Le.maxUnderzooming=3;var Ft="mapboxgl_preloaded_worker_pool",dr=function(){this.active={}};dr.prototype.acquire=function(l){if(!this.workers)for(this.workers=[];this.workers.length<dr.workerCount;)this.workers.push(new Lt);return this.active[l]=!0,this.workers.slice()},dr.prototype.release=function(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(function(h){h.terminate()}),this.workers=null)},dr.prototype.isPreloaded=function(){return!!this.active[Ft]},dr.prototype.numActive=function(){return Object.keys(this.active).length};var bn,pn=Math.floor(g.browser.hardwareConcurrency/2);function Pt(){return bn||(bn=new dr),bn}function en(l,h){var c={};for(var d in l)d!=="ref"&&(c[d]=l[d]);return g.refProperties.forEach(function(E){E in h&&(c[E]=h[E])}),c}function zr(l){l=l.slice();for(var h=Object.create(null),c=0;c<l.length;c++)h[l[c].id]=l[c];for(var d=0;d<l.length;d++)"ref"in l[d]&&(l[d]=en(l[d],h[l[d].ref]));return l}dr.workerCount=Math.max(Math.min(pn,6),1);var Xr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function mi(l,h,c){c.push({command:Xr.addSource,args:[l,h[l]]})}function tn(l,h,c){h.push({command:Xr.removeSource,args:[l]}),c[l]=!0}function mn(l,h,c,d){tn(l,c,d),mi(l,h,c)}function Xi(l,h,c){var d;for(d in l[c])if(l[c].hasOwnProperty(d)&&d!=="data"&&!g.deepEqual(l[c][d],h[c][d]))return!1;for(d in h[c])if(h[c].hasOwnProperty(d)&&d!=="data"&&!g.deepEqual(l[c][d],h[c][d]))return!1;return!0}function hi(l,h,c,d,E,w){var P;for(P in h=h||{},l=l||{})l.hasOwnProperty(P)&&(g.deepEqual(l[P],h[P])||c.push({command:w,args:[d,P,h[P],E]}));for(P in h)h.hasOwnProperty(P)&&!l.hasOwnProperty(P)&&(g.deepEqual(l[P],h[P])||c.push({command:w,args:[d,P,h[P],E]}))}function Pi(l){return l.id}function _i(l,h){return l[h.id]=h,l}var dt=function(l,h){this.reset(l,h)};dt.prototype.reset=function(l,h){this.points=l||[],this._distances=[0];for(var c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding},dt.prototype.lerp=function(l){if(this.points.length===1)return this.points[0];l=g.clamp(l,0,1);for(var h=1,c=this._distances[h],d=l*this.paddedLength+this.padding;c<d&&h<this._distances.length;)c=this._distances[++h];var E=h-1,w=this._distances[E],P=c-w,L=P>0?(d-w)/P:0;return this.points[E].mult(1-L).add(this.points[h].mult(L))};var It=function(l,h,c){var d=this.boxCells=[],E=this.circleCells=[];this.xCellCount=Math.ceil(l/c),this.yCellCount=Math.ceil(h/c);for(var w=0;w<this.xCellCount*this.yCellCount;w++)d.push([]),E.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=h,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0};function Ta(l,h,c,d,E){var w=g.create();return h?(g.scale(w,w,[1/E,1/E,1]),c||g.rotateZ(w,w,d.angle)):g.multiply(w,d.labelPlaneMatrix,l),w}function Si(l,h,c,d,E){if(h){var w=g.clone(l);return g.scale(w,w,[E,E,1]),c||g.rotateZ(w,w,-d.angle),w}return d.glCoordMatrix}function Ii(l,h){var c=[l.x,l.y,0,1];Ma(c,c,h);var d=c[3];return{point:new g.Point(c[0]/d,c[1]/d),signedDistanceFromCamera:d}}function ji(l,h){return .5+l/h*.5}function Ir(l,h){var c=l[0]/l[3],d=l[1]/l[3];return c>=-h[0]&&c<=h[0]&&d>=-h[1]&&d<=h[1]}function un(l,h,c,d,E,w,P,L){var Z=d?l.textSizeData:l.iconSizeData,X=g.evaluateSizeForZoom(Z,c.transform.zoom),se=[256/c.width*2+1,256/c.height*2+1],fe=d?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;fe.clear();for(var de=l.lineVertexArray,ke=d?l.text.placedSymbolArray:l.icon.placedSymbolArray,Oe=c.transform.width/c.transform.height,ze=!1,Ce=0;Ce<ke.length;Ce++){var je=ke.get(Ce);if(je.hidden||je.writingMode===g.WritingMode.vertical&&!ze)za(je.numGlyphs,fe);else{ze=!1;var Qe=[je.anchorX,je.anchorY,0,1];if(g.transformMat4(Qe,Qe,h),Ir(Qe,se)){var gt=ji(c.transform.cameraToCenterDistance,Qe[3]),Gt=g.evaluateSizeForFeature(Z,X,je),Ut=P?Gt/gt:Gt*gt,Yt=new g.Point(je.anchorX,je.anchorY),vr=Ii(Yt,E).point,Dr={},_r=J(je,Ut,!1,L,h,E,w,l.glyphOffsetArray,de,fe,vr,Yt,Dr,Oe);ze=_r.useVertical,(_r.notEnoughRoom||ze||_r.needsFlipping&&J(je,Ut,!0,L,h,E,w,l.glyphOffsetArray,de,fe,vr,Yt,Dr,Oe).notEnoughRoom)&&za(je.numGlyphs,fe)}else za(je.numGlyphs,fe)}}d?l.text.dynamicLayoutVertexBuffer.updateData(fe):l.icon.dynamicLayoutVertexBuffer.updateData(fe)}function _t(l,h,c,d,E,w,P,L,Z,X,se){var fe=L.glyphStartIndex+L.numGlyphs,de=L.lineStartIndex,ke=L.lineStartIndex+L.lineLength,Oe=h.getoffsetX(L.glyphStartIndex),ze=h.getoffsetX(fe-1),Ce=na(l*Oe,c,d,E,w,P,L.segment,de,ke,Z,X,se);if(!Ce)return null;var je=na(l*ze,c,d,E,w,P,L.segment,de,ke,Z,X,se);return je?{first:Ce,last:je}:null}function aa(l,h,c,d){return l===g.WritingMode.horizontal&&Math.abs(c.y-h.y)>Math.abs(c.x-h.x)*d?{useVertical:!0}:(l===g.WritingMode.vertical?h.y<c.y:h.x>c.x)?{needsFlipping:!0}:null}function J(l,h,c,d,E,w,P,L,Z,X,se,fe,de,ke){var Oe,ze=h/24,Ce=l.lineOffsetX*ze,je=l.lineOffsetY*ze;if(l.numGlyphs>1){var Qe=l.glyphStartIndex+l.numGlyphs,gt=l.lineStartIndex,Gt=l.lineStartIndex+l.lineLength,Ut=_t(ze,L,Ce,je,c,se,fe,l,Z,w,de);if(!Ut)return{notEnoughRoom:!0};var Yt=Ii(Ut.first.point,P).point,vr=Ii(Ut.last.point,P).point;if(d&&!c){var Dr=aa(l.writingMode,Yt,vr,ke);if(Dr)return Dr}Oe=[Ut.first];for(var _r=l.glyphStartIndex+1;_r<Qe-1;_r++)Oe.push(na(ze*L.getoffsetX(_r),Ce,je,c,se,fe,l.segment,gt,Gt,Z,w,de));Oe.push(Ut.last)}else{if(d&&!c){var ln=Ii(fe,E).point,Gn=l.lineStartIndex+l.segment+1,Hn=new g.Point(Z.getx(Gn),Z.gety(Gn)),Bn=Ii(Hn,E),Di=Bn.signedDistanceFromCamera>0?Bn.point:Ko(fe,Hn,ln,1,E),rn=aa(l.writingMode,ln,Di,ke);if(rn)return rn}var oi=na(ze*L.getoffsetX(l.glyphStartIndex),Ce,je,c,se,fe,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,Z,w,de);if(!oi)return{notEnoughRoom:!0};Oe=[oi]}for(var ci=0,Qn=Oe;ci<Qn.length;ci+=1){var Xn=Qn[ci];g.addDynamicAttributes(X,Xn.point,Xn.angle)}return{}}function Ko(l,h,c,d,E){var w=Ii(l.add(l.sub(h)._unit()),E).point,P=c.sub(w);return c.add(P._mult(d/P.mag()))}function na(l,h,c,d,E,w,P,L,Z,X,se,fe){var de=d?l-h:l+h,ke=de>0?1:-1,Oe=0;d&&(ke*=-1,Oe=Math.PI),ke<0&&(Oe+=Math.PI);for(var ze=ke>0?L+P:L+P+1,Ce=E,je=E,Qe=0,gt=0,Gt=Math.abs(de),Ut=[];Qe+gt<=Gt;){if((ze+=ke)<L||ze>=Z)return null;if(je=Ce,Ut.push(Ce),(Ce=fe[ze])===void 0){var Yt=new g.Point(X.getx(ze),X.gety(ze)),vr=Ii(Yt,se);if(vr.signedDistanceFromCamera>0)Ce=fe[ze]=vr.point;else{var Dr=ze-ke;Ce=Ko(Qe===0?w:new g.Point(X.getx(Dr),X.gety(Dr)),Yt,je,Gt-Qe+1,se)}}Qe+=gt,gt=je.dist(Ce)}var _r=(Gt-Qe)/gt,ln=Ce.sub(je),Gn=ln.mult(_r)._add(je);Gn._add(ln._unit()._perp()._mult(c*ke));var Hn=Oe+Math.atan2(Ce.y-je.y,Ce.x-je.x);return Ut.push(Gn),{point:Gn,angle:Hn,path:Ut}}It.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},It.prototype.insert=function(l,h,c,d,E){this._forEachCell(h,c,d,E,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(h),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(E)},It.prototype.insertCircle=function(l,h,c,d){this._forEachCell(h-d,c-d,h+d,c+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(h),this.circles.push(c),this.circles.push(d)},It.prototype._insertBoxCell=function(l,h,c,d,E,w){this.boxCells[E].push(w)},It.prototype._insertCircleCell=function(l,h,c,d,E,w){this.circleCells[E].push(w)},It.prototype._query=function(l,h,c,d,E,w){if(c<0||l>this.width||d<0||h>this.height)return!E&&[];var P=[];if(l<=0&&h<=0&&this.width<=c&&this.height<=d){if(E)return!0;for(var L=0;L<this.boxKeys.length;L++)P.push({key:this.boxKeys[L],x1:this.bboxes[4*L],y1:this.bboxes[4*L+1],x2:this.bboxes[4*L+2],y2:this.bboxes[4*L+3]});for(var Z=0;Z<this.circleKeys.length;Z++){var X=this.circles[3*Z],se=this.circles[3*Z+1],fe=this.circles[3*Z+2];P.push({key:this.circleKeys[Z],x1:X-fe,y1:se-fe,x2:X+fe,y2:se+fe})}return w?P.filter(w):P}return this._forEachCell(l,h,c,d,this._queryCell,P,{hitTest:E,seenUids:{box:{},circle:{}}},w),E?P.length>0:P},It.prototype._queryCircle=function(l,h,c,d,E){var w=l-c,P=l+c,L=h-c,Z=h+c;if(P<0||w>this.width||Z<0||L>this.height)return!d&&[];var X=[];return this._forEachCell(w,L,P,Z,this._queryCellCircle,X,{hitTest:d,circle:{x:l,y:h,radius:c},seenUids:{box:{},circle:{}}},E),d?X.length>0:X},It.prototype.query=function(l,h,c,d,E){return this._query(l,h,c,d,!1,E)},It.prototype.hitTest=function(l,h,c,d,E){return this._query(l,h,c,d,!0,E)},It.prototype.hitTestCircle=function(l,h,c,d){return this._queryCircle(l,h,c,!0,d)},It.prototype._queryCell=function(l,h,c,d,E,w,P,L){var Z=P.seenUids,X=this.boxCells[E];if(X!==null)for(var se=this.bboxes,fe=0,de=X;fe<de.length;fe+=1){var ke=de[fe];if(!Z.box[ke]){Z.box[ke]=!0;var Oe=4*ke;if(l<=se[Oe+2]&&h<=se[Oe+3]&&c>=se[Oe+0]&&d>=se[Oe+1]&&(!L||L(this.boxKeys[ke]))){if(P.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[ke],x1:se[Oe],y1:se[Oe+1],x2:se[Oe+2],y2:se[Oe+3]})}}}var ze=this.circleCells[E];if(ze!==null)for(var Ce=this.circles,je=0,Qe=ze;je<Qe.length;je+=1){var gt=Qe[je];if(!Z.circle[gt]){Z.circle[gt]=!0;var Gt=3*gt;if(this._circleAndRectCollide(Ce[Gt],Ce[Gt+1],Ce[Gt+2],l,h,c,d)&&(!L||L(this.circleKeys[gt]))){if(P.hitTest)return w.push(!0),!0;var Ut=Ce[Gt],Yt=Ce[Gt+1],vr=Ce[Gt+2];w.push({key:this.circleKeys[gt],x1:Ut-vr,y1:Yt-vr,x2:Ut+vr,y2:Yt+vr})}}}},It.prototype._queryCellCircle=function(l,h,c,d,E,w,P,L){var Z=P.circle,X=P.seenUids,se=this.boxCells[E];if(se!==null)for(var fe=this.bboxes,de=0,ke=se;de<ke.length;de+=1){var Oe=ke[de];if(!X.box[Oe]){X.box[Oe]=!0;var ze=4*Oe;if(this._circleAndRectCollide(Z.x,Z.y,Z.radius,fe[ze+0],fe[ze+1],fe[ze+2],fe[ze+3])&&(!L||L(this.boxKeys[Oe])))return w.push(!0),!0}}var Ce=this.circleCells[E];if(Ce!==null)for(var je=this.circles,Qe=0,gt=Ce;Qe<gt.length;Qe+=1){var Gt=gt[Qe];if(!X.circle[Gt]){X.circle[Gt]=!0;var Ut=3*Gt;if(this._circlesCollide(je[Ut],je[Ut+1],je[Ut+2],Z.x,Z.y,Z.radius)&&(!L||L(this.circleKeys[Gt])))return w.push(!0),!0}}},It.prototype._forEachCell=function(l,h,c,d,E,w,P,L){for(var Z=this._convertToXCellCoord(l),X=this._convertToYCellCoord(h),se=this._convertToXCellCoord(c),fe=this._convertToYCellCoord(d),de=Z;de<=se;de++)for(var ke=X;ke<=fe;ke++)if(E.call(this,l,h,c,d,this.xCellCount*ke+de,w,P,L))return},It.prototype._convertToXCellCoord=function(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))},It.prototype._convertToYCellCoord=function(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))},It.prototype._circlesCollide=function(l,h,c,d,E,w){var P=d-l,L=E-h,Z=c+w;return Z*Z>P*P+L*L},It.prototype._circleAndRectCollide=function(l,h,c,d,E,w,P){var L=(w-d)/2,Z=Math.abs(l-(d+L));if(Z>L+c)return!1;var X=(P-E)/2,se=Math.abs(h-(E+X));if(se>X+c)return!1;if(Z<=L||se<=X)return!0;var fe=Z-L,de=se-X;return fe*fe+de*de<=c*c};var bu=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function za(l,h){for(var c=0;c<l;c++){var d=h.length;h.resize(d+4),h.float32.set(bu,3*d)}}function Ma(l,h,c){var d=h[0],E=h[1];return l[0]=c[0]*d+c[4]*E+c[12],l[1]=c[1]*d+c[5]*E+c[13],l[3]=c[3]*d+c[7]*E+c[15],l}var qa=function(l,h,c){h===void 0&&(h=new It(l.width+200,l.height+200,25)),c===void 0&&(c=new It(l.width+200,l.height+200,25)),this.transform=l,this.grid=h,this.ignoredGrid=c,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+100,this.screenBottomBoundary=l.height+100,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200};function oa(l,h,c){return h*(g.EXTENT/(l.tileSize*Math.pow(2,c-l.tileID.overscaledZ)))}qa.prototype.placeCollisionBox=function(l,h,c,d,E){var w=this.projectAndGetPerspectiveRatio(d,l.anchorPointX,l.anchorPointY),P=c*w.perspectiveRatio,L=l.x1*P+w.point.x,Z=l.y1*P+w.point.y,X=l.x2*P+w.point.x,se=l.y2*P+w.point.y;return!this.isInsideGrid(L,Z,X,se)||!h&&this.grid.hitTest(L,Z,X,se,E)?{box:[],offscreen:!1}:{box:[L,Z,X,se],offscreen:this.isOffscreen(L,Z,X,se)}},qa.prototype.placeCollisionCircles=function(l,h,c,d,E,w,P,L,Z,X,se,fe,de){var ke=[],Oe=new g.Point(h.anchorX,h.anchorY),ze=Ii(Oe,w),Ce=ji(this.transform.cameraToCenterDistance,ze.signedDistanceFromCamera),je=(X?E/Ce:E*Ce)/g.ONE_EM,Qe=Ii(Oe,P).point,gt=_t(je,d,h.lineOffsetX*je,h.lineOffsetY*je,!1,Qe,Oe,h,c,P,{}),Gt=!1,Ut=!1,Yt=!0;if(gt){for(var vr=.5*fe*Ce+de,Dr=new g.Point(-100,-100),_r=new g.Point(this.screenRightBoundary,this.screenBottomBoundary),ln=new dt,Gn=gt.first,Hn=gt.last,Bn=[],Di=Gn.path.length-1;Di>=1;Di--)Bn.push(Gn.path[Di]);for(var rn=1;rn<Hn.path.length;rn++)Bn.push(Hn.path[rn]);var oi=2.5*vr;if(L){var ci=Bn.map(function(Jo){return Ii(Jo,L)});Bn=ci.some(function(Jo){return Jo.signedDistanceFromCamera<=0})?[]:ci.map(function(Jo){return Jo.point})}var Qn=[];if(Bn.length>0){for(var Xn=Bn[0].clone(),di=Bn[0].clone(),$n=1;$n<Bn.length;$n++)Xn.x=Math.min(Xn.x,Bn[$n].x),Xn.y=Math.min(Xn.y,Bn[$n].y),di.x=Math.max(di.x,Bn[$n].x),di.y=Math.max(di.y,Bn[$n].y);Qn=Xn.x>=Dr.x&&di.x<=_r.x&&Xn.y>=Dr.y&&di.y<=_r.y?[Bn]:di.x<Dr.x||Xn.x>_r.x||di.y<Dr.y||Xn.y>_r.y?[]:g.clipLine([Bn],Dr.x,Dr.y,_r.x,_r.y)}for(var qn=0,yo=Qn;qn<yo.length;qn+=1){var Qa;ln.reset(yo[qn],.25*vr),Qa=ln.length<=.5*vr?1:Math.ceil(ln.paddedLength/oi)+1;for(var To=0;To<Qa;To++){var ia=To/Math.max(Qa-1,1),Ha=ln.lerp(ia),fo=Ha.x+100,Rs=Ha.y+100;ke.push(fo,Rs,vr,0);var us=fo-vr,Bu=Rs-vr,ls=fo+vr,nu=Rs+vr;if(Yt=Yt&&this.isOffscreen(us,Bu,ls,nu),Ut=Ut||this.isInsideGrid(us,Bu,ls,nu),!l&&this.grid.hitTestCircle(fo,Rs,vr,se)&&(Gt=!0,!Z))return{circles:[],offscreen:!1,collisionDetected:Gt}}}}return{circles:!Z&&Gt||!Ut?[]:ke,offscreen:Yt,collisionDetected:Gt}},qa.prototype.queryRenderedSymbols=function(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var h=[],c=1/0,d=1/0,E=-1/0,w=-1/0,P=0,L=l;P<L.length;P+=1){var Z=L[P],X=new g.Point(Z.x+100,Z.y+100);c=Math.min(c,X.x),d=Math.min(d,X.y),E=Math.max(E,X.x),w=Math.max(w,X.y),h.push(X)}for(var se={},fe={},de=0,ke=this.grid.query(c,d,E,w).concat(this.ignoredGrid.query(c,d,E,w));de<ke.length;de+=1){var Oe=ke[de],ze=Oe.key;if(se[ze.bucketInstanceId]===void 0&&(se[ze.bucketInstanceId]={}),!se[ze.bucketInstanceId][ze.featureIndex]){var Ce=[new g.Point(Oe.x1,Oe.y1),new g.Point(Oe.x2,Oe.y1),new g.Point(Oe.x2,Oe.y2),new g.Point(Oe.x1,Oe.y2)];g.polygonIntersectsPolygon(h,Ce)&&(se[ze.bucketInstanceId][ze.featureIndex]=!0,fe[ze.bucketInstanceId]===void 0&&(fe[ze.bucketInstanceId]=[]),fe[ze.bucketInstanceId].push(ze.featureIndex))}}return fe},qa.prototype.insertCollisionBox=function(l,h,c,d,E){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:d,collisionGroupID:E},l[0],l[1],l[2],l[3])},qa.prototype.insertCollisionCircles=function(l,h,c,d,E){for(var w=h?this.ignoredGrid:this.grid,P={bucketInstanceId:c,featureIndex:d,collisionGroupID:E},L=0;L<l.length;L+=4)w.insertCircle(P,l[L],l[L+1],l[L+2])},qa.prototype.projectAndGetPerspectiveRatio=function(l,h,c){var d=[h,c,0,1];return Ma(d,d,l),{point:new g.Point((d[0]/d[3]+1)/2*this.transform.width+100,(-d[1]/d[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/d[3]*.5}},qa.prototype.isOffscreen=function(l,h,c,d){return c<100||l>=this.screenRightBoundary||d<100||h>this.screenBottomBoundary},qa.prototype.isInsideGrid=function(l,h,c,d){return c>=0&&l<this.gridRightBoundary&&d>=0&&h<this.gridBottomBoundary},qa.prototype.getViewportMatrix=function(){var l=g.identity([]);return g.translate(l,l,[-100,-100,0]),l};var Ao=function(l,h,c,d){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?h:-h))):d&&c?1:0,this.placed=c};Ao.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var jo=function(l,h,c,d,E){this.text=new Ao(l?l.text:null,h,c,E),this.icon=new Ao(l?l.icon:null,h,d,E)};jo.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var wu=function(l,h,c){this.text=l,this.icon=h,this.skipFade=c},vo=function(){this.invProjMatrix=g.create(),this.viewportMatrix=g.create(),this.circles=[]},Do=function(l,h,c,d,E){this.bucketInstanceId=l,this.featureIndex=h,this.sourceLayerIndex=c,this.bucketIndex=d,this.tileID=E},sa=function(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}};function Ka(l,h,c,d,E){var w=g.getAnchorAlignment(l),P=-(w.horizontalAlign-.5)*h,L=-(w.verticalAlign-.5)*c,Z=g.evaluateVariableOffset(l,d);return new g.Point(P+Z[0]*E,L+Z[1]*E)}function Fo(l,h,c,d,E,w){var P=l.x1,L=l.x2,Z=l.y1,X=l.y2,se=l.anchorPointX,fe=l.anchorPointY,de=new g.Point(h,c);return d&&de._rotate(E?w:-w),{x1:P+de.x,y1:Z+de.y,x2:L+de.x,y2:X+de.y,anchorPointX:se,anchorPointY:fe}}sa.prototype.get=function(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){var h=++this.maxGroupID;this.collisionGroups[l]={ID:h,predicate:function(c){return c.collisionGroupID===h}}}return this.collisionGroups[l]};var $a=function(l,h,c,d){this.transform=l.clone(),this.collisionIndex=new qa(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new sa(c),this.collisionCircleArrays={},this.prevPlacement=d,d&&(d.prevPlacement=void 0),this.placedOrientations={}};function Ms(l,h,c,d,E){l.emplaceBack(h?1:0,c?1:0,d||0,E||0),l.emplaceBack(h?1:0,c?1:0,d||0,E||0),l.emplaceBack(h?1:0,c?1:0,d||0,E||0),l.emplaceBack(h?1:0,c?1:0,d||0,E||0)}$a.prototype.getBucketParts=function(l,h,c,d){var E=c.getBucket(h),w=c.latestFeatureIndex;if(E&&w&&h.id===E.layerIds[0]){var P=c.collisionBoxArray,L=E.layers[0].layout,Z=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),X=c.tileSize/g.EXTENT,se=this.transform.calculatePosMatrix(c.tileID.toUnwrapped()),fe=L.get("text-pitch-alignment")==="map",de=L.get("text-rotation-alignment")==="map",ke=oa(c,1,this.transform.zoom),Oe=Ta(se,fe,de,this.transform,ke),ze=null;if(fe){var Ce=Si(se,fe,de,this.transform,ke);ze=g.multiply([],this.transform.labelPlaneMatrix,Ce)}this.retainedQueryData[E.bucketInstanceId]=new Do(E.bucketInstanceId,w,E.sourceLayerIndex,E.index,c.tileID);var je={bucket:E,layout:L,posMatrix:se,textLabelPlaneMatrix:Oe,labelToScreenMatrix:ze,scale:Z,textPixelRatio:X,holdingForFade:c.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:g.evaluateSizeForZoom(E.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(E.sourceID)};if(d)for(var Qe=0,gt=E.sortKeyRanges;Qe<gt.length;Qe+=1){var Gt=gt[Qe];l.push({sortKey:Gt.sortKey,symbolInstanceStart:Gt.symbolInstanceStart,symbolInstanceEnd:Gt.symbolInstanceEnd,parameters:je})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:je})}},$a.prototype.attemptAnchorPlacement=function(l,h,c,d,E,w,P,L,Z,X,se,fe,de,ke,Oe){var ze,Ce=[fe.textOffset0,fe.textOffset1],je=Ka(l,c,d,Ce,E),Qe=this.collisionIndex.placeCollisionBox(Fo(h,je.x,je.y,w,P,this.transform.angle),se,L,Z,X.predicate);if(!Oe||this.collisionIndex.placeCollisionBox(Fo(Oe,je.x,je.y,w,P,this.transform.angle),se,L,Z,X.predicate).box.length!==0)return Qe.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[fe.crossTileID]&&this.prevPlacement.placements[fe.crossTileID]&&this.prevPlacement.placements[fe.crossTileID].text&&(ze=this.prevPlacement.variableOffsets[fe.crossTileID].anchor),this.variableOffsets[fe.crossTileID]={textOffset:Ce,width:c,height:d,anchor:l,textBoxScale:E,prevAnchor:ze},this.markUsedJustification(de,l,fe,ke),de.allowVerticalPlacement&&(this.markUsedOrientation(de,ke,fe),this.placedOrientations[fe.crossTileID]=ke),{shift:je,placedGlyphBoxes:Qe}):void 0},$a.prototype.placeLayerBucketPart=function(l,h,c){var d=this,E=l.parameters,w=E.bucket,P=E.layout,L=E.posMatrix,Z=E.textLabelPlaneMatrix,X=E.labelToScreenMatrix,se=E.textPixelRatio,fe=E.holdingForFade,de=E.collisionBoxArray,ke=E.partiallyEvaluatedTextSize,Oe=E.collisionGroup,ze=P.get("text-optional"),Ce=P.get("icon-optional"),je=P.get("text-allow-overlap"),Qe=P.get("icon-allow-overlap"),gt=P.get("text-rotation-alignment")==="map",Gt=P.get("text-pitch-alignment")==="map",Ut=P.get("icon-text-fit")!=="none",Yt=P.get("symbol-z-order")==="viewport-y",vr=je&&(Qe||!w.hasIconData()||Ce),Dr=Qe&&(je||!w.hasTextData()||ze);!w.collisionArrays&&de&&w.deserializeCollisionBoxes(de);var _r=function(rn,oi){if(!h[rn.crossTileID])if(fe)d.placements[rn.crossTileID]=new wu(!1,!1,!1);else{var ci,Qn=!1,Xn=!1,di=!0,$n=null,qn={box:null,offscreen:null},yo={box:null,offscreen:null},Qa=null,To=null,ia=0,Ha=0,fo=0;oi.textFeatureIndex?ia=oi.textFeatureIndex:rn.useRuntimeCollisionCircles&&(ia=rn.featureIndex),oi.verticalTextFeatureIndex&&(Ha=oi.verticalTextFeatureIndex);var Rs=oi.textBox;if(Rs){var us=function(ua){var Zs=g.WritingMode.horizontal;if(w.allowVerticalPlacement&&!ua&&d.prevPlacement){var es=d.prevPlacement.placedOrientations[rn.crossTileID];es&&(d.placedOrientations[rn.crossTileID]=es,d.markUsedOrientation(w,Zs=es,rn))}return Zs},Bu=function(ua,Zs){if(w.allowVerticalPlacement&&rn.numVerticalGlyphVertices>0&&oi.verticalTextBox)for(var es=0,_u=w.writingModes;es<_u.length&&(_u[es]===g.WritingMode.vertical?(qn=Zs(),yo=qn):qn=ua(),!(qn&&qn.box&&qn.box.length));es+=1);else qn=ua()};if(P.get("text-variable-anchor")){var ls=P.get("text-variable-anchor");if(d.prevPlacement&&d.prevPlacement.variableOffsets[rn.crossTileID]){var nu=d.prevPlacement.variableOffsets[rn.crossTileID];ls.indexOf(nu.anchor)>0&&(ls=ls.filter(function(ua){return ua!==nu.anchor})).unshift(nu.anchor)}var Jo=function(ua,Zs,es){for(var _u=ua.x2-ua.x1,qc=ua.y2-ua.y1,Kc=rn.textBoxScale,Pf=Ut&&!Qe?Zs:null,au={box:[],offscreen:!1},mc=je?2*ls.length:ls.length,ou=0;ou<mc;++ou){var bl=d.attemptAnchorPlacement(ls[ou%ls.length],ua,_u,qc,Kc,gt,Gt,se,L,Oe,ou>=ls.length,rn,w,es,Pf);if(bl&&(au=bl.placedGlyphBoxes)&&au.box&&au.box.length){Qn=!0,$n=bl.shift;break}}return au};Bu(function(){return Jo(Rs,oi.iconBox,g.WritingMode.horizontal)},function(){var ua=oi.verticalTextBox;return w.allowVerticalPlacement&&!(qn&&qn.box&&qn.box.length)&&rn.numVerticalGlyphVertices>0&&ua?Jo(ua,oi.verticalIconBox,g.WritingMode.vertical):{box:null,offscreen:null}}),qn&&(Qn=qn.box,di=qn.offscreen);var cs=us(qn&&qn.box);if(!Qn&&d.prevPlacement){var Wl=d.prevPlacement.variableOffsets[rn.crossTileID];Wl&&(d.variableOffsets[rn.crossTileID]=Wl,d.markUsedJustification(w,Wl.anchor,rn,cs))}}else{var Nu=function(ua,Zs){var es=d.collisionIndex.placeCollisionBox(ua,je,se,L,Oe.predicate);return es&&es.box&&es.box.length&&(d.markUsedOrientation(w,Zs,rn),d.placedOrientations[rn.crossTileID]=Zs),es};Bu(function(){return Nu(Rs,g.WritingMode.horizontal)},function(){var ua=oi.verticalTextBox;return w.allowVerticalPlacement&&rn.numVerticalGlyphVertices>0&&ua?Nu(ua,g.WritingMode.vertical):{box:null,offscreen:null}}),us(qn&&qn.box&&qn.box.length)}}if(Qn=(ci=qn)&&ci.box&&ci.box.length>0,di=ci&&ci.offscreen,rn.useRuntimeCollisionCircles){var _l=w.text.placedSymbolArray.get(rn.centerJustifiedTextSymbolIndex),Xl=g.evaluateSizeForFeature(w.textSizeData,ke,_l),iu=P.get("text-padding");Qa=d.collisionIndex.placeCollisionCircles(je,_l,w.lineVertexArray,w.glyphOffsetArray,Xl,L,Z,X,c,Gt,Oe.predicate,rn.collisionCircleDiameter,iu),Qn=je||Qa.circles.length>0&&!Qa.collisionDetected,di=di&&Qa.offscreen}if(oi.iconFeatureIndex&&(fo=oi.iconFeatureIndex),oi.iconBox){var xl=function(ua){var Zs=Ut&&$n?Fo(ua,$n.x,$n.y,gt,Gt,d.transform.angle):ua;return d.collisionIndex.placeCollisionBox(Zs,Qe,se,L,Oe.predicate)};Xn=yo&&yo.box&&yo.box.length&&oi.verticalIconBox?(To=xl(oi.verticalIconBox)).box.length>0:(To=xl(oi.iconBox)).box.length>0,di=di&&To.offscreen}var Su=ze||rn.numHorizontalGlyphVertices===0&&rn.numVerticalGlyphVertices===0,Eo=Ce||rn.numIconVertices===0;if(Su||Eo?Eo?Su||(Xn=Xn&&Qn):Qn=Xn&&Qn:Xn=Qn=Xn&&Qn,Qn&&ci&&ci.box&&d.collisionIndex.insertCollisionBox(ci.box,P.get("text-ignore-placement"),w.bucketInstanceId,yo&&yo.box&&Ha?Ha:ia,Oe.ID),Xn&&To&&d.collisionIndex.insertCollisionBox(To.box,P.get("icon-ignore-placement"),w.bucketInstanceId,fo,Oe.ID),Qa&&(Qn&&d.collisionIndex.insertCollisionCircles(Qa.circles,P.get("text-ignore-placement"),w.bucketInstanceId,ia,Oe.ID),c)){var zu=w.bucketInstanceId,Zu=d.collisionCircleArrays[zu];Zu===void 0&&(Zu=d.collisionCircleArrays[zu]=new vo);for(var tl=0;tl<Qa.circles.length;tl+=4)Zu.circles.push(Qa.circles[tl+0]),Zu.circles.push(Qa.circles[tl+1]),Zu.circles.push(Qa.circles[tl+2]),Zu.circles.push(Qa.collisionDetected?1:0)}d.placements[rn.crossTileID]=new wu(Qn||vr,Xn||Dr,di||w.justReloaded),h[rn.crossTileID]=!0}};if(Yt)for(var ln=w.getSortedSymbolIndexes(this.transform.angle),Gn=ln.length-1;Gn>=0;--Gn){var Hn=ln[Gn];_r(w.symbolInstances.get(Hn),w.collisionArrays[Hn])}else for(var Bn=l.symbolInstanceStart;Bn<l.symbolInstanceEnd;Bn++)_r(w.symbolInstances.get(Bn),w.collisionArrays[Bn]);if(c&&w.bucketInstanceId in this.collisionCircleArrays){var Di=this.collisionCircleArrays[w.bucketInstanceId];g.invert(Di.invProjMatrix,L),Di.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1},$a.prototype.markUsedJustification=function(l,h,c,d){var E;E=d===g.WritingMode.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[g.getAnchorJustification(h)];for(var w=0,P=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];w<P.length;w+=1){var L=P[w];L>=0&&(l.text.placedSymbolArray.get(L).crossTileID=E>=0&&L!==E?0:c.crossTileID)}},$a.prototype.markUsedOrientation=function(l,h,c){for(var d=h===g.WritingMode.horizontal||h===g.WritingMode.horizontalOnly?h:0,E=h===g.WritingMode.vertical?h:0,w=0,P=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];w<P.length;w+=1)l.text.placedSymbolArray.get(P[w]).placedOrientation=d;c.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=E)},$a.prototype.commit=function(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;var h=this.prevPlacement,c=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;var d=h?h.symbolFadeChange(l):1,E=h?h.opacities:{},w=h?h.variableOffsets:{},P=h?h.placedOrientations:{};for(var L in this.placements){var Z=this.placements[L],X=E[L];X?(this.opacities[L]=new jo(X,d,Z.text,Z.icon),c=c||Z.text!==X.text.placed||Z.icon!==X.icon.placed):(this.opacities[L]=new jo(null,d,Z.text,Z.icon,Z.skipFade),c=c||Z.text||Z.icon)}for(var se in E){var fe=E[se];if(!this.opacities[se]){var de=new jo(fe,d,!1,!1);de.isHidden()||(this.opacities[se]=de,c=c||fe.text.placed||fe.icon.placed)}}for(var ke in w)this.variableOffsets[ke]||!this.opacities[ke]||this.opacities[ke].isHidden()||(this.variableOffsets[ke]=w[ke]);for(var Oe in P)this.placedOrientations[Oe]||!this.opacities[Oe]||this.opacities[Oe].isHidden()||(this.placedOrientations[Oe]=P[Oe]);c?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:l)},$a.prototype.updateLayerOpacities=function(l,h){for(var c={},d=0,E=h;d<E.length;d+=1){var w=E[d],P=w.getBucket(l);P&&w.latestFeatureIndex&&l.id===P.layerIds[0]&&this.updateBucketOpacities(P,c,w.collisionBoxArray)}},$a.prototype.updateBucketOpacities=function(l,h,c){var d=this;l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();var E=l.layers[0].layout,w=new jo(null,0,!1,!1,!0),P=E.get("text-allow-overlap"),L=E.get("icon-allow-overlap"),Z=E.get("text-variable-anchor"),X=E.get("text-rotation-alignment")==="map",se=E.get("text-pitch-alignment")==="map",fe=E.get("icon-text-fit")!=="none",de=new jo(null,0,P&&(L||!l.hasIconData()||E.get("icon-optional")),L&&(P||!l.hasTextData()||E.get("text-optional")),!0);!l.collisionArrays&&c&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(c);for(var ke=function(je,Qe,gt){for(var Gt=0;Gt<Qe/4;Gt++)je.opacityVertexArray.emplaceBack(gt)},Oe=function(je){var Qe=l.symbolInstances.get(je),gt=Qe.numHorizontalGlyphVertices,Gt=Qe.numVerticalGlyphVertices,Ut=Qe.crossTileID,Yt=d.opacities[Ut];h[Ut]?Yt=w:Yt||(d.opacities[Ut]=Yt=de),h[Ut]=!0;var vr=Qe.numIconVertices>0,Dr=d.placedOrientations[Qe.crossTileID],_r=Dr===g.WritingMode.vertical,ln=Dr===g.WritingMode.horizontal||Dr===g.WritingMode.horizontalOnly;if(gt>0||Gt>0){var Gn=kn(Yt.text);ke(l.text,gt,_r?Oi:Gn),ke(l.text,Gt,ln?Oi:Gn);var Hn=Yt.text.isHidden();[Qe.rightJustifiedTextSymbolIndex,Qe.centerJustifiedTextSymbolIndex,Qe.leftJustifiedTextSymbolIndex].forEach(function(qn){qn>=0&&(l.text.placedSymbolArray.get(qn).hidden=Hn||_r?1:0)}),Qe.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(Qe.verticalPlacedTextSymbolIndex).hidden=Hn||ln?1:0);var Bn=d.variableOffsets[Qe.crossTileID];Bn&&d.markUsedJustification(l,Bn.anchor,Qe,Dr);var Di=d.placedOrientations[Qe.crossTileID];Di&&(d.markUsedJustification(l,"left",Qe,Di),d.markUsedOrientation(l,Di,Qe))}if(vr){var rn=kn(Yt.icon),oi=!(fe&&Qe.verticalPlacedIconSymbolIndex&&_r);Qe.placedIconSymbolIndex>=0&&(ke(l.icon,Qe.numIconVertices,oi?rn:Oi),l.icon.placedSymbolArray.get(Qe.placedIconSymbolIndex).hidden=Yt.icon.isHidden()),Qe.verticalPlacedIconSymbolIndex>=0&&(ke(l.icon,Qe.numVerticalIconVertices,oi?Oi:rn),l.icon.placedSymbolArray.get(Qe.verticalPlacedIconSymbolIndex).hidden=Yt.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){var ci=l.collisionArrays[je];if(ci){var Qn=new g.Point(0,0);if(ci.textBox||ci.verticalTextBox){var Xn=!0;if(Z){var di=d.variableOffsets[Ut];di?(Qn=Ka(di.anchor,di.width,di.height,di.textOffset,di.textBoxScale),X&&Qn._rotate(se?d.transform.angle:-d.transform.angle)):Xn=!1}ci.textBox&&Ms(l.textCollisionBox.collisionVertexArray,Yt.text.placed,!Xn||_r,Qn.x,Qn.y),ci.verticalTextBox&&Ms(l.textCollisionBox.collisionVertexArray,Yt.text.placed,!Xn||ln,Qn.x,Qn.y)}var $n=Boolean(!ln&&ci.verticalIconBox);ci.iconBox&&Ms(l.iconCollisionBox.collisionVertexArray,Yt.icon.placed,$n,fe?Qn.x:0,fe?Qn.y:0),ci.verticalIconBox&&Ms(l.iconCollisionBox.collisionVertexArray,Yt.icon.placed,!$n,fe?Qn.x:0,fe?Qn.y:0)}}},ze=0;ze<l.symbolInstances.length;ze++)Oe(ze);if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){var Ce=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=Ce.invProjMatrix,l.placementViewportMatrix=Ce.viewportMatrix,l.collisionCircleArray=Ce.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}},$a.prototype.symbolFadeChange=function(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},$a.prototype.zoomAdjustment=function(l){return Math.max(0,(this.transform.zoom-l)/1.5)},$a.prototype.hasTransitions=function(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration},$a.prototype.stillRecent=function(l,h){var c=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*c>l},$a.prototype.setStale=function(){this.stale=!0};var Il=Math.pow(2,25),_s=Math.pow(2,24),re=Math.pow(2,17),Se=Math.pow(2,16),Ye=Math.pow(2,9),Rt=Math.pow(2,8),Or=Math.pow(2,1);function kn(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;var h=l.placed?1:0,c=Math.floor(127*l.opacity);return c*Il+h*_s+c*re+h*Se+c*Ye+h*Rt+c*Or+h}var Oi=0,ao=function(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};ao.prototype.continuePlacement=function(l,h,c,d,E){for(var w=this._bucketParts;this._currentTileIndex<l.length;)if(h.getBucketParts(w,d,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,E())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort(function(P,L){return P.sortKey-L.sortKey}));this._currentPartIndex<w.length;)if(h.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,E())return!0;return!1};var Ra=function(l,h,c,d,E,w,P){this.placement=new $a(l,E,w,P),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=d,this._done=!1};Ra.prototype.isDone=function(){return this._done},Ra.prototype.continuePlacement=function(l,h,c){for(var d=this,E=g.browser.now(),w=function(){var Z=g.browser.now()-E;return!d._forceFullPlacement&&Z>2};this._currentPlacementIndex>=0;){var P=h[l[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(P.type==="symbol"&&(!P.minzoom||P.minzoom<=L)&&(!P.maxzoom||P.maxzoom>L)){if(this._inProgressLayer||(this._inProgressLayer=new ao(P)),this._inProgressLayer.continuePlacement(c[P.source],this.placement,this._showCollisionBoxes,P,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Ra.prototype.commit=function(l){return this.placement.commit(l),this.placement};var Za=512/g.EXTENT/2,Vo=function(l,h,c){this.tileID=l,this.indexedSymbolInstances={},this.bucketInstanceId=c;for(var d=0;d<h.length;d++){var E=h.get(d),w=E.key;this.indexedSymbolInstances[w]||(this.indexedSymbolInstances[w]=[]),this.indexedSymbolInstances[w].push({crossTileID:E.crossTileID,coord:this.getScaledCoordinates(E,l)})}};Vo.prototype.getScaledCoordinates=function(l,h){var c=Za/Math.pow(2,h.canonical.z-this.tileID.canonical.z);return{x:Math.floor((h.canonical.x*g.EXTENT+l.anchorX)*c),y:Math.floor((h.canonical.y*g.EXTENT+l.anchorY)*c)}},Vo.prototype.findMatches=function(l,h,c){for(var d=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z),E=0;E<l.length;E++){var w=l.get(E);if(!w.crossTileID){var P=this.indexedSymbolInstances[w.key];if(P)for(var L=this.getScaledCoordinates(w,h),Z=0,X=P;Z<X.length;Z+=1){var se=X[Z];if(Math.abs(se.coord.x-L.x)<=d&&Math.abs(se.coord.y-L.y)<=d&&!c[se.crossTileID]){c[se.crossTileID]=!0,w.crossTileID=se.crossTileID;break}}}}};var xs=function(){this.maxCrossTileID=0};xs.prototype.generate=function(){return++this.maxCrossTileID};var uo=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};uo.prototype.handleWrapJump=function(l){var h=Math.round((l-this.lng)/360);if(h!==0)for(var c in this.indexes){var d=this.indexes[c],E={};for(var w in d){var P=d[w];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+h),E[P.tileID.key]=P}this.indexes[c]=E}this.lng=l},uo.prototype.addBucket=function(l,h,c){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(var d=0;d<h.symbolInstances.length;d++)h.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});var E=this.usedCrossTileIDs[l.overscaledZ];for(var w in this.indexes){var P=this.indexes[w];if(Number(w)>l.overscaledZ)for(var L in P){var Z=P[L];Z.tileID.isChildOf(l)&&Z.findMatches(h.symbolInstances,l,E)}else{var X=P[l.scaledTo(Number(w)).key];X&&X.findMatches(h.symbolInstances,l,E)}}for(var se=0;se<h.symbolInstances.length;se++){var fe=h.symbolInstances.get(se);fe.crossTileID||(fe.crossTileID=c.generate(),E[fe.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Vo(l,h.symbolInstances,h.bucketInstanceId),!0},uo.prototype.removeBucketCrossTileIDs=function(l,h){for(var c in h.indexedSymbolInstances)for(var d=0,E=h.indexedSymbolInstances[c];d<E.length;d+=1)delete this.usedCrossTileIDs[l][E[d].crossTileID]},uo.prototype.removeStaleBuckets=function(l){var h=!1;for(var c in this.indexes){var d=this.indexes[c];for(var E in d)l[d[E].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,d[E]),delete d[E],h=!0)}return h};var wo=function(){this.layerIndexes={},this.crossTileIDs=new xs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};wo.prototype.addLayer=function(l,h,c){var d=this.layerIndexes[l.id];d===void 0&&(d=this.layerIndexes[l.id]=new uo);var E=!1,w={};d.handleWrapJump(c);for(var P=0,L=h;P<L.length;P+=1){var Z=L[P],X=Z.getBucket(l);X&&l.id===X.layerIds[0]&&(X.bucketInstanceId||(X.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(Z.tileID,X,this.crossTileIDs)&&(E=!0),w[X.bucketInstanceId]=!0)}return d.removeStaleBuckets(w)&&(E=!0),E},wo.prototype.pruneUnusedLayers=function(l){var h={};for(var c in l.forEach(function(d){h[d]=!0}),this.layerIndexes)h[c]||delete this.layerIndexes[c]};var bs=function(l,h){return g.emitValidationErrors(l,h&&h.filter(function(c){return c.identifier!=="source.canvas"}))},Ps=g.pick(Xr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Fs=g.pick(Xr,["setCenter","setZoom","setBearing","setPitch"]),fu=function(){var l={},h=g.styleSpec.$version;for(var c in g.styleSpec.$root){var d,E=g.styleSpec.$root[c];E.required&&(d=c==="version"?h:E.type==="array"?[]:{})!=null&&(l[c]=d)}return l}(),Es=function(l){function h(c,d){var E=this;d===void 0&&(d={}),l.call(this),this.map=c,this.dispatcher=new Ht(Pt(),this),this.imageManager=new Mt,this.imageManager.setEventedParent(this),this.glyphManager=new Xt(c._requestManager,d.localIdeographFontFamily),this.lineAtlas=new et(256,512),this.crossTileSymbolIndex=new wo,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new g.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",g.getReferrer());var w=this;this._rtlTextPluginCallback=h.registerForPluginStateChange(function(P){w.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:P.pluginStatus,pluginURL:P.pluginURL},function(L,Z){if(g.triggerPluginCompletionEvent(L),Z&&Z.every(function(se){return se}))for(var X in w.sourceCaches)w.sourceCaches[X].reload()})}),this.on("data",function(P){if(P.dataType==="source"&&P.sourceDataType==="metadata"){var L=E.sourceCaches[P.sourceId];if(L){var Z=L.getSource();if(Z&&Z.vectorLayerIds)for(var X in E._layers){var se=E._layers[X];se.source===Z.id&&E._validateLayer(se)}}}})}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.loadURL=function(c,d){var E=this;d===void 0&&(d={}),this.fire(new g.Event("dataloading",{dataType:"style"}));var w=typeof d.validate=="boolean"?d.validate:!g.isMapboxURL(c);c=this.map._requestManager.normalizeStyleURL(c,d.accessToken);var P=this.map._requestManager.transformRequest(c,g.ResourceType.Style);this._request=g.getJSON(P,function(L,Z){E._request=null,L?E.fire(new g.ErrorEvent(L)):Z&&E._load(Z,w)})},h.prototype.loadJSON=function(c,d){var E=this;d===void 0&&(d={}),this.fire(new g.Event("dataloading",{dataType:"style"})),this._request=g.browser.frame(function(){E._request=null,E._load(c,d.validate!==!1)})},h.prototype.loadEmpty=function(){this.fire(new g.Event("dataloading",{dataType:"style"})),this._load(fu,!1)},h.prototype._load=function(c,d){if(!d||!bs(this,g.validateStyle(c))){for(var E in this._loaded=!0,this.stylesheet=c,c.sources)this.addSource(E,c.sources[E],{validate:!1});c.sprite?this._loadSprite(c.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(c.glyphs);var w=zr(this.stylesheet.layers);this._order=w.map(function(X){return X.id}),this._layers={},this._serializedLayers={};for(var P=0,L=w;P<L.length;P+=1){var Z=L[P];(Z=g.createStyleLayer(Z)).setEventedParent(this,{layer:{id:Z.id}}),this._layers[Z.id]=Z,this._serializedLayers[Z.id]=Z.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new St(this.stylesheet.light),this.fire(new g.Event("data",{dataType:"style"})),this.fire(new g.Event("style.load"))}},h.prototype._loadSprite=function(c){var d=this;this._spriteRequest=function(E,w,P){var L,Z,X,se=g.browser.devicePixelRatio>1?"@2x":"",fe=g.getJSON(w.transformRequest(w.normalizeSpriteURL(E,se,".json"),g.ResourceType.SpriteJSON),function(Oe,ze){fe=null,X||(X=Oe,L=ze,ke())}),de=g.getImage(w.transformRequest(w.normalizeSpriteURL(E,se,".png"),g.ResourceType.SpriteImage),function(Oe,ze){de=null,X||(X=Oe,Z=ze,ke())});function ke(){if(X)P(X);else if(L&&Z){var Oe=g.browser.getImageData(Z),ze={};for(var Ce in L){var je=L[Ce],Qe=je.width,gt=je.height,Gt=je.x,Ut=je.y,Yt=je.sdf,vr=je.pixelRatio,Dr=je.stretchX,_r=je.stretchY,ln=je.content,Gn=new g.RGBAImage({width:Qe,height:gt});g.RGBAImage.copy(Oe,Gn,{x:Gt,y:Ut},{x:0,y:0},{width:Qe,height:gt}),ze[Ce]={data:Gn,pixelRatio:vr,sdf:Yt,stretchX:Dr,stretchY:_r,content:ln}}P(null,ze)}}return{cancel:function(){fe&&(fe.cancel(),fe=null),de&&(de.cancel(),de=null)}}}(c,this.map._requestManager,function(E,w){if(d._spriteRequest=null,E)d.fire(new g.ErrorEvent(E));else if(w)for(var P in w)d.imageManager.addImage(P,w[P]);d.imageManager.setLoaded(!0),d._availableImages=d.imageManager.listImages(),d.dispatcher.broadcast("setImages",d._availableImages),d.fire(new g.Event("data",{dataType:"style"}))})},h.prototype._validateLayer=function(c){var d=this.sourceCaches[c.source];if(d){var E=c.sourceLayer;if(E){var w=d.getSource();(w.type==="geojson"||w.vectorLayerIds&&w.vectorLayerIds.indexOf(E)===-1)&&this.fire(new g.ErrorEvent(new Error('Source layer "'+E+'" does not exist on source "'+w.id+'" as specified by style layer "'+c.id+'"')))}}},h.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var c in this.sourceCaches)if(!this.sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()},h.prototype._serializeLayers=function(c){for(var d=[],E=0,w=c;E<w.length;E+=1){var P=this._layers[w[E]];P.type!=="custom"&&d.push(P.serialize())}return d},h.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var c in this.sourceCaches)if(this.sourceCaches[c].hasTransition())return!0;for(var d in this._layers)if(this._layers[d].hasTransition())return!0;return!1},h.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},h.prototype.update=function(c){if(this._loaded){var d=this._changed;if(this._changed){var E=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);for(var P in(E.length||w.length)&&this._updateWorkerLayers(E,w),this._updatedSources){var L=this._updatedSources[P];L==="reload"?this._reloadSource(P):L==="clear"&&this._clearSource(P)}for(var Z in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[Z].updateTransitions(c);this.light.updateTransitions(c),this._resetUpdates()}var X={};for(var se in this.sourceCaches){var fe=this.sourceCaches[se];X[se]=fe.used,fe.used=!1}for(var de=0,ke=this._order;de<ke.length;de+=1){var Oe=this._layers[ke[de]];Oe.recalculate(c,this._availableImages),!Oe.isHidden(c.zoom)&&Oe.source&&(this.sourceCaches[Oe.source].used=!0)}for(var ze in X){var Ce=this.sourceCaches[ze];X[ze]!==Ce.used&&Ce.fire(new g.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:ze}))}this.light.recalculate(c),this.z=c.zoom,d&&this.fire(new g.Event("data",{dataType:"style"}))}},h.prototype._updateTilesForChangedImages=function(){var c=Object.keys(this._changedImages);if(c.length){for(var d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}},h.prototype._updateWorkerLayers=function(c,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(c),removedIds:d})},h.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},h.prototype.setState=function(c){var d=this;if(this._checkLoaded(),bs(this,g.validateStyle(c)))return!1;(c=g.clone$1(c)).layers=zr(c.layers);var E=function(P,L){if(!P)return[{command:Xr.setStyle,args:[L]}];var Z=[];try{if(!g.deepEqual(P.version,L.version))return[{command:Xr.setStyle,args:[L]}];g.deepEqual(P.center,L.center)||Z.push({command:Xr.setCenter,args:[L.center]}),g.deepEqual(P.zoom,L.zoom)||Z.push({command:Xr.setZoom,args:[L.zoom]}),g.deepEqual(P.bearing,L.bearing)||Z.push({command:Xr.setBearing,args:[L.bearing]}),g.deepEqual(P.pitch,L.pitch)||Z.push({command:Xr.setPitch,args:[L.pitch]}),g.deepEqual(P.sprite,L.sprite)||Z.push({command:Xr.setSprite,args:[L.sprite]}),g.deepEqual(P.glyphs,L.glyphs)||Z.push({command:Xr.setGlyphs,args:[L.glyphs]}),g.deepEqual(P.transition,L.transition)||Z.push({command:Xr.setTransition,args:[L.transition]}),g.deepEqual(P.light,L.light)||Z.push({command:Xr.setLight,args:[L.light]});var X={},se=[];(function(de,ke,Oe,ze){var Ce;for(Ce in ke=ke||{},de=de||{})de.hasOwnProperty(Ce)&&(ke.hasOwnProperty(Ce)||tn(Ce,Oe,ze));for(Ce in ke)ke.hasOwnProperty(Ce)&&(de.hasOwnProperty(Ce)?g.deepEqual(de[Ce],ke[Ce])||(de[Ce].type==="geojson"&&ke[Ce].type==="geojson"&&Xi(de,ke,Ce)?Oe.push({command:Xr.setGeoJSONSourceData,args:[Ce,ke[Ce].data]}):mn(Ce,ke,Oe,ze)):mi(Ce,ke,Oe))})(P.sources,L.sources,se,X);var fe=[];P.layers&&P.layers.forEach(function(de){X[de.source]?Z.push({command:Xr.removeLayer,args:[de.id]}):fe.push(de)}),Z=Z.concat(se),function(de,ke,Oe){ke=ke||[];var ze,Ce,je,Qe,gt,Gt,Ut,Yt=(de=de||[]).map(Pi),vr=ke.map(Pi),Dr=de.reduce(_i,{}),_r=ke.reduce(_i,{}),ln=Yt.slice(),Gn=Object.create(null);for(ze=0,Ce=0;ze<Yt.length;ze++)_r.hasOwnProperty(je=Yt[ze])?Ce++:(Oe.push({command:Xr.removeLayer,args:[je]}),ln.splice(ln.indexOf(je,Ce),1));for(ze=0,Ce=0;ze<vr.length;ze++)ln[ln.length-1-ze]!==(je=vr[vr.length-1-ze])&&(Dr.hasOwnProperty(je)?(Oe.push({command:Xr.removeLayer,args:[je]}),ln.splice(ln.lastIndexOf(je,ln.length-Ce),1)):Ce++,Oe.push({command:Xr.addLayer,args:[_r[je],Gt=ln[ln.length-ze]]}),ln.splice(ln.length-ze,0,je),Gn[je]=!0);for(ze=0;ze<vr.length;ze++)if(Qe=Dr[je=vr[ze]],gt=_r[je],!Gn[je]&&!g.deepEqual(Qe,gt))if(g.deepEqual(Qe.source,gt.source)&&g.deepEqual(Qe["source-layer"],gt["source-layer"])&&g.deepEqual(Qe.type,gt.type)){for(Ut in hi(Qe.layout,gt.layout,Oe,je,null,Xr.setLayoutProperty),hi(Qe.paint,gt.paint,Oe,je,null,Xr.setPaintProperty),g.deepEqual(Qe.filter,gt.filter)||Oe.push({command:Xr.setFilter,args:[je,gt.filter]}),g.deepEqual(Qe.minzoom,gt.minzoom)&&g.deepEqual(Qe.maxzoom,gt.maxzoom)||Oe.push({command:Xr.setLayerZoomRange,args:[je,gt.minzoom,gt.maxzoom]}),Qe)Qe.hasOwnProperty(Ut)&&Ut!=="layout"&&Ut!=="paint"&&Ut!=="filter"&&Ut!=="metadata"&&Ut!=="minzoom"&&Ut!=="maxzoom"&&(Ut.indexOf("paint.")===0?hi(Qe[Ut],gt[Ut],Oe,je,Ut.slice(6),Xr.setPaintProperty):g.deepEqual(Qe[Ut],gt[Ut])||Oe.push({command:Xr.setLayerProperty,args:[je,Ut,gt[Ut]]}));for(Ut in gt)gt.hasOwnProperty(Ut)&&!Qe.hasOwnProperty(Ut)&&Ut!=="layout"&&Ut!=="paint"&&Ut!=="filter"&&Ut!=="metadata"&&Ut!=="minzoom"&&Ut!=="maxzoom"&&(Ut.indexOf("paint.")===0?hi(Qe[Ut],gt[Ut],Oe,je,Ut.slice(6),Xr.setPaintProperty):g.deepEqual(Qe[Ut],gt[Ut])||Oe.push({command:Xr.setLayerProperty,args:[je,Ut,gt[Ut]]}))}else Oe.push({command:Xr.removeLayer,args:[je]}),Gt=ln[ln.lastIndexOf(je)+1],Oe.push({command:Xr.addLayer,args:[gt,Gt]})}(fe,L.layers,Z)}catch(de){console.warn("Unable to compute style diff:",de),Z=[{command:Xr.setStyle,args:[L]}]}return Z}(this.serialize(),c).filter(function(P){return!(P.command in Fs)});if(E.length===0)return!1;var w=E.filter(function(P){return!(P.command in Ps)});if(w.length>0)throw new Error("Unimplemented: "+w.map(function(P){return P.command}).join(", ")+".");return E.forEach(function(P){P.command!=="setTransition"&&d[P.command].apply(d,P.args)}),this.stylesheet=c,!0},h.prototype.addImage=function(c,d){if(this.getImage(c))return this.fire(new g.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(c,d),this._afterImageUpdated(c)},h.prototype.updateImage=function(c,d){this.imageManager.updateImage(c,d)},h.prototype.getImage=function(c){return this.imageManager.getImage(c)},h.prototype.removeImage=function(c){if(!this.getImage(c))return this.fire(new g.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(c),this._afterImageUpdated(c)},h.prototype._afterImageUpdated=function(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new g.Event("data",{dataType:"style"}))},h.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},h.prototype.addSource=function(c,d,E){var w=this;if(E===void 0&&(E={}),this._checkLoaded(),this.sourceCaches[c]!==void 0)throw new Error("There is already a source with this ID");if(!d.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(d).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(g.validateStyle.source,"sources."+c,d,null,E))){this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);var P=this.sourceCaches[c]=new Le(c,d,this.dispatcher);P.style=this,P.setEventedParent(this,function(){return{isSourceLoaded:w.loaded(),source:P.serialize(),sourceId:c}}),P.onAdd(this.map),this._changed=!0}},h.prototype.removeSource=function(c){if(this._checkLoaded(),this.sourceCaches[c]===void 0)throw new Error("There is no source with this ID");for(var d in this._layers)if(this._layers[d].source===c)return this.fire(new g.ErrorEvent(new Error('Source "'+c+'" cannot be removed while layer "'+d+'" is using it.')));var E=this.sourceCaches[c];delete this.sourceCaches[c],delete this._updatedSources[c],E.fire(new g.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:c})),E.setEventedParent(null),E.clearTiles(),E.onRemove&&E.onRemove(this.map),this._changed=!0},h.prototype.setGeoJSONSourceData=function(c,d){this._checkLoaded(),this.sourceCaches[c].getSource().setData(d),this._changed=!0},h.prototype.getSource=function(c){return this.sourceCaches[c]&&this.sourceCaches[c].getSource()},h.prototype.addLayer=function(c,d,E){E===void 0&&(E={}),this._checkLoaded();var w=c.id;if(this.getLayer(w))this.fire(new g.ErrorEvent(new Error('Layer with id "'+w+'" already exists on this map')));else{var P;if(c.type==="custom"){if(bs(this,g.validateCustomStyleLayer(c)))return;P=g.createStyleLayer(c)}else{if(typeof c.source=="object"&&(this.addSource(w,c.source),c=g.clone$1(c),c=g.extend(c,{source:w})),this._validate(g.validateStyle.layer,"layers."+w,c,{arrayIndex:-1},E))return;P=g.createStyleLayer(c),this._validateLayer(P),P.setEventedParent(this,{layer:{id:w}}),this._serializedLayers[P.id]=P.serialize()}var L=d?this._order.indexOf(d):this._order.length;if(d&&L===-1)this.fire(new g.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.')));else{if(this._order.splice(L,0,w),this._layerOrderChanged=!0,this._layers[w]=P,this._removedLayers[w]&&P.source&&P.type!=="custom"){var Z=this._removedLayers[w];delete this._removedLayers[w],Z.type!==P.type?this._updatedSources[P.source]="clear":(this._updatedSources[P.source]="reload",this.sourceCaches[P.source].pause())}this._updateLayer(P),P.onAdd&&P.onAdd(this.map)}}},h.prototype.moveLayer=function(c,d){if(this._checkLoaded(),this._changed=!0,this._layers[c]){if(c!==d){var E=this._order.indexOf(c);this._order.splice(E,1);var w=d?this._order.indexOf(d):this._order.length;d&&w===-1?this.fire(new g.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.'))):(this._order.splice(w,0,c),this._layerOrderChanged=!0)}}else this.fire(new g.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be moved.")))},h.prototype.removeLayer=function(c){this._checkLoaded();var d=this._layers[c];if(d){d.setEventedParent(null);var E=this._order.indexOf(c);this._order.splice(E,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=d,delete this._layers[c],delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],d.onRemove&&d.onRemove(this.map)}else this.fire(new g.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be removed.")))},h.prototype.getLayer=function(c){return this._layers[c]},h.prototype.hasLayer=function(c){return c in this._layers},h.prototype.setLayerZoomRange=function(c,d,E){this._checkLoaded();var w=this.getLayer(c);w?w.minzoom===d&&w.maxzoom===E||(d!=null&&(w.minzoom=d),E!=null&&(w.maxzoom=E),this._updateLayer(w)):this.fire(new g.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot have zoom extent.")))},h.prototype.setFilter=function(c,d,E){E===void 0&&(E={}),this._checkLoaded();var w=this.getLayer(c);if(w){if(!g.deepEqual(w.filter,d))return d==null?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(g.validateStyle.filter,"layers."+w.id+".filter",d,null,E)||(w.filter=g.clone$1(d),this._updateLayer(w)))}else this.fire(new g.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be filtered.")))},h.prototype.getFilter=function(c){return g.clone$1(this.getLayer(c).filter)},h.prototype.setLayoutProperty=function(c,d,E,w){w===void 0&&(w={}),this._checkLoaded();var P=this.getLayer(c);P?g.deepEqual(P.getLayoutProperty(d),E)||(P.setLayoutProperty(d,E,w),this._updateLayer(P)):this.fire(new g.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},h.prototype.getLayoutProperty=function(c,d){var E=this.getLayer(c);if(E)return E.getLayoutProperty(d);this.fire(new g.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style.")))},h.prototype.setPaintProperty=function(c,d,E,w){w===void 0&&(w={}),this._checkLoaded();var P=this.getLayer(c);P?g.deepEqual(P.getPaintProperty(d),E)||(P.setPaintProperty(d,E,w)&&this._updateLayer(P),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new g.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},h.prototype.getPaintProperty=function(c,d){return this.getLayer(c).getPaintProperty(d)},h.prototype.setFeatureState=function(c,d){this._checkLoaded();var E=c.source,w=c.sourceLayer,P=this.sourceCaches[E];if(P!==void 0){var L=P.getSource().type;L==="geojson"&&w?this.fire(new g.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):L!=="vector"||w?(c.id===void 0&&this.fire(new g.ErrorEvent(new Error("The feature id parameter must be provided."))),P.setFeatureState(w,c.id,d)):this.fire(new g.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new g.ErrorEvent(new Error("The source '"+E+"' does not exist in the map's style.")))},h.prototype.removeFeatureState=function(c,d){this._checkLoaded();var E=c.source,w=this.sourceCaches[E];if(w!==void 0){var P=w.getSource().type,L=P==="vector"?c.sourceLayer:void 0;P!=="vector"||L?d&&typeof c.id!="string"&&typeof c.id!="number"?this.fire(new g.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):w.removeFeatureState(L,c.id,d):this.fire(new g.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new g.ErrorEvent(new Error("The source '"+E+"' does not exist in the map's style.")))},h.prototype.getFeatureState=function(c){this._checkLoaded();var d=c.source,E=c.sourceLayer,w=this.sourceCaches[d];if(w!==void 0){if(w.getSource().type!=="vector"||E)return c.id===void 0&&this.fire(new g.ErrorEvent(new Error("The feature id parameter must be provided."))),w.getFeatureState(E,c.id);this.fire(new g.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new g.ErrorEvent(new Error("The source '"+d+"' does not exist in the map's style.")))},h.prototype.getTransition=function(){return g.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},h.prototype.serialize=function(){return g.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:g.mapObject(this.sourceCaches,function(c){return c.serialize()}),layers:this._serializeLayers(this._order)},function(c){return c!==void 0})},h.prototype._updateLayer=function(c){this._updatedLayers[c.id]=!0,c.source&&!this._updatedSources[c.source]&&this.sourceCaches[c.source].getSource().type!=="raster"&&(this._updatedSources[c.source]="reload",this.sourceCaches[c.source].pause()),this._changed=!0},h.prototype._flattenAndSortRenderedFeatures=function(c){for(var d=this,E=function(Dr){return d._layers[Dr].type==="fill-extrusion"},w={},P=[],L=this._order.length-1;L>=0;L--){var Z=this._order[L];if(E(Z)){w[Z]=L;for(var X=0,se=c;X<se.length;X+=1){var fe=se[X][Z];if(fe)for(var de=0,ke=fe;de<ke.length;de+=1)P.push(ke[de])}}}P.sort(function(Dr,_r){return _r.intersectionZ-Dr.intersectionZ});for(var Oe=[],ze=this._order.length-1;ze>=0;ze--){var Ce=this._order[ze];if(E(Ce))for(var je=P.length-1;je>=0;je--){var Qe=P[je].feature;if(w[Qe.layer.id]<ze)break;Oe.push(Qe),P.pop()}else for(var gt=0,Gt=c;gt<Gt.length;gt+=1){var Ut=Gt[gt][Ce];if(Ut)for(var Yt=0,vr=Ut;Yt<vr.length;Yt+=1)Oe.push(vr[Yt].feature)}}return Oe},h.prototype.queryRenderedFeatures=function(c,d,E){d&&d.filter&&this._validate(g.validateStyle.filter,"queryRenderedFeatures.filter",d.filter,null,d);var w={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new g.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var P=0,L=d.layers;P<L.length;P+=1){var Z=L[P],X=this._layers[Z];if(!X)return this.fire(new g.ErrorEvent(new Error("The layer '"+Z+"' does not exist in the map's style and cannot be queried for features."))),[];w[X.source]=!0}}var se=[];for(var fe in d.availableImages=this._availableImages,this.sourceCaches)d.layers&&!w[fe]||se.push(wr(this.sourceCaches[fe],this._layers,this._serializedLayers,c,d,E));return this.placement&&se.push(function(de,ke,Oe,ze,Ce,je,Qe){for(var gt={},Gt=je.queryRenderedSymbols(ze),Ut=[],Yt=0,vr=Object.keys(Gt).map(Number);Yt<vr.length;Yt+=1)Ut.push(Qe[vr[Yt]]);Ut.sort(xn);for(var Dr=function(){var Bn=ln[_r],Di=Bn.featureIndex.lookupSymbolFeatures(Gt[Bn.bucketInstanceId],ke,Bn.bucketIndex,Bn.sourceLayerIndex,Ce.filter,Ce.layers,Ce.availableImages,de);for(var rn in Di){var oi=gt[rn]=gt[rn]||[],ci=Di[rn];ci.sort(function(di,$n){var qn=Bn.featureSortOrder;if(qn){var yo=qn.indexOf(di.featureIndex);return qn.indexOf($n.featureIndex)-yo}return $n.featureIndex-di.featureIndex});for(var Qn=0,Xn=ci;Qn<Xn.length;Qn+=1)oi.push(Xn[Qn])}},_r=0,ln=Ut;_r<ln.length;_r+=1)Dr();var Gn=function(Bn){gt[Bn].forEach(function(Di){var rn=Di.feature,oi=Oe[de[Bn].source].getFeatureState(rn.layer["source-layer"],rn.id);rn.source=rn.layer.source,rn.layer["source-layer"]&&(rn.sourceLayer=rn.layer["source-layer"]),rn.state=oi})};for(var Hn in gt)Gn(Hn);return gt}(this._layers,this._serializedLayers,this.sourceCaches,c,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(se)},h.prototype.querySourceFeatures=function(c,d){d&&d.filter&&this._validate(g.validateStyle.filter,"querySourceFeatures.filter",d.filter,null,d);var E=this.sourceCaches[c];return E?function(w,P){for(var L=w.getRenderableIds().map(function(ke){return w.getTileByID(ke)}),Z=[],X={},se=0;se<L.length;se++){var fe=L[se],de=fe.tileID.canonical.key;X[de]||(X[de]=!0,fe.querySourceFeatures(Z,P))}return Z}(E,d):[]},h.prototype.addSourceType=function(c,d,E){return h.getSourceType(c)?E(new Error('A source type called "'+c+'" already exists.')):(h.setSourceType(c,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:d.workerSourceURL},E):E(null,null))},h.prototype.getLight=function(){return this.light.getLight()},h.prototype.setLight=function(c,d){d===void 0&&(d={}),this._checkLoaded();var E=this.light.getLight(),w=!1;for(var P in c)if(!g.deepEqual(c[P],E[P])){w=!0;break}if(w){var L={now:g.browser.now(),transition:g.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(c,d),this.light.updateTransitions(L)}},h.prototype._validate=function(c,d,E,w,P){return P===void 0&&(P={}),(!P||P.validate!==!1)&&bs(this,c.call(g.validateStyle,g.extend({key:d,style:this.serialize(),value:E,styleSpec:g.styleSpec},w)))},h.prototype._remove=function(){for(var c in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),g.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[c].setEventedParent(null);for(var d in this.sourceCaches)this.sourceCaches[d].clearTiles(),this.sourceCaches[d].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},h.prototype._clearSource=function(c){this.sourceCaches[c].clearTiles()},h.prototype._reloadSource=function(c){this.sourceCaches[c].resume(),this.sourceCaches[c].reload()},h.prototype._updateSources=function(c){for(var d in this.sourceCaches)this.sourceCaches[d].update(c)},h.prototype._generateCollisionBoxes=function(){for(var c in this.sourceCaches)this._reloadSource(c)},h.prototype._updatePlacement=function(c,d,E,w,P){P===void 0&&(P=!1);for(var L=!1,Z=!1,X={},se=0,fe=this._order;se<fe.length;se+=1){var de=this._layers[fe[se]];if(de.type==="symbol"){if(!X[de.source]){var ke=this.sourceCaches[de.source];X[de.source]=ke.getRenderableIds(!0).map(function(Qe){return ke.getTileByID(Qe)}).sort(function(Qe,gt){return gt.tileID.overscaledZ-Qe.tileID.overscaledZ||(Qe.tileID.isLessThan(gt.tileID)?-1:1)})}var Oe=this.crossTileSymbolIndex.addLayer(de,X[de.source],c.center.lng);L=L||Oe}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((P=P||this._layerOrderChanged||E===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(g.browser.now(),c.zoom))&&(this.pauseablePlacement=new Ra(c,this._order,P,d,E,w,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,X),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(g.browser.now()),Z=!0),L&&this.pauseablePlacement.placement.setStale()),Z||L)for(var ze=0,Ce=this._order;ze<Ce.length;ze+=1){var je=this._layers[Ce[ze]];je.type==="symbol"&&this.placement.updateLayerOpacities(je,X[je.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(g.browser.now())},h.prototype._releaseSymbolFadeTiles=function(){for(var c in this.sourceCaches)this.sourceCaches[c].releaseSymbolFadeTiles()},h.prototype.getImages=function(c,d,E){this.imageManager.getImages(d.icons,E),this._updateTilesForChangedImages();var w=this.sourceCaches[d.source];w&&w.setDependencies(d.tileID.key,d.type,d.icons)},h.prototype.getGlyphs=function(c,d,E){this.glyphManager.getGlyphs(d.stacks,E)},h.prototype.getResource=function(c,d,E){return g.makeRequest(d,E)},h}(g.Evented);Es.getSourceType=function(l){return nr[l]},Es.setSourceType=function(l,h){nr[l]=h},Es.registerForPluginStateChange=g.registerForPluginStateChange;var ma=g.createLayout([{name:"a_pos",type:"Int16",components:2}]),_a=Hi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),as=Hi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),mf=Hi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Ol=Hi(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),qs=Hi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),ac=Hi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Yu=Hi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Ks=Hi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),ul=Hi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),_=Hi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),M=Hi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),B=Hi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),R=Hi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),$=Hi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),be=Hi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),We=Hi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),ht=Hi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),vt=Hi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),or=Hi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),lr=Hi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Rn=Hi(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),ai=Hi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Fn=Hi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Yi=Hi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),da=Hi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),Ca=Hi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Hi(l,h){var c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=h.match(/attribute ([\w]+) ([\w]+)/g),E=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=h.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),P=w?w.concat(E):E,L={};return{fragmentSource:l=l.replace(c,function(Z,X,se,fe,de){return L[de]=!0,X==="define"?`
#ifndef HAS_UNIFORM_u_`+de+`
varying `+se+" "+fe+" "+de+`;
#else
uniform `+se+" "+fe+" u_"+de+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+de+`
    `+se+" "+fe+" "+de+" = u_"+de+`;
#endif
`}),vertexSource:h=h.replace(c,function(Z,X,se,fe,de){var ke=fe==="float"?"vec2":"vec4",Oe=de.match(/color/)?"color":ke;return L[de]?X==="define"?`
#ifndef HAS_UNIFORM_u_`+de+`
uniform lowp float u_`+de+`_t;
attribute `+se+" "+ke+" a_"+de+`;
varying `+se+" "+fe+" "+de+`;
#else
uniform `+se+" "+fe+" u_"+de+`;
#endif
`:Oe==="vec4"?`
#ifndef HAS_UNIFORM_u_`+de+`
    `+de+" = a_"+de+`;
#else
    `+se+" "+fe+" "+de+" = u_"+de+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+de+`
    `+de+" = unpack_mix_"+Oe+"(a_"+de+", u_"+de+`_t);
#else
    `+se+" "+fe+" "+de+" = u_"+de+`;
#endif
`:X==="define"?`
#ifndef HAS_UNIFORM_u_`+de+`
uniform lowp float u_`+de+`_t;
attribute `+se+" "+ke+" a_"+de+`;
#else
uniform `+se+" "+fe+" u_"+de+`;
#endif
`:Oe==="vec4"?`
#ifndef HAS_UNIFORM_u_`+de+`
    `+se+" "+fe+" "+de+" = a_"+de+`;
#else
    `+se+" "+fe+" "+de+" = u_"+de+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+de+`
    `+se+" "+fe+" "+de+" = unpack_mix_"+Oe+"(a_"+de+", u_"+de+`_t);
#else
    `+se+" "+fe+" "+de+" = u_"+de+`;
#endif
`}),staticAttributes:d,staticUniforms:P}}var Ss=Object.freeze({__proto__:null,prelude:_a,background:as,backgroundPattern:mf,circle:Ol,clippingMask:qs,heatmap:ac,heatmapTexture:Yu,collisionBox:Ks,collisionCircle:ul,debug:_,fill:M,fillOutline:B,fillOutlinePattern:R,fillPattern:$,fillExtrusion:be,fillExtrusionPattern:We,hillshadePrepare:ht,hillshade:vt,line:or,lineGradient:lr,linePattern:Rn,lineSDF:ai,raster:Fn,symbolIcon:Yi,symbolSDF:da,symbolTextAndIcon:Ca}),hu=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function qu(l){for(var h=[],c=0;c<l.length;c++)if(l[c]!==null){var d=l[c].split(" ");h.push(d.pop())}return h}hu.prototype.bind=function(l,h,c,d,E,w,P,L){this.context=l;for(var Z=this.boundPaintVertexBuffers.length!==d.length,X=0;!Z&&X<d.length;X++)this.boundPaintVertexBuffers[X]!==d[X]&&(Z=!0);l.extVertexArrayObject&&this.vao&&this.boundProgram===h&&this.boundLayoutVertexBuffer===c&&!Z&&this.boundIndexBuffer===E&&this.boundVertexOffset===w&&this.boundDynamicVertexBuffer===P&&this.boundDynamicVertexBuffer2===L?(l.bindVertexArrayOES.set(this.vao),P&&P.bind(),E&&E.dynamicDraw&&E.bind(),L&&L.bind()):this.freshBind(h,c,d,E,w,P,L)},hu.prototype.freshBind=function(l,h,c,d,E,w,P){var L,Z=l.numAttributes,X=this.context,se=X.gl;if(X.extVertexArrayObject)this.vao&&this.destroy(),this.vao=X.extVertexArrayObject.createVertexArrayOES(),X.bindVertexArrayOES.set(this.vao),L=0,this.boundProgram=l,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=d,this.boundVertexOffset=E,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=P;else{L=X.currentNumAttributes||0;for(var fe=Z;fe<L;fe++)se.disableVertexAttribArray(fe)}h.enableAttributes(se,l);for(var de=0,ke=c;de<ke.length;de+=1)ke[de].enableAttributes(se,l);w&&w.enableAttributes(se,l),P&&P.enableAttributes(se,l),h.bind(),h.setVertexAttribPointers(se,l,E);for(var Oe=0,ze=c;Oe<ze.length;Oe+=1){var Ce=ze[Oe];Ce.bind(),Ce.setVertexAttribPointers(se,l,E)}w&&(w.bind(),w.setVertexAttribPointers(se,l,E)),d&&d.bind(),P&&(P.bind(),P.setVertexAttribPointers(se,l,E)),X.currentNumAttributes=Z},hu.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var gf=function(l,h,c,d,E,w){var P=l.gl;this.program=P.createProgram();for(var L=qu(c.staticAttributes),Z=d?d.getBinderAttributes():[],X=L.concat(Z),se=c.staticUniforms?qu(c.staticUniforms):[],fe=d?d.getBinderUniforms():[],de=[],ke=0,Oe=se.concat(fe);ke<Oe.length;ke+=1){var ze=Oe[ke];de.indexOf(ze)<0&&de.push(ze)}var Ce=d?d.defines():[];w&&Ce.push("#define OVERDRAW_INSPECTOR;");var je=Ce.concat(_a.fragmentSource,c.fragmentSource).join(`
`),Qe=Ce.concat(_a.vertexSource,c.vertexSource).join(`
`),gt=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(gt,je),P.compileShader(gt),P.attachShader(this.program,gt);var Gt=P.createShader(P.VERTEX_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(Gt,Qe),P.compileShader(Gt),P.attachShader(this.program,Gt),this.attributes={};var Ut={};this.numAttributes=X.length;for(var Yt=0;Yt<this.numAttributes;Yt++)X[Yt]&&(P.bindAttribLocation(this.program,Yt,X[Yt]),this.attributes[X[Yt]]=Yt);P.linkProgram(this.program),P.deleteShader(Gt),P.deleteShader(gt);for(var vr=0;vr<de.length;vr++){var Dr=de[vr];if(Dr&&!Ut[Dr]){var _r=P.getUniformLocation(this.program,Dr);_r&&(Ut[Dr]=_r)}}this.fixedUniforms=E(l,Ut),this.binderUniforms=d?d.getUniforms(l,Ut):[]}}};function ll(l,h,c){var d=1/oa(c,1,h.transform.tileZoom),E=Math.pow(2,c.tileID.overscaledZ),w=c.tileSize*Math.pow(2,h.transform.tileZoom)/E,P=w*(c.tileID.canonical.x+c.tileID.wrap*E),L=w*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[d,l.fromScale,l.toScale],u_fade:l.t,u_pixel_coord_upper:[P>>16,L>>16],u_pixel_coord_lower:[65535&P,65535&L]}}gf.prototype.draw=function(l,h,c,d,E,w,P,L,Z,X,se,fe,de,ke,Oe,ze){var Ce,je=l.gl;if(!this.failedToCreate){for(var Qe in l.program.set(this.program),l.setDepthMode(c),l.setStencilMode(d),l.setColorMode(E),l.setCullFace(w),this.fixedUniforms)this.fixedUniforms[Qe].set(P[Qe]);ke&&ke.setUniforms(l,this.binderUniforms,fe,{zoom:de});for(var gt=(Ce={},Ce[je.LINES]=2,Ce[je.TRIANGLES]=3,Ce[je.LINE_STRIP]=1,Ce)[h],Gt=0,Ut=se.get();Gt<Ut.length;Gt+=1){var Yt=Ut[Gt],vr=Yt.vaos||(Yt.vaos={});(vr[L]||(vr[L]=new hu)).bind(l,this,Z,ke?ke.getPaintVertexBuffers():[],X,Yt.vertexOffset,Oe,ze),je.drawElements(h,Yt.primitiveLength*gt,je.UNSIGNED_SHORT,Yt.primitiveOffset*gt*2)}}};var Bc=function(l,h,c,d){var E=h.style.light,w=E.properties.get("position"),P=[w.x,w.y,w.z],L=g.create$1();E.properties.get("anchor")==="viewport"&&g.fromRotation(L,-h.transform.angle),g.transformMat3(P,P,L);var Z=E.properties.get("color");return{u_matrix:l,u_lightpos:P,u_lightintensity:E.properties.get("intensity"),u_lightcolor:[Z.r,Z.g,Z.b],u_vertical_gradient:+c,u_opacity:d}},Tu=function(l,h,c,d,E,w,P){return g.extend(Bc(l,h,c,d),ll(w,h,P),{u_height_factor:-Math.pow(2,E.overscaledZ)/P.tileSize/8})},Mu=function(l){return{u_matrix:l}},Pu=function(l,h,c,d){return g.extend(Mu(l),ll(c,h,d))},lo=function(l,h){return{u_matrix:l,u_world:h}},Gf=function(l,h,c,d,E){return g.extend(Pu(l,h,c,d),{u_world:E})},Hf=function(l,h,c,d){var E,w,P=l.transform;if(d.paint.get("circle-pitch-alignment")==="map"){var L=oa(c,1,P.zoom);E=!0,w=[L,L]}else E=!1,w=P.pixelsToGLUnits;return{u_camera_to_center_distance:P.cameraToCenterDistance,u_scale_with_map:+(d.paint.get("circle-pitch-scale")==="map"),u_matrix:l.translatePosMatrix(h.posMatrix,c,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_pitch_with_map:+E,u_device_pixel_ratio:g.browser.devicePixelRatio,u_extrude_scale:w}},$o=function(l,h,c){var d=oa(c,1,h.zoom),E=Math.pow(2,h.zoom-c.tileID.overscaledZ),w=c.tileID.overscaleFactor();return{u_matrix:l,u_camera_to_center_distance:h.cameraToCenterDistance,u_pixels_to_tile_units:d,u_extrude_scale:[h.pixelsToGLUnits[0]/(d*E),h.pixelsToGLUnits[1]/(d*E)],u_overscale_factor:w}},Nc=function(l,h,c){return{u_matrix:l,u_inv_matrix:h,u_camera_to_center_distance:c.cameraToCenterDistance,u_viewport_size:[c.width,c.height]}},Iu=function(l,h,c){return c===void 0&&(c=1),{u_matrix:l,u_color:h,u_overlay:0,u_overlay_scale:c}},pu=function(l){return{u_matrix:l}},yf=function(l,h,c,d){return{u_matrix:l,u_extrude_scale:oa(h,1,c),u_intensity:d}},Rl=function(l,h,c){var d=l.transform;return{u_matrix:zc(l,h,c),u_ratio:1/oa(h,1,d.zoom),u_device_pixel_ratio:g.browser.devicePixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},zi=function(l,h,c,d){return g.extend(Rl(l,h,c),{u_image:0,u_image_height:d})},kl=function(l,h,c,d){var E=l.transform,w=cl(h,E);return{u_matrix:zc(l,h,c),u_texsize:h.imageAtlasTexture.size,u_ratio:1/oa(h,1,E.zoom),u_device_pixel_ratio:g.browser.devicePixelRatio,u_image:0,u_scale:[w,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]]}},Mh=function(l,h,c,d,E){var w=l.lineAtlas,P=cl(h,l.transform),L=c.layout.get("line-cap")==="round",Z=w.getDash(d.from,L),X=w.getDash(d.to,L),se=Z.width*E.fromScale,fe=X.width*E.toScale;return g.extend(Rl(l,h,c),{u_patternscale_a:[P/se,-Z.height/2],u_patternscale_b:[P/fe,-X.height/2],u_sdfgamma:w.width/(256*Math.min(se,fe)*g.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:Z.y,u_tex_y_b:X.y,u_mix:E.t})};function cl(l,h){return 1/oa(l,1,h.tileZoom)}function zc(l,h,c){return l.translatePosMatrix(h.tileID.posMatrix,h,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}var Wf=function(l,h,c,d,E){return{u_matrix:l,u_tl_parent:h,u_scale_parent:c,u_buffer_scale:1,u_fade_t:d.mix,u_opacity:d.opacity*E.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:E.paint.get("raster-brightness-min"),u_brightness_high:E.paint.get("raster-brightness-max"),u_saturation_factor:(P=E.paint.get("raster-saturation"),P>0?1-1/(1.001-P):-P),u_contrast_factor:(w=E.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:Ph(E.paint.get("raster-hue-rotate"))};var w,P};function Ph(l){l*=Math.PI/180;var h=Math.sin(l),c=Math.cos(l);return[(2*c+1)/3,(-Math.sqrt(3)*h-c+1)/3,(Math.sqrt(3)*h-c+1)/3]}var Xf,Zc=function(l,h,c,d,E,w,P,L,Z,X){var se=E.transform;return{u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:h?h.uSizeT:0,u_size:h?h.uSize:0,u_camera_to_center_distance:se.cameraToCenterDistance,u_pitch:se.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:se.width/se.height,u_fade_change:E.options.fadeDuration?E.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:P,u_coord_matrix:L,u_is_text:+Z,u_pitch_with_map:+d,u_texsize:X,u_texture:0}},oc=function(l,h,c,d,E,w,P,L,Z,X,se){var fe=E.transform;return g.extend(Zc(l,h,c,d,E,w,P,L,Z,X),{u_gamma_scale:d?Math.cos(fe._pitch)*fe.cameraToCenterDistance:1,u_device_pixel_ratio:g.browser.devicePixelRatio,u_is_halo:+se})},sc=function(l,h,c,d,E,w,P,L,Z,X){return g.extend(oc(l,h,c,d,E,w,P,L,!0,Z,!0),{u_texsize_icon:X,u_texture_icon:1})},Ll=function(l,h,c){return{u_matrix:l,u_opacity:h,u_color:c}},fl=function(l,h,c,d,E,w){return g.extend(function(P,L,Z,X){var se=Z.imageManager.getPattern(P.from.toString()),fe=Z.imageManager.getPattern(P.to.toString()),de=Z.imageManager.getPixelSize(),ke=de.width,Oe=de.height,ze=Math.pow(2,X.tileID.overscaledZ),Ce=X.tileSize*Math.pow(2,Z.transform.tileZoom)/ze,je=Ce*(X.tileID.canonical.x+X.tileID.wrap*ze),Qe=Ce*X.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:se.tl,u_pattern_br_a:se.br,u_pattern_tl_b:fe.tl,u_pattern_br_b:fe.br,u_texsize:[ke,Oe],u_mix:L.t,u_pattern_size_a:se.displaySize,u_pattern_size_b:fe.displaySize,u_scale_a:L.fromScale,u_scale_b:L.toScale,u_tile_units_to_pixels:1/oa(X,1,Z.transform.tileZoom),u_pixel_coord_upper:[je>>16,Qe>>16],u_pixel_coord_lower:[65535&je,65535&Qe]}}(d,w,c,E),{u_matrix:l,u_opacity:h})},Dl={fillExtrusion:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_lightpos:new g.Uniform3f(l,h.u_lightpos),u_lightintensity:new g.Uniform1f(l,h.u_lightintensity),u_lightcolor:new g.Uniform3f(l,h.u_lightcolor),u_vertical_gradient:new g.Uniform1f(l,h.u_vertical_gradient),u_opacity:new g.Uniform1f(l,h.u_opacity)}},fillExtrusionPattern:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_lightpos:new g.Uniform3f(l,h.u_lightpos),u_lightintensity:new g.Uniform1f(l,h.u_lightintensity),u_lightcolor:new g.Uniform3f(l,h.u_lightcolor),u_vertical_gradient:new g.Uniform1f(l,h.u_vertical_gradient),u_height_factor:new g.Uniform1f(l,h.u_height_factor),u_image:new g.Uniform1i(l,h.u_image),u_texsize:new g.Uniform2f(l,h.u_texsize),u_pixel_coord_upper:new g.Uniform2f(l,h.u_pixel_coord_upper),u_pixel_coord_lower:new g.Uniform2f(l,h.u_pixel_coord_lower),u_scale:new g.Uniform3f(l,h.u_scale),u_fade:new g.Uniform1f(l,h.u_fade),u_opacity:new g.Uniform1f(l,h.u_opacity)}},fill:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix)}},fillPattern:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_image:new g.Uniform1i(l,h.u_image),u_texsize:new g.Uniform2f(l,h.u_texsize),u_pixel_coord_upper:new g.Uniform2f(l,h.u_pixel_coord_upper),u_pixel_coord_lower:new g.Uniform2f(l,h.u_pixel_coord_lower),u_scale:new g.Uniform3f(l,h.u_scale),u_fade:new g.Uniform1f(l,h.u_fade)}},fillOutline:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_world:new g.Uniform2f(l,h.u_world)}},fillOutlinePattern:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_world:new g.Uniform2f(l,h.u_world),u_image:new g.Uniform1i(l,h.u_image),u_texsize:new g.Uniform2f(l,h.u_texsize),u_pixel_coord_upper:new g.Uniform2f(l,h.u_pixel_coord_upper),u_pixel_coord_lower:new g.Uniform2f(l,h.u_pixel_coord_lower),u_scale:new g.Uniform3f(l,h.u_scale),u_fade:new g.Uniform1f(l,h.u_fade)}},circle:function(l,h){return{u_camera_to_center_distance:new g.Uniform1f(l,h.u_camera_to_center_distance),u_scale_with_map:new g.Uniform1i(l,h.u_scale_with_map),u_pitch_with_map:new g.Uniform1i(l,h.u_pitch_with_map),u_extrude_scale:new g.Uniform2f(l,h.u_extrude_scale),u_device_pixel_ratio:new g.Uniform1f(l,h.u_device_pixel_ratio),u_matrix:new g.UniformMatrix4f(l,h.u_matrix)}},collisionBox:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_camera_to_center_distance:new g.Uniform1f(l,h.u_camera_to_center_distance),u_pixels_to_tile_units:new g.Uniform1f(l,h.u_pixels_to_tile_units),u_extrude_scale:new g.Uniform2f(l,h.u_extrude_scale),u_overscale_factor:new g.Uniform1f(l,h.u_overscale_factor)}},collisionCircle:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_inv_matrix:new g.UniformMatrix4f(l,h.u_inv_matrix),u_camera_to_center_distance:new g.Uniform1f(l,h.u_camera_to_center_distance),u_viewport_size:new g.Uniform2f(l,h.u_viewport_size)}},debug:function(l,h){return{u_color:new g.UniformColor(l,h.u_color),u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_overlay:new g.Uniform1i(l,h.u_overlay),u_overlay_scale:new g.Uniform1f(l,h.u_overlay_scale)}},clippingMask:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix)}},heatmap:function(l,h){return{u_extrude_scale:new g.Uniform1f(l,h.u_extrude_scale),u_intensity:new g.Uniform1f(l,h.u_intensity),u_matrix:new g.UniformMatrix4f(l,h.u_matrix)}},heatmapTexture:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_world:new g.Uniform2f(l,h.u_world),u_image:new g.Uniform1i(l,h.u_image),u_color_ramp:new g.Uniform1i(l,h.u_color_ramp),u_opacity:new g.Uniform1f(l,h.u_opacity)}},hillshade:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_image:new g.Uniform1i(l,h.u_image),u_latrange:new g.Uniform2f(l,h.u_latrange),u_light:new g.Uniform2f(l,h.u_light),u_shadow:new g.UniformColor(l,h.u_shadow),u_highlight:new g.UniformColor(l,h.u_highlight),u_accent:new g.UniformColor(l,h.u_accent)}},hillshadePrepare:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_image:new g.Uniform1i(l,h.u_image),u_dimension:new g.Uniform2f(l,h.u_dimension),u_zoom:new g.Uniform1f(l,h.u_zoom),u_unpack:new g.Uniform4f(l,h.u_unpack)}},line:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_ratio:new g.Uniform1f(l,h.u_ratio),u_device_pixel_ratio:new g.Uniform1f(l,h.u_device_pixel_ratio),u_units_to_pixels:new g.Uniform2f(l,h.u_units_to_pixels)}},lineGradient:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_ratio:new g.Uniform1f(l,h.u_ratio),u_device_pixel_ratio:new g.Uniform1f(l,h.u_device_pixel_ratio),u_units_to_pixels:new g.Uniform2f(l,h.u_units_to_pixels),u_image:new g.Uniform1i(l,h.u_image),u_image_height:new g.Uniform1f(l,h.u_image_height)}},linePattern:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_texsize:new g.Uniform2f(l,h.u_texsize),u_ratio:new g.Uniform1f(l,h.u_ratio),u_device_pixel_ratio:new g.Uniform1f(l,h.u_device_pixel_ratio),u_image:new g.Uniform1i(l,h.u_image),u_units_to_pixels:new g.Uniform2f(l,h.u_units_to_pixels),u_scale:new g.Uniform3f(l,h.u_scale),u_fade:new g.Uniform1f(l,h.u_fade)}},lineSDF:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_ratio:new g.Uniform1f(l,h.u_ratio),u_device_pixel_ratio:new g.Uniform1f(l,h.u_device_pixel_ratio),u_units_to_pixels:new g.Uniform2f(l,h.u_units_to_pixels),u_patternscale_a:new g.Uniform2f(l,h.u_patternscale_a),u_patternscale_b:new g.Uniform2f(l,h.u_patternscale_b),u_sdfgamma:new g.Uniform1f(l,h.u_sdfgamma),u_image:new g.Uniform1i(l,h.u_image),u_tex_y_a:new g.Uniform1f(l,h.u_tex_y_a),u_tex_y_b:new g.Uniform1f(l,h.u_tex_y_b),u_mix:new g.Uniform1f(l,h.u_mix)}},raster:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_tl_parent:new g.Uniform2f(l,h.u_tl_parent),u_scale_parent:new g.Uniform1f(l,h.u_scale_parent),u_buffer_scale:new g.Uniform1f(l,h.u_buffer_scale),u_fade_t:new g.Uniform1f(l,h.u_fade_t),u_opacity:new g.Uniform1f(l,h.u_opacity),u_image0:new g.Uniform1i(l,h.u_image0),u_image1:new g.Uniform1i(l,h.u_image1),u_brightness_low:new g.Uniform1f(l,h.u_brightness_low),u_brightness_high:new g.Uniform1f(l,h.u_brightness_high),u_saturation_factor:new g.Uniform1f(l,h.u_saturation_factor),u_contrast_factor:new g.Uniform1f(l,h.u_contrast_factor),u_spin_weights:new g.Uniform3f(l,h.u_spin_weights)}},symbolIcon:function(l,h){return{u_is_size_zoom_constant:new g.Uniform1i(l,h.u_is_size_zoom_constant),u_is_size_feature_constant:new g.Uniform1i(l,h.u_is_size_feature_constant),u_size_t:new g.Uniform1f(l,h.u_size_t),u_size:new g.Uniform1f(l,h.u_size),u_camera_to_center_distance:new g.Uniform1f(l,h.u_camera_to_center_distance),u_pitch:new g.Uniform1f(l,h.u_pitch),u_rotate_symbol:new g.Uniform1i(l,h.u_rotate_symbol),u_aspect_ratio:new g.Uniform1f(l,h.u_aspect_ratio),u_fade_change:new g.Uniform1f(l,h.u_fade_change),u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_label_plane_matrix:new g.UniformMatrix4f(l,h.u_label_plane_matrix),u_coord_matrix:new g.UniformMatrix4f(l,h.u_coord_matrix),u_is_text:new g.Uniform1i(l,h.u_is_text),u_pitch_with_map:new g.Uniform1i(l,h.u_pitch_with_map),u_texsize:new g.Uniform2f(l,h.u_texsize),u_texture:new g.Uniform1i(l,h.u_texture)}},symbolSDF:function(l,h){return{u_is_size_zoom_constant:new g.Uniform1i(l,h.u_is_size_zoom_constant),u_is_size_feature_constant:new g.Uniform1i(l,h.u_is_size_feature_constant),u_size_t:new g.Uniform1f(l,h.u_size_t),u_size:new g.Uniform1f(l,h.u_size),u_camera_to_center_distance:new g.Uniform1f(l,h.u_camera_to_center_distance),u_pitch:new g.Uniform1f(l,h.u_pitch),u_rotate_symbol:new g.Uniform1i(l,h.u_rotate_symbol),u_aspect_ratio:new g.Uniform1f(l,h.u_aspect_ratio),u_fade_change:new g.Uniform1f(l,h.u_fade_change),u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_label_plane_matrix:new g.UniformMatrix4f(l,h.u_label_plane_matrix),u_coord_matrix:new g.UniformMatrix4f(l,h.u_coord_matrix),u_is_text:new g.Uniform1i(l,h.u_is_text),u_pitch_with_map:new g.Uniform1i(l,h.u_pitch_with_map),u_texsize:new g.Uniform2f(l,h.u_texsize),u_texture:new g.Uniform1i(l,h.u_texture),u_gamma_scale:new g.Uniform1f(l,h.u_gamma_scale),u_device_pixel_ratio:new g.Uniform1f(l,h.u_device_pixel_ratio),u_is_halo:new g.Uniform1i(l,h.u_is_halo)}},symbolTextAndIcon:function(l,h){return{u_is_size_zoom_constant:new g.Uniform1i(l,h.u_is_size_zoom_constant),u_is_size_feature_constant:new g.Uniform1i(l,h.u_is_size_feature_constant),u_size_t:new g.Uniform1f(l,h.u_size_t),u_size:new g.Uniform1f(l,h.u_size),u_camera_to_center_distance:new g.Uniform1f(l,h.u_camera_to_center_distance),u_pitch:new g.Uniform1f(l,h.u_pitch),u_rotate_symbol:new g.Uniform1i(l,h.u_rotate_symbol),u_aspect_ratio:new g.Uniform1f(l,h.u_aspect_ratio),u_fade_change:new g.Uniform1f(l,h.u_fade_change),u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_label_plane_matrix:new g.UniformMatrix4f(l,h.u_label_plane_matrix),u_coord_matrix:new g.UniformMatrix4f(l,h.u_coord_matrix),u_is_text:new g.Uniform1i(l,h.u_is_text),u_pitch_with_map:new g.Uniform1i(l,h.u_pitch_with_map),u_texsize:new g.Uniform2f(l,h.u_texsize),u_texsize_icon:new g.Uniform2f(l,h.u_texsize_icon),u_texture:new g.Uniform1i(l,h.u_texture),u_texture_icon:new g.Uniform1i(l,h.u_texture_icon),u_gamma_scale:new g.Uniform1f(l,h.u_gamma_scale),u_device_pixel_ratio:new g.Uniform1f(l,h.u_device_pixel_ratio),u_is_halo:new g.Uniform1i(l,h.u_is_halo)}},background:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_opacity:new g.Uniform1f(l,h.u_opacity),u_color:new g.UniformColor(l,h.u_color)}},backgroundPattern:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_opacity:new g.Uniform1f(l,h.u_opacity),u_image:new g.Uniform1i(l,h.u_image),u_pattern_tl_a:new g.Uniform2f(l,h.u_pattern_tl_a),u_pattern_br_a:new g.Uniform2f(l,h.u_pattern_br_a),u_pattern_tl_b:new g.Uniform2f(l,h.u_pattern_tl_b),u_pattern_br_b:new g.Uniform2f(l,h.u_pattern_br_b),u_texsize:new g.Uniform2f(l,h.u_texsize),u_mix:new g.Uniform1f(l,h.u_mix),u_pattern_size_a:new g.Uniform2f(l,h.u_pattern_size_a),u_pattern_size_b:new g.Uniform2f(l,h.u_pattern_size_b),u_scale_a:new g.Uniform1f(l,h.u_scale_a),u_scale_b:new g.Uniform1f(l,h.u_scale_b),u_pixel_coord_upper:new g.Uniform2f(l,h.u_pixel_coord_upper),u_pixel_coord_lower:new g.Uniform2f(l,h.u_pixel_coord_lower),u_tile_units_to_pixels:new g.Uniform1f(l,h.u_tile_units_to_pixels)}}};function Ku(l,h,c,d,E,w,P){for(var L=l.context,Z=L.gl,X=l.useProgram("collisionBox"),se=[],fe=0,de=0,ke=0;ke<d.length;ke++){var Oe=d[ke],ze=h.getTile(Oe),Ce=ze.getBucket(c);if(Ce){var je=Oe.posMatrix;E[0]===0&&E[1]===0||(je=l.translatePosMatrix(Oe.posMatrix,ze,E,w));var Qe=P?Ce.textCollisionBox:Ce.iconCollisionBox,gt=Ce.collisionCircleArray;if(gt.length>0){var Gt=g.create(),Ut=je;g.mul(Gt,Ce.placementInvProjMatrix,l.transform.glCoordMatrix),g.mul(Gt,Gt,Ce.placementViewportMatrix),se.push({circleArray:gt,circleOffset:de,transform:Ut,invTransform:Gt}),de=fe+=gt.length/4}Qe&&X.draw(L,Z.LINES,ge.disabled,Ie.disabled,l.colorModeForRenderPass(),tt.disabled,$o(je,l.transform,ze),c.id,Qe.layoutVertexBuffer,Qe.indexBuffer,Qe.segments,null,l.transform.zoom,null,null,Qe.collisionVertexBuffer)}}if(P&&se.length){var Yt=l.useProgram("collisionCircle"),vr=new g.StructArrayLayout2f1f2i16;vr.resize(4*fe),vr._trim();for(var Dr=0,_r=0,ln=se;_r<ln.length;_r+=1)for(var Gn=ln[_r],Hn=0;Hn<Gn.circleArray.length/4;Hn++){var Bn=4*Hn,Di=Gn.circleArray[Bn+0],rn=Gn.circleArray[Bn+1],oi=Gn.circleArray[Bn+2],ci=Gn.circleArray[Bn+3];vr.emplace(Dr++,Di,rn,oi,ci,0),vr.emplace(Dr++,Di,rn,oi,ci,1),vr.emplace(Dr++,Di,rn,oi,ci,2),vr.emplace(Dr++,Di,rn,oi,ci,3)}(!Xf||Xf.length<2*fe)&&(Xf=function(Qa){var To=2*Qa,ia=new g.StructArrayLayout3ui6;ia.resize(To),ia._trim();for(var Ha=0;Ha<To;Ha++){var fo=6*Ha;ia.uint16[fo+0]=4*Ha+0,ia.uint16[fo+1]=4*Ha+1,ia.uint16[fo+2]=4*Ha+2,ia.uint16[fo+3]=4*Ha+2,ia.uint16[fo+4]=4*Ha+3,ia.uint16[fo+5]=4*Ha+0}return ia}(fe));for(var Qn=L.createIndexBuffer(Xf,!0),Xn=L.createVertexBuffer(vr,g.collisionCircleLayout.members,!0),di=0,$n=se;di<$n.length;di+=1){var qn=$n[di],yo=Nc(qn.transform,qn.invTransform,l.transform);Yt.draw(L,Z.TRIANGLES,ge.disabled,Ie.disabled,l.colorModeForRenderPass(),tt.disabled,yo,c.id,Xn,Qn,g.SegmentVector.simpleSegment(0,2*qn.circleOffset,qn.circleArray.length,qn.circleArray.length/2),null,l.transform.zoom,null,null,null)}Xn.destroy(),Qn.destroy()}}var $s=g.identity(new Float32Array(16));function _f(l,h,c,d,E,w){var P=g.getAnchorAlignment(l),L=-(P.horizontalAlign-.5)*h,Z=-(P.verticalAlign-.5)*c,X=g.evaluateVariableOffset(l,d);return new g.Point((L/E+X[0])*w,(Z/E+X[1])*w)}function xf(l,h,c,d,E,w,P,L,Z,X,se){var fe=l.text.placedSymbolArray,de=l.text.dynamicLayoutVertexArray,ke=l.icon.dynamicLayoutVertexArray,Oe={};de.clear();for(var ze=0;ze<fe.length;ze++){var Ce=fe.get(ze),je=Ce.hidden||!Ce.crossTileID||l.allowVerticalPlacement&&!Ce.placedOrientation?null:d[Ce.crossTileID];if(je){var Qe=new g.Point(Ce.anchorX,Ce.anchorY),gt=Ii(Qe,c?L:P),Gt=ji(w.cameraToCenterDistance,gt.signedDistanceFromCamera),Ut=E.evaluateSizeForFeature(l.textSizeData,X,Ce)*Gt/g.ONE_EM;c&&(Ut*=l.tilePixelRatio/Z);for(var Yt=_f(je.anchor,je.width,je.height,je.textOffset,je.textBoxScale,Ut),vr=c?Ii(Qe.add(Yt),P).point:gt.point.add(h?Yt.rotate(-w.angle):Yt),Dr=l.allowVerticalPlacement&&Ce.placedOrientation===g.WritingMode.vertical?Math.PI/2:0,_r=0;_r<Ce.numGlyphs;_r++)g.addDynamicAttributes(de,vr,Dr);se&&Ce.associatedIconIndex>=0&&(Oe[Ce.associatedIconIndex]={shiftedAnchor:vr,angle:Dr})}else za(Ce.numGlyphs,de)}if(se){ke.clear();for(var ln=l.icon.placedSymbolArray,Gn=0;Gn<ln.length;Gn++){var Hn=ln.get(Gn);if(Hn.hidden)za(Hn.numGlyphs,ke);else{var Bn=Oe[Gn];if(Bn)for(var Di=0;Di<Hn.numGlyphs;Di++)g.addDynamicAttributes(ke,Bn.shiftedAnchor,Bn.angle);else za(Hn.numGlyphs,ke)}}l.icon.dynamicLayoutVertexBuffer.updateData(ke)}l.text.dynamicLayoutVertexBuffer.updateData(de)}function Yf(l,h,c){return c.iconsInText&&h?"symbolTextAndIcon":l?"symbolSDF":"symbolIcon"}function du(l,h,c,d,E,w,P,L,Z,X,se,fe){for(var de=l.context,ke=de.gl,Oe=l.transform,ze=L==="map",Ce=Z==="map",je=ze&&c.layout.get("symbol-placement")!=="point",Qe=ze&&!Ce&&!je,gt=c.layout.get("symbol-sort-key").constantOr(1)!==void 0,Gt=!1,Ut=l.depthModeForSublayer(0,ge.ReadOnly),Yt=c.layout.get("text-variable-anchor"),vr=[],Dr=0,_r=d;Dr<_r.length;Dr+=1){var ln=_r[Dr],Gn=h.getTile(ln),Hn=Gn.getBucket(c);if(Hn){var Bn=E?Hn.text:Hn.icon;if(Bn&&Bn.segments.get().length){var Di=Bn.programConfigurations.get(c.id),rn=E||Hn.sdfIcons,oi=E?Hn.textSizeData:Hn.iconSizeData,ci=Ce||Oe.pitch!==0,Qn=l.useProgram(Yf(rn,E,Hn),Di),Xn=g.evaluateSizeForZoom(oi,Oe.zoom),di=void 0,$n=[0,0],qn=void 0,yo=void 0,Qa=null,To=void 0;if(E)qn=Gn.glyphAtlasTexture,yo=ke.LINEAR,di=Gn.glyphAtlasTexture.size,Hn.iconsInText&&($n=Gn.imageAtlasTexture.size,Qa=Gn.imageAtlasTexture,To=ci||l.options.rotating||l.options.zooming||oi.kind==="composite"||oi.kind==="camera"?ke.LINEAR:ke.NEAREST);else{var ia=c.layout.get("icon-size").constantOr(0)!==1||Hn.iconsNeedLinear;qn=Gn.imageAtlasTexture,yo=rn||l.options.rotating||l.options.zooming||ia||ci?ke.LINEAR:ke.NEAREST,di=Gn.imageAtlasTexture.size}var Ha=oa(Gn,1,l.transform.zoom),fo=Ta(ln.posMatrix,Ce,ze,l.transform,Ha),Rs=Si(ln.posMatrix,Ce,ze,l.transform,Ha),us=Yt&&Hn.hasTextData(),Bu=c.layout.get("icon-text-fit")!=="none"&&us&&Hn.hasIconData();je&&un(Hn,ln.posMatrix,l,E,fo,Rs,Ce,X);var ls=l.translatePosMatrix(ln.posMatrix,Gn,w,P),nu=je||E&&Yt||Bu?$s:fo,Jo=l.translatePosMatrix(Rs,Gn,w,P,!0),cs=rn&&c.paint.get(E?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Wl={program:Qn,buffers:Bn,uniformValues:rn?Hn.iconsInText?sc(oi.kind,Xn,Qe,Ce,l,ls,nu,Jo,di,$n):oc(oi.kind,Xn,Qe,Ce,l,ls,nu,Jo,E,di,!0):Zc(oi.kind,Xn,Qe,Ce,l,ls,nu,Jo,E,di),atlasTexture:qn,atlasTextureIcon:Qa,atlasInterpolation:yo,atlasInterpolationIcon:To,isSDF:rn,hasHalo:cs};if(gt&&Hn.canOverlap){Gt=!0;for(var Nu=0,_l=Bn.segments.get();Nu<_l.length;Nu+=1){var Xl=_l[Nu];vr.push({segments:new g.SegmentVector([Xl]),sortKey:Xl.sortKey,state:Wl})}}else vr.push({segments:Bn.segments,sortKey:0,state:Wl})}}}Gt&&vr.sort(function(Zu,tl){return Zu.sortKey-tl.sortKey});for(var iu=0,xl=vr;iu<xl.length;iu+=1){var Su=xl[iu],Eo=Su.state;if(de.activeTexture.set(ke.TEXTURE0),Eo.atlasTexture.bind(Eo.atlasInterpolation,ke.CLAMP_TO_EDGE),Eo.atlasTextureIcon&&(de.activeTexture.set(ke.TEXTURE1),Eo.atlasTextureIcon&&Eo.atlasTextureIcon.bind(Eo.atlasInterpolationIcon,ke.CLAMP_TO_EDGE)),Eo.isSDF){var zu=Eo.uniformValues;Eo.hasHalo&&(zu.u_is_halo=1,uc(Eo.buffers,Su.segments,c,l,Eo.program,Ut,se,fe,zu)),zu.u_is_halo=0}uc(Eo.buffers,Su.segments,c,l,Eo.program,Ut,se,fe,Eo.uniformValues)}}function uc(l,h,c,d,E,w,P,L,Z){var X=d.context;E.draw(X,X.gl.TRIANGLES,w,P,L,tt.disabled,Z,c.id,l.layoutVertexBuffer,l.indexBuffer,h,c.paint,d.transform.zoom,l.programConfigurations.get(c.id),l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer)}function Uc(l,h,c,d,E,w,P){var L,Z,X,se,fe,de=l.context.gl,ke=c.paint.get("fill-pattern"),Oe=ke&&ke.constantOr(1),ze=c.getCrossfadeParameters();P?(Z=Oe&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=de.LINES):(Z=Oe?"fillPattern":"fill",L=de.TRIANGLES);for(var Ce=0,je=d;Ce<je.length;Ce+=1){var Qe=je[Ce],gt=h.getTile(Qe);if(!Oe||gt.patternsLoaded()){var Gt=gt.getBucket(c);if(Gt){var Ut=Gt.programConfigurations.get(c.id),Yt=l.useProgram(Z,Ut);Oe&&(l.context.activeTexture.set(de.TEXTURE0),gt.imageAtlasTexture.bind(de.LINEAR,de.CLAMP_TO_EDGE),Ut.updatePaintBuffers(ze));var vr=ke.constantOr(null);if(vr&&gt.imageAtlas){var Dr=gt.imageAtlas,_r=Dr.patternPositions[vr.to.toString()],ln=Dr.patternPositions[vr.from.toString()];_r&&ln&&Ut.setConstantPatternPositions(_r,ln)}var Gn=l.translatePosMatrix(Qe.posMatrix,gt,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(P){se=Gt.indexBuffer2,fe=Gt.segments2;var Hn=[de.drawingBufferWidth,de.drawingBufferHeight];X=Z==="fillOutlinePattern"&&Oe?Gf(Gn,l,ze,gt,Hn):lo(Gn,Hn)}else se=Gt.indexBuffer,fe=Gt.segments,X=Oe?Pu(Gn,l,ze,gt):Mu(Gn);Yt.draw(l.context,L,E,l.stencilModeForClipping(Qe),w,tt.disabled,X,c.id,Gt.layoutVertexBuffer,se,fe,c.paint,l.transform.zoom,Ut)}}}}function bf(l,h,c,d,E,w,P){for(var L=l.context,Z=L.gl,X=c.paint.get("fill-extrusion-pattern"),se=X.constantOr(1),fe=c.getCrossfadeParameters(),de=c.paint.get("fill-extrusion-opacity"),ke=0,Oe=d;ke<Oe.length;ke+=1){var ze=Oe[ke],Ce=h.getTile(ze),je=Ce.getBucket(c);if(je){var Qe=je.programConfigurations.get(c.id),gt=l.useProgram(se?"fillExtrusionPattern":"fillExtrusion",Qe);se&&(l.context.activeTexture.set(Z.TEXTURE0),Ce.imageAtlasTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),Qe.updatePaintBuffers(fe));var Gt=X.constantOr(null);if(Gt&&Ce.imageAtlas){var Ut=Ce.imageAtlas,Yt=Ut.patternPositions[Gt.to.toString()],vr=Ut.patternPositions[Gt.from.toString()];Yt&&vr&&Qe.setConstantPatternPositions(Yt,vr)}var Dr=l.translatePosMatrix(ze.posMatrix,Ce,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),_r=c.paint.get("fill-extrusion-vertical-gradient"),ln=se?Tu(Dr,l,_r,de,ze,fe,Ce):Bc(Dr,l,_r,de);gt.draw(L,L.gl.TRIANGLES,E,w,P,tt.backCCW,ln,c.id,je.layoutVertexBuffer,je.indexBuffer,je.segments,c.paint,l.transform.zoom,Qe)}}}function Fl(l,h,c,d,E,w){var P=l.context,L=P.gl,Z=h.fbo;if(Z){var X=l.useProgram("hillshade");P.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,Z.colorAttachment.get());var se=function(fe,de,ke){var Oe=ke.paint.get("hillshade-shadow-color"),ze=ke.paint.get("hillshade-highlight-color"),Ce=ke.paint.get("hillshade-accent-color"),je=ke.paint.get("hillshade-illumination-direction")*(Math.PI/180);ke.paint.get("hillshade-illumination-anchor")==="viewport"&&(je-=fe.transform.angle);var Qe,gt,Gt,Ut=!fe.options.moving;return{u_matrix:fe.transform.calculatePosMatrix(de.tileID.toUnwrapped(),Ut),u_image:0,u_latrange:(Qe=de.tileID,gt=Math.pow(2,Qe.canonical.z),Gt=Qe.canonical.y,[new g.MercatorCoordinate(0,Gt/gt).toLngLat().lat,new g.MercatorCoordinate(0,(Gt+1)/gt).toLngLat().lat]),u_light:[ke.paint.get("hillshade-exaggeration"),je],u_shadow:Oe,u_highlight:ze,u_accent:Ce}}(l,h,c);X.draw(P,L.TRIANGLES,d,E,w,tt.disabled,se,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}}function hp(l,h,c,d,E,w){var P=l.context,L=P.gl,Z=h.dem;if(Z&&Z.data){var X=Z.dim,se=Z.stride,fe=Z.getPixels();if(P.activeTexture.set(L.TEXTURE1),P.pixelStoreUnpackPremultiplyAlpha.set(!1),h.demTexture=h.demTexture||l.getTileTexture(se),h.demTexture){var de=h.demTexture;de.update(fe,{premultiply:!1}),de.bind(L.NEAREST,L.CLAMP_TO_EDGE)}else h.demTexture=new g.Texture(P,fe,L.RGBA,{premultiply:!1}),h.demTexture.bind(L.NEAREST,L.CLAMP_TO_EDGE);P.activeTexture.set(L.TEXTURE0);var ke=h.fbo;if(!ke){var Oe=new g.Texture(P,{width:X,height:X,data:null},L.RGBA);Oe.bind(L.LINEAR,L.CLAMP_TO_EDGE),(ke=h.fbo=P.createFramebuffer(X,X,!0)).colorAttachment.set(Oe.texture)}P.bindFramebuffer.set(ke.framebuffer),P.viewport.set([0,0,X,X]),l.useProgram("hillshadePrepare").draw(P,L.TRIANGLES,d,E,w,tt.disabled,function(ze,Ce){var je=Ce.stride,Qe=g.create();return g.ortho(Qe,0,g.EXTENT,-g.EXTENT,0,0,1),g.translate(Qe,Qe,[0,-g.EXTENT,0]),{u_matrix:Qe,u_image:1,u_dimension:[je,je],u_zoom:ze.overscaledZ,u_unpack:Ce.getUnpackVector()}}(h.tileID,Z),c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments),h.needsHillshadePrepare=!1}}function Ef(l,h,c,d,E){var w=d.paint.get("raster-fade-duration");if(w>0){var P=g.browser.now(),L=(P-l.timeAdded)/w,Z=h?(P-h.timeAdded)/w:-1,X=c.getSource(),se=E.coveringZoomLevel({tileSize:X.tileSize,roundZoom:X.roundZoom}),fe=!h||Math.abs(h.tileID.overscaledZ-se)>Math.abs(l.tileID.overscaledZ-se),de=fe&&l.refreshedUponExpiration?1:g.clamp(fe?L:1-Z,0,1);return l.refreshedUponExpiration&&L>=1&&(l.refreshedUponExpiration=!1),h?{opacity:1,mix:1-de}:{opacity:de,mix:0}}return{opacity:1,mix:0}}var Bl=new g.Color(1,0,0,1),Sf=new g.Color(0,1,0,1),Cf=new g.Color(0,0,1,1),Nl=new g.Color(1,0,1,1),jc=new g.Color(0,1,1,1);function Ih(l,h,c,d){lc(l,0,h+c/2,l.transform.width,c,d)}function Oh(l,h,c,d){lc(l,h-c/2,0,c,l.transform.height,d)}function lc(l,h,c,d,E,w){var P=l.context,L=P.gl;L.enable(L.SCISSOR_TEST),L.scissor(h*g.browser.devicePixelRatio,c*g.browser.devicePixelRatio,d*g.browser.devicePixelRatio,E*g.browser.devicePixelRatio),P.clear({color:w}),L.disable(L.SCISSOR_TEST)}function Rh(l,h,c){var d=l.context,E=d.gl,w=c.posMatrix,P=l.useProgram("debug"),L=ge.disabled,Z=Ie.disabled,X=l.colorModeForRenderPass();d.activeTexture.set(E.TEXTURE0),l.emptyTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),P.draw(d,E.LINE_STRIP,L,Z,X,tt.disabled,Iu(w,g.Color.red),"$debug",l.debugBuffer,l.tileBorderIndexBuffer,l.debugSegments);var se=h.getTileByID(c.key).latestRawTileData,fe=Math.floor((se&&se.byteLength||0)/1024),de=h.getTile(c).tileSize,ke=512/Math.min(de,512)*(c.overscaledZ/l.transform.zoom)*.5,Oe=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(Oe+=" => "+c.overscaledZ),function(ze,Ce){ze.initDebugOverlayCanvas();var je=ze.debugOverlayCanvas,Qe=ze.context.gl,gt=ze.debugOverlayCanvas.getContext("2d");gt.clearRect(0,0,je.width,je.height),gt.shadowColor="white",gt.shadowBlur=2,gt.lineWidth=1.5,gt.strokeStyle="white",gt.textBaseline="top",gt.font="bold 36px Open Sans, sans-serif",gt.fillText(Ce,5,5),gt.strokeText(Ce,5,5),ze.debugOverlayTexture.update(je),ze.debugOverlayTexture.bind(Qe.LINEAR,Qe.CLAMP_TO_EDGE)}(l,Oe+" "+fe+"kb"),P.draw(d,E.TRIANGLES,L,Z,Ge.alphaBlended,tt.disabled,Iu(w,g.Color.transparent,ke),"$debug",l.debugBuffer,l.quadTriangleIndexBuffer,l.debugSegments)}var zl={symbol:function(l,h,c,d,E){if(l.renderPass==="translucent"){var w=Ie.disabled,P=l.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(L,Z,X,se,fe,de,ke){for(var Oe=Z.transform,ze=fe==="map",Ce=de==="map",je=0,Qe=L;je<Qe.length;je+=1){var gt=Qe[je],Gt=se.getTile(gt),Ut=Gt.getBucket(X);if(Ut&&Ut.text&&Ut.text.segments.get().length){var Yt=g.evaluateSizeForZoom(Ut.textSizeData,Oe.zoom),vr=oa(Gt,1,Z.transform.zoom),Dr=Ta(gt.posMatrix,Ce,ze,Z.transform,vr),_r=X.layout.get("icon-text-fit")!=="none"&&Ut.hasIconData();if(Yt){var ln=Math.pow(2,Oe.zoom-Gt.tileID.overscaledZ);xf(Ut,ze,Ce,ke,g.symbolSize,Oe,Dr,gt.posMatrix,ln,Yt,_r)}}}}(d,l,c,h,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),E),c.paint.get("icon-opacity").constantOr(1)!==0&&du(l,h,c,d,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),w,P),c.paint.get("text-opacity").constantOr(1)!==0&&du(l,h,c,d,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),w,P),h.map.showCollisionBoxes&&(Ku(l,h,c,d,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),Ku(l,h,c,d,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))}},circle:function(l,h,c,d){if(l.renderPass==="translucent"){var E=c.paint.get("circle-opacity"),w=c.paint.get("circle-stroke-width"),P=c.paint.get("circle-stroke-opacity"),L=c.layout.get("circle-sort-key").constantOr(1)!==void 0;if(E.constantOr(1)!==0||w.constantOr(1)!==0&&P.constantOr(1)!==0){for(var Z=l.context,X=Z.gl,se=l.depthModeForSublayer(0,ge.ReadOnly),fe=Ie.disabled,de=l.colorModeForRenderPass(),ke=[],Oe=0;Oe<d.length;Oe++){var ze=d[Oe],Ce=h.getTile(ze),je=Ce.getBucket(c);if(je){var Qe=je.programConfigurations.get(c.id),gt={programConfiguration:Qe,program:l.useProgram("circle",Qe),layoutVertexBuffer:je.layoutVertexBuffer,indexBuffer:je.indexBuffer,uniformValues:Hf(l,ze,Ce,c)};if(L)for(var Gt=0,Ut=je.segments.get();Gt<Ut.length;Gt+=1){var Yt=Ut[Gt];ke.push({segments:new g.SegmentVector([Yt]),sortKey:Yt.sortKey,state:gt})}else ke.push({segments:je.segments,sortKey:0,state:gt})}}L&&ke.sort(function(Gn,Hn){return Gn.sortKey-Hn.sortKey});for(var vr=0,Dr=ke;vr<Dr.length;vr+=1){var _r=Dr[vr],ln=_r.state;ln.program.draw(Z,X.TRIANGLES,se,fe,de,tt.disabled,ln.uniformValues,c.id,ln.layoutVertexBuffer,ln.indexBuffer,_r.segments,c.paint,l.transform.zoom,ln.programConfiguration)}}}},heatmap:function(l,h,c,d){if(c.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){var E=l.context,w=E.gl,P=Ie.disabled,L=new Ge([w.ONE,w.ONE],g.Color.transparent,[!0,!0,!0,!0]);(function(ke,Oe,ze){var Ce=ke.gl;ke.activeTexture.set(Ce.TEXTURE1),ke.viewport.set([0,0,Oe.width/4,Oe.height/4]);var je=ze.heatmapFbo;if(je)Ce.bindTexture(Ce.TEXTURE_2D,je.colorAttachment.get()),ke.bindFramebuffer.set(je.framebuffer);else{var Qe=Ce.createTexture();Ce.bindTexture(Ce.TEXTURE_2D,Qe),Ce.texParameteri(Ce.TEXTURE_2D,Ce.TEXTURE_WRAP_S,Ce.CLAMP_TO_EDGE),Ce.texParameteri(Ce.TEXTURE_2D,Ce.TEXTURE_WRAP_T,Ce.CLAMP_TO_EDGE),Ce.texParameteri(Ce.TEXTURE_2D,Ce.TEXTURE_MIN_FILTER,Ce.LINEAR),Ce.texParameteri(Ce.TEXTURE_2D,Ce.TEXTURE_MAG_FILTER,Ce.LINEAR),je=ze.heatmapFbo=ke.createFramebuffer(Oe.width/4,Oe.height/4,!1),function(gt,Gt,Ut,Yt){var vr=gt.gl;vr.texImage2D(vr.TEXTURE_2D,0,vr.RGBA,Gt.width/4,Gt.height/4,0,vr.RGBA,gt.extRenderToTextureHalfFloat?gt.extTextureHalfFloat.HALF_FLOAT_OES:vr.UNSIGNED_BYTE,null),Yt.colorAttachment.set(Ut)}(ke,Oe,Qe,je)}})(E,l,c),E.clear({color:g.Color.transparent});for(var Z=0;Z<d.length;Z++){var X=d[Z];if(!h.hasRenderableParent(X)){var se=h.getTile(X),fe=se.getBucket(c);if(fe){var de=fe.programConfigurations.get(c.id);l.useProgram("heatmap",de).draw(E,w.TRIANGLES,ge.disabled,P,L,tt.disabled,yf(X.posMatrix,se,l.transform.zoom,c.paint.get("heatmap-intensity")),c.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segments,c.paint,l.transform.zoom,de)}}}E.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(ke,Oe){var ze=ke.context,Ce=ze.gl,je=Oe.heatmapFbo;if(je){ze.activeTexture.set(Ce.TEXTURE0),Ce.bindTexture(Ce.TEXTURE_2D,je.colorAttachment.get()),ze.activeTexture.set(Ce.TEXTURE1);var Qe=Oe.colorRampTexture;Qe||(Qe=Oe.colorRampTexture=new g.Texture(ze,Oe.colorRamp,Ce.RGBA)),Qe.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE),ke.useProgram("heatmapTexture").draw(ze,Ce.TRIANGLES,ge.disabled,Ie.disabled,ke.colorModeForRenderPass(),tt.disabled,function(gt,Gt,Ut,Yt){var vr=g.create();g.ortho(vr,0,gt.width,gt.height,0,0,1);var Dr=gt.context.gl;return{u_matrix:vr,u_world:[Dr.drawingBufferWidth,Dr.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Gt.paint.get("heatmap-opacity")}}(ke,Oe),Oe.id,ke.viewportBuffer,ke.quadTriangleIndexBuffer,ke.viewportSegments,Oe.paint,ke.transform.zoom)}}(l,c))},line:function(l,h,c,d){if(l.renderPass==="translucent"){var E=c.paint.get("line-opacity"),w=c.paint.get("line-width");if(E.constantOr(1)!==0&&w.constantOr(1)!==0)for(var P=l.depthModeForSublayer(0,ge.ReadOnly),L=l.colorModeForRenderPass(),Z=c.paint.get("line-dasharray"),X=c.paint.get("line-pattern"),se=X.constantOr(1),fe=c.paint.get("line-gradient"),de=c.getCrossfadeParameters(),ke=se?"linePattern":Z?"lineSDF":fe?"lineGradient":"line",Oe=l.context,ze=Oe.gl,Ce=!0,je=0,Qe=d;je<Qe.length;je+=1){var gt=Qe[je],Gt=h.getTile(gt);if(!se||Gt.patternsLoaded()){var Ut=Gt.getBucket(c);if(Ut){var Yt=Ut.programConfigurations.get(c.id),vr=l.context.program.get(),Dr=l.useProgram(ke,Yt),_r=Ce||Dr.program!==vr,ln=X.constantOr(null);if(ln&&Gt.imageAtlas){var Gn=Gt.imageAtlas,Hn=Gn.patternPositions[ln.to.toString()],Bn=Gn.patternPositions[ln.from.toString()];Hn&&Bn&&Yt.setConstantPatternPositions(Hn,Bn)}var Di=se?kl(l,Gt,c,de):Z?Mh(l,Gt,c,Z,de):fe?zi(l,Gt,c,Ut.lineClipsArray.length):Rl(l,Gt,c);if(se)Oe.activeTexture.set(ze.TEXTURE0),Gt.imageAtlasTexture.bind(ze.LINEAR,ze.CLAMP_TO_EDGE),Yt.updatePaintBuffers(de);else if(Z&&(_r||l.lineAtlas.dirty))Oe.activeTexture.set(ze.TEXTURE0),l.lineAtlas.bind(Oe);else if(fe){var rn=Ut.gradients[c.id],oi=rn.texture;if(c.gradientVersion!==rn.version){var ci=256;if(c.stepInterpolant){var Qn=h.getSource().maxzoom,Xn=gt.canonical.z===Qn?Math.ceil(1<<l.transform.maxZoom-gt.canonical.z):1;ci=g.clamp(g.nextPowerOfTwo(Ut.maxLineLength/g.EXTENT*1024*Xn),256,Oe.maxTextureSize)}rn.gradient=g.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:ci,image:rn.gradient||void 0,clips:Ut.lineClipsArray}),rn.texture?rn.texture.update(rn.gradient):rn.texture=new g.Texture(Oe,rn.gradient,ze.RGBA),rn.version=c.gradientVersion,oi=rn.texture}Oe.activeTexture.set(ze.TEXTURE0),oi.bind(c.stepInterpolant?ze.NEAREST:ze.LINEAR,ze.CLAMP_TO_EDGE)}Dr.draw(Oe,ze.TRIANGLES,P,l.stencilModeForClipping(gt),L,tt.disabled,Di,c.id,Ut.layoutVertexBuffer,Ut.indexBuffer,Ut.segments,c.paint,l.transform.zoom,Yt,Ut.layoutVertexBuffer2),Ce=!1}}}}},fill:function(l,h,c,d){var E=c.paint.get("fill-color"),w=c.paint.get("fill-opacity");if(w.constantOr(1)!==0){var P=l.colorModeForRenderPass(),L=c.paint.get("fill-pattern"),Z=l.opaquePassEnabledForLayer()&&!L.constantOr(1)&&E.constantOr(g.Color.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";if(l.renderPass===Z){var X=l.depthModeForSublayer(1,l.renderPass==="opaque"?ge.ReadWrite:ge.ReadOnly);Uc(l,h,c,d,X,P,!1)}if(l.renderPass==="translucent"&&c.paint.get("fill-antialias")){var se=l.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,ge.ReadOnly);Uc(l,h,c,d,se,P,!0)}}},"fill-extrusion":function(l,h,c,d){var E=c.paint.get("fill-extrusion-opacity");if(E!==0&&l.renderPass==="translucent"){var w=new ge(l.context.gl.LEQUAL,ge.ReadWrite,l.depthRangeFor3D);if(E!==1||c.paint.get("fill-extrusion-pattern").constantOr(1))bf(l,h,c,d,w,Ie.disabled,Ge.disabled),bf(l,h,c,d,w,l.stencilModeFor3D(),l.colorModeForRenderPass());else{var P=l.colorModeForRenderPass();bf(l,h,c,d,w,Ie.disabled,P)}}},hillshade:function(l,h,c,d){if(l.renderPass==="offscreen"||l.renderPass==="translucent"){for(var E=l.context,w=l.depthModeForSublayer(0,ge.ReadOnly),P=l.colorModeForRenderPass(),L=l.renderPass==="translucent"?l.stencilConfigForOverlap(d):[{},d],Z=L[0],X=0,se=L[1];X<se.length;X+=1){var fe=se[X],de=h.getTile(fe);de.needsHillshadePrepare&&l.renderPass==="offscreen"?hp(l,de,c,w,Ie.disabled,P):l.renderPass==="translucent"&&Fl(l,de,c,w,Z[fe.overscaledZ],P)}E.viewport.set([0,0,l.width,l.height])}},raster:function(l,h,c,d){if(l.renderPass==="translucent"&&c.paint.get("raster-opacity")!==0&&d.length)for(var E=l.context,w=E.gl,P=h.getSource(),L=l.useProgram("raster"),Z=l.colorModeForRenderPass(),X=P instanceof Ke?[{},d]:l.stencilConfigForOverlap(d),se=X[0],fe=X[1],de=fe[fe.length-1].overscaledZ,ke=!l.options.moving,Oe=0,ze=fe;Oe<ze.length;Oe+=1){var Ce=ze[Oe],je=l.depthModeForSublayer(Ce.overscaledZ-de,c.paint.get("raster-opacity")===1?ge.ReadWrite:ge.ReadOnly,w.LESS),Qe=h.getTile(Ce),gt=l.transform.calculatePosMatrix(Ce.toUnwrapped(),ke);Qe.registerFadeDuration(c.paint.get("raster-fade-duration"));var Gt=h.findLoadedParent(Ce,0),Ut=Ef(Qe,Gt,h,c,l.transform),Yt=void 0,vr=void 0,Dr=c.paint.get("raster-resampling")==="nearest"?w.NEAREST:w.LINEAR;E.activeTexture.set(w.TEXTURE0),Qe.texture.bind(Dr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),E.activeTexture.set(w.TEXTURE1),Gt?(Gt.texture.bind(Dr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),Yt=Math.pow(2,Gt.tileID.overscaledZ-Qe.tileID.overscaledZ),vr=[Qe.tileID.canonical.x*Yt%1,Qe.tileID.canonical.y*Yt%1]):Qe.texture.bind(Dr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST);var _r=Wf(gt,vr||[0,0],Yt||1,Ut,c);P instanceof Ke?L.draw(E,w.TRIANGLES,je,Ie.disabled,Z,tt.disabled,_r,c.id,P.boundsBuffer,l.quadTriangleIndexBuffer,P.boundsSegments):L.draw(E,w.TRIANGLES,je,se[Ce.overscaledZ],Z,tt.disabled,_r,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}},background:function(l,h,c){var d=c.paint.get("background-color"),E=c.paint.get("background-opacity");if(E!==0){var w=l.context,P=w.gl,L=l.transform,Z=L.tileSize,X=c.paint.get("background-pattern");if(!l.isPatternMissing(X)){var se=!X&&d.a===1&&E===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass===se){var fe=Ie.disabled,de=l.depthModeForSublayer(0,se==="opaque"?ge.ReadWrite:ge.ReadOnly),ke=l.colorModeForRenderPass(),Oe=l.useProgram(X?"backgroundPattern":"background"),ze=L.coveringTiles({tileSize:Z});X&&(w.activeTexture.set(P.TEXTURE0),l.imageManager.bind(l.context));for(var Ce=c.getCrossfadeParameters(),je=0,Qe=ze;je<Qe.length;je+=1){var gt=Qe[je],Gt=l.transform.calculatePosMatrix(gt.toUnwrapped()),Ut=X?fl(Gt,E,l,X,{tileID:gt,tileSize:Z},Ce):Ll(Gt,E,d);Oe.draw(w,P.TRIANGLES,de,fe,ke,tt.disabled,Ut,c.id,l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments)}}}}},debug:function(l,h,c){for(var d=0;d<c.length;d++)Rh(l,h,c[d])},custom:function(l,h,c){var d=l.context,E=c.implementation;if(l.renderPass==="offscreen"){var w=E.prerender;w&&(l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),w.call(E,d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState())}else if(l.renderPass==="translucent"){l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),d.setStencilMode(Ie.disabled);var P=E.renderingMode==="3d"?new ge(l.context.gl.LEQUAL,ge.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,ge.ReadOnly);d.setDepthMode(P),E.render(d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState(),d.bindFramebuffer.set(null)}}},Ji=function(l,h){this.context=new ce(l),this.transform=h,this._tileTextures={},this.setup(),this.numSublayers=Le.maxUnderzooming+Le.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new wo,this.gpuTimers={}};Ji.prototype.resize=function(l,h){if(this.width=l*g.browser.devicePixelRatio,this.height=h*g.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var c=0,d=this.style._order;c<d.length;c+=1)this.style._layers[d[c]].resize()},Ji.prototype.setup=function(){var l=this.context,h=new g.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(g.EXTENT,0),h.emplaceBack(0,g.EXTENT),h.emplaceBack(g.EXTENT,g.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(h,ma.members),this.tileExtentSegments=g.SegmentVector.simpleSegment(0,0,4,2);var c=new g.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(g.EXTENT,0),c.emplaceBack(0,g.EXTENT),c.emplaceBack(g.EXTENT,g.EXTENT),this.debugBuffer=l.createVertexBuffer(c,ma.members),this.debugSegments=g.SegmentVector.simpleSegment(0,0,4,5);var d=new g.StructArrayLayout4i8;d.emplaceBack(0,0,0,0),d.emplaceBack(g.EXTENT,0,g.EXTENT,0),d.emplaceBack(0,g.EXTENT,0,g.EXTENT),d.emplaceBack(g.EXTENT,g.EXTENT,g.EXTENT,g.EXTENT),this.rasterBoundsBuffer=l.createVertexBuffer(d,He.members),this.rasterBoundsSegments=g.SegmentVector.simpleSegment(0,0,4,2);var E=new g.StructArrayLayout2i4;E.emplaceBack(0,0),E.emplaceBack(1,0),E.emplaceBack(0,1),E.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(E,ma.members),this.viewportSegments=g.SegmentVector.simpleSegment(0,0,4,2);var w=new g.StructArrayLayout1ui2;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(w);var P=new g.StructArrayLayout3ui6;P.emplaceBack(0,1,2),P.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(P),this.emptyTexture=new g.Texture(l,{width:1,height:1,data:new Uint8Array([0,0,0,0])},l.gl.RGBA);var L=this.context.gl;this.stencilClearMode=new Ie({func:L.ALWAYS,mask:0},0,255,L.ZERO,L.ZERO,L.ZERO)},Ji.prototype.clearStencil=function(){var l=this.context,h=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var c=g.create();g.ortho(c,0,this.width,this.height,0,0,1),g.scale(c,c,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,h.TRIANGLES,ge.disabled,this.stencilClearMode,Ge.disabled,tt.disabled,pu(c),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Ji.prototype._renderTileClippingMasks=function(l,h){if(this.currentStencilSource!==l.source&&l.isTileClipped()&&h&&h.length){this.currentStencilSource=l.source;var c=this.context,d=c.gl;this.nextStencilID+h.length>256&&this.clearStencil(),c.setColorMode(Ge.disabled),c.setDepthMode(ge.disabled);var E=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var w=0,P=h;w<P.length;w+=1){var L=P[w],Z=this._tileClippingMaskIDs[L.key]=this.nextStencilID++;E.draw(c,d.TRIANGLES,ge.disabled,new Ie({func:d.ALWAYS,mask:0},Z,255,d.KEEP,d.KEEP,d.REPLACE),Ge.disabled,tt.disabled,pu(L.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Ji.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var l=this.nextStencilID++,h=this.context.gl;return new Ie({func:h.NOTEQUAL,mask:255},l,255,h.KEEP,h.KEEP,h.REPLACE)},Ji.prototype.stencilModeForClipping=function(l){var h=this.context.gl;return new Ie({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,h.KEEP,h.KEEP,h.REPLACE)},Ji.prototype.stencilConfigForOverlap=function(l){var h,c=this.context.gl,d=l.sort(function(Z,X){return X.overscaledZ-Z.overscaledZ}),E=d[d.length-1].overscaledZ,w=d[0].overscaledZ-E+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();for(var P={},L=0;L<w;L++)P[L+E]=new Ie({func:c.GEQUAL,mask:255},L+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=w,[P,d]}return[(h={},h[E]=Ie.disabled,h),d]},Ji.prototype.colorModeForRenderPass=function(){var l=this.context.gl;return this._showOverdrawInspector?new Ge([l.CONSTANT_COLOR,l.ONE],new g.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ge.unblended:Ge.alphaBlended},Ji.prototype.depthModeForSublayer=function(l,h,c){if(!this.opaquePassEnabledForLayer())return ge.disabled;var d=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new ge(c||this.context.gl.LEQUAL,h,[d,d])},Ji.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Ji.prototype.render=function(l,h){var c=this;this.style=l,this.options=h,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(g.browser.now()),this.imageManager.beginFrame();var d=this.style._order,E=this.style.sourceCaches;for(var w in E){var P=E[w];P.used&&P.prepare(this.context)}var L,Z,X={},se={},fe={};for(var de in E){var ke=E[de];X[de]=ke.getVisibleCoordinates(),se[de]=X[de].slice().reverse(),fe[de]=ke.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Oe=0;Oe<d.length;Oe++)if(this.style._layers[d[Oe]].is3D()){this.opaquePassCutoff=Oe;break}this.renderPass="offscreen";for(var ze=0,Ce=d;ze<Ce.length;ze+=1){var je=this.style._layers[Ce[ze]];if(je.hasOffscreenPass()&&!je.isHidden(this.transform.zoom)){var Qe=se[je.source];(je.type==="custom"||Qe.length)&&this.renderLayer(this,E[je.source],je,Qe)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?g.Color.black:g.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){var gt=this.style._layers[d[this.currentLayer]],Gt=E[gt.source],Ut=X[gt.source];this._renderTileClippingMasks(gt,Ut),this.renderLayer(this,Gt,gt,Ut)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){var Yt=this.style._layers[d[this.currentLayer]],vr=E[Yt.source],Dr=(Yt.type==="symbol"?fe:se)[Yt.source];this._renderTileClippingMasks(Yt,X[Yt.source]),this.renderLayer(this,vr,Yt,Dr)}this.options.showTileBoundaries&&(g.values(this.style._layers).forEach(function(_r){_r.source&&!_r.isHidden(c.transform.zoom)&&(_r.source!==(Z&&Z.id)&&(Z=c.style.sourceCaches[_r.source]),(!L||L.getSource().maxzoom<Z.getSource().maxzoom)&&(L=Z))}),L&&zl.debug(this,L,L.getVisibleCoordinates())),this.options.showPadding&&function(_r){var ln=_r.transform.padding;Ih(_r,_r.transform.height-(ln.top||0),3,Bl),Ih(_r,ln.bottom||0,3,Sf),Oh(_r,ln.left||0,3,Cf),Oh(_r,_r.transform.width-(ln.right||0),3,Nl);var Gn=_r.transform.centerPoint;(function(Hn,Bn,Di,rn){lc(Hn,Bn-1,Di-10,2,20,rn),lc(Hn,Bn-10,Di-1,20,2,rn)})(_r,Gn.x,_r.transform.height-Gn.y,jc)}(this),this.context.setDefault()},Ji.prototype.renderLayer=function(l,h,c,d){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||d.length)&&(this.id=c.id,this.gpuTimingStart(c),zl[c.type](l,h,c,d,this.style.placement.variableOffsets),this.gpuTimingEnd())},Ji.prototype.gpuTimingStart=function(l){if(this.options.gpuTiming){var h=this.context.extTimerQuery,c=this.gpuTimers[l.id];c||(c=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),c.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,c.query)}},Ji.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}},Ji.prototype.collectGpuTimers=function(){var l=this.gpuTimers;return this.gpuTimers={},l},Ji.prototype.queryGpuTimers=function(l){var h={};for(var c in l){var d=l[c],E=this.context.extTimerQuery,w=E.getQueryObjectEXT(d.query,E.QUERY_RESULT_EXT)/1e6;E.deleteQueryEXT(d.query),h[c]=w}return h},Ji.prototype.translatePosMatrix=function(l,h,c,d,E){if(!c[0]&&!c[1])return l;var w=E?d==="map"?this.transform.angle:0:d==="viewport"?-this.transform.angle:0;if(w){var P=Math.sin(w),L=Math.cos(w);c=[c[0]*L-c[1]*P,c[0]*P+c[1]*L]}var Z=[E?c[0]:oa(h,c[0],this.transform.zoom),E?c[1]:oa(h,c[1],this.transform.zoom),0],X=new Float32Array(16);return g.translate(X,l,Z),X},Ji.prototype.saveTileTexture=function(l){var h=this._tileTextures[l.size[0]];h?h.push(l):this._tileTextures[l.size[0]]=[l]},Ji.prototype.getTileTexture=function(l){var h=this._tileTextures[l];return h&&h.length>0?h.pop():null},Ji.prototype.isPatternMissing=function(l){if(!l)return!1;if(!l.from||!l.to)return!0;var h=this.imageManager.getPattern(l.from.toString()),c=this.imageManager.getPattern(l.to.toString());return!h||!c},Ji.prototype.useProgram=function(l,h){this.cache=this.cache||{};var c=""+l+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[c]||(this.cache[c]=new gf(this.context,l,Ss[l],h,Dl[l],this._showOverdrawInspector)),this.cache[c]},Ji.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Ji.prototype.setBaseState=function(){var l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)},Ji.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=g.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new g.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Ji.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var cc=function(l,h){this.points=l,this.planes=h};cc.fromInvProjectionMatrix=function(l,h,c){var d=Math.pow(2,c),E=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(P){return g.transformMat4([],P,l)}).map(function(P){return g.scale$1([],P,1/P[3]/h*d)}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(P){var L=g.sub([],E[P[0]],E[P[1]]),Z=g.sub([],E[P[2]],E[P[1]]),X=g.normalize([],g.cross([],L,Z)),se=-g.dot(X,E[P[1]]);return X.concat(se)});return new cc(E,w)};var ca=function(l,h){this.min=l,this.max=h,this.center=g.scale$2([],g.add([],this.min,this.max),.5)};ca.prototype.quadrant=function(l){for(var h=[l%2==0,l<2],c=g.clone$2(this.min),d=g.clone$2(this.max),E=0;E<h.length;E++)c[E]=h[E]?this.min[E]:this.center[E],d[E]=h[E]?this.center[E]:this.max[E];return d[2]=this.max[2],new ca(c,d)},ca.prototype.distanceX=function(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]},ca.prototype.distanceY=function(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]},ca.prototype.intersects=function(l){for(var h=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],c=!0,d=0;d<l.planes.length;d++){for(var E=l.planes[d],w=0,P=0;P<h.length;P++)w+=g.dot$1(E,h[P])>=0;if(w===0)return 0;w!==h.length&&(c=!1)}if(c)return 2;for(var L=0;L<3;L++){for(var Z=Number.MAX_VALUE,X=-Number.MAX_VALUE,se=0;se<l.points.length;se++){var fe=l.points[se][L]-this.min[L];Z=Math.min(Z,fe),X=Math.max(X,fe)}if(X<0||Z>this.max[L]-this.min[L])return 0}return 1};var Ou=function(l,h,c,d){if(l===void 0&&(l=0),h===void 0&&(h=0),c===void 0&&(c=0),d===void 0&&(d=0),isNaN(l)||l<0||isNaN(h)||h<0||isNaN(c)||c<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=h,this.left=c,this.right=d};Ou.prototype.interpolate=function(l,h,c){return h.top!=null&&l.top!=null&&(this.top=g.number(l.top,h.top,c)),h.bottom!=null&&l.bottom!=null&&(this.bottom=g.number(l.bottom,h.bottom,c)),h.left!=null&&l.left!=null&&(this.left=g.number(l.left,h.left,c)),h.right!=null&&l.right!=null&&(this.right=g.number(l.right,h.right,c)),this},Ou.prototype.getCenter=function(l,h){var c=g.clamp((this.left+l-this.right)/2,0,l),d=g.clamp((this.top+h-this.bottom)/2,0,h);return new g.Point(c,d)},Ou.prototype.equals=function(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right},Ou.prototype.clone=function(){return new Ou(this.top,this.bottom,this.left,this.right)},Ou.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var qi=function(l,h,c,d,E){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=E===void 0||E,this._minZoom=l||0,this._maxZoom=h||22,this._minPitch=c==null?0:c,this._maxPitch=d==null?60:d,this.setMaxBounds(),this.width=0,this.height=0,this._center=new g.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Ou,this._posMatrixCache={},this._alignedPosMatrixCache={}},Pa={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};qi.prototype.clone=function(){var l=new qi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.tileSize=this.tileSize,l.latRange=this.latRange,l.width=this.width,l.height=this.height,l._center=this._center,l.zoom=this.zoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._calcMatrices(),l},Pa.minZoom.get=function(){return this._minZoom},Pa.minZoom.set=function(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))},Pa.maxZoom.get=function(){return this._maxZoom},Pa.maxZoom.set=function(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))},Pa.minPitch.get=function(){return this._minPitch},Pa.minPitch.set=function(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))},Pa.maxPitch.get=function(){return this._maxPitch},Pa.maxPitch.set=function(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))},Pa.renderWorldCopies.get=function(){return this._renderWorldCopies},Pa.renderWorldCopies.set=function(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l},Pa.worldSize.get=function(){return this.tileSize*this.scale},Pa.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Pa.size.get=function(){return new g.Point(this.width,this.height)},Pa.bearing.get=function(){return-this.angle/Math.PI*180},Pa.bearing.set=function(l){var h=-g.wrap(l,-180,180)*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=g.create$2(),g.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Pa.pitch.get=function(){return this._pitch/Math.PI*180},Pa.pitch.set=function(l){var h=g.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())},Pa.fov.get=function(){return this._fov/Math.PI*180},Pa.fov.set=function(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())},Pa.zoom.get=function(){return this._zoom},Pa.zoom.set=function(l){var h=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.scale=this.zoomScale(h),this.tileZoom=Math.floor(h),this.zoomFraction=h-this.tileZoom,this._constrain(),this._calcMatrices())},Pa.center.get=function(){return this._center},Pa.center.set=function(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())},Pa.padding.get=function(){return this._edgeInsets.toJSON()},Pa.padding.set=function(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())},Pa.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},qi.prototype.isPaddingEqual=function(l){return this._edgeInsets.equals(l)},qi.prototype.interpolatePadding=function(l,h,c){this._unmodified=!1,this._edgeInsets.interpolate(l,h,c),this._constrain(),this._calcMatrices()},qi.prototype.coveringZoomLevel=function(l){var h=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,h)},qi.prototype.getVisibleUnwrappedCoordinates=function(l){var h=[new g.UnwrappedTileID(0,l)];if(this._renderWorldCopies)for(var c=this.pointCoordinate(new g.Point(0,0)),d=this.pointCoordinate(new g.Point(this.width,0)),E=this.pointCoordinate(new g.Point(this.width,this.height)),w=this.pointCoordinate(new g.Point(0,this.height)),P=Math.floor(Math.min(c.x,d.x,E.x,w.x)),L=Math.floor(Math.max(c.x,d.x,E.x,w.x)),Z=P-1;Z<=L+1;Z++)Z!==0&&h.push(new g.UnwrappedTileID(Z,l));return h},qi.prototype.coveringTiles=function(l){var h=this.coveringZoomLevel(l),c=h;if(l.minzoom!==void 0&&h<l.minzoom)return[];l.maxzoom!==void 0&&h>l.maxzoom&&(h=l.maxzoom);var d=g.MercatorCoordinate.fromLngLat(this.center),E=Math.pow(2,h),w=[E*d.x,E*d.y,0],P=cc.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h),L=l.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(L=h);var Z=function(_r){return{aabb:new ca([_r*E,0,0],[(_r+1)*E,E,0]),zoom:0,x:0,y:0,wrap:_r,fullyVisible:!1}},X=[],se=[],fe=h,de=l.reparseOverscaled?c:h;if(this._renderWorldCopies)for(var ke=1;ke<=3;ke++)X.push(Z(-ke)),X.push(Z(ke));for(X.push(Z(0));X.length>0;){var Oe=X.pop(),ze=Oe.x,Ce=Oe.y,je=Oe.fullyVisible;if(!je){var Qe=Oe.aabb.intersects(P);if(Qe===0)continue;je=Qe===2}var gt=Oe.aabb.distanceX(w),Gt=Oe.aabb.distanceY(w),Ut=Math.max(Math.abs(gt),Math.abs(Gt));if(Oe.zoom===fe||Ut>3+(1<<fe-Oe.zoom)-2&&Oe.zoom>=L)se.push({tileID:new g.OverscaledTileID(Oe.zoom===fe?de:Oe.zoom,Oe.wrap,Oe.zoom,ze,Ce),distanceSq:g.sqrLen([w[0]-.5-ze,w[1]-.5-Ce])});else for(var Yt=0;Yt<4;Yt++){var vr=(ze<<1)+Yt%2,Dr=(Ce<<1)+(Yt>>1);X.push({aabb:Oe.aabb.quadrant(Yt),zoom:Oe.zoom+1,x:vr,y:Dr,wrap:Oe.wrap,fullyVisible:je})}}return se.sort(function(_r,ln){return _r.distanceSq-ln.distanceSq}).map(function(_r){return _r.tileID})},qi.prototype.resize=function(l,h){this.width=l,this.height=h,this.pixelsToGLUnits=[2/l,-2/h],this._constrain(),this._calcMatrices()},Pa.unmodified.get=function(){return this._unmodified},qi.prototype.zoomScale=function(l){return Math.pow(2,l)},qi.prototype.scaleZoom=function(l){return Math.log(l)/Math.LN2},qi.prototype.project=function(l){var h=g.clamp(l.lat,-this.maxValidLatitude,this.maxValidLatitude);return new g.Point(g.mercatorXfromLng(l.lng)*this.worldSize,g.mercatorYfromLat(h)*this.worldSize)},qi.prototype.unproject=function(l){return new g.MercatorCoordinate(l.x/this.worldSize,l.y/this.worldSize).toLngLat()},Pa.point.get=function(){return this.project(this.center)},qi.prototype.setLocationAtPoint=function(l,h){var c=this.pointCoordinate(h),d=this.pointCoordinate(this.centerPoint),E=this.locationCoordinate(l),w=new g.MercatorCoordinate(E.x-(c.x-d.x),E.y-(c.y-d.y));this.center=this.coordinateLocation(w),this._renderWorldCopies&&(this.center=this.center.wrap())},qi.prototype.locationPoint=function(l){return this.coordinatePoint(this.locationCoordinate(l))},qi.prototype.pointLocation=function(l){return this.coordinateLocation(this.pointCoordinate(l))},qi.prototype.locationCoordinate=function(l){return g.MercatorCoordinate.fromLngLat(l)},qi.prototype.coordinateLocation=function(l){return l.toLngLat()},qi.prototype.pointCoordinate=function(l){var h=[l.x,l.y,0,1],c=[l.x,l.y,1,1];g.transformMat4(h,h,this.pixelMatrixInverse),g.transformMat4(c,c,this.pixelMatrixInverse);var d=h[3],E=c[3],w=h[1]/d,P=c[1]/E,L=h[2]/d,Z=c[2]/E,X=L===Z?0:(0-L)/(Z-L);return new g.MercatorCoordinate(g.number(h[0]/d,c[0]/E,X)/this.worldSize,g.number(w,P,X)/this.worldSize)},qi.prototype.coordinatePoint=function(l){var h=[l.x*this.worldSize,l.y*this.worldSize,0,1];return g.transformMat4(h,h,this.pixelMatrix),new g.Point(h[0]/h[3],h[1]/h[3])},qi.prototype.getBounds=function(){return new g.LngLatBounds().extend(this.pointLocation(new g.Point(0,0))).extend(this.pointLocation(new g.Point(this.width,0))).extend(this.pointLocation(new g.Point(this.width,this.height))).extend(this.pointLocation(new g.Point(0,this.height)))},qi.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new g.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},qi.prototype.setMaxBounds=function(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},qi.prototype.calculatePosMatrix=function(l,h){h===void 0&&(h=!1);var c=l.key,d=h?this._alignedPosMatrixCache:this._posMatrixCache;if(d[c])return d[c];var E=l.canonical,w=this.worldSize/this.zoomScale(E.z),P=E.x+Math.pow(2,E.z)*l.wrap,L=g.identity(new Float64Array(16));return g.translate(L,L,[P*w,E.y*w,0]),g.scale(L,L,[w/g.EXTENT,w/g.EXTENT,1]),g.multiply(L,h?this.alignedProjMatrix:this.projMatrix,L),d[c]=new Float32Array(L),d[c]},qi.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},qi.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var l,h,c,d,E=-90,w=90,P=-180,L=180,Z=this.size,X=this._unmodified;if(this.latRange){var se=this.latRange;E=g.mercatorYfromLat(se[1])*this.worldSize,l=(w=g.mercatorYfromLat(se[0])*this.worldSize)-E<Z.y?Z.y/(w-E):0}if(this.lngRange){var fe=this.lngRange;P=g.mercatorXfromLng(fe[0])*this.worldSize,h=(L=g.mercatorXfromLng(fe[1])*this.worldSize)-P<Z.x?Z.x/(L-P):0}var de=this.point,ke=Math.max(h||0,l||0);if(ke)return this.center=this.unproject(new g.Point(h?(L+P)/2:de.x,l?(w+E)/2:de.y)),this.zoom+=this.scaleZoom(ke),this._unmodified=X,void(this._constraining=!1);if(this.latRange){var Oe=de.y,ze=Z.y/2;Oe-ze<E&&(d=E+ze),Oe+ze>w&&(d=w-ze)}if(this.lngRange){var Ce=de.x,je=Z.x/2;Ce-je<P&&(c=P+je),Ce+je>L&&(c=L-je)}c===void 0&&d===void 0||(this.center=this.unproject(new g.Point(c!==void 0?c:de.x,d!==void 0?d:de.y))),this._unmodified=X,this._constraining=!1}},qi.prototype._calcMatrices=function(){if(this.height){var l=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var h=Math.PI/2+this._pitch,c=this._fov*(.5+l.y/this.height),d=Math.sin(c)*this.cameraToCenterDistance/Math.sin(g.clamp(Math.PI-h-c,.01,Math.PI-.01)),E=this.point,w=E.x,P=E.y,L=1.01*(Math.cos(Math.PI/2-this._pitch)*d+this.cameraToCenterDistance),Z=this.height/50,X=new Float64Array(16);g.perspective(X,this._fov,this.width/this.height,Z,L),X[8]=2*-l.x/this.width,X[9]=2*l.y/this.height,g.scale(X,X,[1,-1,1]),g.translate(X,X,[0,0,-this.cameraToCenterDistance]),g.rotateX(X,X,this._pitch),g.rotateZ(X,X,this.angle),g.translate(X,X,[-w,-P,0]),this.mercatorMatrix=g.scale([],X,[this.worldSize,this.worldSize,this.worldSize]),g.scale(X,X,[1,1,g.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=X,this.invProjMatrix=g.invert([],this.projMatrix);var se=this.width%2/2,fe=this.height%2/2,de=Math.cos(this.angle),ke=Math.sin(this.angle),Oe=w-Math.round(w)+de*se+ke*fe,ze=P-Math.round(P)+de*fe+ke*se,Ce=new Float64Array(X);if(g.translate(Ce,Ce,[Oe>.5?Oe-1:Oe,ze>.5?ze-1:ze,0]),this.alignedProjMatrix=Ce,X=g.create(),g.scale(X,X,[this.width/2,-this.height/2,1]),g.translate(X,X,[1,-1,0]),this.labelPlaneMatrix=X,X=g.create(),g.scale(X,X,[1,-1,1]),g.translate(X,X,[-1,-1,0]),g.scale(X,X,[2/this.width,2/this.height,1]),this.glCoordMatrix=X,this.pixelMatrix=g.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(X=g.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=X,this._posMatrixCache={},this._alignedPosMatrixCache={}}},qi.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var l=this.pointCoordinate(new g.Point(0,0)),h=[l.x*this.worldSize,l.y*this.worldSize,0,1];return g.transformMat4(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance},qi.prototype.getCameraPoint=function(){var l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new g.Point(0,l))},qi.prototype.getCameraQueryGeometry=function(l){var h=this.getCameraPoint();if(l.length===1)return[l[0],h];for(var c=h.x,d=h.y,E=h.x,w=h.y,P=0,L=l;P<L.length;P+=1){var Z=L[P];c=Math.min(c,Z.x),d=Math.min(d,Z.y),E=Math.max(E,Z.x),w=Math.max(w,Z.y)}return[new g.Point(c,d),new g.Point(E,d),new g.Point(E,w),new g.Point(c,w),new g.Point(c,d)]},Object.defineProperties(qi.prototype,Pa);var Cs=function(l){var h,c,d,E;this._hashName=l&&encodeURIComponent(l),g.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(h=this._updateHashUnthrottled.bind(this),c=!1,d=null,E=function(){d=null,c&&(h(),d=setTimeout(E,300),c=!1)},function(){return c=!0,d||E(),d})};Cs.prototype.addTo=function(l){return this._map=l,g.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Cs.prototype.remove=function(){return g.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Cs.prototype.getHashString=function(l){var h=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,d=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,d),w=Math.round(h.lng*E)/E,P=Math.round(h.lat*E)/E,L=this._map.getBearing(),Z=this._map.getPitch(),X="";if(X+=l?"/"+w+"/"+P+"/"+c:c+"/"+P+"/"+w,(L||Z)&&(X+="/"+Math.round(10*L)/10),Z&&(X+="/"+Math.round(Z)),this._hashName){var se=this._hashName,fe=!1,de=g.window.location.hash.slice(1).split("&").map(function(ke){var Oe=ke.split("=")[0];return Oe===se?(fe=!0,Oe+"="+X):ke}).filter(function(ke){return ke});return fe||de.push(se+"="+X),"#"+de.join("&")}return"#"+X},Cs.prototype._getCurrentHash=function(){var l,h=this,c=g.window.location.hash.replace("#","");return this._hashName?(c.split("&").map(function(d){return d.split("=")}).forEach(function(d){d[0]===h._hashName&&(l=d)}),(l&&l[1]||"").split("/")):c.split("/")},Cs.prototype._onHashChange=function(){var l=this._getCurrentHash();if(l.length>=3&&!l.some(function(c){return isNaN(c)})){var h=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(l[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:h,pitch:+(l[4]||0)}),!0}return!1},Cs.prototype._updateHashUnthrottled=function(){var l=g.window.location.href.replace(/(#.+)?$/,this.getHashString());try{g.window.history.replaceState(g.window.history.state,null,l)}catch(h){}};var Vc={linearity:.3,easing:g.bezier(0,0,.3,1)},$u=g.extend({deceleration:2500,maxSpeed:1400},Vc),Ua=g.extend({deceleration:20,maxSpeed:1400},Vc),fc=g.extend({deceleration:1e3,maxSpeed:360},Vc),Zl=g.extend({deceleration:1e3,maxSpeed:90},Vc),Qu=function(l){this._map=l,this.clear()};function Gc(l,h){(!l.duration||l.duration<h.duration)&&(l.duration=h.duration,l.easing=h.easing)}function Ru(l,h,c){var d=c.maxSpeed,E=c.linearity,w=c.deceleration,P=g.clamp(l*E/(h/1e3),-d,d),L=Math.abs(P)/(w*E);return{easing:c.easing,duration:1e3*L,amount:P*(L/2)}}Qu.prototype.clear=function(){this._inertiaBuffer=[]},Qu.prototype.record=function(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:g.browser.now(),settings:l})},Qu.prototype._drainInertiaBuffer=function(){for(var l=this._inertiaBuffer,h=g.browser.now();l.length>0&&h-l[0].time>160;)l.shift()},Qu.prototype._onMoveEnd=function(l){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var h={zoom:0,bearing:0,pitch:0,pan:new g.Point(0,0),pinchAround:void 0,around:void 0},c=0,d=this._inertiaBuffer;c<d.length;c+=1){var E=d[c].settings;h.zoom+=E.zoomDelta||0,h.bearing+=E.bearingDelta||0,h.pitch+=E.pitchDelta||0,E.panDelta&&h.pan._add(E.panDelta),E.around&&(h.around=E.around),E.pinchAround&&(h.pinchAround=E.pinchAround)}var w=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,P={};if(h.pan.mag()){var L=Ru(h.pan.mag(),w,g.extend({},$u,l||{}));P.offset=h.pan.mult(L.amount/h.pan.mag()),P.center=this._map.transform.center,Gc(P,L)}if(h.zoom){var Z=Ru(h.zoom,w,Ua);P.zoom=this._map.transform.zoom+Z.amount,Gc(P,Z)}if(h.bearing){var X=Ru(h.bearing,w,fc);P.bearing=this._map.transform.bearing+g.clamp(X.amount,-179,179),Gc(P,X)}if(h.pitch){var se=Ru(h.pitch,w,Zl);P.pitch=this._map.transform.pitch+se.amount,Gc(P,se)}if(P.zoom||P.bearing){var fe=h.pinchAround===void 0?h.around:h.pinchAround;P.around=fe?this._map.unproject(fe):this._map.getCenter()}return this.clear(),g.extend(P,{noMoveStart:!0})}};var mo=function(l){function h(d,E,w,P){P===void 0&&(P={});var L=H.mousePos(E.getCanvasContainer(),w),Z=E.unproject(L);l.call(this,d,g.extend({point:L,lngLat:Z,originalEvent:w},P)),this._defaultPrevented=!1,this.target=E}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var c={defaultPrevented:{configurable:!0}};return h.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(h.prototype,c),h}(g.Event),Ul=function(l){function h(d,E,w){var P=d==="touchend"?w.changedTouches:w.touches,L=H.touchPos(E.getCanvasContainer(),P),Z=L.map(function(fe){return E.unproject(fe)}),X=L.reduce(function(fe,de,ke,Oe){return fe.add(de.div(Oe.length))},new g.Point(0,0)),se=E.unproject(X);l.call(this,d,{points:L,point:X,lngLats:Z,lngLat:se,originalEvent:w}),this._defaultPrevented=!1}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var c={defaultPrevented:{configurable:!0}};return h.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(h.prototype,c),h}(g.Event),hc=function(l){function h(d,E,w){l.call(this,d,{originalEvent:w}),this._defaultPrevented=!1}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var c={defaultPrevented:{configurable:!0}};return h.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(h.prototype,c),h}(g.Event),go=function(l,h){this._map=l,this._clickTolerance=h.clickTolerance};go.prototype.reset=function(){delete this._mousedownPos},go.prototype.wheel=function(l){return this._firePreventable(new hc(l.type,this._map,l))},go.prototype.mousedown=function(l,h){return this._mousedownPos=h,this._firePreventable(new mo(l.type,this._map,l))},go.prototype.mouseup=function(l){this._map.fire(new mo(l.type,this._map,l))},go.prototype.click=function(l,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new mo(l.type,this._map,l))},go.prototype.dblclick=function(l){return this._firePreventable(new mo(l.type,this._map,l))},go.prototype.mouseover=function(l){this._map.fire(new mo(l.type,this._map,l))},go.prototype.mouseout=function(l){this._map.fire(new mo(l.type,this._map,l))},go.prototype.touchstart=function(l){return this._firePreventable(new Ul(l.type,this._map,l))},go.prototype.touchmove=function(l){this._map.fire(new Ul(l.type,this._map,l))},go.prototype.touchend=function(l){this._map.fire(new Ul(l.type,this._map,l))},go.prototype.touchcancel=function(l){this._map.fire(new Ul(l.type,this._map,l))},go.prototype._firePreventable=function(l){if(this._map.fire(l),l.defaultPrevented)return{}},go.prototype.isEnabled=function(){return!0},go.prototype.isActive=function(){return!1},go.prototype.enable=function(){},go.prototype.disable=function(){};var gn=function(l){this._map=l};gn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},gn.prototype.mousemove=function(l){this._map.fire(new mo(l.type,this._map,l))},gn.prototype.mousedown=function(){this._delayContextMenu=!0},gn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new mo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},gn.prototype.contextmenu=function(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new mo(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()},gn.prototype.isEnabled=function(){return!0},gn.prototype.isActive=function(){return!1},gn.prototype.enable=function(){},gn.prototype.disable=function(){};var co=function(l,h){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=h.clickTolerance||1};function Ju(l,h){for(var c={},d=0;d<l.length;d++)c[l[d].identifier]=h[d];return c}co.prototype.isEnabled=function(){return!!this._enabled},co.prototype.isActive=function(){return!!this._active},co.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},co.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},co.prototype.mousedown=function(l,h){this.isEnabled()&&l.shiftKey&&l.button===0&&(H.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)},co.prototype.mousemoveWindow=function(l,h){if(this._active){var c=h;if(!(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)){var d=this._startPos;this._lastPos=c,this._box||(this._box=H.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));var E=Math.min(d.x,c.x),w=Math.max(d.x,c.x),P=Math.min(d.y,c.y),L=Math.max(d.y,c.y);H.setTransform(this._box,"translate("+E+"px,"+P+"px)"),this._box.style.width=w-E+"px",this._box.style.height=L-P+"px"}}},co.prototype.mouseupWindow=function(l,h){var c=this;if(this._active&&l.button===0){var d=this._startPos,E=h;if(this.reset(),H.suppressClick(),d.x!==E.x||d.y!==E.y)return this._map.fire(new g.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:function(w){return w.fitScreenCoordinates(d,E,c._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",l)}},co.prototype.keydown=function(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))},co.prototype.blur=function(){this.reset()},co.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(H.remove(this._box),this._box=null),H.enableDrag(),delete this._startPos,delete this._lastPos},co.prototype._fireEvent=function(l,h){return this._map.fire(new g.Event(l,{originalEvent:h}))};var ka=function(l){this.reset(),this.numTouches=l.numTouches};ka.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},ka.prototype.touchstart=function(l,h,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),c.length===this.numTouches&&(this.centroid=function(d){for(var E=new g.Point(0,0),w=0,P=d;w<P.length;w+=1)E._add(P[w]);return E.div(d.length)}(h),this.touches=Ju(c,h)))},ka.prototype.touchmove=function(l,h,c){if(!this.aborted&&this.centroid){var d=Ju(c,h);for(var E in this.touches){var w=d[E];(!w||w.dist(this.touches[E])>30)&&(this.aborted=!0)}}},ka.prototype.touchend=function(l,h,c){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){var d=!this.aborted&&this.centroid;if(this.reset(),d)return d}};var Qs=function(l){this.singleTap=new ka(l),this.numTaps=l.numTaps,this.reset()};Qs.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Qs.prototype.touchstart=function(l,h,c){this.singleTap.touchstart(l,h,c)},Qs.prototype.touchmove=function(l,h,c){this.singleTap.touchmove(l,h,c)},Qs.prototype.touchend=function(l,h,c){var d=this.singleTap.touchend(l,h,c);if(d){var E=l.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(d)<30;if(E&&w||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}};var Is=function(){this._zoomIn=new Qs({numTouches:1,numTaps:2}),this._zoomOut=new Qs({numTouches:2,numTaps:1}),this.reset()};Is.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Is.prototype.touchstart=function(l,h,c){this._zoomIn.touchstart(l,h,c),this._zoomOut.touchstart(l,h,c)},Is.prototype.touchmove=function(l,h,c){this._zoomIn.touchmove(l,h,c),this._zoomOut.touchmove(l,h,c)},Is.prototype.touchend=function(l,h,c){var d=this,E=this._zoomIn.touchend(l,h,c),w=this._zoomOut.touchend(l,h,c);return E?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(P){return P.easeTo({duration:300,zoom:P.getZoom()+1,around:P.unproject(E)},{originalEvent:l})}}):w?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(P){return P.easeTo({duration:300,zoom:P.getZoom()-1,around:P.unproject(w)},{originalEvent:l})}}):void 0},Is.prototype.touchcancel=function(){this.reset()},Is.prototype.enable=function(){this._enabled=!0},Is.prototype.disable=function(){this._enabled=!1,this.reset()},Is.prototype.isEnabled=function(){return this._enabled},Is.prototype.isActive=function(){return this._active};var Af={0:1,2:2},Vr=function(l){this.reset(),this._clickTolerance=l.clickTolerance||1};Vr.prototype.blur=function(){this.reset()},Vr.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Vr.prototype._correctButton=function(l,h){return!1},Vr.prototype._move=function(l,h){return{}},Vr.prototype.mousedown=function(l,h){if(!this._lastPoint){var c=H.mouseButton(l);this._correctButton(l,c)&&(this._lastPoint=h,this._eventButton=c)}},Vr.prototype.mousemoveWindow=function(l,h){var c=this._lastPoint;if(c){if(l.preventDefault(),function(d,E){var w=Af[E];return d.buttons===void 0||(d.buttons&w)!==w}(l,this._eventButton))this.reset();else if(this._moved||!(h.dist(c)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(c,h)}},Vr.prototype.mouseupWindow=function(l){this._lastPoint&&H.mouseButton(l)===this._eventButton&&(this._moved&&H.suppressClick(),this.reset())},Vr.prototype.enable=function(){this._enabled=!0},Vr.prototype.disable=function(){this._enabled=!1,this.reset()},Vr.prototype.isEnabled=function(){return this._enabled},Vr.prototype.isActive=function(){return this._active};var pc=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.mousedown=function(c,d){l.prototype.mousedown.call(this,c,d),this._lastPoint&&(this._active=!0)},h.prototype._correctButton=function(c,d){return d===0&&!c.ctrlKey},h.prototype._move=function(c,d){return{around:d,panDelta:d.sub(c)}},h}(Vr),wf=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},h.prototype._move=function(c,d){var E=.8*(d.x-c.x);if(E)return this._active=!0,{bearingDelta:E}},h.prototype.contextmenu=function(c){c.preventDefault()},h}(Vr),hl=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},h.prototype._move=function(c,d){var E=-.5*(d.y-c.y);if(E)return this._active=!0,{pitchDelta:E}},h.prototype.contextmenu=function(c){c.preventDefault()},h}(Vr),Aa=function(l){this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset()};Aa.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new g.Point(0,0)},Aa.prototype.touchstart=function(l,h,c){return this._calculateTransform(l,h,c)},Aa.prototype.touchmove=function(l,h,c){if(this._active&&!(c.length<this._minTouches))return l.preventDefault(),this._calculateTransform(l,h,c)},Aa.prototype.touchend=function(l,h,c){this._calculateTransform(l,h,c),this._active&&c.length<this._minTouches&&this.reset()},Aa.prototype.touchcancel=function(){this.reset()},Aa.prototype._calculateTransform=function(l,h,c){c.length>0&&(this._active=!0);var d=Ju(c,h),E=new g.Point(0,0),w=new g.Point(0,0),P=0;for(var L in d){var Z=d[L],X=this._touches[L];X&&(E._add(Z),w._add(Z.sub(X)),P++,d[L]=Z)}if(this._touches=d,!(P<this._minTouches)&&w.mag()){var se=w.div(P);if(this._sum._add(se),!(this._sum.mag()<this._clickTolerance))return{around:E.div(P),panDelta:se}}},Aa.prototype.enable=function(){this._enabled=!0},Aa.prototype.disable=function(){this._enabled=!1,this.reset()},Aa.prototype.isEnabled=function(){return this._enabled},Aa.prototype.isActive=function(){return this._active};var As=function(){this.reset()};function Tf(l,h,c){for(var d=0;d<l.length;d++)if(l[d].identifier===c)return h[d]}function ku(l,h){return Math.log(l/h)/Math.LN2}As.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},As.prototype._start=function(l){},As.prototype._move=function(l,h,c){return{}},As.prototype.touchstart=function(l,h,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([h[0],h[1]]))},As.prototype.touchmove=function(l,h,c){if(this._firstTwoTouches){l.preventDefault();var d=this._firstTwoTouches,E=d[1],w=Tf(c,h,d[0]),P=Tf(c,h,E);if(w&&P){var L=this._aroundCenter?null:w.add(P).div(2);return this._move([w,P],L,l)}}},As.prototype.touchend=function(l,h,c){if(this._firstTwoTouches){var d=this._firstTwoTouches,E=d[1],w=Tf(c,h,d[0]),P=Tf(c,h,E);w&&P||(this._active&&H.suppressClick(),this.reset())}},As.prototype.touchcancel=function(){this.reset()},As.prototype.enable=function(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"},As.prototype.disable=function(){this._enabled=!1,this.reset()},As.prototype.isEnabled=function(){return this._enabled},As.prototype.isActive=function(){return this._active};var Bs=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.reset=function(){l.prototype.reset.call(this),delete this._distance,delete this._startDistance},h.prototype._start=function(c){this._startDistance=this._distance=c[0].dist(c[1])},h.prototype._move=function(c,d){var E=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(ku(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ku(this._distance,E),pinchAround:d}},h}(As);function Lu(l,h){return 180*l.angleWith(h)/Math.PI}var qf=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.reset=function(){l.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},h.prototype._start=function(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])},h.prototype._move=function(c,d){var E=this._vector;if(this._vector=c[0].sub(c[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Lu(this._vector,E),pinchAround:d}},h.prototype._isBelowThreshold=function(c){this._minDiameter=Math.min(this._minDiameter,c.mag());var d=25/(Math.PI*this._minDiameter)*360,E=Lu(c,this._startVector);return Math.abs(E)<d},h}(As);function pl(l){return Math.abs(l.y)>Math.abs(l.x)}var Kf=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.reset=function(){l.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},h.prototype._start=function(c){this._lastPoints=c,pl(c[0].sub(c[1]))&&(this._valid=!1)},h.prototype._move=function(c,d,E){var w=c[0].sub(this._lastPoints[0]),P=c[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(w,P,E.timeStamp),this._valid)return this._lastPoints=c,this._active=!0,{pitchDelta:(w.y+P.y)/2*-.5}},h.prototype.gestureBeginsVertically=function(c,d,E){if(this._valid!==void 0)return this._valid;var w=c.mag()>=2,P=d.mag()>=2;if(w||P){if(!w||!P)return this._firstMove===void 0&&(this._firstMove=E),E-this._firstMove<100&&void 0;var L=c.y>0==d.y>0;return pl(c)&&pl(d)&&L}},h}(As),Mf={panStep:100,bearingStep:15,pitchStep:10},vu=function(){var l=Mf;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1};function Os(l){return l*(2-l)}vu.prototype.blur=function(){this.reset()},vu.prototype.reset=function(){this._active=!1},vu.prototype.keydown=function(l){var h=this;if(!(l.altKey||l.ctrlKey||l.metaKey)){var c=0,d=0,E=0,w=0,P=0;switch(l.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:l.shiftKey?d=-1:(l.preventDefault(),w=-1);break;case 39:l.shiftKey?d=1:(l.preventDefault(),w=1);break;case 38:l.shiftKey?E=1:(l.preventDefault(),P=-1);break;case 40:l.shiftKey?E=-1:(l.preventDefault(),P=1);break;default:return}return this._rotationDisabled&&(d=0,E=0),{cameraAnimation:function(L){var Z=L.getZoom();L.easeTo({duration:300,easeId:"keyboardHandler",easing:Os,zoom:c?Math.round(Z)+c*(l.shiftKey?2:1):Z,bearing:L.getBearing()+d*h._bearingStep,pitch:L.getPitch()+E*h._pitchStep,offset:[-w*h._panStep,-P*h._panStep],center:L.getCenter()},{originalEvent:l})}}}},vu.prototype.enable=function(){this._enabled=!0},vu.prototype.disable=function(){this._enabled=!1,this.reset()},vu.prototype.isEnabled=function(){return this._enabled},vu.prototype.isActive=function(){return this._active},vu.prototype.disableRotation=function(){this._rotationDisabled=!0},vu.prototype.enableRotation=function(){this._rotationDisabled=!1};var Mi=function(l,h){this._map=l,this._el=l.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,g.bindAll(["_onTimeout"],this)};Mi.prototype.setZoomRate=function(l){this._defaultZoomRate=l},Mi.prototype.setWheelZoomRate=function(l){this._wheelZoomRate=l},Mi.prototype.isEnabled=function(){return!!this._enabled},Mi.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Mi.prototype.isZooming=function(){return!!this._zooming},Mi.prototype.enable=function(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=l&&l.around==="center")},Mi.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Mi.prototype.wheel=function(l){if(this.isEnabled()){var h=l.deltaMode===g.window.WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY,c=g.browser.now(),d=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,h!==0&&h%4.000244140625==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(d*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),l.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=l,this._delta-=h,this._active||this._start(l)),l.preventDefault()}},Mi.prototype._onTimeout=function(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},Mi.prototype._start=function(l){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var h=H.mousePos(this._el,l);this._around=g.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(h)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Mi.prototype.renderFrame=function(){var l=this;if(this._frameId&&(this._frameId=null,this.isActive())){var h=this._map.transform;if(this._delta!==0){var c=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,d=2/(1+Math.exp(-Math.abs(this._delta*c)));this._delta<0&&d!==0&&(d=1/d);var E=typeof this._targetZoom=="number"?h.zoomScale(this._targetZoom):h.scale;this._targetZoom=Math.min(h.maxZoom,Math.max(h.minZoom,h.scaleZoom(E*d))),this._type==="wheel"&&(this._startZoom=h.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var w,P=typeof this._targetZoom=="number"?this._targetZoom:h.zoom,L=this._startZoom,Z=this._easing,X=!1;if(this._type==="wheel"&&L&&Z){var se=Math.min((g.browser.now()-this._lastWheelEventTime)/200,1),fe=Z(se);w=g.number(L,P,fe),se<1?this._frameId||(this._frameId=!0):X=!0}else w=P,X=!0;return this._active=!0,X&&(this._active=!1,this._finishTimeout=setTimeout(function(){l._zooming=!1,l._handler._triggerRenderFrame(),delete l._targetZoom,delete l._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!X,zoomDelta:w-h.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Mi.prototype._smoothOutEasing=function(l){var h=g.ease;if(this._prevEase){var c=this._prevEase,d=(g.browser.now()-c.start)/c.duration,E=c.easing(d+.01)-c.easing(d),w=.27/Math.sqrt(E*E+1e-4)*.01,P=Math.sqrt(.0729-w*w);h=g.bezier(w,P,.25,1)}return this._prevEase={start:g.browser.now(),duration:l,easing:h},h},Mi.prototype.blur=function(){this.reset()},Mi.prototype.reset=function(){this._active=!1};var Du=function(l,h){this._clickZoom=l,this._tapZoom=h};Du.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Du.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Du.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Du.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var mu=function(){this.reset()};mu.prototype.reset=function(){this._active=!1},mu.prototype.blur=function(){this.reset()},mu.prototype.dblclick=function(l,h){return l.preventDefault(),{cameraAnimation:function(c){c.easeTo({duration:300,zoom:c.getZoom()+(l.shiftKey?-1:1),around:c.unproject(h)},{originalEvent:l})}}},mu.prototype.enable=function(){this._enabled=!0},mu.prototype.disable=function(){this._enabled=!1,this.reset()},mu.prototype.isEnabled=function(){return this._enabled},mu.prototype.isActive=function(){return this._active};var Go=function(){this._tap=new Qs({numTouches:1,numTaps:1}),this.reset()};Go.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Go.prototype.touchstart=function(l,h,c){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?c.length>0&&(this._swipePoint=h[0],this._swipeTouch=c[0].identifier):this._tap.touchstart(l,h,c))},Go.prototype.touchmove=function(l,h,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;var d=h[0],E=d.y-this._swipePoint.y;return this._swipePoint=d,l.preventDefault(),this._active=!0,{zoomDelta:E/128}}}else this._tap.touchmove(l,h,c)},Go.prototype.touchend=function(l,h,c){this._tapTime?this._swipePoint&&c.length===0&&this.reset():this._tap.touchend(l,h,c)&&(this._tapTime=l.timeStamp)},Go.prototype.touchcancel=function(){this.reset()},Go.prototype.enable=function(){this._enabled=!0},Go.prototype.disable=function(){this._enabled=!1,this.reset()},Go.prototype.isEnabled=function(){return this._enabled},Go.prototype.isActive=function(){return this._active};var dl=function(l,h,c){this._el=l,this._mousePan=h,this._touchPan=c};dl.prototype.enable=function(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},dl.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},dl.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},dl.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var os=function(l,h,c){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=h,this._mousePitch=c};os.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},os.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},os.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},os.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var Js=function(l,h,c,d){this._el=l,this._touchZoom=h,this._touchRotate=c,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0};Js.prototype.enable=function(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},Js.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},Js.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},Js.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},Js.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},Js.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var ws=function(l){return l.zoom||l.drag||l.pitch||l.rotate},Eu=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h}(g.Event);function Ln(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}var wn=function(l,h){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Qu(l),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h),g.bindAll(["handleEvent","handleWindowEvent"],this);var c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[g.window.document,"mousemove",{capture:!0}],[g.window.document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[g.window,"blur",void 0]];for(var d=0,E=this._listeners;d<E.length;d+=1){var w=E[d],P=w[0];H.addEventListener(P,w[1],P===g.window.document?this.handleWindowEvent:this.handleEvent,w[2])}};wn.prototype.destroy=function(){for(var l=0,h=this._listeners;l<h.length;l+=1){var c=h[l],d=c[0];H.removeEventListener(d,c[1],d===g.window.document?this.handleWindowEvent:this.handleEvent,c[2])}},wn.prototype._addDefaultHandlers=function(l){var h=this._map,c=h.getCanvasContainer();this._add("mapEvent",new go(h,l));var d=h.boxZoom=new co(h,l);this._add("boxZoom",d);var E=new Is,w=new mu;h.doubleClickZoom=new Du(w,E),this._add("tapZoom",E),this._add("clickZoom",w);var P=new Go;this._add("tapDragZoom",P);var L=h.touchPitch=new Kf;this._add("touchPitch",L);var Z=new wf(l),X=new hl(l);h.dragRotate=new os(l,Z,X),this._add("mouseRotate",Z,["mousePitch"]),this._add("mousePitch",X,["mouseRotate"]);var se=new pc(l),fe=new Aa(l);h.dragPan=new dl(c,se,fe),this._add("mousePan",se),this._add("touchPan",fe,["touchZoom","touchRotate"]);var de=new qf,ke=new Bs;h.touchZoomRotate=new Js(c,ke,de,P),this._add("touchRotate",de,["touchPan","touchZoom"]),this._add("touchZoom",ke,["touchPan","touchRotate"]);var Oe=h.scrollZoom=new Mi(h,this);this._add("scrollZoom",Oe,["mousePan"]);var ze=h.keyboard=new vu;this._add("keyboard",ze),this._add("blockableMapEvent",new gn(h));for(var Ce=0,je=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Ce<je.length;Ce+=1){var Qe=je[Ce];l.interactive&&l[Qe]&&h[Qe].enable(l[Qe])}},wn.prototype._add=function(l,h,c){this._handlers.push({handlerName:l,handler:h,allowed:c}),this._handlersById[l]=h},wn.prototype.stop=function(l){if(!this._updatingCamera){for(var h=0,c=this._handlers;h<c.length;h+=1)c[h].handler.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}},wn.prototype.isActive=function(){for(var l=0,h=this._handlers;l<h.length;l+=1)if(h[l].handler.isActive())return!0;return!1},wn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},wn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},wn.prototype.isMoving=function(){return Boolean(ws(this._eventsInProgress))||this.isZooming()},wn.prototype._blockedByActive=function(l,h,c){for(var d in l)if(d!==c&&(!h||h.indexOf(d)<0))return!0;return!1},wn.prototype.handleWindowEvent=function(l){this.handleEvent(l,l.type+"Window")},wn.prototype._getMapTouches=function(l){for(var h=[],c=0,d=l;c<d.length;c+=1){var E=d[c];this._el.contains(E.target)&&h.push(E)}return h},wn.prototype.handleEvent=function(l,h){this._updatingCamera=!0;for(var c=l.type==="renderFrame"?void 0:l,d={needsRenderFrame:!1},E={},w={},P=l.touches?this._getMapTouches(l.touches):void 0,L=P?H.touchPos(this._el,P):H.mousePos(this._el,l),Z=0,X=this._handlers;Z<X.length;Z+=1){var se=X[Z],fe=se.handlerName,de=se.handler,ke=se.allowed;if(de.isEnabled()){var Oe=void 0;this._blockedByActive(w,ke,fe)?de.reset():de[h||l.type]&&(Oe=de[h||l.type](l,L,P),this.mergeHandlerResult(d,E,Oe,fe,c),Oe&&Oe.needsRenderFrame&&this._triggerRenderFrame()),(Oe||de.isActive())&&(w[fe]=de)}}var ze={};for(var Ce in this._previousActiveHandlers)w[Ce]||(ze[Ce]=c);this._previousActiveHandlers=w,(Object.keys(ze).length||Ln(d))&&(this._changes.push([d,E,ze]),this._triggerRenderFrame()),(Object.keys(w).length||Ln(d))&&this._map._stop(!0),this._updatingCamera=!1;var je=d.cameraAnimation;je&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],je(this._map))},wn.prototype.mergeHandlerResult=function(l,h,c,d,E){if(c){g.extend(l,c);var w={handlerName:d,originalEvent:c.originalEvent||E};c.zoomDelta!==void 0&&(h.zoom=w),c.panDelta!==void 0&&(h.drag=w),c.pitchDelta!==void 0&&(h.pitch=w),c.bearingDelta!==void 0&&(h.rotate=w)}},wn.prototype._applyChanges=function(){for(var l={},h={},c={},d=0,E=this._changes;d<E.length;d+=1){var w=E[d],P=w[0],L=w[1],Z=w[2];P.panDelta&&(l.panDelta=(l.panDelta||new g.Point(0,0))._add(P.panDelta)),P.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+P.zoomDelta),P.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+P.bearingDelta),P.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+P.pitchDelta),P.around!==void 0&&(l.around=P.around),P.pinchAround!==void 0&&(l.pinchAround=P.pinchAround),P.noInertia&&(l.noInertia=P.noInertia),g.extend(h,L),g.extend(c,Z)}this._updateMapTransform(l,h,c),this._changes=[]},wn.prototype._updateMapTransform=function(l,h,c){var d=this._map,E=d.transform;if(!Ln(l))return this._fireEvents(h,c,!0);var w=l.panDelta,P=l.zoomDelta,L=l.bearingDelta,Z=l.pitchDelta,X=l.around,se=l.pinchAround;se!==void 0&&(X=se),d._stop(!0),X=X||d.transform.centerPoint;var fe=E.pointLocation(w?X.sub(w):X);L&&(E.bearing+=L),Z&&(E.pitch+=Z),P&&(E.zoom+=P),E.setLocationAtPoint(fe,X),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(h,c,!0)},wn.prototype._fireEvents=function(l,h,c){var d=this,E=ws(this._eventsInProgress),w=ws(l),P={};for(var L in l)this._eventsInProgress[L]||(P[L+"start"]=l[L].originalEvent),this._eventsInProgress[L]=l[L];for(var Z in!E&&w&&this._fireEvent("movestart",w.originalEvent),P)this._fireEvent(Z,P[Z]);for(var X in w&&this._fireEvent("move",w.originalEvent),l)this._fireEvent(X,l[X].originalEvent);var se,fe={};for(var de in this._eventsInProgress){var ke=this._eventsInProgress[de],Oe=ke.handlerName,ze=ke.originalEvent;this._handlersById[Oe].isActive()||(delete this._eventsInProgress[de],fe[de+"end"]=se=h[Oe]||ze)}for(var Ce in fe)this._fireEvent(Ce,fe[Ce]);var je=ws(this._eventsInProgress);if(c&&(E||w)&&!je){this._updatingCamera=!0;var Qe=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),gt=function(Gt){return Gt!==0&&-d._bearingSnap<Gt&&Gt<d._bearingSnap};Qe?(gt(Qe.bearing||this._map.getBearing())&&(Qe.bearing=0),this._map.easeTo(Qe,{originalEvent:se})):(this._map.fire(new g.Event("moveend",{originalEvent:se})),gt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},wn.prototype._fireEvent=function(l,h){this._map.fire(new g.Event(l,h?{originalEvent:h}:{}))},wn.prototype._requestFrame=function(){var l=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(h){delete l._frameId,l.handleEvent(new Eu("renderFrame",{timeStamp:h})),l._applyChanges()})},wn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Hc=function(l){function h(c,d){l.call(this),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=d.bearingSnap,g.bindAll(["_renderFrameCallback"],this)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getCenter=function(){return new g.LngLat(this.transform.center.lng,this.transform.center.lat)},h.prototype.setCenter=function(c,d){return this.jumpTo({center:c},d)},h.prototype.panBy=function(c,d,E){return c=g.Point.convert(c).mult(-1),this.panTo(this.transform.center,g.extend({offset:c},d),E)},h.prototype.panTo=function(c,d,E){return this.easeTo(g.extend({center:c},d),E)},h.prototype.getZoom=function(){return this.transform.zoom},h.prototype.setZoom=function(c,d){return this.jumpTo({zoom:c},d),this},h.prototype.zoomTo=function(c,d,E){return this.easeTo(g.extend({zoom:c},d),E)},h.prototype.zoomIn=function(c,d){return this.zoomTo(this.getZoom()+1,c,d),this},h.prototype.zoomOut=function(c,d){return this.zoomTo(this.getZoom()-1,c,d),this},h.prototype.getBearing=function(){return this.transform.bearing},h.prototype.setBearing=function(c,d){return this.jumpTo({bearing:c},d),this},h.prototype.getPadding=function(){return this.transform.padding},h.prototype.setPadding=function(c,d){return this.jumpTo({padding:c},d),this},h.prototype.rotateTo=function(c,d,E){return this.easeTo(g.extend({bearing:c},d),E)},h.prototype.resetNorth=function(c,d){return this.rotateTo(0,g.extend({duration:1e3},c),d),this},h.prototype.resetNorthPitch=function(c,d){return this.easeTo(g.extend({bearing:0,pitch:0,duration:1e3},c),d),this},h.prototype.snapToNorth=function(c,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,d):this},h.prototype.getPitch=function(){return this.transform.pitch},h.prototype.setPitch=function(c,d){return this.jumpTo({pitch:c},d),this},h.prototype.cameraForBounds=function(c,d){c=g.LngLatBounds.convert(c);var E=d&&d.bearing||0;return this._cameraForBoxAndBearing(c.getNorthWest(),c.getSouthEast(),E,d)},h.prototype._cameraForBoxAndBearing=function(c,d,E,w){var P={top:0,bottom:0,right:0,left:0};if(typeof(w=g.extend({padding:P,offset:[0,0],maxZoom:this.transform.maxZoom},w)).padding=="number"){var L=w.padding;w.padding={top:L,bottom:L,right:L,left:L}}w.padding=g.extend(P,w.padding);var Z=this.transform,X=Z.padding,se=Z.project(g.LngLat.convert(c)),fe=Z.project(g.LngLat.convert(d)),de=se.rotate(-E*Math.PI/180),ke=fe.rotate(-E*Math.PI/180),Oe=new g.Point(Math.max(de.x,ke.x),Math.max(de.y,ke.y)),ze=new g.Point(Math.min(de.x,ke.x),Math.min(de.y,ke.y)),Ce=Oe.sub(ze),je=(Z.width-(X.left+X.right+w.padding.left+w.padding.right))/Ce.x,Qe=(Z.height-(X.top+X.bottom+w.padding.top+w.padding.bottom))/Ce.y;if(!(Qe<0||je<0)){var gt=Math.min(Z.scaleZoom(Z.scale*Math.min(je,Qe)),w.maxZoom),Gt=typeof w.offset.x=="number"?new g.Point(w.offset.x,w.offset.y):g.Point.convert(w.offset),Ut=new g.Point((w.padding.left-w.padding.right)/2,(w.padding.top-w.padding.bottom)/2).rotate(E*Math.PI/180),Yt=Gt.add(Ut).mult(Z.scale/Z.zoomScale(gt));return{center:Z.unproject(se.add(fe).div(2).sub(Yt)),zoom:gt,bearing:E}}g.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},h.prototype.fitBounds=function(c,d,E){return this._fitInternal(this.cameraForBounds(c,d),d,E)},h.prototype.fitScreenCoordinates=function(c,d,E,w,P){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(g.Point.convert(c)),this.transform.pointLocation(g.Point.convert(d)),E,w),w,P)},h.prototype._fitInternal=function(c,d,E){return c?(delete(d=g.extend(c,d)).padding,d.linear?this.easeTo(d,E):this.flyTo(d,E)):this},h.prototype.jumpTo=function(c,d){this.stop();var E=this.transform,w=!1,P=!1,L=!1;return"zoom"in c&&E.zoom!==+c.zoom&&(w=!0,E.zoom=+c.zoom),c.center!==void 0&&(E.center=g.LngLat.convert(c.center)),"bearing"in c&&E.bearing!==+c.bearing&&(P=!0,E.bearing=+c.bearing),"pitch"in c&&E.pitch!==+c.pitch&&(L=!0,E.pitch=+c.pitch),c.padding==null||E.isPaddingEqual(c.padding)||(E.padding=c.padding),this.fire(new g.Event("movestart",d)).fire(new g.Event("move",d)),w&&this.fire(new g.Event("zoomstart",d)).fire(new g.Event("zoom",d)).fire(new g.Event("zoomend",d)),P&&this.fire(new g.Event("rotatestart",d)).fire(new g.Event("rotate",d)).fire(new g.Event("rotateend",d)),L&&this.fire(new g.Event("pitchstart",d)).fire(new g.Event("pitch",d)).fire(new g.Event("pitchend",d)),this.fire(new g.Event("moveend",d))},h.prototype.easeTo=function(c,d){var E=this;this._stop(!1,c.easeId),((c=g.extend({offset:[0,0],duration:500,easing:g.ease},c)).animate===!1||!c.essential&&g.browser.prefersReducedMotion)&&(c.duration=0);var w=this.transform,P=this.getZoom(),L=this.getBearing(),Z=this.getPitch(),X=this.getPadding(),se="zoom"in c?+c.zoom:P,fe="bearing"in c?this._normalizeBearing(c.bearing,L):L,de="pitch"in c?+c.pitch:Z,ke="padding"in c?c.padding:w.padding,Oe=g.Point.convert(c.offset),ze=w.centerPoint.add(Oe),Ce=w.pointLocation(ze),je=g.LngLat.convert(c.center||Ce);this._normalizeCenter(je);var Qe,gt,Gt=w.project(Ce),Ut=w.project(je).sub(Gt),Yt=w.zoomScale(se-P);c.around&&(Qe=g.LngLat.convert(c.around),gt=w.locationPoint(Qe));var vr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||se!==P,this._rotating=this._rotating||L!==fe,this._pitching=this._pitching||de!==Z,this._padding=!w.isPaddingEqual(ke),this._easeId=c.easeId,this._prepareEase(d,c.noMoveStart,vr),this._ease(function(Dr){if(E._zooming&&(w.zoom=g.number(P,se,Dr)),E._rotating&&(w.bearing=g.number(L,fe,Dr)),E._pitching&&(w.pitch=g.number(Z,de,Dr)),E._padding&&(w.interpolatePadding(X,ke,Dr),ze=w.centerPoint.add(Oe)),Qe)w.setLocationAtPoint(Qe,gt);else{var _r=w.zoomScale(w.zoom-P),ln=se>P?Math.min(2,Yt):Math.max(.5,Yt),Gn=Math.pow(ln,1-Dr),Hn=w.unproject(Gt.add(Ut.mult(Dr*Gn)).mult(_r));w.setLocationAtPoint(w.renderWorldCopies?Hn.wrap():Hn,ze)}E._fireMoveEvents(d)},function(Dr){E._afterEase(d,Dr)},c),this},h.prototype._prepareEase=function(c,d,E){E===void 0&&(E={}),this._moving=!0,d||E.moving||this.fire(new g.Event("movestart",c)),this._zooming&&!E.zooming&&this.fire(new g.Event("zoomstart",c)),this._rotating&&!E.rotating&&this.fire(new g.Event("rotatestart",c)),this._pitching&&!E.pitching&&this.fire(new g.Event("pitchstart",c))},h.prototype._fireMoveEvents=function(c){this.fire(new g.Event("move",c)),this._zooming&&this.fire(new g.Event("zoom",c)),this._rotating&&this.fire(new g.Event("rotate",c)),this._pitching&&this.fire(new g.Event("pitch",c))},h.prototype._afterEase=function(c,d){if(!this._easeId||!d||this._easeId!==d){delete this._easeId;var E=this._zooming,w=this._rotating,P=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,E&&this.fire(new g.Event("zoomend",c)),w&&this.fire(new g.Event("rotateend",c)),P&&this.fire(new g.Event("pitchend",c)),this.fire(new g.Event("moveend",c))}},h.prototype.flyTo=function(c,d){var E=this;if(!c.essential&&g.browser.prefersReducedMotion){var w=g.pick(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(w,d)}this.stop(),c=g.extend({offset:[0,0],speed:1.2,curve:1.42,easing:g.ease},c);var P=this.transform,L=this.getZoom(),Z=this.getBearing(),X=this.getPitch(),se=this.getPadding(),fe="zoom"in c?g.clamp(+c.zoom,P.minZoom,P.maxZoom):L,de="bearing"in c?this._normalizeBearing(c.bearing,Z):Z,ke="pitch"in c?+c.pitch:X,Oe="padding"in c?c.padding:P.padding,ze=P.zoomScale(fe-L),Ce=g.Point.convert(c.offset),je=P.centerPoint.add(Ce),Qe=P.pointLocation(je),gt=g.LngLat.convert(c.center||Qe);this._normalizeCenter(gt);var Gt=P.project(Qe),Ut=P.project(gt).sub(Gt),Yt=c.curve,vr=Math.max(P.width,P.height),Dr=vr/ze,_r=Ut.mag();if("minZoom"in c){var ln=g.clamp(Math.min(c.minZoom,L,fe),P.minZoom,P.maxZoom),Gn=vr/P.zoomScale(ln-L);Yt=Math.sqrt(Gn/_r*2)}var Hn=Yt*Yt;function Bn($n){var qn=(Dr*Dr-vr*vr+($n?-1:1)*Hn*Hn*_r*_r)/(2*($n?Dr:vr)*Hn*_r);return Math.log(Math.sqrt(qn*qn+1)-qn)}function Di($n){return(Math.exp($n)-Math.exp(-$n))/2}function rn($n){return(Math.exp($n)+Math.exp(-$n))/2}var oi=Bn(0),ci=function($n){return rn(oi)/rn(oi+Yt*$n)},Qn=function($n){return vr*((rn(oi)*(Di(qn=oi+Yt*$n)/rn(qn))-Di(oi))/Hn)/_r;var qn},Xn=(Bn(1)-oi)/Yt;if(Math.abs(_r)<1e-6||!isFinite(Xn)){if(Math.abs(vr-Dr)<1e-6)return this.easeTo(c,d);var di=Dr<vr?-1:1;Xn=Math.abs(Math.log(Dr/vr))/Yt,Qn=function(){return 0},ci=function($n){return Math.exp(di*Yt*$n)}}return c.duration="duration"in c?+c.duration:1e3*Xn/("screenSpeed"in c?+c.screenSpeed/Yt:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0),this._zooming=!0,this._rotating=Z!==de,this._pitching=ke!==X,this._padding=!P.isPaddingEqual(Oe),this._prepareEase(d,!1),this._ease(function($n){var qn=$n*Xn,yo=1/ci(qn);P.zoom=$n===1?fe:L+P.scaleZoom(yo),E._rotating&&(P.bearing=g.number(Z,de,$n)),E._pitching&&(P.pitch=g.number(X,ke,$n)),E._padding&&(P.interpolatePadding(se,Oe,$n),je=P.centerPoint.add(Ce));var Qa=$n===1?gt:P.unproject(Gt.add(Ut.mult(Qn(qn))).mult(yo));P.setLocationAtPoint(P.renderWorldCopies?Qa.wrap():Qa,je),E._fireMoveEvents(d)},function(){return E._afterEase(d)},c),this},h.prototype.isEasing=function(){return!!this._easeFrameId},h.prototype.stop=function(){return this._stop()},h.prototype._stop=function(c,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var E=this._onEaseEnd;delete this._onEaseEnd,E.call(this,d)}if(!c){var w=this.handlers;w&&w.stop(!1)}return this},h.prototype._ease=function(c,d,E){E.animate===!1||E.duration===0?(c(1),d()):(this._easeStart=g.browser.now(),this._easeOptions=E,this._onEaseFrame=c,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},h.prototype._renderFrameCallback=function(){var c=Math.min((g.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},h.prototype._normalizeBearing=function(c,d){c=g.wrap(c,-180,180);var E=Math.abs(c-d);return Math.abs(c-360-d)<E&&(c-=360),Math.abs(c+360-d)<E&&(c+=360),c},h.prototype._normalizeCenter=function(c){var d=this.transform;if(d.renderWorldCopies&&!d.lngRange){var E=c.lng-d.center.lng;c.lng+=E>180?-360:E<-180?360:0}},h}(g.Evented),Qo=function(l){l===void 0&&(l={}),this.options=l,g.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};Qo.prototype.getDefaultPosition=function(){return"bottom-right"},Qo.prototype.onAdd=function(l){var h=this.options&&this.options.compact;return this._map=l,this._container=H.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=H.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=H.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),h===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},Qo.prototype.onRemove=function(){H.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},Qo.prototype._setElementTitle=function(l,h){var c=this._map._getUIString("AttributionControl."+h);l.title=c,l.setAttribute("aria-label",c)},Qo.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},Qo.prototype._updateEditLink=function(){var l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));var h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||g.config.ACCESS_TOKEN}];if(l){var c=h.reduce(function(d,E,w){return E.value&&(d+=E.key+"="+E.value+(w<h.length-1?"&":"")),d},"?");l.href=g.config.FEEDBACK_URL+"/"+c+(this._map._hash?this._map._hash.getHashString(!0):""),l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}},Qo.prototype._updateData=function(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},Qo.prototype._updateAttributions=function(){if(this._map.style){var l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(function(L){return typeof L!="string"?"":L})):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){var h=this._map.style.stylesheet;this.styleOwner=h.owner,this.styleId=h.id}var c=this._map.style.sourceCaches;for(var d in c){var E=c[d];if(E.used){var w=E.getSource();w.attribution&&l.indexOf(w.attribution)<0&&l.push(w.attribution)}}l.sort(function(L,Z){return L.length-Z.length});var P=(l=l.filter(function(L,Z){for(var X=Z+1;X<l.length;X++)if(l[X].indexOf(L)>=0)return!1;return!0})).join(" | ");P!==this._attribHTML&&(this._attribHTML=P,l.length?(this._innerContainer.innerHTML=P,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},Qo.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var eu=function(){g.bindAll(["_updateLogo"],this),g.bindAll(["_updateCompact"],this)};eu.prototype.onAdd=function(l){this._map=l,this._container=H.create("div","mapboxgl-ctrl");var h=H.create("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},eu.prototype.onRemove=function(){H.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},eu.prototype.getDefaultPosition=function(){return"bottom-left"},eu.prototype._updateLogo=function(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},eu.prototype._logoRequired=function(){if(this._map.style){var l=this._map.style.sourceCaches;for(var h in l)if(l[h].getSource().mapbox_logo)return!0;return!1}},eu.prototype._updateCompact=function(){var l=this._container.children;if(l.length){var h=l[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}};var Ho=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Ho.prototype.add=function(l){var h=++this._id;return this._queue.push({callback:l,id:h,cancelled:!1}),h},Ho.prototype.remove=function(l){for(var h=this._currentlyRunning,c=0,d=h?this._queue.concat(h):this._queue;c<d.length;c+=1){var E=d[c];if(E.id===l)return void(E.cancelled=!0)}},Ho.prototype.run=function(l){l===void 0&&(l=0);var h=this._currentlyRunning=this._queue;this._queue=[];for(var c=0,d=h;c<d.length;c+=1){var E=d[c];if(!E.cancelled&&(E.callback(l),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Ho.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var gu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},$f=g.window.HTMLImageElement,Wc=g.window.HTMLElement,ga=g.window.ImageBitmap,La={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},vl=function(l){function h(d){var E=this;if((d=g.extend({},La,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var w=new qi(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies);if(l.call(this,w,d),this._interactive=d.interactive,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._crossSourceCollisions=d.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=d.collectResourceTiming,this._renderTaskQueue=new Ho,this._controls=[],this._mapId=g.uniqueId(),this._locale=g.extend({},gu,d.locale),this._clickTolerance=d.clickTolerance,this._requestManager=new g.RequestManager(d.transformRequest,d.accessToken),typeof d.container=="string"){if(this._container=g.window.document.getElementById(d.container),!this._container)throw new Error("Container '"+d.container+"' not found.")}else{if(!(d.container instanceof Wc))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(d.maxBounds&&this.setMaxBounds(d.maxBounds),g.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return E._update(!1)}),this.on("moveend",function(){return E._update(!1)}),this.on("zoom",function(){return E._update(!0)}),g.window!==void 0&&(g.window.addEventListener("online",this._onWindowOnline,!1),g.window.addEventListener("resize",this._onWindowResize,!1),g.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new wn(this,d),this._hash=d.hash&&new Cs(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,g.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localIdeographFontFamily:d.localIdeographFontFamily}),d.attributionControl&&this.addControl(new Qo({customAttribution:d.customAttribution})),this.addControl(new eu,d.logoPosition),this.on("style.load",function(){E.transform.unmodified&&E.jumpTo(E.style.stylesheet)}),this.on("data",function(P){E._update(P.dataType==="style"),E.fire(new g.Event(P.dataType+"data",P))}),this.on("dataloading",function(P){E.fire(new g.Event(P.dataType+"dataloading",P))})}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var c={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return h.prototype._getMapId=function(){return this._mapId},h.prototype.addControl=function(d,E){if(E===void 0&&(E=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new g.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var w=d.onAdd(this);this._controls.push(d);var P=this._controlPositions[E];return E.indexOf("bottom")!==-1?P.insertBefore(w,P.firstChild):P.appendChild(w),this},h.prototype.removeControl=function(d){if(!d||!d.onRemove)return this.fire(new g.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var E=this._controls.indexOf(d);return E>-1&&this._controls.splice(E,1),d.onRemove(this),this},h.prototype.hasControl=function(d){return this._controls.indexOf(d)>-1},h.prototype.resize=function(d){var E=this._containerDimensions(),w=E[0],P=E[1];if(w===this.transform.width&&P===this.transform.height)return this;this._resizeCanvas(w,P),this.transform.resize(w,P),this.painter.resize(w,P);var L=!this._moving;return L&&this.fire(new g.Event("movestart",d)).fire(new g.Event("move",d)),this.fire(new g.Event("resize",d)),L&&this.fire(new g.Event("moveend",d)),this},h.prototype.getBounds=function(){return this.transform.getBounds()},h.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},h.prototype.setMaxBounds=function(d){return this.transform.setMaxBounds(g.LngLatBounds.convert(d)),this._update()},h.prototype.setMinZoom=function(d){if((d=d==null?-2:d)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d&&this.setZoom(d),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},h.prototype.getMinZoom=function(){return this.transform.minZoom},h.prototype.setMaxZoom=function(d){if((d=d==null?22:d)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d&&this.setZoom(d),this;throw new Error("maxZoom must be greater than the current minZoom")},h.prototype.getMaxZoom=function(){return this.transform.maxZoom},h.prototype.setMinPitch=function(d){if((d=d==null?0:d)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d&&this.setPitch(d),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},h.prototype.getMinPitch=function(){return this.transform.minPitch},h.prototype.setMaxPitch=function(d){if((d=d==null?60:d)>60)throw new Error("maxPitch must be less than or equal to 60");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d&&this.setPitch(d),this;throw new Error("maxPitch must be greater than the current minPitch")},h.prototype.getMaxPitch=function(){return this.transform.maxPitch},h.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},h.prototype.setRenderWorldCopies=function(d){return this.transform.renderWorldCopies=d,this._update()},h.prototype.project=function(d){return this.transform.locationPoint(g.LngLat.convert(d))},h.prototype.unproject=function(d){return this.transform.pointLocation(g.Point.convert(d))},h.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},h.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},h.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},h.prototype._createDelegatedListener=function(d,E,w){var P,L=this;if(d==="mouseenter"||d==="mouseover"){var Z=!1;return{layer:E,listener:w,delegates:{mousemove:function(se){var fe=L.getLayer(E)?L.queryRenderedFeatures(se.point,{layers:[E]}):[];fe.length?Z||(Z=!0,w.call(L,new mo(d,L,se.originalEvent,{features:fe}))):Z=!1},mouseout:function(){Z=!1}}}}if(d==="mouseleave"||d==="mouseout"){var X=!1;return{layer:E,listener:w,delegates:{mousemove:function(se){(L.getLayer(E)?L.queryRenderedFeatures(se.point,{layers:[E]}):[]).length?X=!0:X&&(X=!1,w.call(L,new mo(d,L,se.originalEvent)))},mouseout:function(se){X&&(X=!1,w.call(L,new mo(d,L,se.originalEvent)))}}}}return{layer:E,listener:w,delegates:(P={},P[d]=function(se){var fe=L.getLayer(E)?L.queryRenderedFeatures(se.point,{layers:[E]}):[];fe.length&&(se.features=fe,w.call(L,se),delete se.features)},P)}},h.prototype.on=function(d,E,w){if(w===void 0)return l.prototype.on.call(this,d,E);var P=this._createDelegatedListener(d,E,w);for(var L in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(P),P.delegates)this.on(L,P.delegates[L]);return this},h.prototype.once=function(d,E,w){if(w===void 0)return l.prototype.once.call(this,d,E);var P=this._createDelegatedListener(d,E,w);for(var L in P.delegates)this.once(L,P.delegates[L]);return this},h.prototype.off=function(d,E,w){var P=this;return w===void 0?l.prototype.off.call(this,d,E):(this._delegatedListeners&&this._delegatedListeners[d]&&function(L){for(var Z=L[d],X=0;X<Z.length;X++){var se=Z[X];if(se.layer===E&&se.listener===w){for(var fe in se.delegates)P.off(fe,se.delegates[fe]);return Z.splice(X,1),P}}}(this._delegatedListeners),this)},h.prototype.queryRenderedFeatures=function(d,E){if(!this.style)return[];var w;if(E!==void 0||d===void 0||d instanceof g.Point||Array.isArray(d)||(E=d,d=void 0),E=E||{},(d=d||[[0,0],[this.transform.width,this.transform.height]])instanceof g.Point||typeof d[0]=="number")w=[g.Point.convert(d)];else{var P=g.Point.convert(d[0]),L=g.Point.convert(d[1]);w=[P,new g.Point(L.x,P.y),L,new g.Point(P.x,L.y),P]}return this.style.queryRenderedFeatures(w,E,this.transform)},h.prototype.querySourceFeatures=function(d,E){return this.style.querySourceFeatures(d,E)},h.prototype.setStyle=function(d,E){return(E=g.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},E)).diff!==!1&&E.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&d?(this._diffStyle(d,E),this):(this._localIdeographFontFamily=E.localIdeographFontFamily,this._updateStyle(d,E))},h.prototype._getUIString=function(d){var E=this._locale[d];if(E==null)throw new Error("Missing UI string '"+d+"'");return E},h.prototype._updateStyle=function(d,E){return this.style&&(this.style.setEventedParent(null),this.style._remove()),d?(this.style=new Es(this,E||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d):this.style.loadJSON(d),this):(delete this.style,this)},h.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Es(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},h.prototype._diffStyle=function(d,E){var w=this;if(typeof d=="string"){var P=this._requestManager.normalizeStyleURL(d),L=this._requestManager.transformRequest(P,g.ResourceType.Style);g.getJSON(L,function(Z,X){Z?w.fire(new g.ErrorEvent(Z)):X&&w._updateDiff(X,E)})}else typeof d=="object"&&this._updateDiff(d,E)},h.prototype._updateDiff=function(d,E){try{this.style.setState(d)&&this._update(!0)}catch(w){g.warnOnce("Unable to perform style diff: "+(w.message||w.error||w)+".  Rebuilding the style from scratch."),this._updateStyle(d,E)}},h.prototype.getStyle=function(){if(this.style)return this.style.serialize()},h.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():g.warnOnce("There is no style added to the map.")},h.prototype.addSource=function(d,E){return this._lazyInitEmptyStyle(),this.style.addSource(d,E),this._update(!0)},h.prototype.isSourceLoaded=function(d){var E=this.style&&this.style.sourceCaches[d];if(E!==void 0)return E.loaded();this.fire(new g.ErrorEvent(new Error("There is no source with ID '"+d+"'")))},h.prototype.areTilesLoaded=function(){var d=this.style&&this.style.sourceCaches;for(var E in d){var w=d[E]._tiles;for(var P in w){var L=w[P];if(L.state!=="loaded"&&L.state!=="errored")return!1}}return!0},h.prototype.addSourceType=function(d,E,w){return this._lazyInitEmptyStyle(),this.style.addSourceType(d,E,w)},h.prototype.removeSource=function(d){return this.style.removeSource(d),this._update(!0)},h.prototype.getSource=function(d){return this.style.getSource(d)},h.prototype.addImage=function(d,E,w){w===void 0&&(w={});var P=w.pixelRatio;P===void 0&&(P=1);var L=w.sdf;L===void 0&&(L=!1);var Z=w.stretchX,X=w.stretchY,se=w.content;if(this._lazyInitEmptyStyle(),E instanceof $f||ga&&E instanceof ga){var fe=g.browser.getImageData(E);this.style.addImage(d,{data:new g.RGBAImage({width:fe.width,height:fe.height},fe.data),pixelRatio:P,stretchX:Z,stretchY:X,content:se,sdf:L,version:0})}else{if(E.width===void 0||E.height===void 0)return this.fire(new g.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var de=E;this.style.addImage(d,{data:new g.RGBAImage({width:E.width,height:E.height},new Uint8Array(E.data)),pixelRatio:P,stretchX:Z,stretchY:X,content:se,sdf:L,version:0,userImage:de}),de.onAdd&&de.onAdd(this,d)}},h.prototype.updateImage=function(d,E){var w=this.style.getImage(d);if(!w)return this.fire(new g.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var P=E instanceof $f||ga&&E instanceof ga?g.browser.getImageData(E):E,L=P.width,Z=P.height,X=P.data;return L===void 0||Z===void 0?this.fire(new g.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):L!==w.data.width||Z!==w.data.height?this.fire(new g.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(w.data.replace(X,!(E instanceof $f||ga&&E instanceof ga)),void this.style.updateImage(d,w))},h.prototype.hasImage=function(d){return d?!!this.style.getImage(d):(this.fire(new g.ErrorEvent(new Error("Missing required image id"))),!1)},h.prototype.removeImage=function(d){this.style.removeImage(d)},h.prototype.loadImage=function(d,E){g.getImage(this._requestManager.transformRequest(d,g.ResourceType.Image),E)},h.prototype.listImages=function(){return this.style.listImages()},h.prototype.addLayer=function(d,E){return this._lazyInitEmptyStyle(),this.style.addLayer(d,E),this._update(!0)},h.prototype.moveLayer=function(d,E){return this.style.moveLayer(d,E),this._update(!0)},h.prototype.removeLayer=function(d){return this.style.removeLayer(d),this._update(!0)},h.prototype.getLayer=function(d){return this.style.getLayer(d)},h.prototype.setLayerZoomRange=function(d,E,w){return this.style.setLayerZoomRange(d,E,w),this._update(!0)},h.prototype.setFilter=function(d,E,w){return w===void 0&&(w={}),this.style.setFilter(d,E,w),this._update(!0)},h.prototype.getFilter=function(d){return this.style.getFilter(d)},h.prototype.setPaintProperty=function(d,E,w,P){return P===void 0&&(P={}),this.style.setPaintProperty(d,E,w,P),this._update(!0)},h.prototype.getPaintProperty=function(d,E){return this.style.getPaintProperty(d,E)},h.prototype.setLayoutProperty=function(d,E,w,P){return P===void 0&&(P={}),this.style.setLayoutProperty(d,E,w,P),this._update(!0)},h.prototype.getLayoutProperty=function(d,E){return this.style.getLayoutProperty(d,E)},h.prototype.setLight=function(d,E){return E===void 0&&(E={}),this._lazyInitEmptyStyle(),this.style.setLight(d,E),this._update(!0)},h.prototype.getLight=function(){return this.style.getLight()},h.prototype.setFeatureState=function(d,E){return this.style.setFeatureState(d,E),this._update()},h.prototype.removeFeatureState=function(d,E){return this.style.removeFeatureState(d,E),this._update()},h.prototype.getFeatureState=function(d){return this.style.getFeatureState(d)},h.prototype.getContainer=function(){return this._container},h.prototype.getCanvasContainer=function(){return this._canvasContainer},h.prototype.getCanvas=function(){return this._canvas},h.prototype._containerDimensions=function(){var d=0,E=0;return this._container&&(d=this._container.clientWidth||400,E=this._container.clientHeight||300),[d,E]},h.prototype._detectMissingCSS=function(){g.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&g.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},h.prototype._setupContainer=function(){var d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=H.create("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();var E=this._canvasContainer=H.create("div","mapboxgl-canvas-container",d);this._interactive&&E.classList.add("mapboxgl-interactive"),this._canvas=H.create("canvas","mapboxgl-canvas",E),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var w=this._containerDimensions();this._resizeCanvas(w[0],w[1]);var P=this._controlContainer=H.create("div","mapboxgl-control-container",d),L=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(Z){L[Z]=H.create("div","mapboxgl-ctrl-"+Z,P)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},h.prototype._resizeCanvas=function(d,E){var w=g.browser.devicePixelRatio||1;this._canvas.width=w*d,this._canvas.height=w*E,this._canvas.style.width=d+"px",this._canvas.style.height=E+"px"},h.prototype._setupPainter=function(){var d=g.extend({},Ee.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),E=this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);E?(this.painter=new Ji(E,this.transform),g.webpSupported.testSupport(E)):this.fire(new g.ErrorEvent(new Error("Failed to initialize WebGL")))},h.prototype._contextLost=function(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new g.Event("webglcontextlost",{originalEvent:d}))},h.prototype._contextRestored=function(d){this._setupPainter(),this.resize(),this._update(),this.fire(new g.Event("webglcontextrestored",{originalEvent:d}))},h.prototype._onMapScroll=function(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},h.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},h.prototype._update=function(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this},h.prototype._requestRenderFrame=function(d){return this._update(),this._renderTaskQueue.add(d)},h.prototype._cancelRenderFrame=function(d){this._renderTaskQueue.remove(d)},h.prototype._render=function(d){var E,w=this,P=0,L=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(E=L.createQueryEXT(),L.beginQueryEXT(L.TIME_ELAPSED_EXT,E),P=g.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),!this._removed){var Z=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var X=this.transform.zoom,se=g.browser.now();this.style.zoomHistory.update(X,se);var fe=new g.EvaluationParameters(X,{now:se,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),de=fe.crossFadingFactor();de===1&&de===this._crossFadingFactor||(Z=!0,this._crossFadingFactor=de),this.style.update(fe)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new g.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new g.Event("load"))),this.style&&(this.style.hasTransitions()||Z)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var ke=g.browser.now()-P;L.endQueryEXT(L.TIME_ELAPSED_EXT,E),setTimeout(function(){var Ce=L.getQueryObjectEXT(E,L.QUERY_RESULT_EXT)/1e6;L.deleteQueryEXT(E),w.fire(new g.Event("gpu-timing-frame",{cpuTime:ke,gpuTime:Ce}))},50)}if(this.listens("gpu-timing-layer")){var Oe=this.painter.collectGpuTimers();setTimeout(function(){var Ce=w.painter.queryGpuTimers(Oe);w.fire(new g.Event("gpu-timing-layer",{layerTimes:Ce}))},50)}var ze=this._sourcesDirty||this._styleDirty||this._placementDirty;return ze||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new g.Event("idle")),!this._loaded||this._fullyLoaded||ze||(this._fullyLoaded=!0),this}},h.prototype.remove=function(){this._hash&&this._hash.remove();for(var d=0,E=this._controls;d<E.length;d+=1)E[d].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),g.window!==void 0&&(g.window.removeEventListener("resize",this._onWindowResize,!1),g.window.removeEventListener("orientationchange",this._onWindowResize,!1),g.window.removeEventListener("online",this._onWindowOnline,!1));var w=this.painter.context.gl.getExtension("WEBGL_lose_context");w&&w.loseContext(),dc(this._canvasContainer),dc(this._controlContainer),dc(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new g.Event("remove"))},h.prototype.triggerRepaint=function(){var d=this;this.style&&!this._frame&&(this._frame=g.browser.frame(function(E){d._frame=null,d._render(E)}))},h.prototype._onWindowOnline=function(){this._update()},h.prototype._onWindowResize=function(d){this._trackResize&&this.resize({originalEvent:d})._update()},c.showTileBoundaries.get=function(){return!!this._showTileBoundaries},c.showTileBoundaries.set=function(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())},c.showPadding.get=function(){return!!this._showPadding},c.showPadding.set=function(d){this._showPadding!==d&&(this._showPadding=d,this._update())},c.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},c.showCollisionBoxes.set=function(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())},c.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},c.showOverdrawInspector.set=function(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())},c.repaint.get=function(){return!!this._repaint},c.repaint.set=function(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())},c.vertices.get=function(){return!!this._vertices},c.vertices.set=function(d){this._vertices=d,this._update()},h.prototype._setCacheLimits=function(d,E){g.setCacheLimits(d,E)},c.version.get=function(){return g.version},Object.defineProperties(h.prototype,c),h}(Hc);function dc(l){l.parentNode&&l.parentNode.removeChild(l)}var Ns={showCompass:!0,showZoom:!0,visualizePitch:!1},yu=function(l){var h=this;this.options=g.extend({},Ns,l),this._container=H.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(c){return c.preventDefault()}),this.options.showZoom&&(g.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(c){return h._map.zoomIn({},{originalEvent:c})}),H.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(c){return h._map.zoomOut({},{originalEvent:c})}),H.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(g.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(c){h.options.visualizePitch?h._map.resetNorthPitch({},{originalEvent:c}):h._map.resetNorth({},{originalEvent:c})}),this._compassIcon=H.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};yu.prototype._updateZoomButtons=function(){var l=this._map.getZoom(),h=l===this._map.getMaxZoom(),c=l===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},yu.prototype._rotateCompassArrow=function(){var l=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=l},yu.prototype.onAdd=function(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new pi(this._map,this._compass,this.options.visualizePitch)),this._container},yu.prototype.onRemove=function(){H.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},yu.prototype._createButton=function(l,h){var c=H.create("button",l,this._container);return c.type="button",c.addEventListener("click",h),c},yu.prototype._setButtonTitle=function(l,h){var c=this._map._getUIString("NavigationControl."+h);l.title=c,l.setAttribute("aria-label",c)};var pi=function(l,h,c){c===void 0&&(c=!1),this._clickTolerance=10,this.element=h,this.mouseRotate=new wf({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,c&&(this.mousePitch=new hl({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),g.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),H.addEventListener(h,"mousedown",this.mousedown),H.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),H.addEventListener(h,"touchmove",this.touchmove),H.addEventListener(h,"touchend",this.touchend),H.addEventListener(h,"touchcancel",this.reset)};function zs(l,h,c){if(l=new g.LngLat(l.lng,l.lat),h){var d=new g.LngLat(l.lng-360,l.lat),E=new g.LngLat(l.lng+360,l.lat),w=c.locationPoint(l).distSqr(h);c.locationPoint(d).distSqr(h)<w?l=d:c.locationPoint(E).distSqr(h)<w&&(l=E)}for(;Math.abs(l.lng-c.center.lng)>180;){var P=c.locationPoint(l);if(P.x>=0&&P.y>=0&&P.x<=c.width&&P.y<=c.height)break;l.lng>c.center.lng?l.lng-=360:l.lng+=360}return l}pi.prototype.down=function(l,h){this.mouseRotate.mousedown(l,h),this.mousePitch&&this.mousePitch.mousedown(l,h),H.disableDrag()},pi.prototype.move=function(l,h){var c=this.map,d=this.mouseRotate.mousemoveWindow(l,h);if(d&&d.bearingDelta&&c.setBearing(c.getBearing()+d.bearingDelta),this.mousePitch){var E=this.mousePitch.mousemoveWindow(l,h);E&&E.pitchDelta&&c.setPitch(c.getPitch()+E.pitchDelta)}},pi.prototype.off=function(){var l=this.element;H.removeEventListener(l,"mousedown",this.mousedown),H.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),H.removeEventListener(l,"touchmove",this.touchmove),H.removeEventListener(l,"touchend",this.touchend),H.removeEventListener(l,"touchcancel",this.reset),this.offTemp()},pi.prototype.offTemp=function(){H.enableDrag(),H.removeEventListener(g.window,"mousemove",this.mousemove),H.removeEventListener(g.window,"mouseup",this.mouseup)},pi.prototype.mousedown=function(l){this.down(g.extend({},l,{ctrlKey:!0,preventDefault:function(){return l.preventDefault()}}),H.mousePos(this.element,l)),H.addEventListener(g.window,"mousemove",this.mousemove),H.addEventListener(g.window,"mouseup",this.mouseup)},pi.prototype.mousemove=function(l){this.move(l,H.mousePos(this.element,l))},pi.prototype.mouseup=function(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()},pi.prototype.touchstart=function(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=H.touchPos(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return l.preventDefault()}},this._startPos))},pi.prototype.touchmove=function(l){l.targetTouches.length!==1?this.reset():(this._lastPos=H.touchPos(this.element,l.targetTouches)[0],this.move({preventDefault:function(){return l.preventDefault()}},this._lastPos))},pi.prototype.touchend=function(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},pi.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var ss={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function jl(l,h,c){var d=l.classList;for(var E in ss)d.remove("mapboxgl-"+c+"-anchor-"+E);d.add("mapboxgl-"+c+"-anchor-"+h)}var Fu,el=function(l){function h(c,d){if(l.call(this),(c instanceof g.window.HTMLElement||d)&&(c=g.extend({element:c},d)),g.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment!=="auto"?c.pitchAlignment:this._rotationAlignment,c&&c.element)this._element=c.element,this._offset=g.Point.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=H.create("div"),this._element.setAttribute("aria-label","Map marker");var E=H.createNS("http://www.w3.org/2000/svg","svg");E.setAttributeNS(null,"display","block"),E.setAttributeNS(null,"height","41px"),E.setAttributeNS(null,"width","27px"),E.setAttributeNS(null,"viewBox","0 0 27 41");var w=H.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"stroke","none"),w.setAttributeNS(null,"stroke-width","1"),w.setAttributeNS(null,"fill","none"),w.setAttributeNS(null,"fill-rule","evenodd");var P=H.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill-rule","nonzero");var L=H.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"transform","translate(3.0, 29.0)"),L.setAttributeNS(null,"fill","#000000");for(var Z=0,X=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];Z<X.length;Z+=1){var se=X[Z],fe=H.createNS("http://www.w3.org/2000/svg","ellipse");fe.setAttributeNS(null,"opacity","0.04"),fe.setAttributeNS(null,"cx","10.5"),fe.setAttributeNS(null,"cy","5.80029008"),fe.setAttributeNS(null,"rx",se.rx),fe.setAttributeNS(null,"ry",se.ry),L.appendChild(fe)}var de=H.createNS("http://www.w3.org/2000/svg","g");de.setAttributeNS(null,"fill",this._color);var ke=H.createNS("http://www.w3.org/2000/svg","path");ke.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),de.appendChild(ke);var Oe=H.createNS("http://www.w3.org/2000/svg","g");Oe.setAttributeNS(null,"opacity","0.25"),Oe.setAttributeNS(null,"fill","#000000");var ze=H.createNS("http://www.w3.org/2000/svg","path");ze.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Oe.appendChild(ze);var Ce=H.createNS("http://www.w3.org/2000/svg","g");Ce.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Ce.setAttributeNS(null,"fill","#FFFFFF");var je=H.createNS("http://www.w3.org/2000/svg","g");je.setAttributeNS(null,"transform","translate(8.0, 8.0)");var Qe=H.createNS("http://www.w3.org/2000/svg","circle");Qe.setAttributeNS(null,"fill","#000000"),Qe.setAttributeNS(null,"opacity","0.25"),Qe.setAttributeNS(null,"cx","5.5"),Qe.setAttributeNS(null,"cy","5.5"),Qe.setAttributeNS(null,"r","5.4999962");var gt=H.createNS("http://www.w3.org/2000/svg","circle");gt.setAttributeNS(null,"fill","#FFFFFF"),gt.setAttributeNS(null,"cx","5.5"),gt.setAttributeNS(null,"cy","5.5"),gt.setAttributeNS(null,"r","5.4999962"),je.appendChild(Qe),je.appendChild(gt),P.appendChild(L),P.appendChild(de),P.appendChild(Oe),P.appendChild(Ce),P.appendChild(je),E.appendChild(P),E.setAttributeNS(null,"height",41*this._scale+"px"),E.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(E),this._offset=g.Point.convert(c&&c.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(Gt){Gt.preventDefault()}),this._element.addEventListener("mousedown",function(Gt){Gt.preventDefault()}),jl(this._element,this._anchor,"marker"),this._popup=null}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.addTo=function(c){return this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._update),c.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},h.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),H.remove(this._element),this._popup&&this._popup.remove(),this},h.prototype.getLngLat=function(){return this._lngLat},h.prototype.setLngLat=function(c){return this._lngLat=g.LngLat.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},h.prototype.getElement=function(){return this._element},h.prototype.setPopup=function(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){var d=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(24.6+d)],"bottom-right":[-d,-1*(24.6+d)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=c,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},h.prototype._onKeyPress=function(c){var d=c.code,E=c.charCode||c.keyCode;d!=="Space"&&d!=="Enter"&&E!==32&&E!==13||this.togglePopup()},h.prototype._onMapClick=function(c){var d=c.originalEvent.target,E=this._element;this._popup&&(d===E||E.contains(d))&&this.togglePopup()},h.prototype.getPopup=function(){return this._popup},h.prototype.togglePopup=function(){var c=this._popup;return c?(c.isOpen()?c.remove():c.addTo(this._map),this):this},h.prototype._update=function(c){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=zs(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(d="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var E="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?E="rotateX(0deg)":this._pitchAlignment==="map"&&(E="rotateX("+this._map.getPitch()+"deg)"),c&&c.type!=="moveend"||(this._pos=this._pos.round()),H.setTransform(this._element,ss[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+E+" "+d)}},h.prototype.getOffset=function(){return this._offset},h.prototype.setOffset=function(c){return this._offset=g.Point.convert(c),this._update(),this},h.prototype._onMove=function(c){if(!this._isDragging){var d=this._clickTolerance||this._map._clickTolerance;this._isDragging=c.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=c.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new g.Event("dragstart"))),this.fire(new g.Event("drag")))},h.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new g.Event("dragend")),this._state="inactive"},h.prototype._addDragHandler=function(c){this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(this._pos).add(this._offset),this._pointerdownPos=c.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},h.prototype.setDraggable=function(c){return this._draggable=!!c,this._map&&(c?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},h.prototype.isDraggable=function(){return this._draggable},h.prototype.setRotation=function(c){return this._rotation=c||0,this._update(),this},h.prototype.getRotation=function(){return this._rotation},h.prototype.setRotationAlignment=function(c){return this._rotationAlignment=c||"auto",this._update(),this},h.prototype.getRotationAlignment=function(){return this._rotationAlignment},h.prototype.setPitchAlignment=function(c){return this._pitchAlignment=c&&c!=="auto"?c:this._rotationAlignment,this._update(),this},h.prototype.getPitchAlignment=function(){return this._pitchAlignment},h}(g.Evented),Xc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Da=0,tu=!1,Vl=function(l){function h(c){l.call(this),this.options=g.extend({},Xc,c),g.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.onAdd=function(c){var d;return this._map=c,this._container=H.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),d=this._setupUI,Fu!==void 0?d(Fu):g.window.navigator.permissions!==void 0?g.window.navigator.permissions.query({name:"geolocation"}).then(function(E){d(Fu=E.state!=="denied")}):d(Fu=!!g.window.navigator.geolocation),this._container},h.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(g.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),H.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Da=0,tu=!1},h.prototype._isOutOfMapMaxBounds=function(c){var d=this._map.getMaxBounds(),E=c.coords;return d&&(E.longitude<d.getWest()||E.longitude>d.getEast()||E.latitude<d.getSouth()||E.latitude>d.getNorth())},h.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},h.prototype._onSuccess=function(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new g.Event("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new g.Event("geolocate",c)),this._finish()}},h.prototype._updateCamera=function(c){var d=new g.LngLat(c.coords.longitude,c.coords.latitude),E=c.coords.accuracy,w=this._map.getBearing(),P=g.extend({bearing:w},this.options.fitBoundsOptions);this._map.fitBounds(d.toBounds(E),P,{geolocateSource:!0})},h.prototype._updateMarker=function(c){if(c){var d=new g.LngLat(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},h.prototype._updateCircleRadius=function(){var c=this._map._container.clientHeight/2,d=this._map.unproject([0,c]),E=this._map.unproject([1,c]),w=d.distanceTo(E),P=Math.ceil(2*this._accuracy/w);this._circleElement.style.width=P+"px",this._circleElement.style.height=P+"px"},h.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},h.prototype._onError=function(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&tu)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new g.Event("error",c)),this._finish()}},h.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},h.prototype._setupUI=function(c){var d=this;if(this._container.addEventListener("contextmenu",function(P){return P.preventDefault()}),this._geolocateButton=H.create("button","mapboxgl-ctrl-geolocate",this._container),H.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",c===!1){g.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var E=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=E,this._geolocateButton.setAttribute("aria-label",E)}else{var w=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=w,this._geolocateButton.setAttribute("aria-label",w)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=H.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new el(this._dotElement),this._circleElement=H.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new el({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(P){P.geolocateSource||d._watchState!=="ACTIVE_LOCK"||P.originalEvent&&P.originalEvent.type==="resize"||(d._watchState="BACKGROUND",d._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),d._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),d.fire(new g.Event("trackuserlocationend")))})},h.prototype.trigger=function(){if(!this._setup)return g.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new g.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Da--,tu=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new g.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new g.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++Da>1?(c={maximumAge:6e5,timeout:0},tu=!0):(c=this.options.positionOptions,tu=!1),this._geolocationWatchID=g.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,c)}}else g.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},h.prototype._clearWatch=function(){g.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},h}(g.Evented),ml={maxWidth:100,unit:"metric"},gl=function(l){this.options=g.extend({},ml,l),g.bindAll(["_onMove","setUnit"],this)};function Yc(l,h,c){var d=c&&c.maxWidth||100,E=l._container.clientHeight/2,w=l.unproject([0,E]),P=l.unproject([d,E]),L=w.distanceTo(P);if(c&&c.unit==="imperial"){var Z=3.2808*L;Z>5280?yl(h,d,Z/5280,l._getUIString("ScaleControl.Miles")):yl(h,d,Z,l._getUIString("ScaleControl.Feet"))}else c&&c.unit==="nautical"?yl(h,d,L/1852,l._getUIString("ScaleControl.NauticalMiles")):L>=1e3?yl(h,d,L/1e3,l._getUIString("ScaleControl.Kilometers")):yl(h,d,L,l._getUIString("ScaleControl.Meters"))}function yl(l,h,c,d){var E,w,P,L=(E=c,(w=Math.pow(10,(""+Math.floor(E)).length-1))*(P=(P=E/w)>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(Z){var X=Math.pow(10,Math.ceil(-Math.log(Z)/Math.LN10));return Math.round(Z*X)/X}(P)));l.style.width=h*(L/c)+"px",l.innerHTML=L+"&nbsp;"+d}gl.prototype.getDefaultPosition=function(){return"bottom-left"},gl.prototype._onMove=function(){Yc(this._map,this._container,this.options)},gl.prototype.onAdd=function(l){return this._map=l,this._container=H.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},gl.prototype.onRemove=function(){H.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},gl.prototype.setUnit=function(l){this.options.unit=l,Yc(this._map,this._container,this.options)};var ru=function(l){this._fullscreen=!1,l&&l.container&&(l.container instanceof g.window.HTMLElement?this._container=l.container:g.warnOnce("Full screen control 'container' must be a DOM element.")),g.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in g.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in g.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in g.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in g.window.document&&(this._fullscreenchange="MSFullscreenChange")};ru.prototype.onAdd=function(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=H.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",g.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},ru.prototype.onRemove=function(){H.remove(this._controlContainer),this._map=null,g.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},ru.prototype._checkFullscreenSupport=function(){return!!(g.window.document.fullscreenEnabled||g.window.document.mozFullScreenEnabled||g.window.document.msFullscreenEnabled||g.window.document.webkitFullscreenEnabled)},ru.prototype._setupUI=function(){var l=this._fullscreenButton=H.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);H.create("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden",!0),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),g.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},ru.prototype._updateTitle=function(){var l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.title=l},ru.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},ru.prototype._isFullscreen=function(){return this._fullscreen},ru.prototype._changeIcon=function(){(g.window.document.fullscreenElement||g.window.document.mozFullScreenElement||g.window.document.webkitFullscreenElement||g.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},ru.prototype._onClickFullscreen=function(){this._isFullscreen()?g.window.document.exitFullscreen?g.window.document.exitFullscreen():g.window.document.mozCancelFullScreen?g.window.document.mozCancelFullScreen():g.window.document.msExitFullscreen?g.window.document.msExitFullscreen():g.window.document.webkitCancelFullScreen&&g.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var vc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Gl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Qf=function(l){function h(c){l.call(this),this.options=g.extend(Object.create(vc),c),g.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.addTo=function(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new g.Event("open")),this},h.prototype.isOpen=function(){return!!this._map},h.prototype.remove=function(){return this._content&&H.remove(this._content),this._container&&(H.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new g.Event("close")),this},h.prototype.getLngLat=function(){return this._lngLat},h.prototype.setLngLat=function(c){return this._lngLat=g.LngLat.convert(c),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},h.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},h.prototype.getElement=function(){return this._container},h.prototype.setText=function(c){return this.setDOMContent(g.window.document.createTextNode(c))},h.prototype.setHTML=function(c){var d,E=g.window.document.createDocumentFragment(),w=g.window.document.createElement("body");for(w.innerHTML=c;d=w.firstChild;)E.appendChild(d);return this.setDOMContent(E)},h.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},h.prototype.setMaxWidth=function(c){return this.options.maxWidth=c,this._update(),this},h.prototype.setDOMContent=function(c){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=H.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(c),this._createCloseButton(),this._update(),this._focusFirstElement(),this},h.prototype.addClassName=function(c){this._container&&this._container.classList.add(c)},h.prototype.removeClassName=function(c){this._container&&this._container.classList.remove(c)},h.prototype.setOffset=function(c){return this.options.offset=c,this._update(),this},h.prototype.toggleClassName=function(c){if(this._container)return this._container.classList.toggle(c)},h.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=H.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},h.prototype._onMouseUp=function(c){this._update(c.point)},h.prototype._onMouseMove=function(c){this._update(c.point)},h.prototype._onDrag=function(c){this._update(c.point)},h.prototype._update=function(c){var d=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=H.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=H.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(fe){return d._container.classList.add(fe)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=zs(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||c)){var E=this._pos=this._trackPointer&&c?c:this._map.project(this._lngLat),w=this.options.anchor,P=function fe(de){if(de){if(typeof de=="number"){var ke=Math.round(Math.sqrt(.5*Math.pow(de,2)));return{center:new g.Point(0,0),top:new g.Point(0,de),"top-left":new g.Point(ke,ke),"top-right":new g.Point(-ke,ke),bottom:new g.Point(0,-de),"bottom-left":new g.Point(ke,-ke),"bottom-right":new g.Point(-ke,-ke),left:new g.Point(de,0),right:new g.Point(-de,0)}}if(de instanceof g.Point||Array.isArray(de)){var Oe=g.Point.convert(de);return{center:Oe,top:Oe,"top-left":Oe,"top-right":Oe,bottom:Oe,"bottom-left":Oe,"bottom-right":Oe,left:Oe,right:Oe}}return{center:g.Point.convert(de.center||[0,0]),top:g.Point.convert(de.top||[0,0]),"top-left":g.Point.convert(de["top-left"]||[0,0]),"top-right":g.Point.convert(de["top-right"]||[0,0]),bottom:g.Point.convert(de.bottom||[0,0]),"bottom-left":g.Point.convert(de["bottom-left"]||[0,0]),"bottom-right":g.Point.convert(de["bottom-right"]||[0,0]),left:g.Point.convert(de.left||[0,0]),right:g.Point.convert(de.right||[0,0])}}return fe(new g.Point(0,0))}(this.options.offset);if(!w){var L,Z=this._container.offsetWidth,X=this._container.offsetHeight;L=E.y+P.bottom.y<X?["top"]:E.y>this._map.transform.height-X?["bottom"]:[],E.x<Z/2?L.push("left"):E.x>this._map.transform.width-Z/2&&L.push("right"),w=L.length===0?"bottom":L.join("-")}var se=E.add(P[w]).round();H.setTransform(this._container,ss[w]+" translate("+se.x+"px,"+se.y+"px)"),jl(this._container,w,"popup")}},h.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var c=this._container.querySelector(Gl);c&&c.focus()}},h.prototype._onClose=function(){this.remove()},h}(g.Evented),Hl={version:g.version,supported:Ee,setRTLTextPlugin:g.setRTLTextPlugin,getRTLTextPluginStatus:g.getRTLTextPluginStatus,Map:vl,NavigationControl:yu,GeolocateControl:Vl,AttributionControl:Qo,ScaleControl:gl,FullscreenControl:ru,Popup:Qf,Marker:el,Style:Es,LngLat:g.LngLat,LngLatBounds:g.LngLatBounds,Point:g.Point,MercatorCoordinate:g.MercatorCoordinate,Evented:g.Evented,config:g.config,prewarm:function(){Pt().acquire(Ft)},clearPrewarmedResources:function(){var l=bn;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(Ft),bn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return g.config.ACCESS_TOKEN},set accessToken(l){g.config.ACCESS_TOKEN=l},get baseApiUrl(){return g.config.API_URL},set baseApiUrl(l){g.config.API_URL=l},get workerCount(){return dr.workerCount},set workerCount(l){dr.workerCount=l},get maxParallelImageRequests(){return g.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){g.config.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage:function(l){g.clearTileCache(l)},workerUrl:""};return Hl}),_e})},28660:function(Jt,te,W){var _e=W(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var ue;(function(g){(function(Ee){var H=typeof W.g=="object"?W.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),ae=le(g);typeof H.Reflect=="undefined"?H.Reflect=g:ae=le(H.Reflect,ae),Ee(ae);function le(Be,ye){return function(Je,st){typeof Be[Je]!="function"&&Object.defineProperty(Be,Je,{configurable:!0,writable:!0,value:st}),ye&&ye(Je,st)}}})(function(Ee){var H=Object.prototype.hasOwnProperty,ae=typeof Symbol=="function",le=ae&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",Be=ae&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",ye=typeof Object.create=="function",Je={__proto__:[]}instanceof Array,st=!ye&&!Je,yt={create:ye?function(){return cu(Object.create(null))}:Je?function(){return cu({__proto__:null})}:function(){return cu({})},has:st?function(Zt,er){return H.call(Zt,er)}:function(Zt,er){return er in Zt},get:st?function(Zt,er){return H.call(Zt,er)?Zt[er]:void 0}:function(Zt,er){return Zt[er]}},$t=Object.getPrototypeOf(Function),tr=typeof _e=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",Mt=!tr&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:me(),Qt=!tr&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:li(),Bt=!tr&&typeof WeakMap=="function"?WeakMap:bo(),ut=new Bt;function pt(Zt,er,Lr,sn){if(wr(Lr)){if(!Ti(Zt))throw new TypeError;if(!Qi(er))throw new TypeError;return kr(Zt,er)}else{if(!Ti(Zt))throw new TypeError;if(!Dn(er))throw new TypeError;if(!Dn(sn)&&!wr(sn)&&!xn(sn))throw new TypeError;return xn(sn)&&(sn=void 0),Lr=Ei(Lr),$r(Zt,er,Lr,sn)}}Ee("decorate",pt);function rr(Zt,er){function Lr(sn,On){if(!Dn(sn))throw new TypeError;if(!wr(On)&&!po(On))throw new TypeError;it(Zt,er,sn,On)}return Lr}Ee("metadata",rr);function K(Zt,er,Lr,sn){if(!Dn(Lr))throw new TypeError;return wr(sn)||(sn=Ei(sn)),it(Zt,er,Lr,sn)}Ee("defineMetadata",K);function Xt(Zt,er,Lr){if(!Dn(er))throw new TypeError;return wr(Lr)||(Lr=Ei(Lr)),pe(Zt,er,Lr)}Ee("hasMetadata",Xt);function lt(Zt,er,Lr){if(!Dn(er))throw new TypeError;return wr(Lr)||(Lr=Ei(Lr)),he(Zt,er,Lr)}Ee("hasOwnMetadata",lt);function $e(Zt,er,Lr){if(!Dn(er))throw new TypeError;return wr(Lr)||(Lr=Ei(Lr)),He(Zt,er,Lr)}Ee("getMetadata",$e);function St(Zt,er,Lr){if(!Dn(er))throw new TypeError;return wr(Lr)||(Lr=Ei(Lr)),Ke(Zt,er,Lr)}Ee("getOwnMetadata",St);function et(Zt,er){if(!Dn(Zt))throw new TypeError;return wr(er)||(er=Ei(er)),bt(Zt,er)}Ee("getMetadataKeys",et);function Ht(Zt,er){if(!Dn(Zt))throw new TypeError;return wr(er)||(er=Ei(er)),nr(Zt,er)}Ee("getOwnMetadataKeys",Ht);function Er(Zt,er,Lr){if(!Dn(er))throw new TypeError;wr(Lr)||(Lr=Ei(Lr));var sn=S(er,Lr,!1);if(wr(sn)||!sn.delete(Zt))return!1;if(sn.size>0)return!0;var On=ut.get(er);return On.delete(Lr),On.size>0||ut.delete(er),!0}Ee("deleteMetadata",Er);function kr(Zt,er){for(var Lr=Zt.length-1;Lr>=0;--Lr){var sn=Zt[Lr],On=sn(er);if(!wr(On)&&!xn(On)){if(!Qi(On))throw new TypeError;er=On}}return er}function $r(Zt,er,Lr,sn){for(var On=Zt.length-1;On>=0;--On){var Vn=Zt[On],bi=Vn(er,Lr,sn);if(!wr(bi)&&!xn(bi)){if(!Dn(bi))throw new TypeError;sn=bi}}return sn}function S(Zt,er,Lr){var sn=ut.get(Zt);if(wr(sn)){if(!Lr)return;sn=new Mt,ut.set(Zt,sn)}var On=sn.get(er);if(wr(On)){if(!Lr)return;On=new Mt,sn.set(er,On)}return On}function pe(Zt,er,Lr){var sn=he(Zt,er,Lr);if(sn)return!0;var On=is(er);return xn(On)?!1:pe(Zt,On,Lr)}function he(Zt,er,Lr){var sn=S(er,Lr,!1);return wr(sn)?!1:ii(sn.has(Zt))}function He(Zt,er,Lr){var sn=he(Zt,er,Lr);if(sn)return Ke(Zt,er,Lr);var On=is(er);if(!xn(On))return He(Zt,On,Lr)}function Ke(Zt,er,Lr){var sn=S(er,Lr,!1);if(!wr(sn))return sn.get(Zt)}function it(Zt,er,Lr,sn){var On=S(Lr,sn,!0);On.set(Zt,er)}function bt(Zt,er){var Lr=nr(Zt,er),sn=is(Zt);if(sn===null)return Lr;var On=bt(sn,er);if(On.length<=0)return Lr;if(Lr.length<=0)return On;for(var Vn=new Qt,bi=[],vi=0,An=Lr;vi<An.length;vi++){var Bi=An[vi],Li=Vn.has(Bi);Li||(Vn.add(Bi),bi.push(Bi))}for(var io=0,ys=On;io<ys.length;io++){var Bi=ys[io],Li=Vn.has(Bi);Li||(Vn.add(Bi),bi.push(Bi))}return bi}function nr(Zt,er){var Lr=[],sn=S(Zt,er,!1);if(wr(sn))return Lr;for(var On=sn.keys(),Vn=pa(On),bi=0;;){var vi=ra(Vn);if(!vi)return Lr.length=bi,Lr;var An=Fi(vi);try{Lr[bi]=An}catch(Bi){try{$i(Vn)}finally{throw Bi}}bi++}}function Nr(Zt){if(Zt===null)return 1;switch(typeof Zt){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Zt===null?1:6;default:return 6}}function wr(Zt){return Zt===void 0}function xn(Zt){return Zt===null}function an(Zt){return typeof Zt=="symbol"}function Dn(Zt){return typeof Zt=="object"?Zt!==null:typeof Zt=="function"}function jn(Zt,er){switch(Nr(Zt)){case 0:return Zt;case 1:return Zt;case 2:return Zt;case 3:return Zt;case 4:return Zt;case 5:return Zt}var Lr=er===3?"string":er===5?"number":"default",sn=Sa(Zt,le);if(sn!==void 0){var On=sn.call(Zt,Lr);if(Dn(On))throw new TypeError;return On}return In(Zt,Lr==="default"?"number":Lr)}function In(Zt,er){if(er==="string"){var Lr=Zt.toString;if(Gi(Lr)){var sn=Lr.call(Zt);if(!Dn(sn))return sn}var On=Zt.valueOf;if(Gi(On)){var sn=On.call(Zt);if(!Dn(sn))return sn}}else{var On=Zt.valueOf;if(Gi(On)){var sn=On.call(Zt);if(!Dn(sn))return sn}var Vn=Zt.toString;if(Gi(Vn)){var sn=Vn.call(Zt);if(!Dn(sn))return sn}}throw new TypeError}function ii(Zt){return!!Zt}function wi(Zt){return""+Zt}function Ei(Zt){var er=jn(Zt,3);return an(er)?er:wi(er)}function Ti(Zt){return Array.isArray?Array.isArray(Zt):Zt instanceof Object?Zt instanceof Array:Object.prototype.toString.call(Zt)==="[object Array]"}function Gi(Zt){return typeof Zt=="function"}function Qi(Zt){return typeof Zt=="function"}function po(Zt){switch(Nr(Zt)){case 3:return!0;case 4:return!0;default:return!1}}function Sa(Zt,er){var Lr=Zt[er];if(Lr!=null){if(!Gi(Lr))throw new TypeError;return Lr}}function pa(Zt){var er=Sa(Zt,Be);if(!Gi(er))throw new TypeError;var Lr=er.call(Zt);if(!Dn(Lr))throw new TypeError;return Lr}function Fi(Zt){return Zt.value}function ra(Zt){var er=Zt.next();return er.done?!1:er}function $i(Zt){var er=Zt.return;er&&er.call(Zt)}function is(Zt){var er=Object.getPrototypeOf(Zt);if(typeof Zt!="function"||Zt===$t||er!==$t)return er;var Lr=Zt.prototype,sn=Lr&&Object.getPrototypeOf(Lr);if(sn==null||sn===Object.prototype)return er;var On=sn.constructor;return typeof On!="function"||On===Zt?er:On}function me(){var Zt={},er=[],Lr=function(){function bi(vi,An,Bi){this._index=0,this._keys=vi,this._values=An,this._selector=Bi}return bi.prototype["@@iterator"]=function(){return this},bi.prototype[Be]=function(){return this},bi.prototype.next=function(){var vi=this._index;if(vi>=0&&vi<this._keys.length){var An=this._selector(this._keys[vi],this._values[vi]);return vi+1>=this._keys.length?(this._index=-1,this._keys=er,this._values=er):this._index++,{value:An,done:!1}}return{value:void 0,done:!0}},bi.prototype.throw=function(vi){throw this._index>=0&&(this._index=-1,this._keys=er,this._values=er),vi},bi.prototype.return=function(vi){return this._index>=0&&(this._index=-1,this._keys=er,this._values=er),{value:vi,done:!0}},bi}();return function(){function bi(){this._keys=[],this._values=[],this._cacheKey=Zt,this._cacheIndex=-2}return Object.defineProperty(bi.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),bi.prototype.has=function(vi){return this._find(vi,!1)>=0},bi.prototype.get=function(vi){var An=this._find(vi,!1);return An>=0?this._values[An]:void 0},bi.prototype.set=function(vi,An){var Bi=this._find(vi,!0);return this._values[Bi]=An,this},bi.prototype.delete=function(vi){var An=this._find(vi,!1);if(An>=0){for(var Bi=this._keys.length,Li=An+1;Li<Bi;Li++)this._keys[Li-1]=this._keys[Li],this._values[Li-1]=this._values[Li];return this._keys.length--,this._values.length--,vi===this._cacheKey&&(this._cacheKey=Zt,this._cacheIndex=-2),!0}return!1},bi.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Zt,this._cacheIndex=-2},bi.prototype.keys=function(){return new Lr(this._keys,this._values,sn)},bi.prototype.values=function(){return new Lr(this._keys,this._values,On)},bi.prototype.entries=function(){return new Lr(this._keys,this._values,Vn)},bi.prototype["@@iterator"]=function(){return this.entries()},bi.prototype[Be]=function(){return this.entries()},bi.prototype._find=function(vi,An){return this._cacheKey!==vi&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=vi)),this._cacheIndex<0&&An&&(this._cacheIndex=this._keys.length,this._keys.push(vi),this._values.push(void 0)),this._cacheIndex},bi}();function sn(bi,vi){return bi}function On(bi,vi){return vi}function Vn(bi,vi){return[bi,vi]}}function li(){return function(){function Zt(){this._map=new Mt}return Object.defineProperty(Zt.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Zt.prototype.has=function(er){return this._map.has(er)},Zt.prototype.add=function(er){return this._map.set(er,er),this},Zt.prototype.delete=function(er){return this._map.delete(er)},Zt.prototype.clear=function(){this._map.clear()},Zt.prototype.keys=function(){return this._map.keys()},Zt.prototype.values=function(){return this._map.values()},Zt.prototype.entries=function(){return this._map.entries()},Zt.prototype["@@iterator"]=function(){return this.keys()},Zt.prototype[Be]=function(){return this.keys()},Zt}()}function bo(){var Zt=16,er=yt.create(),Lr=sn();return function(){function An(){this._key=sn()}return An.prototype.has=function(Bi){var Li=On(Bi,!1);return Li!==void 0?yt.has(Li,this._key):!1},An.prototype.get=function(Bi){var Li=On(Bi,!1);return Li!==void 0?yt.get(Li,this._key):void 0},An.prototype.set=function(Bi,Li){var io=On(Bi,!0);return io[this._key]=Li,this},An.prototype.delete=function(Bi){var Li=On(Bi,!1);return Li!==void 0?delete Li[this._key]:!1},An.prototype.clear=function(){this._key=sn()},An}();function sn(){var An;do An="@@WeakMap@@"+vi();while(yt.has(er,An));return er[An]=!0,An}function On(An,Bi){if(!H.call(An,Lr)){if(!Bi)return;Object.defineProperty(An,Lr,{value:yt.create()})}return An[Lr]}function Vn(An,Bi){for(var Li=0;Li<Bi;++Li)An[Li]=Math.random()*255|0;return An}function bi(An){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(An)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(An)):Vn(new Uint8Array(An),An):Vn(new Array(An),An)}function vi(){var An=bi(Zt);An[6]=An[6]&79|64,An[8]=An[8]&191|128;for(var Bi="",Li=0;Li<Zt;++Li){var io=An[Li];(Li===4||Li===6||Li===8)&&(Bi+="-"),io<16&&(Bi+="0"),Bi+=io.toString(16).toLowerCase()}return Bi}}function cu(Zt){return Zt.__=void 0,delete Zt.__,Zt}})})(ue||(ue={}))},69848:function(Jt){(function(te,W){Jt.exports=W()})(this,function(){"use strict";function te(lt,$e,St,et,Ht,Er){if(!(Ht-et<=St)){var kr=et+Ht>>1;W(lt,$e,kr,et,Ht,Er%2),te(lt,$e,St,et,kr-1,Er+1),te(lt,$e,St,kr+1,Ht,Er+1)}}function W(lt,$e,St,et,Ht,Er){for(;Ht>et;){if(Ht-et>600){var kr=Ht-et+1,$r=St-et+1,S=Math.log(kr),pe=.5*Math.exp(2*S/3),he=.5*Math.sqrt(S*pe*(kr-pe)/kr)*($r-kr/2<0?-1:1),He=Math.max(et,Math.floor(St-$r*pe/kr+he)),Ke=Math.min(Ht,Math.floor(St+(kr-$r)*pe/kr+he));W(lt,$e,St,He,Ke,Er)}var it=$e[2*St+Er],bt=et,nr=Ht;for(_e(lt,$e,et,St),$e[2*Ht+Er]>it&&_e(lt,$e,et,Ht);bt<nr;){for(_e(lt,$e,bt,nr),bt++,nr--;$e[2*bt+Er]<it;)bt++;for(;$e[2*nr+Er]>it;)nr--}$e[2*et+Er]===it?_e(lt,$e,et,nr):(nr++,_e(lt,$e,nr,Ht)),nr<=St&&(et=nr+1),St<=nr&&(Ht=nr-1)}}function _e(lt,$e,St,et){ue(lt,St,et),ue($e,2*St,2*et),ue($e,2*St+1,2*et+1)}function ue(lt,$e,St){var et=lt[$e];lt[$e]=lt[St],lt[St]=et}function g(lt,$e,St,et,Ht,Er,kr){for(var $r=[0,lt.length-1,0],S=[],pe,he;$r.length;){var He=$r.pop(),Ke=$r.pop(),it=$r.pop();if(Ke-it<=kr){for(var bt=it;bt<=Ke;bt++)pe=$e[2*bt],he=$e[2*bt+1],pe>=St&&pe<=Ht&&he>=et&&he<=Er&&S.push(lt[bt]);continue}var nr=Math.floor((it+Ke)/2);pe=$e[2*nr],he=$e[2*nr+1],pe>=St&&pe<=Ht&&he>=et&&he<=Er&&S.push(lt[nr]);var Nr=(He+1)%2;(He===0?St<=pe:et<=he)&&($r.push(it),$r.push(nr-1),$r.push(Nr)),(He===0?Ht>=pe:Er>=he)&&($r.push(nr+1),$r.push(Ke),$r.push(Nr))}return S}function Ee(lt,$e,St,et,Ht,Er){for(var kr=[0,lt.length-1,0],$r=[],S=Ht*Ht;kr.length;){var pe=kr.pop(),he=kr.pop(),He=kr.pop();if(he-He<=Er){for(var Ke=He;Ke<=he;Ke++)H($e[2*Ke],$e[2*Ke+1],St,et)<=S&&$r.push(lt[Ke]);continue}var it=Math.floor((He+he)/2),bt=$e[2*it],nr=$e[2*it+1];H(bt,nr,St,et)<=S&&$r.push(lt[it]);var Nr=(pe+1)%2;(pe===0?St-Ht<=bt:et-Ht<=nr)&&(kr.push(He),kr.push(it-1),kr.push(Nr)),(pe===0?St+Ht>=bt:et+Ht>=nr)&&(kr.push(it+1),kr.push(he),kr.push(Nr))}return $r}function H(lt,$e,St,et){var Ht=lt-St,Er=$e-et;return Ht*Ht+Er*Er}var ae=function(lt){return lt[0]},le=function(lt){return lt[1]},Be=function($e,St,et,Ht,Er){St===void 0&&(St=ae),et===void 0&&(et=le),Ht===void 0&&(Ht=64),Er===void 0&&(Er=Float64Array),this.nodeSize=Ht,this.points=$e;for(var kr=$e.length<65536?Uint16Array:Uint32Array,$r=this.ids=new kr($e.length),S=this.coords=new Er($e.length*2),pe=0;pe<$e.length;pe++)$r[pe]=pe,S[2*pe]=St($e[pe]),S[2*pe+1]=et($e[pe]);te($r,S,Ht,0,$r.length-1,0)};Be.prototype.range=function($e,St,et,Ht){return g(this.ids,this.coords,$e,St,et,Ht,this.nodeSize)},Be.prototype.within=function($e,St,et){return Ee(this.ids,this.coords,$e,St,et,this.nodeSize)};var ye={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(lt){return lt}},Je=Math.fround||function(lt){return function($e){return lt[0]=+$e,lt[0]}}(new Float32Array(1)),st=function($e){this.options=rr(Object.create(ye),$e),this.trees=new Array(this.options.maxZoom+1)};st.prototype.load=function($e){var St=this.options,et=St.log,Ht=St.minZoom,Er=St.maxZoom,kr=St.nodeSize;et&&console.time("total time");var $r="prepare "+$e.length+" points";et&&console.time($r),this.points=$e;for(var S=[],pe=0;pe<$e.length;pe++)!$e[pe].geometry||S.push($t($e[pe],pe));this.trees[Er+1]=new Be(S,K,Xt,kr,Float32Array),et&&console.timeEnd($r);for(var he=Er;he>=Ht;he--){var He=+Date.now();S=this._cluster(S,he),this.trees[he]=new Be(S,K,Xt,kr,Float32Array),et&&console.log("z%d: %d clusters in %dms",he,S.length,+Date.now()-He)}return et&&console.timeEnd("total time"),this},st.prototype.getClusters=function($e,St){var et=(($e[0]+180)%360+360)%360-180,Ht=Math.max(-90,Math.min(90,$e[1])),Er=$e[2]===180?180:(($e[2]+180)%360+360)%360-180,kr=Math.max(-90,Math.min(90,$e[3]));if($e[2]-$e[0]>=360)et=-180,Er=180;else if(et>Er){var $r=this.getClusters([et,Ht,180,kr],St),S=this.getClusters([-180,Ht,Er,kr],St);return $r.concat(S)}for(var pe=this.trees[this._limitZoom(St)],he=pe.range(Qt(et),Bt(kr),Qt(Er),Bt(Ht)),He=[],Ke=0,it=he;Ke<it.length;Ke+=1){var bt=it[Ke],nr=pe.points[bt];He.push(nr.numPoints?tr(nr):this.points[nr.index])}return He},st.prototype.getChildren=function($e){var St=this._getOriginId($e),et=this._getOriginZoom($e),Ht="No cluster with the specified id.",Er=this.trees[et];if(!Er)throw new Error(Ht);var kr=Er.points[St];if(!kr)throw new Error(Ht);for(var $r=this.options.radius/(this.options.extent*Math.pow(2,et-1)),S=Er.within(kr.x,kr.y,$r),pe=[],he=0,He=S;he<He.length;he+=1){var Ke=He[he],it=Er.points[Ke];it.parentId===$e&&pe.push(it.numPoints?tr(it):this.points[it.index])}if(pe.length===0)throw new Error(Ht);return pe},st.prototype.getLeaves=function($e,St,et){St=St||10,et=et||0;var Ht=[];return this._appendLeaves(Ht,$e,St,et,0),Ht},st.prototype.getTile=function($e,St,et){var Ht=this.trees[this._limitZoom($e)],Er=Math.pow(2,$e),kr=this.options,$r=kr.extent,S=kr.radius,pe=S/$r,he=(et-pe)/Er,He=(et+1+pe)/Er,Ke={features:[]};return this._addTileFeatures(Ht.range((St-pe)/Er,he,(St+1+pe)/Er,He),Ht.points,St,et,Er,Ke),St===0&&this._addTileFeatures(Ht.range(1-pe/Er,he,1,He),Ht.points,Er,et,Er,Ke),St===Er-1&&this._addTileFeatures(Ht.range(0,he,pe/Er,He),Ht.points,-1,et,Er,Ke),Ke.features.length?Ke:null},st.prototype.getClusterExpansionZoom=function($e){for(var St=this._getOriginZoom($e)-1;St<=this.options.maxZoom;){var et=this.getChildren($e);if(St++,et.length!==1)break;$e=et[0].properties.cluster_id}return St},st.prototype._appendLeaves=function($e,St,et,Ht,Er){for(var kr=this.getChildren(St),$r=0,S=kr;$r<S.length;$r+=1){var pe=S[$r],he=pe.properties;if(he&&he.cluster?Er+he.point_count<=Ht?Er+=he.point_count:Er=this._appendLeaves($e,he.cluster_id,et,Ht,Er):Er<Ht?Er++:$e.push(pe),$e.length===et)break}return Er},st.prototype._addTileFeatures=function($e,St,et,Ht,Er,kr){for(var $r=0,S=$e;$r<S.length;$r+=1){var pe=S[$r],he=St[pe],He=he.numPoints,Ke=void 0,it=void 0,bt=void 0;if(He)Ke=Mt(he),it=he.x,bt=he.y;else{var nr=this.points[he.index];Ke=nr.properties,it=Qt(nr.geometry.coordinates[0]),bt=Bt(nr.geometry.coordinates[1])}var Nr={type:1,geometry:[[Math.round(this.options.extent*(it*Er-et)),Math.round(this.options.extent*(bt*Er-Ht))]],tags:Ke},wr=void 0;He?wr=he.id:this.options.generateId?wr=he.index:this.points[he.index].id&&(wr=this.points[he.index].id),wr!==void 0&&(Nr.id=wr),kr.features.push(Nr)}},st.prototype._limitZoom=function($e){return Math.max(this.options.minZoom,Math.min(Math.floor(+$e),this.options.maxZoom+1))},st.prototype._cluster=function($e,St){for(var et=[],Ht=this.options,Er=Ht.radius,kr=Ht.extent,$r=Ht.reduce,S=Ht.minPoints,pe=Er/(kr*Math.pow(2,St)),he=0;he<$e.length;he++){var He=$e[he];if(!(He.zoom<=St)){He.zoom=St;for(var Ke=this.trees[St+1],it=Ke.within(He.x,He.y,pe),bt=He.numPoints||1,nr=bt,Nr=0,wr=it;Nr<wr.length;Nr+=1){var xn=wr[Nr],an=Ke.points[xn];an.zoom>St&&(nr+=an.numPoints||1)}if(nr>bt&&nr>=S){for(var Dn=He.x*bt,jn=He.y*bt,In=$r&&bt>1?this._map(He,!0):null,ii=(he<<5)+(St+1)+this.points.length,wi=0,Ei=it;wi<Ei.length;wi+=1){var Ti=Ei[wi],Gi=Ke.points[Ti];if(!(Gi.zoom<=St)){Gi.zoom=St;var Qi=Gi.numPoints||1;Dn+=Gi.x*Qi,jn+=Gi.y*Qi,Gi.parentId=ii,$r&&(In||(In=this._map(He,!0)),$r(In,this._map(Gi)))}}He.parentId=ii,et.push(yt(Dn/nr,jn/nr,ii,nr,In))}else if(et.push(He),nr>1)for(var po=0,Sa=it;po<Sa.length;po+=1){var pa=Sa[po],Fi=Ke.points[pa];Fi.zoom<=St||(Fi.zoom=St,et.push(Fi))}}}return et},st.prototype._getOriginId=function($e){return $e-this.points.length>>5},st.prototype._getOriginZoom=function($e){return($e-this.points.length)%32},st.prototype._map=function($e,St){if($e.numPoints)return St?rr({},$e.properties):$e.properties;var et=this.points[$e.index].properties,Ht=this.options.map(et);return St&&Ht===et?rr({},Ht):Ht};function yt(lt,$e,St,et,Ht){return{x:Je(lt),y:Je($e),zoom:Infinity,id:St,parentId:-1,numPoints:et,properties:Ht}}function $t(lt,$e){var St=lt.geometry.coordinates,et=St[0],Ht=St[1];return{x:Je(Qt(et)),y:Je(Bt(Ht)),zoom:Infinity,index:$e,parentId:-1}}function tr(lt){return{type:"Feature",id:lt.id,properties:Mt(lt),geometry:{type:"Point",coordinates:[ut(lt.x),pt(lt.y)]}}}function Mt(lt){var $e=lt.numPoints,St=$e>=1e4?Math.round($e/1e3)+"k":$e>=1e3?Math.round($e/100)/10+"k":$e;return rr(rr({},lt.properties),{cluster:!0,cluster_id:lt.id,point_count:$e,point_count_abbreviated:St})}function Qt(lt){return lt/360+.5}function Bt(lt){var $e=Math.sin(lt*Math.PI/180),St=.5-.25*Math.log((1+$e)/(1-$e))/Math.PI;return St<0?0:St>1?1:St}function ut(lt){return(lt-.5)*360}function pt(lt){var $e=(180-lt*360)*Math.PI/180;return 360*Math.atan(Math.exp($e))/Math.PI-90}function rr(lt,$e){for(var St in $e)lt[St]=$e[St];return lt}function K(lt){return lt.x}function Xt(lt){return lt.y}return st})},75752:function(Jt){Jt.exports.RADIUS=6378137,Jt.exports.FLATTENING=1/298.257223563,Jt.exports.POLAR_RADIUS=63567523142e-4}}]);
