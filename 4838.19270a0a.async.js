(self.webpackChunkruoyi_react=self.webpackChunkruoyi_react||[]).push([[4838],{67417:function(Er,re,Q){"use strict";Q.d(re,{zP:function(){return l3},JE:function(){return x5},ns:function(){return u3}});var Ce={};Q.r(Ce),Q.d(Ce,{add:function(){return $r},adjoint:function(){return Rd},clone:function(){return yc},copy:function(){return Po},create:function(){return Yi},determinant:function(){return vh},equals:function(){return Vr},exactEquals:function(){return xn},frob:function(){return Or},fromQuat:function(){return dr},fromQuat2:function(){return Fe},fromRotation:function(){return Rf},fromRotationTranslation:function(){return ce},fromRotationTranslationScale:function(){return Qt},fromRotationTranslationScaleOrigin:function(){return lr},fromScaling:function(){return Yl},fromTranslation:function(){return Up},fromValues:function(){return Us},fromXRotation:function(){return mh},fromYRotation:function(){return kd},fromZRotation:function(){return N},frustum:function(){return _r},getRotation:function(){return Ot},getScaling:function(){return rr},getTranslation:function(){return Lt},identity:function(){return dh},invert:function(){return zp},lookAt:function(){return xr},mul:function(){return Sr},multiply:function(){return Sl},multiplyScalar:function(){return Jt},multiplyScalarAndAdd:function(){return tr},ortho:function(){return nt},orthoNO:function(){return Cr},orthoZO:function(){return jt},perspective:function(){return wr},perspectiveFromFieldOfView:function(){return mr},perspectiveNO:function(){return Ar},perspectiveZO:function(){return jr},rotate:function(){return td},rotateX:function(){return up},rotateY:function(){return rf},rotateZ:function(){return ba},scale:function(){return Xl},set:function(){return ed},str:function(){return ur},sub:function(){return qr},subtract:function(){return Fn},targetTo:function(){return Nr},translate:function(){return sp},transpose:function(){return Od}});var me=Q(67294),m=(0,me.createContext)({});function Re(){return(0,me.useContext)(m)}var W={},pe={},de=function(i){return pe[i]},ze=function(i,r){pe[i]=r},_e=function(i){return W[i]},et=function(i,r){W[i]=r},mt={},Ct={},Bt=34,or=10,At=13;function Kt(e){return new Function("d","return {"+e.map(function(i,r){return JSON.stringify(i)+": d["+r+'] || ""'}).join(",")+"}")}function yt(e,i){var r=Kt(e);return function(n,a){return i(r(n),a,e)}}function ct(e){var i=Object.create(null),r=[];return e.forEach(function(n){for(var a in n)a in i||r.push(i[a]=a)}),r}function it(e,i){var r=e+"",n=r.length;return n<i?new Array(i-n+1).join(0)+r:r}function $t(e){return e<0?"-"+it(-e,6):e>9999?"+"+it(e,6):it(e,4)}function X(e){var i=e.getUTCHours(),r=e.getUTCMinutes(),n=e.getUTCSeconds(),a=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":$t(e.getUTCFullYear(),4)+"-"+it(e.getUTCMonth()+1,2)+"-"+it(e.getUTCDate(),2)+(a?"T"+it(i,2)+":"+it(r,2)+":"+it(n,2)+"."+it(a,3)+"Z":n?"T"+it(i,2)+":"+it(r,2)+":"+it(n,2)+"Z":r||i?"T"+it(i,2)+":"+it(r,2)+"Z":"")}function Xt(e){var i=new RegExp('["'+e+`
\r]`),r=e.charCodeAt(0);function n(T,R){var F,j,Y=a(T,function(J,be){if(F)return F(J,be-1);j=J,F=R?yt(J,R):Kt(J)});return Y.columns=j||[],Y}function a(T,R){var F=[],j=T.length,Y=0,J=0,be,Be=j<=0,Ye=!1;T.charCodeAt(j-1)===or&&--j,T.charCodeAt(j-1)===At&&--j;function tt(){if(Be)return Ct;if(Ye)return Ye=!1,mt;var wt,Yt=Y,ar;if(T.charCodeAt(Yt)===Bt){for(;Y++<j&&T.charCodeAt(Y)!==Bt||T.charCodeAt(++Y)===Bt;);return(wt=Y)>=j?Be=!0:(ar=T.charCodeAt(Y++))===or?Ye=!0:ar===At&&(Ye=!0,T.charCodeAt(Y)===or&&++Y),T.slice(Yt+1,wt-1).replace(/""/g,'"')}for(;Y<j;){if((ar=T.charCodeAt(wt=Y++))===or)Ye=!0;else if(ar===At)Ye=!0,T.charCodeAt(Y)===or&&++Y;else if(ar!==r)continue;return T.slice(Yt,wt)}return Be=!0,T.slice(Yt,j)}for(;(be=tt())!==Ct;){for(var Et=[];be!==mt&&be!==Ct;)Et.push(be),be=tt();R&&(Et=R(Et,J++))==null||F.push(Et)}return F}function s(T,R){return T.map(function(F){return R.map(function(j){return C(F[j])}).join(e)})}function p(T,R){return R==null&&(R=ct(T)),[R.map(C).join(e)].concat(s(T,R)).join(`
`)}function v(T,R){return R==null&&(R=ct(T)),s(T,R).join(`
`)}function g(T){return T.map(x).join(`
`)}function x(T){return T.map(C).join(e)}function C(T){return T==null?"":T instanceof Date?X(T):i.test(T+="")?'"'+T.replace(/"/g,'""')+'"':T}return{parse:n,parseRows:a,format:p,formatBody:v,formatRows:g,formatRow:x,formatValue:C}}var at=Xt(","),qe=at.parse,xt=at.parseRows,$e=at.format,Ht=at.formatBody,vr=at.formatRows,Fr=at.formatRow,Yr=at.formatValue,A=Q(96156),Se=Q(85061),ke=Q(38163),ut=Q.n(ke);function ft(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Rt(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ft(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ft(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Dt(e,i){var r=i.x,n=i.y,a=i.x1,s=i.y1,p=i.coordinates,v=[];return Array.isArray(e)?(e.forEach(function(g,x){var C=[];if(r&&n&&(C=[parseFloat(g[r]),parseFloat(g[n])]),r&&n&&a&&s){var T=[parseFloat(g[r]),parseFloat(g[n])],R=[parseFloat(g[a]),parseFloat(g[s])];C=[T,R]}if(p){var F="Polygon";Array.isArray(p[0])||(F="Point"),Array.isArray(p[0])&&!Array.isArray(p[0][0])&&(F="LineString");var j={type:F,coordinates:(0,Se.Z)(g[p])};ut()(j,!0),C=j.coordinates}var Y=Rt(Rt({},g),{},{_id:x,coordinates:C});v.push(Y)}),{dataArray:v}):{dataArray:[]}}var gr=[{lng1:100,lat1:30,lng2:130,lat2:30}],Yn={parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}};function Gr(e,i){var r=qe(e);return Dt(r,i)}var Nn=63710088e-1,yn={centimeters:Nn*100,centimetres:Nn*100,degrees:Nn/111325,feet:Nn*3.28084,inches:Nn*39.37,kilometers:Nn/1e3,kilometres:Nn/1e3,meters:Nn,metres:Nn,miles:Nn/1609.344,millimeters:Nn*1e3,millimetres:Nn*1e3,nauticalmiles:Nn/1852,radians:1,yards:Nn*1.0936},zn={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Nn,yards:1.0936133},si={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Gn(e,i,r){r===void 0&&(r={});var n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=i||{},n.geometry=e,n}function fi(e,i,r){switch(r===void 0&&(r={}),e){case"Point":return ta(i).geometry;case"LineString":return ra(i).geometry;case"Polygon":return Ii(i).geometry;case"MultiPoint":return ki(i).geometry;case"MultiLineString":return ia(i).geometry;case"MultiPolygon":return qi(i).geometry;default:throw new Error(e+" is invalid")}}function ta(e,i,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Tn(e[0])||!Tn(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return Gn(n,i,r)}function zi(e,i,r){return r===void 0&&(r={}),na(e.map(function(n){return ta(n,i)}),r)}function Ii(e,i,r){r===void 0&&(r={});for(var n=0,a=e;n<a.length;n++){var s=a[n];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var p=0;p<s[s.length-1].length;p++)if(s[s.length-1][p]!==s[0][p])throw new Error("First and last Position are not equivalent.")}var v={type:"Polygon",coordinates:e};return Gn(v,i,r)}function Ki(e,i,r){return r===void 0&&(r={}),na(e.map(function(n){return Ii(n,i)}),r)}function ra(e,i,r){if(r===void 0&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return Gn(n,i,r)}function Ya(e,i,r){return r===void 0&&(r={}),na(e.map(function(n){return ra(n,i)}),r)}function na(e,i){i===void 0&&(i={});var r={type:"FeatureCollection"};return i.id&&(r.id=i.id),i.bbox&&(r.bbox=i.bbox),r.features=e,r}function ia(e,i,r){r===void 0&&(r={});var n={type:"MultiLineString",coordinates:e};return Gn(n,i,r)}function ki(e,i,r){r===void 0&&(r={});var n={type:"MultiPoint",coordinates:e};return Gn(n,i,r)}function qi(e,i,r){r===void 0&&(r={});var n={type:"MultiPolygon",coordinates:e};return Gn(n,i,r)}function Gi(e,i,r){r===void 0&&(r={});var n={type:"GeometryCollection",geometries:e};return Gn(n,i,r)}function Cs(e,i){if(i===void 0&&(i=0),i&&!(i>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,i||0);return Math.round(e*r)/r}function fe(e,i){i===void 0&&(i="kilometers");var r=yn[i];if(!r)throw new Error(i+" units is invalid");return e*r}function ui(e,i){i===void 0&&(i="kilometers");var r=yn[i];if(!r)throw new Error(i+" units is invalid");return e/r}function bo(e,i){return Ut(ui(e,i))}function su(e){var i=e%360;return i<0&&(i+=360),i}function Ut(e){var i=e%(2*Math.PI);return i*180/Math.PI}function er(e){var i=e%360;return i*Math.PI/180}function Rr(e,i,r){if(i===void 0&&(i="kilometers"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("length must be a positive number");return fe(ui(e,i),r)}function an(e,i,r){if(i===void 0&&(i="meters"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=si[i];if(!n)throw new Error("invalid original units");var a=si[r];if(!a)throw new Error("invalid final units");return e/n*a}function Tn(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Un(e){return!!e&&e.constructor===Object}function bi(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(i){if(!Tn(i))throw new Error("bbox must only contain numbers")})}function di(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function Sn(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Li(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Oi(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return Oi(e[0]);throw new Error("coordinates must only contain numbers")}function io(e,i,r){if(!i||!r)throw new Error("type and name required");if(!e||e.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.type)}function hs(e,i,r){if(!e)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!e.geometry||e.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.geometry.type)}function Uo(e,i,r){if(!e)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(var n=0,a=e.features;n<a.length;n++){var s=a[n];if(!s||s.type!=="Feature"||!s.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!s.geometry||s.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+s.geometry.type)}}function Na(e){return e.type==="Feature"?e.geometry:e}function xa(e,i){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function V(e,i,r){if(e!==null)for(var n,a,s,p,v,g,x,C=0,T=0,R,F=e.type,j=F==="FeatureCollection",Y=F==="Feature",J=j?e.features.length:1,be=0;be<J;be++){x=j?e.features[be].geometry:Y?e.geometry:e,R=x?x.type==="GeometryCollection":!1,v=R?x.geometries.length:1;for(var Be=0;Be<v;Be++){var Ye=0,tt=0;if(p=R?x.geometries[Be]:x,p!==null){g=p.coordinates;var Et=p.type;switch(C=r&&(Et==="Polygon"||Et==="MultiPolygon")?1:0,Et){case null:break;case"Point":if(i(g,T,be,Ye,tt)===!1)return!1;T++,Ye++;break;case"LineString":case"MultiPoint":for(n=0;n<g.length;n++){if(i(g[n],T,be,Ye,tt)===!1)return!1;T++,Et==="MultiPoint"&&Ye++}Et==="LineString"&&Ye++;break;case"Polygon":case"MultiLineString":for(n=0;n<g.length;n++){for(a=0;a<g[n].length-C;a++){if(i(g[n][a],T,be,Ye,tt)===!1)return!1;T++}Et==="MultiLineString"&&Ye++,Et==="Polygon"&&tt++}Et==="Polygon"&&Ye++;break;case"MultiPolygon":for(n=0;n<g.length;n++){for(tt=0,a=0;a<g[n].length;a++){for(s=0;s<g[n][a].length-C;s++){if(i(g[n][a][s],T,be,Ye,tt)===!1)return!1;T++}tt++}Ye++}break;case"GeometryCollection":for(n=0;n<p.geometries.length;n++)if(V(p.geometries[n],i,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function $(e,i,r,n){var a=r;return V(e,function(s,p,v,g,x){p===0&&r===void 0?a=s:a=i(a,s,p,v,g,x)},n),a}function te(e,i){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length&&i(e.features[r].properties,r)!==!1;r++);break;case"Feature":i(e.properties,0);break}}function he(e,i,r){var n=r;return te(e,function(a,s){s===0&&r===void 0?n=a:n=i(n,a,s)}),n}function Me(e,i){if(e.type==="Feature")i(e,0);else if(e.type==="FeatureCollection")for(var r=0;r<e.features.length&&i(e.features[r],r)!==!1;r++);}function Ge(e,i,r){var n=r;return Me(e,function(a,s){s===0&&r===void 0?n=a:n=i(n,a,s)}),n}function Qe(e){var i=[];return V(e,function(r){i.push(r)}),i}function oe(e,i){var r,n,a,s,p,v,g,x,C,T,R=0,F=e.type==="FeatureCollection",j=e.type==="Feature",Y=F?e.features.length:1;for(r=0;r<Y;r++){for(v=F?e.features[r].geometry:j?e.geometry:e,x=F?e.features[r].properties:j?e.properties:{},C=F?e.features[r].bbox:j?e.bbox:void 0,T=F?e.features[r].id:j?e.id:void 0,g=v?v.type==="GeometryCollection":!1,p=g?v.geometries.length:1,a=0;a<p;a++){if(s=g?v.geometries[a]:v,s===null){if(i(null,R,x,C,T)===!1)return!1;continue}switch(s.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(i(s,R,x,C,T)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<s.geometries.length;n++)if(i(s.geometries[n],R,x,C,T)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}R++}}function Le(e,i,r){var n=r;return oe(e,function(a,s,p,v,g){s===0&&r===void 0?n=a:n=i(n,a,s,p,v,g)}),n}function ht(e,i){oe(e,function(r,n,a,s,p){var v=r===null?null:r.type;switch(v){case null:case"Point":case"LineString":case"Polygon":return i(Gn(r,a,{bbox:s,id:p}),n,0)===!1?!1:void 0}var g;switch(v){case"MultiPoint":g="Point";break;case"MultiLineString":g="LineString";break;case"MultiPolygon":g="Polygon";break}for(var x=0;x<r.coordinates.length;x++){var C=r.coordinates[x],T={type:g,coordinates:C};if(i(Gn(T,a),n,x)===!1)return!1}})}function fr(e,i,r){var n=r;return ht(e,function(a,s,p){s===0&&p===0&&r===void 0?n=a:n=i(n,a,s,p)}),n}function kt(e,i){ht(e,function(r,n,a){var s=0;if(!!r.geometry){var p=r.geometry.type;if(!(p==="Point"||p==="MultiPoint")){var v,g=0,x=0,C=0;if(V(r,function(T,R,F,j,Y){if(v===void 0||n>g||j>x||Y>C){v=T,g=n,x=j,C=Y,s=0;return}var J=lineString([v,T],r.properties);if(i(J,n,a,Y,s)===!1)return!1;s++,v=T})===!1)return!1}}})}function Ft(e,i,r){var n=r,a=!1;return kt(e,function(s,p,v,g,x){a===!1&&r===void 0?n=s:n=i(n,s,p,v,g,x),a=!0}),n}function pr(e,i){if(!e)throw new Error("geojson is required");ht(e,function(r,n,a){if(r.geometry!==null){var s=r.geometry.type,p=r.geometry.coordinates;switch(s){case"LineString":if(i(r,n,a,0,0)===!1)return!1;break;case"Polygon":for(var v=0;v<p.length;v++)if(i(lineString(p[v],r.properties),n,a,v)===!1)return!1;break}}})}function _n(e,i,r){var n=r;return pr(e,function(a,s,p,v){s===0&&r===void 0?n=a:n=i(n,a,s,p,v)}),n}function fn(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,a=i.geometryIndex||0,s=i.segmentIndex||0,p=i.properties,v;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),p=p||e.features[r].properties,v=e.features[r].geometry;break;case"Feature":p=p||e.properties,v=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":v=e;break;default:throw new Error("geojson is invalid")}if(v===null)return null;var g=v.coordinates;switch(v.type){case"Point":case"MultiPoint":return null;case"LineString":return s<0&&(s=g.length+s-1),lineString([g[s],g[s+1]],p,i);case"Polygon":return a<0&&(a=g.length+a),s<0&&(s=g[a].length+s-1),lineString([g[a][s],g[a][s+1]],p,i);case"MultiLineString":return n<0&&(n=g.length+n),s<0&&(s=g[n].length+s-1),lineString([g[n][s],g[n][s+1]],p,i);case"MultiPolygon":return n<0&&(n=g.length+n),a<0&&(a=g[n].length+a),s<0&&(s=g[n][a].length-s-1),lineString([g[n][a][s],g[n][a][s+1]],p,i)}throw new Error("geojson is invalid")}function Tt(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,a=i.geometryIndex||0,s=i.coordIndex||0,p=i.properties,v;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),p=p||e.features[r].properties,v=e.features[r].geometry;break;case"Feature":p=p||e.properties,v=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":v=e;break;default:throw new Error("geojson is invalid")}if(v===null)return null;var g=v.coordinates;switch(v.type){case"Point":return point(g,p,i);case"MultiPoint":return n<0&&(n=g.length+n),point(g[n],p,i);case"LineString":return s<0&&(s=g.length+s),point(g[s],p,i);case"Polygon":return a<0&&(a=g.length+a),s<0&&(s=g[a].length+s),point(g[a][s],p,i);case"MultiLineString":return n<0&&(n=g.length+n),s<0&&(s=g[n].length+s),point(g[n][s],p,i);case"MultiPolygon":return n<0&&(n=g.length+n),a<0&&(a=g[n].length+a),s<0&&(s=g[n][a].length-s),point(g[n][a][s],p,i)}throw new Error("geojson is invalid")}function Jr(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Br(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Jr(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Jr(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Wr(e,i){var r=[],n={};if(!e.features)return e.features=[],{dataArray:[]};if(e.features=e.features.filter(function(s){var p=s.geometry;return s!=null&&p&&p.type&&p.coordinates&&p.coordinates.length>0}),ut()(e,!0),e.features.length===0)return{dataArray:[],featureKeys:n};var a=0;return ht(e,function(s,p){var v=Li(s),g=p,x=Br(Br({},s.properties),{},{coordinates:v,_id:g});r.push(x)}),{dataArray:r,featureKeys:n}}function vi(e){var i=131,r=137,n=0;e+="x";for(var a=Math.floor(9007199254740991/r),s=0;s<e.length;s++)n>a&&(n=Math.floor(n/r)),n=n*i+e.charCodeAt(s);return n}function en(e){e=e.toString();for(var i=5381,r=e.length;r;)i=i*33^e.charCodeAt(--r);return i>>>0}var gn=Q(28481),Hi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function pi(e){this.message=e}pi.prototype=new Error,pi.prototype.name="InvalidCharacterError";function wi(e){var i=String(e).replace(/=+$/,"");if(i.length%4==1)throw new pi("'atob' failed: The string to be decoded is not correctly encoded.");for(var r="",n=0,a,s,p=0;s=i.charAt(p++);~s&&(a=n%4?a*64+s:s,n++%4)?r+=String.fromCharCode(255&a>>(-2*n&6)):0)s=Hi.indexOf(s);return r}function yi(e){e=String(e);for(var i,r,n,a,s="",p=0,v=e.length%3;p<e.length;){if((r=e.charCodeAt(p++))>255||(n=e.charCodeAt(p++))>255||(a=e.charCodeAt(p++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");i=r<<16|n<<8|a,s+=Hi.charAt(i>>18&63)+Hi.charAt(i>>12&63)+Hi.charAt(i>>6&63)+Hi.charAt(i&63)}return v?s.slice(0,v-3)+"===".substring(v):s}var dt=Q(6610),Mt=Q(5991),wa=function(){function e(i,r){(0,dt.Z)(this,e),this.buffers=i,this.type=r}return(0,Mt.Z)(e,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(r,n,a){throw new Error("not implemented")}}]),e}(),Ei;typeof window=="undefined"?Ei={devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(i){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(i){return!0},Event:function(i,r){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:Ei=window;var Ti=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Ui=Ti?my.getSystemInfoSync().pixelRatio:Ei.devicePixelRatio,Pr=Q(10379),on=Q(46070),gt=Q(77608),aa=(0,Mt.Z)(function e(i,r){(0,dt.Z)(this,e),(0,A.Z)(this,"cancelBubble",void 0),(0,A.Z)(this,"cancelable",void 0),(0,A.Z)(this,"target",void 0),(0,A.Z)(this,"currentTarget",void 0),(0,A.Z)(this,"preventDefault",void 0),(0,A.Z)(this,"stopPropagation",void 0),(0,A.Z)(this,"type",void 0),(0,A.Z)(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=i,this.timeStamp=Date.now()}),ue=Q(63349);function qo(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=ea(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function ea(e,i){if(!!e){if(typeof e=="string")return _u(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _u(e,i)}}function _u(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var za=new WeakMap,Ta=function(){function e(){(0,dt.Z)(this,e),za.set(this,{})}return(0,Mt.Z)(e,[{key:"addEventListener",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=za.get(this);s||(s={}),s[r]||(s[r]=[]),s[r].push(n),za.set(this,s),a.capture,a.once,a.passive}},{key:"removeEventListener",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=za.get(this);if(s){var p=s[r];if(p&&p.length>0){for(var v=p.length;v--;v>0)if(p[v]===n){p.splice(v,1);break}}}}},{key:"dispatchEvent",value:function(r){var n=za.get(this)[r.type];if(n){var a=qo(n),s;try{for(a.s();!(s=a.n()).done;){var p=s.value;p(r)}}catch(v){a.e(v)}finally{a.f()}}}}]),e}();function qa(e){var i=oa();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function oa(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ao=function(e){(0,Pr.Z)(r,e);var i=qa(r);function r(){var n;return(0,dt.Z)(this,r),n=i.call(this),(0,A.Z)((0,ue.Z)(n),"childNodes",void 0),n.childNodes=[],n}return(0,Mt.Z)(r,[{key:"appendChild",value:function(a){this.childNodes.push(a)}},{key:"cloneNode",value:function(){var a=Object.create(this);return Object.assign(a,this),a}},{key:"removeChild",value:function(a){var s=this.childNodes.findIndex(function(p){return p===a});return s>-1?this.childNodes.splice(s,1):null}}]),r}(Ta);function Zo(e){var i=Cu();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function Cu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ho=function(e){(0,Pr.Z)(r,e);var i=Zo(r);function r(){var n;return(0,dt.Z)(this,r),n=i.call(this),(0,A.Z)((0,ue.Z)(n),"className",void 0),(0,A.Z)((0,ue.Z)(n),"children",void 0),n.className="",n.children=[],n}return(0,Mt.Z)(r,[{key:"setAttribute",value:function(a,s){this[a]=s}},{key:"getAttribute",value:function(a){return this[a]}},{key:"setAttributeNS",value:function(a,s){this[a]=s}},{key:"getAttributeNS",value:function(a){return this[a]}}]),r}(Ao),Lo=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,sa,Ka,Do,$a;if(Lo){var As=my.getSystemInfoSync();sa=As.screenWidth,Ka=As.screenHeight,Do=As.windowWidth,$a=As.windowHeight}else{var Ml=Ei.innerWidth,ds=Ei.innerHeight;sa=Ml,Ka=ds,Do=Ml,$a=ds}var ee={width:sa,height:Ka,availWidth:Do,availHeight:$a,availLeft:0,availTop:0},ye=ee.availWidth,We=ee.availHeight,It={style:[]};function Ir(e,i){if(!("parentNode"in e)){var r;i===0?r=function(){return null}:i===1?r=function(){return It}:r=function(){return null},Object.defineProperty(e,"parentNode",{enumerable:!0,get:r})}if(!("parentElement"in e)){var n;i===0?n=function(){return null}:i===1?n=function(){return It}:n=function(){return null},Object.defineProperty(e,"parentElement",{enumerable:!0,get:n})}}function In(e){e.style=e.style||{},Object.assign(e.style,{top:"0px",left:"0px",width:ye+"px",height:We+"px",margin:"0px",padding:"0px"})}function Mi(e){"clientLeft"in e||(e.clientLeft=0,e.clientTop=0),"clientWidth"in e||(e.clientWidth=ye,e.clientHeight=We),"getBoundingClientRect"in e||(e.getBoundingClientRect=function(){var i={x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight};return i})}function ao(e){"offsetLeft"in e||(e.offsetLeft=0,e.offsetTop=0),"offsetWidth"in e||(e.offsetWidth=ye,e.offsetHeight=We)}function Ra(e){"scrollLeft"in e||(e.scrollLeft=0,e.scrollTop=0),"scrollWidth"in e||(e.scrollWidth=ye,e.scrollHeight=We)}function Ua(e){var i=function(){return!0};e.classList=[],e.classList.add=i,e.classList.remove=i,e.classList.contains=i,e.classList.toggle=i}function jo(e){var i=vs();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function vs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function uo(){}var wo=function(e){(0,Pr.Z)(r,e);var i=jo(r);function r(){var n,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",s=arguments.length>1?arguments[1]:void 0;return(0,dt.Z)(this,r),n=i.call(this),(0,A.Z)((0,ue.Z)(n),"className",void 0),(0,A.Z)((0,ue.Z)(n),"children",void 0),(0,A.Z)((0,ue.Z)(n),"focus",void 0),(0,A.Z)((0,ue.Z)(n),"blur",void 0),(0,A.Z)((0,ue.Z)(n),"insertBefore",void 0),(0,A.Z)((0,ue.Z)(n),"appendChild",void 0),(0,A.Z)((0,ue.Z)(n),"removeChild",void 0),(0,A.Z)((0,ue.Z)(n),"remove",void 0),(0,A.Z)((0,ue.Z)(n),"innerHTML",void 0),(0,A.Z)((0,ue.Z)(n),"tagName",void 0),n.className="",n.children=[],n.focus=uo,n.blur=uo,n.insertBefore=uo,n.appendChild=uo,n.removeChild=uo,n.remove=uo,n.innerHTML="",n.tagName=a.toUpperCase(),Ir((0,ue.Z)(n),s),In((0,ue.Z)(n)),Ua((0,ue.Z)(n)),Mi((0,ue.Z)(n)),ao((0,ue.Z)(n)),Ra((0,ue.Z)(n)),n}return(0,Mt.Z)(r)}(ho);function ms(e){var i=ws();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function ws(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ds=function(e){(0,Pr.Z)(r,e);var i=ms(r);function r(n){return(0,dt.Z)(this,r),i.call(this,n)}return(0,Mt.Z)(r,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),r}(wo);function uu(e){var i=gs();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function gs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ma=function(e){(0,Pr.Z)(r,e);var i=uu(r);function r(){return(0,dt.Z)(this,r),i.call(this,"video")}return(0,Mt.Z)(r)}(Ds),_a={},rs={};function pf(e,i){_a=e,_a.id=i,"tagName"in _a||(_a.tagName="CANVAS"),_a.type="canvas",Mixin.parentNode(_a),Mixin.style(_a),Mixin.classList(_a),Mixin.clientRegion(_a),Mixin.offsetRegion(_a),_a.focus=function(){},_a.blur=function(){}}function Pl(e,i){var r=1024,n=1024;rs={width:r,height:n,clientWidth:r/devicePixelRatio,clientHeight:n/devicePixelRatio,id:i,type:"canvas"},"tagName"in rs||(rs.tagName="CANVAS"),Mixin.parentNode(rs),Mixin.style(rs),Mixin.classList(rs),Mixin.clientRegion(rs),Mixin.offsetRegion(rs),rs.getContext=function(a){if(a==="2d")return e},rs.focus=function(){},rs.blur=function(){}}function Ws(){return _a}function rc(){return rs}var Wu=(0,Mt.Z)(function e(){(0,dt.Z)(this,e);var i=Ws(),r=i.createImage&&i.createImage()||{};return"tagName"in r||(r.tagName="IMG",r.__proto__=e.prototype),Ir(r),Ua(r),Object.assign(r,{addEventListener:function(a,s){r["on".concat(a)]=s.bind(r)},removeEventListener:function(a){r["on".concat(a)]=null}}),r}),Xs={href:"",protocol:"",host:""};function al(e){var i=_();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function _(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var M=function(e){(0,Pr.Z)(r,e);var i=al(r);function r(){return(0,dt.Z)(this,r),i.call(this,"body",0)}return(0,Mt.Z)(r,[{key:"addEventListener",value:function(a,s){var p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(a,s,p){}},{key:"dispatchEvent",value:function(a){}}]),r}(wo),B=function(e){(0,Pr.Z)(r,e);var i=al(r);function r(){return(0,dt.Z)(this,r),i.call(this,"html",0)}return(0,Mt.Z)(r,[{key:"addEventListener",value:function(a,s){var p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(a,s){}},{key:"dispatchEvent",value:function(a){}}]),r}(wo),O={},K={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:Xs,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(i){return i=i.toLowerCase(),i==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):i==="img"?new Wu:i==="video"?new ma:new wo(i)},createElementNS:function(i,r){return this.createElement(r)},createTextNode:function(i){return i},getElementById:function(i){return null},getElementsByTagName:function(i){return i=i.toLowerCase(),[]},getElementsByTagNameNS:function(i,r){return this.getElementsByTagName(r)},getElementsByName:function(i){return[]},querySelector:function(i){return null},querySelectorAll:function(i){return[]},addEventListener:function(i,r,n){O[i]||(O[i]=[]),O[i].push(r)},removeEventListener:function(i,r){var n=O[i];if(n&&n.length>0){for(var a=n.length;a--;a>0)if(n[a]===r){n.splice(a,1);break}}},dispatchEvent:function(i){var r=i.type,n=O[r];if(n)for(var a=0;a<n.length;a++)n[a](i);i.target&&typeof i.target["on"+r]=="function"&&i.target["on"+r](i)},createEvent:function(i){return new aa(i)}};K.documentElement=new B,K.head=new wo("head"),K.body=new M;var ge=Object,He=Q(90484),lt=function(){function e(){(0,dt.Z)(this,e),(0,A.Z)(this,"_w",void 0),(0,A.Z)(this,"_h",void 0),(0,A.Z)(this,"_data",void 0);var i=arguments.length;if(i===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){this._w=arguments[0],this._h=arguments[1],this._data=new Uint8ClampedArray(this._w*this._h*4);return}}else i===3&&(0,He.Z)(arguments[0])==="object"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number"&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return(0,Mt.Z)(e,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),e}(),pt=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,nr,sr,Mn;if(pt){var ri=my.getSystemInfoSync();nr=ri.system,sr=ri.platform,Mn=ri.language}else{var kn={versions:function(){var e=Ei.navigator.userAgent;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")===-1,mobile:!!e.match(/AppleWebKit.*Mobile.*/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:e.indexOf("Safari")===-1,weixin:e.indexOf("MicroMessenger")>-1,qq:e.match(/\sQQ/i)===" qq"}}(),language:(Ei.navigator.browserLanguage||Ei.navigator.language).toLowerCase()};kn.versions.android?sr="android":kn.versions.trident?sr="IE":kn.versions.presto?sr="Opera":kn.versions.webKit?sr="webKit":kn.versions.gecko?sr="Firefox":kn.versions.mobile?sr="mobile":kn.versions.ios?sr="ios":kn.versions.iPhone?sr="iPhone":kn.versions.iPad?sr="ipad":kn.versions.webApp?sr="webApp":kn.versions.weixin?sr="weixin":kn.versions.qq&&(sr="qq"),nr=Ei.navigator.userAgent,Mn=kn.language}var Wi=nr.toLowerCase().indexOf("android")!==-1,da=Wi?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",Sa="Mozilla/5.0 (".concat(da,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(Mn),ji={platform:sr,language:Mn,appVersion:"5.0 (".concat(da,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:Sa},ys={mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){}},lu=0,Xu=0;function hf(e){var i=Date.now(),r=Math.max(lu+23,i);return Xu=setTimeout(function(){e(lu=r)},r-i),Xu}function ol(e){var i=Ws();return i.requestAnimationFrame?i.requestAnimationFrame(e):hf(e)}function kc(e){var i=Ws();return i.cancelAnimationFrame?i.cancelAnimationFrame(e):clearTimeout(e)}var Au=function(){function e(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if((0,dt.Z)(this,e),(0,A.Z)(this,"href",void 0),i.indexOf("http://")==0||i.indexOf("https://")==0){this.href=i;return}this.href=r+i}return(0,Mt.Z)(e,null,[{key:"createObjectURL",value:function(r){var n=r.buffers[0],a=r.type,s=wu(n),p="data:".concat(a,";base64, ");return p+s}}]),e}();function wu(e){for(var i="",r=new Uint8Array(e),n=r.byteLength,a=0;a<n;a++)i+=String.fromCharCode(r[a]);return yi(i)}var Tu={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:18446744073709552e3,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},lo={};function Zf(e){var i=jf();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function jf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ko=new Map,Lc=new Map,Mu=new Map,cu={json:"application/json",text:"application/text",arraybuffer:"application/octet-stream"};function df(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{target:this};typeof this["on".concat(e)]=="function"&&this["on".concat(e)].call(this,i)}function Il(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{readyState:e};this.readyState=e,df.call(this,"readystatechange",i)}var Fi=function(e){(0,Pr.Z)(r,e);var i=Zf(r);function r(){var n;return(0,dt.Z)(this,r),n=i.call(this),(0,A.Z)((0,ue.Z)(n),"onabort",void 0),(0,A.Z)((0,ue.Z)(n),"onerror",void 0),(0,A.Z)((0,ue.Z)(n),"onload",void 0),(0,A.Z)((0,ue.Z)(n),"onloadstart",void 0),(0,A.Z)((0,ue.Z)(n),"onprogress",void 0),(0,A.Z)((0,ue.Z)(n),"ontimeout",void 0),(0,A.Z)((0,ue.Z)(n),"onloadend",void 0),(0,A.Z)((0,ue.Z)(n),"onreadystatechange",void 0),(0,A.Z)((0,ue.Z)(n),"readyState",void 0),(0,A.Z)((0,ue.Z)(n),"response",void 0),(0,A.Z)((0,ue.Z)(n),"responseText",void 0),(0,A.Z)((0,ue.Z)(n),"_responseType",void 0),(0,A.Z)((0,ue.Z)(n),"responseXML",void 0),(0,A.Z)((0,ue.Z)(n),"status",void 0),(0,A.Z)((0,ue.Z)(n),"statusText",void 0),(0,A.Z)((0,ue.Z)(n),"upload",void 0),(0,A.Z)((0,ue.Z)(n),"withCredentials",void 0),(0,A.Z)((0,ue.Z)(n),"timeout",void 0),(0,A.Z)((0,ue.Z)(n),"_url",void 0),(0,A.Z)((0,ue.Z)(n),"_method",void 0),n.onabort=null,n.onerror=null,n.onload=null,n.onloadstart=null,n.onprogress=null,n.ontimeout=null,n.onloadend=null,n.onreadystatechange=null,n.readyState=0,n.response=null,n.responseText=null,n._responseType="text",n.responseXML=null,n.status=0,n.statusText="",n.upload={},n.withCredentials=!1,Ko.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),n}return(0,Mt.Z)(r,[{key:"responseType",set:function(a){this._responseType=a}},{key:"abort",value:function(){var a=Mu.get("requestTask");a&&a.abort()}},{key:"getAllResponseHeaders",value:function(){var a=Lc.get("responseHeader");return Object.keys(a).map(function(s){return"".concat(s,": ").concat(a[s])}).join(`
`)}},{key:"getResponseHeader",value:function(a){return Lc.get("responseHeader")[a]}},{key:"open",value:function(a,s,p){this._method=a,this._url=s}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:""}},{key:"setRequestHeader",value:function(a,s){var p=Ko.get("requestHeader");p[a]=s,Ko.set("requestHeader",p)}},{key:"addEventListener",value:function(a,s){var p=this;typeof s=="function"&&(this["on"+a]=function(){var v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};v.target=v.target||p,s.call(p,v)})}},{key:"removeEventListener",value:function(a,s){this["on"+a]===s&&(this["on"+a]=null)}}]),r}(Ta);(0,A.Z)(Fi,"UNSEND",void 0),(0,A.Z)(Fi,"OPENED",void 0),(0,A.Z)(Fi,"HEADERS_RECEIVED",void 0),(0,A.Z)(Fi,"LOADING",void 0),(0,A.Z)(Fi,"DONE",void 0),Fi.UNSEND=0,Fi.OPENED=1,Fi.HEADERS_RECEIVED=2,Fi.LOADING=3,Fi.DONE=4;function Ol(e){var i=Ap();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function Ap(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sl=function(e){(0,Pr.Z)(r,e);var i=Ol(r);function r(n){var a;return(0,dt.Z)(this,r),a=i.call(this,n),(0,A.Z)((0,ue.Z)(a),"touches",void 0),(0,A.Z)((0,ue.Z)(a),"targetTouches",void 0),(0,A.Z)((0,ue.Z)(a),"changedTouches",void 0),a.touches=[],a.targetTouches=[],a.changedTouches=[],a.target=Ws(),a.currentTarget=Ws(),a}return(0,Mt.Z)(r)}(aa);function Dc(e){var i=e||{},r=i.x,n=r===void 0?0:r,a=i.y,s=a===void 0?0:a,p=i.clientX,v=p===void 0?0:p,g=i.clientY,x=g===void 0?0:g;Object.keys(e).indexOf("x")!==-1?(e.pageX=e.clientX=n,e.pageY=e.clientY=s):(e.x=v,e.y=x)}function Vf(e){return function(i){var r=new sl(e);r.changedTouches=i.changedTouches,r.touches=i.touches,r.targetTouches=Array.prototype.slice.call(i.touches),r.timeStamp=i.timeStamp,r.changedTouches.forEach(function(n){return Dc(n)}),r.touches.forEach(function(n){return Dc(n)}),r.targetTouches.forEach(function(n){return Dc(n)}),K.dispatchEvent(r)}}function wp(e){return function(i){i.type=e,K.dispatchEvent(i)}}var Gf=Vf("touchstart"),Fc=Vf("touchmove"),nc=Vf("touchend"),ic=wp("mapCameaParams");function Rl(e){var i=ul();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function ul(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kl=function(e){(0,Pr.Z)(r,e);var i=Rl(r);function r(n){var a;return(0,dt.Z)(this,r),a=i.call(this,n),(0,A.Z)((0,ue.Z)(a),"buttons",void 0),(0,A.Z)((0,ue.Z)(a),"which",void 0),(0,A.Z)((0,ue.Z)(a),"pointerId",void 0),(0,A.Z)((0,ue.Z)(a),"bubbles",void 0),(0,A.Z)((0,ue.Z)(a),"button",void 0),(0,A.Z)((0,ue.Z)(a),"width",void 0),(0,A.Z)((0,ue.Z)(a),"height",void 0),(0,A.Z)((0,ue.Z)(a),"pressure",void 0),(0,A.Z)((0,ue.Z)(a),"isPrimary",void 0),(0,A.Z)((0,ue.Z)(a),"pointerType",void 0),(0,A.Z)((0,ue.Z)(a),"altKey",void 0),(0,A.Z)((0,ue.Z)(a),"ctrlKey",void 0),(0,A.Z)((0,ue.Z)(a),"metaKey",void 0),(0,A.Z)((0,ue.Z)(a),"shiftKey",void 0),a.target=Ws(),a.currentTarget=Ws(),a}return(0,Mt.Z)(r)}(aa),Yu=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],Ys=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0],vf="touch";function mf(e,i,r){for(var n=new kl(e),a=0;a<Yu.length;a++){var s=Yu[a];n[s]=i[s]||Ys[a]}return n.type=e,n.target=Ws(),n.currentTarget=Ws(),n.buttons=Hf(e),n.which=n.buttons,n.pointerId=(i.identifier||0)+2,n.bubbles=!0,n.cancelable=!0,n.button=0,n.width=(i.radiusX||.5)*2,n.height=(i.radiusY||.5)*2,n.pressure=i.force||.5,n.isPrimary=ac(i),n.pointerType=vf,n.altKey=r.altKey,n.ctrlKey=r.ctrlKey,n.metaKey=r.metaKey,n.shiftKey=r.shiftKey,r.preventDefault&&(n.preventDefault=function(){r.preventDefault()}),n}function Hf(e){var i=0;return(e==="touchstart"||e==="touchmove"||e==="pointerdown"||e==="pointermove")&&(i=1),i}var fu=null;function ac(e){return fu===e.identifier}function Bc(e){fu===null&&(fu=e.identifier)}function gf(e){fu===e.identifier&&(fu=null)}function Ll(e){return function(i){for(var r=i.changedTouches,n=0;n<r.length;n++){var a=r[n];n===0&&e==="pointerdown"?Bc(a):(e==="pointerup"||e==="pointercancel")&&gf(a);var s=mf(e,a,i);K.dispatchEvent(s)}}}var uh=Ll("pointerdown"),yf=Ll("pointermove"),Dl=Ll("pointerup");function _f(e){var i=xf();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function xf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Fl=function(e){(0,Pr.Z)(r,e);var i=_f(r);function r(n){return(0,dt.Z)(this,r),i.call(this,n)}return(0,Mt.Z)(r)}(aa);function Nc(e){return function(i){i.type=e,K.dispatchEvent(i)}}var Tp=Nc("mousedown"),Mp=Nc("mousemove"),oc=Nc("mouseup"),Pp=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Bl=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),$i=Pp||Bl,sc={atob:wi,btoa:yi,devicePixelRatio:Ui,Blob:wa,document:K,Element:ho,Event:aa,EventTarget:Ta,HTMLCanvasElement:ge,HTMLElement:wo,HTMLMediaElement:Ds,HTMLVideoElement:ma,Image:Wu,ImageData:lt,navigator:ji,Node:Ao,requestAnimationFrame:ol,cancelAnimationFrame:kc,screen:ee,XMLHttpRequest:Fi,performance:ys,URL:Au,WebGLRenderingContext:Tu,WebGL2RenderingContext:lo,addEventListener:function(i,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};K.addEventListener(i,r,n)},removeEventListener:function(i,r,n){K.removeEventListener(i,r)},dispatchEvent:function(i){K.dispatchEvent(i)},innerWidth:ee.availWidth,innerHeight:ee.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},ca=$i?sc:Ei,Pu=$i?Fi:Ei.XMLHttpRequest,Xi=$i?Xs:Ei.location;function Ma(e){var i=e;return typeof e=="string"&&(i=ca.document.getElementById(e)),i}function _s(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function zc(e){return _s(e).split(/\s+/)}function qu(e){var i,r,n=ca==null||(i=ca.document)===null||i===void 0||(r=i.documentElement)===null||r===void 0?void 0:r.style;if(!n)return e[0];for(var a in e)if(e[a]&&e[a]in n)return e[a];return e[0]}function Za(e,i,r){var n=ca.document.createElement(e);return n.className=i||"",r&&r.appendChild(n),n}function uc(e){var i=e.parentNode;i&&i.removeChild(e)}function Nl(e,i){if(e.classList!==void 0)for(var r=zc(i),n=0,a=r.length;n<a;n++)e.classList.add(r[n]);else if(!Uc(e,i)){var s=vo(e);Iu(e,(s?s+" ":"")+i)}}function Ku(e,i){e.classList!==void 0?e.classList.remove(i):Iu(e,_s((" "+vo(e)+" ").replace(" "+i+" "," ")))}function Uc(e,i){if(e.classList!==void 0)return e.classList.contains(i);var r=vo(e);return r.length>0&&new RegExp("(^|\\s)"+i+"(\\s|$)").test(r)}function Iu(e,i){e instanceof HTMLElement?e.className=i:e.className.baseVal=i}function vo(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function zl(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var lc=qu(["transform","WebkitTransform"]);function mo(e,i){e.style[lc]=i}function hn(){if(typeof Event=="function")ca.dispatchEvent(new Event("resize"));else{var e=ca.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,ca,0),ca.dispatchEvent(e)}}function co(e){var i=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,i.join(""))}function $u(){var e,i=ca.document.querySelector('meta[name="viewport"]');if(!i)return 1;var r=(e=i.content)===null||e===void 0?void 0:e.split(","),n=r.find(function(a){var s=a.split("="),p=(0,gn.Z)(s,2),v=p[0],g=p[1];return v==="initial-scale"});return n?n.split("=")[1]*1:1}var ka=$u()<1?1:ca.devicePixelRatio,qs=Q(14665);function Ts(e){return Function.toString.call(e).indexOf("[native code]")!==-1}var bf=Q(51814);function Zr(e,i,r){return(0,bf.Z)()?Zr=Reflect.construct:Zr=function(a,s,p){var v=[null];v.push.apply(v,s);var g=Function.bind.apply(a,v),x=new g;return p&&(0,qs.Z)(x,p.prototype),x},Zr.apply(null,arguments)}function cc(e){var i=typeof Map=="function"?new Map:void 0;return cc=function(n){if(n===null||!Ts(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof i!="undefined"){if(i.has(n))return i.get(n);i.set(n,a)}function a(){return Zr(n,arguments,(0,gt.Z)(this).constructor)}return a.prototype=Object.create(n.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),(0,qs.Z)(a,n)},cc(e)}function Ef(e){var i=ll();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function ll(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ca=function(e){(0,Pr.Z)(r,e);var i=Ef(r);function r(n,a,s){var p;return(0,dt.Z)(this,r),p=i.call(this,n),(0,A.Z)((0,ue.Z)(p),"status",void 0),(0,A.Z)((0,ue.Z)(p),"url",void 0),p.status=a,p.url=s,p.name=p.constructor.name,p.message=n,p}return(0,Mt.Z)(r,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),r}(cc(Error));function xs(e){var i=new Pu;i.open("GET",e.url,!0);for(var r in e.headers)e.headers.hasOwnProperty(r)&&i.setRequestHeader(r,e.headers[r]);return i.withCredentials=e.credentials==="include",i}var Sf=function(i,r){var n=xs(i);return n.setRequestHeader("Accept","application/json"),n.onerror=function(){r(new Error(n.statusText))},n.onload=function(){if(n.status>=200&&n.status<300&&n.response){var a;try{a=JSON.parse(n.response)}catch(s){return r(s)}r(null,a)}else n.status===401?r(new Ca("".concat(n.statusText),n.status,i.url)):r(new Ca(n.statusText,n.status,i.url))},n.send(),n},Ou=function(i,r){var n=xs(i);return n.responseType="arraybuffer",n.onerror=function(){r(new Error(n.statusText))},n.onload=function(){var a=n.response;if(a.byteLength===0&&n.status===200)return r(new Error("http status 200 returned without content."));n.status>=200&&n.status<300&&n.response?r(null,{data:a,cacheControl:n.getResponseHeader("Cache-Control"),expires:n.getResponseHeader("Expires")}):r(new Ca(n.statusText,n.status,i.url))},n.send(),n};function Fs(e){var i=$window.document.createElement("a");return i.href=e,i.protocol===$window.document.location.protocol&&i.host===$window.document.location.host}var Ru="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Wf=function(i,r){return Ou(i,function(n,a){if(n)r(n);else if(a){var s=new ca.Image;s.crossOrigin="anonymous";var p=ca.URL||ca.webkitURL;s.onload=function(){r(null,s),p.revokeObjectURL(s.src)};var v=new ca.Blob([new Uint8Array(a.data)],{type:"image/png"});s.src=a.data.byteLength?p.createObjectURL(v):Ru}})},cl=2*Math.PI*6378137/2;function Xf(e){var i=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(r){var n=r.coordinates;Cf(i,n)}),i}function Cf(e,i){return Array.isArray(i[0])?i.forEach(function(r){Cf(e,r)}):(e[0]>i[0]&&(e[0]=i[0]),e[1]>i[1]&&(e[1]=i[1]),e[2]<i[0]&&(e[2]=i[0]),e[3]<i[1]&&(e[3]=i[1])),e}function pu(e,i){return Ms(e,i)}function Ms(e,i){return Array.isArray(e[0])?e.map(function(r){return Ms(r,i)}):i(e)}function Ai(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=fl(e,i);var n=e[0],a=e[1],s=n*cl/180,p=Math.log(Math.tan((90+a)*Math.PI/360))/(Math.PI/180);return p=p*cl/180,r.enable&&(s=Number(s.toFixed(r.decimal)),p=Number(p.toFixed(r.decimal))),e.length===3?[s,p,e[2]]:[s,p]}function ku(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,r=e[0],n=e[1],a=r/cl*180,s=n/cl*180;return s=180/Math.PI*(2*Math.atan(Math.exp(s*Math.PI/180))-Math.PI/2),i!=null&&(a=Number(a.toFixed(i)),s=Number(s.toFixed(i))),e.length===3?[a,s,e[2]]:[a,s]}function hu(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function Vo(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function fl(e,i){if(i===!1)return e;var r=hu(e[0]),n=Vo(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[r,n,e[2]]:[r,n]}function ns(e){var i=85.0511287798,r=Math.max(Math.min(i,e[1]),-i),n=256<<20,a=Math.PI/180,s=e[0]*a,p=r*a;p=Math.log(Math.tan(Math.PI/4+p/2));var v=.5/Math.PI,g=.5,x=-.5/Math.PI;return a=.5,s=n*(v*s+g),p=n*(x*p+a),[Math.floor(s),Math.floor(p)]}function Ks(e){var i=.5/Math.PI,r=.5,n=-.5/Math.PI,a=.5,s=256<<20,p=_slicedToArray(e,2),v=p[0],g=p[1];v=(v/s-r)/i,g=(g/s-a)/n,g=(Math.atan(Math.pow(Math.E,g))-Math.PI/4)*2,a=Math.PI/180;var x=g/a,C=v/a;return[C,x]}function bs(e,i,r){var n=er(i[1]-e[1]),a=er(i[0]-e[0]),s=er(e[1]),p=er(i[1]),v=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(s)*Math.cos(p);return fe(2*Math.atan2(Math.sqrt(v),Math.sqrt(1-v)),r="meters")}function xu(e){var i=Math.PI/180,r=85.0511287798,n=6378137,a=Math.max(Math.min(r,e[1]),-r),s=Math.sin(a*i),p=n*e[0]*i,v=n*Math.log((1+s)/(1-s))/2;return[p,v]}function Rn(e,i){var r=Math.abs(e[1][1]-e[0][1])*i,n=Math.abs(e[1][0]-e[0][0])*i;return[[e[0][0]-n,e[0][1]-r],[e[1][0]+n,e[1][1]+r]]}function Cn(e,i){return e[0][0]<=i[0][0]&&e[0][1]<=i[0][1]&&e[1][0]>=i[1][0]&&e[1][1]>=i[1][1]}function Zc(e){return[[e[0],e[1]],[e[2],e[3]]]}function $o(e){var i=$s(e,[0,0]);return[e[0]/i,e[1]/i]}function $s(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))}function Go(e,i){return e[0]*i[0]+e[1]*i[1]}function du(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Yf(e,i){return Math.acos(Go(e,i)/(du(e)*du(i)))*180/Math.PI}function jc(e,i){return i[0]>0?i[1]>0?90-Math.atan(i[1]/i[0])*180/Math.PI:90+Math.atan(-i[1]/i[0])*180/Math.PI:i[1]<0?180+(90-Math.atan(i[1]/i[0])*180/Math.PI):270+Math.atan(i[1]/-i[0])*180/Math.PI}function ga(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!e||e.length<2)){for(var r=[0,1],n=0,a=[],s=0;s<e.length-1;s++){var p=e[s],v=e[s+1],g=$s(p,v);n+=g;var x=[p[0]-v[0],p[1]-v[1]],C=jc(r,x);if(s>0){var T=a[s-1].rotation;T-C>360-T+C&&(C=C+360)}a.push({start:p,end:v,dis:g,rotation:C,duration:0})}return a.map(function(R){R.duration=i*(R.dis/n)}),a}}var La=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,r=arguments.length>1?arguments[1]:void 0;(0,dt.Z)(this,e),(0,A.Z)(this,"limit",void 0),(0,A.Z)(this,"cache",void 0),(0,A.Z)(this,"destroy",void 0),(0,A.Z)(this,"order",void 0),this.limit=i,this.destroy=r||this.defaultDestroy,this.order=[],this.clear()}return(0,Mt.Z)(e,[{key:"clear",value:function(){var r=this;this.order.forEach(function(n){r.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(r){var n=this.cache[r];return n&&(this.deleteOrder(r),this.appendOrder(r)),n}},{key:"set",value:function(r,n){this.cache[r]?(this.delete(r),this.cache[r]=n,this.appendOrder(r)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[r]=n,this.appendOrder(r))}},{key:"delete",value:function(r){var n=this.cache[r];n&&(this.deleteCache(r),this.deleteOrder(r),this.destroy(n,r))}},{key:"deleteCache",value:function(r){delete this.cache[r]}},{key:"deleteOrder",value:function(r){var n=this.order.findIndex(function(a){return a===r});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(r){this.order.push(r)}},{key:"defaultDestroy",value:function(r,n){return null}}]),e}();function pl(e,i){e.forEach(function(r){!i[r]||(i[r]=i[r].bind(i))})}var fc=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16;(0,dt.Z)(this,e),(0,A.Z)(this,"duration",16),(0,A.Z)(this,"timestamp",new Date().getTime()),this.duration=i}return(0,Mt.Z)(e,[{key:"run",value:function(r){var n=new Date().getTime(),a=n-this.timestamp;this.timestamp=n,a>=this.duration&&r()}}]),e}(),Qs=Q(2650);function vu(e){return typeof e=="string"?!!Qs.ZP(e):!1}function _i(e){var i=Qs.ZP(e),r=[0,0,0,0];return i!=null&&(r[0]=i.r/255,r[1]=i.g/255,r[2]=i.b/255,r[3]=i.opacity),r}function Bs(e){var i=e&&e[0],r=e&&e[1],n=e&&e[2],a=i+r*256+n*65536-1;return a}function Ps(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function hl(e){var i=ca.document.createElement("canvas"),r=i.getContext("2d");i.width=256,i.height=1;for(var n=r.createLinearGradient(0,0,256,1),a=null,s=e.positions[0],p=e.positions[e.positions.length-1],v=0;v<e.colors.length;++v){var g=(e.positions[v]-s)/(p-s);n.addColorStop(g,e.colors[v])}if(r.fillStyle=n,r.fillRect(0,0,256,1),$i)return a=new Uint8ClampedArray(r.getImageData(0,0,256,1).data),{data:a,width:256,height:1};a=r.getImageData(0,0,256,1).data;for(var x=r.createImageData(256,1),C=0;C<x.data.length;C+=4)x.data[C+0]=a[C+0],x.data[C+1]=a[C+1],x.data[C+2]=a[C+2],x.data[C+3]=a[C+3];return x}var Lu;(function(e){e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e.LEFT="left",e.RIGHT="right"})(Lu||(Lu={}));var Qu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Vc(e,i,r){var n=e.classList;for(var a in Qu)Qu.hasOwnProperty(a)&&n.remove("l7-".concat(r,"-anchor-").concat(a));n.add("l7-".concat(r,"-anchor-").concat(i))}function Pa(e,i){return{enable:e,mask:255,func:{cmp:514,ref:i?1:0,mask:255}}}var Js={BACK:1029,FRONT:1028};function Ul(e){switch(e){case"GAODE1.x":return Js.BACK;case"GAODE2.x":return Js.BACK;case"MAPBOX":return Js.FRONT;case"SIMPLE":return Js.FRONT;case"GLOBEL":return Js.BACK;case"L7MAP":return Js.FRONT;default:return Js.FRONT}}function dl(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i*1}function vl(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i*1}function Gc(e){if(e.length===0)return 0;for(var i=e[0]*1,r=1;r<e.length;r++)i+=e[r]*1;return i}function ml(e){if(e.length===0)throw new Error("mean requires at least one data point");return Gc(e)/e.length}function eu(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var i=e[0],r=NaN,n=0,a=1,s=1;s<e.length+1;s++)e[s]!==i?(a>n&&(n=a,r=i),a=1,i=e[s]):a++;return r*1}var pc={min:vl,max:dl,mean:ml,sum:Gc,mode:eu};function Zl(e,i){return e.map(function(r){return r[i]})}function qf(e,i){return pc[e](i)}function jl(e,i){var r=i.extent,n=r===void 0?[121.168,30.2828,121.384,30.4219]:r,a=new Promise(function(p){l(e,function(v){p(v)})}),s={originData:e,images:a,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return s}function l(e,i){var r=e,n=[];if(typeof r=="string")Wf({url:r},function(p,v){n.push(v),i(n)});else{var a=r.length,s=0;r.forEach(function(p){Wf({url:p},function(v,g){s++,n.push(g),s===a&&i(n)})})}return jl}function f(e,i){var r=i.extent,n=i.width,a=i.height,s=i.min,p=i.max,v={_id:1,dataArray:[{_id:1,data:Array.from(e),width:n,height:a,min:s,max:p,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]};return v}var c=Q(30236),d=Q.n(c),E=Q(47037),w=Q.n(E),P=Q(23560),L=Q.n(P),U=Q(50361),H=Q.n(U),ae=Q(34155);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function se(e,i,r,n){function a(s){return s instanceof r?s:new r(function(p){p(s)})}return new(r||(r=Promise))(function(s,p){function v(C){try{x(n.next(C))}catch(T){p(T)}}function g(C){try{x(n.throw(C))}catch(T){p(T)}}function x(C){C.done?s(C.value):a(C.value).then(v,g)}x((n=n.apply(e,i||[])).next())})}function le(e,i){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,a,s,p;return p={next:v(0),throw:v(1),return:v(2)},typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p;function v(x){return function(C){return g([x,C])}}function g(x){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(s=x[0]&2?a.return:x[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,x[1])).done)return s;switch(a=0,s&&(x=[x[0]&2,s.value]),x[0]){case 0:case 1:s=x;break;case 4:return r.label++,{value:x[1],done:!1};case 5:r.label++,a=x[1],x=[0];continue;case 7:x=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(x[0]===6||x[0]===2)){r=0;continue}if(x[0]===3&&(!s||x[1]>s[0]&&x[1]<s[3])){r.label=x[1];break}if(x[0]===6&&r.label<s[1]){r.label=s[1],s=x;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(x);break}s[2]&&r.ops.pop(),r.trys.pop();continue}x=i.call(e,r)}catch(C){x=[6,C],a=0}finally{n=s=0}if(x[0]&5)throw x[1];return{value:x[0]?x[1]:void 0,done:!0}}}function Oe(e,i){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),a,s=[],p;try{for(;(i===void 0||i-- >0)&&!(a=n.next()).done;)s.push(a.value)}catch(v){p={error:v}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(p)throw p.error}}return s}function Pe(){for(var e=[],i=0;i<arguments.length;i++)e=e.concat(Oe(arguments[i]));return e}function Ne(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function xe(e,i){return i={exports:{}},e(i,i.exports),i.exports}var je=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return n&&typeof n.length=="number"&&n.length>=0&&n.length%1==0}e.exports=i.default});Ne(je);var Ke=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return function(){for(var n=[],a=arguments.length;a--;)n[a]=arguments[a];var s=n.pop();return r.call(this,n,s)}},e.exports=i.default});Ne(Ke);var vt=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.fallback=a,i.wrap=s;var r=i.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,n=i.hasNextTick=typeof ae=="object"&&typeof ae.nextTick=="function";function a(v){setTimeout(v,0)}function s(v){return function(g){for(var x=[],C=arguments.length-1;C-- >0;)x[C]=arguments[C+1];return v(function(){return g.apply(void 0,x)})}}var p;r?p=setImmediate:n?p=ae.nextTick:p=a,i.default=s(p)});Ne(vt);var Wt=vt.fallback,Zt=vt.wrap,qt=vt.hasSetImmediate,hr=vt.hasNextTick,kr=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(Ke),n=a(vt);function a(g){return g&&g.__esModule?g:{default:g}}function s(g){return(0,yr.isAsync)(g)?function(){for(var x=[],C=arguments.length;C--;)x[C]=arguments[C];var T=x.pop(),R=g.apply(this,x);return p(R,T)}:(0,r.default)(function(x,C){var T;try{T=g.apply(this,x)}catch(R){return C(R)}if(T&&typeof T.then=="function")return p(T,C);C(null,T)})}function p(g,x){return g.then(function(C){v(x,null,C)},function(C){v(x,C&&C.message?C:new Error(C))})}function v(g,x,C){try{g(x,C)}catch(T){(0,n.default)(function(R){throw R},T)}}e.exports=i.default});Ne(kr);var yr=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.isAsyncIterable=i.isAsyncGenerator=i.isAsync=void 0;var r=n(kr);function n(g){return g&&g.__esModule?g:{default:g}}function a(g){return g[Symbol.toStringTag]==="AsyncFunction"}function s(g){return g[Symbol.toStringTag]==="AsyncGenerator"}function p(g){return typeof g[Symbol.asyncIterator]=="function"}function v(g){if(typeof g!="function")throw new Error("expected a function");return a(g)?(0,r.default)(g):g}i.default=v,i.isAsync=a,i.isAsyncGenerator=s,i.isAsyncIterable=p});Ne(yr);var sn=yr.isAsyncIterable,Zn=yr.isAsyncGenerator,jn=yr.isAsync,Ln=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n,a){if(a===void 0&&(a=n.length),!a)throw new Error("arity is undefined");function s(){for(var p=this,v=[],g=arguments.length;g--;)v[g]=arguments[g];return typeof v[a-1]=="function"?n.apply(this,v):new Promise(function(x,C){v[a-1]=function(T){for(var R=[],F=arguments.length-1;F-- >0;)R[F]=arguments[F+1];if(T)return C(T);x(R.length>1?R:R[0])},n.apply(p,v)})}return Object.defineProperty(s,"name",{configurable:!0,value:"awaitable("+n.name+")"}),s}e.exports=i.default});Ne(Ln);var Ri=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=s(je),n=s(yr),a=s(Ln);function s(p){return p&&p.__esModule?p:{default:p}}i.default=(0,a.default)(function(p,v,g){var x=(0,r.default)(v)?[]:{};p(v,function(C,T,R){(0,n.default)(C)(function(F){for(var j,Y=[],J=arguments.length-1;J-- >0;)Y[J]=arguments[J+1];Y.length<2&&(j=Y,Y=j[0]),x[T]=Y,R(F)})},function(C){return g(C,x)})},3),e.exports=i.default});Ne(Ri);var tn=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){function a(){for(var s=[],p=arguments.length;p--;)s[p]=arguments[p];if(n!==null){var v=n;n=null,v.apply(this,s)}}return Object.assign(a,n),a}e.exports=i.default});Ne(tn);var ni=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return r[Symbol.iterator]&&r[Symbol.iterator]()},e.exports=i.default});Ne(ni);var li=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=g;var r=a(je),n=a(ni);function a(x){return x&&x.__esModule?x:{default:x}}function s(x){var C=-1,T=x.length;return function(){return++C<T?{value:x[C],key:C}:null}}function p(x){var C=-1;return function(){var R=x.next();return R.done?null:(C++,{value:R.value,key:C})}}function v(x){var C=x?Object.keys(x):[],T=-1,R=C.length;return function(){var j=C[++T];return T<R?{value:x[j],key:j}:null}}function g(x){if((0,r.default)(x))return s(x);var C=(0,n.default)(x);return C?p(C):v(x)}e.exports=i.default});Ne(li);var Kn=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];if(n===null)throw new Error("Callback was already called.");var p=n;n=null,p.apply(this,a)}}e.exports=i.default});Ne(Kn);var Hn=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r={};i.default=r,e.exports=i.default});Ne(Hn);var hi=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=a;var r=n(Hn);function n(s){return s&&s.__esModule?s:{default:s}}function a(s,p,v,g){var x=!1,C=!1,T=!1,R=0,F=0;function j(){R>=p||T||x||(T=!0,s.next().then(function(be){var Be=be.value,Ye=be.done;if(!(C||x)){if(T=!1,Ye){x=!0,R<=0&&g(null);return}R++,v(Be,F,Y),F++,j()}}).catch(J))}function Y(be,Be){if(R-=1,!C){if(be)return J(be);if(be===!1){x=!0,C=!0;return}if(Be===r.default||x&&R<=0)return x=!0,g(null);j()}}function J(be){C||(T=!1,x=!0,g(be))}j()}e.exports=i.default});Ne(hi);var qn=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=v(tn),n=v(li),a=v(Kn),s=v(hi),p=v(Hn);function v(g){return g&&g.__esModule?g:{default:g}}i.default=function(g){return function(x,C,T){if(T=(0,r.default)(T),g<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!x)return T(null);if((0,yr.isAsyncGenerator)(x))return(0,s.default)(x,g,C,T);if((0,yr.isAsyncIterable)(x))return(0,s.default)(x[Symbol.asyncIterator](),g,C,T);var R=(0,n.default)(x),F=!1,j=!1,Y=0,J=!1;function be(Ye,tt){if(!j)if(Y-=1,Ye)F=!0,T(Ye);else if(Ye===!1)F=!0,j=!0;else{if(tt===p.default||F&&Y<=0)return F=!0,T(null);J||Be()}}function Be(){for(J=!0;Y<g&&!F;){var Ye=R();if(Ye===null){F=!0,Y<=0&&T(null);return}Y+=1,C(Ye.value,Ye.key,(0,a.default)(be))}J=!1}Be()}},e.exports=i.default});Ne(qn);var Xn=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=s(qn),n=s(yr),a=s(Ln);function s(v){return v&&v.__esModule?v:{default:v}}function p(v,g,x,C){return(0,r.default)(g)(v,(0,n.default)(x),C)}i.default=(0,a.default)(p,4),e.exports=i.default});Ne(Xn);var go=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=a(Xn),n=a(Ln);function a(p){return p&&p.__esModule?p:{default:p}}function s(p,v,g){return(0,r.default)(p,1,v,g)}i.default=(0,n.default)(s,3),e.exports=i.default});Ne(go);var Qa=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(Ri),n=a(go);function a(p){return p&&p.__esModule?p:{default:p}}function s(p,v){return(0,r.default)(n.default,p,v)}e.exports=i.default}),To=Ne(Qa),Da=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return this.args=r,To(this.tasks)},e.prototype.tap=function(i,r){var n=this;this.tasks.push(function(a){r.apply(void 0,Pe(n.args)),a(null,i)})},e}(),Ga=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=x(je),n=x(Hn),a=x(Xn),s=x(tn),p=x(Kn),v=x(yr),g=x(Ln);function x(F){return F&&F.__esModule?F:{default:F}}function C(F,j,Y){Y=(0,s.default)(Y);var J=0,be=0,Be=F.length,Ye=!1;Be===0&&Y(null);function tt(Et,wt){Et===!1&&(Ye=!0),Ye!==!0&&(Et?Y(Et):(++be===Be||wt===n.default)&&Y(null))}for(;J<Be;J++)j(F[J],J,(0,p.default)(tt))}function T(F,j,Y){return(0,a.default)(F,Infinity,j,Y)}function R(F,j,Y){var J=(0,r.default)(F)?C:T;return J(F,(0,v.default)(j),Y)}i.default=(0,g.default)(R,3),e.exports=i.default});Ne(Ga);var fo=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(Ga),n=a(Ri);function a(p){return p&&p.__esModule?p:{default:p}}function s(p,v){return(0,n.default)(r.default,p,v)}e.exports=i.default}),Is=Ne(fo),is=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.promise=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return Is(this.tasks)},e.prototype.tapPromise=function(i,r){var n=this;this.tasks.push(function(a){return se(n,void 0,void 0,function(){return le(this,function(s){switch(s.label){case 0:return[4,r()];case 1:return s.sent(),a(null,i),[2]}})})})},e}(),Du=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=p(tn),n=p(Kn),a=p(yr),s=p(Ln);function p(g){return g&&g.__esModule?g:{default:g}}function v(g,x){if(x=(0,r.default)(x),!Array.isArray(g))return x(new Error("First argument to waterfall must be an array of functions"));if(!g.length)return x();var C=0;function T(F){var j=(0,a.default)(g[C++]);j.apply(void 0,F.concat([(0,n.default)(R)]))}function R(F){for(var j=[],Y=arguments.length-1;Y-- >0;)j[Y]=arguments[Y+1];if(F!==!1){if(F||C===g.length)return x.apply(void 0,[F].concat(j));T(j)}}T([])}i.default=(0,s.default)(v),e.exports=i.default}),as=Ne(Du),mu=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return as(this.tasks)},e.prototype.tap=function(i,r){this.tasks.length===0?this.tasks.push(function(n){var a=r();n(a?null:!1,a)}):this.tasks.push(function(n,a){var s=r();a(s?null:!1,i)})},e}(),Os=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return To(this.tasks)},e.prototype.tap=function(i,r){this.tasks.push(function(n){var a=r();n(a,i)})},e}(),Es=Q(26729),Vl=Q.n(Es),Fu=Q(69848),gl=Q.n(Fu);function Gl(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function tu(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Gl(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Gl(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function yl(e,i){var r=i.radius,n=r===void 0?40:r,a=i.maxZoom,s=a===void 0?18:a,p=i.minZoom,v=p===void 0?0:p,g=i.zoom,x=g===void 0?2:g;if(e.pointIndex){var C=e.pointIndex.getClusters(e.extent,Math.floor(x));return e.dataArray=bu(C),e}var T=new(gl())({radius:n,minZoom:v,maxZoom:s}),R={type:"FeatureCollection",features:[]};return R.features=e.dataArray.map(function(F){return{type:"Feature",geometry:{type:"Point",coordinates:F.coordinates},properties:tu({},F)}}),T.load(R.features),T}function bu(e){return e.map(function(i,r){return tu({coordinates:i.geometry.coordinates,_id:r+1},i.properties)})}function Eo(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i}function Bu(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i}function Nu(e){if(e.length===0)return 0;for(var i=e[0],r=0,n,a=1;a<e.length;a++)n=i+e[a]*1,Math.abs(i)>=Math.abs(e[a])?r+=i-n+e[a]:r+=e[a]-n+i,i=n;return i+r*1}function Ju(e){if(e.length===0)throw new Error("mean requires at least one data point");return Nu(e)/e.length}var ua={min:Bu,max:Eo,mean:Ju,sum:Nu};function Ns(e,i){return e.map(function(r){return r[i]*1})}function Qo(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function gu(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Qo(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Qo(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Hc(e){var i=Wc();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function Wc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Af(e,i){if(Array.isArray(i))return i}var ru=function(e){(0,Pr.Z)(r,e);var i=Hc(r);function r(n,a){var s;return(0,dt.Z)(this,r),s=i.call(this),(0,A.Z)((0,ue.Z)(s),"data",void 0),(0,A.Z)((0,ue.Z)(s),"extent",void 0),(0,A.Z)((0,ue.Z)(s),"hooks",{init:new Da}),(0,A.Z)((0,ue.Z)(s),"parser",{type:"geojson"}),(0,A.Z)((0,ue.Z)(s),"transforms",[]),(0,A.Z)((0,ue.Z)(s),"cluster",!1),(0,A.Z)((0,ue.Z)(s),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,A.Z)((0,ue.Z)(s),"mapService",void 0),(0,A.Z)((0,ue.Z)(s),"invalidExtent",!1),(0,A.Z)((0,ue.Z)(s),"dataArrayChanged",!1),(0,A.Z)((0,ue.Z)(s),"originData",void 0),(0,A.Z)((0,ue.Z)(s),"rawData",void 0),(0,A.Z)((0,ue.Z)(s),"cfg",{}),(0,A.Z)((0,ue.Z)(s),"clusterIndex",void 0),s.originData=n,s.initCfg(a),s.hooks.init.tap("parser",function(){s.excuteParser()}),s.hooks.init.tap("cluster",function(){s.initCluster()}),s.hooks.init.tap("transform",function(){s.executeTrans()}),s.init(),s}return(0,Mt.Z)(r,[{key:"setData",value:function(a,s){this.originData=a,this.dataArrayChanged=!1,this.initCfg(s),this.init(),this.emit("update")}},{key:"getClusters",value:function(a){return this.clusterIndex.getClusters(this.caculClusterExtent(2),a)}},{key:"getClustersLeaves",value:function(a){return this.clusterIndex.getLeaves(a,Infinity)}},{key:"updateClusterData",value:function(a){var s=this,p=this.clusterOptions,v=p.method,g=v===void 0?"sum":v,x=p.field,C=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(a));this.clusterOptions.zoom=a,C.forEach(function(T){T.id||(T.properties.point_count=1)}),(x||L()(g))&&(C=C.map(function(T){var R=T.id;if(R){var F=s.clusterIndex.getLeaves(R,Infinity),j=F.map(function(be){return be.properties}),Y;if(w()(g)&&x){var J=Ns(j,x);Y=ua[g](J)}L()(g)&&(Y=g(j)),T.properties.stat=Y}else T.properties.point_count=1;return T})),this.data=de("geojson")({type:"FeatureCollection",features:C}),this.executeTrans()}},{key:"getFeatureById",value:function(a){var s=this.parser.type,p=s===void 0?"geojson":s;if(p==="geojson"&&!this.cluster){var v=a<this.originData.features.length?this.originData.features[a]:"null",g=H()(v);if(this.transforms.length!==0||this.dataArrayChanged){var x=this.data.dataArray.find(function(C){return C._id===a});g.properties=x}return g}else return a<this.data.dataArray.length?this.data.dataArray[a]:"null"}},{key:"updateFeaturePropertiesById",value:function(a,s){this.data.dataArray=this.data.dataArray.map(function(p){return p._id===a?gu(gu({},p),s):p}),this.dataArrayChanged=!0,this.emit("update")}},{key:"getFeatureId",value:function(a,s){var p=this.data.dataArray.find(function(v){return v[a]===s});return p==null?void 0:p._id}},{key:"destroy",value:function(){this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null}},{key:"caculClusterExtent",value:function(a){var s=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(s=Rn(Zc(this.extent),a)),s[0].concat(s[1])}},{key:"initCfg",value:function(a){this.cfg=d()(this.cfg,a,Af);var s=this.cfg;s&&(s.parser&&(this.parser=s.parser),s.transforms&&(this.transforms=s.transforms),this.cluster=s.cluster||!1,s.clusterOptions&&(this.cluster=!0,this.clusterOptions=gu(gu({},this.clusterOptions),s.clusterOptions)))}},{key:"excuteParser",value:function(){var a=this.parser,s=a.type||"geojson";if(s==="imagetile"){this.data={tileurl:this.originData,dataArray:[]};return}var p=de(s);this.data=p(this.originData,a),this.extent=Xf(this.data.dataArray),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3]}},{key:"executeTrans",value:function(){var a=this,s=this.transforms;s.forEach(function(p){var v=p.type,g=_e(v)(a.data,p);Object.assign(a.data,g)})}},{key:"initCluster",value:function(){if(!!this.cluster){var a=this.clusterOptions||{};this.clusterIndex=yl(this.data,a)}}},{key:"init",value:function(){this.hooks.init.call(this)}}]),r}(Es.EventEmitter);function hc(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.filter(r)),e}function nu(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_l(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function _l(e,i){if(!!e){if(typeof e=="string")return dc(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return dc(e,i)}}function dc(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var iu=6378e3;function Fo(e,i){var r=e.dataArray,n=i.size,a=n===void 0?10:n,s=a/(2*Math.PI*iu)*(256<<20)/2,p=Xc(r,a),v=p.gridHash,g=p.gridOffset,x=lh(v,g,i);return{yOffset:s,xOffset:s,radius:s,type:"grid",dataArray:x}}function Xc(e,i){var r=Infinity,n=-Infinity,a,s=nu(e),p;try{for(s.s();!(p=s.n()).done;){var v=p.value;a=v.coordinates[1],Number.isFinite(a)&&(r=a<r?a:r,n=a>n?a:n)}}catch(Ye){s.e(Ye)}finally{s.f()}var g=(r+n)/2,x=Kf(i,g);if(x.xOffset<=0||x.yOffset<=0)return{gridHash:{},gridOffset:x};var C={},T=nu(e),R;try{for(T.s();!(R=T.n()).done;){var F=R.value,j=F.coordinates[1],Y=F.coordinates[0];if(Number.isFinite(j)&&Number.isFinite(Y)){var J=Math.floor((j+90)/x.yOffset),be=Math.floor((Y+180)/x.xOffset),Be="".concat(J,"-").concat(be);C[Be]=C[Be]||{count:0,points:[]},C[Be].count+=1,C[Be].points.push(F)}}}catch(Ye){T.e(Ye)}finally{T.f()}return{gridHash:C,gridOffset:x}}function Kf(e,i){var r=Ip(e),n=$f(i,e);return{yOffset:r,xOffset:n}}function Ip(e){return e/iu*(180/Math.PI)}function $f(e,i){return i/iu*(180/Math.PI)/Math.cos(e*Math.PI/180)}function lh(e,i,r){return Object.keys(e).reduce(function(n,a,s){var p=a.split("-"),v=parseInt(p[0],10),g=parseInt(p[1],10),x={};if(r.field&&r.method){var C=Zl(e[a].points,r.field);x[r.method]=pc[r.method](C)}return Object.assign(x,{_id:s,coordinates:ns([-180+i.xOffset*(g+.5),-90+i.yOffset*(v+.5)]),rawData:e[a].points,count:e[a].count}),n.push(x),n},[])}var vc=Math.PI/3,mc=[0,vc,2*vc,3*vc,4*vc,5*vc];function wf(e){return e[0]}function Op(e){return e[1]}function Wh(){var e=0,i=0,r=1,n=1,a=wf,s=Op,p,v,g;function x(T){var R={},F=[],j,Y=T.length;for(j=0;j<Y;++j)if(!(isNaN(be=+a.call(null,J=T[j],j,T))||isNaN(Be=+s.call(null,J,j,T)))){var J,be,Be,Ye=Math.round(Be=Be/g),tt=Math.round(be=be/v-(Ye&1)/2),Et=Be-Ye;if(Math.abs(Et)*3>1){var wt=be-tt,Yt=tt+(be<tt?-1:1)/2,ar=Ye+(Be<Ye?-1:1),Mr=be-Yt,Qr=Be-ar;wt*wt+Et*Et>Mr*Mr+Qr*Qr&&(tt=Yt+(Ye&1?1:-1)/2,Ye=ar)}var br=tt+"-"+Ye,vn=R[br];vn?vn.push(J):(F.push(vn=R[br]=[J]),vn.x=(tt+(Ye&1)/2)*v,vn.y=Ye*g)}return F}function C(T){var R=0,F=0;return mc.map(function(j){var Y=Math.sin(j)*T,J=-Math.cos(j)*T,be=Y-R,Be=J-F;return R=Y,F=J,[be,Be]})}return x.hexagon=function(T){return"m"+C(T==null?p:+T).join("l")+"z"},x.centers=function(){for(var T=[],R=Math.round(i/g),F=Math.round(e/v),j=R*g;j<n+p;j+=g,++R)for(var Y=F*v+(R&1)*v/2;Y<r+v/2;Y+=v)T.push([Y,j]);return T},x.mesh=function(){var T=C(p).slice(0,4).join("l");return x.centers().map(function(R){return"M"+R+"m"+T}).join("")},x.x=function(T){return arguments.length?(a=T,x):a},x.y=function(T){return arguments.length?(s=T,x):s},x.radius=function(T){return arguments.length?(p=+T,v=p*2*Math.sin(vc),g=p*1.5,x):p},x.size=function(T){return arguments.length?(e=i=0,r=+T[0],n=+T[1],x):[r-e,n-i]},x.extent=function(T){return arguments.length?(e=+T[0][0],i=+T[0][1],r=+T[1][0],n=+T[1][1],x):[[e,i],[r,n]]},x.radius(1)}function xl(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Yc(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?xl(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xl(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Xh=6378e3;function wd(e,i){var r=e.dataArray,n=i.size,a=n===void 0?10:n,s=i.method,p=s===void 0?"sum":s,v=a/(2*Math.PI*Xh)*(256<<20)/2,g=r.map(function(R){var F=ns(R.coordinates),j=(0,gn.Z)(F,2),Y=j[0],J=j[1];return Yc(Yc({},R),{},{coordinates:[Y,J]})}),x=Wh().radius(v).x(function(R){return R.coordinates[0]}).y(function(R){return R.coordinates[1]}),C=x(g),T={dataArray:C.map(function(R,F){var j;if(i.field&&p){var Y=Zl(R,i.field);R[p]=pc[p](Y)}return j={},(0,A.Z)(j,i.method,R[p]),(0,A.Z)(j,"count",R.length),(0,A.Z)(j,"rawData",R),(0,A.Z)(j,"coordinates",[R.x,R.y]),(0,A.Z)(j,"_id",F),j}),radius:v,xOffset:v,yOffset:v,type:"hexagon"};return T}function qc(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Rp(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?qc(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):qc(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Td(e,i){var r=i.sourceField,n=i.targetField,a=i.data,s={};return a.forEach(function(p){s[p[r]]=p}),e.dataArray=e.dataArray.map(function(p){var v=p[n];return Rp(Rp({},p),s[v])}),e}function Md(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.map(r)),e}ze("geojson",Wr),ze("image",jl),ze("csv",Gr),ze("json",Dt),ze("raster",f),et("cluster",yl),et("filter",hc),et("join",Td),et("map",Md),et("grid",Fo),et("hexagon",wd);var Yh=gr,ch=Yn,fh=ru,Qf=Q(28660),Xr=Q(86700),Mo=Q(84879),Gt={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},qh=Q(31745),kp=Q.n(qh);function Jf(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Tf(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Jf(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Jf(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ep(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=tp(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function tp(e,i){if(!!e){if(typeof e=="string")return Hl(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Hl(e,i)}}function Hl(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var bl=30;function rp(e){var i=e.characterSet,r=e.getFontWidth,n=e.fontHeight,a=e.buffer,s=e.maxCanvasWidth,p=e.mapping,v=p===void 0?{}:p,g=e.xOffset,x=g===void 0?0:g,C=e.yOffset,T=C===void 0?0:C,R=0,F=x;Array.from(i).forEach(function(Y,J){if(!v[Y]){var be=r(Y,J);F+bl>s&&(F=0,R++),v[Y]={x:F,y:T+R*bl,width:bl,height:bl,advance:be},F+=bl}});var j=n+a*2;return{mapping:v,xOffset:F,yOffset:T+R*j,canvasHeight:np(T+(R+1)*j)}}function Lp(e,i,r){var n=0,a=0,s=0,p=[],v={},g=ep(e),x;try{for(g.s();!(x=g.n()).done;){var C=x.value;if(!v[C.id]){var T=C.size;n+T+i>r&&(Wl(v,p,a),n=0,a=s+a+i,s=0,p=[]),p.push({icon:C,xOffset:n}),n=n+T+i,s=Math.max(s,T)}}}catch(F){g.e(F)}finally{g.f()}p.length>0&&Wl(v,p,a);var R=np(s+a+i);return{mapping:v,canvasHeight:R}}function Wl(e,i,r){var n=ep(i),a;try{for(n.s();!(a=n.n()).done;){var s=a.value,p=s.icon,v=s.xOffset;e[p.id]=Tf(Tf({},p),{},{x:v,y:r,image:p.image,width:p.width,height:p.height})}}catch(g){n.e(g)}finally{n.f()}}function np(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var Mf,ip;function Kc(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Pf(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function Pf(e,i){if(!!e){if(typeof e=="string")return zs(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return zs(e,i)}}function zs(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function If(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function $c(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?If(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):If(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var ap=Bp(),op="sans-serif",Dp="normal",El=24,Qc=3,Kh=.25,Fp=8,ph=1024,Pd=1,$h=1,Eu=3,Id=null;function Bp(){for(var e=[],i=32;i<128;i++)e.push(String.fromCharCode(i));return e}function Jc(e,i,r,n){e.font="".concat(n," ").concat(r,"px ").concat(i),e.fillStyle="black",e.textBaseline="middle"}function zu(e,i){for(var r=0;r<e.length;r++)i.data[4*r+3]=e[r]}var Qh=(Mf=(0,Xr.b2)(),Mf(ip=function(){function e(){(0,dt.Z)(this,e),(0,A.Z)(this,"fontAtlas",void 0),(0,A.Z)(this,"iconFontMap",void 0),(0,A.Z)(this,"iconFontGlyphs",{}),(0,A.Z)(this,"fontOptions",void 0),(0,A.Z)(this,"key",void 0),(0,A.Z)(this,"cache",new La(Eu))}return(0,Mt.Z)(e,[{key:"scale",get:function(){return $h}},{key:"canvas",get:function(){var r=this.cache.get(this.key);return r&&r.data}},{key:"mapping",get:function(){var r=this.cache.get(this.key);return r&&r.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:op,fontWeight:Dp,characterSet:ap,fontSize:El,buffer:Qc,sdf:!0,cutoff:Kh,radius:Fp,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(r){var n=this;r.forEach(function(a){n.iconFontGlyphs[a.name]=a.unicode})}},{key:"addIconFont",value:function(r,n){this.iconFontMap.set(r,n)}},{key:"getIconFontKey",value:function(r){return this.iconFontMap.get(r)||r}},{key:"getGlyph",value:function(r){return this.iconFontGlyphs[r]?String.fromCharCode(parseInt(this.iconFontGlyphs[r],16)):""}},{key:"setFontOptions",value:function(r){this.fontOptions=$c($c({},this.fontOptions),r),this.key=this.getKey();var n=this.getNewChars(this.key,this.fontOptions.characterSet),a=this.cache.get(this.key);if(!(a&&n.length===0)){var s=this.generateFontAtlas(this.key,n,a);this.fontAtlas=s,this.cache.set(this.key,s)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(r,n,a){var s=this.fontOptions,p=s.fontFamily,v=s.fontWeight,g=s.fontSize,x=s.buffer,C=s.sdf,T=s.radius,R=s.cutoff,F=s.iconfont,j=a&&a.data;j||(j=ca.document.createElement("canvas"),j.width=ph);var Y=j.getContext("2d");Jc(Y,p,g,v);var J=rp($c({getFontWidth:function(ks){return Y.measureText(ks).width},fontHeight:g*$h,buffer:x,characterSet:n,maxCanvasWidth:ph},a&&{mapping:a.mapping,xOffset:a.xOffset,yOffset:a.yOffset})),be=J.mapping,Be=J.canvasHeight,Ye=J.xOffset,tt=J.yOffset,Et=Y.getImageData(0,0,j.width,j.height);if(j.height=Be,Y.putImageData(Et,0,0),Jc(Y,p,g,v),C){var wt=new(kp())(g,x,T,R,p,v),Yt=Y.getImageData(0,0,wt.size,wt.size),ar=Kc(n),Mr;try{for(ar.s();!(Mr=ar.n()).done;){var Qr=Mr.value;if(F){var br=String.fromCharCode(parseInt(Qr.replace("&#x","").replace(";",""),16)),vn=wt.draw(br);zu(vn,Yt)}else zu(wt.draw(Qr),Yt);Y.putImageData(Yt,be[Qr].x,be[Qr].y)}}catch(Yo){ar.e(Yo)}finally{ar.f()}}else{var Pn=Kc(n),$n;try{for(Pn.s();!($n=Pn.n()).done;){var Ba=$n.value;Y.fillText(Ba,be[Ba].x,be[Ba].y+g*Pd)}}catch(Yo){Pn.e(Yo)}finally{Pn.f()}}return{xOffset:Ye,yOffset:tt,mapping:be,data:j,width:j.width,height:j.height}}},{key:"getKey",value:function(){return"key";var r,n,a,s,p,v,g,x}},{key:"getNewChars",value:function(r,n){var a=this.cache.get(r);if(!a)return n;var s=[],p=a.mapping,v=new Set(Object.keys(p)),g=new Set(n);return g.forEach(function(x){v.has(x)||s.push(x)}),s}}]),e}())||ip),Jh,el;function Of(e){var i=ef();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function ef(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gc=3,hh=1024,tf=64,Np=(Jh=(0,Xr.b2)(),Jh(el=function(e){(0,Pr.Z)(r,e);var i=Of(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"canvasHeight",128),(0,A.Z)((0,ue.Z)(n),"texture",void 0),(0,A.Z)((0,ue.Z)(n),"canvas",void 0),(0,A.Z)((0,ue.Z)(n),"iconData",void 0),(0,A.Z)((0,ue.Z)(n),"iconMap",void 0),(0,A.Z)((0,ue.Z)(n),"ctx",void 0),(0,A.Z)((0,ue.Z)(n),"loadingImageCount",0),n}return(0,Mt.Z)(r,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=ca.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(a,s){var p=this,v=new Image;if(this.loadingImageCount++,this.hasImage(a))throw new Error("Image Id already exists");this.iconData.push({id:a,size:tf}),this.updateIconMap(),this.loadImage(s).then(function(g){v=g;var x=p.iconData.find(function(C){return C.id===a});x&&(x.image=v,x.width=v.width,x.height=v.height),p.update()})}},{key:"addImageMini",value:function(a,s,p){var v=this,g=p.getSceneConfig().canvas,x=g.createImage();if(this.loadingImageCount++,this.hasImage(a))throw new Error("Image Id already exists");this.iconData.push({id:a,size:tf}),this.updateIconMap(),this.loadImageMini(s,g).then(function(C){x=C;var T=v.iconData.find(function(R){return R.id===a});T&&(T.image=x,T.width=x.width,T.height=x.height),v.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(a){return this.iconMap.hasOwnProperty(a)}},{key:"removeImage",value:function(a){this.hasImage(a)&&(this.iconData=this.iconData.filter(function(s){return s.id!==a}),delete this.iconMap[a],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(a){return new Promise(function(s,p){if(a instanceof HTMLImageElement){s(a);return}var v=new Image;v.crossOrigin="anonymous",v.onload=function(){s(v)},v.onerror=function(){p(new Error("Could not load image at "+a))},v.src=a instanceof File?URL.createObjectURL(a):a})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var a=this;this.canvas.width=hh,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(s){var p=a.iconMap[s],v=p.x,g=p.y,x=p.image,C=p.width,T=C===void 0?64:C,R=p.height,F=R===void 0?64:R,j=Math.max(T,F),Y=j/tf,J=F/Y,be=T/Y;x&&a.ctx.drawImage(x,v+(tf-be)/2,g+(tf-J)/2,be,J)})}},{key:"updateIconMap",value:function(){var a=Lp(this.iconData,gc,hh),s=a.mapping,p=a.canvasHeight;this.iconMap=s,this.canvasHeight=p}},{key:"loadImageMini",value:function(a,s){return new Promise(function(p,v){var g=s.createImage();g.crossOrigin="anonymous",g.onload=function(){p(g)},g.onerror=function(){v(new Error("Could not load image at "+a))},g.src=a})}}]),r}(Es.EventEmitter))||el),Ia=Q(49685);function Yi(){var e=new Ia.WT(16);return Ia.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function yc(e){var i=new Ia.WT(16);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function Po(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function Us(e,i,r,n,a,s,p,v,g,x,C,T,R,F,j,Y){var J=new Ia.WT(16);return J[0]=e,J[1]=i,J[2]=r,J[3]=n,J[4]=a,J[5]=s,J[6]=p,J[7]=v,J[8]=g,J[9]=x,J[10]=C,J[11]=T,J[12]=R,J[13]=F,J[14]=j,J[15]=Y,J}function ed(e,i,r,n,a,s,p,v,g,x,C,T,R,F,j,Y,J){return e[0]=i,e[1]=r,e[2]=n,e[3]=a,e[4]=s,e[5]=p,e[6]=v,e[7]=g,e[8]=x,e[9]=C,e[10]=T,e[11]=R,e[12]=F,e[13]=j,e[14]=Y,e[15]=J,e}function dh(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Od(e,i){if(e===i){var r=i[1],n=i[2],a=i[3],s=i[6],p=i[7],v=i[11];e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=r,e[6]=i[9],e[7]=i[13],e[8]=n,e[9]=s,e[11]=i[14],e[12]=a,e[13]=p,e[14]=v}else e[0]=i[0],e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=i[1],e[5]=i[5],e[6]=i[9],e[7]=i[13],e[8]=i[2],e[9]=i[6],e[10]=i[10],e[11]=i[14],e[12]=i[3],e[13]=i[7],e[14]=i[11],e[15]=i[15];return e}function zp(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],p=i[4],v=i[5],g=i[6],x=i[7],C=i[8],T=i[9],R=i[10],F=i[11],j=i[12],Y=i[13],J=i[14],be=i[15],Be=r*v-n*p,Ye=r*g-a*p,tt=r*x-s*p,Et=n*g-a*v,wt=n*x-s*v,Yt=a*x-s*g,ar=C*Y-T*j,Mr=C*J-R*j,Qr=C*be-F*j,br=T*J-R*Y,vn=T*be-F*Y,Pn=R*be-F*J,$n=Be*Pn-Ye*vn+tt*br+Et*Qr-wt*Mr+Yt*ar;return $n?($n=1/$n,e[0]=(v*Pn-g*vn+x*br)*$n,e[1]=(a*vn-n*Pn-s*br)*$n,e[2]=(Y*Yt-J*wt+be*Et)*$n,e[3]=(R*wt-T*Yt-F*Et)*$n,e[4]=(g*Qr-p*Pn-x*Mr)*$n,e[5]=(r*Pn-a*Qr+s*Mr)*$n,e[6]=(J*tt-j*Yt-be*Ye)*$n,e[7]=(C*Yt-R*tt+F*Ye)*$n,e[8]=(p*vn-v*Qr+x*ar)*$n,e[9]=(n*Qr-r*vn-s*ar)*$n,e[10]=(j*wt-Y*tt+be*Be)*$n,e[11]=(T*tt-C*wt-F*Be)*$n,e[12]=(v*Mr-p*br-g*ar)*$n,e[13]=(r*br-n*Mr+a*ar)*$n,e[14]=(Y*Ye-j*Et-J*Be)*$n,e[15]=(C*Et-T*Ye+R*Be)*$n,e):null}function Rd(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],p=i[4],v=i[5],g=i[6],x=i[7],C=i[8],T=i[9],R=i[10],F=i[11],j=i[12],Y=i[13],J=i[14],be=i[15];return e[0]=v*(R*be-F*J)-T*(g*be-x*J)+Y*(g*F-x*R),e[1]=-(n*(R*be-F*J)-T*(a*be-s*J)+Y*(a*F-s*R)),e[2]=n*(g*be-x*J)-v*(a*be-s*J)+Y*(a*x-s*g),e[3]=-(n*(g*F-x*R)-v*(a*F-s*R)+T*(a*x-s*g)),e[4]=-(p*(R*be-F*J)-C*(g*be-x*J)+j*(g*F-x*R)),e[5]=r*(R*be-F*J)-C*(a*be-s*J)+j*(a*F-s*R),e[6]=-(r*(g*be-x*J)-p*(a*be-s*J)+j*(a*x-s*g)),e[7]=r*(g*F-x*R)-p*(a*F-s*R)+C*(a*x-s*g),e[8]=p*(T*be-F*Y)-C*(v*be-x*Y)+j*(v*F-x*T),e[9]=-(r*(T*be-F*Y)-C*(n*be-s*Y)+j*(n*F-s*T)),e[10]=r*(v*be-x*Y)-p*(n*be-s*Y)+j*(n*x-s*v),e[11]=-(r*(v*F-x*T)-p*(n*F-s*T)+C*(n*x-s*v)),e[12]=-(p*(T*J-R*Y)-C*(v*J-g*Y)+j*(v*R-g*T)),e[13]=r*(T*J-R*Y)-C*(n*J-a*Y)+j*(n*R-a*T),e[14]=-(r*(v*J-g*Y)-p*(n*J-a*Y)+j*(n*g-a*v)),e[15]=r*(v*R-g*T)-p*(n*R-a*T)+C*(n*g-a*v),e}function vh(e){var i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],p=e[5],v=e[6],g=e[7],x=e[8],C=e[9],T=e[10],R=e[11],F=e[12],j=e[13],Y=e[14],J=e[15],be=i*p-r*s,Be=i*v-n*s,Ye=i*g-a*s,tt=r*v-n*p,Et=r*g-a*p,wt=n*g-a*v,Yt=x*j-C*F,ar=x*Y-T*F,Mr=x*J-R*F,Qr=C*Y-T*j,br=C*J-R*j,vn=T*J-R*Y;return be*vn-Be*br+Ye*Qr+tt*Mr-Et*ar+wt*Yt}function Sl(e,i,r){var n=i[0],a=i[1],s=i[2],p=i[3],v=i[4],g=i[5],x=i[6],C=i[7],T=i[8],R=i[9],F=i[10],j=i[11],Y=i[12],J=i[13],be=i[14],Be=i[15],Ye=r[0],tt=r[1],Et=r[2],wt=r[3];return e[0]=Ye*n+tt*v+Et*T+wt*Y,e[1]=Ye*a+tt*g+Et*R+wt*J,e[2]=Ye*s+tt*x+Et*F+wt*be,e[3]=Ye*p+tt*C+Et*j+wt*Be,Ye=r[4],tt=r[5],Et=r[6],wt=r[7],e[4]=Ye*n+tt*v+Et*T+wt*Y,e[5]=Ye*a+tt*g+Et*R+wt*J,e[6]=Ye*s+tt*x+Et*F+wt*be,e[7]=Ye*p+tt*C+Et*j+wt*Be,Ye=r[8],tt=r[9],Et=r[10],wt=r[11],e[8]=Ye*n+tt*v+Et*T+wt*Y,e[9]=Ye*a+tt*g+Et*R+wt*J,e[10]=Ye*s+tt*x+Et*F+wt*be,e[11]=Ye*p+tt*C+Et*j+wt*Be,Ye=r[12],tt=r[13],Et=r[14],wt=r[15],e[12]=Ye*n+tt*v+Et*T+wt*Y,e[13]=Ye*a+tt*g+Et*R+wt*J,e[14]=Ye*s+tt*x+Et*F+wt*be,e[15]=Ye*p+tt*C+Et*j+wt*Be,e}function sp(e,i,r){var n=r[0],a=r[1],s=r[2],p,v,g,x,C,T,R,F,j,Y,J,be;return i===e?(e[12]=i[0]*n+i[4]*a+i[8]*s+i[12],e[13]=i[1]*n+i[5]*a+i[9]*s+i[13],e[14]=i[2]*n+i[6]*a+i[10]*s+i[14],e[15]=i[3]*n+i[7]*a+i[11]*s+i[15]):(p=i[0],v=i[1],g=i[2],x=i[3],C=i[4],T=i[5],R=i[6],F=i[7],j=i[8],Y=i[9],J=i[10],be=i[11],e[0]=p,e[1]=v,e[2]=g,e[3]=x,e[4]=C,e[5]=T,e[6]=R,e[7]=F,e[8]=j,e[9]=Y,e[10]=J,e[11]=be,e[12]=p*n+C*a+j*s+i[12],e[13]=v*n+T*a+Y*s+i[13],e[14]=g*n+R*a+J*s+i[14],e[15]=x*n+F*a+be*s+i[15]),e}function Xl(e,i,r){var n=r[0],a=r[1],s=r[2];return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=i[3]*n,e[4]=i[4]*a,e[5]=i[5]*a,e[6]=i[6]*a,e[7]=i[7]*a,e[8]=i[8]*s,e[9]=i[9]*s,e[10]=i[10]*s,e[11]=i[11]*s,e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function td(e,i,r,n){var a=n[0],s=n[1],p=n[2],v=Math.hypot(a,s,p),g,x,C,T,R,F,j,Y,J,be,Be,Ye,tt,Et,wt,Yt,ar,Mr,Qr,br,vn,Pn,$n,Ba;return v<Ia.Ib?null:(v=1/v,a*=v,s*=v,p*=v,g=Math.sin(r),x=Math.cos(r),C=1-x,T=i[0],R=i[1],F=i[2],j=i[3],Y=i[4],J=i[5],be=i[6],Be=i[7],Ye=i[8],tt=i[9],Et=i[10],wt=i[11],Yt=a*a*C+x,ar=s*a*C+p*g,Mr=p*a*C-s*g,Qr=a*s*C-p*g,br=s*s*C+x,vn=p*s*C+a*g,Pn=a*p*C+s*g,$n=s*p*C-a*g,Ba=p*p*C+x,e[0]=T*Yt+Y*ar+Ye*Mr,e[1]=R*Yt+J*ar+tt*Mr,e[2]=F*Yt+be*ar+Et*Mr,e[3]=j*Yt+Be*ar+wt*Mr,e[4]=T*Qr+Y*br+Ye*vn,e[5]=R*Qr+J*br+tt*vn,e[6]=F*Qr+be*br+Et*vn,e[7]=j*Qr+Be*br+wt*vn,e[8]=T*Pn+Y*$n+Ye*Ba,e[9]=R*Pn+J*$n+tt*Ba,e[10]=F*Pn+be*$n+Et*Ba,e[11]=j*Pn+Be*$n+wt*Ba,i!==e&&(e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e)}function up(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[4],p=i[5],v=i[6],g=i[7],x=i[8],C=i[9],T=i[10],R=i[11];return i!==e&&(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[4]=s*a+x*n,e[5]=p*a+C*n,e[6]=v*a+T*n,e[7]=g*a+R*n,e[8]=x*a-s*n,e[9]=C*a-p*n,e[10]=T*a-v*n,e[11]=R*a-g*n,e}function rf(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[0],p=i[1],v=i[2],g=i[3],x=i[8],C=i[9],T=i[10],R=i[11];return i!==e&&(e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=s*a-x*n,e[1]=p*a-C*n,e[2]=v*a-T*n,e[3]=g*a-R*n,e[8]=s*n+x*a,e[9]=p*n+C*a,e[10]=v*n+T*a,e[11]=g*n+R*a,e}function ba(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[0],p=i[1],v=i[2],g=i[3],x=i[4],C=i[5],T=i[6],R=i[7];return i!==e&&(e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=s*a+x*n,e[1]=p*a+C*n,e[2]=v*a+T*n,e[3]=g*a+R*n,e[4]=x*a-s*n,e[5]=C*a-p*n,e[6]=T*a-v*n,e[7]=R*a-g*n,e}function Up(e,i){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function Yl(e,i){return e[0]=i[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=i[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Rf(e,i,r){var n=r[0],a=r[1],s=r[2],p=Math.hypot(n,a,s),v,g,x;return p<Ia.Ib?null:(p=1/p,n*=p,a*=p,s*=p,v=Math.sin(i),g=Math.cos(i),x=1-g,e[0]=n*n*x+g,e[1]=a*n*x+s*v,e[2]=s*n*x-a*v,e[3]=0,e[4]=n*a*x-s*v,e[5]=a*a*x+g,e[6]=s*a*x+n*v,e[7]=0,e[8]=n*s*x+a*v,e[9]=a*s*x-n*v,e[10]=s*s*x+g,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function mh(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function kd(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function N(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ce(e,i,r){var n=i[0],a=i[1],s=i[2],p=i[3],v=n+n,g=a+a,x=s+s,C=n*v,T=n*g,R=n*x,F=a*g,j=a*x,Y=s*x,J=p*v,be=p*g,Be=p*x;return e[0]=1-(F+Y),e[1]=T+Be,e[2]=R-be,e[3]=0,e[4]=T-Be,e[5]=1-(C+Y),e[6]=j+J,e[7]=0,e[8]=R+be,e[9]=j-J,e[10]=1-(C+F),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Fe(e,i){var r=new Ia.WT(3),n=-i[0],a=-i[1],s=-i[2],p=i[3],v=i[4],g=i[5],x=i[6],C=i[7],T=n*n+a*a+s*s+p*p;return T>0?(r[0]=(v*p+C*n+g*s-x*a)*2/T,r[1]=(g*p+C*a+x*n-v*s)*2/T,r[2]=(x*p+C*s+v*a-g*n)*2/T):(r[0]=(v*p+C*n+g*s-x*a)*2,r[1]=(g*p+C*a+x*n-v*s)*2,r[2]=(x*p+C*s+v*a-g*n)*2),ce(e,i,r),e}function Lt(e,i){return e[0]=i[12],e[1]=i[13],e[2]=i[14],e}function rr(e,i){var r=i[0],n=i[1],a=i[2],s=i[4],p=i[5],v=i[6],g=i[8],x=i[9],C=i[10];return e[0]=Math.hypot(r,n,a),e[1]=Math.hypot(s,p,v),e[2]=Math.hypot(g,x,C),e}function Ot(e,i){var r=new Ia.WT(3);rr(r,i);var n=1/r[0],a=1/r[1],s=1/r[2],p=i[0]*n,v=i[1]*a,g=i[2]*s,x=i[4]*n,C=i[5]*a,T=i[6]*s,R=i[8]*n,F=i[9]*a,j=i[10]*s,Y=p+C+j,J=0;return Y>0?(J=Math.sqrt(Y+1)*2,e[3]=.25*J,e[0]=(T-F)/J,e[1]=(R-g)/J,e[2]=(v-x)/J):p>C&&p>j?(J=Math.sqrt(1+p-C-j)*2,e[3]=(T-F)/J,e[0]=.25*J,e[1]=(v+x)/J,e[2]=(R+g)/J):C>j?(J=Math.sqrt(1+C-p-j)*2,e[3]=(R-g)/J,e[0]=(v+x)/J,e[1]=.25*J,e[2]=(T+F)/J):(J=Math.sqrt(1+j-p-C)*2,e[3]=(v-x)/J,e[0]=(R+g)/J,e[1]=(T+F)/J,e[2]=.25*J),e}function Qt(e,i,r,n){var a=i[0],s=i[1],p=i[2],v=i[3],g=a+a,x=s+s,C=p+p,T=a*g,R=a*x,F=a*C,j=s*x,Y=s*C,J=p*C,be=v*g,Be=v*x,Ye=v*C,tt=n[0],Et=n[1],wt=n[2];return e[0]=(1-(j+J))*tt,e[1]=(R+Ye)*tt,e[2]=(F-Be)*tt,e[3]=0,e[4]=(R-Ye)*Et,e[5]=(1-(T+J))*Et,e[6]=(Y+be)*Et,e[7]=0,e[8]=(F+Be)*wt,e[9]=(Y-be)*wt,e[10]=(1-(T+j))*wt,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function lr(e,i,r,n,a){var s=i[0],p=i[1],v=i[2],g=i[3],x=s+s,C=p+p,T=v+v,R=s*x,F=s*C,j=s*T,Y=p*C,J=p*T,be=v*T,Be=g*x,Ye=g*C,tt=g*T,Et=n[0],wt=n[1],Yt=n[2],ar=a[0],Mr=a[1],Qr=a[2],br=(1-(Y+be))*Et,vn=(F+tt)*Et,Pn=(j-Ye)*Et,$n=(F-tt)*wt,Ba=(1-(R+be))*wt,Yo=(J+Be)*wt,ks=(j+Ye)*Yt,Ls=(J-Be)*Yt,Hs=(1-(R+Y))*Yt;return e[0]=br,e[1]=vn,e[2]=Pn,e[3]=0,e[4]=$n,e[5]=Ba,e[6]=Yo,e[7]=0,e[8]=ks,e[9]=Ls,e[10]=Hs,e[11]=0,e[12]=r[0]+ar-(br*ar+$n*Mr+ks*Qr),e[13]=r[1]+Mr-(vn*ar+Ba*Mr+Ls*Qr),e[14]=r[2]+Qr-(Pn*ar+Yo*Mr+Hs*Qr),e[15]=1,e}function dr(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],p=r+r,v=n+n,g=a+a,x=r*p,C=n*p,T=n*v,R=a*p,F=a*v,j=a*g,Y=s*p,J=s*v,be=s*g;return e[0]=1-T-j,e[1]=C+be,e[2]=R-J,e[3]=0,e[4]=C-be,e[5]=1-x-j,e[6]=F+Y,e[7]=0,e[8]=R+J,e[9]=F-Y,e[10]=1-x-T,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function _r(e,i,r,n,a,s,p){var v=1/(r-i),g=1/(a-n),x=1/(s-p);return e[0]=s*2*v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s*2*g,e[6]=0,e[7]=0,e[8]=(r+i)*v,e[9]=(a+n)*g,e[10]=(p+s)*x,e[11]=-1,e[12]=0,e[13]=0,e[14]=p*s*2*x,e[15]=0,e}function Ar(e,i,r,n,a){var s=1/Math.tan(i/2),p;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==Infinity?(p=1/(n-a),e[10]=(a+n)*p,e[14]=2*a*n*p):(e[10]=-1,e[14]=-2*n),e}var wr=Ar;function jr(e,i,r,n,a){var s=1/Math.tan(i/2),p;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==Infinity?(p=1/(n-a),e[10]=a*p,e[14]=a*n*p):(e[10]=-1,e[14]=-n),e}function mr(e,i,r,n){var a=Math.tan(i.upDegrees*Math.PI/180),s=Math.tan(i.downDegrees*Math.PI/180),p=Math.tan(i.leftDegrees*Math.PI/180),v=Math.tan(i.rightDegrees*Math.PI/180),g=2/(p+v),x=2/(a+s);return e[0]=g,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=x,e[6]=0,e[7]=0,e[8]=-((p-v)*g*.5),e[9]=(a-s)*x*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function Cr(e,i,r,n,a,s,p){var v=1/(i-r),g=1/(n-a),x=1/(s-p);return e[0]=-2*v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*g,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*x,e[11]=0,e[12]=(i+r)*v,e[13]=(a+n)*g,e[14]=(p+s)*x,e[15]=1,e}var nt=Cr;function jt(e,i,r,n,a,s,p){var v=1/(i-r),g=1/(n-a),x=1/(s-p);return e[0]=-2*v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*g,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=x,e[11]=0,e[12]=(i+r)*v,e[13]=(a+n)*g,e[14]=s*x,e[15]=1,e}function xr(e,i,r,n){var a,s,p,v,g,x,C,T,R,F,j=i[0],Y=i[1],J=i[2],be=n[0],Be=n[1],Ye=n[2],tt=r[0],Et=r[1],wt=r[2];return Math.abs(j-tt)<Ia.Ib&&Math.abs(Y-Et)<Ia.Ib&&Math.abs(J-wt)<Ia.Ib?dh(e):(C=j-tt,T=Y-Et,R=J-wt,F=1/Math.hypot(C,T,R),C*=F,T*=F,R*=F,a=Be*R-Ye*T,s=Ye*C-be*R,p=be*T-Be*C,F=Math.hypot(a,s,p),F?(F=1/F,a*=F,s*=F,p*=F):(a=0,s=0,p=0),v=T*p-R*s,g=R*a-C*p,x=C*s-T*a,F=Math.hypot(v,g,x),F?(F=1/F,v*=F,g*=F,x*=F):(v=0,g=0,x=0),e[0]=a,e[1]=v,e[2]=C,e[3]=0,e[4]=s,e[5]=g,e[6]=T,e[7]=0,e[8]=p,e[9]=x,e[10]=R,e[11]=0,e[12]=-(a*j+s*Y+p*J),e[13]=-(v*j+g*Y+x*J),e[14]=-(C*j+T*Y+R*J),e[15]=1,e)}function Nr(e,i,r,n){var a=i[0],s=i[1],p=i[2],v=n[0],g=n[1],x=n[2],C=a-r[0],T=s-r[1],R=p-r[2],F=C*C+T*T+R*R;F>0&&(F=1/Math.sqrt(F),C*=F,T*=F,R*=F);var j=g*R-x*T,Y=x*C-v*R,J=v*T-g*C;return F=j*j+Y*Y+J*J,F>0&&(F=1/Math.sqrt(F),j*=F,Y*=F,J*=F),e[0]=j,e[1]=Y,e[2]=J,e[3]=0,e[4]=T*J-R*Y,e[5]=R*j-C*J,e[6]=C*Y-T*j,e[7]=0,e[8]=C,e[9]=T,e[10]=R,e[11]=0,e[12]=a,e[13]=s,e[14]=p,e[15]=1,e}function ur(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Or(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function $r(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e[4]=i[4]+r[4],e[5]=i[5]+r[5],e[6]=i[6]+r[6],e[7]=i[7]+r[7],e[8]=i[8]+r[8],e[9]=i[9]+r[9],e[10]=i[10]+r[10],e[11]=i[11]+r[11],e[12]=i[12]+r[12],e[13]=i[13]+r[13],e[14]=i[14]+r[14],e[15]=i[15]+r[15],e}function Fn(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e[4]=i[4]-r[4],e[5]=i[5]-r[5],e[6]=i[6]-r[6],e[7]=i[7]-r[7],e[8]=i[8]-r[8],e[9]=i[9]-r[9],e[10]=i[10]-r[10],e[11]=i[11]-r[11],e[12]=i[12]-r[12],e[13]=i[13]-r[13],e[14]=i[14]-r[14],e[15]=i[15]-r[15],e}function Jt(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=i[7]*r,e[8]=i[8]*r,e[9]=i[9]*r,e[10]=i[10]*r,e[11]=i[11]*r,e[12]=i[12]*r,e[13]=i[13]*r,e[14]=i[14]*r,e[15]=i[15]*r,e}function tr(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e[4]=i[4]+r[4]*n,e[5]=i[5]+r[5]*n,e[6]=i[6]+r[6]*n,e[7]=i[7]+r[7]*n,e[8]=i[8]+r[8]*n,e[9]=i[9]+r[9]*n,e[10]=i[10]+r[10]*n,e[11]=i[11]+r[11]*n,e[12]=i[12]+r[12]*n,e[13]=i[13]+r[13]*n,e[14]=i[14]+r[14]*n,e[15]=i[15]+r[15]*n,e}function xn(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]&&e[4]===i[4]&&e[5]===i[5]&&e[6]===i[6]&&e[7]===i[7]&&e[8]===i[8]&&e[9]===i[9]&&e[10]===i[10]&&e[11]===i[11]&&e[12]===i[12]&&e[13]===i[13]&&e[14]===i[14]&&e[15]===i[15]}function Vr(e,i){var r=e[0],n=e[1],a=e[2],s=e[3],p=e[4],v=e[5],g=e[6],x=e[7],C=e[8],T=e[9],R=e[10],F=e[11],j=e[12],Y=e[13],J=e[14],be=e[15],Be=i[0],Ye=i[1],tt=i[2],Et=i[3],wt=i[4],Yt=i[5],ar=i[6],Mr=i[7],Qr=i[8],br=i[9],vn=i[10],Pn=i[11],$n=i[12],Ba=i[13],Yo=i[14],ks=i[15];return Math.abs(r-Be)<=Ia.Ib*Math.max(1,Math.abs(r),Math.abs(Be))&&Math.abs(n-Ye)<=Ia.Ib*Math.max(1,Math.abs(n),Math.abs(Ye))&&Math.abs(a-tt)<=Ia.Ib*Math.max(1,Math.abs(a),Math.abs(tt))&&Math.abs(s-Et)<=Ia.Ib*Math.max(1,Math.abs(s),Math.abs(Et))&&Math.abs(p-wt)<=Ia.Ib*Math.max(1,Math.abs(p),Math.abs(wt))&&Math.abs(v-Yt)<=Ia.Ib*Math.max(1,Math.abs(v),Math.abs(Yt))&&Math.abs(g-ar)<=Ia.Ib*Math.max(1,Math.abs(g),Math.abs(ar))&&Math.abs(x-Mr)<=Ia.Ib*Math.max(1,Math.abs(x),Math.abs(Mr))&&Math.abs(C-Qr)<=Ia.Ib*Math.max(1,Math.abs(C),Math.abs(Qr))&&Math.abs(T-br)<=Ia.Ib*Math.max(1,Math.abs(T),Math.abs(br))&&Math.abs(R-vn)<=Ia.Ib*Math.max(1,Math.abs(R),Math.abs(vn))&&Math.abs(F-Pn)<=Ia.Ib*Math.max(1,Math.abs(F),Math.abs(Pn))&&Math.abs(j-$n)<=Ia.Ib*Math.max(1,Math.abs(j),Math.abs($n))&&Math.abs(Y-Ba)<=Ia.Ib*Math.max(1,Math.abs(Y),Math.abs(Ba))&&Math.abs(J-Yo)<=Ia.Ib*Math.max(1,Math.abs(J),Math.abs(Yo))&&Math.abs(be-ks)<=Ia.Ib*Math.max(1,Math.abs(be),Math.abs(ks))}var Sr=Sl,qr=Fn,Kr,mi,ii=(Kr=(0,Xr.b2)(),Kr(mi=function(){function e(){(0,dt.Z)(this,e),(0,A.Z)(this,"viewport",void 0),(0,A.Z)(this,"overridedViewProjectionMatrix",void 0),(0,A.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,A.Z)(this,"jitteredProjectionMatrix",void 0),(0,A.Z)(this,"viewMatrixInverse",void 0),(0,A.Z)(this,"cameraPosition",void 0)}return(0,Mt.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(r){this.viewport=r,this.viewMatrixInverse=Yi(),zp(this.viewMatrixInverse,r.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var r=this.viewport.getCenter(),n=(0,gn.Z)(r,2),a=n[0],s=n[1];return[a,s]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}},{key:"setViewProjectionMatrix",value:function(r){this.overridedViewProjectionMatrix=r}},{key:"jitterProjectionMatrix",value:function(r,n){var a=Up(Yi(),[r,n,0]);this.jitteredProjectionMatrix=Sl(Yi(),a,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=Sl(Yi(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||mi),Hr,rn;function Qn(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=ci(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function ci(e,i){if(!!e){if(typeof e=="string")return Bi(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Bi(e,i)}}function Bi(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var oo=(Hr=(0,Xr.b2)(),Hr(rn=function(){function e(){(0,dt.Z)(this,e),(0,A.Z)(this,"container",void 0),(0,A.Z)(this,"controlCorners",void 0),(0,A.Z)(this,"controlContainer",void 0),(0,A.Z)(this,"scene",void 0),(0,A.Z)(this,"mapsService",void 0),(0,A.Z)(this,"controls",[]),(0,A.Z)(this,"unAddControls",[])}return(0,Mt.Z)(e,[{key:"init",value:function(r,n){this.container=r.container,this.scene=n,this.mapsService=n.get(Gt.IMapService),this.initControlPos()}},{key:"addControl",value:function(r,n){var a=n.get(Gt.IMapService);a.map?(r.addTo(this.scene),this.controls.push(r)):this.unAddControls.push(r)}},{key:"getControlByName",value:function(r){return this.controls.find(function(n){return n.controlOption.name===r})}},{key:"removeControl",value:function(r){var n=this.controls.indexOf(r);return n>-1&&this.controls.splice(n,1),r.remove(),this}},{key:"addControls",value:function(){var r=this;this.unAddControls.forEach(function(n){n.addTo(r.scene),r.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var r=Qn(this.controls),n;try{for(r.s();!(n=r.n()).done;){var a=n.value;a.remove()}}catch(s){r.e(s)}finally{r.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var r=this.controlCorners={},n="l7-",a=this.controlContainer=Za("div",n+"control-container",this.container);function s(){var p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],v=p.map(function(g){return n+g}).join(" ");r[p.join("")]=Za("div",v,a)}s(["top","left"]),s(["top","right"]),s(["bottom","left"]),s(["bottom","right"]),s(["top","center"]),s(["right","center"]),s(["left","center"]),s(["bottom","center"])}},{key:"clearControlPos",value:function(){for(var r in this.controlCorners)this.controlCorners[r]&&uc(this.controlCorners[r]);this.controlContainer&&uc(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),e}())||rn),so,Di,Jo=(so=(0,Xr.b2)(),so(Di=function(){function e(){(0,dt.Z)(this,e),(0,A.Z)(this,"container",void 0),(0,A.Z)(this,"scene",void 0),(0,A.Z)(this,"mapsService",void 0),(0,A.Z)(this,"markers",[]),(0,A.Z)(this,"markerLayers",[]),(0,A.Z)(this,"unAddMarkers",[]),(0,A.Z)(this,"unAddMarkerLayers",[])}return(0,Mt.Z)(e,[{key:"addMarkerLayer",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(r),r.addTo(this.scene)):this.unAddMarkerLayers.push(r)}},{key:"removeMarkerLayer",value:function(r){r.destroy(),this.markerLayers.indexOf(r);var n=this.markerLayers.indexOf(r);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(r),r.addTo(this.scene)):this.unAddMarkers.push(r)}},{key:"addMarkers",value:function(){var r=this;this.unAddMarkers.forEach(function(n){n.addTo(r.scene),r.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var r=this;this.unAddMarkerLayers.forEach(function(n){r.markerLayers.push(n),n.addTo(r.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(r){r.remove(),this.markers.indexOf(r);var n=this.markers.indexOf(r);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(Gt.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(r){r.remove()}),this.markers=[],this.markerLayers.forEach(function(r){r.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(r){r.destroy()}}]),e}())||Di),ja,Bo,So=(ja=(0,Xr.b2)(),ja(Bo=function(){function e(){(0,dt.Z)(this,e),(0,A.Z)(this,"scene",void 0),(0,A.Z)(this,"popup",void 0),(0,A.Z)(this,"mapsService",void 0),(0,A.Z)(this,"unAddPopup",void 0)}return(0,Mt.Z)(e,[{key:"removePopup",value:function(r){r.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(r){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(r.addTo(this.scene),this.popup=r):this.unAddPopup=r}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(Gt.IMapService)}}]),e}())||Bo),Ho=Q(82492),Io=Q.n(Ho),os={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},po=os,gi,Oo;function Qi(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function No(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Qi(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Qi(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var ti={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},Ni={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},va=(gi=(0,Xr.b2)(),gi(Oo=function(){function e(){(0,dt.Z)(this,e),(0,A.Z)(this,"sceneConfigCache",{}),(0,A.Z)(this,"layerConfigCache",{})}return(0,Mt.Z)(e,[{key:"getSceneConfig",value:function(r){return this.sceneConfigCache[r]}},{key:"getSceneWarninfo",value:function(r){return po[r]}},{key:"setSceneConfig",value:function(r,n){this.sceneConfigCache[r]=No(No({},ti),n)}},{key:"getLayerConfig",value:function(r){return this.layerConfigCache[r]}},{key:"setLayerConfig",value:function(r,n,a){this.layerConfigCache[n]=No({},Io()({},this.sceneConfigCache[r],Ni,a))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||Oo);function Bn(e,i,r,n){!r||Object.defineProperty(e,i,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}function ai(e,i,r,n,a){var s={};return Object.keys(n).forEach(function(p){s[p]=n[p]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=r.slice().reverse().reduce(function(p,v){return v(e,i,p)||p},s),a&&s.initializer!==void 0&&(s.value=s.initializer?s.initializer.call(a):void 0,s.initializer=void 0),s.initializer===void 0&&(Object.defineProperty(e,i,s),s=null),s}function we(){var e=new Ia.WT(4);return Ia.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Nt(e){var i=new glMatrix.ARRAY_TYPE(4);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i}function bt(e,i,r,n){var a=new Ia.WT(4);return a[0]=e,a[1]=i,a[2]=r,a[3]=n,a}function dn(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e}function Vi(e,i,r,n,a){return e[0]=i,e[1]=r,e[2]=n,e[3]=a,e}function Ee(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e}function ie(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e}function Ve(e,i,r){return e[0]=i[0]*r[0],e[1]=i[1]*r[1],e[2]=i[2]*r[2],e[3]=i[3]*r[3],e}function ot(e,i,r){return e[0]=i[0]/r[0],e[1]=i[1]/r[1],e[2]=i[2]/r[2],e[3]=i[3]/r[3],e}function Pt(e,i){return e[0]=Math.ceil(i[0]),e[1]=Math.ceil(i[1]),e[2]=Math.ceil(i[2]),e[3]=Math.ceil(i[3]),e}function Xe(e,i){return e[0]=Math.floor(i[0]),e[1]=Math.floor(i[1]),e[2]=Math.floor(i[2]),e[3]=Math.floor(i[3]),e}function De(e,i,r){return e[0]=Math.min(i[0],r[0]),e[1]=Math.min(i[1],r[1]),e[2]=Math.min(i[2],r[2]),e[3]=Math.min(i[3],r[3]),e}function Je(e,i,r){return e[0]=Math.max(i[0],r[0]),e[1]=Math.max(i[1],r[1]),e[2]=Math.max(i[2],r[2]),e[3]=Math.max(i[3],r[3]),e}function ve(e,i){return e[0]=Math.round(i[0]),e[1]=Math.round(i[1]),e[2]=Math.round(i[2]),e[3]=Math.round(i[3]),e}function Ze(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e}function Ae(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e}function st(e,i){var r=i[0]-e[0],n=i[1]-e[1],a=i[2]-e[2],s=i[3]-e[3];return Math.hypot(r,n,a,s)}function St(e,i){var r=i[0]-e[0],n=i[1]-e[1],a=i[2]-e[2],s=i[3]-e[3];return r*r+n*n+a*a+s*s}function cr(e){var i=e[0],r=e[1],n=e[2],a=e[3];return Math.hypot(i,r,n,a)}function zr(e){var i=e[0],r=e[1],n=e[2],a=e[3];return i*i+r*r+n*n+a*a}function Ur(e,i){return e[0]=-i[0],e[1]=-i[1],e[2]=-i[2],e[3]=-i[3],e}function nn(e,i){return e[0]=1/i[0],e[1]=1/i[1],e[2]=1/i[2],e[3]=1/i[3],e}function Lr(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],p=r*r+n*n+a*a+s*s;return p>0&&(p=1/Math.sqrt(p)),e[0]=r*p,e[1]=n*p,e[2]=a*p,e[3]=s*p,e}function An(e,i){return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]+e[3]*i[3]}function un(e,i,r,n){var a=r[0]*n[1]-r[1]*n[0],s=r[0]*n[2]-r[2]*n[0],p=r[0]*n[3]-r[3]*n[0],v=r[1]*n[2]-r[2]*n[1],g=r[1]*n[3]-r[3]*n[1],x=r[2]*n[3]-r[3]*n[2],C=i[0],T=i[1],R=i[2],F=i[3];return e[0]=T*x-R*g+F*v,e[1]=-(C*x)+R*p-F*s,e[2]=C*g-T*p+F*a,e[3]=-(C*v)+T*s-R*a,e}function En(e,i,r,n){var a=i[0],s=i[1],p=i[2],v=i[3];return e[0]=a+n*(r[0]-a),e[1]=s+n*(r[1]-s),e[2]=p+n*(r[2]-p),e[3]=v+n*(r[3]-v),e}function bn(e,i){i=i||1;var r,n,a,s,p,v;do r=glMatrix.RANDOM()*2-1,n=glMatrix.RANDOM()*2-1,p=r*r+n*n;while(p>=1);do a=glMatrix.RANDOM()*2-1,s=glMatrix.RANDOM()*2-1,v=a*a+s*s;while(v>=1);var g=Math.sqrt((1-p)/v);return e[0]=i*r,e[1]=i*n,e[2]=i*a*g,e[3]=i*s*g,e}function ln(e,i,r){var n=i[0],a=i[1],s=i[2],p=i[3];return e[0]=r[0]*n+r[4]*a+r[8]*s+r[12]*p,e[1]=r[1]*n+r[5]*a+r[9]*s+r[13]*p,e[2]=r[2]*n+r[6]*a+r[10]*s+r[14]*p,e[3]=r[3]*n+r[7]*a+r[11]*s+r[15]*p,e}function Jn(e,i,r){var n=i[0],a=i[1],s=i[2],p=r[0],v=r[1],g=r[2],x=r[3],C=x*n+v*s-g*a,T=x*a+g*n-p*s,R=x*s+p*a-v*n,F=-p*n-v*a-g*s;return e[0]=C*x+F*-p+T*-g-R*-v,e[1]=T*x+F*-v+R*-p-C*-g,e[2]=R*x+F*-g+C*-v-T*-p,e[3]=i[3],e}function Ea(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function ss(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Va(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]}function ya(e,i){var r=e[0],n=e[1],a=e[2],s=e[3],p=i[0],v=i[1],g=i[2],x=i[3];return Math.abs(r-p)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(n-v)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(a-g)<=glMatrix.EPSILON*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(s-x)<=glMatrix.EPSILON*Math.max(1,Math.abs(s),Math.abs(x))}var ql=null,Zs=null,Cl=null,Uu=null,rd=null,Zu=null,nf=null,Zp=function(){var e=we();return function(i,r,n,a,s,p){var v,g;for(r||(r=4),n||(n=0),a?g=Math.min(a*r+n,i.length):g=i.length,v=n;v<g;v+=r)e[0]=i[v],e[1]=i[v+1],e[2]=i[v+2],e[3]=i[v+3],s(e,e,p),i[v]=e[0],i[v+1]=e[1],i[v+2]=e[2],i[v+3]=e[3];return i}}(),nd=Math.PI/180,Wo=512,jp=4003e4;function _c(e){var i=e.latitude,r=i===void 0?0:i,n=e.zoom,a=n===void 0?0:n,s=e.scale,p=e.highPrecision,v=p===void 0?!1:p,g=e.flipY,x=g===void 0?!1:g;s=s!==void 0?s:Math.pow(2,a);var C={},T=Wo*s,R=Math.cos(r*nd),F=T/360,j=F/R,Y=T/jp/R;if(C.pixelsPerMeter=[Y,-Y,Y],C.metersPerPixel=[1/Y,-1/Y,1/Y],C.pixelsPerDegree=[F,-j,Y],C.degreesPerPixel=[1/F,-1/j,1/Y],v){var J=nd*Math.tan(r*nd)/R,be=F*J/2,Be=T/jp*J,Ye=Be/j*Y;C.pixelsPerDegree2=[0,-be,Be],C.pixelsPerMeter2=[Ye,0,Ye],x&&(C.pixelsPerDegree2[1]=-C.pixelsPerDegree2[1],C.pixelsPerMeter2[1]=-C.pixelsPerMeter2[1])}return x&&(C.pixelsPerMeter[1]=-C.pixelsPerMeter[1],C.metersPerPixel[1]=-C.metersPerPixel[1],C.pixelsPerDegree[1]=-C.pixelsPerDegree[1],C.degreesPerPixel[1]=-C.degreesPerPixel[1]),C}var Kl;(function(e){e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2"})(Kl||(Kl={}));var xc={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},id,lp,bc,ad,Ld,yv=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],us=(id=(0,Xr.b2)(),lp=(0,Xr.f3)(Gt.ICameraService),id(bc=(ad=function(){function e(){(0,dt.Z)(this,e),(0,A.Z)(this,"needRefresh",!0),Bn(this,"cameraService",Ld,this),(0,A.Z)(this,"coordinateSystem",void 0),(0,A.Z)(this,"viewportCenter",void 0),(0,A.Z)(this,"viewportCenterProjection",void 0),(0,A.Z)(this,"pixelsPerDegree",void 0),(0,A.Z)(this,"pixelsPerDegree2",void 0),(0,A.Z)(this,"pixelsPerMeter",void 0)}return(0,Mt.Z)(e,[{key:"refresh",value:function(){var r=this.cameraService.getZoom(),n=this.cameraService.getZoomScale(),a=this.cameraService.getCenter(),s=_c({latitude:a[1],zoom:r}),p=s.pixelsPerMeter,v=s.pixelsPerDegree;this.viewportCenter=a,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=p,this.pixelsPerDegree=v,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Kl.LNGLAT||this.coordinateSystem===Kl.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Kl.LNGLAT_OFFSET?this.calculateLnglatOffset(a,r):this.coordinateSystem===Kl.P20_OFFSET&&this.calculateLnglatOffset(a,r,n,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(r){this.coordinateSystem=r}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(r,n,a,s){var p=_c({latitude:r[1],zoom:n,scale:a,flipY:s,highPrecision:!0}),v=p.pixelsPerMeter,g=p.pixelsPerDegree,x=p.pixelsPerDegree2,C=this.cameraService.getViewMatrix(),T=this.cameraService.getProjectionMatrix(),R=Sl([],T,C),F=this.cameraService.projectFlat([Math.fround(r[0]),Math.fround(r[1])],Math.pow(2,n));this.viewportCenterProjection=ln([],[F[0],F[1],0,1],R),C=this.cameraService.getViewMatrixUncentered()||C,R=Sl([],T,C),R=Sl([],R,yv),this.cameraService.setViewProjectionMatrix(R),this.pixelsPerMeter=v,this.pixelsPerDegree=g,this.pixelsPerDegree2=x}}]),e}(),Ld=ai(ad.prototype,"cameraService",[lp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ad))||bc),kf=Q(20396),Vp=Q.n(kf),t;(function(e){e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag"})(t||(t={}));var o,u,h,y,b;function S(e){var i=I();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function I(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var D={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},z=(o=(0,Xr.b2)(),u=(0,Xr.f3)(Gt.IMapService),o(h=(y=function(e){(0,Pr.Z)(r,e);var i=S(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"indragging",!1),Bn((0,ue.Z)(n),"mapService",b,(0,ue.Z)(n)),(0,A.Z)((0,ue.Z)(n),"hammertime",void 0),(0,A.Z)((0,ue.Z)(n),"lastClickTime",0),(0,A.Z)((0,ue.Z)(n),"lastClickXY",[-1,-1]),(0,A.Z)((0,ue.Z)(n),"clickTimer",void 0),(0,A.Z)((0,ue.Z)(n),"$containter",void 0),(0,A.Z)((0,ue.Z)(n),"onDrag",function(v){var g=n.interactionEvent(v);g.type=D[g.type],g.type==="dragging"?n.indragging=!0:n.indragging=!1,n.emit(t.Drag,g)}),(0,A.Z)((0,ue.Z)(n),"onHammer",function(v){v.srcEvent.stopPropagation();var g=n.interactionEvent(v);n.emit(t.Hover,g)}),(0,A.Z)((0,ue.Z)(n),"onTouch",function(v){var g=v.touches[0];n.onHover({x:g.pageX,y:g.pageY,type:"touch"})}),(0,A.Z)((0,ue.Z)(n),"onHover",function(v){var g=v.clientX,x=v.clientY,C=g,T=x,R=v.type,F=n.mapService.getMapContainer();if(F)if($i)C=C-F.left-0,T=T-F.top-0;else{var j=F.getBoundingClientRect(),Y=j.top,J=j.left;C=C-J-F.clientLeft,T=T-Y-F.clientTop}var be=n.mapService.containerToLngLat([C,T]);if(R==="click"){if(!$i&&"ontouchstart"in document.documentElement)return;n.isDoubleTap(C,T,be);return}if(R==="touch"){n.isDoubleTap(C,T,be);return}R!=="click"&&R!=="dblclick"&&n.emit(t.Hover,{x:C,y:T,lngLat:be,type:R,target:v})}),n}return(0,Mt.Z)(r,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(t.Hover)}},{key:"triggerHover",value:function(a){var s=a.x,p=a.y;this.emit(t.Hover,{x:s,y:p})}},{key:"triggerSelect",value:function(a){this.emit(t.Select,{featureId:a})}},{key:"triggerActive",value:function(a){this.emit(t.Active,{featureId:a})}},{key:"handleMiniEvent",value:function(a){this.onHover({clientX:a.touches[0].pageX,clientY:a.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var a=this.mapService.getMapContainer();if(a)if($i)ca.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var s=new(Vp()).Manager(a);s.add(new(Vp()).Tap({event:"dblclick",taps:2})),s.add(new(Vp()).Tap({event:"click"})),s.add(new(Vp()).Pan({threshold:0,pointers:0})),s.add(new(Vp()).Press({})),s.on("dblclick click",this.onHammer),s.on("panstart panmove panend pancancel",this.onDrag),a.addEventListener("mousemove",this.onHover),a.addEventListener("mousedown",this.onHover,!0),a.addEventListener("mouseup",this.onHover),a.addEventListener("contextmenu",this.onHover),this.hammertime=s}}},{key:"removeEventListenerOnMap",value:function(){if($i)ca.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var a=this.mapService.getMapContainer();a&&(a.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),a.removeEventListener("mousedown",this.onHover),a.removeEventListener("mouseup",this.onHover),a.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(a){var s=a.type,p=a.pointerType,v,g;p==="touch"?(g=Math.floor(a.pointers[0].clientY),v=Math.floor(a.pointers[0].clientX)):(g=Math.floor(a.srcEvent.y),v=Math.floor(a.srcEvent.x));var x=this.mapService.getMapContainer();if(x){var C=x.getBoundingClientRect(),T=C.top,R=C.left;v-=R,g-=T}var F=this.mapService.containerToLngLat([v,g]);return{x:v,y:g,lngLat:F,type:s,target:a.srcEvent}}},{key:"isDoubleTap",value:function(a,s,p){var v=this,g=new Date().getTime(),x="click";g-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-a)<10&&Math.abs(this.lastClickXY[1]-s)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),x="dblclick",this.emit(t.Hover,{x:a,y:s,lngLat:p,type:x})):(this.lastClickTime=g,this.lastClickXY=[a,s],this.clickTimer=setTimeout(function(){x="click",v.emit(t.Hover,{x:a,y:s,lngLat:p,type:x})},400))}}]),r}(Vl()),b=ai(y.prototype,"mapService",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y))||h),Z=Q(92137),G=Q(87757),q=Q.n(G),ne=0;function Te(e){if($i)return null;var i=e;if(typeof e=="string"&&(i=document.getElementById(e)),i){var r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,r.id="l7-scene-".concat(ne++),r.classList.add("l7-scene"),i.appendChild(r),r}return null}function Ie(e){var i,r,n=!0;return e==null||(i=e.target)===null||i===void 0||(r=i.path)===null||r===void 0||r.map(function(a){if(a!=null&&a.classList){var s;a==null||(s=a.classList)===null||s===void 0||s.forEach(function(p){(p==="l7-marker"||p==="l7-popup")&&(n=!1)})}}),n}var k;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(k||(k={}));var Ue,rt,_t,zt,Vt,ir,Tr,Dr,Dn,cn,Vn,pn,Pi;function ei(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function wn(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ei(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ei(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Zi=(Ue=(0,Xr.b2)(),rt=(0,Xr.f3)(Gt.IMapService),_t=(0,Xr.f3)(Gt.IRendererService),zt=(0,Xr.f3)(Gt.IGlobalConfigService),Vt=(0,Xr.f3)(Gt.IInteractionService),ir=(0,Xr.f3)(Gt.ILayerService),Ue(Tr=(Dr=function(){function e(){var i=this;(0,dt.Z)(this,e),Bn(this,"mapService",Dn,this),Bn(this,"rendererService",cn,this),Bn(this,"configService",Vn,this),Bn(this,"interactionService",pn,this),Bn(this,"layerService",Pi,this),(0,A.Z)(this,"pickingFBO",void 0),(0,A.Z)(this,"width",0),(0,A.Z)(this,"height",0),(0,A.Z)(this,"alreadyInPicking",!1),(0,A.Z)(this,"pickBufferScale",1),(0,A.Z)(this,"lastPickTime",new Date().getTime()),(0,A.Z)(this,"pickFromPickingFBO",function(r,n){var a,s=n.x,p=n.y,v=n.lngLat,g=n.type,x=n.target,C=!1,T=i.rendererService,R=T.getViewportSize,F=T.readPixels,j=T.getContainer,Y=i.getContainerSize(j()),J=Y.width,be=Y.height;J*=ka,be*=ka;var Be=r.getLayerConfig(),Ye=Be.enableHighlight,tt=Be.enableSelect,Et=s*ka,wt=p*ka;if(Et>J-1*ka||Et<0||wt>be-1*ka||wt<0)return!1;var Yt;if(Yt=F({x:Math.floor(Et/i.pickBufferScale),y:Math.floor((be-(p+1)*ka)/i.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:i.pickingFBO}),Yt[0]!==0||Yt[1]!==0||Yt[2]!==0){var ar=Bs(Yt),Mr=r.getSource().getFeatureById(ar);ar!==r.getCurrentPickId()&&g==="mousemove"&&(g="mouseenter");var Qr={x:s,y:p,type:g,lngLat:v,featureId:ar,feature:Mr,target:x};Mr&&(C=!0,r.setCurrentPickId(ar),i.triggerHoverOnLayer(r,Qr))}else{var br={x:s,y:p,lngLat:v,type:r.getCurrentPickId()!==null&&g==="mousemove"?"mouseout":"un"+g,featureId:null,target:x,feature:null};i.triggerHoverOnLayer(r,wn(wn({},br),{},{type:"unpick"})),i.triggerHoverOnLayer(r,br),r.setCurrentPickId(null)}if(Ye&&i.highlightPickedFeature(r,Yt),tt&&g==="click"&&((a=Yt)===null||a===void 0?void 0:a.toString())!==[0,0,0,0].toString()){var vn=Bs(Yt);r.getCurrentSelectedId()===null||vn!==r.getCurrentSelectedId()?(i.selectFeature(r,Yt),r.setCurrentSelectedId(vn)):(i.selectFeature(r,new Uint8Array([0,0,0,0])),r.setCurrentSelectedId(null))}return C})}return(0,Mt.Z)(e,[{key:"init",value:function(r){var n=this.rendererService,a=n.createTexture2D,s=n.createFramebuffer,p=n.getViewportSize,v=n.getContainer,g=this.getContainerSize(v()),x=g.width,C=g.height;x*=ka,C*=ka,this.pickBufferScale=this.configService.getSceneConfig(r).pickBufferScale||1,this.pickingFBO=s({color:a({width:Math.round(x/this.pickBufferScale),height:Math.round(C/this.pickBufferScale),wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE})}),this.interactionService.on(t.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var i=(0,Z.Z)(q().mark(function n(a,s,p){var v=this,g,x,C,T;return q().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:g=this.rendererService,x=g.useFramebuffer,C=g.clear,T=g.getContainer,this.resizePickingFBO(),x(this.pickingFBO,function(){C({framebuffer:v.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),a.hooks.beforePickingEncode.call(),a.renderModels(),a.hooks.afterPickingEncode.call();var j=v.pickBox(a,s);p(j)});case 3:case"end":return F.stop()}},n,this)}));function r(n,a,s){return i.apply(this,arguments)}return r}()},{key:"pickBox",value:function(r,n){var a=this,s=n.map(function(br){var vn=br<0?0:br;return Math.floor(vn*ka/a.pickBufferScale)}),p=(0,gn.Z)(s,4),v=p[0],g=p[1],x=p[2],C=p[3],T=this.rendererService,R=T.getViewportSize,F=T.readPixels,j=T.getContainer,Y=this.getContainerSize(j()),J=Y.width,be=Y.height;if(J*=ka,be*=ka,v>(J-1)*ka/this.pickBufferScale||x<0||g>(be-1)*ka/this.pickBufferScale||C<0)return[];var Be,Ye=Math.min(J/this.pickBufferScale,x)-v,tt=Math.min(be/this.pickBufferScale,C)-g;Be=F({x:v,y:Math.floor(be/this.pickBufferScale-(C+1)),width:Ye,height:tt,data:new Uint8Array(Ye*tt*4),framebuffer:this.pickingFBO});for(var Et=[],wt={},Yt=0;Yt<Be.length/4;Yt=Yt+1){var ar=Be.slice(Yt*4,Yt*4+4),Mr=Bs(ar);if(Mr!==-1&&!wt[Mr]){var Qr=r.getSource().getFeatureById(Mr);Et.push(wn(wn({},Qr),{},{pickedFeatureIdx:Mr})),wt[Mr]=!0}}return Et}},{key:"handleCursor",value:function(r,n){var a=r.getLayerConfig(),s=a.cursor,p=s===void 0?"":s,v=a.cursorEnabled;if(v){var g=this.mapService.version,x=g==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),C=x==null?void 0:x.style.getPropertyValue("cursor");n==="unmousemove"&&C!==""?x==null||x.style.setProperty("cursor",""):n==="mousemove"&&(x==null||x.style.setProperty("cursor",p))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(r){return r.getContext?{width:r.width/ka,height:r.height/ka}:r.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var i=(0,Z.Z)(q().mark(function n(a){var s;return q().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())){v.next=2;break}return v.abrupt("return");case 2:if(this.alreadyInPicking=!0,s=new Date().getTime(),!(s-this.lastPickTime>10||a.type==="contextmenu"||a.type==="click")){v.next=7;break}return v.next=7,this.pickingLayers(a);case 7:this.lastPickTime=s,this.layerService.renderLayers(),this.alreadyInPicking=!1;case 10:case"end":return v.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resizePickingFBO",value:function(){var r=this.rendererService.getContainer,n=this.getContainerSize(r()),a=n.width,s=n.height;a*=ka,s*=ka,(this.width!==a||this.height!==s)&&(this.pickingFBO.resize({width:Math.round(a/this.pickBufferScale),height:Math.round(s/this.pickBufferScale)}),this.width=a,this.height=s)}},{key:"pickingLayers",value:function(){var i=(0,Z.Z)(q().mark(function n(a){var s=this,p,v,g,x,C;return q().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:p=this.rendererService,v=p.getViewportSize,g=p.useFramebuffer,x=p.clear,C=p.getContainer,this.resizePickingFBO(),g(this.pickingFBO,function(){var F=s.layerService.getRenderList();F.filter(function(j){return j.needPick(a.type)}).reverse().some(function(j){x({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),j.hooks.beforePickingEncode.call(),j.masks.length>0&&j.masks.map(function(J){J.hooks.beforeRenderData.call(),J.hooks.beforeRender.call(),J.render(),J.hooks.afterRender.call()}),j.renderModels(!0),j.hooks.afterPickingEncode.call();var Y=s.pickFromPickingFBO(j,a);return s.layerService.pickedLayerId=Y?+j.id:-1,Y&&!j.getLayerConfig().enablePropagation})});case 3:case"end":return R.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"triggerHoverOnLayer",value:function(r,n){Ie(n)&&(this.handleCursor(r,n.type),r.emit(n.type,n))}},{key:"highlightPickedFeature",value:function(r,n){var a=(0,gn.Z)(n,3),s=a[0],p=a[1],v=a[2];r.hooks.beforeHighlight.call([s,p,v])}},{key:"selectFeature",value:function(r,n){var a=(0,gn.Z)(n,3),s=a[0],p=a[1],v=a[2];r.hooks.beforeSelect.call([s,p,v])}}]),e}(),Dn=ai(Dr.prototype,"mapService",[rt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cn=ai(Dr.prototype,"rendererService",[_t],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vn=ai(Dr.prototype,"configService",[zt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pn=ai(Dr.prototype,"interactionService",[Vt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pi=ai(Dr.prototype,"layerService",[ir],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dr))||Tr),Si=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,dt.Z)(this,e),(0,A.Z)(this,"autoStart",void 0),(0,A.Z)(this,"startTime",0),(0,A.Z)(this,"oldTime",0),(0,A.Z)(this,"running",!1),(0,A.Z)(this,"elapsedTime",0),this.autoStart=i}return(0,Mt.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var r=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance=="undefined"?Date:performance).now();r=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=r}return r}}]),e}(),Ji,Wn,fa,Ja,yo,Ha,eo,_o,Xo;function es(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=js(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function js(e,i){if(!!e){if(typeof e=="string")return ts(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ts(e,i)}}function ts(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Vs=(Ji=(0,Xr.b2)(),Wn=(0,Xr.f3)(Gt.IRendererService),fa=(0,Xr.f3)(Gt.IMapService),Ja=(0,Xr.f3)(Gt.IGlobalConfigService),Ji(yo=(Ha=function(){function e(){(0,dt.Z)(this,e),(0,A.Z)(this,"pickedLayerId",-1),(0,A.Z)(this,"clock",new Si),(0,A.Z)(this,"alreadyInRendering",!1),(0,A.Z)(this,"layers",[]),(0,A.Z)(this,"layerList",[]),(0,A.Z)(this,"layerRenderID",void 0),(0,A.Z)(this,"sceneInited",!1),(0,A.Z)(this,"animateInstanceCount",0),(0,A.Z)(this,"shaderPicking",!0),(0,A.Z)(this,"enableRender",!0),Bn(this,"renderService",eo,this),Bn(this,"mapService",_o,this),Bn(this,"configService",Xo,this)}return(0,Mt.Z)(e,[{key:"add",value:function(r){this.sceneInited&&r.init(),this.layers.push(r),this.updateLayerRenderList()}},{key:"addMask",value:function(r){this.sceneInited&&r.init()}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(r){r.inited||r.init()}),this.updateLayerRenderList()}},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(r){return this.layers.find(function(n){return n.id===r})}},{key:"getLayerByName",value:function(r){return this.layers.find(function(n){return n.name===r})}},{key:"cleanRemove",value:function(r,n){if(n){var a=n.layerChildren.indexOf(r);a>-1&&n.layerChildren.splice(a,1)}else{var s=this.layers.indexOf(r);s>-1&&this.layers.splice(s,1)}this.updateLayerRenderList(),this.renderLayers()}},{key:"remove",value:function(r,n){if(n){var a=n.layerChildren.indexOf(r);a>-1&&n.layerChildren.splice(a,1)}else{var s=this.layers.indexOf(r);s>-1&&this.layers.splice(s,1)}this.updateLayerRenderList(),r.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"setEnableRender",value:function(r){this.enableRender=r}},{key:"renderLayers",value:function(){var i=(0,Z.Z)(q().mark(function n(){var a,s,p;return q().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){g.next=2;break}return g.abrupt("return");case 2:this.alreadyInRendering=!0,this.clear(),a=es(this.layerList),g.prev=5,a.s();case 7:if((s=a.n()).done){g.next=21;break}if(p=s.value,p.hooks.beforeRenderData.call(),p.hooks.beforeRender.call(),!p.isLayerGroup&&p.masks.length>0&&(this.renderService.clear({stencil:0,depth:1,framebuffer:null}),p.masks.map(function(x){x.hooks.beforeRenderData.call(),x.hooks.beforeRender.call(),x.render(),x.hooks.afterRender.call()})),!p.getLayerConfig().enableMultiPassRenderer){g.next=17;break}return g.next=15,p.renderMultiPass();case 15:g.next=18;break;case 17:p.render();case 18:p.hooks.afterRender.call();case 19:g.next=7;break;case 21:g.next=26;break;case 23:g.prev=23,g.t0=g.catch(5),a.e(g.t0);case 26:return g.prev=26,a.f(),g.finish(26);case 29:this.alreadyInRendering=!1;case 30:case"end":return g.stop()}},n,this,[[5,23,26,29]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"updateLayerRenderList",value:function(){var r=this;this.layerList=[],this.layers.filter(function(n){return n.inited}).filter(function(n){return n.isVisible()}).sort(function(n,a){return n.zIndex-a.zIndex}).forEach(function(n){n.isLayerGroup?n.layerChildren.filter(function(a){return a.inited}).filter(function(a){return a.isVisible()}).sort(function(a,s){return a.zIndex-s.zIndex}).forEach(function(a){r.layerList.push(a)}):r.layerList.push(n)})}},{key:"destroy",value:function(){this.layers.forEach(function(r){r.destroy()}),this.layers=[],this.layerList=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var r=_i(this.mapService.bgColor);this.renderService.clear({color:r,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=ca.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){ca.cancelAnimationFrame(this.layerRenderID)}}]),e}(),eo=ai(Ha.prototype,"renderService",[Wn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_o=ai(Ha.prototype,"mapService",[fa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xo=ai(Ha.prototype,"configService",[Ja],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ha))||yo),to=Q(81253),ls=Q(14293),Ci=Q.n(ls),Fa=function(){function e(i){var r=this;(0,dt.Z)(this,e),(0,A.Z)(this,"name",void 0),(0,A.Z)(this,"type",void 0),(0,A.Z)(this,"scale",void 0),(0,A.Z)(this,"descriptor",void 0),(0,A.Z)(this,"featureBufferLayout",[]),(0,A.Z)(this,"needRescale",!1),(0,A.Z)(this,"needRemapping",!1),(0,A.Z)(this,"needRegenerateVertices",!1),(0,A.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,A.Z)(this,"vertexAttribute",void 0),(0,A.Z)(this,"defaultCallback",function(n){if(n.length===0){var a;return((a=r.scale)===null||a===void 0?void 0:a.defaultValues)||[]}return n.map(function(s,p){var v,g=(v=r.scale)===null||v===void 0?void 0:v.scalers[p].func,x=g(s);return x})}),this.setProps(i)}return(0,Mt.Z)(e,[{key:"setProps",value:function(r){Object.assign(this,r)}},{key:"mapping",value:function(r){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var a,s=(a=this.scale)===null||a===void 0?void 0:a.callback.apply(a,(0,Se.Z)(r));if(!Ci()(s))return[s]}return this.defaultCallback(r)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),Aa=["buffer","update","name"],la=["buffer","update","name"],cs,Ss,Wa,Ro,fs,pa;function $l(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function au(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?$l(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$l(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function af(e){return new Promise(function(i){return setTimeout(i,e)})}var ko=(cs={},(0,A.Z)(cs,k.FLOAT,4),(0,A.Z)(cs,k.UNSIGNED_BYTE,1),(0,A.Z)(cs,k.UNSIGNED_SHORT,2),cs),Ec=(Ss=(0,Xr.b2)(),Wa=(0,Xr.f3)(Gt.IRendererService),Ss(Ro=(fs=function(){function e(){(0,dt.Z)(this,e),(0,A.Z)(this,"attributesAndIndices",void 0),Bn(this,"rendererService",pa,this),(0,A.Z)(this,"attributes",[]),(0,A.Z)(this,"triangulation",void 0),(0,A.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,Mt.Z)(e,[{key:"registerStyleAttribute",value:function(r){var n=this.getLayerStyleAttribute(r.name||"");return n?n.setProps(r):(n=new Fa(r),this.attributes.push(n)),n}},{key:"updateStyleAttribute",value:function(r,n,a){var s=this.getLayerStyleAttribute(r);s||(s=this.registerStyleAttribute(au(au({},n),{},{name:r})));var p=n.scale;p&&s&&(s.scale=p,s.needRescale=!0,s.needRemapping=!0,s.needRegenerateVertices=!0,a&&a.featureRange&&(s.featureRange=a.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(r){return this.attributes.find(function(n){return n.name===r})}},{key:"getLayerAttributeScale",value:function(r){var n,a=this.getLayerStyleAttribute(r),s=a==null||(n=a.scale)===null||n===void 0?void 0:n.scalers;return s&&s[0]?s[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3?arguments[3]:void 0,p=this.attributes.find(function(tt){return tt.name===r});if(p&&p.descriptor){var v=p.descriptor,g=v.update,x=v.buffer,C=v.size,T=C===void 0?0:C,R=ko[x.type||k.FLOAT];if(g){var F=this.featureLayout,j=F.elements,Y=F.sizePerElement,J=j.slice(a,s);if(!J.length)return;var be=J[0].offset,Be=be*T*R,Ye=J.map(function(tt,Et){for(var wt=tt.featureIdx,Yt=tt.vertices,ar=tt.normals,Mr=Yt.length/Y,Qr=[],br=0;br<Mr;br++){var vn=ar?ar.slice(br*3,br*3+3):[];Qr.push.apply(Qr,(0,Se.Z)(g(n[wt],wt,Yt.slice(br*Y,br*Y+Y),Et,vn)))}return Qr}).reduce(function(tt,Et){return tt.push.apply(tt,(0,Se.Z)(Et)),tt},[]);p.vertexAttribute.updateBuffer({data:Ye,offset:Be})}}}},{key:"createAttributesAndIndices",value:function(r,n,a){var s=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var p=this.attributes.map(function(Be){return Be.resetDescriptor(),Be.descriptor}),v=0,g=[],x=[],C=[],T=3;r.forEach(function(Be,Ye){var tt=s.triangulation(Be,a),Et=tt.indices,wt=tt.vertices,Yt=tt.normals,ar=tt.size,Mr=tt.indexes;Et.forEach(function(Pn){x.push(Pn+v)}),T=ar;var Qr=wt.length/ar;s.featureLayout.sizePerElement=T,s.featureLayout.elements.push({featureIdx:Ye,vertices:wt,normals:Yt,offset:v}),v+=Qr;for(var br=function($n){var Ba=(Yt==null?void 0:Yt.slice($n*3,$n*3+3))||[],Yo=wt.slice($n*ar,$n*ar+ar),ks=0;Mr&&Mr[$n]!==void 0&&(ks=Mr[$n]),p.forEach(function(Ls,Hs){if(Ls&&Ls.update){var ff;(ff=Ls.buffer.data).push.apply(ff,(0,Se.Z)(Ls.update(Be,Ye,Yo,$n,Ba,ks)))}})},vn=0;vn<Qr;vn++)br(vn)});var R=this.rendererService,F=R.createAttribute,j=R.createBuffer,Y=R.createElements,J={};p.forEach(function(Be,Ye){if(Be){var tt=Be.buffer,Et=Be.update,wt=Be.name,Yt=(0,to.Z)(Be,Aa),ar=F(au({buffer:j(tt)},Yt));J[Be.name||""]=ar,s.attributes[Ye].vertexAttribute=ar}});var be=Y({data:x,type:k.UNSIGNED_INT,count:x.length});return this.attributesAndIndices={attributes:J,elements:be},this.attributesAndIndices}},{key:"createAttributes",value:function(r,n){var a=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var s=this.attributes.map(function(F){return F.resetDescriptor(),F.descriptor}),p=0,v=[],g=3;r.forEach(function(F,j){var Y=a.triangulation(F),J=Y.indices,be=Y.vertices,Be=Y.normals,Ye=Y.size,tt=Y.indexes;J.forEach(function(ar){v.push(ar+p)}),g=Ye;var Et=be.length/Ye;a.featureLayout.sizePerElement=g,a.featureLayout.elements.push({featureIdx:j,vertices:be,normals:Be,offset:p}),p+=Et;for(var wt=function(Mr){var Qr=(Be==null?void 0:Be.slice(Mr*3,Mr*3+3))||[],br=be.slice(Mr*Ye,Mr*Ye+Ye),vn=0;tt&&tt[Mr]!==void 0&&(vn=tt[Mr]),s.forEach(function(Pn,$n){if(Pn&&Pn.update){var Ba;(Ba=Pn.buffer.data).push.apply(Ba,(0,Se.Z)(Pn.update(F,j,br,Mr,Qr,vn)))}})},Yt=0;Yt<Et;Yt++)wt(Yt)});var x=this.rendererService,C=x.createAttribute,T=x.createBuffer,R={};return s.forEach(function(F,j){if(F){var Y=F.buffer,J=F.update,be=F.name,Be=(0,to.Z)(F,la),Ye=C(au({buffer:T(Y)},Be));R[F.name||""]=Ye,a.attributes[j].vertexAttribute=Ye}}),{attributes:R}}},{key:"clearAllAttributes",value:function(){var r;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(r=this.attributesAndIndices)===null||r===void 0||r.elements.destroy(),this.attributes=[]}}]),e}(),pa=ai(fs.prototype,"rendererService",[Wa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fs))||Ro),tl=Q(67709),Gp=Q.n(tl),Lf,cp,Sc,fp,gh,pp,Hp,yh,_h,Cc,Wp,hp,of,dp,xh,bh,Xp,ps,Eh,Yp,qp,Kp,Sh,vp,Ch,mp,$p,Df,Qp,gp,od,Dd,sd;function y0(e){var i=Fd();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function Fd(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _v=(Lf=(0,Xr.b2)(),cp=(0,Xr.f3)(Gt.SceneID),Sc=(0,Xr.f3)(Gt.IIconService),fp=(0,Xr.f3)(Gt.IFontService),gh=(0,Xr.f3)(Gt.IControlService),pp=(0,Xr.f3)(Gt.IGlobalConfigService),Hp=(0,Xr.f3)(Gt.IMapService),yh=(0,Xr.f3)(Gt.ICoordinateSystemService),_h=(0,Xr.f3)(Gt.IRendererService),Cc=(0,Xr.f3)(Gt.ILayerService),Wp=(0,Xr.f3)(Gt.ICameraService),hp=(0,Xr.f3)(Gt.IInteractionService),of=(0,Xr.f3)(Gt.IPickingService),dp=(0,Xr.f3)(Gt.IShaderModuleService),xh=(0,Xr.f3)(Gt.IMarkerService),bh=(0,Xr.f3)(Gt.IPopupService),Lf(Xp=(ps=function(e){(0,Pr.Z)(r,e);var i=y0(r);function r(){var n;return(0,dt.Z)(this,r),n=i.call(this),(0,A.Z)((0,ue.Z)(n),"destroyed",!1),(0,A.Z)((0,ue.Z)(n),"loaded",!1),(0,A.Z)((0,ue.Z)(n),"loadFont",!1),(0,A.Z)((0,ue.Z)(n),"fontFamily",""),Bn((0,ue.Z)(n),"id",Eh,(0,ue.Z)(n)),Bn((0,ue.Z)(n),"iconService",Yp,(0,ue.Z)(n)),Bn((0,ue.Z)(n),"fontService",qp,(0,ue.Z)(n)),Bn((0,ue.Z)(n),"controlService",Kp,(0,ue.Z)(n)),Bn((0,ue.Z)(n),"configService",Sh,(0,ue.Z)(n)),Bn((0,ue.Z)(n),"map",vp,(0,ue.Z)(n)),Bn((0,ue.Z)(n),"coordinateSystemService",Ch,(0,ue.Z)(n)),Bn((0,ue.Z)(n),"rendererService",mp,(0,ue.Z)(n)),Bn((0,ue.Z)(n),"layerService",$p,(0,ue.Z)(n)),Bn((0,ue.Z)(n),"cameraService",Df,(0,ue.Z)(n)),Bn((0,ue.Z)(n),"interactionService",Qp,(0,ue.Z)(n)),Bn((0,ue.Z)(n),"pickingService",gp,(0,ue.Z)(n)),Bn((0,ue.Z)(n),"shaderModuleService",od,(0,ue.Z)(n)),Bn((0,ue.Z)(n),"markerService",Dd,(0,ue.Z)(n)),Bn((0,ue.Z)(n),"popupService",sd,(0,ue.Z)(n)),(0,A.Z)((0,ue.Z)(n),"inited",!1),(0,A.Z)((0,ue.Z)(n),"initPromise",void 0),(0,A.Z)((0,ue.Z)(n),"rendering",!1),(0,A.Z)((0,ue.Z)(n),"$container",void 0),(0,A.Z)((0,ue.Z)(n),"canvas",void 0),(0,A.Z)((0,ue.Z)(n),"markerContainer",void 0),(0,A.Z)((0,ue.Z)(n),"hooks",void 0),(0,A.Z)((0,ue.Z)(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),hn(),n.coordinateSystemService.needRefresh=!0,n.render())}),(0,A.Z)((0,ue.Z)(n),"handleMapCameraChanged",function(a){n.cameraService.update(a),n.render()}),n.hooks={init:new is},n}return(0,Mt.Z)(r,[{key:"init",value:function(a){var s=this;this.configService.setSceneConfig(this.id,a),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return s.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Z.Z)(q().mark(function p(){return q().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,new Promise(function(x){s.map.onCameraChanged(function(C){s.cameraService.init(),s.cameraService.update(C),s.map.version!=="GAODE2.x"&&x()}),s.map.version!=="GAODE2.x"?s.map.init():x()});case 2:if(!(s.map.version==="GAODE2.x"&&s.map.initViewPort)){g.next=6;break}return g.next=5,s.map.init();case 5:s.map.initViewPort();case 6:s.map.onCameraChanged(s.handleMapCameraChanged),s.map.addMarkerContainer(),s.markerService.addMarkers(),s.markerService.addMarkerLayers(),s.popupService.initPopup(),s.interactionService.init(),s.interactionService.on(t.Drag,s.addSceneEvent.bind(s));case 13:case"end":return g.stop()}},p)}))),this.hooks.init.tapPromise("initRenderer",(0,Z.Z)(q().mark(function p(){var v,g;return q().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(v=Te(s.configService.getSceneConfig(s.id).id||""),s.$container=v,!v){C.next=11;break}return s.canvas=Za("canvas","",v),s.setCanvas(),C.next=7,s.rendererService.init(s.canvas,s.configService.getSceneConfig(s.id));case 7:Gp()(s.$container,s.handleWindowResized),ca.matchMedia&&((g=ca.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||g===void 0||g.addListener(s.handleWindowResized)),C.next=12;break;case 11:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:s.pickingService.init(s.id);case 13:case"end":return C.stop()}},p)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"initMiniScene",value:function(a){var s=this;this.configService.setSceneConfig(this.id,a),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return s.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Z.Z)(q().mark(function p(){return q().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,new Promise(function(x){s.map.onCameraChanged(function(C){s.cameraService.init(),s.cameraService.update(C),s.map.version!=="GAODE2.x"&&x()}),s.map.initMiniMap()});case 2:s.map.onCameraChanged(s.handleMapCameraChanged),s.interactionService.init(),s.interactionService.on(t.Drag,s.addSceneEvent.bind(s));case 5:case"end":return g.stop()}},p)}))),this.hooks.init.tapPromise("initRenderer",(0,Z.Z)(q().mark(function p(){var v;return q().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(v=a.canvas,s.$container=v||null,!s.$container){x.next=7;break}return x.next=5,s.rendererService.init(a.canvas,s.configService.getSceneConfig(s.id));case 5:x.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:s.pickingService.init(s.id);case 9:case"end":return x.stop()}},p)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(a){this.layerService.sceneService=this,this.layerService.add(a),this.render()}},{key:"addMask",value:function(a){this.layerService.sceneService=this,this.layerService.addMask(a),this.render()}},{key:"render",value:function(){var n=(0,Z.Z)(q().mark(function s(){return q().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!(this.rendering||this.destroyed)){v.next=2;break}return v.abrupt("return");case 2:if(this.rendering=!0,this.inited){v.next=23;break}return v.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){v.next=18;break}return v.prev=8,v.next=11,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 11:v.next=18;break;case 13:v.prev=13,v.t0=v.catch(8),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(v.t0);case 18:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 23:this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this.rendering=!1;case 26:case"end":return v.stop()}},s,this,[[8,13]])}));function a(){return n.apply(this,arguments)}return a}()},{key:"addFontFace",value:function(a,s){this.fontFamily=a;var p=document.createElement("style");p.type="text/css",p.innerText=`
        @font-face{
            font-family: '`.concat(a,`';
            src: url('`).concat(s,`') format('woff2'),
            url('`).concat(s,`') format('woff'),
            url('`).concat(s,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(p),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(a){var s,p=(s=this.$container)===null||s===void 0?void 0:s.getElementsByTagName("canvas")[0];this.render();var v=a==="jpg"?p==null?void 0:p.toDataURL("image/jpeg"):p==null?void 0:p.toDataURL("image/png");return v}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var a=this.$container.parentElement;a!==null&&(this.markerContainer=Za("div","l7-marker-container",a))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var a=this,s,p;if(!this.inited){this.destroyed=!0;return}if(this.emit("destroy"),this.pickingService.destroy(),this.layerService.destroy(),setTimeout(function(){var g;(g=a.$container)===null||g===void 0||g.removeChild(a.canvas),a.canvas=null,a.rendererService.destroy()}),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),(s=this.$container)===null||s===void 0||(p=s.parentNode)===null||p===void 0||p.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,(0,tl.unbind)(this.$container,this.handleWindowResized),ca.matchMedia){var v;(v=ca.matchMedia("screen and (min-resolution: 2dppx)"))===null||v===void 0||v.removeListener(this.handleWindowResized)}}},{key:"initContainer",value:function(){var a,s,p=ka,v=((a=this.$container)===null||a===void 0?void 0:a.clientWidth)||400,g=((s=this.$container)===null||s===void 0?void 0:s.clientHeight)||300,x=this.canvas;x&&(x.width=v*p,x.height=g*p),this.rendererService.viewport({x:0,y:0,width:p*v,height:p*g})}},{key:"setCanvas",value:function(){var a,s,p=ka,v=((a=this.$container)===null||a===void 0?void 0:a.clientWidth)||400,g=((s=this.$container)===null||s===void 0?void 0:s.clientHeight)||300,x=this.canvas;x.width=v*p,x.height=g*p,x.style.width="100%",x.style.height="100%"}},{key:"addSceneEvent",value:function(a){this.emit(a.type,a)}}]),r}(Es.EventEmitter),Eh=ai(ps.prototype,"id",[cp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yp=ai(ps.prototype,"iconService",[Sc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qp=ai(ps.prototype,"fontService",[fp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kp=ai(ps.prototype,"controlService",[gh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sh=ai(ps.prototype,"configService",[pp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vp=ai(ps.prototype,"map",[Hp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ch=ai(ps.prototype,"coordinateSystemService",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mp=ai(ps.prototype,"rendererService",[_h],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$p=ai(ps.prototype,"layerService",[Cc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Df=ai(ps.prototype,"cameraService",[Wp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qp=ai(ps.prototype,"interactionService",[hp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gp=ai(ps.prototype,"pickingService",[of],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),od=ai(ps.prototype,"shaderModuleService",[dp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dd=ai(ps.prototype,"markerService",[xh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sd=ai(ps.prototype,"popupService",[bh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ps))||Xp),Ah=Q(44908),Co=Q.n(Ah);function Ql(e){var i=0;switch(e){case"vec2":case"ivec2":i=2;break;case"vec3":case"ivec3":i=3;break;case"vec4":case"ivec4":case"mat2":i=4;break;case"mat3":i=9;break;case"mat4":i=16;break;default:}return i}var xv=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function sf(e){var i={};return e=e.replace(xv,function(r,n,a){var s=a.split(":"),p=s[0].trim(),v="";switch(s.length>1&&(v=s[1].trim()),n){case"bool":v=v==="true";break;case"float":case"int":v=Number(v);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":v?v=v.replace("[","").replace("]","").split(",").reduce(function(g,x){return g.push(Number(x.trim())),g},[]):v=new Array(Ql(n)).fill(0);break;default:}return i[p]=v,"uniform ".concat(n," ").concat(p,`;
`)}),{content:e,uniforms:i}}var ud,Bd;function wh(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ju(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?wh(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):wh(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Th="#define PI 3.14159265359",Mh=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,ld=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,cd=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,Nd=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

uniform float u_activeMix: 0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,_0=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec3 u_CurrentSelectedId : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;
uniform float u_EnableSelect: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {
  //   // \u9009\u4E2D\u6001
  //   v_PickingResult.a = SELECT;
  // } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {
  //   // \u9AD8\u4EAE\u6001
  //   v_PickingResult.a = HIGHLIGHT;
  // } else {
  //   v_PickingResult.a = NORMAL;
  // }

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,Ph=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,x0=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom));
  }
  return pixel * 2.0;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,b0=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,E0=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasThetaOffset() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 thetaOffset \u7684\u6570\u636E
  return u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 1.0, 0.0, 0.0, // offsets thetaOffset
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0 +  // offsets
          u_cellTypeLayout[2][1];         // thetaOffset
}`,S0=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,C0=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,Vu=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,fd=`
// \u8BA1\u7B97 thetaOffset \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasThetaOffset()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 thetaOffset \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_thetaOffset, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureThetaOffset, textureOffset + 1.0);
  }
}
`,A0=/precision\s+(high|low|medium)p\s+float/,Ac=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,bv=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,w0=(ud=(0,Xr.b2)(),ud(Bd=function(){function e(){(0,dt.Z)(this,e),(0,A.Z)(this,"moduleCache",{}),(0,A.Z)(this,"rawContentCache",{})}return(0,Mt.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:Th,fs:Th}),this.registerModule("decode",{vs:Mh,fs:""}),this.registerModule("projection",{vs:x0,fs:""}),this.registerModule("project",{vs:Ph,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:b0}),this.registerModule("lighting",{vs:cd,fs:""}),this.registerModule("light",{vs:ld,fs:""}),this.registerModule("picking",{vs:_0,fs:Nd}),this.registerModule("styleMapping",{vs:E0,fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:fd,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:S0,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:C0,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:Vu,fs:""})}},{key:"registerModule",value:function(r,n){if(!this.rawContentCache[r]){var a=n.vs,s=n.fs,p=n.uniforms,v=sf(a),g=v.content,x=v.uniforms,C=sf(s),T=C.content,R=C.uniforms;this.rawContentCache[r]={fs:T,uniforms:ju(ju(ju({},x),R),p),vs:g}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(r){var n=this;if(this.moduleCache[r])return this.moduleCache[r];var a=this.rawContentCache[r].vs,s=this.rawContentCache[r].fs,p=this.processModule(a,[],"vs"),v=p.content,g=p.includeList,x=this.processModule(s,[],"fs"),C=x.content,T=x.includeList,R=C,F=Co()(g.concat(T).concat(r)).reduce(function(j,Y){return ju(ju({},j),n.rawContentCache[Y].uniforms)},{});return A0.test(C)||(R=Ac+C),this.moduleCache[r]={fs:R.trim(),uniforms:F,vs:v.trim()},this.moduleCache[r]}},{key:"processModule",value:function(r,n,a){var s=this,p=r.replace(bv,function(v,g){var x=g.split(" "),C=x[0].replace(/"/g,"");if(n.indexOf(C)>-1)return"";var T=s.rawContentCache[C][a];n.push(C);var R=s.processModule(T,n,a),F=R.content;return F});return{content:p,includeList:n}}}]),e}())||Bd);function yp(e,i){for(;!Object.prototype.hasOwnProperty.call(e,i)&&(e=(0,gt.Z)(e),e!==null););return e}function Al(){return typeof Reflect!="undefined"&&Reflect.get?Al=Reflect.get:Al=function(i,r,n){var a=yp(i,r);if(!!a){var s=Object.getOwnPropertyDescriptor(a,r);return s.get?s.get.call(arguments.length<3?i:n):s.value}},Al.apply(this,arguments)}var rl;(function(e){e.Normal="normal",e.PostProcessing="post-processing"})(rl||(rl={}));var _p,xp,Ih=(_p=(0,Xr.b2)(),_p(xp=function(){function e(){(0,dt.Z)(this,e),(0,A.Z)(this,"shaderModuleService",void 0),(0,A.Z)(this,"rendererService",void 0),(0,A.Z)(this,"cameraService",void 0),(0,A.Z)(this,"mapService",void 0),(0,A.Z)(this,"interactionService",void 0),(0,A.Z)(this,"layerService",void 0),(0,A.Z)(this,"config",void 0)}return(0,Mt.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return rl.Normal}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(Gt.IRendererService),this.cameraService=r.getContainer().get(Gt.ICameraService),this.mapService=r.getContainer().get(Gt.IMapService),this.interactionService=r.getContainer().get(Gt.IInteractionService),this.layerService=r.getContainer().get(Gt.ILayerService),this.shaderModuleService=r.getContainer().get(Gt.IShaderModuleService)}},{key:"render",value:function(r){}}]),e}())||xp),zd,Ud;function T0(e){var i=Zd();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function Zd(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jd=(zd=(0,Xr.b2)(),zd(Ud=function(e){(0,Pr.Z)(r,e);var i=T0(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,Mt.Z)(r,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(a,s){Al((0,gt.Z)(r.prototype),"init",this).call(this,a,s)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),r}(Ih))||Ud),wc,Vd,pd,Oh,Gd;function Hd(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=M0(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function M0(e,i){if(!!e){if(typeof e=="string")return Wd(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Wd(e,i)}}function Wd(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Xd=(wc=(0,Xr.b2)(),Vd=(0,Xr.f3)(Gt.IPostProcessor),wc(pd=(Oh=function(){function e(){(0,dt.Z)(this,e),(0,A.Z)(this,"passes",[]),Bn(this,"postProcessor",Gd,this),(0,A.Z)(this,"layer",void 0),(0,A.Z)(this,"renderFlag",void 0),(0,A.Z)(this,"width",0),(0,A.Z)(this,"height",0)}return(0,Mt.Z)(e,[{key:"setLayer",value:function(r){this.layer=r}},{key:"setRenderFlag",value:function(r){this.renderFlag=r}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var i=(0,Z.Z)(q().mark(function n(){var a,s,p;return q().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:a=Hd(this.passes),g.prev=1,a.s();case 3:if((s=a.n()).done){g.next=9;break}return p=s.value,g.next=7,p.render(this.layer);case 7:g.next=3;break;case 9:g.next=14;break;case 11:g.prev=11,g.t0=g.catch(1),a.e(g.t0);case 14:return g.prev=14,a.f(),g.finish(14);case 17:return g.next=19,this.postProcessor.render(this.layer);case 19:case"end":return g.stop()}},n,this,[[1,11,14,17]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){(this.width!==r||this.height!==n)&&(this.postProcessor.resize(r,n),this.width=r,this.height=n)}},{key:"add",value:function(r,n){r.getType()===rl.PostProcessing?this.postProcessor.add(r,this.layer,n):(r.init(this.layer,n),this.passes.push(r))}},{key:"insert",value:function(r,n,a){r.init(this.layer,n),this.passes.splice(a,0,r)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),Gd=ai(Oh.prototype,"postProcessor",[Vd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oh))||pd),Yd,Jp;function qd(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Rh(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?qd(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):qd(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Ev(e){var i=P0();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function P0(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Sv=(Yd=(0,Xr.b2)(),Yd(Jp=function(e){(0,Pr.Z)(r,e);var i=Ev(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"pickingFBO",void 0),(0,A.Z)((0,ue.Z)(n),"layer",void 0),(0,A.Z)((0,ue.Z)(n),"width",0),(0,A.Z)((0,ue.Z)(n),"height",0),(0,A.Z)((0,ue.Z)(n),"alreadyInRendering",!1),(0,A.Z)((0,ue.Z)(n),"pickFromPickingFBO",function(v){var g=v.x,x=v.y,C=v.lngLat,T=v.type;if(!(!n.layer.isVisible()||!n.layer.needPick(T))){var R=n.rendererService,F=R.getViewportSize,j=R.readPixels,Y=R.useFramebuffer,J=F(),be=J.width,Be=J.height,Ye=n.layer.getLayerConfig(),tt=Ye.enableHighlight,Et=Ye.enableSelect,wt=g*ka,Yt=x*ka;if(!(wt>be||wt<0||Yt>Be||Yt<0)){var ar;Y(n.pickingFBO,function(){var Mr;if(ar=j({x:Math.round(wt),y:Math.round(Be-(x+1)*ka),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),ar[0]!==0||ar[1]!==0||ar[2]!==0){var Qr=Bs(ar),br=n.layer.getSource().getFeatureById(Qr),vn={x:g,y:x,type:T,lngLat:C,featureId:Qr,feature:br};br&&(n.layer.setCurrentPickId(Qr),n.triggerHoverOnLayer(vn))}else{var Pn={x:g,y:x,lngLat:C,type:n.layer.getCurrentPickId()===null?"un"+T:"mouseout",featureId:null,feature:null};n.triggerHoverOnLayer(Rh(Rh({},Pn),{},{type:"unpick"})),n.triggerHoverOnLayer(Pn),n.layer.setCurrentPickId(null)}tt&&n.highlightPickedFeature(ar),Et&&T==="click"&&((Mr=ar)===null||Mr===void 0?void 0:Mr.toString())!==[0,0,0,0].toString()&&n.selectFeature(ar)})}}}),n}return(0,Mt.Z)(r,[{key:"getType",value:function(){return rl.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(a,s){Al((0,gt.Z)(r.prototype),"init",this).call(this,a,s),this.layer=a;var p=this.rendererService,v=p.createTexture2D,g=p.createFramebuffer,x=p.getViewportSize,C=x(),T=C.width,R=C.height;this.pickingFBO=g({color:v({width:T,height:R,wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE})}),this.interactionService.on(t.Hover,this.pickFromPickingFBO),this.interactionService.on(t.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(t.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(a){var s=this;if(!this.alreadyInRendering){var p=this.rendererService,v=p.getViewportSize,g=p.useFramebuffer,x=p.clear,C=v(),T=C.width,R=C.height;this.alreadyInRendering=!0,(this.width!==T||this.height!==R)&&(this.pickingFBO.resize({width:T,height:R}),this.width=T,this.height=R),g(this.pickingFBO,function(){x({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var F=s.layer.multiPassRenderer.getRenderFlag();s.layer.multiPassRenderer.setRenderFlag(!1),a.hooks.beforePickingEncode.call(),a.render(),a.hooks.afterPickingEncode.call(),s.layer.multiPassRenderer.setRenderFlag(F),s.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(a){this.layer.emit(a.type,a)}},{key:"highlightPickedFeature",value:function(a){var s=(0,gn.Z)(a,3),p=s[0],v=s[1],g=s[2];this.layer.hooks.beforeHighlight.call([p,v,g]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(a){var s=(0,gn.Z)(a,3),p=s[0],v=s[1],g=s[2];this.layer.hooks.beforeSelect.call([p,v,g]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(a){var s=a.featureId,p=Ps(s);this.selectFeature(new Uint8Array(p))}},{key:"highlightFeatureHandle",value:function(a){var s=a.featureId,p=Ps(s);this.highlightPickedFeature(new Uint8Array(p))}}]),r}(Ih))||Jp),Cv=Q(11700),Av=Q.n(Cv),wv=Q(68929),Tv=Q.n(wv),I0,O0,R0,wl,kh;function Kd(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function uf(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Kd(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Kd(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var k0=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,bp=(I0=(0,Xr.b2)(),O0=(0,Xr.f3)(Gt.IShaderModuleService),I0(R0=(wl=function(){function e(){(0,dt.Z)(this,e),Bn(this,"shaderModuleService",kh,this),(0,A.Z)(this,"rendererService",void 0),(0,A.Z)(this,"config",void 0),(0,A.Z)(this,"quad",k0),(0,A.Z)(this,"enabled",!0),(0,A.Z)(this,"renderToScreen",!1),(0,A.Z)(this,"model",void 0),(0,A.Z)(this,"name",void 0),(0,A.Z)(this,"optionsToUpdate",{})}return(0,Mt.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(r){this.name=r}},{key:"getType",value:function(){return rl.PostProcessing}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(Gt.IRendererService),this.shaderModuleService=r.getContainer().get(Gt.IShaderModuleService);var a=this.rendererService,s=a.createAttribute,p=a.createBuffer,v=a.createModel,g=this.setupShaders(),x=g.vs,C=g.fs,T=g.uniforms;this.model=v({vs:x,fs:C,attributes:{a_Position:s({buffer:p({data:[-4,-4,4,-4,0,4],type:k.FLOAT}),size:2})},uniforms:uf(uf({u_Texture:null},T),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(r,n){var a=this,s=r.multiPassRenderer.getPostProcessor(),p=this.rendererService,v=p.useFramebuffer,g=p.getViewportSize,x=p.clear,C=g(),T=C.width,R=C.height;v(this.renderToScreen?null:s.getWriteFBO(),function(){x({framebuffer:s.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var F=uf({u_BloomFinal:0,u_Texture:s.getReadFBO(),u_ViewportSize:[T,R]},a.convertOptionsToUniforms(a.optionsToUpdate));n&&(F.u_BloomFinal=1,F.u_Texture2=n),a.model.draw({uniforms:F})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(r){this.enabled=r}},{key:"setRenderToScreen",value:function(r){this.renderToScreen=r}},{key:"updateOptions",value:function(r){this.optionsToUpdate=uf(uf({},this.optionsToUpdate),r)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(r){var n={};return Object.keys(r).forEach(function(a){Ci()(r[a])||(n["u_".concat(Av()(Tv()(a)))]=r[a])}),n}}]),e}(),kh=ai(wl.prototype,"shaderModuleService",[O0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wl))||R0),pm,hm;function dm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function vm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?dm(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):dm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Lx(e){var i=Dx();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function Dx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Fx=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,Bx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Nx=(pm=(0,Xr.b2)(),pm(hm=function(e){(0,Pr.Z)(r,e);var i=Lx(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,Mt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Bx,fs:Fx});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,p=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:p,uniforms:vm(vm({},v),{},{u_ViewportSize:[x,C]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return Ci()(a.bloomRadius)||(s.u_radius=a.bloomRadius),Ci()(a.bloomIntensity)||(s.u_intensity=a.bloomIntensity),Ci()(a.bloomBaseRadio)||(s.u_baseRadio=a.bloomBaseRadio),s}}]),r}(bp))||hm),mm,gm;function ym(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function _m(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ym(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ym(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function zx(e){var i=Ux();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function Ux(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Zx=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,jx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Vx=(mm=(0,Xr.b2)(),mm(gm=function(e){(0,Pr.Z)(r,e);var i=zx(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,Mt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:jx,fs:Zx});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,p=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:p,uniforms:_m(_m({},v),{},{u_ViewportSize:[x,C]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return Ci()(a.blurRadius)||(s.u_BlurDir=[a.blurRadius,0]),s}}]),r}(bp))||gm),xm,bm;function Em(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Sm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Em(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Em(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Gx(e){var i=Hx();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function Hx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Wx=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,Xx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Yx=(xm=(0,Xr.b2)(),xm(bm=function(e){(0,Pr.Z)(r,e);var i=Gx(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,Mt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Xx,fs:Wx});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,p=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:p,uniforms:Sm(Sm({},v),{},{u_ViewportSize:[x,C]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return Ci()(a.blurRadius)||(s.u_BlurDir=[0,a.blurRadius]),s}}]),r}(bp))||bm),Cm,Am;function wm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Tm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?wm(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):wm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function qx(e){var i=Kx();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function Kx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $x=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,Qx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Jx=(Cm=(0,Xr.b2)(),Cm(Am=function(e){(0,Pr.Z)(r,e);var i=qx(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,Mt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:Qx,fs:$x});var a=this.shaderModuleService.getModule("colorhalftone-pass"),s=a.vs,p=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:p,uniforms:Tm(Tm({},v),{},{u_ViewportSize:[x,C]})}}}]),r}(bp))||Am),Mm,Pm;function eb(e){var i=tb();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function tb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rb=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,nb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ib=(Mm=(0,Xr.b2)(),Mm(Pm=function(e){(0,Pr.Z)(r,e);var i=eb(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,Mt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:nb,fs:rb}),this.shaderModuleService.getModule("copy-pass")}}]),r}(bp))||Pm),Im,Om;function Rm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function km(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Rm(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Rm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ab(e){var i=ob();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function ob(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sb=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,ub=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,lb=(Im=(0,Xr.b2)(),Im(Om=function(e){(0,Pr.Z)(r,e);var i=ab(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,Mt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:ub,fs:sb});var a=this.shaderModuleService.getModule("hexagonalpixelate-pass"),s=a.vs,p=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:p,uniforms:km(km({},v),{},{u_ViewportSize:[x,C]})}}}]),r}(bp))||Om),Lm,Dm;function Fm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Bm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Fm(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Fm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function cb(e){var i=fb();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function fb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pb=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,hb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,db=(Lm=(0,Xr.b2)(),Lm(Dm=function(e){(0,Pr.Z)(r,e);var i=cb(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,Mt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:hb,fs:pb});var a=this.shaderModuleService.getModule("ink-pass"),s=a.vs,p=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:p,uniforms:Bm(Bm({},v),{},{u_ViewportSize:[x,C]})}}}]),r}(bp))||Dm),Nm,zm;function vb(e){var i=mb();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function mb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gb=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,yb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,_b=(Nm=(0,Xr.b2)(),Nm(zm=function(e){(0,Pr.Z)(r,e);var i=vb(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,Mt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:yb,fs:gb}),this.shaderModuleService.getModule("noise-pass")}}]),r}(bp))||zm),Um,Zm;function xb(e){var i=bb();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function bb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Eb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Sb=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,Cb=(Um=(0,Xr.b2)(),Um(Zm=function(e){(0,Pr.Z)(r,e);var i=xb(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,Mt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:Eb,fs:Sb}),this.shaderModuleService.getModule("sepia-pass")}}]),r}(bp))||Zm),jm,Vm,Gm,Hm,hd,Wm,Ab=(jm=(0,Xr.b2)(),Vm=(0,Xr.f3)(Gt.IRendererService),Gm=(0,Xr.zY)(),jm(Hm=(hd=function(){function e(){(0,dt.Z)(this,e),Bn(this,"rendererService",Wm,this),(0,A.Z)(this,"passes",[]),(0,A.Z)(this,"readFBO",void 0),(0,A.Z)(this,"writeFBO",void 0)}return(0,Mt.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var r=this.rendererService,n=r.getViewportSize,a=r.createTexture2D,s=n(),p=s.width,v=s.height;return a({x:0,y:0,width:p,height:v,copy:!0})}},{key:"getReadFBOTex",value:function(){var r=this,n=this.rendererService.useFramebuffer;return new Promise(function(a,s){n(r.readFBO,(0,Z.Z)(q().mark(function p(){return q().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:a(r.getCurrentFBOTex());case 1:case"end":return g.stop()}},p)})))})}},{key:"renderBloomPass",value:function(){var i=(0,Z.Z)(q().mark(function n(a,s){var p,v;return q().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,this.getReadFBOTex();case 2:p=x.sent,v=0;case 4:if(!(v<4)){x.next=11;break}return x.next=7,s.render(a,p);case 7:this.swap(),v++,x.next=4;break;case 11:case"end":return x.stop()}},n,this)}));function r(n,a){return i.apply(this,arguments)}return r}()},{key:"render",value:function(){var i=(0,Z.Z)(q().mark(function n(a){var s,p;return q().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:s=0;case 1:if(!(s<this.passes.length)){g.next=15;break}if(p=this.passes[s],p.setRenderToScreen(this.isLastEnabledPass(s)),p.getName()!=="bloom"){g.next=9;break}return g.next=7,this.renderBloomPass(a,p);case 7:g.next=12;break;case 9:return g.next=11,p.render(a);case 11:s!==this.passes.length-1&&this.swap();case 12:s++,g.next=1;break;case 15:case"end":return g.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){this.readFBO.resize({width:r,height:n}),this.writeFBO.resize({width:r,height:n})}},{key:"add",value:function(r,n,a){r.init(n,a),this.passes.push(r)}},{key:"insert",value:function(r,n,a,s){r.init(a,s),this.passes.splice(n,0,r)}},{key:"getPostProcessingPassByName",value:function(r){return this.passes.find(function(n){return n.getName()===r})}},{key:"init",value:function(){var r=this.rendererService,n=r.createFramebuffer,a=r.createTexture2D;this.readFBO=n({color:a({width:1,height:1,wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE})}),this.writeFBO=n({color:a({width:1,height:1,wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(r){for(var n=r+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var r=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=r}}]),e}(),Wm=ai(hd.prototype,"rendererService",[Vm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ai(hd.prototype,"init",[Gm],Object.getOwnPropertyDescriptor(hd.prototype,"init"),hd.prototype),hd))||Hm),Xm,Ym;function wb(e){var i=Tb();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function Tb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Mb=(Xm=(0,Xr.b2)(),Xm(Ym=function(e){(0,Pr.Z)(r,e);var i=wb(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,Mt.Z)(r,[{key:"getType",value:function(){return rl.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(a,s){Al((0,gt.Z)(r.prototype),"init",this).call(this,a,s)}},{key:"render",value:function(a){var s=this.rendererService,p=s.useFramebuffer,v=s.clear,g=a.multiPassRenderer.getPostProcessor().getReadFBO();p(g,function(){v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:g}),a.multiPassRenderer.setRenderFlag(!1),a.models.forEach(function(x){x.draw({uniforms:a.layerModel.getUninforms()})}),a.multiPassRenderer.setRenderFlag(!0)})}}]),r}(Ih))||Ym),qm,Km,$m,Mv,Qm;function Jm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function eg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Jm(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Jm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Pb(e){var i=Ib();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function Ib(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ob=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,tg=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,Rb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function rg(e,i){for(var r=0,n=1/i,a=e;a>0;)r=r+n*(a%i),a=Math.floor(a/i),n=n/i;return r}var kb=1,Lb=(qm=(0,Xr.b2)(),Km=(0,Xr.f3)(Gt.IShaderModuleService),qm($m=(Mv=function(e){(0,Pr.Z)(r,e);var i=Pb(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),Bn((0,ue.Z)(n),"shaderModuleService",Qm,(0,ue.Z)(n)),(0,A.Z)((0,ue.Z)(n),"haltonSequence",[]),(0,A.Z)((0,ue.Z)(n),"accumulatingId",0),(0,A.Z)((0,ue.Z)(n),"frame",0),(0,A.Z)((0,ue.Z)(n),"timer",void 0),(0,A.Z)((0,ue.Z)(n),"sampleRenderTarget",void 0),(0,A.Z)((0,ue.Z)(n),"prevRenderTarget",void 0),(0,A.Z)((0,ue.Z)(n),"outputRenderTarget",void 0),(0,A.Z)((0,ue.Z)(n),"copyRenderTarget",void 0),(0,A.Z)((0,ue.Z)(n),"blendModel",void 0),(0,A.Z)((0,ue.Z)(n),"outputModel",void 0),(0,A.Z)((0,ue.Z)(n),"copyModel",void 0),n}return(0,Mt.Z)(r,[{key:"getType",value:function(){return rl.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(a,s){Al((0,gt.Z)(r.prototype),"init",this).call(this,a,s);var p=this.rendererService,v=p.createFramebuffer,g=p.createTexture2D;this.sampleRenderTarget=v({color:g({width:1,height:1,wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE})}),this.prevRenderTarget=v({color:g({width:1,height:1,wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE})}),this.outputRenderTarget=v({color:g({width:1,height:1,wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE})}),this.copyRenderTarget=v({color:g({width:1,height:1,wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE})});for(var x=0;x<30;x++)this.haltonSequence.push([rg(x,2),rg(x,3)]);this.blendModel=this.createTriangleModel("blend-pass",Ob),this.outputModel=this.createTriangleModel("copy-pass",tg,{blend:{enable:!0,func:{srcRGB:k.ONE,dstRGB:k.ONE_MINUS_SRC_ALPHA,srcAlpha:k.ONE,dstAlpha:k.ONE_MINUS_SRC_ALPHA},equation:{rgb:k.FUNC_ADD,alpha:k.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",tg)}},{key:"render",value:function(a){var s=this,p=this.rendererService,v=p.clear,g=p.getViewportSize,x=p.useFramebuffer,C=g(),T=C.width,R=C.height;this.sampleRenderTarget.resize({width:T,height:R}),this.prevRenderTarget.resize({width:T,height:R}),this.outputRenderTarget.resize({width:T,height:R}),this.copyRenderTarget.resize({width:T,height:R}),this.resetFrame(),this.stopAccumulating();var F=a.multiPassRenderer.getPostProcessor().getReadFBO();x(F,function(){v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:F}),a.multiPassRenderer.setRenderFlag(!1),a.render(),a.multiPassRenderer.setRenderFlag(!0)});var j=function Y(J){!s.accumulatingId||J!==s.accumulatingId||s.isFinished()||(s.doRender(a),ca.requestAnimationFrame(function(){Y(J)}))};this.accumulatingId=kb++,this.timer=ca.setTimeout(function(){j(s.accumulatingId)},50)}},{key:"doRender",value:function(a){var s=this,p=this.rendererService,v=p.clear,g=p.getViewportSize,x=p.useFramebuffer,C=g(),T=C.width,R=C.height,F=a.getLayerConfig(),j=F.jitterScale,Y=j===void 0?1:j,J=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((J[0]*2-1)/T*Y,(J[1]*2-1)/R*Y),a.multiPassRenderer.setRenderFlag(!1),a.hooks.beforeRender.call(),x(this.sampleRenderTarget,function(){v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:s.sampleRenderTarget}),a.render()}),a.hooks.afterRender.call(),a.multiPassRenderer.setRenderFlag(!0);var be=a.getLayerConfig();x(this.outputRenderTarget,function(){s.blendModel.draw({uniforms:{u_opacity:be.opacity||1,u_MixRatio:s.frame===0?1:.9,u_Diffuse1:s.sampleRenderTarget,u_Diffuse2:s.frame===0?a.multiPassRenderer.getPostProcessor().getReadFBO():s.prevRenderTarget}})}),this.frame===0&&v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(x(this.copyRenderTarget,function(){s.outputModel.draw({uniforms:{u_Texture:s.outputRenderTarget}})}),x(a.multiPassRenderer.getPostProcessor().getReadFBO(),function(){s.copyModel.draw({uniforms:{u_Texture:s.copyRenderTarget}})}),a.multiPassRenderer.getPostProcessor().render(a));var Be=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=Be,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,ca.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(a,s,p){this.shaderModuleService.registerModule(a,{vs:Rb,fs:s});var v=this.shaderModuleService.getModule(a),g=v.vs,x=v.fs,C=v.uniforms,T=this.rendererService,R=T.createAttribute,F=T.createBuffer,j=T.createModel;return j(eg({vs:g,fs:x,attributes:{a_Position:R({buffer:F({data:[-4,-4,4,-4,0,4],type:k.FLOAT}),size:2})},uniforms:eg({},C),depth:{enable:!1},count:3},p))}}]),r}(Ih),Qm=ai(Mv.prototype,"shaderModuleService",[Km],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mv))||$m),$d=new Xr.W2;$d.bind(Gt.IGlobalConfigService).to(va).inSingletonScope(),(0,Xr.GW)((0,Xr.b2)(),Es.EventEmitter),$d.bind(Gt.IEventEmitter).to(Es.EventEmitter);var ng=(0,Mo.Z)($d,!1),Pv=function(i){var r=ng.lazyInject(i);return function(n,a,s){r.call(this,n,a),s&&(s.initializer=function(){return n[a]})}},R3=function(i){var r=ng.lazyMultiInject(i);return function(n,a,s){r.call(this,n,a),s&&(s.initializer=function(){return n[a]})}},Jl=$d,Db=0;function Fb(){var e=new Xr.W2;return e.parent=$d,e.bind(Gt.SceneID).toConstantValue("".concat(Db++)),e.bind(Gt.IShaderModuleService).to(w0).inSingletonScope(),e.bind(Gt.ILayerService).to(Vs).inSingletonScope(),e.bind(Gt.ISceneService).to(_v).inSingletonScope(),e.bind(Gt.ICameraService).to(ii).inSingletonScope(),e.bind(Gt.ICoordinateSystemService).to(us).inSingletonScope(),e.bind(Gt.IInteractionService).to(z).inSingletonScope(),e.bind(Gt.IPickingService).to(Zi).inSingletonScope(),e.bind(Gt.IControlService).to(oo).inSingletonScope(),e.bind(Gt.IMarkerService).to(Jo).inSingletonScope(),e.bind(Gt.IIconService).to(Np).inSingletonScope(),e.bind(Gt.IFontService).to(Qh).inSingletonScope(),e.bind(Gt.IPopupService).to(So).inSingletonScope(),e.bind(Gt.INormalPass).to(jd).whenTargetNamed("clear"),e.bind(Gt.INormalPass).to(Sv).whenTargetNamed("pixelPicking"),e.bind(Gt.INormalPass).to(Mb).whenTargetNamed("render"),e.bind(Gt.INormalPass).to(Lb).whenTargetNamed("taa"),e.bind(Gt.IFactoryNormalPass).toFactory(function(i){return function(r){return i.container.getNamed(Gt.INormalPass,r)}}),e.bind(Gt.IPostProcessingPass).to(ib).whenTargetNamed("copy"),e.bind(Gt.IPostProcessingPass).to(Nx).whenTargetNamed("bloom"),e.bind(Gt.IPostProcessingPass).to(Vx).whenTargetNamed("blurH"),e.bind(Gt.IPostProcessingPass).to(Yx).whenTargetNamed("blurV"),e.bind(Gt.IPostProcessingPass).to(_b).whenTargetNamed("noise"),e.bind(Gt.IPostProcessingPass).to(Cb).whenTargetNamed("sepia"),e.bind(Gt.IPostProcessingPass).to(Jx).whenTargetNamed("colorHalftone"),e.bind(Gt.IPostProcessingPass).to(lb).whenTargetNamed("hexagonalPixelate"),e.bind(Gt.IPostProcessingPass).to(db).whenTargetNamed("ink"),e.bind(Gt.IFactoryPostProcessingPass).toFactory(function(i){return function(r){var n=i.container.getNamed(Gt.IPostProcessingPass,r);return n.setName(r),n}}),e}function ig(e){var i=new Xr.W2;return i.parent=e,i.bind(Gt.IStyleAttributeService).to(Ec).inSingletonScope(),i.bind(Gt.IMultiPassRenderer).to(Xd).inSingletonScope(),i.bind(Gt.IPostProcessor).to(Ab).inSingletonScope(),i}var k3=Q(74691),Bb=null;function L3(e){return Bb.indexOf(e)}var Nb=2,D3=4,zb=64,F3=128,Ub=256,Zb=512,B3=8192,N3=16384,z3=32768,jb=null,ag=131072,U3=262144,Vb=524288,Z3=1048576,Gb=2097152,j3=4194304,Hb=8388608,Wb=16777216,Xb=null;function L0(e,i){return e=_clamp(Math.floor(e),0,255),i=_clamp(Math.floor(i),0,255),256*e+i}function V3(e){var i=e.color,r=e.radius,n=e.tileX,a=e.tileY,s=e.shape,p=e.opacity,v=e.stroke,g=e.strokeWidth,x=e.strokeOpacity,C=[],T=[],R=[],F=[L0(i[0],i[1]),L0(i[2],i[3])],j=[L0(v[0],v[1]),L0(v[2],v[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(Y){var J=_slicedToArray(Y,2),be=J[0],Be=J[1];C.push([].concat(F,[(be+1)*Hb+(Be+1)*Gb+getShapeIndex(s)*ag+r,(n+512)*Vb+(a+512)*zb])),T.push([].concat(j,[g,x])),R.push([p,0,0,0])}),{packedBuffer:C,packedBuffer2:T,packedBuffer3:R}}function G3(e,i){if(e===0&&!i)return 0;if(e===1&&i)return 4294967295;var r=i?1:0,n=Math.floor(e*127);return n*Xb+r*Wb+n*ag+r*jb+n*Zb+r*Ub+n*Nb+r}var Tc;(function(e){e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none"})(Tc||(Tc={}));var ou;(function(e){e.LINEAR="linear",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat"})(ou||(ou={}));var eh;(function(e){e.CONSTANT="constant",e.VARIABLE="variable"})(eh||(eh={}));var On;(function(e){e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform"})(On||(On={}));var Yb=["mapload","mapchange","mapAfterFrameChange"],Lh={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},Iv=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],th;(function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter"})(th||(th={}));function og(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function sg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?og(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):og(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function qb(e){var i=Kb();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function Kb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $b=0,D0=function(e){(0,Pr.Z)(r,e);var i=qb(r);function r(n){var a;return(0,dt.Z)(this,r),a=i.call(this),(0,A.Z)((0,ue.Z)(a),"controlOption",void 0),(0,A.Z)((0,ue.Z)(a),"container",void 0),(0,A.Z)((0,ue.Z)(a),"sceneContainer",void 0),(0,A.Z)((0,ue.Z)(a),"mapsService",void 0),(0,A.Z)((0,ue.Z)(a),"renderService",void 0),(0,A.Z)((0,ue.Z)(a),"layerService",void 0),(0,A.Z)((0,ue.Z)(a),"controlService",void 0),(0,A.Z)((0,ue.Z)(a),"isShow",void 0),a.controlOption=sg(sg({},a.getDefault()),n||{}),a}return(0,Mt.Z)(r,[{key:"getDefault",value:function(){return{position:th.TOPRIGHT,name:"".concat($b++)}}},{key:"setPosition",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:th.BOTTOMRIGHT,s=this.controlService;return s&&s.removeControl(this),this.controlOption.position=a,s&&s.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(a){this.mapsService=a.get(Gt.IMapService),this.renderService=a.get(Gt.IRendererService),this.layerService=a.get(Gt.ILayerService),this.controlService=a.get(Gt.IControlService),this.sceneContainer=a,this.isShow=!0,this.container=this.onAdd();var s=this.container,p=this.controlOption.position,v=this.controlService.controlCorners[p];return Nl(s,"l7-control"),p.indexOf("bottom")!==-1?v.insertBefore(s,v.firstChild):v.appendChild(s),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var a=this.container;Nl(a,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var a=this.container;Ku(a,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;uc(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(a){if(this.mapsService&&a&&a.screenX>0&&a.screenY>0){var s=this.mapsService.getContainer();s!==null&&s.focus()}}}]),r}(Es.EventEmitter);function Qb(e){var i=Jb();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function Jb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var H3=function(e){(0,Pr.Z)(r,e);var i=Qb(r);function r(n){var a;return(0,dt.Z)(this,r),a=i.call(this,n),(0,A.Z)((0,ue.Z)(a),"layerControlInputs",void 0),(0,A.Z)((0,ue.Z)(a),"layers",void 0),(0,A.Z)((0,ue.Z)(a),"lastZIndex",void 0),(0,A.Z)((0,ue.Z)(a),"handlingClick",void 0),(0,A.Z)((0,ue.Z)(a),"layersLink",void 0),(0,A.Z)((0,ue.Z)(a),"baseLayersList",void 0),(0,A.Z)((0,ue.Z)(a),"separator",void 0),(0,A.Z)((0,ue.Z)(a),"overlaysList",void 0),(0,A.Z)((0,ue.Z)(a),"form",void 0),a.layerControlInputs=[],a.layers=[],a.lastZIndex=0,a.handlingClick=!1,a.initLayers(),pl(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,ue.Z)(a)),a}return(0,Mt.Z)(r,[{key:"getDefault",value:function(){return{collapsed:!0,position:th.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var a=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(s){s.layer.on("remove",a.onLayerChange),s.layer.on("add",a.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(a,s){return this.addLayer(a,s,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var a=this.renderService.getViewportSize(),s=a.height;Nl(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var p=s-(this.container.offsetTop+50);return p<this.form.clientHeight?(Nl(this.form,"l7-control-layers-scrollbar"),this.form.style.height=p+"px"):Ku(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return Ku(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var a=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(s){s.layer.off("remove",a.onLayerChange),s.layer.off("add",a.onLayerChange)}))}},{key:"initLayout",value:function(){var a="l7-control-layers",s=this.container=Za("div",a),p=this.controlOption.collapsed;s.setAttribute("aria-haspopup","true");var v=this.form=Za("form",a+"-list");p&&(this.mapsService.on("click",this.collapse),s.addEventListener("mouseenter",this.expand),s.addEventListener("mouseleave",this.collapse)),this.layersLink=Za("a",a+"-toggle",s);var g=this.layersLink;g.title="Layers",p||this.expand(),this.baseLayersList=Za("div",a+"-base",v),this.separator=Za("div",a+"-separator",v),this.overlaysList=Za("div",a+"-overlays",v),s.appendChild(v)}},{key:"initLayers",value:function(){var a=this,s=this.controlOption,p=s.baseLayers,v=p===void 0?{}:p,g=s.overlayers,x=g===void 0?{}:g;Object.keys(v).forEach(function(C,T){a.addLayer(v[C],C,!1)}),Object.keys(x).forEach(function(C,T){a.addLayer(x[C],C,!0)})}},{key:"update",value:function(){if(!this.container)return this;zl(this.baseLayersList),zl(this.overlaysList),this.layerControlInputs=[];var a,s,p,v,g=0;for(p=0;p<this.layers.length;p++)v=this.layers[p],this.addItem(v),s=s||v.overlay,a=a||!v.overlay,g+=v.overlay?0:1;return this.controlOption.hideSingleBase&&(a=a&&g>1,this.baseLayersList.style.display=a?"":"none"),this.separator.style.display=s&&a?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var a=this.layerControlInputs,s,p,v=this.mapsService.getZoom(),g=a.length-1;g>=0;g--)if(s=a[g],p=this.layerService.getLayer(s.layerId),p&&p.inited){var x=p.getMinZoom(),C=p.getMaxZoom();s.disabled=v<x||v>C}}},{key:"addLayer",value:function(a,s,p){this.mapsService&&(a.on("add",this.onLayerChange),a.on("remove",this.onLayerChange)),this.layers.push({layer:a,name:s,overlay:p});var v=this.controlOption,g=v.sortLayers,x=v.sortFunction,C=v.autoZIndex;g&&this.layers.sort(function(T,R){return x(T.layer,R.layer,T.name,R.name)}),C&&a.setZIndex&&(this.lastZIndex++,a.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(a){this.handlingClick||this.update();var s=this.layerService.getLayer(a.target.layerId),p=s!=null&&s.overlay?a.type==="add"?"overlayadd":"overlayremove":a.type==="add"?"baselayerchange":null;p&&this.emit(p,s)}},{key:"createRadioElement",value:function(a,s){var p='<input type="radio" class="l7-control-layers-selector" name="'+a+'"'+(s?' checked="checked"':"")+"/>",v=document.createElement("div");return v.innerHTML=p,v.firstChild}},{key:"addItem",value:function(a){var s=document.createElement("label"),p=this.layerService.getLayer(a.layer.id),v=p&&p.inited&&a.layer.isVisible(),g;a.overlay?(g=document.createElement("input"),g.type="checkbox",g.className="l7-control-layers-selector",g.defaultChecked=v):g=this.createRadioElement("l7-base-layers",v),this.layerControlInputs.push(g),g.layerId=a.layer.id,g.addEventListener("click",this.onInputClick);var x=document.createElement("span");x.innerHTML=" "+a.name;var C=document.createElement("div");s.appendChild(C),C.appendChild(g),C.appendChild(x);var T=a.overlay?this.overlaysList:this.baseLayersList;return T.appendChild(s),this.checkDisabledLayers(),s}},{key:"onInputClick",value:function(){var a=this.layerControlInputs,s,p,v=[],g=[];this.handlingClick=!0;for(var x=a.length-1;x>=0;x--)s=a[x],p=this.layerService.getLayer(s.layerId),s.checked?v.push(p):s.checked||g.push(p);g.forEach(function(C){C.hide()}),v.forEach(function(C){C.show()}),this.handlingClick=!1}}]),r}(D0);function e2(e){var i=t2();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function t2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var r2=function(e){(0,Pr.Z)(r,e);var i=e2(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,Mt.Z)(r,[{key:"getDefault",value:function(){return{position:th.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var a="l7-control-logo",s=Za("div",a),p=Za("a","l7-ctrl-logo");return p.target="_blank",p.rel="noopener nofollow",p.href="https://antv.alipay.com/l7",p.setAttribute("aria-label","AntV logo"),p.setAttribute("rel","noopener nofollow"),s.appendChild(p),s}},{key:"onRemove",value:function(){return null}}]),r}(D0);function n2(e){var i=i2();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function i2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var W3=function(e){(0,Pr.Z)(r,e);var i=n2(r);function r(n){var a;return(0,dt.Z)(this,r),a=i.call(this,n),(0,A.Z)((0,ue.Z)(a),"mScale",void 0),(0,A.Z)((0,ue.Z)(a),"iScale",void 0),pl(["update"],(0,ue.Z)(a)),a}return(0,Mt.Z)(r,[{key:"getDefault",value:function(){return{position:th.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var a="l7-control-scale",s=Za("div",a);this.addScales(a+"-line",s);var p=this.controlOption.updateWhenIdle;return this.mapsService.on(p?"moveend":"mapmove",this.update),this.mapsService.on(p?"zoomend":"zoomchange",this.update),this.update(),s}},{key:"onRemove",value:function(){var a=this.controlOption.updateWhenIdle;this.mapsService.off(a?"zoomend":"zoomchange",this.update),this.mapsService.off(a?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var a=this.mapsService,s=this.controlOption.maxWidth,p=a.getSize()[1]/2,v=a.containerToLngLat([0,p]),g=a.containerToLngLat([s,p]),x=bs([v.lng,v.lat],[g.lng,g.lat]);this.updateScales(x)}},{key:"updateScales",value:function(a){var s=this.controlOption,p=s.metric,v=s.imperial;p&&a&&this.updateMetric(a),v&&a&&this.updateImperial(a)}},{key:"updateMetric",value:function(a){var s=this.getRoundNum(a),p=s<1e3?s+" m":s/1e3+" km";this.updateScale(this.mScale,p,s/a)}},{key:"updateImperial",value:function(a){var s=a*3.2808399,p,v,g;s>5280?(p=s/5280,v=this.getRoundNum(p),this.updateScale(this.iScale,v+" mi",v/p)):(g=this.getRoundNum(s),this.updateScale(this.iScale,g+" ft",g/s))}},{key:"updateScale",value:function(a,s,p){var v=this.controlOption.maxWidth;a.style.width=Math.round(v*p)+"px",a.innerHTML=s}},{key:"getRoundNum",value:function(a){var s=Math.pow(10,(Math.floor(a)+"").length-1),p=a/s;return p=p>=10?10:p>=5?5:p>=3?3:p>=2?2:1,s*p}},{key:"addScales",value:function(a,s){var p=this.controlOption,v=p.metric,g=p.imperial;v&&(this.mScale=Za("div",a,s)),g&&(this.iScale=Za("div",a,s))}}]),r}(D0);function a2(e){var i=o2();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function o2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var X3=function(e){(0,Pr.Z)(r,e);var i=a2(r);function r(n){var a;return(0,dt.Z)(this,r),a=i.call(this,n),(0,A.Z)((0,ue.Z)(a),"disabled",void 0),(0,A.Z)((0,ue.Z)(a),"zoomInButton",void 0),(0,A.Z)((0,ue.Z)(a),"zoomOutButton",void 0),pl(["updateDisabled","zoomIn","zoomOut"],(0,ue.Z)(a)),a}return(0,Mt.Z)(r,[{key:"getDefault",value:function(){return{position:th.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var a="l7-control-zoom",s=Za("div",a+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,a+"-in",s,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,a+"-out",s,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),s}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(a,s,p,v,g){var x=Za("a",p,v);return x.innerHTML=a,x.title=s,x.href="javascript:void(0)",x.addEventListener("click",g),x}},{key:"updateDisabled",value:function(){var a=this.mapsService,s="l7-disabled";Ku(this.zoomInButton,s),Ku(this.zoomOutButton,s),(this.disabled||a.getZoom()<=a.getMinZoom())&&Nl(this.zoomOutButton,s),(this.disabled||a.getZoom()>=a.getMaxZoom())&&Nl(this.zoomInButton,s)}}]),r}(D0);function ug(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function lg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ug(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ug(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function s2(e){var i=u2();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function u2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cg=function(e){(0,Pr.Z)(r,e);var i=s2(r);function r(n){var a;return(0,dt.Z)(this,r),a=i.call(this),(0,A.Z)((0,ue.Z)(a),"markerOption",void 0),(0,A.Z)((0,ue.Z)(a),"defaultMarker",void 0),(0,A.Z)((0,ue.Z)(a),"popup",void 0),(0,A.Z)((0,ue.Z)(a),"mapsService",void 0),(0,A.Z)((0,ue.Z)(a),"sceneSerive",void 0),(0,A.Z)((0,ue.Z)(a),"lngLat",void 0),(0,A.Z)((0,ue.Z)(a),"scene",void 0),(0,A.Z)((0,ue.Z)(a),"added",!1),(0,A.Z)((0,ue.Z)(a),"eventHandle",function(s){a.emit(s.type,{target:s,data:a.markerOption.extData,lngLat:a.lngLat})}),a.markerOption=lg(lg({},a.getDefault()),n),pl(["update","onMove","onUp","addDragHandler","onMapClick"],(0,ue.Z)(a)),a.init(),a}return(0,Mt.Z)(r,[{key:"getDefault",value:function(){return{element:void 0,anchor:Lu.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(a){this.scene=a,this.mapsService=a.get(Gt.IMapService),this.sceneSerive=a.get(Gt.ISceneService);var s=this.markerOption,p=s.element,v=s.draggable;return this.mapsService.getMarkerContainer().appendChild(p),this.registerMarkerEvent(p),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var a=this.markerOption.element;return a&&uc(a),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(a){return this.lngLat=a,Array.isArray(a)&&(this.lngLat={lng:a[0],lat:a[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(a){var s=this;if(!this.added)return this.once("added",function(){s.setElement(a)}),this;var p=this.markerOption.element;return p&&uc(p),this.markerOption.element=a,this.init(),this.mapsService.getMarkerContainer().appendChild(a),this.registerMarkerEvent(a),this.update(),this}},{key:"openPopup",value:function(){var a=this;if(!this.added)return this.once("added",function(){a.openPopup()}),this;var s=this.popup;return s?(s.isOpen()||s.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var a=this;this.added||this.once("added",function(){a.closePopup()});var s=this.popup;return s&&s.remove(),this}},{key:"setPopup",value:function(a){return this.popup=a,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var a=this.popup;if(a)a.isOpen()?a.remove():a.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(a){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(a){this.markerOption.extData=a}},{key:"update",value:function(){if(!!this.mapsService){var a=this.markerOption,s=a.element,p=a.anchor;this.updatePosition(),mo(s,"".concat(Qu[p]))}}},{key:"onMapClick",value:function(a){var s=this.markerOption.element;this.popup&&s&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var a=this.markerOption,s=a.element,p=a.offsets,v=this.lngLat,g=v.lng,x=v.lat,C=this.mapsService.getBounds(),T=this.mapsService.lngLatToContainer([g,x]);if(s){s.style.display="block",s.style.whiteSpace="nowrap";var R=this.mapsService.getContainer(),F=0,j=0;if(R&&(F=R.scrollWidth,j=R.scrollHeight),Math.abs(C[0][0])>180||Math.abs(C[1][0])>180){if(T.x>F){var Y=this.mapsService.lngLatToContainer([g-360,x]);T.x=Y.x}if(T.x<0){var J=this.mapsService.lngLatToContainer([g+360,x]);T.x=J.x}}(T.x>F||T.x<0||T.y>j||T.y<0)&&(s.style.display="none"),s.style.left=T.x+p[0]+"px",s.style.top=T.y-p[1]+"px"}}}},{key:"init",value:function(){var a=this,s=this.markerOption.element,p=this.markerOption,v=p.color,g=p.anchor;if(!s){this.defaultMarker=!0,s=Za("div"),this.markerOption.element=s;var x=document.createElementNS("http://www.w3.org/2000/svg","svg");x.setAttributeNS(null,"display","block"),x.setAttributeNS(null,"height","48px"),x.setAttributeNS(null,"width","48px"),x.setAttributeNS(null,"viewBox","0 0 1024 1024");var C=document.createElementNS("http://www.w3.org/2000/svg","path");C.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),C.setAttributeNS(null,"fill",v),x.appendChild(C),s.appendChild(x)}Nl(s,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(T){var R,F,j=((R=a.markerOption)===null||R===void 0?void 0:R.style)&&((F=a.markerOption)===null||F===void 0?void 0:F.style[T]);s&&(s.style[T]=j)}),s.addEventListener("click",function(T){a.onMapClick(T)}),s.addEventListener("click",this.eventHandle),Vc(s,g,"marker")}},{key:"registerMarkerEvent",value:function(a){a.addEventListener("mousemove",this.eventHandle),a.addEventListener("click",this.eventHandle),a.addEventListener("mousedown",this.eventHandle),a.addEventListener("mouseup",this.eventHandle),a.addEventListener("dblclick",this.eventHandle),a.addEventListener("contextmenu",this.eventHandle),a.addEventListener("mouseover",this.eventHandle),a.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var a=this.getElement();a.removeEventListener("mousemove",this.eventHandle),a.removeEventListener("click",this.eventHandle),a.removeEventListener("mousedown",this.eventHandle),a.removeEventListener("mouseup",this.eventHandle),a.removeEventListener("dblclick",this.eventHandle),a.removeEventListener("contextmenu",this.eventHandle),a.removeEventListener("mouseover",this.eventHandle),a.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(a){throw new Error("Method not implemented.")}},{key:"onUp",value:function(a){throw new Error("Method not implemented.")}}]),r}(Es.EventEmitter);function fg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function pg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?fg(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function l2(e){var i=c2();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function c2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Y3=function(e){(0,Pr.Z)(r,e);var i=l2(r);function r(n){var a,s;return(0,dt.Z)(this,r),s=i.call(this),(0,A.Z)((0,ue.Z)(s),"markers",[]),(0,A.Z)((0,ue.Z)(s),"markerLayerOption",void 0),(0,A.Z)((0,ue.Z)(s),"clusterIndex",void 0),(0,A.Z)((0,ue.Z)(s),"points",[]),(0,A.Z)((0,ue.Z)(s),"clusterMarkers",[]),(0,A.Z)((0,ue.Z)(s),"mapsService",void 0),(0,A.Z)((0,ue.Z)(s),"scene",void 0),(0,A.Z)((0,ue.Z)(s),"zoom",void 0),(0,A.Z)((0,ue.Z)(s),"bbox",void 0),s.markerLayerOption=Io()(s.getDefault(),n),pl(["update"],(0,ue.Z)(s)),s.zoom=((a=s.markerLayerOption.clusterOption)===null||a===void 0?void 0:a.zoom)||-99,s}return(0,Mt.Z)(r,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(a){return this.scene=a,this.mapsService=a.get(Gt.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(a){var s=this.markerLayerOption.cluster;if(s&&(this.addPoint(a,this.markers.length),this.mapsService)){var p=this.mapsService.getZoom(),v=this.mapsService.getBounds();this.bbox=Rn(v,.5),this.zoom=Math.floor(p),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(a)}},{key:"removeMarker",value:function(a){this.markers.indexOf(a);var s=this.markers.indexOf(a);s>-1&&this.markers.splice(s,1)}},{key:"hide",value:function(){this.markers.map(function(a){a.getElement().style.opacity="0"}),this.clusterMarkers.map(function(a){a.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(a){a.getElement().style.opacity="1"}),this.clusterMarkers.map(function(a){a.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var a=this.markerLayerOption.cluster;return a?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var a=this;this.getMarkers().forEach(function(s){s.addTo(a.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(a){a.remove()}),this.clusterMarkers.forEach(function(a){a.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(a,s){var p=a.getLnglat(),v=p.lng,g=p.lat,x={geometry:{type:"Point",coordinates:[v,g]},properties:pg(pg({},a.getExtData()),{},{marker_id:s})};this.points.push(x),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var a=this.markerLayerOption.clusterOption,s=a.radius,p=a.minZoom,v=p===void 0?0:p,g=a.maxZoom;this.clusterIndex=new(gl())({radius:s,minZoom:v,maxZoom:g}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(a,s){var p=this,v=a[0].concat(a[1]),g=this.clusterIndex.getClusters(v,s);this.clusterMarkers.forEach(function(x){x.remove()}),this.clusterMarkers=[],g.forEach(function(x){var C,T=p.markerLayerOption.clusterOption,R=T.field,F=T.method;if(x.properties&&(C=x.properties)!==null&&C!==void 0&&C.cluster_id){var j,Y=p.getLeaves((j=x.properties)===null||j===void 0?void 0:j.cluster_id);if(x.properties.clusterData=Y,R&&F){var J=Y==null?void 0:Y.map(function(Et){var wt=(0,A.Z)({},R,Et.properties[R]);return wt}),be=Zl(J,R),Be=qf(F,be),Ye="point_"+F;x.properties[Ye]=Be.toFixed(2)}}var tt=p.clusterMarker(x);p.clusterMarkers.push(tt),tt.addTo(p.scene)})}},{key:"getLeaves",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return a?this.clusterIndex.getLeaves(a,s,p):null}},{key:"clusterMarker",value:function(a){var s=this.markerLayerOption.clusterOption,p=s,v=p.element,g=v===void 0?this.generateElement.bind(this):v,x=new cg({element:g(a)}).setLnglat({lng:a.geometry.coordinates[0],lat:a.geometry.coordinates[1]});return x}},{key:"normalMarker",value:function(a){var s=a.properties.marker_id;return this.markers[s]}},{key:"update",value:function(){if(!!this.mapsService){var a=this.mapsService.getZoom(),s=this.mapsService.getBounds();(!this.bbox||Math.abs(a-this.zoom)>=1||!Cn(this.bbox,s))&&(this.bbox=Rn(s,.5),this.zoom=Math.floor(a),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(a){var s=Za("div","l7-marker-cluster"),p=Za("div","",s),v=Za("span","",p),g=this.markerLayerOption.clusterOption,x=g.field,C=g.method;a.properties.point_count=a.properties.point_count||1;var T=x&&C?a.properties["point_"+C]||a.properties[x]:a.properties.point_count;return v.textContent=T,s}}]),r}(Es.EventEmitter);function hg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function dg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?hg(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):hg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function f2(e){var i=p2();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function p2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vg=function(e){(0,Pr.Z)(r,e);var i=f2(r);function r(n){var a;return(0,dt.Z)(this,r),a=i.call(this),(0,A.Z)((0,ue.Z)(a),"popupOption",void 0),(0,A.Z)((0,ue.Z)(a),"mapsService",void 0),(0,A.Z)((0,ue.Z)(a),"sceneSerive",void 0),(0,A.Z)((0,ue.Z)(a),"lngLat",void 0),(0,A.Z)((0,ue.Z)(a),"content",void 0),(0,A.Z)((0,ue.Z)(a),"closeButton",void 0),(0,A.Z)((0,ue.Z)(a),"timeoutInstance",void 0),(0,A.Z)((0,ue.Z)(a),"container",void 0),(0,A.Z)((0,ue.Z)(a),"tip",void 0),(0,A.Z)((0,ue.Z)(a),"scene",void 0),a.popupOption=dg(dg({},a.getdefault()),n),pl(["update","onClickClose","remove"],(0,ue.Z)(a)),a}return(0,Mt.Z)(r,[{key:"addTo",value:function(a){var s=this;return this.mapsService=a.get(Gt.IMapService),this.sceneSerive=a.get(Gt.ISceneService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=a,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){s.mapsService.on("click",s.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(a){var s=window.document.createDocumentFragment(),p=window.document.createElement("body"),v;for(p.innerHTML=a;v=p.firstChild,!!v;)s.appendChild(v);return this.setDOMContent(s)}},{key:"setLnglat",value:function(a){return this.lngLat=a,Array.isArray(a)&&(this.lngLat={lng:a[0],lat:a[1]}),this.mapsService&&(this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(a){return this.setDOMContent(window.document.createTextNode(a))}},{key:"setMaxWidth",value:function(a){return this.popupOption.maxWidth=a,this.update(),this}},{key:"setDOMContent",value:function(a){return this.createContent(),this.content.appendChild(a),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&uc(this.content),this.content=Za("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=Za("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(a,s,p){var v=window.document.createElement(a);return s!==void 0&&(v.className=s),p&&p.appendChild(v),v}},{key:"removeDom",value:function(a){a.parentNode&&a.parentNode.removeChild(a)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:Lu.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(a){a.stopPropagation&&a.stopPropagation(),this.remove()}},{key:"update",value:function(){var a=this,s=this.lngLat,p=this.popupOption,v=p.className,g=p.maxWidth,x=p.anchor;if(!(!this.mapsService||!s||!this.content)){var C=this.mapsService.getMarkerContainer();if(!this.container&&C){this.container=this.creatDom("div","l7-popup",C),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),v&&v.split(" ").forEach(function(R){return a.container.classList.add(R)});var T=this.popupOption.stopPropagation;T&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(R){a.container.addEventListener(R,function(F){F.stopPropagation()})}),this.container.style.whiteSpace="nowrap"}g&&this.container.style.maxWidth!==g&&(this.container.style.maxWidth=g),this.updatePosition(),mo(this.container,"".concat(Qu[x])),Vc(this.container,x,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var a=this.lngLat,s=a.lng,p=a.lat,v=this.popupOption.offsets,g=this.mapsService.lngLatToContainer([s,p]);this.container.style.left=g.x+v[0]+"px",this.container.style.top=g.y-v[1]+"px"}}}]),r}(Es.EventEmitter);function h2(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var p=i.createElement("style");return p.type="text/css",p.styleSheet?p.styleSheet.cssText=e:p.appendChild(i.createTextNode(e)),a.appendChild(p),p}}h2(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
}

.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 5px;
}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}

.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-left: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-bottom: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-bottom: none;
  border-left: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-bottom: none;
  border-right: none;
  border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-left: none;
  border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  padding: 0;
  font-size: 25px;
  line-height: 20px;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
  display: none;
}

.l7-popup-track-pointer * {
  pointer-events: none;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}

.l7-map:active .l7-popup-track-pointer {
  display: none;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
  border-radius: 4px;
}
.l7-bar a,
.l7-bar a:hover {
  background-color: #fff;
  width: 30px;
  height: 30px;
  font-size: 20px;
  display: block;
  text-align: center;
  text-decoration: none;
  color: #8e9dab;
}
.l7-bar a,
.l7-control-layers-toggle {
  background-position: 50% 50%;
  background-repeat: no-repeat;
  display: block;
}
.l7-bar a:hover {
  background-color: #f4f4f4;
}
.l7-bar a:first-child {
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}
.l7-bar a:last-child {
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 2px;
  border-bottom: none;
}
.l7-bar a.l7-disabled {
  cursor: default;
  background-color: #f4f4f4;
  color: #bbb;
}

/* control positioning */

.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-hide {
  display: none;
}
.l7-control {
  position: relative;
  z-index: 800;
  pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control {
  float: left;
  clear: both;
}
.l7-top,
.l7-bottom {
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-top {
  top: 0;
}
.l7-right {
  right: 0;
}
.l7-bottom {
  bottom: 0;
}
.l7-left {
  left: 0;
}
.l7-center {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-bottom.l7-center,
.l7-top.l7-center {
  width: 100%;
}
.l7-right.l7-center,
.l7-left.l7-center {
  height: 100%;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-top.l7-center,
.l7-left.l7-center {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}

.l7-bottom.l7-center,
.l7-right.l7-center {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}

.l7-center .l7-control {
  margin-right: 10px;
  margin-bottom: 10px;
}

.l7-control {
  float: left;
  clear: both;
}
.l7-right .l7-control {
  float: right;
}
.l7-top .l7-control {
  margin-top: 10px;
}
.l7-bottom .l7-control {
  margin-bottom: 10px;
}
.l7-left .l7-control {
  margin-left: 10px;
}
.l7-right .l7-control {
  margin-right: 10px;
}

/* attribution and scale controls */

.l7-control-container .l7-control-attribution {
  background: #fff;
  background: rgba(59, 58, 58, 0.7);
  margin: 0;
}
.l7-control-attribution,
.l7-control-scale-line {
  padding: 0 5px;
  color: #333;
}
.l7-control-attribution a {
  text-decoration: none;
}
.l7-control-attribution a:hover {
  text-decoration: underline;
}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
}
.l7-left .l7-control-scale {
  margin-left: 5px;
}
.l7-bottom .l7-control-scale {
  margin-bottom: 5px;
}
.l7-control-scale-line {
  border: 2px solid #000;
  border-top: none;
  color: #000;
  line-height: 1.1;
  padding: 2px 5px 1px;
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;

  background: #fff;
}
.l7-control-scale-line:not(:first-child) {
  border-top: 2px solid #777;
  border-bottom: none;
  margin-top: -2px;
}
.l7-control-scale-line:not(:first-child):not(:last-child) {
  border-bottom: 2px solid #777;
}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  border: 2px solid rgba(0, 0, 0, 0.2);
  background-clip: padding-box;
}
/*logo */

.l7-ctrl-logo {
  background-size: 100% 100%;
  width: 89px;
  height: 16px;
  margin: 0 0 -3px -3px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  background-repeat: no-repeat;
  cursor: pointer;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 2px;
}
.l7-control-layers-toggle {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
  width: 30px;
  height: 30px;
  background-size: 20px 20px;
}

.l7-touch .l7-control-layers-toggle {
  width: 44px;
  height: 44px;
}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
  display: none;
}
.l7-control-layers-expanded .l7-control-layers-list {
  display: block;
  position: relative;
}
.l7-control-layers-expanded {
  padding: 6px 10px 6px 6px;
  color: #59626b;
  background: #fff;
}
.l7-control-layers-scrollbar {
  overflow-y: scroll;
  overflow-x: hidden;
  padding-right: 5px;
}
.l7-control-layers-selector {
  margin-top: 2px;
  position: relative;
  top: 1px;
}
.l7-control-layers label {
  display: block;
  padding: 8px;
}
.l7-control-layers label input[type='radio'],
.l7-control-layers label input[type='checkbox'] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
  height: 0;
  border-top: 1px solid #d8d8d8;
  margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
}
.amap-logo {
  display: none !important;
}
`);var d2=Q(52353),v2=Q.n(d2),m2=Q(13218),Gu=Q.n(m2),rh,mg=(rh={},(0,A.Z)(rh,Tc.additive,{enable:!0,func:{srcRGB:k.ONE,dstRGB:k.ONE,srcAlpha:1,dstAlpha:1}}),(0,A.Z)(rh,Tc.none,{enable:!1}),(0,A.Z)(rh,Tc.normal,{enable:!0,func:{srcRGB:k.SRC_ALPHA,dstRGB:k.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,A.Z)(rh,Tc.subtractive,{enable:!0,func:{srcRGB:k.ONE,dstRGB:k.ONE,srcAlpha:k.ZERO,dstAlpha:k.ONE_MINUS_SRC_COLOR},equation:{rgb:k.FUNC_SUBTRACT,alpha:k.FUNC_SUBTRACT}}),(0,A.Z)(rh,Tc.max,{enable:!0,func:{srcRGB:k.ONE,dstRGB:k.ONE},equation:{rgb:k.MAX_EXT}}),(0,A.Z)(rh,Tc.min,{enable:!0,func:{srcRGB:k.ONE,dstRGB:k.ONE},equation:{rgb:k.MIN_EXT}}),rh),g2=Q(81763),ha=Q.n(g2),q3=1024;function nl(e,i,r,n,a){i.updateStyleAttribute(e,r,n,a)}function y2(e,i){e.opacity&&F0("opacity",i,e.opacity),e.strokeWidth&&F0("strokeWidth",i,e.strokeWidth),e.strokeOpacity&&F0("strokeOpacity",i,e.strokeOpacity),e.stroke&&_2("stroke",i,e.stroke),e.offsets&&gg("offsets",i,e.offsets),e.textOffset&&gg("textOffset",i,e.textOffset),e.thetaOffset&&F0("thetaOffset",i,e.thetaOffset)}function F0(e,i,r){w()(r)?nl(e,i,r,function(n){return n}):ha()(r)?nl(e,i,[r],void 0):Array.isArray(r)&&r.length===2?w()(r[0])&&L()(r[1])||w()(r[0])&&Array.isArray(r[1])&&ha()(r[1][0])&&ha()(r[1][1])?nl(e,i,r[0],r[1]):nl(e,i,[1],void 0):nl(e,i,[1],void 0)}function gg(e,i,r){w()(r)?nl(e,i,r,function(n){return n}):Array.isArray(r)&&r.length===2&&w()(r[0])&&L()(r[1])?nl(e,i,r[0],r[1]):Array.isArray(r)&&r.length===2&&ha()(r[0])&&ha()(r[1])?nl(e,i,r,void 0):nl(e,i,[0,0],void 0)}function _2(e,i,r){w()(r)?nl(e,i,r,void 0):Array.isArray(r)&&r.length===2&&(w()(r[0])&&L()(r[1])||w()(r[0])&&Array.isArray(r[1])&&r[1].length>0)?nl(e,i,r[0],r[1]):nl(e,i,"#fff",void 0)}var Rs;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL"})(Rs||(Rs={}));function x2(e,i){var r=[i[0]-e[0],i[1]-e[1]],n=$o(r),a=[e[0]+n[0]*1e-4,e[1]+n[1]*1e-4];return a}function b2(e,i){var r=this;e.length>0&&i.version===Rs["GAODE2.x"]&&(typeof e[0].coordinates[0]=="number"?e.filter(function(n){return!n.originCoordinates}).map(function(n){n.version=Rs["GAODE2.x"],n.originCoordinates=cloneDeep(n.coordinates),n.coordinates=r.mapService.lngLatToCoord(n.coordinates)}):e.filter(function(n){return!n.originCoordinates}).map(function(n){n.version=Rs["GAODE2.x"],n.originCoordinates=cloneDeep(n.coordinates),n.coordinates=r.mapService.lngLatToCoords(n.coordinates)}))}function E2(e,i){e.length>0&&i.version===Rs.SIMPLE&&e.map(function(r){r.simpleCoordinate||(r.coordinates=S2(r.coordinates,i),r.simpleCoordinate=!0)})}function S2(e,i){if(typeof e[0]=="number")return i.simpleMapCoord.unproject(e);if(e[0]&&e[0][0]instanceof Array){var r=[];return e.map(function(a){var s=[];a.map(function(p){s.push(i.simpleMapCoord.unproject(p))}),r.push(s)}),r}else{var n=[];return e.map(function(a){n.push(i.simpleMapCoord.unproject(a))}),n}}function C2(e,i,r){var n;if(!e.scale)return[];var a=(e==null||(n=e.scale)===null||n===void 0?void 0:n.scalers)||[],s=[];a.forEach(function(v){var g,x=v.field;(i.hasOwnProperty(x)||((g=e.scale)===null||g===void 0?void 0:g.type)==="variable")&&s.push(i[x])});var p=e.mapping?e.mapping(s):[];return e.name==="color"&&!vu(p[0])?[r]:p}function A2(e,i,r,n,a,s){var p=s==null?void 0:s.getLayerConfig(),v=p.arrow,g=v===void 0?{enable:!1}:v,x=i.map(function(C){var T={id:C._id,coordinates:C.coordinates};if(e.filter(function(j){return j.scale!==void 0}).forEach(function(j){var Y=C2(j,C,a);j.needRemapping=!1,j.name==="color"&&(Y=Y.map(function(J){return _i(J)})),T[j.name]=Array.isArray(Y)&&Y.length===1?Y[0]:Y,j.name==="shape"&&(T.shape=r.getIconFontKey(T[j.name]))}),T.shape==="line"&&g.enable){var R=T.coordinates,F=x2(R[0],R[1]);T.coordinates.splice(1,0,F,F)}return T});return b2(x,n),E2(x,n),x}function w2(e,i,r,n,a,s){var p=new fh(a,s),v=e.getBottomColor(),g=n.getLayerStyleAttributes()||[],x=p.data.dataArray,C=x,T=A2(g,C,i,r,v,e);return p.destroy(),T}function yg(e){return e.map(function(i){return typeof i=="string"&&(i=[i,{}]),i})}function _g(e,i,r,n){var a=e.multiPassRenderer,s=e.getLayerConfig(),p=s.enablePicking,v=s.enableTAA;return v?a.add(n("taa")):a.add(n("render")),yg(i).forEach(function(g){var x=(0,gn.Z)(g,2),C=x[0],T=x[1];a.add(r(C),T)}),a.add(r("copy")),a}var T2=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]];function M2(e,i,r){if(typeof i=="string"&&typeof r=="string"&&i!==r){if(e.type==="PointLayer"){e.dataState.dataSourceNeedUpdate=!0;return}T2.map(function(n){if(n.includes(i)&&n.includes(r)){e.dataState.dataSourceNeedUpdate=!0;return}})}}var P2=["passes"],I2=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber"],xg,Ov,bg;function O2(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=R2(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function R2(e,i){if(!!e){if(typeof e=="string")return Eg(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Eg(e,i)}}function Eg(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Sg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Hu(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Sg(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Sg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function k2(e){var i=L2();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function L2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Cg=0,nh=(xg=Pv(Gt.IGlobalConfigService),Ov=function(e){(0,Pr.Z)(r,e);var i=k2(r);function r(){var n,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,dt.Z)(this,r),n=i.call(this),(0,A.Z)((0,ue.Z)(n),"id","".concat(Cg++)),(0,A.Z)((0,ue.Z)(n),"name","".concat(Cg)),(0,A.Z)((0,ue.Z)(n),"type",void 0),(0,A.Z)((0,ue.Z)(n),"visible",!0),(0,A.Z)((0,ue.Z)(n),"zIndex",0),(0,A.Z)((0,ue.Z)(n),"minZoom",void 0),(0,A.Z)((0,ue.Z)(n),"maxZoom",void 0),(0,A.Z)((0,ue.Z)(n),"inited",!1),(0,A.Z)((0,ue.Z)(n),"layerModelNeedUpdate",!1),(0,A.Z)((0,ue.Z)(n),"pickedFeatureID",null),(0,A.Z)((0,ue.Z)(n),"selectedFeatureID",null),(0,A.Z)((0,ue.Z)(n),"styleNeedUpdate",!1),(0,A.Z)((0,ue.Z)(n),"rendering",void 0),(0,A.Z)((0,ue.Z)(n),"clusterZoom",0),(0,A.Z)((0,ue.Z)(n),"layerType",void 0),(0,A.Z)((0,ue.Z)(n),"isLayerGroup",!1),(0,A.Z)((0,ue.Z)(n),"triangulation",void 0),(0,A.Z)((0,ue.Z)(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,A.Z)((0,ue.Z)(n),"hooks",{init:new Os,afterInit:new Os,beforeRender:new Os,beforeRenderData:new mu,afterRender:new Da,beforePickingEncode:new Da,afterPickingEncode:new Da,beforeHighlight:new Da(["pickedColor"]),afterHighlight:new Da,beforeSelect:new Da(["pickedColor"]),afterSelect:new Da,beforeDestroy:new Da,afterDestroy:new Da}),(0,A.Z)((0,ue.Z)(n),"models",[]),(0,A.Z)((0,ue.Z)(n),"multiPassRenderer",void 0),(0,A.Z)((0,ue.Z)(n),"plugins",void 0),(0,A.Z)((0,ue.Z)(n),"sourceOption",void 0),(0,A.Z)((0,ue.Z)(n),"layerModel",void 0),(0,A.Z)((0,ue.Z)(n),"shapeOption",void 0),(0,A.Z)((0,ue.Z)(n),"sceneContainer",void 0),(0,A.Z)((0,ue.Z)(n),"layerChildren",[]),(0,A.Z)((0,ue.Z)(n),"masks",[]),Bn((0,ue.Z)(n),"configService",bg,(0,ue.Z)(n)),(0,A.Z)((0,ue.Z)(n),"shaderModuleService",void 0),(0,A.Z)((0,ue.Z)(n),"cameraService",void 0),(0,A.Z)((0,ue.Z)(n),"coordinateService",void 0),(0,A.Z)((0,ue.Z)(n),"iconService",void 0),(0,A.Z)((0,ue.Z)(n),"fontService",void 0),(0,A.Z)((0,ue.Z)(n),"pickingService",void 0),(0,A.Z)((0,ue.Z)(n),"rendererService",void 0),(0,A.Z)((0,ue.Z)(n),"layerService",void 0),(0,A.Z)((0,ue.Z)(n),"interactionService",void 0),(0,A.Z)((0,ue.Z)(n),"mapService",void 0),(0,A.Z)((0,ue.Z)(n),"styleAttributeService",void 0),(0,A.Z)((0,ue.Z)(n),"layerSource",void 0),(0,A.Z)((0,ue.Z)(n),"postProcessingPassFactory",void 0),(0,A.Z)((0,ue.Z)(n),"normalPassFactory",void 0),(0,A.Z)((0,ue.Z)(n),"animateOptions",{enable:!1}),(0,A.Z)((0,ue.Z)(n),"container",void 0),(0,A.Z)((0,ue.Z)(n),"encodedData",void 0),(0,A.Z)((0,ue.Z)(n),"configSchema",void 0),(0,A.Z)((0,ue.Z)(n),"currentPickId",null),(0,A.Z)((0,ue.Z)(n),"rawConfig",void 0),(0,A.Z)((0,ue.Z)(n),"needUpdateConfig",void 0),(0,A.Z)((0,ue.Z)(n),"pendingStyleAttributes",[]),(0,A.Z)((0,ue.Z)(n),"scaleOptions",{}),(0,A.Z)((0,ue.Z)(n),"animateStartTime",void 0),(0,A.Z)((0,ue.Z)(n),"aniamateStatus",!1),(0,A.Z)((0,ue.Z)(n),"bottomColor","rgba(0, 0, 0, 0)"),(0,A.Z)((0,ue.Z)(n),"isDestroied",!1),(0,A.Z)((0,ue.Z)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var s=n.getLayerConfig(),p=s.autoFit,v=s.fitBoundsOptions;p&&n.fitBounds(v),n.reRender()}),n.name=a.name||n.id,n.zIndex=a.zIndex||0,n.rawConfig=a,n}return(0,Mt.Z)(r,[{key:"addMaskLayer",value:function(a){this.masks.push(a)}},{key:"removeMaskLayer",value:function(a){var s=this.masks.indexOf(a);s>-1&&this.masks.splice(s,1),a.destroy()}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(a){if(!this.inited)this.needUpdateConfig=Hu(Hu({},this.needUpdateConfig),a);else{var s=this.container.get(Gt.SceneID);y2(a,this),this.configService.setLayerConfig(s,this.id,Hu(Hu(Hu({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),a)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(a,s){this.container=a,this.sceneContainer=s}},{key:"getContainer",value:function(){return this.container}},{key:"setBottomColor",value:function(a){this.bottomColor=a}},{key:"getBottomColor",value:function(){return this.bottomColor}},{key:"addPlugin",value:function(a){return this.plugins.push(a),this}},{key:"init",value:function(){var a=this,s=this.container.get(Gt.SceneID);this.configService.setLayerConfig(s,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(Gt.IIconService),this.fontService=this.container.get(Gt.IFontService),this.rendererService=this.container.get(Gt.IRendererService),this.layerService=this.container.get(Gt.ILayerService),this.interactionService=this.container.get(Gt.IInteractionService),this.pickingService=this.container.get(Gt.IPickingService),this.mapService=this.container.get(Gt.IMapService);var p=this.getLayerConfig(),v=p.enableMultiPassRenderer,g=p.passes;v&&g!==null&&g!==void 0&&g.length&&g.length>0&&this.mapService.on("mapAfterFrameChange",function(){a.renderLayers()}),this.cameraService=this.container.get(Gt.ICameraService),this.coordinateService=this.container.get(Gt.ICoordinateSystemService),this.shaderModuleService=this.container.get(Gt.IShaderModuleService),this.postProcessingPassFactory=this.container.get(Gt.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(Gt.IFactoryNormalPass),this.styleAttributeService=this.container.get(Gt.IStyleAttributeService),this.multiPassRenderer=this.container.get(Gt.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(R){var F=R.attributeName,j=R.attributeField,Y=R.attributeValues,J=R.updateOptions;a.styleAttributeService.updateStyleAttribute(F,{scale:Hu({field:j},a.splitValuesAndCallbackInAttribute(Y,a.getLayerConfig()[F]))},J)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(Gt.ILayerPlugin);var x=O2(this.plugins),C;try{for(x.s();!(C=x.n()).done;){var T=C.value;T.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(R){x.e(R)}finally{x.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"updateModelData",value:function(a){a.attributes&&a.elements?this.models.map(function(s){s.updateAttributesAndElements(a.attributes,a.elements)}):console.warn("data error")}},{key:"createModelData",value:function(a,s){if(this.layerModel.createModelData)return this.layerModel.createModelData(s);var p=this.calculateEncodeData(a,s),v=this.triangulation;return p&&v?this.styleAttributeService.createAttributesAndIndices(p,v):{attributes:void 0,elements:void 0}}},{key:"calculateEncodeData",value:function(a,s){return this.inited?w2(this,this.fontService,this.mapService,this.styleAttributeService,a,s):(console.warn("layer not inited!"),null)}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(Hu(Hu({},this.getDefaultConfig()),this.rawConfig));var a=this.getLayerConfig(),s=a.animateOption;s!=null&&s.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(a,s,p){return this.updateStyleAttribute("color",a,s,p),this}},{key:"texture",value:function(a,s,p){return this.updateStyleAttribute("texture",a,s,p),this}},{key:"rotate",value:function(a,s,p){return this.updateStyleAttribute("rotate",a,s,p),this}},{key:"size",value:function(a,s,p){return this.updateStyleAttribute("size",a,s,p),this}},{key:"filter",value:function(a,s,p){return this.updateStyleAttribute("filter",a,s,p),this}},{key:"shape",value:function(a,s,p){var v,g,x,C=(v=this.styleAttributeService)===null||v===void 0||(g=v.getLayerStyleAttribute("shape"))===null||g===void 0||(x=g.scale)===null||x===void 0?void 0:x.field,T=a;return this.shapeOption={field:a,values:s},this.updateStyleAttribute("shape",a,s,p),M2(this,C,T),this}},{key:"label",value:function(a,s,p){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:a,attributeValues:s,updateOptions:p}),this}},{key:"animate",value:function(a){var s={};return Gu()(a)?(s.enable=!0,s=Hu(Hu({},s),a)):s.enable=a,this.updateLayerConfig({animateOption:s}),this}},{key:"source",value:function(a,s){return a!=null&&a.data?(this.setSource(a),this):(this.sourceOption={data:a,options:s},this.clusterZoom=0,this)}},{key:"setData",value:function(a,s){var p=this;return this.inited?this.layerSource.setData(a,s):this.on("inited",function(){var v=p.getSource();v?p.layerSource.setData(a,s):(p.source(new fh(a,s)),p.sourceEvent())}),this}},{key:"style",value:function(a){var s=this,p=this.getLayerConfig(),v=a.passes,g=(0,to.Z)(a,P2);return v&&yg(v).forEach(function(x){var C=s.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(x[0]);C&&C.updateOptions(x[1])}),this.rawConfig=Hu(Hu({},this.rawConfig),g),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),p&&p.mask===!0&&a.mask===!1&&(this.clearModels(),this.models=this.layerModel.buildModels()),this}},{key:"scale",value:function(a,s){return Gu()(a)?this.scaleOptions=Hu(Hu({},this.scaleOptions),a):this.scaleOptions[a]=s,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.getEncodedData().length!==0&&this.renderModels(),this}},{key:"renderMultiPass",value:function(){var n=(0,Z.Z)(q().mark(function s(){return q().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(this.getEncodedData().length===0){v.next=7;break}if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){v.next=6;break}return v.next=4,this.multiPassRenderer.render();case 4:v.next=7;break;case 6:this.multiPassRenderer?this.renderModels():this.renderModels();case 7:case"end":return v.stop()}},s,this)}));function a(){return n.apply(this,arguments)}return a}()},{key:"active",value:function(a){var s={};return s.enableHighlight=Gu()(a)?!0:a,Gu()(a)?(s.enableHighlight=!0,a.color&&(s.highlightColor=a.color),a.mix&&(s.activeMix=a.mix)):s.enableHighlight=!!a,this.updateLayerConfig(s),this}},{key:"setActive",value:function(a,s){var p=this;if(Gu()(a)){var v=a.x,g=v===void 0?0:v,x=a.y,C=x===void 0?0:x;this.updateLayerConfig({highlightColor:Gu()(s)?s.color:this.getLayerConfig().highlightColor,activeMix:Gu()(s)?s.mix:this.getLayerConfig().activeMix}),this.pick({x:g,y:C})}else this.updateLayerConfig({pickedFeatureID:a,highlightColor:Gu()(s)?s.color:this.getLayerConfig().highlightColor,activeMix:Gu()(s)?s.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call(Ps(a)).then(function(){setTimeout(function(){p.reRender()},1)})}},{key:"select",value:function(a){var s={};return s.enableSelect=Gu()(a)?!0:a,Gu()(a)?(s.enableSelect=!0,a.color&&(s.selectColor=a.color),a.mix&&(s.selectMix=a.mix)):s.enableSelect=!!a,this.updateLayerConfig(s),this}},{key:"setSelect",value:function(a,s){var p=this;if(Gu()(a)){var v=a.x,g=v===void 0?0:v,x=a.y,C=x===void 0?0:x;this.updateLayerConfig({selectColor:Gu()(s)?s.color:this.getLayerConfig().selectColor,selectMix:Gu()(s)?s.mix:this.getLayerConfig().selectMix}),this.pick({x:g,y:C})}else this.updateLayerConfig({pickedFeatureID:a,selectColor:Gu()(s)?s.color:this.getLayerConfig().selectColor,selectMix:Gu()(s)?s.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(Ps(a)).then(function(){setTimeout(function(){p.reRender()},1)})}},{key:"setBlend",value:function(a){return this.updateLayerConfig({blend:a}),this.layerModelNeedUpdate=!0,this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.type==="CanvasLayer"&&this.layerModel.clearCanvas&&this.layerModel.clearCanvas(),this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(a){return this.zIndex=a,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(a){this.currentPickId=a}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(a){this.selectedFeatureID=a}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var a=this.mapService.getZoom(),s=this.getLayerConfig(),p=s.visible,v=s.minZoom,g=v===void 0?-Infinity:v,x=s.maxZoom,C=x===void 0?Infinity:x;return!!p&&a>=g&&a<=C}},{key:"setMultiPass",value:function(a,s){if(this.updateLayerConfig({enableMultiPassRenderer:a}),s&&this.updateLayerConfig({passes:s}),a){var p=this.getLayerConfig(),v=p.passes,g=v===void 0?[]:v;this.multiPassRenderer=_g(this,g,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var x=this.rendererService.getViewportSize(),C=x.width,T=x.height;this.multiPassRenderer.resize(C,T)}return this}},{key:"setMinZoom",value:function(a){return this.updateLayerConfig({minZoom:a}),this}},{key:"getMinZoom",value:function(){var a=this.getLayerConfig(),s=a.minZoom;return s}},{key:"getMaxZoom",value:function(){var a=this.getLayerConfig(),s=a.maxZoom;return s}},{key:"get",value:function(a){var s=this.getLayerConfig();return s[a]}},{key:"setMaxZoom",value:function(a){return this.updateLayerConfig({maxZoom:a}),this}},{key:"setAutoFit",value:function(a){return this.updateLayerConfig({autoFit:a}),this}},{key:"fitBounds",value:function(a){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var s=this.getSource(),p=s.extent,v=p.some(function(g){return Math.abs(g)===Infinity});return v?this:(this.mapService.fitBounds([[p[0],p[1]],[p[2],p[3]]],a),this)}},{key:"destroy",value:function(){var a;this.isDestroied||(this.layerChildren.map(function(s){return s.destroy()}),this.layerChildren=[],this.masks.map(function(s){return s.destroy()}),this.masks=[],this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(a=this.layerModel)===null||a===void 0||a.clearModels(),this.models=[],this.layerService.cleanRemove(this),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroied=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(a){return a.destroy()}),this.layerModel.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(a){return a.needRescale||a.needRemapping||a.needRegenerateVertices}).length}},{key:"setSource",value:function(a){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=a,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var s=this.mapService.getZoom();this.layerSource.updateClusterData(s)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(a){this.encodedData=a}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(a){return this.styleAttributeService.getLayerAttributeScale(a)}},{key:"getLegendItems",value:function(a){var s=this.styleAttributeService.getLayerAttributeScale(a);if(!s)return[];if(s.invertExtent){var p=s.range().map(function(x){return(0,A.Z)({value:s.invertExtent(x)},a,x)});return p}else if(s.ticks){var v=s.ticks().map(function(x){return(0,A.Z)({value:x},a,s(x))});return v}else if(s!=null&&s.domain){var g=s.domain().filter(function(x){return!v2()(x)}).map(function(x){return(0,A.Z)({value:x},a,s(x))});return g}return[]}},{key:"pick",value:function(a){var s=a.x,p=a.y;this.interactionService.triggerHover({x:s,y:p})}},{key:"boxSelect",value:function(a,s){this.pickingService.boxPickLayer(this,a,s)}},{key:"buildLayerModel",value:function(a){var s=a.moduleName,p=a.vertexShader,v=a.fragmentShader,g=a.triangulation,x=a.segmentNumber,C=(0,to.Z)(a,I2);this.shaderModuleService.registerModule(s,{vs:p,fs:v});var T=this.shaderModuleService.getModule(s),R=T.vs,F=T.fs,j=T.uniforms,Y=this.rendererService.createModel,J=this.styleAttributeService.createAttributesAndIndices(this.encodedData,g,x),be=J.attributes,Be=J.elements;return Y(Hu({attributes:be,uniforms:j,fs:F,vs:R,elements:Be,blend:mg[Tc.normal]},C))}},{key:"createAttrubutes",value:function(a){var s=a.triangulation,p=this.styleAttributeService.createAttributes(this.encodedData,s),v=p.attributes;return v}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(a){var s=this.getLayerConfig(),p=s.enableHighlight,v=p===void 0?!0:p,g=s.enableSelect,x=g===void 0?!0:g,C=this.eventNames().indexOf(a)!==-1||this.eventNames().indexOf("un"+a)!==-1;return(a==="click"||a==="dblclick")&&x&&(C=!0),a==="mousemove"&&(v||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(C=!0),this.isVisible()&&C}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderMulPass",value:function(){var n=(0,Z.Z)(q().mark(function s(p){return q().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,p.render();case 2:case"end":return g.stop()}},s)}));function a(s){return n.apply(this,arguments)}return a}()},{key:"renderModels",value:function(a){var s=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.layerModel.renderUpdate&&this.layerModel.renderUpdate(),this.models.forEach(function(p){p.draw({uniforms:s.layerModel.getUninforms()},a)})),this}},{key:"updateStyleAttribute",value:function(a,s,p,v){this.inited?this.styleAttributeService.updateStyleAttribute(a,{scale:Hu({field:s},this.splitValuesAndCallbackInAttribute(p,this.getLayerConfig()[s]))},v):this.pendingStyleAttributes.push({attributeName:a,attributeField:s,attributeValues:p,updateOptions:v})}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(a){console.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&(this.layerService.updateLayerRenderList(),this.layerService.renderLayers())}},{key:"splitValuesAndCallbackInAttribute",value:function(a,s){return{values:L()(a)?void 0:a||s,callback:L()(a)?a:void 0}}}]),r}(Es.EventEmitter),bg=ai(Ov.prototype,"configService",[xg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ov),D2=Q(18446),dd=Q.n(D2),Ag,Rv,wg;function F2(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=B2(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function B2(e,i){if(!!e){if(typeof e=="string")return Tg(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Tg(e,i)}}function Tg(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var xo=(Ag=Pv(Gt.IGlobalConfigService),Rv=function(){function e(i){(0,dt.Z)(this,e),(0,A.Z)(this,"triangulation",void 0),(0,A.Z)(this,"createTexture2D",void 0),(0,A.Z)(this,"layer",void 0),(0,A.Z)(this,"dataTexture",void 0),(0,A.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,A.Z)(this,"rowCount",void 0),(0,A.Z)(this,"cacheStyleProperties",void 0),(0,A.Z)(this,"cellLength",void 0),(0,A.Z)(this,"cellProperties",void 0),(0,A.Z)(this,"cellTypeLayout",void 0),(0,A.Z)(this,"stylePropertyesExist",void 0),(0,A.Z)(this,"dataTextureTest",void 0),Bn(this,"configService",wg,this),(0,A.Z)(this,"shaderModuleService",void 0),(0,A.Z)(this,"rendererService",void 0),(0,A.Z)(this,"iconService",void 0),(0,A.Z)(this,"fontService",void 0),(0,A.Z)(this,"styleAttributeService",void 0),(0,A.Z)(this,"mapService",void 0),(0,A.Z)(this,"cameraService",void 0),(0,A.Z)(this,"layerService",void 0),this.layer=i,this.rendererService=i.getContainer().get(Gt.IRendererService),this.shaderModuleService=i.getContainer().get(Gt.IShaderModuleService),this.styleAttributeService=i.getContainer().get(Gt.IStyleAttributeService),this.mapService=i.getContainer().get(Gt.IMapService),this.iconService=i.getContainer().get(Gt.IIconService),this.fontService=i.getContainer().get(Gt.IFontService),this.cameraService=i.getContainer().get(Gt.ICameraService),this.layerService=i.getContainer().get(Gt.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var r=this.rendererService.createTexture2D;this.createTexture2D=r,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8Array(4),mag:k.NEAREST,min:k.NEAREST,width:1,height:1}))}return(0,Mt.Z)(e,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,this.stylePropertyesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(r){var n=!1;return dd()(r.thetaOffset,this.cacheStyleProperties.thetaOffset)||(n=!0,this.cacheStyleProperties.thetaOffset=r.thetaOffset),dd()(r.opacity,this.cacheStyleProperties.opacity)||(n=!0,this.cacheStyleProperties.opacity=r.opacity),dd()(r.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(n=!0,this.cacheStyleProperties.strokeOpacity=r.strokeOpacity),dd()(r.strokeWidth,this.cacheStyleProperties.strokeWidth)||(n=!0,this.cacheStyleProperties.strokeWidth=r.strokeWidth),dd()(r.stroke,this.cacheStyleProperties.stroke)||(n=!0,this.cacheStyleProperties.stroke=r.stroke),dd()(r.offsets,this.cacheStyleProperties.offsets)||(n=!0,this.cacheStyleProperties.offsets=r.offsets),this.dataTexture===void 0&&(n=!0),n}},{key:"judgeStyleAttributes",value:function(r){this.clearLastCalRes(),r.opacity!==void 0&&!ha()(r.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),r.strokeOpacity!==void 0&&!ha()(r.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),r.strokeWidth!==void 0&&!ha()(r.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),r.stroke!==void 0&&!this.isStaticColor(r.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),r.offsets!==void 0&&!this.isOffsetStatic(r.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2),r.thetaOffset!==void 0&&!ha()(r.thetaOffset)&&(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertyesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(r){return w()(r)?!!(0,Qs.ZP)(r):!1}},{key:"getStrokeColor",value:function(r){if(this.isStaticColor(r)){var n=_i(r);return n[0]=n[0]?n[0]:0,n[1]=n[1]?n[1]:0,n[2]=n[2]?n[2]:0,n[3]=n[3]?n[3]:0,n}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(r){return!!(Array.isArray(r)&&r.length===2&&ha()(r[0])&&ha()(r[1]))}},{key:"patchMod",value:function(r,n){for(var a=0;a<n;a++)r.push(-1)}},{key:"patchData",value:function(r,n,a){var s=F2(a),p;try{for(s.s();!(p=s.n()).done;){var v=p.value,g=v.attr,x=v.count,C=n[g];C!==void 0?g==="stroke"?r.push.apply(r,(0,Se.Z)(_i(C))):g==="offsets"?this.isOffsetStatic(C)?r.push(-C[0],C[1]):r.push(0,0):r.push(ha()(C)?C:1):this.patchMod(r,x)}}catch(T){s.e(T)}finally{s.f()}}},{key:"calDataFrame",value:function(r,n,a){for(var s=n.length,p=Math.ceil(s*r/this.DATA_TEXTURE_WIDTH),v=p*this.DATA_TEXTURE_WIDTH,g=[],x=0;x<s;x++){var C=n[x];this.patchData(g,C,a)}for(var T=g.length;T<v;T++)g.push(-1);return{data:g,width:this.DATA_TEXTURE_WIDTH,height:p}}},{key:"getBlend",value:function(){var r=this.layer.getLayerConfig(),n=r.blend,a=n===void 0?"normal":n;return mg[Tc[a]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.duration||4,r.interval||.2,r.trailLength||.1]}},{key:"startModelAnimate",value:function(){var r=this.layer.getLayerConfig(),n=r.animateOption;n.enable&&this.layer.setAnimateStartTime()}}]),e}(),wg=ai(Rv.prototype,"configService",[Ag],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rv),N2=Q(9187),Ff=Q.n(N2),Mg=100,K3=36,$3=40;function Pg(e){return e/180*Math.acos(-1)}function Ig(e){var i=Pg(e[0])+Math.PI/2,r=Pg(e[1]),n=Mg+Math.random()*.4,a=n*Math.cos(r)*Math.cos(i),s=n*Math.cos(r)*Math.sin(i),p=n*Math.sin(r);return[s,p,a]}function Q3(e,i){var r=mat4.create(),n=mat4.create(),a=vec3.fromValues(0,1,0),s=vec3.fromValues(0,0,0);i=i||{},e=typeof e!="undefined"?e:1;for(var p=typeof i.segments!="undefined"?i.segments:32,v=2+p,g=2*v,x=[],C=[],T=[],R=[],F=[],j=[],Y=0;Y<=v;Y++){for(var J=Y/v,be=J*Math.PI,Be=0;Be<=g;Be++){var Ye=Be/g,tt=Ye*Math.PI*2;mat4.identity(n),mat4.rotateZ(n,n,-be),mat4.identity(r),mat4.rotateY(r,r,tt),vec3.transformMat4(s,a,n),vec3.transformMat4(s,s,r),vec3.scale(s,s,-e),T.push(s.slice()),R.push.apply(R,_toConsumableArray(s.slice())),vec3.normalize(s,s),F.push.apply(F,_toConsumableArray(s.slice())),j.push([Ye,1-J]),R.push(Ye,1-J)}if(Y>0)for(var Et=T.length,wt=Et-2*(g+1);wt+g+2<Et;wt++)x.push([wt,wt+1,wt+g+1]),C.push(wt,wt+1,wt+g+1),x.push([wt+g+1,wt+1,wt+g+2]),C.push(wt+g+1,wt+1,wt+g+2)}return{cells:x,positions:T,uvs:j,positionsArr:R,indicesArr:C,normalArr:F}}var xi=Q(31437),B0=xi.create(),J3=xi.create(),Gs=xi.create(),ih=xi.create(),vd=xi.create();function kv(e,i,r,n,a){xi.add(e,r,n),xi.normalize(e,e),i=xi.fromValues(-e[1],e[0]);var s=xi.fromValues(-r[1],r[0]);return[a/xi.dot(i,s),i]}function ah(e,i){return xi.set(e,-i[1],i[0])}function md(e,i,r){return xi.sub(e,i,r),xi.normalize(e,e),e}function Lv(e,i){return e[0]===i[0]&&e[1]===i[1]}function eP(e){for(var i=new Map,r=0;r<e.length;r++){var n=e[0].toString()+"-"+e[1].toString();i.get(n)?(e.splice(r,1),r++):i.set(n,n)}return e}var Og=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,dt.Z)(this,e),(0,A.Z)(this,"complex",void 0),(0,A.Z)(this,"join",void 0),(0,A.Z)(this,"cap",void 0),(0,A.Z)(this,"miterLimit",void 0),(0,A.Z)(this,"thickness",void 0),(0,A.Z)(this,"normal",void 0),(0,A.Z)(this,"lastFlip",-1),(0,A.Z)(this,"miter",xi.fromValues(0,0)),(0,A.Z)(this,"started",!1),(0,A.Z)(this,"dash",!1),(0,A.Z)(this,"totalDistance",0),(0,A.Z)(this,"currentIndex",0),this.join=i.join||"miter",this.cap=i.cap||"butt",this.miterLimit=i.miterLimit||10,this.thickness=i.thickness||1,this.dash=i.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,Mt.Z)(e,[{key:"extrude_gaode2",value:function(r,n){var a=this.complex;if(r.length<=1)return a;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var s=r.length,p=a.startIndex,v=1;v<s;v++){var g,x,C,T=r[v-1];T.push((g=n[v-1][2])!==null&&g!==void 0?g:0);var R=n[v-1],F=r[v];F.push((x=n[v][2])!==null&&x!==void 0?x:0);var j=n[v],Y=v<r.length-1?[].concat((0,Se.Z)(r[v+1]),[(C=n[v+1][2])!==null&&C!==void 0?C:0]):null,J=v<n.length-1?n[v+1]:null,be=this.segment_gaode2(a,p,T,F,Y,R,j,J);p+=be}if(this.dash)for(var Be=0;Be<a.positions.length/6;Be++)a.positions[Be*6+5]=this.totalDistance;return a.startIndex=a.positions.length/6,a}},{key:"simpleExtrude_gaode2",value:function(r,n){var a=this.complex;if(r.length<=1)return a;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var s=r.length,p=a.startIndex,v=1;v<s;v++){var g,x,C,T=r[v-1];T.push((g=n[v-1][2])!==null&&g!==void 0?g:0);var R=n[v-1],F=r[v];F.push((x=n[v][2])!==null&&x!==void 0?x:0);var j=n[v],Y=v<r.length-1?[].concat((0,Se.Z)(r[v+1]),[(C=n[v+1][2])!==null&&C!==void 0?C:0]):null,J=v<n.length-1?n[v+1]:null,be=this.simpleSegment(a,p,T,F,Y,R,j,J);p+=be}if(this.dash)for(var Be=0;Be<a.positions.length/6;Be++)a.positions[Be*6+5]=this.totalDistance;return a.startIndex=a.positions.length/6,a}},{key:"extrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=r.length,s=n.startIndex,p=1;p<a;p++){var v=r[p-1],g=r[p],x=p<r.length-1?r[p+1]:null,C=this.segment(n,s,v,g,x);s+=C}if(this.dash)for(var T=0;T<n.positions.length/6;T++)n.positions[T*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=r.length,s=n.startIndex,p=1;p<a;p++){var v=r[p-1],g=r[p],x=p<r.length-1?r[p+1]:null,C=this.simpleSegment(n,s,v,g,x);s+=C}if(this.dash)for(var T=0;T<n.positions.length/6;T++)n.positions[T*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(r,n,a,s,p,v,g,x){var C=0,T=r.indices,R=r.positions,F=r.normals,j=this.cap==="square",Y=this.join==="bevel",J=ns([g[0],g[1]]),be=ns([v[0],v[1]]);md(Gs,s,a);var Be=0;if(this.dash&&(Be=this.lineSegmentDistance(J,be),this.totalDistance+=Be),this.normal||(this.normal=xi.create(),ah(this.normal,Gs)),!this.started)if(this.started=!0,j){var Ye=xi.create(),tt=xi.create();xi.add(Ye,this.normal,Gs),xi.add(tt,this.normal,Gs),F.push(tt[0],tt[1],0),F.push(Ye[0],Ye[1],0),R.push(a[0],a[1],a[2]|0,this.totalDistance-Be,-this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),R.push(a[0],a[1],a[2]|0,this.totalDistance-Be,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(R,F,a,this.normal,this.thickness,this.totalDistance-Be);if(T.push(n+0,n+1,n+2),p){Lv(s,p)&&xi.add(p,s,xi.normalize(p,xi.subtract(p,s,a))),md(ih,p,s);var Yt=kv(vd,xi.create(),Gs,ih,this.thickness),ar=(0,gn.Z)(Yt,2),Mr=ar[0],Qr=ar[1],br=xi.dot(vd,this.normal)<0?-1:1,vn=Y;if(!vn&&this.join==="miter"){var Pn=Mr;Pn>this.miterLimit&&(vn=!0)}vn?(F.push(this.normal[0],this.normal[1],0),F.push(Qr[0],Qr[1],0),R.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*br,s[2]|0),this.complex.indexes.push(this.currentIndex),R.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness*br,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,T.push.apply(T,(0,Se.Z)(this.lastFlip!==-br?[n,n+2,n+3]:[n+2,n+1,n+3])),T.push(n+2,n+3,n+4),ah(B0,ih),xi.copy(this.normal,B0),F.push(this.normal[0],this.normal[1],0),R.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*br,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,C+=3):(this.extrusions(R,F,s,Qr,Mr,this.totalDistance),T.push.apply(T,(0,Se.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),br=-1,xi.copy(this.normal,Qr),C+=2),this.lastFlip=br}else{if(ah(this.normal,Gs),j){var Et=xi.create(),wt=xi.create();xi.sub(wt,Gs,this.normal),xi.add(Et,Gs,this.normal),F.push(wt[0],wt[1],0),F.push(Et[0],Et[1],0),R.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),R.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(R,F,s,this.normal,this.thickness,this.totalDistance);T.push.apply(T,(0,Se.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),C+=2}return C}},{key:"simpleSegment",value:function(r,n,a,s,p){var v=0,g=r.indices,x=r.positions,C=r.normals,T=ns([s[0],s[1]]),R=ns([a[0],a[1]]);md(Gs,T,R);var F=0;if(this.dash&&(F=this.lineSegmentDistance(T,R),this.totalDistance+=F),this.normal||(this.normal=xi.create(),ah(this.normal,Gs)),this.started||(this.started=!0,this.extrusions(x,C,a,this.normal,this.thickness,this.totalDistance-F)),g.push(n+0,n+1,n+2),!p)ah(this.normal,Gs),this.extrusions(x,C,s,this.normal,this.thickness,this.totalDistance),g.push.apply(g,(0,Se.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),v+=2;else{var j=ns([p[0],p[1]]);Lv(T,j)&&xi.add(j,T,xi.normalize(j,xi.subtract(j,T,R))),md(ih,j,T);var Y=kv(vd,xi.create(),Gs,ih,this.thickness),J=(0,gn.Z)(Y,2),be=J[0],Be=J[1],Ye=xi.dot(vd,this.normal)<0?-1:1;this.extrusions(x,C,s,Be,be,this.totalDistance),g.push.apply(g,(0,Se.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Ye=-1,xi.copy(this.normal,Be),v+=2,this.lastFlip=Ye}return v}},{key:"segment",value:function(r,n,a,s,p){var v=0,g=r.indices,x=r.positions,C=r.normals,T=this.cap==="square",R=this.join==="bevel",F=ns([s[0],s[1]]),j=ns([a[0],a[1]]);md(Gs,F,j);var Y=0;if(this.dash&&(Y=this.lineSegmentDistance(F,j),this.totalDistance+=Y),this.normal||(this.normal=xi.create(),ah(this.normal,Gs)),!this.started)if(this.started=!0,T){var J=xi.create(),be=xi.create();xi.add(J,this.normal,Gs),xi.add(be,this.normal,Gs),C.push(be[0],be[1],0),C.push(J[0],J[1],0),x.push(a[0],a[1],a[2]|0,this.totalDistance-Y,-this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),x.push(a[0],a[1],a[2]|0,this.totalDistance-Y,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(x,C,a,this.normal,this.thickness,this.totalDistance-Y);if(g.push(n+0,n+1,n+2),p){var tt=ns([p[0],p[1]]);Lv(F,tt)&&xi.add(tt,F,xi.normalize(tt,xi.subtract(tt,F,j))),md(ih,tt,F);var Et=kv(vd,xi.create(),Gs,ih,this.thickness),wt=(0,gn.Z)(Et,2),Yt=wt[0],ar=wt[1],Mr=xi.dot(vd,this.normal)<0?-1:1,Qr=R;if(!Qr&&this.join==="miter"){var br=Yt;br>this.miterLimit&&(Qr=!0)}Qr?(C.push(this.normal[0],this.normal[1],0),C.push(ar[0],ar[1],0),x.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*Mr,s[2]|0),this.complex.indexes.push(this.currentIndex),x.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness*Mr,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,g.push.apply(g,(0,Se.Z)(this.lastFlip!==-Mr?[n,n+2,n+3]:[n+2,n+1,n+3])),g.push(n+2,n+3,n+4),ah(B0,ih),xi.copy(this.normal,B0),C.push(this.normal[0],this.normal[1],0),x.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*Mr,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,v+=3):(this.extrusions(x,C,s,ar,Yt,this.totalDistance),g.push.apply(g,(0,Se.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Mr=-1,xi.copy(this.normal,ar),v+=2),this.lastFlip=Mr}else{if(ah(this.normal,Gs),T){var Be=xi.create(),Ye=xi.create();xi.sub(Ye,Gs,this.normal),xi.add(Be,Gs,this.normal),C.push(Ye[0],Ye[1],0),C.push(Be[0],Be[1],0),x.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),x.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(x,C,s,this.normal,this.thickness,this.totalDistance);g.push.apply(g,(0,Se.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),v+=2}return v}},{key:"extrusions",value:function(r,n,a,s,p,v){n.push(s[0],s[1],0),n.push(s[0],s[1],0),r.push(a[0],a[1],a[2]|0,v,-p,a[2]|0),this.complex.indexes.push(this.currentIndex),r.push(a[0],a[1],a[2]|0,v,p,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(r,n){var a=n[0]-r[0],s=n[1]-r[1];return Math.sqrt(a*a+s*s)}}]),e}();function Dh(e){if(ha()(e[0]))return e;if(ha()(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(ha()(e[0][0][0])){var i=e,r=0,n=0,a=0;return i.forEach(function(s){s.forEach(function(p){r+=p[0],n+=p[1],a++})}),[r/a,n/a,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function z2(e){for(var i=e[0],r=e[1],n=e[0],a=e[1],s=0,p=0,v=0,g=0;g<e.length;g+=2){var x=e[g],C=e[g+1];x&&C&&(i=Math.max(x,i),r=Math.max(C,r),n=Math.min(x,n),a=Math.min(C,a),s+=x,p+=C,v++)}return{center:[s/v,p/v],radius:Math.sqrt(Math.pow(i-n,2)+Math.pow(r-a,2))/2}}var Xa=Q(77160);function U2(e){var i=e[0][0],r=e[0][e[0].length-1];i[0]===r[0]&&i[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var n=e[0].length,a=Ff().flatten(e),s=a.vertices,p=a.dimensions,v=[],g=[],x=0;x<s.length/p;x++)p===2?v.push(s[x*2],s[x*2+1],1):v.push(s[x*3],s[x*3+1],1);var C=Ff()(a.vertices,a.holes,a.dimensions);g.push.apply(g,(0,Se.Z)(C));for(var T=function(j){var Y=a.vertices.slice(j*p,(j+1)*p),J=a.vertices.slice((j+1)*p,(j+2)*p);J.length===0&&(J=a.vertices.slice(0,p));var be=v.length/3;v.push(Y[0],Y[1],1,J[0],J[1],1,Y[0],Y[1],0,J[0],J[1],0),g.push.apply(g,(0,Se.Z)([0,2,1,2,3,1].map(function(Be){return Be+be})))},R=0;R<n;R++)T(R);return{positions:v,index:g}}function Z2(e){var i=Ff().flatten(e),r=Ff()(i.vertices,i.holes,i.dimensions);return{positions:i.vertices,index:r}}function Rg(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=e[0][0],n=e[0][e[0].length-1];r[0]===n[0]&&r[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var a=e[0].length,s=Ff().flatten(e),p=s.vertices,v=s.dimensions,g=[],x=[],C=[],T=0;T<p.length/v;T++)v===2?g.push(p[T*2],p[T*2+1],1,-1,-1):g.push(p[T*3],p[T*3+1],1,-1,-1),C.push(0,0,1);var R=Ff()(s.vertices,s.holes,s.dimensions);x.push.apply(x,(0,Se.Z)(R));for(var F=function(J){var be=s.vertices.slice(J*v,(J+1)*v),Be=s.vertices.slice((J+1)*v,(J+2)*v);Be.length===0&&(Be=s.vertices.slice(0,v));var Ye=g.length/5;g.push(be[0],be[1],1,0,0,Be[0],Be[1],1,.1,0,be[0],be[1],0,0,.8,Be[0],Be[1],0,.1,.8);var tt=j2([Be[0],Be[1],1],[be[0],be[1],0],[be[0],be[1],1],i);C.push.apply(C,(0,Se.Z)(tt).concat((0,Se.Z)(tt),(0,Se.Z)(tt),(0,Se.Z)(tt))),x.push.apply(x,(0,Se.Z)([1,2,0,3,2,1].map(function(Et){return Et+Ye})))},j=0;j<a;j++)F(j);return{positions:g,index:x,normals:C}}function j2(e,i,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,a=Xa.create(),s=Xa.create(),p=Xa.create();n&&(e=Ai(e),i=Ai(i),r=Ai(r));var v=Xa.fromValues.apply(Xa,(0,Se.Z)(e)),g=Xa.fromValues.apply(Xa,(0,Se.Z)(i)),x=Xa.fromValues.apply(Xa,(0,Se.Z)(r));Xa.sub(a,x,g),Xa.sub(s,v,g),Xa.cross(p,a,s);var C=Xa.create();return Xa.normalize(C,p),C}var Mc,Fh;(function(e){e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn"})(Fh||(Fh={}));var Bh;(function(e){e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon"})(Bh||(Bh={}));function Qd(e){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=Math.PI*2/e,n=[],a=0;a<e;a++)n.push(r*a+i*Math.PI/12);var s=n.map(function(p){var v=Math.sin(p+Math.PI/4),g=Math.cos(p+Math.PI/4);return[v,g,0]});return s}function kg(){return Qd(30)}function Lg(){return Qd(4)}function Dg(){return Qd(3)}function Fg(){return Qd(6,1)}function Bg(){return Qd(5)}var gd=(Mc={},(0,A.Z)(Mc,Bh.CIRCLE,kg),(0,A.Z)(Mc,Bh.HEXAGON,Fg),(0,A.Z)(Mc,Bh.TRIANGLE,Dg),(0,A.Z)(Mc,Bh.SQUARE,Lg),(0,A.Z)(Mc,Bh.PENTAGON,Bg),(0,A.Z)(Mc,Fh.CYLINDER,kg),(0,A.Z)(Mc,Fh.HEXAGONCOLUMN,Fg),(0,A.Z)(Mc,Fh.TRIANGLECOLUMN,Dg),(0,A.Z)(Mc,Fh.SQUARECOLUMN,Lg),(0,A.Z)(Mc,Fh.PENTAGONCOLUMN,Bg),Mc),N0={};function Nh(e){var i=Dh(e.coordinates);return{vertices:[].concat((0,Se.Z)(i),(0,Se.Z)(i),(0,Se.Z)(i),(0,Se.Z)(i)),indices:[0,1,2,2,3,0],size:i.length}}function Ng(e){var i=Dh(e.coordinates),r=Ig(i);return{vertices:[].concat((0,Se.Z)(r),(0,Se.Z)(r),(0,Se.Z)(r),(0,Se.Z)(r)),indices:[0,1,2,2,3,0],size:r.length}}function zg(e){var i=e.shape,r=H2(i,!1),n=r.positions,a=r.index,s=r.normals;return{vertices:n,indices:a,normals:s,size:5}}function Ug(e){var i=Dh(e.coordinates);return{vertices:(0,Se.Z)(i),indices:[0],size:i.length}}function Jd(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,a=new Og({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var s=i;Array.isArray(s[0][0])||(s=[i]);var p=r;Array.isArray(p[0][0])||(p=[r]);for(var v=0;v<s.length;v++){var g=s[v],x=p[v];a.extrude_gaode2(g,x)}}else{var C=i;C[0]&&!Array.isArray(C[0][0])&&(C=[i]),C.forEach(function(R){a.extrude(R)})}var T=a.complex;return{vertices:T.positions,indices:T.indices,normals:T.normals,indexes:T.indexes,size:6}}function V2(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,a=new Og({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var s=i;Array.isArray(s[0][0])||(s=[i]);var p=r;Array.isArray(p[0][0])||(p=[r]);for(var v=0;v<s.length;v++){var g=s[v],x=p[v];a.simpleExtrude_gaode2(g,x)}}else{var C=i;C[0]&&!Array.isArray(C[0][0])&&(C=[i]),C.forEach(function(R){a.simpleExtrude(R)})}var T=a.complex;return{vertices:T.positions,indices:T.indices,normals:T.normals,size:6}}function e0(e){var i=e.coordinates,r=Ff().flatten(i),n=r.vertices,a=r.dimensions,s=r.holes;return{indices:Ff()(n,s,a),vertices:n,size:a}}function Zg(e){var i=e.coordinates,r=Ff().flatten(i),n=r.vertices,a=r.dimensions,s=r.holes;return{indices:Ff()(n,s,a),vertices:G2(n),size:a+4}}function G2(e){for(var i=[],r=z2(e),n=r.center,a=r.radius,s=0;s<e.length;s+=2){var p=e[s],v=e[s+1];i.push.apply(i,[p,v,0].concat((0,Se.Z)(n),[a]))}return i}function jg(e){var i=e.coordinates,r=Rg(i,!0),n=r.positions,a=r.index,s=r.normals;return{vertices:n,indices:a,normals:s,size:5}}function Vg(e){var i=e.shape,r=X2(i),n=r.positions,a=r.index;return{vertices:n,indices:a,size:3}}function Gg(e){var i=e.coordinates,r=[].concat((0,Se.Z)(i[0]),[0,0,1,i[1][0],i[0][1],0,1,1],(0,Se.Z)(i[1]),[0,1,0],(0,Se.Z)(i[0]),[0,0,1],(0,Se.Z)(i[1]),[0,1,0,i[0][0],i[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:r,indices:n,size:5}}function z0(e,i){for(var r=i||30,n=e.coordinates,a=[],s=[],p=function(x){a.push(x,1,x,n[0][0],n[0][1],n[1][0],n[1][1],x,-1,x,n[0][0],n[0][1],n[1][0],n[1][1]),x!==r-1&&s.push.apply(s,(0,Se.Z)([0,1,2,1,3,2].map(function(C){return x*2+C})))},v=0;v<r;v++)p(v);return{vertices:a,indices:s,size:7}}function Hg(e){var i=e.coordinates;i.length===2&&i.push(0);var r=e.size,n=U0(-1,1),a=U0(1,1),s=U0(-1,-1),p=U0(1,-1),v=[].concat((0,Se.Z)(i),(0,Se.Z)(n),(0,Se.Z)(i),(0,Se.Z)(s),(0,Se.Z)(i),(0,Se.Z)(p),(0,Se.Z)(i),(0,Se.Z)(a)),g=[0,1,2,3,0,2];return{vertices:v,indices:g,size:5}}function H2(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(N0&&N0[e])return N0[e];var r=gd[e]?gd[e]():gd.cylinder(),n=Rg([r],i);return N0[e]=n,n}function tP(e,i){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,a=new Float32Array(e.length/r*3),s,p,v,g=vec3.create(),x=vec3.create(),C=vec3.create(),T=0,R=i.length;T<R;T+=3){s=i[T+0]*3,p=i[T+1]*3,v=i[T+2]*3;var F=[e[s],e[s+1]],j=[e[p],e[p+1]],Y=[e[v],e[v+1]];n&&(F=lngLatToMeters(F),j=lngLatToMeters(j),Y=lngLatToMeters(Y));var J=F,be=_slicedToArray(J,2),Be=be[0],Ye=be[1],tt=vec3.fromValues(Be,Ye,e[s+2]),Et=j,wt=_slicedToArray(Et,2),Yt=wt[0],ar=wt[1],Mr=vec3.fromValues(Yt,ar,e[p+2]),Qr=Y,br=_slicedToArray(Qr,2),vn=br[0],Pn=br[1],$n=vec3.fromValues(vn,Pn,e[v+2]);vec3.sub(g,$n,Mr),vec3.sub(x,tt,Mr),vec3.cross(C,g,x),a[s]+=g[0],a[s+1]+=g[1],a[s+2]+=g[2],a[p]+=g[0],a[p+1]+=g[1],a[p+2]+=g[2],a[v]+=g[0],a[v+1]+=g[1],a[v+2]+=g[2]}return W2(a),a}function W2(e){for(var i=0,r=e.length;i<r;i+=3){var n=vec3.fromValues(e[i],e[i+1],e[i+2]),a=vec3.create();vec3.normalize(a,n),e.set(a,i)}}function rP(e){var i=e[0][0],r=e[0][e[0].length-1];return i[0]===r[0]&&i[1]===r[1]}function X2(e){var i=["cylinder","triangleColumn","hexagonColumn","squareColumn"],r=gd[e]?gd[e]():gd.circle(),n=i.indexOf(e)===-1?Z2([r]):U2([r]);return n}function U0(e,i){var r=(e+1)/2,n=(i+1)/2;return[r,n]}function nP(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function iP(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function Y2(e){var i=q2();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function q2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var K2=`uniform float u_opacity;
varying vec4 v_Color;

void main() {
  gl_FragColor = v_Color;
  gl_FragColor.a *= u_opacity;
}
`,$2=`attribute vec4 a_Color;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;

#pragma include "projection"

void main() {

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,Q2=function(e){(0,Pr.Z)(r,e);var i=Y2(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?0:s;return{u_opacity:ha()(p)?p:0}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"mask",vertexShader:$2,fragmentShader:K2,triangulation:e0,blend:this.getBlend(),depth:{enable:!1},stencil:{enable:!0,mask:255,func:{cmp:k.ALWAYS,ref:1,mask:255},opFront:{fail:k.REPLACE,zfail:k.REPLACE,zpass:k.REPLACE}}})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy(),this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),r}(xo),J2={fill:Q2},eE=J2;function tE(e){var i=rE();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function rE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nE=function(e){(0,Pr.Z)(r,e);var i=tE(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"type","MaskLayer"),n}return(0,Mt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new eE[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"fill"}}]),r}(nh),iE=Q(88307),aE=Q.n(iE),oE=function(){function e(i,r){(0,dt.Z)(this,e),(0,A.Z)(this,"attribute",void 0),(0,A.Z)(this,"buffer",void 0);var n=r.buffer,a=r.offset,s=r.stride,p=r.normalized,v=r.size,g=r.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:a||0,stride:s||0,normalized:p||!1,divisor:g||0},v&&(this.attribute.size=v)}return(0,Mt.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),Ep,t0,Sp,Pc,r0,oh,n0,Z0,Bf,zh,Su,Nf,zf,j0,sE=(Ep={},(0,A.Z)(Ep,k.POINTS,"points"),(0,A.Z)(Ep,k.LINES,"lines"),(0,A.Z)(Ep,k.LINE_LOOP,"line loop"),(0,A.Z)(Ep,k.LINE_STRIP,"line strip"),(0,A.Z)(Ep,k.TRIANGLES,"triangles"),(0,A.Z)(Ep,k.TRIANGLE_FAN,"triangle fan"),(0,A.Z)(Ep,k.TRIANGLE_STRIP,"triangle strip"),Ep),Wg=(t0={},(0,A.Z)(t0,k.STATIC_DRAW,"static"),(0,A.Z)(t0,k.DYNAMIC_DRAW,"dynamic"),(0,A.Z)(t0,k.STREAM_DRAW,"stream"),t0),Dv=(Sp={},(0,A.Z)(Sp,k.BYTE,"int8"),(0,A.Z)(Sp,k.UNSIGNED_INT,"int16"),(0,A.Z)(Sp,k.INT,"int32"),(0,A.Z)(Sp,k.UNSIGNED_BYTE,"uint8"),(0,A.Z)(Sp,k.UNSIGNED_SHORT,"uint16"),(0,A.Z)(Sp,k.UNSIGNED_INT,"uint32"),(0,A.Z)(Sp,k.FLOAT,"float"),Sp),uE=(Pc={},(0,A.Z)(Pc,k.ALPHA,"alpha"),(0,A.Z)(Pc,k.LUMINANCE,"luminance"),(0,A.Z)(Pc,k.LUMINANCE_ALPHA,"luminance alpha"),(0,A.Z)(Pc,k.RGB,"rgb"),(0,A.Z)(Pc,k.RGBA,"rgba"),(0,A.Z)(Pc,k.RGBA4,"rgba4"),(0,A.Z)(Pc,k.RGB5_A1,"rgb5 a1"),(0,A.Z)(Pc,k.RGB565,"rgb565"),(0,A.Z)(Pc,k.DEPTH_COMPONENT,"depth"),(0,A.Z)(Pc,k.DEPTH_STENCIL,"depth stencil"),Pc),lE=(r0={},(0,A.Z)(r0,k.DONT_CARE,"dont care"),(0,A.Z)(r0,k.NICEST,"nice"),(0,A.Z)(r0,k.FASTEST,"fast"),r0),Xg=(oh={},(0,A.Z)(oh,k.NEAREST,"nearest"),(0,A.Z)(oh,k.LINEAR,"linear"),(0,A.Z)(oh,k.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,A.Z)(oh,k.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,A.Z)(oh,k.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,A.Z)(oh,k.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),oh),Yg=(n0={},(0,A.Z)(n0,k.REPEAT,"repeat"),(0,A.Z)(n0,k.CLAMP_TO_EDGE,"clamp"),(0,A.Z)(n0,k.MIRRORED_REPEAT,"mirror"),n0),cE=(Z0={},(0,A.Z)(Z0,k.NONE,"none"),(0,A.Z)(Z0,k.BROWSER_DEFAULT_WEBGL,"browser"),Z0),fE=(Bf={},(0,A.Z)(Bf,k.NEVER,"never"),(0,A.Z)(Bf,k.ALWAYS,"always"),(0,A.Z)(Bf,k.LESS,"less"),(0,A.Z)(Bf,k.LEQUAL,"lequal"),(0,A.Z)(Bf,k.GREATER,"greater"),(0,A.Z)(Bf,k.GEQUAL,"gequal"),(0,A.Z)(Bf,k.EQUAL,"equal"),(0,A.Z)(Bf,k.NOTEQUAL,"notequal"),Bf),qg=(zh={},(0,A.Z)(zh,k.FUNC_ADD,"add"),(0,A.Z)(zh,k.MIN_EXT,"min"),(0,A.Z)(zh,k.MAX_EXT,"max"),(0,A.Z)(zh,k.FUNC_SUBTRACT,"subtract"),(0,A.Z)(zh,k.FUNC_REVERSE_SUBTRACT,"reverse subtract"),zh),V0=(Su={},(0,A.Z)(Su,k.ZERO,"zero"),(0,A.Z)(Su,k.ONE,"one"),(0,A.Z)(Su,k.SRC_COLOR,"src color"),(0,A.Z)(Su,k.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,A.Z)(Su,k.SRC_ALPHA,"src alpha"),(0,A.Z)(Su,k.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,A.Z)(Su,k.DST_COLOR,"dst color"),(0,A.Z)(Su,k.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,A.Z)(Su,k.DST_ALPHA,"dst alpha"),(0,A.Z)(Su,k.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,A.Z)(Su,k.CONSTANT_COLOR,"constant color"),(0,A.Z)(Su,k.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,A.Z)(Su,k.CONSTANT_ALPHA,"constant alpha"),(0,A.Z)(Su,k.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,A.Z)(Su,k.SRC_ALPHA_SATURATE,"src alpha saturate"),Su),pE=(Nf={},(0,A.Z)(Nf,k.NEVER,"never"),(0,A.Z)(Nf,k.ALWAYS,"always"),(0,A.Z)(Nf,k.LESS,"less"),(0,A.Z)(Nf,k.LEQUAL,"lequal"),(0,A.Z)(Nf,k.GREATER,"greater"),(0,A.Z)(Nf,k.GEQUAL,"gequal"),(0,A.Z)(Nf,k.EQUAL,"equal"),(0,A.Z)(Nf,k.NOTEQUAL,"notequal"),Nf),yd=(zf={},(0,A.Z)(zf,k.ZERO,"zero"),(0,A.Z)(zf,k.KEEP,"keep"),(0,A.Z)(zf,k.REPLACE,"replace"),(0,A.Z)(zf,k.INVERT,"invert"),(0,A.Z)(zf,k.INCR,"increment"),(0,A.Z)(zf,k.DECR,"decrement"),(0,A.Z)(zf,k.INCR_WRAP,"increment wrap"),(0,A.Z)(zf,k.DECR_WRAP,"decrement wrap"),zf),hE=(j0={},(0,A.Z)(j0,k.FRONT,"front"),(0,A.Z)(j0,k.BACK,"back"),j0),dE=function(){function e(i,r){(0,dt.Z)(this,e),(0,A.Z)(this,"buffer",void 0);var n=r.data,a=r.usage,s=r.type;this.buffer=i.buffer({data:n,usage:Wg[a||k.STATIC_DRAW],type:Dv[s||k.UNSIGNED_BYTE]})}return(0,Mt.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(r){var n=r.data,a=r.offset;this.buffer.subdata(n,a)}}]),e}(),vE=function(){function e(i,r){(0,dt.Z)(this,e),(0,A.Z)(this,"elements",void 0);var n=r.data,a=r.usage,s=r.type,p=r.count;this.elements=i.elements({data:n,usage:Wg[a||k.STATIC_DRAW],type:Dv[s||k.UNSIGNED_BYTE],count:p})}return(0,Mt.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(r){var n=r.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),e}(),mE=function(){function e(i,r){(0,dt.Z)(this,e),(0,A.Z)(this,"framebuffer",void 0);var n=r.width,a=r.height,s=r.color,p=r.colors,v=r.depth,g=r.stencil,x={width:n,height:a};Array.isArray(p)&&(x.colors=p.map(function(C){return C.get()})),s&&typeof s!="boolean"&&(x.color=s.get()),this.framebuffer=i.framebuffer(x)}return(0,Mt.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(r){var n=r.width,a=r.height;this.framebuffer.resize(n,a)}}]),e}(),gE=Q(36719),yE=Q.n(gE),_E=Q(68630),xE=Q.n(_E);function Kg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Ic(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Kg(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Kg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var bE=function(){function e(i,r){(0,dt.Z)(this,e),(0,A.Z)(this,"reGl",void 0),(0,A.Z)(this,"destroyed",!1),(0,A.Z)(this,"drawCommand",void 0),(0,A.Z)(this,"drawPickCommand",void 0),(0,A.Z)(this,"drawParams",void 0),(0,A.Z)(this,"options",void 0),(0,A.Z)(this,"uniforms",{}),this.reGl=i;var n=r.vs,a=r.fs,s=r.attributes,p=r.uniforms,v=r.primitive,g=r.count,x=r.elements,C=r.depth,T=r.blend,R=r.stencil,F=r.cull,j=r.instances,Y={};this.options=r,p&&(this.uniforms=this.extractUniforms(p),Object.keys(p).forEach(function(Ye){Y[Ye]=i.prop(Ye)}));var J={};Object.keys(s).forEach(function(Ye){J[Ye]=s[Ye].get()});var be={attributes:J,frag:a,uniforms:Y,vert:n,blend:{},primitive:sE[v===void 0?k.TRIANGLES:v]};j&&(be.instances=j),g&&(be.count=g),x&&(be.elements=x.get()),this.initDepthDrawParams({depth:C},be),this.initBlendDrawParams({blend:T},be),this.initStencilDrawParams({stencil:R},be),this.initCullDrawParams({cull:F},be),this.drawCommand=i(be);var Be=H()(be);Be.blend=Ic(Ic({},Be.blend),{},{enable:!1}),this.drawPickCommand=i(Be),this.drawParams=be}return(0,Mt.Z)(e,[{key:"updateAttributesAndElements",value:function(r,n){var a={};Object.keys(r).forEach(function(p){a[p]=r[p].get()}),this.drawParams.attributes=a,this.drawParams.elements=n.get(),this.drawCommand=this.reGl(this.drawParams);var s=H()(this.drawParams);s.blend=Ic(Ic({},s.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(s)}},{key:"updateAttributes",value:function(r){var n={};Object.keys(r).forEach(function(s){n[s]=r[s].get()}),this.drawParams.attributes=n,this.drawCommand=this.reGl(this.drawParams);var a=H()(this.drawParams);a.blend=Ic(Ic({},a.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(a)}},{key:"addUniforms",value:function(r){this.uniforms=Ic(Ic({},this.uniforms),this.extractUniforms(r))}},{key:"draw",value:function(r,n){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var a=Ic(Ic({},this.uniforms),this.extractUniforms(r.uniforms||{})),s={};Object.keys(a).forEach(function(p){var v=(0,He.Z)(a[p]);v==="boolean"||v==="number"||Array.isArray(a[p])||a[p].BYTES_PER_ELEMENT?s[p]=a[p]:s[p]=a[p].get()}),n?this.drawPickCommand(s):this.drawCommand(s)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(r){r.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(r,n){var a=r.depth;a&&(n.depth={enable:a.enable===void 0?!0:!!a.enable,mask:a.mask===void 0?!0:!!a.mask,func:fE[a.func||k.LESS],range:a.range||[0,1]})}},{key:"initBlendDrawParams",value:function(r,n){var a=r.blend;if(a){var s=a.enable,p=a.func,v=a.equation,g=a.color,x=g===void 0?[0,0,0,0]:g;n.blend={enable:!!s,func:{srcRGB:V0[p&&p.srcRGB||k.SRC_ALPHA],srcAlpha:V0[p&&p.srcAlpha||k.SRC_ALPHA],dstRGB:V0[p&&p.dstRGB||k.ONE_MINUS_SRC_ALPHA],dstAlpha:V0[p&&p.dstAlpha||k.ONE_MINUS_SRC_ALPHA]},equation:{rgb:qg[v&&v.rgb||k.FUNC_ADD],alpha:qg[v&&v.alpha||k.FUNC_ADD]},color:x}}}},{key:"initStencilDrawParams",value:function(r,n){var a=r.stencil;if(a){var s=a.enable,p=a.mask,v=p===void 0?-1:p,g=a.func,x=g===void 0?{cmp:k.ALWAYS,ref:0,mask:-1}:g,C=a.opFront,T=C===void 0?{fail:k.KEEP,zfail:k.KEEP,zpass:k.KEEP}:C,R=a.opBack,F=R===void 0?{fail:k.KEEP,zfail:k.KEEP,zpass:k.KEEP}:R;n.stencil={enable:!!s,mask:v,func:Ic(Ic({},x),{},{cmp:pE[x.cmp]}),opFront:{fail:yd[T.fail],zfail:yd[T.zfail],zpass:yd[T.zpass]},opBack:{fail:yd[F.fail],zfail:yd[F.zfail],zpass:yd[F.zpass]}}}}},{key:"initCullDrawParams",value:function(r,n){var a=r.cull;if(a){var s=a.enable,p=a.face,v=p===void 0?k.BACK:p;n.cull={enable:!!s,face:hE[v]}}}},{key:"extractUniforms",value:function(r){var n=this,a={};return Object.keys(r).forEach(function(s){n.extractUniformsRecursively(s,r[s],a,"")}),a}},{key:"extractUniformsRecursively",value:function(r,n,a,s){var p=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||yE()(n)||n===""||"resize"in n){a["".concat(s&&s+".").concat(r)]=n;return}xE()(n)&&Object.keys(n).forEach(function(v){p.extractUniformsRecursively(v,n[v],a,"".concat(s&&s+".").concat(r))}),Array.isArray(n)&&n.forEach(function(v,g){Object.keys(v).forEach(function(x){p.extractUniformsRecursively(x,v[x],a,"".concat(s&&s+".").concat(r,"[").concat(g,"]"))})})}}]),e}(),EE=function(){function e(i,r){(0,dt.Z)(this,e),(0,A.Z)(this,"texture",void 0),(0,A.Z)(this,"width",void 0),(0,A.Z)(this,"height",void 0),(0,A.Z)(this,"isDistroy",!1);var n=r.data,a=r.type,s=a===void 0?k.UNSIGNED_BYTE:a,p=r.width,v=r.height,g=r.flipY,x=g===void 0?!1:g,C=r.format,T=C===void 0?k.RGBA:C,R=r.mipmap,F=R===void 0?!1:R,j=r.wrapS,Y=j===void 0?k.CLAMP_TO_EDGE:j,J=r.wrapT,be=J===void 0?k.CLAMP_TO_EDGE:J,Be=r.aniso,Ye=Be===void 0?0:Be,tt=r.alignment,Et=tt===void 0?1:tt,wt=r.premultiplyAlpha,Yt=wt===void 0?!1:wt,ar=r.mag,Mr=ar===void 0?k.NEAREST:ar,Qr=r.min,br=Qr===void 0?k.NEAREST:Qr,vn=r.colorSpace,Pn=vn===void 0?k.BROWSER_DEFAULT_WEBGL:vn,$n=r.x,Ba=$n===void 0?0:$n,Yo=r.y,ks=Yo===void 0?0:Yo,Ls=r.copy,Hs=Ls===void 0?!1:Ls;this.width=p,this.height=v;var ff={width:p,height:v,type:Dv[s],format:uE[T],wrapS:Yg[Y],wrapT:Yg[be],mag:Xg[Mr],min:Xg[br],alignment:Et,flipY:x,colorSpace:cE[Pn],premultiplyAlpha:Yt,aniso:Ye,x:Ba,y:ks,copy:Hs};n&&(ff.data=n),typeof F=="number"?ff.mipmap=lE[F]:typeof F=="boolean"&&(ff.mipmap=F),this.texture=i.texture(ff)}return(0,Mt.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(r)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(r){var n=r.width,a=r.height;this.texture.resize(n,a),this.width=n,this.height=a}},{key:"destroy",value:function(){if(!this.isDistroy){var r;(r=this.texture)===null||r===void 0||r.destroy()}this.isDistroy=!0}}]),e}(),$g,Qg,SE=($g=(0,Xr.b2)(),$g(Qg=function(){function e(){var i=this;(0,dt.Z)(this,e),(0,A.Z)(this,"extensionObject",void 0),(0,A.Z)(this,"gl",void 0),(0,A.Z)(this,"$container",void 0),(0,A.Z)(this,"canvas",void 0),(0,A.Z)(this,"width",void 0),(0,A.Z)(this,"height",void 0),(0,A.Z)(this,"isDirty",void 0),(0,A.Z)(this,"createModel",function(r){return new bE(i.gl,r)}),(0,A.Z)(this,"createAttribute",function(r){return new oE(i.gl,r)}),(0,A.Z)(this,"createBuffer",function(r){return new dE(i.gl,r)}),(0,A.Z)(this,"createElements",function(r){return new vE(i.gl,r)}),(0,A.Z)(this,"createTexture2D",function(r){return new EE(i.gl,r)}),(0,A.Z)(this,"createFramebuffer",function(r){return new mE(i.gl,r)}),(0,A.Z)(this,"useFramebuffer",function(r,n){i.gl({framebuffer:r?r.get():null})(n)}),(0,A.Z)(this,"clear",function(r){var n=r.color,a=r.depth,s=r.stencil,p=r.framebuffer,v=p===void 0?null:p,g={color:n,depth:a,stencil:s};g.framebuffer=v===null?v:v.get(),i.gl.clear(g)}),(0,A.Z)(this,"viewport",function(r){var n=r.x,a=r.y,s=r.width,p=r.height;i.gl._gl.viewport(n,a,s,p),i.width=s,i.height=p,i.gl._refresh()}),(0,A.Z)(this,"readPixels",function(r){var n=r.framebuffer,a=r.x,s=r.y,p=r.width,v=r.height,g={x:a,y:s,width:p,height:v};return n&&(g.framebuffer=n.get()),i.gl.read(g)}),(0,A.Z)(this,"getViewportSize",function(){return{width:i.gl._gl.drawingBufferWidth,height:i.gl._gl.drawingBufferHeight}}),(0,A.Z)(this,"getContainer",function(){if($i)return i.canvas;var r;return(r=i.canvas)===null||r===void 0?void 0:r.parentElement}),(0,A.Z)(this,"getCanvas",function(){return i.canvas}),(0,A.Z)(this,"getGLContext",function(){return i.gl._gl}),(0,A.Z)(this,"destroy",function(){i.canvas=null,i.gl.destroy(),i.gl=null})}return(0,Mt.Z)(e,[{key:"init",value:function(){var i=(0,Z.Z)(q().mark(function n(a,s){var p=this;return q().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return this.canvas=a,g.next=3,new Promise(function(x,C){aE()({canvas:p.canvas,attributes:{alpha:!0,antialias:s.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:s.preserveDrawingBuffer,stencil:s.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(R,F){(R||!F)&&C(R),x(F)}})});case 3:this.gl=g.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return g.stop()}},n,this)}));function r(n,a){return i.apply(this,arguments)}return r}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(r){return!!this.getGLContext().getExtension(r)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var r=this.getGLContext();r.disable(r.CULL_FACE)}},{key:"setDirty",value:function(r){this.isDirty=r}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||Qg);function Jg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ey(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Jg(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Jg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var CE=function(){function e(i){(0,dt.Z)(this,e),(0,A.Z)(this,"sceneService",void 0),(0,A.Z)(this,"mapService",void 0),(0,A.Z)(this,"controlService",void 0),(0,A.Z)(this,"layerService",void 0),(0,A.Z)(this,"iconService",void 0),(0,A.Z)(this,"markerService",void 0),(0,A.Z)(this,"popupService",void 0),(0,A.Z)(this,"fontService",void 0),(0,A.Z)(this,"interactionService",void 0),(0,A.Z)(this,"container",void 0);var r=i.id,n=i.map,a=i.canvas,s=i.hasBaseMap,p=Fb();this.container=p,n.setContainer(p,r,a,s),p.bind(Gt.IRendererService).to(SE).inSingletonScope(),this.sceneService=p.get(Gt.ISceneService),this.mapService=p.get(Gt.IMapService),this.iconService=p.get(Gt.IIconService),this.fontService=p.get(Gt.IFontService),this.controlService=p.get(Gt.IControlService),this.layerService=p.get(Gt.ILayerService),this.markerService=p.get(Gt.IMarkerService),this.interactionService=p.get(Gt.IInteractionService),this.popupService=p.get(Gt.IPopupService),$i?this.sceneService.initMiniScene(i):(this.initComponent(r),this.sceneService.init(i),this.initControl())}return(0,Mt.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(r){return this.sceneService.exportPng(r)}},{key:"exportMap",value:function(r){return this.sceneService.exportPng(r)}},{key:"registerRenderService",value:function(r){var n=this;if(this.sceneService.loaded){var a=new r(this);a.init()}else this.on("loaded",function(){var s=new r(n);s.init()})}},{key:"setBgColor",value:function(r){this.mapService.setBgColor(r)}},{key:"addLayer",value:function(r){var n=ig(this.container);r.setContainer(n,this.container),this.sceneService.addLayer(r);var a=r.getLayerConfig();if(a){var s=a.mask,p=a.maskfence,v=a.maskColor,g=v===void 0?"#000":v,x=a.maskOpacity,C=x===void 0?0:x;if(s&&p){var T=new nE().source(p).shape("fill").color(g).style({opacity:C});this.addMask(T,r.id)}}else console.warn("addLayer should run after scene loaded!")}},{key:"addMask",value:function(r,n){var a=this.getLayer(n);if(a){var s=ig(this.container);r.setContainer(s,this.container),a.addMaskLayer(r),this.sceneService.addLayer(r)}else console.warn("parent layer not find!")}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(r){return this.layerService.getLayer(r)}},{key:"getLayerByName",value:function(r){return this.layerService.getLayerByName(r)}},{key:"removeLayer",value:function(r,n){this.layerService.remove(r,n)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(r){this.layerService.setEnableRender(r)}},{key:"addIconFont",value:function(r,n){this.fontService.addIconFont(r,n)}},{key:"addIconFonts",value:function(r){var n=this;r.forEach(function(a){var s=(0,gn.Z)(a,2),p=s[0],v=s[1];n.fontService.addIconFont(p,v)})}},{key:"addFontFace",value:function(r,n){this.sceneService.addFontFace(r,n)}},{key:"addImage",value:function(r,n){$i?this.iconService.addImageMini(r,n,this.sceneService):this.iconService.addImage(r,n)}},{key:"hasImage",value:function(r){return this.iconService.hasImage(r)}},{key:"removeImage",value:function(r){this.iconService.removeImage(r)}},{key:"addIconFontGlyphs",value:function(r,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(r){this.controlService.addControl(r,this.container)}},{key:"removeControl",value:function(r){this.controlService.removeControl(r)}},{key:"getControlByName",value:function(r){return this.controlService.getControlByName(r)}},{key:"addMarker",value:function(r){this.markerService.addMarker(r)}},{key:"addMarkerLayer",value:function(r){this.markerService.addMarkerLayer(r)}},{key:"removeMarkerLayer",value:function(r){this.markerService.removeMarkerLayer(r)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(r){this.popupService.addPopup(r)}},{key:"on",value:function(r,n){Iv.indexOf(r)===-1?this.mapService.on(r,n):this.sceneService.on(r,n)}},{key:"once",value:function(r,n){Iv.indexOf(r)===-1?this.mapService.once(r,n):this.sceneService.once(r,n)}},{key:"off",value:function(r,n){Iv.indexOf(r)===-1?this.mapService.off(r,n):this.sceneService.off(r,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(r){return this.mapService.getCenter(r)}},{key:"setCenter",value:function(r,n){return this.mapService.setCenter(r,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(r){return this.mapService.setPitch(r)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(r){this.mapService.setRotation(r)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(r){this.mapService.panTo(r)}},{key:"panBy",value:function(r,n){this.mapService.panBy(r,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(r){this.mapService.setZoom(r)}},{key:"fitBounds",value:function(r,n){var a=this.sceneService.getSceneConfig(),s=a.fitBoundsOptions,p=a.animate;this.mapService.fitBounds(r,n||ey(ey({},s),{},{animate:p}))}},{key:"setZoomAndCenter",value:function(r,n){this.mapService.setZoomAndCenter(r,n)}},{key:"setMapStyle",value:function(r){this.mapService.setMapStyle(r)}},{key:"setMapStatus",value:function(r){this.mapService.setMapStatus(r)}},{key:"pixelToLngLat",value:function(r){return this.mapService.pixelToLngLat(r)}},{key:"lngLatToPixel",value:function(r){return this.mapService.lngLatToPixel(r)}},{key:"containerToLngLat",value:function(r){return this.mapService.containerToLngLat(r)}},{key:"lngLatToContainer",value:function(r){return this.mapService.lngLatToContainer(r)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(r,n){this.container.bind(Gt.IPostProcessingPass).to(r).whenTargetNamed(n)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(r){this.controlService.init({container:Ma(r)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var r=this.sceneService.getSceneConfig(),n=r.logoVisible,a=r.logoPosition;n&&this.addControl(new r2({position:a}))}}]),e}();function AE(e){var i=wE();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function wE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var TE=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

uniform float u_circleSweep;
uniform float u_cityMinSize;
uniform vec3 u_circleSweepColor;
uniform float u_circleSweepSpeed;

varying float v_worldDis;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    gl_FragColor.rgb += r * r * u_circleSweepColor;
  }
   
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,ME=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

uniform float u_circleSweep;
uniform vec2 u_cityCenter;

varying float v_worldDis;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,PE=function(e){(0,Pr.Z)(r,e);var i=AE(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"cityCenter",void 0),(0,A.Z)((0,ue.Z)(n),"cityMinSize",void 0),n}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.baseColor,g=v===void 0?"rgb(16,16,16)":v,x=a.brightColor,C=x===void 0?"rgb(255,176,38)":x,T=a.windowColor,R=T===void 0?"rgb(30,60,89)":T,F=a.time,j=F===void 0?0:F,Y=a.sweep,J=Y===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:Y;return{u_cityCenter:J.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*J.sweepRadius,u_circleSweep:J.enable?1:0,u_circleSweepColor:_i(J.sweepColor).slice(0,3),u_circleSweepSpeed:J.sweepSpeed,u_opacity:p,u_baseColor:_i(g),u_brightColor:_i(C),u_windowColor:_i(R),u_time:this.layer.getLayerAnimateTime()||j}}},{key:"calCityGeo",value:function(){var a=(0,gn.Z)(this.layer.getSource().extent,4),s=a[0],p=a[1],v=a[2],g=a[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(v+s)/2,(g+p)/2]);var x=this.mapService.lngLatToCoord([v,g]),C=this.mapService.lngLatToCoord([s,p]);this.cityMinSize=Math.sqrt(Math.pow(x[0]-C[0],2)+Math.pow(x[1]-C[1],2))/4}else{var T=v-s,R=g-p;this.cityCenter=[(v+s)/2,(g+p)/2],this.cityMinSize=Math.sqrt(Math.pow(T,2)+Math.pow(R,2))/4}}},{key:"initModels",value:function(){return this.calCityGeo(),this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:ME,fragmentShader:TE,triangulation:jg,cull:{enable:!0,face:k.BACK}})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:On.Attribute,descriptor:{name:"a_Normal",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(s,p,v,g,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,p,v,g){var x=s.size,C=x===void 0?10:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_Uv",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(s,p,v,g){var x=s.size;return[v[3],v[4]]}}})}}]),r}(xo);function IE(e){var i=OE();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function OE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var RE=function(e){(0,Pr.Z)(r,e);var i=IE(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"type","PolygonLayer"),n}return(0,Mt.Z)(r,[{key:"buildModels",value:function(){this.layerModel=new PE(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(a){this.updateLayerConfig({time:a})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),r}(nh);function kE(e){var i=LE();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function LE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var DE=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,FE=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,BE=function(e){(0,Pr.Z)(r,e);var i=kE(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.coverage,v=a.angle;return{u_opacity:s||1,u_coverage:p||.9,u_angle:v||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:DE,fragmentShader:FE,triangulation:Vg,depth:{enable:!1},primitive:k.TRIANGLES,blend:this.getBlend(),stencil:Pa(p,g)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:On.Attribute,descriptor:{name:"a_Pos",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(s,p){var v=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[v[0],v[1],0]}}})}}]),r}(xo);function NE(e){var i=zE();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function zE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var UE=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,ZE=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,jE=function(e){(0,Pr.Z)(r,e);var i=NE(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.coverage,v=a.angle;return{u_opacity:s||1,u_coverage:p||1,u_angle:v||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:UE,fragmentShader:ZE,triangulation:zg,depth:{enable:!0},blend:this.getBlend(),stencil:Pa(p,g)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,p,v,g){var x=s.size;return Array.isArray(x)?[x[0]]:[x]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:On.Attribute,descriptor:{name:"a_Normal",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(s,p,v,g,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:On.Attribute,descriptor:{name:"a_Pos",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(s,p){var v=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[v[0],v[1],0]}}})}}]),r}(xo);function VE(e,i){for(var r=[],n=[],a=[],s=e+1,p=i+1,v=e/2,g=i/2,x=0;x<p;x++)for(var C=x-g,T=0;T<s;T++){var R=T-v;n.push(R/v,-C/g,0),a.push(T/e),a.push(1-x/i)}for(var F=0;F<i;F++)for(var j=0;j<e;j++){var Y=j+s*F,J=j+s*(F+1),be=j+1+s*(F+1),Be=j+1+s*F;r.push(Y,J,Be),r.push(J,be,Be)}return{vertices:n,indices:r,uvs:a}}var ty,ry;function ny(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function iy(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ny(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ny(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function GE(e){var i=HE();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function HE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var WE=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,XE=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,YE=`uniform sampler2D u_texture;        // \u70ED\u529B\u5F3A\u5EA6\u56FE
uniform sampler2D u_colorTexture;   // \u6839\u636E\u5F3A\u5EA6\u5206\u5E03\u7684\u8272\u5E26
uniform float u_opacity;
varying vec2 v_texCoord;

float getBlurIndusty() {
    float h = 2.0/512.0;
    vec2 vUv = v_texCoord;
    float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y + 1.0 * h) ).r;
    float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * h, vUv.y + 1.0 * h) ).r;
    float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y + 1.0 * h) ).r;

    float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y) ).r;
    float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;
    float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y) ).r;

    float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y-1.0*h) ).r;
    float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * h, vUv.y-1.0*h) ).r;
    float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y-1.0*h) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture2D(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));

    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,qE=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;

void main() {
  v_texCoord = a_Uv;

  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,KE=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,$E=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,ay=(ty=(0,Xr.b2)(),ty(ry=function(e){(0,Pr.Z)(r,e);var i=GE(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"texture",void 0),(0,A.Z)((0,ue.Z)(n),"colorTexture",void 0),(0,A.Z)((0,ue.Z)(n),"heatmapFramerBuffer",void 0),(0,A.Z)((0,ue.Z)(n),"intensityModel",void 0),(0,A.Z)((0,ue.Z)(n),"colorModel",void 0),(0,A.Z)((0,ue.Z)(n),"shapeType",void 0),n}return(0,Mt.Z)(r,[{key:"render",value:function(){var a=this,s=this.rendererService,p=s.clear,v=s.useFramebuffer;v(this.heatmapFramerBuffer,function(){p({color:[0,0,0,0],depth:1,stencil:0,framebuffer:a.heatmapFramerBuffer}),a.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var a,s=this.rendererService,p=s.createFramebuffer,v=s.clear,g=s.getViewportSize,x=s.createTexture2D,C=s.useFramebuffer,T=this.styleAttributeService.getLayerStyleAttribute("shape"),R=(T==null||(a=T.scale)===null||a===void 0?void 0:a.field)||"heatmap";this.shapeType=R,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=R==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var F=g(),j=F.width,Y=F.height;return this.heatmapFramerBuffer=p({color:x({width:Math.floor(j/4),height:Math.floor(Y/4),wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE,min:k.LINEAR,mag:k.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:On.Attribute,descriptor:{name:"a_Dir",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(s,p,v,g){return[v[3],v[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,p,v,g){var x=s.size,C=x===void 0?1:x;return[C]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.triangulation=Hg,this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:$E,fragmentShader:KE,triangulation:Hg,depth:{enable:!1},cull:{enable:!0,face:Ul(this.mapService.version)},blend:{enable:!0,func:{srcRGB:k.ONE,srcAlpha:1,dstRGB:k.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;this.shaderModuleService.registerModule("heatmapColor",{vs:qE,fs:YE});var x=this.shaderModuleService.getModule("heatmapColor"),C=x.vs,T=x.fs,R=x.uniforms,F=this.rendererService,j=F.createAttribute,Y=F.createElements,J=F.createBuffer,be=F.createModel;return be({vs:C,fs:T,attributes:{a_Position:j({buffer:J({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:k.FLOAT}),size:3}),a_Uv:j({buffer:J({data:[0,1,1,1,0,0,1,0],type:k.FLOAT}),size:2})},uniforms:iy({},R),depth:{enable:!1},blend:this.getBlend(),count:6,elements:Y({data:[0,2,1,2,3,1],type:k.UNSIGNED_INT,count:6}),stencil:Pa(p,g)})}},{key:"drawIntensityMode",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.intensity,v=p===void 0?10:p,g=a.radius,x=g===void 0?5:g;this.intensityModel.draw({uniforms:{u_opacity:s||1,u_radius:x,u_intensity:v}})}},{key:"drawColorMode",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;this.colorModel.draw({uniforms:{u_opacity:s||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=Yi();zp(p,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:s||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,Se.Z)(p)}})}},{key:"build3dHeatMap",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.rendererService.getViewportSize,C=x(),T=C.width,R=C.height,F=VE(T/4,R/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:XE,fs:WE});var j=this.shaderModuleService.getModule("heatmap3dColor"),Y=j.vs,J=j.fs,be=j.uniforms,Be=this.rendererService,Ye=Be.createAttribute,tt=Be.createElements,Et=Be.createBuffer,wt=Be.createModel;return wt({vs:Y,fs:J,attributes:{a_Position:Ye({buffer:Et({data:F.vertices,type:k.FLOAT}),size:3}),a_Uv:Ye({buffer:Et({data:F.uvs,type:k.FLOAT}),size:2})},primitive:k.TRIANGLES,uniforms:iy({},be),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:k.SRC_ALPHA,srcAlpha:1,dstRGB:k.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:tt({data:F.indices,type:k.UNSIGNED_INT,count:F.indices.length}),stencil:Pa(p,g)})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var a=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var s=this.layer.getLayerConfig(),p=s.rampColors,v=hl(p);this.colorTexture=a({data:new Uint8Array(v.data),width:v.width,height:v.height,wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE,min:k.NEAREST,mag:k.NEAREST,flipY:!1})}}]),r}(xo))||ry);function QE(e){var i=JE();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function JE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var eS=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,tS=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,rS=function(e){(0,Pr.Z)(r,e);var i=QE(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.coverage,v=a.angle;return{u_opacity:s||1,u_coverage:p||.9,u_angle:v||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:tS,fragmentShader:eS,triangulation:Vg,depth:{enable:!1},primitive:k.TRIANGLES,blend:this.getBlend(),stencil:Pa(p,g)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:On.Attribute,descriptor:{name:"a_Pos",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(s,p){var v=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[v[0],v[1],0]}}})}}]),r}(xo),nS={heatmap:ay,heatmap3d:ay,grid:BE,grid3d:jE,hexagon:rS},iS=nS;function aS(e){var i=oS();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function oS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sS=function(e){(0,Pr.Z)(r,e);var i=aS(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"type","HeatMapLayer"),n}return(0,Mt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new iS[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var a=this,s=this.getModelType();return s==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(p){return p.draw({uniforms:a.layerModel.getUninforms()})}),this)}},{key:"updateModelData",value:function(a){a.attributes&&a.elements?this.models[0].updateAttributesAndElements(a.attributes,a.elements):console.warn("data error")}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),p=this.getLayerConfig(),v=p.shape3d,g=this.getSource(),x=g.data.type,C=(s==null||(a=s.scale)===null||a===void 0?void 0:a.field)||"heatmap";return C==="heatmap"||C==="heatmap3d"?"heatmap":x==="hexagon"?(v==null?void 0:v.indexOf(C))===-1?"hexagon":"grid3d":x==="grid"?(v==null?void 0:v.indexOf(C))===-1?"grid":"grid3d":"heatmap"}}]),r}(nh);function uS(e){var i=lS();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function lS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cS=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,fS=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,pS=function(e){(0,Pr.Z)(r,e);var i=uS(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"texture",void 0),n}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;return{u_opacity:s||1,u_texture:this.texture}}},{key:"initModels",value:function(){var a=this,s=this.layer.getLayerConfig(),p=s.mask,v=p===void 0?!1:p,g=s.maskInside,x=g===void 0?!0:g,C=this.layer.getSource(),T=this.rendererService.createTexture2D;if(this.texture=T({height:0,width:0}),$i){var R=this.layerService.sceneService.getSceneConfig().canvas,F=R.createImage();F.crossOrigin="anonymous",F.src=C.data.originData,F.onload=function(){a.texture=T({data:F,width:F.width,height:F.height}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}else C.data.images.then(function(j){a.texture=T({data:j[0],width:j[0].width,height:j[0].height}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()});return[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:fS,fragmentShader:cS,triangulation:Gg,primitive:k.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:Pa(v,x)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_Uv",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(s,p,v,g){return[v[3],v[4]]}}})}}]),r}(xo),hS={image:pS},dS=hS;function vS(e){var i=mS();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function mS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gS=function(e){(0,Pr.Z)(r,e);var i=vS(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"type","ImageLayer"),n}return(0,Mt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new dS[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={image:{}};return s[a]}},{key:"getModelType",value:function(){return"image"}}]),r}(nh);function yS(e){var i=_S();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function _S(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xS=`
uniform float u_opacity;

varying vec4 v_dash_array;
varying vec4 v_color;

uniform float segmentNumber;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity;

  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  }
  gl_FragColor.a *=flag;
  
  gl_FragColor = filterColor(gl_FragColor);
}`,bS=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;


uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  vec2 s = source;
  vec2 t = target;
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  

   styleMappingMat[3].b = segmentIndex / segmentNumber;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,ES=`
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  
  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = styleMappingMat[3].g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = styleMappingMat[3].a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);
}`,SS=`#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
     styleMappingMat[3].g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,CS=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}`,AS=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,wS={solid:0,dash:1},TS=function(e){(0,Pr.Z)(r,e);var i=yS(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"texture",void 0),(0,A.Z)((0,ue.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:k.NEAREST,min:k.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,v=a.targetColor,g=a.textureBlend,x=g===void 0?"normal":g,C=a.lineType,T=C===void 0?"solid":C,R=a.dashArray,F=R===void 0?[10,5]:R,j=a.forward,Y=j===void 0?!0:j,J=a.lineTexture,be=J===void 0?!1:J,Be=a.iconStep,Ye=Be===void 0?100:Be,tt=a.segmentNumber,Et=tt===void 0?30:tt,wt=a.thetaOffset,Yt=wt===void 0?.314:wt;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s,thetaOffset:Yt})){this.judgeStyleAttributes({opacity:s,thetaOffset:Yt});var ar=this.layer.getEncodedData(),Mr=this.calDataFrame(this.cellLength,ar,this.cellProperties),Qr=Mr.data,br=Mr.width,vn=Mr.height;this.rowCount=vn,this.dataTexture=this.cellLength>0&&Qr.length>0?this.createTexture2D({flipY:!0,data:Qr,format:k.LUMINANCE,type:k.FLOAT,width:br,height:vn}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}F.length===2&&F.push(0,0);var Pn=0,$n=[0,0,0,0],Ba=[0,0,0,0];return p&&v&&($n=_i(p),Ba=_i(v),Pn=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:ha()(Yt)?Yt:0,u_opacity:ha()(s)?s:1,u_textureBlend:x==="normal"?0:1,segmentNumber:Et,u_line_type:wS[T||"solid"],u_dash_array:F,u_blur:.9,u_lineDir:Y?1:-1,u_texture:this.texture,u_line_texture:be?1:0,u_icon_step:Ye,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Pn,u_sourceColor:$n,u_targetColor:Ba}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,p=a.targetColor,v=a.lineType;return v==="dash"?{frag:xS,vert:bS,type:"dash"}:s&&p?{frag:CS,vert:AS,type:"linear"}:{frag:ES,vert:SS,type:"normal"}}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,p=s===void 0?30:s,v=a.mask,g=v===void 0?!1:v,x=a.maskInside,C=x===void 0?!0:x,T=this.getShaders(),R=T.frag,F=T.vert,j=T.type;return[this.layer.buildLayerModel({moduleName:"arc2dline"+j,vertexShader:F,fragmentShader:R,triangulation:z0,depth:{enable:!1},blend:this.getBlend(),segmentNumber:p,stencil:Pa(g,C)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(p,v,g,x){var C=p.size,T=C===void 0?1:C;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:On.Attribute,descriptor:{name:"a_Instance",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:4,update:function(p,v,g,x){return[g[3],g[4],g[5],g[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(p,v,g,x){var C=a.iconService.getIconMap(),T=p.texture,R=C[T]||{x:0,y:0},F=R.x,j=R.y;return[F,j]}}})}}]),r}(xo);function MS(e){var i=PS();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function PS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var IS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,OS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,RS=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;


uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,kS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,LS={solid:0,dash:1},DS=function(e){(0,Pr.Z)(r,e);var i=MS(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"texture",void 0),(0,A.Z)((0,ue.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:k.NEAREST,min:k.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,v=a.targetColor,g=a.textureBlend,x=g===void 0?"normal":g,C=a.lineType,T=C===void 0?"solid":C,R=a.dashArray,F=R===void 0?[10,5]:R,j=a.lineTexture,Y=j===void 0?!1:j,J=a.iconStep,be=J===void 0?100:J,Be=a.segmentNumber,Ye=Be===void 0?30:Be,tt=a.globalArcHeight,Et=tt===void 0?10:tt;F.length===2&&F.push(0,0);var wt=0,Yt=[0,0,0,0],ar=[0,0,0,0];if(p&&v&&(Yt=_i(p),ar=_i(v),wt=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var Mr=this.layer.getEncodedData(),Qr=this.calDataFrame(this.cellLength,Mr,this.cellProperties),br=Qr.data,vn=Qr.width,Pn=Qr.height;this.rowCount=Pn,this.dataTexture=this.cellLength>0&&br.length>0?this.createTexture2D({flipY:!0,data:br,format:k.LUMINANCE,type:k.FLOAT,width:vn,height:Pn}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:Mg,u_global_height:Et,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ha()(s)?s:1,u_textureBlend:x==="normal"?0:1,segmentNumber:Ye,u_line_type:LS[T]||0,u_dash_array:F,u_texture:this.texture,u_line_texture:Y?1:0,u_icon_step:be,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:wt,u_sourceColor:Yt,u_targetColor:ar}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,p=a.targetColor,v=a.lineType;return s&&p?{frag:RS,vert:kS,type:"linear"}:{frag:IS,vert:OS,type:"normal"}}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,p=s===void 0?30:s,v=a.mask,g=v===void 0?!1:v,x=a.maskInside,C=x===void 0?!0:x,T=this.getShaders(),R=T.frag,F=T.vert,j=T.type;return[this.layer.buildLayerModel({moduleName:"arc3Dline"+j,vertexShader:F,fragmentShader:R,triangulation:z0,blend:this.getBlend(),segmentNumber:p,stencil:Pa(g,C)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(p,v,g,x){var C=p.size,T=C===void 0?1:C;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:On.Attribute,descriptor:{name:"a_Instance",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:4,update:function(p,v,g,x){return[g[3],g[4],g[5],g[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(p,v,g,x){var C=a.iconService.getIconMap(),T=p.texture,R=C[T]||{x:0,y:0},F=R.x,j=R.y;return[F,j]}}})}}]),r}(xo);function FS(e){var i=BS();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function BS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var NS=`#define LineTypeSolid 0.0
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
// varying vec2 v_normal;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float segmentNumber;
varying float v_distance_ratio;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
 
  gl_FragColor.a *= u_opacity;

  if(u_aimate.x == Animate) {
      float animateSpeed = u_time / u_aimate.y; // \u8FD0\u52A8\u901F\u5EA6
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }
}`,zS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

uniform float u_lineDir: 1.0;

// \u504F\u79FB\u91CF
uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = u_thetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  v_distance_ratio = segmentIndex / segmentNumber;
  
  if(u_aimate.x == Animate && u_lineDir != 1.0) {
      v_distance_ratio = 1.0 - v_distance_ratio;
  }

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
}
`,US=function(e){(0,Pr.Z)(r,e);var i=FS(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,v=a.targetColor,g=a.forward,x=g===void 0?!0:g,C=a.segmentNumber,T=C===void 0?30:C,R=a.thetaOffset,F=R===void 0?.314:R,j=0,Y=[0,0,0,0],J=[0,0,0,0];return p&&v&&(Y=_i(p),J=_i(v),j=1),{u_thetaOffset:F,u_opacity:ha()(s)?s:1,segmentNumber:T,u_blur:.9,u_lineDir:x?1:-1,u_linearColor:j,u_sourceColor:Y,u_targetColor:J}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,p=s===void 0?30:s;return[this.layer.buildLayerModel({moduleName:"arc2dminiline",vertexShader:zS,fragmentShader:NS,triangulation:z0,depth:{enable:!1},blend:this.getBlend(),segmentNumber:p})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,p,v,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:On.Attribute,descriptor:{name:"a_Instance",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:4,update:function(s,p,v,g){return[v[3],v[4],v[5],v[6]]}}})}}]),r}(xo);function ZS(e){var i=jS();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function jS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var VS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = styleMappingMat[3].g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,GS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  styleMappingMat[3].g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,HS={solid:0,dash:1},WS=function(e){(0,Pr.Z)(r,e);var i=ZS(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"texture",void 0),(0,A.Z)((0,ue.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:k.NEAREST,min:k.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,v=a.targetColor,g=a.textureBlend,x=g===void 0?"normal":g,C=a.lineType,T=C===void 0?"solid":C,R=a.dashArray,F=R===void 0?[10,5]:R,j=a.lineTexture,Y=j===void 0?!1:j,J=a.iconStep,be=J===void 0?100:J,Be=a.segmentNumber,Ye=Be===void 0?30:Be;F.length===2&&F.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var tt=0,Et=[0,0,0,0],wt=[0,0,0,0];if(p&&v&&(Et=_i(p),wt=_i(v),tt=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var Yt=this.layer.getEncodedData(),ar=this.calDataFrame(this.cellLength,Yt,this.cellProperties),Mr=ar.data,Qr=ar.width,br=ar.height;this.rowCount=br,this.dataTexture=this.cellLength>0&&Mr.length>0?this.createTexture2D({flipY:!0,data:Mr,format:k.LUMINANCE,type:k.FLOAT,width:Qr,height:br}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ha()(s)?s:1,u_textureBlend:x==="normal"?0:1,segmentNumber:Ye,u_line_type:HS[T]||0,u_dash_array:F,u_texture:this.texture,u_line_texture:Y?1:0,u_icon_step:be,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:tt,u_sourceColor:Et,u_targetColor:wt}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"greatcircleline",vertexShader:GS,fragmentShader:VS,triangulation:z0,depth:{enable:!1},blend:this.getBlend(),stencil:Pa(p,g)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(p,v,g,x){var C=p.size,T=C===void 0?1:C;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:On.Attribute,descriptor:{name:"a_Instance",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:4,update:function(p,v,g,x){return[g[3],g[4],g[5],g[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(p,v,g,x){var C=a.iconService.getIconMap(),T=p.texture,R=C[T]||{x:0,y:0},F=R.x,j=R.y;return[F,j]}}})}}]),r}(xo);function XS(e){var i=YS();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function YS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qS=`#define LineTypeSolid 0.0
uniform float u_opacity : 1.0;

varying vec4 v_color;

// dash
varying vec4 v_dash_array;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
 // dash line
 
  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  }
  gl_FragColor.a *=flag;

  gl_FragColor = filterColor(gl_FragColor);
}
`,KS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  vec2 offset = project_pixel(size.xy);

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = a_DistanceAndIndex.x / a_Total_Distance; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_DistanceAndIndex.x;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));
  } else {
    float lineHeight = a_Size.y;
 
    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,$S=`#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = styleMappingMat[3].a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth/2.0;

    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) {
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,oy=`
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,QS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;

varying vec4 v_color;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"


varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,JS={solid:0,dash:1},sy=function(e){(0,Pr.Z)(r,e);var i=XS(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"texture",void 0),(0,A.Z)((0,ue.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:k.NEAREST,min:k.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,v=a.targetColor,g=a.textureBlend,x=g===void 0?"normal":g,C=a.lineType,T=C===void 0?"solid":C,R=a.dashArray,F=R===void 0?[10,5,0,0]:R,j=a.lineTexture,Y=j===void 0?!1:j,J=a.iconStep,be=J===void 0?100:J,Be=a.vertexHeightScale,Ye=Be===void 0?20:Be,tt=a.borderWidth,Et=tt===void 0?0:tt,wt=a.borderColor,Yt=wt===void 0?"#ccc":wt,ar=a.raisingHeight,Mr=ar===void 0?0:ar,Qr=a.heightfixed,br=Qr===void 0?!1:Qr,vn=a.arrow,Pn=vn===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:vn;F.length===2&&F.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var $n=0,Ba=[0,0,0,0],Yo=[0,0,0,0];if(p&&v&&(Ba=_i(p),Yo=_i(v),$n=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var ks=this.layer.getEncodedData(),Ls=this.calDataFrame(this.cellLength,ks,this.cellProperties),Hs=Ls.data,ff=Ls.width,gv=Ls.height;this.rowCount=gv,this.dataTexture=this.cellLength>0&&Hs.length>0?this.createTexture2D({flipY:!0,data:Hs,format:k.LUMINANCE,type:k.FLOAT,width:ff,height:gv}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ha()(s)?s:1,u_textureBlend:x==="normal"?0:1,u_line_type:JS[T],u_dash_array:F,u_texture:this.texture,u_line_texture:Y?1:0,u_icon_step:be,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:Et,u_borderColor:_i(Yt),u_linearColor:$n,u_sourceColor:Ba,u_targetColor:Yo,u_heightfixed:Number(br),u_vertexScale:Ye,u_raisingHeight:Number(Mr),u_arrow:Number(Pn.enable),u_arrowHeight:Pn.arrowHeight||3,u_arrowWidth:Pn.arrowWidth||2,u_tailWidth:Pn.tailWidth===void 0?1:Pn.tailWidth}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=a.depth,C=x===void 0?!1:x,T=this.getShaders(),R=T.frag,F=T.vert,j=T.type;return this.layer.triangulation=Jd,[this.layer.buildLayerModel({moduleName:"line_"+j,vertexShader:F,fragmentShader:R,triangulation:Jd,primitive:k.TRIANGLES,blend:this.getBlend(),depth:{enable:C},stencil:Pa(p,g)})]}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,p=a.targetColor,v=a.lineType;return v==="dash"?{frag:qS,vert:KS,type:"dash"}:s&&p?{frag:QS,vert:oy,type:"linear"}:{frag:$S,vert:oy,type:"normal"}}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:On.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(p,v,g,x,C,T){return T===void 0?[g[3],10]:[g[3],T]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:On.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(p,v,g,x){return[g[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(p,v,g,x){var C=p.size,T=C===void 0?1:C;return Array.isArray(T)?[T[0],T[1]]:[T,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:On.Attribute,descriptor:{name:"a_Normal",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(p,v,g,x,C){return C}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:On.Attribute,descriptor:{name:"a_Miter",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(p,v,g,x){return[g[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(p,v,g,x){var C=a.iconService.getIconMap(),T=p.texture,R=C[T]||{x:0,y:0},F=R.x,j=R.y;return[F,j]}}})}}]),r}(xo);function eC(e){var i=tC();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function tC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rC=`uniform float u_opacity : 1.0;
uniform sampler2D u_texture;

#pragma include "picking"

varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = texture2D(u_texture, vec2(d_distance_ratio, 0.5));

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,nC=`
attribute float a_Miter;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

uniform float u_opacity: 1.0;

#pragma include "projection"
#pragma include "picking"

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,iC=function(e){(0,Pr.Z)(r,e);var i=eC(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"colorTexture",void 0),(0,A.Z)((0,ue.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;n.colorTexture&&n.colorTexture.destroy();var g=n.layer.getLayerConfig(),x=g.rampColors,C=hl(x);n.colorTexture=v({data:new Uint8Array(C.data),width:C.width,height:C.height,wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE,min:k.NEAREST,mag:k.NEAREST,flipY:!1})}),n}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.vertexHeightScale,v=p===void 0?20:p,g=a.raisingHeight,x=g===void 0?0:g,C=a.heightfixed,T=C===void 0?!1:C;if(this.rendererService.getDirty()&&this.colorTexture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var R=this.layer.getEncodedData(),F=this.calDataFrame(this.cellLength,R,this.cellProperties),j=F.data,Y=F.width,J=F.height;this.rowCount=J,this.dataTexture=this.cellLength>0&&j.length>0?this.createTexture2D({flipY:!0,data:j,format:k.LUMINANCE,type:k.FLOAT,width:Y,height:J}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ha()(s)?s:1,u_texture:this.colorTexture,u_heightfixed:Number(T),u_vertexScale:v,u_raisingHeight:Number(x)}}},{key:"initModels",value:function(){return this.updateTexture(),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.colorTexture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=a.depth,C=x===void 0?!1:x,T=this.getShaders(),R=T.frag,F=T.vert,j=T.type;return this.layer.triangulation=Jd,[this.layer.buildLayerModel({moduleName:"line_"+j,vertexShader:F,fragmentShader:R,triangulation:Jd,primitive:k.TRIANGLES,blend:this.getBlend(),depth:{enable:C},stencil:Pa(p,g)})]}},{key:"getShaders",value:function(){return{frag:rC,vert:nC,type:"linear_rampColors"}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:On.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(s,p,v,g,x,C){return C===void 0?[v[3],10]:[v[3],C]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:On.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,p,v,g){return[v[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(s,p,v,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0],C[1]]:[C,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:On.Attribute,descriptor:{name:"a_Normal",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(s,p,v,g,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:On.Attribute,descriptor:{name:"a_Miter",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,p,v,g){return[v[4]]}}})}}]),r}(xo);function aC(e){var i=oC();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function oC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sC=`

uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,uC=`
varying vec4 v_color;
varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,uy=`
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Position;


// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_vertexScale: 1.0;

#pragma include "projection"

varying vec4 v_color;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_color = a_Color;  

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
  }
}
`,lC=function(e){(0,Pr.Z)(r,e);var i=aC(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,v=a.targetColor,g=a.vertexHeightScale,x=g===void 0?20:g,C=0,T=[0,0,0,0],R=[0,0,0,0];if(p&&v&&(T=_i(p),R=_i(v),C=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var F=this.layer.getEncodedData(),j=this.calDataFrame(this.cellLength,F,this.cellProperties),Y=j.data,J=j.width,be=j.height;this.rowCount=be,this.dataTexture=this.cellLength>0&&Y.length>0?this.createTexture2D({flipY:!0,data:Y,format:k.LUMINANCE,type:k.FLOAT,width:J,height:be}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ha()(s)?s:1,u_linearColor:C,u_sourceColor:T,u_targetColor:R,u_vertexScale:x}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,p=a.targetColor;return s&&p?{frag:sC,vert:uy,type:"linear"}:{frag:uC,vert:uy,type:"normal"}}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.getShaders(),C=x.frag,T=x.vert,R=x.type;return[this.layer.buildLayerModel({moduleName:"simpleline"+R,vertexShader:T,fragmentShader:C,triangulation:V2,primitive:k.LINES,blend:this.getBlend(),depth:{enable:!1},stencil:Pa(p,g)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:On.Attribute,descriptor:{name:"a_Distance",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,p,v,g){return[v[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:On.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,p,v,g){return[v[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(s,p,v,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0],C[1]]:[C,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:On.Attribute,descriptor:{name:"a_Normal",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(s,p,v,g,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:On.Attribute,descriptor:{name:"a_Miter",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,p,v,g){return[v[4]]}}})}}]),r}(xo);function cC(e){var i=fC();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function fC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pC=`#define LineTypeSolid 0.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity : 1.0;
uniform float u_textureBlend;
uniform float u_iconStepCount;

varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

// dash
uniform float u_dash_offset : 0.0;
uniform float u_dash_ratio : 0.1;

varying vec2 v_iconMapUV;
varying float v_blur;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = styleMappingMat[3].a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);

    
  
  
}
`,hC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

varying vec4 v_color;
varying float v_blur;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "light"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    originSize = project_float_pixel(a_Size.x);
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);

  // v_lightWeight = lightWeight;
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);
  // v_color = a_Color;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,dC=function(e){(0,Pr.Z)(r,e);var i=cC(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"texture",void 0),(0,A.Z)((0,ue.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:k.NEAREST,min:k.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,v=a.targetColor,g=a.textureBlend,x=g===void 0?"normal":g,C=a.heightfixed,T=C===void 0?!1:C,R=a.lineTexture,F=R===void 0?!1:R,j=a.iconStep,Y=j===void 0?100:j,J=a.iconStepCount,be=J===void 0?1:J;this.rendererService.getDirty()&&this.texture.bind();var Be=0,Ye=[0,0,0,0],tt=[0,0,0,0];if(p&&v&&(Ye=_i(p),tt=_i(v),Be=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var Et=this.layer.getEncodedData(),wt=this.calDataFrame(this.cellLength,Et,this.cellProperties),Yt=wt.data,ar=wt.width,Mr=wt.height;this.rowCount=Mr,this.dataTexture=this.cellLength>0&&Yt.length>0?this.createTexture2D({flipY:!0,data:Yt,format:k.LUMINANCE,type:k.FLOAT,width:ar,height:Mr}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_heightfixed:Number(T),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ha()(s)?s:1,u_textureBlend:x==="normal"?0:1,u_texture:this.texture,u_line_texture:F?1:0,u_iconStepCount:be,u_icon_step:Y,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Be,u_sourceColor:Ye,u_targetColor:tt}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"linewall",vertexShader:hC,fragmentShader:pC,triangulation:Jd,primitive:k.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:On.Attribute,descriptor:{name:"a_Distance",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(p,v,g,x){return[g[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:On.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(p,v,g,x){return[g[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(p,v,g,x){var C=p.size,T=C===void 0?1:C;return Array.isArray(T)?[T[0],T[1]]:[T,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:On.Attribute,descriptor:{name:"a_Normal",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(p,v,g,x,C){return C}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:On.Attribute,descriptor:{name:"a_Miter",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(p,v,g,x){return[g[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(p,v,g,x){var C=a.iconService.getIconMap(),T=p.texture,R=C[T]||{x:0,y:0},F=R.x,j=R.y;return[F,j]}}})}}]),r}(xo),vC={arc:TS,arcmini:US,arc3d:DS,greatcircle:WS,wall:dC,line:sy,simple:lC,linearline:iC},mC=vC;function gC(e){var i=yC();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function yC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _C=function(e){(0,Pr.Z)(r,e);var i=gC(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"type","LineLayer"),n}return(0,Mt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new mC[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},arcmini:{blend:"additive"},greatcircle:{blend:"additive"}};return s[a]}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),p=s==null||(a=s.scale)===null||a===void 0?void 0:a.field;return p||"line"}}]),r}(nh);function xC(e){var i=bC();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function bC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var EC=`varying vec4 v_color;
uniform float u_opacity: 1.0;

varying float v_z;
varying float v_lightWeight;
uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_z);
    gl_FragColor.rgb *= v_lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_z): v_z;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, v_lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,SC=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

varying float v_z;
varying float v_lightWeight;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  v_z = a_Position.z;

 

  // vec2 offset = project_pixel(size.xy);
  // vec2 offset = (size.xy);

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    // offset = project_pixel(offset);
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // vec4 pos = vec4(project_pos.xy + offset, project_pixel(size.z) * u_r, 1.0);
  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  // float lightWeight = u_lightEnable > 0.0 ? calc_lighting(pos): 1.0;
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  v_lightWeight = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  
  if(u_globel > 0.0) {
    // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
    //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
    float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
    float xRadian = getXRadian(a_Pos.y, r);
    float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 mx = mat4(
      1,0,0,0,  
      0,xcos,-xsin,0,  
      0,xsin,xcos,0,  
      0,0,0,1);

    //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
    float yRadian = getYRadian(a_Pos.x, a_Pos.z);
    float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 my = mat4(
      ycos,0,-ysin,0,  
      0,1,0,0,  
      ysin,0,ycos,0,  
      0,0,0,1);

    gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  }

  setPickingColor(a_PickingColor);
}
`,ly=function(e){(0,Pr.Z)(r,e);var i=xC(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"raiseCount",0),(0,A.Z)((0,ue.Z)(n),"raiserepeat",0),n}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,p=s===void 0?{enable:!1,speed:.01,repeat:!1}:s,v=a.opacity,g=v===void 0?1:v,x=a.sourceColor,C=a.targetColor,T=a.pickLight,R=T===void 0?!1:T,F=a.heightfixed,j=F===void 0?!1:F,Y=a.opacityLinear,J=Y===void 0?{enable:!1,dir:"up"}:Y,be=a.lightEnable,Be=be===void 0?!0:be;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:g})){this.judgeStyleAttributes({opacity:g});var Ye=this.layer.getEncodedData(),tt=this.calDataFrame(this.cellLength,Ye,this.cellProperties),Et=tt.data,wt=tt.width,Yt=tt.height;this.rowCount=Yt,this.dataTexture=this.cellLength>0&&Et.length>0?this.createTexture2D({flipY:!0,data:Et,format:k.LUMINANCE,type:k.FLOAT,width:wt,height:Yt}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}var ar=0,Mr=[0,0,0,0],Qr=[0,0,0,0];if(x&&C&&(Mr=_i(x),Qr=_i(C),ar=1),this.raiseCount<1&&this.raiserepeat>0&&p.enable){var br=p.speed,vn=br===void 0?.01:br,Pn=p.repeat,$n=Pn===void 0?!1:Pn;this.raiseCount+=vn,this.raiseCount>=1&&(this.raiserepeat>1?(this.raiseCount=0,this.raiserepeat--):this.raiseCount=1)}return{u_pickLight:Number(R),u_heightfixed:Number(j),u_r:p.enable&&this.raiserepeat>0?this.raiseCount:1,u_globel:this.mapService.version==="GLOBEL"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ha()(g)?g:1,u_linearColor:ar,u_sourceColor:Mr,u_targetColor:Qr,u_opacitylinear:Number(J.enable),u_opacitylinear_dir:J.dir==="up"?1:0,u_lightEnable:Number(Be)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.depth,p=s===void 0?!0:s,v=a.animateOption.repeat,g=v===void 0?1:v;return this.raiserepeat=g,[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:SC,fragmentShader:EC,triangulation:zg,blend:this.getBlend(),cull:{enable:!0,face:Ul(this.mapService.version)},depth:{enable:p}})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(p,v,g,x){var C=p.size;if(C){var T=[];return Array.isArray(C)&&(T=C.length===2?[C[0],C[0],C[1]]:C),Array.isArray(C)||(T=[C,C,C]),T}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:On.Attribute,descriptor:{name:"a_Normal",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(p,v,g,x,C){return C}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:On.Attribute,descriptor:{name:"a_Pos",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(p,v){var g=Dh(p.coordinates);return a?Ig([g[0],g[1]]):[g[0],g[1],0]}}})}}]),r}(xo);function CC(e){var i=AC();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function AC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cy=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  
  outer_df = sdCircle(v_data.xy, 1.0);
  inner_df = sdCircle(v_data.xy, r);


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

 gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  float d = length(v_data.xy);
  if(d > 0.5) {
    discard;
  }
  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
  
  // TODO: \u6839\u636E\u53E0\u52A0\u6A21\u5F0F\u9009\u62E9\u6548\u679C
  if(u_additive > 0.0) {
    gl_FragColor *= intensity;
    // TODO: \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,wC=`
uniform float u_globel;
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(u_globel > 0.0) {
    // TODO: \u5730\u7403\u6A21\u5F0F\u4E0B\u907F\u514D\u591A\u4F59\u7247\u5143\u7ED8\u5236\uFF0C\u540C\u65F6\u4E5F\u80FD\u907F\u514D\u6709\u7528\u7247\u5143\u5728\u900F\u660E\u4E14\u91CD\u53E0\u7684\u60C5\u51B5\u4E0B\u65E0\u6CD5\u5199\u5165
    // \u4ED8\u51FA\u7684\u4EE3\u4EF7\u662F\u8FB9\u7F18\u4F1A\u6709\u4E00\u4E9B\u952F\u9F7F
    if(outer_df > antialiasblur + 0.018) discard;
  }
  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,Fv=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;
uniform float u_raisingHeight: 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raiseHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, u_raisingHeight, 1.0));
  }

  if(u_globel > 0.0) {
    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,fy=function(e){(0,Pr.Z)(r,e);var i=CC(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"meter2coord",1),(0,A.Z)((0,ue.Z)(n),"isMeter",!1),n}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.strokeOpacity,g=v===void 0?1:v,x=a.strokeWidth,C=x===void 0?0:x,T=a.stroke,R=T===void 0?"rgba(0,0,0,0)":T,F=a.offsets,j=F===void 0?[0,0]:F,Y=a.blend,J=a.blur,be=J===void 0?0:J,Be=a.raisingHeight,Ye=Be===void 0?0:Be;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,strokeOpacity:g,strokeWidth:C,stroke:R,offsets:j})){this.judgeStyleAttributes({opacity:p,strokeOpacity:g,strokeWidth:C,stroke:R,offsets:j});var tt=this.layer.getEncodedData(),Et=this.calDataFrame(this.cellLength,tt,this.cellProperties),wt=Et.data,Yt=Et.width,ar=Et.height;this.rowCount=ar,this.dataTexture=this.cellLength>0&&wt.length>0?this.createTexture2D({flipY:!0,data:wt,format:k.LUMINANCE,type:k.FLOAT,width:Yt,height:ar}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(Ye),u_isMeter:Number(this.isMeter),u_blur:be,u_additive:Y==="additive"?1:0,u_globel:this.mapService.version===Rs.GLOBEL?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ha()(p)?p:1,u_stroke_opacity:ha()(g)?g:1,u_stroke_width:ha()(C)?C:0,u_stroke_color:this.getStrokeColor(R),u_offsets:this.isOffsetStatic(j)?j:[0,0]}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,p=s===void 0?{enable:!1}:s;return{u_aimate:this.animateOption2Array(p),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Nh)}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.unit,p=s===void 0?"l7size":s,v=this.mapService.version;return p==="meter"&&v!==Rs.L7MAP&&v!==Rs.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,gn.Z)(this.layer.getSource().extent,4),s=a[0],p=a[1],v=a[2],g=a[3],x=[(s+v)/2,(p+g)/2],C=this.mapService.version;if(C===Rs.MAPBOX&&window.mapboxgl.MercatorCoordinate){var T=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:x[0],lat:x[1]},0),R=1,F=R*T.meterInMercatorCoordinateUnits(),j=new window.mapboxgl.MercatorCoordinate(T.x-F,T.y,T.z),Y=j.toLngLat();this.meter2coord=x[0]-Y.lng;return}var J=this.mapService.meterToCoord(x,[s,p]),be=this.mapService.meterToCoord(x,[v===s?v+.1:v,g===p?p+.1:g]);this.meter2coord=(J+be)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=a.animateOption,C=x===void 0?{enable:!1}:x,T=this.getShaders(C),R=T.frag,F=T.vert,j=T.type,Y=this.mapService.version==="GLOBEL";return this.layer.triangulation=Y?Ng:Nh,[this.layer.buildLayerModel({moduleName:"pointfill_"+j,vertexShader:F,fragmentShader:R,triangulation:Y?Ng:Nh,depth:{enable:Y},blend:this.getBlend(),stencil:Pa(p,g),cull:{enable:!0,face:Ul(this.mapService.version)}})]}},{key:"getShaders",value:function(a){if(a.enable)switch(a.type){case"wave":return{frag:cy,vert:Fv,type:"wave"};default:return{frag:cy,vert:Fv,type:"wave"}}else return{frag:wC,vert:Fv,type:"normal"}}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"animateOption2Array",value:function(a){return[a.enable?0:1,a.speed||1,a.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var a=this,s=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"extrude",type:On.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(v,g,x,C){var T;if(s){var R=(0,gn.Z)(x,3),F=R[0],j=R[1],Y=R[2],J=Xa.fromValues(0,0,1),be=Xa.fromValues(F,0,Y),Be=F>=0?Xa.angle(J,be):Math.PI*2-Xa.angle(J,be),Ye=Math.PI*2-Math.asin(j/100),tt=Yi();rf(tt,tt,Be),up(tt,tt,Ye);var Et=Xa.fromValues(1,1,0);Xa.transformMat4(Et,Et,tt),Xa.normalize(Et,Et);var wt=Xa.fromValues(-1,1,0);Xa.transformMat4(wt,wt,tt),Xa.normalize(wt,wt);var Yt=Xa.fromValues(-1,-1,0);Xa.transformMat4(Yt,Yt,tt),Xa.normalize(Yt,Yt);var ar=Xa.fromValues(1,-1,0);Xa.transformMat4(ar,ar,tt),Xa.normalize(ar,ar),T=[].concat((0,Se.Z)(Et),(0,Se.Z)(wt),(0,Se.Z)(Yt),(0,Se.Z)(ar))}else T=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var Mr=C%4*3;return[T[Mr],T[Mr+1],T[Mr+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(v,g,x,C){var T=v.size,R=T===void 0?5:T;return Array.isArray(R)?[R[0]*a.meter2coord]:[R*a.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:On.Attribute,descriptor:{name:"a_Shape",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(v,g,x,C){var T=v.shape,R=T===void 0?2:T,F=a.layer.getLayerConfig().shape2d,j=F.indexOf(R);return[j]}}})}}]),r}(xo);function TC(e){var i=MC();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function MC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var PC=`uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv;

void main() {

  float opacity = styleMappingMat[0][0];

  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  gl_FragColor = texture2D(u_texture, pos);
  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,IC=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute vec2 a_Uv;
attribute float a_Rotate;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform mat2 u_RotateMatrix;
uniform float u_isMeter;

varying float v_radius;
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv; // icon \u8D34\u56FE\u7684 uv \u5750\u6807

uniform float u_opacity : 1;
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;

  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // radius(16-bit)
  v_radius = a_Size;

  // TODO: billboard
  // anti-alias
  

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);

  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (rotation_matrix * u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,OC=function(e){(0,Pr.Z)(r,e);var i=TC(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"meter2coord",1),(0,A.Z)((0,ue.Z)(n),"texture",void 0),(0,A.Z)((0,ue.Z)(n),"isMeter",!1),(0,A.Z)((0,ue.Z)(n),"radian",0),(0,A.Z)((0,ue.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layer.renderLayers();return}n.texture=v({data:n.iconService.getCanvas(),mag:k.LINEAR,min:k.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.strokeOpacity,g=v===void 0?1:v,x=a.strokeWidth,C=x===void 0?0:x,T=a.stroke,R=T===void 0?"rgba(0,0,0,0)":T,F=a.offsets,j=F===void 0?[0,0]:F,Y=a.blend,J=a.rotation;this.rendererService.getDirty()&&this.texture.bind();var be=1;if((this.mapService.version==="GAODE2.x"||this.mapService.version==="GAODE1.x")&&(be=-1),this.radian=J!==void 0?be*Math.PI*J/180:be*Math.PI*(this.mapService.getRotation()%360)/180,this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,strokeOpacity:g,strokeWidth:C,stroke:R,offsets:j})){this.judgeStyleAttributes({opacity:p,strokeOpacity:g,strokeWidth:C,stroke:R,offsets:j});var Be=this.layer.getEncodedData(),Ye=this.calDataFrame(this.cellLength,Be,this.cellProperties),tt=Ye.data,Et=Ye.width,wt=Ye.height;this.rowCount=wt,this.dataTexture=this.cellLength>0&&tt.length>0?this.createTexture2D({flipY:!0,data:tt,format:k.LUMINANCE,type:k.FLOAT,width:Et,height:wt}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_additive:Y==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:ha()(p)?p:1,u_offsets:this.isOffsetStatic(j)?j:[0,0]}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Nh)}},{key:"initModels",value:function(){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture);var a=this.layer.getLayerConfig(),s=a.unit,p=s===void 0?"l7size":s,v=this.mapService.version;return p==="meter"&&v!==Rs.L7MAP&&v!==Rs.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,gn.Z)(this.layer.getSource().extent,4),s=a[0],p=a[1],v=a[2],g=a[3],x=[(s+v)/2,(p+g)/2],C=this.mapService.version;if(C===Rs.MAPBOX&&window.mapboxgl.MercatorCoordinate){var T=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:x[0],lat:x[1]},0),R=1,F=R*T.meterInMercatorCoordinateUnits(),j=new window.mapboxgl.MercatorCoordinate(T.x-F,T.y,T.z),Y=j.toLngLat();this.meter2coord=x[0]-Y.lng;return}var J=this.mapService.meterToCoord(x,[s,p]),be=this.mapService.meterToCoord(x,[v===s?v+.1:v,g===p?p+.1:g]);this.meter2coord=(J+be)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.getShaders(),C=x.frag,T=x.vert,R=x.type;return[this.layer.buildLayerModel({moduleName:"pointfill_"+R,vertexShader:T,fragmentShader:C,triangulation:Nh,depth:{enable:!1},blend:this.getBlend(),stencil:Pa(p,g),cull:{enable:!0,face:Ul(this.mapService.version)}})]}},{key:"getShaders",value:function(){return{frag:PC,vert:IC,type:"normal"}}},{key:"clearModels",value:function(){var a,s;this.iconService.off("imageUpdate",this.updateTexture),(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"rotate",type:On.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(p,v,g,x){var C=p.rotate,T=C===void 0?0:C;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_Uv",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(p,v,g,x){var C=a.iconService.getIconMap(),T=p.shape,R=C[T]||{x:0,y:0},F=R.x,j=R.y;return[F,j]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:On.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(p,v,g,x){var C=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],T=x%4*3;return[C[T],C[T+1],C[T+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(p,v,g,x){var C=p.size,T=C===void 0?5:C;return Array.isArray(T)?[T[0]*a.meter2coord]:[T*a.meter2coord]}}})}}]),r}(xo);function RC(e){var i=kC();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function kC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var LC=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,DC=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,FC=function(e){(0,Pr.Z)(r,e);var i=RC(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"texture",void 0),n}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;return{u_opacity:s||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var a=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){a.updateTexture(),a.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:DC,fragmentShader:LC,triangulation:Ug,primitive:k.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(p,v,g,x){var C=p.size;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_Uv",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(p,v,g,x){var C=a.fontService.mapping,T=p.shape,R=a.fontService.getGlyph(T),F=C[R],j=F.x,Y=F.y;return[j,Y]}}})}},{key:"updateTexture",value:function(){var a=this.rendererService.createTexture2D,s=this.fontService.canvas;this.texture=a({data:s,mag:k.LINEAR,min:k.LINEAR,width:s.width,height:s.height})}},{key:"initIconFontGlyphs",value:function(){var a=this,s=this.layer.getLayerConfig(),p=s.fontWeight,v=p===void 0?"normal":p,g=s.fontFamily,x=g===void 0?"sans-serif":g,C=this.layer.getEncodedData(),T=[];C.forEach(function(R){var F=R.shape,j=F===void 0?"":F;j=j.toString();var Y=a.fontService.getGlyph(j);T.indexOf(Y)===-1&&T.push(Y)}),this.fontService.setFontOptions({characterSet:T,fontWeight:v,fontFamily:x,fontSize:48})}}]),r}(xo);function BC(e){var i=NC();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function NC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zC=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,UC=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,py=function(e){(0,Pr.Z)(r,e);var i=BC(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"texture",void 0),(0,A.Z)((0,ue.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layer.renderLayers();return}n.texture=v({data:n.iconService.getCanvas(),mag:k.LINEAR,min:k.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.offsets,v=p===void 0?[0,0]:p;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s,offsets:v})){this.judgeStyleAttributes({opacity:s,offsets:v});var g=this.layer.getEncodedData(),x=this.calDataFrame(this.cellLength,g,this.cellProperties),C=x.data,T=x.width,R=x.height;this.rowCount=R,this.dataTexture=this.cellLength>0&&C.length>0?this.createTexture2D({flipY:!0,data:C,format:k.LUMINANCE,type:k.FLOAT,width:T,height:R}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:ha()(s)?s:1,u_offsets:this.isOffsetStatic(v)?v:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:UC,fragmentShader:zC,triangulation:Ug,primitive:k.POINTS,depth:{enable:!1},blend:this.getBlend(),stencil:Pa(p,g)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(p,v,g,x){var C=p.size,T=C===void 0?5:C;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_Uv",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(p,v,g,x){var C=a.iconService.getIconMap(),T=p.shape,R=C[T]||{x:0,y:0},F=R.x,j=R.y;return[F,j]}}})}}]),r}(xo);function ZC(e){var i=jC();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function jC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var VC=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,GC=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function hy(e){var i=e.coordinates;return{vertices:(0,Se.Z)(i),indices:[0],size:i.length}}var dy=function(e){(0,Pr.Z)(r,e);var i=ZC(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,Mt.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.offsets,g=v===void 0?[0,0]:v;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,offsets:g})){this.judgeStyleAttributes({opacity:p,offsets:g});var x=this.layer.getEncodedData(),C=this.calDataFrame(this.cellLength,x,this.cellProperties),T=C.data,R=C.width,F=C.height;this.rowCount=F,this.dataTexture=this.cellLength>0&&T.length>0?this.createTexture2D({flipY:!0,data:T,format:k.LUMINANCE,type:k.FLOAT,width:R,height:F}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ha()(p)?p:1,u_offsets:this.isOffsetStatic(g)?g:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return this.layer.triangulation=hy,[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:GC,fragmentShader:VC,triangulation:hy,depth:{enable:!1},primitive:k.POINTS,blend:this.getBlend(),stencil:Pa(p,g)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,p,v,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0]]:[C]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:Tc.additive}}}]),r}(xo);function HC(e){var i=WC();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function WC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var XC=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }

  vec2 extrude =  styleMappingMat[2].ba;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  // full circle
  // float rades = dot(dir, baseDir);
  // float flag = sign(dir.y);
  // float radar_v = (flag - 1.0) * -0.5 + flag * acos(rades)/pi/2.0;
  
  // half circle
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }



  gl_FragColor.a *= radar_v;
}
`,YC=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;
uniform float u_speed: 1.0;
uniform float u_time;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - a_Extrude.x - a_Extrude.y
    0.0, 0.0, 0.0, 0.0  // 
  );

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  styleMappingMat[2].ba = rotateMatrix * a_Extrude.xy;

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> empty -> empty ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;


  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  v_data = vec4(extrude.x, extrude.y, antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  if(u_globel > 0.0) {
    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);
  }

  setPickingColor(a_PickingColor);
}
`,qC=function(e){(0,Pr.Z)(r,e);var i=HC(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"meter2coord",1),(0,A.Z)((0,ue.Z)(n),"isMeter",!1),n}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.strokeOpacity,g=v===void 0?1:v,x=a.strokeWidth,C=x===void 0?0:x,T=a.stroke,R=T===void 0?"rgba(0,0,0,0)":T,F=a.offsets,j=F===void 0?[0,0]:F,Y=a.blend,J=a.speed,be=J===void 0?1:J;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,strokeOpacity:g,strokeWidth:C,stroke:R,offsets:j})){this.judgeStyleAttributes({opacity:p,strokeOpacity:g,strokeWidth:C,stroke:R,offsets:j});var Be=this.layer.getEncodedData(),Ye=this.calDataFrame(this.cellLength,Be,this.cellProperties),tt=Ye.data,Et=Ye.width,wt=Ye.height;this.rowCount=wt,this.dataTexture=this.cellLength>0&&tt.length>0?this.createTexture2D({flipY:!0,data:tt,format:k.LUMINANCE,type:k.FLOAT,width:Et,height:wt}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_speed:be,u_additive:Y==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ha()(p)?p:1,u_offsets:this.isOffsetStatic(j)?j:[0,0]}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,p=s===void 0?{enable:!1}:s;return{u_aimate:this.animateOption2Array(p),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Nh)}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.unit,p=s===void 0?"l7size":s,v=this.mapService.version;return p==="meter"&&v!==Rs.L7MAP&&v!==Rs.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,gn.Z)(this.layer.getSource().extent,4),s=a[0],p=a[1],v=a[2],g=a[3],x=[(s+v)/2,(p+g)/2],C=this.mapService.version;if(C===Rs.MAPBOX&&window.mapboxgl.MercatorCoordinate){var T=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:x[0],lat:x[1]},0),R=1,F=R*T.meterInMercatorCoordinateUnits(),j=new window.mapboxgl.MercatorCoordinate(T.x-F,T.y,T.z),Y=j.toLngLat();this.meter2coord=x[0]-Y.lng;return}var J=this.mapService.meterToCoord(x,[s,p]),be=this.mapService.meterToCoord(x,[v===s?v+.1:v,g===p?p+.1:g]);this.meter2coord=(J+be)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.getShaders(),C=x.frag,T=x.vert,R=x.type;return[this.layer.buildLayerModel({moduleName:"pointfill_"+R,vertexShader:T,fragmentShader:C,triangulation:Nh,depth:{enable:!1},blend:this.getBlend(),stencil:Pa(p,g),cull:{enable:!0,face:Ul(this.mapService.version)}})]}},{key:"getShaders",value:function(){return{frag:XC,vert:YC,type:"radar"}}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"animateOption2Array",value:function(a){return[a.enable?0:1,a.speed||1,a.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:On.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(p,v,g,x){var C;C=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var T=x%4*3;return[C[T],C[T+1],C[T+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(p,v,g,x){var C=p.size,T=C===void 0?5:C;return Array.isArray(T)?[T[0]*a.meter2coord]:[T*a.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:On.Attribute,descriptor:{name:"a_Shape",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(p,v,g,x){var C=p.shape,T=C===void 0?2:C,R=a.layer.getLayerConfig().shape2d,F=R.indexOf(T);return[F]}}})}}]),r}(xo);function KC(e){var i=$C();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function $C(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var QC=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_additive;

uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  float opacity = styleMappingMat[0][0];
  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);

  

  
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,JC=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143
varying float v_blur;
varying float v_innerRadius;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function vy(e){var i=e.coordinates;return{vertices:(0,Se.Z)(i),indices:[0],size:i.length}}var eA=function(e){(0,Pr.Z)(r,e);var i=KC(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,Mt.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.offsets,g=v===void 0?[0,0]:v,x=a.blend,C=a.strokeOpacity,T=C===void 0?1:C,R=a.strokeWidth,F=R===void 0?0:R,j=a.stroke,Y=j===void 0?"#fff":j;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,offsets:g})){this.judgeStyleAttributes({opacity:p,offsets:g});var J=this.layer.getEncodedData(),be=this.calDataFrame(this.cellLength,J,this.cellProperties),Be=be.data,Ye=be.width,tt=be.height;this.rowCount=tt,this.dataTexture=this.cellLength>0&&Be.length>0?this.createTexture2D({flipY:!0,data:Be,format:k.LUMINANCE,type:k.FLOAT,width:Ye,height:tt}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_additive:x==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ha()(p)?p:1,u_offsets:this.isOffsetStatic(g)?g:[0,0],u_stroke_opacity:ha()(T)?T:1,u_stroke_width:ha()(F)?F:0,u_stroke_color:this.getStrokeColor(Y)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return this.layer.triangulation=vy,[this.layer.buildLayerModel({moduleName:"simplepoint",vertexShader:JC,fragmentShader:QC,triangulation:vy,depth:{enable:!1},primitive:k.POINTS,blend:this.getBlend(),stencil:Pa(p,g)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,p,v,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0]]:[C]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:Tc.additive}}}]),r}(xo);function tA(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=rA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function rA(e,i){if(!!e){if(typeof e=="string")return gy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return gy(e,i)}}function gy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var nA=function(){function e(i,r,n){(0,dt.Z)(this,e),(0,A.Z)(this,"boxCells",[]),(0,A.Z)(this,"xCellCount",void 0),(0,A.Z)(this,"yCellCount",void 0),(0,A.Z)(this,"boxKeys",void 0),(0,A.Z)(this,"bboxes",void 0),(0,A.Z)(this,"width",void 0),(0,A.Z)(this,"height",void 0),(0,A.Z)(this,"xScale",void 0),(0,A.Z)(this,"yScale",void 0),(0,A.Z)(this,"boxUid",void 0);var a=this.boxCells;this.xCellCount=Math.ceil(i/n),this.yCellCount=Math.ceil(r/n);for(var s=0;s<this.xCellCount*this.yCellCount;s++)a.push([]);this.boxKeys=[],this.bboxes=[],this.width=i,this.height=r,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/r,this.boxUid=0}return(0,Mt.Z)(e,[{key:"insert",value:function(r,n,a,s,p){this.forEachCell(n,a,s,p,this.insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(s),this.bboxes.push(p)}},{key:"query",value:function(r,n,a,s,p){return this.queryHitTest(r,n,a,s,!1,p)}},{key:"hitTest",value:function(r,n,a,s,p){return this.queryHitTest(r,n,a,s,!0,p)}},{key:"insertBoxCell",value:function(r,n,a,s,p,v){this.boxCells[p].push(v)}},{key:"queryHitTest",value:function(r,n,a,s,p,v){if(a<0||r>this.width||s<0||n>this.height)return p?!1:[];var g=[];if(r<=0&&n<=0&&this.width<=a&&this.height<=s){if(p)return!0;for(var x=0;x<this.boxKeys.length;x++)g.push({key:this.boxKeys[x],x1:this.bboxes[x*4],y1:this.bboxes[x*4+1],x2:this.bboxes[x*4+2],y2:this.bboxes[x*4+3]});return v?g.filter(v):g}var C={hitTest:p,seenUids:{box:{},circle:{}}};return this.forEachCell(r,n,a,s,this.queryCell,g,C,v),p?g.length>0:g}},{key:"queryCell",value:function(r,n,a,s,p,v,g,x){var C=g.seenUids,T=this.boxCells[p];if(T!==null){var R=this.bboxes,F=tA(T),j;try{for(F.s();!(j=F.n()).done;){var Y=j.value;if(!C.box[Y]){C.box[Y]=!0;var J=Y*4;if(r<=R[J+2]&&n<=R[J+3]&&a>=R[J+0]&&s>=R[J+1]&&(!x||x(this.boxKeys[Y]))){if(g.hitTest)return v.push(!0),!0;v.push({key:this.boxKeys[Y],x1:R[J],y1:R[J+1],x2:R[J+2],y2:R[J+3]})}}}}catch(be){F.e(be)}finally{F.f()}}return!1}},{key:"forEachCell",value:function(r,n,a,s,p,v,g,x){for(var C=this.convertToXCellCoord(r),T=this.convertToYCellCoord(n),R=this.convertToXCellCoord(a),F=this.convertToYCellCoord(s),j=C;j<=R;j++)for(var Y=T;Y<=F;Y++){var J=this.xCellCount*Y+j;if(p.call(this,r,n,a,s,J,v,g,x))return}}},{key:"convertToXCellCoord",value:function(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}},{key:"convertToYCellCoord",value:function(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}}]),e}(),iA=nA,aA=function(){function e(i,r){(0,dt.Z)(this,e),(0,A.Z)(this,"width",void 0),(0,A.Z)(this,"height",void 0),(0,A.Z)(this,"grid",void 0),(0,A.Z)(this,"viewportPadding",100),(0,A.Z)(this,"screenRightBoundary",void 0),(0,A.Z)(this,"screenBottomBoundary",void 0),(0,A.Z)(this,"gridRightBoundary",void 0),(0,A.Z)(this,"gridBottomBoundary",void 0),this.width=i,this.height=r,this.viewportPadding=Math.max(i,r),this.grid=new iA(i+this.viewportPadding,r+this.viewportPadding,25),this.screenRightBoundary=i+this.viewportPadding,this.screenBottomBoundary=r+this.viewportPadding,this.gridRightBoundary=i+2*this.viewportPadding,this.gridBottomBoundary=r+2*this.viewportPadding}return(0,Mt.Z)(e,[{key:"placeCollisionBox",value:function(r){var n=r.x1+r.anchorPointX+this.viewportPadding,a=r.y1+r.anchorPointY+this.viewportPadding,s=r.x2+r.anchorPointX+this.viewportPadding,p=r.y2+r.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,a,s,p)||this.grid.hitTest(n,a,s,p)?{box:[]}:{box:[n,a,s,p]}}},{key:"insertCollisionBox",value:function(r,n){var a={featureIndex:n};this.grid.insert(a,r[0],r[1],r[2],r[3])}},{key:"project",value:function(r,n,a){var s=bt(n,a,0,1),p=we(),v=Us.apply(Ce,(0,Se.Z)(r));return ln(p,s,v),{x:(p[0]/p[3]+1)/2*this.width+this.viewportPadding,y:(-p[1]/p[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(r,n,a,s){return a>=0&&r<this.gridRightBoundary&&s>=0&&n<this.gridBottomBoundary}}]),e}();function yy(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=oA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function oA(e,i){if(!!e){if(typeof e=="string")return _y(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _y(e,i)}}function _y(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function xy(e){var i=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0;break;default:i=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0;break;default:r=.5}return{horizontalAlign:i,verticalAlign:r}}function by(e,i,r,n,a){if(!!a){var s=e[n],p=s.glyph;if(p)for(var v=i[p].advance*s.scale,g=(e[n].x+v)*a,x=r;x<=n;x++)e[x].x-=g}}function Ey(e,i,r,n,a,s,p){var v=(i-r)*a,g=(-n*p+.5)*s,x=yy(e),C;try{for(x.s();!(C=x.n()).done;){var T=C.value;T.x+=v,T.y+=g}}catch(R){x.e(R)}finally{x.f()}}function sA(e,i,r,n,a,s,p){var v=-8,g=0,x=v,C=0,T=e.positionedGlyphs,R=s==="right"?1:s==="left"?0:.5,F=T.length;r.forEach(function(Be){if(Be.split("").forEach(function(tt){var Et=i[tt],wt=0;Et&&(T.push({glyph:tt,x:g,y:x+wt,vertical:!1,scale:1,metrics:Et}),g+=Et.advance+p)}),T.length!==F){var Ye=g-p;C=Math.max(Ye,C),by(T,i,F,T.length-1,R)}g=0,x-=n+5});var j=xy(a),Y=j.horizontalAlign,J=j.verticalAlign;Ey(T,R,Y,J,C,n,r.length);var be=x-v;e.top+=-J*be,e.bottom=e.top-be,e.left+=-Y*C,e.right=e.left+C}function uA(e,i,r,n,a,s,p){var v=-8,g=0,x=v,C=0,T=e.positionedGlyphs,R=s==="right"?1:s==="left"?0:.5,F=T.length;r.forEach(function(Be){var Ye=i[Be],tt=0;if(Ye&&(T.push({glyph:Be,x:Ye.advance/2,y:x+tt,vertical:!1,scale:1,metrics:Ye}),g+=Ye.advance+p),T.length!==F){var Et=g-p;C=Math.max(Et,C),by(T,i,F,T.length-1,R)}g=0,x-=n+5});var j=xy(a),Y=j.horizontalAlign,J=j.verticalAlign;Ey(T,R,Y,J,C,n,r.length);var be=x-v;e.top+=-J*be,e.bottom=e.top-be,e.left+=-Y*C,e.right=e.left+C}function lA(e,i,r,n,a,s){var p=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],v=arguments.length>7?arguments[7]:void 0,g=e.split(`
`),x=[],C={positionedGlyphs:x,top:p[1],bottom:p[1],left:p[0],right:p[0],lineCount:g.length,text:e};return v?uA(C,i,g,r,n,a,s):sA(C,i,g,r,n,a,s),x.length?C:!1}function cA(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,n=e.positionedGlyphs,a=n===void 0?[]:n,s=[],p=yy(a),v;try{for(p.s();!(v=p.n()).done;){var g=v.value,x=g.metrics,C=4,T=x.advance*g.scale/2,R=r?[g.x+T,g.y]:[0,0],F=r?[0,0]:[g.x+T+i[0],g.y+i[1]],j=(0-C)*g.scale-T+F[0],Y=(0-C)*g.scale+F[1],J=j+x.width*g.scale,be=Y+x.height*g.scale,Be={x:j,y:Y},Ye={x:J,y:Y},tt={x:j,y:be},Et={x:J,y:be};s.push({tl:Be,tr:Ye,bl:tt,br:Et,tex:x,glyphOffset:R})}}catch(wt){p.e(wt)}finally{p.f()}return s}function fA(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=pA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function pA(e,i){if(!!e){if(typeof e=="string")return Sy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Sy(e,i)}}function Sy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function hA(e){var i=dA();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function dA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Cy=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Ay=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_raisingHeight: 0.0;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function wy(e){var i=this,r=e.id,n=[],a=[];if(!i.glyphInfoMap||!i.glyphInfoMap[r])return{vertices:[],indices:[],size:7};var s=i.glyphInfoMap[r].centroid,p=s.length===2?[s[0],s[1],0]:s;return i.glyphInfoMap[r].glyphQuads.forEach(function(v,g){n.push.apply(n,(0,Se.Z)(p).concat([v.tex.x,v.tex.y+v.tex.height,v.tl.x,v.tl.y],(0,Se.Z)(p),[v.tex.x+v.tex.width,v.tex.y+v.tex.height,v.tr.x,v.tr.y],(0,Se.Z)(p),[v.tex.x+v.tex.width,v.tex.y,v.br.x,v.br.y],(0,Se.Z)(p),[v.tex.x,v.tex.y,v.bl.x,v.bl.y])),a.push(0+g*4,1+g*4,2+g*4,2+g*4,3+g*4,0+g*4)}),{vertices:n,indices:a,size:7}}var Ty=function(e){(0,Pr.Z)(r,e);var i=hA(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"glyphInfo",void 0),(0,A.Z)((0,ue.Z)(n),"glyphInfoMap",{}),(0,A.Z)((0,ue.Z)(n),"texture",void 0),(0,A.Z)((0,ue.Z)(n),"currentZoom",-1),(0,A.Z)((0,ue.Z)(n),"extent",void 0),(0,A.Z)((0,ue.Z)(n),"textureHeight",0),(0,A.Z)((0,ue.Z)(n),"textCount",0),(0,A.Z)((0,ue.Z)(n),"preTextStyle",{}),(0,A.Z)((0,ue.Z)(n),"buildModels",function(){var v=n.layer.getLayerConfig(),g=v.mask,x=g===void 0?!1:g,C=v.maskInside,T=C===void 0?!0:C;return n.initGlyph(),n.updateTexture(),n.filterGlyphs(),n.reBuildModel(),[n.layer.buildLayerModel({moduleName:"pointText",vertexShader:Ay,fragmentShader:Cy,triangulation:wy.bind((0,ue.Z)(n)),depth:{enable:!1},blend:n.getBlend(),stencil:Pa(x,T)})]}),n}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.stroke,g=v===void 0?"#fff":v,x=a.strokeWidth,C=x===void 0?0:x,T=a.textAnchor,R=T===void 0?"center":T,F=a.textAllowOverlap,j=F===void 0?!1:F,Y=a.halo,J=Y===void 0?.5:Y,be=a.gamma,Be=be===void 0?2:be,Ye=a.raisingHeight,tt=Ye===void 0?0:Ye,Et=this.fontService,wt=Et.canvas,Yt=Et.mapping;if(Object.keys(Yt).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(Yt).length),this.preTextStyle={textAnchor:R,textAllowOverlap:j},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,strokeWidth:C,stroke:g})){this.judgeStyleAttributes({opacity:p,strokeWidth:C,stroke:g});var ar=this.layer.getEncodedData(),Mr=this.calDataFrame(this.cellLength,ar,this.cellProperties),Qr=Mr.data,br=Mr.width,vn=Mr.height;this.rowCount=vn,this.dataTexture=this.cellLength>0&&Qr.length>0?this.createTexture2D({flipY:!0,data:Qr,format:k.LUMINANCE,type:k.FLOAT,width:br,height:vn}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(tt),u_opacity:ha()(p)?p:1,u_stroke_width:ha()(C)?C:0,u_stroke_color:this.getStrokeColor(g),u_sdf_map:this.texture,u_halo_blur:J,u_gamma_scale:Be,u_sdf_map_size:[wt.width,wt.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var a=this.layer.getLayerConfig(),s=a.textAnchor,p=s===void 0?"center":s,v=a.textAllowOverlap,g=v===void 0?!0:v;return this.preTextStyle={textAnchor:p,textAllowOverlap:g},this.buildModels()}},{key:"needUpdate",value:function(){var a=this.layer.getLayerConfig(),s=a.textAllowOverlap,p=s===void 0?!1:s,v=this.mapService.getZoom(),g=this.mapService.getBounds(),x=Cn(this.extent,g);return!p&&(Math.abs(this.currentZoom-v)>1||!x)||p!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:On.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,p,v,g){var x=s.rotate,C=x===void 0?0:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:On.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(s,p,v,g){return[v[5],v[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,p,v,g){var x=s.size,C=x===void 0?12:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:On.Attribute,descriptor:{name:"a_tex",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(s,p,v,g){return[v[3],v[4]]}}})}},{key:"textExtent",value:function(){var a=this.mapService.getBounds();return Rn(a,.5)}},{key:"initTextFont",value:function(){var a=this.layer.getLayerConfig(),s=a.fontWeight,p=s===void 0?"400":s,v=a.fontFamily,g=v===void 0?"sans-serif":v,x=this.layer.getEncodedData(),C=[];x.forEach(function(T){var R=T.shape,F=R===void 0?"":R;F=F.toString();var j=fA(F),Y;try{for(j.s();!(Y=j.n()).done;){var J=Y.value;C.indexOf(J)===-1&&C.push(J)}}catch(be){j.e(be)}finally{j.f()}}),this.fontService.setFontOptions({characterSet:C,fontWeight:p,fontFamily:g,iconfont:!1})}},{key:"initIconFontTex",value:function(){var a=this.layer.getLayerConfig(),s=a.fontWeight,p=s===void 0?"400":s,v=a.fontFamily,g=v===void 0?"sans-serif":v,x=this.layer.getEncodedData(),C=[];x.forEach(function(T){var R=T.shape,F=R===void 0?"":R;F="".concat(F),C.indexOf(F)===-1&&C.push(F)}),this.fontService.setFontOptions({characterSet:C,fontWeight:p,fontFamily:g,iconfont:!0})}},{key:"generateGlyphLayout",value:function(a){var s=this,p=this.fontService.mapping,v=this.layer.getLayerConfig(),g=v.spacing,x=g===void 0?2:g,C=v.textAnchor,T=C===void 0?"center":C,R=this.layer.getEncodedData();this.glyphInfo=R.map(function(F){var j=F.shape,Y=j===void 0?"":j,J=F.id,be=F.size,Be=be===void 0?1:be,Ye=F.textOffset,tt=Ye===void 0?[0,0]:Ye,Et=lA(Y.toString(),p,Be,T,"left",x,tt,a),wt=cA(Et,tt,!1);return F.shaping=Et,F.glyphQuads=wt,F.centroid=Dh(F.coordinates),F.originCentroid=F.version==="GAODE2.x"?Dh(F.originCoordinates):F.originCentroid=F.centroid,s.glyphInfoMap[J]={shaping:Et,glyphQuads:wt,centroid:Dh(F.coordinates)},F})}},{key:"filterGlyphs",value:function(){var a=this,s=this.layer.getLayerConfig(),p=s.padding,v=p===void 0?[4,4]:p,g=s.textAllowOverlap,x=g===void 0?!1:g;if(!x){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var C=this.rendererService.getViewportSize(),T=C.width,R=C.height,F=new aA(T,R),j=this.glyphInfo.filter(function(Y){var J=Y.shaping,be=Y.id,Be=be===void 0?0:be,Ye=Y.version==="GAODE2.x"?Y.originCentroid:Y.centroid,tt=Y.size,Et=tt/24,wt=a.mapService.lngLatToContainer(Ye),Yt=F.placeCollisionBox({x1:J.left*Et-v[0],x2:J.right*Et+v[0],y1:J.top*Et-v[1],y2:J.bottom*Et+v[1],anchorPointX:wt.x,anchorPointY:wt.y}),ar=Yt.box;return ar&&ar.length?(F.insertCollisionBox(ar,Be),!0):!1});j.forEach(function(Y){a.glyphInfoMap[Y.id]=Y})}}},{key:"initGlyph",value:function(){var a=this.layer.getLayerConfig(),s=a.iconfont,p=s===void 0?!1:s;p?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(p)}},{key:"updateTexture",value:function(){var a=this.rendererService.createTexture2D,s=this.fontService.canvas;this.textureHeight=s.height,this.texture&&this.texture.destroy(),this.texture=a({data:s,mag:k.LINEAR,min:k.LINEAR,width:s.width,height:s.height})}},{key:"reBuildModel",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:Ay,fragmentShader:Cy,triangulation:wy.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:Pa(p,g)})]}}]),r}(xo),vA={fillImage:OC,fill:fy,radar:qC,image:py,normal:dy,simplePoint:eA,extrude:ly,text:Ty,icon:FC},mA=vA;function gA(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=yA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function yA(e,i){if(!!e){if(typeof e=="string")return My(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return My(e,i)}}function My(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function _A(e){var i=xA();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function xA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bA=function(e){(0,Pr.Z)(r,e);var i=_A(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"type","PointLayer"),n}return(0,Mt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new mA[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var a=this.shapeOption,s=a.field,p=a.values,v=this.getLayerConfig(),g=v.shape2d,x=v.shape3d,C=this.iconService.getIconMap();if(s&&(g==null?void 0:g.indexOf(s))!==-1)return"fill";if(p&&p instanceof Array){var T=gA(p),R;try{for(T.s();!(R=T.n()).done;){var F=R.value;if(typeof F=="string"&&C.hasOwnProperty(F))return"image"}}catch(j){T.e(j)}finally{T.f()}}}return"normal"}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}};return s[a]}},{key:"getModelType",value:function(){var a=["fillImage","fill","radar","image","normal","simplePoint","extrude","text","icon"];if(this.layerType&&a.includes(this.layerType))return this.layerType;var s=this.getEncodedData(),p=this.getLayerConfig(),v=p.shape2d,g=p.shape3d,x=this.iconService.getIconMap(),C=s.find(function(R){return R.hasOwnProperty("shape")});if(C){var T=C.shape;return T==="dot"?"normal":T==="simple"?"simplePoint":T==="radar"?"radar":T==="fillImage"?"fillImage":(v==null?void 0:v.indexOf(T))!==-1?"fill":(g==null?void 0:g.indexOf(T))!==-1?"extrude":x.hasOwnProperty(T)?"image":this.fontService.getGlyph(T)!==""?"icon":"text"}else return this.getModelTypeWillEmptyData()}}]),r}(nh);function EA(e){var i=SA();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function SA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var CA=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];  
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }

  } else {
     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,AA=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  if(styleMappingMat[0][3] < 1.0 ) {
    // side
    styleMappingMat[0][0] = 0.0;
  } else {

  }

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,wA=`uniform sampler2D u_texture;
uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float lightWeight = styleMappingMat[3][1];
  float topU = styleMappingMat[2][2];
  float topV = styleMappingMat[2][3];

  float sidey = styleMappingMat[3][0];
  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }
  } else {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = texture2D(u_texture, vec2(topU, topV));
  }
  

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,TA=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  v_Color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - a_Position.z(judge side by a_Position.z)
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - u - v
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[2][2] = a_uvs[0];
  styleMappingMat[2][3] = 1.0 - a_uvs[1];
  styleMappingMat[3][0] = a_uvs[2];


  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,MA=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      // side notuse linear
       gl_FragColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
}
`,PA=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,IA=function(e){(0,Pr.Z)(r,e);var i=EA(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"texture",void 0),n}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.heightfixed,g=v===void 0?!1:v,x=a.raisingHeight,C=x===void 0?0:x,T=a.topsurface,R=T===void 0?!0:T,F=a.sidesurface,j=F===void 0?!0:F,Y=a.sourceColor,J=a.targetColor;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var be=this.layer.getEncodedData(),Be=this.calDataFrame(this.cellLength,be,this.cellProperties),Ye=Be.data,tt=Be.width,Et=Be.height;this.rowCount=Et,this.dataTexture=this.cellLength>0&&Ye.length>0?this.createTexture2D({flipY:!0,data:Ye,format:k.LUMINANCE,type:k.FLOAT,width:tt,height:Et}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}var wt=0,Yt=[1,1,1,1],ar=[1,1,1,1];return Y&&J&&(Yt=_i(Y),ar=_i(J),wt=1),{u_topsurface:Number(R),u_sidesurface:Number(j),u_heightfixed:Number(g),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(C),u_opacity:ha()(p)?p:1,u_linearColor:wt,u_sourceColor:Yt,u_targetColor:ar,u_texture:this.texture}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.getShaders(),C=x.frag,T=x.vert,R=x.type;return[this.layer.buildLayerModel({moduleName:R,vertexShader:T,fragmentShader:C,triangulation:jg,stencil:Pa(p,g),cull:{enable:!0,face:k.BACK}})]}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.pickLight,p=a.mapTexture;return p?{frag:wA,vert:TA,type:"polygonExtrudeTexture"}:s?{frag:MA,vert:PA,type:"polygonExtrude"}:{frag:CA,vert:AA,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var a,s;(a=this.dataTexture)===null||a===void 0||a.destroy(),(s=this.texture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getSource().extent,s=(0,gn.Z)(a,4),p=s[0],v=s[1],g=s[2],x=s[3],C=g-p,T=x-v;this.styleAttributeService.registerStyleAttribute({name:"uvs",type:On.Attribute,descriptor:{name:"a_uvs",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(F,j,Y,J,be){var Be=Y[0],Ye=Y[1];return[(Be-p)/C,(Ye-v)/T,Y[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:On.Attribute,descriptor:{name:"a_Normal",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(F,j,Y,J,be){return be}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(F,j,Y,J){var be=F.size,Be=be===void 0?10:be;return Array.isArray(Be)?[Be[0]]:[Be]}}})}},{key:"loadTexture",value:function(){var a=this,s=this.layer.getLayerConfig(),p=s.mapTexture,v=this.rendererService.createTexture2D;if(this.texture=v({height:0,width:0}),p){var g=new Image;g.crossOrigin="",g.src=p,g.onload=function(){a.texture=v({data:g,width:g.width,height:g.height,wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE,min:k.LINEAR,mag:k.LINEAR}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}}}]),r}(xo);function OA(e){var i=RA();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function RA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kA=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,LA=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;


void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,DA=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}`,FA=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,BA=function(e){(0,Pr.Z)(r,e);var i=OA(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.raisingHeight,p=s===void 0?0:s,v=a.opacity,g=v===void 0?1:v,x=a.opacityLinear,C=x===void 0?{enable:!1,dir:"in"}:x;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:g})){this.judgeStyleAttributes({opacity:g});var T=this.layer.getEncodedData(),R=this.calDataFrame(this.cellLength,T,this.cellProperties),F=R.data,j=R.width,Y=R.height;this.rowCount=Y,this.dataTexture=this.cellLength>0&&F.length>0?this.createTexture2D({flipY:!0,data:F,format:k.LUMINANCE,type:k.FLOAT,width:j,height:Y}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(p),u_opacity:ha()(g)?g:1,u_opacitylinear:Number(C.enable),u_dir:C.dir==="in"?1:0}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.opacityLinear,p=s===void 0?{enable:!1,dir:"in"}:s,v=a.mask,g=v===void 0?!1:v,x=a.maskInside,C=x===void 0?!0:x;return this.layer.triangulation=p.enable?Zg:e0,[this.layer.buildLayerModel({moduleName:"polygon",vertexShader:p.enable?DA:FA,fragmentShader:p.enable?LA:kA,triangulation:p.enable?Zg:e0,blend:this.getBlend(),depth:{enable:!1},cull:{enable:!0,face:k.BACK},stencil:Pa(g,C)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getLayerConfig(),s=a.opacityLinear,p=s===void 0?{enable:!1,dir:"in"}:s;p.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:On.Attribute,descriptor:{name:"a_linear",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(g,x,C,T,R){return[C[3],C[4],C[5]]}}})}}]),r}(xo);function NA(e){var i=zA();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function zA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var UA=`
uniform float u_time;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;
// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)
// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)
uniform vec4 u_watercolor;
uniform vec4 u_watercolor2;
vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture2D(u_texture2,p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture2D(u_texture1,fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    

  float opacity = styleMappingMat[0][0];
  gl_FragColor = vec4(col, opacity);

  // gl_FragColor = v_Color;
  
}
`,ZA=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,jA=function(e){(0,Pr.Z)(r,e);var i=NA(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"texture1",void 0),(0,A.Z)((0,ue.Z)(n),"texture2",void 0),(0,A.Z)((0,ue.Z)(n),"texture3",void 0),n}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.watercolor,g=v===void 0?"#6D99A8":v,x=a.watercolor2,C=x===void 0?"#0F121C":x;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var T=this.layer.getEncodedData(),R=this.calDataFrame(this.cellLength,T,this.cellProperties),F=R.data,j=R.width,Y=R.height;this.rowCount=Y,this.dataTexture=this.cellLength>0&&F.length>0?this.createTexture2D({flipY:!0,data:F,format:k.LUMINANCE,type:k.FLOAT,width:j,height:Y}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:_i(g),u_watercolor2:_i(C),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ha()(p)?p:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"polygon_ocean",vertexShader:ZA,fragmentShader:UA,triangulation:e0,depth:{enable:!1},stencil:Pa(p,g)})]}},{key:"clearModels",value:function(){var a,s,p,v;(a=this.texture1)===null||a===void 0||a.destroy(),(s=this.texture2)===null||s===void 0||s.destroy(),(p=this.texture3)===null||p===void 0||p.destroy(),(v=this.dataTexture)===null||v===void 0||v.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getSource().extent,s=(0,gn.Z)(a,4),p=s[0],v=s[1],g=s[2],x=s[3],C=g-p,T=x-v;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:On.Attribute,descriptor:{name:"a_uv",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(F,j,Y,J,be){var Be=(0,gn.Z)(Y,2),Ye=Be[0],tt=Be[1];return[(Ye-p)/C,(tt-v)/T]}}})}},{key:"loadTexture",value:function(){var a=this,s=this.rendererService.createTexture2D,p={height:0,width:0};this.texture1=s(p),this.texture2=s(p),this.texture3=s(p),v(function(x){a.texture1=g(x[0]),a.texture2=g(x[1]),a.texture3=g(x[2]),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()});function v(x){var C=0,T=[],R=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];R.map(function(F){var j=new Image;j.crossOrigin="",j.src=F,T.push(j),j.onload=function(){C++,C===3&&x(T)}})}function g(x){return s({data:x,width:x.width,height:x.height,wrapS:k.MIRRORED_REPEAT,wrapT:k.MIRRORED_REPEAT,min:k.LINEAR,mag:k.LINEAR})}}}]),r}(xo);function VA(e){var i=GA();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function GA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var HA=`
uniform sampler2D u_texture;
uniform float u_time;
uniform float u_speed: 1.0;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

  float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

  float water(vec3 p) {
    float t = u_time * u_speed;
    p.z += t * 2.; p.x += t * 2.;
    vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;
    p.z += t * 3.; p.x += t * 0.52;
    vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;
    p.z += t * 4.; p.x += t * 0.8;
    vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;
    c1 += c2 - c3;
    float z = (c1.x + c1.y + c1.z) / 3.;
    return p.y + z / 4.;
  }

  float map(vec3 p) {
    float d = 100.0;
    d = water(p);
    return d;
  }

  float intersect(vec3 ro, vec3 rd) {
    float d = 0.0;
    for (int i = 0; i <= 100; i++) {
      float h = map(ro + rd * d);
      if (h < 0.1) return  d;
      d += h;
    }
    return 0.0;
  }
  
  vec3 norm(vec3 p) {
    float eps = .1;
    return normalize(vec3(
      map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
      map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
      map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
    ));
  } 

  float calSpc() {
    vec3 l1 = normalize(vec3(1, 1, 1));
    vec3 ro = vec3(-3, 20, -8);
    vec3 rc = vec3(0, 0, 0);
    vec3 ww = normalize(rc - ro);
    vec3 uu = normalize(cross(vec3(0,1,0), ww));
    vec3 vv = normalize(cross(rc - ro, uu));
    vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
    float d = intersect(ro, rd);
    vec3 p = ro + rd * d;
    vec3 n = norm(p);
    float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
    return spc;
  }

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;

  float spc = calSpc();
  gl_FragColor += spc * 0.4;
}
`,WA=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,XA=function(e){(0,Pr.Z)(r,e);var i=VA(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"texture",void 0),n}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.speed,g=v===void 0?.5:v;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var x=this.layer.getEncodedData(),C=this.calDataFrame(this.cellLength,x,this.cellProperties),T=C.data,R=C.width,F=C.height;this.rowCount=F,this.dataTexture=this.cellLength>0&&T.length>0?this.createTexture2D({flipY:!0,data:T,format:k.LUMINANCE,type:k.FLOAT,width:R,height:F}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_texture:this.texture,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_speed:g,u_opacity:ha()(p)?p:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"polygon_water",vertexShader:WA,fragmentShader:HA,triangulation:e0,depth:{enable:!1},stencil:Pa(p,g)})]}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getSource().extent,s=(0,gn.Z)(a,4),p=s[0],v=s[1],g=s[2],x=s[3],C=g-p,T=x-v;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:On.Attribute,descriptor:{name:"a_uv",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(F,j,Y,J,be){var Be=(0,gn.Z)(Y,2),Ye=Be[0],tt=Be[1];return[(Ye-p)/C,(tt-v)/T]}}})}},{key:"loadTexture",value:function(){var a=this,s=this.layer.getLayerConfig(),p=s.waterTexture,v=this.rendererService.createTexture2D;this.texture=v({height:0,width:0});var g=new Image;g.crossOrigin="",p?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),g.src=p):g.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",g.onload=function(){a.texture=v({data:g,width:g.width,height:g.height,wrapS:k.MIRRORED_REPEAT,wrapT:k.MIRRORED_REPEAT,min:k.LINEAR,mag:k.LINEAR}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}}]),r}(xo),YA={fill:BA,line:sy,extrude:IA,text:Ty,point_fill:fy,point_image:py,point_normal:dy,point_extrude:ly,water:XA,ocean:jA},qA=YA;function KA(e){var i=$A();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function $A(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Py=function(e){(0,Pr.Z)(r,e);var i=KA(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"type","PolygonLayer"),n}return(0,Mt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new qA[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),p=s==null||(a=s.scale)===null||a===void 0?void 0:a.field;return p==="fill"?"fill":p==="extrude"?"extrude":p==="water"?"water":p==="ocean"?"ocean":p==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var a=this.getEncodedData(),s=this.getLayerConfig(),p=s.shape2d,v=s.shape3d,g=this.iconService.getIconMap(),x=a.find(function(T){return T.hasOwnProperty("shape")});if(x){var C=x.shape;return C==="dot"?"point_normal":(p==null?void 0:p.indexOf(C))!==-1?"point_fill":(v==null?void 0:v.indexOf(C))!==-1?"point_extrude":g.hasOwnProperty(C)?"point_image":"text"}else return"fill"}}]),r}(nh);function QA(e){var i=JA();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function JA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ew=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,tw=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,Iy=function(e){(0,Pr.Z)(r,e);var i=QA(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"texture",void 0),(0,A.Z)((0,ue.Z)(n),"colorTexture",void 0),n}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.clampLow,g=v===void 0?!0:v,x=a.clampHigh,C=x===void 0?!0:x,T=a.noDataValue,R=T===void 0?-9999999:T,F=a.domain,j=F===void 0?[0,1]:F;return this.updateColorTexure(),{u_opacity:p||1,u_texture:this.texture,u_domain:j,u_clampLow:g,u_clampHigh:typeof C!="undefined"?C:g,u_noDataValue:R,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.layer.getSource(),C=this.rendererService.createTexture2D,T=x.data.dataArray[0];this.texture=C({data:T.data,width:T.width,height:T.height,format:k.LUMINANCE,type:k.FLOAT});var R=this.layer.getLayerConfig(),F=R.rampColors,j=hl(F);return this.colorTexture=C({data:j.data,width:j.width,height:j.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:tw,fragmentShader:ew,triangulation:Gg,primitive:k.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:Pa(p,g)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_Uv",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(s,p,v,g){return[v[3],v[4]]}}})}},{key:"updateColorTexure",value:function(){var a=this.rendererService.createTexture2D,s=this.layer.getLayerConfig(),p=s.rampColors,v=hl(p);this.colorTexture=a({data:v.data,width:v.width,height:v.height,flipY:!1})}}]),r}(xo),rw={raster:Iy,raster3d:Iy},nw=rw;function iw(e){var i=aw();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function aw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ow=function(e){(0,Pr.Z)(r,e);var i=iw(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"type","RasterLayer"),n}return(0,Mt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new nw[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={raster:{},raster3d:{}};return s[a]}},{key:"getModelType",value:function(){return"raster"}}]),r}(nh),Oy,Ry,ky,Ly,Dy,i0,Fy,By,Ny;function zy(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function sw(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?zy(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):zy(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var uw=(Oy=(0,Xr.b2)(),Ry=(0,Xr.f3)(Gt.IGlobalConfigService),ky=(0,Xr.f3)(Gt.IMapService),Ly=(0,Xr.f3)(Gt.IFontService),Oy(Dy=(i0=function(){function e(){(0,dt.Z)(this,e),Bn(this,"configService",Fy,this),Bn(this,"mapService",By,this),Bn(this,"fontService",Ny,this)}return(0,Mt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("DataMappingPlugin",function(){a.generateMaping(r,{styleAttributeService:s})}),r.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return r.dataState.dataMappingNeedUpdate=!1,a.generateMaping(r,{styleAttributeService:s}),!0}),r.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!r.layerModelNeedUpdate){var p=r.getBottomColor(),v=s.getLayerStyleAttributes()||[],g=s.getLayerStyleAttribute("filter"),x=r.getSource().data.dataArray,C=v.filter(function(R){return R.needRemapping}),T=x;g!=null&&g.needRemapping&&g!==null&&g!==void 0&&g.scale&&(T=x.filter(function(R){return a.applyAttributeMapping(g,R,p)[0]})),C.length&&(g!=null&&g.needRemapping?(r.setEncodedData(a.mapping(v,T,void 0,p,r)),g.needRemapping=!1):r.setEncodedData(a.mapping(C,T,r.getEncodedData(),p,r)),r.emit("remapping",null))}})}},{key:"generateMaping",value:function(r,n){var a=this,s=n.styleAttributeService,p=r.getBottomColor(),v=s.getLayerStyleAttributes()||[],g=s.getLayerStyleAttribute("filter"),x=r.getSource().data.dataArray,C=x;g!=null&&g.scale&&(C=x.filter(function(T){return a.applyAttributeMapping(g,T,p)[0]})),r.setEncodedData(this.mapping(v,C,void 0,p,r)),r.emit("dataUpdate",null)}},{key:"getArrowPoints",value:function(r,n){var a=[n[0]-r[0],n[1]-r[1]],s=$o(a),p=[r[0]+s[0]*1e-4,r[1]+s[1]*1e-4];return p}},{key:"mapping",value:function(r,n,a,s,p){var v=this,g=p==null?void 0:p.getLayerConfig(),x=g.arrow,C=x===void 0?{enable:!1}:x,T=n.map(function(R,F){var j=a?a[F]:{},Y=sw({id:R._id,coordinates:R.coordinates},j);if(r.filter(function(Be){return Be.scale!==void 0}).forEach(function(Be){var Ye=v.applyAttributeMapping(Be,R,s);Be.needRemapping=!1,Be.name==="color"&&(Ye=Ye.map(function(tt){return _i(tt)})),Y[Be.name]=Array.isArray(Ye)&&Ye.length===1?Ye[0]:Ye,Be.name==="shape"&&(Y.shape=v.fontService.getIconFontKey(Y[Be.name]))}),Y.shape==="line"&&C.enable){var J=Y.coordinates,be=v.getArrowPoints(J[0],J[1]);Y.coordinates.splice(1,0,be,be)}return Y});return this.adjustData2Amap2Coordinates(T),this.adjustData2SimpleCoordinates(T),T}},{key:"adjustData2Amap2Coordinates",value:function(r){var n=this;r.length>0&&this.mapService.version===Rs["GAODE2.x"]&&(typeof r[0].coordinates[0]=="number"?r.filter(function(a){return!a.originCoordinates}).map(function(a){a.version=Rs["GAODE2.x"],a.originCoordinates=H()(a.coordinates),a.coordinates=n.mapService.lngLatToCoord(a.coordinates)}):r.filter(function(a){return!a.originCoordinates}).map(function(a){a.version=Rs["GAODE2.x"],a.originCoordinates=H()(a.coordinates),a.coordinates=n.mapService.lngLatToCoords(a.coordinates)}))}},{key:"adjustData2SimpleCoordinates",value:function(r){var n=this;r.length>0&&this.mapService.version===Rs.SIMPLE&&r.map(function(a){a.simpleCoordinate||(a.coordinates=n.unProjectCoordinates(a.coordinates),a.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(r){var n=this;if(typeof r[0]=="number")return this.mapService.simpleMapCoord.unproject(r);if(r[0]&&r[0][0]instanceof Array){var a=[];return r.map(function(p){var v=[];p.map(function(g){v.push(n.mapService.simpleMapCoord.unproject(g))}),a.push(v)}),a}else{var s=[];return r.map(function(p){s.push(n.mapService.simpleMapCoord.unproject(p))}),s}}},{key:"applyAttributeMapping",value:function(r,n,a){var s;if(!r.scale)return[];var p=(r==null||(s=r.scale)===null||s===void 0?void 0:s.scalers)||[],v=[];p.forEach(function(x){var C,T=x.field;(n.hasOwnProperty(T)||((C=r.scale)===null||C===void 0?void 0:C.type)==="variable")&&v.push(n[T])});var g=r.mapping?r.mapping(v):[];return r.name==="color"&&!vu(g[0])?[a]:g}}]),e}(),Fy=ai(i0.prototype,"configService",[Ry],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),By=ai(i0.prototype,"mapService",[ky],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ny=ai(i0.prototype,"fontService",[Ly],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),i0))||Dy),Uy,Zy,lw=(Uy=(0,Xr.b2)(),Uy(Zy=function(){function e(){(0,dt.Z)(this,e),(0,A.Z)(this,"mapService",void 0)}return(0,Mt.Z)(e,[{key:"apply",value:function(r){var n=this;this.mapService=r.getContainer().get(Gt.IMapService),r.hooks.init.tap("DataSourcePlugin",function(){var a=r.getSource();if(!a){var s=r.sourceOption||{data:Yh,options:ch},p=s.data,v=s.options;r.setSource(new fh(p,v))}n.updateClusterData(r)}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var a=n.updateClusterData(r),s=r.dataState.dataSourceNeedUpdate;return r.dataState.dataSourceNeedUpdate=!1,a||s})}},{key:"updateClusterData",value:function(r){var n=r.getSource(),a=n.cluster,s=n.clusterOptions,p=s.zoom,v=p===void 0?0:p,g=s.maxZoom,x=g===void 0?16:g,C=this.mapService.getZoom()-1,T=r.dataState.dataSourceNeedUpdate;return a&&(T||Math.abs(r.clusterZoom-C)>=1)?(v!==Math.floor(C)&&n.updateClusterData(Math.floor(C)),r.clusterZoom=C,!0):!1}}]),e}())||Zy);function Bv(e,i){return e<i?-1:e>i?1:e>=i?0:NaN}function jy(e){return e.length===1&&(e=cw(e)),{left:function(i,r,n,a){for(n==null&&(n=0),a==null&&(a=i.length);n<a;){var s=n+a>>>1;e(i[s],r)<0?n=s+1:a=s}return n},right:function(i,r,n,a){for(n==null&&(n=0),a==null&&(a=i.length);n<a;){var s=n+a>>>1;e(i[s],r)>0?a=s:n=s+1}return n}}}function cw(e){return function(i,r){return Bv(e(i),r)}}var Vy=jy(Bv),fw=Vy.right,aP=Vy.left,G0=fw;function pw(e,i){var r=e.length,n=-1,a,s,p;if(i==null){for(;++n<r;)if((a=e[n])!=null&&a>=a)for(s=p=a;++n<r;)(a=e[n])!=null&&(s>a&&(s=a),p<a&&(p=a))}else for(;++n<r;)if((a=i(e[n],n,e))!=null&&a>=a)for(s=p=a;++n<r;)(a=i(e[n],n,e))!=null&&(s>a&&(s=a),p<a&&(p=a));return[s,p]}var Gy=Array.prototype,oP=Gy.slice,sP=Gy.map,Nv=Math.sqrt(50),zv=Math.sqrt(10),Uv=Math.sqrt(2);function Hy(e,i,r){var n,a=-1,s,p,v;if(i=+i,e=+e,r=+r,e===i&&r>0)return[e];if((n=i<e)&&(s=e,e=i,i=s),(v=H0(e,i,r))===0||!isFinite(v))return[];if(v>0)for(e=Math.ceil(e/v),i=Math.floor(i/v),p=new Array(s=Math.ceil(i-e+1));++a<s;)p[a]=(e+a)*v;else for(e=Math.floor(e*v),i=Math.ceil(i*v),p=new Array(s=Math.ceil(e-i+1));++a<s;)p[a]=(e-a)/v;return n&&p.reverse(),p}function H0(e,i,r){var n=(i-e)/Math.max(0,r),a=Math.floor(Math.log(n)/Math.LN10),s=n/Math.pow(10,a);return a>=0?(s>=Nv?10:s>=zv?5:s>=Uv?2:1)*Math.pow(10,a):-Math.pow(10,-a)/(s>=Nv?10:s>=zv?5:s>=Uv?2:1)}function Zv(e,i,r){var n=Math.abs(i-e)/Math.max(0,r),a=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),s=n/a;return s>=Nv?a*=10:s>=zv?a*=5:s>=Uv&&(a*=2),i<e?-a:a}function uP(){var e=identity,i=extent,r=sturges;function n(a){var s,p=a.length,v,g=new Array(p);for(s=0;s<p;++s)g[s]=e(a[s],s,a);var x=i(g),C=x[0],T=x[1],R=r(g,C,T);Array.isArray(R)||(R=tickStep(C,T,R),R=range(Math.ceil(C/R)*R,T,R));for(var F=R.length;R[0]<=C;)R.shift(),--F;for(;R[F-1]>T;)R.pop(),--F;var j=new Array(F+1),Y;for(s=0;s<=F;++s)Y=j[s]=[],Y.x0=s>0?R[s-1]:C,Y.x1=s<F?R[s]:T;for(s=0;s<p;++s)v=g[s],C<=v&&v<=T&&j[bisect(R,v,0,F)].push(a[s]);return j}return n.value=function(a){return arguments.length?(e=typeof a=="function"?a:constant(a),n):e},n.domain=function(a){return arguments.length?(i=typeof a=="function"?a:constant([a[0],a[1]]),n):i},n.thresholds=function(a){return arguments.length?(r=typeof a=="function"?a:Array.isArray(a)?constant(slice.call(a)):constant(a),n):r},n}function lP(e,i,r){return e=map.call(e,number).sort(ascending),Math.ceil((r-i)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function hw(e){return e===null?NaN:+e}function dw(e,i,r){if(r==null&&(r=hw),!!(n=e.length)){if((i=+i)<=0||n<2)return+r(e[0],0,e);if(i>=1)return+r(e[n-1],n-1,e);var n,a=(n-1)*i,s=Math.floor(a),p=+r(e[s],s,e),v=+r(e[s+1],s+1,e);return p+(v-p)*(a-s)}}var Oc="$";function W0(){}W0.prototype=Wy.prototype={constructor:W0,has:function(e){return Oc+e in this},get:function(e){return this[Oc+e]},set:function(e,i){return this[Oc+e]=i,this},remove:function(e){var i=Oc+e;return i in this&&delete this[i]},clear:function(){for(var e in this)e[0]===Oc&&delete this[e]},keys:function(){var e=[];for(var i in this)i[0]===Oc&&e.push(i.slice(1));return e},values:function(){var e=[];for(var i in this)i[0]===Oc&&e.push(this[i]);return e},entries:function(){var e=[];for(var i in this)i[0]===Oc&&e.push({key:i.slice(1),value:this[i]});return e},size:function(){var e=0;for(var i in this)i[0]===Oc&&++e;return e},empty:function(){for(var e in this)if(e[0]===Oc)return!1;return!0},each:function(e){for(var i in this)i[0]===Oc&&e(this[i],i.slice(1),this)}};function Wy(e,i){var r=new W0;if(e instanceof W0)e.each(function(v,g){r.set(g,v)});else if(Array.isArray(e)){var n=-1,a=e.length,s;if(i==null)for(;++n<a;)r.set(n,e[n]);else for(;++n<a;)r.set(i(s=e[n],n,e),s)}else if(e)for(var p in e)r.set(p,e[p]);return r}var jv=Wy;function cP(){var e=[],i=[],r,n,a;function s(v,g,x,C){if(g>=e.length)return r!=null&&v.sort(r),n!=null?n(v):v;for(var T=-1,R=v.length,F=e[g++],j,Y,J=map(),be,Be=x();++T<R;)(be=J.get(j=F(Y=v[T])+""))?be.push(Y):J.set(j,[Y]);return J.each(function(Ye,tt){C(Be,tt,s(Ye,g,x,C))}),Be}function p(v,g){if(++g>e.length)return v;var x,C=i[g-1];return n!=null&&g>=e.length?x=v.entries():(x=[],v.each(function(T,R){x.push({key:R,values:p(T,g)})})),C!=null?x.sort(function(T,R){return C(T.key,R.key)}):x}return a={object:function(v){return s(v,0,vw,mw)},map:function(v){return s(v,0,Xy,Yy)},entries:function(v){return p(s(v,0,Xy,Yy),0)},key:function(v){return e.push(v),a},sortKeys:function(v){return i[e.length-1]=v,a},sortValues:function(v){return r=v,a},rollup:function(v){return n=v,a}}}function vw(){return{}}function mw(e,i,r){e[i]=r}function Xy(){return map()}function Yy(e,i,r){e.set(i,r)}function X0(){}var Uh=jv.prototype;X0.prototype=gw.prototype={constructor:X0,has:Uh.has,add:function(e){return e+="",this[Oc+e]=e,this},remove:Uh.remove,clear:Uh.clear,values:Uh.keys,size:Uh.size,empty:Uh.empty,each:Uh.each};function gw(e,i){var r=new X0;if(e instanceof X0)e.each(function(s){r.add(s)});else if(e){var n=-1,a=e.length;if(i==null)for(;++n<a;)r.add(e[n]);else for(;++n<a;)r.add(i(e[n],n,e))}return r}var fP=null,qy=Array.prototype,Y0=qy.map,Zh=qy.slice;function sh(e,i){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(i).domain(e);break}return this}function pP(e,i){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(i).domain(e);break}return this}var Ky={name:"implicit"};function q0(){var e=jv(),i=[],r=[],n=Ky;function a(s){var p=s+"",v=e.get(p);if(!v){if(n!==Ky)return n;e.set(p,v=i.push(s))}return r[(v-1)%r.length]}return a.domain=function(s){if(!arguments.length)return i.slice();i=[],e=jv();for(var p=-1,v=s.length,g,x;++p<v;)e.has(x=(g=s[p])+"")||e.set(x,i.push(g));return a},a.range=function(s){return arguments.length?(r=Zh.call(s),a):r.slice()},a.unknown=function(s){return arguments.length?(n=s,a):n},a.copy=function(){return q0(i,r).unknown(n)},sh.apply(a,arguments),a}function $y(){var e=ordinal().unknown(void 0),i=e.domain,r=e.range,n=[0,1],a,s,p=!1,v=0,g=0,x=.5;delete e.unknown;function C(){var T=i().length,R=n[1]<n[0],F=n[R-0],j=n[1-R];a=(j-F)/Math.max(1,T-v+g*2),p&&(a=Math.floor(a)),F+=(j-F-a*(T-v))*x,s=a*(1-v),p&&(F=Math.round(F),s=Math.round(s));var Y=sequence(T).map(function(J){return F+a*J});return r(R?Y.reverse():Y)}return e.domain=function(T){return arguments.length?(i(T),C()):i()},e.range=function(T){return arguments.length?(n=[+T[0],+T[1]],C()):n.slice()},e.rangeRound=function(T){return n=[+T[0],+T[1]],p=!0,C()},e.bandwidth=function(){return s},e.step=function(){return a},e.round=function(T){return arguments.length?(p=!!T,C()):p},e.padding=function(T){return arguments.length?(v=Math.min(1,g=+T),C()):v},e.paddingInner=function(T){return arguments.length?(v=Math.min(1,T),C()):v},e.paddingOuter=function(T){return arguments.length?(g=+T,C()):g},e.align=function(T){return arguments.length?(x=Math.max(0,Math.min(1,T)),C()):x},e.copy=function(){return $y(i(),n).round(p).paddingInner(v).paddingOuter(g).align(x)},initRange.apply(C(),arguments)}function Qy(e){var i=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return Qy(i())},e}function hP(){return Qy($y.apply(null,arguments).paddingInner(1))}var yw=Q(26257),_w=Q(73626);function xw(e,i){return e=+e,i=+i,function(r){return Math.round(e*(1-r)+i*r)}}function bw(e){return function(){return e}}function Vv(e){return+e}var Jy=[0,1];function Rc(e){return e}function Gv(e,i){return(i-=e=+e)?function(r){return(r-e)/i}:bw(isNaN(i)?NaN:.5)}function e_(e){var i=e[0],r=e[e.length-1],n;return i>r&&(n=i,i=r,r=n),function(a){return Math.max(i,Math.min(r,a))}}function Ew(e,i,r){var n=e[0],a=e[1],s=i[0],p=i[1];return a<n?(n=Gv(a,n),s=r(p,s)):(n=Gv(n,a),s=r(s,p)),function(v){return s(n(v))}}function Sw(e,i,r){var n=Math.min(e.length,i.length)-1,a=new Array(n),s=new Array(n),p=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),i=i.slice().reverse());++p<n;)a[p]=Gv(e[p],e[p+1]),s[p]=r(i[p],i[p+1]);return function(v){var g=G0(e,v,1,n)-1;return s[g](a[g](v))}}function K0(e,i){return i.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Hv(){var e=Jy,i=Jy,r=yw.Z,n,a,s,p=Rc,v,g,x;function C(){return v=Math.min(e.length,i.length)>2?Sw:Ew,g=x=null,T}function T(R){return isNaN(R=+R)?s:(g||(g=v(e.map(n),i,r)))(n(p(R)))}return T.invert=function(R){return p(a((x||(x=v(i,e.map(n),_w.Z)))(R)))},T.domain=function(R){return arguments.length?(e=Y0.call(R,Vv),p===Rc||(p=e_(e)),C()):e.slice()},T.range=function(R){return arguments.length?(i=Zh.call(R),C()):i.slice()},T.rangeRound=function(R){return i=Zh.call(R),r=xw,C()},T.clamp=function(R){return arguments.length?(p=R?e_(e):Rc,T):p!==Rc},T.interpolate=function(R){return arguments.length?(r=R,C()):r},T.unknown=function(R){return arguments.length?(s=R,T):s},function(R,F){return n=R,a=F,C()}}function t_(e,i){return Hv()(e,i)}var Cw=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function $0(e){if(!(i=Cw.exec(e)))throw new Error("invalid format: "+e);var i;return new Wv({fill:i[1],align:i[2],sign:i[3],symbol:i[4],zero:i[5],width:i[6],comma:i[7],precision:i[8]&&i[8].slice(1),trim:i[9],type:i[10]})}$0.prototype=Wv.prototype;function Wv(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}Wv.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Aw(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Q0(e,i){if((r=(e=i?e.toExponential(i-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function _d(e){return e=Q0(Math.abs(e)),e?e[1]:NaN}function ww(e,i){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(_d(i)/3)))*3-_d(Math.abs(e)))}function Tw(e,i){return function(r,n){for(var a=r.length,s=[],p=0,v=e[0],g=0;a>0&&v>0&&(g+v+1>n&&(v=Math.max(1,n-g)),s.push(r.substring(a-=v,a+v)),!((g+=v+1)>n));)v=e[p=(p+1)%e.length];return s.reverse().join(i)}}function Mw(e){return function(i){return i.replace(/[0-9]/g,function(r){return e[+r]})}}function Pw(e){e:for(var i=e.length,r=1,n=-1,a;r<i;++r)switch(e[r]){case".":n=a=r;break;case"0":n===0&&(n=r),a=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(a+1):e}var r_;function Iw(e,i){var r=Q0(e,i);if(!r)return e+"";var n=r[0],a=r[1],s=a-(r_=Math.max(-8,Math.min(8,Math.floor(a/3)))*3)+1,p=n.length;return s===p?n:s>p?n+new Array(s-p+1).join("0"):s>0?n.slice(0,s)+"."+n.slice(s):"0."+new Array(1-s).join("0")+Q0(e,Math.max(0,i+s-1))[0]}function n_(e,i){var r=Q0(e,i);if(!r)return e+"";var n=r[0],a=r[1];return a<0?"0."+new Array(-a).join("0")+n:n.length>a+1?n.slice(0,a+1)+"."+n.slice(a+1):n+new Array(a-n.length+2).join("0")}var i_={"%":function(e,i){return(e*100).toFixed(i)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:Aw,e:function(e,i){return e.toExponential(i)},f:function(e,i){return e.toFixed(i)},g:function(e,i){return e.toPrecision(i)},o:function(e){return Math.round(e).toString(8)},p:function(e,i){return n_(e*100,i)},r:n_,s:Iw,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function a_(e){return e}var o_=Array.prototype.map,s_=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function Ow(e){var i=e.grouping===void 0||e.thousands===void 0?a_:Tw(o_.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",a=e.decimal===void 0?".":e.decimal+"",s=e.numerals===void 0?a_:Mw(o_.call(e.numerals,String)),p=e.percent===void 0?"%":e.percent+"",v=e.minus===void 0?"-":e.minus+"",g=e.nan===void 0?"NaN":e.nan+"";function x(T){T=$0(T);var R=T.fill,F=T.align,j=T.sign,Y=T.symbol,J=T.zero,be=T.width,Be=T.comma,Ye=T.precision,tt=T.trim,Et=T.type;Et==="n"?(Be=!0,Et="g"):i_[Et]||(Ye===void 0&&(Ye=12),tt=!0,Et="g"),(J||R==="0"&&F==="=")&&(J=!0,R="0",F="=");var wt=Y==="$"?r:Y==="#"&&/[boxX]/.test(Et)?"0"+Et.toLowerCase():"",Yt=Y==="$"?n:/[%p]/.test(Et)?p:"",ar=i_[Et],Mr=/[defgprs%]/.test(Et);Ye=Ye===void 0?6:/[gprs]/.test(Et)?Math.max(1,Math.min(21,Ye)):Math.max(0,Math.min(20,Ye));function Qr(br){var vn=wt,Pn=Yt,$n,Ba,Yo;if(Et==="c")Pn=ar(br)+Pn,br="";else{br=+br;var ks=br<0||1/br<0;if(br=isNaN(br)?g:ar(Math.abs(br),Ye),tt&&(br=Pw(br)),ks&&+br==0&&j!=="+"&&(ks=!1),vn=(ks?j==="("?j:v:j==="-"||j==="("?"":j)+vn,Pn=(Et==="s"?s_[8+r_/3]:"")+Pn+(ks&&j==="("?")":""),Mr){for($n=-1,Ba=br.length;++$n<Ba;)if(Yo=br.charCodeAt($n),48>Yo||Yo>57){Pn=(Yo===46?a+br.slice($n+1):br.slice($n))+Pn,br=br.slice(0,$n);break}}}Be&&!J&&(br=i(br,Infinity));var Ls=vn.length+br.length+Pn.length,Hs=Ls<be?new Array(be-Ls+1).join(R):"";switch(Be&&J&&(br=i(Hs+br,Hs.length?be-Pn.length:Infinity),Hs=""),F){case"<":br=vn+br+Pn+Hs;break;case"=":br=vn+Hs+br+Pn;break;case"^":br=Hs.slice(0,Ls=Hs.length>>1)+vn+br+Pn+Hs.slice(Ls);break;default:br=Hs+vn+br+Pn;break}return s(br)}return Qr.toString=function(){return T+""},Qr}function C(T,R){var F=x((T=$0(T),T.type="f",T)),j=Math.max(-8,Math.min(8,Math.floor(_d(R)/3)))*3,Y=Math.pow(10,-j),J=s_[8+j/3];return function(be){return F(Y*be)+J}}return{format:x,formatPrefix:C}}var J0,Xv,u_;Rw({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function Rw(e){return J0=Ow(e),Xv=J0.format,u_=J0.formatPrefix,J0}function kw(e,i){return e=Math.abs(e),i=Math.abs(i)-e,Math.max(0,_d(i)-_d(e))+1}function Lw(e){return Math.max(0,-_d(Math.abs(e)))}function Dw(e,i,r,n){var a=Zv(e,i,r),s;switch(n=$0(n==null?",f":n),n.type){case"s":{var p=Math.max(Math.abs(e),Math.abs(i));return n.precision==null&&!isNaN(s=ww(a,p))&&(n.precision=s),u_(n,p)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(s=kw(a,Math.max(Math.abs(e),Math.abs(i))))&&(n.precision=s-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(s=Lw(a))&&(n.precision=s-(n.type==="%")*2);break}}return Xv(n)}function ev(e){var i=e.domain;return e.ticks=function(r){var n=i();return Hy(n[0],n[n.length-1],r==null?10:r)},e.tickFormat=function(r,n){var a=i();return Dw(a[0],a[a.length-1],r==null?10:r,n)},e.nice=function(r){r==null&&(r=10);var n=i(),a=0,s=n.length-1,p=n[a],v=n[s],g;return v<p&&(g=p,p=v,v=g,g=a,a=s,s=g),g=H0(p,v,r),g>0?(p=Math.floor(p/g)*g,v=Math.ceil(v/g)*g,g=H0(p,v,r)):g<0&&(p=Math.ceil(p*g)/g,v=Math.floor(v*g)/g,g=H0(p,v,r)),g>0?(n[a]=Math.floor(p/g)*g,n[s]=Math.ceil(v/g)*g,i(n)):g<0&&(n[a]=Math.ceil(p*g)/g,n[s]=Math.floor(v*g)/g,i(n)),e},e}function l_(){var e=t_(Rc,Rc);return e.copy=function(){return K0(e,l_())},sh.apply(e,arguments),ev(e)}function c_(e){var i;function r(n){return isNaN(n=+n)?i:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=Y0.call(n,Vv),r):e.slice()},r.unknown=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return c_(e).unknown(i)},e=arguments.length?Y0.call(e,Vv):[0,1],ev(r)}function f_(e,i){e=e.slice();var r=0,n=e.length-1,a=e[r],s=e[n],p;return s<a&&(p=r,r=n,n=p,p=a,a=s,s=p),e[r]=i.floor(a),e[n]=i.ceil(s),e}function p_(e){return Math.log(e)}function h_(e){return Math.exp(e)}function Fw(e){return-Math.log(-e)}function Bw(e){return-Math.exp(-e)}function Nw(e){return isFinite(e)?+("1e"+e):e<0?0:e}function zw(e){return e===10?Nw:e===Math.E?Math.exp:function(i){return Math.pow(e,i)}}function Uw(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(i){return Math.log(i)/e})}function d_(e){return function(i){return-e(-i)}}function Zw(e){var i=e(p_,h_),r=i.domain,n=10,a,s;function p(){return a=Uw(n),s=zw(n),r()[0]<0?(a=d_(a),s=d_(s),e(Fw,Bw)):e(p_,h_),i}return i.base=function(v){return arguments.length?(n=+v,p()):n},i.domain=function(v){return arguments.length?(r(v),p()):r()},i.ticks=function(v){var g=r(),x=g[0],C=g[g.length-1],T;(T=C<x)&&(R=x,x=C,C=R);var R=a(x),F=a(C),j,Y,J,be=v==null?10:+v,Be=[];if(!(n%1)&&F-R<be){if(R=Math.round(R)-1,F=Math.round(F)+1,x>0){for(;R<F;++R)for(Y=1,j=s(R);Y<n;++Y)if(J=j*Y,!(J<x)){if(J>C)break;Be.push(J)}}else for(;R<F;++R)for(Y=n-1,j=s(R);Y>=1;--Y)if(J=j*Y,!(J<x)){if(J>C)break;Be.push(J)}}else Be=Hy(R,F,Math.min(F-R,be)).map(s);return T?Be.reverse():Be},i.tickFormat=function(v,g){if(g==null&&(g=n===10?".0e":","),typeof g!="function"&&(g=Xv(g)),v===Infinity)return g;v==null&&(v=10);var x=Math.max(1,n*v/i.ticks().length);return function(C){var T=C/s(Math.round(a(C)));return T*n<n-.5&&(T*=n),T<=x?g(C):""}},i.nice=function(){return r(f_(r(),{floor:function(v){return s(Math.floor(a(v)))},ceil:function(v){return s(Math.ceil(a(v)))}}))},i}function v_(){var e=Zw(Hv()).domain([1,10]);return e.copy=function(){return K0(e,v_()).base(e.base())},sh.apply(e,arguments),e}function m_(e){return function(i){return Math.sign(i)*Math.log1p(Math.abs(i/e))}}function g_(e){return function(i){return Math.sign(i)*Math.expm1(Math.abs(i))*e}}function jw(e){var i=1,r=e(m_(i),g_(i));return r.constant=function(n){return arguments.length?e(m_(i=+n),g_(i)):i},linearish(r)}function Vw(){var e=jw(transformer());return e.copy=function(){return copy(e,Vw()).constant(e.constant())},initRange.apply(e,arguments)}function y_(e){return function(i){return i<0?-Math.pow(-i,e):Math.pow(i,e)}}function Gw(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function Hw(e){return e<0?-e*e:e*e}function Ww(e){var i=e(Rc,Rc),r=1;function n(){return r===1?e(Rc,Rc):r===.5?e(Gw,Hw):e(y_(r),y_(1/r))}return i.exponent=function(a){return arguments.length?(r=+a,n()):r},ev(i)}function Yv(){var e=Ww(Hv());return e.copy=function(){return K0(e,Yv()).exponent(e.exponent())},sh.apply(e,arguments),e}function dP(){return Yv.apply(null,arguments).exponent(.5)}function __(){var e=[],i=[],r=[],n;function a(){var p=0,v=Math.max(1,i.length);for(r=new Array(v-1);++p<v;)r[p-1]=dw(e,p/v);return s}function s(p){return isNaN(p=+p)?n:i[G0(r,p)]}return s.invertExtent=function(p){var v=i.indexOf(p);return v<0?[NaN,NaN]:[v>0?r[v-1]:e[0],v<r.length?r[v]:e[e.length-1]]},s.domain=function(p){if(!arguments.length)return e.slice();e=[];for(var v=0,g=p.length,x;v<g;++v)x=p[v],x!=null&&!isNaN(x=+x)&&e.push(x);return e.sort(Bv),a()},s.range=function(p){return arguments.length?(i=Zh.call(p),a()):i.slice()},s.unknown=function(p){return arguments.length?(n=p,s):n},s.quantiles=function(){return r.slice()},s.copy=function(){return __().domain(e).range(i).unknown(n)},sh.apply(s,arguments)}function x_(){var e=0,i=1,r=1,n=[.5],a=[0,1],s;function p(g){return g<=g?a[G0(n,g,0,r)]:s}function v(){var g=-1;for(n=new Array(r);++g<r;)n[g]=((g+1)*i-(g-r)*e)/(r+1);return p}return p.domain=function(g){return arguments.length?(e=+g[0],i=+g[1],v()):[e,i]},p.range=function(g){return arguments.length?(r=(a=Zh.call(g)).length-1,v()):a.slice()},p.invertExtent=function(g){var x=a.indexOf(g);return x<0?[NaN,NaN]:x<1?[e,n[0]]:x>=r?[n[r-1],i]:[n[x-1],n[x]]},p.unknown=function(g){return arguments.length&&(s=g),p},p.thresholds=function(){return n.slice()},p.copy=function(){return x_().domain([e,i]).range(a).unknown(s)},sh.apply(ev(p),arguments)}function b_(){var e=[.5],i=[0,1],r,n=1;function a(s){return s<=s?i[G0(e,s,0,n)]:r}return a.domain=function(s){return arguments.length?(e=Zh.call(s),n=Math.min(e.length,i.length-1),a):e.slice()},a.range=function(s){return arguments.length?(i=Zh.call(s),n=Math.min(e.length,i.length-1),a):i.slice()},a.invertExtent=function(s){var p=i.indexOf(s);return[e[p-1],e[p]]},a.unknown=function(s){return arguments.length?(r=s,a):r},a.copy=function(){return b_().domain(e).range(i).unknown(r)},sh.apply(a,arguments)}var qv=new Date,Kv=new Date;function il(e,i,r,n){function a(s){return e(s=arguments.length===0?new Date:new Date(+s)),s}return a.floor=function(s){return e(s=new Date(+s)),s},a.ceil=function(s){return e(s=new Date(s-1)),i(s,1),e(s),s},a.round=function(s){var p=a(s),v=a.ceil(s);return s-p<v-s?p:v},a.offset=function(s,p){return i(s=new Date(+s),p==null?1:Math.floor(p)),s},a.range=function(s,p,v){var g=[],x;if(s=a.ceil(s),v=v==null?1:Math.floor(v),!(s<p)||!(v>0))return g;do g.push(x=new Date(+s)),i(s,v),e(s);while(x<s&&s<p);return g},a.filter=function(s){return il(function(p){if(p>=p)for(;e(p),!s(p);)p.setTime(p-1)},function(p,v){if(p>=p)if(v<0)for(;++v<=0;)for(;i(p,-1),!s(p););else for(;--v>=0;)for(;i(p,1),!s(p););})},r&&(a.count=function(s,p){return qv.setTime(+s),Kv.setTime(+p),e(qv),e(Kv),Math.floor(r(qv,Kv))},a.every=function(s){return s=Math.floor(s),!isFinite(s)||!(s>0)?null:s>1?a.filter(n?function(p){return n(p)%s==0}:function(p){return a.count(0,p)%s==0}):a}),a}var $v=il(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,i){e.setFullYear(e.getFullYear()+i)},function(e,i){return i.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});$v.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:il(function(i){i.setFullYear(Math.floor(i.getFullYear()/e)*e),i.setMonth(0,1),i.setHours(0,0,0,0)},function(i,r){i.setFullYear(i.getFullYear()+r*e)})};var xd=$v,vP=$v.range,E_=il(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,i){e.setMonth(e.getMonth()+i)},function(e,i){return i.getMonth()-e.getMonth()+(i.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),Xw=E_,mP=E_.range,tv=1e3,a0=6e4,S_=36e5,C_=864e5,A_=6048e5;function jh(e){return il(function(i){i.setDate(i.getDate()-(i.getDay()+7-e)%7),i.setHours(0,0,0,0)},function(i,r){i.setDate(i.getDate()+r*7)},function(i,r){return(r-i-(r.getTimezoneOffset()-i.getTimezoneOffset())*a0)/A_})}var Qv=jh(0),rv=jh(1),Yw=jh(2),qw=jh(3),bd=jh(4),Kw=jh(5),$w=jh(6),gP=Qv.range,yP=rv.range,_P=Yw.range,xP=qw.range,bP=bd.range,EP=Kw.range,SP=$w.range,w_=il(function(e){e.setHours(0,0,0,0)},function(e,i){e.setDate(e.getDate()+i)},function(e,i){return(i-e-(i.getTimezoneOffset()-e.getTimezoneOffset())*a0)/C_},function(e){return e.getDate()-1}),Jv=w_,CP=w_.range,T_=il(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*tv-e.getMinutes()*a0)},function(e,i){e.setTime(+e+i*S_)},function(e,i){return(i-e)/S_},function(e){return e.getHours()}),Qw=T_,AP=T_.range,M_=il(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*tv)},function(e,i){e.setTime(+e+i*a0)},function(e,i){return(i-e)/a0},function(e){return e.getMinutes()}),Jw=M_,wP=M_.range,P_=il(function(e){e.setTime(e-e.getMilliseconds())},function(e,i){e.setTime(+e+i*tv)},function(e,i){return(i-e)/tv},function(e){return e.getUTCSeconds()}),eT=P_,TP=P_.range,nv=il(function(){},function(e,i){e.setTime(+e+i)},function(e,i){return i-e});nv.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?il(function(i){i.setTime(Math.floor(i/e)*e)},function(i,r){i.setTime(+i+r*e)},function(i,r){return(r-i)/e}):nv};var tT=nv,MP=nv.range;function Vh(e){return il(function(i){i.setUTCDate(i.getUTCDate()-(i.getUTCDay()+7-e)%7),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCDate(i.getUTCDate()+r*7)},function(i,r){return(r-i)/A_})}var I_=Vh(0),iv=Vh(1),rT=Vh(2),nT=Vh(3),Ed=Vh(4),iT=Vh(5),aT=Vh(6),PP=I_.range,IP=iv.range,OP=rT.range,RP=nT.range,kP=Ed.range,LP=iT.range,DP=aT.range,O_=il(function(e){e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCDate(e.getUTCDate()+i)},function(e,i){return(i-e)/C_},function(e){return e.getUTCDate()-1}),R_=O_,FP=O_.range,em=il(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCFullYear(e.getUTCFullYear()+i)},function(e,i){return i.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});em.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:il(function(i){i.setUTCFullYear(Math.floor(i.getUTCFullYear()/e)*e),i.setUTCMonth(0,1),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCFullYear(i.getUTCFullYear()+r*e)})};var o0=em,BP=em.range;function tm(e){if(0<=e.y&&e.y<100){var i=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return i.setFullYear(e.y),i}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function rm(e){if(0<=e.y&&e.y<100){var i=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return i.setUTCFullYear(e.y),i}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function s0(e,i,r){return{y:e,m:i,d:r,H:0,M:0,S:0,L:0}}function oT(e){var i=e.dateTime,r=e.date,n=e.time,a=e.periods,s=e.days,p=e.shortDays,v=e.months,g=e.shortMonths,x=u0(a),C=l0(a),T=u0(s),R=l0(s),F=u0(p),j=l0(p),Y=u0(v),J=l0(v),be=u0(g),Be=l0(g),Ye={a:ks,A:Ls,b:Hs,B:ff,c:null,d:N_,e:N_,f:PT,g:zT,G:ZT,H:wT,I:TT,j:MT,L:z_,m:IT,M:OT,p:gv,q:A3,Q:H_,s:W_,S:RT,u:kT,U:LT,V:DT,w:FT,W:BT,x:null,X:null,y:NT,Y:UT,Z:jT,"%":G_},tt={a:w3,A:T3,b:M3,B:P3,c:null,d:Z_,e:Z_,f:WT,g:rM,G:iM,H:VT,I:GT,j:HT,L:j_,m:XT,M:YT,p:I3,q:O3,Q:H_,s:W_,S:qT,u:KT,U:$T,V:QT,w:JT,W:eM,x:null,X:null,y:tM,Y:nM,Z:aM,"%":G_},Et={a:Qr,A:br,b:vn,B:Pn,c:$n,d:F_,e:F_,f:ET,g:D_,G:L_,H:B_,I:B_,j:yT,L:bT,m:gT,M:_T,p:Mr,q:mT,Q:CT,s:AT,S:xT,u:fT,U:pT,V:hT,w:cT,W:dT,x:Ba,X:Yo,y:D_,Y:L_,Z:vT,"%":ST};Ye.x=wt(r,Ye),Ye.X=wt(n,Ye),Ye.c=wt(i,Ye),tt.x=wt(r,tt),tt.X=wt(n,tt),tt.c=wt(i,tt);function wt(oi,Oa){return function(no){var mn=[],Tl=-1,zo=0,ec=oi.length,tc,Hh,kx;for(no instanceof Date||(no=new Date(+no));++Tl<ec;)oi.charCodeAt(Tl)===37&&(mn.push(oi.slice(zo,Tl)),(Hh=k_[tc=oi.charAt(++Tl)])!=null?tc=oi.charAt(++Tl):Hh=tc==="e"?" ":"0",(kx=Oa[tc])&&(tc=kx(no,Hh)),mn.push(tc),zo=Tl+1);return mn.push(oi.slice(zo,Tl)),mn.join("")}}function Yt(oi,Oa){return function(no){var mn=s0(1900,void 0,1),Tl=ar(mn,oi,no+="",0),zo,ec;if(Tl!=no.length)return null;if("Q"in mn)return new Date(mn.Q);if("s"in mn)return new Date(mn.s*1e3+("L"in mn?mn.L:0));if(Oa&&!("Z"in mn)&&(mn.Z=0),"p"in mn&&(mn.H=mn.H%12+mn.p*12),mn.m===void 0&&(mn.m="q"in mn?mn.q:0),"V"in mn){if(mn.V<1||mn.V>53)return null;"w"in mn||(mn.w=1),"Z"in mn?(zo=rm(s0(mn.y,0,1)),ec=zo.getUTCDay(),zo=ec>4||ec===0?iv.ceil(zo):iv(zo),zo=R_.offset(zo,(mn.V-1)*7),mn.y=zo.getUTCFullYear(),mn.m=zo.getUTCMonth(),mn.d=zo.getUTCDate()+(mn.w+6)%7):(zo=tm(s0(mn.y,0,1)),ec=zo.getDay(),zo=ec>4||ec===0?rv.ceil(zo):rv(zo),zo=Jv.offset(zo,(mn.V-1)*7),mn.y=zo.getFullYear(),mn.m=zo.getMonth(),mn.d=zo.getDate()+(mn.w+6)%7)}else("W"in mn||"U"in mn)&&("w"in mn||(mn.w="u"in mn?mn.u%7:"W"in mn?1:0),ec="Z"in mn?rm(s0(mn.y,0,1)).getUTCDay():tm(s0(mn.y,0,1)).getDay(),mn.m=0,mn.d="W"in mn?(mn.w+6)%7+mn.W*7-(ec+5)%7:mn.w+mn.U*7-(ec+6)%7);return"Z"in mn?(mn.H+=mn.Z/100|0,mn.M+=mn.Z%100,rm(mn)):tm(mn)}}function ar(oi,Oa,no,mn){for(var Tl=0,zo=Oa.length,ec=no.length,tc,Hh;Tl<zo;){if(mn>=ec)return-1;if(tc=Oa.charCodeAt(Tl++),tc===37){if(tc=Oa.charAt(Tl++),Hh=Et[tc in k_?Oa.charAt(Tl++):tc],!Hh||(mn=Hh(oi,no,mn))<0)return-1}else if(tc!=no.charCodeAt(mn++))return-1}return mn}function Mr(oi,Oa,no){var mn=x.exec(Oa.slice(no));return mn?(oi.p=C[mn[0].toLowerCase()],no+mn[0].length):-1}function Qr(oi,Oa,no){var mn=F.exec(Oa.slice(no));return mn?(oi.w=j[mn[0].toLowerCase()],no+mn[0].length):-1}function br(oi,Oa,no){var mn=T.exec(Oa.slice(no));return mn?(oi.w=R[mn[0].toLowerCase()],no+mn[0].length):-1}function vn(oi,Oa,no){var mn=be.exec(Oa.slice(no));return mn?(oi.m=Be[mn[0].toLowerCase()],no+mn[0].length):-1}function Pn(oi,Oa,no){var mn=Y.exec(Oa.slice(no));return mn?(oi.m=J[mn[0].toLowerCase()],no+mn[0].length):-1}function $n(oi,Oa,no){return ar(oi,i,Oa,no)}function Ba(oi,Oa,no){return ar(oi,r,Oa,no)}function Yo(oi,Oa,no){return ar(oi,n,Oa,no)}function ks(oi){return p[oi.getDay()]}function Ls(oi){return s[oi.getDay()]}function Hs(oi){return g[oi.getMonth()]}function ff(oi){return v[oi.getMonth()]}function gv(oi){return a[+(oi.getHours()>=12)]}function A3(oi){return 1+~~(oi.getMonth()/3)}function w3(oi){return p[oi.getUTCDay()]}function T3(oi){return s[oi.getUTCDay()]}function M3(oi){return g[oi.getUTCMonth()]}function P3(oi){return v[oi.getUTCMonth()]}function I3(oi){return a[+(oi.getUTCHours()>=12)]}function O3(oi){return 1+~~(oi.getUTCMonth()/3)}return{format:function(oi){var Oa=wt(oi+="",Ye);return Oa.toString=function(){return oi},Oa},parse:function(oi){var Oa=Yt(oi+="",!1);return Oa.toString=function(){return oi},Oa},utcFormat:function(oi){var Oa=wt(oi+="",tt);return Oa.toString=function(){return oi},Oa},utcParse:function(oi){var Oa=Yt(oi+="",!0);return Oa.toString=function(){return oi},Oa}}}var k_={"-":"",_:" ","0":"0"},yu=/^\s*\d+/,sT=/^%/,uT=/[\\^$*+?|[\]().{}]/g;function ro(e,i,r){var n=e<0?"-":"",a=(n?-e:e)+"",s=a.length;return n+(s<r?new Array(r-s+1).join(i)+a:a)}function lT(e){return e.replace(uT,"\\$&")}function u0(e){return new RegExp("^(?:"+e.map(lT).join("|")+")","i")}function l0(e){for(var i={},r=-1,n=e.length;++r<n;)i[e[r].toLowerCase()]=r;return i}function cT(e,i,r){var n=yu.exec(i.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function fT(e,i,r){var n=yu.exec(i.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function pT(e,i,r){var n=yu.exec(i.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function hT(e,i,r){var n=yu.exec(i.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function dT(e,i,r){var n=yu.exec(i.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function L_(e,i,r){var n=yu.exec(i.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function D_(e,i,r){var n=yu.exec(i.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function vT(e,i,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(i.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function mT(e,i,r){var n=yu.exec(i.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function gT(e,i,r){var n=yu.exec(i.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function F_(e,i,r){var n=yu.exec(i.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function yT(e,i,r){var n=yu.exec(i.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function B_(e,i,r){var n=yu.exec(i.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function _T(e,i,r){var n=yu.exec(i.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function xT(e,i,r){var n=yu.exec(i.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function bT(e,i,r){var n=yu.exec(i.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function ET(e,i,r){var n=yu.exec(i.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function ST(e,i,r){var n=sT.exec(i.slice(r,r+1));return n?r+n[0].length:-1}function CT(e,i,r){var n=yu.exec(i.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function AT(e,i,r){var n=yu.exec(i.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function N_(e,i){return ro(e.getDate(),i,2)}function wT(e,i){return ro(e.getHours(),i,2)}function TT(e,i){return ro(e.getHours()%12||12,i,2)}function MT(e,i){return ro(1+Jv.count(xd(e),e),i,3)}function z_(e,i){return ro(e.getMilliseconds(),i,3)}function PT(e,i){return z_(e,i)+"000"}function IT(e,i){return ro(e.getMonth()+1,i,2)}function OT(e,i){return ro(e.getMinutes(),i,2)}function RT(e,i){return ro(e.getSeconds(),i,2)}function kT(e){var i=e.getDay();return i===0?7:i}function LT(e,i){return ro(Qv.count(xd(e)-1,e),i,2)}function U_(e){var i=e.getDay();return i>=4||i===0?bd(e):bd.ceil(e)}function DT(e,i){return e=U_(e),ro(bd.count(xd(e),e)+(xd(e).getDay()===4),i,2)}function FT(e){return e.getDay()}function BT(e,i){return ro(rv.count(xd(e)-1,e),i,2)}function NT(e,i){return ro(e.getFullYear()%100,i,2)}function zT(e,i){return e=U_(e),ro(e.getFullYear()%100,i,2)}function UT(e,i){return ro(e.getFullYear()%1e4,i,4)}function ZT(e,i){var r=e.getDay();return e=r>=4||r===0?bd(e):bd.ceil(e),ro(e.getFullYear()%1e4,i,4)}function jT(e){var i=e.getTimezoneOffset();return(i>0?"-":(i*=-1,"+"))+ro(i/60|0,"0",2)+ro(i%60,"0",2)}function Z_(e,i){return ro(e.getUTCDate(),i,2)}function VT(e,i){return ro(e.getUTCHours(),i,2)}function GT(e,i){return ro(e.getUTCHours()%12||12,i,2)}function HT(e,i){return ro(1+R_.count(o0(e),e),i,3)}function j_(e,i){return ro(e.getUTCMilliseconds(),i,3)}function WT(e,i){return j_(e,i)+"000"}function XT(e,i){return ro(e.getUTCMonth()+1,i,2)}function YT(e,i){return ro(e.getUTCMinutes(),i,2)}function qT(e,i){return ro(e.getUTCSeconds(),i,2)}function KT(e){var i=e.getUTCDay();return i===0?7:i}function $T(e,i){return ro(I_.count(o0(e)-1,e),i,2)}function V_(e){var i=e.getUTCDay();return i>=4||i===0?Ed(e):Ed.ceil(e)}function QT(e,i){return e=V_(e),ro(Ed.count(o0(e),e)+(o0(e).getUTCDay()===4),i,2)}function JT(e){return e.getUTCDay()}function eM(e,i){return ro(iv.count(o0(e)-1,e),i,2)}function tM(e,i){return ro(e.getUTCFullYear()%100,i,2)}function rM(e,i){return e=V_(e),ro(e.getUTCFullYear()%100,i,2)}function nM(e,i){return ro(e.getUTCFullYear()%1e4,i,4)}function iM(e,i){var r=e.getUTCDay();return e=r>=4||r===0?Ed(e):Ed.ceil(e),ro(e.getUTCFullYear()%1e4,i,4)}function aM(){return"+0000"}function G_(){return"%"}function H_(e){return+e}function W_(e){return Math.floor(+e/1e3)}var Sd,X_,oM,sM,uM;lM({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function lM(e){return Sd=oT(e),X_=Sd.format,oM=Sd.parse,sM=Sd.utcFormat,uM=Sd.utcParse,Sd}var c0=1e3,f0=c0*60,p0=f0*60,h0=p0*24,cM=h0*7,Y_=h0*30,nm=h0*365;function fM(e){return new Date(e)}function pM(e){return e instanceof Date?+e:+new Date(+e)}function q_(e,i,r,n,a,s,p,v,g){var x=t_(Rc,Rc),C=x.invert,T=x.domain,R=g(".%L"),F=g(":%S"),j=g("%I:%M"),Y=g("%I %p"),J=g("%a %d"),be=g("%b %d"),Be=g("%B"),Ye=g("%Y"),tt=[[p,1,c0],[p,5,5*c0],[p,15,15*c0],[p,30,30*c0],[s,1,f0],[s,5,5*f0],[s,15,15*f0],[s,30,30*f0],[a,1,p0],[a,3,3*p0],[a,6,6*p0],[a,12,12*p0],[n,1,h0],[n,2,2*h0],[r,1,cM],[i,1,Y_],[i,3,3*Y_],[e,1,nm]];function Et(Yt){return(p(Yt)<Yt?R:s(Yt)<Yt?F:a(Yt)<Yt?j:n(Yt)<Yt?Y:i(Yt)<Yt?r(Yt)<Yt?J:be:e(Yt)<Yt?Be:Ye)(Yt)}function wt(Yt,ar,Mr,Qr){if(Yt==null&&(Yt=10),typeof Yt=="number"){var br=Math.abs(Mr-ar)/Yt,vn=jy(function(Pn){return Pn[2]}).right(tt,br);vn===tt.length?(Qr=Zv(ar/nm,Mr/nm,Yt),Yt=e):vn?(vn=tt[br/tt[vn-1][2]<tt[vn][2]/br?vn-1:vn],Qr=vn[1],Yt=vn[0]):(Qr=Math.max(Zv(ar,Mr,Yt),1),Yt=v)}return Qr==null?Yt:Yt.every(Qr)}return x.invert=function(Yt){return new Date(C(Yt))},x.domain=function(Yt){return arguments.length?T(Y0.call(Yt,pM)):T().map(fM)},x.ticks=function(Yt,ar){var Mr=T(),Qr=Mr[0],br=Mr[Mr.length-1],vn=br<Qr,Pn;return vn&&(Pn=Qr,Qr=br,br=Pn),Pn=wt(Yt,Qr,br,ar),Pn=Pn?Pn.range(Qr,br+1):[],vn?Pn.reverse():Pn},x.tickFormat=function(Yt,ar){return ar==null?Et:g(ar)},x.nice=function(Yt,ar){var Mr=T();return(Yt=wt(Yt,Mr[0],Mr[Mr.length-1],ar))?T(f_(Mr,Yt)):x},x.copy=function(){return K0(x,q_(e,i,r,n,a,s,p,v,g))},x}function hM(){return sh.apply(q_(xd,Xw,Qv,Jv,Qw,Jw,eT,tT,X_).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function NP(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function av(){var e=0,i=1,r,n,a,s,p=identity,v=!1,g;function x(C){return isNaN(C=+C)?g:p(a===0?.5:(C=(s(C)-r)*a,v?Math.max(0,Math.min(1,C)):C))}return x.domain=function(C){return arguments.length?(r=s(e=+C[0]),n=s(i=+C[1]),a=r===n?0:1/(n-r),x):[e,i]},x.clamp=function(C){return arguments.length?(v=!!C,x):v},x.interpolator=function(C){return arguments.length?(p=C,x):p},x.unknown=function(C){return arguments.length?(g=C,x):g},function(C){return s=C,r=C(e),n=C(i),a=r===n?0:1/(n-r),x}}function ov(e,i){return i.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function dM(){var e=linearish(av()(identity));return e.copy=function(){return ov(e,dM())},initInterpolator.apply(e,arguments)}function vM(){var e=loggish(av()).domain([1,10]);return e.copy=function(){return ov(e,vM()).base(e.base())},initInterpolator.apply(e,arguments)}function mM(){var e=symlogish(av());return e.copy=function(){return ov(e,mM()).constant(e.constant())},initInterpolator.apply(e,arguments)}function K_(){var e=powish(av());return e.copy=function(){return ov(e,K_()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function zP(){return K_.apply(null,arguments).exponent(.5)}function gM(){var e=[],i=identity;function r(n){if(!isNaN(n=+n))return i((bisect(e,n)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(var a=0,s=n.length,p;a<s;++a)p=n[a],p!=null&&!isNaN(p=+p)&&e.push(p);return e.sort(ascending),r},r.interpolator=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return gM(i).domain(e)},initInterpolator.apply(r,arguments)}function sv(){var e=0,i=.5,r=1,n,a,s,p,v,g=identity,x,C=!1,T;function R(F){return isNaN(F=+F)?T:(F=.5+((F=+x(F))-a)*(F<a?p:v),g(C?Math.max(0,Math.min(1,F)):F))}return R.domain=function(F){return arguments.length?(n=x(e=+F[0]),a=x(i=+F[1]),s=x(r=+F[2]),p=n===a?0:.5/(a-n),v=a===s?0:.5/(s-a),R):[e,i,r]},R.clamp=function(F){return arguments.length?(C=!!F,R):C},R.interpolator=function(F){return arguments.length?(g=F,R):g},R.unknown=function(F){return arguments.length?(T=F,R):T},function(F){return x=F,n=F(e),a=F(i),s=F(r),p=n===a?0:.5/(a-n),v=a===s?0:.5/(s-a),R}}function yM(){var e=linearish(sv()(identity));return e.copy=function(){return copy(e,yM())},initInterpolator.apply(e,arguments)}function _M(){var e=loggish(sv()).domain([.1,1,10]);return e.copy=function(){return copy(e,_M()).base(e.base())},initInterpolator.apply(e,arguments)}function xM(){var e=symlogish(sv());return e.copy=function(){return copy(e,xM()).constant(e.constant())},initInterpolator.apply(e,arguments)}function $_(){var e=powish(sv());return e.copy=function(){return copy(e,$_()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function UP(){return $_.apply(null,arguments).exponent(.5)}var lf,Q_,J_,e1,im,t1,bM=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,EM=(lf={},(0,A.Z)(lf,ou.LINEAR,l_),(0,A.Z)(lf,ou.POWER,Yv),(0,A.Z)(lf,ou.LOG,v_),(0,A.Z)(lf,ou.IDENTITY,c_),(0,A.Z)(lf,ou.TIME,hM),(0,A.Z)(lf,ou.QUANTILE,__),(0,A.Z)(lf,ou.QUANTIZE,x_),(0,A.Z)(lf,ou.THRESHOLD,b_),(0,A.Z)(lf,ou.CAT,q0),lf),SM=(Q_=(0,Xr.b2)(),J_=(0,Xr.f3)(Gt.IGlobalConfigService),Q_(e1=(im=function(){function e(){(0,dt.Z)(this,e),Bn(this,"configService",t1,this),(0,A.Z)(this,"scaleCache",{}),(0,A.Z)(this,"scaleOptions",{})}return(0,Mt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("FeatureScalePlugin",function(){a.scaleOptions=r.getScaleOptions();var p=s.getLayerStyleAttributes(),v=r.getSource().data.dataArray;v.length!==0&&a.caculateScalesForAttributes(p||[],v)}),r.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){a.scaleOptions=r.getScaleOptions();var p=s.getLayerStyleAttributes(),v=r.getSource().data.dataArray;return a.caculateScalesForAttributes(p||[],v),r.layerModelNeedUpdate=!0,!0}),r.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!r.layerModelNeedUpdate){a.scaleOptions=r.getScaleOptions();var p=s.getLayerStyleAttributes();if(p){var v=r.getSource().data.dataArray;if(v.length===0)return;var g=p.filter(function(x){return x.needRescale});g.length&&a.caculateScalesForAttributes(g,v)}}})}},{key:"isNumber",value:function(r){return!isNaN(parseFloat(r))&&isFinite(r)}},{key:"caculateScalesForAttributes",value:function(r,n){var a=this;this.scaleCache={},r.forEach(function(s){if(s.scale){var p=s.scale,v=s.name;p.names=a.parseFields(s.scale.field||[]);var g=[];p.names.forEach(function(x){g.push(a.getOrCreateScale(x,s,n))}),g.some(function(x){return x.type===eh.VARIABLE})?(p.type=eh.VARIABLE,g.forEach(function(x){if(!p.callback){var C;if(p.values&&p.values!=="text"){var T;if(((T=x.option)===null||T===void 0?void 0:T.type)==="linear"&&p.values.length>2){var R=x.scale.ticks(p.values.length);v==="color"&&x.scale.domain(R)}x.scale.range(p.values)}else((C=x.option)===null||C===void 0?void 0:C.type)==="cat"&&x.scale.range(x.option.domain)}})):(p.type=eh.CONSTANT,p.defaultValues=g.map(function(x,C){return x.scale(p.names[C])})),p.scalers=g.map(function(x){return{field:x.field,func:x.scale,option:x.option}}),s.needRescale=!1}})}},{key:"getOrCreateScale",value:function(r,n,a){var s,p=[r,n.name].join("_"),v=(s=n.scale)===null||s===void 0?void 0:s.values,g=this.createScale(r,n.name,v,a);return g}},{key:"parseFields",value:function(r){return Array.isArray(r)?r:w()(r)?r.split("*"):[r]}},{key:"createScale",value:function(r,n,a,s){var p,v,g=this.scaleOptions[n]&&((p=this.scaleOptions[n])===null||p===void 0?void 0:p.field)===r?this.scaleOptions[n]:this.scaleOptions[r],x={field:r,scale:void 0,type:eh.VARIABLE,option:g};if(!s||!s.length)return g&&g.type?x.scale=this.createDefaultScale(g):(x.scale=q0([r]),x.type=eh.CONSTANT),x;var C=(v=s.find(function(F){return!Ci()(F[r])}))===null||v===void 0?void 0:v[r];if(this.isNumber(r)||Ci()(C)&&!g)x.scale=q0([r]),x.type=eh.CONSTANT;else{var T=g&&g.type||this.getDefaultType(C);a==="text"&&(T=ou.CAT);var R=this.createDefaultScaleConfig(T,r,s);Object.assign(R,g),x.scale=this.createDefaultScale(R),x.option=R}return x}},{key:"getDefaultType",value:function(r){var n=ou.LINEAR;return typeof r=="string"&&(n=bM.test(r)?ou.TIME:ou.CAT),n}},{key:"createDefaultScaleConfig",value:function(r,n,a){var s={type:r},p=(a==null?void 0:a.map(function(v){return v[n]}))||[];return r!==ou.CAT&&r!==ou.QUANTILE?s.domain=pw(p):r===ou.CAT?s.domain=Co()(p):r===ou.QUANTILE&&(s.domain=p),s}},{key:"createDefaultScale",value:function(r){var n=r.type,a=r.domain,s=EM[n]();return a&&s.domain(a),s}}]),e}(),t1=ai(im.prototype,"configService",[J_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),im))||e1),r1,n1,i1,a1,uv,o1,s1;function u1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function CM(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?u1(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var AM=(r1=(0,Xr.b2)(),n1=(0,Xr.f3)(Gt.ICameraService),i1=(0,Xr.f3)(Gt.IRendererService),r1(a1=(uv=function(){function e(){(0,dt.Z)(this,e),Bn(this,"cameraService",o1,this),Bn(this,"rendererService",s1,this)}return(0,Mt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){r.models.forEach(function(n){n.addUniforms(CM({},r.layerModel.getAnimateUniforms()))})})}}]),e}(),o1=ai(uv.prototype,"cameraService",[n1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),s1=ai(uv.prototype,"rendererService",[i1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uv))||a1),l1,c1,wM=(l1=(0,Xr.b2)(),l1(c1=function(){function e(){(0,dt.Z)(this,e)}return(0,Mt.Z)(e,[{key:"apply",value:function(r){r.hooks.init.tap("LayerModelPlugin",function(){r.prepareBuildModel(),r.buildModels(),r.styleNeedUpdate=!1}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return r.prepareBuildModel(),r.clearModels(),r.buildModels(),r.layerModelNeedUpdate=!1,!1})}}]),e}())||c1),f1,p1,TM=(f1=(0,Xr.b2)(),f1(p1=function(){function e(){(0,dt.Z)(this,e)}return(0,Mt.Z)(e,[{key:"apply",value:function(r){r.hooks.afterInit.tap("LayerStylePlugin",function(){r.updateLayerConfig({});var n=r.getLayerConfig(),a=n.autoFit,s=n.fitBoundsOptions;a&&setTimeout(function(){r.fitBounds(s)},100)})}}]),e}())||p1),h1,d1,MM=["type"];function v1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function d0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?v1(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var m1={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},PM={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},IM={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},OM={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},ZP=null;function RM(e){var i={u_DirectionalLights:new Array(3).fill(d0({},IM)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(d0({},OM)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[PM]),e.forEach(function(r,n){var a=r.type,s=a===void 0?"directional":a,p=(0,to.Z)(r,MM),v=m1[s].lights,g=m1[s].num,x=i[g];i[v][x]=d0(d0({},i[v][x]),p),i[g]++}),i}var kM=(h1=(0,Xr.b2)(),h1(d1=function(){function e(){(0,dt.Z)(this,e)}return(0,Mt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LightingPlugin",function(){var n=r.getLayerConfig(),a=n.enableLighting;a&&r.models.forEach(function(s){return s.addUniforms(d0({},RM()))})})}}]),e}())||d1),g1,y1,_1,am,x1,LM=(g1=(0,Xr.b2)(),y1=(0,Xr.f3)(Gt.IGlobalConfigService),g1(_1=(am=function(){function e(){(0,dt.Z)(this,e),Bn(this,"configService",x1,this),(0,A.Z)(this,"enabled",void 0)}return(0,Mt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.rendererService,p=n.postProcessingPassFactory,v=n.normalPassFactory;r.hooks.init.tap("MultiPassRendererPlugin",function(){var g=r.getLayerConfig(),x=g.enableMultiPassRenderer,C=g.passes,T=C===void 0?[]:C;a.enabled=!!x&&r.getLayerConfig().enableMultiPassRenderer!==!1,a.enabled&&(r.multiPassRenderer=_g(r,T,p,v),r.multiPassRenderer.setRenderFlag(!0))}),r.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(a.enabled){var g=s.getViewportSize(),x=g.width,C=g.height;r.multiPassRenderer.resize(x,C)}})}}]),e}(),x1=ai(am.prototype,"configService",[y1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),am))||_1),b1,E1,lv={NONE:0,ENCODE:1,HIGHLIGHT:2},DM=(b1=(0,Xr.b2)(),b1(E1=function(){function e(){(0,dt.Z)(this,e)}return(0,Mt.Z)(e,[{key:"apply",value:function(r,n){var a=n.rendererService,s=n.styleAttributeService;r.hooks.init.tap("PixelPickingPlugin",function(){var p=!0;s.registerStyleAttribute({name:"pickingColor",type:On.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:k.FLOAT},size:3,update:function(g,x){var C=g.id;return p?Ps(C):[0,0,0]}}})}),r.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var p=r.getLayerConfig(),v=p.enablePicking;v&&r.isVisible()&&r.models.forEach(function(g){return g.addUniforms({u_PickingStage:lv.ENCODE})})}),r.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var p=r.getLayerConfig(),v=p.enablePicking;v&&r.isVisible()&&r.models.forEach(function(g){return g.addUniforms({u_PickingStage:lv.HIGHLIGHT})})}),r.hooks.beforeHighlight.tap("PixelPickingPlugin",function(p){var v=r.getLayerConfig(),g=v.highlightColor,x=v.activeMix,C=x===void 0?0:x,T=typeof g=="string"?_i(g):g||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:Bs(new Uint8Array(p))}),r.models.forEach(function(R){return R.addUniforms({u_PickingStage:lv.HIGHLIGHT,u_PickingColor:p,u_HighlightColor:T.map(function(F){return F*255}),u_activeMix:C})})}),r.hooks.beforeSelect.tap("PixelPickingPlugin",function(p){var v=r.getLayerConfig(),g=v.selectColor,x=v.selectMix,C=x===void 0?0:x,T=typeof g=="string"?_i(g):g||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:Bs(new Uint8Array(p))}),r.models.forEach(function(R){return R.addUniforms({u_PickingStage:lv.HIGHLIGHT,u_PickingColor:p,u_HighlightColor:T.map(function(F){return F*255}),u_activeMix:C,u_CurrentSelectedId:p,u_SelectColor:T.map(function(F){return F*255}),u_EnableSelect:1})})})}}]),e}())||E1),S1,C1,FM=(S1=(0,Xr.b2)(),S1(C1=function(){function e(){(0,dt.Z)(this,e)}return(0,Mt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("RegisterStyleAttributePlugin",function(){a.registerBuiltinAttributes(s)})}},{key:"registerBuiltinAttributes",value:function(r){r.registerStyleAttribute({name:"position",type:On.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:k.FLOAT},size:3,update:function(a,s,p){return p.length===2?[p[0],p[1],0]:[p[0],p[1],p[2]]}}}),r.registerStyleAttribute({name:"filter",type:On.Attribute,descriptor:{name:"filter",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(a,s){var p=a.filter;return p?[1]:[0]}}}),r.registerStyleAttribute({name:"color",type:On.Attribute,descriptor:{name:"a_Color",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:4,update:function(a,s){var p=a.color;return!p||!p.length?[1,1,1,1]:p}}}),r.registerStyleAttribute({name:"vertexId",type:On.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(a,s,p,v){return[s]}}})}}]),e}())||C1),A1,w1,T1,M1,P1,I1,Cd,O1,R1,k1,L1,BM=(A1=(0,Xr.b2)(),w1=(0,Xr.f3)(Gt.ICameraService),T1=(0,Xr.f3)(Gt.ICoordinateSystemService),M1=(0,Xr.f3)(Gt.IRendererService),P1=(0,Xr.f3)(Gt.IMapService),A1(I1=(Cd=function(){function e(){(0,dt.Z)(this,e),Bn(this,"cameraService",O1,this),Bn(this,"coordinateSystemService",R1,this),Bn(this,"rendererService",k1,this),Bn(this,"mapService",L1,this)}return(0,Mt.Z)(e,[{key:"apply",value:function(r){var n=this,a=this.mapService.version,s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],p=[0,0];r.hooks.beforeRender.tap("ShaderUniformPlugin",function(){n.coordinateSystemService.refresh(),a==="GAODE2.x"&&(s=n.mapService.map.customCoords.getMVPMatrix(),p=n.mapService.getCustomCoordCenter());var v=n.rendererService.getViewportSize(),g=v.width,x=v.height;r.models.forEach(function(C){var T;C.addUniforms((T={},(0,A.Z)(T,Lh.ProjectionMatrix,n.cameraService.getProjectionMatrix()),(0,A.Z)(T,Lh.ViewMatrix,n.cameraService.getViewMatrix()),(0,A.Z)(T,Lh.ViewProjectionMatrix,n.cameraService.getViewProjectionMatrix()),(0,A.Z)(T,Lh.Zoom,n.cameraService.getZoom()),(0,A.Z)(T,Lh.ZoomScale,n.cameraService.getZoomScale()),(0,A.Z)(T,Lh.FocalDistance,n.cameraService.getFocalDistance()),(0,A.Z)(T,Lh.CameraPosition,n.cameraService.getCameraPosition()),(0,A.Z)(T,xc.CoordinateSystem,n.coordinateSystemService.getCoordinateSystem()),(0,A.Z)(T,xc.ViewportCenter,n.coordinateSystemService.getViewportCenter()),(0,A.Z)(T,xc.ViewportCenterProjection,n.coordinateSystemService.getViewportCenterProjection()),(0,A.Z)(T,xc.PixelsPerDegree,n.coordinateSystemService.getPixelsPerDegree()),(0,A.Z)(T,xc.PixelsPerDegree2,n.coordinateSystemService.getPixelsPerDegree2()),(0,A.Z)(T,xc.PixelsPerMeter,n.coordinateSystemService.getPixelsPerMeter()),(0,A.Z)(T,xc.Mvp,s),(0,A.Z)(T,"u_SceneCenterMKT",p),(0,A.Z)(T,"u_ViewportSize",[g,x]),(0,A.Z)(T,"u_ModelMatrix",n.cameraService.getModelMatrix()),(0,A.Z)(T,"u_DevicePixelRatio",ca.devicePixelRatio),(0,A.Z)(T,"u_PickingBuffer",r.getLayerConfig().pickingBuffer||0),(0,A.Z)(T,"u_shaderPick",Number(r.getShaderPickStat())),T))})})}}]),e}(),O1=ai(Cd.prototype,"cameraService",[w1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R1=ai(Cd.prototype,"coordinateSystemService",[T1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k1=ai(Cd.prototype,"rendererService",[M1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L1=ai(Cd.prototype,"mapService",[P1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cd))||I1),D1,F1,NM=(D1=(0,Xr.b2)(),D1(F1=function(){function e(){(0,dt.Z)(this,e)}return(0,Mt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("UpdateModelPlugin",function(){r.layerModel&&r.layerModel.needUpdate()})}}]),e}())||F1),B1,N1,zM=(B1=(0,Xr.b2)(),B1(N1=function(){function e(){(0,dt.Z)(this,e)}return(0,Mt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("UpdateStyleAttributePlugin",function(){a.initStyleAttribute(r,{styleAttributeService:s})}),r.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){r.layerModelNeedUpdate||a.updateStyleAtrribute(r,{styleAttributeService:s})})}},{key:"updateStyleAtrribute",value:function(r,n){var a=n.styleAttributeService,s=a.getLayerStyleAttributes()||[],p=a.getLayerStyleAttribute("filter"),v=a.getLayerStyleAttribute("shape");if(p&&p.needRegenerateVertices){r.layerModelNeedUpdate=!0,s.forEach(function(g){return g.needRegenerateVertices=!1});return}s.filter(function(g){return g.needRegenerateVertices}).forEach(function(g){a.updateAttributeByFeatureRange(g.name,r.getEncodedData(),g.featureRange.startIndex,g.featureRange.endIndex),g.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(r,n){var a=n.styleAttributeService,s=a.getLayerStyleAttributes()||[];s.filter(function(p){return p.needRegenerateVertices}).forEach(function(p){a.updateAttributeByFeatureRange(p.name,r.getEncodedData(),p.featureRange.startIndex,p.featureRange.endIndex),p.needRegenerateVertices=!1})}}]),e}())||N1);Jl.bind(Gt.ILayerPlugin).to(lw).inRequestScope(),Jl.bind(Gt.ILayerPlugin).to(FM).inRequestScope(),Jl.bind(Gt.ILayerPlugin).to(SM).inRequestScope(),Jl.bind(Gt.ILayerPlugin).to(uw).inRequestScope(),Jl.bind(Gt.ILayerPlugin).to(TM).inRequestScope(),Jl.bind(Gt.ILayerPlugin).to(zM).inRequestScope(),Jl.bind(Gt.ILayerPlugin).to(NM).inRequestScope(),Jl.bind(Gt.ILayerPlugin).to(LM).inRequestScope(),Jl.bind(Gt.ILayerPlugin).to(BM).inRequestScope(),Jl.bind(Gt.ILayerPlugin).to(AM).inRequestScope(),Jl.bind(Gt.ILayerPlugin).to(kM).inRequestScope(),Jl.bind(Gt.ILayerPlugin).to(DM).inRequestScope(),Jl.bind(Gt.ILayerPlugin).to(wM).inRequestScope();var jP="2.8.34";function z1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function VP(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?z1(Object(r),!0).forEach(function(n){UM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):z1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function UM(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function GP(e,i){return GM(e)||VM(e,i)||jM(e,i)||ZM()}function ZM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function jM(e,i){if(!!e){if(typeof e=="string")return U1(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return U1(e,i)}}function U1(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function VM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,v;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function GM(e){if(Array.isArray(e))return e}var HP=null,WP=null,Z1,om,j1;function V1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function G1(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?V1(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):V1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var HM=(Z1=Pv(Gt.IGlobalConfigService),om=function(){function e(i){(0,dt.Z)(this,e),Bn(this,"configService",j1,this),(0,A.Z)(this,"config",void 0),this.config=i}return(0,Mt.Z)(e,[{key:"setContainer",value:function(r,n,a,s){r.bind(Gt.MapConfig).toConstantValue(G1(G1({},this.config),{},{id:n,canvas:a,hasBaseMap:s})),r.bind(Gt.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),j1=ai(om.prototype,"configService",[Z1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),om),WM=Q(6158),v0=Q.n(WM);function m0(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function cv(e,i){var r=ln([],i,e);return Ze(r,r,1/r[3]),r}function XP(e,i){var r=e%i;return r<0?i+r:r}function YP(e,i,r){return r*i+(1-r)*e}function Gh(e,i){if(!e)throw new Error(i||"viewport-mercator-project: assertion failed.")}var cf=Math.PI,H1=cf/4,Cp=cf/180,W1=180/cf,sm=512,um=4003e4,XM=1.5;function X1(e){return Math.pow(2,e)}function YM(e){return Math.log2(e)}function fv(e,i){var r=(0,gn.Z)(e,2),n=r[0],a=r[1];Gh(Number.isFinite(n)&&Number.isFinite(i)),Gh(Number.isFinite(a)&&a>=-90&&a<=90,"invalid latitude"),i*=sm;var s=n*Cp,p=a*Cp,v=i*(s+cf)/(2*cf),g=i*(cf-Math.log(Math.tan(H1+p*.5)))/(2*cf);return[v,g]}function lm(e,i){var r=(0,gn.Z)(e,2),n=r[0],a=r[1];i*=sm;var s=n/i*(2*cf)-cf,p=2*(Math.atan(Math.exp(cf-a/i*(2*cf)))-H1);return[s*W1,p*W1]}function qP(e){var i=e.latitude;assert(Number.isFinite(i));var r=Math.cos(i*Cp);return YM(um*r)-9}function Y1(e){var i=e.latitude,r=e.longitude,n=e.zoom,a=e.scale,s=e.highPrecision,p=s===void 0?!1:s;a=a!==void 0?a:X1(n),Gh(Number.isFinite(i)&&Number.isFinite(r)&&Number.isFinite(a));var v={},g=sm*a,x=Math.cos(i*Cp),C=g/360,T=C/x,R=g/um/x;if(v.pixelsPerMeter=[R,-R,R],v.metersPerPixel=[1/R,-1/R,1/R],v.pixelsPerDegree=[C,-T,R],v.degreesPerPixel=[1/C,-1/T,1/R],p){var F=Cp*Math.tan(i*Cp)/x,j=C*F/2,Y=g/um*F,J=Y/T*R;v.pixelsPerDegree2=[0,-j,Y],v.pixelsPerMeter2=[J,0,J]}return v}function KP(e,i){var r=_slicedToArray(e,3),n=r[0],a=r[1],s=r[2],p=_slicedToArray(i,3),v=p[0],g=p[1],x=p[2],C=1,T=Y1({longitude:n,latitude:a,scale:C,highPrecision:!0}),R=T.pixelsPerMeter,F=T.pixelsPerMeter2,j=fv(e,C);j[0]+=v*(R[0]+F[0]*g),j[1]+=g*(R[1]+F[1]*g);var Y=lm(j,C),J=(s||0)+(x||0);return Number.isFinite(s)||Number.isFinite(x)?[Y[0],Y[1],J]:Y}function qM(e){var i=e.height,r=e.pitch,n=e.bearing,a=e.altitude,s=e.center,p=s===void 0?null:s,v=e.flipY,g=v===void 0?!1:v,x=m0();return sp(x,x,[0,0,-a]),Xl(x,x,[1,1,1/i]),up(x,x,-r*Cp),ba(x,x,n*Cp),g&&Xl(x,x,[1,-1,1]),p&&sp(x,x,Xa.negate([],p)),x}function KM(e){var i=e.width,r=e.height,n=e.altitude,a=n===void 0?XM:n,s=e.pitch,p=s===void 0?0:s,v=e.nearZMultiplier,g=v===void 0?1:v,x=e.farZMultiplier,C=x===void 0?1:x,T=p*Cp,R=Math.atan(.5/a),F=Math.sin(R)*a/Math.sin(Math.PI/2-T-R),j=Math.cos(Math.PI/2-T)*F+a;return{fov:2*Math.atan(r/2/a),aspect:i/r,focalDistance:a,near:g,far:j*C}}function $M(e){var i=e.width,r=e.height,n=e.pitch,a=e.altitude,s=e.nearZMultiplier,p=e.farZMultiplier,v=KM({width:i,height:r,altitude:a,pitch:n,nearZMultiplier:s,farZMultiplier:p}),g=v.fov,x=v.aspect,C=v.near,T=v.far,R=wr([],g,x,C,T);return R}function QM(e,i){var r=(0,gn.Z)(e,3),n=r[0],a=r[1],s=r[2],p=s===void 0?0:s;return Gh(Number.isFinite(n)&&Number.isFinite(a)&&Number.isFinite(p)),cv(i,[n,a,p,1])}function q1(e,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=(0,gn.Z)(e,3),a=n[0],s=n[1],p=n[2];if(Gh(Number.isFinite(a)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(p)){var v=cv(i,[a,s,p,1]);return v}var g=cv(i,[a,s,0,1]),x=cv(i,[a,s,1,1]),C=g[2],T=x[2],R=C===T?0:((r||0)-C)/(T-C);return xi.lerp([],g,x,R)}var K1=m0(),JM=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=i.width,n=i.height,a=i.viewMatrix,s=a===void 0?K1:a,p=i.projectionMatrix,v=p===void 0?K1:p;(0,dt.Z)(this,e),this.width=r||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=s,this.projectionMatrix=v;var g=m0();Sl(g,g,this.projectionMatrix),Sl(g,g,this.viewMatrix),this.viewProjectionMatrix=g;var x=m0();Xl(x,x,[this.width/2,-this.height/2,1]),sp(x,x,[1,-1,0]),Sl(x,x,this.viewProjectionMatrix);var C=zp(m0(),x);if(!C)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=x,this.pixelUnprojectionMatrix=C,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,Mt.Z)(e,[{key:"equals",value:function(r){return r instanceof e?r.width===this.width&&r.height===this.height&&Vr(r.projectionMatrix,this.projectionMatrix)&&Vr(r.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=n.topLeft,s=a===void 0?!0:a,p=this.projectPosition(r),v=QM(p,this.pixelProjectionMatrix),g=(0,gn.Z)(v,2),x=g[0],C=g[1],T=s?C:this.height-C;return r.length===2?[x,T]:[x,T,v[2]]}},{key:"unproject",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=n.topLeft,s=a===void 0?!0:a,p=n.targetZ,v=(0,gn.Z)(r,3),g=v[0],x=v[1],C=v[2],T=s?x:this.height-x,R=p&&p*this.pixelsPerMeter,F=q1([g,T,C],this.pixelUnprojectionMatrix,R),j=this.unprojectPosition(F),Y=(0,gn.Z)(j,3),J=Y[0],be=Y[1],Be=Y[2];return Number.isFinite(C)?[J,be,Be]:Number.isFinite(p)?[J,be,p]:[J,be]}},{key:"projectPosition",value:function(r){var n=this.projectFlat(r),a=(0,gn.Z)(n,2),s=a[0],p=a[1],v=(r[2]||0)*this.pixelsPerMeter;return[s,p,v]}},{key:"unprojectPosition",value:function(r){var n=this.unprojectFlat(r),a=(0,gn.Z)(n,2),s=a[0],p=a[1],v=(r[2]||0)/this.pixelsPerMeter;return[s,p,v]}},{key:"projectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}},{key:"unprojectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}}]),e}();function e5(e){var i=e.width,r=e.height,n=e.bounds,a=e.minExtent,s=a===void 0?0:a,p=e.maxZoom,v=p===void 0?24:p,g=e.padding,x=g===void 0?0:g,C=e.offset,T=C===void 0?[0,0]:C,R=(0,gn.Z)(n,2),F=(0,gn.Z)(R[0],2),j=F[0],Y=F[1],J=(0,gn.Z)(R[1],2),be=J[0],Be=J[1];if(Number.isFinite(x)){var Ye=x;x={top:Ye,bottom:Ye,left:Ye,right:Ye}}else Gh(Number.isFinite(x.top)&&Number.isFinite(x.bottom)&&Number.isFinite(x.left)&&Number.isFinite(x.right));var tt=new $1({width:i,height:r,longitude:0,latitude:0,zoom:0}),Et=tt.project([j,Be]),wt=tt.project([be,Y]),Yt=[Math.max(Math.abs(wt[0]-Et[0]),s),Math.max(Math.abs(wt[1]-Et[1]),s)],ar=[i-x.left-x.right-Math.abs(T[0])*2,r-x.top-x.bottom-Math.abs(T[1])*2];Gh(ar[0]>0&&ar[1]>0);var Mr=ar[0]/Yt[0],Qr=ar[1]/Yt[1],br=(x.right-x.left)/2/Mr,vn=(x.bottom-x.top)/2/Qr,Pn=[(wt[0]+Et[0])/2+br,(wt[1]+Et[1])/2+vn],$n=tt.unproject(Pn),Ba=tt.zoom+Math.log2(Math.abs(Math.min(Mr,Qr)));return{longitude:$n[0],latitude:$n[1],zoom:Math.min(Ba,v)}}var $1=function(e){(0,Pr.Z)(i,e);function i(){var r,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=n.width,s=n.height,p=n.latitude,v=p===void 0?0:p,g=n.longitude,x=g===void 0?0:g,C=n.zoom,T=C===void 0?0:C,R=n.pitch,F=R===void 0?0:R,j=n.bearing,Y=j===void 0?0:j,J=n.altitude,be=J===void 0?1.5:J,Be=n.nearZMultiplier,Ye=n.farZMultiplier;(0,dt.Z)(this,i),a=a||1,s=s||1;var tt=X1(T);be=Math.max(.75,be);var Et=fv([x,v],tt);Et[2]=0;var wt=$M({width:a,height:s,pitch:F,bearing:Y,altitude:be,nearZMultiplier:Be||1/s,farZMultiplier:Ye||1.01}),Yt=qM({height:s,center:Et,pitch:F,bearing:Y,altitude:be,flipY:!0});return r=(0,on.Z)(this,(0,gt.Z)(i).call(this,{width:a,height:s,viewMatrix:Yt,projectionMatrix:wt})),r.latitude=v,r.longitude=x,r.zoom=T,r.pitch=F,r.bearing=Y,r.altitude=be,r.scale=tt,r.center=Et,r.pixelsPerMeter=Y1((0,ue.Z)((0,ue.Z)(r))).pixelsPerMeter[2],Object.freeze((0,ue.Z)((0,ue.Z)(r))),r}return(0,Mt.Z)(i,[{key:"projectFlat",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return fv(n,a)}},{key:"unprojectFlat",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return lm(n,a)}},{key:"getMapCenterByLngLatPosition",value:function(n){var a=n.lngLat,s=n.pos,p=q1(s,this.pixelUnprojectionMatrix),v=fv(a,this.scale),g=xi.add([],v,xi.negate([],p)),x=xi.add([],this.center,g);return lm(x,this.scale)}},{key:"getLocationAtPoint",value:function(n){var a=n.lngLat,s=n.pos;return this.getMapCenterByLngLatPosition({lngLat:a,pos:s})}},{key:"fitBounds",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=this.width,p=this.height,v=e5(Object.assign({width:s,height:p,bounds:n},a)),g=v.longitude,x=v.latitude,C=v.zoom;return new i({width:s,height:p,longitude:g,latitude:x,zoom:C})}}]),i}(JM),t5=function(){function e(){(0,dt.Z)(this,e),(0,A.Z)(this,"viewport",void 0)}return(0,Mt.Z)(e,[{key:"syncWithMapCamera",value:function(r){var n=r.center,a=r.zoom,s=r.pitch,p=r.bearing,v=r.viewportHeight,g=r.viewportWidth;this.viewport=new $1({width:g,height:v,longitude:n&&n[0],latitude:n&&n[1],zoom:a,pitch:s,bearing:p})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}}]),e}(),r5=function(){function e(i){(0,dt.Z)(this,e),(0,A.Z)(this,"size",1e4),this.size=i||1e4}return(0,Mt.Z)(e,[{key:"setSize",value:function(r){this.size=r}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(r){return(180+r)/360*this.size}},{key:"mercatorYfromLat",value:function(r){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(r){return r/this.size*360-180}},{key:"latFromMercatorY",value:function(r){var n=180-(1-r/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90}},{key:"project",value:function(r){var n=this.mercatorXfromLng(r[0]),a=this.mercatorYfromLat(r[1]);return[n,a]}},{key:"unproject",value:function(r){var n=this.lngFromMercatorX(r[0]),a=this.latFromMercatorY(r[1]);return[n,a]}}]),e}(),Q1={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},n5=["id","attributionControl","style","token","rotation","mapInstance"],J1,ex,tx,rx,nx,ix,Ad,ax,ox,sx,ux;function lx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function i5(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?lx(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):lx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function a5(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var p=i.createElement("style");return p.type="text/css",p.styleSheet?p.styleSheet.cssText=e:p.appendChild(i.createTextNode(e)),a.appendChild(p),p}}a5(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=v0();var cx={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},o5=0,s5=12,fx="pk.eyJ1IjoibHp4dWUiLCJhIjoiY2tvaWZuM2s4MWZuYjJ1dHI5ZGduYTlrdiJ9.DQCfMRbZzx0VSwecQ69McA",u5=(J1=(0,Xr.b2)(),ex=(0,Xr.f3)(Gt.MapConfig),tx=(0,Xr.f3)(Gt.IGlobalConfigService),rx=(0,Xr.f3)(Gt.ICoordinateSystemService),nx=(0,Xr.f3)(Gt.IEventEmitter),J1(ix=(Ad=function(){function e(){var i=this;(0,dt.Z)(this,e),(0,A.Z)(this,"version",Rs.MAPBOX),(0,A.Z)(this,"map",void 0),(0,A.Z)(this,"simpleMapCoord",new r5),(0,A.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),Bn(this,"config",ax,this),Bn(this,"configService",ox,this),Bn(this,"coordinateSystemService",sx,this),Bn(this,"eventEmitter",ux,this),(0,A.Z)(this,"viewport",void 0),(0,A.Z)(this,"markerContainer",void 0),(0,A.Z)(this,"cameraChangedCallback",void 0),(0,A.Z)(this,"$mapContainer",void 0),(0,A.Z)(this,"handleCameraChanged",function(){var r=i.map.getCenter().wrap(),n=r.lat,a=r.lng;i.emit("mapchange"),i.viewport.syncWithMapCamera({bearing:i.map.getBearing(),center:[a,n],viewportHeight:i.map.transform.height,pitch:i.map.getPitch(),viewportWidth:i.map.transform.width,zoom:i.map.getZoom(),cameraHeight:0});var s=i.config.offsetZoom,p=s===void 0?s5:s;i.viewport.getZoom()>p?i.coordinateSystemService.setCoordinateSystem(Kl.LNGLAT_OFFSET):i.coordinateSystemService.setCoordinateSystem(Kl.LNGLAT),i.cameraChangedCallback(i.viewport)})}return(0,Mt.Z)(e,[{key:"setBgColor",value:function(r){this.bgColor=r}},{key:"addMarkerContainer",value:function(){var r=this.map.getCanvasContainer();this.markerContainer=Za("div","l7-marker-container",r),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(r,n){Yb.indexOf(r)!==-1?this.eventEmitter.on(r,n):this.map.on(cx[r]||r,n)}},{key:"off",value:function(r,n){this.map.off(cx[r]||r,n),this.eventEmitter.off(r,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var r=this.map.transform;return[r.width,r.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(r){return this.map.setZoom(r)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(r){this.map.setCenter(r)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(r){this.map.setBearing(r)}},{key:"zoomIn",value:function(r,n){this.map.zoomIn(r,n)}},{key:"zoomOut",value:function(r,n){this.map.zoomOut(r,n)}},{key:"setPitch",value:function(r){return this.map.setPitch(r)}},{key:"panTo",value:function(r){this.map.panTo(r)}},{key:"panBy",value:function(r,n){this.panTo([r,n])}},{key:"fitBounds",value:function(r,n){this.map.fitBounds(r,n)}},{key:"setMaxZoom",value:function(r){this.map.setMaxZoom(r)}},{key:"setMinZoom",value:function(r){this.map.setMinZoom(r)}},{key:"setMapStatus",value:function(r){r.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),r.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),r.dragEnable===!1&&this.map.dragPan.disable(),r.dragEnable===!0&&this.map.dragPan.enable(),r.rotateEnable===!1&&this.map.dragRotate.disable(),r.rotateEnable===!0&&this.map.dragRotate.enable(),r.keyboardEnable===!1&&this.map.keyboard.disable(),r.keyboardEnable===!0&&this.map.keyboard.enable(),r.zoomEnable===!1&&this.map.scrollZoom.disable(),r.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(r,n){this.map.flyTo({zoom:r,center:n})}},{key:"setMapStyle",value:function(r){this.map.setStyle(this.getMapStyle(r))}},{key:"pixelToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToPixel",value:function(r){return this.map.project(r)}},{key:"containerToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToContainer",value:function(r){return this.map.project(r)}},{key:"lngLatToCoord",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},a=this.lngLatToMercator(r,0),s=a.x,p=a.y;return[s-n.x,p-n.y]}},{key:"lngLatToMercator",value:function(r,n){var a=window.mapboxgl.MercatorCoordinate.fromLngLat(r,n),s=a.x,p=s===void 0?0:s,v=a.y,g=v===void 0?0:v,x=a.z,C=x===void 0?0:x;return{x:p,y:g,z:C}}},{key:"getModelMatrix",value:function(r,n,a){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],p=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},v=window.mapboxgl.MercatorCoordinate.fromLngLat(r,n),g=v.meterInMercatorCoordinateUnits(),x=Yi();return sp(x,x,Xa.fromValues(v.x-p.x,v.y-p.y,v.z||0-p.z)),Xl(x,x,Xa.fromValues(g*s[0],-g*s[1],g*s[2])),up(x,x,a[0]),rf(x,x,a[1]),ba(x,x,a[2]),x}},{key:"init",value:function(){var i=(0,Z.Z)(q().mark(function n(){var a,s,p,v,g,x,C,T,R,F,j,Y,J;return q().wrap(function(Be){for(;;)switch(Be.prev=Be.next){case 0:a=this.config,s=a.id,p=s===void 0?"map":s,v=a.attributionControl,g=v===void 0?!1:v,x=a.style,C=x===void 0?"light":x,T=a.token,R=T===void 0?fx:T,F=a.rotation,j=F===void 0?0:F,Y=a.mapInstance,J=(0,to.Z)(a,n5),this.viewport=new t5,!Y&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),R===fx&&C!=="blank"&&!window.mapboxgl.accessToken&&!Y&&console.warn(this.configService.getSceneWarninfo("MapToken")),!Y&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=R),Y?(this.map=Y,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(p),this.map=new window.mapboxgl.Map(i5({container:this.$mapContainer,style:this.getMapStyle(C),attributionControl:g,bearing:j},J))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return Be.stop()}},n,this)}));function r(){return i.apply(this,arguments)}return r}()},{key:"destroy",value:function(){var r,n;(r=this.$mapContainer)===null||r===void 0||(n=r.parentNode)===null||n===void 0||n.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(r){for(var n,a=arguments.length,s=new Array(a>1?a-1:0),p=1;p<a;p++)s[p-1]=arguments[p];(n=this.eventEmitter).emit.apply(n,[r].concat(s))}},{key:"once",value:function(r){for(var n,a=arguments.length,s=new Array(a>1?a-1:0),p=1;p<a;p++)s[p-1]=arguments[p];(n=this.eventEmitter).once.apply(n,[r].concat(s))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(r,n){var a=new(v0()).LngLat(r[0],r[1]),s=new(v0()).LngLat(n[0],n[1]),p=a.distanceTo(s),v=v0().MercatorCoordinate.fromLngLat({lng:r[0],lat:r[1]}),g=v0().MercatorCoordinate.fromLngLat({lng:n[0],lat:n[1]}),x=v.x,C=v.y,T=g.x,R=g.y,F=Math.sqrt(Math.pow(x-T,2)+Math.pow(C-R,2))*4194304*2;return F/p}},{key:"exportMap",value:function(r){var n=this.map.getCanvas(),a=r==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return a}},{key:"onCameraChanged",value:function(r){this.cameraChangedCallback=r}},{key:"creatAmapContainer",value:function(r){var n=r;typeof r=="string"&&(n=document.getElementById(r));var a=document.createElement("div");return a.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,a.id="l7_mapbox_div"+o5++,n.appendChild(a),a}},{key:"getMapStyle",value:function(r){return typeof r!="string"?r:Q1[r]?Q1[r]:r}}]),e}(),ax=ai(Ad.prototype,"config",[ex],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ox=ai(Ad.prototype,"configService",[tx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sx=ai(Ad.prototype,"coordinateSystemService",[rx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ux=ai(Ad.prototype,"eventEmitter",[nx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ad))||ix);function l5(e){var i=c5();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function c5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function f5(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var p=i.createElement("style");return p.type="text/css",p.styleSheet?p.styleSheet.cssText=e:p.appendChild(i.createTextNode(e)),a.appendChild(p),p}}f5(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var p5=function(e){(0,Pr.Z)(r,e);var i=l5(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,Mt.Z)(r,[{key:"getServiceConstructor",value:function(){return u5}}]),r}(HM);function px(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function hx(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?px(Object(r),!0).forEach(function(n){h5(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):px(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function h5(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function d5(e,i){return y5(e)||g5(e,i)||m5(e,i)||v5()}function v5(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function m5(e,i){if(!!e){if(typeof e=="string")return dx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return dx(e,i)}}function dx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function g5(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,v;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function y5(e){if(Array.isArray(e))return e}var _5=me.memo(function(e){var i=e.style,r=e.className,n=e.map,a=e.option,s=e.onSceneLoaded,p=(0,me.createRef)(),v=(0,me.useState)(),g=d5(v,2),x=g[0],C=g[1];return(0,me.useEffect)(function(){var T=new CE(hx(hx({id:p.current},a),{},{map:new p5(n)}));return T.on("loaded",function(){C(T),s&&s(T)}),function(){T.destroy()}},[]),(0,me.useEffect)(function(){x&&n.style&&x.setMapStyle(n.style)},[JSON.stringify(n.style)]),(0,me.useEffect)(function(){x&&n.zoom&&x.setZoom(n.zoom)},[n.zoom]),(0,me.useEffect)(function(){x&&n.center&&x.setCenter(n.center)},[JSON.stringify(n.center)]),(0,me.useEffect)(function(){x&&n.pitch!==void 0&&x.setPitch(n.pitch||0)},[n.pitch]),(0,me.useEffect)(function(){x&&n.rotation&&x.setRotation(n.rotation)},[n.rotation]),me.createElement(m.Provider,{value:x},(0,me.createElement)("div",{ref:p,style:i,className:r},x&&e.children))}),x5=_5;function vx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function $P(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?vx(Object(r),!0).forEach(function(n){b5(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):vx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function b5(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function QP(e,i){return A5(e)||C5(e,i)||S5(e,i)||E5()}function E5(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function S5(e,i){if(!!e){if(typeof e=="string")return mx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return mx(e,i)}}function mx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function C5(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,v;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function A5(e){if(Array.isArray(e))return e}var JP=null,eI=null;function gx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function tI(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?gx(Object(r),!0).forEach(function(n){w5(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function w5(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function rI(e,i){return I5(e)||P5(e,i)||M5(e,i)||T5()}function T5(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function M5(e,i){if(!!e){if(typeof e=="string")return yx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return yx(e,i)}}function yx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function P5(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,v;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function I5(e){if(Array.isArray(e))return e}var nI=null,iI=null;function aI(e,i){return L5(e)||k5(e,i)||R5(e,i)||O5()}function O5(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function R5(e,i){if(!!e){if(typeof e=="string")return _x(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _x(e,i)}}function _x(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function k5(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,v;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function L5(e){if(Array.isArray(e))return e}var oI=null,sI=null;function xx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function uI(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?xx(Object(r),!0).forEach(function(n){D5(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function D5(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function lI(e,i){if(e==null)return{};var r=F5(e,i),n,a;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function F5(e,i){if(e==null)return{};var r={},n=Object.keys(e),a,s;for(s=0;s<n.length;s++)a=n[s],!(i.indexOf(a)>=0)&&(r[a]=e[a]);return r}var cI=null,bx=Q(73935);function Ex(e,i){return U5(e)||z5(e,i)||N5(e,i)||B5()}function B5(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function N5(e,i){if(!!e){if(typeof e=="string")return Sx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Sx(e,i)}}function Sx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function z5(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,v;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function U5(e){if(Array.isArray(e))return e}var Cx=me.useEffect,Ax=me.useState,Z5=/\B([A-Z])/g,j5=function(i){return i.replace(Z5,"-$1").toLowerCase()};function fI(e){var i=e.className,r=e.style,n=e.children,a=e.position,s=Ax(),p=Ex(s,2),v=p[0],g=p[1],x=useSceneValue(),C=Ax(function(){return document.createElement("div")}),T=Ex(C,1),R=T[0];return Cx(function(){var F=new Control({position:a});return F.onAdd=function(){if(i&&(R.className=i),r){var j=Object.keys(r).map(function(Y){return"".concat(j5(Y),":").concat(r[Y])}).join(";");R.style.cssText=j}return R},F.onRemove=function(){},g(F),x.addControl(F),function(){x.removeControl(F)}},[]),Cx(function(){v&&v.setPosition(a||"bottomleft")},[a]),createPortal(n,R)}var Tx=(0,me.createContext)({});function pI(){return useContext(Tx)}var Uf=Q(96486),hI=me.useEffect,V5=me.memo(function(i){var r=i.layer,n=i.active;return r.active(n.option),null},Uf.isEqual),dI=me.useEffect,G5=me.memo(function(i){var r=i.layer,n=i.animate;return r.animate(n),null},Uf.isEqual),vI=me.useEffect,H5=me.memo(function(i){var r=i.layer,n=i.color;return n.field?r.color(n.field,n.values):r.color(n.values),null},Uf.isEqual),W5=me.memo(function(i){var r=i.layer,n=i.filter;return n.field&&r.filter(n.field,n.values),null},Uf.isEqual),X5=me.memo(function(i){var r=i.layer,n=i.scale;return r.scale(n.values),null},Uf.isEqual),mI=me.useEffect,Y5=me.memo(function(i){var r=i.layer,n=i.select;return r.select(n.option),null},Uf.isEqual),q5=me.memo(function(i){var r=i.layer,n=i.shape;return n.field?r.shape(n.field,n.values):r.shape(n.values),null},Uf.isEqual),K5=me.memo(function(i){var r=i.layer,n=i.size;return n.field?r.size(n.field,n.values):r.size(n.values),null},Uf.isEqual),$5=["data"];function Q5(e,i){if(e==null)return{};var r=J5(e,i),n,a;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function J5(e,i){if(e==null)return{};var r={},n=Object.keys(e),a,s;for(s=0;s<n.length;s++)a=n[s],!(i.indexOf(a)>=0)&&(r[a]=e[a]);return r}var e3=me.memo(function(i){var r=i.layer,n=i.source,a=n.data,s=Q5(n,$5);return r.inited?r.setData(a,s):r.source(a,s),s.autoFit&&r.fitBounds(s&&s.fitBoundsOptions),null},Uf.isEqual),gI=me.useEffect,t3=me.memo(function(i){var r=i.layer,n=i.style;return r.style(n),null},Uf.isEqual);function r3(e,i){return o3(e)||a3(e,i)||i3(e,i)||n3()}function n3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function i3(e,i){if(!!e){if(typeof e=="string")return Mx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Mx(e,i)}}function Mx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function a3(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,v;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function o3(e){if(Array.isArray(e))return e}var g0=me.useEffect,s3=me.useState;function Px(e,i){var r=i.source,n=i.color,a=i.shape,s=i.style,p=i.size,v=i.scale,g=i.active,x=i.select,C=i.filter,T=i.animate,R=i.options,F=i.onLayerLoaded,j=Re(),Y=s3(function(){var Be;switch(e){case"polygonLayer":Be=new Py(R);break;case"lineLayer":Be=new _C(R);break;case"pointLayer":Be=new bA(R);break;case"heatmapLayer":Be=new sS(R);break;case"rasterLayer":Be=new ow(R);break;case"imageLayer":Be=new gS(R);break;case"citybuildingLayer":Be=new RE(R);break;default:Be=new Py(R)}return Be.on("inited",function(){F&&F(Be,j)}),Be}),J=r3(Y,1),be=J[0];return g0(function(){return j.addLayer(be),function(){j.removeLayer(be)}},[]),g0(function(){be.inited&&R&&be.updateLayerConfig(R)},[R==null?void 0:R.minZoom,R==null?void 0:R.maxZoom,R==null?void 0:R.visible]),g0(function(){be.inited&&(R==null?void 0:R.zIndex)&&be.setIndex(R.zIndex)},[R==null?void 0:R.zIndex]),g0(function(){be.inited&&(R==null?void 0:R.blend)&&be.setBlend(R.blend)},[R==null?void 0:R.blend]),g0(function(){j.render()}),me.createElement(Tx.Provider,{value:be},me.createElement(e3,{layer:be,source:r}),v&&me.createElement(X5,{layer:be,scale:v}),n&&me.createElement(H5,{layer:be,color:n}),p&&me.createElement(K5,{layer:be,size:p}),a&&me.createElement(q5,{layer:be,shape:a}),s&&me.createElement(t3,{layer:be,style:s}),g&&me.createElement(V5,{layer:be,active:g}),x&&me.createElement(Y5,{layer:be,select:x}),C&&me.createElement(W5,{layer:be,filter:C}),T&&me.createElement(G5,{layer:be,animate:T}),i.children)}var yI=null,_I=null,u3=me.memo(function(i){return Px("pointLayer",i)}),l3=me.memo(function(i){return Px("heatmapLayer",i)}),xI=null,bI=null,EI=null,SI=me.useEffect,CI=null,AI=null;function pv(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?pv=function(r){return typeof r}:pv=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},pv(e)}function Ix(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function hv(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Ix(Object(r),!0).forEach(function(n){c3(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ix(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function c3(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function f3(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function Ox(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function p3(e,i,r){return i&&Ox(e.prototype,i),r&&Ox(e,r),e}function h3(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&cm(e,i)}function cm(e,i){return cm=Object.setPrototypeOf||function(n,a){return n.__proto__=a,n},cm(e,i)}function d3(e){var i=g3();return function(){var n=dv(e),a;if(i){var s=dv(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return v3(this,a)}}function v3(e,i){if(i&&(pv(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return m3(e)}function m3(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function dv(e){return dv=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},dv(e)}var wI=function(e){h3(r,e);var i=d3(r);function r(n){var a;return f3(this,r),a=i.call(this,n),a.el=void 0,a.scene=void 0,a.popup=void 0,a.el=document.createElement("div"),a}return p3(r,[{key:"componentDidMount",value:function(){var a,s=this.props,p=s.lnglat,v=s.children,g=s.option,x=s.lngLat,C=new vg(hv(hv({},g),{},{stopPropagation:(a=this.props.option)===null||a===void 0?void 0:a.stopPropagation}));p&&C.setLnglat(p),x&&C.setLnglat(x),v&&C.setDOMContent(this.el),this.popup=C,this.scene.addPopup(C)}},{key:"componentDidUpdate",value:function(a){var s,p,v,g,x,C,T=Array.isArray(a.lnglat)?a.lnglat:[a==null||(s=a.lnglat)===null||s===void 0?void 0:s.lng,a==null||(p=a.lnglat)===null||p===void 0?void 0:p.lat],R=Array.isArray(this.props.lnglat)?this.props.lnglat:[(v=this.props)===null||v===void 0||(g=v.lnglat)===null||g===void 0?void 0:g.lng,(x=this.props)===null||x===void 0||(C=x.lnglat)===null||C===void 0?void 0:C.lat],F=T.toString()!==R.toString();if(F){var j;this.popup.remove(),this.popup=new vg(hv(hv({},this.props.option),{},{stopPropagation:(j=this.props.option)===null||j===void 0?void 0:j.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var a=this;return me.createElement(m.Consumer,{},function(s){return s&&(a.scene=s),(0,bx.createPortal)(a.props.children,a.el)})}}]),r}(me.PureComponent);function vv(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?vv=function(r){return typeof r}:vv=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},vv(e)}function y3(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function Rx(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _3(e,i,r){return i&&Rx(e.prototype,i),r&&Rx(e,r),e}function x3(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&fm(e,i)}function fm(e,i){return fm=Object.setPrototypeOf||function(n,a){return n.__proto__=a,n},fm(e,i)}function b3(e){var i=C3();return function(){var n=mv(e),a;if(i){var s=mv(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return E3(this,a)}}function E3(e,i){if(i&&(vv(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return S3(e)}function S3(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function C3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function mv(e){return mv=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},mv(e)}var TI=function(e){x3(r,e);var i=b3(r);function r(n){var a;return y3(this,r),a=i.call(this,n),a.el=void 0,a.scene=void 0,a.marker=void 0,a.el=document.createElement("div"),a}return _3(r,[{key:"componentDidMount",value:function(){var a=this.props,s=a.lnglat,p=a.children,v=a.option,g=a.onMarkerLoaded,x=new cg(v);s&&x.setLnglat(s),p&&x.setElement(this.el),this.marker=x,g&&g(x),this.scene.addMarker(x)}},{key:"componentDidUpdate",value:function(a){var s,p=(a==null?void 0:a.lnglat.toString())!==((s=this.props)===null||s===void 0?void 0:s.lnglat.toString());p&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var a=this;return me.createElement(m.Consumer,{},function(s){return s&&(a.scene=s),(0,bx.createPortal)(a.props.children,a.el)})}}]),r}(me.PureComponent),MI=me.useEffect,PI=null,II=null,OI=me.useEffect,RI=null},31795:function(Er,re,Q){var Ce=Q(75752);Er.exports.geometry=me,Er.exports.ring=Re;function me(pe){var de=0,ze;switch(pe.type){case"Polygon":return m(pe.coordinates);case"MultiPolygon":for(ze=0;ze<pe.coordinates.length;ze++)de+=m(pe.coordinates[ze]);return de;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(ze=0;ze<pe.geometries.length;ze++)de+=me(pe.geometries[ze]);return de}}function m(pe){var de=0;if(pe&&pe.length>0){de+=Math.abs(Re(pe[0]));for(var ze=1;ze<pe.length;ze++)de-=Math.abs(Re(pe[ze]))}return de}function Re(pe){var de,ze,_e,et,mt,Ct,Bt,or=0,At=pe.length;if(At>2){for(Bt=0;Bt<At;Bt++)Bt===At-2?(et=At-2,mt=At-1,Ct=0):Bt===At-1?(et=At-1,mt=0,Ct=1):(et=Bt,mt=Bt+1,Ct=Bt+2),de=pe[et],ze=pe[mt],_e=pe[Ct],or+=(W(_e[0])-W(de[0]))*Math.sin(W(ze[1]));or=or*Ce.RADIUS*Ce.RADIUS/2}return or}function W(pe){return pe*Math.PI/180}},38163:function(Er,re,Q){var Ce=Q(31795);Er.exports=me;function me(ze,_e){switch(ze&&ze.type||null){case"FeatureCollection":return ze.features=ze.features.map(m(me,_e)),ze;case"GeometryCollection":return ze.geometries=ze.geometries.map(m(me,_e)),ze;case"Feature":return ze.geometry=me(ze.geometry,_e),ze;case"Polygon":case"MultiPolygon":return Re(ze,_e);default:return ze}}function m(ze,_e){return function(et){return ze(et,_e)}}function Re(ze,_e){return ze.type==="Polygon"?ze.coordinates=W(ze.coordinates,_e):ze.type==="MultiPolygon"&&(ze.coordinates=ze.coordinates.map(m(W,_e))),ze}function W(ze,_e){_e=!!_e,ze[0]=pe(ze[0],_e);for(var et=1;et<ze.length;et++)ze[et]=pe(ze[et],!_e);return ze}function pe(ze,_e){return de(ze)===_e?ze:ze.reverse()}function de(ze){return Ce.ring(ze)>=0}},80638:function(){},15746:function(Er,re,Q){"use strict";var Ce=Q(21584);re.Z=Ce.Z},89032:function(Er,re,Q){"use strict";var Ce=Q(38663),me=Q.n(Ce),m=Q(6999)},99134:function(Er,re,Q){"use strict";var Ce=Q(67294),me=(0,Ce.createContext)({});re.Z=me},21584:function(Er,re,Q){"use strict";var Ce=Q(96156),me=Q(22122),m=Q(90484),Re=Q(67294),W=Q(94184),pe=Q.n(W),de=Q(99134),ze=Q(65632),_e=function(Bt,or){var At={};for(var Kt in Bt)Object.prototype.hasOwnProperty.call(Bt,Kt)&&or.indexOf(Kt)<0&&(At[Kt]=Bt[Kt]);if(Bt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var yt=0,Kt=Object.getOwnPropertySymbols(Bt);yt<Kt.length;yt++)or.indexOf(Kt[yt])<0&&Object.prototype.propertyIsEnumerable.call(Bt,Kt[yt])&&(At[Kt[yt]]=Bt[Kt[yt]]);return At};function et(Bt){return typeof Bt=="number"?"".concat(Bt," ").concat(Bt," auto"):/^\d+(\.\d+)?(px|em|rem|%)$/.test(Bt)?"0 0 ".concat(Bt):Bt}var mt=["xs","sm","md","lg","xl","xxl"],Ct=Re.forwardRef(function(Bt,or){var At,Kt=Re.useContext(ze.E_),yt=Kt.getPrefixCls,ct=Kt.direction,it=Re.useContext(de.Z),$t=it.gutter,X=it.wrap,Xt=it.supportFlexGap,at=Bt.prefixCls,qe=Bt.span,xt=Bt.order,$e=Bt.offset,Ht=Bt.push,vr=Bt.pull,Fr=Bt.className,Yr=Bt.children,A=Bt.flex,Se=Bt.style,ke=_e(Bt,["prefixCls","span","order","offset","push","pull","className","children","flex","style"]),ut=yt("col",at),ft={};mt.forEach(function(Gr){var Nn,yn={},zn=Bt[Gr];typeof zn=="number"?yn.span=zn:(0,m.Z)(zn)==="object"&&(yn=zn||{}),delete ke[Gr],ft=(0,me.Z)((0,me.Z)({},ft),(Nn={},(0,Ce.Z)(Nn,"".concat(ut,"-").concat(Gr,"-").concat(yn.span),yn.span!==void 0),(0,Ce.Z)(Nn,"".concat(ut,"-").concat(Gr,"-order-").concat(yn.order),yn.order||yn.order===0),(0,Ce.Z)(Nn,"".concat(ut,"-").concat(Gr,"-offset-").concat(yn.offset),yn.offset||yn.offset===0),(0,Ce.Z)(Nn,"".concat(ut,"-").concat(Gr,"-push-").concat(yn.push),yn.push||yn.push===0),(0,Ce.Z)(Nn,"".concat(ut,"-").concat(Gr,"-pull-").concat(yn.pull),yn.pull||yn.pull===0),(0,Ce.Z)(Nn,"".concat(ut,"-rtl"),ct==="rtl"),Nn))});var Rt=pe()(ut,(At={},(0,Ce.Z)(At,"".concat(ut,"-").concat(qe),qe!==void 0),(0,Ce.Z)(At,"".concat(ut,"-order-").concat(xt),xt),(0,Ce.Z)(At,"".concat(ut,"-offset-").concat($e),$e),(0,Ce.Z)(At,"".concat(ut,"-push-").concat(Ht),Ht),(0,Ce.Z)(At,"".concat(ut,"-pull-").concat(vr),vr),At),Fr,ft),Dt={};if($t&&$t[0]>0){var gr=$t[0]/2;Dt.paddingLeft=gr,Dt.paddingRight=gr}if($t&&$t[1]>0&&!Xt){var Yn=$t[1]/2;Dt.paddingTop=Yn,Dt.paddingBottom=Yn}return A&&(Dt.flex=et(A),X===!1&&!Dt.minWidth&&(Dt.minWidth=0)),Re.createElement("div",(0,me.Z)({},ke,{style:(0,me.Z)((0,me.Z)({},Dt),Se),className:Rt,ref:or}),Yr)});Ct.displayName="Col",re.Z=Ct},92820:function(Er,re,Q){"use strict";var Ce=Q(22122),me=Q(96156),m=Q(90484),Re=Q(28481),W=Q(67294),pe=Q(94184),de=Q.n(pe),ze=Q(65632),_e=Q(99134),et=Q(93355),mt=Q(24308),Ct=Q(98082),Bt=function(yt,ct){var it={};for(var $t in yt)Object.prototype.hasOwnProperty.call(yt,$t)&&ct.indexOf($t)<0&&(it[$t]=yt[$t]);if(yt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var X=0,$t=Object.getOwnPropertySymbols(yt);X<$t.length;X++)ct.indexOf($t[X])<0&&Object.prototype.propertyIsEnumerable.call(yt,$t[X])&&(it[$t[X]]=yt[$t[X]]);return it},or=(0,et.b)("top","middle","bottom","stretch"),At=(0,et.b)("start","end","center","space-around","space-between","space-evenly"),Kt=W.forwardRef(function(yt,ct){var it,$t=yt.prefixCls,X=yt.justify,Xt=yt.align,at=yt.className,qe=yt.style,xt=yt.children,$e=yt.gutter,Ht=$e===void 0?0:$e,vr=yt.wrap,Fr=Bt(yt,["prefixCls","justify","align","className","style","children","gutter","wrap"]),Yr=W.useContext(ze.E_),A=Yr.getPrefixCls,Se=Yr.direction,ke=W.useState({xs:!0,sm:!0,md:!0,lg:!0,xl:!0,xxl:!0}),ut=(0,Re.Z)(ke,2),ft=ut[0],Rt=ut[1],Dt=(0,Ct.Z)(),gr=W.useRef(Ht);W.useEffect(function(){var ra=mt.ZP.subscribe(function(Ya){var na=gr.current||0;(!Array.isArray(na)&&(0,m.Z)(na)==="object"||Array.isArray(na)&&((0,m.Z)(na[0])==="object"||(0,m.Z)(na[1])==="object"))&&Rt(Ya)});return function(){return mt.ZP.unsubscribe(ra)}},[]);var Yn=function(){var Ya=[0,0],na=Array.isArray(Ht)?Ht:[Ht,0];return na.forEach(function(ia,ki){if((0,m.Z)(ia)==="object")for(var qi=0;qi<mt.c4.length;qi++){var Gi=mt.c4[qi];if(ft[Gi]&&ia[Gi]!==void 0){Ya[ki]=ia[Gi];break}}else Ya[ki]=ia||0}),Ya},Gr=A("row",$t),Nn=Yn(),yn=de()(Gr,(it={},(0,me.Z)(it,"".concat(Gr,"-no-wrap"),vr===!1),(0,me.Z)(it,"".concat(Gr,"-").concat(X),X),(0,me.Z)(it,"".concat(Gr,"-").concat(Xt),Xt),(0,me.Z)(it,"".concat(Gr,"-rtl"),Se==="rtl"),it),at),zn={},si=Nn[0]>0?Nn[0]/-2:void 0,Gn=Nn[1]>0?Nn[1]/-2:void 0;if(si&&(zn.marginLeft=si,zn.marginRight=si),Dt){var fi=(0,Re.Z)(Nn,2);zn.rowGap=fi[1]}else Gn&&(zn.marginTop=Gn,zn.marginBottom=Gn);var ta=(0,Re.Z)(Nn,2),zi=ta[0],Ii=ta[1],Ki=W.useMemo(function(){return{gutter:[zi,Ii],wrap:vr,supportFlexGap:Dt}},[zi,Ii,vr,Dt]);return W.createElement(_e.Z.Provider,{value:Ki},W.createElement("div",(0,Ce.Z)({},Fr,{className:yn,style:(0,Ce.Z)((0,Ce.Z)({},zn),qe),ref:ct}),xt))});Kt.displayName="Row",re.Z=Kt},6999:function(Er,re,Q){"use strict";var Ce=Q(38663),me=Q.n(Ce),m=Q(80638),Re=Q.n(m)},71230:function(Er,re,Q){"use strict";var Ce=Q(92820);re.Z=Ce.Z},13062:function(Er,re,Q){"use strict";var Ce=Q(38663),me=Q.n(Ce),m=Q(6999)},9187:function(Er){"use strict";Er.exports=re,Er.exports.default=re;function re(A,Se,ke){ke=ke||2;var ut=Se&&Se.length,ft=ut?Se[0]*ke:A.length,Rt=Q(A,0,ft,ke,!0),Dt=[];if(!Rt||Rt.next===Rt.prev)return Dt;var gr,Yn,Gr,Nn,yn,zn,si;if(ut&&(Rt=de(A,Se,Rt,ke)),A.length>80*ke){gr=Gr=A[0],Yn=Nn=A[1];for(var Gn=ke;Gn<ft;Gn+=ke)yn=A[Gn],zn=A[Gn+1],yn<gr&&(gr=yn),zn<Yn&&(Yn=zn),yn>Gr&&(Gr=yn),zn>Nn&&(Nn=zn);si=Math.max(Gr-gr,Nn-Yn),si=si!==0?1/si:0}return me(Rt,Dt,ke,gr,Yn,si),Dt}function Q(A,Se,ke,ut,ft){var Rt,Dt;if(ft===Yr(A,Se,ke,ut)>0)for(Rt=Se;Rt<ke;Rt+=ut)Dt=Ht(Rt,A[Rt],A[Rt+1],Dt);else for(Rt=ke-ut;Rt>=Se;Rt-=ut)Dt=Ht(Rt,A[Rt],A[Rt+1],Dt);return Dt&&it(Dt,Dt.next)&&(vr(Dt),Dt=Dt.next),Dt}function Ce(A,Se){if(!A)return A;Se||(Se=A);var ke=A,ut;do if(ut=!1,!ke.steiner&&(it(ke,ke.next)||ct(ke.prev,ke,ke.next)===0)){if(vr(ke),ke=Se=ke.prev,ke===ke.next)break;ut=!0}else ke=ke.next;while(ut||ke!==Se);return Se}function me(A,Se,ke,ut,ft,Rt,Dt){if(!!A){!Dt&&Rt&&Ct(A,ut,ft,Rt);for(var gr=A,Yn,Gr;A.prev!==A.next;){if(Yn=A.prev,Gr=A.next,Rt?Re(A,ut,ft,Rt):m(A)){Se.push(Yn.i/ke),Se.push(A.i/ke),Se.push(Gr.i/ke),vr(A),A=Gr.next,gr=Gr.next;continue}if(A=Gr,A===gr){Dt?Dt===1?(A=W(Ce(A),Se,ke),me(A,Se,ke,ut,ft,Rt,2)):Dt===2&&pe(A,Se,ke,ut,ft,Rt):me(Ce(A),Se,ke,ut,ft,Rt,1);break}}}}function m(A){var Se=A.prev,ke=A,ut=A.next;if(ct(Se,ke,ut)>=0)return!1;for(var ft=A.next.next;ft!==A.prev;){if(Kt(Se.x,Se.y,ke.x,ke.y,ut.x,ut.y,ft.x,ft.y)&&ct(ft.prev,ft,ft.next)>=0)return!1;ft=ft.next}return!0}function Re(A,Se,ke,ut){var ft=A.prev,Rt=A,Dt=A.next;if(ct(ft,Rt,Dt)>=0)return!1;for(var gr=ft.x<Rt.x?ft.x<Dt.x?ft.x:Dt.x:Rt.x<Dt.x?Rt.x:Dt.x,Yn=ft.y<Rt.y?ft.y<Dt.y?ft.y:Dt.y:Rt.y<Dt.y?Rt.y:Dt.y,Gr=ft.x>Rt.x?ft.x>Dt.x?ft.x:Dt.x:Rt.x>Dt.x?Rt.x:Dt.x,Nn=ft.y>Rt.y?ft.y>Dt.y?ft.y:Dt.y:Rt.y>Dt.y?Rt.y:Dt.y,yn=or(gr,Yn,Se,ke,ut),zn=or(Gr,Nn,Se,ke,ut),si=A.prevZ,Gn=A.nextZ;si&&si.z>=yn&&Gn&&Gn.z<=zn;){if(si!==A.prev&&si!==A.next&&Kt(ft.x,ft.y,Rt.x,Rt.y,Dt.x,Dt.y,si.x,si.y)&&ct(si.prev,si,si.next)>=0||(si=si.prevZ,Gn!==A.prev&&Gn!==A.next&&Kt(ft.x,ft.y,Rt.x,Rt.y,Dt.x,Dt.y,Gn.x,Gn.y)&&ct(Gn.prev,Gn,Gn.next)>=0))return!1;Gn=Gn.nextZ}for(;si&&si.z>=yn;){if(si!==A.prev&&si!==A.next&&Kt(ft.x,ft.y,Rt.x,Rt.y,Dt.x,Dt.y,si.x,si.y)&&ct(si.prev,si,si.next)>=0)return!1;si=si.prevZ}for(;Gn&&Gn.z<=zn;){if(Gn!==A.prev&&Gn!==A.next&&Kt(ft.x,ft.y,Rt.x,Rt.y,Dt.x,Dt.y,Gn.x,Gn.y)&&ct(Gn.prev,Gn,Gn.next)>=0)return!1;Gn=Gn.nextZ}return!0}function W(A,Se,ke){var ut=A;do{var ft=ut.prev,Rt=ut.next.next;!it(ft,Rt)&&$t(ft,ut,ut.next,Rt)&&qe(ft,Rt)&&qe(Rt,ft)&&(Se.push(ft.i/ke),Se.push(ut.i/ke),Se.push(Rt.i/ke),vr(ut),vr(ut.next),ut=A=Rt),ut=ut.next}while(ut!==A);return Ce(ut)}function pe(A,Se,ke,ut,ft,Rt){var Dt=A;do{for(var gr=Dt.next.next;gr!==Dt.prev;){if(Dt.i!==gr.i&&yt(Dt,gr)){var Yn=$e(Dt,gr);Dt=Ce(Dt,Dt.next),Yn=Ce(Yn,Yn.next),me(Dt,Se,ke,ut,ft,Rt),me(Yn,Se,ke,ut,ft,Rt);return}gr=gr.next}Dt=Dt.next}while(Dt!==A)}function de(A,Se,ke,ut){var ft=[],Rt,Dt,gr,Yn,Gr;for(Rt=0,Dt=Se.length;Rt<Dt;Rt++)gr=Se[Rt]*ut,Yn=Rt<Dt-1?Se[Rt+1]*ut:A.length,Gr=Q(A,gr,Yn,ut,!1),Gr===Gr.next&&(Gr.steiner=!0),ft.push(At(Gr));for(ft.sort(ze),Rt=0;Rt<ft.length;Rt++)ke=_e(ft[Rt],ke),ke=Ce(ke,ke.next);return ke}function ze(A,Se){return A.x-Se.x}function _e(A,Se){var ke=et(A,Se);if(!ke)return Se;var ut=$e(ke,A),ft=Ce(ke,ke.next);return Ce(ut,ut.next),Se===ke?ft:Se}function et(A,Se){var ke=Se,ut=A.x,ft=A.y,Rt=-Infinity,Dt;do{if(ft<=ke.y&&ft>=ke.next.y&&ke.next.y!==ke.y){var gr=ke.x+(ft-ke.y)*(ke.next.x-ke.x)/(ke.next.y-ke.y);if(gr<=ut&&gr>Rt){if(Rt=gr,gr===ut){if(ft===ke.y)return ke;if(ft===ke.next.y)return ke.next}Dt=ke.x<ke.next.x?ke:ke.next}}ke=ke.next}while(ke!==Se);if(!Dt)return null;if(ut===Rt)return Dt;var Yn=Dt,Gr=Dt.x,Nn=Dt.y,yn=Infinity,zn;ke=Dt;do ut>=ke.x&&ke.x>=Gr&&ut!==ke.x&&Kt(ft<Nn?ut:Rt,ft,Gr,Nn,ft<Nn?Rt:ut,ft,ke.x,ke.y)&&(zn=Math.abs(ft-ke.y)/(ut-ke.x),qe(ke,A)&&(zn<yn||zn===yn&&(ke.x>Dt.x||ke.x===Dt.x&&mt(Dt,ke)))&&(Dt=ke,yn=zn)),ke=ke.next;while(ke!==Yn);return Dt}function mt(A,Se){return ct(A.prev,A,Se.prev)<0&&ct(Se.next,A,A.next)<0}function Ct(A,Se,ke,ut){var ft=A;do ft.z===null&&(ft.z=or(ft.x,ft.y,Se,ke,ut)),ft.prevZ=ft.prev,ft.nextZ=ft.next,ft=ft.next;while(ft!==A);ft.prevZ.nextZ=null,ft.prevZ=null,Bt(ft)}function Bt(A){var Se,ke,ut,ft,Rt,Dt,gr,Yn,Gr=1;do{for(ke=A,A=null,Rt=null,Dt=0;ke;){for(Dt++,ut=ke,gr=0,Se=0;Se<Gr&&(gr++,ut=ut.nextZ,!!ut);Se++);for(Yn=Gr;gr>0||Yn>0&&ut;)gr!==0&&(Yn===0||!ut||ke.z<=ut.z)?(ft=ke,ke=ke.nextZ,gr--):(ft=ut,ut=ut.nextZ,Yn--),Rt?Rt.nextZ=ft:A=ft,ft.prevZ=Rt,Rt=ft;ke=ut}Rt.nextZ=null,Gr*=2}while(Dt>1);return A}function or(A,Se,ke,ut,ft){return A=32767*(A-ke)*ft,Se=32767*(Se-ut)*ft,A=(A|A<<8)&16711935,A=(A|A<<4)&252645135,A=(A|A<<2)&858993459,A=(A|A<<1)&1431655765,Se=(Se|Se<<8)&16711935,Se=(Se|Se<<4)&252645135,Se=(Se|Se<<2)&858993459,Se=(Se|Se<<1)&1431655765,A|Se<<1}function At(A){var Se=A,ke=A;do(Se.x<ke.x||Se.x===ke.x&&Se.y<ke.y)&&(ke=Se),Se=Se.next;while(Se!==A);return ke}function Kt(A,Se,ke,ut,ft,Rt,Dt,gr){return(ft-Dt)*(Se-gr)-(A-Dt)*(Rt-gr)>=0&&(A-Dt)*(ut-gr)-(ke-Dt)*(Se-gr)>=0&&(ke-Dt)*(Rt-gr)-(ft-Dt)*(ut-gr)>=0}function yt(A,Se){return A.next.i!==Se.i&&A.prev.i!==Se.i&&!at(A,Se)&&(qe(A,Se)&&qe(Se,A)&&xt(A,Se)&&(ct(A.prev,A,Se.prev)||ct(A,Se.prev,Se))||it(A,Se)&&ct(A.prev,A,A.next)>0&&ct(Se.prev,Se,Se.next)>0)}function ct(A,Se,ke){return(Se.y-A.y)*(ke.x-Se.x)-(Se.x-A.x)*(ke.y-Se.y)}function it(A,Se){return A.x===Se.x&&A.y===Se.y}function $t(A,Se,ke,ut){var ft=Xt(ct(A,Se,ke)),Rt=Xt(ct(A,Se,ut)),Dt=Xt(ct(ke,ut,A)),gr=Xt(ct(ke,ut,Se));return!!(ft!==Rt&&Dt!==gr||ft===0&&X(A,ke,Se)||Rt===0&&X(A,ut,Se)||Dt===0&&X(ke,A,ut)||gr===0&&X(ke,Se,ut))}function X(A,Se,ke){return Se.x<=Math.max(A.x,ke.x)&&Se.x>=Math.min(A.x,ke.x)&&Se.y<=Math.max(A.y,ke.y)&&Se.y>=Math.min(A.y,ke.y)}function Xt(A){return A>0?1:A<0?-1:0}function at(A,Se){var ke=A;do{if(ke.i!==A.i&&ke.next.i!==A.i&&ke.i!==Se.i&&ke.next.i!==Se.i&&$t(ke,ke.next,A,Se))return!0;ke=ke.next}while(ke!==A);return!1}function qe(A,Se){return ct(A.prev,A,A.next)<0?ct(A,Se,A.next)>=0&&ct(A,A.prev,Se)>=0:ct(A,Se,A.prev)<0||ct(A,A.next,Se)<0}function xt(A,Se){var ke=A,ut=!1,ft=(A.x+Se.x)/2,Rt=(A.y+Se.y)/2;do ke.y>Rt!=ke.next.y>Rt&&ke.next.y!==ke.y&&ft<(ke.next.x-ke.x)*(Rt-ke.y)/(ke.next.y-ke.y)+ke.x&&(ut=!ut),ke=ke.next;while(ke!==A);return ut}function $e(A,Se){var ke=new Fr(A.i,A.x,A.y),ut=new Fr(Se.i,Se.x,Se.y),ft=A.next,Rt=Se.prev;return A.next=Se,Se.prev=A,ke.next=ft,ft.prev=ke,ut.next=ke,ke.prev=ut,Rt.next=ut,ut.prev=Rt,ut}function Ht(A,Se,ke,ut){var ft=new Fr(A,Se,ke);return ut?(ft.next=ut.next,ft.prev=ut,ut.next.prev=ft,ut.next=ft):(ft.prev=ft,ft.next=ft),ft}function vr(A){A.next.prev=A.prev,A.prev.next=A.next,A.prevZ&&(A.prevZ.nextZ=A.nextZ),A.nextZ&&(A.nextZ.prevZ=A.prevZ)}function Fr(A,Se,ke){this.i=A,this.x=Se,this.y=ke,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}re.deviation=function(A,Se,ke,ut){var ft=Se&&Se.length,Rt=ft?Se[0]*ke:A.length,Dt=Math.abs(Yr(A,0,Rt,ke));if(ft)for(var gr=0,Yn=Se.length;gr<Yn;gr++){var Gr=Se[gr]*ke,Nn=gr<Yn-1?Se[gr+1]*ke:A.length;Dt-=Math.abs(Yr(A,Gr,Nn,ke))}var yn=0;for(gr=0;gr<ut.length;gr+=3){var zn=ut[gr]*ke,si=ut[gr+1]*ke,Gn=ut[gr+2]*ke;yn+=Math.abs((A[zn]-A[Gn])*(A[si+1]-A[zn+1])-(A[zn]-A[si])*(A[Gn+1]-A[zn+1]))}return Dt===0&&yn===0?0:Math.abs((yn-Dt)/Dt)};function Yr(A,Se,ke,ut){for(var ft=0,Rt=Se,Dt=ke-ut;Rt<ke;Rt+=ut)ft+=(A[Dt]-A[Rt])*(A[Rt+1]+A[Dt+1]),Dt=Rt;return ft}re.flatten=function(A){for(var Se=A[0][0].length,ke={vertices:[],holes:[],dimensions:Se},ut=0,ft=0;ft<A.length;ft++){for(var Rt=0;Rt<A[ft].length;Rt++)for(var Dt=0;Dt<Se;Dt++)ke.vertices.push(A[ft][Rt][Dt]);ft>0&&(ut+=A[ft-1].length,ke.holes.push(ut))}return ke}},67709:function(Er){function re(Ce){var me=Ce.target||Ce.srcElement;me.__resizeRAF__&&cancelAnimationFrame(me.__resizeRAF__),me.__resizeRAF__=requestAnimationFrame(function(){var m=me.__resizeTrigger__,Re=m&&m.__resizeListeners__;Re&&Re.forEach(function(W){W.call(m,Ce)})})}var Q=function(me,m){var Re=this,W=Re.document,pe,de=W.attachEvent;typeof navigator!="undefined"&&(pe=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function ze(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",re)}if(!me.__resizeListeners__)if(me.__resizeListeners__=[],de)me.__resizeTrigger__=me,me.attachEvent("onresize",re);else{getComputedStyle(me).position==="static"&&(me.style.position="relative");var _e=me.__resizeTrigger__=W.createElement("object");_e.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),_e.setAttribute("class","resize-sensor"),_e.setAttribute("tabindex","-1"),_e.setAttribute("title",""),_e.__resizeElement__=me,_e.onload=ze,_e.type="text/html",pe&&me.appendChild(_e),_e.data="about:blank",pe||me.appendChild(_e)}me.__resizeListeners__.push(m)};Er.exports=typeof window=="undefined"?Q:Q.bind(window),Er.exports.unbind=function(Ce,me){var m=document.attachEvent,Re=Ce.__resizeListeners__||[];if(me){var W=Re.indexOf(me);W!==-1&&Re.splice(W,1)}else Re=Ce.__resizeListeners__=[];if(!Re.length){if(m)Ce.detachEvent("onresize",re);else if(Ce.__resizeTrigger__){var pe=Ce.__resizeTrigger__.contentDocument,de=pe&&pe.defaultView;de&&(de.removeEventListener("resize",re),delete de.__resizeTrigger__),Ce.__resizeTrigger__=!Ce.removeChild(Ce.__resizeTrigger__)}delete Ce.__resizeListeners__}}},26729:function(Er){"use strict";var re=Object.prototype.hasOwnProperty,Q="~";function Ce(){}Object.create&&(Ce.prototype=Object.create(null),new Ce().__proto__||(Q=!1));function me(pe,de,ze){this.fn=pe,this.context=de,this.once=ze||!1}function m(pe,de,ze,_e,et){if(typeof ze!="function")throw new TypeError("The listener must be a function");var mt=new me(ze,_e||pe,et),Ct=Q?Q+de:de;return pe._events[Ct]?pe._events[Ct].fn?pe._events[Ct]=[pe._events[Ct],mt]:pe._events[Ct].push(mt):(pe._events[Ct]=mt,pe._eventsCount++),pe}function Re(pe,de){--pe._eventsCount==0?pe._events=new Ce:delete pe._events[de]}function W(){this._events=new Ce,this._eventsCount=0}W.prototype.eventNames=function(){var de=[],ze,_e;if(this._eventsCount===0)return de;for(_e in ze=this._events)re.call(ze,_e)&&de.push(Q?_e.slice(1):_e);return Object.getOwnPropertySymbols?de.concat(Object.getOwnPropertySymbols(ze)):de},W.prototype.listeners=function(de){var ze=Q?Q+de:de,_e=this._events[ze];if(!_e)return[];if(_e.fn)return[_e.fn];for(var et=0,mt=_e.length,Ct=new Array(mt);et<mt;et++)Ct[et]=_e[et].fn;return Ct},W.prototype.listenerCount=function(de){var ze=Q?Q+de:de,_e=this._events[ze];return _e?_e.fn?1:_e.length:0},W.prototype.emit=function(de,ze,_e,et,mt,Ct){var Bt=Q?Q+de:de;if(!this._events[Bt])return!1;var or=this._events[Bt],At=arguments.length,Kt,yt;if(or.fn){switch(or.once&&this.removeListener(de,or.fn,void 0,!0),At){case 1:return or.fn.call(or.context),!0;case 2:return or.fn.call(or.context,ze),!0;case 3:return or.fn.call(or.context,ze,_e),!0;case 4:return or.fn.call(or.context,ze,_e,et),!0;case 5:return or.fn.call(or.context,ze,_e,et,mt),!0;case 6:return or.fn.call(or.context,ze,_e,et,mt,Ct),!0}for(yt=1,Kt=new Array(At-1);yt<At;yt++)Kt[yt-1]=arguments[yt];or.fn.apply(or.context,Kt)}else{var ct=or.length,it;for(yt=0;yt<ct;yt++)switch(or[yt].once&&this.removeListener(de,or[yt].fn,void 0,!0),At){case 1:or[yt].fn.call(or[yt].context);break;case 2:or[yt].fn.call(or[yt].context,ze);break;case 3:or[yt].fn.call(or[yt].context,ze,_e);break;case 4:or[yt].fn.call(or[yt].context,ze,_e,et);break;default:if(!Kt)for(it=1,Kt=new Array(At-1);it<At;it++)Kt[it-1]=arguments[it];or[yt].fn.apply(or[yt].context,Kt)}}return!0},W.prototype.on=function(de,ze,_e){return m(this,de,ze,_e,!1)},W.prototype.once=function(de,ze,_e){return m(this,de,ze,_e,!0)},W.prototype.removeListener=function(de,ze,_e,et){var mt=Q?Q+de:de;if(!this._events[mt])return this;if(!ze)return Re(this,mt),this;var Ct=this._events[mt];if(Ct.fn)Ct.fn===ze&&(!et||Ct.once)&&(!_e||Ct.context===_e)&&Re(this,mt);else{for(var Bt=0,or=[],At=Ct.length;Bt<At;Bt++)(Ct[Bt].fn!==ze||et&&!Ct[Bt].once||_e&&Ct[Bt].context!==_e)&&or.push(Ct[Bt]);or.length?this._events[mt]=or.length===1?or[0]:or:Re(this,mt)}return this},W.prototype.removeAllListeners=function(de){var ze;return de?(ze=Q?Q+de:de,this._events[ze]&&Re(this,ze)):(this._events=new Ce,this._eventsCount=0),this},W.prototype.off=W.prototype.removeListener,W.prototype.addListener=W.prototype.on,W.prefixed=Q,W.EventEmitter=W,Er.exports=W},7375:function(Er,re){"use strict";Object.defineProperty(re,"__esModule",{value:!0});var Q=Symbol.for("INJECTION");function Ce(pe,de,ze,_e){function et(){return _e&&!Reflect.hasMetadata(Q,this,de)&&Reflect.defineMetadata(Q,ze(),this,de),Reflect.hasMetadata(Q,this,de)?Reflect.getMetadata(Q,this,de):ze()}function mt(Ct){Reflect.defineMetadata(Q,Ct,this,de)}Object.defineProperty(pe,de,{configurable:!0,enumerable:!0,get:et,set:mt})}function me(pe,de){return function(ze){return function(_e,et){var mt=function(){return pe.get(ze)};Ce(_e,et,mt,de)}}}re.makePropertyInjectDecorator=me;function m(pe,de){return function(ze,_e){return function(et,mt){var Ct=function(){return pe.getNamed(ze,_e)};Ce(et,mt,Ct,de)}}}re.makePropertyInjectNamedDecorator=m;function Re(pe,de){return function(ze,_e,et){return function(mt,Ct){var Bt=function(){return pe.getTagged(ze,_e,et)};Ce(mt,Ct,Bt,de)}}}re.makePropertyInjectTaggedDecorator=Re;function W(pe,de){return function(ze){return function(_e,et){var mt=function(){return pe.getAll(ze)};Ce(_e,et,mt,de)}}}re.makePropertyMultiInjectDecorator=W},84879:function(Er,re,Q){"use strict";var Ce;Ce={value:!0};var me=Q(7375);function m(Re,W){W===void 0&&(W=!0);var pe=me.makePropertyInjectDecorator(Re,W),de=me.makePropertyInjectNamedDecorator(Re,W),ze=me.makePropertyInjectTaggedDecorator(Re,W),_e=me.makePropertyMultiInjectDecorator(Re,W);return{lazyInject:pe,lazyInjectNamed:de,lazyInjectTagged:ze,lazyMultiInject:_e}}re.Z=m},99934:function(Er,re,Q){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.tagProperty=re.tagParameter=re.decorate=void 0;var Ce=Q(16674),me=Q(6867);function m(_e,et,mt,Ct){var Bt=me.TAGGED;W(Bt,_e,et,Ct,mt)}re.tagParameter=m;function Re(_e,et,mt){var Ct=me.TAGGED_PROP;W(Ct,_e.constructor,et,mt)}re.tagProperty=Re;function W(_e,et,mt,Ct,Bt){var or={},At=typeof Bt=="number",Kt=Bt!==void 0&&At?Bt.toString():mt;if(At&&mt!==void 0)throw new Error(Ce.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(_e,et)&&(or=Reflect.getMetadata(_e,et));var yt=or[Kt];if(!Array.isArray(yt))yt=[];else for(var ct=0,it=yt;ct<it.length;ct++){var $t=it[ct];if($t.key===Ct.key)throw new Error(Ce.DUPLICATED_METADATA+" "+$t.key.toString())}yt.push(Ct),or[Kt]=yt,Reflect.defineMetadata(_e,or,et)}function pe(_e,et){Reflect.decorate(_e,et)}function de(_e,et){return function(mt,Ct){et(mt,Ct,_e)}}function ze(_e,et,mt){typeof mt=="number"?pe([de(mt,_e)],et):typeof mt=="string"?Reflect.decorate([_e],et,mt):pe([_e],et)}re.decorate=ze},5744:function(Er,re,Q){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.inject=re.LazyServiceIdentifer=void 0;var Ce=Q(16674),me=Q(6867),m=Q(47738),Re=Q(99934),W=function(){function de(ze){this._cb=ze}return de.prototype.unwrap=function(){return this._cb()},de}();re.LazyServiceIdentifer=W;function pe(de){return function(ze,_e,et){if(de===void 0)throw new Error(Ce.UNDEFINED_INJECT_ANNOTATION(ze.name));var mt=new m.Metadata(me.INJECT_TAG,de);typeof et=="number"?Re.tagParameter(ze,_e,et,mt):Re.tagProperty(ze,_e,mt)}}re.inject=pe},64315:function(Er,re,Q){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.injectable=void 0;var Ce=Q(16674),me=Q(6867);function m(){return function(Re){if(Reflect.hasOwnMetadata(me.PARAM_TYPES,Re))throw new Error(Ce.DUPLICATED_INJECTABLE_DECORATOR);var W=Reflect.getMetadata(me.DESIGN_PARAM_TYPES,Re)||[];return Reflect.defineMetadata(me.PARAM_TYPES,W,Re),Re}}re.injectable=m},71693:function(Er,re,Q){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.multiInject=void 0;var Ce=Q(6867),me=Q(47738),m=Q(99934);function Re(W){return function(pe,de,ze){var _e=new me.Metadata(Ce.MULTI_INJECT_TAG,W);typeof ze=="number"?m.tagParameter(pe,de,ze,_e):m.tagProperty(pe,de,_e)}}re.multiInject=Re},38085:function(Er,re,Q){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.named=void 0;var Ce=Q(6867),me=Q(47738),m=Q(99934);function Re(W){return function(pe,de,ze){var _e=new me.Metadata(Ce.NAMED_TAG,W);typeof ze=="number"?m.tagParameter(pe,de,ze,_e):m.tagProperty(pe,de,_e)}}re.named=Re},6515:function(Er,re,Q){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.optional=void 0;var Ce=Q(6867),me=Q(47738),m=Q(99934);function Re(){return function(W,pe,de){var ze=new me.Metadata(Ce.OPTIONAL_TAG,!0);typeof de=="number"?m.tagParameter(W,pe,de,ze):m.tagProperty(W,pe,ze)}}re.optional=Re},7014:function(Er,re,Q){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.postConstruct=void 0;var Ce=Q(16674),me=Q(6867),m=Q(47738);function Re(){return function(W,pe,de){var ze=new m.Metadata(me.POST_CONSTRUCT,pe);if(Reflect.hasOwnMetadata(me.POST_CONSTRUCT,W.constructor))throw new Error(Ce.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(me.POST_CONSTRUCT,ze,W.constructor)}}re.postConstruct=Re},32052:function(Er,re,Q){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.tagged=void 0;var Ce=Q(47738),me=Q(99934);function m(Re,W){return function(pe,de,ze){var _e=new Ce.Metadata(Re,W);typeof ze=="number"?me.tagParameter(pe,de,ze,_e):me.tagProperty(pe,de,_e)}}re.tagged=m},55638:function(Er,re,Q){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.targetName=void 0;var Ce=Q(6867),me=Q(47738),m=Q(99934);function Re(W){return function(pe,de,ze){var _e=new me.Metadata(Ce.NAME_TAG,W);m.tagParameter(pe,de,ze,_e)}}re.targetName=Re},86757:function(Er,re,Q){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.unmanaged=void 0;var Ce=Q(6867),me=Q(47738),m=Q(99934);function Re(){return function(W,pe,de){var ze=new me.Metadata(Ce.UNMANAGED_TAG,!0);m.tagParameter(W,pe,de,ze)}}re.unmanaged=Re},44290:function(Er,re,Q){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.Binding=void 0;var Ce=Q(28421),me=Q(37791),m=function(){function Re(W,pe){this.id=me.id(),this.activated=!1,this.serviceIdentifier=W,this.scope=pe,this.type=Ce.BindingTypeEnum.Invalid,this.constraint=function(de){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return Re.prototype.clone=function(){var W=new Re(this.serviceIdentifier,this.scope);return W.activated=W.scope===Ce.BindingScopeEnum.Singleton?this.activated:!1,W.implementationType=this.implementationType,W.dynamicValue=this.dynamicValue,W.scope=this.scope,W.type=this.type,W.factory=this.factory,W.provider=this.provider,W.constraint=this.constraint,W.onActivation=this.onActivation,W.cache=this.cache,W},Re}();re.Binding=m},23184:function(Er,re){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.BindingCount=void 0;var Q={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};re.BindingCount=Q},16674:function(Er,re){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.STACK_OVERFLOW=re.CIRCULAR_DEPENDENCY_IN_FACTORY=re.POST_CONSTRUCT_ERROR=re.MULTIPLE_POST_CONSTRUCT_METHODS=re.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=re.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=re.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=re.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=re.ARGUMENTS_LENGTH_MISMATCH=re.INVALID_DECORATOR_OPERATION=re.INVALID_TO_SELF_VALUE=re.INVALID_FUNCTION_BINDING=re.INVALID_MIDDLEWARE_RETURN=re.NO_MORE_SNAPSHOTS_AVAILABLE=re.INVALID_BINDING_TYPE=re.NOT_IMPLEMENTED=re.CIRCULAR_DEPENDENCY=re.UNDEFINED_INJECT_ANNOTATION=re.MISSING_INJECT_ANNOTATION=re.MISSING_INJECTABLE_ANNOTATION=re.NOT_REGISTERED=re.CANNOT_UNBIND=re.AMBIGUOUS_MATCH=re.KEY_NOT_FOUND=re.NULL_ARGUMENT=re.DUPLICATED_METADATA=re.DUPLICATED_INJECTABLE_DECORATOR=void 0,re.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",re.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",re.NULL_ARGUMENT="NULL argument",re.KEY_NOT_FOUND="Key Not Found",re.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",re.CANNOT_UNBIND="Could not unbind serviceIdentifier:",re.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",re.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",re.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var Q=function(Re){return"@inject called with undefined this could mean that the class "+Re+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};re.UNDEFINED_INJECT_ANNOTATION=Q,re.CIRCULAR_DEPENDENCY="Circular dependency found:",re.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",re.INVALID_BINDING_TYPE="Invalid binding type:",re.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",re.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",re.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",re.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",re.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var Ce=function(){for(var Re=[],W=0;W<arguments.length;W++)Re[W]=arguments[W];return"The number of constructor arguments in the derived class "+(Re[0]+" must be >= than the number of constructor arguments of its base class.")};re.ARGUMENTS_LENGTH_MISMATCH=Ce,re.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",re.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",re.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",re.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",re.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var me=function(){for(var Re=[],W=0;W<arguments.length;W++)Re[W]=arguments[W];return"@postConstruct error in class "+Re[0]+": "+Re[1]};re.POST_CONSTRUCT_ERROR=me;var m=function(){for(var Re=[],W=0;W<arguments.length;W++)Re[W]=arguments[W];return"It looks like there is a circular dependency "+("in one of the '"+Re[0]+"' bindings. Please investigate bindings with")+("service identifier '"+Re[1]+"'.")};re.CIRCULAR_DEPENDENCY_IN_FACTORY=m,re.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(Er,re){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.TargetTypeEnum=re.BindingTypeEnum=re.BindingScopeEnum=void 0;var Q={Request:"Request",Singleton:"Singleton",Transient:"Transient"};re.BindingScopeEnum=Q;var Ce={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};re.BindingTypeEnum=Ce;var me={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};re.TargetTypeEnum=me},6867:function(Er,re){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.NON_CUSTOM_TAG_KEYS=re.POST_CONSTRUCT=re.DESIGN_PARAM_TYPES=re.PARAM_TYPES=re.TAGGED_PROP=re.TAGGED=re.MULTI_INJECT_TAG=re.INJECT_TAG=re.OPTIONAL_TAG=re.UNMANAGED_TAG=re.NAME_TAG=re.NAMED_TAG=void 0,re.NAMED_TAG="named",re.NAME_TAG="name",re.UNMANAGED_TAG="unmanaged",re.OPTIONAL_TAG="optional",re.INJECT_TAG="inject",re.MULTI_INJECT_TAG="multi_inject",re.TAGGED="inversify:tagged",re.TAGGED_PROP="inversify:tagged_props",re.PARAM_TYPES="inversify:paramtypes",re.DESIGN_PARAM_TYPES="design:paramtypes",re.POST_CONSTRUCT="post_construct";function Q(){return[re.INJECT_TAG,re.MULTI_INJECT_TAG,re.NAME_TAG,re.UNMANAGED_TAG,re.NAMED_TAG,re.OPTIONAL_TAG]}re.NON_CUSTOM_TAG_KEYS=Q()},51389:function(Er,re,Q){"use strict";var Ce=this&&this.__awaiter||function(yt,ct,it,$t){function X(Xt){return Xt instanceof it?Xt:new it(function(at){at(Xt)})}return new(it||(it=Promise))(function(Xt,at){function qe(Ht){try{$e($t.next(Ht))}catch(vr){at(vr)}}function xt(Ht){try{$e($t.throw(Ht))}catch(vr){at(vr)}}function $e(Ht){Ht.done?Xt(Ht.value):X(Ht.value).then(qe,xt)}$e(($t=$t.apply(yt,ct||[])).next())})},me=this&&this.__generator||function(yt,ct){var it={label:0,sent:function(){if(Xt[0]&1)throw Xt[1];return Xt[1]},trys:[],ops:[]},$t,X,Xt,at;return at={next:qe(0),throw:qe(1),return:qe(2)},typeof Symbol=="function"&&(at[Symbol.iterator]=function(){return this}),at;function qe($e){return function(Ht){return xt([$e,Ht])}}function xt($e){if($t)throw new TypeError("Generator is already executing.");for(;it;)try{if($t=1,X&&(Xt=$e[0]&2?X.return:$e[0]?X.throw||((Xt=X.return)&&Xt.call(X),0):X.next)&&!(Xt=Xt.call(X,$e[1])).done)return Xt;switch(X=0,Xt&&($e=[$e[0]&2,Xt.value]),$e[0]){case 0:case 1:Xt=$e;break;case 4:return it.label++,{value:$e[1],done:!1};case 5:it.label++,X=$e[1],$e=[0];continue;case 7:$e=it.ops.pop(),it.trys.pop();continue;default:if(Xt=it.trys,!(Xt=Xt.length>0&&Xt[Xt.length-1])&&($e[0]===6||$e[0]===2)){it=0;continue}if($e[0]===3&&(!Xt||$e[1]>Xt[0]&&$e[1]<Xt[3])){it.label=$e[1];break}if($e[0]===6&&it.label<Xt[1]){it.label=Xt[1],Xt=$e;break}if(Xt&&it.label<Xt[2]){it.label=Xt[2],it.ops.push($e);break}Xt[2]&&it.ops.pop(),it.trys.pop();continue}$e=ct.call(yt,it)}catch(Ht){$e=[6,Ht],X=0}finally{$t=Xt=0}if($e[0]&5)throw $e[1];return{value:$e[0]?$e[1]:void 0,done:!0}}},m=this&&this.__spreadArray||function(yt,ct){for(var it=0,$t=ct.length,X=yt.length;it<$t;it++,X++)yt[X]=ct[it];return yt};Object.defineProperty(re,"__esModule",{value:!0}),re.Container=void 0;var Re=Q(44290),W=Q(16674),pe=Q(28421),de=Q(6867),ze=Q(51377),_e=Q(86311),et=Q(31927),mt=Q(15451),Ct=Q(37791),Bt=Q(55800),or=Q(85700),At=Q(80175),Kt=function(){function yt(ct){this._appliedMiddleware=[];var it=ct||{};if(typeof it!="object")throw new Error(""+W.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(it.defaultScope===void 0)it.defaultScope=pe.BindingScopeEnum.Transient;else if(it.defaultScope!==pe.BindingScopeEnum.Singleton&&it.defaultScope!==pe.BindingScopeEnum.Transient&&it.defaultScope!==pe.BindingScopeEnum.Request)throw new Error(""+W.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(it.autoBindInjectable===void 0)it.autoBindInjectable=!1;else if(typeof it.autoBindInjectable!="boolean")throw new Error(""+W.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(it.skipBaseClassChecks===void 0)it.skipBaseClassChecks=!1;else if(typeof it.skipBaseClassChecks!="boolean")throw new Error(""+W.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:it.autoBindInjectable,defaultScope:it.defaultScope,skipBaseClassChecks:it.skipBaseClassChecks},this.id=Ct.id(),this._bindingDictionary=new At.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new ze.MetadataReader}return yt.merge=function(ct,it){for(var $t=[],X=2;X<arguments.length;X++)$t[X-2]=arguments[X];var Xt=new yt,at=m([ct,it],$t).map(function($e){return _e.getBindingDictionary($e)}),qe=_e.getBindingDictionary(Xt);function xt($e,Ht){$e.traverse(function(vr,Fr){Fr.forEach(function(Yr){Ht.add(Yr.serviceIdentifier,Yr.clone())})})}return at.forEach(function($e){xt($e,qe)}),Xt},yt.prototype.load=function(){for(var ct=[],it=0;it<arguments.length;it++)ct[it]=arguments[it];for(var $t=this._getContainerModuleHelpersFactory(),X=0,Xt=ct;X<Xt.length;X++){var at=Xt[X],qe=$t(at.id);at.registry(qe.bindFunction,qe.unbindFunction,qe.isboundFunction,qe.rebindFunction)}},yt.prototype.loadAsync=function(){for(var ct=[],it=0;it<arguments.length;it++)ct[it]=arguments[it];return Ce(this,void 0,void 0,function(){var $t,X,Xt,at,qe;return me(this,function(xt){switch(xt.label){case 0:$t=this._getContainerModuleHelpersFactory(),X=0,Xt=ct,xt.label=1;case 1:return X<Xt.length?(at=Xt[X],qe=$t(at.id),[4,at.registry(qe.bindFunction,qe.unbindFunction,qe.isboundFunction,qe.rebindFunction)]):[3,4];case 2:xt.sent(),xt.label=3;case 3:return X++,[3,1];case 4:return[2]}})})},yt.prototype.unload=function(){for(var ct=this,it=[],$t=0;$t<arguments.length;$t++)it[$t]=arguments[$t];var X=function(Xt){return function(at){return at.moduleId===Xt}};it.forEach(function(Xt){var at=X(Xt.id);ct._bindingDictionary.removeByCondition(at)})},yt.prototype.bind=function(ct){var it=this.options.defaultScope||pe.BindingScopeEnum.Transient,$t=new Re.Binding(ct,it);return this._bindingDictionary.add(ct,$t),new mt.BindingToSyntax($t)},yt.prototype.rebind=function(ct){return this.unbind(ct),this.bind(ct)},yt.prototype.unbind=function(ct){try{this._bindingDictionary.remove(ct)}catch(it){throw new Error(W.CANNOT_UNBIND+" "+Bt.getServiceIdentifierAsString(ct))}},yt.prototype.unbindAll=function(){this._bindingDictionary=new At.Lookup},yt.prototype.isBound=function(ct){var it=this._bindingDictionary.hasKey(ct);return!it&&this.parent&&(it=this.parent.isBound(ct)),it},yt.prototype.isBoundNamed=function(ct,it){return this.isBoundTagged(ct,de.NAMED_TAG,it)},yt.prototype.isBoundTagged=function(ct,it,$t){var X=!1;if(this._bindingDictionary.hasKey(ct)){var Xt=this._bindingDictionary.get(ct),at=_e.createMockRequest(this,ct,it,$t);X=Xt.some(function(qe){return qe.constraint(at)})}return!X&&this.parent&&(X=this.parent.isBoundTagged(ct,it,$t)),X},yt.prototype.snapshot=function(){this._snapshots.push(or.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},yt.prototype.restore=function(){var ct=this._snapshots.pop();if(ct===void 0)throw new Error(W.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=ct.bindings,this._middleware=ct.middleware},yt.prototype.createChild=function(ct){var it=new yt(ct||this.options);return it.parent=this,it},yt.prototype.applyMiddleware=function(){for(var ct=[],it=0;it<arguments.length;it++)ct[it]=arguments[it];this._appliedMiddleware=this._appliedMiddleware.concat(ct);var $t=this._middleware?this._middleware:this._planAndResolve();this._middleware=ct.reduce(function(X,Xt){return Xt(X)},$t)},yt.prototype.applyCustomMetadataReader=function(ct){this._metadataReader=ct},yt.prototype.get=function(ct){return this._get(!1,!1,pe.TargetTypeEnum.Variable,ct)},yt.prototype.getTagged=function(ct,it,$t){return this._get(!1,!1,pe.TargetTypeEnum.Variable,ct,it,$t)},yt.prototype.getNamed=function(ct,it){return this.getTagged(ct,de.NAMED_TAG,it)},yt.prototype.getAll=function(ct){return this._get(!0,!0,pe.TargetTypeEnum.Variable,ct)},yt.prototype.getAllTagged=function(ct,it,$t){return this._get(!1,!0,pe.TargetTypeEnum.Variable,ct,it,$t)},yt.prototype.getAllNamed=function(ct,it){return this.getAllTagged(ct,de.NAMED_TAG,it)},yt.prototype.resolve=function(ct){var it=this.createChild();return it.bind(ct).toSelf(),this._appliedMiddleware.forEach(function($t){it.applyMiddleware($t)}),it.get(ct)},yt.prototype._getContainerModuleHelpersFactory=function(){var ct=this,it=function(qe,xt){qe._binding.moduleId=xt},$t=function(qe){return function(xt){var $e=ct.bind.bind(ct),Ht=$e(xt);return it(Ht,qe),Ht}},X=function(qe){return function(xt){var $e=ct.unbind.bind(ct);$e(xt)}},Xt=function(qe){return function(xt){var $e=ct.isBound.bind(ct);return $e(xt)}},at=function(qe){return function(xt){var $e=ct.rebind.bind(ct),Ht=$e(xt);return it(Ht,qe),Ht}};return function(qe){return{bindFunction:$t(qe),isboundFunction:Xt(qe),rebindFunction:at(qe),unbindFunction:X(qe)}}},yt.prototype._get=function(ct,it,$t,X,Xt,at){var qe=null,xt={avoidConstraints:ct,contextInterceptor:function($e){return $e},isMultiInject:it,key:Xt,serviceIdentifier:X,targetType:$t,value:at};if(this._middleware){if(qe=this._middleware(xt),qe==null)throw new Error(W.INVALID_MIDDLEWARE_RETURN)}else qe=this._planAndResolve()(xt);return qe},yt.prototype._planAndResolve=function(){var ct=this;return function(it){var $t=_e.plan(ct._metadataReader,ct,it.isMultiInject,it.targetType,it.serviceIdentifier,it.key,it.value,it.avoidConstraints);$t=it.contextInterceptor($t);var X=et.resolve($t);return X}},yt}();re.Container=Kt},33244:function(Er,re,Q){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.AsyncContainerModule=re.ContainerModule=void 0;var Ce=Q(37791),me=function(){function Re(W){this.id=Ce.id(),this.registry=W}return Re}();re.ContainerModule=me;var m=function(){function Re(W){this.id=Ce.id(),this.registry=W}return Re}();re.AsyncContainerModule=m},85700:function(Er,re){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.ContainerSnapshot=void 0;var Q=function(){function Ce(){}return Ce.of=function(me,m){var Re=new Ce;return Re.bindings=me,Re.middleware=m,Re},Ce}();re.ContainerSnapshot=Q},80175:function(Er,re,Q){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.Lookup=void 0;var Ce=Q(16674),me=function(){function m(){this._map=new Map}return m.prototype.getMap=function(){return this._map},m.prototype.add=function(Re,W){if(Re==null)throw new Error(Ce.NULL_ARGUMENT);if(W==null)throw new Error(Ce.NULL_ARGUMENT);var pe=this._map.get(Re);pe!==void 0?(pe.push(W),this._map.set(Re,pe)):this._map.set(Re,[W])},m.prototype.get=function(Re){if(Re==null)throw new Error(Ce.NULL_ARGUMENT);var W=this._map.get(Re);if(W!==void 0)return W;throw new Error(Ce.KEY_NOT_FOUND)},m.prototype.remove=function(Re){if(Re==null)throw new Error(Ce.NULL_ARGUMENT);if(!this._map.delete(Re))throw new Error(Ce.KEY_NOT_FOUND)},m.prototype.removeByCondition=function(Re){var W=this;this._map.forEach(function(pe,de){var ze=pe.filter(function(_e){return!Re(_e)});ze.length>0?W._map.set(de,ze):W._map.delete(de)})},m.prototype.hasKey=function(Re){if(Re==null)throw new Error(Ce.NULL_ARGUMENT);return this._map.has(Re)},m.prototype.clone=function(){var Re=new m;return this._map.forEach(function(W,pe){W.forEach(function(de){return Re.add(pe,de.clone())})}),Re},m.prototype.traverse=function(Re){this._map.forEach(function(W,pe){Re(pe,W)})},m}();re.Lookup=me},86700:function(Er,re,Q){"use strict";var Ce;Ce={value:!0},Ce=Ce=Ce=Ce=Ce=Ce=re.GW=Ce=Ce=re.zY=Ce=Ce=Ce=Ce=Ce=re.f3=Ce=Ce=re.b2=Ce=Ce=Ce=Ce=Ce=re.W2=Ce=void 0;var me=Q(6867);Ce=me;var m=Q(51389);Object.defineProperty(re,"W2",{enumerable:!0,get:function(){return m.Container}});var Re=Q(28421);Ce={enumerable:!0,get:function(){return Re.BindingScopeEnum}},Ce={enumerable:!0,get:function(){return Re.BindingTypeEnum}},Ce={enumerable:!0,get:function(){return Re.TargetTypeEnum}};var W=Q(33244);Ce={enumerable:!0,get:function(){return W.AsyncContainerModule}},Ce={enumerable:!0,get:function(){return W.ContainerModule}};var pe=Q(64315);Object.defineProperty(re,"b2",{enumerable:!0,get:function(){return pe.injectable}});var de=Q(32052);Ce={enumerable:!0,get:function(){return de.tagged}};var ze=Q(38085);Ce={enumerable:!0,get:function(){return ze.named}};var _e=Q(5744);Object.defineProperty(re,"f3",{enumerable:!0,get:function(){return _e.inject}}),Ce={enumerable:!0,get:function(){return _e.LazyServiceIdentifer}};var et=Q(6515);Ce={enumerable:!0,get:function(){return et.optional}};var mt=Q(86757);Ce={enumerable:!0,get:function(){return mt.unmanaged}};var Ct=Q(71693);Ce={enumerable:!0,get:function(){return Ct.multiInject}};var Bt=Q(55638);Ce={enumerable:!0,get:function(){return Bt.targetName}};var or=Q(7014);Object.defineProperty(re,"zY",{enumerable:!0,get:function(){return or.postConstruct}});var At=Q(51377);Ce={enumerable:!0,get:function(){return At.MetadataReader}};var Kt=Q(37791);Ce={enumerable:!0,get:function(){return Kt.id}};var yt=Q(99934);Object.defineProperty(re,"GW",{enumerable:!0,get:function(){return yt.decorate}});var ct=Q(80758);Ce={enumerable:!0,get:function(){return ct.traverseAncerstors}},Ce={enumerable:!0,get:function(){return ct.taggedConstraint}},Ce={enumerable:!0,get:function(){return ct.namedConstraint}},Ce={enumerable:!0,get:function(){return ct.typeConstraint}};var it=Q(55800);Ce={enumerable:!0,get:function(){return it.getServiceIdentifierAsString}};var $t=Q(70600);Ce={enumerable:!0,get:function(){return $t.multiBindToService}}},95228:function(Er,re,Q){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.Context=void 0;var Ce=Q(37791),me=function(){function m(Re){this.id=Ce.id(),this.container=Re}return m.prototype.addPlan=function(Re){this.plan=Re},m.prototype.setCurrentRequest=function(Re){this.currentRequest=Re},m}();re.Context=me},47738:function(Er,re,Q){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.Metadata=void 0;var Ce=Q(6867),me=function(){function m(Re,W){this.key=Re,this.value=W}return m.prototype.toString=function(){return this.key===Ce.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},m}();re.Metadata=me},51377:function(Er,re,Q){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.MetadataReader=void 0;var Ce=Q(6867),me=function(){function m(){}return m.prototype.getConstructorMetadata=function(Re){var W=Reflect.getMetadata(Ce.PARAM_TYPES,Re),pe=Reflect.getMetadata(Ce.TAGGED,Re);return{compilerGeneratedMetadata:W,userGeneratedMetadata:pe||{}}},m.prototype.getPropertiesMetadata=function(Re){var W=Reflect.getMetadata(Ce.TAGGED_PROP,Re)||[];return W},m}();re.MetadataReader=me},55314:function(Er,re){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.Plan=void 0;var Q=function(){function Ce(me,m){this.parentContext=me,this.rootRequest=m}return Ce}();re.Plan=Q},86311:function(Er,re,Q){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.getBindingDictionary=re.createMockRequest=re.plan=void 0;var Ce=Q(23184),me=Q(16674),m=Q(28421),Re=Q(6867),W=Q(85265),pe=Q(55800),de=Q(95228),ze=Q(47738),_e=Q(55314),et=Q(6e3),mt=Q(6748),Ct=Q(18924);function Bt(X){return X._bindingDictionary}re.getBindingDictionary=Bt;function or(X,Xt,at,qe,xt,$e){var Ht=X?Re.MULTI_INJECT_TAG:Re.INJECT_TAG,vr=new ze.Metadata(Ht,at),Fr=new Ct.Target(Xt,qe,at,vr);if(xt!==void 0){var Yr=new ze.Metadata(xt,$e);Fr.metadata.push(Yr)}return Fr}function At(X,Xt,at,qe,xt){var $e=ct(at.container,xt.serviceIdentifier),Ht=[];return $e.length===Ce.BindingCount.NoBindingsAvailable&&at.container.options.autoBindInjectable&&typeof xt.serviceIdentifier=="function"&&X.getConstructorMetadata(xt.serviceIdentifier).compilerGeneratedMetadata&&(at.container.bind(xt.serviceIdentifier).toSelf(),$e=ct(at.container,xt.serviceIdentifier)),Xt?Ht=$e:Ht=$e.filter(function(vr){var Fr=new mt.Request(vr.serviceIdentifier,at,qe,vr,xt);return vr.constraint(Fr)}),Kt(xt.serviceIdentifier,Ht,xt,at.container),Ht}function Kt(X,Xt,at,qe){switch(Xt.length){case Ce.BindingCount.NoBindingsAvailable:if(at.isOptional())return Xt;var xt=pe.getServiceIdentifierAsString(X),$e=me.NOT_REGISTERED;throw $e+=pe.listMetadataForTarget(xt,at),$e+=pe.listRegisteredBindingsForServiceIdentifier(qe,xt,ct),new Error($e);case Ce.BindingCount.OnlyOneBindingAvailable:if(!at.isArray())return Xt;case Ce.BindingCount.MultipleBindingsAvailable:default:if(at.isArray())return Xt;var xt=pe.getServiceIdentifierAsString(X),$e=me.AMBIGUOUS_MATCH+" "+xt;throw $e+=pe.listRegisteredBindingsForServiceIdentifier(qe,xt,ct),new Error($e)}}function yt(X,Xt,at,qe,xt,$e){var Ht,vr;if(xt===null){Ht=At(X,Xt,qe,null,$e),vr=new mt.Request(at,qe,null,Ht,$e);var Fr=new _e.Plan(qe,vr);qe.addPlan(Fr)}else Ht=At(X,Xt,qe,xt,$e),vr=xt.addChildRequest($e.serviceIdentifier,Ht,$e);Ht.forEach(function(Yr){var A=null;if($e.isArray())A=vr.addChildRequest(Yr.serviceIdentifier,Yr,$e);else{if(Yr.cache)return;A=vr}if(Yr.type===m.BindingTypeEnum.Instance&&Yr.implementationType!==null){var Se=et.getDependencies(X,Yr.implementationType);if(!qe.container.options.skipBaseClassChecks){var ke=et.getBaseClassDependencyCount(X,Yr.implementationType);if(Se.length<ke){var ut=me.ARGUMENTS_LENGTH_MISMATCH(et.getFunctionName(Yr.implementationType));throw new Error(ut)}}Se.forEach(function(ft){yt(X,!1,ft.serviceIdentifier,qe,A,ft)})}})}function ct(X,Xt){var at=[],qe=Bt(X);return qe.hasKey(Xt)?at=qe.get(Xt):X.parent!==null&&(at=ct(X.parent,Xt)),at}function it(X,Xt,at,qe,xt,$e,Ht,vr){vr===void 0&&(vr=!1);var Fr=new de.Context(Xt),Yr=or(at,qe,xt,"",$e,Ht);try{return yt(X,vr,xt,Fr,null,Yr),Fr}catch(A){throw W.isStackOverflowExeption(A)&&Fr.plan&&pe.circularDependencyToException(Fr.plan.rootRequest),A}}re.plan=it;function $t(X,Xt,at,qe){var xt=new Ct.Target(m.TargetTypeEnum.Variable,"",Xt,new ze.Metadata(at,qe)),$e=new de.Context(X),Ht=new mt.Request(Xt,$e,null,[],xt);return Ht}re.createMockRequest=$t},88460:function(Er,re){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.QueryableString=void 0;var Q=function(){function Ce(me){this.str=me}return Ce.prototype.startsWith=function(me){return this.str.indexOf(me)===0},Ce.prototype.endsWith=function(me){var m="",Re=me.split("").reverse().join("");return m=this.str.split("").reverse().join(""),this.startsWith.call({str:m},Re)},Ce.prototype.contains=function(me){return this.str.indexOf(me)!==-1},Ce.prototype.equals=function(me){return this.str===me},Ce.prototype.value=function(){return this.str},Ce}();re.QueryableString=Q},6e3:function(Er,re,Q){"use strict";var Ce=this&&this.__spreadArray||function(At,Kt){for(var yt=0,ct=Kt.length,it=At.length;yt<ct;yt++,it++)At[it]=Kt[yt];return At};Object.defineProperty(re,"__esModule",{value:!0}),re.getFunctionName=re.getBaseClassDependencyCount=re.getDependencies=void 0;var me=Q(5744),m=Q(16674),Re=Q(28421),W=Q(6867),pe=Q(55800);Object.defineProperty(re,"getFunctionName",{enumerable:!0,get:function(){return pe.getFunctionName}});var de=Q(18924);function ze(At,Kt){var yt=pe.getFunctionName(Kt),ct=_e(At,yt,Kt,!1);return ct}re.getDependencies=ze;function _e(At,Kt,yt,ct){var it=At.getConstructorMetadata(yt),$t=it.compilerGeneratedMetadata;if($t===void 0){var X=m.MISSING_INJECTABLE_ANNOTATION+" "+Kt+".";throw new Error(X)}var Xt=it.userGeneratedMetadata,at=Object.keys(Xt),qe=yt.length===0&&at.length>0,xt=at.length>yt.length,$e=qe||xt?at.length:yt.length,Ht=mt(ct,Kt,$t,Xt,$e),vr=Ct(At,yt),Fr=Ce(Ce([],Ht),vr);return Fr}function et(At,Kt,yt,ct,it){var $t=it[At.toString()]||[],X=or($t),Xt=X.unmanaged!==!0,at=ct[At],qe=X.inject||X.multiInject;if(at=qe||at,at instanceof me.LazyServiceIdentifer&&(at=at.unwrap()),Xt){var xt=at===Object,$e=at===Function,Ht=at===void 0,vr=xt||$e||Ht;if(!Kt&&vr){var Fr=m.MISSING_INJECT_ANNOTATION+" argument "+At+" in class "+yt+".";throw new Error(Fr)}var Yr=new de.Target(Re.TargetTypeEnum.ConstructorArgument,X.targetName,at);return Yr.metadata=$t,Yr}return null}function mt(At,Kt,yt,ct,it){for(var $t=[],X=0;X<it;X++){var Xt=X,at=et(Xt,At,Kt,yt,ct);at!==null&&$t.push(at)}return $t}function Ct(At,Kt){for(var yt=At.getPropertiesMetadata(Kt),ct=[],it=Object.keys(yt),$t=0,X=it;$t<X.length;$t++){var Xt=X[$t],at=yt[Xt],qe=or(yt[Xt]),xt=qe.targetName||Xt,$e=qe.inject||qe.multiInject,Ht=new de.Target(Re.TargetTypeEnum.ClassProperty,xt,$e);Ht.metadata=at,ct.push(Ht)}var vr=Object.getPrototypeOf(Kt.prototype).constructor;if(vr!==Object){var Fr=Ct(At,vr);ct=Ce(Ce([],ct),Fr)}return ct}function Bt(At,Kt){var yt=Object.getPrototypeOf(Kt.prototype).constructor;if(yt!==Object){var ct=pe.getFunctionName(yt),it=_e(At,ct,yt,!0),$t=it.map(function(at){return at.metadata.filter(function(qe){return qe.key===W.UNMANAGED_TAG})}),X=[].concat.apply([],$t).length,Xt=it.length-X;return Xt>0?Xt:Bt(At,yt)}else return 0}re.getBaseClassDependencyCount=Bt;function or(At){var Kt={};return At.forEach(function(yt){Kt[yt.key.toString()]=yt.value}),{inject:Kt[W.INJECT_TAG],multiInject:Kt[W.MULTI_INJECT_TAG],targetName:Kt[W.NAME_TAG],unmanaged:Kt[W.UNMANAGED_TAG]}}},6748:function(Er,re,Q){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.Request=void 0;var Ce=Q(37791),me=function(){function m(Re,W,pe,de,ze){this.id=Ce.id(),this.serviceIdentifier=Re,this.parentContext=W,this.parentRequest=pe,this.target=ze,this.childRequests=[],this.bindings=Array.isArray(de)?de:[de],this.requestScope=pe===null?new Map:null}return m.prototype.addChildRequest=function(Re,W,pe){var de=new m(Re,this.parentContext,this,W,pe);return this.childRequests.push(de),de},m}();re.Request=me},18924:function(Er,re,Q){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.Target=void 0;var Ce=Q(6867),me=Q(37791),m=Q(47738),Re=Q(88460),W=function(){function pe(de,ze,_e,et){this.id=me.id(),this.type=de,this.serviceIdentifier=_e,this.name=new Re.QueryableString(ze||""),this.metadata=new Array;var mt=null;typeof et=="string"?mt=new m.Metadata(Ce.NAMED_TAG,et):et instanceof m.Metadata&&(mt=et),mt!==null&&this.metadata.push(mt)}return pe.prototype.hasTag=function(de){for(var ze=0,_e=this.metadata;ze<_e.length;ze++){var et=_e[ze];if(et.key===de)return!0}return!1},pe.prototype.isArray=function(){return this.hasTag(Ce.MULTI_INJECT_TAG)},pe.prototype.matchesArray=function(de){return this.matchesTag(Ce.MULTI_INJECT_TAG)(de)},pe.prototype.isNamed=function(){return this.hasTag(Ce.NAMED_TAG)},pe.prototype.isTagged=function(){return this.metadata.some(function(de){return Ce.NON_CUSTOM_TAG_KEYS.every(function(ze){return de.key!==ze})})},pe.prototype.isOptional=function(){return this.matchesTag(Ce.OPTIONAL_TAG)(!0)},pe.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(de){return de.key===Ce.NAMED_TAG})[0]:null},pe.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(de){return Ce.NON_CUSTOM_TAG_KEYS.every(function(ze){return de.key!==ze})}):null},pe.prototype.matchesNamedTag=function(de){return this.matchesTag(Ce.NAMED_TAG)(de)},pe.prototype.matchesTag=function(de){var ze=this;return function(_e){for(var et=0,mt=ze.metadata;et<mt.length;et++){var Ct=mt[et];if(Ct.key===de&&Ct.value===_e)return!0}return!1}},pe}();re.Target=W},52279:function(Er,re,Q){"use strict";var Ce=this&&this.__spreadArray||function(_e,et){for(var mt=0,Ct=et.length,Bt=_e.length;mt<Ct;mt++,Bt++)_e[Bt]=et[mt];return _e};Object.defineProperty(re,"__esModule",{value:!0}),re.resolveInstance=void 0;var me=Q(16674),m=Q(28421),Re=Q(6867);function W(_e,et,mt){var Ct=et.filter(function(or){return or.target!==null&&or.target.type===m.TargetTypeEnum.ClassProperty}),Bt=Ct.map(mt);return Ct.forEach(function(or,At){var Kt="";Kt=or.target.name.value();var yt=Bt[At];_e[Kt]=yt}),_e}function pe(_e,et){return new(_e.bind.apply(_e,Ce([void 0],et)))}function de(_e,et){if(Reflect.hasMetadata(Re.POST_CONSTRUCT,_e)){var mt=Reflect.getMetadata(Re.POST_CONSTRUCT,_e);try{et[mt.value]()}catch(Ct){throw new Error(me.POST_CONSTRUCT_ERROR(_e.name,Ct.message))}}}function ze(_e,et,mt){var Ct=null;if(et.length>0){var Bt=et.filter(function(At){return At.target!==null&&At.target.type===m.TargetTypeEnum.ConstructorArgument}),or=Bt.map(mt);Ct=pe(_e,or),Ct=W(Ct,et,mt)}else Ct=new _e;return de(_e,Ct),Ct}re.resolveInstance=ze},31927:function(Er,re,Q){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.resolve=void 0;var Ce=Q(16674),me=Q(28421),m=Q(85265),Re=Q(55800),W=Q(52279),pe=function(_e,et,mt){try{return mt()}catch(Ct){throw m.isStackOverflowExeption(Ct)?new Error(Ce.CIRCULAR_DEPENDENCY_IN_FACTORY(_e,et.toString())):Ct}},de=function(_e){return function(et){et.parentContext.setCurrentRequest(et);var mt=et.bindings,Ct=et.childRequests,Bt=et.target&&et.target.isArray(),or=!et.parentRequest||!et.parentRequest.target||!et.target||!et.parentRequest.target.matchesArray(et.target.serviceIdentifier);if(Bt&&or)return Ct.map(function($t){var X=de(_e);return X($t)});var At=null;if(et.target.isOptional()&&mt.length===0)return;var Kt=mt[0],yt=Kt.scope===me.BindingScopeEnum.Singleton,ct=Kt.scope===me.BindingScopeEnum.Request;if(yt&&Kt.activated)return Kt.cache;if(ct&&_e!==null&&_e.has(Kt.id))return _e.get(Kt.id);if(Kt.type===me.BindingTypeEnum.ConstantValue)At=Kt.cache,Kt.activated=!0;else if(Kt.type===me.BindingTypeEnum.Function)At=Kt.cache,Kt.activated=!0;else if(Kt.type===me.BindingTypeEnum.Constructor)At=Kt.implementationType;else if(Kt.type===me.BindingTypeEnum.DynamicValue&&Kt.dynamicValue!==null)At=pe("toDynamicValue",Kt.serviceIdentifier,function(){return Kt.dynamicValue(et.parentContext)});else if(Kt.type===me.BindingTypeEnum.Factory&&Kt.factory!==null)At=pe("toFactory",Kt.serviceIdentifier,function(){return Kt.factory(et.parentContext)});else if(Kt.type===me.BindingTypeEnum.Provider&&Kt.provider!==null)At=pe("toProvider",Kt.serviceIdentifier,function(){return Kt.provider(et.parentContext)});else if(Kt.type===me.BindingTypeEnum.Instance&&Kt.implementationType!==null)At=W.resolveInstance(Kt.implementationType,Ct,de(_e));else{var it=Re.getServiceIdentifierAsString(et.serviceIdentifier);throw new Error(Ce.INVALID_BINDING_TYPE+" "+it)}return typeof Kt.onActivation=="function"&&(At=Kt.onActivation(et.parentContext,At)),yt&&(Kt.cache=At,Kt.activated=!0),ct&&_e!==null&&!_e.has(Kt.id)&&_e.set(Kt.id,At),At}};function ze(_e){var et=de(_e.plan.rootRequest.requestScope);return et(_e.plan.rootRequest)}re.resolve=ze},83366:function(Er,re,Q){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.BindingInSyntax=void 0;var Ce=Q(28421),me=Q(71325),m=function(){function Re(W){this._binding=W}return Re.prototype.inRequestScope=function(){return this._binding.scope=Ce.BindingScopeEnum.Request,new me.BindingWhenOnSyntax(this._binding)},Re.prototype.inSingletonScope=function(){return this._binding.scope=Ce.BindingScopeEnum.Singleton,new me.BindingWhenOnSyntax(this._binding)},Re.prototype.inTransientScope=function(){return this._binding.scope=Ce.BindingScopeEnum.Transient,new me.BindingWhenOnSyntax(this._binding)},Re}();re.BindingInSyntax=m},74889:function(Er,re,Q){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.BindingInWhenOnSyntax=void 0;var Ce=Q(83366),me=Q(51811),m=Q(98370),Re=function(){function W(pe){this._binding=pe,this._bindingWhenSyntax=new m.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new me.BindingOnSyntax(this._binding),this._bindingInSyntax=new Ce.BindingInSyntax(pe)}return W.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},W.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},W.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},W.prototype.when=function(pe){return this._bindingWhenSyntax.when(pe)},W.prototype.whenTargetNamed=function(pe){return this._bindingWhenSyntax.whenTargetNamed(pe)},W.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},W.prototype.whenTargetTagged=function(pe,de){return this._bindingWhenSyntax.whenTargetTagged(pe,de)},W.prototype.whenInjectedInto=function(pe){return this._bindingWhenSyntax.whenInjectedInto(pe)},W.prototype.whenParentNamed=function(pe){return this._bindingWhenSyntax.whenParentNamed(pe)},W.prototype.whenParentTagged=function(pe,de){return this._bindingWhenSyntax.whenParentTagged(pe,de)},W.prototype.whenAnyAncestorIs=function(pe){return this._bindingWhenSyntax.whenAnyAncestorIs(pe)},W.prototype.whenNoAncestorIs=function(pe){return this._bindingWhenSyntax.whenNoAncestorIs(pe)},W.prototype.whenAnyAncestorNamed=function(pe){return this._bindingWhenSyntax.whenAnyAncestorNamed(pe)},W.prototype.whenAnyAncestorTagged=function(pe,de){return this._bindingWhenSyntax.whenAnyAncestorTagged(pe,de)},W.prototype.whenNoAncestorNamed=function(pe){return this._bindingWhenSyntax.whenNoAncestorNamed(pe)},W.prototype.whenNoAncestorTagged=function(pe,de){return this._bindingWhenSyntax.whenNoAncestorTagged(pe,de)},W.prototype.whenAnyAncestorMatches=function(pe){return this._bindingWhenSyntax.whenAnyAncestorMatches(pe)},W.prototype.whenNoAncestorMatches=function(pe){return this._bindingWhenSyntax.whenNoAncestorMatches(pe)},W.prototype.onActivation=function(pe){return this._bindingOnSyntax.onActivation(pe)},W}();re.BindingInWhenOnSyntax=Re},51811:function(Er,re,Q){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.BindingOnSyntax=void 0;var Ce=Q(98370),me=function(){function m(Re){this._binding=Re}return m.prototype.onActivation=function(Re){return this._binding.onActivation=Re,new Ce.BindingWhenSyntax(this._binding)},m}();re.BindingOnSyntax=me},15451:function(Er,re,Q){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.BindingToSyntax=void 0;var Ce=Q(16674),me=Q(28421),m=Q(74889),Re=Q(71325),W=function(){function pe(de){this._binding=de}return pe.prototype.to=function(de){return this._binding.type=me.BindingTypeEnum.Instance,this._binding.implementationType=de,new m.BindingInWhenOnSyntax(this._binding)},pe.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+Ce.INVALID_TO_SELF_VALUE);var de=this._binding.serviceIdentifier;return this.to(de)},pe.prototype.toConstantValue=function(de){return this._binding.type=me.BindingTypeEnum.ConstantValue,this._binding.cache=de,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=me.BindingScopeEnum.Singleton,new Re.BindingWhenOnSyntax(this._binding)},pe.prototype.toDynamicValue=function(de){return this._binding.type=me.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=de,this._binding.implementationType=null,new m.BindingInWhenOnSyntax(this._binding)},pe.prototype.toConstructor=function(de){return this._binding.type=me.BindingTypeEnum.Constructor,this._binding.implementationType=de,this._binding.scope=me.BindingScopeEnum.Singleton,new Re.BindingWhenOnSyntax(this._binding)},pe.prototype.toFactory=function(de){return this._binding.type=me.BindingTypeEnum.Factory,this._binding.factory=de,this._binding.scope=me.BindingScopeEnum.Singleton,new Re.BindingWhenOnSyntax(this._binding)},pe.prototype.toFunction=function(de){if(typeof de!="function")throw new Error(Ce.INVALID_FUNCTION_BINDING);var ze=this.toConstantValue(de);return this._binding.type=me.BindingTypeEnum.Function,this._binding.scope=me.BindingScopeEnum.Singleton,ze},pe.prototype.toAutoFactory=function(de){return this._binding.type=me.BindingTypeEnum.Factory,this._binding.factory=function(ze){var _e=function(){return ze.container.get(de)};return _e},this._binding.scope=me.BindingScopeEnum.Singleton,new Re.BindingWhenOnSyntax(this._binding)},pe.prototype.toProvider=function(de){return this._binding.type=me.BindingTypeEnum.Provider,this._binding.provider=de,this._binding.scope=me.BindingScopeEnum.Singleton,new Re.BindingWhenOnSyntax(this._binding)},pe.prototype.toService=function(de){this.toDynamicValue(function(ze){return ze.container.get(de)})},pe}();re.BindingToSyntax=W},71325:function(Er,re,Q){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.BindingWhenOnSyntax=void 0;var Ce=Q(51811),me=Q(98370),m=function(){function Re(W){this._binding=W,this._bindingWhenSyntax=new me.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new Ce.BindingOnSyntax(this._binding)}return Re.prototype.when=function(W){return this._bindingWhenSyntax.when(W)},Re.prototype.whenTargetNamed=function(W){return this._bindingWhenSyntax.whenTargetNamed(W)},Re.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},Re.prototype.whenTargetTagged=function(W,pe){return this._bindingWhenSyntax.whenTargetTagged(W,pe)},Re.prototype.whenInjectedInto=function(W){return this._bindingWhenSyntax.whenInjectedInto(W)},Re.prototype.whenParentNamed=function(W){return this._bindingWhenSyntax.whenParentNamed(W)},Re.prototype.whenParentTagged=function(W,pe){return this._bindingWhenSyntax.whenParentTagged(W,pe)},Re.prototype.whenAnyAncestorIs=function(W){return this._bindingWhenSyntax.whenAnyAncestorIs(W)},Re.prototype.whenNoAncestorIs=function(W){return this._bindingWhenSyntax.whenNoAncestorIs(W)},Re.prototype.whenAnyAncestorNamed=function(W){return this._bindingWhenSyntax.whenAnyAncestorNamed(W)},Re.prototype.whenAnyAncestorTagged=function(W,pe){return this._bindingWhenSyntax.whenAnyAncestorTagged(W,pe)},Re.prototype.whenNoAncestorNamed=function(W){return this._bindingWhenSyntax.whenNoAncestorNamed(W)},Re.prototype.whenNoAncestorTagged=function(W,pe){return this._bindingWhenSyntax.whenNoAncestorTagged(W,pe)},Re.prototype.whenAnyAncestorMatches=function(W){return this._bindingWhenSyntax.whenAnyAncestorMatches(W)},Re.prototype.whenNoAncestorMatches=function(W){return this._bindingWhenSyntax.whenNoAncestorMatches(W)},Re.prototype.onActivation=function(W){return this._bindingOnSyntax.onActivation(W)},Re}();re.BindingWhenOnSyntax=m},98370:function(Er,re,Q){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.BindingWhenSyntax=void 0;var Ce=Q(51811),me=Q(80758),m=function(){function Re(W){this._binding=W}return Re.prototype.when=function(W){return this._binding.constraint=W,new Ce.BindingOnSyntax(this._binding)},Re.prototype.whenTargetNamed=function(W){return this._binding.constraint=me.namedConstraint(W),new Ce.BindingOnSyntax(this._binding)},Re.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(W){var pe=W.target!==null&&!W.target.isNamed()&&!W.target.isTagged();return pe},new Ce.BindingOnSyntax(this._binding)},Re.prototype.whenTargetTagged=function(W,pe){return this._binding.constraint=me.taggedConstraint(W)(pe),new Ce.BindingOnSyntax(this._binding)},Re.prototype.whenInjectedInto=function(W){return this._binding.constraint=function(pe){return me.typeConstraint(W)(pe.parentRequest)},new Ce.BindingOnSyntax(this._binding)},Re.prototype.whenParentNamed=function(W){return this._binding.constraint=function(pe){return me.namedConstraint(W)(pe.parentRequest)},new Ce.BindingOnSyntax(this._binding)},Re.prototype.whenParentTagged=function(W,pe){return this._binding.constraint=function(de){return me.taggedConstraint(W)(pe)(de.parentRequest)},new Ce.BindingOnSyntax(this._binding)},Re.prototype.whenAnyAncestorIs=function(W){return this._binding.constraint=function(pe){return me.traverseAncerstors(pe,me.typeConstraint(W))},new Ce.BindingOnSyntax(this._binding)},Re.prototype.whenNoAncestorIs=function(W){return this._binding.constraint=function(pe){return!me.traverseAncerstors(pe,me.typeConstraint(W))},new Ce.BindingOnSyntax(this._binding)},Re.prototype.whenAnyAncestorNamed=function(W){return this._binding.constraint=function(pe){return me.traverseAncerstors(pe,me.namedConstraint(W))},new Ce.BindingOnSyntax(this._binding)},Re.prototype.whenNoAncestorNamed=function(W){return this._binding.constraint=function(pe){return!me.traverseAncerstors(pe,me.namedConstraint(W))},new Ce.BindingOnSyntax(this._binding)},Re.prototype.whenAnyAncestorTagged=function(W,pe){return this._binding.constraint=function(de){return me.traverseAncerstors(de,me.taggedConstraint(W)(pe))},new Ce.BindingOnSyntax(this._binding)},Re.prototype.whenNoAncestorTagged=function(W,pe){return this._binding.constraint=function(de){return!me.traverseAncerstors(de,me.taggedConstraint(W)(pe))},new Ce.BindingOnSyntax(this._binding)},Re.prototype.whenAnyAncestorMatches=function(W){return this._binding.constraint=function(pe){return me.traverseAncerstors(pe,W)},new Ce.BindingOnSyntax(this._binding)},Re.prototype.whenNoAncestorMatches=function(W){return this._binding.constraint=function(pe){return!me.traverseAncerstors(pe,W)},new Ce.BindingOnSyntax(this._binding)},Re}();re.BindingWhenSyntax=m},80758:function(Er,re,Q){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.typeConstraint=re.namedConstraint=re.taggedConstraint=re.traverseAncerstors=void 0;var Ce=Q(6867),me=Q(47738),m=function(de,ze){var _e=de.parentRequest;return _e!==null?ze(_e)?!0:m(_e,ze):!1};re.traverseAncerstors=m;var Re=function(de){return function(ze){var _e=function(et){return et!==null&&et.target!==null&&et.target.matchesTag(de)(ze)};return _e.metaData=new me.Metadata(de,ze),_e}};re.taggedConstraint=Re;var W=Re(Ce.NAMED_TAG);re.namedConstraint=W;var pe=function(de){return function(ze){var _e=null;if(ze!==null)if(_e=ze.bindings[0],typeof de=="string"){var et=_e.serviceIdentifier;return et===de}else{var mt=ze.bindings[0].implementationType;return de===mt}return!1}};re.typeConstraint=pe},70600:function(Er,re){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.multiBindToService=void 0;var Q=function(Ce){return function(me){return function(){for(var m=[],Re=0;Re<arguments.length;Re++)m[Re]=arguments[Re];return m.forEach(function(W){return Ce.bind(W).toService(me)})}}};re.multiBindToService=Q},85265:function(Er,re,Q){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.isStackOverflowExeption=void 0;var Ce=Q(16674);function me(m){return m instanceof RangeError||m.message===Ce.STACK_OVERFLOW}re.isStackOverflowExeption=me},37791:function(Er,re){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.id=void 0;var Q=0;function Ce(){return Q++}re.id=Ce},55800:function(Er,re,Q){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.circularDependencyToException=re.listMetadataForTarget=re.listRegisteredBindingsForServiceIdentifier=re.getServiceIdentifierAsString=re.getFunctionName=void 0;var Ce=Q(16674);function me(_e){if(typeof _e=="function"){var et=_e;return et.name}else{if(typeof _e=="symbol")return _e.toString();var et=_e;return et}}re.getServiceIdentifierAsString=me;function m(_e,et,mt){var Ct="",Bt=mt(_e,et);return Bt.length!==0&&(Ct=`
Registered bindings:`,Bt.forEach(function(or){var At="Object";or.implementationType!==null&&(At=ze(or.implementationType)),Ct=Ct+`
 `+At,or.constraint.metaData&&(Ct=Ct+" - "+or.constraint.metaData)})),Ct}re.listRegisteredBindingsForServiceIdentifier=m;function Re(_e,et){return _e.parentRequest===null?!1:_e.parentRequest.serviceIdentifier===et?!0:Re(_e.parentRequest,et)}function W(_e){function et(Ct,Bt){Bt===void 0&&(Bt=[]);var or=me(Ct.serviceIdentifier);return Bt.push(or),Ct.parentRequest!==null?et(Ct.parentRequest,Bt):Bt}var mt=et(_e);return mt.reverse().join(" --> ")}function pe(_e){_e.childRequests.forEach(function(et){if(Re(et,et.serviceIdentifier)){var mt=W(et);throw new Error(Ce.CIRCULAR_DEPENDENCY+" "+mt)}else pe(et)})}re.circularDependencyToException=pe;function de(_e,et){if(et.isTagged()||et.isNamed()){var mt="",Ct=et.getNamedTag(),Bt=et.getCustomTags();return Ct!==null&&(mt+=Ct.toString()+`
`),Bt!==null&&Bt.forEach(function(or){mt+=or.toString()+`
`})," "+_e+`
 `+_e+" - "+mt}else return" "+_e}re.listMetadataForTarget=de;function ze(_e){if(_e.name)return _e.name;var et=_e.toString(),mt=et.match(/^function\s*([^\s(]+)/);return mt?mt[1]:"Anonymous function: "+et}re.getFunctionName=ze},31745:function(Er){"use strict";Er.exports=Q,Er.exports.default=Q;var re=1e20;function Q(W,pe,de,ze,_e,et){this.fontSize=W||24,this.buffer=pe===void 0?3:pe,this.cutoff=ze||.25,this.fontFamily=_e||"sans-serif",this.fontWeight=et||"normal",this.radius=de||8;var mt=this.size=this.fontSize+this.buffer*2,Ct=mt+this.buffer*2,Bt=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;Bt?this.canvas=my.createOffscreenCanvas(mt,mt,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=mt),this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(Ct*Ct),this.gridInner=new Float64Array(Ct*Ct),this.f=new Float64Array(Ct),this.z=new Float64Array(Ct+1),this.v=new Uint16Array(Ct),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,Bt?this.middle=Math.round(mt/2*1):this.middle=Math.round(mt/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Ce(W,pe,de,ze,_e,et,mt){et.fill(re,0,pe*de),mt.fill(0,0,pe*de);for(var Ct=(pe-ze)/2,Bt=0;Bt<_e;Bt++)for(var or=0;or<ze;or++){var At=(Bt+Ct)*pe+or+Ct,Kt=W.data[4*(Bt*ze+or)+3]/255;if(Kt===1)et[At]=0,mt[At]=re;else if(Kt===0)et[At]=re,mt[At]=0;else{var yt=Math.max(0,.5-Kt),ct=Math.max(0,Kt-.5);et[At]=yt*yt,mt[At]=ct*ct}}}function me(W,pe,de,ze,_e,et,mt){for(var Ct=0;Ct<pe*de;Ct++){var Bt=Math.sqrt(ze[Ct])-Math.sqrt(_e[Ct]);W[Ct]=Math.round(255-255*(Bt/et+mt))}}Q.prototype._draw=function(W,pe){var de=this.ctx.measureText(W),ze=de.width,_e=2*this.buffer,et,mt,Ct,Bt,or,At,Kt,yt;pe&&this.useMetrics?(or=Math.floor(de.actualBoundingBoxAscent),yt=this.buffer+Math.ceil(de.actualBoundingBoxAscent),At=this.buffer,Kt=this.buffer,mt=Math.min(this.size,Math.ceil(de.actualBoundingBoxRight-de.actualBoundingBoxLeft)),Bt=Math.min(this.size-At,Math.ceil(de.actualBoundingBoxAscent+de.actualBoundingBoxDescent)),et=mt+_e,Ct=Bt+_e,this.ctx.textBaseline="alphabetic"):(et=mt=this.size,Ct=Bt=this.size,or=19*this.fontSize/24,At=Kt=0,yt=this.middle,this.ctx.textBaseline="middle");var ct;mt&&Bt&&(this.ctx.clearRect(Kt,At,mt,Bt),this.ctx.fillText(W,this.buffer,yt),ct=this.ctx.getImageData(Kt,At,mt,Bt));var it=new Uint8ClampedArray(et*Ct);return Ce(ct,et,Ct,mt,Bt,this.gridOuter,this.gridInner),m(this.gridOuter,et,Ct,this.f,this.v,this.z),m(this.gridInner,et,Ct,this.f,this.v,this.z),me(it,et,Ct,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:it,metrics:{width:mt,height:Bt,sdfWidth:et,sdfHeight:Ct,top:or,left:0,advance:ze}}},Q.prototype.draw=function(W){return this._draw(W,!1).data},Q.prototype.drawWithMetrics=function(W){return this._draw(W,!0)};function m(W,pe,de,ze,_e,et){for(var mt=0;mt<pe;mt++)Re(W,mt,pe,de,ze,_e,et);for(var Ct=0;Ct<de;Ct++)Re(W,Ct*pe,1,pe,ze,_e,et)}function Re(W,pe,de,ze,_e,et,mt){var Ct,Bt,or,At;for(et[0]=0,mt[0]=-re,mt[1]=re,Ct=0;Ct<ze;Ct++)_e[Ct]=W[pe+Ct*de];for(Ct=1,Bt=0,or=0;Ct<ze;Ct++){do At=et[Bt],or=(_e[Ct]-_e[At]+Ct*Ct-At*At)/(Ct-At)/2;while(or<=mt[Bt]&&--Bt>-1);Bt++,et[Bt]=Ct,mt[Bt]=or,mt[Bt+1]=re}for(Ct=0,Bt=0;Ct<ze;Ct++){for(;mt[Bt+1]<Ct;)Bt++;At=et[Bt],W[pe+Ct*de]=_e[At]+(Ct-At)*(Ct-At)}}},18857:function(Er,re,Q){"use strict";Q.r(re),Q.d(re,{Function:function(){return Xs},Interpreter:function(){return _a},default:function(){return al},evaluate:function(){return Wu},vm:function(){return Ce}});var Ce={};Q.r(Ce),Q.d(Ce,{Script:function(){return rc},compileFunction:function(){return pf},createContext:function(){return rs},runInContext:function(){return Pl},runInNewContext:function(){return Ws}});var me={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},m="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",Re={5:m,"5module":m+" export import",6:m+" const class extends export import super"},W=/^in(stanceof)?$/,pe="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",de="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",ze=new RegExp("["+pe+"]"),_e=new RegExp("["+pe+de+"]");pe=de=null;var et=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],mt=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function Ct(_,M){for(var B=65536,O=0;O<M.length;O+=2){if(B+=M[O],B>_)return!1;if(B+=M[O+1],B>=_)return!0}}function Bt(_,M){return _<65?_===36:_<91?!0:_<97?_===95:_<123?!0:_<=65535?_>=170&&ze.test(String.fromCharCode(_)):M===!1?!1:Ct(_,et)}function or(_,M){return _<48?_===36:_<58?!0:_<65?!1:_<91?!0:_<97?_===95:_<123?!0:_<=65535?_>=170&&_e.test(String.fromCharCode(_)):M===!1?!1:Ct(_,et)||Ct(_,mt)}var At=function(M,B){B===void 0&&(B={}),this.label=M,this.keyword=B.keyword,this.beforeExpr=!!B.beforeExpr,this.startsExpr=!!B.startsExpr,this.isLoop=!!B.isLoop,this.isAssign=!!B.isAssign,this.prefix=!!B.prefix,this.postfix=!!B.postfix,this.binop=B.binop||null,this.updateContext=null};function Kt(_,M){return new At(_,{beforeExpr:!0,binop:M})}var yt={beforeExpr:!0},ct={startsExpr:!0},it={};function $t(_,M){return M===void 0&&(M={}),M.keyword=_,it[_]=new At(_,M)}var X={num:new At("num",ct),regexp:new At("regexp",ct),string:new At("string",ct),name:new At("name",ct),eof:new At("eof"),bracketL:new At("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new At("]"),braceL:new At("{",{beforeExpr:!0,startsExpr:!0}),braceR:new At("}"),parenL:new At("(",{beforeExpr:!0,startsExpr:!0}),parenR:new At(")"),comma:new At(",",yt),semi:new At(";",yt),colon:new At(":",yt),dot:new At("."),question:new At("?",yt),questionDot:new At("?."),arrow:new At("=>",yt),template:new At("template"),invalidTemplate:new At("invalidTemplate"),ellipsis:new At("...",yt),backQuote:new At("`",ct),dollarBraceL:new At("${",{beforeExpr:!0,startsExpr:!0}),eq:new At("=",{beforeExpr:!0,isAssign:!0}),assign:new At("_=",{beforeExpr:!0,isAssign:!0}),incDec:new At("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new At("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:Kt("||",1),logicalAND:Kt("&&",2),bitwiseOR:Kt("|",3),bitwiseXOR:Kt("^",4),bitwiseAND:Kt("&",5),equality:Kt("==/!=/===/!==",6),relational:Kt("</>/<=/>=",7),bitShift:Kt("<</>>/>>>",8),plusMin:new At("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:Kt("%",10),star:Kt("*",10),slash:Kt("/",10),starstar:new At("**",{beforeExpr:!0}),coalesce:Kt("??",1),_break:$t("break"),_case:$t("case",yt),_catch:$t("catch"),_continue:$t("continue"),_debugger:$t("debugger"),_default:$t("default",yt),_do:$t("do",{isLoop:!0,beforeExpr:!0}),_else:$t("else",yt),_finally:$t("finally"),_for:$t("for",{isLoop:!0}),_function:$t("function",ct),_if:$t("if"),_return:$t("return",yt),_switch:$t("switch"),_throw:$t("throw",yt),_try:$t("try"),_var:$t("var"),_const:$t("const"),_while:$t("while",{isLoop:!0}),_with:$t("with"),_new:$t("new",{beforeExpr:!0,startsExpr:!0}),_this:$t("this",ct),_super:$t("super",ct),_class:$t("class",ct),_extends:$t("extends",yt),_export:$t("export"),_import:$t("import",ct),_null:$t("null",ct),_true:$t("true",ct),_false:$t("false",ct),_in:$t("in",{beforeExpr:!0,binop:7}),_instanceof:$t("instanceof",{beforeExpr:!0,binop:7}),_typeof:$t("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:$t("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:$t("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},Xt=/\r\n?|\n|\u2028|\u2029/,at=new RegExp(Xt.source,"g");function qe(_,M){return _===10||_===13||!M&&(_===8232||_===8233)}var xt=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,$e=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,Ht=Object.prototype,vr=Ht.hasOwnProperty,Fr=Ht.toString;function Yr(_,M){return vr.call(_,M)}var A=Array.isArray||function(_){return Fr.call(_)==="[object Array]"};function Se(_){return new RegExp("^(?:"+_.replace(/ /g,"|")+")$")}var ke=function(M,B){this.line=M,this.column=B};ke.prototype.offset=function(M){return new ke(this.line,this.column+M)};var ut=function(M,B,O){this.start=B,this.end=O,M.sourceFile!==null&&(this.source=M.sourceFile)};function ft(_,M){for(var B=1,O=0;;){at.lastIndex=O;var K=at.exec(_);if(K&&K.index<M)++B,O=K.index+K[0].length;else return new ke(B,M-O)}}var Rt={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function Dt(_){var M={};for(var B in Rt)M[B]=_&&Yr(_,B)?_[B]:Rt[B];if(M.ecmaVersion>=2015&&(M.ecmaVersion-=2009),M.allowReserved==null&&(M.allowReserved=M.ecmaVersion<5),A(M.onToken)){var O=M.onToken;M.onToken=function(K){return O.push(K)}}return A(M.onComment)&&(M.onComment=gr(M,M.onComment)),M}function gr(_,M){return function(B,O,K,ge,He,lt){var pt={type:B?"Block":"Line",value:O,start:K,end:ge};_.locations&&(pt.loc=new ut(this,He,lt)),_.ranges&&(pt.range=[K,ge]),M.push(pt)}}var Yn=1,Gr=2,Nn=Yn|Gr,yn=4,zn=8,si=16,Gn=32,fi=64,ta=128;function zi(_,M){return Gr|(_?yn:0)|(M?zn:0)}var Ii=0,Ki=1,ra=2,Ya=3,na=4,ia=5,ki=function(M,B,O){this.options=M=Dt(M),this.sourceFile=M.sourceFile,this.keywords=Se(Re[M.ecmaVersion>=6?6:M.sourceType==="module"?"5module":5]);var K="";if(M.allowReserved!==!0){for(var ge=M.ecmaVersion;!(K=me[ge]);ge--);M.sourceType==="module"&&(K+=" await")}this.reservedWords=Se(K);var He=(K?K+" ":"")+me.strict;this.reservedWordsStrict=Se(He),this.reservedWordsStrictBind=Se(He+" "+me.strictBind),this.input=String(B),this.containsEsc=!1,O?(this.pos=O,this.lineStart=this.input.lastIndexOf(`
`,O-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(Xt).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=X.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=M.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&M.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(Yn),this.regexpState=null},qi={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};ki.prototype.parse=function(){var M=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(M)},qi.inFunction.get=function(){return(this.currentVarScope().flags&Gr)>0},qi.inGenerator.get=function(){return(this.currentVarScope().flags&zn)>0},qi.inAsync.get=function(){return(this.currentVarScope().flags&yn)>0},qi.allowSuper.get=function(){return(this.currentThisScope().flags&fi)>0},qi.allowDirectSuper.get=function(){return(this.currentThisScope().flags&ta)>0},qi.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},ki.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&Gr)>0},ki.extend=function(){for(var M=[],B=arguments.length;B--;)M[B]=arguments[B];for(var O=this,K=0;K<M.length;K++)O=M[K](O);return O},ki.parse=function(M,B){return new this(B,M).parse()},ki.parseExpressionAt=function(M,B,O){var K=new this(O,M,B);return K.nextToken(),K.parseExpression()},ki.tokenizer=function(M,B){return new this(B,M)},Object.defineProperties(ki.prototype,qi);var Gi=ki.prototype,Cs=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;Gi.strictDirective=function(_){for(;;){$e.lastIndex=_,_+=$e.exec(this.input)[0].length;var M=Cs.exec(this.input.slice(_));if(!M)return!1;if((M[1]||M[2])==="use strict"){$e.lastIndex=_+M[0].length;var B=$e.exec(this.input),O=B.index+B[0].length,K=this.input.charAt(O);return K===";"||K==="}"||Xt.test(B[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(K)||K==="!"&&this.input.charAt(O+1)==="=")}_+=M[0].length,$e.lastIndex=_,_+=$e.exec(this.input)[0].length,this.input[_]===";"&&_++}},Gi.eat=function(_){return this.type===_?(this.next(),!0):!1},Gi.isContextual=function(_){return this.type===X.name&&this.value===_&&!this.containsEsc},Gi.eatContextual=function(_){return this.isContextual(_)?(this.next(),!0):!1},Gi.expectContextual=function(_){this.eatContextual(_)||this.unexpected()},Gi.canInsertSemicolon=function(){return this.type===X.eof||this.type===X.braceR||Xt.test(this.input.slice(this.lastTokEnd,this.start))},Gi.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},Gi.semicolon=function(){!this.eat(X.semi)&&!this.insertSemicolon()&&this.unexpected()},Gi.afterTrailingComma=function(_,M){if(this.type===_)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),M||this.next(),!0},Gi.expect=function(_){this.eat(_)||this.unexpected()},Gi.unexpected=function(_){this.raise(_!=null?_:this.start,"Unexpected token")};function fe(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}Gi.checkPatternErrors=function(_,M){if(!!_){_.trailingComma>-1&&this.raiseRecoverable(_.trailingComma,"Comma is not permitted after the rest element");var B=M?_.parenthesizedAssign:_.parenthesizedBind;B>-1&&this.raiseRecoverable(B,"Parenthesized pattern")}},Gi.checkExpressionErrors=function(_,M){if(!_)return!1;var B=_.shorthandAssign,O=_.doubleProto;if(!M)return B>=0||O>=0;B>=0&&this.raise(B,"Shorthand property assignments are valid only in destructuring patterns"),O>=0&&this.raiseRecoverable(O,"Redefinition of __proto__ property")},Gi.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},Gi.isSimpleAssignTarget=function(_){return _.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(_.expression):_.type==="Identifier"||_.type==="MemberExpression"};var ui=ki.prototype;ui.parseTopLevel=function(_){var M={};for(_.body||(_.body=[]);this.type!==X.eof;){var B=this.parseStatement(null,!0,M);_.body.push(B)}if(this.inModule)for(var O=0,K=Object.keys(this.undefinedExports);O<K.length;O+=1){var ge=K[O];this.raiseRecoverable(this.undefinedExports[ge].start,"Export '"+ge+"' is not defined")}return this.adaptDirectivePrologue(_.body),this.next(),_.sourceType=this.options.sourceType,this.finishNode(_,"Program")};var bo={kind:"loop"},su={kind:"switch"};ui.isLet=function(_){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;$e.lastIndex=this.pos;var M=$e.exec(this.input),B=this.pos+M[0].length,O=this.input.charCodeAt(B);if(O===91)return!0;if(_)return!1;if(O===123)return!0;if(Bt(O,!0)){for(var K=B+1;or(this.input.charCodeAt(K),!0);)++K;var ge=this.input.slice(B,K);if(!W.test(ge))return!0}return!1},ui.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;$e.lastIndex=this.pos;var _=$e.exec(this.input),M=this.pos+_[0].length;return!Xt.test(this.input.slice(this.pos,M))&&this.input.slice(M,M+8)==="function"&&(M+8===this.input.length||!or(this.input.charAt(M+8)))},ui.parseStatement=function(_,M,B){var O=this.type,K=this.startNode(),ge;switch(this.isLet(_)&&(O=X._var,ge="let"),O){case X._break:case X._continue:return this.parseBreakContinueStatement(K,O.keyword);case X._debugger:return this.parseDebuggerStatement(K);case X._do:return this.parseDoStatement(K);case X._for:return this.parseForStatement(K);case X._function:return _&&(this.strict||_!=="if"&&_!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(K,!1,!_);case X._class:return _&&this.unexpected(),this.parseClass(K,!0);case X._if:return this.parseIfStatement(K);case X._return:return this.parseReturnStatement(K);case X._switch:return this.parseSwitchStatement(K);case X._throw:return this.parseThrowStatement(K);case X._try:return this.parseTryStatement(K);case X._const:case X._var:return ge=ge||this.value,_&&ge!=="var"&&this.unexpected(),this.parseVarStatement(K,ge);case X._while:return this.parseWhileStatement(K);case X._with:return this.parseWithStatement(K);case X.braceL:return this.parseBlock(!0,K);case X.semi:return this.parseEmptyStatement(K);case X._export:case X._import:if(this.options.ecmaVersion>10&&O===X._import){$e.lastIndex=this.pos;var He=$e.exec(this.input),lt=this.pos+He[0].length,pt=this.input.charCodeAt(lt);if(pt===40||pt===46)return this.parseExpressionStatement(K,this.parseExpression())}return this.options.allowImportExportEverywhere||(M||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),O===X._import?this.parseImport(K):this.parseExport(K,B);default:if(this.isAsyncFunction())return _&&this.unexpected(),this.next(),this.parseFunctionStatement(K,!0,!_);var nr=this.value,sr=this.parseExpression();return O===X.name&&sr.type==="Identifier"&&this.eat(X.colon)?this.parseLabeledStatement(K,nr,sr,_):this.parseExpressionStatement(K,sr)}},ui.parseBreakContinueStatement=function(_,M){var B=M==="break";this.next(),this.eat(X.semi)||this.insertSemicolon()?_.label=null:this.type!==X.name?this.unexpected():(_.label=this.parseIdent(),this.semicolon());for(var O=0;O<this.labels.length;++O){var K=this.labels[O];if((_.label==null||K.name===_.label.name)&&(K.kind!=null&&(B||K.kind==="loop")||_.label&&B))break}return O===this.labels.length&&this.raise(_.start,"Unsyntactic "+M),this.finishNode(_,B?"BreakStatement":"ContinueStatement")},ui.parseDebuggerStatement=function(_){return this.next(),this.semicolon(),this.finishNode(_,"DebuggerStatement")},ui.parseDoStatement=function(_){return this.next(),this.labels.push(bo),_.body=this.parseStatement("do"),this.labels.pop(),this.expect(X._while),_.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(X.semi):this.semicolon(),this.finishNode(_,"DoWhileStatement")},ui.parseForStatement=function(_){this.next();var M=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(bo),this.enterScope(0),this.expect(X.parenL),this.type===X.semi)return M>-1&&this.unexpected(M),this.parseFor(_,null);var B=this.isLet();if(this.type===X._var||this.type===X._const||B){var O=this.startNode(),K=B?"let":this.value;return this.next(),this.parseVar(O,!0,K),this.finishNode(O,"VariableDeclaration"),(this.type===X._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&O.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===X._in?M>-1&&this.unexpected(M):_.await=M>-1),this.parseForIn(_,O)):(M>-1&&this.unexpected(M),this.parseFor(_,O))}var ge=new fe,He=this.parseExpression(!0,ge);return this.type===X._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===X._in?M>-1&&this.unexpected(M):_.await=M>-1),this.toAssignable(He,!1,ge),this.checkLVal(He),this.parseForIn(_,He)):(this.checkExpressionErrors(ge,!0),M>-1&&this.unexpected(M),this.parseFor(_,He))},ui.parseFunctionStatement=function(_,M,B){return this.next(),this.parseFunction(_,er|(B?0:Rr),!1,M)},ui.parseIfStatement=function(_){return this.next(),_.test=this.parseParenExpression(),_.consequent=this.parseStatement("if"),_.alternate=this.eat(X._else)?this.parseStatement("if"):null,this.finishNode(_,"IfStatement")},ui.parseReturnStatement=function(_){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(X.semi)||this.insertSemicolon()?_.argument=null:(_.argument=this.parseExpression(),this.semicolon()),this.finishNode(_,"ReturnStatement")},ui.parseSwitchStatement=function(_){this.next(),_.discriminant=this.parseParenExpression(),_.cases=[],this.expect(X.braceL),this.labels.push(su),this.enterScope(0);for(var M,B=!1;this.type!==X.braceR;)if(this.type===X._case||this.type===X._default){var O=this.type===X._case;M&&this.finishNode(M,"SwitchCase"),_.cases.push(M=this.startNode()),M.consequent=[],this.next(),O?M.test=this.parseExpression():(B&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),B=!0,M.test=null),this.expect(X.colon)}else M||this.unexpected(),M.consequent.push(this.parseStatement(null));return this.exitScope(),M&&this.finishNode(M,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(_,"SwitchStatement")},ui.parseThrowStatement=function(_){return this.next(),Xt.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),_.argument=this.parseExpression(),this.semicolon(),this.finishNode(_,"ThrowStatement")};var Ut=[];ui.parseTryStatement=function(_){if(this.next(),_.block=this.parseBlock(),_.handler=null,this.type===X._catch){var M=this.startNode();if(this.next(),this.eat(X.parenL)){M.param=this.parseBindingAtom();var B=M.param.type==="Identifier";this.enterScope(B?Gn:0),this.checkLVal(M.param,B?na:ra),this.expect(X.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),M.param=null,this.enterScope(0);M.body=this.parseBlock(!1),this.exitScope(),_.handler=this.finishNode(M,"CatchClause")}return _.finalizer=this.eat(X._finally)?this.parseBlock():null,!_.handler&&!_.finalizer&&this.raise(_.start,"Missing catch or finally clause"),this.finishNode(_,"TryStatement")},ui.parseVarStatement=function(_,M){return this.next(),this.parseVar(_,!1,M),this.semicolon(),this.finishNode(_,"VariableDeclaration")},ui.parseWhileStatement=function(_){return this.next(),_.test=this.parseParenExpression(),this.labels.push(bo),_.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(_,"WhileStatement")},ui.parseWithStatement=function(_){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),_.object=this.parseParenExpression(),_.body=this.parseStatement("with"),this.finishNode(_,"WithStatement")},ui.parseEmptyStatement=function(_){return this.next(),this.finishNode(_,"EmptyStatement")},ui.parseLabeledStatement=function(_,M,B,O){for(var K=0,ge=this.labels;K<ge.length;K+=1){var He=ge[K];He.name===M&&this.raise(B.start,"Label '"+M+"' is already declared")}for(var lt=this.type.isLoop?"loop":this.type===X._switch?"switch":null,pt=this.labels.length-1;pt>=0;pt--){var nr=this.labels[pt];if(nr.statementStart===_.start)nr.statementStart=this.start,nr.kind=lt;else break}return this.labels.push({name:M,kind:lt,statementStart:this.start}),_.body=this.parseStatement(O?O.indexOf("label")===-1?O+"label":O:"label"),this.labels.pop(),_.label=B,this.finishNode(_,"LabeledStatement")},ui.parseExpressionStatement=function(_,M){return _.expression=M,this.semicolon(),this.finishNode(_,"ExpressionStatement")},ui.parseBlock=function(_,M,B){for(_===void 0&&(_=!0),M===void 0&&(M=this.startNode()),M.body=[],this.expect(X.braceL),_&&this.enterScope(0);this.type!==X.braceR;){var O=this.parseStatement(null);M.body.push(O)}return B&&(this.strict=!1),this.next(),_&&this.exitScope(),this.finishNode(M,"BlockStatement")},ui.parseFor=function(_,M){return _.init=M,this.expect(X.semi),_.test=this.type===X.semi?null:this.parseExpression(),this.expect(X.semi),_.update=this.type===X.parenR?null:this.parseExpression(),this.expect(X.parenR),_.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(_,"ForStatement")},ui.parseForIn=function(_,M){var B=this.type===X._in;return this.next(),M.type==="VariableDeclaration"&&M.declarations[0].init!=null&&(!B||this.options.ecmaVersion<8||this.strict||M.kind!=="var"||M.declarations[0].id.type!=="Identifier")?this.raise(M.start,(B?"for-in":"for-of")+" loop variable declaration may not have an initializer"):M.type==="AssignmentPattern"&&this.raise(M.start,"Invalid left-hand side in for-loop"),_.left=M,_.right=B?this.parseExpression():this.parseMaybeAssign(),this.expect(X.parenR),_.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(_,B?"ForInStatement":"ForOfStatement")},ui.parseVar=function(_,M,B){for(_.declarations=[],_.kind=B;;){var O=this.startNode();if(this.parseVarId(O,B),this.eat(X.eq)?O.init=this.parseMaybeAssign(M):B==="const"&&!(this.type===X._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():O.id.type!=="Identifier"&&!(M&&(this.type===X._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):O.init=null,_.declarations.push(this.finishNode(O,"VariableDeclarator")),!this.eat(X.comma))break}return _},ui.parseVarId=function(_,M){_.id=this.parseBindingAtom(),this.checkLVal(_.id,M==="var"?Ki:ra,!1)};var er=1,Rr=2,an=4;ui.parseFunction=function(_,M,B,O){this.initFunction(_),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!O)&&(this.type===X.star&&M&Rr&&this.unexpected(),_.generator=this.eat(X.star)),this.options.ecmaVersion>=8&&(_.async=!!O),M&er&&(_.id=M&an&&this.type!==X.name?null:this.parseIdent(),_.id&&!(M&Rr)&&this.checkLVal(_.id,this.strict||_.generator||_.async?this.treatFunctionsAsVar?Ki:ra:Ya));var K=this.yieldPos,ge=this.awaitPos,He=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(zi(_.async,_.generator)),M&er||(_.id=this.type===X.name?this.parseIdent():null),this.parseFunctionParams(_),this.parseFunctionBody(_,B,!1),this.yieldPos=K,this.awaitPos=ge,this.awaitIdentPos=He,this.finishNode(_,M&er?"FunctionDeclaration":"FunctionExpression")},ui.parseFunctionParams=function(_){this.expect(X.parenL),_.params=this.parseBindingList(X.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},ui.parseClass=function(_,M){this.next();var B=this.strict;this.strict=!0,this.parseClassId(_,M),this.parseClassSuper(_);var O=this.startNode(),K=!1;for(O.body=[],this.expect(X.braceL);this.type!==X.braceR;){var ge=this.parseClassElement(_.superClass!==null);ge&&(O.body.push(ge),ge.type==="MethodDefinition"&&ge.kind==="constructor"&&(K&&this.raise(ge.start,"Duplicate constructor in the same class"),K=!0))}return this.strict=B,this.next(),_.body=this.finishNode(O,"ClassBody"),this.finishNode(_,M?"ClassDeclaration":"ClassExpression")},ui.parseClassElement=function(_){var M=this;if(this.eat(X.semi))return null;var B=this.startNode(),O=function(pt,nr){nr===void 0&&(nr=!1);var sr=M.start,Mn=M.startLoc;return M.eatContextual(pt)?M.type!==X.parenL&&(!nr||!M.canInsertSemicolon())?!0:(B.key&&M.unexpected(),B.computed=!1,B.key=M.startNodeAt(sr,Mn),B.key.name=pt,M.finishNode(B.key,"Identifier"),!1):!1};B.kind="method",B.static=O("static");var K=this.eat(X.star),ge=!1;K||(this.options.ecmaVersion>=8&&O("async",!0)?(ge=!0,K=this.options.ecmaVersion>=9&&this.eat(X.star)):O("get")?B.kind="get":O("set")&&(B.kind="set")),B.key||this.parsePropertyName(B);var He=B.key,lt=!1;return!B.computed&&!B.static&&(He.type==="Identifier"&&He.name==="constructor"||He.type==="Literal"&&He.value==="constructor")?(B.kind!=="method"&&this.raise(He.start,"Constructor can't have get/set modifier"),K&&this.raise(He.start,"Constructor can't be a generator"),ge&&this.raise(He.start,"Constructor can't be an async method"),B.kind="constructor",lt=_):B.static&&He.type==="Identifier"&&He.name==="prototype"&&this.raise(He.start,"Classes may not have a static property named prototype"),this.parseClassMethod(B,K,ge,lt),B.kind==="get"&&B.value.params.length!==0&&this.raiseRecoverable(B.value.start,"getter should have no params"),B.kind==="set"&&B.value.params.length!==1&&this.raiseRecoverable(B.value.start,"setter should have exactly one param"),B.kind==="set"&&B.value.params[0].type==="RestElement"&&this.raiseRecoverable(B.value.params[0].start,"Setter cannot use rest params"),B},ui.parseClassMethod=function(_,M,B,O){return _.value=this.parseMethod(M,B,O),this.finishNode(_,"MethodDefinition")},ui.parseClassId=function(_,M){this.type===X.name?(_.id=this.parseIdent(),M&&this.checkLVal(_.id,ra,!1)):(M===!0&&this.unexpected(),_.id=null)},ui.parseClassSuper=function(_){_.superClass=this.eat(X._extends)?this.parseExprSubscripts():null},ui.parseExport=function(_,M){if(this.next(),this.eat(X.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(_.exported=this.parseIdent(!0),this.checkExport(M,_.exported.name,this.lastTokStart)):_.exported=null),this.expectContextual("from"),this.type!==X.string&&this.unexpected(),_.source=this.parseExprAtom(),this.semicolon(),this.finishNode(_,"ExportAllDeclaration");if(this.eat(X._default)){this.checkExport(M,"default",this.lastTokStart);var B;if(this.type===X._function||(B=this.isAsyncFunction())){var O=this.startNode();this.next(),B&&this.next(),_.declaration=this.parseFunction(O,er|an,!1,B)}else if(this.type===X._class){var K=this.startNode();_.declaration=this.parseClass(K,"nullableID")}else _.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(_,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())_.declaration=this.parseStatement(null),_.declaration.type==="VariableDeclaration"?this.checkVariableExport(M,_.declaration.declarations):this.checkExport(M,_.declaration.id.name,_.declaration.id.start),_.specifiers=[],_.source=null;else{if(_.declaration=null,_.specifiers=this.parseExportSpecifiers(M),this.eatContextual("from"))this.type!==X.string&&this.unexpected(),_.source=this.parseExprAtom();else{for(var ge=0,He=_.specifiers;ge<He.length;ge+=1){var lt=He[ge];this.checkUnreserved(lt.local),this.checkLocalExport(lt.local)}_.source=null}this.semicolon()}return this.finishNode(_,"ExportNamedDeclaration")},ui.checkExport=function(_,M,B){!_||(Yr(_,M)&&this.raiseRecoverable(B,"Duplicate export '"+M+"'"),_[M]=!0)},ui.checkPatternExport=function(_,M){var B=M.type;if(B==="Identifier")this.checkExport(_,M.name,M.start);else if(B==="ObjectPattern")for(var O=0,K=M.properties;O<K.length;O+=1){var ge=K[O];this.checkPatternExport(_,ge)}else if(B==="ArrayPattern")for(var He=0,lt=M.elements;He<lt.length;He+=1){var pt=lt[He];pt&&this.checkPatternExport(_,pt)}else B==="Property"?this.checkPatternExport(_,M.value):B==="AssignmentPattern"?this.checkPatternExport(_,M.left):B==="RestElement"?this.checkPatternExport(_,M.argument):B==="ParenthesizedExpression"&&this.checkPatternExport(_,M.expression)},ui.checkVariableExport=function(_,M){if(!!_)for(var B=0,O=M;B<O.length;B+=1){var K=O[B];this.checkPatternExport(_,K.id)}},ui.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},ui.parseExportSpecifiers=function(_){var M=[],B=!0;for(this.expect(X.braceL);!this.eat(X.braceR);){if(B)B=!1;else if(this.expect(X.comma),this.afterTrailingComma(X.braceR))break;var O=this.startNode();O.local=this.parseIdent(!0),O.exported=this.eatContextual("as")?this.parseIdent(!0):O.local,this.checkExport(_,O.exported.name,O.exported.start),M.push(this.finishNode(O,"ExportSpecifier"))}return M},ui.parseImport=function(_){return this.next(),this.type===X.string?(_.specifiers=Ut,_.source=this.parseExprAtom()):(_.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),_.source=this.type===X.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(_,"ImportDeclaration")},ui.parseImportSpecifiers=function(){var _=[],M=!0;if(this.type===X.name){var B=this.startNode();if(B.local=this.parseIdent(),this.checkLVal(B.local,ra),_.push(this.finishNode(B,"ImportDefaultSpecifier")),!this.eat(X.comma))return _}if(this.type===X.star){var O=this.startNode();return this.next(),this.expectContextual("as"),O.local=this.parseIdent(),this.checkLVal(O.local,ra),_.push(this.finishNode(O,"ImportNamespaceSpecifier")),_}for(this.expect(X.braceL);!this.eat(X.braceR);){if(M)M=!1;else if(this.expect(X.comma),this.afterTrailingComma(X.braceR))break;var K=this.startNode();K.imported=this.parseIdent(!0),this.eatContextual("as")?K.local=this.parseIdent():(this.checkUnreserved(K.imported),K.local=K.imported),this.checkLVal(K.local,ra),_.push(this.finishNode(K,"ImportSpecifier"))}return _},ui.adaptDirectivePrologue=function(_){for(var M=0;M<_.length&&this.isDirectiveCandidate(_[M]);++M)_[M].directive=_[M].expression.raw.slice(1,-1)},ui.isDirectiveCandidate=function(_){return _.type==="ExpressionStatement"&&_.expression.type==="Literal"&&typeof _.expression.value=="string"&&(this.input[_.start]==='"'||this.input[_.start]==="'")};var Tn=ki.prototype;Tn.toAssignable=function(_,M,B){if(this.options.ecmaVersion>=6&&_)switch(_.type){case"Identifier":this.inAsync&&_.name==="await"&&this.raise(_.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":_.type="ObjectPattern",B&&this.checkPatternErrors(B,!0);for(var O=0,K=_.properties;O<K.length;O+=1){var ge=K[O];this.toAssignable(ge,M),ge.type==="RestElement"&&(ge.argument.type==="ArrayPattern"||ge.argument.type==="ObjectPattern")&&this.raise(ge.argument.start,"Unexpected token")}break;case"Property":_.kind!=="init"&&this.raise(_.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(_.value,M);break;case"ArrayExpression":_.type="ArrayPattern",B&&this.checkPatternErrors(B,!0),this.toAssignableList(_.elements,M);break;case"SpreadElement":_.type="RestElement",this.toAssignable(_.argument,M),_.argument.type==="AssignmentPattern"&&this.raise(_.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":_.operator!=="="&&this.raise(_.left.end,"Only '=' operator can be used for specifying default value."),_.type="AssignmentPattern",delete _.operator,this.toAssignable(_.left,M);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(_.expression,M,B);break;case"ChainExpression":this.raiseRecoverable(_.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!M)break;default:this.raise(_.start,"Assigning to rvalue")}else B&&this.checkPatternErrors(B,!0);return _},Tn.toAssignableList=function(_,M){for(var B=_.length,O=0;O<B;O++){var K=_[O];K&&this.toAssignable(K,M)}if(B){var ge=_[B-1];this.options.ecmaVersion===6&&M&&ge&&ge.type==="RestElement"&&ge.argument.type!=="Identifier"&&this.unexpected(ge.argument.start)}return _},Tn.parseSpread=function(_){var M=this.startNode();return this.next(),M.argument=this.parseMaybeAssign(!1,_),this.finishNode(M,"SpreadElement")},Tn.parseRestBinding=function(){var _=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==X.name&&this.unexpected(),_.argument=this.parseBindingAtom(),this.finishNode(_,"RestElement")},Tn.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case X.bracketL:var _=this.startNode();return this.next(),_.elements=this.parseBindingList(X.bracketR,!0,!0),this.finishNode(_,"ArrayPattern");case X.braceL:return this.parseObj(!0)}return this.parseIdent()},Tn.parseBindingList=function(_,M,B){for(var O=[],K=!0;!this.eat(_);)if(K?K=!1:this.expect(X.comma),M&&this.type===X.comma)O.push(null);else{if(B&&this.afterTrailingComma(_))break;if(this.type===X.ellipsis){var ge=this.parseRestBinding();this.parseBindingListItem(ge),O.push(ge),this.type===X.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(_);break}else{var He=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(He),O.push(He)}}return O},Tn.parseBindingListItem=function(_){return _},Tn.parseMaybeDefault=function(_,M,B){if(B=B||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(X.eq))return B;var O=this.startNodeAt(_,M);return O.left=B,O.right=this.parseMaybeAssign(),this.finishNode(O,"AssignmentPattern")},Tn.checkLVal=function(_,M,B){switch(M===void 0&&(M=Ii),_.type){case"Identifier":M===ra&&_.name==="let"&&this.raiseRecoverable(_.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(_.name)&&this.raiseRecoverable(_.start,(M?"Binding ":"Assigning to ")+_.name+" in strict mode"),B&&(Yr(B,_.name)&&this.raiseRecoverable(_.start,"Argument name clash"),B[_.name]=!0),M!==Ii&&M!==ia&&this.declareName(_.name,M,_.start);break;case"ChainExpression":this.raiseRecoverable(_.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":M&&this.raiseRecoverable(_.start,"Binding member expression");break;case"ObjectPattern":for(var O=0,K=_.properties;O<K.length;O+=1){var ge=K[O];this.checkLVal(ge,M,B)}break;case"Property":this.checkLVal(_.value,M,B);break;case"ArrayPattern":for(var He=0,lt=_.elements;He<lt.length;He+=1){var pt=lt[He];pt&&this.checkLVal(pt,M,B)}break;case"AssignmentPattern":this.checkLVal(_.left,M,B);break;case"RestElement":this.checkLVal(_.argument,M,B);break;case"ParenthesizedExpression":this.checkLVal(_.expression,M,B);break;default:this.raise(_.start,(M?"Binding":"Assigning to")+" rvalue")}};var Un=ki.prototype;Un.checkPropClash=function(_,M,B){if(!(this.options.ecmaVersion>=9&&_.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(_.computed||_.method||_.shorthand))){var O=_.key,K;switch(O.type){case"Identifier":K=O.name;break;case"Literal":K=String(O.value);break;default:return}var ge=_.kind;if(this.options.ecmaVersion>=6){K==="__proto__"&&ge==="init"&&(M.proto&&(B?B.doubleProto<0&&(B.doubleProto=O.start):this.raiseRecoverable(O.start,"Redefinition of __proto__ property")),M.proto=!0);return}K="$"+K;var He=M[K];if(He){var lt;ge==="init"?lt=this.strict&&He.init||He.get||He.set:lt=He.init||He[ge],lt&&this.raiseRecoverable(O.start,"Redefinition of property")}else He=M[K]={init:!1,get:!1,set:!1};He[ge]=!0}},Un.parseExpression=function(_,M){var B=this.start,O=this.startLoc,K=this.parseMaybeAssign(_,M);if(this.type===X.comma){var ge=this.startNodeAt(B,O);for(ge.expressions=[K];this.eat(X.comma);)ge.expressions.push(this.parseMaybeAssign(_,M));return this.finishNode(ge,"SequenceExpression")}return K},Un.parseMaybeAssign=function(_,M,B){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(_);this.exprAllowed=!1}var O=!1,K=-1,ge=-1;M?(K=M.parenthesizedAssign,ge=M.trailingComma,M.parenthesizedAssign=M.trailingComma=-1):(M=new fe,O=!0);var He=this.start,lt=this.startLoc;(this.type===X.parenL||this.type===X.name)&&(this.potentialArrowAt=this.start);var pt=this.parseMaybeConditional(_,M);if(B&&(pt=B.call(this,pt,He,lt)),this.type.isAssign){var nr=this.startNodeAt(He,lt);return nr.operator=this.value,nr.left=this.type===X.eq?this.toAssignable(pt,!1,M):pt,O||(M.parenthesizedAssign=M.trailingComma=M.doubleProto=-1),M.shorthandAssign>=nr.left.start&&(M.shorthandAssign=-1),this.checkLVal(pt),this.next(),nr.right=this.parseMaybeAssign(_),this.finishNode(nr,"AssignmentExpression")}else O&&this.checkExpressionErrors(M,!0);return K>-1&&(M.parenthesizedAssign=K),ge>-1&&(M.trailingComma=ge),pt},Un.parseMaybeConditional=function(_,M){var B=this.start,O=this.startLoc,K=this.parseExprOps(_,M);if(this.checkExpressionErrors(M))return K;if(this.eat(X.question)){var ge=this.startNodeAt(B,O);return ge.test=K,ge.consequent=this.parseMaybeAssign(),this.expect(X.colon),ge.alternate=this.parseMaybeAssign(_),this.finishNode(ge,"ConditionalExpression")}return K},Un.parseExprOps=function(_,M){var B=this.start,O=this.startLoc,K=this.parseMaybeUnary(M,!1);return this.checkExpressionErrors(M)||K.start===B&&K.type==="ArrowFunctionExpression"?K:this.parseExprOp(K,B,O,-1,_)},Un.parseExprOp=function(_,M,B,O,K){var ge=this.type.binop;if(ge!=null&&(!K||this.type!==X._in)&&ge>O){var He=this.type===X.logicalOR||this.type===X.logicalAND,lt=this.type===X.coalesce;lt&&(ge=X.logicalAND.binop);var pt=this.value;this.next();var nr=this.start,sr=this.startLoc,Mn=this.parseExprOp(this.parseMaybeUnary(null,!1),nr,sr,ge,K),ri=this.buildBinary(M,B,_,Mn,pt,He||lt);return(He&&this.type===X.coalesce||lt&&(this.type===X.logicalOR||this.type===X.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(ri,M,B,O,K)}return _},Un.buildBinary=function(_,M,B,O,K,ge){var He=this.startNodeAt(_,M);return He.left=B,He.operator=K,He.right=O,this.finishNode(He,ge?"LogicalExpression":"BinaryExpression")},Un.parseMaybeUnary=function(_,M){var B=this.start,O=this.startLoc,K;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))K=this.parseAwait(),M=!0;else if(this.type.prefix){var ge=this.startNode(),He=this.type===X.incDec;ge.operator=this.value,ge.prefix=!0,this.next(),ge.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(_,!0),He?this.checkLVal(ge.argument):this.strict&&ge.operator==="delete"&&ge.argument.type==="Identifier"?this.raiseRecoverable(ge.start,"Deleting local variable in strict mode"):M=!0,K=this.finishNode(ge,He?"UpdateExpression":"UnaryExpression")}else{if(K=this.parseExprSubscripts(_),this.checkExpressionErrors(_))return K;for(;this.type.postfix&&!this.canInsertSemicolon();){var lt=this.startNodeAt(B,O);lt.operator=this.value,lt.prefix=!1,lt.argument=K,this.checkLVal(K),this.next(),K=this.finishNode(lt,"UpdateExpression")}}return!M&&this.eat(X.starstar)?this.buildBinary(B,O,K,this.parseMaybeUnary(null,!1),"**",!1):K},Un.parseExprSubscripts=function(_){var M=this.start,B=this.startLoc,O=this.parseExprAtom(_);if(O.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return O;var K=this.parseSubscripts(O,M,B);return _&&K.type==="MemberExpression"&&(_.parenthesizedAssign>=K.start&&(_.parenthesizedAssign=-1),_.parenthesizedBind>=K.start&&(_.parenthesizedBind=-1)),K},Un.parseSubscripts=function(_,M,B,O){for(var K=this.options.ecmaVersion>=8&&_.type==="Identifier"&&_.name==="async"&&this.lastTokEnd===_.end&&!this.canInsertSemicolon()&&_.end-_.start==5&&this.potentialArrowAt===_.start,ge=!1;;){var He=this.parseSubscript(_,M,B,O,K,ge);if(He.optional&&(ge=!0),He===_||He.type==="ArrowFunctionExpression"){if(ge){var lt=this.startNodeAt(M,B);lt.expression=He,He=this.finishNode(lt,"ChainExpression")}return He}_=He}},Un.parseSubscript=function(_,M,B,O,K,ge){var He=this.options.ecmaVersion>=11,lt=He&&this.eat(X.questionDot);O&&lt&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var pt=this.eat(X.bracketL);if(pt||lt&&this.type!==X.parenL&&this.type!==X.backQuote||this.eat(X.dot)){var nr=this.startNodeAt(M,B);nr.object=_,nr.property=pt?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),nr.computed=!!pt,pt&&this.expect(X.bracketR),He&&(nr.optional=lt),_=this.finishNode(nr,"MemberExpression")}else if(!O&&this.eat(X.parenL)){var sr=new fe,Mn=this.yieldPos,ri=this.awaitPos,kn=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var Wi=this.parseExprList(X.parenR,this.options.ecmaVersion>=8,!1,sr);if(K&&!lt&&!this.canInsertSemicolon()&&this.eat(X.arrow))return this.checkPatternErrors(sr,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=Mn,this.awaitPos=ri,this.awaitIdentPos=kn,this.parseArrowExpression(this.startNodeAt(M,B),Wi,!0);this.checkExpressionErrors(sr,!0),this.yieldPos=Mn||this.yieldPos,this.awaitPos=ri||this.awaitPos,this.awaitIdentPos=kn||this.awaitIdentPos;var da=this.startNodeAt(M,B);da.callee=_,da.arguments=Wi,He&&(da.optional=lt),_=this.finishNode(da,"CallExpression")}else if(this.type===X.backQuote){(lt||ge)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var Sa=this.startNodeAt(M,B);Sa.tag=_,Sa.quasi=this.parseTemplate({isTagged:!0}),_=this.finishNode(Sa,"TaggedTemplateExpression")}return _},Un.parseExprAtom=function(_){this.type===X.slash&&this.readRegexp();var M,B=this.potentialArrowAt===this.start;switch(this.type){case X._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),M=this.startNode(),this.next(),this.type===X.parenL&&!this.allowDirectSuper&&this.raise(M.start,"super() call outside constructor of a subclass"),this.type!==X.dot&&this.type!==X.bracketL&&this.type!==X.parenL&&this.unexpected(),this.finishNode(M,"Super");case X._this:return M=this.startNode(),this.next(),this.finishNode(M,"ThisExpression");case X.name:var O=this.start,K=this.startLoc,ge=this.containsEsc,He=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!ge&&He.name==="async"&&!this.canInsertSemicolon()&&this.eat(X._function))return this.parseFunction(this.startNodeAt(O,K),0,!1,!0);if(B&&!this.canInsertSemicolon()){if(this.eat(X.arrow))return this.parseArrowExpression(this.startNodeAt(O,K),[He],!1);if(this.options.ecmaVersion>=8&&He.name==="async"&&this.type===X.name&&!ge)return He=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(X.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(O,K),[He],!0)}return He;case X.regexp:var lt=this.value;return M=this.parseLiteral(lt.value),M.regex={pattern:lt.pattern,flags:lt.flags},M;case X.num:case X.string:return this.parseLiteral(this.value);case X._null:case X._true:case X._false:return M=this.startNode(),M.value=this.type===X._null?null:this.type===X._true,M.raw=this.type.keyword,this.next(),this.finishNode(M,"Literal");case X.parenL:var pt=this.start,nr=this.parseParenAndDistinguishExpression(B);return _&&(_.parenthesizedAssign<0&&!this.isSimpleAssignTarget(nr)&&(_.parenthesizedAssign=pt),_.parenthesizedBind<0&&(_.parenthesizedBind=pt)),nr;case X.bracketL:return M=this.startNode(),this.next(),M.elements=this.parseExprList(X.bracketR,!0,!0,_),this.finishNode(M,"ArrayExpression");case X.braceL:return this.parseObj(!1,_);case X._function:return M=this.startNode(),this.next(),this.parseFunction(M,0);case X._class:return this.parseClass(this.startNode(),!1);case X._new:return this.parseNew();case X.backQuote:return this.parseTemplate();case X._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},Un.parseExprImport=function(){var _=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var M=this.parseIdent(!0);switch(this.type){case X.parenL:return this.parseDynamicImport(_);case X.dot:return _.meta=M,this.parseImportMeta(_);default:this.unexpected()}},Un.parseDynamicImport=function(_){if(this.next(),_.source=this.parseMaybeAssign(),!this.eat(X.parenR)){var M=this.start;this.eat(X.comma)&&this.eat(X.parenR)?this.raiseRecoverable(M,"Trailing comma is not allowed in import()"):this.unexpected(M)}return this.finishNode(_,"ImportExpression")},Un.parseImportMeta=function(_){this.next();var M=this.containsEsc;return _.property=this.parseIdent(!0),_.property.name!=="meta"&&this.raiseRecoverable(_.property.start,"The only valid meta property for import is 'import.meta'"),M&&this.raiseRecoverable(_.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(_.start,"Cannot use 'import.meta' outside a module"),this.finishNode(_,"MetaProperty")},Un.parseLiteral=function(_){var M=this.startNode();return M.value=_,M.raw=this.input.slice(this.start,this.end),M.raw.charCodeAt(M.raw.length-1)===110&&(M.bigint=M.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(M,"Literal")},Un.parseParenExpression=function(){this.expect(X.parenL);var _=this.parseExpression();return this.expect(X.parenR),_},Un.parseParenAndDistinguishExpression=function(_){var M=this.start,B=this.startLoc,O,K=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var ge=this.start,He=this.startLoc,lt=[],pt=!0,nr=!1,sr=new fe,Mn=this.yieldPos,ri=this.awaitPos,kn;for(this.yieldPos=0,this.awaitPos=0;this.type!==X.parenR;)if(pt?pt=!1:this.expect(X.comma),K&&this.afterTrailingComma(X.parenR,!0)){nr=!0;break}else if(this.type===X.ellipsis){kn=this.start,lt.push(this.parseParenItem(this.parseRestBinding())),this.type===X.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else lt.push(this.parseMaybeAssign(!1,sr,this.parseParenItem));var Wi=this.start,da=this.startLoc;if(this.expect(X.parenR),_&&!this.canInsertSemicolon()&&this.eat(X.arrow))return this.checkPatternErrors(sr,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=Mn,this.awaitPos=ri,this.parseParenArrowList(M,B,lt);(!lt.length||nr)&&this.unexpected(this.lastTokStart),kn&&this.unexpected(kn),this.checkExpressionErrors(sr,!0),this.yieldPos=Mn||this.yieldPos,this.awaitPos=ri||this.awaitPos,lt.length>1?(O=this.startNodeAt(ge,He),O.expressions=lt,this.finishNodeAt(O,"SequenceExpression",Wi,da)):O=lt[0]}else O=this.parseParenExpression();if(this.options.preserveParens){var Sa=this.startNodeAt(M,B);return Sa.expression=O,this.finishNode(Sa,"ParenthesizedExpression")}else return O},Un.parseParenItem=function(_){return _},Un.parseParenArrowList=function(_,M,B){return this.parseArrowExpression(this.startNodeAt(_,M),B)};var bi=[];Un.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var _=this.startNode(),M=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(X.dot)){_.meta=M;var B=this.containsEsc;return _.property=this.parseIdent(!0),_.property.name!=="target"&&this.raiseRecoverable(_.property.start,"The only valid meta property for new is 'new.target'"),B&&this.raiseRecoverable(_.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(_.start,"'new.target' can only be used in functions"),this.finishNode(_,"MetaProperty")}var O=this.start,K=this.startLoc,ge=this.type===X._import;return _.callee=this.parseSubscripts(this.parseExprAtom(),O,K,!0),ge&&_.callee.type==="ImportExpression"&&this.raise(O,"Cannot use new with import()"),this.eat(X.parenL)?_.arguments=this.parseExprList(X.parenR,this.options.ecmaVersion>=8,!1):_.arguments=bi,this.finishNode(_,"NewExpression")},Un.parseTemplateElement=function(_){var M=_.isTagged,B=this.startNode();return this.type===X.invalidTemplate?(M||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),B.value={raw:this.value,cooked:null}):B.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),B.tail=this.type===X.backQuote,this.finishNode(B,"TemplateElement")},Un.parseTemplate=function(_){_===void 0&&(_={});var M=_.isTagged;M===void 0&&(M=!1);var B=this.startNode();this.next(),B.expressions=[];var O=this.parseTemplateElement({isTagged:M});for(B.quasis=[O];!O.tail;)this.type===X.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(X.dollarBraceL),B.expressions.push(this.parseExpression()),this.expect(X.braceR),B.quasis.push(O=this.parseTemplateElement({isTagged:M}));return this.next(),this.finishNode(B,"TemplateLiteral")},Un.isAsyncProp=function(_){return!_.computed&&_.key.type==="Identifier"&&_.key.name==="async"&&(this.type===X.name||this.type===X.num||this.type===X.string||this.type===X.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===X.star)&&!Xt.test(this.input.slice(this.lastTokEnd,this.start))},Un.parseObj=function(_,M){var B=this.startNode(),O=!0,K={};for(B.properties=[],this.next();!this.eat(X.braceR);){if(O)O=!1;else if(this.expect(X.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(X.braceR))break;var ge=this.parseProperty(_,M);_||this.checkPropClash(ge,K,M),B.properties.push(ge)}return this.finishNode(B,_?"ObjectPattern":"ObjectExpression")},Un.parseProperty=function(_,M){var B=this.startNode(),O,K,ge,He;if(this.options.ecmaVersion>=9&&this.eat(X.ellipsis))return _?(B.argument=this.parseIdent(!1),this.type===X.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(B,"RestElement")):(this.type===X.parenL&&M&&(M.parenthesizedAssign<0&&(M.parenthesizedAssign=this.start),M.parenthesizedBind<0&&(M.parenthesizedBind=this.start)),B.argument=this.parseMaybeAssign(!1,M),this.type===X.comma&&M&&M.trailingComma<0&&(M.trailingComma=this.start),this.finishNode(B,"SpreadElement"));this.options.ecmaVersion>=6&&(B.method=!1,B.shorthand=!1,(_||M)&&(ge=this.start,He=this.startLoc),_||(O=this.eat(X.star)));var lt=this.containsEsc;return this.parsePropertyName(B),!_&&!lt&&this.options.ecmaVersion>=8&&!O&&this.isAsyncProp(B)?(K=!0,O=this.options.ecmaVersion>=9&&this.eat(X.star),this.parsePropertyName(B,M)):K=!1,this.parsePropertyValue(B,_,O,K,ge,He,M,lt),this.finishNode(B,"Property")},Un.parsePropertyValue=function(_,M,B,O,K,ge,He,lt){if((B||O)&&this.type===X.colon&&this.unexpected(),this.eat(X.colon))_.value=M?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,He),_.kind="init";else if(this.options.ecmaVersion>=6&&this.type===X.parenL)M&&this.unexpected(),_.kind="init",_.method=!0,_.value=this.parseMethod(B,O);else if(!M&&!lt&&this.options.ecmaVersion>=5&&!_.computed&&_.key.type==="Identifier"&&(_.key.name==="get"||_.key.name==="set")&&this.type!==X.comma&&this.type!==X.braceR&&this.type!==X.eq){(B||O)&&this.unexpected(),_.kind=_.key.name,this.parsePropertyName(_),_.value=this.parseMethod(!1);var pt=_.kind==="get"?0:1;if(_.value.params.length!==pt){var nr=_.value.start;_.kind==="get"?this.raiseRecoverable(nr,"getter should have no params"):this.raiseRecoverable(nr,"setter should have exactly one param")}else _.kind==="set"&&_.value.params[0].type==="RestElement"&&this.raiseRecoverable(_.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!_.computed&&_.key.type==="Identifier"?((B||O)&&this.unexpected(),this.checkUnreserved(_.key),_.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=K),_.kind="init",M?_.value=this.parseMaybeDefault(K,ge,_.key):this.type===X.eq&&He?(He.shorthandAssign<0&&(He.shorthandAssign=this.start),_.value=this.parseMaybeDefault(K,ge,_.key)):_.value=_.key,_.shorthand=!0):this.unexpected()},Un.parsePropertyName=function(_){if(this.options.ecmaVersion>=6){if(this.eat(X.bracketL))return _.computed=!0,_.key=this.parseMaybeAssign(),this.expect(X.bracketR),_.key;_.computed=!1}return _.key=this.type===X.num||this.type===X.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},Un.initFunction=function(_){_.id=null,this.options.ecmaVersion>=6&&(_.generator=_.expression=!1),this.options.ecmaVersion>=8&&(_.async=!1)},Un.parseMethod=function(_,M,B){var O=this.startNode(),K=this.yieldPos,ge=this.awaitPos,He=this.awaitIdentPos;return this.initFunction(O),this.options.ecmaVersion>=6&&(O.generator=_),this.options.ecmaVersion>=8&&(O.async=!!M),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(zi(M,O.generator)|fi|(B?ta:0)),this.expect(X.parenL),O.params=this.parseBindingList(X.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(O,!1,!0),this.yieldPos=K,this.awaitPos=ge,this.awaitIdentPos=He,this.finishNode(O,"FunctionExpression")},Un.parseArrowExpression=function(_,M,B){var O=this.yieldPos,K=this.awaitPos,ge=this.awaitIdentPos;return this.enterScope(zi(B,!1)|si),this.initFunction(_),this.options.ecmaVersion>=8&&(_.async=!!B),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,_.params=this.toAssignableList(M,!0),this.parseFunctionBody(_,!0,!1),this.yieldPos=O,this.awaitPos=K,this.awaitIdentPos=ge,this.finishNode(_,"ArrowFunctionExpression")},Un.parseFunctionBody=function(_,M,B){var O=M&&this.type!==X.braceL,K=this.strict,ge=!1;if(O)_.body=this.parseMaybeAssign(),_.expression=!0,this.checkParams(_,!1);else{var He=this.options.ecmaVersion>=7&&!this.isSimpleParamList(_.params);(!K||He)&&(ge=this.strictDirective(this.end),ge&&He&&this.raiseRecoverable(_.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var lt=this.labels;this.labels=[],ge&&(this.strict=!0),this.checkParams(_,!K&&!ge&&!M&&!B&&this.isSimpleParamList(_.params)),this.strict&&_.id&&this.checkLVal(_.id,ia),_.body=this.parseBlock(!1,void 0,ge&&!K),_.expression=!1,this.adaptDirectivePrologue(_.body.body),this.labels=lt}this.exitScope()},Un.isSimpleParamList=function(_){for(var M=0,B=_;M<B.length;M+=1){var O=B[M];if(O.type!=="Identifier")return!1}return!0},Un.checkParams=function(_,M){for(var B={},O=0,K=_.params;O<K.length;O+=1){var ge=K[O];this.checkLVal(ge,Ki,M?null:B)}},Un.parseExprList=function(_,M,B,O){for(var K=[],ge=!0;!this.eat(_);){if(ge)ge=!1;else if(this.expect(X.comma),M&&this.afterTrailingComma(_))break;var He=void 0;B&&this.type===X.comma?He=null:this.type===X.ellipsis?(He=this.parseSpread(O),O&&this.type===X.comma&&O.trailingComma<0&&(O.trailingComma=this.start)):He=this.parseMaybeAssign(!1,O),K.push(He)}return K},Un.checkUnreserved=function(_){var M=_.start,B=_.end,O=_.name;if(this.inGenerator&&O==="yield"&&this.raiseRecoverable(M,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&O==="await"&&this.raiseRecoverable(M,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(O)&&this.raise(M,"Unexpected keyword '"+O+"'"),!(this.options.ecmaVersion<6&&this.input.slice(M,B).indexOf("\\")!==-1)){var K=this.strict?this.reservedWordsStrict:this.reservedWords;K.test(O)&&(!this.inAsync&&O==="await"&&this.raiseRecoverable(M,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(M,"The keyword '"+O+"' is reserved"))}},Un.parseIdent=function(_,M){var B=this.startNode();return this.type===X.name?B.name=this.value:this.type.keyword?(B.name=this.type.keyword,(B.name==="class"||B.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!_),this.finishNode(B,"Identifier"),_||(this.checkUnreserved(B),B.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=B.start)),B},Un.parseYield=function(_){this.yieldPos||(this.yieldPos=this.start);var M=this.startNode();return this.next(),this.type===X.semi||this.canInsertSemicolon()||this.type!==X.star&&!this.type.startsExpr?(M.delegate=!1,M.argument=null):(M.delegate=this.eat(X.star),M.argument=this.parseMaybeAssign(_)),this.finishNode(M,"YieldExpression")},Un.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var _=this.startNode();return this.next(),_.argument=this.parseMaybeUnary(null,!1),this.finishNode(_,"AwaitExpression")};var di=ki.prototype;di.raise=function(_,M){var B=ft(this.input,_);M+=" ("+B.line+":"+B.column+")";var O=new SyntaxError(M);throw O.pos=_,O.loc=B,O.raisedAt=this.pos,O},di.raiseRecoverable=di.raise,di.curPosition=function(){if(this.options.locations)return new ke(this.curLine,this.pos-this.lineStart)};var Sn=ki.prototype,Li=function(M){this.flags=M,this.var=[],this.lexical=[],this.functions=[]};Sn.enterScope=function(_){this.scopeStack.push(new Li(_))},Sn.exitScope=function(){this.scopeStack.pop()},Sn.treatFunctionsAsVarInScope=function(_){return _.flags&Gr||!this.inModule&&_.flags&Yn},Sn.declareName=function(_,M,B){var O=!1;if(M===ra){var K=this.currentScope();O=K.lexical.indexOf(_)>-1||K.functions.indexOf(_)>-1||K.var.indexOf(_)>-1,K.lexical.push(_),this.inModule&&K.flags&Yn&&delete this.undefinedExports[_]}else if(M===na){var ge=this.currentScope();ge.lexical.push(_)}else if(M===Ya){var He=this.currentScope();this.treatFunctionsAsVar?O=He.lexical.indexOf(_)>-1:O=He.lexical.indexOf(_)>-1||He.var.indexOf(_)>-1,He.functions.push(_)}else for(var lt=this.scopeStack.length-1;lt>=0;--lt){var pt=this.scopeStack[lt];if(pt.lexical.indexOf(_)>-1&&!(pt.flags&Gn&&pt.lexical[0]===_)||!this.treatFunctionsAsVarInScope(pt)&&pt.functions.indexOf(_)>-1){O=!0;break}if(pt.var.push(_),this.inModule&&pt.flags&Yn&&delete this.undefinedExports[_],pt.flags&Nn)break}O&&this.raiseRecoverable(B,"Identifier '"+_+"' has already been declared")},Sn.checkLocalExport=function(_){this.scopeStack[0].lexical.indexOf(_.name)===-1&&this.scopeStack[0].var.indexOf(_.name)===-1&&(this.undefinedExports[_.name]=_)},Sn.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},Sn.currentVarScope=function(){for(var _=this.scopeStack.length-1;;_--){var M=this.scopeStack[_];if(M.flags&Nn)return M}},Sn.currentThisScope=function(){for(var _=this.scopeStack.length-1;;_--){var M=this.scopeStack[_];if(M.flags&Nn&&!(M.flags&si))return M}};var Oi=function(M,B,O){this.type="",this.start=B,this.end=0,M.options.locations&&(this.loc=new ut(M,O)),M.options.directSourceFile&&(this.sourceFile=M.options.directSourceFile),M.options.ranges&&(this.range=[B,0])},io=ki.prototype;io.startNode=function(){return new Oi(this,this.start,this.startLoc)},io.startNodeAt=function(_,M){return new Oi(this,_,M)};function hs(_,M,B,O){return _.type=M,_.end=B,this.options.locations&&(_.loc.end=O),this.options.ranges&&(_.range[1]=B),_}io.finishNode=function(_,M){return hs.call(this,_,M,this.lastTokEnd,this.lastTokEndLoc)},io.finishNodeAt=function(_,M,B,O){return hs.call(this,_,M,B,O)};var Uo=function(M,B,O,K,ge){this.token=M,this.isExpr=!!B,this.preserveSpace=!!O,this.override=K,this.generator=!!ge},Na={b_stat:new Uo("{",!1),b_expr:new Uo("{",!0),b_tmpl:new Uo("${",!1),p_stat:new Uo("(",!1),p_expr:new Uo("(",!0),q_tmpl:new Uo("`",!0,!0,function(_){return _.tryReadTemplateToken()}),f_stat:new Uo("function",!1),f_expr:new Uo("function",!0),f_expr_gen:new Uo("function",!0,!1,null,!0),f_gen:new Uo("function",!1,!1,null,!0)},xa=ki.prototype;xa.initialContext=function(){return[Na.b_stat]},xa.braceIsBlock=function(_){var M=this.curContext();return M===Na.f_expr||M===Na.f_stat?!0:_===X.colon&&(M===Na.b_stat||M===Na.b_expr)?!M.isExpr:_===X._return||_===X.name&&this.exprAllowed?Xt.test(this.input.slice(this.lastTokEnd,this.start)):_===X._else||_===X.semi||_===X.eof||_===X.parenR||_===X.arrow?!0:_===X.braceL?M===Na.b_stat:_===X._var||_===X._const||_===X.name?!1:!this.exprAllowed},xa.inGeneratorContext=function(){for(var _=this.context.length-1;_>=1;_--){var M=this.context[_];if(M.token==="function")return M.generator}return!1},xa.updateContext=function(_){var M,B=this.type;B.keyword&&_===X.dot?this.exprAllowed=!1:(M=B.updateContext)?M.call(this,_):this.exprAllowed=B.beforeExpr},X.parenR.updateContext=X.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var _=this.context.pop();_===Na.b_stat&&this.curContext().token==="function"&&(_=this.context.pop()),this.exprAllowed=!_.isExpr},X.braceL.updateContext=function(_){this.context.push(this.braceIsBlock(_)?Na.b_stat:Na.b_expr),this.exprAllowed=!0},X.dollarBraceL.updateContext=function(){this.context.push(Na.b_tmpl),this.exprAllowed=!0},X.parenL.updateContext=function(_){var M=_===X._if||_===X._for||_===X._with||_===X._while;this.context.push(M?Na.p_stat:Na.p_expr),this.exprAllowed=!0},X.incDec.updateContext=function(){},X._function.updateContext=X._class.updateContext=function(_){_.beforeExpr&&_!==X.semi&&_!==X._else&&!(_===X._return&&Xt.test(this.input.slice(this.lastTokEnd,this.start)))&&!((_===X.colon||_===X.braceL)&&this.curContext()===Na.b_stat)?this.context.push(Na.f_expr):this.context.push(Na.f_stat),this.exprAllowed=!1},X.backQuote.updateContext=function(){this.curContext()===Na.q_tmpl?this.context.pop():this.context.push(Na.q_tmpl),this.exprAllowed=!1},X.star.updateContext=function(_){if(_===X._function){var M=this.context.length-1;this.context[M]===Na.f_expr?this.context[M]=Na.f_expr_gen:this.context[M]=Na.f_gen}this.exprAllowed=!0},X.name.updateContext=function(_){var M=!1;this.options.ecmaVersion>=6&&_!==X.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(M=!0),this.exprAllowed=M};var V="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",$=V+" Extended_Pictographic",te=$,he={9:V,10:$,11:te},Me="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",Ge="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",Qe=Ge+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",oe=Qe+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",Le={9:Ge,10:Qe,11:oe},ht={};function fr(_){var M=ht[_]={binary:Se(he[_]+" "+Me),nonBinary:{General_Category:Se(Me),Script:Se(Le[_])}};M.nonBinary.Script_Extensions=M.nonBinary.Script,M.nonBinary.gc=M.nonBinary.General_Category,M.nonBinary.sc=M.nonBinary.Script,M.nonBinary.scx=M.nonBinary.Script_Extensions}fr(9),fr(10),fr(11);var kt=ki.prototype,Ft=function(M){this.parser=M,this.validFlags="gim"+(M.options.ecmaVersion>=6?"uy":"")+(M.options.ecmaVersion>=9?"s":""),this.unicodeProperties=ht[M.options.ecmaVersion>=11?11:M.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};Ft.prototype.reset=function(M,B,O){var K=O.indexOf("u")!==-1;this.start=M|0,this.source=B+"",this.flags=O,this.switchU=K&&this.parser.options.ecmaVersion>=6,this.switchN=K&&this.parser.options.ecmaVersion>=9},Ft.prototype.raise=function(M){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+M)},Ft.prototype.at=function(M,B){B===void 0&&(B=!1);var O=this.source,K=O.length;if(M>=K)return-1;var ge=O.charCodeAt(M);if(!(B||this.switchU)||ge<=55295||ge>=57344||M+1>=K)return ge;var He=O.charCodeAt(M+1);return He>=56320&&He<=57343?(ge<<10)+He-56613888:ge},Ft.prototype.nextIndex=function(M,B){B===void 0&&(B=!1);var O=this.source,K=O.length;if(M>=K)return K;var ge=O.charCodeAt(M),He;return!(B||this.switchU)||ge<=55295||ge>=57344||M+1>=K||(He=O.charCodeAt(M+1))<56320||He>57343?M+1:M+2},Ft.prototype.current=function(M){return M===void 0&&(M=!1),this.at(this.pos,M)},Ft.prototype.lookahead=function(M){return M===void 0&&(M=!1),this.at(this.nextIndex(this.pos,M),M)},Ft.prototype.advance=function(M){M===void 0&&(M=!1),this.pos=this.nextIndex(this.pos,M)},Ft.prototype.eat=function(M,B){return B===void 0&&(B=!1),this.current(B)===M?(this.advance(B),!0):!1};function pr(_){return _<=65535?String.fromCharCode(_):(_-=65536,String.fromCharCode((_>>10)+55296,(_&1023)+56320))}kt.validateRegExpFlags=function(_){for(var M=_.validFlags,B=_.flags,O=0;O<B.length;O++){var K=B.charAt(O);M.indexOf(K)===-1&&this.raise(_.start,"Invalid regular expression flag"),B.indexOf(K,O+1)>-1&&this.raise(_.start,"Duplicate regular expression flag")}},kt.validateRegExpPattern=function(_){this.regexp_pattern(_),!_.switchN&&this.options.ecmaVersion>=9&&_.groupNames.length>0&&(_.switchN=!0,this.regexp_pattern(_))},kt.regexp_pattern=function(_){_.pos=0,_.lastIntValue=0,_.lastStringValue="",_.lastAssertionIsQuantifiable=!1,_.numCapturingParens=0,_.maxBackReference=0,_.groupNames.length=0,_.backReferenceNames.length=0,this.regexp_disjunction(_),_.pos!==_.source.length&&(_.eat(41)&&_.raise("Unmatched ')'"),(_.eat(93)||_.eat(125))&&_.raise("Lone quantifier brackets")),_.maxBackReference>_.numCapturingParens&&_.raise("Invalid escape");for(var M=0,B=_.backReferenceNames;M<B.length;M+=1){var O=B[M];_.groupNames.indexOf(O)===-1&&_.raise("Invalid named capture referenced")}},kt.regexp_disjunction=function(_){for(this.regexp_alternative(_);_.eat(124);)this.regexp_alternative(_);this.regexp_eatQuantifier(_,!0)&&_.raise("Nothing to repeat"),_.eat(123)&&_.raise("Lone quantifier brackets")},kt.regexp_alternative=function(_){for(;_.pos<_.source.length&&this.regexp_eatTerm(_););},kt.regexp_eatTerm=function(_){return this.regexp_eatAssertion(_)?(_.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(_)&&_.switchU&&_.raise("Invalid quantifier"),!0):(_.switchU?this.regexp_eatAtom(_):this.regexp_eatExtendedAtom(_))?(this.regexp_eatQuantifier(_),!0):!1},kt.regexp_eatAssertion=function(_){var M=_.pos;if(_.lastAssertionIsQuantifiable=!1,_.eat(94)||_.eat(36))return!0;if(_.eat(92)){if(_.eat(66)||_.eat(98))return!0;_.pos=M}if(_.eat(40)&&_.eat(63)){var B=!1;if(this.options.ecmaVersion>=9&&(B=_.eat(60)),_.eat(61)||_.eat(33))return this.regexp_disjunction(_),_.eat(41)||_.raise("Unterminated group"),_.lastAssertionIsQuantifiable=!B,!0}return _.pos=M,!1},kt.regexp_eatQuantifier=function(_,M){return M===void 0&&(M=!1),this.regexp_eatQuantifierPrefix(_,M)?(_.eat(63),!0):!1},kt.regexp_eatQuantifierPrefix=function(_,M){return _.eat(42)||_.eat(43)||_.eat(63)||this.regexp_eatBracedQuantifier(_,M)},kt.regexp_eatBracedQuantifier=function(_,M){var B=_.pos;if(_.eat(123)){var O=0,K=-1;if(this.regexp_eatDecimalDigits(_)&&(O=_.lastIntValue,_.eat(44)&&this.regexp_eatDecimalDigits(_)&&(K=_.lastIntValue),_.eat(125)))return K!==-1&&K<O&&!M&&_.raise("numbers out of order in {} quantifier"),!0;_.switchU&&!M&&_.raise("Incomplete quantifier"),_.pos=B}return!1},kt.regexp_eatAtom=function(_){return this.regexp_eatPatternCharacters(_)||_.eat(46)||this.regexp_eatReverseSolidusAtomEscape(_)||this.regexp_eatCharacterClass(_)||this.regexp_eatUncapturingGroup(_)||this.regexp_eatCapturingGroup(_)},kt.regexp_eatReverseSolidusAtomEscape=function(_){var M=_.pos;if(_.eat(92)){if(this.regexp_eatAtomEscape(_))return!0;_.pos=M}return!1},kt.regexp_eatUncapturingGroup=function(_){var M=_.pos;if(_.eat(40)){if(_.eat(63)&&_.eat(58)){if(this.regexp_disjunction(_),_.eat(41))return!0;_.raise("Unterminated group")}_.pos=M}return!1},kt.regexp_eatCapturingGroup=function(_){if(_.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(_):_.current()===63&&_.raise("Invalid group"),this.regexp_disjunction(_),_.eat(41))return _.numCapturingParens+=1,!0;_.raise("Unterminated group")}return!1},kt.regexp_eatExtendedAtom=function(_){return _.eat(46)||this.regexp_eatReverseSolidusAtomEscape(_)||this.regexp_eatCharacterClass(_)||this.regexp_eatUncapturingGroup(_)||this.regexp_eatCapturingGroup(_)||this.regexp_eatInvalidBracedQuantifier(_)||this.regexp_eatExtendedPatternCharacter(_)},kt.regexp_eatInvalidBracedQuantifier=function(_){return this.regexp_eatBracedQuantifier(_,!0)&&_.raise("Nothing to repeat"),!1},kt.regexp_eatSyntaxCharacter=function(_){var M=_.current();return _n(M)?(_.lastIntValue=M,_.advance(),!0):!1};function _n(_){return _===36||_>=40&&_<=43||_===46||_===63||_>=91&&_<=94||_>=123&&_<=125}kt.regexp_eatPatternCharacters=function(_){for(var M=_.pos,B=0;(B=_.current())!==-1&&!_n(B);)_.advance();return _.pos!==M},kt.regexp_eatExtendedPatternCharacter=function(_){var M=_.current();return M!==-1&&M!==36&&!(M>=40&&M<=43)&&M!==46&&M!==63&&M!==91&&M!==94&&M!==124?(_.advance(),!0):!1},kt.regexp_groupSpecifier=function(_){if(_.eat(63)){if(this.regexp_eatGroupName(_)){_.groupNames.indexOf(_.lastStringValue)!==-1&&_.raise("Duplicate capture group name"),_.groupNames.push(_.lastStringValue);return}_.raise("Invalid group")}},kt.regexp_eatGroupName=function(_){if(_.lastStringValue="",_.eat(60)){if(this.regexp_eatRegExpIdentifierName(_)&&_.eat(62))return!0;_.raise("Invalid capture group name")}return!1},kt.regexp_eatRegExpIdentifierName=function(_){if(_.lastStringValue="",this.regexp_eatRegExpIdentifierStart(_)){for(_.lastStringValue+=pr(_.lastIntValue);this.regexp_eatRegExpIdentifierPart(_);)_.lastStringValue+=pr(_.lastIntValue);return!0}return!1},kt.regexp_eatRegExpIdentifierStart=function(_){var M=_.pos,B=this.options.ecmaVersion>=11,O=_.current(B);return _.advance(B),O===92&&this.regexp_eatRegExpUnicodeEscapeSequence(_,B)&&(O=_.lastIntValue),fn(O)?(_.lastIntValue=O,!0):(_.pos=M,!1)};function fn(_){return Bt(_,!0)||_===36||_===95}kt.regexp_eatRegExpIdentifierPart=function(_){var M=_.pos,B=this.options.ecmaVersion>=11,O=_.current(B);return _.advance(B),O===92&&this.regexp_eatRegExpUnicodeEscapeSequence(_,B)&&(O=_.lastIntValue),Tt(O)?(_.lastIntValue=O,!0):(_.pos=M,!1)};function Tt(_){return or(_,!0)||_===36||_===95||_===8204||_===8205}kt.regexp_eatAtomEscape=function(_){return this.regexp_eatBackReference(_)||this.regexp_eatCharacterClassEscape(_)||this.regexp_eatCharacterEscape(_)||_.switchN&&this.regexp_eatKGroupName(_)?!0:(_.switchU&&(_.current()===99&&_.raise("Invalid unicode escape"),_.raise("Invalid escape")),!1)},kt.regexp_eatBackReference=function(_){var M=_.pos;if(this.regexp_eatDecimalEscape(_)){var B=_.lastIntValue;if(_.switchU)return B>_.maxBackReference&&(_.maxBackReference=B),!0;if(B<=_.numCapturingParens)return!0;_.pos=M}return!1},kt.regexp_eatKGroupName=function(_){if(_.eat(107)){if(this.regexp_eatGroupName(_))return _.backReferenceNames.push(_.lastStringValue),!0;_.raise("Invalid named reference")}return!1},kt.regexp_eatCharacterEscape=function(_){return this.regexp_eatControlEscape(_)||this.regexp_eatCControlLetter(_)||this.regexp_eatZero(_)||this.regexp_eatHexEscapeSequence(_)||this.regexp_eatRegExpUnicodeEscapeSequence(_,!1)||!_.switchU&&this.regexp_eatLegacyOctalEscapeSequence(_)||this.regexp_eatIdentityEscape(_)},kt.regexp_eatCControlLetter=function(_){var M=_.pos;if(_.eat(99)){if(this.regexp_eatControlLetter(_))return!0;_.pos=M}return!1},kt.regexp_eatZero=function(_){return _.current()===48&&!gn(_.lookahead())?(_.lastIntValue=0,_.advance(),!0):!1},kt.regexp_eatControlEscape=function(_){var M=_.current();return M===116?(_.lastIntValue=9,_.advance(),!0):M===110?(_.lastIntValue=10,_.advance(),!0):M===118?(_.lastIntValue=11,_.advance(),!0):M===102?(_.lastIntValue=12,_.advance(),!0):M===114?(_.lastIntValue=13,_.advance(),!0):!1},kt.regexp_eatControlLetter=function(_){var M=_.current();return Jr(M)?(_.lastIntValue=M%32,_.advance(),!0):!1};function Jr(_){return _>=65&&_<=90||_>=97&&_<=122}kt.regexp_eatRegExpUnicodeEscapeSequence=function(_,M){M===void 0&&(M=!1);var B=_.pos,O=M||_.switchU;if(_.eat(117)){if(this.regexp_eatFixedHexDigits(_,4)){var K=_.lastIntValue;if(O&&K>=55296&&K<=56319){var ge=_.pos;if(_.eat(92)&&_.eat(117)&&this.regexp_eatFixedHexDigits(_,4)){var He=_.lastIntValue;if(He>=56320&&He<=57343)return _.lastIntValue=(K-55296)*1024+(He-56320)+65536,!0}_.pos=ge,_.lastIntValue=K}return!0}if(O&&_.eat(123)&&this.regexp_eatHexDigits(_)&&_.eat(125)&&Br(_.lastIntValue))return!0;O&&_.raise("Invalid unicode escape"),_.pos=B}return!1};function Br(_){return _>=0&&_<=1114111}kt.regexp_eatIdentityEscape=function(_){if(_.switchU)return this.regexp_eatSyntaxCharacter(_)?!0:_.eat(47)?(_.lastIntValue=47,!0):!1;var M=_.current();return M!==99&&(!_.switchN||M!==107)?(_.lastIntValue=M,_.advance(),!0):!1},kt.regexp_eatDecimalEscape=function(_){_.lastIntValue=0;var M=_.current();if(M>=49&&M<=57){do _.lastIntValue=10*_.lastIntValue+(M-48),_.advance();while((M=_.current())>=48&&M<=57);return!0}return!1},kt.regexp_eatCharacterClassEscape=function(_){var M=_.current();if(Wr(M))return _.lastIntValue=-1,_.advance(),!0;if(_.switchU&&this.options.ecmaVersion>=9&&(M===80||M===112)){if(_.lastIntValue=-1,_.advance(),_.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(_)&&_.eat(125))return!0;_.raise("Invalid property name")}return!1};function Wr(_){return _===100||_===68||_===115||_===83||_===119||_===87}kt.regexp_eatUnicodePropertyValueExpression=function(_){var M=_.pos;if(this.regexp_eatUnicodePropertyName(_)&&_.eat(61)){var B=_.lastStringValue;if(this.regexp_eatUnicodePropertyValue(_)){var O=_.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(_,B,O),!0}}if(_.pos=M,this.regexp_eatLoneUnicodePropertyNameOrValue(_)){var K=_.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(_,K),!0}return!1},kt.regexp_validateUnicodePropertyNameAndValue=function(_,M,B){Yr(_.unicodeProperties.nonBinary,M)||_.raise("Invalid property name"),_.unicodeProperties.nonBinary[M].test(B)||_.raise("Invalid property value")},kt.regexp_validateUnicodePropertyNameOrValue=function(_,M){_.unicodeProperties.binary.test(M)||_.raise("Invalid property name")},kt.regexp_eatUnicodePropertyName=function(_){var M=0;for(_.lastStringValue="";vi(M=_.current());)_.lastStringValue+=pr(M),_.advance();return _.lastStringValue!==""};function vi(_){return Jr(_)||_===95}kt.regexp_eatUnicodePropertyValue=function(_){var M=0;for(_.lastStringValue="";en(M=_.current());)_.lastStringValue+=pr(M),_.advance();return _.lastStringValue!==""};function en(_){return vi(_)||gn(_)}kt.regexp_eatLoneUnicodePropertyNameOrValue=function(_){return this.regexp_eatUnicodePropertyValue(_)},kt.regexp_eatCharacterClass=function(_){if(_.eat(91)){if(_.eat(94),this.regexp_classRanges(_),_.eat(93))return!0;_.raise("Unterminated character class")}return!1},kt.regexp_classRanges=function(_){for(;this.regexp_eatClassAtom(_);){var M=_.lastIntValue;if(_.eat(45)&&this.regexp_eatClassAtom(_)){var B=_.lastIntValue;_.switchU&&(M===-1||B===-1)&&_.raise("Invalid character class"),M!==-1&&B!==-1&&M>B&&_.raise("Range out of order in character class")}}},kt.regexp_eatClassAtom=function(_){var M=_.pos;if(_.eat(92)){if(this.regexp_eatClassEscape(_))return!0;if(_.switchU){var B=_.current();(B===99||wi(B))&&_.raise("Invalid class escape"),_.raise("Invalid escape")}_.pos=M}var O=_.current();return O!==93?(_.lastIntValue=O,_.advance(),!0):!1},kt.regexp_eatClassEscape=function(_){var M=_.pos;if(_.eat(98))return _.lastIntValue=8,!0;if(_.switchU&&_.eat(45))return _.lastIntValue=45,!0;if(!_.switchU&&_.eat(99)){if(this.regexp_eatClassControlLetter(_))return!0;_.pos=M}return this.regexp_eatCharacterClassEscape(_)||this.regexp_eatCharacterEscape(_)},kt.regexp_eatClassControlLetter=function(_){var M=_.current();return gn(M)||M===95?(_.lastIntValue=M%32,_.advance(),!0):!1},kt.regexp_eatHexEscapeSequence=function(_){var M=_.pos;if(_.eat(120)){if(this.regexp_eatFixedHexDigits(_,2))return!0;_.switchU&&_.raise("Invalid escape"),_.pos=M}return!1},kt.regexp_eatDecimalDigits=function(_){var M=_.pos,B=0;for(_.lastIntValue=0;gn(B=_.current());)_.lastIntValue=10*_.lastIntValue+(B-48),_.advance();return _.pos!==M};function gn(_){return _>=48&&_<=57}kt.regexp_eatHexDigits=function(_){var M=_.pos,B=0;for(_.lastIntValue=0;Hi(B=_.current());)_.lastIntValue=16*_.lastIntValue+pi(B),_.advance();return _.pos!==M};function Hi(_){return _>=48&&_<=57||_>=65&&_<=70||_>=97&&_<=102}function pi(_){return _>=65&&_<=70?10+(_-65):_>=97&&_<=102?10+(_-97):_-48}kt.regexp_eatLegacyOctalEscapeSequence=function(_){if(this.regexp_eatOctalDigit(_)){var M=_.lastIntValue;if(this.regexp_eatOctalDigit(_)){var B=_.lastIntValue;M<=3&&this.regexp_eatOctalDigit(_)?_.lastIntValue=M*64+B*8+_.lastIntValue:_.lastIntValue=M*8+B}else _.lastIntValue=M;return!0}return!1},kt.regexp_eatOctalDigit=function(_){var M=_.current();return wi(M)?(_.lastIntValue=M-48,_.advance(),!0):(_.lastIntValue=0,!1)};function wi(_){return _>=48&&_<=55}kt.regexp_eatFixedHexDigits=function(_,M){var B=_.pos;_.lastIntValue=0;for(var O=0;O<M;++O){var K=_.current();if(!Hi(K))return _.pos=B,!1;_.lastIntValue=16*_.lastIntValue+pi(K),_.advance()}return!0};var yi=function(M){this.type=M.type,this.value=M.value,this.start=M.start,this.end=M.end,M.options.locations&&(this.loc=new ut(M,M.startLoc,M.endLoc)),M.options.ranges&&(this.range=[M.start,M.end])},dt=ki.prototype;dt.next=function(_){!_&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new yi(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},dt.getToken=function(){return this.next(),new yi(this)},typeof Symbol!="undefined"&&(dt[Symbol.iterator]=function(){var _=this;return{next:function(){var M=_.getToken();return{done:M.type===X.eof,value:M}}}}),dt.curContext=function(){return this.context[this.context.length-1]},dt.nextToken=function(){var _=this.curContext();if((!_||!_.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(X.eof);if(_.override)return _.override(this);this.readToken(this.fullCharCodeAtPos())},dt.readToken=function(_){return Bt(_,this.options.ecmaVersion>=6)||_===92?this.readWord():this.getTokenFromCode(_)},dt.fullCharCodeAtPos=function(){var _=this.input.charCodeAt(this.pos);if(_<=55295||_>=57344)return _;var M=this.input.charCodeAt(this.pos+1);return(_<<10)+M-56613888},dt.skipBlockComment=function(){var _=this.options.onComment&&this.curPosition(),M=this.pos,B=this.input.indexOf("*/",this.pos+=2);if(B===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=B+2,this.options.locations){at.lastIndex=M;for(var O;(O=at.exec(this.input))&&O.index<this.pos;)++this.curLine,this.lineStart=O.index+O[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(M+2,B),M,this.pos,_,this.curPosition())},dt.skipLineComment=function(_){for(var M=this.pos,B=this.options.onComment&&this.curPosition(),O=this.input.charCodeAt(this.pos+=_);this.pos<this.input.length&&!qe(O);)O=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(M+_,this.pos),M,this.pos,B,this.curPosition())},dt.skipSpace=function(){e:for(;this.pos<this.input.length;){var _=this.input.charCodeAt(this.pos);switch(_){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(_>8&&_<14||_>=5760&&xt.test(String.fromCharCode(_)))++this.pos;else break e}}},dt.finishToken=function(_,M){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var B=this.type;this.type=_,this.value=M,this.updateContext(B)},dt.readToken_dot=function(){var _=this.input.charCodeAt(this.pos+1);if(_>=48&&_<=57)return this.readNumber(!0);var M=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&_===46&&M===46?(this.pos+=3,this.finishToken(X.ellipsis)):(++this.pos,this.finishToken(X.dot))},dt.readToken_slash=function(){var _=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):_===61?this.finishOp(X.assign,2):this.finishOp(X.slash,1)},dt.readToken_mult_modulo_exp=function(_){var M=this.input.charCodeAt(this.pos+1),B=1,O=_===42?X.star:X.modulo;return this.options.ecmaVersion>=7&&_===42&&M===42&&(++B,O=X.starstar,M=this.input.charCodeAt(this.pos+2)),M===61?this.finishOp(X.assign,B+1):this.finishOp(O,B)},dt.readToken_pipe_amp=function(_){var M=this.input.charCodeAt(this.pos+1);if(M===_){if(this.options.ecmaVersion>=12){var B=this.input.charCodeAt(this.pos+2);if(B===61)return this.finishOp(X.assign,3)}return this.finishOp(_===124?X.logicalOR:X.logicalAND,2)}return M===61?this.finishOp(X.assign,2):this.finishOp(_===124?X.bitwiseOR:X.bitwiseAND,1)},dt.readToken_caret=function(){var _=this.input.charCodeAt(this.pos+1);return _===61?this.finishOp(X.assign,2):this.finishOp(X.bitwiseXOR,1)},dt.readToken_plus_min=function(_){var M=this.input.charCodeAt(this.pos+1);return M===_?M===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||Xt.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(X.incDec,2):M===61?this.finishOp(X.assign,2):this.finishOp(X.plusMin,1)},dt.readToken_lt_gt=function(_){var M=this.input.charCodeAt(this.pos+1),B=1;return M===_?(B=_===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+B)===61?this.finishOp(X.assign,B+1):this.finishOp(X.bitShift,B)):M===33&&_===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(M===61&&(B=2),this.finishOp(X.relational,B))},dt.readToken_eq_excl=function(_){var M=this.input.charCodeAt(this.pos+1);return M===61?this.finishOp(X.equality,this.input.charCodeAt(this.pos+2)===61?3:2):_===61&&M===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(X.arrow)):this.finishOp(_===61?X.eq:X.prefix,1)},dt.readToken_question=function(){var _=this.options.ecmaVersion;if(_>=11){var M=this.input.charCodeAt(this.pos+1);if(M===46){var B=this.input.charCodeAt(this.pos+2);if(B<48||B>57)return this.finishOp(X.questionDot,2)}if(M===63){if(_>=12){var O=this.input.charCodeAt(this.pos+2);if(O===61)return this.finishOp(X.assign,3)}return this.finishOp(X.coalesce,2)}}return this.finishOp(X.question,1)},dt.getTokenFromCode=function(_){switch(_){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(X.parenL);case 41:return++this.pos,this.finishToken(X.parenR);case 59:return++this.pos,this.finishToken(X.semi);case 44:return++this.pos,this.finishToken(X.comma);case 91:return++this.pos,this.finishToken(X.bracketL);case 93:return++this.pos,this.finishToken(X.bracketR);case 123:return++this.pos,this.finishToken(X.braceL);case 125:return++this.pos,this.finishToken(X.braceR);case 58:return++this.pos,this.finishToken(X.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(X.backQuote);case 48:var M=this.input.charCodeAt(this.pos+1);if(M===120||M===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(M===111||M===79)return this.readRadixNumber(8);if(M===98||M===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(_);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(_);case 124:case 38:return this.readToken_pipe_amp(_);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(_);case 60:case 62:return this.readToken_lt_gt(_);case 61:case 33:return this.readToken_eq_excl(_);case 63:return this.readToken_question();case 126:return this.finishOp(X.prefix,1)}this.raise(this.pos,"Unexpected character '"+Ei(_)+"'")},dt.finishOp=function(_,M){var B=this.input.slice(this.pos,this.pos+M);return this.pos+=M,this.finishToken(_,B)},dt.readRegexp=function(){for(var _,M,B=this.pos;;){this.pos>=this.input.length&&this.raise(B,"Unterminated regular expression");var O=this.input.charAt(this.pos);if(Xt.test(O)&&this.raise(B,"Unterminated regular expression"),_)_=!1;else{if(O==="[")M=!0;else if(O==="]"&&M)M=!1;else if(O==="/"&&!M)break;_=O==="\\"}++this.pos}var K=this.input.slice(B,this.pos);++this.pos;var ge=this.pos,He=this.readWord1();this.containsEsc&&this.unexpected(ge);var lt=this.regexpState||(this.regexpState=new Ft(this));lt.reset(B,K,He),this.validateRegExpFlags(lt),this.validateRegExpPattern(lt);var pt=null;try{pt=new RegExp(K,He)}catch(nr){}return this.finishToken(X.regexp,{pattern:K,flags:He,value:pt})},dt.readInt=function(_,M,B){for(var O=this.options.ecmaVersion>=12&&M===void 0,K=B&&this.input.charCodeAt(this.pos)===48,ge=this.pos,He=0,lt=0,pt=0,nr=M==null?Infinity:M;pt<nr;++pt,++this.pos){var sr=this.input.charCodeAt(this.pos),Mn=void 0;if(O&&sr===95){K&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),lt===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),pt===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),lt=sr;continue}if(sr>=97?Mn=sr-97+10:sr>=65?Mn=sr-65+10:sr>=48&&sr<=57?Mn=sr-48:Mn=Infinity,Mn>=_)break;lt=sr,He=He*_+Mn}return O&&lt===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===ge||M!=null&&this.pos-ge!==M?null:He};function Mt(_,M){return M?parseInt(_,8):parseFloat(_.replace(/_/g,""))}function wa(_){return typeof BigInt!="function"?null:BigInt(_.replace(/_/g,""))}dt.readRadixNumber=function(_){var M=this.pos;this.pos+=2;var B=this.readInt(_);return B==null&&this.raise(this.start+2,"Expected number in radix "+_),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(B=wa(this.input.slice(M,this.pos)),++this.pos):Bt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(X.num,B)},dt.readNumber=function(_){var M=this.pos;!_&&this.readInt(10,void 0,!0)===null&&this.raise(M,"Invalid number");var B=this.pos-M>=2&&this.input.charCodeAt(M)===48;B&&this.strict&&this.raise(M,"Invalid number");var O=this.input.charCodeAt(this.pos);if(!B&&!_&&this.options.ecmaVersion>=11&&O===110){var K=wa(this.input.slice(M,this.pos));return++this.pos,Bt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(X.num,K)}B&&/[89]/.test(this.input.slice(M,this.pos))&&(B=!1),O===46&&!B&&(++this.pos,this.readInt(10),O=this.input.charCodeAt(this.pos)),(O===69||O===101)&&!B&&(O=this.input.charCodeAt(++this.pos),(O===43||O===45)&&++this.pos,this.readInt(10)===null&&this.raise(M,"Invalid number")),Bt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var ge=Mt(this.input.slice(M,this.pos),B);return this.finishToken(X.num,ge)},dt.readCodePoint=function(){var _=this.input.charCodeAt(this.pos),M;if(_===123){this.options.ecmaVersion<6&&this.unexpected();var B=++this.pos;M=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,M>1114111&&this.invalidStringToken(B,"Code point out of bounds")}else M=this.readHexChar(4);return M};function Ei(_){return _<=65535?String.fromCharCode(_):(_-=65536,String.fromCharCode((_>>10)+55296,(_&1023)+56320))}dt.readString=function(_){for(var M="",B=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var O=this.input.charCodeAt(this.pos);if(O===_)break;O===92?(M+=this.input.slice(B,this.pos),M+=this.readEscapedChar(!1),B=this.pos):(qe(O,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return M+=this.input.slice(B,this.pos++),this.finishToken(X.string,M)};var Ti={};dt.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(_){if(_===Ti)this.readInvalidTemplateToken();else throw _}this.inTemplateElement=!1},dt.invalidStringToken=function(_,M){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Ti;this.raise(_,M)},dt.readTmplToken=function(){for(var _="",M=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var B=this.input.charCodeAt(this.pos);if(B===96||B===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===X.template||this.type===X.invalidTemplate)?B===36?(this.pos+=2,this.finishToken(X.dollarBraceL)):(++this.pos,this.finishToken(X.backQuote)):(_+=this.input.slice(M,this.pos),this.finishToken(X.template,_));if(B===92)_+=this.input.slice(M,this.pos),_+=this.readEscapedChar(!0),M=this.pos;else if(qe(B)){switch(_+=this.input.slice(M,this.pos),++this.pos,B){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:_+=`
`;break;default:_+=String.fromCharCode(B);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),M=this.pos}else++this.pos}},dt.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(X.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},dt.readEscapedChar=function(_){var M=this.input.charCodeAt(++this.pos);switch(++this.pos,M){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return Ei(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(_){var B=this.pos-1;return this.invalidStringToken(B,"Invalid escape sequence in template string"),null}default:if(M>=48&&M<=55){var O=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],K=parseInt(O,8);return K>255&&(O=O.slice(0,-1),K=parseInt(O,8)),this.pos+=O.length-1,M=this.input.charCodeAt(this.pos),(O!=="0"||M===56||M===57)&&(this.strict||_)&&this.invalidStringToken(this.pos-1-O.length,_?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(K)}return qe(M)?"":String.fromCharCode(M)}},dt.readHexChar=function(_){var M=this.pos,B=this.readInt(16,_);return B===null&&this.invalidStringToken(M,"Bad character escape sequence"),B},dt.readWord1=function(){this.containsEsc=!1;for(var _="",M=!0,B=this.pos,O=this.options.ecmaVersion>=6;this.pos<this.input.length;){var K=this.fullCharCodeAtPos();if(or(K,O))this.pos+=K<=65535?1:2;else if(K===92){this.containsEsc=!0,_+=this.input.slice(B,this.pos);var ge=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var He=this.readCodePoint();(M?Bt:or)(He,O)||this.invalidStringToken(ge,"Invalid Unicode escape"),_+=Ei(He),B=this.pos}else break;M=!1}return _+this.input.slice(B,this.pos)},dt.readWord=function(){var _=this.readWord1(),M=X.name;return this.keywords.test(_)&&(M=it[_]),this.finishToken(M,_)};var Ui="7.4.1";ki.acorn={Parser:ki,version:Ui,defaultOptions:Rt,Position:ke,SourceLocation:ut,getLineInfo:ft,Node:Oi,TokenType:At,tokTypes:X,keywordTypes:it,TokContext:Uo,tokContexts:Na,isIdentifierChar:or,isIdentifierStart:Bt,Token:yi,isNewLine:qe,lineBreak:Xt,lineBreakG:at,nonASCIIwhitespace:xt};function Pr(_,M){return ki.parse(_,M)}function on(_,M,B){return ki.parseExpressionAt(_,M,B)}function gt(_,M){return ki.tokenizer(_,M)}function aa(_,M){_.prototype=Object.create(M.prototype),_.prototype.constructor=_,_.__proto__=M}function ue(_){var M=typeof Map=="function"?new Map:void 0;return ue=function(O){if(O===null||!_u(O))return O;if(typeof O!="function")throw new TypeError("Super expression must either be null or a function");if(typeof M!="undefined"){if(M.has(O))return M.get(O);M.set(O,K)}function K(){return ea(O,arguments,Ta(this).constructor)}return K.prototype=Object.create(O.prototype,{constructor:{value:K,enumerable:!1,writable:!0,configurable:!0}}),za(K,O)},ue(_)}function qo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(_){return!1}}function ea(_,M,B){return qo()?ea=Reflect.construct:ea=function(K,ge,He){var lt=[null];lt.push.apply(lt,ge);var pt=Function.bind.apply(K,lt),nr=new pt;return He&&za(nr,He.prototype),nr},ea.apply(null,arguments)}function _u(_){return Function.toString.call(_).indexOf("[native code]")!==-1}function za(_,M){return za=Object.setPrototypeOf||function(O,K){return O.__proto__=K,O},za(_,M)}function Ta(_){return Ta=Object.setPrototypeOf?Object.getPrototypeOf:function(B){return B.__proto__||Object.getPrototypeOf(B)},Ta(_)}var qa=function(_){aa(M,_);function M(){return _.apply(this,arguments)||this}return M}(ue(Error)),oa=function(_){aa(M,_);function M(){return _.apply(this,arguments)||this}return M}(ue(SyntaxError)),Ao=function(_){aa(M,_);function M(){return _.apply(this,arguments)||this}return M}(ue(ReferenceError)),Zo=function(_){aa(M,_);function M(){return _.apply(this,arguments)||this}return M}(ue(TypeError)),Cu=function(_){aa(M,_);function M(){return _.apply(this,arguments)||this}return M}(qa),ho=function(_){aa(M,_);function M(){return _.apply(this,arguments)||this}return M}(oa),Lo=function(_){aa(M,_);function M(){return _.apply(this,arguments)||this}return M}(Ao),sa={UnknownError:[3001,"%0",Cu],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",Cu],NodeTypeSyntaxError:[1001,"Unknown node type: %0",Lo],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",Lo],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",Lo],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",Lo],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",Lo],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",Lo],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",Lo],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",Lo],ParamTypeSyntaxError:[1009,"Unknown param type: %0",Lo],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",Lo],FunctionUndefinedReferenceError:[2001,"%0 is not a function",Ao],VariableUndefinedReferenceError:[2002,"%0 is not defined",Ao],IsNotConstructor:[2003,"%0 is not a constructor",Zo]};function Ka(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(_){return!1}}function Do(_,M,B){return Ka()?Do=Reflect.construct:Do=function(K,ge,He){var lt=[null];lt.push.apply(lt,ge);var pt=Function.bind.apply(K,lt),nr=new pt;return He&&$a(nr,He.prototype),nr},Do.apply(null,arguments)}function $a(_,M){return $a=Object.setPrototypeOf||function(O,K){return O.__proto__=K,O},$a(_,M)}var As="0.0.3";function Ml(_,M){Object.defineProperty(_,"name",{value:M,writable:!1,enumerable:!1,configurable:!0})}var ds=Object.prototype.hasOwnProperty,ee=Symbol("Break"),ye=Symbol("Continue"),We=Symbol("DefaultCase"),It=Symbol("EmptyStatementReturn"),Ir=Symbol("WithScopeName"),In=Symbol("SuperScopeName"),Mi=Symbol("RootScopeName"),ao=Symbol("GlobalScopeName");function Ra(_){return typeof _=="function"}var Ua=function(){function _(B){this.interpreter=B}var M=_.prototype;return M.generator=function(){var O=this.interpreter;function K(){return this.getCurrentScope()}function ge(){return this.getGlobalScope()}function He(){return this.getCurrentContext()}return{getOptions:O.getOptions.bind(O),getCurrentScope:K.bind(O),getGlobalScope:ge.bind(O),getCurrentContext:He.bind(O),getExecStartTime:O.getExecStartTime.bind(O)}},_}();function jo(_,M,B){if(B===void 0&&(B=!0),!(_ instanceof Ua))throw new Error("Illegal call");if(typeof M!="string")return M;if(!!M){var O=_.generator(),K=O.getOptions(),ge={timeout:K.timeout,_initEnv:function(){B||this.setCurrentContext(O.getCurrentContext()),this.execStartTime=O.getExecStartTime(),this.execEndTime=this.execStartTime}},He=B?O.getGlobalScope():O.getCurrentScope(),lt=new _a(He,ge);return lt.evaluate(M)}}Object.defineProperty(jo,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function vs(_){if(!(_ instanceof Ua))throw new Error("Illegal call");for(var M=_.generator(),B=arguments.length,O=new Array(B>1?B-1:0),K=1;K<B;K++)O[K-1]=arguments[K];var ge=O.pop(),He=new _a(M.getGlobalScope(),M.getOptions()),lt=`
		    (function anonymous(`+O.join(",")+`){
		        `+ge+`
		    });
		    `;return He.evaluate(lt)}Object.defineProperty(vs,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var uo=function(M){this.value=M},wo=function(M){this.value=M},ms=function(M){this.value=M},ws=function(M,B,O){B===void 0&&(B=null),this.name=O,this.parent=B,this.data=M,this.labelStack=[]};function Ds(){}function uu(_,M){return _===void 0&&(_=null),new ws(Object.create(null),_,M)}function gs(_){return Object.create(_)}var ma={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Float64Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:jo,Function:vs};typeof JSON!="undefined"&&(ma.JSON=JSON),typeof Promise!="undefined"&&(ma.Promise=Promise),typeof Set!="undefined"&&(ma.Set=Set),typeof Map!="undefined"&&(ma.Map=Map),typeof Symbol!="undefined"&&(ma.Symbol=Symbol),typeof Proxy!="undefined"&&(ma.Proxy=Proxy),typeof WeakMap!="undefined"&&(ma.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(ma.WeakSet=WeakSet),typeof Reflect!="undefined"&&(ma.Reflect=Reflect);var _a=function(){function _(B,O){B===void 0&&(B=_.global),O===void 0&&(O={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:O.ecmaVersion||_.ecmaVersion,timeout:O.timeout||0,rootContext:O.rootContext,globalContextInFunction:O.globalContextInFunction===void 0?_.globalContextInFunction:O.globalContextInFunction,_initEnv:O._initEnv},this.context=B||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var M=_.prototype;return M.initEnvironment=function(O){var K;if(O instanceof ws)K=O;else{var ge=null,He=this.createSuperScope(O);this.options.rootContext&&(ge=new ws(gs(this.options.rootContext),He,Mi)),K=new ws(O,ge||He,ao)}this.globalScope=K,this.currentScope=this.globalScope,this.globalContext=K.data,this.currentContext=K.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var lt=this.options._initEnv;lt&&lt.call(this)},M.getExecStartTime=function(){return this.execStartTime},M.getExecutionTime=function(){return this.execEndTime-this.execStartTime},M.setExecTimeout=function(O){O===void 0&&(O=0),this.options.timeout=O},M.getOptions=function(){return this.options},M.getGlobalScope=function(){return this.globalScope},M.getCurrentScope=function(){return this.currentScope},M.getCurrentContext=function(){return this.currentContext},M.isInterruptThrow=function(O){return O instanceof Cu||O instanceof Lo||O instanceof ho},M.createSuperScope=function(O){var K=Object.assign({},ma),ge=Object.keys(K);return ge.forEach(function(He){He in O&&delete K[He]}),new ws(K,null,In)},M.setCurrentContext=function(O){this.currentContext=O},M.setCurrentScope=function(O){this.currentScope=O},M.evaluate=function(O){O===void 0&&(O="");var K;if(!!O)return K=Pr(O,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||_.ecmaVersion}),this.evaluateNode(K,O)},M.appendCode=function(O){return this.evaluate(O)},M.evaluateNode=function(O,K){var ge=this;K===void 0&&(K=""),this.value=void 0,this.source=K,this.sourceList.push(K),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var He=this.getCurrentScope(),lt=this.getCurrentContext(),pt=He.labelStack.concat([]),nr=this.callStack.concat([]),sr=function(){ge.setCurrentScope(He),ge.setCurrentContext(lt),He.labelStack=pt,ge.callStack=nr};try{var Mn=this.createClosure(O);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),Mn()}catch(ri){throw ri}finally{sr(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},M.createErrorMessage=function(O,K,ge){var He=O[1].replace("%0",String(K));return ge!==null&&(He+=this.getNodePosition(ge||this.lastExecNode)),He},M.createError=function(O,K){return new K(O)},M.createThrowError=function(O,K){return this.createError(O,K)},M.createInternalThrowError=function(O,K,ge){return this.createError(this.createErrorMessage(O,K,ge),O[2])},M.checkTimeout=function(){if(!this.isRunning)return!1;var O=this.options.timeout||0,K=Date.now();return K-this.execStartTime>O},M.getNodePosition=function(O){if(O){var K="";return O.loc?" ["+O.loc.start.line+":"+O.loc.start.column+"]"+K:""}return""},M.createClosure=function(O){var K=this,ge;switch(O.type){case"BinaryExpression":ge=this.binaryExpressionHandler(O);break;case"LogicalExpression":ge=this.logicalExpressionHandler(O);break;case"UnaryExpression":ge=this.unaryExpressionHandler(O);break;case"UpdateExpression":ge=this.updateExpressionHandler(O);break;case"ObjectExpression":ge=this.objectExpressionHandler(O);break;case"ArrayExpression":ge=this.arrayExpressionHandler(O);break;case"CallExpression":ge=this.callExpressionHandler(O);break;case"NewExpression":ge=this.newExpressionHandler(O);break;case"MemberExpression":ge=this.memberExpressionHandler(O);break;case"ThisExpression":ge=this.thisExpressionHandler(O);break;case"SequenceExpression":ge=this.sequenceExpressionHandler(O);break;case"Literal":ge=this.literalHandler(O);break;case"Identifier":ge=this.identifierHandler(O);break;case"AssignmentExpression":ge=this.assignmentExpressionHandler(O);break;case"FunctionDeclaration":ge=this.functionDeclarationHandler(O);break;case"VariableDeclaration":ge=this.variableDeclarationHandler(O);break;case"BlockStatement":case"Program":ge=this.programHandler(O);break;case"ExpressionStatement":ge=this.expressionStatementHandler(O);break;case"EmptyStatement":ge=this.emptyStatementHandler(O);break;case"ReturnStatement":ge=this.returnStatementHandler(O);break;case"FunctionExpression":ge=this.functionExpressionHandler(O);break;case"IfStatement":ge=this.ifStatementHandler(O);break;case"ConditionalExpression":ge=this.conditionalExpressionHandler(O);break;case"ForStatement":ge=this.forStatementHandler(O);break;case"WhileStatement":ge=this.whileStatementHandler(O);break;case"DoWhileStatement":ge=this.doWhileStatementHandler(O);break;case"ForInStatement":ge=this.forInStatementHandler(O);break;case"WithStatement":ge=this.withStatementHandler(O);break;case"ThrowStatement":ge=this.throwStatementHandler(O);break;case"TryStatement":ge=this.tryStatementHandler(O);break;case"ContinueStatement":ge=this.continueStatementHandler(O);break;case"BreakStatement":ge=this.breakStatementHandler(O);break;case"SwitchStatement":ge=this.switchStatementHandler(O);break;case"LabeledStatement":ge=this.labeledStatementHandler(O);break;case"DebuggerStatement":ge=this.debuggerStatementHandler(O);break;default:throw this.createInternalThrowError(sa.NodeTypeSyntaxError,O.type,O)}return function(){var He=K.options.timeout;if(He&&He>0&&K.checkTimeout())throw K.createInternalThrowError(sa.ExecutionTimeOutError,He,null);return K.lastExecNode=O,ge.apply(void 0,arguments)}},M.binaryExpressionHandler=function(O){var K=this,ge=this.createClosure(O.left),He=this.createClosure(O.right);return function(){var lt=ge(),pt=He();switch(O.operator){case"==":return lt==pt;case"!=":return lt!=pt;case"===":return lt===pt;case"!==":return lt!==pt;case"<":return lt<pt;case"<=":return lt<=pt;case">":return lt>pt;case">=":return lt>=pt;case"<<":return lt<<pt;case">>":return lt>>pt;case">>>":return lt>>>pt;case"+":return lt+pt;case"-":return lt-pt;case"*":return lt*pt;case"**":return Math.pow(lt,pt);case"/":return lt/pt;case"%":return lt%pt;case"|":return lt|pt;case"^":return lt^pt;case"&":return lt&pt;case"in":return lt in pt;case"instanceof":return lt instanceof pt;default:throw K.createInternalThrowError(sa.BinaryOperatorSyntaxError,O.operator,O)}}},M.logicalExpressionHandler=function(O){var K=this,ge=this.createClosure(O.left),He=this.createClosure(O.right);return function(){switch(O.operator){case"||":return ge()||He();case"&&":return ge()&&He();default:throw K.createInternalThrowError(sa.LogicalOperatorSyntaxError,O.operator,O)}}},M.unaryExpressionHandler=function(O){var K=this;switch(O.operator){case"delete":var ge=this.createObjectGetter(O.argument),He=this.createNameGetter(O.argument);return function(){var sr=ge(),Mn=He();return delete sr[Mn]};default:var lt;if(O.operator==="typeof"&&O.argument.type==="Identifier"){var pt=this.createObjectGetter(O.argument),nr=this.createNameGetter(O.argument);lt=function(){return pt()[nr()]}}else lt=this.createClosure(O.argument);return function(){var sr=lt();switch(O.operator){case"-":return-sr;case"+":return+sr;case"!":return!sr;case"~":return~sr;case"void":return;case"typeof":return typeof sr;default:throw K.createInternalThrowError(sa.UnaryOperatorSyntaxError,O.operator,O)}}}},M.updateExpressionHandler=function(O){var K=this,ge=this.createObjectGetter(O.argument),He=this.createNameGetter(O.argument);return function(){var lt=ge(),pt=He();switch(K.assertVariable(lt,pt,O),O.operator){case"++":return O.prefix?++lt[pt]:lt[pt]++;case"--":return O.prefix?--lt[pt]:lt[pt]--;default:throw K.createInternalThrowError(sa.UpdateOperatorSyntaxError,O.operator,O)}}},M.objectExpressionHandler=function(O){var K=this,ge=[];function He(pt){return pt.type==="Identifier"?pt.name:pt.type==="Literal"?pt.value:this.throwError(sa.ObjectStructureSyntaxError,pt.type,pt)}var lt=Object.create(null);return O.properties.forEach(function(pt){var nr=pt.kind,sr=He(pt.key);(!lt[sr]||nr==="init")&&(lt[sr]={}),lt[sr][nr]=K.createClosure(pt.value),ge.push({key:sr,property:pt})}),function(){for(var pt={},nr=ge.length,sr=0;sr<nr;sr++){var Mn=ge[sr],ri=Mn.key,kn=lt[ri],Wi=kn.init?kn.init():void 0,da=kn.get?kn.get():function(){},Sa=kn.set?kn.set():function(Xu){};if("set"in kn||"get"in kn){var ji={configurable:!0,enumerable:!0,get:da,set:Sa};Object.defineProperty(pt,ri,ji)}else{var ys=Mn.property,lu=ys.kind;ys.key.type==="Identifier"&&ys.value.type==="FunctionExpression"&&lu==="init"&&!ys.value.id&&Ml(Wi,ys.key.name),pt[ri]=Wi}}return pt}},M.arrayExpressionHandler=function(O){var K=this,ge=O.elements.map(function(He){return He&&K.createClosure(He)});return function(){for(var He=ge.length,lt=Array(He),pt=0;pt<He;pt++){var nr=ge[pt];nr&&(lt[pt]=nr())}return lt}},M.safeObjectGet=function(O,K,ge){return O[K]},M.createCallFunctionGetter=function(O){var K=this;switch(O.type){case"MemberExpression":var ge=this.createClosure(O.object),He=this.createMemberKeyGetter(O),lt=this.source;return function(){var nr=ge(),sr=He(),Mn=K.safeObjectGet(nr,sr,O);if(!Mn||!Ra(Mn)){var ri=lt.slice(O.start,O.end);throw K.createInternalThrowError(sa.FunctionUndefinedReferenceError,ri,O)}return Mn.__IS_EVAL_FUNC?function(kn){return Mn(new Ua(K),kn,!0)}:Mn.__IS_FUNCTION_FUNC?function(){for(var kn=arguments.length,Wi=new Array(kn),da=0;da<kn;da++)Wi[da]=arguments[da];return Mn.apply(void 0,[new Ua(K)].concat(Wi))}:Mn.bind(nr)};default:var pt=this.createClosure(O);return function(){var nr="";O.type==="Identifier"&&(nr=O.name);var sr=pt();if(!sr||!Ra(sr))throw K.createInternalThrowError(sa.FunctionUndefinedReferenceError,nr,O);if(O.type==="Identifier"&&sr.__IS_EVAL_FUNC&&nr==="eval")return function(kn){var Wi=K.getScopeFromName(nr,K.getCurrentScope()),da=Wi.name===In||Wi.name===ao||Wi.name===Mi;return sr(new Ua(K),kn,!da)};if(sr.__IS_EVAL_FUNC)return function(kn){return sr(new Ua(K),kn,!0)};if(sr.__IS_FUNCTION_FUNC)return function(){for(var kn=arguments.length,Wi=new Array(kn),da=0;da<kn;da++)Wi[da]=arguments[da];return sr.apply(void 0,[new Ua(K)].concat(Wi))};var Mn=K.options.globalContextInFunction;if(O.type==="Identifier"){var ri=K.getIdentifierScope(O);ri.name===Ir&&(Mn=ri.data)}return sr.bind(Mn)}}},M.callExpressionHandler=function(O){var K=this,ge=this.createCallFunctionGetter(O.callee),He=O.arguments.map(function(lt){return K.createClosure(lt)});return function(){return ge().apply(void 0,He.map(function(lt){return lt()}))}},M.functionExpressionHandler=function(O){var K=this,ge=this,He=this.source,lt=this.collectDeclVars,pt=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var nr=O.id?O.id.name:"",sr=O.params.length,Mn=O.params.map(function(da){return K.createParamNameGetter(da)}),ri=this.createClosure(O.body),kn=this.collectDeclVars,Wi=this.collectDeclFuncs;return this.collectDeclVars=lt,this.collectDeclFuncs=pt,function(){var da=ge.getCurrentScope(),Sa=function ji(){for(var ys=arguments.length,lu=new Array(ys),Xu=0;Xu<ys;Xu++)lu[Xu]=arguments[Xu];ge.callStack.push(""+nr);var hf=ge.getCurrentScope(),ol=uu(da,"FunctionScope("+nr+")");ge.setCurrentScope(ol),ge.addDeclarationsToScope(kn,Wi,ol),nr&&(ol.data[nr]=ji),ol.data.arguments=arguments,Mn.forEach(function(wu,Tu){ol.data[wu()]=lu[Tu]});var kc=ge.getCurrentContext();ge.setCurrentContext(this);var Au=ri();if(ge.setCurrentContext(kc),ge.setCurrentScope(hf),ge.callStack.pop(),Au instanceof uo)return Au.value};return Ml(Sa,nr),Object.defineProperty(Sa,"length",{value:sr,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(Sa,"toString",{value:function(){return He.slice(O.start,O.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(Sa,"valueOf",{value:function(){return He.slice(O.start,O.end)},writable:!0,configurable:!0,enumerable:!1}),Sa}},M.newExpressionHandler=function(O){var K=this,ge=this.source,He=this.createClosure(O.callee),lt=O.arguments.map(function(pt){return K.createClosure(pt)});return function(){var pt=He();if(!Ra(pt)||pt.__IS_EVAL_FUNC){var nr=O.callee,sr=ge.slice(nr.start,nr.end);throw K.createInternalThrowError(sa.IsNotConstructor,sr,O)}return pt.__IS_FUNCTION_FUNC?pt.apply(void 0,[new Ua(K)].concat(lt.map(function(Mn){return Mn()}))):Do(pt,lt.map(function(Mn){return Mn()}))}},M.memberExpressionHandler=function(O){var K=this.createClosure(O.object),ge=this.createMemberKeyGetter(O);return function(){var He=K(),lt=ge();return He[lt]}},M.thisExpressionHandler=function(O){var K=this;return function(){return K.getCurrentContext()}},M.sequenceExpressionHandler=function(O){var K=this,ge=O.expressions.map(function(He){return K.createClosure(He)});return function(){for(var He,lt=ge.length,pt=0;pt<lt;pt++){var nr=ge[pt];He=nr()}return He}},M.literalHandler=function(O){return function(){return O.regex?new RegExp(O.regex.pattern,O.regex.flags):O.value}},M.identifierHandler=function(O){var K=this;return function(){var ge=K.getCurrentScope(),He=K.getScopeDataFromName(O.name,ge);return K.assertVariable(He,O.name,O),He[O.name]}},M.getIdentifierScope=function(O){var K=this.getCurrentScope(),ge=this.getScopeFromName(O.name,K);return ge},M.assignmentExpressionHandler=function(O){var K=this;O.left.type==="Identifier"&&O.right.type==="FunctionExpression"&&!O.right.id&&(O.right.id={type:"Identifier",name:O.left.name});var ge=this.createObjectGetter(O.left),He=this.createNameGetter(O.left),lt=this.createClosure(O.right);return function(){var pt=ge(),nr=He(),sr=lt();switch(O.operator!=="="&&K.assertVariable(pt,nr,O),O.operator){case"=":return pt[nr]=sr;case"+=":return pt[nr]+=sr;case"-=":return pt[nr]-=sr;case"*=":return pt[nr]*=sr;case"**=":return pt[nr]=Math.pow(pt[nr],sr);case"/=":return pt[nr]/=sr;case"%=":return pt[nr]%=sr;case"<<=":return pt[nr]<<=sr;case">>=":return pt[nr]>>=sr;case">>>=":return pt[nr]>>>=sr;case"&=":return pt[nr]&=sr;case"^=":return pt[nr]^=sr;case"|=":return pt[nr]|=sr;default:throw K.createInternalThrowError(sa.AssignmentExpressionSyntaxError,O.type,O)}}},M.functionDeclarationHandler=function(O){if(O.id){var K=this.functionExpressionHandler(O);Object.defineProperty(K,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(O.id.name,K)}return function(){return It}},M.getVariableName=function(O){if(O.type==="Identifier")return O.name;throw this.createInternalThrowError(sa.VariableTypeSyntaxError,O.type,O)},M.variableDeclarationHandler=function(O){for(var K=this,ge,He=[],lt=0;lt<O.declarations.length;lt++){var pt=O.declarations[lt];this.varDeclaration(this.getVariableName(pt.id)),pt.init&&He.push({type:"AssignmentExpression",operator:"=",left:pt.id,right:pt.init})}return He.length&&(ge=this.createClosure({type:"BlockStatement",body:He})),function(){if(ge){var nr=K.isVarDeclMode;K.isVarDeclMode=!0,ge(),K.isVarDeclMode=nr}return It}},M.assertVariable=function(O,K,ge){if(O===this.globalScope.data&&!(K in O))throw this.createInternalThrowError(sa.VariableUndefinedReferenceError,K,ge)},M.programHandler=function(O){var K=this,ge=O.body.map(function(He){return K.createClosure(He)});return function(){for(var He=It,lt=0;lt<ge.length;lt++){var pt=ge[lt],nr=K.setValue(pt());if(nr!==It&&(He=nr,He instanceof uo||He instanceof wo||He instanceof ms||He===ee||He===ye))break}return He}},M.expressionStatementHandler=function(O){return this.createClosure(O.expression)},M.emptyStatementHandler=function(O){return function(){return It}},M.returnStatementHandler=function(O){var K=O.argument?this.createClosure(O.argument):Ds;return function(){return new uo(K())}},M.ifStatementHandler=function(O){var K=this.createClosure(O.test),ge=this.createClosure(O.consequent),He=O.alternate?this.createClosure(O.alternate):function(){return It};return function(){return K()?ge():He()}},M.conditionalExpressionHandler=function(O){return this.ifStatementHandler(O)},M.forStatementHandler=function(O){var K=this,ge=Ds,He=O.test?this.createClosure(O.test):function(){return!0},lt=Ds,pt=this.createClosure(O.body);return O.type==="ForStatement"&&(ge=O.init?this.createClosure(O.init):ge,lt=O.update?this.createClosure(O.update):Ds),function(nr){var sr,Mn=It,ri=O.type==="DoWhileStatement";for(nr&&nr.type==="LabeledStatement"&&(sr=nr.label.name),ge();ri||He();lt()){ri=!1;var kn=K.setValue(pt());if(!(kn===It||kn===ye)){if(kn===ee)break;if(Mn=kn,Mn instanceof ms&&Mn.value===sr){Mn=It;continue}if(Mn instanceof uo||Mn instanceof wo||Mn instanceof ms)break}}return Mn}},M.whileStatementHandler=function(O){return this.forStatementHandler(O)},M.doWhileStatementHandler=function(O){return this.forStatementHandler(O)},M.forInStatementHandler=function(O){var K=this,ge=O.left,He=this.createClosure(O.right),lt=this.createClosure(O.body);return O.left.type==="VariableDeclaration"&&(this.createClosure(O.left)(),ge=O.left.declarations[0].id),function(pt){var nr,sr=It,Mn;pt&&pt.type==="LabeledStatement"&&(nr=pt.label.name);var ri=He();for(Mn in ri){K.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:ge,right:{type:"Literal",value:Mn}})();var kn=K.setValue(lt());if(!(kn===It||kn===ye)){if(kn===ee)break;if(sr=kn,sr instanceof ms&&sr.value===nr){sr=It;continue}if(sr instanceof uo||sr instanceof wo||sr instanceof ms)break}}return sr}},M.withStatementHandler=function(O){var K=this,ge=this.createClosure(O.object),He=this.createClosure(O.body);return function(){var lt=ge(),pt=K.getCurrentScope(),nr=new ws(lt,pt,Ir);K.setCurrentScope(nr);var sr=K.setValue(He());return K.setCurrentScope(pt),sr}},M.throwStatementHandler=function(O){var K=this,ge=this.createClosure(O.argument);return function(){throw K.setValue(void 0),ge()}},M.tryStatementHandler=function(O){var K=this,ge=this.createClosure(O.block),He=O.handler?this.catchClauseHandler(O.handler):null,lt=O.finalizer?this.createClosure(O.finalizer):null;return function(){var pt=K.getCurrentScope(),nr=K.getCurrentContext(),sr=pt.labelStack.concat([]),Mn=K.callStack.concat([]),ri=It,kn,Wi,da=function(){K.setCurrentScope(pt),K.setCurrentContext(nr),pt.labelStack=sr,K.callStack=Mn};try{ri=K.setValue(ge()),ri instanceof uo&&(kn=ri)}catch(Sa){if(da(),K.isInterruptThrow(Sa))throw Sa;if(He)try{ri=K.setValue(He(Sa)),ri instanceof uo&&(kn=ri)}catch(ji){if(da(),K.isInterruptThrow(ji))throw ji;Wi=ji}}if(lt)try{ri=lt(),ri instanceof uo&&(kn=ri)}catch(Sa){if(da(),K.isInterruptThrow(Sa))throw Sa;Wi=Sa}if(Wi)throw Wi;return kn||ri}},M.catchClauseHandler=function(O){var K=this,ge=this.createParamNameGetter(O.param),He=this.createClosure(O.body);return function(lt){var pt,nr=K.getCurrentScope(),sr=nr.data,Mn=ge(),ri=ds.call(sr,Mn),kn=sr[Mn];return sr[Mn]=lt,pt=He(),ri?sr[Mn]=kn:delete sr[Mn],pt}},M.continueStatementHandler=function(O){return function(){return O.label?new ms(O.label.name):ye}},M.breakStatementHandler=function(O){return function(){return O.label?new wo(O.label.name):ee}},M.switchStatementHandler=function(O){var K=this,ge=this.createClosure(O.discriminant),He=O.cases.map(function(lt){return K.switchCaseHandler(lt)});return function(){for(var lt=ge(),pt=!1,nr,sr,Mn,ri=0;ri<He.length;ri++){var kn=He[ri](),Wi=kn.testClosure();if(Wi===We){Mn=kn;continue}if(pt||Wi===lt){if(pt=!0,sr=K.setValue(kn.bodyClosure()),sr===It)continue;if(sr===ee||(nr=sr,nr instanceof uo||nr instanceof wo||nr instanceof ms||nr===ye))break}}if(!pt&&Mn){sr=K.setValue(Mn.bodyClosure());var da=sr===It||sr===ee||sr===ye;da||(nr=sr)}return nr}},M.switchCaseHandler=function(O){var K=O.test?this.createClosure(O.test):function(){return We},ge=this.createClosure({type:"BlockStatement",body:O.consequent});return function(){return{testClosure:K,bodyClosure:ge}}},M.labeledStatementHandler=function(O){var K=this,ge=O.label.name,He=this.createClosure(O.body);return function(){var lt,pt=K.getCurrentScope();return pt.labelStack.push(ge),lt=He(O),lt instanceof wo&&lt.value===ge&&(lt=It),pt.labelStack.pop(),lt}},M.debuggerStatementHandler=function(O){return function(){debugger;return It}},M.createParamNameGetter=function(O){if(O.type==="Identifier")return function(){return O.name};throw this.createInternalThrowError(sa.ParamTypeSyntaxError,O.type,O)},M.createObjectKeyGetter=function(O){var K;return O.type==="Identifier"?K=function(){return O.name}:K=this.createClosure(O),function(){return K()}},M.createMemberKeyGetter=function(O){return O.computed?this.createClosure(O.property):this.createObjectKeyGetter(O.property)},M.createObjectGetter=function(O){var K=this;switch(O.type){case"Identifier":return function(){return K.getScopeDataFromName(O.name,K.getCurrentScope())};case"MemberExpression":return this.createClosure(O.object);default:throw this.createInternalThrowError(sa.AssignmentTypeSyntaxError,O.type,O)}},M.createNameGetter=function(O){switch(O.type){case"Identifier":return function(){return O.name};case"MemberExpression":return this.createMemberKeyGetter(O);default:throw this.createInternalThrowError(sa.AssignmentTypeSyntaxError,O.type,O)}},M.varDeclaration=function(O){var K=this.collectDeclVars;K[O]=void 0},M.funcDeclaration=function(O,K){var ge=this.collectDeclFuncs;ge[O]=K},M.addDeclarationsToScope=function(O,K,ge){var He=ge.data;for(var lt in K){var pt=K[lt];He[lt]=pt&&pt()}for(var nr in O)nr in He||(He[nr]=void 0)},M.getScopeValue=function(O,K){var ge=this.getScopeFromName(O,K);return ge.data[O]},M.getScopeDataFromName=function(O,K){return this.getScopeFromName(O,K).data},M.getScopeFromName=function(O,K){var ge=K;do if(O in ge.data)return ge;while(ge=ge.parent);return this.globalScope},M.setValue=function(O){var K=this.callStack.length;return this.isVarDeclMode||K||O===It||O===ee||O===ye||O instanceof wo||O instanceof ms||(this.value=O instanceof uo?O.value:O),O},M.getValue=function(){return this.value},_}();_a.version=As,_a.eval=jo,_a.Function=vs,_a.ecmaVersion=5,_a.globalContextInFunction=void 0,_a.global=Object.create(null);function rs(_){return _===void 0&&(_=Object.create(null)),_}function pf(_,M,B){M===void 0&&(M=[]),B===void 0&&(B={});var O=B.parsingContext,K=B.timeout===void 0?0:B.timeout,ge=`
    (function anonymous(`+M.join(",")+`){
         `+_+`
    });
    `,He=new _a(O,{ecmaVersion:B.ecmaVersion,timeout:K,rootContext:B.rootContext,globalContextInFunction:B.globalContextInFunction});return He.evaluate(ge)}function Pl(_,M,B){var O=new _a(M,B);return O.evaluate(_)}var Ws=Pl,rc=function(){function _(B){this._code=B}var M=_.prototype;return M.runInContext=function(O){return Pl(this._code,O)},M.runInNewContext=function(O){return Pl(this._code,O)},_}(),Wu=function(_,M,B){return Pl(_,M,B)};function Xs(){for(var _=arguments.length,M=new Array(_),B=0;B<_;B++)M[B]=arguments[B];var O=M.pop();return pf(O||"",M)}var al=Wu},20396:function(Er,re,Q){var Ce;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(me,m,Re,W){"use strict";var pe=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,de=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),ze=pe||de,_e=["","webkit","Moz","MS","ms","o"],et=ze?"":m.createElement("div"),mt="function",Ct=Math.round,Bt=Math.abs,or=Date.now;function At(ee,ye,We){return setTimeout(at(ee,We),ye)}function Kt(ee,ye,We){return Array.isArray(ee)?(yt(ee,We[ye],We),!0):!1}function yt(ee,ye,We){var It;if(!!ee)if(ee.forEach)ee.forEach(ye,We);else if(ee.length!==W)for(It=0;It<ee.length;)ye.call(We,ee[It],It,ee),It++;else for(It in ee)ee.hasOwnProperty(It)&&ye.call(We,ee[It],It,ee)}function ct(ee,ye,We){var It="DEPRECATED METHOD: "+ye+`
`+We+` AT 
`;return function(){var Ir=new Error("get-stack-trace"),In=Ir&&Ir.stack?Ir.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Mi=me.console&&(me.console.warn||me.console.log);return Mi&&Mi.call(me.console,It,In),ee.apply(this,arguments)}}var it;typeof Object.assign!="function"?it=function(ye){if(ye===W||ye===null)throw new TypeError("Cannot convert undefined or null to object");for(var We=Object(ye),It=1;It<arguments.length;It++){var Ir=arguments[It];if(Ir!==W&&Ir!==null)for(var In in Ir)Ir.hasOwnProperty(In)&&(We[In]=Ir[In])}return We}:it=Object.assign;var $t=ct(function(ye,We,It){for(var Ir=Object.keys(We),In=0;In<Ir.length;)(!It||It&&ye[Ir[In]]===W)&&(ye[Ir[In]]=We[Ir[In]]),In++;return ye},"extend","Use `assign`."),X=ct(function(ye,We){return $t(ye,We,!0)},"merge","Use `assign`.");function Xt(ee,ye,We){var It=ye.prototype,Ir;Ir=ee.prototype=Object.create(It),Ir.constructor=ee,Ir._super=It,We&&it(Ir,We)}function at(ee,ye){return function(){return ee.apply(ye,arguments)}}function qe(ee,ye){return typeof ee==mt?ee.apply(ye&&ye[0]||W,ye):ee}function xt(ee,ye){return ee===W?ye:ee}function $e(ee,ye,We){yt(Yr(ye),function(It){ee.addEventListener(It,We,!1)})}function Ht(ee,ye,We){yt(Yr(ye),function(It){ee.removeEventListener(It,We,!1)})}function vr(ee,ye){for(;ee;){if(ee==ye)return!0;ee=ee.parentNode}return!1}function Fr(ee,ye){return ee.indexOf(ye)>-1}function Yr(ee){return ee.trim().split(/\s+/g)}function A(ee,ye,We){if(ee.indexOf&&!We)return ee.indexOf(ye);for(var It=0;It<ee.length;){if(We&&ee[It][We]==ye||!We&&ee[It]===ye)return It;It++}return-1}function Se(ee){return Array.prototype.slice.call(ee,0)}function ke(ee,ye,We){for(var It=[],Ir=[],In=0;In<ee.length;){var Mi=ye?ee[In][ye]:ee[In];A(Ir,Mi)<0&&It.push(ee[In]),Ir[In]=Mi,In++}return We&&(ye?It=It.sort(function(Ra,Ua){return Ra[ye]>Ua[ye]}):It=It.sort()),It}function ut(ee,ye){for(var We,It,Ir=ye[0].toUpperCase()+ye.slice(1),In=0;In<_e.length;){if(We=_e[In],It=We?We+Ir:ye,It in ee)return It;In++}return W}var ft=1;function Rt(){return ft++}function Dt(ee){var ye=ee.ownerDocument||ee;return ye.defaultView||ye.parentWindow||me}var gr=/mobile|tablet|ip(ad|hone|od)|android/i,Yn="ontouchstart"in me,Gr=ut(me,"PointerEvent")!==W,Nn=Yn&&gr.test(navigator.userAgent),yn="touch",zn="pen",si="mouse",Gn="kinect",fi=25,ta=1,zi=2,Ii=4,Ki=8,ra=1,Ya=2,na=4,ia=8,ki=16,qi=Ya|na,Gi=ia|ki,Cs=qi|Gi,fe=["x","y"],ui=["clientX","clientY"];function bo(ee,ye){var We=this;this.manager=ee,this.callback=ye,this.element=ee.element,this.target=ee.options.inputTarget,this.domHandler=function(It){qe(ee.options.enable,[ee])&&We.handler(It)},this.init()}bo.prototype={handler:function(){},init:function(){this.evEl&&$e(this.element,this.evEl,this.domHandler),this.evTarget&&$e(this.target,this.evTarget,this.domHandler),this.evWin&&$e(Dt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Ht(this.element,this.evEl,this.domHandler),this.evTarget&&Ht(this.target,this.evTarget,this.domHandler),this.evWin&&Ht(Dt(this.element),this.evWin,this.domHandler)}};function su(ee){var ye,We=ee.options.inputClass;return We?ye=We:Gr?ye=Me:Nn?ye=Ft:Yn?ye=Tt:ye=xa,new ye(ee,Ut)}function Ut(ee,ye,We){var It=We.pointers.length,Ir=We.changedPointers.length,In=ye&ta&&It-Ir==0,Mi=ye&(Ii|Ki)&&It-Ir==0;We.isFirst=!!In,We.isFinal=!!Mi,In&&(ee.session={}),We.eventType=ye,er(ee,We),ee.emit("hammer.input",We),ee.recognize(We),ee.session.prevInput=We}function er(ee,ye){var We=ee.session,It=ye.pointers,Ir=It.length;We.firstInput||(We.firstInput=Tn(ye)),Ir>1&&!We.firstMultiple?We.firstMultiple=Tn(ye):Ir===1&&(We.firstMultiple=!1);var In=We.firstInput,Mi=We.firstMultiple,ao=Mi?Mi.center:In.center,Ra=ye.center=Un(It);ye.timeStamp=or(),ye.deltaTime=ye.timeStamp-In.timeStamp,ye.angle=Li(ao,Ra),ye.distance=Sn(ao,Ra),Rr(We,ye),ye.offsetDirection=di(ye.deltaX,ye.deltaY);var Ua=bi(ye.deltaTime,ye.deltaX,ye.deltaY);ye.overallVelocityX=Ua.x,ye.overallVelocityY=Ua.y,ye.overallVelocity=Bt(Ua.x)>Bt(Ua.y)?Ua.x:Ua.y,ye.scale=Mi?io(Mi.pointers,It):1,ye.rotation=Mi?Oi(Mi.pointers,It):0,ye.maxPointers=We.prevInput?ye.pointers.length>We.prevInput.maxPointers?ye.pointers.length:We.prevInput.maxPointers:ye.pointers.length,an(We,ye);var jo=ee.element;vr(ye.srcEvent.target,jo)&&(jo=ye.srcEvent.target),ye.target=jo}function Rr(ee,ye){var We=ye.center,It=ee.offsetDelta||{},Ir=ee.prevDelta||{},In=ee.prevInput||{};(ye.eventType===ta||In.eventType===Ii)&&(Ir=ee.prevDelta={x:In.deltaX||0,y:In.deltaY||0},It=ee.offsetDelta={x:We.x,y:We.y}),ye.deltaX=Ir.x+(We.x-It.x),ye.deltaY=Ir.y+(We.y-It.y)}function an(ee,ye){var We=ee.lastInterval||ye,It=ye.timeStamp-We.timeStamp,Ir,In,Mi,ao;if(ye.eventType!=Ki&&(It>fi||We.velocity===W)){var Ra=ye.deltaX-We.deltaX,Ua=ye.deltaY-We.deltaY,jo=bi(It,Ra,Ua);In=jo.x,Mi=jo.y,Ir=Bt(jo.x)>Bt(jo.y)?jo.x:jo.y,ao=di(Ra,Ua),ee.lastInterval=ye}else Ir=We.velocity,In=We.velocityX,Mi=We.velocityY,ao=We.direction;ye.velocity=Ir,ye.velocityX=In,ye.velocityY=Mi,ye.direction=ao}function Tn(ee){for(var ye=[],We=0;We<ee.pointers.length;)ye[We]={clientX:Ct(ee.pointers[We].clientX),clientY:Ct(ee.pointers[We].clientY)},We++;return{timeStamp:or(),pointers:ye,center:Un(ye),deltaX:ee.deltaX,deltaY:ee.deltaY}}function Un(ee){var ye=ee.length;if(ye===1)return{x:Ct(ee[0].clientX),y:Ct(ee[0].clientY)};for(var We=0,It=0,Ir=0;Ir<ye;)We+=ee[Ir].clientX,It+=ee[Ir].clientY,Ir++;return{x:Ct(We/ye),y:Ct(It/ye)}}function bi(ee,ye,We){return{x:ye/ee||0,y:We/ee||0}}function di(ee,ye){return ee===ye?ra:Bt(ee)>=Bt(ye)?ee<0?Ya:na:ye<0?ia:ki}function Sn(ee,ye,We){We||(We=fe);var It=ye[We[0]]-ee[We[0]],Ir=ye[We[1]]-ee[We[1]];return Math.sqrt(It*It+Ir*Ir)}function Li(ee,ye,We){We||(We=fe);var It=ye[We[0]]-ee[We[0]],Ir=ye[We[1]]-ee[We[1]];return Math.atan2(Ir,It)*180/Math.PI}function Oi(ee,ye){return Li(ye[1],ye[0],ui)+Li(ee[1],ee[0],ui)}function io(ee,ye){return Sn(ye[0],ye[1],ui)/Sn(ee[0],ee[1],ui)}var hs={mousedown:ta,mousemove:zi,mouseup:Ii},Uo="mousedown",Na="mousemove mouseup";function xa(){this.evEl=Uo,this.evWin=Na,this.pressed=!1,bo.apply(this,arguments)}Xt(xa,bo,{handler:function(ye){var We=hs[ye.type];We&ta&&ye.button===0&&(this.pressed=!0),We&zi&&ye.which!==1&&(We=Ii),!!this.pressed&&(We&Ii&&(this.pressed=!1),this.callback(this.manager,We,{pointers:[ye],changedPointers:[ye],pointerType:si,srcEvent:ye}))}});var V={pointerdown:ta,pointermove:zi,pointerup:Ii,pointercancel:Ki,pointerout:Ki},$={2:yn,3:zn,4:si,5:Gn},te="pointerdown",he="pointermove pointerup pointercancel";!ze&&me.MSPointerEvent&&!me.PointerEvent&&(te="MSPointerDown",he="MSPointerMove MSPointerUp MSPointerCancel");function Me(){this.evEl=te,this.evWin=he,bo.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}Xt(Me,bo,{handler:function(ye){var We=this.store,It=!1,Ir=ye.type.toLowerCase().replace("ms",""),In=V[Ir],Mi=$[ye.pointerType]||ye.pointerType,ao=Mi==yn,Ra=A(We,ye.pointerId,"pointerId");In&ta&&(ye.button===0||ao)?Ra<0&&(We.push(ye),Ra=We.length-1):In&(Ii|Ki)&&(It=!0),!(Ra<0)&&(We[Ra]=ye,this.callback(this.manager,In,{pointers:We,changedPointers:[ye],pointerType:Mi,srcEvent:ye}),It&&We.splice(Ra,1))}});var Ge={touchstart:ta,touchmove:zi,touchend:Ii,touchcancel:Ki},Qe="touchstart",oe="touchstart touchmove touchend touchcancel";function Le(){this.evTarget=Qe,this.evWin=oe,this.started=!1,bo.apply(this,arguments)}Xt(Le,bo,{handler:function(ye){var We=Ge[ye.type];if(We===ta&&(this.started=!0),!!this.started){var It=ht.call(this,ye,We);We&(Ii|Ki)&&It[0].length-It[1].length==0&&(this.started=!1),this.callback(this.manager,We,{pointers:It[0],changedPointers:It[1],pointerType:yn,srcEvent:ye})}}});function ht(ee,ye){var We=Se(ee.touches),It=Se(ee.changedTouches);return ye&(Ii|Ki)&&(We=ke(We.concat(It),"identifier",!0)),[We,It]}var fr={touchstart:ta,touchmove:zi,touchend:Ii,touchcancel:Ki},kt="touchstart touchmove touchend touchcancel";function Ft(){this.evTarget=kt,this.targetIds={},bo.apply(this,arguments)}Xt(Ft,bo,{handler:function(ye){var We=fr[ye.type],It=pr.call(this,ye,We);!It||this.callback(this.manager,We,{pointers:It[0],changedPointers:It[1],pointerType:yn,srcEvent:ye})}});function pr(ee,ye){var We=Se(ee.touches),It=this.targetIds;if(ye&(ta|zi)&&We.length===1)return It[We[0].identifier]=!0,[We,We];var Ir,In,Mi=Se(ee.changedTouches),ao=[],Ra=this.target;if(In=We.filter(function(Ua){return vr(Ua.target,Ra)}),ye===ta)for(Ir=0;Ir<In.length;)It[In[Ir].identifier]=!0,Ir++;for(Ir=0;Ir<Mi.length;)It[Mi[Ir].identifier]&&ao.push(Mi[Ir]),ye&(Ii|Ki)&&delete It[Mi[Ir].identifier],Ir++;if(!!ao.length)return[ke(In.concat(ao),"identifier",!0),ao]}var _n=2500,fn=25;function Tt(){bo.apply(this,arguments);var ee=at(this.handler,this);this.touch=new Ft(this.manager,ee),this.mouse=new xa(this.manager,ee),this.primaryTouch=null,this.lastTouches=[]}Xt(Tt,bo,{handler:function(ye,We,It){var Ir=It.pointerType==yn,In=It.pointerType==si;if(!(In&&It.sourceCapabilities&&It.sourceCapabilities.firesTouchEvents)){if(Ir)Jr.call(this,We,It);else if(In&&Wr.call(this,It))return;this.callback(ye,We,It)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Jr(ee,ye){ee&ta?(this.primaryTouch=ye.changedPointers[0].identifier,Br.call(this,ye)):ee&(Ii|Ki)&&Br.call(this,ye)}function Br(ee){var ye=ee.changedPointers[0];if(ye.identifier===this.primaryTouch){var We={x:ye.clientX,y:ye.clientY};this.lastTouches.push(We);var It=this.lastTouches,Ir=function(){var In=It.indexOf(We);In>-1&&It.splice(In,1)};setTimeout(Ir,_n)}}function Wr(ee){for(var ye=ee.srcEvent.clientX,We=ee.srcEvent.clientY,It=0;It<this.lastTouches.length;It++){var Ir=this.lastTouches[It],In=Math.abs(ye-Ir.x),Mi=Math.abs(We-Ir.y);if(In<=fn&&Mi<=fn)return!0}return!1}var vi=ze?W:ut(et.style,"touchAction"),en=vi!==W,gn="compute",Hi="auto",pi="manipulation",wi="none",yi="pan-x",dt="pan-y",Mt=Ti();function wa(ee,ye){this.manager=ee,this.set(ye)}wa.prototype={set:function(ee){ee==gn&&(ee=this.compute()),en&&this.manager.element.style&&Mt[ee]&&(this.manager.element.style[vi]=ee),this.actions=ee.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var ee=[];return yt(this.manager.recognizers,function(ye){qe(ye.options.enable,[ye])&&(ee=ee.concat(ye.getTouchAction()))}),Ei(ee.join(" "))},preventDefaults:function(ee){var ye=ee.srcEvent,We=ee.offsetDirection;if(this.manager.session.prevented){ye.preventDefault();return}var It=this.actions,Ir=Fr(It,wi)&&!Mt[wi],In=Fr(It,dt)&&!Mt[dt],Mi=Fr(It,yi)&&!Mt[yi];if(Ir){var ao=ee.pointers.length===1,Ra=ee.distance<2,Ua=ee.deltaTime<250;if(ao&&Ra&&Ua)return}if(!(Mi&&In)&&(Ir||In&&We&qi||Mi&&We&Gi))return this.preventSrc(ye)},preventSrc:function(ee){this.manager.session.prevented=!0,ee.preventDefault()}};function Ei(ee){if(Fr(ee,wi))return wi;var ye=Fr(ee,yi),We=Fr(ee,dt);return ye&&We?wi:ye||We?ye?yi:dt:Fr(ee,pi)?pi:Hi}function Ti(){if(!en)return!1;var ee={};if(ze)return ee;var ye=me.CSS&&me.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(We){ee[We]=ye?me.CSS.supports("touch-action",We):!0}),ee}var Ui=1,Pr=2,on=4,gt=8,aa=gt,ue=16,qo=32;function ea(ee){this.options=it({},this.defaults,ee||{}),this.id=Rt(),this.manager=null,this.options.enable=xt(this.options.enable,!0),this.state=Ui,this.simultaneous={},this.requireFail=[]}ea.prototype={defaults:{},set:function(ee){return it(this.options,ee),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(ee){if(Kt(ee,"recognizeWith",this))return this;var ye=this.simultaneous;return ee=Ta(ee,this),ye[ee.id]||(ye[ee.id]=ee,ee.recognizeWith(this)),this},dropRecognizeWith:function(ee){return Kt(ee,"dropRecognizeWith",this)?this:(ee=Ta(ee,this),delete this.simultaneous[ee.id],this)},requireFailure:function(ee){if(Kt(ee,"requireFailure",this))return this;var ye=this.requireFail;return ee=Ta(ee,this),A(ye,ee)===-1&&(ye.push(ee),ee.requireFailure(this)),this},dropRequireFailure:function(ee){if(Kt(ee,"dropRequireFailure",this))return this;ee=Ta(ee,this);var ye=A(this.requireFail,ee);return ye>-1&&this.requireFail.splice(ye,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(ee){return!!this.simultaneous[ee.id]},emit:function(ee){var ye=this,We=this.state;function It(Ir){ye.manager.emit(Ir,ee)}We<gt&&It(ye.options.event+_u(We)),It(ye.options.event),ee.additionalEvent&&It(ee.additionalEvent),We>=gt&&It(ye.options.event+_u(We))},tryEmit:function(ee){if(this.canEmit())return this.emit(ee);this.state=qo},canEmit:function(){for(var ee=0;ee<this.requireFail.length;){if(!(this.requireFail[ee].state&(qo|Ui)))return!1;ee++}return!0},recognize:function(ee){var ye=it({},ee);if(!qe(this.options.enable,[this,ye])){this.reset(),this.state=qo;return}this.state&(aa|ue|qo)&&(this.state=Ui),this.state=this.process(ye),this.state&(Pr|on|gt|ue)&&this.tryEmit(ye)},process:function(ee){},getTouchAction:function(){},reset:function(){}};function _u(ee){return ee&ue?"cancel":ee&gt?"end":ee&on?"move":ee&Pr?"start":""}function za(ee){return ee==ki?"down":ee==ia?"up":ee==Ya?"left":ee==na?"right":""}function Ta(ee,ye){var We=ye.manager;return We?We.get(ee):ee}function qa(){ea.apply(this,arguments)}Xt(qa,ea,{defaults:{pointers:1},attrTest:function(ee){var ye=this.options.pointers;return ye===0||ee.pointers.length===ye},process:function(ee){var ye=this.state,We=ee.eventType,It=ye&(Pr|on),Ir=this.attrTest(ee);return It&&(We&Ki||!Ir)?ye|ue:It||Ir?We&Ii?ye|gt:ye&Pr?ye|on:Pr:qo}});function oa(){qa.apply(this,arguments),this.pX=null,this.pY=null}Xt(oa,qa,{defaults:{event:"pan",threshold:10,pointers:1,direction:Cs},getTouchAction:function(){var ee=this.options.direction,ye=[];return ee&qi&&ye.push(dt),ee&Gi&&ye.push(yi),ye},directionTest:function(ee){var ye=this.options,We=!0,It=ee.distance,Ir=ee.direction,In=ee.deltaX,Mi=ee.deltaY;return Ir&ye.direction||(ye.direction&qi?(Ir=In===0?ra:In<0?Ya:na,We=In!=this.pX,It=Math.abs(ee.deltaX)):(Ir=Mi===0?ra:Mi<0?ia:ki,We=Mi!=this.pY,It=Math.abs(ee.deltaY))),ee.direction=Ir,We&&It>ye.threshold&&Ir&ye.direction},attrTest:function(ee){return qa.prototype.attrTest.call(this,ee)&&(this.state&Pr||!(this.state&Pr)&&this.directionTest(ee))},emit:function(ee){this.pX=ee.deltaX,this.pY=ee.deltaY;var ye=za(ee.direction);ye&&(ee.additionalEvent=this.options.event+ye),this._super.emit.call(this,ee)}});function Ao(){qa.apply(this,arguments)}Xt(Ao,qa,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[wi]},attrTest:function(ee){return this._super.attrTest.call(this,ee)&&(Math.abs(ee.scale-1)>this.options.threshold||this.state&Pr)},emit:function(ee){if(ee.scale!==1){var ye=ee.scale<1?"in":"out";ee.additionalEvent=this.options.event+ye}this._super.emit.call(this,ee)}});function Zo(){ea.apply(this,arguments),this._timer=null,this._input=null}Xt(Zo,ea,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Hi]},process:function(ee){var ye=this.options,We=ee.pointers.length===ye.pointers,It=ee.distance<ye.threshold,Ir=ee.deltaTime>ye.time;if(this._input=ee,!It||!We||ee.eventType&(Ii|Ki)&&!Ir)this.reset();else if(ee.eventType&ta)this.reset(),this._timer=At(function(){this.state=aa,this.tryEmit()},ye.time,this);else if(ee.eventType&Ii)return aa;return qo},reset:function(){clearTimeout(this._timer)},emit:function(ee){this.state===aa&&(ee&&ee.eventType&Ii?this.manager.emit(this.options.event+"up",ee):(this._input.timeStamp=or(),this.manager.emit(this.options.event,this._input)))}});function Cu(){qa.apply(this,arguments)}Xt(Cu,qa,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[wi]},attrTest:function(ee){return this._super.attrTest.call(this,ee)&&(Math.abs(ee.rotation)>this.options.threshold||this.state&Pr)}});function ho(){qa.apply(this,arguments)}Xt(ho,qa,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:qi|Gi,pointers:1},getTouchAction:function(){return oa.prototype.getTouchAction.call(this)},attrTest:function(ee){var ye=this.options.direction,We;return ye&(qi|Gi)?We=ee.overallVelocity:ye&qi?We=ee.overallVelocityX:ye&Gi&&(We=ee.overallVelocityY),this._super.attrTest.call(this,ee)&&ye&ee.offsetDirection&&ee.distance>this.options.threshold&&ee.maxPointers==this.options.pointers&&Bt(We)>this.options.velocity&&ee.eventType&Ii},emit:function(ee){var ye=za(ee.offsetDirection);ye&&this.manager.emit(this.options.event+ye,ee),this.manager.emit(this.options.event,ee)}});function Lo(){ea.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}Xt(Lo,ea,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[pi]},process:function(ee){var ye=this.options,We=ee.pointers.length===ye.pointers,It=ee.distance<ye.threshold,Ir=ee.deltaTime<ye.time;if(this.reset(),ee.eventType&ta&&this.count===0)return this.failTimeout();if(It&&Ir&&We){if(ee.eventType!=Ii)return this.failTimeout();var In=this.pTime?ee.timeStamp-this.pTime<ye.interval:!0,Mi=!this.pCenter||Sn(this.pCenter,ee.center)<ye.posThreshold;this.pTime=ee.timeStamp,this.pCenter=ee.center,!Mi||!In?this.count=1:this.count+=1,this._input=ee;var ao=this.count%ye.taps;if(ao===0)return this.hasRequireFailures()?(this._timer=At(function(){this.state=aa,this.tryEmit()},ye.interval,this),Pr):aa}return qo},failTimeout:function(){return this._timer=At(function(){this.state=qo},this.options.interval,this),qo},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==aa&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function sa(ee,ye){return ye=ye||{},ye.recognizers=xt(ye.recognizers,sa.defaults.preset),new $a(ee,ye)}sa.VERSION="2.0.7",sa.defaults={domEvents:!1,touchAction:gn,enable:!0,inputTarget:null,inputClass:null,preset:[[Cu,{enable:!1}],[Ao,{enable:!1},["rotate"]],[ho,{direction:qi}],[oa,{direction:qi},["swipe"]],[Lo],[Lo,{event:"doubletap",taps:2},["tap"]],[Zo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Ka=1,Do=2;function $a(ee,ye){this.options=it({},sa.defaults,ye||{}),this.options.inputTarget=this.options.inputTarget||ee,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=ee,this.input=su(this),this.touchAction=new wa(this,this.options.touchAction),As(this,!0),yt(this.options.recognizers,function(We){var It=this.add(new We[0](We[1]));We[2]&&It.recognizeWith(We[2]),We[3]&&It.requireFailure(We[3])},this)}$a.prototype={set:function(ee){return it(this.options,ee),ee.touchAction&&this.touchAction.update(),ee.inputTarget&&(this.input.destroy(),this.input.target=ee.inputTarget,this.input.init()),this},stop:function(ee){this.session.stopped=ee?Do:Ka},recognize:function(ee){var ye=this.session;if(!ye.stopped){this.touchAction.preventDefaults(ee);var We,It=this.recognizers,Ir=ye.curRecognizer;(!Ir||Ir&&Ir.state&aa)&&(Ir=ye.curRecognizer=null);for(var In=0;In<It.length;)We=It[In],ye.stopped!==Do&&(!Ir||We==Ir||We.canRecognizeWith(Ir))?We.recognize(ee):We.reset(),!Ir&&We.state&(Pr|on|gt)&&(Ir=ye.curRecognizer=We),In++}},get:function(ee){if(ee instanceof ea)return ee;for(var ye=this.recognizers,We=0;We<ye.length;We++)if(ye[We].options.event==ee)return ye[We];return null},add:function(ee){if(Kt(ee,"add",this))return this;var ye=this.get(ee.options.event);return ye&&this.remove(ye),this.recognizers.push(ee),ee.manager=this,this.touchAction.update(),ee},remove:function(ee){if(Kt(ee,"remove",this))return this;if(ee=this.get(ee),ee){var ye=this.recognizers,We=A(ye,ee);We!==-1&&(ye.splice(We,1),this.touchAction.update())}return this},on:function(ee,ye){if(ee!==W&&ye!==W){var We=this.handlers;return yt(Yr(ee),function(It){We[It]=We[It]||[],We[It].push(ye)}),this}},off:function(ee,ye){if(ee!==W){var We=this.handlers;return yt(Yr(ee),function(It){ye?We[It]&&We[It].splice(A(We[It],ye),1):delete We[It]}),this}},emit:function(ee,ye){this.options.domEvents&&Ml(ee,ye);var We=this.handlers[ee]&&this.handlers[ee].slice();if(!(!We||!We.length)){ye.type=ee,ye.preventDefault=function(){ye.srcEvent.preventDefault()};for(var It=0;It<We.length;)We[It](ye),It++}},destroy:function(){this.element&&As(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function As(ee,ye){var We=ee.element;if(!!We.style){var It;yt(ee.options.cssProps,function(Ir,In){It=ut(We.style,In),ye?(ee.oldCssProps[It]=We.style[It],We.style[It]=Ir):We.style[It]=ee.oldCssProps[It]||""}),ye||(ee.oldCssProps={})}}function Ml(ee,ye){if(!ze){var We=m.createEvent("Event");We.initEvent(ee,!0,!0),We.gesture=ye,ye.target.dispatchEvent(We)}}if(!ze){it(sa,{INPUT_START:ta,INPUT_MOVE:zi,INPUT_END:Ii,INPUT_CANCEL:Ki,STATE_POSSIBLE:Ui,STATE_BEGAN:Pr,STATE_CHANGED:on,STATE_ENDED:gt,STATE_RECOGNIZED:aa,STATE_CANCELLED:ue,STATE_FAILED:qo,DIRECTION_NONE:ra,DIRECTION_LEFT:Ya,DIRECTION_RIGHT:na,DIRECTION_UP:ia,DIRECTION_DOWN:ki,DIRECTION_HORIZONTAL:qi,DIRECTION_VERTICAL:Gi,DIRECTION_ALL:Cs,Manager:$a,Input:bo,TouchAction:wa,TouchInput:Ft,MouseInput:xa,PointerEventInput:Me,TouchMouseInput:Tt,SingleTouchInput:Le,Recognizer:ea,AttrRecognizer:qa,Tap:Lo,Pan:oa,Swipe:ho,Pinch:Ao,Rotate:Cu,Press:Zo,on:$e,off:Ht,each:yt,merge:X,extend:$t,assign:it,inherit:Xt,bindFn:at,prefixed:ut});var ds=typeof window!="undefined"?window:typeof self!="undefined"?self:{};ds.Hammer=sa,Ce=function(){return sa}.call(re,Q,re,Er),Ce!==W&&(Er.exports=Ce)}})(typeof window!="undefined"?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document,"Hammer")},88307:function(Er,re,Q){(function(Ce,me){Er.exports=me(Q(18857))})(this,function(Ce){"use strict";var me=function(N){return N instanceof Uint8Array||N instanceof Uint16Array||N instanceof Uint32Array||N instanceof Int8Array||N instanceof Int16Array||N instanceof Int32Array||N instanceof Float32Array||N instanceof Float64Array||N instanceof Uint8ClampedArray},m=function(N,ce){for(var Fe=Object.keys(ce),Lt=0;Lt<Fe.length;++Lt)N[Fe[Lt]]=ce[Fe[Lt]];return N},Re=`
`;function W(N){return typeof atob!="undefined"?atob(N):"base64:"+N}function pe(N){var ce=new Error("(regl) "+N);throw console.error(ce),ce}function de(N,ce){N||pe(ce)}function ze(N){return N?": "+N:""}function _e(N,ce,Fe){N in ce||pe("unknown parameter ("+N+")"+ze(Fe)+". possible values: "+Object.keys(ce).join())}function et(N,ce){me(N)||pe("invalid parameter type"+ze(ce)+". must be a typed array")}function mt(N,ce){switch(ce){case"number":return typeof N=="number";case"object":return typeof N=="object";case"string":return typeof N=="string";case"boolean":return typeof N=="boolean";case"function":return typeof N=="function";case"undefined":return typeof N=="undefined";case"symbol":return typeof N=="symbol"}}function Ct(N,ce,Fe){mt(N,ce)||pe("invalid parameter type"+ze(Fe)+". expected "+ce+", got "+typeof N)}function Bt(N,ce){N>=0&&(N|0)===N||pe("invalid parameter type, ("+N+")"+ze(ce)+". must be a nonnegative integer")}function or(N,ce,Fe){ce.indexOf(N)<0&&pe("invalid value"+ze(Fe)+". must be one of: "+ce)}var At=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Kt(N){Object.keys(N).forEach(function(ce){At.indexOf(ce)<0&&pe('invalid regl constructor argument "'+ce+'". must be one of '+At)})}function yt(N,ce){for(N=N+"";N.length<ce;)N=" "+N;return N}function ct(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function it(N,ce){this.number=N,this.line=ce,this.errors=[]}function $t(N,ce,Fe){this.file=N,this.line=ce,this.message=Fe}function X(){var N=new Error,ce=(N.stack||N).toString(),Fe=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(ce);if(Fe)return Fe[1];var Lt=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(ce);return Lt?Lt[1]:"unknown"}function Xt(){var N=new Error,ce=(N.stack||N).toString(),Fe=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(ce);if(Fe)return Fe[1];var Lt=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(ce);return Lt?Lt[1]:"unknown"}function at(N,ce){var Fe=N.split(`
`),Lt=1,rr=0,Ot={unknown:new ct,0:new ct};Ot.unknown.name=Ot[0].name=ce||X(),Ot.unknown.lines.push(new it(0,""));for(var Qt=0;Qt<Fe.length;++Qt){var lr=Fe[Qt],dr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(lr);if(dr)switch(dr[1]){case"line":var _r=/(\d+)(\s+\d+)?/.exec(dr[2]);_r&&(Lt=_r[1]|0,_r[2]&&(rr=_r[2]|0,rr in Ot||(Ot[rr]=new ct)));break;case"define":var Ar=/SHADER_NAME(_B64)?\s+(.*)$/.exec(dr[2]);Ar&&(Ot[rr].name=Ar[1]?W(Ar[2]):Ar[2]);break}Ot[rr].lines.push(new it(Lt++,lr))}return Object.keys(Ot).forEach(function(wr){var jr=Ot[wr];jr.lines.forEach(function(mr){jr.index[mr.number]=mr})}),Ot}function qe(N){var ce=[];return N.split(`
`).forEach(function(Fe){if(!(Fe.length<5)){var Lt=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(Fe);Lt?ce.push(new $t(Lt[1]|0,Lt[2]|0,Lt[3].trim())):Fe.length>0&&ce.push(new $t("unknown",0,Fe))}}),ce}function xt(N,ce){ce.forEach(function(Fe){var Lt=N[Fe.file];if(Lt){var rr=Lt.index[Fe.line];if(rr){rr.errors.push(Fe),Lt.hasErrors=!0;return}}N.unknown.hasErrors=!0,N.unknown.lines[0].errors.push(Fe)})}function $e(N,ce,Fe,Lt,rr){if(!N.getShaderParameter(ce,N.COMPILE_STATUS)){var Ot=N.getShaderInfoLog(ce),Qt=Lt===N.FRAGMENT_SHADER?"fragment":"vertex";ke(Fe,"string",Qt+" shader source must be a string",rr);var lr=at(Fe,rr),dr=qe(Ot);xt(lr,dr),Object.keys(lr).forEach(function(_r){var Ar=lr[_r];if(!Ar.hasErrors)return;var wr=[""],jr=[""];function mr(Cr,nt){wr.push(Cr),jr.push(nt||"")}mr("file number "+_r+": "+Ar.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Ar.lines.forEach(function(Cr){if(Cr.errors.length>0){mr(yt(Cr.number,4)+"|  ","background-color:yellow; font-weight:bold"),mr(Cr.line+Re,"color:red; background-color:yellow; font-weight:bold");var nt=0;Cr.errors.forEach(function(jt){var xr=jt.message,Nr=/^\s*'(.*)'\s*:\s*(.*)$/.exec(xr);if(Nr){var ur=Nr[1];switch(xr=Nr[2],ur){case"assign":ur="=";break}nt=Math.max(Cr.line.indexOf(ur,nt),0)}else nt=0;mr(yt("| ",6)),mr(yt("^^^",nt+3)+Re,"font-weight:bold"),mr(yt("| ",6)),mr(xr+Re,"font-weight:bold")}),mr(yt("| ",6)+Re)}else mr(yt(Cr.number,4)+"|  "),mr(Cr.line+Re,"color:red")}),typeof document!="undefined"&&!window.chrome?(jr[0]=wr.join("%c"),console.log.apply(console,jr)):console.log(wr.join(""))}),de.raise("Error compiling "+Qt+" shader, "+lr[0].name)}}function Ht(N,ce,Fe,Lt,rr){if(!N.getProgramParameter(ce,N.LINK_STATUS)){var Ot=N.getProgramInfoLog(ce),Qt=at(Fe,rr),lr=at(Lt,rr),dr='Error linking program with vertex shader, "'+lr[0].name+'", and fragment shader "'+Qt[0].name+'"';typeof document!="undefined"?console.log("%c"+dr+Re+"%c"+Ot,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(dr+Re+Ot),de.raise(dr)}}function vr(N){N._commandRef=X()}function Fr(N,ce,Fe,Lt){vr(N);function rr(dr){return dr?Lt.id(dr):0}N._fragId=rr(N.static.frag),N._vertId=rr(N.static.vert);function Ot(dr,_r){Object.keys(_r).forEach(function(Ar){dr[Lt.id(Ar)]=!0})}var Qt=N._uniformSet={};Ot(Qt,ce.static),Ot(Qt,ce.dynamic);var lr=N._attributeSet={};Ot(lr,Fe.static),Ot(lr,Fe.dynamic),N._hasCount="count"in N.static||"count"in N.dynamic||"elements"in N.static||"elements"in N.dynamic}function Yr(N,ce){var Fe=Xt();pe(N+" in command "+(ce||X())+(Fe==="unknown"?"":" called from "+Fe))}function A(N,ce,Fe){N||Yr(ce,Fe||X())}function Se(N,ce,Fe,Lt){N in ce||Yr("unknown parameter ("+N+")"+ze(Fe)+". possible values: "+Object.keys(ce).join(),Lt||X())}function ke(N,ce,Fe,Lt){mt(N,ce)||Yr("invalid parameter type"+ze(Fe)+". expected "+ce+", got "+typeof N,Lt||X())}function ut(N){N()}function ft(N,ce,Fe){N.texture?or(N.texture._texture.internalformat,ce,"unsupported texture format for attachment"):or(N.renderbuffer._renderbuffer.format,Fe,"unsupported renderbuffer format for attachment")}var Rt=33071,Dt=9728,gr=9984,Yn=9985,Gr=9986,Nn=9987,yn=5120,zn=5121,si=5122,Gn=5123,fi=5124,ta=5125,zi=5126,Ii=32819,Ki=32820,ra=33635,Ya=34042,na=36193,ia={};ia[yn]=ia[zn]=1,ia[si]=ia[Gn]=ia[na]=ia[ra]=ia[Ii]=ia[Ki]=2,ia[fi]=ia[ta]=ia[zi]=ia[Ya]=4;function ki(N,ce){return N===Ki||N===Ii||N===ra?2:N===Ya?4:ia[N]*ce}function qi(N){return!(N&N-1)&&!!N}function Gi(N,ce,Fe){var Lt,rr=ce.width,Ot=ce.height,Qt=ce.channels;de(rr>0&&rr<=Fe.maxTextureSize&&Ot>0&&Ot<=Fe.maxTextureSize,"invalid texture shape"),(N.wrapS!==Rt||N.wrapT!==Rt)&&de(qi(rr)&&qi(Ot),"incompatible wrap mode for texture, both width and height must be power of 2"),ce.mipmask===1?rr!==1&&Ot!==1&&de(N.minFilter!==gr&&N.minFilter!==Gr&&N.minFilter!==Yn&&N.minFilter!==Nn,"min filter requires mipmap"):(de(qi(rr)&&qi(Ot),"texture must be a square power of 2 to support mipmapping"),de(ce.mipmask===(rr<<1)-1,"missing or incomplete mipmap data")),ce.type===zi&&(Fe.extensions.indexOf("oes_texture_float_linear")<0&&de(N.minFilter===Dt&&N.magFilter===Dt,"filter not supported, must enable oes_texture_float_linear"),de(!N.genMipmaps,"mipmap generation not supported with float textures"));var lr=ce.images;for(Lt=0;Lt<16;++Lt)if(lr[Lt]){var dr=rr>>Lt,_r=Ot>>Lt;de(ce.mipmask&1<<Lt,"missing mipmap data");var Ar=lr[Lt];if(de(Ar.width===dr&&Ar.height===_r,"invalid shape for mip images"),de(Ar.format===ce.format&&Ar.internalformat===ce.internalformat&&Ar.type===ce.type,"incompatible type for mip image"),!Ar.compressed)if(Ar.data){var wr=Math.ceil(ki(Ar.type,Qt)*dr/Ar.unpackAlignment)*Ar.unpackAlignment;de(Ar.data.byteLength===wr*_r,"invalid data for image, buffer size is inconsistent with image format")}else Ar.element||Ar.copy}else N.genMipmaps||de((ce.mipmask&1<<Lt)==0,"extra mipmap data");ce.compressed&&de(!N.genMipmaps,"mipmap generation for compressed images not supported")}function Cs(N,ce,Fe,Lt){var rr=N.width,Ot=N.height,Qt=N.channels;de(rr>0&&rr<=Lt.maxTextureSize&&Ot>0&&Ot<=Lt.maxTextureSize,"invalid texture shape"),de(rr===Ot,"cube map must be square"),de(ce.wrapS===Rt&&ce.wrapT===Rt,"wrap mode not supported by cube map");for(var lr=0;lr<Fe.length;++lr){var dr=Fe[lr];de(dr.width===rr&&dr.height===Ot,"inconsistent cube map face shape"),ce.genMipmaps&&(de(!dr.compressed,"can not generate mipmap for compressed textures"),de(dr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var _r=dr.images,Ar=0;Ar<16;++Ar){var wr=_r[Ar];if(wr){var jr=rr>>Ar,mr=Ot>>Ar;de(dr.mipmask&1<<Ar,"missing mipmap data"),de(wr.width===jr&&wr.height===mr,"invalid shape for mip images"),de(wr.format===N.format&&wr.internalformat===N.internalformat&&wr.type===N.type,"incompatible type for mip image"),wr.compressed||(wr.data?de(wr.data.byteLength===jr*mr*Math.max(ki(wr.type,Qt),wr.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):wr.element||wr.copy)}}}}var fe=m(de,{optional:ut,raise:pe,commandRaise:Yr,command:A,parameter:_e,commandParameter:Se,constructor:Kt,type:Ct,commandType:ke,isTypedArray:et,nni:Bt,oneOf:or,shaderError:$e,linkError:Ht,callSite:Xt,saveCommandRef:vr,saveDrawInfo:Fr,framebufferFormat:ft,guessCommand:X,texture2D:Gi,textureCube:Cs}),ui=0,bo=0,su=5,Ut=6;function er(N,ce){this.id=ui++,this.type=N,this.data=ce}function Rr(N){return N.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function an(N){if(N.length===0)return[];var ce=N.charAt(0),Fe=N.charAt(N.length-1);if(N.length>1&&ce===Fe&&(ce==='"'||ce==="'"))return['"'+Rr(N.substr(1,N.length-2))+'"'];var Lt=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(N);if(Lt)return an(N.substr(0,Lt.index)).concat(an(Lt[1])).concat(an(N.substr(Lt.index+Lt[0].length)));var rr=N.split(".");if(rr.length===1)return['"'+Rr(N)+'"'];for(var Ot=[],Qt=0;Qt<rr.length;++Qt)Ot=Ot.concat(an(rr[Qt]));return Ot}function Tn(N){return"["+an(N).join("][")+"]"}function Un(N,ce){return new er(N,Tn(ce+""))}function bi(N){return typeof N=="function"&&!N._reglType||N instanceof er}function di(N,ce){if(typeof N=="function")return new er(bo,N);if(typeof N=="number"||typeof N=="boolean")return new er(su,N);if(Array.isArray(N))return new er(Ut,N.map(function(Fe,Lt){return di(Fe,ce+"["+Lt+"]")}));if(N instanceof er)return N;fe(!1,"invalid option type in uniform "+ce)}var Sn={DynamicVariable:er,define:Un,isDynamic:bi,unbox:di,accessor:Tn},Li={next:typeof requestAnimationFrame=="function"?function(N){return requestAnimationFrame(N)}:function(N){return setTimeout(N,16)},cancel:typeof cancelAnimationFrame=="function"?function(N){return cancelAnimationFrame(N)}:clearTimeout},Oi=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,io=Oi?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function hs(){var N={"":0},ce=[""];return{id:function(Fe){var Lt=N[Fe];return Lt||(Lt=N[Fe]=ce.length,ce.push(Fe),Lt)},str:function(Fe){return ce[Fe]}}}function Uo(N,ce,Fe){var Lt=document.createElement("canvas");m(Lt.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),N.appendChild(Lt),N===document.body&&(Lt.style.position="absolute",m(N.style,{margin:0,padding:0}));function rr(){var lr=window.innerWidth,dr=window.innerHeight;if(N!==document.body){var _r=Lt.getBoundingClientRect();lr=_r.right-_r.left,dr=_r.bottom-_r.top}Lt.width=Fe*lr,Lt.height=Fe*dr}var Ot;N!==document.body&&typeof ResizeObserver=="function"?(Ot=new ResizeObserver(function(){setTimeout(rr)}),Ot.observe(N)):window.addEventListener("resize",rr,!1);function Qt(){Ot?Ot.disconnect():window.removeEventListener("resize",rr),N.removeChild(Lt)}return rr(),{canvas:Lt,onDestroy:Qt}}function Na(N,ce){function Fe(Lt){try{return N.getContext(Lt,ce)}catch(rr){return null}}return Fe("webgl")||Fe("experimental-webgl")||Fe("webgl-experimental")}function xa(N){return typeof N.nodeName=="string"&&typeof N.appendChild=="function"&&typeof N.getBoundingClientRect=="function"}function V(N){return typeof N.drawArrays=="function"||typeof N.drawElements=="function"}function $(N){return typeof N=="string"?N.split():(fe(Array.isArray(N),"invalid extension array"),N)}function te(N){return typeof N=="string"?(fe(typeof document!="undefined","not supported outside of DOM"),document.querySelector(N)):N}function he(N){var ce=N||{},Fe,Lt,rr,Ot,Qt={},lr=[],dr=[],_r=typeof window=="undefined"?1:window.devicePixelRatio,Ar=!1,wr=function(Cr){Cr&&fe.raise(Cr)},jr=function(){};if(typeof ce=="string"?(fe(typeof document!="undefined","selector queries only supported in DOM environments"),Fe=document.querySelector(ce),fe(Fe,"invalid query string for element")):typeof ce=="object"?xa(ce)?Fe=ce:V(ce)?(Ot=ce,rr=Ot.canvas):(fe.constructor(ce),"gl"in ce?Ot=ce.gl:"canvas"in ce?rr=te(ce.canvas):"container"in ce&&(Lt=te(ce.container)),"attributes"in ce&&(Qt=ce.attributes,fe.type(Qt,"object","invalid context attributes")),"extensions"in ce&&(lr=$(ce.extensions)),"optionalExtensions"in ce&&(dr=$(ce.optionalExtensions)),"onDone"in ce&&(fe.type(ce.onDone,"function","invalid or missing onDone callback"),wr=ce.onDone),"profile"in ce&&(Ar=!!ce.profile),"pixelRatio"in ce&&(_r=+ce.pixelRatio,fe(_r>0,"invalid pixel ratio"))):fe.raise("invalid arguments to regl"),Fe&&(Fe.nodeName.toLowerCase()==="canvas"?rr=Fe:Lt=Fe),!Ot){if(!rr){fe(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var mr=Uo(Lt||document.body,wr,_r);if(!mr)return null;rr=mr.canvas,jr=mr.onDestroy}Qt.premultipliedAlpha===void 0&&(Qt.premultipliedAlpha=!0),Ot=Na(rr,Qt)}return Ot?{gl:Ot,canvas:rr,container:Lt,extensions:lr,optionalExtensions:dr,pixelRatio:_r,profile:Ar,onDone:wr,onDestroy:jr}:(jr(),wr("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Me(N,ce){var Fe={};function Lt(lr){fe.type(lr,"string","extension name must be string");var dr=lr.toLowerCase(),_r;try{_r=Fe[dr]=rr(lr)}catch(Ar){}return!!_r}function rr(lr){return N.getExtension(lr)?N.getExtension(lr):N.getExtension(lr.toLowerCase())?N.getExtension(lr.toLowerCase()):null}for(var Ot=0;Ot<ce.extensions.length;++Ot){var Qt=ce.extensions[Ot];if(!Lt(Qt))return ce.onDestroy(),ce.onDone('"'+Qt+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return ce.optionalExtensions.forEach(Lt),{extensions:Fe,restore:function(){Object.keys(Fe).forEach(function(lr){if(Fe[lr]&&!Lt(lr))throw new Error("(regl): error restoring extension "+lr)})}}}function Ge(N,ce){for(var Fe=Array(N),Lt=0;Lt<N;++Lt)Fe[Lt]=ce(Lt);return Fe}var Qe=5120,oe=5121,Le=5122,ht=5123,fr=5124,kt=5125,Ft=5126;function pr(N){for(var ce=16;ce<=1<<28;ce*=16)if(N<=ce)return ce;return 0}function _n(N){var ce,Fe;return ce=(N>65535)<<4,N>>>=ce,Fe=(N>255)<<3,N>>>=Fe,ce|=Fe,Fe=(N>15)<<2,N>>>=Fe,ce|=Fe,Fe=(N>3)<<1,N>>>=Fe,ce|=Fe,ce|N>>1}function fn(){var N=Ge(8,function(){return[]});function ce(Ot){var Qt=pr(Ot),lr=N[_n(Qt)>>2];return lr.length>0?lr.pop():new ArrayBuffer(Qt)}function Fe(Ot){N[_n(Ot.byteLength)>>2].push(Ot)}function Lt(Ot,Qt){var lr=null;switch(Ot){case Qe:lr=new Int8Array(ce(Qt),0,Qt);break;case oe:lr=new Uint8Array(ce(Qt),0,Qt);break;case Le:lr=new Int16Array(ce(2*Qt),0,Qt);break;case ht:lr=new Uint16Array(ce(2*Qt),0,Qt);break;case fr:lr=new Int32Array(ce(4*Qt),0,Qt);break;case kt:lr=new Uint32Array(ce(4*Qt),0,Qt);break;case Ft:lr=new Float32Array(ce(4*Qt),0,Qt);break;default:return null}return lr.length!==Qt?lr.subarray(0,Qt):lr}function rr(Ot){Fe(Ot.buffer)}return{alloc:ce,free:Fe,allocType:Lt,freeType:rr}}var Tt=fn();Tt.zero=fn();var Jr=3408,Br=3410,Wr=3411,vi=3412,en=3413,gn=3414,Hi=3415,pi=33901,wi=33902,yi=3379,dt=3386,Mt=34921,wa=36347,Ei=36348,Ti=35661,Ui=35660,Pr=34930,on=36349,gt=34076,aa=34024,ue=7936,qo=7937,ea=7938,_u=35724,za=34047,Ta=36063,qa=34852,oa=3553,Ao=34067,Zo=34069,Cu=33984,ho=6408,Lo=5126,sa=5121,Ka=36160,Do=36053,$a=36064,As=16384,Ml=function(N,ce){var Fe=1;ce.ext_texture_filter_anisotropic&&(Fe=N.getParameter(za));var Lt=1,rr=1;ce.webgl_draw_buffers&&(Lt=N.getParameter(qa),rr=N.getParameter(Ta));var Ot=!!ce.oes_texture_float;if(Ot){var Qt=N.createTexture();N.bindTexture(oa,Qt),N.texImage2D(oa,0,ho,1,1,0,ho,Lo,null);var lr=N.createFramebuffer();if(N.bindFramebuffer(Ka,lr),N.framebufferTexture2D(Ka,$a,oa,Qt,0),N.bindTexture(oa,null),N.checkFramebufferStatus(Ka)!==Do)Ot=!1;else{N.viewport(0,0,1,1),N.clearColor(1,0,0,1),N.clear(As);var dr=Tt.allocType(Lo,4);N.readPixels(0,0,1,1,ho,Lo,dr),N.getError()?Ot=!1:(N.deleteFramebuffer(lr),N.deleteTexture(Qt),Ot=dr[0]===1),Tt.freeType(dr)}}var _r=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Ar=!0;if(!_r){var wr=N.createTexture(),jr=Tt.allocType(sa,36);N.activeTexture(Cu),N.bindTexture(Ao,wr),N.texImage2D(Zo,0,ho,3,3,0,ho,sa,jr),Tt.freeType(jr),N.bindTexture(Ao,null),N.deleteTexture(wr),Ar=!N.getError()}return{colorBits:[N.getParameter(Br),N.getParameter(Wr),N.getParameter(vi),N.getParameter(en)],depthBits:N.getParameter(gn),stencilBits:N.getParameter(Hi),subpixelBits:N.getParameter(Jr),extensions:Object.keys(ce).filter(function(mr){return!!ce[mr]}),maxAnisotropic:Fe,maxDrawbuffers:Lt,maxColorAttachments:rr,pointSizeDims:N.getParameter(pi),lineWidthDims:N.getParameter(wi),maxViewportDims:N.getParameter(dt),maxCombinedTextureUnits:N.getParameter(Ti),maxCubeMapSize:N.getParameter(gt),maxRenderbufferSize:N.getParameter(aa),maxTextureUnits:N.getParameter(Pr),maxTextureSize:N.getParameter(yi),maxAttributes:N.getParameter(Mt),maxVertexUniforms:N.getParameter(wa),maxVertexTextureUnits:N.getParameter(Ui),maxVaryingVectors:N.getParameter(Ei),maxFragmentUniforms:N.getParameter(on),glsl:N.getParameter(_u),renderer:N.getParameter(qo),vendor:N.getParameter(ue),version:N.getParameter(ea),readFloat:Ot,npotTextureCube:Ar}};function ds(N){return!!N&&typeof N=="object"&&Array.isArray(N.shape)&&Array.isArray(N.stride)&&typeof N.offset=="number"&&N.shape.length===N.stride.length&&(Array.isArray(N.data)||me(N.data))}var ee=function(N){return Object.keys(N).map(function(ce){return N[ce]})},ye={shape:ao,flatten:Mi};function We(N,ce,Fe){for(var Lt=0;Lt<ce;++Lt)Fe[Lt]=N[Lt]}function It(N,ce,Fe,Lt){for(var rr=0,Ot=0;Ot<ce;++Ot)for(var Qt=N[Ot],lr=0;lr<Fe;++lr)Lt[rr++]=Qt[lr]}function Ir(N,ce,Fe,Lt,rr,Ot){for(var Qt=Ot,lr=0;lr<ce;++lr)for(var dr=N[lr],_r=0;_r<Fe;++_r)for(var Ar=dr[_r],wr=0;wr<Lt;++wr)rr[Qt++]=Ar[wr]}function In(N,ce,Fe,Lt,rr){for(var Ot=1,Qt=Fe+1;Qt<ce.length;++Qt)Ot*=ce[Qt];var lr=ce[Fe];if(ce.length-Fe==4){var dr=ce[Fe+1],_r=ce[Fe+2],Ar=ce[Fe+3];for(Qt=0;Qt<lr;++Qt)Ir(N[Qt],dr,_r,Ar,Lt,rr),rr+=Ot}else for(Qt=0;Qt<lr;++Qt)In(N[Qt],ce,Fe+1,Lt,rr),rr+=Ot}function Mi(N,ce,Fe,Lt){var rr=1;if(ce.length)for(var Ot=0;Ot<ce.length;++Ot)rr*=ce[Ot];else rr=0;var Qt=Lt||Tt.allocType(Fe,rr);switch(ce.length){case 0:break;case 1:We(N,ce[0],Qt);break;case 2:It(N,ce[0],ce[1],Qt);break;case 3:Ir(N,ce[0],ce[1],ce[2],Qt,0);break;default:In(N,ce,0,Qt,0)}return Qt}function ao(N){for(var ce=[],Fe=N;Fe.length;Fe=Fe[0])ce.push(Fe.length);return ce}var Ra={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Ua=5120,jo=5122,vs=5124,uo=5121,wo=5123,ms=5125,ws=5126,Ds=5126,uu={int8:Ua,int16:jo,int32:vs,uint8:uo,uint16:wo,uint32:ms,float:ws,float32:Ds},gs=35048,ma=35040,_a={dynamic:gs,stream:ma,static:35044},rs=ye.flatten,pf=ye.shape,Pl=35044,Ws=35040,rc=5121,Wu=5126,Xs=[];Xs[5120]=1,Xs[5122]=2,Xs[5124]=4,Xs[5121]=1,Xs[5123]=2,Xs[5125]=4,Xs[5126]=4;function al(N){return Ra[Object.prototype.toString.call(N)]|0}function _(N,ce){for(var Fe=0;Fe<ce.length;++Fe)N[Fe]=ce[Fe]}function M(N,ce,Fe,Lt,rr,Ot,Qt){for(var lr=0,dr=0;dr<Fe;++dr)for(var _r=0;_r<Lt;++_r)N[lr++]=ce[rr*dr+Ot*_r+Qt]}function B(N,ce,Fe,Lt){var rr=0,Ot={};function Qt(nt){this.id=rr++,this.buffer=N.createBuffer(),this.type=nt,this.usage=Pl,this.byteLength=0,this.dimension=1,this.dtype=rc,this.persistentData=null,Fe.profile&&(this.stats={size:0})}Qt.prototype.bind=function(){N.bindBuffer(this.type,this.buffer)},Qt.prototype.destroy=function(){jr(this)};var lr=[];function dr(nt,jt){var xr=lr.pop();return xr||(xr=new Qt(nt)),xr.bind(),wr(xr,jt,Ws,0,1,!1),xr}function _r(nt){lr.push(nt)}function Ar(nt,jt,xr){nt.byteLength=jt.byteLength,N.bufferData(nt.type,jt,xr)}function wr(nt,jt,xr,Nr,ur,Or){var $r;if(nt.usage=xr,Array.isArray(jt)){if(nt.dtype=Nr||Wu,jt.length>0){var Fn;if(Array.isArray(jt[0])){$r=pf(jt);for(var Jt=1,tr=1;tr<$r.length;++tr)Jt*=$r[tr];nt.dimension=Jt,Fn=rs(jt,$r,nt.dtype),Ar(nt,Fn,xr),Or?nt.persistentData=Fn:Tt.freeType(Fn)}else if(typeof jt[0]=="number"){nt.dimension=ur;var xn=Tt.allocType(nt.dtype,jt.length);_(xn,jt),Ar(nt,xn,xr),Or?nt.persistentData=xn:Tt.freeType(xn)}else me(jt[0])?(nt.dimension=jt[0].length,nt.dtype=Nr||al(jt[0])||Wu,Fn=rs(jt,[jt.length,jt[0].length],nt.dtype),Ar(nt,Fn,xr),Or?nt.persistentData=Fn:Tt.freeType(Fn)):fe.raise("invalid buffer data")}}else if(me(jt))nt.dtype=Nr||al(jt),nt.dimension=ur,Ar(nt,jt,xr),Or&&(nt.persistentData=new Uint8Array(new Uint8Array(jt.buffer)));else if(ds(jt)){$r=jt.shape;var Vr=jt.stride,Sr=jt.offset,qr=0,Kr=0,mi=0,ii=0;$r.length===1?(qr=$r[0],Kr=1,mi=Vr[0],ii=0):$r.length===2?(qr=$r[0],Kr=$r[1],mi=Vr[0],ii=Vr[1]):fe.raise("invalid shape"),nt.dtype=Nr||al(jt.data)||Wu,nt.dimension=Kr;var Hr=Tt.allocType(nt.dtype,qr*Kr);M(Hr,jt.data,qr,Kr,mi,ii,Sr),Ar(nt,Hr,xr),Or?nt.persistentData=Hr:Tt.freeType(Hr)}else jt instanceof ArrayBuffer?(nt.dtype=rc,nt.dimension=ur,Ar(nt,jt,xr),Or&&(nt.persistentData=new Uint8Array(new Uint8Array(jt)))):fe.raise("invalid buffer data")}function jr(nt){ce.bufferCount--,Lt(nt);var jt=nt.buffer;fe(jt,"buffer must not be deleted already"),N.deleteBuffer(jt),nt.buffer=null,delete Ot[nt.id]}function mr(nt,jt,xr,Nr){ce.bufferCount++;var ur=new Qt(jt);Ot[ur.id]=ur;function Or(Jt){var tr=Pl,xn=null,Vr=0,Sr=0,qr=1;return Array.isArray(Jt)||me(Jt)||ds(Jt)||Jt instanceof ArrayBuffer?xn=Jt:typeof Jt=="number"?Vr=Jt|0:Jt&&(fe.type(Jt,"object","buffer arguments must be an object, a number or an array"),"data"in Jt&&(fe(xn===null||Array.isArray(xn)||me(xn)||ds(xn),"invalid data for buffer"),xn=Jt.data),"usage"in Jt&&(fe.parameter(Jt.usage,_a,"invalid buffer usage"),tr=_a[Jt.usage]),"type"in Jt&&(fe.parameter(Jt.type,uu,"invalid buffer type"),Sr=uu[Jt.type]),"dimension"in Jt&&(fe.type(Jt.dimension,"number","invalid dimension"),qr=Jt.dimension|0),"length"in Jt&&(fe.nni(Vr,"buffer length must be a nonnegative integer"),Vr=Jt.length|0)),ur.bind(),xn?wr(ur,xn,tr,Sr,qr,Nr):(Vr&&N.bufferData(ur.type,Vr,tr),ur.dtype=Sr||rc,ur.usage=tr,ur.dimension=qr,ur.byteLength=Vr),Fe.profile&&(ur.stats.size=ur.byteLength*Xs[ur.dtype]),Or}function $r(Jt,tr){fe(tr+Jt.byteLength<=ur.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+Jt.byteLength+" starting from offset "+tr+" to a buffer of size "+ur.byteLength),N.bufferSubData(ur.type,tr,Jt)}function Fn(Jt,tr){var xn=(tr||0)|0,Vr;if(ur.bind(),me(Jt)||Jt instanceof ArrayBuffer)$r(Jt,xn);else if(Array.isArray(Jt)){if(Jt.length>0)if(typeof Jt[0]=="number"){var Sr=Tt.allocType(ur.dtype,Jt.length);_(Sr,Jt),$r(Sr,xn),Tt.freeType(Sr)}else if(Array.isArray(Jt[0])||me(Jt[0])){Vr=pf(Jt);var qr=rs(Jt,Vr,ur.dtype);$r(qr,xn),Tt.freeType(qr)}else fe.raise("invalid buffer data")}else if(ds(Jt)){Vr=Jt.shape;var Kr=Jt.stride,mi=0,ii=0,Hr=0,rn=0;Vr.length===1?(mi=Vr[0],ii=1,Hr=Kr[0],rn=0):Vr.length===2?(mi=Vr[0],ii=Vr[1],Hr=Kr[0],rn=Kr[1]):fe.raise("invalid shape");var Qn=Array.isArray(Jt.data)?ur.dtype:al(Jt.data),ci=Tt.allocType(Qn,mi*ii);M(ci,Jt.data,mi,ii,Hr,rn,Jt.offset),$r(ci,xn),Tt.freeType(ci)}else fe.raise("invalid data for buffer subdata");return Or}return xr||Or(nt),Or._reglType="buffer",Or._buffer=ur,Or.subdata=Fn,Fe.profile&&(Or.stats=ur.stats),Or.destroy=function(){jr(ur)},Or}function Cr(){ee(Ot).forEach(function(nt){nt.buffer=N.createBuffer(),N.bindBuffer(nt.type,nt.buffer),N.bufferData(nt.type,nt.persistentData||nt.byteLength,nt.usage)})}return Fe.profile&&(ce.getTotalBufferSize=function(){var nt=0;return Object.keys(Ot).forEach(function(jt){nt+=Ot[jt].stats.size}),nt}),{create:mr,createStream:dr,destroyStream:_r,clear:function(){ee(Ot).forEach(jr),lr.forEach(jr)},getBuffer:function(nt){return nt&&nt._buffer instanceof Qt?nt._buffer:null},restore:Cr,_initBuffer:wr}}var O=0,K=0,ge=1,He=1,lt=4,pt=4,nr={points:O,point:K,lines:ge,line:He,triangles:lt,triangle:pt,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},sr=0,Mn=1,ri=4,kn=5120,Wi=5121,da=5122,Sa=5123,ji=5124,ys=5125,lu=34963,Xu=35040,hf=35044;function ol(N,ce,Fe,Lt){var rr={},Ot=0,Qt={uint8:Wi,uint16:Sa};ce.oes_element_index_uint&&(Qt.uint32=ys);function lr(Cr){this.id=Ot++,rr[this.id]=this,this.buffer=Cr,this.primType=ri,this.vertCount=0,this.type=0}lr.prototype.bind=function(){this.buffer.bind()};var dr=[];function _r(Cr){var nt=dr.pop();return nt||(nt=new lr(Fe.create(null,lu,!0,!1)._buffer)),wr(nt,Cr,Xu,-1,-1,0,0),nt}function Ar(Cr){dr.push(Cr)}function wr(Cr,nt,jt,xr,Nr,ur,Or){Cr.buffer.bind();var $r;if(nt){var Fn=Or;!Or&&(!me(nt)||ds(nt)&&!me(nt.data))&&(Fn=ce.oes_element_index_uint?ys:Sa),Fe._initBuffer(Cr.buffer,nt,jt,Fn,3)}else N.bufferData(lu,ur,jt),Cr.buffer.dtype=$r||Wi,Cr.buffer.usage=jt,Cr.buffer.dimension=3,Cr.buffer.byteLength=ur;if($r=Or,!Or){switch(Cr.buffer.dtype){case Wi:case kn:$r=Wi;break;case Sa:case da:$r=Sa;break;case ys:case ji:$r=ys;break;default:fe.raise("unsupported type for element array")}Cr.buffer.dtype=$r}Cr.type=$r,fe($r!==ys||!!ce.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var Jt=Nr;Jt<0&&(Jt=Cr.buffer.byteLength,$r===Sa?Jt>>=1:$r===ys&&(Jt>>=2)),Cr.vertCount=Jt;var tr=xr;if(xr<0){tr=ri;var xn=Cr.buffer.dimension;xn===1&&(tr=sr),xn===2&&(tr=Mn),xn===3&&(tr=ri)}Cr.primType=tr}function jr(Cr){Lt.elementsCount--,fe(Cr.buffer!==null,"must not double destroy elements"),delete rr[Cr.id],Cr.buffer.destroy(),Cr.buffer=null}function mr(Cr,nt){var jt=Fe.create(null,lu,!0),xr=new lr(jt._buffer);Lt.elementsCount++;function Nr(ur){if(!ur)jt(),xr.primType=ri,xr.vertCount=0,xr.type=Wi;else if(typeof ur=="number")jt(ur),xr.primType=ri,xr.vertCount=ur|0,xr.type=Wi;else{var Or=null,$r=hf,Fn=-1,Jt=-1,tr=0,xn=0;Array.isArray(ur)||me(ur)||ds(ur)?Or=ur:(fe.type(ur,"object","invalid arguments for elements"),"data"in ur&&(Or=ur.data,fe(Array.isArray(Or)||me(Or)||ds(Or),"invalid data for element buffer")),"usage"in ur&&(fe.parameter(ur.usage,_a,"invalid element buffer usage"),$r=_a[ur.usage]),"primitive"in ur&&(fe.parameter(ur.primitive,nr,"invalid element buffer primitive"),Fn=nr[ur.primitive]),"count"in ur&&(fe(typeof ur.count=="number"&&ur.count>=0,"invalid vertex count for elements"),Jt=ur.count|0),"type"in ur&&(fe.parameter(ur.type,Qt,"invalid buffer type"),xn=Qt[ur.type]),"length"in ur?tr=ur.length|0:(tr=Jt,xn===Sa||xn===da?tr*=2:(xn===ys||xn===ji)&&(tr*=4))),wr(xr,Or,$r,Fn,Jt,tr,xn)}return Nr}return Nr(Cr),Nr._reglType="elements",Nr._elements=xr,Nr.subdata=function(ur,Or){return jt.subdata(ur,Or),Nr},Nr.destroy=function(){jr(xr)},Nr}return{create:mr,createStream:_r,destroyStream:Ar,getElements:function(Cr){return typeof Cr=="function"&&Cr._elements instanceof lr?Cr._elements:null},clear:function(){ee(rr).forEach(jr)}}}var kc=new Float32Array(1),Au=new Uint32Array(kc.buffer),wu=5123;function Tu(N){for(var ce=Tt.allocType(wu,N.length),Fe=0;Fe<N.length;++Fe)if(isNaN(N[Fe]))ce[Fe]=65535;else if(N[Fe]===Infinity)ce[Fe]=31744;else if(N[Fe]===-Infinity)ce[Fe]=64512;else{kc[0]=N[Fe];var Lt=Au[0],rr=Lt>>>31<<15,Ot=(Lt<<1>>>24)-127,Qt=Lt>>13&(1<<10)-1;if(Ot<-24)ce[Fe]=rr;else if(Ot<-14){var lr=-14-Ot;ce[Fe]=rr+(Qt+(1<<10)>>lr)}else Ot>15?ce[Fe]=rr+31744:ce[Fe]=rr+(Ot+15<<10)+Qt}return ce}function lo(N){return Array.isArray(N)||me(N)}var Zf=function(N){return!(N&N-1)&&!!N},jf=34467,Ko=3553,Lc=34067,Mu=34069,cu=6408,df=6406,Il=6407,Fi=6409,Ol=6410,Ap=32854,sl=32855,Dc=36194,Vf=32819,wp=32820,Gf=33635,Fc=34042,nc=6402,ic=34041,Rl=35904,ul=35906,kl=36193,Yu=33776,Ys=33777,vf=33778,mf=33779,Hf=35986,fu=35987,ac=34798,Bc=35840,gf=35841,Ll=35842,uh=35843,yf=36196,Dl=5121,_f=5123,xf=5125,Fl=5126,Nc=10242,Tp=10243,Mp=10497,oc=33071,Pp=33648,Bl=10240,$i=10241,sc=9728,ca=9729,Pu=9984,Xi=9985,Ma=9986,_s=9987,zc=33170,qu=4352,Za=4353,uc=4354,Nl=34046,Ku=3317,Uc=37440,Iu=37441,vo=37443,zl=37444,lc=33984,mo=[Pu,Ma,Xi,_s],hn=[0,Fi,Ol,Il,cu],co={};co[Fi]=co[df]=co[nc]=1,co[ic]=co[Ol]=2,co[Il]=co[Rl]=3,co[cu]=co[ul]=4;function $u(N){return"[object "+N+"]"}var ka=$u("HTMLCanvasElement"),qs=$u("OffscreenCanvas"),Ts=$u("CanvasRenderingContext2D"),bf=$u("ImageBitmap"),Zr=$u("HTMLImageElement"),cc=$u("HTMLVideoElement"),Ef=Object.keys(Ra).concat([ka,qs,Ts,bf,Zr,cc]),ll=[];ll[Dl]=1,ll[Fl]=4,ll[kl]=2,ll[_f]=2,ll[xf]=4;var Ca=[];Ca[Ap]=2,Ca[sl]=2,Ca[Dc]=2,Ca[ic]=4,Ca[Yu]=.5,Ca[Ys]=.5,Ca[vf]=1,Ca[mf]=1,Ca[Hf]=.5,Ca[fu]=1,Ca[ac]=1,Ca[Bc]=.5,Ca[gf]=.25,Ca[Ll]=.5,Ca[uh]=.25,Ca[yf]=.5;function xs(N){return Array.isArray(N)&&(N.length===0||typeof N[0]=="number")}function Sf(N){if(!Array.isArray(N))return!1;var ce=N.length;return!(ce===0||!lo(N[0]))}function Ou(N){return Object.prototype.toString.call(N)}function Fs(N){return Ou(N)===ka}function Ru(N){return Ou(N)===qs}function Wf(N){return Ou(N)===Ts}function cl(N){return Ou(N)===bf}function Xf(N){return Ou(N)===Zr}function Cf(N){return Ou(N)===cc}function pu(N){var ce=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(ce&&N&&N.getContext)}function Ms(N){var ce=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(ce&&N&&"src"in N&&"crossOrigin"in N)}function Ai(N){if(!N)return!1;if(pu(N)||Ms(N))return!0;var ce=Ou(N);return Ef.indexOf(ce)>=0?!0:xs(N)||Sf(N)||ds(N)}function ku(N){return Ra[Object.prototype.toString.call(N)]|0}function hu(N,ce){var Fe=ce.length;switch(N.type){case Dl:case _f:case xf:case Fl:var Lt=Tt.allocType(N.type,Fe);Lt.set(ce),N.data=Lt;break;case kl:N.data=Tu(ce);break;default:fe.raise("unsupported texture type, must specify a typed array")}}function Vo(N,ce){return Tt.allocType(N.type===kl?Fl:N.type,ce)}function fl(N,ce){N.type===kl?(N.data=Tu(ce),Tt.freeType(ce)):N.data=ce}function ns(N,ce,Fe,Lt,rr,Ot){for(var Qt=N.width,lr=N.height,dr=N.channels,_r=Qt*lr*dr,Ar=Vo(N,_r),wr=0,jr=0;jr<lr;++jr)for(var mr=0;mr<Qt;++mr)for(var Cr=0;Cr<dr;++Cr)Ar[wr++]=ce[Fe*mr+Lt*jr+rr*Cr+Ot];fl(N,Ar)}function Ks(N,ce,Fe,Lt,rr,Ot){var Qt;if(typeof Ca[N]!="undefined"?Qt=Ca[N]:Qt=co[N]*ll[ce],Ot&&(Qt*=6),rr){for(var lr=0,dr=Fe;dr>=1;)lr+=Qt*dr*dr,dr/=2;return lr}else return Qt*Fe*Lt}function bs(N,ce,Fe,Lt,rr,Ot,Qt){var lr={"don't care":qu,"dont care":qu,nice:uc,fast:Za},dr={repeat:Mp,clamp:oc,mirror:Pp},_r={nearest:sc,linear:ca},Ar=m({mipmap:_s,"nearest mipmap nearest":Pu,"linear mipmap nearest":Xi,"nearest mipmap linear":Ma,"linear mipmap linear":_s},_r),wr={none:0,browser:zl},jr={uint8:Dl,rgba4:Vf,rgb565:Gf,"rgb5 a1":wp},mr={alpha:df,luminance:Fi,"luminance alpha":Ol,rgb:Il,rgba:cu,rgba4:Ap,"rgb5 a1":sl,rgb565:Dc},Cr={};ce.ext_srgb&&(mr.srgb=Rl,mr.srgba=ul),ce.oes_texture_float&&(jr.float32=jr.float=Fl),ce.oes_texture_half_float&&(jr.float16=jr["half float"]=kl),ce.webgl_depth_texture&&(m(mr,{depth:nc,"depth stencil":ic}),m(jr,{uint16:_f,uint32:xf,"depth stencil":Fc})),ce.webgl_compressed_texture_s3tc&&m(Cr,{"rgb s3tc dxt1":Yu,"rgba s3tc dxt1":Ys,"rgba s3tc dxt3":vf,"rgba s3tc dxt5":mf}),ce.webgl_compressed_texture_atc&&m(Cr,{"rgb atc":Hf,"rgba atc explicit alpha":fu,"rgba atc interpolated alpha":ac}),ce.webgl_compressed_texture_pvrtc&&m(Cr,{"rgb pvrtc 4bppv1":Bc,"rgb pvrtc 2bppv1":gf,"rgba pvrtc 4bppv1":Ll,"rgba pvrtc 2bppv1":uh}),ce.webgl_compressed_texture_etc1&&(Cr["rgb etc1"]=yf);var nt=Array.prototype.slice.call(N.getParameter(jf)||new Uint32Array(0));Object.keys(Cr).forEach(function(we){var Nt=Cr[we];nt.indexOf(Nt)>=0&&(mr[we]=Nt)});var jt=Object.keys(mr);Fe.textureFormats=jt;var xr=[];Object.keys(mr).forEach(function(we){var Nt=mr[we];xr[Nt]=we});var Nr=[];Object.keys(jr).forEach(function(we){var Nt=jr[we];Nr[Nt]=we});var ur=[];Object.keys(_r).forEach(function(we){var Nt=_r[we];ur[Nt]=we});var Or=[];Object.keys(Ar).forEach(function(we){var Nt=Ar[we];Or[Nt]=we});var $r=[];Object.keys(dr).forEach(function(we){var Nt=dr[we];$r[Nt]=we});var Fn=jt.reduce(function(we,Nt){var bt=mr[Nt];return bt===Fi||bt===df||bt===Fi||bt===Ol||bt===nc||bt===ic||ce.ext_srgb&&(bt===Rl||bt===ul)?we[bt]=bt:bt===sl||Nt.indexOf("rgba")>=0?we[bt]=cu:we[bt]=Il,we},{});function Jt(){this.internalformat=cu,this.format=cu,this.type=Dl,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=zl,this.width=0,this.height=0,this.channels=0}function tr(we,Nt){we.internalformat=Nt.internalformat,we.format=Nt.format,we.type=Nt.type,we.compressed=Nt.compressed,we.premultiplyAlpha=Nt.premultiplyAlpha,we.flipY=Nt.flipY,we.unpackAlignment=Nt.unpackAlignment,we.colorSpace=Nt.colorSpace,we.width=Nt.width,we.height=Nt.height,we.channels=Nt.channels}function xn(we,Nt){if(!(typeof Nt!="object"||!Nt)){if("premultiplyAlpha"in Nt&&(fe.type(Nt.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),we.premultiplyAlpha=Nt.premultiplyAlpha),"flipY"in Nt&&(fe.type(Nt.flipY,"boolean","invalid texture flip"),we.flipY=Nt.flipY),"alignment"in Nt&&(fe.oneOf(Nt.alignment,[1,2,4,8],"invalid texture unpack alignment"),we.unpackAlignment=Nt.alignment),"colorSpace"in Nt&&(fe.parameter(Nt.colorSpace,wr,"invalid colorSpace"),we.colorSpace=wr[Nt.colorSpace]),"type"in Nt){var bt=Nt.type;fe(ce.oes_texture_float||!(bt==="float"||bt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),fe(ce.oes_texture_half_float||!(bt==="half float"||bt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),fe(ce.webgl_depth_texture||!(bt==="uint16"||bt==="uint32"||bt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),fe.parameter(bt,jr,"invalid texture type"),we.type=jr[bt]}var dn=we.width,Vi=we.height,Ee=we.channels,ie=!1;"shape"in Nt?(fe(Array.isArray(Nt.shape)&&Nt.shape.length>=2,"shape must be an array"),dn=Nt.shape[0],Vi=Nt.shape[1],Nt.shape.length===3&&(Ee=Nt.shape[2],fe(Ee>0&&Ee<=4,"invalid number of channels"),ie=!0),fe(dn>=0&&dn<=Fe.maxTextureSize,"invalid width"),fe(Vi>=0&&Vi<=Fe.maxTextureSize,"invalid height")):("radius"in Nt&&(dn=Vi=Nt.radius,fe(dn>=0&&dn<=Fe.maxTextureSize,"invalid radius")),"width"in Nt&&(dn=Nt.width,fe(dn>=0&&dn<=Fe.maxTextureSize,"invalid width")),"height"in Nt&&(Vi=Nt.height,fe(Vi>=0&&Vi<=Fe.maxTextureSize,"invalid height")),"channels"in Nt&&(Ee=Nt.channels,fe(Ee>0&&Ee<=4,"invalid number of channels"),ie=!0)),we.width=dn|0,we.height=Vi|0,we.channels=Ee|0;var Ve=!1;if("format"in Nt){var ot=Nt.format;fe(ce.webgl_depth_texture||!(ot==="depth"||ot==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),fe.parameter(ot,mr,"invalid texture format");var Pt=we.internalformat=mr[ot];we.format=Fn[Pt],ot in jr&&("type"in Nt||(we.type=jr[ot])),ot in Cr&&(we.compressed=!0),Ve=!0}!ie&&Ve?we.channels=co[we.format]:ie&&!Ve?we.channels!==hn[we.format]&&(we.format=we.internalformat=hn[we.channels]):Ve&&ie&&fe(we.channels===co[we.format],"number of channels inconsistent with specified format")}}function Vr(we){N.pixelStorei(Uc,we.flipY),N.pixelStorei(Iu,we.premultiplyAlpha),N.pixelStorei(vo,we.colorSpace),N.pixelStorei(Ku,we.unpackAlignment)}function Sr(){Jt.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function qr(we,Nt){var bt=null;if(Ai(Nt)?bt=Nt:Nt&&(fe.type(Nt,"object","invalid pixel data type"),xn(we,Nt),"x"in Nt&&(we.xOffset=Nt.x|0),"y"in Nt&&(we.yOffset=Nt.y|0),Ai(Nt.data)&&(bt=Nt.data)),fe(!we.compressed||bt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),Nt.copy){fe(!bt,"can not specify copy and data field for the same texture");var dn=rr.viewportWidth,Vi=rr.viewportHeight;we.width=we.width||dn-we.xOffset,we.height=we.height||Vi-we.yOffset,we.needsCopy=!0,fe(we.xOffset>=0&&we.xOffset<dn&&we.yOffset>=0&&we.yOffset<Vi&&we.width>0&&we.width<=dn&&we.height>0&&we.height<=Vi,"copy texture read out of bounds")}else if(!bt)we.width=we.width||1,we.height=we.height||1,we.channels=we.channels||4;else if(me(bt))we.channels=we.channels||4,we.data=bt,!("type"in Nt)&&we.type===Dl&&(we.type=ku(bt));else if(xs(bt))we.channels=we.channels||4,hu(we,bt),we.alignment=1,we.needsFree=!0;else if(ds(bt)){var Ee=bt.data;!Array.isArray(Ee)&&we.type===Dl&&(we.type=ku(Ee));var ie=bt.shape,Ve=bt.stride,ot,Pt,Xe,De,Je,ve;ie.length===3?(Xe=ie[2],ve=Ve[2]):(fe(ie.length===2,"invalid ndarray pixel data, must be 2 or 3D"),Xe=1,ve=1),ot=ie[0],Pt=ie[1],De=Ve[0],Je=Ve[1],we.alignment=1,we.width=ot,we.height=Pt,we.channels=Xe,we.format=we.internalformat=hn[Xe],we.needsFree=!0,ns(we,Ee,De,Je,ve,bt.offset)}else if(pu(bt)||Fs(bt)||Ru(bt)||Wf(bt))pu(bt)||Fs(bt)||Ru(bt)?we.element=bt:we.element=bt.canvas,we.width=we.element.width,we.height=we.element.height,we.channels=4;else if(cl(bt))we.element=bt,we.width=bt.width,we.height=bt.height,we.channels=4;else if(Xf(bt))we.element=bt,we.width=bt.naturalWidth,we.height=bt.naturalHeight,we.channels=4;else if(Ms(bt))we.element=bt,we.width=bt.width,we.height=bt.height,we.channels=4;else if(Cf(bt))we.element=bt,we.width=bt.videoWidth,we.height=bt.videoHeight,we.channels=4;else if(Sf(bt)){var Ze=we.width||bt[0].length,Ae=we.height||bt.length,st=we.channels;lo(bt[0][0])?st=st||bt[0][0].length:st=st||1;for(var St=ye.shape(bt),cr=1,zr=0;zr<St.length;++zr)cr*=St[zr];var Ur=Vo(we,cr);ye.flatten(bt,St,"",Ur),fl(we,Ur),we.alignment=1,we.width=Ze,we.height=Ae,we.channels=st,we.format=we.internalformat=hn[st],we.needsFree=!0}we.type===Fl?fe(Fe.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):we.type===kl&&fe(Fe.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Kr(we,Nt,bt){var dn=we.element,Vi=we.data,Ee=we.internalformat,ie=we.format,Ve=we.type,ot=we.width,Pt=we.height;Vr(we),dn?N.texImage2D(Nt,bt,ie,ie,Ve,dn):we.compressed?N.compressedTexImage2D(Nt,bt,Ee,ot,Pt,0,Vi):we.needsCopy?(Lt(),N.copyTexImage2D(Nt,bt,ie,we.xOffset,we.yOffset,ot,Pt,0)):N.texImage2D(Nt,bt,ie,ot,Pt,0,ie,Ve,Vi||null)}function mi(we,Nt,bt,dn,Vi){var Ee=we.element,ie=we.data,Ve=we.internalformat,ot=we.format,Pt=we.type,Xe=we.width,De=we.height;Vr(we),Ee?N.texSubImage2D(Nt,Vi,bt,dn,ot,Pt,Ee):we.compressed?N.compressedTexSubImage2D(Nt,Vi,bt,dn,Ve,Xe,De,ie):we.needsCopy?(Lt(),N.copyTexSubImage2D(Nt,Vi,bt,dn,we.xOffset,we.yOffset,Xe,De)):N.texSubImage2D(Nt,Vi,bt,dn,Xe,De,ot,Pt,ie)}var ii=[];function Hr(){return ii.pop()||new Sr}function rn(we){we.needsFree&&Tt.freeType(we.data),Sr.call(we),ii.push(we)}function Qn(){Jt.call(this),this.genMipmaps=!1,this.mipmapHint=qu,this.mipmask=0,this.images=Array(16)}function ci(we,Nt,bt){var dn=we.images[0]=Hr();we.mipmask=1,dn.width=we.width=Nt,dn.height=we.height=bt,dn.channels=we.channels=4}function Bi(we,Nt){var bt=null;if(Ai(Nt))bt=we.images[0]=Hr(),tr(bt,we),qr(bt,Nt),we.mipmask=1;else if(xn(we,Nt),Array.isArray(Nt.mipmap))for(var dn=Nt.mipmap,Vi=0;Vi<dn.length;++Vi)bt=we.images[Vi]=Hr(),tr(bt,we),bt.width>>=Vi,bt.height>>=Vi,qr(bt,dn[Vi]),we.mipmask|=1<<Vi;else bt=we.images[0]=Hr(),tr(bt,we),qr(bt,Nt),we.mipmask=1;tr(we,we.images[0]),we.compressed&&(we.internalformat===Yu||we.internalformat===Ys||we.internalformat===vf||we.internalformat===mf)&&fe(we.width%4==0&&we.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function oo(we,Nt){for(var bt=we.images,dn=0;dn<bt.length;++dn){if(!bt[dn])return;Kr(bt[dn],Nt,dn)}}var so=[];function Di(){var we=so.pop()||new Qn;Jt.call(we),we.mipmask=0;for(var Nt=0;Nt<16;++Nt)we.images[Nt]=null;return we}function Jo(we){for(var Nt=we.images,bt=0;bt<Nt.length;++bt)Nt[bt]&&rn(Nt[bt]),Nt[bt]=null;so.push(we)}function ja(){this.minFilter=sc,this.magFilter=sc,this.wrapS=oc,this.wrapT=oc,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=qu}function Bo(we,Nt){if("min"in Nt){var bt=Nt.min;fe.parameter(bt,Ar),we.minFilter=Ar[bt],mo.indexOf(we.minFilter)>=0&&!("faces"in Nt)&&(we.genMipmaps=!0)}if("mag"in Nt){var dn=Nt.mag;fe.parameter(dn,_r),we.magFilter=_r[dn]}var Vi=we.wrapS,Ee=we.wrapT;if("wrap"in Nt){var ie=Nt.wrap;typeof ie=="string"?(fe.parameter(ie,dr),Vi=Ee=dr[ie]):Array.isArray(ie)&&(fe.parameter(ie[0],dr),fe.parameter(ie[1],dr),Vi=dr[ie[0]],Ee=dr[ie[1]])}else{if("wrapS"in Nt){var Ve=Nt.wrapS;fe.parameter(Ve,dr),Vi=dr[Ve]}if("wrapT"in Nt){var ot=Nt.wrapT;fe.parameter(ot,dr),Ee=dr[ot]}}if(we.wrapS=Vi,we.wrapT=Ee,"anisotropic"in Nt){var Pt=Nt.anisotropic;fe(typeof Pt=="number"&&Pt>=1&&Pt<=Fe.maxAnisotropic,"aniso samples must be between 1 and "),we.anisotropic=Nt.anisotropic}if("mipmap"in Nt){var Xe=!1;switch(typeof Nt.mipmap){case"string":fe.parameter(Nt.mipmap,lr,"invalid mipmap hint"),we.mipmapHint=lr[Nt.mipmap],we.genMipmaps=!0,Xe=!0;break;case"boolean":Xe=we.genMipmaps=Nt.mipmap;break;case"object":fe(Array.isArray(Nt.mipmap),"invalid mipmap type"),we.genMipmaps=!1,Xe=!0;break;default:fe.raise("invalid mipmap type")}Xe&&!("min"in Nt)&&(we.minFilter=Pu)}}function So(we,Nt){N.texParameteri(Nt,$i,we.minFilter),N.texParameteri(Nt,Bl,we.magFilter),N.texParameteri(Nt,Nc,we.wrapS),N.texParameteri(Nt,Tp,we.wrapT),ce.ext_texture_filter_anisotropic&&N.texParameteri(Nt,Nl,we.anisotropic),we.genMipmaps&&(N.hint(zc,we.mipmapHint),N.generateMipmap(Nt))}var Ho=0,Io={},os=Fe.maxTextureUnits,po=Array(os).map(function(){return null});function gi(we){Jt.call(this),this.mipmask=0,this.internalformat=cu,this.id=Ho++,this.refCount=1,this.target=we,this.texture=N.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new ja,Qt.profile&&(this.stats={size:0})}function Oo(we){N.activeTexture(lc),N.bindTexture(we.target,we.texture)}function Qi(){var we=po[0];we?N.bindTexture(we.target,we.texture):N.bindTexture(Ko,null)}function No(we){var Nt=we.texture;fe(Nt,"must not double destroy texture");var bt=we.unit,dn=we.target;bt>=0&&(N.activeTexture(lc+bt),N.bindTexture(dn,null),po[bt]=null),N.deleteTexture(Nt),we.texture=null,we.params=null,we.pixels=null,we.refCount=0,delete Io[we.id],Ot.textureCount--}m(gi.prototype,{bind:function(){var we=this;we.bindCount+=1;var Nt=we.unit;if(Nt<0){for(var bt=0;bt<os;++bt){var dn=po[bt];if(dn){if(dn.bindCount>0)continue;dn.unit=-1}po[bt]=we,Nt=bt;break}Nt>=os&&fe.raise("insufficient number of texture units"),Qt.profile&&Ot.maxTextureUnits<Nt+1&&(Ot.maxTextureUnits=Nt+1),we.unit=Nt,N.activeTexture(lc+Nt),N.bindTexture(we.target,we.texture)}return Nt},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&No(this)}});function ti(we,Nt){var bt=new gi(Ko);Io[bt.id]=bt,Ot.textureCount++;function dn(ie,Ve){var ot=bt.texInfo;ja.call(ot);var Pt=Di();return typeof ie=="number"?typeof Ve=="number"?ci(Pt,ie|0,Ve|0):ci(Pt,ie|0,ie|0):ie?(fe.type(ie,"object","invalid arguments to regl.texture"),Bo(ot,ie),Bi(Pt,ie)):ci(Pt,1,1),ot.genMipmaps&&(Pt.mipmask=(Pt.width<<1)-1),bt.mipmask=Pt.mipmask,tr(bt,Pt),fe.texture2D(ot,Pt,Fe),bt.internalformat=Pt.internalformat,dn.width=Pt.width,dn.height=Pt.height,Oo(bt),oo(Pt,Ko),So(ot,Ko),Qi(),Jo(Pt),Qt.profile&&(bt.stats.size=Ks(bt.internalformat,bt.type,Pt.width,Pt.height,ot.genMipmaps,!1)),dn.format=xr[bt.internalformat],dn.type=Nr[bt.type],dn.mag=ur[ot.magFilter],dn.min=Or[ot.minFilter],dn.wrapS=$r[ot.wrapS],dn.wrapT=$r[ot.wrapT],dn}function Vi(ie,Ve,ot,Pt){fe(!!ie,"must specify image data");var Xe=Ve|0,De=ot|0,Je=Pt|0,ve=Hr();return tr(ve,bt),ve.width=0,ve.height=0,qr(ve,ie),ve.width=ve.width||(bt.width>>Je)-Xe,ve.height=ve.height||(bt.height>>Je)-De,fe(bt.type===ve.type&&bt.format===ve.format&&bt.internalformat===ve.internalformat,"incompatible format for texture.subimage"),fe(Xe>=0&&De>=0&&Xe+ve.width<=bt.width&&De+ve.height<=bt.height,"texture.subimage write out of bounds"),fe(bt.mipmask&1<<Je,"missing mipmap data"),fe(ve.data||ve.element||ve.needsCopy,"missing image data"),Oo(bt),mi(ve,Ko,Xe,De,Je),Qi(),rn(ve),dn}function Ee(ie,Ve){var ot=ie|0,Pt=Ve|0||ot;if(ot===bt.width&&Pt===bt.height)return dn;dn.width=bt.width=ot,dn.height=bt.height=Pt,Oo(bt);for(var Xe=0;bt.mipmask>>Xe;++Xe){var De=ot>>Xe,Je=Pt>>Xe;if(!De||!Je)break;N.texImage2D(Ko,Xe,bt.format,De,Je,0,bt.format,bt.type,null)}return Qi(),Qt.profile&&(bt.stats.size=Ks(bt.internalformat,bt.type,ot,Pt,!1,!1)),dn}return dn(we,Nt),dn.subimage=Vi,dn.resize=Ee,dn._reglType="texture2d",dn._texture=bt,Qt.profile&&(dn.stats=bt.stats),dn.destroy=function(){bt.decRef()},dn}function Ni(we,Nt,bt,dn,Vi,Ee){var ie=new gi(Lc);Io[ie.id]=ie,Ot.cubeCount++;var Ve=new Array(6);function ot(De,Je,ve,Ze,Ae,st){var St,cr=ie.texInfo;for(ja.call(cr),St=0;St<6;++St)Ve[St]=Di();if(typeof De=="number"||!De){var zr=De|0||1;for(St=0;St<6;++St)ci(Ve[St],zr,zr)}else if(typeof De=="object")if(Je)Bi(Ve[0],De),Bi(Ve[1],Je),Bi(Ve[2],ve),Bi(Ve[3],Ze),Bi(Ve[4],Ae),Bi(Ve[5],st);else if(Bo(cr,De),xn(ie,De),"faces"in De){var Ur=De.faces;for(fe(Array.isArray(Ur)&&Ur.length===6,"cube faces must be a length 6 array"),St=0;St<6;++St)fe(typeof Ur[St]=="object"&&!!Ur[St],"invalid input for cube map face"),tr(Ve[St],ie),Bi(Ve[St],Ur[St])}else for(St=0;St<6;++St)Bi(Ve[St],De);else fe.raise("invalid arguments to cube map");for(tr(ie,Ve[0]),fe.optional(function(){Fe.npotTextureCube||fe(Zf(ie.width)&&Zf(ie.height),"your browser does not support non power or two texture dimensions")}),cr.genMipmaps?ie.mipmask=(Ve[0].width<<1)-1:ie.mipmask=Ve[0].mipmask,fe.textureCube(ie,cr,Ve,Fe),ie.internalformat=Ve[0].internalformat,ot.width=Ve[0].width,ot.height=Ve[0].height,Oo(ie),St=0;St<6;++St)oo(Ve[St],Mu+St);for(So(cr,Lc),Qi(),Qt.profile&&(ie.stats.size=Ks(ie.internalformat,ie.type,ot.width,ot.height,cr.genMipmaps,!0)),ot.format=xr[ie.internalformat],ot.type=Nr[ie.type],ot.mag=ur[cr.magFilter],ot.min=Or[cr.minFilter],ot.wrapS=$r[cr.wrapS],ot.wrapT=$r[cr.wrapT],St=0;St<6;++St)Jo(Ve[St]);return ot}function Pt(De,Je,ve,Ze,Ae){fe(!!Je,"must specify image data"),fe(typeof De=="number"&&De===(De|0)&&De>=0&&De<6,"invalid face");var st=ve|0,St=Ze|0,cr=Ae|0,zr=Hr();return tr(zr,ie),zr.width=0,zr.height=0,qr(zr,Je),zr.width=zr.width||(ie.width>>cr)-st,zr.height=zr.height||(ie.height>>cr)-St,fe(ie.type===zr.type&&ie.format===zr.format&&ie.internalformat===zr.internalformat,"incompatible format for texture.subimage"),fe(st>=0&&St>=0&&st+zr.width<=ie.width&&St+zr.height<=ie.height,"texture.subimage write out of bounds"),fe(ie.mipmask&1<<cr,"missing mipmap data"),fe(zr.data||zr.element||zr.needsCopy,"missing image data"),Oo(ie),mi(zr,Mu+De,st,St,cr),Qi(),rn(zr),ot}function Xe(De){var Je=De|0;if(Je!==ie.width){ot.width=ie.width=Je,ot.height=ie.height=Je,Oo(ie);for(var ve=0;ve<6;++ve)for(var Ze=0;ie.mipmask>>Ze;++Ze)N.texImage2D(Mu+ve,Ze,ie.format,Je>>Ze,Je>>Ze,0,ie.format,ie.type,null);return Qi(),Qt.profile&&(ie.stats.size=Ks(ie.internalformat,ie.type,ot.width,ot.height,!1,!0)),ot}}return ot(we,Nt,bt,dn,Vi,Ee),ot.subimage=Pt,ot.resize=Xe,ot._reglType="textureCube",ot._texture=ie,Qt.profile&&(ot.stats=ie.stats),ot.destroy=function(){ie.decRef()},ot}function va(){for(var we=0;we<os;++we)N.activeTexture(lc+we),N.bindTexture(Ko,null),po[we]=null;ee(Io).forEach(No),Ot.cubeCount=0,Ot.textureCount=0}Qt.profile&&(Ot.getTotalTextureSize=function(){var we=0;return Object.keys(Io).forEach(function(Nt){we+=Io[Nt].stats.size}),we});function Bn(){for(var we=0;we<os;++we){var Nt=po[we];Nt&&(Nt.bindCount=0,Nt.unit=-1,po[we]=null)}ee(Io).forEach(function(bt){bt.texture=N.createTexture(),N.bindTexture(bt.target,bt.texture);for(var dn=0;dn<32;++dn)if((bt.mipmask&1<<dn)!=0)if(bt.target===Ko)N.texImage2D(Ko,dn,bt.internalformat,bt.width>>dn,bt.height>>dn,0,bt.internalformat,bt.type,null);else for(var Vi=0;Vi<6;++Vi)N.texImage2D(Mu+Vi,dn,bt.internalformat,bt.width>>dn,bt.height>>dn,0,bt.internalformat,bt.type,null);So(bt.texInfo,bt.target)})}function ai(){for(var we=0;we<os;++we){var Nt=po[we];Nt&&(Nt.bindCount=0,Nt.unit=-1,po[we]=null),N.activeTexture(lc+we),N.bindTexture(Ko,null),N.bindTexture(Lc,null)}}return{create2D:ti,createCube:Ni,clear:va,getTexture:function(we){return null},restore:Bn,refresh:ai}}var xu=36161,Rn=32854,Cn=32855,Zc=36194,$o=33189,$s=36168,Go=34041,du=35907,Yf=34836,jc=34842,ga=34843,La=[];La[Rn]=2,La[Cn]=2,La[Zc]=2,La[$o]=2,La[$s]=1,La[Go]=4,La[du]=4,La[Yf]=16,La[jc]=8,La[ga]=6;function pl(N,ce,Fe){return La[N]*ce*Fe}var fc=function(N,ce,Fe,Lt,rr){var Ot={rgba4:Rn,rgb565:Zc,"rgb5 a1":Cn,depth:$o,stencil:$s,"depth stencil":Go};ce.ext_srgb&&(Ot.srgba=du),ce.ext_color_buffer_half_float&&(Ot.rgba16f=jc,Ot.rgb16f=ga),ce.webgl_color_buffer_float&&(Ot.rgba32f=Yf);var Qt=[];Object.keys(Ot).forEach(function(mr){var Cr=Ot[mr];Qt[Cr]=mr});var lr=0,dr={};function _r(mr){this.id=lr++,this.refCount=1,this.renderbuffer=mr,this.format=Rn,this.width=0,this.height=0,rr.profile&&(this.stats={size:0})}_r.prototype.decRef=function(){--this.refCount<=0&&Ar(this)};function Ar(mr){var Cr=mr.renderbuffer;fe(Cr,"must not double destroy renderbuffer"),N.bindRenderbuffer(xu,null),N.deleteRenderbuffer(Cr),mr.renderbuffer=null,mr.refCount=0,delete dr[mr.id],Lt.renderbufferCount--}function wr(mr,Cr){var nt=new _r(N.createRenderbuffer());dr[nt.id]=nt,Lt.renderbufferCount++;function jt(Nr,ur){var Or=0,$r=0,Fn=Rn;if(typeof Nr=="object"&&Nr){var Jt=Nr;if("shape"in Jt){var tr=Jt.shape;fe(Array.isArray(tr)&&tr.length>=2,"invalid renderbuffer shape"),Or=tr[0]|0,$r=tr[1]|0}else"radius"in Jt&&(Or=$r=Jt.radius|0),"width"in Jt&&(Or=Jt.width|0),"height"in Jt&&($r=Jt.height|0);"format"in Jt&&(fe.parameter(Jt.format,Ot,"invalid renderbuffer format"),Fn=Ot[Jt.format])}else typeof Nr=="number"?(Or=Nr|0,typeof ur=="number"?$r=ur|0:$r=Or):Nr?fe.raise("invalid arguments to renderbuffer constructor"):Or=$r=1;if(fe(Or>0&&$r>0&&Or<=Fe.maxRenderbufferSize&&$r<=Fe.maxRenderbufferSize,"invalid renderbuffer size"),!(Or===nt.width&&$r===nt.height&&Fn===nt.format))return jt.width=nt.width=Or,jt.height=nt.height=$r,nt.format=Fn,N.bindRenderbuffer(xu,nt.renderbuffer),N.renderbufferStorage(xu,Fn,Or,$r),fe(N.getError()===0,"invalid render buffer format"),rr.profile&&(nt.stats.size=pl(nt.format,nt.width,nt.height)),jt.format=Qt[nt.format],jt}function xr(Nr,ur){var Or=Nr|0,$r=ur|0||Or;return Or===nt.width&&$r===nt.height||(fe(Or>0&&$r>0&&Or<=Fe.maxRenderbufferSize&&$r<=Fe.maxRenderbufferSize,"invalid renderbuffer size"),jt.width=nt.width=Or,jt.height=nt.height=$r,N.bindRenderbuffer(xu,nt.renderbuffer),N.renderbufferStorage(xu,nt.format,Or,$r),fe(N.getError()===0,"invalid render buffer format"),rr.profile&&(nt.stats.size=pl(nt.format,nt.width,nt.height))),jt}return jt(mr,Cr),jt.resize=xr,jt._reglType="renderbuffer",jt._renderbuffer=nt,rr.profile&&(jt.stats=nt.stats),jt.destroy=function(){nt.decRef()},jt}rr.profile&&(Lt.getTotalRenderbufferSize=function(){var mr=0;return Object.keys(dr).forEach(function(Cr){mr+=dr[Cr].stats.size}),mr});function jr(){ee(dr).forEach(function(mr){mr.renderbuffer=N.createRenderbuffer(),N.bindRenderbuffer(xu,mr.renderbuffer),N.renderbufferStorage(xu,mr.format,mr.width,mr.height)}),N.bindRenderbuffer(xu,null)}return{create:wr,clear:function(){ee(dr).forEach(Ar)},restore:jr}},Qs=36160,vu=36161,_i=3553,Bs=34069,Ps=36064,hl=36096,Lu=36128,Qu=33306,Vc=36053,Pa=36054,Js=36055,Ul=36057,dl=36061,vl=36193,Gc=5121,ml=5126,eu=6407,pc=6408,Zl=6402,qf=[eu,pc],jl=[];jl[pc]=4,jl[eu]=3;var l=[];l[Gc]=1,l[ml]=4,l[vl]=2;var f=32854,c=32855,d=36194,E=33189,w=36168,P=34041,L=35907,U=34836,H=34842,ae=34843,se=[f,c,d,L,H,ae,U],le={};le[Vc]="complete",le[Pa]="incomplete attachment",le[Ul]="incomplete dimensions",le[Js]="incomplete, missing attachment",le[dl]="unsupported";function Oe(N,ce,Fe,Lt,rr,Ot){var Qt={cur:null,next:null,dirty:!1,setFBO:null},lr=["rgba"],dr=["rgba4","rgb565","rgb5 a1"];ce.ext_srgb&&dr.push("srgba"),ce.ext_color_buffer_half_float&&dr.push("rgba16f","rgb16f"),ce.webgl_color_buffer_float&&dr.push("rgba32f");var _r=["uint8"];ce.oes_texture_half_float&&_r.push("half float","float16"),ce.oes_texture_float&&_r.push("float","float32");function Ar(Sr,qr,Kr){this.target=Sr,this.texture=qr,this.renderbuffer=Kr;var mi=0,ii=0;qr?(mi=qr.width,ii=qr.height):Kr&&(mi=Kr.width,ii=Kr.height),this.width=mi,this.height=ii}function wr(Sr){Sr&&(Sr.texture&&Sr.texture._texture.decRef(),Sr.renderbuffer&&Sr.renderbuffer._renderbuffer.decRef())}function jr(Sr,qr,Kr){if(!!Sr)if(Sr.texture){var mi=Sr.texture._texture,ii=Math.max(1,mi.width),Hr=Math.max(1,mi.height);fe(ii===qr&&Hr===Kr,"inconsistent width/height for supplied texture"),mi.refCount+=1}else{var rn=Sr.renderbuffer._renderbuffer;fe(rn.width===qr&&rn.height===Kr,"inconsistent width/height for renderbuffer"),rn.refCount+=1}}function mr(Sr,qr){qr&&(qr.texture?N.framebufferTexture2D(Qs,Sr,qr.target,qr.texture._texture.texture,0):N.framebufferRenderbuffer(Qs,Sr,vu,qr.renderbuffer._renderbuffer.renderbuffer))}function Cr(Sr){var qr=_i,Kr=null,mi=null,ii=Sr;typeof Sr=="object"&&(ii=Sr.data,"target"in Sr&&(qr=Sr.target|0)),fe.type(ii,"function","invalid attachment data");var Hr=ii._reglType;return Hr==="texture2d"?(Kr=ii,fe(qr===_i)):Hr==="textureCube"?(Kr=ii,fe(qr>=Bs&&qr<Bs+6,"invalid cube map target")):Hr==="renderbuffer"?(mi=ii,qr=vu):fe.raise("invalid regl object for attachment"),new Ar(qr,Kr,mi)}function nt(Sr,qr,Kr,mi,ii){if(Kr){var Hr=Lt.create2D({width:Sr,height:qr,format:mi,type:ii});return Hr._texture.refCount=0,new Ar(_i,Hr,null)}else{var rn=rr.create({width:Sr,height:qr,format:mi});return rn._renderbuffer.refCount=0,new Ar(vu,null,rn)}}function jt(Sr){return Sr&&(Sr.texture||Sr.renderbuffer)}function xr(Sr,qr,Kr){Sr&&(Sr.texture?Sr.texture.resize(qr,Kr):Sr.renderbuffer&&Sr.renderbuffer.resize(qr,Kr),Sr.width=qr,Sr.height=Kr)}var Nr=0,ur={};function Or(){this.id=Nr++,ur[this.id]=this,this.framebuffer=N.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function $r(Sr){Sr.colorAttachments.forEach(wr),wr(Sr.depthAttachment),wr(Sr.stencilAttachment),wr(Sr.depthStencilAttachment)}function Fn(Sr){var qr=Sr.framebuffer;fe(qr,"must not double destroy framebuffer"),N.deleteFramebuffer(qr),Sr.framebuffer=null,Ot.framebufferCount--,delete ur[Sr.id]}function Jt(Sr){var qr;N.bindFramebuffer(Qs,Sr.framebuffer);var Kr=Sr.colorAttachments;for(qr=0;qr<Kr.length;++qr)mr(Ps+qr,Kr[qr]);for(qr=Kr.length;qr<Fe.maxColorAttachments;++qr)N.framebufferTexture2D(Qs,Ps+qr,_i,null,0);N.framebufferTexture2D(Qs,Qu,_i,null,0),N.framebufferTexture2D(Qs,hl,_i,null,0),N.framebufferTexture2D(Qs,Lu,_i,null,0),mr(hl,Sr.depthAttachment),mr(Lu,Sr.stencilAttachment),mr(Qu,Sr.depthStencilAttachment);var mi=N.checkFramebufferStatus(Qs);!N.isContextLost()&&mi!==Vc&&fe.raise("framebuffer configuration not supported, status = "+le[mi]),N.bindFramebuffer(Qs,Qt.next?Qt.next.framebuffer:null),Qt.cur=Qt.next,N.getError()}function tr(Sr,qr){var Kr=new Or;Ot.framebufferCount++;function mi(Hr,rn){var Qn;fe(Qt.next!==Kr,"can not update framebuffer which is currently in use");var ci=0,Bi=0,oo=!0,so=!0,Di=null,Jo=!0,ja="rgba",Bo="uint8",So=1,Ho=null,Io=null,os=null,po=!1;if(typeof Hr=="number")ci=Hr|0,Bi=rn|0||ci;else if(!Hr)ci=Bi=1;else{fe.type(Hr,"object","invalid arguments for framebuffer");var gi=Hr;if("shape"in gi){var Oo=gi.shape;fe(Array.isArray(Oo)&&Oo.length>=2,"invalid shape for framebuffer"),ci=Oo[0],Bi=Oo[1]}else"radius"in gi&&(ci=Bi=gi.radius),"width"in gi&&(ci=gi.width),"height"in gi&&(Bi=gi.height);("color"in gi||"colors"in gi)&&(Di=gi.color||gi.colors,Array.isArray(Di)&&fe(Di.length===1||ce.webgl_draw_buffers,"multiple render targets not supported")),Di||("colorCount"in gi&&(So=gi.colorCount|0,fe(So>0,"invalid color buffer count")),"colorTexture"in gi&&(Jo=!!gi.colorTexture,ja="rgba4"),"colorType"in gi&&(Bo=gi.colorType,Jo?(fe(ce.oes_texture_float||!(Bo==="float"||Bo==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),fe(ce.oes_texture_half_float||!(Bo==="half float"||Bo==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Bo==="half float"||Bo==="float16"?(fe(ce.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),ja="rgba16f"):(Bo==="float"||Bo==="float32")&&(fe(ce.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),ja="rgba32f"),fe.oneOf(Bo,_r,"invalid color type")),"colorFormat"in gi&&(ja=gi.colorFormat,lr.indexOf(ja)>=0?Jo=!0:dr.indexOf(ja)>=0?Jo=!1:fe.optional(function(){Jo?fe.oneOf(gi.colorFormat,lr,"invalid color format for texture"):fe.oneOf(gi.colorFormat,dr,"invalid color format for renderbuffer")}))),("depthTexture"in gi||"depthStencilTexture"in gi)&&(po=!!(gi.depthTexture||gi.depthStencilTexture),fe(!po||ce.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in gi&&(typeof gi.depth=="boolean"?oo=gi.depth:(Ho=gi.depth,so=!1)),"stencil"in gi&&(typeof gi.stencil=="boolean"?so=gi.stencil:(Io=gi.stencil,oo=!1)),"depthStencil"in gi&&(typeof gi.depthStencil=="boolean"?oo=so=gi.depthStencil:(os=gi.depthStencil,oo=!1,so=!1))}var Qi=null,No=null,ti=null,Ni=null;if(Array.isArray(Di))Qi=Di.map(Cr);else if(Di)Qi=[Cr(Di)];else for(Qi=new Array(So),Qn=0;Qn<So;++Qn)Qi[Qn]=nt(ci,Bi,Jo,ja,Bo);fe(ce.webgl_draw_buffers||Qi.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),fe(Qi.length<=Fe.maxColorAttachments,"too many color attachments, not supported"),ci=ci||Qi[0].width,Bi=Bi||Qi[0].height,Ho?No=Cr(Ho):oo&&!so&&(No=nt(ci,Bi,po,"depth","uint32")),Io?ti=Cr(Io):so&&!oo&&(ti=nt(ci,Bi,!1,"stencil","uint8")),os?Ni=Cr(os):!Ho&&!Io&&so&&oo&&(Ni=nt(ci,Bi,po,"depth stencil","depth stencil")),fe(!!Ho+!!Io+!!os<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var va=null;for(Qn=0;Qn<Qi.length;++Qn)if(jr(Qi[Qn],ci,Bi),fe(!Qi[Qn]||Qi[Qn].texture&&qf.indexOf(Qi[Qn].texture._texture.format)>=0||Qi[Qn].renderbuffer&&se.indexOf(Qi[Qn].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Qn+" is invalid"),Qi[Qn]&&Qi[Qn].texture){var Bn=jl[Qi[Qn].texture._texture.format]*l[Qi[Qn].texture._texture.type];va===null?va=Bn:fe(va===Bn,"all color attachments much have the same number of bits per pixel.")}return jr(No,ci,Bi),fe(!No||No.texture&&No.texture._texture.format===Zl||No.renderbuffer&&No.renderbuffer._renderbuffer.format===E,"invalid depth attachment for framebuffer object"),jr(ti,ci,Bi),fe(!ti||ti.renderbuffer&&ti.renderbuffer._renderbuffer.format===w,"invalid stencil attachment for framebuffer object"),jr(Ni,ci,Bi),fe(!Ni||Ni.texture&&Ni.texture._texture.format===P||Ni.renderbuffer&&Ni.renderbuffer._renderbuffer.format===P,"invalid depth-stencil attachment for framebuffer object"),$r(Kr),Kr.width=ci,Kr.height=Bi,Kr.colorAttachments=Qi,Kr.depthAttachment=No,Kr.stencilAttachment=ti,Kr.depthStencilAttachment=Ni,mi.color=Qi.map(jt),mi.depth=jt(No),mi.stencil=jt(ti),mi.depthStencil=jt(Ni),mi.width=Kr.width,mi.height=Kr.height,Jt(Kr),mi}function ii(Hr,rn){fe(Qt.next!==Kr,"can not resize a framebuffer which is currently in use");var Qn=Math.max(Hr|0,1),ci=Math.max(rn|0||Qn,1);if(Qn===Kr.width&&ci===Kr.height)return mi;for(var Bi=Kr.colorAttachments,oo=0;oo<Bi.length;++oo)xr(Bi[oo],Qn,ci);return xr(Kr.depthAttachment,Qn,ci),xr(Kr.stencilAttachment,Qn,ci),xr(Kr.depthStencilAttachment,Qn,ci),Kr.width=mi.width=Qn,Kr.height=mi.height=ci,Jt(Kr),mi}return mi(Sr,qr),m(mi,{resize:ii,_reglType:"framebuffer",_framebuffer:Kr,destroy:function(){Fn(Kr),$r(Kr)},use:function(Hr){Qt.setFBO({framebuffer:mi},Hr)}})}function xn(Sr){var qr=Array(6);function Kr(ii){var Hr;fe(qr.indexOf(Qt.next)<0,"can not update framebuffer which is currently in use");var rn={color:null},Qn=0,ci=null,Bi="rgba",oo="uint8",so=1;if(typeof ii=="number")Qn=ii|0;else if(!ii)Qn=1;else{fe.type(ii,"object","invalid arguments for framebuffer");var Di=ii;if("shape"in Di){var Jo=Di.shape;fe(Array.isArray(Jo)&&Jo.length>=2,"invalid shape for framebuffer"),fe(Jo[0]===Jo[1],"cube framebuffer must be square"),Qn=Jo[0]}else"radius"in Di&&(Qn=Di.radius|0),"width"in Di?(Qn=Di.width|0,"height"in Di&&fe(Di.height===Qn,"must be square")):"height"in Di&&(Qn=Di.height|0);("color"in Di||"colors"in Di)&&(ci=Di.color||Di.colors,Array.isArray(ci)&&fe(ci.length===1||ce.webgl_draw_buffers,"multiple render targets not supported")),ci||("colorCount"in Di&&(so=Di.colorCount|0,fe(so>0,"invalid color buffer count")),"colorType"in Di&&(fe.oneOf(Di.colorType,_r,"invalid color type"),oo=Di.colorType),"colorFormat"in Di&&(Bi=Di.colorFormat,fe.oneOf(Di.colorFormat,lr,"invalid color format for texture"))),"depth"in Di&&(rn.depth=Di.depth),"stencil"in Di&&(rn.stencil=Di.stencil),"depthStencil"in Di&&(rn.depthStencil=Di.depthStencil)}var ja;if(ci)if(Array.isArray(ci))for(ja=[],Hr=0;Hr<ci.length;++Hr)ja[Hr]=ci[Hr];else ja=[ci];else{ja=Array(so);var Bo={radius:Qn,format:Bi,type:oo};for(Hr=0;Hr<so;++Hr)ja[Hr]=Lt.createCube(Bo)}for(rn.color=Array(ja.length),Hr=0;Hr<ja.length;++Hr){var So=ja[Hr];fe(typeof So=="function"&&So._reglType==="textureCube","invalid cube map"),Qn=Qn||So.width,fe(So.width===Qn&&So.height===Qn,"invalid cube map shape"),rn.color[Hr]={target:Bs,data:ja[Hr]}}for(Hr=0;Hr<6;++Hr){for(var Ho=0;Ho<ja.length;++Ho)rn.color[Ho].target=Bs+Hr;Hr>0&&(rn.depth=qr[0].depth,rn.stencil=qr[0].stencil,rn.depthStencil=qr[0].depthStencil),qr[Hr]?qr[Hr](rn):qr[Hr]=tr(rn)}return m(Kr,{width:Qn,height:Qn,color:ja})}function mi(ii){var Hr,rn=ii|0;if(fe(rn>0&&rn<=Fe.maxCubeMapSize,"invalid radius for cube fbo"),rn===Kr.width)return Kr;var Qn=Kr.color;for(Hr=0;Hr<Qn.length;++Hr)Qn[Hr].resize(rn);for(Hr=0;Hr<6;++Hr)qr[Hr].resize(rn);return Kr.width=Kr.height=rn,Kr}return Kr(Sr),m(Kr,{faces:qr,resize:mi,_reglType:"framebufferCube",destroy:function(){qr.forEach(function(ii){ii.destroy()})}})}function Vr(){Qt.cur=null,Qt.next=null,Qt.dirty=!0,ee(ur).forEach(function(Sr){Sr.framebuffer=N.createFramebuffer(),Jt(Sr)})}return m(Qt,{getFramebuffer:function(Sr){if(typeof Sr=="function"&&Sr._reglType==="framebuffer"){var qr=Sr._framebuffer;if(qr instanceof Or)return qr}return null},create:tr,createCube:xn,clear:function(){ee(ur).forEach(Fn)},restore:Vr})}var Pe=5126,Ne=34962,xe=34963,je=["attributes","elements","offset","count","primitive","instances"];function Ke(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Pe,this.offset=0,this.stride=0,this.divisor=0}function vt(N,ce,Fe,Lt,rr,Ot,Qt){for(var lr=Fe.maxAttributes,dr=new Array(lr),_r=0;_r<lr;++_r)dr[_r]=new Ke;var Ar=0,wr={},jr={Record:Ke,scope:{},state:dr,currentVAO:null,targetVAO:null,restore:Cr()?$r:function(){},createVAO:Fn,getVAO:jt,destroyBuffer:mr,setVAO:Cr()?xr:Nr,clear:Cr()?ur:function(){}};function mr(Jt){for(var tr=0;tr<dr.length;++tr){var xn=dr[tr];xn.buffer===Jt&&(N.disableVertexAttribArray(tr),xn.buffer=null)}}function Cr(){return ce.oes_vertex_array_object}function nt(){return ce.angle_instanced_arrays}function jt(Jt){return typeof Jt=="function"&&Jt._vao?Jt._vao:null}function xr(Jt){if(Jt!==jr.currentVAO){var tr=Cr();Jt?tr.bindVertexArrayOES(Jt.vao):tr.bindVertexArrayOES(null),jr.currentVAO=Jt}}function Nr(Jt){if(Jt!==jr.currentVAO){if(Jt)Jt.bindAttrs();else{for(var tr=nt(),xn=0;xn<dr.length;++xn){var Vr=dr[xn];Vr.buffer?(N.enableVertexAttribArray(xn),Vr.buffer.bind(),N.vertexAttribPointer(xn,Vr.size,Vr.type,Vr.normalized,Vr.stride,Vr.offfset),tr&&Vr.divisor&&tr.vertexAttribDivisorANGLE(xn,Vr.divisor)):(N.disableVertexAttribArray(xn),N.vertexAttrib4f(xn,Vr.x,Vr.y,Vr.z,Vr.w))}Qt.elements?N.bindBuffer(xe,Qt.elements.buffer.buffer):N.bindBuffer(xe,null)}jr.currentVAO=Jt}}function ur(){ee(wr).forEach(function(Jt){Jt.destroy()})}function Or(){this.id=++Ar,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var Jt=Cr();Jt?this.vao=Jt.createVertexArrayOES():this.vao=null,wr[this.id]=this,this.buffers=[]}Or.prototype.bindAttrs=function(){for(var Jt=nt(),tr=this.attributes,xn=0;xn<tr.length;++xn){var Vr=tr[xn];Vr.buffer?(N.enableVertexAttribArray(xn),N.bindBuffer(Ne,Vr.buffer.buffer),N.vertexAttribPointer(xn,Vr.size,Vr.type,Vr.normalized,Vr.stride,Vr.offset),Jt&&Vr.divisor&&Jt.vertexAttribDivisorANGLE(xn,Vr.divisor)):(N.disableVertexAttribArray(xn),N.vertexAttrib4f(xn,Vr.x,Vr.y,Vr.z,Vr.w))}for(var Sr=tr.length;Sr<lr;++Sr)N.disableVertexAttribArray(Sr);var qr=Ot.getElements(this.elements);qr?N.bindBuffer(xe,qr.buffer.buffer):N.bindBuffer(xe,null)},Or.prototype.refresh=function(){var Jt=Cr();Jt&&(Jt.bindVertexArrayOES(this.vao),this.bindAttrs(),jr.currentVAO=null,Jt.bindVertexArrayOES(null))},Or.prototype.destroy=function(){if(this.vao){var Jt=Cr();this===jr.currentVAO&&(jr.currentVAO=null,Jt.bindVertexArrayOES(null)),Jt.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),wr[this.id]&&(delete wr[this.id],Lt.vaoCount-=1)};function $r(){var Jt=Cr();Jt&&ee(wr).forEach(function(tr){tr.refresh()})}function Fn(Jt){var tr=new Or;Lt.vaoCount+=1;function xn(Vr){var Sr;if(Array.isArray(Vr))Sr=Vr,tr.elements&&tr.ownsElements&&tr.elements.destroy(),tr.elements=null,tr.ownsElements=!1,tr.offset=0,tr.count=0,tr.instances=-1,tr.primitive=4;else{if(fe(typeof Vr=="object","invalid arguments for create vao"),fe("attributes"in Vr,"must specify attributes for vao"),Vr.elements){var qr=Vr.elements;tr.ownsElements?typeof qr=="function"&&qr._reglType==="elements"?(tr.elements.destroy(),tr.ownsElements=!1):(tr.elements(qr),tr.ownsElements=!1):Ot.getElements(Vr.elements)?(tr.elements=Vr.elements,tr.ownsElements=!1):(tr.elements=Ot.create(Vr.elements),tr.ownsElements=!0)}else tr.elements=null,tr.ownsElements=!1;Sr=Vr.attributes,tr.offset=0,tr.count=-1,tr.instances=-1,tr.primitive=4,tr.elements&&(tr.count=tr.elements._elements.vertCount,tr.primitive=tr.elements._elements.primType),"offset"in Vr&&(tr.offset=Vr.offset|0),"count"in Vr&&(tr.count=Vr.count|0),"instances"in Vr&&(tr.instances=Vr.instances|0),"primitive"in Vr&&(fe(Vr.primitive in nr,"bad primitive type: "+Vr.primitive),tr.primitive=nr[Vr.primitive]),fe.optional(function(){for(var oo=Object.keys(Vr),so=0;so<oo.length;++so)fe(je.indexOf(oo[so])>=0,'invalid option for vao: "'+oo[so]+'" valid options are '+je)}),fe(Array.isArray(Sr),"attributes must be an array")}fe(Sr.length<lr,"too many attributes"),fe(Sr.length>0,"must specify at least one attribute");var Kr={},mi=tr.attributes;mi.length=Sr.length;for(var ii=0;ii<Sr.length;++ii){var Hr=Sr[ii],rn=mi[ii]=new Ke,Qn=Hr.data||Hr;if(Array.isArray(Qn)||me(Qn)||ds(Qn)){var ci;tr.buffers[ii]&&(ci=tr.buffers[ii],me(Qn)&&ci._buffer.byteLength>=Qn.byteLength?ci.subdata(Qn):(ci.destroy(),tr.buffers[ii]=null)),tr.buffers[ii]||(ci=tr.buffers[ii]=rr.create(Hr,Ne,!1,!0)),rn.buffer=rr.getBuffer(ci),rn.size=rn.buffer.dimension|0,rn.normalized=!1,rn.type=rn.buffer.dtype,rn.offset=0,rn.stride=0,rn.divisor=0,rn.state=1,Kr[ii]=1}else rr.getBuffer(Hr)?(rn.buffer=rr.getBuffer(Hr),rn.size=rn.buffer.dimension|0,rn.normalized=!1,rn.type=rn.buffer.dtype,rn.offset=0,rn.stride=0,rn.divisor=0,rn.state=1):rr.getBuffer(Hr.buffer)?(rn.buffer=rr.getBuffer(Hr.buffer),rn.size=(+Hr.size||rn.buffer.dimension)|0,rn.normalized=!!Hr.normalized||!1,"type"in Hr?(fe.parameter(Hr.type,uu,"invalid buffer type"),rn.type=uu[Hr.type]):rn.type=rn.buffer.dtype,rn.offset=(Hr.offset||0)|0,rn.stride=(Hr.stride||0)|0,rn.divisor=(Hr.divisor||0)|0,rn.state=1,fe(rn.size>=1&&rn.size<=4,"size must be between 1 and 4"),fe(rn.offset>=0,"invalid offset"),fe(rn.stride>=0&&rn.stride<=255,"stride must be between 0 and 255"),fe(rn.divisor>=0,"divisor must be positive"),fe(!rn.divisor||!!ce.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Hr?(fe(ii>0,"first attribute must not be a constant"),rn.x=+Hr.x||0,rn.y=+Hr.y||0,rn.z=+Hr.z||0,rn.w=+Hr.w||0,rn.state=2):fe(!1,"invalid attribute spec for location "+ii)}for(var Bi=0;Bi<tr.buffers.length;++Bi)!Kr[Bi]&&tr.buffers[Bi]&&(tr.buffers[Bi].destroy(),tr.buffers[Bi]=null);return tr.refresh(),xn}return xn.destroy=function(){for(var Vr=0;Vr<tr.buffers.length;++Vr)tr.buffers[Vr]&&tr.buffers[Vr].destroy();tr.buffers.length=0,tr.ownsElements&&(tr.elements.destroy(),tr.elements=null,tr.ownsElements=!1),tr.destroy()},xn._vao=tr,xn._reglType="vao",xn(Jt)}return jr}var Wt=35632,Zt=35633,qt=35718,hr=35721;function kr(N,ce,Fe,Lt){var rr={},Ot={};function Qt(nt,jt,xr,Nr){this.name=nt,this.id=jt,this.location=xr,this.info=Nr}function lr(nt,jt){for(var xr=0;xr<nt.length;++xr)if(nt[xr].id===jt.id){nt[xr].location=jt.location;return}nt.push(jt)}function dr(nt,jt,xr){var Nr=nt===Wt?rr:Ot,ur=Nr[jt];if(!ur){var Or=ce.str(jt);ur=N.createShader(nt),N.shaderSource(ur,Or),N.compileShader(ur),fe.shaderError(N,ur,Or,nt,xr),Nr[jt]=ur}return ur}var _r={},Ar=[],wr=0;function jr(nt,jt){this.id=wr++,this.fragId=nt,this.vertId=jt,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,Lt.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function mr(nt,jt,xr){var Nr,ur,Or=dr(Wt,nt.fragId),$r=dr(Zt,nt.vertId),Fn=nt.program=N.createProgram();if(N.attachShader(Fn,Or),N.attachShader(Fn,$r),xr)for(Nr=0;Nr<xr.length;++Nr){var Jt=xr[Nr];N.bindAttribLocation(Fn,Jt[0],Jt[1])}N.linkProgram(Fn),fe.linkError(N,Fn,ce.str(nt.fragId),ce.str(nt.vertId),jt);var tr=N.getProgramParameter(Fn,qt);Lt.profile&&(nt.stats.uniformsCount=tr);var xn=nt.uniforms;for(Nr=0;Nr<tr;++Nr)if(ur=N.getActiveUniform(Fn,Nr),ur)if(ur.size>1)for(var Vr=0;Vr<ur.size;++Vr){var Sr=ur.name.replace("[0]","["+Vr+"]");lr(xn,new Qt(Sr,ce.id(Sr),N.getUniformLocation(Fn,Sr),ur))}else lr(xn,new Qt(ur.name,ce.id(ur.name),N.getUniformLocation(Fn,ur.name),ur));var qr=N.getProgramParameter(Fn,hr);Lt.profile&&(nt.stats.attributesCount=qr);var Kr=nt.attributes;for(Nr=0;Nr<qr;++Nr)ur=N.getActiveAttrib(Fn,Nr),ur&&lr(Kr,new Qt(ur.name,ce.id(ur.name),N.getAttribLocation(Fn,ur.name),ur))}Lt.profile&&(Fe.getMaxUniformsCount=function(){var nt=0;return Ar.forEach(function(jt){jt.stats.uniformsCount>nt&&(nt=jt.stats.uniformsCount)}),nt},Fe.getMaxAttributesCount=function(){var nt=0;return Ar.forEach(function(jt){jt.stats.attributesCount>nt&&(nt=jt.stats.attributesCount)}),nt});function Cr(){rr={},Ot={};for(var nt=0;nt<Ar.length;++nt)mr(Ar[nt],null,Ar[nt].attributes.map(function(jt){return[jt.location,jt.name]}))}return{clear:function(){var nt=N.deleteShader.bind(N);ee(rr).forEach(nt),rr={},ee(Ot).forEach(nt),Ot={},Ar.forEach(function(jt){N.deleteProgram(jt.program)}),Ar.length=0,_r={},Fe.shaderCount=0},program:function(nt,jt,xr,Nr){fe.command(nt>=0,"missing vertex shader",xr),fe.command(jt>=0,"missing fragment shader",xr);var ur=_r[jt];ur||(ur=_r[jt]={});var Or=ur[nt];if(Or&&(Or.refCount++,!Nr))return Or;var $r=new jr(jt,nt);return Fe.shaderCount++,mr($r,xr,Nr),Or||(ur[nt]=$r),Ar.push($r),m($r,{destroy:function(){if($r.refCount--,$r.refCount<=0){N.deleteProgram($r.program);var Fn=Ar.indexOf($r);Ar.splice(Fn,1),Fe.shaderCount--}ur[$r.vertId].refCount<=0&&(N.deleteShader(Ot[$r.vertId]),delete Ot[$r.vertId],delete _r[$r.fragId][$r.vertId]),Object.keys(_r[$r.fragId]).length||(N.deleteShader(rr[$r.fragId]),delete rr[$r.fragId],delete _r[$r.fragId])}})},restore:Cr,shader:dr,frag:-1,vert:-1}}var yr=6408,sn=5121,Zn=3333,jn=5126;function Ln(N,ce,Fe,Lt,rr,Ot,Qt){function lr(Ar){var wr;ce.next===null?(fe(rr.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),wr=sn):(fe(ce.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),wr=ce.next.colorAttachments[0].texture._texture.type,fe.optional(function(){Ot.oes_texture_float?(fe(wr===sn||wr===jn,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),wr===jn&&fe(Qt.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):fe(wr===sn,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var jr=0,mr=0,Cr=Lt.framebufferWidth,nt=Lt.framebufferHeight,jt=null;me(Ar)?jt=Ar:Ar&&(fe.type(Ar,"object","invalid arguments to regl.read()"),jr=Ar.x|0,mr=Ar.y|0,fe(jr>=0&&jr<Lt.framebufferWidth,"invalid x offset for regl.read"),fe(mr>=0&&mr<Lt.framebufferHeight,"invalid y offset for regl.read"),Cr=(Ar.width||Lt.framebufferWidth-jr)|0,nt=(Ar.height||Lt.framebufferHeight-mr)|0,jt=Ar.data||null),jt&&(wr===sn?fe(jt instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):wr===jn&&fe(jt instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),fe(Cr>0&&Cr+jr<=Lt.framebufferWidth,"invalid width for read pixels"),fe(nt>0&&nt+mr<=Lt.framebufferHeight,"invalid height for read pixels"),Fe();var xr=Cr*nt*4;return jt||(wr===sn?jt=new Uint8Array(xr):wr===jn&&(jt=jt||new Float32Array(xr))),fe.isTypedArray(jt,"data buffer for regl.read() must be a typedarray"),fe(jt.byteLength>=xr,"data buffer for regl.read() too small"),N.pixelStorei(Zn,4),N.readPixels(jr,mr,Cr,nt,yr,wr,jt),jt}function dr(Ar){var wr;return ce.setFBO({framebuffer:Ar.framebuffer},function(){wr=lr(Ar)}),wr}function _r(Ar){return!Ar||!("framebuffer"in Ar)?lr(Ar):dr(Ar)}return _r}function Ri(N){return Array.prototype.slice.call(N)}function tn(N){return Ri(N).join("")}function ni(){var N=0,ce=[],Fe=[];function Lt(wr){for(var jr=0;jr<Fe.length;++jr)if(Fe[jr]===wr)return ce[jr];var mr="g"+N++;return ce.push(mr),Fe.push(wr),mr}function rr(){var wr=[];function jr(){wr.push.apply(wr,Ri(arguments))}var mr=[];function Cr(){var nt="v"+N++;return mr.push(nt),arguments.length>0&&(wr.push(nt,"="),wr.push.apply(wr,Ri(arguments)),wr.push(";")),nt}return m(jr,{def:Cr,toString:function(){return tn([mr.length>0?"var "+mr.join(",")+";":"",tn(wr)])}})}function Ot(){var wr=rr(),jr=rr(),mr=wr.toString,Cr=jr.toString;function nt(jt,xr){jr(jt,xr,"=",wr.def(jt,xr),";")}return m(function(){wr.apply(wr,Ri(arguments))},{def:wr.def,entry:wr,exit:jr,save:nt,set:function(jt,xr,Nr){nt(jt,xr),wr(jt,xr,"=",Nr,";")},toString:function(){return mr()+Cr()}})}function Qt(){var wr=tn(arguments),jr=Ot(),mr=Ot(),Cr=jr.toString,nt=mr.toString;return m(jr,{then:function(){return jr.apply(jr,Ri(arguments)),this},else:function(){return mr.apply(mr,Ri(arguments)),this},toString:function(){var jt=nt();return jt&&(jt="else{"+jt+"}"),tn(["if(",wr,"){",Cr(),"}",jt])}})}var lr=rr(),dr={};function _r(wr,jr){var mr=[];function Cr(){var ur="a"+mr.length;return mr.push(ur),ur}jr=jr||0;for(var nt=0;nt<jr;++nt)Cr();var jt=Ot(),xr=jt.toString,Nr=dr[wr]=m(jt,{arg:Cr,toString:function(){return tn(["function(",mr.join(),"){",xr(),"}"])}});return Nr}function Ar(){var wr=['"use strict";',lr,"return {"];Object.keys(dr).forEach(function(nt){wr.push('"',nt,'":',dr[nt].toString(),",")}),wr.push("}");var jr=tn(wr).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),mr=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Cr=mr?Ce.Function.apply(null,ce.concat(jr)):Function.apply(null,ce.concat(jr));return Cr.apply(null,Fe)}return{global:lr,link:Lt,block:rr,proc:_r,scope:Ot,cond:Qt,compile:Ar}}var li="xyzw".split(""),Kn=5121,Hn=1,hi=2,qn=0,Xn=1,go=2,Qa=3,To=4,Da=5,Ga=6,fo="dither",Is="blend.enable",is="blend.color",Du="blend.equation",as="blend.func",mu="depth.enable",Os="depth.func",Es="depth.range",Vl="depth.mask",Fu="colorMask",gl="cull.enable",Gl="cull.face",tu="frontFace",yl="lineWidth",bu="polygonOffset.enable",Eo="polygonOffset.offset",Bu="sample.alpha",Nu="sample.enable",Ju="sample.coverage",ua="stencil.enable",Ns="stencil.mask",Qo="stencil.func",gu="stencil.opFront",Hc="stencil.opBack",Wc="scissor.enable",Af="scissor.box",ru="viewport",hc="profile",nu="framebuffer",_l="vert",dc="frag",iu="elements",Fo="primitive",Xc="count",Kf="offset",Ip="instances",$f="vao",lh="Width",vc="Height",mc=nu+lh,wf=nu+vc,Op=ru+lh,Wh=ru+vc,xl="drawingBuffer",Yc=xl+lh,Xh=xl+vc,wd=[as,Du,Qo,gu,Hc,Ju,ru,Af,Eo],qc=34962,Rp=34963,Td=35632,Md=35633,Yh=3553,ch=34067,fh=2884,Qf=3042,Xr=3024,Mo=2960,Gt=2929,qh=3089,kp=32823,Jf=32926,Tf=32928,ep=5126,tp=35664,Hl=35665,bl=35666,rp=5124,Lp=35667,Wl=35668,np=35669,Mf=35670,ip=35671,Kc=35672,Pf=35673,zs=35674,If=35675,$c=35676,ap=35678,op=35680,Dp=4,El=1028,Qc=1029,Kh=2304,Fp=2305,ph=32775,Pd=32776,$h=519,Eu=7680,Id=0,Bp=1,Jc=32774,zu=513,Qh=36160,Jh=36064,el={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Of=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],ef={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},gc={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},hh={frag:Td,vert:Md},tf={cw:Kh,ccw:Fp};function Np(N){return Array.isArray(N)||me(N)||ds(N)}function Ia(N){return N.sort(function(ce,Fe){return ce===ru?-1:Fe===ru?1:ce<Fe?-1:1})}function Yi(N,ce,Fe,Lt){this.thisDep=N,this.contextDep=ce,this.propDep=Fe,this.append=Lt}function yc(N){return N&&!(N.thisDep||N.contextDep||N.propDep)}function Po(N){return new Yi(!1,!1,!1,N)}function Us(N,ce){var Fe=N.type;if(Fe===qn){var Lt=N.data.length;return new Yi(!0,Lt>=1,Lt>=2,ce)}else if(Fe===To){var rr=N.data;return new Yi(rr.thisDep,rr.contextDep,rr.propDep,ce)}else{if(Fe===Da)return new Yi(!1,!1,!1,ce);if(Fe===Ga){for(var Ot=!1,Qt=!1,lr=!1,dr=0;dr<N.data.length;++dr){var _r=N.data[dr];if(_r.type===Xn)lr=!0;else if(_r.type===go)Qt=!0;else if(_r.type===Qa)Ot=!0;else if(_r.type===qn){Ot=!0;var Ar=_r.data;Ar>=1&&(Qt=!0),Ar>=2&&(lr=!0)}else _r.type===To&&(Ot=Ot||_r.data.thisDep,Qt=Qt||_r.data.contextDep,lr=lr||_r.data.propDep)}return new Yi(Ot,Qt,lr,ce)}else return new Yi(Fe===Qa,Fe===go,Fe===Xn,ce)}}var ed=new Yi(!1,!1,!1,function(){});function dh(N,ce,Fe,Lt,rr,Ot,Qt,lr,dr,_r,Ar,wr,jr,mr,Cr){var nt=_r.Record,jt={add:32774,subtract:32778,"reverse subtract":32779};Fe.ext_blend_minmax&&(jt.min=ph,jt.max=Pd);var xr=Fe.angle_instanced_arrays,Nr=Fe.webgl_draw_buffers,ur=Fe.oes_vertex_array_object,Or={dirty:!0,profile:Cr.profile},$r={},Fn=[],Jt={},tr={};function xn(Ee){return Ee.replace(".","_")}function Vr(Ee,ie,Ve){var ot=xn(Ee);Fn.push(Ee),$r[ot]=Or[ot]=!!Ve,Jt[ot]=ie}function Sr(Ee,ie,Ve){var ot=xn(Ee);Fn.push(Ee),Array.isArray(Ve)?(Or[ot]=Ve.slice(),$r[ot]=Ve.slice()):Or[ot]=$r[ot]=Ve,tr[ot]=ie}Vr(fo,Xr),Vr(Is,Qf),Sr(is,"blendColor",[0,0,0,0]),Sr(Du,"blendEquationSeparate",[Jc,Jc]),Sr(as,"blendFuncSeparate",[Bp,Id,Bp,Id]),Vr(mu,Gt,!0),Sr(Os,"depthFunc",zu),Sr(Es,"depthRange",[0,1]),Sr(Vl,"depthMask",!0),Sr(Fu,Fu,[!0,!0,!0,!0]),Vr(gl,fh),Sr(Gl,"cullFace",Qc),Sr(tu,tu,Fp),Sr(yl,yl,1),Vr(bu,kp),Sr(Eo,"polygonOffset",[0,0]),Vr(Bu,Jf),Vr(Nu,Tf),Sr(Ju,"sampleCoverage",[1,!1]),Vr(ua,Mo),Sr(Ns,"stencilMask",-1),Sr(Qo,"stencilFunc",[$h,0,-1]),Sr(gu,"stencilOpSeparate",[El,Eu,Eu,Eu]),Sr(Hc,"stencilOpSeparate",[Qc,Eu,Eu,Eu]),Vr(Wc,qh),Sr(Af,"scissor",[0,0,N.drawingBufferWidth,N.drawingBufferHeight]),Sr(ru,ru,[0,0,N.drawingBufferWidth,N.drawingBufferHeight]);var qr={gl:N,context:jr,strings:ce,next:$r,current:Or,draw:wr,elements:Ot,buffer:rr,shader:Ar,attributes:_r.state,vao:_r,uniforms:dr,framebuffer:lr,extensions:Fe,timer:mr,isBufferArgs:Np},Kr={primTypes:nr,compareFuncs:ef,blendFuncs:el,blendEquations:jt,stencilOps:gc,glTypes:uu,orientationType:tf};fe.optional(function(){qr.isArrayLike=lo}),Nr&&(Kr.backBuffer=[Qc],Kr.drawBuffer=Ge(Lt.maxDrawbuffers,function(Ee){return Ee===0?[0]:Ge(Ee,function(ie){return Jh+ie})}));var mi=0;function ii(){var Ee=ni(),ie=Ee.link,Ve=Ee.global;Ee.id=mi++,Ee.batchId="0";var ot=ie(qr),Pt=Ee.shared={props:"a0"};Object.keys(qr).forEach(function(Ze){Pt[Ze]=Ve.def(ot,".",Ze)}),fe.optional(function(){Ee.CHECK=ie(fe),Ee.commandStr=fe.guessCommand(),Ee.command=ie(Ee.commandStr),Ee.assert=function(Ze,Ae,st){Ze("if(!(",Ae,"))",this.CHECK,".commandRaise(",ie(st),",",this.command,");")},Kr.invalidBlendCombinations=Of});var Xe=Ee.next={},De=Ee.current={};Object.keys(tr).forEach(function(Ze){Array.isArray(Or[Ze])&&(Xe[Ze]=Ve.def(Pt.next,".",Ze),De[Ze]=Ve.def(Pt.current,".",Ze))});var Je=Ee.constants={};Object.keys(Kr).forEach(function(Ze){Je[Ze]=Ve.def(JSON.stringify(Kr[Ze]))}),Ee.invoke=function(Ze,Ae){switch(Ae.type){case qn:var st=["this",Pt.context,Pt.props,Ee.batchId];return Ze.def(ie(Ae.data),".call(",st.slice(0,Math.max(Ae.data.length+1,4)),")");case Xn:return Ze.def(Pt.props,Ae.data);case go:return Ze.def(Pt.context,Ae.data);case Qa:return Ze.def("this",Ae.data);case To:return Ae.data.append(Ee,Ze),Ae.data.ref;case Da:return Ae.data.toString();case Ga:return Ae.data.map(function(St){return Ee.invoke(Ze,St)})}},Ee.attribCache={};var ve={};return Ee.scopeAttrib=function(Ze){var Ae=ce.id(Ze);if(Ae in ve)return ve[Ae];var st=_r.scope[Ae];st||(st=_r.scope[Ae]=new nt);var St=ve[Ae]=ie(st);return St},Ee}function Hr(Ee){var ie=Ee.static,Ve=Ee.dynamic,ot;if(hc in ie){var Pt=!!ie[hc];ot=Po(function(De,Je){return Pt}),ot.enable=Pt}else if(hc in Ve){var Xe=Ve[hc];ot=Us(Xe,function(De,Je){return De.invoke(Je,Xe)})}return ot}function rn(Ee,ie){var Ve=Ee.static,ot=Ee.dynamic;if(nu in Ve){var Pt=Ve[nu];return Pt?(Pt=lr.getFramebuffer(Pt),fe.command(Pt,"invalid framebuffer object"),Po(function(De,Je){var ve=De.link(Pt),Ze=De.shared;Je.set(Ze.framebuffer,".next",ve);var Ae=Ze.context;return Je.set(Ae,"."+mc,ve+".width"),Je.set(Ae,"."+wf,ve+".height"),ve})):Po(function(De,Je){var ve=De.shared;Je.set(ve.framebuffer,".next","null");var Ze=ve.context;return Je.set(Ze,"."+mc,Ze+"."+Yc),Je.set(Ze,"."+wf,Ze+"."+Xh),"null"})}else if(nu in ot){var Xe=ot[nu];return Us(Xe,function(De,Je){var ve=De.invoke(Je,Xe),Ze=De.shared,Ae=Ze.framebuffer,st=Je.def(Ae,".getFramebuffer(",ve,")");fe.optional(function(){De.assert(Je,"!"+ve+"||"+st,"invalid framebuffer object")}),Je.set(Ae,".next",st);var St=Ze.context;return Je.set(St,"."+mc,st+"?"+st+".width:"+St+"."+Yc),Je.set(St,"."+wf,st+"?"+st+".height:"+St+"."+Xh),st})}else return null}function Qn(Ee,ie,Ve){var ot=Ee.static,Pt=Ee.dynamic;function Xe(ve){if(ve in ot){var Ze=ot[ve];fe.commandType(Ze,"object","invalid "+ve,Ve.commandStr);var Ae=!0,st=Ze.x|0,St=Ze.y|0,cr,zr;return"width"in Ze?(cr=Ze.width|0,fe.command(cr>=0,"invalid "+ve,Ve.commandStr)):Ae=!1,"height"in Ze?(zr=Ze.height|0,fe.command(zr>=0,"invalid "+ve,Ve.commandStr)):Ae=!1,new Yi(!Ae&&ie&&ie.thisDep,!Ae&&ie&&ie.contextDep,!Ae&&ie&&ie.propDep,function(Lr,An){var un=Lr.shared.context,En=cr;"width"in Ze||(En=An.def(un,".",mc,"-",st));var bn=zr;return"height"in Ze||(bn=An.def(un,".",wf,"-",St)),[st,St,En,bn]})}else if(ve in Pt){var Ur=Pt[ve],nn=Us(Ur,function(Lr,An){var un=Lr.invoke(An,Ur);fe.optional(function(){Lr.assert(An,un+"&&typeof "+un+'==="object"',"invalid "+ve)});var En=Lr.shared.context,bn=An.def(un,".x|0"),ln=An.def(un,".y|0"),Jn=An.def('"width" in ',un,"?",un,".width|0:","(",En,".",mc,"-",bn,")"),Ea=An.def('"height" in ',un,"?",un,".height|0:","(",En,".",wf,"-",ln,")");return fe.optional(function(){Lr.assert(An,Jn+">=0&&"+Ea+">=0","invalid "+ve)}),[bn,ln,Jn,Ea]});return ie&&(nn.thisDep=nn.thisDep||ie.thisDep,nn.contextDep=nn.contextDep||ie.contextDep,nn.propDep=nn.propDep||ie.propDep),nn}else return ie?new Yi(ie.thisDep,ie.contextDep,ie.propDep,function(Lr,An){var un=Lr.shared.context;return[0,0,An.def(un,".",mc),An.def(un,".",wf)]}):null}var De=Xe(ru);if(De){var Je=De;De=new Yi(De.thisDep,De.contextDep,De.propDep,function(ve,Ze){var Ae=Je.append(ve,Ze),st=ve.shared.context;return Ze.set(st,"."+Op,Ae[2]),Ze.set(st,"."+Wh,Ae[3]),Ae})}return{viewport:De,scissor_box:Xe(Af)}}function ci(Ee,ie){var Ve=Ee.static,ot=typeof Ve[dc]=="string"&&typeof Ve[_l]=="string";if(ot){if(Object.keys(ie.dynamic).length>0)return null;var Pt=ie.static,Xe=Object.keys(Pt);if(Xe.length>0&&typeof Pt[Xe[0]]=="number"){for(var De=[],Je=0;Je<Xe.length;++Je)fe(typeof Pt[Xe[Je]]=="number","must specify all vertex attribute locations when using vaos"),De.push([Pt[Xe[Je]]|0,Xe[Je]]);return De}}return null}function Bi(Ee,ie,Ve){var ot=Ee.static,Pt=Ee.dynamic;function Xe(Ae){if(Ae in ot){var st=ce.id(ot[Ae]);fe.optional(function(){Ar.shader(hh[Ae],st,fe.guessCommand())});var St=Po(function(){return st});return St.id=st,St}else if(Ae in Pt){var cr=Pt[Ae];return Us(cr,function(zr,Ur){var nn=zr.invoke(Ur,cr),Lr=Ur.def(zr.shared.strings,".id(",nn,")");return fe.optional(function(){Ur(zr.shared.shader,".shader(",hh[Ae],",",Lr,",",zr.command,");")}),Lr})}return null}var De=Xe(dc),Je=Xe(_l),ve=null,Ze;return yc(De)&&yc(Je)?(ve=Ar.program(Je.id,De.id,null,Ve),Ze=Po(function(Ae,st){return Ae.link(ve)})):Ze=new Yi(De&&De.thisDep||Je&&Je.thisDep,De&&De.contextDep||Je&&Je.contextDep,De&&De.propDep||Je&&Je.propDep,function(Ae,st){var St=Ae.shared.shader,cr;De?cr=De.append(Ae,st):cr=st.def(St,".",dc);var zr;Je?zr=Je.append(Ae,st):zr=st.def(St,".",_l);var Ur=St+".program("+zr+","+cr;return fe.optional(function(){Ur+=","+Ae.command}),st.def(Ur+")")}),{frag:De,vert:Je,progVar:Ze,program:ve}}function oo(Ee,ie){var Ve=Ee.static,ot=Ee.dynamic,Pt={},Xe=!1;function De(){if($f in Ve){var An=Ve[$f];return An!==null&&_r.getVAO(An)===null&&(An=_r.createVAO(An)),Xe=!0,Pt.vao=An,Po(function(En){var bn=_r.getVAO(An);return bn?En.link(bn):"null"})}else if($f in ot){Xe=!0;var un=ot[$f];return Us(un,function(En,bn){var ln=En.invoke(bn,un);return bn.def(En.shared.vao+".getVAO("+ln+")")})}return null}var Je=De(),ve=!1;function Ze(){if(iu in Ve){var An=Ve[iu];if(Pt.elements=An,Np(An)){var un=Pt.elements=Ot.create(An,!0);An=Ot.getElements(un),ve=!0}else An&&(An=Ot.getElements(An),ve=!0,fe.command(An,"invalid elements",ie.commandStr));var En=Po(function(ln,Jn){if(An){var Ea=ln.link(An);return ln.ELEMENTS=Ea,Ea}return ln.ELEMENTS=null,null});return En.value=An,En}else if(iu in ot){ve=!0;var bn=ot[iu];return Us(bn,function(ln,Jn){var Ea=ln.shared,ss=Ea.isBufferArgs,Va=Ea.elements,ya=ln.invoke(Jn,bn),ql=Jn.def("null"),Zs=Jn.def(ss,"(",ya,")"),Cl=ln.cond(Zs).then(ql,"=",Va,".createStream(",ya,");").else(ql,"=",Va,".getElements(",ya,");");return fe.optional(function(){ln.assert(Cl.else,"!"+ya+"||"+ql,"invalid elements")}),Jn.entry(Cl),Jn.exit(ln.cond(Zs).then(Va,".destroyStream(",ql,");")),ln.ELEMENTS=ql,ql})}else if(Xe)return new Yi(Je.thisDep,Je.contextDep,Je.propDep,function(ln,Jn){return Jn.def(ln.shared.vao+".currentVAO?"+ln.shared.elements+".getElements("+ln.shared.vao+".currentVAO.elements):null")});return null}var Ae=Ze();function st(){if(Fo in Ve){var An=Ve[Fo];return Pt.primitive=An,fe.commandParameter(An,nr,"invalid primitve",ie.commandStr),Po(function(En,bn){return nr[An]})}else if(Fo in ot){var un=ot[Fo];return Us(un,function(En,bn){var ln=En.constants.primTypes,Jn=En.invoke(bn,un);return fe.optional(function(){En.assert(bn,Jn+" in "+ln,"invalid primitive, must be one of "+Object.keys(nr))}),bn.def(ln,"[",Jn,"]")})}else{if(ve)return yc(Ae)?Ae.value?Po(function(En,bn){return bn.def(En.ELEMENTS,".primType")}):Po(function(){return Dp}):new Yi(Ae.thisDep,Ae.contextDep,Ae.propDep,function(En,bn){var ln=En.ELEMENTS;return bn.def(ln,"?",ln,".primType:",Dp)});if(Xe)return new Yi(Je.thisDep,Je.contextDep,Je.propDep,function(En,bn){return bn.def(En.shared.vao+".currentVAO?"+En.shared.vao+".currentVAO.primitive:"+Dp)})}return null}function St(An,un){if(An in Ve){var En=Ve[An]|0;return un?Pt.offset=En:Pt.instances=En,fe.command(!un||En>=0,"invalid "+An,ie.commandStr),Po(function(ln,Jn){return un&&(ln.OFFSET=En),En})}else if(An in ot){var bn=ot[An];return Us(bn,function(ln,Jn){var Ea=ln.invoke(Jn,bn);return un&&(ln.OFFSET=Ea,fe.optional(function(){ln.assert(Jn,Ea+">=0","invalid "+An)})),Ea})}else if(un){if(ve)return Po(function(ln,Jn){return ln.OFFSET=0,0});if(Xe)return new Yi(Je.thisDep,Je.contextDep,Je.propDep,function(ln,Jn){return Jn.def(ln.shared.vao+".currentVAO?"+ln.shared.vao+".currentVAO.offset:0")})}else if(Xe)return new Yi(Je.thisDep,Je.contextDep,Je.propDep,function(ln,Jn){return Jn.def(ln.shared.vao+".currentVAO?"+ln.shared.vao+".currentVAO.instances:-1")});return null}var cr=St(Kf,!0);function zr(){if(Xc in Ve){var An=Ve[Xc]|0;return Pt.count=An,fe.command(typeof An=="number"&&An>=0,"invalid vertex count",ie.commandStr),Po(function(){return An})}else if(Xc in ot){var un=ot[Xc];return Us(un,function(Jn,Ea){var ss=Jn.invoke(Ea,un);return fe.optional(function(){Jn.assert(Ea,"typeof "+ss+'==="number"&&'+ss+">=0&&"+ss+"===("+ss+"|0)","invalid vertex count")}),ss})}else if(ve)if(yc(Ae)){if(Ae)return cr?new Yi(cr.thisDep,cr.contextDep,cr.propDep,function(Jn,Ea){var ss=Ea.def(Jn.ELEMENTS,".vertCount-",Jn.OFFSET);return fe.optional(function(){Jn.assert(Ea,ss+">=0","invalid vertex offset/element buffer too small")}),ss}):Po(function(Jn,Ea){return Ea.def(Jn.ELEMENTS,".vertCount")});var En=Po(function(){return-1});return fe.optional(function(){En.MISSING=!0}),En}else{var bn=new Yi(Ae.thisDep||cr.thisDep,Ae.contextDep||cr.contextDep,Ae.propDep||cr.propDep,function(Jn,Ea){var ss=Jn.ELEMENTS;return Jn.OFFSET?Ea.def(ss,"?",ss,".vertCount-",Jn.OFFSET,":-1"):Ea.def(ss,"?",ss,".vertCount:-1")});return fe.optional(function(){bn.DYNAMIC=!0}),bn}else if(Xe){var ln=new Yi(Je.thisDep,Je.contextDep,Je.propDep,function(Jn,Ea){return Ea.def(Jn.shared.vao,".currentVAO?",Jn.shared.vao,".currentVAO.count:-1")});return ln}return null}var Ur=st(),nn=zr(),Lr=St(Ip,!1);return{elements:Ae,primitive:Ur,count:nn,instances:Lr,offset:cr,vao:Je,vaoActive:Xe,elementsActive:ve,static:Pt}}function so(Ee,ie){var Ve=Ee.static,ot=Ee.dynamic,Pt={};return Fn.forEach(function(Xe){var De=xn(Xe);function Je(ve,Ze){if(Xe in Ve){var Ae=ve(Ve[Xe]);Pt[De]=Po(function(){return Ae})}else if(Xe in ot){var st=ot[Xe];Pt[De]=Us(st,function(St,cr){return Ze(St,cr,St.invoke(cr,st))})}}switch(Xe){case gl:case Is:case fo:case ua:case mu:case Wc:case bu:case Bu:case Nu:case Vl:return Je(function(ve){return fe.commandType(ve,"boolean",Xe,ie.commandStr),ve},function(ve,Ze,Ae){return fe.optional(function(){ve.assert(Ze,"typeof "+Ae+'==="boolean"',"invalid flag "+Xe,ve.commandStr)}),Ae});case Os:return Je(function(ve){return fe.commandParameter(ve,ef,"invalid "+Xe,ie.commandStr),ef[ve]},function(ve,Ze,Ae){var st=ve.constants.compareFuncs;return fe.optional(function(){ve.assert(Ze,Ae+" in "+st,"invalid "+Xe+", must be one of "+Object.keys(ef))}),Ze.def(st,"[",Ae,"]")});case Es:return Je(function(ve){return fe.command(lo(ve)&&ve.length===2&&typeof ve[0]=="number"&&typeof ve[1]=="number"&&ve[0]<=ve[1],"depth range is 2d array",ie.commandStr),ve},function(ve,Ze,Ae){fe.optional(function(){ve.assert(Ze,ve.shared.isArrayLike+"("+Ae+")&&"+Ae+".length===2&&typeof "+Ae+'[0]==="number"&&typeof '+Ae+'[1]==="number"&&'+Ae+"[0]<="+Ae+"[1]","depth range must be a 2d array")});var st=Ze.def("+",Ae,"[0]"),St=Ze.def("+",Ae,"[1]");return[st,St]});case as:return Je(function(ve){fe.commandType(ve,"object","blend.func",ie.commandStr);var Ze="srcRGB"in ve?ve.srcRGB:ve.src,Ae="srcAlpha"in ve?ve.srcAlpha:ve.src,st="dstRGB"in ve?ve.dstRGB:ve.dst,St="dstAlpha"in ve?ve.dstAlpha:ve.dst;return fe.commandParameter(Ze,el,De+".srcRGB",ie.commandStr),fe.commandParameter(Ae,el,De+".srcAlpha",ie.commandStr),fe.commandParameter(st,el,De+".dstRGB",ie.commandStr),fe.commandParameter(St,el,De+".dstAlpha",ie.commandStr),fe.command(Of.indexOf(Ze+", "+st)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+Ze+", "+st+")",ie.commandStr),[el[Ze],el[st],el[Ae],el[St]]},function(ve,Ze,Ae){var st=ve.constants.blendFuncs;fe.optional(function(){ve.assert(Ze,Ae+"&&typeof "+Ae+'==="object"',"invalid blend func, must be an object")});function St(un,En){var bn=Ze.def('"',un,En,'" in ',Ae,"?",Ae,".",un,En,":",Ae,".",un);return fe.optional(function(){ve.assert(Ze,bn+" in "+st,"invalid "+Xe+"."+un+En+", must be one of "+Object.keys(el))}),bn}var cr=St("src","RGB"),zr=St("dst","RGB");fe.optional(function(){var un=ve.constants.invalidBlendCombinations;ve.assert(Ze,un+".indexOf("+cr+'+", "+'+zr+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var Ur=Ze.def(st,"[",cr,"]"),nn=Ze.def(st,"[",St("src","Alpha"),"]"),Lr=Ze.def(st,"[",zr,"]"),An=Ze.def(st,"[",St("dst","Alpha"),"]");return[Ur,Lr,nn,An]});case Du:return Je(function(ve){if(typeof ve=="string")return fe.commandParameter(ve,jt,"invalid "+Xe,ie.commandStr),[jt[ve],jt[ve]];if(typeof ve=="object")return fe.commandParameter(ve.rgb,jt,Xe+".rgb",ie.commandStr),fe.commandParameter(ve.alpha,jt,Xe+".alpha",ie.commandStr),[jt[ve.rgb],jt[ve.alpha]];fe.commandRaise("invalid blend.equation",ie.commandStr)},function(ve,Ze,Ae){var st=ve.constants.blendEquations,St=Ze.def(),cr=Ze.def(),zr=ve.cond("typeof ",Ae,'==="string"');return fe.optional(function(){function Ur(nn,Lr,An){ve.assert(nn,An+" in "+st,"invalid "+Lr+", must be one of "+Object.keys(jt))}Ur(zr.then,Xe,Ae),ve.assert(zr.else,Ae+"&&typeof "+Ae+'==="object"',"invalid "+Xe),Ur(zr.else,Xe+".rgb",Ae+".rgb"),Ur(zr.else,Xe+".alpha",Ae+".alpha")}),zr.then(St,"=",cr,"=",st,"[",Ae,"];"),zr.else(St,"=",st,"[",Ae,".rgb];",cr,"=",st,"[",Ae,".alpha];"),Ze(zr),[St,cr]});case is:return Je(function(ve){return fe.command(lo(ve)&&ve.length===4,"blend.color must be a 4d array",ie.commandStr),Ge(4,function(Ze){return+ve[Ze]})},function(ve,Ze,Ae){return fe.optional(function(){ve.assert(Ze,ve.shared.isArrayLike+"("+Ae+")&&"+Ae+".length===4","blend.color must be a 4d array")}),Ge(4,function(st){return Ze.def("+",Ae,"[",st,"]")})});case Ns:return Je(function(ve){return fe.commandType(ve,"number",De,ie.commandStr),ve|0},function(ve,Ze,Ae){return fe.optional(function(){ve.assert(Ze,"typeof "+Ae+'==="number"',"invalid stencil.mask")}),Ze.def(Ae,"|0")});case Qo:return Je(function(ve){fe.commandType(ve,"object",De,ie.commandStr);var Ze=ve.cmp||"keep",Ae=ve.ref||0,st="mask"in ve?ve.mask:-1;return fe.commandParameter(Ze,ef,Xe+".cmp",ie.commandStr),fe.commandType(Ae,"number",Xe+".ref",ie.commandStr),fe.commandType(st,"number",Xe+".mask",ie.commandStr),[ef[Ze],Ae,st]},function(ve,Ze,Ae){var st=ve.constants.compareFuncs;fe.optional(function(){function Ur(){ve.assert(Ze,Array.prototype.join.call(arguments,""),"invalid stencil.func")}Ur(Ae+"&&typeof ",Ae,'==="object"'),Ur('!("cmp" in ',Ae,")||(",Ae,".cmp in ",st,")")});var St=Ze.def('"cmp" in ',Ae,"?",st,"[",Ae,".cmp]",":",Eu),cr=Ze.def(Ae,".ref|0"),zr=Ze.def('"mask" in ',Ae,"?",Ae,".mask|0:-1");return[St,cr,zr]});case gu:case Hc:return Je(function(ve){fe.commandType(ve,"object",De,ie.commandStr);var Ze=ve.fail||"keep",Ae=ve.zfail||"keep",st=ve.zpass||"keep";return fe.commandParameter(Ze,gc,Xe+".fail",ie.commandStr),fe.commandParameter(Ae,gc,Xe+".zfail",ie.commandStr),fe.commandParameter(st,gc,Xe+".zpass",ie.commandStr),[Xe===Hc?Qc:El,gc[Ze],gc[Ae],gc[st]]},function(ve,Ze,Ae){var st=ve.constants.stencilOps;fe.optional(function(){ve.assert(Ze,Ae+"&&typeof "+Ae+'==="object"',"invalid "+Xe)});function St(cr){return fe.optional(function(){ve.assert(Ze,'!("'+cr+'" in '+Ae+")||("+Ae+"."+cr+" in "+st+")","invalid "+Xe+"."+cr+", must be one of "+Object.keys(gc))}),Ze.def('"',cr,'" in ',Ae,"?",st,"[",Ae,".",cr,"]:",Eu)}return[Xe===Hc?Qc:El,St("fail"),St("zfail"),St("zpass")]});case Eo:return Je(function(ve){fe.commandType(ve,"object",De,ie.commandStr);var Ze=ve.factor|0,Ae=ve.units|0;return fe.commandType(Ze,"number",De+".factor",ie.commandStr),fe.commandType(Ae,"number",De+".units",ie.commandStr),[Ze,Ae]},function(ve,Ze,Ae){fe.optional(function(){ve.assert(Ze,Ae+"&&typeof "+Ae+'==="object"',"invalid "+Xe)});var st=Ze.def(Ae,".factor|0"),St=Ze.def(Ae,".units|0");return[st,St]});case Gl:return Je(function(ve){var Ze=0;return ve==="front"?Ze=El:ve==="back"&&(Ze=Qc),fe.command(!!Ze,De,ie.commandStr),Ze},function(ve,Ze,Ae){return fe.optional(function(){ve.assert(Ze,Ae+'==="front"||'+Ae+'==="back"',"invalid cull.face")}),Ze.def(Ae,'==="front"?',El,":",Qc)});case yl:return Je(function(ve){return fe.command(typeof ve=="number"&&ve>=Lt.lineWidthDims[0]&&ve<=Lt.lineWidthDims[1],"invalid line width, must be a positive number between "+Lt.lineWidthDims[0]+" and "+Lt.lineWidthDims[1],ie.commandStr),ve},function(ve,Ze,Ae){return fe.optional(function(){ve.assert(Ze,"typeof "+Ae+'==="number"&&'+Ae+">="+Lt.lineWidthDims[0]+"&&"+Ae+"<="+Lt.lineWidthDims[1],"invalid line width")}),Ae});case tu:return Je(function(ve){return fe.commandParameter(ve,tf,De,ie.commandStr),tf[ve]},function(ve,Ze,Ae){return fe.optional(function(){ve.assert(Ze,Ae+'==="cw"||'+Ae+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),Ze.def(Ae+'==="cw"?'+Kh+":"+Fp)});case Fu:return Je(function(ve){return fe.command(lo(ve)&&ve.length===4,"color.mask must be length 4 array",ie.commandStr),ve.map(function(Ze){return!!Ze})},function(ve,Ze,Ae){return fe.optional(function(){ve.assert(Ze,ve.shared.isArrayLike+"("+Ae+")&&"+Ae+".length===4","invalid color.mask")}),Ge(4,function(st){return"!!"+Ae+"["+st+"]"})});case Ju:return Je(function(ve){fe.command(typeof ve=="object"&&ve,De,ie.commandStr);var Ze="value"in ve?ve.value:1,Ae=!!ve.invert;return fe.command(typeof Ze=="number"&&Ze>=0&&Ze<=1,"sample.coverage.value must be a number between 0 and 1",ie.commandStr),[Ze,Ae]},function(ve,Ze,Ae){fe.optional(function(){ve.assert(Ze,Ae+"&&typeof "+Ae+'==="object"',"invalid sample.coverage")});var st=Ze.def('"value" in ',Ae,"?+",Ae,".value:1"),St=Ze.def("!!",Ae,".invert");return[st,St]})}}),Pt}function Di(Ee,ie){var Ve=Ee.static,ot=Ee.dynamic,Pt={};return Object.keys(Ve).forEach(function(Xe){var De=Ve[Xe],Je;if(typeof De=="number"||typeof De=="boolean")Je=Po(function(){return De});else if(typeof De=="function"){var ve=De._reglType;ve==="texture2d"||ve==="textureCube"?Je=Po(function(Ze){return Ze.link(De)}):ve==="framebuffer"||ve==="framebufferCube"?(fe.command(De.color.length>0,'missing color attachment for framebuffer sent to uniform "'+Xe+'"',ie.commandStr),Je=Po(function(Ze){return Ze.link(De.color[0])})):fe.commandRaise('invalid data for uniform "'+Xe+'"',ie.commandStr)}else lo(De)?Je=Po(function(Ze){var Ae=Ze.global.def("[",Ge(De.length,function(st){return fe.command(typeof De[st]=="number"||typeof De[st]=="boolean","invalid uniform "+Xe,Ze.commandStr),De[st]}),"]");return Ae}):fe.commandRaise('invalid or missing data for uniform "'+Xe+'"',ie.commandStr);Je.value=De,Pt[Xe]=Je}),Object.keys(ot).forEach(function(Xe){var De=ot[Xe];Pt[Xe]=Us(De,function(Je,ve){return Je.invoke(ve,De)})}),Pt}function Jo(Ee,ie){var Ve=Ee.static,ot=Ee.dynamic,Pt={};return Object.keys(Ve).forEach(function(Xe){var De=Ve[Xe],Je=ce.id(Xe),ve=new nt;if(Np(De))ve.state=Hn,ve.buffer=rr.getBuffer(rr.create(De,qc,!1,!0)),ve.type=0;else{var Ze=rr.getBuffer(De);if(Ze)ve.state=Hn,ve.buffer=Ze,ve.type=0;else if(fe.command(typeof De=="object"&&De,"invalid data for attribute "+Xe,ie.commandStr),"constant"in De){var Ae=De.constant;ve.buffer="null",ve.state=hi,typeof Ae=="number"?ve.x=Ae:(fe.command(lo(Ae)&&Ae.length>0&&Ae.length<=4,"invalid constant for attribute "+Xe,ie.commandStr),li.forEach(function(Lr,An){An<Ae.length&&(ve[Lr]=Ae[An])}))}else{Np(De.buffer)?Ze=rr.getBuffer(rr.create(De.buffer,qc,!1,!0)):Ze=rr.getBuffer(De.buffer),fe.command(!!Ze,'missing buffer for attribute "'+Xe+'"',ie.commandStr);var st=De.offset|0;fe.command(st>=0,'invalid offset for attribute "'+Xe+'"',ie.commandStr);var St=De.stride|0;fe.command(St>=0&&St<256,'invalid stride for attribute "'+Xe+'", must be integer betweeen [0, 255]',ie.commandStr);var cr=De.size|0;fe.command(!("size"in De)||cr>0&&cr<=4,'invalid size for attribute "'+Xe+'", must be 1,2,3,4',ie.commandStr);var zr=!!De.normalized,Ur=0;"type"in De&&(fe.commandParameter(De.type,uu,"invalid type for attribute "+Xe,ie.commandStr),Ur=uu[De.type]);var nn=De.divisor|0;fe.optional(function(){"divisor"in De&&(fe.command(nn===0||xr,'cannot specify divisor for attribute "'+Xe+'", instancing not supported',ie.commandStr),fe.command(nn>=0,'invalid divisor for attribute "'+Xe+'"',ie.commandStr));var Lr=ie.commandStr,An=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(De).forEach(function(un){fe.command(An.indexOf(un)>=0,'unknown parameter "'+un+'" for attribute pointer "'+Xe+'" (valid parameters are '+An+")",Lr)})}),ve.buffer=Ze,ve.state=Hn,ve.size=cr,ve.normalized=zr,ve.type=Ur||Ze.dtype,ve.offset=st,ve.stride=St,ve.divisor=nn}}Pt[Xe]=Po(function(Lr,An){var un=Lr.attribCache;if(Je in un)return un[Je];var En={isStream:!1};return Object.keys(ve).forEach(function(bn){En[bn]=ve[bn]}),ve.buffer&&(En.buffer=Lr.link(ve.buffer),En.type=En.type||En.buffer+".dtype"),un[Je]=En,En})}),Object.keys(ot).forEach(function(Xe){var De=ot[Xe];function Je(ve,Ze){var Ae=ve.invoke(Ze,De),st=ve.shared,St=ve.constants,cr=st.isBufferArgs,zr=st.buffer;fe.optional(function(){ve.assert(Ze,Ae+"&&(typeof "+Ae+'==="object"||typeof '+Ae+'==="function")&&('+cr+"("+Ae+")||"+zr+".getBuffer("+Ae+")||"+zr+".getBuffer("+Ae+".buffer)||"+cr+"("+Ae+'.buffer)||("constant" in '+Ae+"&&(typeof "+Ae+'.constant==="number"||'+st.isArrayLike+"("+Ae+".constant))))",'invalid dynamic attribute "'+Xe+'"')});var Ur={isStream:Ze.def(!1)},nn=new nt;nn.state=Hn,Object.keys(nn).forEach(function(En){Ur[En]=Ze.def(""+nn[En])});var Lr=Ur.buffer,An=Ur.type;Ze("if(",cr,"(",Ae,")){",Ur.isStream,"=true;",Lr,"=",zr,".createStream(",qc,",",Ae,");",An,"=",Lr,".dtype;","}else{",Lr,"=",zr,".getBuffer(",Ae,");","if(",Lr,"){",An,"=",Lr,".dtype;",'}else if("constant" in ',Ae,"){",Ur.state,"=",hi,";","if(typeof "+Ae+'.constant === "number"){',Ur[li[0]],"=",Ae,".constant;",li.slice(1).map(function(En){return Ur[En]}).join("="),"=0;","}else{",li.map(function(En,bn){return Ur[En]+"="+Ae+".constant.length>"+bn+"?"+Ae+".constant["+bn+"]:0;"}).join(""),"}}else{","if(",cr,"(",Ae,".buffer)){",Lr,"=",zr,".createStream(",qc,",",Ae,".buffer);","}else{",Lr,"=",zr,".getBuffer(",Ae,".buffer);","}",An,'="type" in ',Ae,"?",St.glTypes,"[",Ae,".type]:",Lr,".dtype;",Ur.normalized,"=!!",Ae,".normalized;");function un(En){Ze(Ur[En],"=",Ae,".",En,"|0;")}return un("size"),un("offset"),un("stride"),un("divisor"),Ze("}}"),Ze.exit("if(",Ur.isStream,"){",zr,".destroyStream(",Lr,");","}"),Ur}Pt[Xe]=Us(De,Je)}),Pt}function ja(Ee){var ie=Ee.static,Ve=Ee.dynamic,ot={};return Object.keys(ie).forEach(function(Pt){var Xe=ie[Pt];ot[Pt]=Po(function(De,Je){return typeof Xe=="number"||typeof Xe=="boolean"?""+Xe:De.link(Xe)})}),Object.keys(Ve).forEach(function(Pt){var Xe=Ve[Pt];ot[Pt]=Us(Xe,function(De,Je){return De.invoke(Je,Xe)})}),ot}function Bo(Ee,ie,Ve,ot,Pt){var Xe=Ee.static,De=Ee.dynamic;fe.optional(function(){var un=[nu,_l,dc,iu,Fo,Kf,Xc,Ip,hc,$f].concat(Fn);function En(bn){Object.keys(bn).forEach(function(ln){fe.command(un.indexOf(ln)>=0,'unknown parameter "'+ln+'"',Pt.commandStr)})}En(Xe),En(De)});var Je=ci(Ee,ie),ve=rn(Ee,Pt),Ze=Qn(Ee,ve,Pt),Ae=oo(Ee,Pt),st=so(Ee,Pt),St=Bi(Ee,Pt,Je);function cr(un){var En=Ze[un];En&&(st[un]=En)}cr(ru),cr(xn(Af));var zr=Object.keys(st).length>0,Ur={framebuffer:ve,draw:Ae,shader:St,state:st,dirty:zr,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(Ur.profile=Hr(Ee,Pt),Ur.uniforms=Di(Ve,Pt),Ur.drawVAO=Ur.scopeVAO=Ae.vao,!Ur.drawVAO&&St.program&&!Je&&Fe.angle_instanced_arrays&&Ae.static.elements){var nn=!0,Lr=St.program.attributes.map(function(un){var En=ie.static[un];return nn=nn&&!!En,En});if(nn&&Lr.length>0){var An=_r.getVAO(_r.createVAO({attributes:Lr,elements:Ae.static.elements}));Ur.drawVAO=new Yi(null,null,null,function(un,En){return un.link(An)}),Ur.useVAO=!0}}return Je?Ur.useVAO=!0:Ur.attributes=Jo(ie,Pt),Ur.context=ja(ot,Pt),Ur}function So(Ee,ie,Ve){var ot=Ee.shared,Pt=ot.context,Xe=Ee.scope();Object.keys(Ve).forEach(function(De){ie.save(Pt,"."+De);var Je=Ve[De],ve=Je.append(Ee,ie);Array.isArray(ve)?Xe(Pt,".",De,"=[",ve.join(),"];"):Xe(Pt,".",De,"=",ve,";")}),ie(Xe)}function Ho(Ee,ie,Ve,ot){var Pt=Ee.shared,Xe=Pt.gl,De=Pt.framebuffer,Je;Nr&&(Je=ie.def(Pt.extensions,".webgl_draw_buffers"));var ve=Ee.constants,Ze=ve.drawBuffer,Ae=ve.backBuffer,st;Ve?st=Ve.append(Ee,ie):st=ie.def(De,".next"),ot||ie("if(",st,"!==",De,".cur){"),ie("if(",st,"){",Xe,".bindFramebuffer(",Qh,",",st,".framebuffer);"),Nr&&ie(Je,".drawBuffersWEBGL(",Ze,"[",st,".colorAttachments.length]);"),ie("}else{",Xe,".bindFramebuffer(",Qh,",null);"),Nr&&ie(Je,".drawBuffersWEBGL(",Ae,");"),ie("}",De,".cur=",st,";"),ot||ie("}")}function Io(Ee,ie,Ve){var ot=Ee.shared,Pt=ot.gl,Xe=Ee.current,De=Ee.next,Je=ot.current,ve=ot.next,Ze=Ee.cond(Je,".dirty");Fn.forEach(function(Ae){var st=xn(Ae);if(!(st in Ve.state)){var St,cr;if(st in De){St=De[st],cr=Xe[st];var zr=Ge(Or[st].length,function(nn){return Ze.def(St,"[",nn,"]")});Ze(Ee.cond(zr.map(function(nn,Lr){return nn+"!=="+cr+"["+Lr+"]"}).join("||")).then(Pt,".",tr[st],"(",zr,");",zr.map(function(nn,Lr){return cr+"["+Lr+"]="+nn}).join(";"),";"))}else{St=Ze.def(ve,".",st);var Ur=Ee.cond(St,"!==",Je,".",st);Ze(Ur),st in Jt?Ur(Ee.cond(St).then(Pt,".enable(",Jt[st],");").else(Pt,".disable(",Jt[st],");"),Je,".",st,"=",St,";"):Ur(Pt,".",tr[st],"(",St,");",Je,".",st,"=",St,";")}}}),Object.keys(Ve.state).length===0&&Ze(Je,".dirty=false;"),ie(Ze)}function os(Ee,ie,Ve,ot){var Pt=Ee.shared,Xe=Ee.current,De=Pt.current,Je=Pt.gl;Ia(Object.keys(Ve)).forEach(function(ve){var Ze=Ve[ve];if(!(ot&&!ot(Ze))){var Ae=Ze.append(Ee,ie);if(Jt[ve]){var st=Jt[ve];yc(Ze)?Ae?ie(Je,".enable(",st,");"):ie(Je,".disable(",st,");"):ie(Ee.cond(Ae).then(Je,".enable(",st,");").else(Je,".disable(",st,");")),ie(De,".",ve,"=",Ae,";")}else if(lo(Ae)){var St=Xe[ve];ie(Je,".",tr[ve],"(",Ae,");",Ae.map(function(cr,zr){return St+"["+zr+"]="+cr}).join(";"),";")}else ie(Je,".",tr[ve],"(",Ae,");",De,".",ve,"=",Ae,";")}})}function po(Ee,ie){xr&&(Ee.instancing=ie.def(Ee.shared.extensions,".angle_instanced_arrays"))}function gi(Ee,ie,Ve,ot,Pt){var Xe=Ee.shared,De=Ee.stats,Je=Xe.current,ve=Xe.timer,Ze=Ve.profile;function Ae(){var un=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return un||typeof performance=="undefined"?"Date.now()":"performance.now()"}var st,St;function cr(un){st=ie.def(),un(st,"=",Ae(),";"),typeof Pt=="string"?un(De,".count+=",Pt,";"):un(De,".count++;"),mr&&(ot?(St=ie.def(),un(St,"=",ve,".getNumPendingQueries();")):un(ve,".beginQuery(",De,");"))}function zr(un){un(De,".cpuTime+=",Ae(),"-",st,";"),mr&&(ot?un(ve,".pushScopeStats(",St,",",ve,".getNumPendingQueries(),",De,");"):un(ve,".endQuery();"))}function Ur(un){var En=ie.def(Je,".profile");ie(Je,".profile=",un,";"),ie.exit(Je,".profile=",En,";")}var nn;if(Ze){if(yc(Ze)){Ze.enable?(cr(ie),zr(ie.exit),Ur("true")):Ur("false");return}nn=Ze.append(Ee,ie),Ur(nn)}else nn=ie.def(Je,".profile");var Lr=Ee.block();cr(Lr),ie("if(",nn,"){",Lr,"}");var An=Ee.block();zr(An),ie.exit("if(",nn,"){",An,"}")}function Oo(Ee,ie,Ve,ot,Pt){var Xe=Ee.shared;function De(ve){switch(ve){case tp:case Lp:case ip:return 2;case Hl:case Wl:case Kc:return 3;case bl:case np:case Pf:return 4;default:return 1}}function Je(ve,Ze,Ae){var st=Xe.gl,St=ie.def(ve,".location"),cr=ie.def(Xe.attributes,"[",St,"]"),zr=Ae.state,Ur=Ae.buffer,nn=[Ae.x,Ae.y,Ae.z,Ae.w],Lr=["buffer","normalized","offset","stride"];function An(){ie("if(!",cr,".buffer){",st,".enableVertexAttribArray(",St,");}");var En=Ae.type,bn;if(Ae.size?bn=ie.def(Ae.size,"||",Ze):bn=Ze,ie("if(",cr,".type!==",En,"||",cr,".size!==",bn,"||",Lr.map(function(Jn){return cr+"."+Jn+"!=="+Ae[Jn]}).join("||"),"){",st,".bindBuffer(",qc,",",Ur,".buffer);",st,".vertexAttribPointer(",[St,bn,En,Ae.normalized,Ae.stride,Ae.offset],");",cr,".type=",En,";",cr,".size=",bn,";",Lr.map(function(Jn){return cr+"."+Jn+"="+Ae[Jn]+";"}).join(""),"}"),xr){var ln=Ae.divisor;ie("if(",cr,".divisor!==",ln,"){",Ee.instancing,".vertexAttribDivisorANGLE(",[St,ln],");",cr,".divisor=",ln,";}")}}function un(){ie("if(",cr,".buffer){",st,".disableVertexAttribArray(",St,");",cr,".buffer=null;","}if(",li.map(function(En,bn){return cr+"."+En+"!=="+nn[bn]}).join("||"),"){",st,".vertexAttrib4f(",St,",",nn,");",li.map(function(En,bn){return cr+"."+En+"="+nn[bn]+";"}).join(""),"}")}zr===Hn?An():zr===hi?un():(ie("if(",zr,"===",Hn,"){"),An(),ie("}else{"),un(),ie("}"))}ot.forEach(function(ve){var Ze=ve.name,Ae=Ve.attributes[Ze],st;if(Ae){if(!Pt(Ae))return;st=Ae.append(Ee,ie)}else{if(!Pt(ed))return;var St=Ee.scopeAttrib(Ze);fe.optional(function(){Ee.assert(ie,St+".state","missing attribute "+Ze)}),st={},Object.keys(new nt).forEach(function(cr){st[cr]=ie.def(St,".",cr)})}Je(Ee.link(ve),De(ve.info.type),st)})}function Qi(Ee,ie,Ve,ot,Pt,Xe){for(var De=Ee.shared,Je=De.gl,ve,Ze=0;Ze<ot.length;++Ze){var Ae=ot[Ze],st=Ae.name,St=Ae.info.type,cr=Ve.uniforms[st],zr=Ee.link(Ae),Ur=zr+".location",nn;if(cr){if(!Pt(cr))continue;if(yc(cr)){var Lr=cr.value;if(fe.command(Lr!==null&&typeof Lr!="undefined",'missing uniform "'+st+'"',Ee.commandStr),St===ap||St===op){fe.command(typeof Lr=="function"&&(St===ap&&(Lr._reglType==="texture2d"||Lr._reglType==="framebuffer")||St===op&&(Lr._reglType==="textureCube"||Lr._reglType==="framebufferCube")),"invalid texture for uniform "+st,Ee.commandStr);var An=Ee.link(Lr._texture||Lr.color[0]._texture);ie(Je,".uniform1i(",Ur,",",An+".bind());"),ie.exit(An,".unbind();")}else if(St===zs||St===If||St===$c){fe.optional(function(){fe.command(lo(Lr),"invalid matrix for uniform "+st,Ee.commandStr),fe.command(St===zs&&Lr.length===4||St===If&&Lr.length===9||St===$c&&Lr.length===16,"invalid length for matrix uniform "+st,Ee.commandStr)});var un=Ee.global.def("new Float32Array(["+Array.prototype.slice.call(Lr)+"])"),En=2;St===If?En=3:St===$c&&(En=4),ie(Je,".uniformMatrix",En,"fv(",Ur,",false,",un,");")}else{switch(St){case ep:fe.commandType(Lr,"number","uniform "+st,Ee.commandStr),ve="1f";break;case tp:fe.command(lo(Lr)&&Lr.length===2,"uniform "+st,Ee.commandStr),ve="2f";break;case Hl:fe.command(lo(Lr)&&Lr.length===3,"uniform "+st,Ee.commandStr),ve="3f";break;case bl:fe.command(lo(Lr)&&Lr.length===4,"uniform "+st,Ee.commandStr),ve="4f";break;case Mf:fe.commandType(Lr,"boolean","uniform "+st,Ee.commandStr),ve="1i";break;case rp:fe.commandType(Lr,"number","uniform "+st,Ee.commandStr),ve="1i";break;case ip:fe.command(lo(Lr)&&Lr.length===2,"uniform "+st,Ee.commandStr),ve="2i";break;case Lp:fe.command(lo(Lr)&&Lr.length===2,"uniform "+st,Ee.commandStr),ve="2i";break;case Kc:fe.command(lo(Lr)&&Lr.length===3,"uniform "+st,Ee.commandStr),ve="3i";break;case Wl:fe.command(lo(Lr)&&Lr.length===3,"uniform "+st,Ee.commandStr),ve="3i";break;case Pf:fe.command(lo(Lr)&&Lr.length===4,"uniform "+st,Ee.commandStr),ve="4i";break;case np:fe.command(lo(Lr)&&Lr.length===4,"uniform "+st,Ee.commandStr),ve="4i";break}ie(Je,".uniform",ve,"(",Ur,",",lo(Lr)?Array.prototype.slice.call(Lr):Lr,");")}continue}else nn=cr.append(Ee,ie)}else{if(!Pt(ed))continue;nn=ie.def(De.uniforms,"[",ce.id(st),"]")}St===ap?(fe(!Array.isArray(nn),"must specify a scalar prop for textures"),ie("if(",nn,"&&",nn,'._reglType==="framebuffer"){',nn,"=",nn,".color[0];","}")):St===op&&(fe(!Array.isArray(nn),"must specify a scalar prop for cube maps"),ie("if(",nn,"&&",nn,'._reglType==="framebufferCube"){',nn,"=",nn,".color[0];","}")),fe.optional(function(){function Zs(Zu,nf){Ee.assert(ie,Zu,'bad data or missing for uniform "'+st+'".  '+nf)}function Cl(Zu){fe(!Array.isArray(nn),"must not specify an array type for uniform"),Zs("typeof "+nn+'==="'+Zu+'"',"invalid type, expected "+Zu)}function Uu(Zu,nf){Array.isArray(nn)?fe(nn.length===Zu,"must have length "+Zu):Zs(De.isArrayLike+"("+nn+")&&"+nn+".length==="+Zu,"invalid vector, should have length "+Zu,Ee.commandStr)}function rd(Zu){fe(!Array.isArray(nn),"must not specify a value type"),Zs("typeof "+nn+'==="function"&&'+nn+'._reglType==="texture'+(Zu===Yh?"2d":"Cube")+'"',"invalid texture type",Ee.commandStr)}switch(St){case rp:Cl("number");break;case Lp:Uu(2,"number");break;case Wl:Uu(3,"number");break;case np:Uu(4,"number");break;case ep:Cl("number");break;case tp:Uu(2,"number");break;case Hl:Uu(3,"number");break;case bl:Uu(4,"number");break;case Mf:Cl("boolean");break;case ip:Uu(2,"boolean");break;case Kc:Uu(3,"boolean");break;case Pf:Uu(4,"boolean");break;case zs:Uu(4,"number");break;case If:Uu(9,"number");break;case $c:Uu(16,"number");break;case ap:rd(Yh);break;case op:rd(ch);break}});var bn=1;switch(St){case ap:case op:var ln=ie.def(nn,"._texture");ie(Je,".uniform1i(",Ur,",",ln,".bind());"),ie.exit(ln,".unbind();");continue;case rp:case Mf:ve="1i";break;case Lp:case ip:ve="2i",bn=2;break;case Wl:case Kc:ve="3i",bn=3;break;case np:case Pf:ve="4i",bn=4;break;case ep:ve="1f";break;case tp:ve="2f",bn=2;break;case Hl:ve="3f",bn=3;break;case bl:ve="4f",bn=4;break;case zs:ve="Matrix2fv";break;case If:ve="Matrix3fv";break;case $c:ve="Matrix4fv";break}if(ve.charAt(0)==="M"){ie(Je,".uniform",ve,"(",Ur,",");var Jn=Math.pow(St-zs+2,2),Ea=Ee.global.def("new Float32Array(",Jn,")");Array.isArray(nn)?ie("false,(",Ge(Jn,function(Zs){return Ea+"["+Zs+"]="+nn[Zs]}),",",Ea,")"):ie("false,(Array.isArray(",nn,")||",nn," instanceof Float32Array)?",nn,":(",Ge(Jn,function(Zs){return Ea+"["+Zs+"]="+nn+"["+Zs+"]"}),",",Ea,")"),ie(");")}else if(bn>1){for(var ss=[],Va=[],ya=0;ya<bn;++ya)Array.isArray(nn)?Va.push(nn[ya]):Va.push(ie.def(nn+"["+ya+"]")),Xe&&ss.push(ie.def());Xe&&ie("if(!",Ee.batchId,"||",ss.map(function(Zs,Cl){return Zs+"!=="+Va[Cl]}).join("||"),"){",ss.map(function(Zs,Cl){return Zs+"="+Va[Cl]+";"}).join("")),ie(Je,".uniform",ve,"(",Ur,",",Va.join(","),");"),Xe&&ie("}")}else{if(fe(!Array.isArray(nn),"uniform value must not be an array"),Xe){var ql=ie.def();ie("if(!",Ee.batchId,"||",ql,"!==",nn,"){",ql,"=",nn,";")}ie(Je,".uniform",ve,"(",Ur,",",nn,");"),Xe&&ie("}")}}}function No(Ee,ie,Ve,ot){var Pt=Ee.shared,Xe=Pt.gl,De=Pt.draw,Je=ot.draw;function ve(){var bn=Je.elements,ln,Jn=ie;return bn?((bn.contextDep&&ot.contextDynamic||bn.propDep)&&(Jn=Ve),ln=bn.append(Ee,Jn),Je.elementsActive&&Jn("if("+ln+")"+Xe+".bindBuffer("+Rp+","+ln+".buffer.buffer);")):(ln=Jn.def(),Jn(ln,"=",De,".",iu,";","if(",ln,"){",Xe,".bindBuffer(",Rp,",",ln,".buffer.buffer);}","else if(",Pt.vao,".currentVAO){",ln,"=",Ee.shared.elements+".getElements("+Pt.vao,".currentVAO.elements);",ur?"":"if("+ln+")"+Xe+".bindBuffer("+Rp+","+ln+".buffer.buffer);","}")),ln}function Ze(){var bn=Je.count,ln,Jn=ie;return bn?((bn.contextDep&&ot.contextDynamic||bn.propDep)&&(Jn=Ve),ln=bn.append(Ee,Jn),fe.optional(function(){bn.MISSING&&Ee.assert(ie,"false","missing vertex count"),bn.DYNAMIC&&Ee.assert(Jn,ln+">=0","missing vertex count")})):(ln=Jn.def(De,".",Xc),fe.optional(function(){Ee.assert(Jn,ln+">=0","missing vertex count")})),ln}var Ae=ve();function st(bn){var ln=Je[bn];return ln?ln.contextDep&&ot.contextDynamic||ln.propDep?ln.append(Ee,Ve):ln.append(Ee,ie):ie.def(De,".",bn)}var St=st(Fo),cr=st(Kf),zr=Ze();if(typeof zr=="number"){if(zr===0)return}else Ve("if(",zr,"){"),Ve.exit("}");var Ur,nn;xr&&(Ur=st(Ip),nn=Ee.instancing);var Lr=Ae+".type",An=Je.elements&&yc(Je.elements)&&!Je.vaoActive;function un(){function bn(){Ve(nn,".drawElementsInstancedANGLE(",[St,zr,Lr,cr+"<<(("+Lr+"-"+Kn+")>>1)",Ur],");")}function ln(){Ve(nn,".drawArraysInstancedANGLE(",[St,cr,zr,Ur],");")}Ae&&Ae!=="null"?An?bn():(Ve("if(",Ae,"){"),bn(),Ve("}else{"),ln(),Ve("}")):ln()}function En(){function bn(){Ve(Xe+".drawElements("+[St,zr,Lr,cr+"<<(("+Lr+"-"+Kn+")>>1)"]+");")}function ln(){Ve(Xe+".drawArrays("+[St,cr,zr]+");")}Ae&&Ae!=="null"?An?bn():(Ve("if(",Ae,"){"),bn(),Ve("}else{"),ln(),Ve("}")):ln()}xr&&(typeof Ur!="number"||Ur>=0)?typeof Ur=="string"?(Ve("if(",Ur,">0){"),un(),Ve("}else if(",Ur,"<0){"),En(),Ve("}")):un():En()}function ti(Ee,ie,Ve,ot,Pt){var Xe=ii(),De=Xe.proc("body",Pt);return fe.optional(function(){Xe.commandStr=ie.commandStr,Xe.command=Xe.link(ie.commandStr)}),xr&&(Xe.instancing=De.def(Xe.shared.extensions,".angle_instanced_arrays")),Ee(Xe,De,Ve,ot),Xe.compile().body}function Ni(Ee,ie,Ve,ot){po(Ee,ie),Ve.useVAO?Ve.drawVAO?ie(Ee.shared.vao,".setVAO(",Ve.drawVAO.append(Ee,ie),");"):ie(Ee.shared.vao,".setVAO(",Ee.shared.vao,".targetVAO);"):(ie(Ee.shared.vao,".setVAO(null);"),Oo(Ee,ie,Ve,ot.attributes,function(){return!0})),Qi(Ee,ie,Ve,ot.uniforms,function(){return!0},!1),No(Ee,ie,ie,Ve)}function va(Ee,ie){var Ve=Ee.proc("draw",1);po(Ee,Ve),So(Ee,Ve,ie.context),Ho(Ee,Ve,ie.framebuffer),Io(Ee,Ve,ie),os(Ee,Ve,ie.state),gi(Ee,Ve,ie,!1,!0);var ot=ie.shader.progVar.append(Ee,Ve);if(Ve(Ee.shared.gl,".useProgram(",ot,".program);"),ie.shader.program)Ni(Ee,Ve,ie,ie.shader.program);else{Ve(Ee.shared.vao,".setVAO(null);");var Pt=Ee.global.def("{}"),Xe=Ve.def(ot,".id"),De=Ve.def(Pt,"[",Xe,"]");Ve(Ee.cond(De).then(De,".call(this,a0);").else(De,"=",Pt,"[",Xe,"]=",Ee.link(function(Je){return ti(Ni,Ee,ie,Je,1)}),"(",ot,");",De,".call(this,a0);"))}Object.keys(ie.state).length>0&&Ve(Ee.shared.current,".dirty=true;"),Ee.shared.vao&&Ve(Ee.shared.vao,".setVAO(null);")}function Bn(Ee,ie,Ve,ot){Ee.batchId="a1",po(Ee,ie);function Pt(){return!0}Oo(Ee,ie,Ve,ot.attributes,Pt),Qi(Ee,ie,Ve,ot.uniforms,Pt,!1),No(Ee,ie,ie,Ve)}function ai(Ee,ie,Ve,ot){po(Ee,ie);var Pt=Ve.contextDep,Xe=ie.def(),De="a0",Je="a1",ve=ie.def();Ee.shared.props=ve,Ee.batchId=Xe;var Ze=Ee.scope(),Ae=Ee.scope();ie(Ze.entry,"for(",Xe,"=0;",Xe,"<",Je,";++",Xe,"){",ve,"=",De,"[",Xe,"];",Ae,"}",Ze.exit);function st(Lr){return Lr.contextDep&&Pt||Lr.propDep}function St(Lr){return!st(Lr)}if(Ve.needsContext&&So(Ee,Ae,Ve.context),Ve.needsFramebuffer&&Ho(Ee,Ae,Ve.framebuffer),os(Ee,Ae,Ve.state,st),Ve.profile&&st(Ve.profile)&&gi(Ee,Ae,Ve,!1,!0),ot)Ve.useVAO?Ve.drawVAO?st(Ve.drawVAO)?Ae(Ee.shared.vao,".setVAO(",Ve.drawVAO.append(Ee,Ae),");"):Ze(Ee.shared.vao,".setVAO(",Ve.drawVAO.append(Ee,Ze),");"):Ze(Ee.shared.vao,".setVAO(",Ee.shared.vao,".targetVAO);"):(Ze(Ee.shared.vao,".setVAO(null);"),Oo(Ee,Ze,Ve,ot.attributes,St),Oo(Ee,Ae,Ve,ot.attributes,st)),Qi(Ee,Ze,Ve,ot.uniforms,St,!1),Qi(Ee,Ae,Ve,ot.uniforms,st,!0),No(Ee,Ze,Ae,Ve);else{var cr=Ee.global.def("{}"),zr=Ve.shader.progVar.append(Ee,Ae),Ur=Ae.def(zr,".id"),nn=Ae.def(cr,"[",Ur,"]");Ae(Ee.shared.gl,".useProgram(",zr,".program);","if(!",nn,"){",nn,"=",cr,"[",Ur,"]=",Ee.link(function(Lr){return ti(Bn,Ee,Ve,Lr,2)}),"(",zr,");}",nn,".call(this,a0[",Xe,"],",Xe,");")}}function we(Ee,ie){var Ve=Ee.proc("batch",2);Ee.batchId="0",po(Ee,Ve);var ot=!1,Pt=!0;Object.keys(ie.context).forEach(function(cr){ot=ot||ie.context[cr].propDep}),ot||(So(Ee,Ve,ie.context),Pt=!1);var Xe=ie.framebuffer,De=!1;Xe?(Xe.propDep?ot=De=!0:Xe.contextDep&&ot&&(De=!0),De||Ho(Ee,Ve,Xe)):Ho(Ee,Ve,null),ie.state.viewport&&ie.state.viewport.propDep&&(ot=!0);function Je(cr){return cr.contextDep&&ot||cr.propDep}Io(Ee,Ve,ie),os(Ee,Ve,ie.state,function(cr){return!Je(cr)}),(!ie.profile||!Je(ie.profile))&&gi(Ee,Ve,ie,!1,"a1"),ie.contextDep=ot,ie.needsContext=Pt,ie.needsFramebuffer=De;var ve=ie.shader.progVar;if(ve.contextDep&&ot||ve.propDep)ai(Ee,Ve,ie,null);else{var Ze=ve.append(Ee,Ve);if(Ve(Ee.shared.gl,".useProgram(",Ze,".program);"),ie.shader.program)ai(Ee,Ve,ie,ie.shader.program);else{Ve(Ee.shared.vao,".setVAO(null);");var Ae=Ee.global.def("{}"),st=Ve.def(Ze,".id"),St=Ve.def(Ae,"[",st,"]");Ve(Ee.cond(St).then(St,".call(this,a0,a1);").else(St,"=",Ae,"[",st,"]=",Ee.link(function(cr){return ti(ai,Ee,ie,cr,2)}),"(",Ze,");",St,".call(this,a0,a1);"))}}Object.keys(ie.state).length>0&&Ve(Ee.shared.current,".dirty=true;"),Ee.shared.vao&&Ve(Ee.shared.vao,".setVAO(null);")}function Nt(Ee,ie){var Ve=Ee.proc("scope",3);Ee.batchId="a2";var ot=Ee.shared,Pt=ot.current;So(Ee,Ve,ie.context),ie.framebuffer&&ie.framebuffer.append(Ee,Ve),Ia(Object.keys(ie.state)).forEach(function(De){var Je=ie.state[De],ve=Je.append(Ee,Ve);lo(ve)?ve.forEach(function(Ze,Ae){Ve.set(Ee.next[De],"["+Ae+"]",Ze)}):Ve.set(ot.next,"."+De,ve)}),gi(Ee,Ve,ie,!0,!0),[iu,Kf,Xc,Ip,Fo].forEach(function(De){var Je=ie.draw[De];!Je||Ve.set(ot.draw,"."+De,""+Je.append(Ee,Ve))}),Object.keys(ie.uniforms).forEach(function(De){var Je=ie.uniforms[De].append(Ee,Ve);Array.isArray(Je)&&(Je="["+Je.join()+"]"),Ve.set(ot.uniforms,"["+ce.id(De)+"]",Je)}),Object.keys(ie.attributes).forEach(function(De){var Je=ie.attributes[De].append(Ee,Ve),ve=Ee.scopeAttrib(De);Object.keys(new nt).forEach(function(Ze){Ve.set(ve,"."+Ze,Je[Ze])})}),ie.scopeVAO&&Ve.set(ot.vao,".targetVAO",ie.scopeVAO.append(Ee,Ve));function Xe(De){var Je=ie.shader[De];Je&&Ve.set(ot.shader,"."+De,Je.append(Ee,Ve))}Xe(_l),Xe(dc),Object.keys(ie.state).length>0&&(Ve(Pt,".dirty=true;"),Ve.exit(Pt,".dirty=true;")),Ve("a1(",Ee.shared.context,",a0,",Ee.batchId,");")}function bt(Ee){if(!(typeof Ee!="object"||lo(Ee))){for(var ie=Object.keys(Ee),Ve=0;Ve<ie.length;++Ve)if(Sn.isDynamic(Ee[ie[Ve]]))return!0;return!1}}function dn(Ee,ie,Ve){var ot=ie.static[Ve];if(!ot||!bt(ot))return;var Pt=Ee.global,Xe=Object.keys(ot),De=!1,Je=!1,ve=!1,Ze=Ee.global.def("{}");Xe.forEach(function(st){var St=ot[st];if(Sn.isDynamic(St)){typeof St=="function"&&(St=ot[st]=Sn.unbox(St));var cr=Us(St,null);De=De||cr.thisDep,ve=ve||cr.propDep,Je=Je||cr.contextDep}else{switch(Pt(Ze,".",st,"="),typeof St){case"number":Pt(St);break;case"string":Pt('"',St,'"');break;case"object":Array.isArray(St)&&Pt("[",St.join(),"]");break;default:Pt(Ee.link(St));break}Pt(";")}});function Ae(st,St){Xe.forEach(function(cr){var zr=ot[cr];if(!!Sn.isDynamic(zr)){var Ur=st.invoke(St,zr);St(Ze,".",cr,"=",Ur,";")}})}ie.dynamic[Ve]=new Sn.DynamicVariable(To,{thisDep:De,contextDep:Je,propDep:ve,ref:Ze,append:Ae}),delete ie.static[Ve]}function Vi(Ee,ie,Ve,ot,Pt){var Xe=ii();Xe.stats=Xe.link(Pt),Object.keys(ie.static).forEach(function(Je){dn(Xe,ie,Je)}),wd.forEach(function(Je){dn(Xe,Ee,Je)});var De=Bo(Ee,ie,Ve,ot,Xe);return va(Xe,De),Nt(Xe,De),we(Xe,De),m(Xe.compile(),{destroy:function(){De.shader.program.destroy()}})}return{next:$r,current:Or,procs:function(){var Ee=ii(),ie=Ee.proc("poll"),Ve=Ee.proc("refresh"),ot=Ee.block();ie(ot),Ve(ot);var Pt=Ee.shared,Xe=Pt.gl,De=Pt.next,Je=Pt.current;ot(Je,".dirty=false;"),Ho(Ee,ie),Ho(Ee,Ve,null,!0);var ve;xr&&(ve=Ee.link(xr)),Fe.oes_vertex_array_object&&Ve(Ee.link(Fe.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var Ze=0;Ze<Lt.maxAttributes;++Ze){var Ae=Ve.def(Pt.attributes,"[",Ze,"]"),st=Ee.cond(Ae,".buffer");st.then(Xe,".enableVertexAttribArray(",Ze,");",Xe,".bindBuffer(",qc,",",Ae,".buffer.buffer);",Xe,".vertexAttribPointer(",Ze,",",Ae,".size,",Ae,".type,",Ae,".normalized,",Ae,".stride,",Ae,".offset);").else(Xe,".disableVertexAttribArray(",Ze,");",Xe,".vertexAttrib4f(",Ze,",",Ae,".x,",Ae,".y,",Ae,".z,",Ae,".w);",Ae,".buffer=null;"),Ve(st),xr&&Ve(ve,".vertexAttribDivisorANGLE(",Ze,",",Ae,".divisor);")}return Ve(Ee.shared.vao,".currentVAO=null;",Ee.shared.vao,".setVAO(",Ee.shared.vao,".targetVAO);"),Object.keys(Jt).forEach(function(St){var cr=Jt[St],zr=ot.def(De,".",St),Ur=Ee.block();Ur("if(",zr,"){",Xe,".enable(",cr,")}else{",Xe,".disable(",cr,")}",Je,".",St,"=",zr,";"),Ve(Ur),ie("if(",zr,"!==",Je,".",St,"){",Ur,"}")}),Object.keys(tr).forEach(function(St){var cr=tr[St],zr=Or[St],Ur,nn,Lr=Ee.block();if(Lr(Xe,".",cr,"("),lo(zr)){var An=zr.length;Ur=Ee.global.def(De,".",St),nn=Ee.global.def(Je,".",St),Lr(Ge(An,function(un){return Ur+"["+un+"]"}),");",Ge(An,function(un){return nn+"["+un+"]="+Ur+"["+un+"];"}).join("")),ie("if(",Ge(An,function(un){return Ur+"["+un+"]!=="+nn+"["+un+"]"}).join("||"),"){",Lr,"}")}else Ur=ot.def(De,".",St),nn=ot.def(Je,".",St),Lr(Ur,");",Je,".",St,"=",Ur,";"),ie("if(",Ur,"!==",nn,"){",Lr,"}");Ve(Lr)}),Ee.compile()}(),compile:Vi}}function Od(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var zp=34918,Rd=34919,vh=35007,Sl=function(N,ce){if(!ce.ext_disjoint_timer_query)return null;var Fe=[];function Lt(){return Fe.pop()||ce.ext_disjoint_timer_query.createQueryEXT()}function rr(xr){Fe.push(xr)}var Ot=[];function Qt(xr){var Nr=Lt();ce.ext_disjoint_timer_query.beginQueryEXT(vh,Nr),Ot.push(Nr),mr(Ot.length-1,Ot.length,xr)}function lr(){ce.ext_disjoint_timer_query.endQueryEXT(vh)}function dr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var _r=[];function Ar(){return _r.pop()||new dr}function wr(xr){_r.push(xr)}var jr=[];function mr(xr,Nr,ur){var Or=Ar();Or.startQueryIndex=xr,Or.endQueryIndex=Nr,Or.sum=0,Or.stats=ur,jr.push(Or)}var Cr=[],nt=[];function jt(){var xr,Nr,ur=Ot.length;if(ur!==0){nt.length=Math.max(nt.length,ur+1),Cr.length=Math.max(Cr.length,ur+1),Cr[0]=0,nt[0]=0;var Or=0;for(xr=0,Nr=0;Nr<Ot.length;++Nr){var $r=Ot[Nr];ce.ext_disjoint_timer_query.getQueryObjectEXT($r,Rd)?(Or+=ce.ext_disjoint_timer_query.getQueryObjectEXT($r,zp),rr($r)):Ot[xr++]=$r,Cr[Nr+1]=Or,nt[Nr+1]=xr}for(Ot.length=xr,xr=0,Nr=0;Nr<jr.length;++Nr){var Fn=jr[Nr],Jt=Fn.startQueryIndex,tr=Fn.endQueryIndex;Fn.sum+=Cr[tr]-Cr[Jt];var xn=nt[Jt],Vr=nt[tr];Vr===xn?(Fn.stats.gpuTime+=Fn.sum/1e6,wr(Fn)):(Fn.startQueryIndex=xn,Fn.endQueryIndex=Vr,jr[xr++]=Fn)}jr.length=xr}}return{beginQuery:Qt,endQuery:lr,pushScopeStats:mr,update:jt,getNumPendingQueries:function(){return Ot.length},clear:function(){Fe.push.apply(Fe,Ot);for(var xr=0;xr<Fe.length;xr++)ce.ext_disjoint_timer_query.deleteQueryEXT(Fe[xr]);Ot.length=0,Fe.length=0},restore:function(){Ot.length=0,Fe.length=0}}},sp=16384,Xl=256,td=1024,up=34962,rf="webglcontextlost",ba="webglcontextrestored",Up=1,Yl=2,Rf=3;function mh(N,ce){for(var Fe=0;Fe<N.length;++Fe)if(N[Fe]===ce)return Fe;return-1}function kd(N){var ce=he(N);if(!ce)return null;var Fe=ce.gl,Lt=Fe.getContextAttributes(),rr=Fe.isContextLost(),Ot=Me(Fe,ce);if(!Ot)return null;var Qt=hs(),lr=Od(),dr=Ot.extensions,_r=Sl(Fe,dr),Ar=io(),wr=Fe.drawingBufferWidth,jr=Fe.drawingBufferHeight,mr={tick:0,time:0,viewportWidth:wr,viewportHeight:jr,framebufferWidth:wr,framebufferHeight:jr,drawingBufferWidth:wr,drawingBufferHeight:jr,pixelRatio:ce.pixelRatio},Cr={},nt={elements:null,primitive:4,count:-1,offset:0,instances:-1},jt=Ml(Fe,dr),xr=B(Fe,lr,ce,Or),Nr=ol(Fe,dr,xr,lr),ur=vt(Fe,dr,jt,lr,xr,Nr,nt);function Or(ti){return ur.destroyBuffer(ti)}var $r=kr(Fe,Qt,lr,ce),Fn=bs(Fe,dr,jt,function(){xn.procs.poll()},mr,lr,ce),Jt=fc(Fe,dr,jt,lr,ce),tr=Oe(Fe,dr,jt,Fn,Jt,lr),xn=dh(Fe,Qt,dr,jt,xr,Nr,Fn,tr,Cr,ur,$r,nt,mr,_r,ce),Vr=Ln(Fe,tr,xn.procs.poll,mr,Lt,dr,jt),Sr=xn.next,qr=Fe.canvas,Kr=[],mi=[],ii=[],Hr=[ce.onDestroy],rn=null;function Qn(){if(Kr.length===0){_r&&_r.update(),rn=null;return}rn=Li.next(Qn),po();for(var ti=Kr.length-1;ti>=0;--ti){var Ni=Kr[ti];Ni&&Ni(mr,null,0)}Fe.flush(),_r&&_r.update()}function ci(){!rn&&Kr.length>0&&(rn=Li.next(Qn))}function Bi(){rn&&(Li.cancel(Qn),rn=null)}function oo(ti){ti.preventDefault(),rr=!0,Bi(),mi.forEach(function(Ni){Ni()})}function so(ti){Fe.getError(),rr=!1,Ot.restore(),$r.restore(),xr.restore(),Fn.restore(),Jt.restore(),tr.restore(),ur.restore(),_r&&_r.restore(),xn.procs.refresh(),ci(),ii.forEach(function(Ni){Ni()})}var Di=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;!Di&&qr&&(qr.addEventListener(rf,oo,!1),qr.addEventListener(ba,so,!1));function Jo(){Kr.length=0,Bi(),!Di&&qr&&(qr.removeEventListener(rf,oo),qr.removeEventListener(ba,so)),$r.clear(),tr.clear(),Jt.clear(),ur.clear(),Fn.clear(),Nr.clear(),xr.clear(),_r&&_r.clear(),Hr.forEach(function(ti){ti()})}function ja(ti){fe(!!ti,"invalid args to regl({...})"),fe.type(ti,"object","invalid args to regl({...})");function Ni(Xe){var De=m({},Xe);delete De.uniforms,delete De.attributes,delete De.context,delete De.vao,"stencil"in De&&De.stencil.op&&(De.stencil.opBack=De.stencil.opFront=De.stencil.op,delete De.stencil.op);function Je(ve){if(ve in De){var Ze=De[ve];delete De[ve],Object.keys(Ze).forEach(function(Ae){De[ve+"."+Ae]=Ze[Ae]})}}return Je("blend"),Je("depth"),Je("cull"),Je("stencil"),Je("polygonOffset"),Je("scissor"),Je("sample"),"vao"in Xe&&(De.vao=Xe.vao),De}function va(Xe,De){var Je={},ve={};return Object.keys(Xe).forEach(function(Ze){var Ae=Xe[Ze];if(Sn.isDynamic(Ae)){ve[Ze]=Sn.unbox(Ae,Ze);return}else if(De&&Array.isArray(Ae)){for(var st=0;st<Ae.length;++st)if(Sn.isDynamic(Ae[st])){ve[Ze]=Sn.unbox(Ae,Ze);return}}Je[Ze]=Ae}),{dynamic:ve,static:Je}}var Bn=va(ti.context||{},!0),ai=va(ti.uniforms||{},!0),we=va(ti.attributes||{},!1),Nt=va(Ni(ti),!1),bt={gpuTime:0,cpuTime:0,count:0},dn=xn.compile(Nt,we,ai,Bn,bt),Vi=dn.draw,Ee=dn.batch,ie=dn.scope,Ve=[];function ot(Xe){for(;Ve.length<Xe;)Ve.push(null);return Ve}function Pt(Xe,De){var Je;if(rr&&fe.raise("context lost"),typeof Xe=="function")return ie.call(this,null,Xe,0);if(typeof De=="function")if(typeof Xe=="number")for(Je=0;Je<Xe;++Je)ie.call(this,null,De,Je);else if(Array.isArray(Xe))for(Je=0;Je<Xe.length;++Je)ie.call(this,Xe[Je],De,Je);else return ie.call(this,Xe,De,0);else if(typeof Xe=="number"){if(Xe>0)return Ee.call(this,ot(Xe|0),Xe|0)}else if(Array.isArray(Xe)){if(Xe.length)return Ee.call(this,Xe,Xe.length)}else return Vi.call(this,Xe)}return m(Pt,{stats:bt,destroy:function(){dn.destroy()}})}var Bo=tr.setFBO=ja({framebuffer:Sn.define.call(null,Up,"framebuffer")});function So(ti,Ni){var va=0;xn.procs.poll();var Bn=Ni.color;Bn&&(Fe.clearColor(+Bn[0]||0,+Bn[1]||0,+Bn[2]||0,+Bn[3]||0),va|=sp),"depth"in Ni&&(Fe.clearDepth(+Ni.depth),va|=Xl),"stencil"in Ni&&(Fe.clearStencil(Ni.stencil|0),va|=td),fe(!!va,"called regl.clear with no buffer specified"),Fe.clear(va)}function Ho(ti){if(fe(typeof ti=="object"&&ti,"regl.clear() takes an object as input"),"framebuffer"in ti)if(ti.framebuffer&&ti.framebuffer_reglType==="framebufferCube")for(var Ni=0;Ni<6;++Ni)Bo(m({framebuffer:ti.framebuffer.faces[Ni]},ti),So);else Bo(ti,So);else So(null,ti)}function Io(ti){fe.type(ti,"function","regl.frame() callback must be a function"),Kr.push(ti);function Ni(){var va=mh(Kr,ti);fe(va>=0,"cannot cancel a frame twice");function Bn(){var ai=mh(Kr,Bn);Kr[ai]=Kr[Kr.length-1],Kr.length-=1,Kr.length<=0&&Bi()}Kr[va]=Bn}return ci(),{cancel:Ni}}function os(){var ti=Sr.viewport,Ni=Sr.scissor_box;ti[0]=ti[1]=Ni[0]=Ni[1]=0,mr.viewportWidth=mr.framebufferWidth=mr.drawingBufferWidth=ti[2]=Ni[2]=Fe.drawingBufferWidth,mr.viewportHeight=mr.framebufferHeight=mr.drawingBufferHeight=ti[3]=Ni[3]=Fe.drawingBufferHeight}function po(){mr.tick+=1,mr.time=Oo(),os(),xn.procs.poll()}function gi(){Fn.refresh(),os(),xn.procs.refresh(),_r&&_r.update()}function Oo(){return(io()-Ar)/1e3}gi();function Qi(ti,Ni){fe.type(Ni,"function","listener callback must be a function");var va;switch(ti){case"frame":return Io(Ni);case"lost":va=mi;break;case"restore":va=ii;break;case"destroy":va=Hr;break;default:fe.raise("invalid event, must be one of frame,lost,restore,destroy")}return va.push(Ni),{cancel:function(){for(var Bn=0;Bn<va.length;++Bn)if(va[Bn]===Ni){va[Bn]=va[va.length-1],va.pop();return}}}}var No=m(ja,{clear:Ho,prop:Sn.define.bind(null,Up),context:Sn.define.bind(null,Yl),this:Sn.define.bind(null,Rf),draw:ja({}),buffer:function(ti){return xr.create(ti,up,!1,!1)},elements:function(ti){return Nr.create(ti,!1)},texture:Fn.create2D,cube:Fn.createCube,renderbuffer:Jt.create,framebuffer:tr.create,framebufferCube:tr.createCube,vao:ur.createVAO,attributes:Lt,frame:Io,on:Qi,limits:jt,hasExtension:function(ti){return jt.extensions.indexOf(ti.toLowerCase())>=0},read:Vr,destroy:Jo,_gl:Fe,_refresh:gi,poll:function(){po(),_r&&_r.update()},now:Oo,stats:lr});return ce.onDone(null,No),No}return kd})},49029:function(Er){var re=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function Q(Ce){return Ce.match(re)||[]}Er.exports=Q},29750:function(Er){function re(Q,Ce,me){return Q===Q&&(me!==void 0&&(Q=Q<=me?Q:me),Ce!==void 0&&(Q=Q>=Ce?Q:Ce)),Q}Er.exports=re},18674:function(Er){function re(Q){return function(Ce){return Q==null?void 0:Q[Ce]}}Er.exports=re},98805:function(Er,re,Q){var Ce=Q(40180),me=Q(62689),m=Q(83140),Re=Q(79833);function W(pe){return function(de){de=Re(de);var ze=me(de)?m(de):void 0,_e=ze?ze[0]:de.charAt(0),et=ze?Ce(ze,1).join(""):de.slice(1);return _e[pe]()+et}}Er.exports=W},35393:function(Er,re,Q){var Ce=Q(62663),me=Q(53816),m=Q(58748),Re="['\u2019]",W=RegExp(Re,"g");function pe(de){return function(ze){return Ce(m(me(ze).replace(W,"")),de,"")}}Er.exports=pe},69389:function(Er,re,Q){var Ce=Q(18674),me={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},m=Ce(me);Er.exports=m},93157:function(Er){var re=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function Q(Ce){return re.test(Ce)}Er.exports=Q},2757:function(Er){var re="\\ud800-\\udfff",Q="\\u0300-\\u036f",Ce="\\ufe20-\\ufe2f",me="\\u20d0-\\u20ff",m=Q+Ce+me,Re="\\u2700-\\u27bf",W="a-z\\xdf-\\xf6\\xf8-\\xff",pe="\\xac\\xb1\\xd7\\xf7",de="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",ze="\\u2000-\\u206f",_e=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",et="A-Z\\xc0-\\xd6\\xd8-\\xde",mt="\\ufe0e\\ufe0f",Ct=pe+de+ze+_e,Bt="['\u2019]",or="["+Ct+"]",At="["+m+"]",Kt="\\d+",yt="["+Re+"]",ct="["+W+"]",it="[^"+re+Ct+Kt+Re+W+et+"]",$t="\\ud83c[\\udffb-\\udfff]",X="(?:"+At+"|"+$t+")",Xt="[^"+re+"]",at="(?:\\ud83c[\\udde6-\\uddff]){2}",qe="[\\ud800-\\udbff][\\udc00-\\udfff]",xt="["+et+"]",$e="\\u200d",Ht="(?:"+ct+"|"+it+")",vr="(?:"+xt+"|"+it+")",Fr="(?:"+Bt+"(?:d|ll|m|re|s|t|ve))?",Yr="(?:"+Bt+"(?:D|LL|M|RE|S|T|VE))?",A=X+"?",Se="["+mt+"]?",ke="(?:"+$e+"(?:"+[Xt,at,qe].join("|")+")"+Se+A+")*",ut="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",ft="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Rt=Se+A+ke,Dt="(?:"+[yt,at,qe].join("|")+")"+Rt,gr=RegExp([xt+"?"+ct+"+"+Fr+"(?="+[or,xt,"$"].join("|")+")",vr+"+"+Yr+"(?="+[or,xt+Ht,"$"].join("|")+")",xt+"?"+Ht+"+"+Fr,xt+"+"+Yr,ft,ut,Kt,Dt].join("|"),"g");function Yn(Gr){return Gr.match(gr)||[]}Er.exports=Yn},68929:function(Er,re,Q){var Ce=Q(48403),me=Q(35393),m=me(function(Re,W,pe){return W=W.toLowerCase(),Re+(pe?Ce(W):W)});Er.exports=m},48403:function(Er,re,Q){var Ce=Q(79833),me=Q(11700);function m(Re){return me(Ce(Re).toLowerCase())}Er.exports=m},74691:function(Er,re,Q){var Ce=Q(29750),me=Q(14841);function m(Re,W,pe){return pe===void 0&&(pe=W,W=void 0),pe!==void 0&&(pe=me(pe),pe=pe===pe?pe:0),W!==void 0&&(W=me(W),W=W===W?W:0),Ce(me(Re),W,pe)}Er.exports=m},53816:function(Er,re,Q){var Ce=Q(69389),me=Q(79833),m=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Re="\\u0300-\\u036f",W="\\ufe20-\\ufe2f",pe="\\u20d0-\\u20ff",de=Re+W+pe,ze="["+de+"]",_e=RegExp(ze,"g");function et(mt){return mt=me(mt),mt&&mt.replace(m,Ce).replace(_e,"")}Er.exports=et},14293:function(Er){function re(Q){return Q==null}Er.exports=re},81763:function(Er,re,Q){var Ce=Q(44239),me=Q(37005),m="[object Number]";function Re(W){return typeof W=="number"||me(W)&&Ce(W)==m}Er.exports=Re},30236:function(Er,re,Q){var Ce=Q(42980),me=Q(21463),m=me(function(Re,W,pe,de){Ce(Re,W,pe,de)});Er.exports=m},44908:function(Er,re,Q){var Ce=Q(45652);function me(m){return m&&m.length?Ce(m):[]}Er.exports=me},11700:function(Er,re,Q){var Ce=Q(98805),me=Ce("toUpperCase");Er.exports=me},58748:function(Er,re,Q){var Ce=Q(49029),me=Q(93157),m=Q(79833),Re=Q(2757);function W(pe,de,ze){return pe=m(pe),de=ze?void 0:de,de===void 0?me(pe)?Re(pe):Ce(pe):pe.match(de)||[]}Er.exports=W},6158:function(Er){(function(re,Q){Er.exports=Q()})(this,function(){"use strict";var re,Q,Ce;function me(m,Re){if(!re)re=Re;else if(!Q)Q=Re;else{var W="var sharedChunk = {}; ("+re+")(sharedChunk); ("+Q+")(sharedChunk);",pe={};re(pe),Ce=Re(pe),typeof window!="undefined"&&(Ce.workerUrl=window.URL.createObjectURL(new Blob([W],{type:"text/javascript"})))}}return me(["exports"],function(m){"use strict";function Re(t,o){return t(o={exports:{}},o.exports),o.exports}var W=pe;function pe(t,o,u,h){this.cx=3*t,this.bx=3*(u-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(h-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=h,this.p2x=u,this.p2y=h}pe.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},pe.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},pe.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},pe.prototype.solveCurveX=function(t,o){var u,h,y,b,S;for(o===void 0&&(o=1e-6),y=t,S=0;S<8;S++){if(b=this.sampleCurveX(y)-t,Math.abs(b)<o)return y;var I=this.sampleCurveDerivativeX(y);if(Math.abs(I)<1e-6)break;y-=b/I}if((y=t)<(u=0))return u;if(y>(h=1))return h;for(;u<h;){if(b=this.sampleCurveX(y),Math.abs(b-t)<o)return y;t>b?u=y:h=y,y=.5*(h-u)+u}return y},pe.prototype.solve=function(t,o){return this.sampleCurveY(this.solveCurveX(t,o))};var de=ze;function ze(t,o){this.x=t,this.y=o}ze.prototype={clone:function(){return new ze(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,o){return this.clone()._rotateAround(t,o)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var o=t.x-this.x,u=t.y-this.y;return o*o+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,o){return Math.atan2(this.x*o-this.y*t,this.x*t+this.y*o)},_matMult:function(t){var o=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=o,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var o=Math.cos(t),u=Math.sin(t),h=u*this.x+o*this.y;return this.x=o*this.x-u*this.y,this.y=h,this},_rotateAround:function(t,o){var u=Math.cos(t),h=Math.sin(t),y=o.y+h*(this.x-o.x)+u*(this.y-o.y);return this.x=o.x+u*(this.x-o.x)-h*(this.y-o.y),this.y=y,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ze.convert=function(t){return t instanceof ze?t:Array.isArray(t)?new ze(t[0],t[1]):t};var _e=typeof self!="undefined"?self:{},et=Math.pow(2,53)-1;function mt(t,o,u,h){var y=new W(t,o,u,h);return function(b){return y.solve(b)}}var Ct=mt(.25,.1,.25,1);function Bt(t,o,u){return Math.min(u,Math.max(o,t))}function or(t,o,u){var h=u-o,y=((t-o)%h+h)%h+o;return y===o?u:y}function At(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];for(var h=0,y=o;h<y.length;h+=1){var b=y[h];for(var S in b)t[S]=b[S]}return t}var Kt=1;function yt(){return Kt++}function ct(){return function t(o){return o?(o^16*Math.random()>>o/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function it(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function $t(t,o){t.forEach(function(u){o[u]&&(o[u]=o[u].bind(o))})}function X(t,o){return t.indexOf(o,t.length-o.length)!==-1}function Xt(t,o,u){var h={};for(var y in t)h[y]=o.call(u||this,t[y],y,t);return h}function at(t,o,u){var h={};for(var y in t)o.call(u||this,t[y],y,t)&&(h[y]=t[y]);return h}function qe(t){return Array.isArray(t)?t.map(qe):typeof t=="object"&&t?Xt(t,qe):t}var xt={};function $e(t){xt[t]||(typeof console!="undefined"&&console.warn(t),xt[t]=!0)}function Ht(t,o,u){return(u.y-t.y)*(o.x-t.x)>(o.y-t.y)*(u.x-t.x)}function vr(t){for(var o=0,u=0,h=t.length,y=h-1,b=void 0,S=void 0;u<h;y=u++)o+=((S=t[y]).x-(b=t[u]).x)*(b.y+S.y);return o}function Fr(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Yr(t){var o={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(h,y,b,S){var I=b||S;return o[y]=!I||I.toLowerCase(),""}),o["max-age"]){var u=parseInt(o["max-age"],10);isNaN(u)?delete o["max-age"]:o["max-age"]=u}return o}var A=null;function Se(t){if(A==null){var o=t.navigator?t.navigator.userAgent:null;A=!!t.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return A}function ke(t){try{var o=_e[t];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch(u){return!1}}var ut,ft,Rt,Dt,gr=_e.performance&&_e.performance.now?_e.performance.now.bind(_e.performance):Date.now.bind(Date),Yn=_e.requestAnimationFrame||_e.mozRequestAnimationFrame||_e.webkitRequestAnimationFrame||_e.msRequestAnimationFrame,Gr=_e.cancelAnimationFrame||_e.mozCancelAnimationFrame||_e.webkitCancelAnimationFrame||_e.msCancelAnimationFrame,Nn={now:gr,frame:function(t){var o=Yn(t);return{cancel:function(){return Gr(o)}}},getImageData:function(t,o){o===void 0&&(o=0);var u=_e.document.createElement("canvas"),h=u.getContext("2d");if(!h)throw new Error("failed to create canvas 2d context");return u.width=t.width,u.height=t.height,h.drawImage(t,0,0,t.width,t.height),h.getImageData(-o,-o,t.width+2*o,t.height+2*o)},resolveURL:function(t){return ut||(ut=_e.document.createElement("a")),ut.href=t,ut.href},hardwareConcurrency:_e.navigator&&_e.navigator.hardwareConcurrency||4,get devicePixelRatio(){return _e.devicePixelRatio},get prefersReducedMotion(){return!!_e.matchMedia&&(ft==null&&(ft=_e.matchMedia("(prefers-reduced-motion: reduce)")),ft.matches)}},yn={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},zn={supported:!1,testSupport:function(t){!si&&Dt&&(Gn?fi(t):Rt=t)}},si=!1,Gn=!1;function fi(t){var o=t.createTexture();t.bindTexture(t.TEXTURE_2D,o);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Dt),t.isContextLost())return;zn.supported=!0}catch(u){}t.deleteTexture(o),si=!0}_e.document&&((Dt=_e.document.createElement("img")).onload=function(){Rt&&fi(Rt),Rt=null,Gn=!0},Dt.onerror=function(){si=!0,Rt=null},Dt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var ta="01",zi=function(t,o){this._transformRequestFn=t,this._customAccessToken=o,this._createSkuToken()};function Ii(t){return t.indexOf("mapbox:")===0}zi.prototype._createSkuToken=function(){var t=function(){for(var o="",u=0;u<10;u++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ta,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},zi.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},zi.prototype.transformRequest=function(t,o){return this._transformRequestFn&&this._transformRequestFn(t,o)||{url:t}},zi.prototype.normalizeStyleURL=function(t,o){if(!Ii(t))return t;var u=na(t);return u.path="/styles/v1"+u.path,this._makeAPIURL(u,this._customAccessToken||o)},zi.prototype.normalizeGlyphsURL=function(t,o){if(!Ii(t))return t;var u=na(t);return u.path="/fonts/v1"+u.path,this._makeAPIURL(u,this._customAccessToken||o)},zi.prototype.normalizeSourceURL=function(t,o){if(!Ii(t))return t;var u=na(t);return u.path="/v4/"+u.authority+".json",u.params.push("secure"),this._makeAPIURL(u,this._customAccessToken||o)},zi.prototype.normalizeSpriteURL=function(t,o,u,h){var y=na(t);return Ii(t)?(y.path="/styles/v1"+y.path+"/sprite"+o+u,this._makeAPIURL(y,this._customAccessToken||h)):(y.path+=""+o+u,ia(y))},zi.prototype.normalizeTileURL=function(t,o){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Ii(t))return t;var u=na(t);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,(Nn.devicePixelRatio>=2||o===512?"@2x":"")+(zn.supported?".webp":"$1")),u.path=u.path.replace(/^.+\/v4\//,"/"),u.path="/v4"+u.path;var h=this._customAccessToken||function(y){for(var b=0,S=y;b<S.length;b+=1){var I=S[b].match(/^access_token=(.*)$/);if(I)return I[1]}return null}(u.params)||yn.ACCESS_TOKEN;return yn.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&u.params.push("sku="+this._skuToken),this._makeAPIURL(u,h)},zi.prototype.canonicalizeTileURL=function(t,o){var u=na(t);if(!u.path.match(/(^\/v4\/)/)||!u.path.match(/\.[\w]+$/))return t;var h="mapbox://tiles/";h+=u.path.replace("/v4/","");var y=u.params;return o&&(y=y.filter(function(b){return!b.match(/^access_token=/)})),y.length&&(h+="?"+y.join("&")),h},zi.prototype.canonicalizeTileset=function(t,o){for(var u=!!o&&Ii(o),h=[],y=0,b=t.tiles||[];y<b.length;y+=1){var S=b[y];ra(S)?h.push(this.canonicalizeTileURL(S,u)):h.push(S)}return h},zi.prototype._makeAPIURL=function(t,o){var u="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",h=na(yn.API_URL);if(t.protocol=h.protocol,t.authority=h.authority,t.protocol==="http"){var y=t.params.indexOf("secure");y>=0&&t.params.splice(y,1)}if(h.path!=="/"&&(t.path=""+h.path+t.path),!yn.REQUIRE_ACCESS_TOKEN)return ia(t);if(!(o=o||yn.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+u);if(o[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+u);return t.params=t.params.filter(function(b){return b.indexOf("access_token")===-1}),t.params.push("access_token="+o),ia(t)};var Ki=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function ra(t){return Ki.test(t)}var Ya=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function na(t){var o=t.match(Ya);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function ia(t){var o=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+o}function ki(t){if(!t)return null;var o=t.split(".");if(!o||o.length!==3)return null;try{return JSON.parse(decodeURIComponent(_e.atob(o[1]).split("").map(function(u){return"%"+("00"+u.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(u){return null}}var qi=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};qi.prototype.getStorageKey=function(t){var o,u=ki(yn.ACCESS_TOKEN);return o=u&&u.u?_e.btoa(encodeURIComponent(u.u).replace(/%([0-9A-F]{2})/g,function(h,y){return String.fromCharCode(Number("0x"+y))})):yn.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+o:"mapbox.eventData:"+o},qi.prototype.fetchEventData=function(){var t=ke("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{var h=_e.localStorage.getItem(o);h&&(this.eventData=JSON.parse(h));var y=_e.localStorage.getItem(u);y&&(this.anonId=y)}catch(b){$e("Unable to read from LocalStorage")}},qi.prototype.saveEventData=function(){var t=ke("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{_e.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&_e.localStorage.setItem(o,JSON.stringify(this.eventData))}catch(h){$e("Unable to write to LocalStorage")}},qi.prototype.processRequests=function(t){},qi.prototype.postEvent=function(t,o,u,h){var y=this;if(yn.EVENTS_URL){var b=na(yn.EVENTS_URL);b.params.push("access_token="+(h||yn.ACCESS_TOKEN||""));var S={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:ta,userId:this.anonId},I=o?At(S,o):S,D={url:ia(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([I])};this.pendingRequest=xa(D,function(z){y.pendingRequest=null,u(z),y.saveEventData(),y.processRequests(h)})}},qi.prototype.queueRequest=function(t,o){this.queue.push(t),this.processRequests(o)};var Gi,Cs,fe=function(t){function o(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.postMapLoadEvent=function(u,h,y,b){this.skuToken=y,(yn.EVENTS_URL&&b||yn.ACCESS_TOKEN&&Array.isArray(u)&&u.some(function(S){return Ii(S)||ra(S)}))&&this.queueRequest({id:h,timestamp:Date.now()},b)},o.prototype.processRequests=function(u){var h=this;if(!this.pendingRequest&&this.queue.length!==0){var y=this.queue.shift(),b=y.id,S=y.timestamp;b&&this.success[b]||(this.anonId||this.fetchEventData(),it(this.anonId)||(this.anonId=ct()),this.postEvent(S,{skuToken:this.skuToken},function(I){I||b&&(h.success[b]=!0)},u))}},o}(qi),ui=new(function(t){function o(u){t.call(this,"appUserTurnstile"),this._customAccessToken=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.postTurnstileEvent=function(u,h){yn.EVENTS_URL&&yn.ACCESS_TOKEN&&Array.isArray(u)&&u.some(function(y){return Ii(y)||ra(y)})&&this.queueRequest(Date.now(),h)},o.prototype.processRequests=function(u){var h=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var y=ki(yn.ACCESS_TOKEN),b=y?y.u:yn.ACCESS_TOKEN,S=b!==this.eventData.tokenU;it(this.anonId)||(this.anonId=ct(),S=!0);var I=this.queue.shift();if(this.eventData.lastSuccess){var D=new Date(this.eventData.lastSuccess),z=new Date(I),Z=(I-this.eventData.lastSuccess)/864e5;S=S||Z>=1||Z<-1||D.getDate()!==z.getDate()}else S=!0;if(!S)return this.processRequests();this.postEvent(I,{"enabled.telemetry":!1},function(G){G||(h.eventData.lastSuccess=I,h.eventData.tokenU=b)},u)}},o}(qi)),bo=ui.postTurnstileEvent.bind(ui),su=new fe,Ut=su.postMapLoadEvent.bind(su),er=500,Rr=50;function an(){_e.caches&&!Gi&&(Gi=_e.caches.open("mapbox-tiles"))}function Tn(t){var o=t.indexOf("?");return o<0?t:t.slice(0,o)}var Un,bi=1/0;function di(){return Un==null&&(Un=_e.OffscreenCanvas&&new _e.OffscreenCanvas(1,1).getContext("2d")&&typeof _e.createImageBitmap=="function"),Un}var Sn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Sn);var Li=function(t){function o(u,h,y){h===401&&ra(y)&&(u+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,u),this.status=h,this.url=y,this.name=this.constructor.name,this.message=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},o}(Error),Oi=Fr()?function(){return self.worker&&self.worker.referrer}:function(){return(_e.location.protocol==="blob:"?_e.parent:_e).location.href},io,hs,Uo=function(t,o){if(!(/^file:/.test(u=t.url)||/^file:/.test(Oi())&&!/^\w+:/.test(u))){if(_e.fetch&&_e.Request&&_e.AbortController&&_e.Request.prototype.hasOwnProperty("signal"))return function(h,y){var b,S=new _e.AbortController,I=new _e.Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,referrer:Oi(),signal:S.signal}),D=!1,z=!1,Z=(b=I.url).indexOf("sku=")>0&&ra(b);h.type==="json"&&I.headers.set("Accept","application/json");var G=function(ne,Te,Ie){if(!z){if(ne&&ne.message!=="SecurityError"&&$e(ne),Te&&Ie)return q(Te);var k=Date.now();_e.fetch(I).then(function(Ue){if(Ue.ok){var rt=Z?Ue.clone():null;return q(Ue,rt,k)}return y(new Li(Ue.statusText,Ue.status,h.url))}).catch(function(Ue){Ue.code!==20&&y(new Error(Ue.message))})}},q=function(ne,Te,Ie){(h.type==="arrayBuffer"?ne.arrayBuffer():h.type==="json"?ne.json():ne.text()).then(function(k){z||(Te&&Ie&&function(Ue,rt,_t){if(an(),Gi){var zt={status:rt.status,statusText:rt.statusText,headers:new _e.Headers};rt.headers.forEach(function(ir,Tr){return zt.headers.set(Tr,ir)});var Vt=Yr(rt.headers.get("Cache-Control")||"");Vt["no-store"]||(Vt["max-age"]&&zt.headers.set("Expires",new Date(_t+1e3*Vt["max-age"]).toUTCString()),new Date(zt.headers.get("Expires")).getTime()-_t<42e4||function(ir,Tr){if(Cs===void 0)try{new Response(new ReadableStream),Cs=!0}catch(Dr){Cs=!1}Cs?Tr(ir.body):ir.blob().then(Tr)}(rt,function(ir){var Tr=new _e.Response(ir,zt);an(),Gi&&Gi.then(function(Dr){return Dr.put(Tn(Ue.url),Tr)}).catch(function(Dr){return $e(Dr.message)})}))}}(I,Te,Ie),D=!0,y(null,k,ne.headers.get("Cache-Control"),ne.headers.get("Expires")))}).catch(function(k){z||y(new Error(k.message))})};return Z?function(ne,Te){if(an(),!Gi)return Te(null);var Ie=Tn(ne.url);Gi.then(function(k){k.match(Ie).then(function(Ue){var rt=function(_t){if(!_t)return!1;var zt=new Date(_t.headers.get("Expires")||0),Vt=Yr(_t.headers.get("Cache-Control")||"");return zt>Date.now()&&!Vt["no-cache"]}(Ue);k.delete(Ie),rt&&k.put(Ie,Ue.clone()),Te(null,Ue,rt)}).catch(Te)}).catch(Te)}(I,G):G(null,null),{cancel:function(){z=!0,D||S.abort()}}}(t,o);if(Fr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,o,void 0,!0)}var u;return function(h,y){var b=new _e.XMLHttpRequest;for(var S in b.open(h.method||"GET",h.url,!0),h.type==="arrayBuffer"&&(b.responseType="arraybuffer"),h.headers)b.setRequestHeader(S,h.headers[S]);return h.type==="json"&&(b.responseType="text",b.setRequestHeader("Accept","application/json")),b.withCredentials=h.credentials==="include",b.onerror=function(){y(new Error(b.statusText))},b.onload=function(){if((b.status>=200&&b.status<300||b.status===0)&&b.response!==null){var I=b.response;if(h.type==="json")try{I=JSON.parse(b.response)}catch(D){return y(D)}y(null,I,b.getResponseHeader("Cache-Control"),b.getResponseHeader("Expires"))}else y(new Li(b.statusText,b.status,h.url))},b.send(h.body),{cancel:function(){return b.abort()}}}(t,o)},Na=function(t,o){return Uo(At(t,{type:"arrayBuffer"}),o)},xa=function(t,o){return Uo(At(t,{method:"POST"}),o)},V="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";io=[],hs=0;var $=function(t,o){if(zn.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),hs>=yn.MAX_PARALLEL_IMAGE_REQUESTS){var u={requestParameters:t,callback:o,cancelled:!1,cancel:function(){this.cancelled=!0}};return io.push(u),u}hs++;var h=!1,y=function(){if(!h)for(h=!0,hs--;io.length&&hs<yn.MAX_PARALLEL_IMAGE_REQUESTS;){var S=io.shift();S.cancelled||(S.cancel=$(S.requestParameters,S.callback).cancel)}},b=Na(t,function(S,I,D,z){y(),S?o(S):I&&(di()?function(Z,G){var q=new _e.Blob([new Uint8Array(Z)],{type:"image/png"});_e.createImageBitmap(q).then(function(ne){G(null,ne)}).catch(function(ne){G(new Error("Could not load image because of "+ne.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(I,o):function(Z,G,q,ne){var Te=new _e.Image,Ie=_e.URL;Te.onload=function(){G(null,Te),Ie.revokeObjectURL(Te.src),Te.onload=null,_e.requestAnimationFrame(function(){Te.src=V})},Te.onerror=function(){return G(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var k=new _e.Blob([new Uint8Array(Z)],{type:"image/png"});Te.cacheControl=q,Te.expires=ne,Te.src=Z.byteLength?Ie.createObjectURL(k):V}(I,o,D,z))});return{cancel:function(){b.cancel(),y()}}};function te(t,o,u){u[t]&&u[t].indexOf(o)!==-1||(u[t]=u[t]||[],u[t].push(o))}function he(t,o,u){if(u&&u[t]){var h=u[t].indexOf(o);h!==-1&&u[t].splice(h,1)}}var Me=function(t,o){o===void 0&&(o={}),At(this,o),this.type=t},Ge=function(t){function o(u,h){h===void 0&&(h={}),t.call(this,"error",At({error:u},h))}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Me),Qe=function(){};Qe.prototype.on=function(t,o){return this._listeners=this._listeners||{},te(t,o,this._listeners),this},Qe.prototype.off=function(t,o){return he(t,o,this._listeners),he(t,o,this._oneTimeListeners),this},Qe.prototype.once=function(t,o){return this._oneTimeListeners=this._oneTimeListeners||{},te(t,o,this._oneTimeListeners),this},Qe.prototype.fire=function(t,o){typeof t=="string"&&(t=new Me(t,o||{}));var u=t.type;if(this.listens(u)){t.target=this;for(var h=0,y=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];h<y.length;h+=1)y[h].call(this,t);for(var b=0,S=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];b<S.length;b+=1){var I=S[b];he(u,I,this._oneTimeListeners),I.call(this,t)}var D=this._eventedParent;D&&(At(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),D.fire(t))}else t instanceof Ge&&console.error(t.error);return this},Qe.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},Qe.prototype.setEventedParent=function(t,o){return this._eventedParent=t,this._eventedParentData=o,this};var oe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Le=function(t,o,u,h){this.message=(t?t+": ":"")+u,h&&(this.identifier=h),o!=null&&o.__line__&&(this.line=o.__line__)};function ht(t){var o=t.value;return o?[new Le(t.key,o,"constants have been deprecated as of v8")]:[]}function fr(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];for(var h=0,y=o;h<y.length;h+=1){var b=y[h];for(var S in b)t[S]=b[S]}return t}function kt(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Ft(t){if(Array.isArray(t))return t.map(Ft);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var o={};for(var u in t)o[u]=Ft(t[u]);return o}return kt(t)}var pr=function(t){function o(u,h){t.call(this,h),this.message=h,this.key=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Error),_n=function(t,o){o===void 0&&(o=[]),this.parent=t,this.bindings={};for(var u=0,h=o;u<h.length;u+=1){var y=h[u];this.bindings[y[0]]=y[1]}};_n.prototype.concat=function(t){return new _n(this,t)},_n.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},_n.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var fn={kind:"null"},Tt={kind:"number"},Jr={kind:"string"},Br={kind:"boolean"},Wr={kind:"color"},vi={kind:"object"},en={kind:"value"},gn={kind:"collator"},Hi={kind:"formatted"},pi={kind:"resolvedImage"};function wi(t,o){return{kind:"array",itemType:t,N:o}}function yi(t){if(t.kind==="array"){var o=yi(t.itemType);return typeof t.N=="number"?"array<"+o+", "+t.N+">":t.itemType.kind==="value"?"array":"array<"+o+">"}return t.kind}var dt=[fn,Tt,Jr,Br,Wr,Hi,vi,wi(en),pi];function Mt(t,o){if(o.kind==="error")return null;if(t.kind==="array"){if(o.kind==="array"&&(o.N===0&&o.itemType.kind==="value"||!Mt(t.itemType,o.itemType))&&(typeof t.N!="number"||t.N===o.N))return null}else{if(t.kind===o.kind)return null;if(t.kind==="value"){for(var u=0,h=dt;u<h.length;u+=1)if(!Mt(h[u],o))return null}}return"Expected "+yi(t)+" but found "+yi(o)+" instead."}function wa(t,o){return o.some(function(u){return u.kind===t.kind})}function Ei(t,o){return o.some(function(u){return u==="null"?t===null:u==="array"?Array.isArray(t):u==="object"?t&&!Array.isArray(t)&&typeof t=="object":u===typeof t})}var Ti=Re(function(t,o){var u={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function h(I){return(I=Math.round(I))<0?0:I>255?255:I}function y(I){return h(I[I.length-1]==="%"?parseFloat(I)/100*255:parseInt(I))}function b(I){return(D=I[I.length-1]==="%"?parseFloat(I)/100:parseFloat(I))<0?0:D>1?1:D;var D}function S(I,D,z){return z<0?z+=1:z>1&&(z-=1),6*z<1?I+(D-I)*z*6:2*z<1?D:3*z<2?I+(D-I)*(2/3-z)*6:I}try{o.parseCSSColor=function(I){var D,z=I.replace(/ /g,"").toLowerCase();if(z in u)return u[z].slice();if(z[0]==="#")return z.length===4?(D=parseInt(z.substr(1),16))>=0&&D<=4095?[(3840&D)>>4|(3840&D)>>8,240&D|(240&D)>>4,15&D|(15&D)<<4,1]:null:z.length===7&&(D=parseInt(z.substr(1),16))>=0&&D<=16777215?[(16711680&D)>>16,(65280&D)>>8,255&D,1]:null;var Z=z.indexOf("("),G=z.indexOf(")");if(Z!==-1&&G+1===z.length){var q=z.substr(0,Z),ne=z.substr(Z+1,G-(Z+1)).split(","),Te=1;switch(q){case"rgba":if(ne.length!==4)return null;Te=b(ne.pop());case"rgb":return ne.length!==3?null:[y(ne[0]),y(ne[1]),y(ne[2]),Te];case"hsla":if(ne.length!==4)return null;Te=b(ne.pop());case"hsl":if(ne.length!==3)return null;var Ie=(parseFloat(ne[0])%360+360)%360/360,k=b(ne[1]),Ue=b(ne[2]),rt=Ue<=.5?Ue*(k+1):Ue+k-Ue*k,_t=2*Ue-rt;return[h(255*S(_t,rt,Ie+1/3)),h(255*S(_t,rt,Ie)),h(255*S(_t,rt,Ie-1/3)),Te];default:return null}}return null}}catch(I){}}).parseCSSColor,Ui=function(t,o,u,h){h===void 0&&(h=1),this.r=t,this.g=o,this.b=u,this.a=h};Ui.parse=function(t){if(t){if(t instanceof Ui)return t;if(typeof t=="string"){var o=Ti(t);if(o)return new Ui(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3])}}},Ui.prototype.toString=function(){var t=this.toArray(),o=t[1],u=t[2],h=t[3];return"rgba("+Math.round(t[0])+","+Math.round(o)+","+Math.round(u)+","+h+")"},Ui.prototype.toArray=function(){var t=this.a;return t===0?[0,0,0,0]:[255*this.r/t,255*this.g/t,255*this.b/t,t]},Ui.black=new Ui(0,0,0,1),Ui.white=new Ui(1,1,1,1),Ui.transparent=new Ui(0,0,0,0),Ui.red=new Ui(1,0,0,1);var Pr=function(t,o,u){this.sensitivity=t?o?"variant":"case":o?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Pr.prototype.compare=function(t,o){return this.collator.compare(t,o)},Pr.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var on=function(t,o,u,h,y){this.text=t,this.image=o,this.scale=u,this.fontStack=h,this.textColor=y},gt=function(t){this.sections=t};gt.fromString=function(t){return new gt([new on(t,null,null,null,null)])},gt.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(t){return t.text.length!==0||t.image&&t.image.name.length!==0})},gt.factory=function(t){return t instanceof gt?t:gt.fromString(t)},gt.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(t){return t.text}).join("")},gt.prototype.serialize=function(){for(var t=["format"],o=0,u=this.sections;o<u.length;o+=1){var h=u[o];if(h.image)t.push(["image",h.image.name]);else{t.push(h.text);var y={};h.fontStack&&(y["text-font"]=["literal",h.fontStack.split(",")]),h.scale&&(y["font-scale"]=h.scale),h.textColor&&(y["text-color"]=["rgba"].concat(h.textColor.toArray())),t.push(y)}}return t};var aa=function(t){this.name=t.name,this.available=t.available};function ue(t,o,u,h){return typeof t=="number"&&t>=0&&t<=255&&typeof o=="number"&&o>=0&&o<=255&&typeof u=="number"&&u>=0&&u<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:"Invalid rgba value ["+[t,o,u,h].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof h=="number"?[t,o,u,h]:[t,o,u]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function qo(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Ui||t instanceof Pr||t instanceof gt||t instanceof aa)return!0;if(Array.isArray(t)){for(var o=0,u=t;o<u.length;o+=1)if(!qo(u[o]))return!1;return!0}if(typeof t=="object"){for(var h in t)if(!qo(t[h]))return!1;return!0}return!1}function ea(t){if(t===null)return fn;if(typeof t=="string")return Jr;if(typeof t=="boolean")return Br;if(typeof t=="number")return Tt;if(t instanceof Ui)return Wr;if(t instanceof Pr)return gn;if(t instanceof gt)return Hi;if(t instanceof aa)return pi;if(Array.isArray(t)){for(var o,u=t.length,h=0,y=t;h<y.length;h+=1){var b=ea(y[h]);if(o){if(o===b)continue;o=en;break}o=b}return wi(o||en,u)}return vi}function _u(t){var o=typeof t;return t===null?"":o==="string"||o==="number"||o==="boolean"?String(t):t instanceof Ui||t instanceof gt||t instanceof aa?t.toString():JSON.stringify(t)}aa.prototype.toString=function(){return this.name},aa.fromString=function(t){return t?new aa({name:t,available:!1}):null},aa.prototype.serialize=function(){return["image",this.name]};var za=function(t,o){this.type=t,this.value=o};za.parse=function(t,o){if(t.length!==2)return o.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!qo(t[1]))return o.error("invalid value");var u=t[1],h=ea(u),y=o.expectedType;return h.kind!=="array"||h.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(h=y),new za(h,u)},za.prototype.evaluate=function(){return this.value},za.prototype.eachChild=function(){},za.prototype.outputDefined=function(){return!0},za.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ui?["rgba"].concat(this.value.toArray()):this.value instanceof gt?this.value.serialize():this.value};var Ta=function(t){this.name="ExpressionEvaluationError",this.message=t};Ta.prototype.toJSON=function(){return this.message};var qa={string:Jr,number:Tt,boolean:Br,object:vi},oa=function(t,o){this.type=t,this.args=o};oa.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u,h=1,y=t[0];if(y==="array"){var b,S;if(t.length>2){var I=t[1];if(typeof I!="string"||!(I in qa)||I==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);b=qa[I],h++}else b=en;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return o.error('The length argument to "array" must be a positive integer literal',2);S=t[2],h++}u=wi(b,S)}else u=qa[y];for(var D=[];h<t.length;h++){var z=o.parse(t[h],h,en);if(!z)return null;D.push(z)}return new oa(u,D)},oa.prototype.evaluate=function(t){for(var o=0;o<this.args.length;o++){var u=this.args[o].evaluate(t);if(!Mt(this.type,ea(u)))return u;if(o===this.args.length-1)throw new Ta("Expected value to be of type "+yi(this.type)+", but found "+yi(ea(u))+" instead.")}return null},oa.prototype.eachChild=function(t){this.args.forEach(t)},oa.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},oa.prototype.serialize=function(){var t=this.type,o=[t.kind];if(t.kind==="array"){var u=t.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){o.push(u.kind);var h=t.N;(typeof h=="number"||this.args.length>1)&&o.push(h)}}return o.concat(this.args.map(function(y){return y.serialize()}))};var Ao=function(t){this.type=Hi,this.sections=t};Ao.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u=t[1];if(!Array.isArray(u)&&typeof u=="object")return o.error("First argument must be an image or text section.");for(var h=[],y=!1,b=1;b<=t.length-1;++b){var S=t[b];if(y&&typeof S=="object"&&!Array.isArray(S)){y=!1;var I=null;if(S["font-scale"]&&!(I=o.parse(S["font-scale"],1,Tt)))return null;var D=null;if(S["text-font"]&&!(D=o.parse(S["text-font"],1,wi(Jr))))return null;var z=null;if(S["text-color"]&&!(z=o.parse(S["text-color"],1,Wr)))return null;var Z=h[h.length-1];Z.scale=I,Z.font=D,Z.textColor=z}else{var G=o.parse(t[b],1,en);if(!G)return null;var q=G.type.kind;if(q!=="string"&&q!=="value"&&q!=="null"&&q!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,h.push({content:G,scale:null,font:null,textColor:null})}}return new Ao(h)},Ao.prototype.evaluate=function(t){return new gt(this.sections.map(function(o){var u=o.content.evaluate(t);return ea(u)===pi?new on("",u,null,null,null):new on(_u(u),null,o.scale?o.scale.evaluate(t):null,o.font?o.font.evaluate(t).join(","):null,o.textColor?o.textColor.evaluate(t):null)}))},Ao.prototype.eachChild=function(t){for(var o=0,u=this.sections;o<u.length;o+=1){var h=u[o];t(h.content),h.scale&&t(h.scale),h.font&&t(h.font),h.textColor&&t(h.textColor)}},Ao.prototype.outputDefined=function(){return!1},Ao.prototype.serialize=function(){for(var t=["format"],o=0,u=this.sections;o<u.length;o+=1){var h=u[o];t.push(h.content.serialize());var y={};h.scale&&(y["font-scale"]=h.scale.serialize()),h.font&&(y["text-font"]=h.font.serialize()),h.textColor&&(y["text-color"]=h.textColor.serialize()),t.push(y)}return t};var Zo=function(t){this.type=pi,this.input=t};Zo.parse=function(t,o){if(t.length!==2)return o.error("Expected two arguments.");var u=o.parse(t[1],1,Jr);return u?new Zo(u):o.error("No image name provided.")},Zo.prototype.evaluate=function(t){var o=this.input.evaluate(t),u=aa.fromString(o);return u&&t.availableImages&&(u.available=t.availableImages.indexOf(o)>-1),u},Zo.prototype.eachChild=function(t){t(this.input)},Zo.prototype.outputDefined=function(){return!1},Zo.prototype.serialize=function(){return["image",this.input.serialize()]};var Cu={"to-boolean":Br,"to-color":Wr,"to-number":Tt,"to-string":Jr},ho=function(t,o){this.type=t,this.args=o};ho.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u=t[0];if((u==="to-boolean"||u==="to-string")&&t.length!==2)return o.error("Expected one argument.");for(var h=Cu[u],y=[],b=1;b<t.length;b++){var S=o.parse(t[b],b,en);if(!S)return null;y.push(S)}return new ho(h,y)},ho.prototype.evaluate=function(t){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(t));if(this.type.kind==="color"){for(var o,u,h=0,y=this.args;h<y.length;h+=1){if(u=null,(o=y[h].evaluate(t))instanceof Ui)return o;if(typeof o=="string"){var b=t.parseColor(o);if(b)return b}else if(Array.isArray(o)&&!(u=o.length<3||o.length>4?"Invalid rbga value "+JSON.stringify(o)+": expected an array containing either three or four numeric values.":ue(o[0],o[1],o[2],o[3])))return new Ui(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new Ta(u||"Could not parse color from value '"+(typeof o=="string"?o:String(JSON.stringify(o)))+"'")}if(this.type.kind==="number"){for(var S=null,I=0,D=this.args;I<D.length;I+=1){if((S=D[I].evaluate(t))===null)return 0;var z=Number(S);if(!isNaN(z))return z}throw new Ta("Could not convert "+JSON.stringify(S)+" to number.")}return this.type.kind==="formatted"?gt.fromString(_u(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?aa.fromString(_u(this.args[0].evaluate(t))):_u(this.args[0].evaluate(t))},ho.prototype.eachChild=function(t){this.args.forEach(t)},ho.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},ho.prototype.serialize=function(){if(this.type.kind==="formatted")return new Ao([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Zo(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild(function(o){t.push(o.serialize())}),t};var Lo=["Unknown","Point","LineString","Polygon"],sa=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};sa.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},sa.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Lo[this.feature.type]:this.feature.type:null},sa.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},sa.prototype.canonicalID=function(){return this.canonical},sa.prototype.properties=function(){return this.feature&&this.feature.properties||{}},sa.prototype.parseColor=function(t){var o=this._parseColorCache[t];return o||(o=this._parseColorCache[t]=Ui.parse(t)),o};var Ka=function(t,o,u,h){this.name=t,this.type=o,this._evaluate=u,this.args=h};Ka.prototype.evaluate=function(t){return this._evaluate(t,this.args)},Ka.prototype.eachChild=function(t){this.args.forEach(t)},Ka.prototype.outputDefined=function(){return!1},Ka.prototype.serialize=function(){return[this.name].concat(this.args.map(function(t){return t.serialize()}))},Ka.parse=function(t,o){var u,h=t[0],y=Ka.definitions[h];if(!y)return o.error('Unknown expression "'+h+'". If you wanted a literal array, use ["literal", [...]].',0);for(var b=Array.isArray(y)?y[0]:y.type,S=Array.isArray(y)?[[y[1],y[2]]]:y.overloads,I=S.filter(function(Vn){var pn=Vn[0];return!Array.isArray(pn)||pn.length===t.length-1}),D=null,z=0,Z=I;z<Z.length;z+=1){var G=Z[z],q=G[0],ne=G[1];D=new Ds(o.registry,o.path,null,o.scope);for(var Te=[],Ie=!1,k=1;k<t.length;k++){var Ue=t[k],rt=Array.isArray(q)?q[k-1]:q.type,_t=D.parse(Ue,1+Te.length,rt);if(!_t){Ie=!0;break}Te.push(_t)}if(!Ie)if(Array.isArray(q)&&q.length!==Te.length)D.error("Expected "+q.length+" arguments, but found "+Te.length+" instead.");else{for(var zt=0;zt<Te.length;zt++){var Vt=Array.isArray(q)?q[zt]:q.type,ir=Te[zt];D.concat(zt+1).checkSubtype(Vt,ir.type)}if(D.errors.length===0)return new Ka(h,b,ne,Te)}}if(I.length===1)(u=o.errors).push.apply(u,D.errors);else{for(var Tr=(I.length?I:S).map(function(Vn){var pn;return pn=Vn[0],Array.isArray(pn)?"("+pn.map(yi).join(", ")+")":"("+yi(pn.type)+"...)"}).join(" | "),Dr=[],Dn=1;Dn<t.length;Dn++){var cn=o.parse(t[Dn],1+Dr.length);if(!cn)return null;Dr.push(yi(cn.type))}o.error("Expected arguments of type "+Tr+", but found ("+Dr.join(", ")+") instead.")}return null},Ka.register=function(t,o){for(var u in Ka.definitions=o,o)t[u]=Ka};var Do=function(t,o,u){this.type=gn,this.locale=u,this.caseSensitive=t,this.diacriticSensitive=o};function $a(t,o){t[0]=Math.min(t[0],o[0]),t[1]=Math.min(t[1],o[1]),t[2]=Math.max(t[2],o[0]),t[3]=Math.max(t[3],o[1])}function As(t,o){return!(t[0]<=o[0]||t[2]>=o[2]||t[1]<=o[1]||t[3]>=o[3])}function Ml(t,o){var u=(180+t[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,y=Math.pow(2,o.z);return[Math.round(u*y*8192),Math.round(h*y*8192)]}function ds(t,o,u){return o[1]>t[1]!=u[1]>t[1]&&t[0]<(u[0]-o[0])*(t[1]-o[1])/(u[1]-o[1])+o[0]}function ee(t,o){for(var u,h,y,b,S,I,D,z=!1,Z=0,G=o.length;Z<G;Z++)for(var q=o[Z],ne=0,Te=q.length;ne<Te-1;ne++){if((b=(u=t)[0]-(h=q[ne])[0])*(D=u[1]-(y=q[ne+1])[1])-(I=u[0]-y[0])*(S=u[1]-h[1])==0&&b*I<=0&&S*D<=0)return!1;ds(t,q[ne],q[ne+1])&&(z=!z)}return z}function ye(t,o){for(var u=0;u<o.length;u++)if(ee(t,o[u]))return!0;return!1}function We(t,o,u,h){var y=h[0]-u[0],b=h[1]-u[1],S=(t[0]-u[0])*b-y*(t[1]-u[1]),I=(o[0]-u[0])*b-y*(o[1]-u[1]);return S>0&&I<0||S<0&&I>0}function It(t,o,u){for(var h=0,y=u;h<y.length;h+=1)for(var b=y[h],S=0;S<b.length-1;++S)if((G=[(Z=b[S+1])[0]-(z=b[S])[0],Z[1]-z[1]])[0]*(q=[(D=o)[0]-(I=t)[0],D[1]-I[1]])[1]-G[1]*q[0]!=0&&We(I,D,z,Z)&&We(z,Z,I,D))return!0;var I,D,z,Z,G,q;return!1}function Ir(t,o){for(var u=0;u<t.length;++u)if(!ee(t[u],o))return!1;for(var h=0;h<t.length-1;++h)if(It(t[h],t[h+1],o))return!1;return!0}function In(t,o){for(var u=0;u<o.length;u++)if(Ir(t,o[u]))return!0;return!1}function Mi(t,o,u){for(var h=[],y=0;y<t.length;y++){for(var b=[],S=0;S<t[y].length;S++){var I=Ml(t[y][S],u);$a(o,I),b.push(I)}h.push(b)}return h}function ao(t,o,u){for(var h=[],y=0;y<t.length;y++){var b=Mi(t[y],o,u);h.push(b)}return h}function Ra(t,o,u,h){if(t[0]<u[0]||t[0]>u[2]){var y=.5*h,b=t[0]-u[0]>y?-h:u[0]-t[0]>y?h:0;b===0&&(b=t[0]-u[2]>y?-h:u[2]-t[0]>y?h:0),t[0]+=b}$a(o,t)}function Ua(t,o,u,h){for(var y=8192*Math.pow(2,h.z),b=[8192*h.x,8192*h.y],S=[],I=0,D=t;I<D.length;I+=1)for(var z=0,Z=D[I];z<Z.length;z+=1){var G=Z[z],q=[G.x+b[0],G.y+b[1]];Ra(q,o,u,y),S.push(q)}return S}function jo(t,o,u,h){for(var y,b=8192*Math.pow(2,h.z),S=[8192*h.x,8192*h.y],I=[],D=0,z=t;D<z.length;D+=1){for(var Z=[],G=0,q=z[D];G<q.length;G+=1){var ne=q[G],Te=[ne.x+S[0],ne.y+S[1]];$a(o,Te),Z.push(Te)}I.push(Z)}if(o[2]-o[0]<=b/2){(y=o)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(var Ie=0,k=I;Ie<k.length;Ie+=1)for(var Ue=0,rt=k[Ie];Ue<rt.length;Ue+=1)Ra(rt[Ue],o,u,b)}return I}Do.parse=function(t,o){if(t.length!==2)return o.error("Expected one argument.");var u=t[1];if(typeof u!="object"||Array.isArray(u))return o.error("Collator options argument must be an object.");var h=o.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,Br);if(!h)return null;var y=o.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,Br);if(!y)return null;var b=null;return u.locale&&!(b=o.parse(u.locale,1,Jr))?null:new Do(h,y,b)},Do.prototype.evaluate=function(t){return new Pr(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},Do.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},Do.prototype.outputDefined=function(){return!1},Do.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var vs=function(t,o){this.type=Br,this.geojson=t,this.geometries=o};function uo(t){if(t instanceof Ka&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof vs)return!1;var o=!0;return t.eachChild(function(u){o&&!uo(u)&&(o=!1)}),o}function wo(t){if(t instanceof Ka&&t.name==="feature-state")return!1;var o=!0;return t.eachChild(function(u){o&&!wo(u)&&(o=!1)}),o}function ms(t,o){if(t instanceof Ka&&o.indexOf(t.name)>=0)return!1;var u=!0;return t.eachChild(function(h){u&&!ms(h,o)&&(u=!1)}),u}vs.parse=function(t,o){if(t.length!==2)return o.error("'within' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(qo(t[1])){var u=t[1];if(u.type==="FeatureCollection")for(var h=0;h<u.features.length;++h){var y=u.features[h].geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new vs(u,u.features[h].geometry)}else if(u.type==="Feature"){var b=u.geometry.type;if(b==="Polygon"||b==="MultiPolygon")return new vs(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new vs(u,u)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")},vs.prototype.evaluate=function(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(o,u){var h=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=o.canonicalID();if(u.type==="Polygon"){var S=Mi(u.coordinates,y,b),I=Ua(o.geometry(),h,y,b);if(!As(h,y))return!1;for(var D=0,z=I;D<z.length;D+=1)if(!ee(z[D],S))return!1}if(u.type==="MultiPolygon"){var Z=ao(u.coordinates,y,b),G=Ua(o.geometry(),h,y,b);if(!As(h,y))return!1;for(var q=0,ne=G;q<ne.length;q+=1)if(!ye(ne[q],Z))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(o,u){var h=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=o.canonicalID();if(u.type==="Polygon"){var S=Mi(u.coordinates,y,b),I=jo(o.geometry(),h,y,b);if(!As(h,y))return!1;for(var D=0,z=I;D<z.length;D+=1)if(!Ir(z[D],S))return!1}if(u.type==="MultiPolygon"){var Z=ao(u.coordinates,y,b),G=jo(o.geometry(),h,y,b);if(!As(h,y))return!1;for(var q=0,ne=G;q<ne.length;q+=1)if(!In(ne[q],Z))return!1}return!0}(t,this.geometries)}return!1},vs.prototype.eachChild=function(){},vs.prototype.outputDefined=function(){return!0},vs.prototype.serialize=function(){return["within",this.geojson]};var ws=function(t,o){this.type=o.type,this.name=t,this.boundExpression=o};ws.parse=function(t,o){if(t.length!==2||typeof t[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");var u=t[1];return o.scope.has(u)?new ws(u,o.scope.get(u)):o.error('Unknown variable "'+u+'". Make sure "'+u+'" has been bound in an enclosing "let" expression before using it.',1)},ws.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},ws.prototype.eachChild=function(){},ws.prototype.outputDefined=function(){return!1},ws.prototype.serialize=function(){return["var",this.name]};var Ds=function(t,o,u,h,y){o===void 0&&(o=[]),h===void 0&&(h=new _n),y===void 0&&(y=[]),this.registry=t,this.path=o,this.key=o.map(function(b){return"["+b+"]"}).join(""),this.scope=h,this.errors=y,this.expectedType=u};function uu(t,o){for(var u,h=t.length-1,y=0,b=h,S=0;y<=b;)if((u=t[S=Math.floor((y+b)/2)])<=o){if(S===h||o<t[S+1])return S;y=S+1}else{if(!(u>o))throw new Ta("Input is not a number.");b=S-1}return 0}Ds.prototype.parse=function(t,o,u,h,y){return y===void 0&&(y={}),o?this.concat(o,u,h)._parse(t,y):this._parse(t,y)},Ds.prototype._parse=function(t,o){function u(z,Z,G){return G==="assert"?new oa(Z,[z]):G==="coerce"?new ho(Z,[z]):z}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var h=t[0];if(typeof h!="string")return this.error("Expression name must be a string, but found "+typeof h+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var y=this.registry[h];if(y){var b=y.parse(t,this);if(!b)return null;if(this.expectedType){var S=this.expectedType,I=b.type;if(S.kind!=="string"&&S.kind!=="number"&&S.kind!=="boolean"&&S.kind!=="object"&&S.kind!=="array"||I.kind!=="value")if(S.kind!=="color"&&S.kind!=="formatted"&&S.kind!=="resolvedImage"||I.kind!=="value"&&I.kind!=="string"){if(this.checkSubtype(S,I))return null}else b=u(b,S,o.typeAnnotation||"coerce");else b=u(b,S,o.typeAnnotation||"assert")}if(!(b instanceof za)&&b.type.kind!=="resolvedImage"&&function z(Z){if(Z instanceof ws)return z(Z.boundExpression);if(Z instanceof Ka&&Z.name==="error"||Z instanceof Do||Z instanceof vs)return!1;var G=Z instanceof ho||Z instanceof oa,q=!0;return Z.eachChild(function(ne){q=G?q&&z(ne):q&&ne instanceof za}),!!q&&uo(Z)&&ms(Z,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(b)){var D=new sa;try{b=new za(b.type,b.evaluate(D))}catch(z){return this.error(z.message),null}}return b}return this.error('Unknown expression "'+h+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof t+" instead.")},Ds.prototype.concat=function(t,o,u){var h=typeof t=="number"?this.path.concat(t):this.path,y=u?this.scope.concat(u):this.scope;return new Ds(this.registry,h,o||null,y,this.errors)},Ds.prototype.error=function(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];var h=""+this.key+o.map(function(y){return"["+y+"]"}).join("");this.errors.push(new pr(h,t))},Ds.prototype.checkSubtype=function(t,o){var u=Mt(t,o);return u&&this.error(u),u};var gs=function(t,o,u){this.type=t,this.input=o,this.labels=[],this.outputs=[];for(var h=0,y=u;h<y.length;h+=1){var b=y[h],S=b[1];this.labels.push(b[0]),this.outputs.push(S)}};function ma(t,o,u){return t*(1-u)+o*u}gs.parse=function(t,o){if(t.length-1<4)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");var u=o.parse(t[1],1,Tt);if(!u)return null;var h=[],y=null;o.expectedType&&o.expectedType.kind!=="value"&&(y=o.expectedType);for(var b=1;b<t.length;b+=2){var S=b===1?-1/0:t[b],I=t[b+1],D=b,z=b+1;if(typeof S!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(h.length&&h[h.length-1][0]>=S)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);var Z=o.parse(I,z,y);if(!Z)return null;y=y||Z.type,h.push([S,Z])}return new gs(y,u,h)},gs.prototype.evaluate=function(t){var o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(t);var h=this.input.evaluate(t);if(h<=o[0])return u[0].evaluate(t);var y=o.length;return h>=o[y-1]?u[y-1].evaluate(t):u[uu(o,h)].evaluate(t)},gs.prototype.eachChild=function(t){t(this.input);for(var o=0,u=this.outputs;o<u.length;o+=1)t(u[o])},gs.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},gs.prototype.serialize=function(){for(var t=["step",this.input.serialize()],o=0;o<this.labels.length;o++)o>0&&t.push(this.labels[o]),t.push(this.outputs[o].serialize());return t};var _a=Object.freeze({__proto__:null,number:ma,color:function(t,o,u){return new Ui(ma(t.r,o.r,u),ma(t.g,o.g,u),ma(t.b,o.b,u),ma(t.a,o.a,u))},array:function(t,o,u){return t.map(function(h,y){return ma(h,o[y],u)})}}),rs=6/29*3*(6/29),pf=Math.PI/180,Pl=180/Math.PI;function Ws(t){return t>.008856451679035631?Math.pow(t,1/3):t/rs+4/29}function rc(t){return t>6/29?t*t*t:rs*(t-4/29)}function Wu(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Xs(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function al(t){var o=Xs(t.r),u=Xs(t.g),h=Xs(t.b),y=Ws((.4124564*o+.3575761*u+.1804375*h)/.95047),b=Ws((.2126729*o+.7151522*u+.072175*h)/1);return{l:116*b-16,a:500*(y-b),b:200*(b-Ws((.0193339*o+.119192*u+.9503041*h)/1.08883)),alpha:t.a}}function _(t){var o=(t.l+16)/116,u=isNaN(t.a)?o:o+t.a/500,h=isNaN(t.b)?o:o-t.b/200;return o=1*rc(o),u=.95047*rc(u),h=1.08883*rc(h),new Ui(Wu(3.2404542*u-1.5371385*o-.4985314*h),Wu(-.969266*u+1.8760108*o+.041556*h),Wu(.0556434*u-.2040259*o+1.0572252*h),t.alpha)}function M(t,o,u){var h=o-t;return t+u*(h>180||h<-180?h-360*Math.round(h/360):h)}var B={forward:al,reverse:_,interpolate:function(t,o,u){return{l:ma(t.l,o.l,u),a:ma(t.a,o.a,u),b:ma(t.b,o.b,u),alpha:ma(t.alpha,o.alpha,u)}}},O={forward:function(t){var o=al(t),u=o.l,h=o.a,y=o.b,b=Math.atan2(y,h)*Pl;return{h:b<0?b+360:b,c:Math.sqrt(h*h+y*y),l:u,alpha:t.a}},reverse:function(t){var o=t.h*pf,u=t.c;return _({l:t.l,a:Math.cos(o)*u,b:Math.sin(o)*u,alpha:t.alpha})},interpolate:function(t,o,u){return{h:M(t.h,o.h,u),c:ma(t.c,o.c,u),l:ma(t.l,o.l,u),alpha:ma(t.alpha,o.alpha,u)}}},K=Object.freeze({__proto__:null,lab:B,hcl:O}),ge=function(t,o,u,h,y){this.type=t,this.operator=o,this.interpolation=u,this.input=h,this.labels=[],this.outputs=[];for(var b=0,S=y;b<S.length;b+=1){var I=S[b],D=I[1];this.labels.push(I[0]),this.outputs.push(D)}};function He(t,o,u,h){var y=h-u,b=t-u;return y===0?0:o===1?b/y:(Math.pow(o,b)-1)/(Math.pow(o,y)-1)}ge.interpolationFactor=function(t,o,u,h){var y=0;if(t.name==="exponential")y=He(o,t.base,u,h);else if(t.name==="linear")y=He(o,1,u,h);else if(t.name==="cubic-bezier"){var b=t.controlPoints;y=new W(b[0],b[1],b[2],b[3]).solve(He(o,1,u,h))}return y},ge.parse=function(t,o){var u=t[0],h=t[1],y=t[2],b=t.slice(3);if(!Array.isArray(h)||h.length===0)return o.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){var S=h[1];if(typeof S!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:S}}else{if(h[0]!=="cubic-bezier")return o.error("Unknown interpolation type "+String(h[0]),1,0);var I=h.slice(1);if(I.length!==4||I.some(function(k){return typeof k!="number"||k<0||k>1}))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:I}}if(t.length-1<4)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(!(y=o.parse(y,2,Tt)))return null;var D=[],z=null;u==="interpolate-hcl"||u==="interpolate-lab"?z=Wr:o.expectedType&&o.expectedType.kind!=="value"&&(z=o.expectedType);for(var Z=0;Z<b.length;Z+=2){var G=b[Z],q=b[Z+1],ne=Z+3,Te=Z+4;if(typeof G!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ne);if(D.length&&D[D.length-1][0]>=G)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ne);var Ie=o.parse(q,Te,z);if(!Ie)return null;z=z||Ie.type,D.push([G,Ie])}return z.kind==="number"||z.kind==="color"||z.kind==="array"&&z.itemType.kind==="number"&&typeof z.N=="number"?new ge(z,u,h,y,D):o.error("Type "+yi(z)+" is not interpolatable.")},ge.prototype.evaluate=function(t){var o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(t);var h=this.input.evaluate(t);if(h<=o[0])return u[0].evaluate(t);var y=o.length;if(h>=o[y-1])return u[y-1].evaluate(t);var b=uu(o,h),S=ge.interpolationFactor(this.interpolation,h,o[b],o[b+1]),I=u[b].evaluate(t),D=u[b+1].evaluate(t);return this.operator==="interpolate"?_a[this.type.kind.toLowerCase()](I,D,S):this.operator==="interpolate-hcl"?O.reverse(O.interpolate(O.forward(I),O.forward(D),S)):B.reverse(B.interpolate(B.forward(I),B.forward(D),S))},ge.prototype.eachChild=function(t){t(this.input);for(var o=0,u=this.outputs;o<u.length;o+=1)t(u[o])},ge.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},ge.prototype.serialize=function(){var t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var o=[this.operator,t,this.input.serialize()],u=0;u<this.labels.length;u++)o.push(this.labels[u],this.outputs[u].serialize());return o};var lt=function(t,o){this.type=t,this.args=o};lt.parse=function(t,o){if(t.length<2)return o.error("Expectected at least one argument.");var u=null,h=o.expectedType;h&&h.kind!=="value"&&(u=h);for(var y=[],b=0,S=t.slice(1);b<S.length;b+=1){var I=o.parse(S[b],1+y.length,u,void 0,{typeAnnotation:"omit"});if(!I)return null;u=u||I.type,y.push(I)}var D=h&&y.some(function(z){return Mt(h,z.type)});return new lt(D?en:u,y)},lt.prototype.evaluate=function(t){for(var o,u=null,h=0,y=0,b=this.args;y<b.length&&(h++,(u=b[y].evaluate(t))&&u instanceof aa&&!u.available&&(o||(o=u.name),u=null,h===this.args.length&&(u=o)),u===null);y+=1);return u},lt.prototype.eachChild=function(t){this.args.forEach(t)},lt.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},lt.prototype.serialize=function(){var t=["coalesce"];return this.eachChild(function(o){t.push(o.serialize())}),t};var pt=function(t,o){this.type=o.type,this.bindings=[].concat(t),this.result=o};pt.prototype.evaluate=function(t){return this.result.evaluate(t)},pt.prototype.eachChild=function(t){for(var o=0,u=this.bindings;o<u.length;o+=1)t(u[o][1]);t(this.result)},pt.parse=function(t,o){if(t.length<4)return o.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var u=[],h=1;h<t.length-1;h+=2){var y=t[h];if(typeof y!="string")return o.error("Expected string, but found "+typeof y+" instead.",h);if(/[^a-zA-Z0-9_]/.test(y))return o.error("Variable names must contain only alphanumeric characters or '_'.",h);var b=o.parse(t[h+1],h+1);if(!b)return null;u.push([y,b])}var S=o.parse(t[t.length-1],t.length-1,o.expectedType,u);return S?new pt(u,S):null},pt.prototype.outputDefined=function(){return this.result.outputDefined()},pt.prototype.serialize=function(){for(var t=["let"],o=0,u=this.bindings;o<u.length;o+=1){var h=u[o];t.push(h[0],h[1].serialize())}return t.push(this.result.serialize()),t};var nr=function(t,o,u){this.type=t,this.index=o,this.input=u};nr.parse=function(t,o){if(t.length!==3)return o.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,Tt),h=o.parse(t[2],2,wi(o.expectedType||en));return u&&h?new nr(h.type.itemType,u,h):null},nr.prototype.evaluate=function(t){var o=this.index.evaluate(t),u=this.input.evaluate(t);if(o<0)throw new Ta("Array index out of bounds: "+o+" < 0.");if(o>=u.length)throw new Ta("Array index out of bounds: "+o+" > "+(u.length-1)+".");if(o!==Math.floor(o))throw new Ta("Array index must be an integer, but found "+o+" instead.");return u[o]},nr.prototype.eachChild=function(t){t(this.index),t(this.input)},nr.prototype.outputDefined=function(){return!1},nr.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var sr=function(t,o){this.type=Br,this.needle=t,this.haystack=o};sr.parse=function(t,o){if(t.length!==3)return o.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,en),h=o.parse(t[2],2,en);return u&&h?wa(u.type,[Br,Jr,Tt,fn,en])?new sr(u,h):o.error("Expected first argument to be of type boolean, string, number or null, but found "+yi(u.type)+" instead"):null},sr.prototype.evaluate=function(t){var o=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!u)return!1;if(!Ei(o,["boolean","string","number","null"]))throw new Ta("Expected first argument to be of type boolean, string, number or null, but found "+yi(ea(o))+" instead.");if(!Ei(u,["string","array"]))throw new Ta("Expected second argument to be of type array or string, but found "+yi(ea(u))+" instead.");return u.indexOf(o)>=0},sr.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},sr.prototype.outputDefined=function(){return!0},sr.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Mn=function(t,o,u){this.type=Tt,this.needle=t,this.haystack=o,this.fromIndex=u};Mn.parse=function(t,o){if(t.length<=2||t.length>=5)return o.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,en),h=o.parse(t[2],2,en);if(!u||!h)return null;if(!wa(u.type,[Br,Jr,Tt,fn,en]))return o.error("Expected first argument to be of type boolean, string, number or null, but found "+yi(u.type)+" instead");if(t.length===4){var y=o.parse(t[3],3,Tt);return y?new Mn(u,h,y):null}return new Mn(u,h)},Mn.prototype.evaluate=function(t){var o=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!Ei(o,["boolean","string","number","null"]))throw new Ta("Expected first argument to be of type boolean, string, number or null, but found "+yi(ea(o))+" instead.");if(!Ei(u,["string","array"]))throw new Ta("Expected second argument to be of type array or string, but found "+yi(ea(u))+" instead.");if(this.fromIndex){var h=this.fromIndex.evaluate(t);return u.indexOf(o,h)}return u.indexOf(o)},Mn.prototype.eachChild=function(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)},Mn.prototype.outputDefined=function(){return!1},Mn.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var ri=function(t,o,u,h,y,b){this.inputType=t,this.type=o,this.input=u,this.cases=h,this.outputs=y,this.otherwise=b};ri.parse=function(t,o){if(t.length<5)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return o.error("Expected an even number of arguments.");var u,h;o.expectedType&&o.expectedType.kind!=="value"&&(h=o.expectedType);for(var y={},b=[],S=2;S<t.length-1;S+=2){var I=t[S],D=t[S+1];Array.isArray(I)||(I=[I]);var z=o.concat(S);if(I.length===0)return z.error("Expected at least one branch label.");for(var Z=0,G=I;Z<G.length;Z+=1){var q=G[Z];if(typeof q!="number"&&typeof q!="string")return z.error("Branch labels must be numbers or strings.");if(typeof q=="number"&&Math.abs(q)>Number.MAX_SAFE_INTEGER)return z.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof q=="number"&&Math.floor(q)!==q)return z.error("Numeric branch labels must be integer values.");if(u){if(z.checkSubtype(u,ea(q)))return null}else u=ea(q);if(y[String(q)]!==void 0)return z.error("Branch labels must be unique.");y[String(q)]=b.length}var ne=o.parse(D,S,h);if(!ne)return null;h=h||ne.type,b.push(ne)}var Te=o.parse(t[1],1,en);if(!Te)return null;var Ie=o.parse(t[t.length-1],t.length-1,h);return Ie?Te.type.kind!=="value"&&o.concat(1).checkSubtype(u,Te.type)?null:new ri(u,h,Te,y,b,Ie):null},ri.prototype.evaluate=function(t){var o=this.input.evaluate(t);return(ea(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(t)},ri.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},ri.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})&&this.otherwise.outputDefined()},ri.prototype.serialize=function(){for(var t=this,o=["match",this.input.serialize()],u=[],h={},y=0,b=Object.keys(this.cases).sort();y<b.length;y+=1){var S=b[y];(G=h[this.cases[S]])===void 0?(h[this.cases[S]]=u.length,u.push([this.cases[S],[S]])):u[G][1].push(S)}for(var I=function(ne){return t.inputType.kind==="number"?Number(ne):ne},D=0,z=u;D<z.length;D+=1){var Z=z[D],G=Z[0],q=Z[1];o.push(q.length===1?I(q[0]):q.map(I)),o.push(this.outputs[outputIndex$1].serialize())}return o.push(this.otherwise.serialize()),o};var kn=function(t,o,u){this.type=t,this.branches=o,this.otherwise=u};kn.parse=function(t,o){if(t.length<4)return o.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return o.error("Expected an odd number of arguments.");var u;o.expectedType&&o.expectedType.kind!=="value"&&(u=o.expectedType);for(var h=[],y=1;y<t.length-1;y+=2){var b=o.parse(t[y],y,Br);if(!b)return null;var S=o.parse(t[y+1],y+1,u);if(!S)return null;h.push([b,S]),u=u||S.type}var I=o.parse(t[t.length-1],t.length-1,u);return I?new kn(u,h,I):null},kn.prototype.evaluate=function(t){for(var o=0,u=this.branches;o<u.length;o+=1){var h=u[o],y=h[1];if(h[0].evaluate(t))return y.evaluate(t)}return this.otherwise.evaluate(t)},kn.prototype.eachChild=function(t){for(var o=0,u=this.branches;o<u.length;o+=1){var h=u[o],y=h[1];t(h[0]),t(y)}t(this.otherwise)},kn.prototype.outputDefined=function(){return this.branches.every(function(t){return t[1].outputDefined()})&&this.otherwise.outputDefined()},kn.prototype.serialize=function(){var t=["case"];return this.eachChild(function(o){t.push(o.serialize())}),t};var Wi=function(t,o,u,h){this.type=t,this.input=o,this.beginIndex=u,this.endIndex=h};function da(t,o){return t==="=="||t==="!="?o.kind==="boolean"||o.kind==="string"||o.kind==="number"||o.kind==="null"||o.kind==="value":o.kind==="string"||o.kind==="number"||o.kind==="value"}function Sa(t,o,u,h){return h.compare(o,u)===0}function ji(t,o,u){var h=t!=="=="&&t!=="!=";return function(){function y(b,S,I){this.type=Br,this.lhs=b,this.rhs=S,this.collator=I,this.hasUntypedArgument=b.type.kind==="value"||S.type.kind==="value"}return y.parse=function(b,S){if(b.length!==3&&b.length!==4)return S.error("Expected two or three arguments.");var I=b[0],D=S.parse(b[1],1,en);if(!D)return null;if(!da(I,D.type))return S.concat(1).error('"'+I+`" comparisons are not supported for type '`+yi(D.type)+"'.");var z=S.parse(b[2],2,en);if(!z)return null;if(!da(I,z.type))return S.concat(2).error('"'+I+`" comparisons are not supported for type '`+yi(z.type)+"'.");if(D.type.kind!==z.type.kind&&D.type.kind!=="value"&&z.type.kind!=="value")return S.error("Cannot compare types '"+yi(D.type)+"' and '"+yi(z.type)+"'.");h&&(D.type.kind==="value"&&z.type.kind!=="value"?D=new oa(z.type,[D]):D.type.kind!=="value"&&z.type.kind==="value"&&(z=new oa(D.type,[z])));var Z=null;if(b.length===4){if(D.type.kind!=="string"&&z.type.kind!=="string"&&D.type.kind!=="value"&&z.type.kind!=="value")return S.error("Cannot use collator to compare non-string types.");if(!(Z=S.parse(b[3],3,gn)))return null}return new y(D,z,Z)},y.prototype.evaluate=function(b){var S=this.lhs.evaluate(b),I=this.rhs.evaluate(b);if(h&&this.hasUntypedArgument){var D=ea(S),z=ea(I);if(D.kind!==z.kind||D.kind!=="string"&&D.kind!=="number")throw new Ta('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+D.kind+", "+z.kind+") instead.")}if(this.collator&&!h&&this.hasUntypedArgument){var Z=ea(S),G=ea(I);if(Z.kind!=="string"||G.kind!=="string")return o(b,S,I)}return this.collator?u(b,S,I,this.collator.evaluate(b)):o(b,S,I)},y.prototype.eachChild=function(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)},y.prototype.outputDefined=function(){return!0},y.prototype.serialize=function(){var b=[t];return this.eachChild(function(S){b.push(S.serialize())}),b},y}()}Wi.parse=function(t,o){if(t.length<=2||t.length>=5)return o.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,en),h=o.parse(t[2],2,Tt);if(!u||!h)return null;if(!wa(u.type,[wi(en),Jr,en]))return o.error("Expected first argument to be of type array or string, but found "+yi(u.type)+" instead");if(t.length===4){var y=o.parse(t[3],3,Tt);return y?new Wi(u.type,u,h,y):null}return new Wi(u.type,u,h)},Wi.prototype.evaluate=function(t){var o=this.input.evaluate(t),u=this.beginIndex.evaluate(t);if(!Ei(o,["string","array"]))throw new Ta("Expected first argument to be of type array or string, but found "+yi(ea(o))+" instead.");if(this.endIndex){var h=this.endIndex.evaluate(t);return o.slice(u,h)}return o.slice(u)},Wi.prototype.eachChild=function(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)},Wi.prototype.outputDefined=function(){return!1},Wi.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var ys=ji("==",function(t,o,u){return o===u},Sa),lu=ji("!=",function(t,o,u){return o!==u},function(t,o,u,h){return!Sa(0,o,u,h)}),Xu=ji("<",function(t,o,u){return o<u},function(t,o,u,h){return h.compare(o,u)<0}),hf=ji(">",function(t,o,u){return o>u},function(t,o,u,h){return h.compare(o,u)>0}),ol=ji("<=",function(t,o,u){return o<=u},function(t,o,u,h){return h.compare(o,u)<=0}),kc=ji(">=",function(t,o,u){return o>=u},function(t,o,u,h){return h.compare(o,u)>=0}),Au=function(t,o,u,h,y){this.type=Jr,this.number=t,this.locale=o,this.currency=u,this.minFractionDigits=h,this.maxFractionDigits=y};Au.parse=function(t,o){if(t.length!==3)return o.error("Expected two arguments.");var u=o.parse(t[1],1,Tt);if(!u)return null;var h=t[2];if(typeof h!="object"||Array.isArray(h))return o.error("NumberFormat options argument must be an object.");var y=null;if(h.locale&&!(y=o.parse(h.locale,1,Jr)))return null;var b=null;if(h.currency&&!(b=o.parse(h.currency,1,Jr)))return null;var S=null;if(h["min-fraction-digits"]&&!(S=o.parse(h["min-fraction-digits"],1,Tt)))return null;var I=null;return h["max-fraction-digits"]&&!(I=o.parse(h["max-fraction-digits"],1,Tt))?null:new Au(u,y,b,S,I)},Au.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},Au.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},Au.prototype.outputDefined=function(){return!1},Au.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var wu=function(t){this.type=Tt,this.input=t};wu.parse=function(t,o){if(t.length!==2)return o.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?o.error("Expected argument of type string or array, but found "+yi(u.type)+" instead."):new wu(u):null},wu.prototype.evaluate=function(t){var o=this.input.evaluate(t);if(typeof o=="string"||Array.isArray(o))return o.length;throw new Ta("Expected value to be of type string or array, but found "+yi(ea(o))+" instead.")},wu.prototype.eachChild=function(t){t(this.input)},wu.prototype.outputDefined=function(){return!1},wu.prototype.serialize=function(){var t=["length"];return this.eachChild(function(o){t.push(o.serialize())}),t};var Tu={"==":ys,"!=":lu,">":hf,"<":Xu,">=":kc,"<=":ol,array:oa,at:nr,boolean:oa,case:kn,coalesce:lt,collator:Do,format:Ao,image:Zo,in:sr,"index-of":Mn,interpolate:ge,"interpolate-hcl":ge,"interpolate-lab":ge,length:wu,let:pt,literal:za,match:ri,number:oa,"number-format":Au,object:oa,slice:Wi,step:gs,string:oa,"to-boolean":ho,"to-color":ho,"to-number":ho,"to-string":ho,var:ws,within:vs};function lo(t,o){var u=o[0],h=o[1],y=o[2],b=o[3];u=u.evaluate(t),h=h.evaluate(t),y=y.evaluate(t);var S=b?b.evaluate(t):1,I=ue(u,h,y,S);if(I)throw new Ta(I);return new Ui(u/255*S,h/255*S,y/255*S,S)}function Zf(t,o){return t in o}function jf(t,o){var u=o[t];return u===void 0?null:u}function Ko(t){return{type:t}}function Lc(t){return{result:"success",value:t}}function Mu(t){return{result:"error",value:t}}function cu(t){return t["property-type"]==="data-driven"||t["property-type"]==="cross-faded-data-driven"}function df(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Il(t){return!!t.expression&&t.expression.interpolated}function Fi(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function Ol(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function Ap(t){return t}function sl(t,o,u){return t!==void 0?t:o!==void 0?o:u!==void 0?u:void 0}function Dc(t,o,u,h,y){return sl(typeof u===y?h[u]:void 0,t.default,o.default)}function Vf(t,o,u){if(Fi(u)!=="number")return sl(t.default,o.default);var h=t.stops.length;if(h===1||u<=t.stops[0][0])return t.stops[0][1];if(u>=t.stops[h-1][0])return t.stops[h-1][1];var y=uu(t.stops.map(function(b){return b[0]}),u);return t.stops[y][1]}function wp(t,o,u){var h=t.base!==void 0?t.base:1;if(Fi(u)!=="number")return sl(t.default,o.default);var y=t.stops.length;if(y===1||u<=t.stops[0][0])return t.stops[0][1];if(u>=t.stops[y-1][0])return t.stops[y-1][1];var b=uu(t.stops.map(function(G){return G[0]}),u),S=function(G,q,ne,Te){var Ie=Te-ne,k=G-ne;return Ie===0?0:q===1?k/Ie:(Math.pow(q,k)-1)/(Math.pow(q,Ie)-1)}(u,h,t.stops[b][0],t.stops[b+1][0]),I=t.stops[b][1],D=t.stops[b+1][1],z=_a[o.type]||Ap;if(t.colorSpace&&t.colorSpace!=="rgb"){var Z=K[t.colorSpace];z=function(G,q){return Z.reverse(Z.interpolate(Z.forward(G),Z.forward(q),S))}}return typeof I.evaluate=="function"?{evaluate:function(){for(var G=[],q=arguments.length;q--;)G[q]=arguments[q];var ne=I.evaluate.apply(void 0,G),Te=D.evaluate.apply(void 0,G);if(ne!==void 0&&Te!==void 0)return z(ne,Te,S)}}:z(I,D,S)}function Gf(t,o,u){return o.type==="color"?u=Ui.parse(u):o.type==="formatted"?u=gt.fromString(u.toString()):o.type==="resolvedImage"?u=aa.fromString(u.toString()):Fi(u)===o.type||o.type==="enum"&&o.values[u]||(u=void 0),sl(u,t.default,o.default)}Ka.register(Tu,{error:[{kind:"error"},[Jr],function(t,o){throw new Ta(o[0].evaluate(t))}],typeof:[Jr,[en],function(t,o){return yi(ea(o[0].evaluate(t)))}],"to-rgba":[wi(Tt,4),[Wr],function(t,o){return o[0].evaluate(t).toArray()}],rgb:[Wr,[Tt,Tt,Tt],lo],rgba:[Wr,[Tt,Tt,Tt,Tt],lo],has:{type:Br,overloads:[[[Jr],function(t,o){return Zf(o[0].evaluate(t),t.properties())}],[[Jr,vi],function(t,o){var u=o[1];return Zf(o[0].evaluate(t),u.evaluate(t))}]]},get:{type:en,overloads:[[[Jr],function(t,o){return jf(o[0].evaluate(t),t.properties())}],[[Jr,vi],function(t,o){var u=o[1];return jf(o[0].evaluate(t),u.evaluate(t))}]]},"feature-state":[en,[Jr],function(t,o){return jf(o[0].evaluate(t),t.featureState||{})}],properties:[vi,[],function(t){return t.properties()}],"geometry-type":[Jr,[],function(t){return t.geometryType()}],id:[en,[],function(t){return t.id()}],zoom:[Tt,[],function(t){return t.globals.zoom}],"heatmap-density":[Tt,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[Tt,[],function(t){return t.globals.lineProgress||0}],accumulated:[en,[],function(t){return t.globals.accumulated===void 0?null:t.globals.accumulated}],"+":[Tt,Ko(Tt),function(t,o){for(var u=0,h=0,y=o;h<y.length;h+=1)u+=y[h].evaluate(t);return u}],"*":[Tt,Ko(Tt),function(t,o){for(var u=1,h=0,y=o;h<y.length;h+=1)u*=y[h].evaluate(t);return u}],"-":{type:Tt,overloads:[[[Tt,Tt],function(t,o){var u=o[1];return o[0].evaluate(t)-u.evaluate(t)}],[[Tt],function(t,o){return-o[0].evaluate(t)}]]},"/":[Tt,[Tt,Tt],function(t,o){var u=o[1];return o[0].evaluate(t)/u.evaluate(t)}],"%":[Tt,[Tt,Tt],function(t,o){var u=o[1];return o[0].evaluate(t)%u.evaluate(t)}],ln2:[Tt,[],function(){return Math.LN2}],pi:[Tt,[],function(){return Math.PI}],e:[Tt,[],function(){return Math.E}],"^":[Tt,[Tt,Tt],function(t,o){var u=o[1];return Math.pow(o[0].evaluate(t),u.evaluate(t))}],sqrt:[Tt,[Tt],function(t,o){return Math.sqrt(o[0].evaluate(t))}],log10:[Tt,[Tt],function(t,o){return Math.log(o[0].evaluate(t))/Math.LN10}],ln:[Tt,[Tt],function(t,o){return Math.log(o[0].evaluate(t))}],log2:[Tt,[Tt],function(t,o){return Math.log(o[0].evaluate(t))/Math.LN2}],sin:[Tt,[Tt],function(t,o){return Math.sin(o[0].evaluate(t))}],cos:[Tt,[Tt],function(t,o){return Math.cos(o[0].evaluate(t))}],tan:[Tt,[Tt],function(t,o){return Math.tan(o[0].evaluate(t))}],asin:[Tt,[Tt],function(t,o){return Math.asin(o[0].evaluate(t))}],acos:[Tt,[Tt],function(t,o){return Math.acos(o[0].evaluate(t))}],atan:[Tt,[Tt],function(t,o){return Math.atan(o[0].evaluate(t))}],min:[Tt,Ko(Tt),function(t,o){return Math.min.apply(Math,o.map(function(u){return u.evaluate(t)}))}],max:[Tt,Ko(Tt),function(t,o){return Math.max.apply(Math,o.map(function(u){return u.evaluate(t)}))}],abs:[Tt,[Tt],function(t,o){return Math.abs(o[0].evaluate(t))}],round:[Tt,[Tt],function(t,o){var u=o[0].evaluate(t);return u<0?-Math.round(-u):Math.round(u)}],floor:[Tt,[Tt],function(t,o){return Math.floor(o[0].evaluate(t))}],ceil:[Tt,[Tt],function(t,o){return Math.ceil(o[0].evaluate(t))}],"filter-==":[Br,[Jr,en],function(t,o){var u=o[0],h=o[1];return t.properties()[u.value]===h.value}],"filter-id-==":[Br,[en],function(t,o){var u=o[0];return t.id()===u.value}],"filter-type-==":[Br,[Jr],function(t,o){var u=o[0];return t.geometryType()===u.value}],"filter-<":[Br,[Jr,en],function(t,o){var u=o[0],h=o[1],y=t.properties()[u.value],b=h.value;return typeof y==typeof b&&y<b}],"filter-id-<":[Br,[en],function(t,o){var u=o[0],h=t.id(),y=u.value;return typeof h==typeof y&&h<y}],"filter->":[Br,[Jr,en],function(t,o){var u=o[0],h=o[1],y=t.properties()[u.value],b=h.value;return typeof y==typeof b&&y>b}],"filter-id->":[Br,[en],function(t,o){var u=o[0],h=t.id(),y=u.value;return typeof h==typeof y&&h>y}],"filter-<=":[Br,[Jr,en],function(t,o){var u=o[0],h=o[1],y=t.properties()[u.value],b=h.value;return typeof y==typeof b&&y<=b}],"filter-id-<=":[Br,[en],function(t,o){var u=o[0],h=t.id(),y=u.value;return typeof h==typeof y&&h<=y}],"filter->=":[Br,[Jr,en],function(t,o){var u=o[0],h=o[1],y=t.properties()[u.value],b=h.value;return typeof y==typeof b&&y>=b}],"filter-id->=":[Br,[en],function(t,o){var u=o[0],h=t.id(),y=u.value;return typeof h==typeof y&&h>=y}],"filter-has":[Br,[en],function(t,o){return o[0].value in t.properties()}],"filter-has-id":[Br,[],function(t){return t.id()!==null&&t.id()!==void 0}],"filter-type-in":[Br,[wi(Jr)],function(t,o){return o[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[Br,[wi(en)],function(t,o){return o[0].value.indexOf(t.id())>=0}],"filter-in-small":[Br,[Jr,wi(en)],function(t,o){var u=o[0];return o[1].value.indexOf(t.properties()[u.value])>=0}],"filter-in-large":[Br,[Jr,wi(en)],function(t,o){var u=o[0],h=o[1];return function(y,b,S,I){for(;S<=I;){var D=S+I>>1;if(b[D]===y)return!0;b[D]>y?I=D-1:S=D+1}return!1}(t.properties()[u.value],h.value,0,h.value.length-1)}],all:{type:Br,overloads:[[[Br,Br],function(t,o){var u=o[1];return o[0].evaluate(t)&&u.evaluate(t)}],[Ko(Br),function(t,o){for(var u=0,h=o;u<h.length;u+=1)if(!h[u].evaluate(t))return!1;return!0}]]},any:{type:Br,overloads:[[[Br,Br],function(t,o){var u=o[1];return o[0].evaluate(t)||u.evaluate(t)}],[Ko(Br),function(t,o){for(var u=0,h=o;u<h.length;u+=1)if(h[u].evaluate(t))return!0;return!1}]]},"!":[Br,[Br],function(t,o){return!o[0].evaluate(t)}],"is-supported-script":[Br,[Jr],function(t,o){var u=t.globals&&t.globals.isSupportedScript;return!u||u(o[0].evaluate(t))}],upcase:[Jr,[Jr],function(t,o){return o[0].evaluate(t).toUpperCase()}],downcase:[Jr,[Jr],function(t,o){return o[0].evaluate(t).toLowerCase()}],concat:[Jr,Ko(en),function(t,o){return o.map(function(u){return _u(u.evaluate(t))}).join("")}],"resolved-locale":[Jr,[gn],function(t,o){return o[0].evaluate(t).resolvedLocale()}]});var Fc=function(t,o){this.expression=t,this._warningHistory={},this._evaluator=new sa,this._defaultValue=o?function(u){return u.type==="color"&&Ol(u.default)?new Ui(0,0,0,0):u.type==="color"?Ui.parse(u.default)||null:u.default===void 0?null:u.default}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null};function nc(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Tu}function ic(t,o){var u=new Ds(Tu,[],o?function(y){var b={color:Wr,string:Jr,number:Tt,enum:Jr,boolean:Br,formatted:Hi,resolvedImage:pi};return y.type==="array"?wi(b[y.value]||en,y.length):b[y.type]}(o):void 0),h=u.parse(t,void 0,void 0,void 0,o&&o.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?Lc(new Fc(h,o)):Mu(u.errors)}Fc.prototype.evaluateWithoutErrorHandling=function(t,o,u,h,y,b){return this._evaluator.globals=t,this._evaluator.feature=o,this._evaluator.featureState=u,this._evaluator.canonical=h,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)},Fc.prototype.evaluate=function(t,o,u,h,y,b){this._evaluator.globals=t,this._evaluator.feature=o||null,this._evaluator.featureState=u||null,this._evaluator.canonical=h,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b||null;try{var S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new Ta("Expected value to be one of "+Object.keys(this._enumValues).map(function(I){return JSON.stringify(I)}).join(", ")+", but found "+JSON.stringify(S)+" instead.");return S}catch(I){return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,typeof console!="undefined"&&console.warn(I.message)),this._defaultValue}};var Rl=function(t,o){this.kind=t,this._styleExpression=o,this.isStateDependent=t!=="constant"&&!wo(o.expression)};Rl.prototype.evaluateWithoutErrorHandling=function(t,o,u,h,y,b){return this._styleExpression.evaluateWithoutErrorHandling(t,o,u,h,y,b)},Rl.prototype.evaluate=function(t,o,u,h,y,b){return this._styleExpression.evaluate(t,o,u,h,y,b)};var ul=function(t,o,u,h){this.kind=t,this.zoomStops=u,this._styleExpression=o,this.isStateDependent=t!=="camera"&&!wo(o.expression),this.interpolationType=h};function kl(t,o){if((t=ic(t,o)).result==="error")return t;var u=t.value.expression,h=uo(u);if(!h&&!cu(o))return Mu([new pr("","data expressions not supported")]);var y=ms(u,["zoom"]);if(!y&&!df(o))return Mu([new pr("","zoom expressions not supported")]);var b=function S(I){var D=null;if(I instanceof pt)D=S(I.result);else if(I instanceof lt)for(var z=0,Z=I.args;z<Z.length&&!(D=S(Z[z]));z+=1);else(I instanceof gs||I instanceof ge)&&I.input instanceof Ka&&I.input.name==="zoom"&&(D=I);return D instanceof pr||I.eachChild(function(G){var q=S(G);q instanceof pr?D=q:!D&&q?D=new pr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):D&&q&&D!==q&&(D=new pr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),D}(u);return b||y?b instanceof pr?Mu([b]):b instanceof ge&&!Il(o)?Mu([new pr("",'"interpolate" expressions cannot be used with this property')]):Lc(b?new ul(h?"camera":"composite",t.value,b.labels,b instanceof ge?b.interpolation:void 0):new Rl(h?"constant":"source",t.value)):Mu([new pr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}ul.prototype.evaluateWithoutErrorHandling=function(t,o,u,h,y,b){return this._styleExpression.evaluateWithoutErrorHandling(t,o,u,h,y,b)},ul.prototype.evaluate=function(t,o,u,h,y,b){return this._styleExpression.evaluate(t,o,u,h,y,b)},ul.prototype.interpolationFactor=function(t,o,u){return this.interpolationType?ge.interpolationFactor(this.interpolationType,t,o,u):0};var Yu=function(t,o){this._parameters=t,this._specification=o,fr(this,function u(h,y){var b,S,I,D=y.type==="color",z=h.stops&&typeof h.stops[0][0]=="object",Z=z||!(z||h.property!==void 0),G=h.type||(Il(y)?"exponential":"interval");if(D&&((h=fr({},h)).stops&&(h.stops=h.stops.map(function(cn){return[cn[0],Ui.parse(cn[1])]})),h.default=Ui.parse(h.default?h.default:y.default)),h.colorSpace&&h.colorSpace!=="rgb"&&!K[h.colorSpace])throw new Error("Unknown color space: "+h.colorSpace);if(G==="exponential")b=wp;else if(G==="interval")b=Vf;else if(G==="categorical"){b=Dc,S=Object.create(null);for(var q=0,ne=h.stops;q<ne.length;q+=1){var Te=ne[q];S[Te[0]]=Te[1]}I=typeof h.stops[0][0]}else{if(G!=="identity")throw new Error('Unknown function type "'+G+'"');b=Gf}if(z){for(var Ie={},k=[],Ue=0;Ue<h.stops.length;Ue++){var rt=h.stops[Ue],_t=rt[0].zoom;Ie[_t]===void 0&&(Ie[_t]={zoom:_t,type:h.type,property:h.property,default:h.default,stops:[]},k.push(_t)),Ie[_t].stops.push([rt[0].value,rt[1]])}for(var zt=[],Vt=0,ir=k;Vt<ir.length;Vt+=1){var Tr=ir[Vt];zt.push([Ie[Tr].zoom,u(Ie[Tr],y)])}var Dr={name:"linear"};return{kind:"composite",interpolationType:Dr,interpolationFactor:ge.interpolationFactor.bind(void 0,Dr),zoomStops:zt.map(function(cn){return cn[0]}),evaluate:function(cn,Vn){var pn=cn.zoom;return wp({stops:zt,base:h.base},y,pn).evaluate(pn,Vn)}}}if(Z){var Dn=G==="exponential"?{name:"exponential",base:h.base!==void 0?h.base:1}:null;return{kind:"camera",interpolationType:Dn,interpolationFactor:ge.interpolationFactor.bind(void 0,Dn),zoomStops:h.stops.map(function(cn){return cn[0]}),evaluate:function(cn){return b(h,y,cn.zoom,S,I)}}}return{kind:"source",evaluate:function(cn,Vn){var pn=Vn&&Vn.properties?Vn.properties[h.property]:void 0;return pn===void 0?sl(h.default,y.default):b(h,y,pn,S,I)}}}(this._parameters,this._specification))};function Ys(t){var o=t.key,u=t.value,h=t.valueSpec||{},y=t.objectElementValidators||{},b=t.style,S=t.styleSpec,I=[],D=Fi(u);if(D!=="object")return[new Le(o,u,"object expected, "+D+" found")];for(var z in u){var Z=z.split(".")[0],G=h[Z]||h["*"],q=void 0;if(y[Z])q=y[Z];else if(h[Z])q=Xi;else if(y["*"])q=y["*"];else{if(!h["*"]){I.push(new Le(o,u[z],'unknown property "'+z+'"'));continue}q=Xi}I=I.concat(q({key:(o&&o+".")+z,value:u[z],valueSpec:G,style:b,styleSpec:S,object:u,objectKey:z},u))}for(var ne in h)y[ne]||h[ne].required&&h[ne].default===void 0&&u[ne]===void 0&&I.push(new Le(o,u,'missing required property "'+ne+'"'));return I}function vf(t){var o=t.value,u=t.valueSpec,h=t.style,y=t.styleSpec,b=t.key,S=t.arrayElementValidator||Xi;if(Fi(o)!=="array")return[new Le(b,o,"array expected, "+Fi(o)+" found")];if(u.length&&o.length!==u.length)return[new Le(b,o,"array length "+u.length+" expected, length "+o.length+" found")];if(u["min-length"]&&o.length<u["min-length"])return[new Le(b,o,"array length at least "+u["min-length"]+" expected, length "+o.length+" found")];var I={type:u.value,values:u.values};y.$version<7&&(I.function=u.function),Fi(u.value)==="object"&&(I=u.value);for(var D=[],z=0;z<o.length;z++)D=D.concat(S({array:o,arrayIndex:z,value:o[z],valueSpec:I,style:h,styleSpec:y,key:b+"["+z+"]"}));return D}function mf(t){var o=t.key,u=t.value,h=t.valueSpec,y=Fi(u);return y==="number"&&u!=u&&(y="NaN"),y!=="number"?[new Le(o,u,"number expected, "+y+" found")]:"minimum"in h&&u<h.minimum?[new Le(o,u,u+" is less than the minimum value "+h.minimum)]:"maximum"in h&&u>h.maximum?[new Le(o,u,u+" is greater than the maximum value "+h.maximum)]:[]}function Hf(t){var o,u,h,y=t.valueSpec,b=kt(t.value.type),S={},I=b!=="categorical"&&t.value.property===void 0,D=!I,z=Fi(t.value.stops)==="array"&&Fi(t.value.stops[0])==="array"&&Fi(t.value.stops[0][0])==="object",Z=Ys({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(ne){if(b==="identity")return[new Le(ne.key,ne.value,'identity function may not have a "stops" property')];var Te=[],Ie=ne.value;return Te=Te.concat(vf({key:ne.key,value:Ie,valueSpec:ne.valueSpec,style:ne.style,styleSpec:ne.styleSpec,arrayElementValidator:G})),Fi(Ie)==="array"&&Ie.length===0&&Te.push(new Le(ne.key,Ie,"array must have at least one stop")),Te},default:function(ne){return Xi({key:ne.key,value:ne.value,valueSpec:y,style:ne.style,styleSpec:ne.styleSpec})}}});return b==="identity"&&I&&Z.push(new Le(t.key,t.value,'missing required property "property"')),b==="identity"||t.value.stops||Z.push(new Le(t.key,t.value,'missing required property "stops"')),b==="exponential"&&t.valueSpec.expression&&!Il(t.valueSpec)&&Z.push(new Le(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(D&&!cu(t.valueSpec)?Z.push(new Le(t.key,t.value,"property functions not supported")):I&&!df(t.valueSpec)&&Z.push(new Le(t.key,t.value,"zoom functions not supported"))),b!=="categorical"&&!z||t.value.property!==void 0||Z.push(new Le(t.key,t.value,'"property" property is required')),Z;function G(ne){var Te=[],Ie=ne.value,k=ne.key;if(Fi(Ie)!=="array")return[new Le(k,Ie,"array expected, "+Fi(Ie)+" found")];if(Ie.length!==2)return[new Le(k,Ie,"array length 2 expected, length "+Ie.length+" found")];if(z){if(Fi(Ie[0])!=="object")return[new Le(k,Ie,"object expected, "+Fi(Ie[0])+" found")];if(Ie[0].zoom===void 0)return[new Le(k,Ie,"object stop key must have zoom")];if(Ie[0].value===void 0)return[new Le(k,Ie,"object stop key must have value")];if(h&&h>kt(Ie[0].zoom))return[new Le(k,Ie[0].zoom,"stop zoom values must appear in ascending order")];kt(Ie[0].zoom)!==h&&(h=kt(Ie[0].zoom),u=void 0,S={}),Te=Te.concat(Ys({key:k+"[0]",value:Ie[0],valueSpec:{zoom:{}},style:ne.style,styleSpec:ne.styleSpec,objectElementValidators:{zoom:mf,value:q}}))}else Te=Te.concat(q({key:k+"[0]",value:Ie[0],valueSpec:{},style:ne.style,styleSpec:ne.styleSpec},Ie));return nc(Ft(Ie[1]))?Te.concat([new Le(k+"[1]",Ie[1],"expressions are not allowed in function stops.")]):Te.concat(Xi({key:k+"[1]",value:Ie[1],valueSpec:y,style:ne.style,styleSpec:ne.styleSpec}))}function q(ne,Te){var Ie=Fi(ne.value),k=kt(ne.value),Ue=ne.value!==null?ne.value:Te;if(o){if(Ie!==o)return[new Le(ne.key,Ue,Ie+" stop domain type must match previous stop domain type "+o)]}else o=Ie;if(Ie!=="number"&&Ie!=="string"&&Ie!=="boolean")return[new Le(ne.key,Ue,"stop domain value must be a number, string, or boolean")];if(Ie!=="number"&&b!=="categorical"){var rt="number expected, "+Ie+" found";return cu(y)&&b===void 0&&(rt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Le(ne.key,Ue,rt)]}return b!=="categorical"||Ie!=="number"||isFinite(k)&&Math.floor(k)===k?b!=="categorical"&&Ie==="number"&&u!==void 0&&k<u?[new Le(ne.key,Ue,"stop domain values must appear in ascending order")]:(u=k,b==="categorical"&&k in S?[new Le(ne.key,Ue,"stop domain values must be unique")]:(S[k]=!0,[])):[new Le(ne.key,Ue,"integer expected, found "+k)]}}function fu(t){var o=(t.expressionContext==="property"?kl:ic)(Ft(t.value),t.valueSpec);if(o.result==="error")return o.value.map(function(h){return new Le(""+t.key+h.key,t.value,h.message)});var u=o.value.expression||o.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!u.outputDefined())return[new Le(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!wo(u))return[new Le(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter"&&!wo(u))return[new Le(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!ms(u,["zoom","feature-state"]))return[new Le(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!uo(u))return[new Le(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ac(t){var o=t.key,u=t.value,h=t.valueSpec,y=[];return Array.isArray(h.values)?h.values.indexOf(kt(u))===-1&&y.push(new Le(o,u,"expected one of ["+h.values.join(", ")+"], "+JSON.stringify(u)+" found")):Object.keys(h.values).indexOf(kt(u))===-1&&y.push(new Le(o,u,"expected one of ["+Object.keys(h.values).join(", ")+"], "+JSON.stringify(u)+" found")),y}function Bc(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var o=0,u=t.slice(1);o<u.length;o+=1){var h=u[o];if(!Bc(h)&&typeof h!="boolean")return!1}return!0;default:return!0}}Yu.deserialize=function(t){return new Yu(t._parameters,t._specification)},Yu.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var gf={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ll(t){if(t==null)return{filter:function(){return!0},needGeometry:!1};Bc(t)||(t=yf(t));var o=ic(t,gf);if(o.result==="error")throw new Error(o.value.map(function(u){return u.key+": "+u.message}).join(", "));return{filter:function(u,h,y){return o.value.evaluate(u,h,{},y)},needGeometry:function u(h){if(!Array.isArray(h))return!1;if(h[0]==="within")return!0;for(var y=1;y<h.length;y++)if(u(h[y]))return!0;return!1}(t)}}function uh(t,o){return t<o?-1:t>o?1:0}function yf(t){if(!t)return!0;var o,u=t[0];return t.length<=1?u!=="any":u==="=="?Dl(t[1],t[2],"=="):u==="!="?Fl(Dl(t[1],t[2],"==")):u==="<"||u===">"||u==="<="||u===">="?Dl(t[1],t[2],u):u==="any"?(o=t.slice(1),["any"].concat(o.map(yf))):u==="all"?["all"].concat(t.slice(1).map(yf)):u==="none"?["all"].concat(t.slice(1).map(yf).map(Fl)):u==="in"?_f(t[1],t.slice(2)):u==="!in"?Fl(_f(t[1],t.slice(2))):u==="has"?xf(t[1]):u==="!has"?Fl(xf(t[1])):u!=="within"||t}function Dl(t,o,u){switch(t){case"$type":return["filter-type-"+u,o];case"$id":return["filter-id-"+u,o];default:return["filter-"+u,t,o]}}function _f(t,o){if(o.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(function(u){return typeof u!=typeof o[0]})?["filter-in-large",t,["literal",o.sort(uh)]]:["filter-in-small",t,["literal",o]]}}function xf(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Fl(t){return["!",t]}function Nc(t){return Bc(Ft(t.value))?fu(fr({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function o(u){var h=u.value,y=u.key;if(Fi(h)!=="array")return[new Le(y,h,"array expected, "+Fi(h)+" found")];var b,S=u.styleSpec,I=[];if(h.length<1)return[new Le(y,h,"filter array must have at least 1 element")];switch(I=I.concat(ac({key:y+"[0]",value:h[0],valueSpec:S.filter_operator,style:u.style,styleSpec:u.styleSpec})),kt(h[0])){case"<":case"<=":case">":case">=":h.length>=2&&kt(h[1])==="$type"&&I.push(new Le(y,h,'"$type" cannot be use with operator "'+h[0]+'"'));case"==":case"!=":h.length!==3&&I.push(new Le(y,h,'filter array for operator "'+h[0]+'" must have 3 elements'));case"in":case"!in":h.length>=2&&(b=Fi(h[1]))!=="string"&&I.push(new Le(y+"[1]",h[1],"string expected, "+b+" found"));for(var D=2;D<h.length;D++)b=Fi(h[D]),kt(h[1])==="$type"?I=I.concat(ac({key:y+"["+D+"]",value:h[D],valueSpec:S.geometry_type,style:u.style,styleSpec:u.styleSpec})):b!=="string"&&b!=="number"&&b!=="boolean"&&I.push(new Le(y+"["+D+"]",h[D],"string, number, or boolean expected, "+b+" found"));break;case"any":case"all":case"none":for(var z=1;z<h.length;z++)I=I.concat(o({key:y+"["+z+"]",value:h[z],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":b=Fi(h[1]),h.length!==2?I.push(new Le(y,h,'filter array for "'+h[0]+'" operator must have 2 elements')):b!=="string"&&I.push(new Le(y+"[1]",h[1],"string expected, "+b+" found"));break;case"within":b=Fi(h[1]),h.length!==2?I.push(new Le(y,h,'filter array for "'+h[0]+'" operator must have 2 elements')):b!=="object"&&I.push(new Le(y+"[1]",h[1],"object expected, "+b+" found"))}return I}(t)}function Tp(t,o){var u=t.key,h=t.style,y=t.styleSpec,b=t.value,S=t.objectKey,I=y[o+"_"+t.layerType];if(!I)return[];var D=S.match(/^(.*)-transition$/);if(o==="paint"&&D&&I[D[1]]&&I[D[1]].transition)return Xi({key:u,value:b,valueSpec:y.transition,style:h,styleSpec:y});var z,Z=t.valueSpec||I[S];if(!Z)return[new Le(u,b,'unknown property "'+S+'"')];if(Fi(b)==="string"&&cu(Z)&&!Z.tokens&&(z=/^{([^}]+)}$/.exec(b)))return[new Le(u,b,'"'+S+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(z[1])+" }`.")];var G=[];return t.layerType==="symbol"&&(S==="text-field"&&h&&!h.glyphs&&G.push(new Le(u,b,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&Ol(Ft(b))&&kt(b.type)==="identity"&&G.push(new Le(u,b,'"text-font" does not support identity functions'))),G.concat(Xi({key:t.key,value:b,valueSpec:Z,style:h,styleSpec:y,expressionContext:"property",propertyType:o,propertyKey:S}))}function Mp(t){return Tp(t,"paint")}function oc(t){return Tp(t,"layout")}function Pp(t){var o=[],u=t.value,h=t.key,y=t.style,b=t.styleSpec;u.type||u.ref||o.push(new Le(h,u,'either "type" or "ref" is required'));var S,I=kt(u.type),D=kt(u.ref);if(u.id)for(var z=kt(u.id),Z=0;Z<t.arrayIndex;Z++){var G=y.layers[Z];kt(G.id)===z&&o.push(new Le(h,u.id,'duplicate layer id "'+u.id+'", previously used at line '+G.id.__line__))}if("ref"in u)["type","source","source-layer","filter","layout"].forEach(function(Te){Te in u&&o.push(new Le(h,u[Te],'"'+Te+'" is prohibited for ref layers'))}),y.layers.forEach(function(Te){kt(Te.id)===D&&(S=Te)}),S?S.ref?o.push(new Le(h,u.ref,"ref cannot reference another ref layer")):I=kt(S.type):o.push(new Le(h,u.ref,'ref layer "'+D+'" not found'));else if(I!=="background")if(u.source){var q=y.sources&&y.sources[u.source],ne=q&&kt(q.type);q?ne==="vector"&&I==="raster"?o.push(new Le(h,u.source,'layer "'+u.id+'" requires a raster source')):ne==="raster"&&I!=="raster"?o.push(new Le(h,u.source,'layer "'+u.id+'" requires a vector source')):ne!=="vector"||u["source-layer"]?ne==="raster-dem"&&I!=="hillshade"?o.push(new Le(h,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):I!=="line"||!u.paint||!u.paint["line-gradient"]||ne==="geojson"&&q.lineMetrics||o.push(new Le(h,u,'layer "'+u.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):o.push(new Le(h,u,'layer "'+u.id+'" must specify a "source-layer"')):o.push(new Le(h,u.source,'source "'+u.source+'" not found'))}else o.push(new Le(h,u,'missing required property "source"'));return o=o.concat(Ys({key:h,value:u,valueSpec:b.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Xi({key:h+".type",value:u.type,valueSpec:b.layer.type,style:t.style,styleSpec:t.styleSpec,object:u,objectKey:"type"})},filter:Nc,layout:function(Te){return Ys({layer:u,key:Te.key,value:Te.value,style:Te.style,styleSpec:Te.styleSpec,objectElementValidators:{"*":function(Ie){return oc(fr({layerType:I},Ie))}}})},paint:function(Te){return Ys({layer:u,key:Te.key,value:Te.value,style:Te.style,styleSpec:Te.styleSpec,objectElementValidators:{"*":function(Ie){return Mp(fr({layerType:I},Ie))}}})}}}))}function Bl(t){var o=t.value,u=t.key,h=Fi(o);return h!=="string"?[new Le(u,o,"string expected, "+h+" found")]:[]}var $i={promoteId:function(t){var o=t.key,u=t.value;if(Fi(u)==="string")return Bl({key:o,value:u});var h=[];for(var y in u)h.push.apply(h,Bl({key:o+"."+y,value:u[y]}));return h}};function sc(t){var o=t.value,u=t.key,h=t.styleSpec,y=t.style;if(!o.type)return[new Le(u,o,'"type" is required')];var b,S=kt(o.type);switch(S){case"vector":case"raster":case"raster-dem":return Ys({key:u,value:o,valueSpec:h["source_"+S.replace("-","_")],style:t.style,styleSpec:h,objectElementValidators:$i});case"geojson":if(b=Ys({key:u,value:o,valueSpec:h.source_geojson,style:y,styleSpec:h,objectElementValidators:$i}),o.cluster)for(var I in o.clusterProperties){var D=o.clusterProperties[I],z=D[0],Z=typeof z=="string"?[z,["accumulated"],["get",I]]:z;b.push.apply(b,fu({key:u+"."+I+".map",value:D[1],expressionContext:"cluster-map"})),b.push.apply(b,fu({key:u+"."+I+".reduce",value:Z,expressionContext:"cluster-reduce"}))}return b;case"video":return Ys({key:u,value:o,valueSpec:h.source_video,style:y,styleSpec:h});case"image":return Ys({key:u,value:o,valueSpec:h.source_image,style:y,styleSpec:h});case"canvas":return[new Le(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ac({key:u+".type",value:o.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:y,styleSpec:h})}}function ca(t){var o=t.value,u=t.styleSpec,h=u.light,y=t.style,b=[],S=Fi(o);if(o===void 0)return b;if(S!=="object")return b.concat([new Le("light",o,"object expected, "+S+" found")]);for(var I in o){var D=I.match(/^(.*)-transition$/);b=b.concat(D&&h[D[1]]&&h[D[1]].transition?Xi({key:I,value:o[I],valueSpec:u.transition,style:y,styleSpec:u}):h[I]?Xi({key:I,value:o[I],valueSpec:h[I],style:y,styleSpec:u}):[new Le(I,o[I],'unknown property "'+I+'"')])}return b}var Pu={"*":function(){return[]},array:vf,boolean:function(t){var o=t.value,u=t.key,h=Fi(o);return h!=="boolean"?[new Le(u,o,"boolean expected, "+h+" found")]:[]},number:mf,color:function(t){var o=t.key,u=t.value,h=Fi(u);return h!=="string"?[new Le(o,u,"color expected, "+h+" found")]:Ti(u)===null?[new Le(o,u,'color expected, "'+u+'" found')]:[]},constants:ht,enum:ac,filter:Nc,function:Hf,layer:Pp,object:Ys,source:sc,light:ca,string:Bl,formatted:function(t){return Bl(t).length===0?[]:fu(t)},resolvedImage:function(t){return Bl(t).length===0?[]:fu(t)}};function Xi(t){var o=t.value,u=t.valueSpec,h=t.styleSpec;return u.expression&&Ol(kt(o))?Hf(t):u.expression&&nc(Ft(o))?fu(t):u.type&&Pu[u.type]?Pu[u.type](t):Ys(fr({},t,{valueSpec:u.type?h[u.type]:u}))}function Ma(t){var o=t.value,u=t.key,h=Bl(t);return h.length||(o.indexOf("{fontstack}")===-1&&h.push(new Le(u,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&h.push(new Le(u,o,'"glyphs" url must include a "{range}" token'))),h}function _s(t,o){o===void 0&&(o=oe);var u=[];return u=u.concat(Xi({key:"",value:t,valueSpec:o.$root,styleSpec:o,style:t,objectElementValidators:{glyphs:Ma,"*":function(){return[]}}})),t.constants&&(u=u.concat(ht({key:"constants",value:t.constants,style:t,styleSpec:o}))),zc(u)}function zc(t){return[].concat(t).sort(function(o,u){return o.line-u.line})}function qu(t){return function(){for(var o=[],u=arguments.length;u--;)o[u]=arguments[u];return zc(t.apply(this,o))}}_s.source=qu(sc),_s.light=qu(ca),_s.layer=qu(Pp),_s.filter=qu(Nc),_s.paintProperty=qu(Mp),_s.layoutProperty=qu(oc);var Za=_s,uc=Za.light,Nl=Za.paintProperty,Ku=Za.layoutProperty;function Uc(t,o){var u=!1;if(o&&o.length)for(var h=0,y=o;h<y.length;h+=1)t.fire(new Ge(new Error(y[h].message))),u=!0;return u}var Iu=vo;function vo(t,o,u){var h=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var y=new Int32Array(this.arrayBuffer);t=y[0],this.d=(o=y[1])+2*(u=y[2]);for(var b=0;b<this.d*this.d;b++){var S=y[3+b],I=y[3+b+1];h.push(S===I?null:y.subarray(S,I))}var D=y[3+h.length+1];this.keys=y.subarray(y[3+h.length],D),this.bboxes=y.subarray(D),this.insert=this._insertReadonly}else{this.d=o+2*u;for(var z=0;z<this.d*this.d;z++)h.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=t,this.padding=u,this.scale=o/t,this.uid=0;var Z=u/o*t;this.min=-Z,this.max=t+Z}vo.prototype.insert=function(t,o,u,h,y){this._forEachCell(o,u,h,y,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(h),this.bboxes.push(y)},vo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},vo.prototype._insertCell=function(t,o,u,h,y,b){this.cells[y].push(b)},vo.prototype.query=function(t,o,u,h,y){var b=this.min,S=this.max;if(t<=b&&o<=b&&S<=u&&S<=h&&!y)return Array.prototype.slice.call(this.keys);var I=[];return this._forEachCell(t,o,u,h,this._queryCell,I,{},y),I},vo.prototype._queryCell=function(t,o,u,h,y,b,S,I){var D=this.cells[y];if(D!==null)for(var z=this.keys,Z=this.bboxes,G=0;G<D.length;G++){var q=D[G];if(S[q]===void 0){var ne=4*q;(I?I(Z[ne+0],Z[ne+1],Z[ne+2],Z[ne+3]):t<=Z[ne+2]&&o<=Z[ne+3]&&u>=Z[ne+0]&&h>=Z[ne+1])?(S[q]=!0,b.push(z[q])):S[q]=!1}}},vo.prototype._forEachCell=function(t,o,u,h,y,b,S,I){for(var D=this._convertToCellCoord(t),z=this._convertToCellCoord(o),Z=this._convertToCellCoord(u),G=this._convertToCellCoord(h),q=D;q<=Z;q++)for(var ne=z;ne<=G;ne++){var Te=this.d*ne+q;if((!I||I(this._convertFromCellCoord(q),this._convertFromCellCoord(ne),this._convertFromCellCoord(q+1),this._convertFromCellCoord(ne+1)))&&y.call(this,t,o,u,h,Te,b,S,I))return}},vo.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},vo.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},vo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,o=3+this.cells.length+1+1,u=0,h=0;h<this.cells.length;h++)u+=this.cells[h].length;var y=new Int32Array(o+u+this.keys.length+this.bboxes.length);y[0]=this.extent,y[1]=this.n,y[2]=this.padding;for(var b=o,S=0;S<t.length;S++){var I=t[S];y[3+S]=b,y.set(I,b),b+=I.length}return y[3+t.length]=b,y.set(this.keys,b),y[3+t.length+1]=b+=this.keys.length,y.set(this.bboxes,b),b+=this.bboxes.length,y.buffer};var zl=_e.ImageData,lc=_e.ImageBitmap,mo={};function hn(t,o,u){u===void 0&&(u={}),Object.defineProperty(o,"_classRegistryKey",{value:t,writeable:!1}),mo[t]={klass:o,omit:u.omit||[],shallow:u.shallow||[]}}for(var co in hn("Object",Object),Iu.serialize=function(t,o){var u=t.toArrayBuffer();return o&&o.push(u),{buffer:u}},Iu.deserialize=function(t){return new Iu(t.buffer)},hn("Grid",Iu),hn("Color",Ui),hn("Error",Error),hn("ResolvedImage",aa),hn("StylePropertyFunction",Yu),hn("StyleExpression",Fc,{omit:["_evaluator"]}),hn("ZoomDependentExpression",ul),hn("ZoomConstantExpression",Rl),hn("CompoundExpression",Ka,{omit:["_evaluate"]}),Tu)Tu[co]._classRegistryKey||hn("Expression_"+co,Tu[co]);function $u(t){return t&&typeof ArrayBuffer!="undefined"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function ka(t){return lc&&t instanceof lc}function qs(t,o){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if($u(t)||ka(t))return o&&o.push(t),t;if(ArrayBuffer.isView(t)){var u=t;return o&&o.push(u.buffer),u}if(t instanceof zl)return o&&o.push(t.data.buffer),t;if(Array.isArray(t)){for(var h=[],y=0,b=t;y<b.length;y+=1)h.push(qs(b[y],o));return h}if(typeof t=="object"){var S=t.constructor,I=S._classRegistryKey;if(!I)throw new Error("can't serialize object of unregistered class");var D=S.serialize?S.serialize(t,o):{};if(!S.serialize){for(var z in t)if(t.hasOwnProperty(z)&&!(mo[I].omit.indexOf(z)>=0)){var Z=t[z];D[z]=mo[I].shallow.indexOf(z)>=0?Z:qs(Z,o)}t instanceof Error&&(D.message=t.message)}if(D.$name)throw new Error("$name property is reserved for worker serialization logic.");return I!=="Object"&&(D.$name=I),D}throw new Error("can't serialize object of type "+typeof t)}function Ts(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||$u(t)||ka(t)||ArrayBuffer.isView(t)||t instanceof zl)return t;if(Array.isArray(t))return t.map(Ts);if(typeof t=="object"){var o=t.$name||"Object",u=mo[o].klass;if(!u)throw new Error("can't deserialize unregistered class "+o);if(u.deserialize)return u.deserialize(t);for(var h=Object.create(u.prototype),y=0,b=Object.keys(t);y<b.length;y+=1){var S=b[y];if(S!=="$name"){var I=t[S];h[S]=mo[o].shallow.indexOf(S)>=0?I:Ts(I)}}return h}throw new Error("can't deserialize object of type "+typeof t)}var bf=function(){this.first=!0};bf.prototype.update=function(t,o){var u=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=o):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=o),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=u,!0))};var Zr={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function cc(t){for(var o=0,u=t;o<u.length;o+=1)if(Ef(u[o].charCodeAt(0)))return!0;return!1}function Ef(t){return!(t!==746&&t!==747&&(t<4352||!(Zr["Bopomofo Extended"](t)||Zr.Bopomofo(t)||Zr["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Zr["CJK Compatibility Ideographs"](t)||Zr["CJK Compatibility"](t)||Zr["CJK Radicals Supplement"](t)||Zr["CJK Strokes"](t)||!(!Zr["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||Zr["CJK Unified Ideographs Extension A"](t)||Zr["CJK Unified Ideographs"](t)||Zr["Enclosed CJK Letters and Months"](t)||Zr["Hangul Compatibility Jamo"](t)||Zr["Hangul Jamo Extended-A"](t)||Zr["Hangul Jamo Extended-B"](t)||Zr["Hangul Jamo"](t)||Zr["Hangul Syllables"](t)||Zr.Hiragana(t)||Zr["Ideographic Description Characters"](t)||Zr.Kanbun(t)||Zr["Kangxi Radicals"](t)||Zr["Katakana Phonetic Extensions"](t)||Zr.Katakana(t)&&t!==12540||!(!Zr["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!Zr["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Zr["Unified Canadian Aboriginal Syllabics"](t)||Zr["Unified Canadian Aboriginal Syllabics Extended"](t)||Zr["Vertical Forms"](t)||Zr["Yijing Hexagram Symbols"](t)||Zr["Yi Syllables"](t)||Zr["Yi Radicals"](t))))}function ll(t){return!(Ef(t)||function(o){return!!(Zr["Latin-1 Supplement"](o)&&(o===167||o===169||o===174||o===177||o===188||o===189||o===190||o===215||o===247)||Zr["General Punctuation"](o)&&(o===8214||o===8224||o===8225||o===8240||o===8241||o===8251||o===8252||o===8258||o===8263||o===8264||o===8265||o===8273)||Zr["Letterlike Symbols"](o)||Zr["Number Forms"](o)||Zr["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||o===9003||o>=9085&&o<=9114||o>=9150&&o<=9165||o===9167||o>=9169&&o<=9179||o>=9186&&o<=9215)||Zr["Control Pictures"](o)&&o!==9251||Zr["Optical Character Recognition"](o)||Zr["Enclosed Alphanumerics"](o)||Zr["Geometric Shapes"](o)||Zr["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||Zr["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||Zr["CJK Symbols and Punctuation"](o)||Zr.Katakana(o)||Zr["Private Use Area"](o)||Zr["CJK Compatibility Forms"](o)||Zr["Small Form Variants"](o)||Zr["Halfwidth and Fullwidth Forms"](o)||o===8734||o===8756||o===8757||o>=9984&&o<=10087||o>=10102&&o<=10131||o===65532||o===65533)}(t))}function Ca(t){return t>=1424&&t<=2303||Zr["Arabic Presentation Forms-A"](t)||Zr["Arabic Presentation Forms-B"](t)}function xs(t,o){return!(!o&&Ca(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Zr.Khmer(t))}function Sf(t){for(var o=0,u=t;o<u.length;o+=1)if(Ca(u[o].charCodeAt(0)))return!0;return!1}var Ou=null,Fs="unavailable",Ru=null,Wf=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(Fs="error"),Ou&&Ou(t)};function cl(){Xf.fire(new Me("pluginStateChange",{pluginStatus:Fs,pluginURL:Ru}))}var Xf=new Qe,Cf=function(){return Fs},pu=function(){if(Fs!=="deferred"||!Ru)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Fs="loading",cl(),Ru&&Na({url:Ru},function(t){t?Wf(t):(Fs="loaded",cl())})},Ms={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Fs==="loaded"||Ms.applyArabicShaping!=null},isLoading:function(){return Fs==="loading"},setState:function(t){Fs=t.pluginStatus,Ru=t.pluginURL},isParsed:function(){return Ms.applyArabicShaping!=null&&Ms.processBidirectionalText!=null&&Ms.processStyledBidirectionalText!=null},getPluginURL:function(){return Ru}},Ai=function(t,o){this.zoom=t,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.zoomHistory=o.zoomHistory,this.transition=o.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new bf,this.transition={})};Ai.prototype.isSupportedScript=function(t){return function(o,u){for(var h=0,y=o;h<y.length;h+=1)if(!xs(y[h].charCodeAt(0),u))return!1;return!0}(t,Ms.isLoaded())},Ai.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Ai.prototype.getCrossfadeParameters=function(){var t=this.zoom,o=t-Math.floor(t),u=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:o+(1-o)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*o}};var ku=function(t,o){this.property=t,this.value=o,this.expression=function(u,h){if(Ol(u))return new Yu(u,h);if(nc(u)){var y=kl(u,h);if(y.result==="error")throw new Error(y.value.map(function(S){return S.key+": "+S.message}).join(", "));return y.value}var b=u;return typeof u=="string"&&h.type==="color"&&(b=Ui.parse(u)),{kind:"constant",evaluate:function(){return b}}}(o===void 0?t.specification.default:o,t.specification)};ku.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},ku.prototype.possiblyEvaluate=function(t,o,u){return this.property.possiblyEvaluate(this,t,o,u)};var hu=function(t){this.property=t,this.value=new ku(t,void 0)};hu.prototype.transitioned=function(t,o){return new fl(this.property,this.value,o,At({},t.transition,this.transition),t.now)},hu.prototype.untransitioned=function(){return new fl(this.property,this.value,null,{},0)};var Vo=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};Vo.prototype.getValue=function(t){return qe(this._values[t].value.value)},Vo.prototype.setValue=function(t,o){this._values.hasOwnProperty(t)||(this._values[t]=new hu(this._values[t].property)),this._values[t].value=new ku(this._values[t].property,o===null?void 0:qe(o))},Vo.prototype.getTransition=function(t){return qe(this._values[t].transition)},Vo.prototype.setTransition=function(t,o){this._values.hasOwnProperty(t)||(this._values[t]=new hu(this._values[t].property)),this._values[t].transition=qe(o)||void 0},Vo.prototype.serialize=function(){for(var t={},o=0,u=Object.keys(this._values);o<u.length;o+=1){var h=u[o],y=this.getValue(h);y!==void 0&&(t[h]=y);var b=this.getTransition(h);b!==void 0&&(t[h+"-transition"]=b)}return t},Vo.prototype.transitioned=function(t,o){for(var u=new ns(this._properties),h=0,y=Object.keys(this._values);h<y.length;h+=1){var b=y[h];u._values[b]=this._values[b].transitioned(t,o._values[b])}return u},Vo.prototype.untransitioned=function(){for(var t=new ns(this._properties),o=0,u=Object.keys(this._values);o<u.length;o+=1){var h=u[o];t._values[h]=this._values[h].untransitioned()}return t};var fl=function(t,o,u,h,y){this.property=t,this.value=o,this.begin=y+h.delay||0,this.end=this.begin+h.duration||0,t.specification.transition&&(h.delay||h.duration)&&(this.prior=u)};fl.prototype.possiblyEvaluate=function(t,o,u){var h=t.now||0,y=this.value.possiblyEvaluate(t,o,u),b=this.prior;if(b){if(h>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(h<this.begin)return b.possiblyEvaluate(t,o,u);var S=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(t,o,u),y,function(I){if(I<=0)return 0;if(I>=1)return 1;var D=I*I,z=D*I;return 4*(I<.5?z:3*(I-D)+z-.75)}(S))}return y};var ns=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};ns.prototype.possiblyEvaluate=function(t,o,u){for(var h=new xu(this._properties),y=0,b=Object.keys(this._values);y<b.length;y+=1){var S=b[y];h._values[S]=this._values[S].possiblyEvaluate(t,o,u)}return h},ns.prototype.hasTransition=function(){for(var t=0,o=Object.keys(this._values);t<o.length;t+=1)if(this._values[o[t]].prior)return!0;return!1};var Ks=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};Ks.prototype.getValue=function(t){return qe(this._values[t].value)},Ks.prototype.setValue=function(t,o){this._values[t]=new ku(this._values[t].property,o===null?void 0:qe(o))},Ks.prototype.serialize=function(){for(var t={},o=0,u=Object.keys(this._values);o<u.length;o+=1){var h=u[o],y=this.getValue(h);y!==void 0&&(t[h]=y)}return t},Ks.prototype.possiblyEvaluate=function(t,o,u){for(var h=new xu(this._properties),y=0,b=Object.keys(this._values);y<b.length;y+=1){var S=b[y];h._values[S]=this._values[S].possiblyEvaluate(t,o,u)}return h};var bs=function(t,o,u){this.property=t,this.value=o,this.parameters=u};bs.prototype.isConstant=function(){return this.value.kind==="constant"},bs.prototype.constantOr=function(t){return this.value.kind==="constant"?this.value.value:t},bs.prototype.evaluate=function(t,o,u,h){return this.property.evaluate(this.value,this.parameters,t,o,u,h)};var xu=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};xu.prototype.get=function(t){return this._values[t]};var Rn=function(t){this.specification=t};Rn.prototype.possiblyEvaluate=function(t,o){return t.expression.evaluate(o)},Rn.prototype.interpolate=function(t,o,u){var h=_a[this.specification.type];return h?h(t,o,u):t};var Cn=function(t,o){this.specification=t,this.overrides=o};Cn.prototype.possiblyEvaluate=function(t,o,u,h){return new bs(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(o,null,{},u,h)}:t.expression,o)},Cn.prototype.interpolate=function(t,o,u){if(t.value.kind!=="constant"||o.value.kind!=="constant")return t;if(t.value.value===void 0||o.value.value===void 0)return new bs(this,{kind:"constant",value:void 0},t.parameters);var h=_a[this.specification.type];return h?new bs(this,{kind:"constant",value:h(t.value.value,o.value.value,u)},t.parameters):t},Cn.prototype.evaluate=function(t,o,u,h,y,b){return t.kind==="constant"?t.value:t.evaluate(o,u,h,y,b)};var Zc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.possiblyEvaluate=function(u,h,y,b){if(u.value===void 0)return new bs(this,{kind:"constant",value:void 0},h);if(u.expression.kind==="constant"){var S=u.expression.evaluate(h,null,{},y,b),I=u.property.specification.type==="resolvedImage"&&typeof S!="string"?S.name:S,D=this._calculate(I,I,I,h);return new bs(this,{kind:"constant",value:D},h)}if(u.expression.kind==="camera"){var z=this._calculate(u.expression.evaluate({zoom:h.zoom-1}),u.expression.evaluate({zoom:h.zoom}),u.expression.evaluate({zoom:h.zoom+1}),h);return new bs(this,{kind:"constant",value:z},h)}return new bs(this,u.expression,h)},o.prototype.evaluate=function(u,h,y,b,S,I){if(u.kind==="source"){var D=u.evaluate(h,y,b,S,I);return this._calculate(D,D,D,h)}return u.kind==="composite"?this._calculate(u.evaluate({zoom:Math.floor(h.zoom)-1},y,b),u.evaluate({zoom:Math.floor(h.zoom)},y,b),u.evaluate({zoom:Math.floor(h.zoom)+1},y,b),h):u.value},o.prototype._calculate=function(u,h,y,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:u,to:h}:{from:y,to:h}},o.prototype.interpolate=function(u){return u},o}(Cn),$o=function(t){this.specification=t};$o.prototype.possiblyEvaluate=function(t,o,u,h){if(t.value!==void 0){if(t.expression.kind==="constant"){var y=t.expression.evaluate(o,null,{},u,h);return this._calculate(y,y,y,o)}return this._calculate(t.expression.evaluate(new Ai(Math.floor(o.zoom-1),o)),t.expression.evaluate(new Ai(Math.floor(o.zoom),o)),t.expression.evaluate(new Ai(Math.floor(o.zoom+1),o)),o)}},$o.prototype._calculate=function(t,o,u,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:o}:{from:u,to:o}},$o.prototype.interpolate=function(t){return t};var $s=function(t){this.specification=t};$s.prototype.possiblyEvaluate=function(t,o,u,h){return!!t.expression.evaluate(o,null,{},u,h)},$s.prototype.interpolate=function(){return!1};var Go=function(t){for(var o in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var u=t[o];u.specification.overridable&&this.overridableProperties.push(o);var h=this.defaultPropertyValues[o]=new ku(u,void 0),y=this.defaultTransitionablePropertyValues[o]=new hu(u);this.defaultTransitioningPropertyValues[o]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=h.possiblyEvaluate({})}};hn("DataDrivenProperty",Cn),hn("DataConstantProperty",Rn),hn("CrossFadedDataDrivenProperty",Zc),hn("CrossFadedProperty",$o),hn("ColorRampProperty",$s);var du=function(t){function o(u,h){if(t.call(this),this.id=u.id,this.type=u.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},u.type!=="custom"&&(this.metadata=(u=u).metadata,this.minzoom=u.minzoom,this.maxzoom=u.maxzoom,u.type!=="background"&&(this.source=u.source,this.sourceLayer=u["source-layer"],this.filter=u.filter),h.layout&&(this._unevaluatedLayout=new Ks(h.layout)),h.paint)){for(var y in this._transitionablePaint=new Vo(h.paint),u.paint)this.setPaintProperty(y,u.paint[y],{validate:!1});for(var b in u.layout)this.setLayoutProperty(b,u.layout[b],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new xu(h.paint)}}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},o.prototype.getLayoutProperty=function(u){return u==="visibility"?this.visibility:this._unevaluatedLayout.getValue(u)},o.prototype.setLayoutProperty=function(u,h,y){y===void 0&&(y={}),h!=null&&this._validate(Ku,"layers."+this.id+".layout."+u,u,h,y)||(u!=="visibility"?this._unevaluatedLayout.setValue(u,h):this.visibility=h)},o.prototype.getPaintProperty=function(u){return X(u,"-transition")?this._transitionablePaint.getTransition(u.slice(0,-"-transition".length)):this._transitionablePaint.getValue(u)},o.prototype.setPaintProperty=function(u,h,y){if(y===void 0&&(y={}),h!=null&&this._validate(Nl,"layers."+this.id+".paint."+u,u,h,y))return!1;if(X(u,"-transition"))return this._transitionablePaint.setTransition(u.slice(0,-"-transition".length),h||void 0),!1;var b=this._transitionablePaint._values[u],S=b.property.specification["property-type"]==="cross-faded-data-driven",I=b.value.isDataDriven(),D=b.value;this._transitionablePaint.setValue(u,h),this._handleSpecialPaintPropertyUpdate(u);var z=this._transitionablePaint._values[u].value;return z.isDataDriven()||I||S||this._handleOverridablePaintPropertyUpdate(u,D,z)},o.prototype._handleSpecialPaintPropertyUpdate=function(u){},o.prototype._handleOverridablePaintPropertyUpdate=function(u,h,y){return!1},o.prototype.isHidden=function(u){return!!(this.minzoom&&u<this.minzoom)||!!(this.maxzoom&&u>=this.maxzoom)||this.visibility==="none"},o.prototype.updateTransitions=function(u){this._transitioningPaint=this._transitionablePaint.transitioned(u,this._transitioningPaint)},o.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},o.prototype.recalculate=function(u,h){u.getCrossfadeParameters&&(this._crossfadeParameters=u.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(u,void 0,h)),this.paint=this._transitioningPaint.possiblyEvaluate(u,void 0,h)},o.prototype.serialize=function(){var u={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(u.layout=u.layout||{},u.layout.visibility=this.visibility),at(u,function(h,y){return!(h===void 0||y==="layout"&&!Object.keys(h).length||y==="paint"&&!Object.keys(h).length)})},o.prototype._validate=function(u,h,y,b,S){return S===void 0&&(S={}),(!S||S.validate!==!1)&&Uc(this,u.call(Za,{key:h,layerType:this.type,objectKey:y,value:b,styleSpec:oe,style:{glyphs:!0,sprite:!0}}))},o.prototype.is3D=function(){return!1},o.prototype.isTileClipped=function(){return!1},o.prototype.hasOffscreenPass=function(){return!1},o.prototype.resize=function(){},o.prototype.isStateDependent=function(){for(var u in this.paint._values){var h=this.paint.get(u);if(h instanceof bs&&cu(h.property.specification)&&(h.value.kind==="source"||h.value.kind==="composite")&&h.value.isStateDependent)return!0}return!1},o}(Qe),Yf={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},jc=function(t,o){this._structArray=t,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},ga=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function La(t,o){o===void 0&&(o=1);var u=0,h=0;return{members:t.map(function(y){var b=Yf[y.type].BYTES_PER_ELEMENT,S=u=pl(u,Math.max(o,b)),I=y.components||1;return h=Math.max(h,b),u+=b*I,{name:y.name,type:y.type,components:I,offset:S}}),size:pl(u,Math.max(h,o)),alignment:o}}function pl(t,o){return Math.ceil(t/o)*o}ga.serialize=function(t,o){return t._trim(),o&&(t.isTransferred=!0,o.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},ga.deserialize=function(t){var o=Object.create(this.prototype);return o.arrayBuffer=t.arrayBuffer,o.length=t.length,o.capacity=t.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o},ga.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},ga.prototype.clear=function(){this.length=0},ga.prototype.resize=function(t){this.reserve(t),this.length=t},ga.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}},ga.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var fc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h){var y=this.length;return this.resize(y+1),this.emplace(y,u,h)},o.prototype.emplace=function(u,h,y){var b=2*u;return this.int16[b+0]=h,this.int16[b+1]=y,u},o}(ga);fc.prototype.bytesPerElement=4,hn("StructArrayLayout2i4",fc);var Qs=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b){var S=this.length;return this.resize(S+1),this.emplace(S,u,h,y,b)},o.prototype.emplace=function(u,h,y,b,S){var I=4*u;return this.int16[I+0]=h,this.int16[I+1]=y,this.int16[I+2]=b,this.int16[I+3]=S,u},o}(ga);Qs.prototype.bytesPerElement=8,hn("StructArrayLayout4i8",Qs);var vu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,I){var D=this.length;return this.resize(D+1),this.emplace(D,u,h,y,b,S,I)},o.prototype.emplace=function(u,h,y,b,S,I,D){var z=6*u;return this.int16[z+0]=h,this.int16[z+1]=y,this.int16[z+2]=b,this.int16[z+3]=S,this.int16[z+4]=I,this.int16[z+5]=D,u},o}(ga);vu.prototype.bytesPerElement=12,hn("StructArrayLayout2i4i12",vu);var _i=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,I){var D=this.length;return this.resize(D+1),this.emplace(D,u,h,y,b,S,I)},o.prototype.emplace=function(u,h,y,b,S,I,D){var z=4*u,Z=8*u;return this.int16[z+0]=h,this.int16[z+1]=y,this.uint8[Z+4]=b,this.uint8[Z+5]=S,this.uint8[Z+6]=I,this.uint8[Z+7]=D,u},o}(ga);_i.prototype.bytesPerElement=8,hn("StructArrayLayout2i4ub8",_i);var Bs=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h){var y=this.length;return this.resize(y+1),this.emplace(y,u,h)},o.prototype.emplace=function(u,h,y){var b=2*u;return this.float32[b+0]=h,this.float32[b+1]=y,u},o}(ga);Bs.prototype.bytesPerElement=8,hn("StructArrayLayout2f8",Bs);var Ps=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,I,D,z,Z,G){var q=this.length;return this.resize(q+1),this.emplace(q,u,h,y,b,S,I,D,z,Z,G)},o.prototype.emplace=function(u,h,y,b,S,I,D,z,Z,G,q){var ne=10*u;return this.uint16[ne+0]=h,this.uint16[ne+1]=y,this.uint16[ne+2]=b,this.uint16[ne+3]=S,this.uint16[ne+4]=I,this.uint16[ne+5]=D,this.uint16[ne+6]=z,this.uint16[ne+7]=Z,this.uint16[ne+8]=G,this.uint16[ne+9]=q,u},o}(ga);Ps.prototype.bytesPerElement=20,hn("StructArrayLayout10ui20",Ps);var hl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,I,D,z,Z,G,q,ne){var Te=this.length;return this.resize(Te+1),this.emplace(Te,u,h,y,b,S,I,D,z,Z,G,q,ne)},o.prototype.emplace=function(u,h,y,b,S,I,D,z,Z,G,q,ne,Te){var Ie=12*u;return this.int16[Ie+0]=h,this.int16[Ie+1]=y,this.int16[Ie+2]=b,this.int16[Ie+3]=S,this.uint16[Ie+4]=I,this.uint16[Ie+5]=D,this.uint16[Ie+6]=z,this.uint16[Ie+7]=Z,this.int16[Ie+8]=G,this.int16[Ie+9]=q,this.int16[Ie+10]=ne,this.int16[Ie+11]=Te,u},o}(ga);hl.prototype.bytesPerElement=24,hn("StructArrayLayout4i4ui4i24",hl);var Lu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,h,y)},o.prototype.emplace=function(u,h,y,b){var S=3*u;return this.float32[S+0]=h,this.float32[S+1]=y,this.float32[S+2]=b,u},o}(ga);Lu.prototype.bytesPerElement=12,hn("StructArrayLayout3f12",Lu);var Qu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var h=this.length;return this.resize(h+1),this.emplace(h,u)},o.prototype.emplace=function(u,h){return this.uint32[1*u+0]=h,u},o}(ga);Qu.prototype.bytesPerElement=4,hn("StructArrayLayout1ul4",Qu);var Vc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,I,D,z,Z){var G=this.length;return this.resize(G+1),this.emplace(G,u,h,y,b,S,I,D,z,Z)},o.prototype.emplace=function(u,h,y,b,S,I,D,z,Z,G){var q=10*u,ne=5*u;return this.int16[q+0]=h,this.int16[q+1]=y,this.int16[q+2]=b,this.int16[q+3]=S,this.int16[q+4]=I,this.int16[q+5]=D,this.uint32[ne+3]=z,this.uint16[q+8]=Z,this.uint16[q+9]=G,u},o}(ga);Vc.prototype.bytesPerElement=20,hn("StructArrayLayout6i1ul2ui20",Vc);var Pa=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,I){var D=this.length;return this.resize(D+1),this.emplace(D,u,h,y,b,S,I)},o.prototype.emplace=function(u,h,y,b,S,I,D){var z=6*u;return this.int16[z+0]=h,this.int16[z+1]=y,this.int16[z+2]=b,this.int16[z+3]=S,this.int16[z+4]=I,this.int16[z+5]=D,u},o}(ga);Pa.prototype.bytesPerElement=12,hn("StructArrayLayout2i2i2i12",Pa);var Js=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S){var I=this.length;return this.resize(I+1),this.emplace(I,u,h,y,b,S)},o.prototype.emplace=function(u,h,y,b,S,I){var D=4*u,z=8*u;return this.float32[D+0]=h,this.float32[D+1]=y,this.float32[D+2]=b,this.int16[z+6]=S,this.int16[z+7]=I,u},o}(ga);Js.prototype.bytesPerElement=16,hn("StructArrayLayout2f1f2i16",Js);var Ul=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b){var S=this.length;return this.resize(S+1),this.emplace(S,u,h,y,b)},o.prototype.emplace=function(u,h,y,b,S){var I=12*u,D=3*u;return this.uint8[I+0]=h,this.uint8[I+1]=y,this.float32[D+1]=b,this.float32[D+2]=S,u},o}(ga);Ul.prototype.bytesPerElement=12,hn("StructArrayLayout2ub2f12",Ul);var dl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,h,y)},o.prototype.emplace=function(u,h,y,b){var S=3*u;return this.uint16[S+0]=h,this.uint16[S+1]=y,this.uint16[S+2]=b,u},o}(ga);dl.prototype.bytesPerElement=6,hn("StructArrayLayout3ui6",dl);var vl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,I,D,z,Z,G,q,ne,Te,Ie,k,Ue,rt){var _t=this.length;return this.resize(_t+1),this.emplace(_t,u,h,y,b,S,I,D,z,Z,G,q,ne,Te,Ie,k,Ue,rt)},o.prototype.emplace=function(u,h,y,b,S,I,D,z,Z,G,q,ne,Te,Ie,k,Ue,rt,_t){var zt=24*u,Vt=12*u,ir=48*u;return this.int16[zt+0]=h,this.int16[zt+1]=y,this.uint16[zt+2]=b,this.uint16[zt+3]=S,this.uint32[Vt+2]=I,this.uint32[Vt+3]=D,this.uint32[Vt+4]=z,this.uint16[zt+10]=Z,this.uint16[zt+11]=G,this.uint16[zt+12]=q,this.float32[Vt+7]=ne,this.float32[Vt+8]=Te,this.uint8[ir+36]=Ie,this.uint8[ir+37]=k,this.uint8[ir+38]=Ue,this.uint32[Vt+10]=rt,this.int16[zt+22]=_t,u},o}(ga);vl.prototype.bytesPerElement=48,hn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",vl);var Gc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,I,D,z,Z,G,q,ne,Te,Ie,k,Ue,rt,_t,zt,Vt,ir,Tr,Dr,Dn,cn,Vn,pn,Pi){var ei=this.length;return this.resize(ei+1),this.emplace(ei,u,h,y,b,S,I,D,z,Z,G,q,ne,Te,Ie,k,Ue,rt,_t,zt,Vt,ir,Tr,Dr,Dn,cn,Vn,pn,Pi)},o.prototype.emplace=function(u,h,y,b,S,I,D,z,Z,G,q,ne,Te,Ie,k,Ue,rt,_t,zt,Vt,ir,Tr,Dr,Dn,cn,Vn,pn,Pi,ei){var wn=34*u,Zi=17*u;return this.int16[wn+0]=h,this.int16[wn+1]=y,this.int16[wn+2]=b,this.int16[wn+3]=S,this.int16[wn+4]=I,this.int16[wn+5]=D,this.int16[wn+6]=z,this.int16[wn+7]=Z,this.uint16[wn+8]=G,this.uint16[wn+9]=q,this.uint16[wn+10]=ne,this.uint16[wn+11]=Te,this.uint16[wn+12]=Ie,this.uint16[wn+13]=k,this.uint16[wn+14]=Ue,this.uint16[wn+15]=rt,this.uint16[wn+16]=_t,this.uint16[wn+17]=zt,this.uint16[wn+18]=Vt,this.uint16[wn+19]=ir,this.uint16[wn+20]=Tr,this.uint16[wn+21]=Dr,this.uint16[wn+22]=Dn,this.uint32[Zi+12]=cn,this.float32[Zi+13]=Vn,this.float32[Zi+14]=pn,this.float32[Zi+15]=Pi,this.float32[Zi+16]=ei,u},o}(ga);Gc.prototype.bytesPerElement=68,hn("StructArrayLayout8i15ui1ul4f68",Gc);var ml=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var h=this.length;return this.resize(h+1),this.emplace(h,u)},o.prototype.emplace=function(u,h){return this.float32[1*u+0]=h,u},o}(ga);ml.prototype.bytesPerElement=4,hn("StructArrayLayout1f4",ml);var eu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,h,y)},o.prototype.emplace=function(u,h,y,b){var S=3*u;return this.int16[S+0]=h,this.int16[S+1]=y,this.int16[S+2]=b,u},o}(ga);eu.prototype.bytesPerElement=6,hn("StructArrayLayout3i6",eu);var pc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,h,y)},o.prototype.emplace=function(u,h,y,b){var S=4*u;return this.uint32[2*u+0]=h,this.uint16[S+2]=y,this.uint16[S+3]=b,u},o}(ga);pc.prototype.bytesPerElement=8,hn("StructArrayLayout1ul2ui8",pc);var Zl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h){var y=this.length;return this.resize(y+1),this.emplace(y,u,h)},o.prototype.emplace=function(u,h,y){var b=2*u;return this.uint16[b+0]=h,this.uint16[b+1]=y,u},o}(ga);Zl.prototype.bytesPerElement=4,hn("StructArrayLayout2ui4",Zl);var qf=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var h=this.length;return this.resize(h+1),this.emplace(h,u)},o.prototype.emplace=function(u,h){return this.uint16[1*u+0]=h,u},o}(ga);qf.prototype.bytesPerElement=2,hn("StructArrayLayout1ui2",qf);var jl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b){var S=this.length;return this.resize(S+1),this.emplace(S,u,h,y,b)},o.prototype.emplace=function(u,h,y,b,S){var I=4*u;return this.float32[I+0]=h,this.float32[I+1]=y,this.float32[I+2]=b,this.float32[I+3]=S,u},o}(ga);jl.prototype.bytesPerElement=16,hn("StructArrayLayout4f16",jl);var l=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return u.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},u.x1.get=function(){return this._structArray.int16[this._pos2+2]},u.y1.get=function(){return this._structArray.int16[this._pos2+3]},u.x2.get=function(){return this._structArray.int16[this._pos2+4]},u.y2.get=function(){return this._structArray.int16[this._pos2+5]},u.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},u.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},u.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},u.anchorPoint.get=function(){return new de(this.anchorPointX,this.anchorPointY)},Object.defineProperties(o.prototype,u),o}(jc);l.prototype.size=20;var f=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new l(this,u)},o}(Vc);hn("CollisionBoxArray",f);var c=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return u.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},u.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},u.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},u.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},u.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},u.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},u.segment.get=function(){return this._structArray.uint16[this._pos2+10]},u.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},u.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},u.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},u.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},u.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},u.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},u.placedOrientation.set=function(h){this._structArray.uint8[this._pos1+37]=h},u.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},u.hidden.set=function(h){this._structArray.uint8[this._pos1+38]=h},u.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},u.crossTileID.set=function(h){this._structArray.uint32[this._pos4+10]=h},u.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(o.prototype,u),o}(jc);c.prototype.size=48;var d=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new c(this,u)},o}(vl);hn("PlacedSymbolArray",d);var E=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return u.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},u.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},u.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},u.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},u.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},u.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},u.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},u.key.get=function(){return this._structArray.uint16[this._pos2+8]},u.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},u.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},u.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},u.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},u.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},u.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},u.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},u.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},u.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},u.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},u.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},u.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},u.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},u.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},u.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},u.crossTileID.set=function(h){this._structArray.uint32[this._pos4+12]=h},u.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},u.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},u.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},u.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(o.prototype,u),o}(jc);E.prototype.size=68;var w=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new E(this,u)},o}(Gc);hn("SymbolInstanceArray",w);var P=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getoffsetX=function(u){return this.float32[1*u+0]},o}(ml);hn("GlyphOffsetArray",P);var L=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getx=function(u){return this.int16[3*u+0]},o.prototype.gety=function(u){return this.int16[3*u+1]},o.prototype.gettileUnitDistanceFromAnchor=function(u){return this.int16[3*u+2]},o}(eu);hn("SymbolLineVertexArray",L);var U=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return u.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},u.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},u.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(o.prototype,u),o}(jc);U.prototype.size=8;var H=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new U(this,u)},o}(pc);hn("FeatureIndexArray",H);var ae=La([{name:"a_pos",components:2,type:"Int16"}],4).members,se=function(t){t===void 0&&(t=[]),this.segments=t};function le(t,o){return 256*(t=Bt(Math.floor(t),0,255))+Bt(Math.floor(o),0,255)}se.prototype.prepareSegment=function(t,o,u,h){var y=this.segments[this.segments.length-1];return t>se.MAX_VERTEX_ARRAY_LENGTH&&$e("Max vertices per segment is "+se.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!y||y.vertexLength+t>se.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==h)&&(y={vertexOffset:o.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},h!==void 0&&(y.sortKey=h),this.segments.push(y)),y},se.prototype.get=function(){return this.segments},se.prototype.destroy=function(){for(var t=0,o=this.segments;t<o.length;t+=1){var u=o[t];for(var h in u.vaos)u.vaos[h].destroy()}},se.simpleSegment=function(t,o,u,h){return new se([{vertexOffset:t,primitiveOffset:o,vertexLength:u,primitiveLength:h,vaos:{},sortKey:0}])},se.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,hn("SegmentVector",se);var Oe=La([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Pe=Re(function(t){t.exports=function(o,u){var h,y,b,S,I,D,z,Z;for(y=o.length-(h=3&o.length),b=u,I=3432918353,D=461845907,Z=0;Z<y;)z=255&o.charCodeAt(Z)|(255&o.charCodeAt(++Z))<<8|(255&o.charCodeAt(++Z))<<16|(255&o.charCodeAt(++Z))<<24,++Z,b=27492+(65535&(S=5*(65535&(b=(b^=z=(65535&(z=(z=(65535&z)*I+(((z>>>16)*I&65535)<<16)&4294967295)<<15|z>>>17))*D+(((z>>>16)*D&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(z=0,h){case 3:z^=(255&o.charCodeAt(Z+2))<<16;case 2:z^=(255&o.charCodeAt(Z+1))<<8;case 1:b^=z=(65535&(z=(z=(65535&(z^=255&o.charCodeAt(Z)))*I+(((z>>>16)*I&65535)<<16)&4294967295)<<15|z>>>17))*D+(((z>>>16)*D&65535)<<16)&4294967295}return b^=o.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0}}),Ne=Re(function(t){t.exports=function(o,u){for(var h,y=o.length,b=u^y,S=0;y>=4;)h=1540483477*(65535&(h=255&o.charCodeAt(S)|(255&o.charCodeAt(++S))<<8|(255&o.charCodeAt(++S))<<16|(255&o.charCodeAt(++S))<<24))+((1540483477*(h>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),y-=4,++S;switch(y){case 3:b^=(255&o.charCodeAt(S+2))<<16;case 2:b^=(255&o.charCodeAt(S+1))<<8;case 1:b=1540483477*(65535&(b^=255&o.charCodeAt(S)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0}}),xe=Pe,je=Ne;xe.murmur3=Pe,xe.murmur2=je;var Ke=function(){this.ids=[],this.positions=[],this.indexed=!1};Ke.prototype.add=function(t,o,u,h){this.ids.push(Wt(t)),this.positions.push(o,u,h)},Ke.prototype.getPositions=function(t){for(var o=Wt(t),u=0,h=this.ids.length-1;u<h;){var y=u+h>>1;this.ids[y]>=o?h=y:u=y+1}for(var b=[];this.ids[u]===o;)b.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return b},Ke.serialize=function(t,o){var u=new Float64Array(t.ids),h=new Uint32Array(t.positions);return function y(b,S,I,D){for(;I<D;){for(var z=b[I+D>>1],Z=I-1,G=D+1;;){do Z++;while(b[Z]<z);do G--;while(b[G]>z);if(Z>=G)break;Zt(b,Z,G),Zt(S,3*Z,3*G),Zt(S,3*Z+1,3*G+1),Zt(S,3*Z+2,3*G+2)}G-I<D-G?(y(b,S,I,G),I=G+1):(y(b,S,G+1,D),D=G)}}(u,h,0,u.length-1),o&&o.push(u.buffer,h.buffer),{ids:u,positions:h}},Ke.deserialize=function(t){var o=new Ke;return o.ids=t.ids,o.positions=t.positions,o.indexed=!0,o};var vt=Math.pow(2,53)-1;function Wt(t){var o=+t;return!isNaN(o)&&o<=vt?o:xe(String(t))}function Zt(t,o,u){var h=t[o];t[o]=t[u],t[u]=h}hn("FeaturePositionMap",Ke);var qt=function(t,o){this.gl=t.gl,this.location=o},hr=function(t){function o(u,h){t.call(this,u,h),this.current=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))},o}(qt),kr=function(t){function o(u,h){t.call(this,u,h),this.current=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))},o}(qt),yr=function(t){function o(u,h){t.call(this,u,h),this.current=[0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1]))},o}(qt),sn=function(t){function o(u,h){t.call(this,u,h),this.current=[0,0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2]))},o}(qt),Zn=function(t){function o(u,h){t.call(this,u,h),this.current=[0,0,0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3]))},o}(qt),jn=function(t){function o(u,h){t.call(this,u,h),this.current=Ui.transparent}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a))},o}(qt),Ln=new Float32Array(16),Ri=function(t){function o(u,h){t.call(this,u,h),this.current=Ln}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(var h=1;h<16;h++)if(u[h]!==this.current[h]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}},o}(qt);function tn(t){return[le(255*t.r,255*t.g),le(255*t.b,255*t.a)]}var ni=function(t,o,u){this.value=t,this.uniformNames=o.map(function(h){return"u_"+h}),this.type=u};ni.prototype.setUniform=function(t,o,u){t.set(u.constantOr(this.value))},ni.prototype.getBinding=function(t,o,u){return this.type==="color"?new jn(t,o):new kr(t,o)};var li=function(t,o){this.uniformNames=o.map(function(u){return"u_"+u}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};li.prototype.setConstantPatternPositions=function(t,o){this.pixelRatioFrom=o.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=o.tlbr,this.patternTo=t.tlbr},li.prototype.setUniform=function(t,o,u,h){var y=h==="u_pattern_to"?this.patternTo:h==="u_pattern_from"?this.patternFrom:h==="u_pixel_ratio_to"?this.pixelRatioTo:h==="u_pixel_ratio_from"?this.pixelRatioFrom:null;y&&t.set(y)},li.prototype.getBinding=function(t,o,u){return u.substr(0,9)==="u_pattern"?new Zn(t,o):new kr(t,o)};var Kn=function(t,o,u,h){this.expression=t,this.type=u,this.maxValue=0,this.paintVertexAttributes=o.map(function(y){return{name:"a_"+y,type:"Float32",components:u==="color"?2:1,offset:0}}),this.paintVertexArray=new h};Kn.prototype.populatePaintArray=function(t,o,u,h,y){var b=this.paintVertexArray.length,S=this.expression.evaluate(new Ai(0),o,{},h,[],y);this.paintVertexArray.resize(t),this._setPaintValue(b,t,S)},Kn.prototype.updatePaintArray=function(t,o,u,h){var y=this.expression.evaluate({zoom:0},u,h);this._setPaintValue(t,o,y)},Kn.prototype._setPaintValue=function(t,o,u){if(this.type==="color")for(var h=tn(u),y=t;y<o;y++)this.paintVertexArray.emplace(y,h[0],h[1]);else{for(var b=t;b<o;b++)this.paintVertexArray.emplace(b,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}},Kn.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Kn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Hn=function(t,o,u,h,y,b){this.expression=t,this.uniformNames=o.map(function(S){return"u_"+S+"_t"}),this.type=u,this.useIntegerZoom=h,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=o.map(function(S){return{name:"a_"+S,type:"Float32",components:u==="color"?4:2,offset:0}}),this.paintVertexArray=new b};Hn.prototype.populatePaintArray=function(t,o,u,h,y){var b=this.expression.evaluate(new Ai(this.zoom),o,{},h,[],y),S=this.expression.evaluate(new Ai(this.zoom+1),o,{},h,[],y),I=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(I,t,b,S)},Hn.prototype.updatePaintArray=function(t,o,u,h){var y=this.expression.evaluate({zoom:this.zoom},u,h),b=this.expression.evaluate({zoom:this.zoom+1},u,h);this._setPaintValue(t,o,y,b)},Hn.prototype._setPaintValue=function(t,o,u,h){if(this.type==="color")for(var y=tn(u),b=tn(h),S=t;S<o;S++)this.paintVertexArray.emplace(S,y[0],y[1],b[0],b[1]);else{for(var I=t;I<o;I++)this.paintVertexArray.emplace(I,u,h);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(h))}},Hn.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Hn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Hn.prototype.setUniform=function(t,o){var u=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,h=Bt(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);t.set(h)},Hn.prototype.getBinding=function(t,o,u){return new kr(t,o)};var hi=function(t,o,u,h,y,b){this.expression=t,this.type=o,this.useIntegerZoom=u,this.zoom=h,this.layerId=b,this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y};hi.prototype.populatePaintArray=function(t,o,u){var h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(h,t,o.patterns&&o.patterns[this.layerId],u)},hi.prototype.updatePaintArray=function(t,o,u,h,y){this._setPaintValues(t,o,u.patterns&&u.patterns[this.layerId],y)},hi.prototype._setPaintValues=function(t,o,u,h){if(h&&u){var y=h[u.min],b=h[u.mid],S=h[u.max];if(y&&b&&S)for(var I=t;I<o;I++)this.zoomInPaintVertexArray.emplace(I,b.tl[0],b.tl[1],b.br[0],b.br[1],y.tl[0],y.tl[1],y.br[0],y.br[1],b.pixelRatio,y.pixelRatio),this.zoomOutPaintVertexArray.emplace(I,b.tl[0],b.tl[1],b.br[0],b.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],b.pixelRatio,S.pixelRatio)}},hi.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Oe.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Oe.members,this.expression.isStateDependent))},hi.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var qn=function(t,o,u){this.binders={},this._buffers=[];var h=[];for(var y in t.paint._values)if(u(y)){var b=t.paint.get(y);if(b instanceof bs&&cu(b.property.specification)){var S=go(y,t.type),I=b.value,D=b.property.specification.type,z=b.property.useIntegerZoom,Z=b.property.specification["property-type"],G=Z==="cross-faded"||Z==="cross-faded-data-driven";if(I.kind==="constant")this.binders[y]=G?new li(I.value,S):new ni(I.value,S,D),h.push("/u_"+y);else if(I.kind==="source"||G){var q=Qa(y,D,"source");this.binders[y]=G?new hi(I,D,z,o,q,t.id):new Kn(I,S,D,q),h.push("/a_"+y)}else{var ne=Qa(y,D,"composite");this.binders[y]=new Hn(I,S,D,z,o,ne),h.push("/z_"+y)}}}this.cacheKey=h.sort().join("")};qn.prototype.getMaxValue=function(t){var o=this.binders[t];return o instanceof Kn||o instanceof Hn?o.maxValue:0},qn.prototype.populatePaintArrays=function(t,o,u,h,y){for(var b in this.binders){var S=this.binders[b];(S instanceof Kn||S instanceof Hn||S instanceof hi)&&S.populatePaintArray(t,o,u,h,y)}},qn.prototype.setConstantPatternPositions=function(t,o){for(var u in this.binders){var h=this.binders[u];h instanceof li&&h.setConstantPatternPositions(t,o)}},qn.prototype.updatePaintArrays=function(t,o,u,h,y){var b=!1;for(var S in t)for(var I=0,D=o.getPositions(S);I<D.length;I+=1){var z=D[I],Z=u.feature(z.index);for(var G in this.binders){var q=this.binders[G];if((q instanceof Kn||q instanceof Hn||q instanceof hi)&&q.expression.isStateDependent===!0){var ne=h.paint.get(G);q.expression=ne.value,q.updatePaintArray(z.start,z.end,Z,t[S],y),b=!0}}}return b},qn.prototype.defines=function(){var t=[];for(var o in this.binders){var u=this.binders[o];(u instanceof ni||u instanceof li)&&t.push.apply(t,u.uniformNames.map(function(h){return"#define HAS_UNIFORM_"+h}))}return t},qn.prototype.getBinderAttributes=function(){var t=[];for(var o in this.binders){var u=this.binders[o];if(u instanceof Kn||u instanceof Hn)for(var h=0;h<u.paintVertexAttributes.length;h++)t.push(u.paintVertexAttributes[h].name);else if(u instanceof hi)for(var y=0;y<Oe.members.length;y++)t.push(Oe.members[y].name)}return t},qn.prototype.getBinderUniforms=function(){var t=[];for(var o in this.binders){var u=this.binders[o];if(u instanceof ni||u instanceof li||u instanceof Hn)for(var h=0,y=u.uniformNames;h<y.length;h+=1)t.push(y[h])}return t},qn.prototype.getPaintVertexBuffers=function(){return this._buffers},qn.prototype.getUniforms=function(t,o){var u=[];for(var h in this.binders){var y=this.binders[h];if(y instanceof ni||y instanceof li||y instanceof Hn)for(var b=0,S=y.uniformNames;b<S.length;b+=1){var I=S[b];if(o[I]){var D=y.getBinding(t,o[I],I);u.push({name:I,property:h,binding:D})}}}return u},qn.prototype.setUniforms=function(t,o,u,h){for(var y=0,b=o;y<b.length;y+=1){var S=b[y],I=S.name,D=S.property;this.binders[D].setUniform(S.binding,h,u.get(D),I)}},qn.prototype.updatePaintBuffers=function(t){for(var o in this._buffers=[],this.binders){var u=this.binders[o];if(t&&u instanceof hi){var h=t.fromScale===2?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(u instanceof Kn||u instanceof Hn)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}},qn.prototype.upload=function(t){for(var o in this.binders){var u=this.binders[o];(u instanceof Kn||u instanceof Hn||u instanceof hi)&&u.upload(t)}this.updatePaintBuffers()},qn.prototype.destroy=function(){for(var t in this.binders){var o=this.binders[t];(o instanceof Kn||o instanceof Hn||o instanceof hi)&&o.destroy()}};var Xn=function(t,o,u){u===void 0&&(u=function(){return!0}),this.programConfigurations={};for(var h=0,y=t;h<y.length;h+=1){var b=y[h];this.programConfigurations[b.id]=new qn(b,o,u)}this.needsUpload=!1,this._featureMap=new Ke,this._bufferOffset=0};function go(t,o){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(o+"-","").replace(/-/g,"_")]}function Qa(t,o,u){var h={color:{source:Bs,composite:jl},number:{source:ml,composite:Bs}},y=function(b){return{"line-pattern":{source:Ps,composite:Ps},"fill-pattern":{source:Ps,composite:Ps},"fill-extrusion-pattern":{source:Ps,composite:Ps}}[b]}(t);return y&&y[u]||h[o][u]}Xn.prototype.populatePaintArrays=function(t,o,u,h,y,b){for(var S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(t,o,h,y,b);o.id!==void 0&&this._featureMap.add(o.id,u,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0},Xn.prototype.updatePaintArrays=function(t,o,u,h){for(var y=0,b=u;y<b.length;y+=1){var S=b[y];this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(t,this._featureMap,o,S,h)||this.needsUpload}},Xn.prototype.get=function(t){return this.programConfigurations[t]},Xn.prototype.upload=function(t){if(this.needsUpload){for(var o in this.programConfigurations)this.programConfigurations[o].upload(t);this.needsUpload=!1}},Xn.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},hn("ConstantBinder",ni),hn("CrossFadedConstantBinder",li),hn("SourceExpressionBinder",Kn),hn("CrossFadedCompositeBinder",hi),hn("CompositeExpressionBinder",Hn),hn("ProgramConfiguration",qn,{omit:["_buffers"]}),hn("ProgramConfigurationSet",Xn);var To=Math.pow(2,14)-1,Da=-To-1;function Ga(t){for(var o=8192/t.extent,u=t.loadGeometry(),h=0;h<u.length;h++)for(var y=u[h],b=0;b<y.length;b++){var S=y[b],I=Math.round(S.x*o),D=Math.round(S.y*o);S.x=Bt(I,Da,To),S.y=Bt(D,Da,To),(I<S.x||I>S.x+1||D<S.y||D>S.y+1)&&$e("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return u}function fo(t,o){return{type:t.type,id:t.id,properties:t.properties,geometry:o?Ga(t):[]}}function Is(t,o,u,h,y){t.emplaceBack(2*o+(h+1)/2,2*u+(y+1)/2)}var is=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new fc,this.indexArray=new dl,this.segments=new se,this.programConfigurations=new Xn(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};function Du(t,o){for(var u=0;u<t.length;u++)if(tu(o,t[u]))return!0;for(var h=0;h<o.length;h++)if(tu(t,o[h]))return!0;return!!Es(t,o)}function as(t,o,u){return!!tu(t,o)||!!Fu(o,t,u)}function mu(t,o){if(t.length===1)return Gl(o,t[0]);for(var u=0;u<o.length;u++)for(var h=o[u],y=0;y<h.length;y++)if(tu(t,h[y]))return!0;for(var b=0;b<t.length;b++)if(Gl(o,t[b]))return!0;for(var S=0;S<o.length;S++)if(Es(t,o[S]))return!0;return!1}function Os(t,o,u){if(t.length>1){if(Es(t,o))return!0;for(var h=0;h<o.length;h++)if(Fu(o[h],t,u))return!0}for(var y=0;y<t.length;y++)if(Fu(t[y],o,u))return!0;return!1}function Es(t,o){if(t.length===0||o.length===0)return!1;for(var u=0;u<t.length-1;u++)for(var h=t[u],y=t[u+1],b=0;b<o.length-1;b++)if(Vl(h,y,o[b],o[b+1]))return!0;return!1}function Vl(t,o,u,h){return Ht(t,u,h)!==Ht(o,u,h)&&Ht(t,o,u)!==Ht(t,o,h)}function Fu(t,o,u){var h=u*u;if(o.length===1)return t.distSqr(o[0])<h;for(var y=1;y<o.length;y++)if(gl(t,o[y-1],o[y])<h)return!0;return!1}function gl(t,o,u){var h=o.distSqr(u);if(h===0)return t.distSqr(o);var y=((t.x-o.x)*(u.x-o.x)+(t.y-o.y)*(u.y-o.y))/h;return t.distSqr(y<0?o:y>1?u:u.sub(o)._mult(y)._add(o))}function Gl(t,o){for(var u,h,y,b=!1,S=0;S<t.length;S++)for(var I=0,D=(u=t[S]).length-1;I<u.length;D=I++)(h=u[I]).y>o.y!=(y=u[D]).y>o.y&&o.x<(y.x-h.x)*(o.y-h.y)/(y.y-h.y)+h.x&&(b=!b);return b}function tu(t,o){for(var u=!1,h=0,y=t.length-1;h<t.length;y=h++){var b=t[h],S=t[y];b.y>o.y!=S.y>o.y&&o.x<(S.x-b.x)*(o.y-b.y)/(S.y-b.y)+b.x&&(u=!u)}return u}function yl(t,o,u){var h=u[0],y=u[2];if(t.x<h.x&&o.x<h.x||t.x>y.x&&o.x>y.x||t.y<h.y&&o.y<h.y||t.y>y.y&&o.y>y.y)return!1;var b=Ht(t,o,u[0]);return b!==Ht(t,o,u[1])||b!==Ht(t,o,u[2])||b!==Ht(t,o,u[3])}function bu(t,o,u){var h=o.paint.get(t).value;return h.kind==="constant"?h.value:u.programConfigurations.get(o.id).getMaxValue(t)}function Eo(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Bu(t,o,u,h,y){if(!o[0]&&!o[1])return t;var b=de.convert(o)._mult(y);u==="viewport"&&b._rotate(-h);for(var S=[],I=0;I<t.length;I++)S.push(t[I].sub(b));return S}is.prototype.populate=function(t,o,u){var h=this.layers[0],y=[],b=null;h.type==="circle"&&(b=h.layout.get("circle-sort-key"));for(var S=0,I=t;S<I.length;S+=1){var D=I[S],z=D.feature,Z=D.id,G=D.index,q=D.sourceLayerIndex,ne=this.layers[0]._featureFilter.needGeometry,Te=fo(z,ne);if(this.layers[0]._featureFilter.filter(new Ai(this.zoom),Te,u)){var Ie=b?b.evaluate(Te,{},u):void 0,k={id:Z,properties:z.properties,type:z.type,sourceLayerIndex:q,index:G,geometry:ne?Te.geometry:Ga(z),patterns:{},sortKey:Ie};y.push(k)}}b&&y.sort(function(Dr,Dn){return Dr.sortKey-Dn.sortKey});for(var Ue=0,rt=y;Ue<rt.length;Ue+=1){var _t=rt[Ue],zt=_t.geometry,Vt=_t.index,ir=_t.sourceLayerIndex,Tr=t[Vt].feature;this.addFeature(_t,zt,Vt,u),o.featureIndex.insert(Tr,zt,Vt,ir,this.index)}},is.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},is.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},is.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},is.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ae),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},is.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},is.prototype.addFeature=function(t,o,u,h){for(var y=0,b=o;y<b.length;y+=1)for(var S=0,I=b[y];S<I.length;S+=1){var D=I[S],z=D.x,Z=D.y;if(!(z<0||z>=8192||Z<0||Z>=8192)){var G=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),q=G.vertexLength;Is(this.layoutVertexArray,z,Z,-1,-1),Is(this.layoutVertexArray,z,Z,1,-1),Is(this.layoutVertexArray,z,Z,1,1),Is(this.layoutVertexArray,z,Z,-1,1),this.indexArray.emplaceBack(q,q+1,q+2),this.indexArray.emplaceBack(q,q+3,q+2),G.vertexLength+=4,G.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,{},h)},hn("CircleBucket",is,{omit:["layers"]});var Nu=new Go({"circle-sort-key":new Cn(oe.layout_circle["circle-sort-key"])}),Ju={paint:new Go({"circle-radius":new Cn(oe.paint_circle["circle-radius"]),"circle-color":new Cn(oe.paint_circle["circle-color"]),"circle-blur":new Cn(oe.paint_circle["circle-blur"]),"circle-opacity":new Cn(oe.paint_circle["circle-opacity"]),"circle-translate":new Rn(oe.paint_circle["circle-translate"]),"circle-translate-anchor":new Rn(oe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Rn(oe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Rn(oe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Cn(oe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Cn(oe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Cn(oe.paint_circle["circle-stroke-opacity"])}),layout:Nu},ua=typeof Float32Array!="undefined"?Float32Array:Array;function Ns(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Qo(t,o,u){var h=o[0],y=o[1],b=o[2],S=o[3],I=o[4],D=o[5],z=o[6],Z=o[7],G=o[8],q=o[9],ne=o[10],Te=o[11],Ie=o[12],k=o[13],Ue=o[14],rt=o[15],_t=u[0],zt=u[1],Vt=u[2],ir=u[3];return t[0]=_t*h+zt*I+Vt*G+ir*Ie,t[1]=_t*y+zt*D+Vt*q+ir*k,t[2]=_t*b+zt*z+Vt*ne+ir*Ue,t[3]=_t*S+zt*Z+Vt*Te+ir*rt,t[4]=(_t=u[4])*h+(zt=u[5])*I+(Vt=u[6])*G+(ir=u[7])*Ie,t[5]=_t*y+zt*D+Vt*q+ir*k,t[6]=_t*b+zt*z+Vt*ne+ir*Ue,t[7]=_t*S+zt*Z+Vt*Te+ir*rt,t[8]=(_t=u[8])*h+(zt=u[9])*I+(Vt=u[10])*G+(ir=u[11])*Ie,t[9]=_t*y+zt*D+Vt*q+ir*k,t[10]=_t*b+zt*z+Vt*ne+ir*Ue,t[11]=_t*S+zt*Z+Vt*Te+ir*rt,t[12]=(_t=u[12])*h+(zt=u[13])*I+(Vt=u[14])*G+(ir=u[15])*Ie,t[13]=_t*y+zt*D+Vt*q+ir*k,t[14]=_t*b+zt*z+Vt*ne+ir*Ue,t[15]=_t*S+zt*Z+Vt*Te+ir*rt,t}Math.hypot||(Math.hypot=function(){for(var t=arguments,o=0,u=arguments.length;u--;)o+=t[u]*t[u];return Math.sqrt(o)});var gu,Hc=Qo;function Wc(t,o,u){var h=o[0],y=o[1],b=o[2],S=o[3];return t[0]=u[0]*h+u[4]*y+u[8]*b+u[12]*S,t[1]=u[1]*h+u[5]*y+u[9]*b+u[13]*S,t[2]=u[2]*h+u[6]*y+u[10]*b+u[14]*S,t[3]=u[3]*h+u[7]*y+u[11]*b+u[15]*S,t}gu=new ua(3),ua!=Float32Array&&(gu[0]=0,gu[1]=0,gu[2]=0),function(){var t=new ua(4);ua!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var Af=(function(){var t=new ua(2);ua!=Float32Array&&(t[0]=0,t[1]=0)}(),function(t){function o(u){t.call(this,u,Ju)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new is(u)},o.prototype.queryRadius=function(u){var h=u;return bu("circle-radius",this,h)+bu("circle-stroke-width",this,h)+Eo(this.paint.get("circle-translate"))},o.prototype.queryIntersectsFeature=function(u,h,y,b,S,I,D,z){for(var Z=Bu(u,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),I.angle,D),G=this.paint.get("circle-radius").evaluate(h,y)+this.paint.get("circle-stroke-width").evaluate(h,y),q=this.paint.get("circle-pitch-alignment")==="map",ne=q?Z:function(Tr,Dr){return Tr.map(function(Dn){return ru(Dn,Dr)})}(Z,z),Te=q?G*D:G,Ie=0,k=b;Ie<k.length;Ie+=1)for(var Ue=0,rt=k[Ie];Ue<rt.length;Ue+=1){var _t=rt[Ue],zt=q?_t:ru(_t,z),Vt=Te,ir=Wc([],[_t.x,_t.y,0,1],z);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Vt*=ir[3]/I.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Vt*=I.cameraToCenterDistance/ir[3]),as(ne,zt,Vt))return!0}return!1},o}(du));function ru(t,o){var u=Wc([],[t.x,t.y,0,1],o);return new de(u[0]/u[3],u[1]/u[3])}var hc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(is);function nu(t,o,u,h){var y=o.width,b=o.height;if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==y*b*u)throw new RangeError("mismatched image size")}else h=new Uint8Array(y*b*u);return t.width=y,t.height=b,t.data=h,t}function _l(t,o,u){var h=o.width,y=o.height;if(h!==t.width||y!==t.height){var b=nu({},{width:h,height:y},u);dc(t,b,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,h),height:Math.min(t.height,y)},u),t.width=h,t.height=y,t.data=b.data}}function dc(t,o,u,h,y,b){if(y.width===0||y.height===0)return o;if(y.width>t.width||y.height>t.height||u.x>t.width-y.width||u.y>t.height-y.height)throw new RangeError("out of range source coordinates for image copy");if(y.width>o.width||y.height>o.height||h.x>o.width-y.width||h.y>o.height-y.height)throw new RangeError("out of range destination coordinates for image copy");for(var S=t.data,I=o.data,D=0;D<y.height;D++)for(var z=((u.y+D)*t.width+u.x)*b,Z=((h.y+D)*o.width+h.x)*b,G=0;G<y.width*b;G++)I[Z+G]=S[z+G];return o}hn("HeatmapBucket",hc,{omit:["layers"]});var iu=function(t,o){nu(this,t,1,o)};iu.prototype.resize=function(t){_l(this,t,1)},iu.prototype.clone=function(){return new iu({width:this.width,height:this.height},new Uint8Array(this.data))},iu.copy=function(t,o,u,h,y){dc(t,o,u,h,y,1)};var Fo=function(t,o){nu(this,t,4,o)};Fo.prototype.resize=function(t){_l(this,t,4)},Fo.prototype.replace=function(t,o){o?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t},Fo.prototype.clone=function(){return new Fo({width:this.width,height:this.height},new Uint8Array(this.data))},Fo.copy=function(t,o,u,h,y){dc(t,o,u,h,y,4)},hn("AlphaImage",iu),hn("RGBAImage",Fo);var Xc={paint:new Go({"heatmap-radius":new Cn(oe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Cn(oe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Rn(oe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new $s(oe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Rn(oe.paint_heatmap["heatmap-opacity"])})};function Kf(t){var o={},u=t.resolution||256,h=t.clips?t.clips.length:1,y=t.image||new Fo({width:u,height:h}),b=function(Te,Ie,k){o[t.evaluationKey]=k;var Ue=t.expression.evaluate(o);y.data[Te+Ie+0]=Math.floor(255*Ue.r/Ue.a),y.data[Te+Ie+1]=Math.floor(255*Ue.g/Ue.a),y.data[Te+Ie+2]=Math.floor(255*Ue.b/Ue.a),y.data[Te+Ie+3]=Math.floor(255*Ue.a)};if(t.clips)for(var S=0,I=0;S<h;++S,I+=4*u)for(var D=0,z=0;D<u;D++,z+=4){var Z=D/(u-1),G=t.clips[S];b(I,z,G.start*(1-Z)+G.end*Z)}else for(var q=0,ne=0;q<u;q++,ne+=4)b(0,ne,q/(u-1));return y}var Ip=function(t){function o(u){t.call(this,u,Xc),this._updateColorRamp()}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new hc(u)},o.prototype._handleSpecialPaintPropertyUpdate=function(u){u==="heatmap-color"&&this._updateColorRamp()},o.prototype._updateColorRamp=function(){this.colorRamp=Kf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},o.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},o.prototype.queryRadius=function(){return 0},o.prototype.queryIntersectsFeature=function(){return!1},o.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},o}(du),$f={paint:new Go({"hillshade-illumination-direction":new Rn(oe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Rn(oe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Rn(oe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Rn(oe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Rn(oe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Rn(oe.paint_hillshade["hillshade-accent-color"])})},lh=function(t){function o(u){t.call(this,u,$f)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},o}(du),vc=La([{name:"a_pos",components:2,type:"Int16"}],4).members,mc=Op,wf=Op;function Op(t,o,u){u=u||2;var h,y,b,S,I,D,z,Z=o&&o.length,G=Z?o[0]*u:t.length,q=Wh(t,0,G,u,!0),ne=[];if(!q||q.next===q.prev)return ne;if(Z&&(q=function(Ie,k,Ue,rt){var _t,zt,Vt,ir=[];for(_t=0,zt=k.length;_t<zt;_t++)(Vt=Wh(Ie,k[_t]*rt,_t<zt-1?k[_t+1]*rt:Ie.length,rt,!1))===Vt.next&&(Vt.steiner=!0),ir.push(fh(Vt));for(ir.sort(Td),_t=0;_t<ir.length;_t++)Md(ir[_t],Ue),Ue=xl(Ue,Ue.next);return Ue}(t,o,q,u)),t.length>80*u){h=b=t[0],y=S=t[1];for(var Te=u;Te<G;Te+=u)(I=t[Te])<h&&(h=I),(D=t[Te+1])<y&&(y=D),I>b&&(b=I),D>S&&(S=D);z=(z=Math.max(b-h,S-y))!==0?1/z:0}return Yc(q,ne,u,h,y,z),ne}function Wh(t,o,u,h,y){var b,S;if(y===rp(t,o,u,h)>0)for(b=o;b<u;b+=h)S=tp(b,t[b],t[b+1],S);else for(b=u-h;b>=o;b-=h)S=tp(b,t[b],t[b+1],S);return S&&Gt(S,S.next)&&(Hl(S),S=S.next),S}function xl(t,o){if(!t)return t;o||(o=t);var u,h=t;do if(u=!1,h.steiner||!Gt(h,h.next)&&Mo(h.prev,h,h.next)!==0)h=h.next;else{if(Hl(h),(h=o=h.prev)===h.next)break;u=!0}while(u||h!==o);return o}function Yc(t,o,u,h,y,b,S){if(t){!S&&b&&function(Z,G,q,ne){var Te=Z;do Te.z===null&&(Te.z=ch(Te.x,Te.y,G,q,ne)),Te.prevZ=Te.prev,Te.nextZ=Te.next,Te=Te.next;while(Te!==Z);Te.prevZ.nextZ=null,Te.prevZ=null,function(Ie){var k,Ue,rt,_t,zt,Vt,ir,Tr,Dr=1;do{for(Ue=Ie,Ie=null,zt=null,Vt=0;Ue;){for(Vt++,rt=Ue,ir=0,k=0;k<Dr&&(ir++,rt=rt.nextZ);k++);for(Tr=Dr;ir>0||Tr>0&&rt;)ir!==0&&(Tr===0||!rt||Ue.z<=rt.z)?(_t=Ue,Ue=Ue.nextZ,ir--):(_t=rt,rt=rt.nextZ,Tr--),zt?zt.nextZ=_t:Ie=_t,_t.prevZ=zt,zt=_t;Ue=rt}zt.nextZ=null,Dr*=2}while(Vt>1)}(Te)}(t,h,y,b);for(var I,D,z=t;t.prev!==t.next;)if(I=t.prev,D=t.next,b?wd(t,h,y,b):Xh(t))o.push(I.i/u),o.push(t.i/u),o.push(D.i/u),Hl(t),t=D.next,z=D.next;else if((t=D)===z){S?S===1?Yc(t=qc(xl(t),o,u),o,u,h,y,b,2):S===2&&Rp(t,o,u,h,y,b):Yc(xl(t),o,u,h,y,b,1);break}}}function Xh(t){var o=t.prev,u=t,h=t.next;if(Mo(o,u,h)>=0)return!1;for(var y=t.next.next;y!==t.prev;){if(Qf(o.x,o.y,u.x,u.y,h.x,h.y,y.x,y.y)&&Mo(y.prev,y,y.next)>=0)return!1;y=y.next}return!0}function wd(t,o,u,h){var y=t.prev,b=t,S=t.next;if(Mo(y,b,S)>=0)return!1;for(var I=y.x>b.x?y.x>S.x?y.x:S.x:b.x>S.x?b.x:S.x,D=y.y>b.y?y.y>S.y?y.y:S.y:b.y>S.y?b.y:S.y,z=ch(y.x<b.x?y.x<S.x?y.x:S.x:b.x<S.x?b.x:S.x,y.y<b.y?y.y<S.y?y.y:S.y:b.y<S.y?b.y:S.y,o,u,h),Z=ch(I,D,o,u,h),G=t.prevZ,q=t.nextZ;G&&G.z>=z&&q&&q.z<=Z;){if(G!==t.prev&&G!==t.next&&Qf(y.x,y.y,b.x,b.y,S.x,S.y,G.x,G.y)&&Mo(G.prev,G,G.next)>=0||(G=G.prevZ,q!==t.prev&&q!==t.next&&Qf(y.x,y.y,b.x,b.y,S.x,S.y,q.x,q.y)&&Mo(q.prev,q,q.next)>=0))return!1;q=q.nextZ}for(;G&&G.z>=z;){if(G!==t.prev&&G!==t.next&&Qf(y.x,y.y,b.x,b.y,S.x,S.y,G.x,G.y)&&Mo(G.prev,G,G.next)>=0)return!1;G=G.prevZ}for(;q&&q.z<=Z;){if(q!==t.prev&&q!==t.next&&Qf(y.x,y.y,b.x,b.y,S.x,S.y,q.x,q.y)&&Mo(q.prev,q,q.next)>=0)return!1;q=q.nextZ}return!0}function qc(t,o,u){var h=t;do{var y=h.prev,b=h.next.next;!Gt(y,b)&&qh(y,h,h.next,b)&&Tf(y,b)&&Tf(b,y)&&(o.push(y.i/u),o.push(h.i/u),o.push(b.i/u),Hl(h),Hl(h.next),h=t=b),h=h.next}while(h!==t);return xl(h)}function Rp(t,o,u,h,y,b){var S=t;do{for(var I=S.next.next;I!==S.prev;){if(S.i!==I.i&&Xr(S,I)){var D=ep(S,I);return S=xl(S,S.next),D=xl(D,D.next),Yc(S,o,u,h,y,b),void Yc(D,o,u,h,y,b)}I=I.next}S=S.next}while(S!==t)}function Td(t,o){return t.x-o.x}function Md(t,o){if(o=function(h,y){var b,S=y,I=h.x,D=h.y,z=-1/0;do{if(D<=S.y&&D>=S.next.y&&S.next.y!==S.y){var Z=S.x+(D-S.y)*(S.next.x-S.x)/(S.next.y-S.y);if(Z<=I&&Z>z){if(z=Z,Z===I){if(D===S.y)return S;if(D===S.next.y)return S.next}b=S.x<S.next.x?S:S.next}}S=S.next}while(S!==y);if(!b)return null;if(I===z)return b;var G,q=b,ne=b.x,Te=b.y,Ie=1/0;S=b;do I>=S.x&&S.x>=ne&&I!==S.x&&Qf(D<Te?I:z,D,ne,Te,D<Te?z:I,D,S.x,S.y)&&(G=Math.abs(D-S.y)/(I-S.x),Tf(S,h)&&(G<Ie||G===Ie&&(S.x>b.x||S.x===b.x&&Yh(b,S)))&&(b=S,Ie=G)),S=S.next;while(S!==q);return b}(t,o)){var u=ep(o,t);xl(o,o.next),xl(u,u.next)}}function Yh(t,o){return Mo(t.prev,t,o.prev)<0&&Mo(o.next,t,t.next)<0}function ch(t,o,u,h,y){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-u)*y)|t<<8))|t<<4))|t<<2))|t<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-h)*y)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function fh(t){var o=t,u=t;do(o.x<u.x||o.x===u.x&&o.y<u.y)&&(u=o),o=o.next;while(o!==t);return u}function Qf(t,o,u,h,y,b,S,I){return(y-S)*(o-I)-(t-S)*(b-I)>=0&&(t-S)*(h-I)-(u-S)*(o-I)>=0&&(u-S)*(b-I)-(y-S)*(h-I)>=0}function Xr(t,o){return t.next.i!==o.i&&t.prev.i!==o.i&&!function(u,h){var y=u;do{if(y.i!==u.i&&y.next.i!==u.i&&y.i!==h.i&&y.next.i!==h.i&&qh(y,y.next,u,h))return!0;y=y.next}while(y!==u);return!1}(t,o)&&(Tf(t,o)&&Tf(o,t)&&function(u,h){var y=u,b=!1,S=(u.x+h.x)/2,I=(u.y+h.y)/2;do y.y>I!=y.next.y>I&&y.next.y!==y.y&&S<(y.next.x-y.x)*(I-y.y)/(y.next.y-y.y)+y.x&&(b=!b),y=y.next;while(y!==u);return b}(t,o)&&(Mo(t.prev,t,o.prev)||Mo(t,o.prev,o))||Gt(t,o)&&Mo(t.prev,t,t.next)>0&&Mo(o.prev,o,o.next)>0)}function Mo(t,o,u){return(o.y-t.y)*(u.x-o.x)-(o.x-t.x)*(u.y-o.y)}function Gt(t,o){return t.x===o.x&&t.y===o.y}function qh(t,o,u,h){var y=Jf(Mo(t,o,u)),b=Jf(Mo(t,o,h)),S=Jf(Mo(u,h,t)),I=Jf(Mo(u,h,o));return y!==b&&S!==I||!(y!==0||!kp(t,u,o))||!(b!==0||!kp(t,h,o))||!(S!==0||!kp(u,t,h))||!(I!==0||!kp(u,o,h))}function kp(t,o,u){return o.x<=Math.max(t.x,u.x)&&o.x>=Math.min(t.x,u.x)&&o.y<=Math.max(t.y,u.y)&&o.y>=Math.min(t.y,u.y)}function Jf(t){return t>0?1:t<0?-1:0}function Tf(t,o){return Mo(t.prev,t,t.next)<0?Mo(t,o,t.next)>=0&&Mo(t,t.prev,o)>=0:Mo(t,o,t.prev)<0||Mo(t,t.next,o)<0}function ep(t,o){var u=new bl(t.i,t.x,t.y),h=new bl(o.i,o.x,o.y),y=t.next,b=o.prev;return t.next=o,o.prev=t,u.next=y,y.prev=u,h.next=u,u.prev=h,b.next=h,h.prev=b,h}function tp(t,o,u,h){var y=new bl(t,o,u);return h?(y.next=h.next,y.prev=h,h.next.prev=y,h.next=y):(y.prev=y,y.next=y),y}function Hl(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function bl(t,o,u){this.i=t,this.x=o,this.y=u,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function rp(t,o,u,h){for(var y=0,b=o,S=u-h;b<u;b+=h)y+=(t[S]-t[b])*(t[b+1]+t[S+1]),S=b;return y}function Lp(t,o,u,h,y){(function b(S,I,D,z,Z){for(;z>D;){if(z-D>600){var G=z-D+1,q=I-D+1,ne=Math.log(G),Te=.5*Math.exp(2*ne/3),Ie=.5*Math.sqrt(ne*Te*(G-Te)/G)*(q-G/2<0?-1:1);b(S,I,Math.max(D,Math.floor(I-q*Te/G+Ie)),Math.min(z,Math.floor(I+(G-q)*Te/G+Ie)),Z)}var k=S[I],Ue=D,rt=z;for(Wl(S,D,I),Z(S[z],k)>0&&Wl(S,D,z);Ue<rt;){for(Wl(S,Ue,rt),Ue++,rt--;Z(S[Ue],k)<0;)Ue++;for(;Z(S[rt],k)>0;)rt--}Z(S[D],k)===0?Wl(S,D,rt):Wl(S,++rt,z),rt<=I&&(D=rt+1),I<=rt&&(z=rt-1)}})(t,o,u||0,h||t.length-1,y||np)}function Wl(t,o,u){var h=t[o];t[o]=t[u],t[u]=h}function np(t,o){return t<o?-1:t>o?1:0}function Mf(t,o){var u=t.length;if(u<=1)return[t];for(var h,y,b=[],S=0;S<u;S++){var I=vr(t[S]);I!==0&&(t[S].area=Math.abs(I),y===void 0&&(y=I<0),y===I<0?(h&&b.push(h),h=[t[S]]):h.push(t[S]))}if(h&&b.push(h),o>1)for(var D=0;D<b.length;D++)b[D].length<=o||(Lp(b[D],o,1,b[D].length-1,ip),b[D]=b[D].slice(0,o));return b}function ip(t,o){return o.area-t.area}function Kc(t,o,u){for(var h=u.patternDependencies,y=!1,b=0,S=o;b<S.length;b+=1){var I=S[b].paint.get(t+"-pattern");I.isConstant()||(y=!0);var D=I.constantOr(null);D&&(y=!0,h[D.to]=!0,h[D.from]=!0)}return y}function Pf(t,o,u,h,y){for(var b=y.patternDependencies,S=0,I=o;S<I.length;S+=1){var D=I[S],z=D.paint.get(t+"-pattern").value;if(z.kind!=="constant"){var Z=z.evaluate({zoom:h-1},u,{},y.availableImages),G=z.evaluate({zoom:h},u,{},y.availableImages),q=z.evaluate({zoom:h+1},u,{},y.availableImages);G=G&&G.name?G.name:G,q=q&&q.name?q.name:q,b[Z=Z&&Z.name?Z.name:Z]=!0,b[G]=!0,b[q]=!0,u.patterns[D.id]={min:Z,mid:G,max:q}}}return u}Op.deviation=function(t,o,u,h){var y=o&&o.length,b=Math.abs(rp(t,0,y?o[0]*u:t.length,u));if(y)for(var S=0,I=o.length;S<I;S++)b-=Math.abs(rp(t,o[S]*u,S<I-1?o[S+1]*u:t.length,u));var D=0;for(S=0;S<h.length;S+=3){var z=h[S]*u,Z=h[S+1]*u,G=h[S+2]*u;D+=Math.abs((t[z]-t[G])*(t[Z+1]-t[z+1])-(t[z]-t[Z])*(t[G+1]-t[z+1]))}return b===0&&D===0?0:Math.abs((D-b)/b)},Op.flatten=function(t){for(var o=t[0][0].length,u={vertices:[],holes:[],dimensions:o},h=0,y=0;y<t.length;y++){for(var b=0;b<t[y].length;b++)for(var S=0;S<o;S++)u.vertices.push(t[y][b][S]);y>0&&u.holes.push(h+=t[y-1].length)}return u},mc.default=wf;var zs=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new fc,this.indexArray=new dl,this.indexArray2=new Zl,this.programConfigurations=new Xn(t.layers,t.zoom),this.segments=new se,this.segments2=new se,this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};zs.prototype.populate=function(t,o,u){this.hasPattern=Kc("fill",this.layers,o);for(var h=this.layers[0].layout.get("fill-sort-key"),y=[],b=0,S=t;b<S.length;b+=1){var I=S[b],D=I.feature,z=I.id,Z=I.index,G=I.sourceLayerIndex,q=this.layers[0]._featureFilter.needGeometry,ne=fo(D,q);if(this.layers[0]._featureFilter.filter(new Ai(this.zoom),ne,u)){var Te=h?h.evaluate(ne,{},u,o.availableImages):void 0,Ie={id:z,properties:D.properties,type:D.type,sourceLayerIndex:G,index:Z,geometry:q?ne.geometry:Ga(D),patterns:{},sortKey:Te};y.push(Ie)}}h&&y.sort(function(Tr,Dr){return Tr.sortKey-Dr.sortKey});for(var k=0,Ue=y;k<Ue.length;k+=1){var rt=Ue[k],_t=rt.geometry,zt=rt.index,Vt=rt.sourceLayerIndex;if(this.hasPattern){var ir=Pf("fill",this.layers,rt,this.zoom,o);this.patternFeatures.push(ir)}else this.addFeature(rt,_t,zt,u,{});o.featureIndex.insert(t[zt].feature,_t,zt,Vt,this.index)}},zs.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},zs.prototype.addFeatures=function(t,o,u){for(var h=0,y=this.patternFeatures;h<y.length;h+=1){var b=y[h];this.addFeature(b,b.geometry,b.index,o,u)}},zs.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},zs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},zs.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,vc),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},zs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},zs.prototype.addFeature=function(t,o,u,h,y){for(var b=0,S=Mf(o,500);b<S.length;b+=1){for(var I=S[b],D=0,z=0,Z=I;z<Z.length;z+=1)D+=Z[z].length;for(var G=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray),q=G.vertexLength,ne=[],Te=[],Ie=0,k=I;Ie<k.length;Ie+=1){var Ue=k[Ie];if(Ue.length!==0){Ue!==I[0]&&Te.push(ne.length/2);var rt=this.segments2.prepareSegment(Ue.length,this.layoutVertexArray,this.indexArray2),_t=rt.vertexLength;this.layoutVertexArray.emplaceBack(Ue[0].x,Ue[0].y),this.indexArray2.emplaceBack(_t+Ue.length-1,_t),ne.push(Ue[0].x),ne.push(Ue[0].y);for(var zt=1;zt<Ue.length;zt++)this.layoutVertexArray.emplaceBack(Ue[zt].x,Ue[zt].y),this.indexArray2.emplaceBack(_t+zt-1,_t+zt),ne.push(Ue[zt].x),ne.push(Ue[zt].y);rt.vertexLength+=Ue.length,rt.primitiveLength+=Ue.length}}for(var Vt=mc(ne,Te),ir=0;ir<Vt.length;ir+=3)this.indexArray.emplaceBack(q+Vt[ir],q+Vt[ir+1],q+Vt[ir+2]);G.vertexLength+=D,G.primitiveLength+=Vt.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,h)},hn("FillBucket",zs,{omit:["layers","patternFeatures"]});var If=new Go({"fill-sort-key":new Cn(oe.layout_fill["fill-sort-key"])}),$c={paint:new Go({"fill-antialias":new Rn(oe.paint_fill["fill-antialias"]),"fill-opacity":new Cn(oe.paint_fill["fill-opacity"]),"fill-color":new Cn(oe.paint_fill["fill-color"]),"fill-outline-color":new Cn(oe.paint_fill["fill-outline-color"]),"fill-translate":new Rn(oe.paint_fill["fill-translate"]),"fill-translate-anchor":new Rn(oe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Zc(oe.paint_fill["fill-pattern"])}),layout:If},ap=function(t){function o(u){t.call(this,u,$c)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.recalculate=function(u,h){t.prototype.recalculate.call(this,u,h);var y=this.paint._values["fill-outline-color"];y.value.kind==="constant"&&y.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},o.prototype.createBucket=function(u){return new zs(u)},o.prototype.queryRadius=function(){return Eo(this.paint.get("fill-translate"))},o.prototype.queryIntersectsFeature=function(u,h,y,b,S,I,D){return mu(Bu(u,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),I.angle,D),b)},o.prototype.isTileClipped=function(){return!0},o}(du),op=La([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Dp=El;function El(t,o,u,h,y){this.properties={},this.extent=u,this.type=0,this._pbf=t,this._geometry=-1,this._keys=h,this._values=y,t.readFields(Qc,this,o)}function Qc(t,o,u){t==1?o.id=u.readVarint():t==2?function(h,y){for(var b=h.readVarint()+h.pos;h.pos<b;){var S=y._keys[h.readVarint()],I=y._values[h.readVarint()];y.properties[S]=I}}(u,o):t==3?o.type=u.readVarint():t==4&&(o._geometry=u.pos)}function Kh(t){for(var o,u,h=0,y=0,b=t.length,S=b-1;y<b;S=y++)h+=((u=t[S]).x-(o=t[y]).x)*(o.y+u.y);return h}El.types=["Unknown","Point","LineString","Polygon"],El.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var o,u=t.readVarint()+t.pos,h=1,y=0,b=0,S=0,I=[];t.pos<u;){if(y<=0){var D=t.readVarint();h=7&D,y=D>>3}if(y--,h===1||h===2)b+=t.readSVarint(),S+=t.readSVarint(),h===1&&(o&&I.push(o),o=[]),o.push(new de(b,S));else{if(h!==7)throw new Error("unknown command "+h);o&&o.push(o[0].clone())}}return o&&I.push(o),I},El.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var o=t.readVarint()+t.pos,u=1,h=0,y=0,b=0,S=1/0,I=-1/0,D=1/0,z=-1/0;t.pos<o;){if(h<=0){var Z=t.readVarint();u=7&Z,h=Z>>3}if(h--,u===1||u===2)(y+=t.readSVarint())<S&&(S=y),y>I&&(I=y),(b+=t.readSVarint())<D&&(D=b),b>z&&(z=b);else if(u!==7)throw new Error("unknown command "+u)}return[S,D,I,z]},El.prototype.toGeoJSON=function(t,o,u){var h,y,b=this.extent*Math.pow(2,u),S=this.extent*t,I=this.extent*o,D=this.loadGeometry(),z=El.types[this.type];function Z(ne){for(var Te=0;Te<ne.length;Te++){var Ie=ne[Te];ne[Te]=[360*(Ie.x+S)/b-180,360/Math.PI*Math.atan(Math.exp((180-360*(Ie.y+I)/b)*Math.PI/180))-90]}}switch(this.type){case 1:var G=[];for(h=0;h<D.length;h++)G[h]=D[h][0];Z(D=G);break;case 2:for(h=0;h<D.length;h++)Z(D[h]);break;case 3:for(D=function(ne){var Te=ne.length;if(Te<=1)return[ne];for(var Ie,k,Ue=[],rt=0;rt<Te;rt++){var _t=Kh(ne[rt]);_t!==0&&(k===void 0&&(k=_t<0),k===_t<0?(Ie&&Ue.push(Ie),Ie=[ne[rt]]):Ie.push(ne[rt]))}return Ie&&Ue.push(Ie),Ue}(D),h=0;h<D.length;h++)for(y=0;y<D[h].length;y++)Z(D[h][y])}D.length===1?D=D[0]:z="Multi"+z;var q={type:"Feature",geometry:{type:z,coordinates:D},properties:this.properties};return"id"in this&&(q.id=this.id),q};var Fp=ph;function ph(t,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Pd,this,o),this.length=this._features.length}function Pd(t,o,u){t===15?o.version=u.readVarint():t===1?o.name=u.readString():t===5?o.extent=u.readVarint():t===2?o._features.push(u.pos):t===3?o._keys.push(u.readString()):t===4&&o._values.push(function(h){for(var y=null,b=h.readVarint()+h.pos;h.pos<b;){var S=h.readVarint()>>3;y=S===1?h.readString():S===2?h.readFloat():S===3?h.readDouble():S===4?h.readVarint64():S===5?h.readVarint():S===6?h.readSVarint():S===7?h.readBoolean():null}return y}(u))}function $h(t,o,u){if(t===3){var h=new Fp(u,u.readVarint()+u.pos);h.length&&(o[h.name]=h)}}ph.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var o=this._pbf.readVarint()+this._pbf.pos;return new Dp(this._pbf,o,this.extent,this._keys,this._values)};var Eu={VectorTile:function(t,o){this.layers=t.readFields($h,{},o)},VectorTileFeature:Dp,VectorTileLayer:Fp},Id=Eu.VectorTileFeature.types,Bp=Math.pow(2,13);function Jc(t,o,u,h,y,b,S,I){t.emplaceBack(o,u,2*Math.floor(h*Bp)+S,y*Bp*2,b*Bp*2,Math.round(I))}var zu=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new vu,this.indexArray=new dl,this.programConfigurations=new Xn(t.layers,t.zoom),this.segments=new se,this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};function Qh(t,o){return t.x===o.x&&(t.x<0||t.x>8192)||t.y===o.y&&(t.y<0||t.y>8192)}zu.prototype.populate=function(t,o,u){this.features=[],this.hasPattern=Kc("fill-extrusion",this.layers,o);for(var h=0,y=t;h<y.length;h+=1){var b=y[h],S=b.feature,I=b.id,D=b.index,z=b.sourceLayerIndex,Z=this.layers[0]._featureFilter.needGeometry,G=fo(S,Z);if(this.layers[0]._featureFilter.filter(new Ai(this.zoom),G,u)){var q={id:I,sourceLayerIndex:z,index:D,geometry:Z?G.geometry:Ga(S),properties:S.properties,type:S.type,patterns:{}};this.hasPattern?this.features.push(Pf("fill-extrusion",this.layers,q,this.zoom,o)):this.addFeature(q,q.geometry,D,u,{}),o.featureIndex.insert(S,q.geometry,D,z,this.index,!0)}}},zu.prototype.addFeatures=function(t,o,u){for(var h=0,y=this.features;h<y.length;h+=1){var b=y[h];this.addFeature(b,b.geometry,b.index,o,u)}},zu.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},zu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},zu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},zu.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,op),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},zu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},zu.prototype.addFeature=function(t,o,u,h,y){for(var b=0,S=Mf(o,500);b<S.length;b+=1){for(var I=S[b],D=0,z=0,Z=I;z<Z.length;z+=1)D+=Z[z].length;for(var G=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),q=0,ne=I;q<ne.length;q+=1){var Te=ne[q];if(Te.length!==0&&!((Zi=Te).every(function(Si){return Si.x<0})||Zi.every(function(Si){return Si.x>8192})||Zi.every(function(Si){return Si.y<0})||Zi.every(function(Si){return Si.y>8192})))for(var Ie=0,k=0;k<Te.length;k++){var Ue=Te[k];if(k>=1){var rt=Te[k-1];if(!Qh(Ue,rt)){G.vertexLength+4>se.MAX_VERTEX_ARRAY_LENGTH&&(G=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var _t=Ue.sub(rt)._perp()._unit(),zt=rt.dist(Ue);Ie+zt>32768&&(Ie=0),Jc(this.layoutVertexArray,Ue.x,Ue.y,_t.x,_t.y,0,0,Ie),Jc(this.layoutVertexArray,Ue.x,Ue.y,_t.x,_t.y,0,1,Ie),Jc(this.layoutVertexArray,rt.x,rt.y,_t.x,_t.y,0,0,Ie+=zt),Jc(this.layoutVertexArray,rt.x,rt.y,_t.x,_t.y,0,1,Ie);var Vt=G.vertexLength;this.indexArray.emplaceBack(Vt,Vt+2,Vt+1),this.indexArray.emplaceBack(Vt+1,Vt+2,Vt+3),G.vertexLength+=4,G.primitiveLength+=2}}}}if(G.vertexLength+D>se.MAX_VERTEX_ARRAY_LENGTH&&(G=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray)),Id[t.type]==="Polygon"){for(var ir=[],Tr=[],Dr=G.vertexLength,Dn=0,cn=I;Dn<cn.length;Dn+=1){var Vn=cn[Dn];if(Vn.length!==0){Vn!==I[0]&&Tr.push(ir.length/2);for(var pn=0;pn<Vn.length;pn++){var Pi=Vn[pn];Jc(this.layoutVertexArray,Pi.x,Pi.y,0,0,1,1,0),ir.push(Pi.x),ir.push(Pi.y)}}}for(var ei=mc(ir,Tr),wn=0;wn<ei.length;wn+=3)this.indexArray.emplaceBack(Dr+ei[wn],Dr+ei[wn+2],Dr+ei[wn+1]);G.primitiveLength+=ei.length/3,G.vertexLength+=D}}var Zi;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,h)},hn("FillExtrusionBucket",zu,{omit:["layers","features"]});var Jh={paint:new Go({"fill-extrusion-opacity":new Rn(oe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Cn(oe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Rn(oe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Rn(oe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Zc(oe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Cn(oe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Cn(oe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Rn(oe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},el=function(t){function o(u){t.call(this,u,Jh)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new zu(u)},o.prototype.queryRadius=function(){return Eo(this.paint.get("fill-extrusion-translate"))},o.prototype.is3D=function(){return!0},o.prototype.queryIntersectsFeature=function(u,h,y,b,S,I,D,z){var Z=Bu(u,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),I.angle,D),G=this.paint.get("fill-extrusion-height").evaluate(h,y),q=this.paint.get("fill-extrusion-base").evaluate(h,y),ne=function(Ie,k,Ue,rt){for(var _t=[],zt=0,Vt=Ie;zt<Vt.length;zt+=1){var ir=Vt[zt],Tr=[ir.x,ir.y,0,1];Wc(Tr,Tr,k),_t.push(new de(Tr[0]/Tr[3],Tr[1]/Tr[3]))}return _t}(Z,z),Te=function(Ie,k,Ue,rt){for(var _t=[],zt=[],Vt=rt[8]*k,ir=rt[9]*k,Tr=rt[10]*k,Dr=rt[11]*k,Dn=rt[8]*Ue,cn=rt[9]*Ue,Vn=rt[10]*Ue,pn=rt[11]*Ue,Pi=0,ei=Ie;Pi<ei.length;Pi+=1){for(var wn=[],Zi=[],Si=0,Ji=ei[Pi];Si<Ji.length;Si+=1){var Wn=Ji[Si],fa=Wn.x,Ja=Wn.y,yo=rt[0]*fa+rt[4]*Ja+rt[12],Ha=rt[1]*fa+rt[5]*Ja+rt[13],eo=rt[2]*fa+rt[6]*Ja+rt[14],_o=rt[3]*fa+rt[7]*Ja+rt[15],Xo=eo+Tr,es=_o+Dr,js=yo+Dn,ts=Ha+cn,Vs=eo+Vn,to=_o+pn,ls=new de((yo+Vt)/es,(Ha+ir)/es);ls.z=Xo/es,wn.push(ls);var Ci=new de(js/to,ts/to);Ci.z=Vs/to,Zi.push(Ci)}_t.push(wn),zt.push(Zi)}return[_t,zt]}(b,q,G,z);return function(Ie,k,Ue){var rt=1/0;mu(Ue,k)&&(rt=ef(Ue,k[0]));for(var _t=0;_t<k.length;_t++)for(var zt=k[_t],Vt=Ie[_t],ir=0;ir<zt.length-1;ir++){var Tr=zt[ir],Dr=[Tr,zt[ir+1],Vt[ir+1],Vt[ir],Tr];Du(Ue,Dr)&&(rt=Math.min(rt,ef(Ue,Dr)))}return rt!==1/0&&rt}(Te[0],Te[1],ne)},o}(du);function Of(t,o){return t.x*o.x+t.y*o.y}function ef(t,o){if(t.length===1){for(var u,h=0,y=o[h++];!u||y.equals(u);)if(!(u=o[h++]))return 1/0;for(;h<o.length;h++){var b=o[h],S=t[0],I=u.sub(y),D=b.sub(y),z=S.sub(y),Z=Of(I,I),G=Of(I,D),q=Of(D,D),ne=Of(z,I),Te=Of(z,D),Ie=Z*q-G*G,k=(q*ne-G*Te)/Ie,Ue=(Z*Te-G*ne)/Ie,rt=y.z*(1-k-Ue)+u.z*k+b.z*Ue;if(isFinite(rt))return rt}return 1/0}for(var _t=1/0,zt=0,Vt=o;zt<Vt.length;zt+=1)_t=Math.min(_t,Vt[zt].z);return _t}var gc=La([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,hh=La([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,tf=Eu.VectorTileFeature.types,Np=Math.cos(Math.PI/180*37.5),Ia=Math.pow(2,14)/.5,Yi=function(t){var o=this;this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(u){o.gradients[u.id]={}}),this.layoutVertexArray=new _i,this.layoutVertexArray2=new Bs,this.indexArray=new dl,this.programConfigurations=new Xn(t.layers,t.zoom),this.segments=new se,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};Yi.prototype.populate=function(t,o,u){this.hasPattern=Kc("line",this.layers,o);for(var h=this.layers[0].layout.get("line-sort-key"),y=[],b=0,S=t;b<S.length;b+=1){var I=S[b],D=I.feature,z=I.id,Z=I.index,G=I.sourceLayerIndex,q=this.layers[0]._featureFilter.needGeometry,ne=fo(D,q);if(this.layers[0]._featureFilter.filter(new Ai(this.zoom),ne,u)){var Te=h?h.evaluate(ne,{},u):void 0,Ie={id:z,properties:D.properties,type:D.type,sourceLayerIndex:G,index:Z,geometry:q?ne.geometry:Ga(D),patterns:{},sortKey:Te};y.push(Ie)}}h&&y.sort(function(Tr,Dr){return Tr.sortKey-Dr.sortKey});for(var k=0,Ue=y;k<Ue.length;k+=1){var rt=Ue[k],_t=rt.geometry,zt=rt.index,Vt=rt.sourceLayerIndex;if(this.hasPattern){var ir=Pf("line",this.layers,rt,this.zoom,o);this.patternFeatures.push(ir)}else this.addFeature(rt,_t,zt,u,{});o.featureIndex.insert(t[zt].feature,_t,zt,Vt,this.index)}},Yi.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},Yi.prototype.addFeatures=function(t,o,u){for(var h=0,y=this.patternFeatures;h<y.length;h+=1){var b=y[h];this.addFeature(b,b.geometry,b.index,o,u)}},Yi.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Yi.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Yi.prototype.upload=function(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,hh)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,gc),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Yi.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Yi.prototype.lineFeatureClips=function(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}},Yi.prototype.addFeature=function(t,o,u,h,y){var b=this.layers[0].layout,S=b.get("line-join").evaluate(t,{}),I=b.get("line-cap"),D=b.get("line-miter-limit"),z=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(var Z=0,G=o;Z<G.length;Z+=1)this.addLine(G[Z],t,S,I,D,z);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,h)},Yi.prototype.addLine=function(t,o,u,h,y,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var S=0;S<t.length-1;S++)this.totalDistance+=t[S].dist(t[S+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var I=tf[o.type]==="Polygon",D=t.length;D>=2&&t[D-1].equals(t[D-2]);)D--;for(var z=0;z<D-1&&t[z].equals(t[z+1]);)z++;if(!(D<(I?3:2))){u==="bevel"&&(y=1.05);var Z,G=this.overscaling<=16?122880/(512*this.overscaling):0,q=this.segments.prepareSegment(10*D,this.layoutVertexArray,this.indexArray),ne=void 0,Te=void 0,Ie=void 0,k=void 0;this.e1=this.e2=-1,I&&(k=t[z].sub(Z=t[D-2])._unit()._perp());for(var Ue=z;Ue<D;Ue++)if(!(Te=Ue===D-1?I?t[z+1]:void 0:t[Ue+1])||!t[Ue].equals(Te)){k&&(Ie=k),Z&&(ne=Z),Z=t[Ue],k=Te?Te.sub(Z)._unit()._perp():Ie;var rt=(Ie=Ie||k).add(k);rt.x===0&&rt.y===0||rt._unit();var _t=Ie.x*k.x+Ie.y*k.y,zt=rt.x*k.x+rt.y*k.y,Vt=zt!==0?1/zt:1/0,ir=2*Math.sqrt(2-2*zt),Tr=zt<Np&&ne&&Te,Dr=Ie.x*k.y-Ie.y*k.x>0;if(Tr&&Ue>z){var Dn=Z.dist(ne);if(Dn>2*G){var cn=Z.sub(Z.sub(ne)._mult(G/Dn)._round());this.updateDistance(ne,cn),this.addCurrentVertex(cn,Ie,0,0,q),ne=cn}}var Vn=ne&&Te,pn=Vn?u:I?"butt":h;if(Vn&&pn==="round"&&(Vt<b?pn="miter":Vt<=2&&(pn="fakeround")),pn==="miter"&&Vt>y&&(pn="bevel"),pn==="bevel"&&(Vt>2&&(pn="flipbevel"),Vt<y&&(pn="miter")),ne&&this.updateDistance(ne,Z),pn==="miter")rt._mult(Vt),this.addCurrentVertex(Z,rt,0,0,q);else if(pn==="flipbevel"){if(Vt>100)rt=k.mult(-1);else{var Pi=Vt*Ie.add(k).mag()/Ie.sub(k).mag();rt._perp()._mult(Pi*(Dr?-1:1))}this.addCurrentVertex(Z,rt,0,0,q),this.addCurrentVertex(Z,rt.mult(-1),0,0,q)}else if(pn==="bevel"||pn==="fakeround"){var ei=-Math.sqrt(Vt*Vt-1),wn=Dr?ei:0,Zi=Dr?0:ei;if(ne&&this.addCurrentVertex(Z,Ie,wn,Zi,q),pn==="fakeround")for(var Si=Math.round(180*ir/Math.PI/20),Ji=1;Ji<Si;Ji++){var Wn=Ji/Si;if(Wn!==.5){var fa=Wn-.5;Wn+=Wn*fa*(Wn-1)*((1.0904+_t*(_t*(3.55645-1.43519*_t)-3.2452))*fa*fa+(.848013+_t*(.215638*_t-1.06021)))}var Ja=k.sub(Ie)._mult(Wn)._add(Ie)._unit()._mult(Dr?-1:1);this.addHalfVertex(Z,Ja.x,Ja.y,!1,Dr,0,q)}Te&&this.addCurrentVertex(Z,k,-wn,-Zi,q)}else if(pn==="butt")this.addCurrentVertex(Z,rt,0,0,q);else if(pn==="square"){var yo=ne?1:-1;this.addCurrentVertex(Z,rt,yo,yo,q)}else pn==="round"&&(ne&&(this.addCurrentVertex(Z,Ie,0,0,q),this.addCurrentVertex(Z,Ie,1,1,q,!0)),Te&&(this.addCurrentVertex(Z,k,-1,-1,q,!0),this.addCurrentVertex(Z,k,0,0,q)));if(Tr&&Ue<D-1){var Ha=Z.dist(Te);if(Ha>2*G){var eo=Z.add(Te.sub(Z)._mult(G/Ha)._round());this.updateDistance(Z,eo),this.addCurrentVertex(eo,k,0,0,q),Z=eo}}}}},Yi.prototype.addCurrentVertex=function(t,o,u,h,y,b){b===void 0&&(b=!1);var S=o.y*h-o.x,I=-o.y-o.x*h;this.addHalfVertex(t,o.x+o.y*u,o.y-o.x*u,b,!1,u,y),this.addHalfVertex(t,S,I,b,!0,-h,y),this.distance>Ia/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(t,o,u,h,y,b))},Yi.prototype.addHalfVertex=function(t,o,u,h,y,b,S){var I=.5*(this.lineClips?this.scaledDistance*(Ia-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t.x<<1)+(h?1:0),(t.y<<1)+(y?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(b===0?0:b<0?-1:1)|(63&I)<<2,I>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var D=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),S.primitiveLength++),y?this.e2=D:this.e1=D},Yi.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Yi.prototype.updateDistance=function(t,o){this.distance+=t.dist(o),this.updateScaledDistance()},hn("LineBucket",Yi,{omit:["layers","patternFeatures"]});var yc=new Go({"line-cap":new Rn(oe.layout_line["line-cap"]),"line-join":new Cn(oe.layout_line["line-join"]),"line-miter-limit":new Rn(oe.layout_line["line-miter-limit"]),"line-round-limit":new Rn(oe.layout_line["line-round-limit"]),"line-sort-key":new Cn(oe.layout_line["line-sort-key"])}),Po={paint:new Go({"line-opacity":new Cn(oe.paint_line["line-opacity"]),"line-color":new Cn(oe.paint_line["line-color"]),"line-translate":new Rn(oe.paint_line["line-translate"]),"line-translate-anchor":new Rn(oe.paint_line["line-translate-anchor"]),"line-width":new Cn(oe.paint_line["line-width"]),"line-gap-width":new Cn(oe.paint_line["line-gap-width"]),"line-offset":new Cn(oe.paint_line["line-offset"]),"line-blur":new Cn(oe.paint_line["line-blur"]),"line-dasharray":new $o(oe.paint_line["line-dasharray"]),"line-pattern":new Zc(oe.paint_line["line-pattern"]),"line-gradient":new $s(oe.paint_line["line-gradient"])}),layout:yc},Us=new(function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.possiblyEvaluate=function(u,h){return h=new Ai(Math.floor(h.zoom),{now:h.now,fadeDuration:h.fadeDuration,zoomHistory:h.zoomHistory,transition:h.transition}),t.prototype.possiblyEvaluate.call(this,u,h)},o.prototype.evaluate=function(u,h,y,b){return h=At({},h,{zoom:Math.floor(h.zoom)}),t.prototype.evaluate.call(this,u,h,y,b)},o}(Cn))(Po.paint.properties["line-width"].specification);Us.useIntegerZoom=!0;var ed=function(t){function o(u){t.call(this,u,Po),this.gradientVersion=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._handleSpecialPaintPropertyUpdate=function(u){u==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof gs,this.gradientVersion=(this.gradientVersion+1)%et)},o.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},o.prototype.recalculate=function(u,h){t.prototype.recalculate.call(this,u,h),this.paint._values["line-floorwidth"]=Us.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)},o.prototype.createBucket=function(u){return new Yi(u)},o.prototype.queryRadius=function(u){var h=u,y=dh(bu("line-width",this,h),bu("line-gap-width",this,h)),b=bu("line-offset",this,h);return y/2+Math.abs(b)+Eo(this.paint.get("line-translate"))},o.prototype.queryIntersectsFeature=function(u,h,y,b,S,I,D){var z=Bu(u,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),I.angle,D),Z=D/2*dh(this.paint.get("line-width").evaluate(h,y),this.paint.get("line-gap-width").evaluate(h,y)),G=this.paint.get("line-offset").evaluate(h,y);return G&&(b=function(q,ne){for(var Te=[],Ie=new de(0,0),k=0;k<q.length;k++){for(var Ue=q[k],rt=[],_t=0;_t<Ue.length;_t++){var zt=Ue[_t],Vt=Ue[_t+1],ir=_t===0?Ie:zt.sub(Ue[_t-1])._unit()._perp(),Tr=_t===Ue.length-1?Ie:Vt.sub(zt)._unit()._perp(),Dr=ir._add(Tr)._unit();Dr._mult(1/(Dr.x*Tr.x+Dr.y*Tr.y)),rt.push(Dr._mult(ne)._add(zt))}Te.push(rt)}return Te}(b,G*D)),function(q,ne,Te){for(var Ie=0;Ie<ne.length;Ie++){var k=ne[Ie];if(q.length>=3){for(var Ue=0;Ue<k.length;Ue++)if(tu(q,k[Ue]))return!0}if(Os(q,k,Te))return!0}return!1}(z,b,Z)},o.prototype.isTileClipped=function(){return!0},o}(du);function dh(t,o){return o>0?o+2*t:t}var Od=La([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),zp=La([{name:"a_projected_pos",components:3,type:"Float32"}],4),Rd=(La([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),La([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),vh=(La([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),La([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Sl=La([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function sp(t,o,u){return t.sections.forEach(function(h){h.text=function(y,b,S){var I=b.layout.get("text-transform").evaluate(S,{});return I==="uppercase"?y=y.toLocaleUpperCase():I==="lowercase"&&(y=y.toLocaleLowerCase()),Ms.applyArabicShaping&&(y=Ms.applyArabicShaping(y)),y}(h.text,o,u)}),t}La([{name:"triangle",components:3,type:"Uint16"}]),La([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),La([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),La([{type:"Float32",name:"offsetX"}]),La([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Xl={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},td=function(t,o,u,h,y){var b,S,I=8*y-h-1,D=(1<<I)-1,z=D>>1,Z=-7,G=u?y-1:0,q=u?-1:1,ne=t[o+G];for(G+=q,b=ne&(1<<-Z)-1,ne>>=-Z,Z+=I;Z>0;b=256*b+t[o+G],G+=q,Z-=8);for(S=b&(1<<-Z)-1,b>>=-Z,Z+=h;Z>0;S=256*S+t[o+G],G+=q,Z-=8);if(b===0)b=1-z;else{if(b===D)return S?NaN:1/0*(ne?-1:1);S+=Math.pow(2,h),b-=z}return(ne?-1:1)*S*Math.pow(2,b-h)},up=function(t,o,u,h,y,b){var S,I,D,z=8*b-y-1,Z=(1<<z)-1,G=Z>>1,q=y===23?Math.pow(2,-24)-Math.pow(2,-77):0,ne=h?0:b-1,Te=h?1:-1,Ie=o<0||o===0&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(I=isNaN(o)?1:0,S=Z):(S=Math.floor(Math.log(o)/Math.LN2),o*(D=Math.pow(2,-S))<1&&(S--,D*=2),(o+=S+G>=1?q/D:q*Math.pow(2,1-G))*D>=2&&(S++,D/=2),S+G>=Z?(I=0,S=Z):S+G>=1?(I=(o*D-1)*Math.pow(2,y),S+=G):(I=o*Math.pow(2,G-1)*Math.pow(2,y),S=0));y>=8;t[u+ne]=255&I,ne+=Te,I/=256,y-=8);for(S=S<<y|I,z+=y;z>0;t[u+ne]=255&S,ne+=Te,S/=256,z-=8);t[u+ne-Te]|=128*Ie},rf=ba;function ba(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}ba.Varint=0,ba.Fixed64=1,ba.Bytes=2,ba.Fixed32=5;var Up=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Yl(t){return t.type===ba.Bytes?t.readVarint()+t.pos:t.pos+1}function Rf(t,o,u){return u?4294967296*o+(t>>>0):4294967296*(o>>>0)+(t>>>0)}function mh(t,o,u){var h=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));u.realloc(h);for(var y=u.pos-1;y>=t;y--)u.buf[y+h]=u.buf[y]}function kd(t,o){for(var u=0;u<t.length;u++)o.writeVarint(t[u])}function N(t,o){for(var u=0;u<t.length;u++)o.writeSVarint(t[u])}function ce(t,o){for(var u=0;u<t.length;u++)o.writeFloat(t[u])}function Fe(t,o){for(var u=0;u<t.length;u++)o.writeDouble(t[u])}function Lt(t,o){for(var u=0;u<t.length;u++)o.writeBoolean(t[u])}function rr(t,o){for(var u=0;u<t.length;u++)o.writeFixed32(t[u])}function Ot(t,o){for(var u=0;u<t.length;u++)o.writeSFixed32(t[u])}function Qt(t,o){for(var u=0;u<t.length;u++)o.writeFixed64(t[u])}function lr(t,o){for(var u=0;u<t.length;u++)o.writeSFixed64(t[u])}function dr(t,o){return(t[o]|t[o+1]<<8|t[o+2]<<16)+16777216*t[o+3]}function _r(t,o,u){t[u]=o,t[u+1]=o>>>8,t[u+2]=o>>>16,t[u+3]=o>>>24}function Ar(t,o){return(t[o]|t[o+1]<<8|t[o+2]<<16)+(t[o+3]<<24)}function wr(t,o,u){t===1&&u.readMessage(jr,o)}function jr(t,o,u){if(t===3){var h=u.readMessage(mr,{}),y=h.width,b=h.height,S=h.left,I=h.top,D=h.advance;o.push({id:h.id,bitmap:new iu({width:y+6,height:b+6},h.bitmap),metrics:{width:y,height:b,left:S,top:I,advance:D}})}}function mr(t,o,u){t===1?o.id=u.readVarint():t===2?o.bitmap=u.readBytes():t===3?o.width=u.readVarint():t===4?o.height=u.readVarint():t===5?o.left=u.readSVarint():t===6?o.top=u.readSVarint():t===7&&(o.advance=u.readVarint())}function Cr(t){for(var o=0,u=0,h=0,y=t;h<y.length;h+=1){var b=y[h];o+=b.w*b.h,u=Math.max(u,b.w)}t.sort(function(Ie,k){return k.h-Ie.h});for(var S=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),u),h:1/0}],I=0,D=0,z=0,Z=t;z<Z.length;z+=1)for(var G=Z[z],q=S.length-1;q>=0;q--){var ne=S[q];if(!(G.w>ne.w||G.h>ne.h)){if(G.x=ne.x,G.y=ne.y,D=Math.max(D,G.y+G.h),I=Math.max(I,G.x+G.w),G.w===ne.w&&G.h===ne.h){var Te=S.pop();q<S.length&&(S[q]=Te)}else G.h===ne.h?(ne.x+=G.w,ne.w-=G.w):G.w===ne.w?(ne.y+=G.h,ne.h-=G.h):(S.push({x:ne.x+G.w,y:ne.y,w:ne.w-G.w,h:G.h}),ne.y+=G.h,ne.h-=G.h);break}}return{w:I,h:D,fill:o/(I*D)||0}}ba.prototype={destroy:function(){this.buf=null},readFields:function(t,o,u){for(u=u||this.length;this.pos<u;){var h=this.readVarint(),y=h>>3,b=this.pos;this.type=7&h,t(y,o,this),this.pos===b&&this.skip(h)}return o},readMessage:function(t,o){return this.readFields(t,o,this.readVarint()+this.pos)},readFixed32:function(){var t=dr(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Ar(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=dr(this.buf,this.pos)+4294967296*dr(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=dr(this.buf,this.pos)+4294967296*Ar(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=td(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=td(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var o,u,h=this.buf;return o=127&(u=h[this.pos++]),u<128?o:(o|=(127&(u=h[this.pos++]))<<7,u<128?o:(o|=(127&(u=h[this.pos++]))<<14,u<128?o:(o|=(127&(u=h[this.pos++]))<<21,u<128?o:function(y,b,S){var I,D,z=S.buf;if(I=(112&(D=z[S.pos++]))>>4,D<128||(I|=(127&(D=z[S.pos++]))<<3,D<128)||(I|=(127&(D=z[S.pos++]))<<10,D<128)||(I|=(127&(D=z[S.pos++]))<<17,D<128)||(I|=(127&(D=z[S.pos++]))<<24,D<128)||(I|=(1&(D=z[S.pos++]))<<31,D<128))return Rf(y,I,b);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(u=h[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,o=this.pos;return this.pos=t,t-o>=12&&Up?function(u,h,y){return Up.decode(u.subarray(h,y))}(this.buf,o,t):function(u,h,y){for(var b="",S=h;S<y;){var I,D,z,Z=u[S],G=null,q=Z>239?4:Z>223?3:Z>191?2:1;if(S+q>y)break;q===1?Z<128&&(G=Z):q===2?(192&(I=u[S+1]))==128&&(G=(31&Z)<<6|63&I)<=127&&(G=null):q===3?(D=u[S+2],(192&(I=u[S+1]))==128&&(192&D)==128&&((G=(15&Z)<<12|(63&I)<<6|63&D)<=2047||G>=55296&&G<=57343)&&(G=null)):q===4&&(D=u[S+2],z=u[S+3],(192&(I=u[S+1]))==128&&(192&D)==128&&(192&z)==128&&((G=(15&Z)<<18|(63&I)<<12|(63&D)<<6|63&z)<=65535||G>=1114112)&&(G=null)),G===null?(G=65533,q=1):G>65535&&(G-=65536,b+=String.fromCharCode(G>>>10&1023|55296),G=56320|1023&G),b+=String.fromCharCode(G),S+=q}return b}(this.buf,o,t)},readBytes:function(){var t=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,t);return this.pos=t,o},readPackedVarint:function(t,o){if(this.type!==ba.Bytes)return t.push(this.readVarint(o));var u=Yl(this);for(t=t||[];this.pos<u;)t.push(this.readVarint(o));return t},readPackedSVarint:function(t){if(this.type!==ba.Bytes)return t.push(this.readSVarint());var o=Yl(this);for(t=t||[];this.pos<o;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==ba.Bytes)return t.push(this.readBoolean());var o=Yl(this);for(t=t||[];this.pos<o;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==ba.Bytes)return t.push(this.readFloat());var o=Yl(this);for(t=t||[];this.pos<o;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==ba.Bytes)return t.push(this.readDouble());var o=Yl(this);for(t=t||[];this.pos<o;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==ba.Bytes)return t.push(this.readFixed32());var o=Yl(this);for(t=t||[];this.pos<o;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==ba.Bytes)return t.push(this.readSFixed32());var o=Yl(this);for(t=t||[];this.pos<o;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==ba.Bytes)return t.push(this.readFixed64());var o=Yl(this);for(t=t||[];this.pos<o;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==ba.Bytes)return t.push(this.readSFixed64());var o=Yl(this);for(t=t||[];this.pos<o;)t.push(this.readSFixed64());return t},skip:function(t){var o=7&t;if(o===ba.Varint)for(;this.buf[this.pos++]>127;);else if(o===ba.Bytes)this.pos=this.readVarint()+this.pos;else if(o===ba.Fixed32)this.pos+=4;else{if(o!==ba.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(t,o){this.writeVarint(t<<3|o)},realloc:function(t){for(var o=this.length||16;o<this.pos+t;)o*=2;if(o!==this.length){var u=new Uint8Array(o);u.set(this.buf),this.buf=u,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),_r(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),_r(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),_r(this.buf,-1&t,this.pos),_r(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),_r(this.buf,-1&t,this.pos),_r(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(o,u){var h,y;if(o>=0?(h=o%4294967296|0,y=o/4294967296|0):(y=~(-o/4294967296),4294967295^(h=~(-o%4294967296))?h=h+1|0:(h=0,y=y+1|0)),o>=18446744073709552e3||o<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),function(b,S,I){I.buf[I.pos++]=127&b|128,b>>>=7,I.buf[I.pos++]=127&b|128,b>>>=7,I.buf[I.pos++]=127&b|128,b>>>=7,I.buf[I.pos++]=127&b|128,I.buf[I.pos]=127&(b>>>=7)}(h,0,u),function(b,S){var I=(7&b)<<4;S.buf[S.pos++]|=I|((b>>>=3)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b)))))}(y,u)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var o=this.pos;this.pos=function(h,y,b){for(var S,I,D=0;D<y.length;D++){if((S=y.charCodeAt(D))>55295&&S<57344){if(!I){S>56319||D+1===y.length?(h[b++]=239,h[b++]=191,h[b++]=189):I=S;continue}if(S<56320){h[b++]=239,h[b++]=191,h[b++]=189,I=S;continue}S=I-55296<<10|S-56320|65536,I=null}else I&&(h[b++]=239,h[b++]=191,h[b++]=189,I=null);S<128?h[b++]=S:(S<2048?h[b++]=S>>6|192:(S<65536?h[b++]=S>>12|224:(h[b++]=S>>18|240,h[b++]=S>>12&63|128),h[b++]=S>>6&63|128),h[b++]=63&S|128)}return b}(this.buf,t,this.pos);var u=this.pos-o;u>=128&&mh(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u},writeFloat:function(t){this.realloc(4),up(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),up(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var o=t.length;this.writeVarint(o),this.realloc(o);for(var u=0;u<o;u++)this.buf[this.pos++]=t[u]},writeRawMessage:function(t,o){this.pos++;var u=this.pos;t(o,this);var h=this.pos-u;h>=128&&mh(u,h,this),this.pos=u-1,this.writeVarint(h),this.pos+=h},writeMessage:function(t,o,u){this.writeTag(t,ba.Bytes),this.writeRawMessage(o,u)},writePackedVarint:function(t,o){o.length&&this.writeMessage(t,kd,o)},writePackedSVarint:function(t,o){o.length&&this.writeMessage(t,N,o)},writePackedBoolean:function(t,o){o.length&&this.writeMessage(t,Lt,o)},writePackedFloat:function(t,o){o.length&&this.writeMessage(t,ce,o)},writePackedDouble:function(t,o){o.length&&this.writeMessage(t,Fe,o)},writePackedFixed32:function(t,o){o.length&&this.writeMessage(t,rr,o)},writePackedSFixed32:function(t,o){o.length&&this.writeMessage(t,Ot,o)},writePackedFixed64:function(t,o){o.length&&this.writeMessage(t,Qt,o)},writePackedSFixed64:function(t,o){o.length&&this.writeMessage(t,lr,o)},writeBytesField:function(t,o){this.writeTag(t,ba.Bytes),this.writeBytes(o)},writeFixed32Field:function(t,o){this.writeTag(t,ba.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(t,o){this.writeTag(t,ba.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(t,o){this.writeTag(t,ba.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(t,o){this.writeTag(t,ba.Fixed64),this.writeSFixed64(o)},writeVarintField:function(t,o){this.writeTag(t,ba.Varint),this.writeVarint(o)},writeSVarintField:function(t,o){this.writeTag(t,ba.Varint),this.writeSVarint(o)},writeStringField:function(t,o){this.writeTag(t,ba.Bytes),this.writeString(o)},writeFloatField:function(t,o){this.writeTag(t,ba.Fixed32),this.writeFloat(o)},writeDoubleField:function(t,o){this.writeTag(t,ba.Fixed64),this.writeDouble(o)},writeBooleanField:function(t,o){this.writeVarintField(t,Boolean(o))}};var nt=function(t,o){var u=o.pixelRatio,h=o.version,y=o.stretchX,b=o.stretchY,S=o.content;this.paddedRect=t,this.pixelRatio=u,this.stretchX=y,this.stretchY=b,this.content=S,this.version=h},jt={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};jt.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},jt.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},jt.tlbr.get=function(){return this.tl.concat(this.br)},jt.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(nt.prototype,jt);var xr=function(t,o){var u={},h={};this.haveRenderCallbacks=[];var y=[];this.addImages(t,u,y),this.addImages(o,h,y);var b=Cr(y),S=new Fo({width:b.w||1,height:b.h||1});for(var I in t){var D=t[I],z=u[I].paddedRect;Fo.copy(D.data,S,{x:0,y:0},{x:z.x+1,y:z.y+1},D.data)}for(var Z in o){var G=o[Z],q=h[Z].paddedRect,ne=q.x+1,Te=q.y+1,Ie=G.data.width,k=G.data.height;Fo.copy(G.data,S,{x:0,y:0},{x:ne,y:Te},G.data),Fo.copy(G.data,S,{x:0,y:k-1},{x:ne,y:Te-1},{width:Ie,height:1}),Fo.copy(G.data,S,{x:0,y:0},{x:ne,y:Te+k},{width:Ie,height:1}),Fo.copy(G.data,S,{x:Ie-1,y:0},{x:ne-1,y:Te},{width:1,height:k}),Fo.copy(G.data,S,{x:0,y:0},{x:ne+Ie,y:Te},{width:1,height:k})}this.image=S,this.iconPositions=u,this.patternPositions=h};xr.prototype.addImages=function(t,o,u){for(var h in t){var y=t[h],b={x:0,y:0,w:y.data.width+2,h:y.data.height+2};u.push(b),o[h]=new nt(b,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(h)}},xr.prototype.patchUpdatedImages=function(t,o){for(var u in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[u],t.getImage(u),o),this.patchUpdatedImage(this.patternPositions[u],t.getImage(u),o)},xr.prototype.patchUpdatedImage=function(t,o,u){if(t&&o&&t.version!==o.version){t.version=o.version;var h=t.tl;u.update(o.data,void 0,{x:h[0],y:h[1]})}},hn("ImagePosition",nt),hn("ImageAtlas",xr);var Nr={horizontal:1,vertical:2,horizontalOnly:3},ur=function(){this.scale=1,this.fontStack="",this.imageName=null};ur.forText=function(t,o){var u=new ur;return u.scale=t||1,u.fontStack=o,u},ur.forImage=function(t){var o=new ur;return o.imageName=t,o};var Or=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function $r(t,o,u,h,y,b,S,I,D,z,Z,G,q,ne,Te,Ie){var k,Ue=Or.fromFeature(t,y);G===Nr.vertical&&Ue.verticalizePunctuation();var rt=Ms.processBidirectionalText,_t=Ms.processStyledBidirectionalText;if(rt&&Ue.sections.length===1){k=[];for(var zt=0,Vt=rt(Ue.toString(),qr(Ue,z,b,o,h,ne,Te));zt<Vt.length;zt+=1){var ir=Vt[zt],Tr=new Or;Tr.text=ir,Tr.sections=Ue.sections;for(var Dr=0;Dr<ir.length;Dr++)Tr.sectionIndex.push(0);k.push(Tr)}}else if(_t){k=[];for(var Dn=0,cn=_t(Ue.text,Ue.sectionIndex,qr(Ue,z,b,o,h,ne,Te));Dn<cn.length;Dn+=1){var Vn=cn[Dn],pn=new Or;pn.text=Vn[0],pn.sectionIndex=Vn[1],pn.sections=Ue.sections,k.push(pn)}}else k=function(wn,Zi){for(var Si=[],Ji=wn.text,Wn=0,fa=0,Ja=Zi;fa<Ja.length;fa+=1){var yo=Ja[fa];Si.push(wn.substring(Wn,yo)),Wn=yo}return Wn<Ji.length&&Si.push(wn.substring(Wn,Ji.length)),Si}(Ue,qr(Ue,z,b,o,h,ne,Te));var Pi=[],ei={positionedLines:Pi,text:Ue.toString(),top:Z[1],bottom:Z[1],left:Z[0],right:Z[0],writingMode:G,iconsInText:!1,verticalizable:!1};return function(wn,Zi,Si,Ji,Wn,fa,Ja,yo,Ha,eo,_o,Xo){for(var es=0,js=-17,ts=0,Vs=0,to=yo==="right"?1:yo==="left"?0:.5,ls=0,Ci=0,Fa=Wn;Ci<Fa.length;Ci+=1){var Aa=Fa[Ci];Aa.trim();var la=Aa.getMaxScale(),cs=24*(la-1),Ss={positionedGlyphs:[],lineOffset:0};wn.positionedLines[ls]=Ss;var Wa=Ss.positionedGlyphs,Ro=0;if(Aa.length()){for(var fs=0;fs<Aa.length();fs++){var pa=Aa.getSection(fs),$l=Aa.getSectionIndex(fs),au=Aa.getCharCode(fs),af=0,ko=null,Ec=null,tl=null,Gp=24,Lf=!(Ha===Nr.horizontal||!_o&&!Ef(au)||_o&&(Fn[au]||(Cc=au,Zr.Arabic(Cc)||Zr["Arabic Supplement"](Cc)||Zr["Arabic Extended-A"](Cc)||Zr["Arabic Presentation Forms-A"](Cc)||Zr["Arabic Presentation Forms-B"](Cc))));if(pa.imageName){var cp=Ji[pa.imageName];if(!cp)continue;tl=pa.imageName,wn.iconsInText=wn.iconsInText||!0,Ec=cp.paddedRect;var Sc=cp.displaySize;pa.scale=24*pa.scale/Xo,af=cs+(24-Sc[1]*pa.scale),Gp=(ko={width:Sc[0],height:Sc[1],left:1,top:-3,advance:Lf?Sc[1]:Sc[0]}).advance;var fp=Lf?Sc[0]*pa.scale-24*la:Sc[1]*pa.scale-24*la;fp>0&&fp>Ro&&(Ro=fp)}else{var gh=Si[pa.fontStack],pp=gh&&gh[au];if(pp&&pp.rect)Ec=pp.rect,ko=pp.metrics;else{var Hp=Zi[pa.fontStack],yh=Hp&&Hp[au];if(!yh)continue;ko=yh.metrics}af=24*(la-pa.scale)}Lf?(wn.verticalizable=!0,Wa.push({glyph:au,imageName:tl,x:es,y:js+af,vertical:Lf,scale:pa.scale,fontStack:pa.fontStack,sectionIndex:$l,metrics:ko,rect:Ec}),es+=Gp*pa.scale+eo):(Wa.push({glyph:au,imageName:tl,x:es,y:js+af,vertical:Lf,scale:pa.scale,fontStack:pa.fontStack,sectionIndex:$l,metrics:ko,rect:Ec}),es+=ko.advance*pa.scale+eo)}Wa.length!==0&&(ts=Math.max(es-eo,ts),mi(Wa,0,Wa.length-1,to,Ro)),es=0;var _h=fa*la+Ro;Ss.lineOffset=Math.max(Ro,cs),js+=_h,Vs=Math.max(_h,Vs),++ls}else js+=fa,++ls}var Cc,Wp=js- -17,hp=Kr(Ja),of=hp.horizontalAlign,dp=hp.verticalAlign;(function(xh,bh,Xp,ps,Eh,Yp,qp,Kp,Sh){var vp,Ch=(bh-Xp)*Eh;vp=Yp!==qp?-Kp*ps- -17:(-ps*Sh+.5)*qp;for(var mp=0,$p=xh;mp<$p.length;mp+=1)for(var Df=0,Qp=$p[mp].positionedGlyphs;Df<Qp.length;Df+=1){var gp=Qp[Df];gp.x+=Ch,gp.y+=vp}})(wn.positionedLines,to,of,dp,ts,Vs,fa,Wp,Wn.length),wn.top+=-dp*Wp,wn.bottom=wn.top+Wp,wn.left+=-of*ts,wn.right=wn.left+ts}(ei,o,u,h,k,S,I,D,G,z,q,Ie),!function(wn){for(var Zi=0,Si=wn;Zi<Si.length;Zi+=1)if(Si[Zi].positionedGlyphs.length!==0)return!1;return!0}(Pi)&&ei}Or.fromFeature=function(t,o){for(var u=new Or,h=0;h<t.sections.length;h++){var y=t.sections[h];y.image?u.addImageSection(y):u.addTextSection(y,o)}return u},Or.prototype.length=function(){return this.text.length},Or.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},Or.prototype.getSectionIndex=function(t){return this.sectionIndex[t]},Or.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},Or.prototype.verticalizePunctuation=function(){this.text=function(t){for(var o="",u=0;u<t.length;u++){var h=t.charCodeAt(u+1)||null,y=t.charCodeAt(u-1)||null;o+=h&&ll(h)&&!Xl[t[u+1]]||y&&ll(y)&&!Xl[t[u-1]]||!Xl[t[u]]?t[u]:Xl[t[u]]}return o}(this.text)},Or.prototype.trim=function(){for(var t=0,o=0;o<this.text.length&&Fn[this.text.charCodeAt(o)];o++)t++;for(var u=this.text.length,h=this.text.length-1;h>=0&&h>=t&&Fn[this.text.charCodeAt(h)];h--)u--;this.text=this.text.substring(t,u),this.sectionIndex=this.sectionIndex.slice(t,u)},Or.prototype.substring=function(t,o){var u=new Or;return u.text=this.text.substring(t,o),u.sectionIndex=this.sectionIndex.slice(t,o),u.sections=this.sections,u},Or.prototype.toString=function(){return this.text},Or.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce(function(o,u){return Math.max(o,t.sections[u].scale)},0)},Or.prototype.addTextSection=function(t,o){this.text+=t.text,this.sections.push(ur.forText(t.scale,t.fontStack||o));for(var u=this.sections.length-1,h=0;h<t.text.length;++h)this.sectionIndex.push(u)},Or.prototype.addImageSection=function(t){var o=t.image?t.image.name:"";if(o.length!==0){var u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(ur.forImage(o)),this.sectionIndex.push(this.sections.length-1)):$e("Reached maximum number of images 6401")}else $e("Can't add FormattedSection with an empty image.")},Or.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Fn={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Jt={};function tr(t,o,u,h,y,b){if(o.imageName){var S=h[o.imageName];return S?S.displaySize[0]*o.scale*24/b+y:0}var I=u[o.fontStack],D=I&&I[t];return D?D.metrics.advance*o.scale+y:0}function xn(t,o,u,h){var y=Math.pow(t-o,2);return h?t<o?y/2:2*y:y+Math.abs(u)*u}function Vr(t,o,u){var h=0;return t===10&&(h-=1e4),u&&(h+=150),t!==40&&t!==65288||(h+=50),o!==41&&o!==65289||(h+=50),h}function Sr(t,o,u,h,y,b){for(var S=null,I=xn(o,u,y,b),D=0,z=h;D<z.length;D+=1){var Z=z[D],G=xn(o-Z.x,u,y,b)+Z.badness;G<=I&&(S=Z,I=G)}return{index:t,x:o,priorBreak:S,badness:I}}function qr(t,o,u,h,y,b,S){if(b!=="point")return[];if(!t)return[];for(var I,D=[],z=function(k,Ue,rt,_t,zt,Vt){for(var ir=0,Tr=0;Tr<k.length();Tr++){var Dr=k.getSection(Tr);ir+=tr(k.getCharCode(Tr),Dr,_t,zt,Ue,Vt)}return ir/Math.max(1,Math.ceil(ir/rt))}(t,o,u,h,y,S),Z=t.text.indexOf("\u200B")>=0,G=0,q=0;q<t.length();q++){var ne=t.getSection(q),Te=t.getCharCode(q);if(Fn[Te]||(G+=tr(Te,ne,h,y,o,S)),q<t.length()-1){var Ie=!((I=Te)<11904||!(Zr["Bopomofo Extended"](I)||Zr.Bopomofo(I)||Zr["CJK Compatibility Forms"](I)||Zr["CJK Compatibility Ideographs"](I)||Zr["CJK Compatibility"](I)||Zr["CJK Radicals Supplement"](I)||Zr["CJK Strokes"](I)||Zr["CJK Symbols and Punctuation"](I)||Zr["CJK Unified Ideographs Extension A"](I)||Zr["CJK Unified Ideographs"](I)||Zr["Enclosed CJK Letters and Months"](I)||Zr["Halfwidth and Fullwidth Forms"](I)||Zr.Hiragana(I)||Zr["Ideographic Description Characters"](I)||Zr["Kangxi Radicals"](I)||Zr["Katakana Phonetic Extensions"](I)||Zr.Katakana(I)||Zr["Vertical Forms"](I)||Zr["Yi Radicals"](I)||Zr["Yi Syllables"](I)));(Jt[Te]||Ie||ne.imageName)&&D.push(Sr(q+1,G,z,D,Vr(Te,t.getCharCode(q+1),Ie&&Z),!1))}}return function k(Ue){return Ue?k(Ue.priorBreak).concat(Ue.index):[]}(Sr(t.length(),G,z,D,0,!0))}function Kr(t){var o=.5,u=.5;switch(t){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:o,verticalAlign:u}}function mi(t,o,u,h,y){if(h||y)for(var b=t[u],S=(t[u].x+b.metrics.advance*b.scale)*h,I=o;I<=u;I++)t[I].x-=S,t[I].y+=y}function ii(t,o,u,h,y,b){var S,I=t.image;if(I.content){var D=I.content,z=I.pixelRatio||1;S=[D[0]/z,D[1]/z,I.displaySize[0]-D[2]/z,I.displaySize[1]-D[3]/z]}var Z,G,q,ne,Te=o.left*b,Ie=o.right*b;u==="width"||u==="both"?(ne=y[0]+Te-h[3],G=y[0]+Ie+h[1]):G=(ne=y[0]+(Te+Ie-I.displaySize[0])/2)+I.displaySize[0];var k=o.top*b,Ue=o.bottom*b;return u==="height"||u==="both"?(Z=y[1]+k-h[0],q=y[1]+Ue+h[2]):q=(Z=y[1]+(k+Ue-I.displaySize[1])/2)+I.displaySize[1],{image:I,top:Z,right:G,bottom:q,left:ne,collisionPadding:S}}Jt[10]=!0,Jt[32]=!0,Jt[38]=!0,Jt[40]=!0,Jt[41]=!0,Jt[43]=!0,Jt[45]=!0,Jt[47]=!0,Jt[173]=!0,Jt[183]=!0,Jt[8203]=!0,Jt[8208]=!0,Jt[8211]=!0,Jt[8231]=!0;var Hr=function(t){function o(u,h,y,b){t.call(this,u,h),this.angle=y,b!==void 0&&(this.segment=b)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.clone=function(){return new o(this.x,this.y,this.angle,this.segment)},o}(de);function rn(t,o){var u=o.expression;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new Ai(t+1))};if(u.kind==="source")return{kind:"source"};for(var h=u.zoomStops,y=u.interpolationType,b=0;b<h.length&&h[b]<=t;)b++;for(var S=b=Math.max(0,b-1);S<h.length&&h[S]<t+1;)S++;S=Math.min(h.length-1,S);var I=h[b],D=h[S];return u.kind==="composite"?{kind:"composite",minZoom:I,maxZoom:D,interpolationType:y}:{kind:"camera",minZoom:I,maxZoom:D,minSize:u.evaluate(new Ai(I)),maxSize:u.evaluate(new Ai(D)),interpolationType:y}}function Qn(t,o,u){var h=o.uSize,y=u.lowerSize;return t.kind==="source"?y/128:t.kind==="composite"?ma(y/128,u.upperSize/128,o.uSizeT):h}function ci(t,o){var u=0,h=0;if(t.kind==="constant")h=t.layoutSize;else if(t.kind!=="source"){var y=t.interpolationType,b=y?Bt(ge.interpolationFactor(y,o,t.minZoom,t.maxZoom),0,1):0;t.kind==="camera"?h=ma(t.minSize,t.maxSize,b):u=b}return{uSizeT:u,uSize:h}}hn("Anchor",Hr);var Bi=Object.freeze({__proto__:null,getSizeData:rn,evaluateSizeForFeature:Qn,evaluateSizeForZoom:ci,SIZE_PACK_FACTOR:128});function oo(t,o,u,h,y){if(o.segment===void 0)return!0;for(var b=o,S=o.segment+1,I=0;I>-u/2;){if(--S<0)return!1;I-=t[S].dist(b),b=t[S]}I+=t[S].dist(t[S+1]),S++;for(var D=[],z=0;I<u/2;){var Z=t[S],G=t[S+1];if(!G)return!1;var q=t[S-1].angleTo(Z)-Z.angleTo(G);for(q=Math.abs((q+3*Math.PI)%(2*Math.PI)-Math.PI),D.push({distance:I,angleDelta:q}),z+=q;I-D[0].distance>h;)z-=D.shift().angleDelta;if(z>y)return!1;S++,I+=Z.dist(G)}return!0}function so(t){for(var o=0,u=0;u<t.length-1;u++)o+=t[u].dist(t[u+1]);return o}function Di(t,o,u){return t?.6*o*u:0}function Jo(t,o){return Math.max(t?t.right-t.left:0,o?o.right-o.left:0)}function ja(t,o,u,h,y,b){for(var S=Di(u,y,b),I=Jo(u,h)*b,D=0,z=so(t)/2,Z=0;Z<t.length-1;Z++){var G=t[Z],q=t[Z+1],ne=G.dist(q);if(D+ne>z){var Te=(z-D)/ne,Ie=ma(G.x,q.x,Te),k=ma(G.y,q.y,Te),Ue=new Hr(Ie,k,q.angleTo(G),Z);return Ue._round(),!S||oo(t,Ue,I,S,o)?Ue:void 0}D+=ne}}function Bo(t,o,u,h,y,b,S,I,D){var z=Di(h,b,S),Z=Jo(h,y),G=Z*S,q=t[0].x===0||t[0].x===D||t[0].y===0||t[0].y===D;return o-G<o/4&&(o=G+o/4),function ne(Te,Ie,k,Ue,rt,_t,zt,Vt,ir){for(var Tr=_t/2,Dr=so(Te),Dn=0,cn=Ie-k,Vn=[],pn=0;pn<Te.length-1;pn++){for(var Pi=Te[pn],ei=Te[pn+1],wn=Pi.dist(ei),Zi=ei.angleTo(Pi);cn+k<Dn+wn;){var Si=((cn+=k)-Dn)/wn,Ji=ma(Pi.x,ei.x,Si),Wn=ma(Pi.y,ei.y,Si);if(Ji>=0&&Ji<ir&&Wn>=0&&Wn<ir&&cn-Tr>=0&&cn+Tr<=Dr){var fa=new Hr(Ji,Wn,Zi,pn);fa._round(),Ue&&!oo(Te,fa,_t,Ue,rt)||Vn.push(fa)}}Dn+=wn}return Vt||Vn.length||zt||(Vn=ne(Te,Dn/2,k,Ue,rt,_t,zt,!0,ir)),Vn}(t,q?o/2*I%o:(Z/2+2*b)*S*I%o,o,z,u,G,q,!1,D)}function So(t,o,u,h,y){for(var b=[],S=0;S<t.length;S++)for(var I=t[S],D=void 0,z=0;z<I.length-1;z++){var Z=I[z],G=I[z+1];Z.x<o&&G.x<o||(Z.x<o?Z=new de(o,Z.y+(o-Z.x)/(G.x-Z.x)*(G.y-Z.y))._round():G.x<o&&(G=new de(o,Z.y+(o-Z.x)/(G.x-Z.x)*(G.y-Z.y))._round()),Z.y<u&&G.y<u||(Z.y<u?Z=new de(Z.x+(u-Z.y)/(G.y-Z.y)*(G.x-Z.x),u)._round():G.y<u&&(G=new de(Z.x+(u-Z.y)/(G.y-Z.y)*(G.x-Z.x),u)._round()),Z.x>=h&&G.x>=h||(Z.x>=h?Z=new de(h,Z.y+(h-Z.x)/(G.x-Z.x)*(G.y-Z.y))._round():G.x>=h&&(G=new de(h,Z.y+(h-Z.x)/(G.x-Z.x)*(G.y-Z.y))._round()),Z.y>=y&&G.y>=y||(Z.y>=y?Z=new de(Z.x+(y-Z.y)/(G.y-Z.y)*(G.x-Z.x),y)._round():G.y>=y&&(G=new de(Z.x+(y-Z.y)/(G.y-Z.y)*(G.x-Z.x),y)._round()),D&&Z.equals(D[D.length-1])||b.push(D=[Z]),D.push(G)))))}return b}function Ho(t,o,u,h){var y=[],b=t.image,S=b.pixelRatio,I=b.paddedRect.w-2,D=b.paddedRect.h-2,z=t.right-t.left,Z=t.bottom-t.top,G=b.stretchX||[[0,I]],q=b.stretchY||[[0,D]],ne=function(Ji,Wn){return Ji+Wn[1]-Wn[0]},Te=G.reduce(ne,0),Ie=q.reduce(ne,0),k=I-Te,Ue=D-Ie,rt=0,_t=Te,zt=0,Vt=Ie,ir=0,Tr=k,Dr=0,Dn=Ue;if(b.content&&h){var cn=b.content;rt=Io(G,0,cn[0]),zt=Io(q,0,cn[1]),_t=Io(G,cn[0],cn[2]),Vt=Io(q,cn[1],cn[3]),ir=cn[0]-rt,Dr=cn[1]-zt,Tr=cn[2]-cn[0]-_t,Dn=cn[3]-cn[1]-Vt}var Vn=function(Ji,Wn,fa,Ja){var yo=po(Ji.stretch-rt,_t,z,t.left),Ha=gi(Ji.fixed-ir,Tr,Ji.stretch,Te),eo=po(Wn.stretch-zt,Vt,Z,t.top),_o=gi(Wn.fixed-Dr,Dn,Wn.stretch,Ie),Xo=po(fa.stretch-rt,_t,z,t.left),es=gi(fa.fixed-ir,Tr,fa.stretch,Te),js=po(Ja.stretch-zt,Vt,Z,t.top),ts=gi(Ja.fixed-Dr,Dn,Ja.stretch,Ie),Vs=new de(yo,eo),to=new de(Xo,eo),ls=new de(Xo,js),Ci=new de(yo,js),Fa=new de(Ha/S,_o/S),Aa=new de(es/S,ts/S),la=o*Math.PI/180;if(la){var cs=Math.sin(la),Ss=Math.cos(la),Wa=[Ss,-cs,cs,Ss];Vs._matMult(Wa),to._matMult(Wa),Ci._matMult(Wa),ls._matMult(Wa)}var Ro=Ji.stretch+Ji.fixed,fs=Wn.stretch+Wn.fixed;return{tl:Vs,tr:to,bl:Ci,br:ls,tex:{x:b.paddedRect.x+1+Ro,y:b.paddedRect.y+1+fs,w:fa.stretch+fa.fixed-Ro,h:Ja.stretch+Ja.fixed-fs},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Fa,pixelOffsetBR:Aa,minFontScaleX:Tr/S/z,minFontScaleY:Dn/S/Z,isSDF:u}};if(h&&(b.stretchX||b.stretchY))for(var pn=os(G,k,Te),Pi=os(q,Ue,Ie),ei=0;ei<pn.length-1;ei++)for(var wn=pn[ei],Zi=pn[ei+1],Si=0;Si<Pi.length-1;Si++)y.push(Vn(wn,Pi[Si],Zi,Pi[Si+1]));else y.push(Vn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:I+1},{fixed:0,stretch:D+1}));return y}function Io(t,o,u){for(var h=0,y=0,b=t;y<b.length;y+=1){var S=b[y];h+=Math.max(o,Math.min(u,S[1]))-Math.max(o,Math.min(u,S[0]))}return h}function os(t,o,u){for(var h=[{fixed:-1,stretch:0}],y=0,b=t;y<b.length;y+=1){var S=b[y],I=S[0],D=S[1],z=h[h.length-1];h.push({fixed:I-z.stretch,stretch:z.stretch}),h.push({fixed:I-z.stretch,stretch:z.stretch+(D-I)})}return h.push({fixed:o+1,stretch:u}),h}function po(t,o,u,h){return t/o*u+h}function gi(t,o,u,h){return t-o*u/h}var Oo=function(t,o,u,h,y,b,S,I,D,z){if(this.boxStartIndex=t.length,D){var Z=b.top,G=b.bottom,q=b.collisionPadding;q&&(Z-=q[1],G+=q[3]);var ne=G-Z;ne>0&&(ne=Math.max(10,ne),this.circleDiameter=ne)}else{var Te=b.top*S-I,Ie=b.bottom*S+I,k=b.left*S-I,Ue=b.right*S+I,rt=b.collisionPadding;if(rt&&(k-=rt[0]*S,Te-=rt[1]*S,Ue+=rt[2]*S,Ie+=rt[3]*S),z){var _t=new de(k,Te),zt=new de(Ue,Te),Vt=new de(k,Ie),ir=new de(Ue,Ie),Tr=z*Math.PI/180;_t._rotate(Tr),zt._rotate(Tr),Vt._rotate(Tr),ir._rotate(Tr),k=Math.min(_t.x,zt.x,Vt.x,ir.x),Ue=Math.max(_t.x,zt.x,Vt.x,ir.x),Te=Math.min(_t.y,zt.y,Vt.y,ir.y),Ie=Math.max(_t.y,zt.y,Vt.y,ir.y)}t.emplaceBack(o.x,o.y,k,Te,Ue,Ie,u,h,y)}this.boxEndIndex=t.length},Qi=function(t,o){if(t===void 0&&(t=[]),o===void 0&&(o=No),this.data=t,this.length=this.data.length,this.compare=o,this.length>0)for(var u=(this.length>>1)-1;u>=0;u--)this._down(u)};function No(t,o){return t<o?-1:t>o?1:0}function ti(t,o,u){o===void 0&&(o=1),u===void 0&&(u=!1);for(var h=1/0,y=1/0,b=-1/0,S=-1/0,I=t[0],D=0;D<I.length;D++){var z=I[D];(!D||z.x<h)&&(h=z.x),(!D||z.y<y)&&(y=z.y),(!D||z.x>b)&&(b=z.x),(!D||z.y>S)&&(S=z.y)}var Z=Math.min(b-h,S-y),G=Z/2,q=new Qi([],Ni);if(Z===0)return new de(h,y);for(var ne=h;ne<b;ne+=Z)for(var Te=y;Te<S;Te+=Z)q.push(new va(ne+G,Te+G,G,t));for(var Ie=function(rt){for(var _t=0,zt=0,Vt=0,ir=rt[0],Tr=0,Dr=ir.length,Dn=Dr-1;Tr<Dr;Dn=Tr++){var cn=ir[Tr],Vn=ir[Dn],pn=cn.x*Vn.y-Vn.x*cn.y;zt+=(cn.x+Vn.x)*pn,Vt+=(cn.y+Vn.y)*pn,_t+=3*pn}return new va(zt/_t,Vt/_t,0,rt)}(t),k=q.length;q.length;){var Ue=q.pop();(Ue.d>Ie.d||!Ie.d)&&(Ie=Ue,u&&console.log("found best %d after %d probes",Math.round(1e4*Ue.d)/1e4,k)),Ue.max-Ie.d<=o||(q.push(new va(Ue.p.x-(G=Ue.h/2),Ue.p.y-G,G,t)),q.push(new va(Ue.p.x+G,Ue.p.y-G,G,t)),q.push(new va(Ue.p.x-G,Ue.p.y+G,G,t)),q.push(new va(Ue.p.x+G,Ue.p.y+G,G,t)),k+=4)}return u&&(console.log("num probes: "+k),console.log("best distance: "+Ie.d)),Ie.p}function Ni(t,o){return o.max-t.max}function va(t,o,u,h){this.p=new de(t,o),this.h=u,this.d=function(y,b){for(var S=!1,I=1/0,D=0;D<b.length;D++)for(var z=b[D],Z=0,G=z.length,q=G-1;Z<G;q=Z++){var ne=z[Z],Te=z[q];ne.y>y.y!=Te.y>y.y&&y.x<(Te.x-ne.x)*(y.y-ne.y)/(Te.y-ne.y)+ne.x&&(S=!S),I=Math.min(I,gl(y,ne,Te))}return(S?1:-1)*Math.sqrt(I)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}Qi.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},Qi.prototype.pop=function(){if(this.length!==0){var t=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),t}},Qi.prototype.peek=function(){return this.data[0]},Qi.prototype._up=function(t){for(var o=this.data,u=this.compare,h=o[t];t>0;){var y=t-1>>1,b=o[y];if(u(h,b)>=0)break;o[t]=b,t=y}o[t]=h},Qi.prototype._down=function(t){for(var o=this.data,u=this.compare,h=this.length>>1,y=o[t];t<h;){var b=1+(t<<1),S=o[b],I=b+1;if(I<this.length&&u(o[I],S)<0&&(b=I,S=o[I]),u(S,y)>=0)break;o[t]=S,t=b}o[t]=y};var Bn=Number.POSITIVE_INFINITY;function ai(t,o){return o[1]!==Bn?function(u,h,y){var b=0,S=0;switch(h=Math.abs(h),y=Math.abs(y),u){case"top-right":case"top-left":case"top":S=y-7;break;case"bottom-right":case"bottom-left":case"bottom":S=7-y}switch(u){case"top-right":case"bottom-right":case"right":b=-h;break;case"top-left":case"bottom-left":case"left":b=h}return[b,S]}(t,o[0],o[1]):function(u,h){var y=0,b=0;h<0&&(h=0);var S=h/Math.sqrt(2);switch(u){case"top-right":case"top-left":b=S-7;break;case"bottom-right":case"bottom-left":b=7-S;break;case"bottom":b=7-h;break;case"top":b=h-7}switch(u){case"top-right":case"bottom-right":y=-S;break;case"top-left":case"bottom-left":y=S;break;case"left":y=h;break;case"right":y=-h}return[y,b]}(t,o[0])}function we(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Nt(t,o,u,h,y,b,S,I,D,z,Z,G,q,ne,Te){var Ie=function(zt,Vt,ir,Tr,Dr,Dn,cn,Vn){for(var pn=Tr.layout.get("text-rotate").evaluate(Dn,{})*Math.PI/180,Pi=[],ei=0,wn=Vt.positionedLines;ei<wn.length;ei+=1)for(var Zi=wn[ei],Si=0,Ji=Zi.positionedGlyphs;Si<Ji.length;Si+=1){var Wn=Ji[Si];if(Wn.rect){var fa=Wn.rect||{},Ja=4,yo=!0,Ha=1,eo=0,_o=(Dr||Vn)&&Wn.vertical,Xo=Wn.metrics.advance*Wn.scale/2;if(Vn&&Vt.verticalizable&&(eo=Zi.lineOffset/2-(Wn.imageName?-(24-Wn.metrics.width*Wn.scale)/2:24*(Wn.scale-1))),Wn.imageName){var es=cn[Wn.imageName];yo=es.sdf,Ja=1/(Ha=es.pixelRatio)}var js=Dr?[Wn.x+Xo,Wn.y]:[0,0],ts=Dr?[0,0]:[Wn.x+Xo+ir[0],Wn.y+ir[1]-eo],Vs=[0,0];_o&&(Vs=ts,ts=[0,0]);var to=(Wn.metrics.left-Ja)*Wn.scale-Xo+ts[0],ls=(-Wn.metrics.top-Ja)*Wn.scale+ts[1],Ci=to+fa.w*Wn.scale/Ha,Fa=ls+fa.h*Wn.scale/Ha,Aa=new de(to,ls),la=new de(Ci,ls),cs=new de(to,Fa),Ss=new de(Ci,Fa);if(_o){var Wa=new de(-Xo,Xo- -17),Ro=-Math.PI/2,fs=12-Xo,pa=new de(22-fs,-(Wn.imageName?fs:0)),$l=new(Function.prototype.bind.apply(de,[null].concat(Vs)));Aa._rotateAround(Ro,Wa)._add(pa)._add($l),la._rotateAround(Ro,Wa)._add(pa)._add($l),cs._rotateAround(Ro,Wa)._add(pa)._add($l),Ss._rotateAround(Ro,Wa)._add(pa)._add($l)}if(pn){var au=Math.sin(pn),af=Math.cos(pn),ko=[af,-au,au,af];Aa._matMult(ko),la._matMult(ko),cs._matMult(ko),Ss._matMult(ko)}var Ec=new de(0,0),tl=new de(0,0);Pi.push({tl:Aa,tr:la,bl:cs,br:Ss,tex:fa,writingMode:Vt.writingMode,glyphOffset:js,sectionIndex:Wn.sectionIndex,isSDF:yo,pixelOffsetTL:Ec,pixelOffsetBR:tl,minFontScaleX:0,minFontScaleY:0})}}return Pi}(0,u,I,y,b,S,h,t.allowVerticalPlacement),k=t.textSizeData,Ue=null;k.kind==="source"?(Ue=[128*y.layout.get("text-size").evaluate(S,{})])[0]>32640&&$e(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):k.kind==="composite"&&((Ue=[128*ne.compositeTextSizes[0].evaluate(S,{},Te),128*ne.compositeTextSizes[1].evaluate(S,{},Te)])[0]>32640||Ue[1]>32640)&&$e(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),t.addSymbols(t.text,Ie,Ue,I,b,S,z,o,D.lineStartIndex,D.lineLength,q,Te);for(var rt=0,_t=Z;rt<_t.length;rt+=1)G[_t[rt]]=t.text.placedSymbolArray.length-1;return 4*Ie.length}function bt(t){for(var o in t)return t[o];return null}function dn(t,o,u,h){var y=t.compareText;if(o in y){for(var b=y[o],S=b.length-1;S>=0;S--)if(h.dist(b[S])<u)return!0}else y[o]=[];return y[o].push(h),!1}var Vi=Eu.VectorTileFeature.types,Ee=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ie(t,o,u,h,y,b,S,I,D,z,Z,G,q){var ne=I?Math.min(32640,Math.round(I[0])):0,Te=I?Math.min(32640,Math.round(I[1])):0;t.emplaceBack(o,u,Math.round(32*h),Math.round(32*y),b,S,(ne<<1)+(D?1:0),Te,16*z,16*Z,256*G,256*q)}function Ve(t,o,u){t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u)}function ot(t){for(var o=0,u=t.sections;o<u.length;o+=1)if(Sf(u[o].text))return!0;return!1}var Pt=function(t){this.layoutVertexArray=new hl,this.indexArray=new dl,this.programConfigurations=t,this.segments=new se,this.dynamicLayoutVertexArray=new Lu,this.opacityVertexArray=new Qu,this.placedSymbolArray=new d};Pt.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Pt.prototype.upload=function(t,o,u,h){this.isEmpty()||(u&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Od.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,zp.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Ee,!0),this.opacityVertexBuffer.itemSize=1),(u||h)&&this.programConfigurations.upload(t))},Pt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},hn("SymbolBuffers",Pt);var Xe=function(t,o,u){this.layoutVertexArray=new t,this.layoutAttributes=o,this.indexArray=new u,this.segments=new se,this.collisionVertexArray=new Ul};Xe.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Rd.members,!0)},Xe.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},hn("CollisionBuffers",Xe);var De=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(b){return b.id}),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ns([]),this.placementViewportMatrix=Ns([]);var o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=rn(this.zoom,o["text-size"]),this.iconSizeData=rn(this.zoom,o["icon-size"]);var u=this.layers[0].layout,h=u.get("symbol-sort-key"),y=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,u.get("symbol-placement")==="point"&&(this.writingModes=u.get("text-writing-mode").map(function(b){return Nr[b]})),this.stateDependentLayerIds=this.layers.filter(function(b){return b.isStateDependent()}).map(function(b){return b.id}),this.sourceID=t.sourceID};De.prototype.createArrays=function(){this.text=new Pt(new Xn(this.layers,this.zoom,function(t){return/^text/.test(t)})),this.icon=new Pt(new Xn(this.layers,this.zoom,function(t){return/^icon/.test(t)})),this.glyphOffsetArray=new P,this.lineVertexArray=new L,this.symbolInstances=new w},De.prototype.calculateGlyphDependencies=function(t,o,u,h,y){for(var b=0;b<t.length;b++)if(o[t.charCodeAt(b)]=!0,(u||h)&&y){var S=Xl[t.charAt(b)];S&&(o[S.charCodeAt(0)]=!0)}},De.prototype.populate=function(t,o,u){var h=this.layers[0],y=h.layout,b=y.get("text-font"),S=y.get("text-field"),I=y.get("icon-image"),D=(S.value.kind!=="constant"||S.value.value instanceof gt&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),z=I.value.kind!=="constant"||!!I.value.value||Object.keys(I.parameters).length>0,Z=y.get("symbol-sort-key");if(this.features=[],D||z){for(var G=o.iconDependencies,q=o.glyphDependencies,ne=o.availableImages,Te=new Ai(this.zoom),Ie=0,k=t;Ie<k.length;Ie+=1){var Ue=k[Ie],rt=Ue.feature,_t=Ue.id,zt=Ue.index,Vt=Ue.sourceLayerIndex,ir=h._featureFilter.needGeometry,Tr=fo(rt,ir);if(h._featureFilter.filter(Te,Tr,u)){ir||(Tr.geometry=Ga(rt));var Dr=void 0;if(D){var Dn=h.getValueAndResolveTokens("text-field",Tr,u,ne),cn=gt.factory(Dn);ot(cn)&&(this.hasRTLText=!0),(!this.hasRTLText||Cf()==="unavailable"||this.hasRTLText&&Ms.isParsed())&&(Dr=sp(cn,h,Tr))}var Vn=void 0;if(z){var pn=h.getValueAndResolveTokens("icon-image",Tr,u,ne);Vn=pn instanceof aa?pn:aa.fromString(pn)}if(Dr||Vn){var Pi=this.sortFeaturesByKey?Z.evaluate(Tr,{},u):void 0;if(this.features.push({id:_t,text:Dr,icon:Vn,index:zt,sourceLayerIndex:Vt,geometry:Tr.geometry,properties:rt.properties,type:Vi[rt.type],sortKey:Pi}),Vn&&(G[Vn.name]=!0),Dr){var ei=b.evaluate(Tr,{},u).join(","),wn=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Nr.vertical)>=0;for(var Zi=0,Si=Dr.sections;Zi<Si.length;Zi+=1){var Ji=Si[Zi];if(Ji.image)G[Ji.image.name]=!0;else{var Wn=cc(Dr.toString()),fa=Ji.fontStack||ei,Ja=q[fa]=q[fa]||{};this.calculateGlyphDependencies(Ji.text,Ja,wn,this.allowVerticalPlacement,Wn)}}}}}}y.get("symbol-placement")==="line"&&(this.features=function(yo){var Ha={},eo={},_o=[],Xo=0;function es(Wa){_o.push(yo[Wa]),Xo++}function js(Wa,Ro,fs){var pa=eo[Wa];return delete eo[Wa],eo[Ro]=pa,_o[pa].geometry[0].pop(),_o[pa].geometry[0]=_o[pa].geometry[0].concat(fs[0]),pa}function ts(Wa,Ro,fs){var pa=Ha[Ro];return delete Ha[Ro],Ha[Wa]=pa,_o[pa].geometry[0].shift(),_o[pa].geometry[0]=fs[0].concat(_o[pa].geometry[0]),pa}function Vs(Wa,Ro,fs){var pa=fs?Ro[0][Ro[0].length-1]:Ro[0][0];return Wa+":"+pa.x+":"+pa.y}for(var to=0;to<yo.length;to++){var ls=yo[to],Ci=ls.geometry,Fa=ls.text?ls.text.toString():null;if(Fa){var Aa=Vs(Fa,Ci),la=Vs(Fa,Ci,!0);if(Aa in eo&&la in Ha&&eo[Aa]!==Ha[la]){var cs=ts(Aa,la,Ci),Ss=js(Aa,la,_o[cs].geometry);delete Ha[Aa],delete eo[la],eo[Vs(Fa,_o[Ss].geometry,!0)]=Ss,_o[cs].geometry=null}else Aa in eo?js(Aa,la,Ci):la in Ha?ts(Aa,la,Ci):(es(to),Ha[Aa]=Xo-1,eo[la]=Xo-1)}else es(to)}return _o.filter(function(Wa){return Wa.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(yo,Ha){return yo.sortKey-Ha.sortKey})}},De.prototype.update=function(t,o,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,o,this.layers,u),this.icon.programConfigurations.updatePaintArrays(t,o,this.layers,u))},De.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},De.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},De.prototype.upload=function(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},De.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},De.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},De.prototype.addToLineVertexArray=function(t,o){var u=this.lineVertexArray.length;if(t.segment!==void 0){for(var h=t.dist(o[t.segment+1]),y=t.dist(o[t.segment]),b={},S=t.segment+1;S<o.length;S++)b[S]={x:o[S].x,y:o[S].y,tileUnitDistanceFromAnchor:h},S<o.length-1&&(h+=o[S+1].dist(o[S]));for(var I=t.segment||0;I>=0;I--)b[I]={x:o[I].x,y:o[I].y,tileUnitDistanceFromAnchor:y},I>0&&(y+=o[I-1].dist(o[I]));for(var D=0;D<o.length;D++){var z=b[D];this.lineVertexArray.emplaceBack(z.x,z.y,z.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}},De.prototype.addSymbols=function(t,o,u,h,y,b,S,I,D,z,Z,G){for(var q=t.indexArray,ne=t.layoutVertexArray,Te=t.segments.prepareSegment(4*o.length,ne,q,this.canOverlap?b.sortKey:void 0),Ie=this.glyphOffsetArray.length,k=Te.vertexLength,Ue=this.allowVerticalPlacement&&S===Nr.vertical?Math.PI/2:0,rt=b.text&&b.text.sections,_t=0;_t<o.length;_t++){var zt=o[_t],Vt=zt.tl,ir=zt.tr,Tr=zt.bl,Dr=zt.br,Dn=zt.tex,cn=zt.pixelOffsetTL,Vn=zt.pixelOffsetBR,pn=zt.minFontScaleX,Pi=zt.minFontScaleY,ei=zt.glyphOffset,wn=zt.isSDF,Zi=zt.sectionIndex,Si=Te.vertexLength,Ji=ei[1];ie(ne,I.x,I.y,Vt.x,Ji+Vt.y,Dn.x,Dn.y,u,wn,cn.x,cn.y,pn,Pi),ie(ne,I.x,I.y,ir.x,Ji+ir.y,Dn.x+Dn.w,Dn.y,u,wn,Vn.x,cn.y,pn,Pi),ie(ne,I.x,I.y,Tr.x,Ji+Tr.y,Dn.x,Dn.y+Dn.h,u,wn,cn.x,Vn.y,pn,Pi),ie(ne,I.x,I.y,Dr.x,Ji+Dr.y,Dn.x+Dn.w,Dn.y+Dn.h,u,wn,Vn.x,Vn.y,pn,Pi),Ve(t.dynamicLayoutVertexArray,I,Ue),q.emplaceBack(Si,Si+1,Si+2),q.emplaceBack(Si+1,Si+2,Si+3),Te.vertexLength+=4,Te.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ei[0]),_t!==o.length-1&&Zi===o[_t+1].sectionIndex||t.programConfigurations.populatePaintArrays(ne.length,b,b.index,{},G,rt&&rt[Zi])}t.placedSymbolArray.emplaceBack(I.x,I.y,Ie,this.glyphOffsetArray.length-Ie,k,D,z,I.segment,u?u[0]:0,u?u[1]:0,h[0],h[1],S,0,!1,0,Z)},De.prototype._addCollisionDebugVertex=function(t,o,u,h,y,b){return o.emplaceBack(0,0),t.emplaceBack(u.x,u.y,h,y,Math.round(b.x),Math.round(b.y))},De.prototype.addCollisionDebugVertices=function(t,o,u,h,y,b,S){var I=y.segments.prepareSegment(4,y.layoutVertexArray,y.indexArray),D=I.vertexLength,z=y.layoutVertexArray,Z=y.collisionVertexArray,G=S.anchorX,q=S.anchorY;this._addCollisionDebugVertex(z,Z,b,G,q,new de(t,o)),this._addCollisionDebugVertex(z,Z,b,G,q,new de(u,o)),this._addCollisionDebugVertex(z,Z,b,G,q,new de(u,h)),this._addCollisionDebugVertex(z,Z,b,G,q,new de(t,h)),I.vertexLength+=4;var ne=y.indexArray;ne.emplaceBack(D,D+1),ne.emplaceBack(D+1,D+2),ne.emplaceBack(D+2,D+3),ne.emplaceBack(D+3,D),I.primitiveLength+=4},De.prototype.addDebugCollisionBoxes=function(t,o,u,h){for(var y=t;y<o;y++){var b=this.collisionBoxArray.get(y);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,h?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,u)}},De.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Xe(Pa,vh.members,Zl),this.iconCollisionBox=new Xe(Pa,vh.members,Zl);for(var t=0;t<this.symbolInstances.length;t++){var o=this.symbolInstances.get(t);this.addDebugCollisionBoxes(o.textBoxStartIndex,o.textBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.iconBoxStartIndex,o.iconBoxEndIndex,o,!1),this.addDebugCollisionBoxes(o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o,!1)}},De.prototype._deserializeCollisionBoxesForSymbol=function(t,o,u,h,y,b,S,I,D){for(var z={},Z=o;Z<u;Z++){var G=t.get(Z);z.textBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,anchorPointX:G.anchorPointX,anchorPointY:G.anchorPointY},z.textFeatureIndex=G.featureIndex;break}for(var q=h;q<y;q++){var ne=t.get(q);z.verticalTextBox={x1:ne.x1,y1:ne.y1,x2:ne.x2,y2:ne.y2,anchorPointX:ne.anchorPointX,anchorPointY:ne.anchorPointY},z.verticalTextFeatureIndex=ne.featureIndex;break}for(var Te=b;Te<S;Te++){var Ie=t.get(Te);z.iconBox={x1:Ie.x1,y1:Ie.y1,x2:Ie.x2,y2:Ie.y2,anchorPointX:Ie.anchorPointX,anchorPointY:Ie.anchorPointY},z.iconFeatureIndex=Ie.featureIndex;break}for(var k=I;k<D;k++){var Ue=t.get(k);z.verticalIconBox={x1:Ue.x1,y1:Ue.y1,x2:Ue.x2,y2:Ue.y2,anchorPointX:Ue.anchorPointX,anchorPointY:Ue.anchorPointY},z.verticalIconFeatureIndex=Ue.featureIndex;break}return z},De.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var o=0;o<this.symbolInstances.length;o++){var u=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}},De.prototype.hasTextData=function(){return this.text.segments.get().length>0},De.prototype.hasIconData=function(){return this.icon.segments.get().length>0},De.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},De.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},De.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},De.prototype.addIndicesForPlacedSymbol=function(t,o){for(var u=t.placedSymbolArray.get(o),h=u.vertexStartIndex+4*u.numGlyphs,y=u.vertexStartIndex;y<h;y+=4)t.indexArray.emplaceBack(y,y+1,y+2),t.indexArray.emplaceBack(y+1,y+2,y+3)},De.prototype.getSortedSymbolIndexes=function(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var o=Math.sin(t),u=Math.cos(t),h=[],y=[],b=[],S=0;S<this.symbolInstances.length;++S){b.push(S);var I=this.symbolInstances.get(S);h.push(0|Math.round(o*I.anchorX+u*I.anchorY)),y.push(I.featureIndex)}return b.sort(function(D,z){return h[D]-h[z]||y[z]-y[D]}),b},De.prototype.addToSortKeyRanges=function(t,o){var u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===o?u.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:t,symbolInstanceEnd:t+1})},De.prototype.sortFeatures=function(t){var o=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var u=0,h=this.symbolInstanceIndexes;u<h.length;u+=1){var y=this.symbolInstances.get(h[u]);this.featureSortOrder.push(y.featureIndex),[y.rightJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.leftJustifiedTextSymbolIndex].forEach(function(b,S,I){b>=0&&I.indexOf(b)===S&&o.addIndicesForPlacedSymbol(o.text,b)}),y.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,y.verticalPlacedTextSymbolIndex),y.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,y.placedIconSymbolIndex),y.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,y.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},hn("SymbolBucket",De,{omit:["layers","collisionBoxArray","features","compareText"]}),De.MAX_GLYPHS=65535,De.addDynamicAttributes=Ve;var Je=new Go({"symbol-placement":new Rn(oe.layout_symbol["symbol-placement"]),"symbol-spacing":new Rn(oe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Rn(oe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Cn(oe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Rn(oe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Rn(oe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Rn(oe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Rn(oe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Rn(oe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Cn(oe.layout_symbol["icon-size"]),"icon-text-fit":new Rn(oe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Rn(oe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Cn(oe.layout_symbol["icon-image"]),"icon-rotate":new Cn(oe.layout_symbol["icon-rotate"]),"icon-padding":new Rn(oe.layout_symbol["icon-padding"]),"icon-keep-upright":new Rn(oe.layout_symbol["icon-keep-upright"]),"icon-offset":new Cn(oe.layout_symbol["icon-offset"]),"icon-anchor":new Cn(oe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Rn(oe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Rn(oe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Rn(oe.layout_symbol["text-rotation-alignment"]),"text-field":new Cn(oe.layout_symbol["text-field"]),"text-font":new Cn(oe.layout_symbol["text-font"]),"text-size":new Cn(oe.layout_symbol["text-size"]),"text-max-width":new Cn(oe.layout_symbol["text-max-width"]),"text-line-height":new Rn(oe.layout_symbol["text-line-height"]),"text-letter-spacing":new Cn(oe.layout_symbol["text-letter-spacing"]),"text-justify":new Cn(oe.layout_symbol["text-justify"]),"text-radial-offset":new Cn(oe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Rn(oe.layout_symbol["text-variable-anchor"]),"text-anchor":new Cn(oe.layout_symbol["text-anchor"]),"text-max-angle":new Rn(oe.layout_symbol["text-max-angle"]),"text-writing-mode":new Rn(oe.layout_symbol["text-writing-mode"]),"text-rotate":new Cn(oe.layout_symbol["text-rotate"]),"text-padding":new Rn(oe.layout_symbol["text-padding"]),"text-keep-upright":new Rn(oe.layout_symbol["text-keep-upright"]),"text-transform":new Cn(oe.layout_symbol["text-transform"]),"text-offset":new Cn(oe.layout_symbol["text-offset"]),"text-allow-overlap":new Rn(oe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Rn(oe.layout_symbol["text-ignore-placement"]),"text-optional":new Rn(oe.layout_symbol["text-optional"])}),ve={paint:new Go({"icon-opacity":new Cn(oe.paint_symbol["icon-opacity"]),"icon-color":new Cn(oe.paint_symbol["icon-color"]),"icon-halo-color":new Cn(oe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Cn(oe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Cn(oe.paint_symbol["icon-halo-blur"]),"icon-translate":new Rn(oe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Rn(oe.paint_symbol["icon-translate-anchor"]),"text-opacity":new Cn(oe.paint_symbol["text-opacity"]),"text-color":new Cn(oe.paint_symbol["text-color"],{runtimeType:Wr,getOverride:function(t){return t.textColor},hasOverride:function(t){return!!t.textColor}}),"text-halo-color":new Cn(oe.paint_symbol["text-halo-color"]),"text-halo-width":new Cn(oe.paint_symbol["text-halo-width"]),"text-halo-blur":new Cn(oe.paint_symbol["text-halo-blur"]),"text-translate":new Rn(oe.paint_symbol["text-translate"]),"text-translate-anchor":new Rn(oe.paint_symbol["text-translate-anchor"])}),layout:Je},Ze=function(t){this.type=t.property.overrides?t.property.overrides.runtimeType:fn,this.defaultValue=t};Ze.prototype.evaluate=function(t){if(t.formattedSection){var o=this.defaultValue.property.overrides;if(o&&o.hasOverride(t.formattedSection))return o.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default},Ze.prototype.eachChild=function(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)},Ze.prototype.outputDefined=function(){return!1},Ze.prototype.serialize=function(){return null},hn("FormatSectionOverride",Ze,{omit:["defaultValue"]});var Ae=function(t){function o(u){t.call(this,u,ve)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.recalculate=function(u,h){if(t.prototype.recalculate.call(this,u,h),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var y=this.layout.get("text-writing-mode");if(y){for(var b=[],S=0,I=y;S<I.length;S+=1){var D=I[S];b.indexOf(D)<0&&b.push(D)}this.layout._values["text-writing-mode"]=b}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},o.prototype.getValueAndResolveTokens=function(u,h,y,b){var S=this.layout.get(u).evaluate(h,{},y,b),I=this._unevaluatedLayout._values[u];return I.isDataDriven()||nc(I.value)||!S?S:function(D,z){return z.replace(/{([^{}]+)}/g,function(Z,G){return G in D?String(D[G]):""})}(h.properties,S)},o.prototype.createBucket=function(u){return new De(u)},o.prototype.queryRadius=function(){return 0},o.prototype.queryIntersectsFeature=function(){return!1},o.prototype._setPaintOverrides=function(){for(var u=0,h=ve.paint.overridableProperties;u<h.length;u+=1){var y=h[u];if(o.hasPaintOverride(this.layout,y)){var b,S=this.paint.get(y),I=new Ze(S),D=new Fc(I,S.property.specification);b=S.value.kind==="constant"||S.value.kind==="source"?new Rl("source",D):new ul("composite",D,S.value.zoomStops,S.value._interpolationType),this.paint._values[y]=new bs(S.property,b,S.parameters)}}},o.prototype._handleOverridablePaintPropertyUpdate=function(u,h,y){return!(!this.layout||h.isDataDriven()||y.isDataDriven())&&o.hasPaintOverride(this.layout,u)},o.hasPaintOverride=function(u,h){var y=u.get("text-field"),b=ve.paint.properties[h],S=!1,I=function(Z){for(var G=0,q=Z;G<q.length;G+=1)if(b.overrides&&b.overrides.hasOverride(q[G]))return void(S=!0)};if(y.value.kind==="constant"&&y.value.value instanceof gt)I(y.value.value.sections);else if(y.value.kind==="source"){var D=function(Z){S||(Z instanceof za&&ea(Z.value)===Hi?I(Z.value.sections):Z instanceof Ao?I(Z.sections):Z.eachChild(D))},z=y.value;z._styleExpression&&D(z._styleExpression.expression)}return S},o}(du),st={paint:new Go({"background-color":new Rn(oe.paint_background["background-color"]),"background-pattern":new $o(oe.paint_background["background-pattern"]),"background-opacity":new Rn(oe.paint_background["background-opacity"])})},St=function(t){function o(u){t.call(this,u,st)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(du),cr={paint:new Go({"raster-opacity":new Rn(oe.paint_raster["raster-opacity"]),"raster-hue-rotate":new Rn(oe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Rn(oe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Rn(oe.paint_raster["raster-brightness-max"]),"raster-saturation":new Rn(oe.paint_raster["raster-saturation"]),"raster-contrast":new Rn(oe.paint_raster["raster-contrast"]),"raster-resampling":new Rn(oe.paint_raster["raster-resampling"]),"raster-fade-duration":new Rn(oe.paint_raster["raster-fade-duration"])})},zr=function(t){function o(u){t.call(this,u,cr)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(du),Ur=function(t){function o(u){t.call(this,u,{}),this.implementation=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},o.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},o.prototype.recalculate=function(){},o.prototype.updateTransitions=function(){},o.prototype.hasTransition=function(){},o.prototype.serialize=function(){},o.prototype.onAdd=function(u){this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},o.prototype.onRemove=function(u){this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},o}(du),nn={circle:Af,heatmap:Ip,hillshade:lh,fill:ap,"fill-extrusion":el,line:ed,symbol:Ae,background:St,raster:zr},Lr=_e.HTMLImageElement,An=_e.HTMLCanvasElement,un=_e.HTMLVideoElement,En=_e.ImageData,bn=_e.ImageBitmap,ln=function(t,o,u,h){this.context=t,this.format=u,this.texture=t.gl.createTexture(),this.update(o,h)};ln.prototype.update=function(t,o,u){var h=t.width,y=t.height,b=!(this.size&&this.size[0]===h&&this.size[1]===y||u),S=this.context,I=S.gl;if(this.useMipmap=Boolean(o&&o.useMipmap),I.bindTexture(I.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===I.RGBA&&(!o||o.premultiply!==!1)),b)this.size=[h,y],t instanceof Lr||t instanceof An||t instanceof un||t instanceof En||bn&&t instanceof bn?I.texImage2D(I.TEXTURE_2D,0,this.format,this.format,I.UNSIGNED_BYTE,t):I.texImage2D(I.TEXTURE_2D,0,this.format,h,y,0,this.format,I.UNSIGNED_BYTE,t.data);else{var D=u||{x:0,y:0},z=D.x,Z=D.y;t instanceof Lr||t instanceof An||t instanceof un||t instanceof En||bn&&t instanceof bn?I.texSubImage2D(I.TEXTURE_2D,0,z,Z,I.RGBA,I.UNSIGNED_BYTE,t):I.texSubImage2D(I.TEXTURE_2D,0,z,Z,h,y,I.RGBA,I.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&I.generateMipmap(I.TEXTURE_2D)},ln.prototype.bind=function(t,o,u){var h=this.context.gl;h.bindTexture(h.TEXTURE_2D,this.texture),u!==h.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=h.LINEAR),t!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,t),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,u||t),this.filter=t),o!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,o),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,o),this.wrap=o)},ln.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},ln.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Jn=function(t){var o=this;this._callback=t,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){o._triggered=!1,o._callback()})};Jn.prototype.trigger=function(){var t=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){t._triggered=!1,t._callback()},0))},Jn.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Ea=function(t,o,u){this.target=t,this.parent=o,this.mapId=u,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},$t(["receive","process"],this),this.invoker=new Jn(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Fr()?t:_e};function ss(t,o,u){var h=2*Math.PI*6378137/256/Math.pow(2,u);return[t*h-2*Math.PI*6378137/2,o*h-2*Math.PI*6378137/2]}Ea.prototype.send=function(t,o,u,h,y){var b=this;y===void 0&&(y=!1);var S=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(this.callbacks[S]=u);var I=Se(this.globalScope)?void 0:[];return this.target.postMessage({id:S,type:t,hasCallback:!!u,targetMapId:h,mustQueue:y,sourceMapId:this.mapId,data:qs(o,I)},I),{cancel:function(){u&&delete b.callbacks[S],b.target.postMessage({id:S,type:"<cancel>",targetMapId:h,sourceMapId:b.mapId})}}},Ea.prototype.receive=function(t){var o=t.data,u=o.id;if(u&&(!o.targetMapId||this.mapId===o.targetMapId))if(o.type==="<cancel>"){delete this.tasks[u];var h=this.cancelCallbacks[u];delete this.cancelCallbacks[u],h&&h()}else Fr()||o.mustQueue?(this.tasks[u]=o,this.taskQueue.push(u),this.invoker.trigger()):this.processTask(u,o)},Ea.prototype.process=function(){if(this.taskQueue.length){var t=this.taskQueue.shift(),o=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),o&&this.processTask(t,o)}},Ea.prototype.processTask=function(t,o){var u=this;if(o.type==="<response>"){var h=this.callbacks[t];delete this.callbacks[t],h&&(o.error?h(Ts(o.error)):h(null,Ts(o.data)))}else{var y=!1,b=Se(this.globalScope)?void 0:[],S=o.hasCallback?function(Z,G){y=!0,delete u.cancelCallbacks[t],u.target.postMessage({id:t,type:"<response>",sourceMapId:u.mapId,error:Z?qs(Z):null,data:qs(G,b)},b)}:function(Z){y=!0},I=null,D=Ts(o.data);if(this.parent[o.type])I=this.parent[o.type](o.sourceMapId,D,S);else if(this.parent.getWorkerSource){var z=o.type.split(".");I=this.parent.getWorkerSource(o.sourceMapId,z[0],D.source)[z[1]](D,S)}else S(new Error("Could not find function "+o.type));!y&&I&&I.cancel&&(this.cancelCallbacks[t]=I.cancel)}},Ea.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Va=function(t,o){t&&(o?this.setSouthWest(t).setNorthEast(o):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};Va.prototype.setNorthEast=function(t){return this._ne=t instanceof ya?new ya(t.lng,t.lat):ya.convert(t),this},Va.prototype.setSouthWest=function(t){return this._sw=t instanceof ya?new ya(t.lng,t.lat):ya.convert(t),this},Va.prototype.extend=function(t){var o,u,h=this._sw,y=this._ne;if(t instanceof ya)o=t,u=t;else{if(!(t instanceof Va))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Va.convert(t)):this.extend(ya.convert(t)):this;if(u=t._ne,!(o=t._sw)||!u)return this}return h||y?(h.lng=Math.min(o.lng,h.lng),h.lat=Math.min(o.lat,h.lat),y.lng=Math.max(u.lng,y.lng),y.lat=Math.max(u.lat,y.lat)):(this._sw=new ya(o.lng,o.lat),this._ne=new ya(u.lng,u.lat)),this},Va.prototype.getCenter=function(){return new ya((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Va.prototype.getSouthWest=function(){return this._sw},Va.prototype.getNorthEast=function(){return this._ne},Va.prototype.getNorthWest=function(){return new ya(this.getWest(),this.getNorth())},Va.prototype.getSouthEast=function(){return new ya(this.getEast(),this.getSouth())},Va.prototype.getWest=function(){return this._sw.lng},Va.prototype.getSouth=function(){return this._sw.lat},Va.prototype.getEast=function(){return this._ne.lng},Va.prototype.getNorth=function(){return this._ne.lat},Va.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Va.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Va.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Va.prototype.contains=function(t){var o=ya.convert(t),u=o.lng,h=o.lat,y=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(y=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&y},Va.convert=function(t){return!t||t instanceof Va?t:new Va(t)};var ya=function(t,o){if(isNaN(t)||isNaN(o))throw new Error("Invalid LngLat object: ("+t+", "+o+")");if(this.lng=+t,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};ya.prototype.wrap=function(){return new ya(or(this.lng,-180,180),this.lat)},ya.prototype.toArray=function(){return[this.lng,this.lat]},ya.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},ya.prototype.distanceTo=function(t){var o=Math.PI/180,u=this.lat*o,h=t.lat*o,y=Math.sin(u)*Math.sin(h)+Math.cos(u)*Math.cos(h)*Math.cos((t.lng-this.lng)*o);return 63710088e-1*Math.acos(Math.min(y,1))},ya.prototype.toBounds=function(t){t===void 0&&(t=0);var o=360*t/40075017,u=o/Math.cos(Math.PI/180*this.lat);return new Va(new ya(this.lng-u,this.lat-o),new ya(this.lng+u,this.lat+o))},ya.convert=function(t){if(t instanceof ya)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new ya(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new ya(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var ql=2*Math.PI*63710088e-1;function Zs(t){return ql*Math.cos(t*Math.PI/180)}function Cl(t){return(180+t)/360}function Uu(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function rd(t,o){return t/Zs(o)}function Zu(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}var nf=function(t,o,u){u===void 0&&(u=0),this.x=+t,this.y=+o,this.z=+u};nf.fromLngLat=function(t,o){o===void 0&&(o=0);var u=ya.convert(t);return new nf(Cl(u.lng),Uu(u.lat),rd(o,u.lat))},nf.prototype.toLngLat=function(){return new ya(360*this.x-180,Zu(this.y))},nf.prototype.toAltitude=function(){return this.z*Zs(Zu(this.y))},nf.prototype.meterInMercatorCoordinateUnits=function(){return 1/ql*(t=Zu(this.y),1/Math.cos(t*Math.PI/180));var t};var Zp=function(t,o,u){this.z=t,this.x=o,this.y=u,this.key=jp(0,t,t,o,u)};Zp.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},Zp.prototype.url=function(t,o){var u,h,y,b,S,I=(h=this.y,y=this.z,b=ss(256*(u=this.x),256*(h=Math.pow(2,y)-h-1),y),S=ss(256*(u+1),256*(h+1),y),b[0]+","+b[1]+","+S[0]+","+S[1]),D=function(z,Z,G){for(var q,ne="",Te=z;Te>0;Te--)ne+=(Z&(q=1<<Te-1)?1:0)+(G&q?2:0);return ne}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",D).replace("{bbox-epsg-3857}",I)},Zp.prototype.getTilePoint=function(t){var o=Math.pow(2,this.z);return new de(8192*(t.x*o-this.x),8192*(t.y*o-this.y))},Zp.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var nd=function(t,o){this.wrap=t,this.canonical=o,this.key=jp(t,o.z,o.z,o.x,o.y)},Wo=function(t,o,u,h,y){this.overscaledZ=t,this.wrap=o,this.canonical=new Zp(u,+h,+y),this.key=jp(o,t,u,h,y)};function jp(t,o,u,h,y){(t*=2)<0&&(t=-1*t-1);var b=1<<u;return(b*b*t+b*y+h).toString(36)+u.toString(36)+o.toString(36)}Wo.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},Wo.prototype.scaledTo=function(t){var o=this.canonical.z-t;return t>this.canonical.z?new Wo(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Wo(t,this.wrap,t,this.canonical.x>>o,this.canonical.y>>o)},Wo.prototype.calculateScaledKey=function(t,o){var u=this.canonical.z-t;return t>this.canonical.z?jp(this.wrap*+o,t,this.canonical.z,this.canonical.x,this.canonical.y):jp(this.wrap*+o,t,t,this.canonical.x>>u,this.canonical.y>>u)},Wo.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var o=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>o&&t.canonical.y===this.canonical.y>>o},Wo.prototype.children=function(t){if(this.overscaledZ>=t)return[new Wo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var o=this.canonical.z+1,u=2*this.canonical.x,h=2*this.canonical.y;return[new Wo(o,this.wrap,o,u,h),new Wo(o,this.wrap,o,u+1,h),new Wo(o,this.wrap,o,u,h+1),new Wo(o,this.wrap,o,u+1,h+1)]},Wo.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},Wo.prototype.wrapped=function(){return new Wo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Wo.prototype.unwrapTo=function(t){return new Wo(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},Wo.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Wo.prototype.toUnwrapped=function(){return new nd(this.wrap,this.canonical)},Wo.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Wo.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new nf(t.x-this.wrap,t.y))},hn("CanonicalTileID",Zp),hn("OverscaledTileID",Wo,{omit:["posMatrix"]});var _c=function(t,o,u){if(this.uid=t,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return $e('"'+u+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=o.height;var h=this.dim=o.height-2;this.data=new Uint32Array(o.data.buffer),this.encoding=u||"mapbox";for(var y=0;y<h;y++)this.data[this._idx(-1,y)]=this.data[this._idx(0,y)],this.data[this._idx(h,y)]=this.data[this._idx(h-1,y)],this.data[this._idx(y,-1)]=this.data[this._idx(y,0)],this.data[this._idx(y,h)]=this.data[this._idx(y,h-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(h,-1)]=this.data[this._idx(h-1,0)],this.data[this._idx(-1,h)]=this.data[this._idx(0,h-1)],this.data[this._idx(h,h)]=this.data[this._idx(h-1,h-1)]};_c.prototype.get=function(t,o){var u=new Uint8Array(this.data.buffer),h=4*this._idx(t,o);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(u[h],u[h+1],u[h+2])},_c.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},_c.prototype._idx=function(t,o){if(t<-1||t>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(t+1)},_c.prototype._unpackMapbox=function(t,o,u){return(256*t*256+256*o+u)/10-1e4},_c.prototype._unpackTerrarium=function(t,o,u){return 256*t+o+u/256-32768},_c.prototype.getPixels=function(){return new Fo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},_c.prototype.backfillBorder=function(t,o,u){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var h=o*this.dim,y=o*this.dim+this.dim,b=u*this.dim,S=u*this.dim+this.dim;switch(o){case-1:h=y-1;break;case 1:y=h+1}switch(u){case-1:b=S-1;break;case 1:S=b+1}for(var I=-o*this.dim,D=-u*this.dim,z=b;z<S;z++)for(var Z=h;Z<y;Z++)this.data[this._idx(Z,z)]=t.data[this._idx(Z+I,z+D)]},hn("DEMData",_c);var Kl=function(t){this._stringToNumber={},this._numberToString=[];for(var o=0;o<t.length;o++){var u=t[o];this._stringToNumber[u]=o,this._numberToString[o]=u}};Kl.prototype.encode=function(t){return this._stringToNumber[t]},Kl.prototype.decode=function(t){return this._numberToString[t]};var xc=function(t,o,u,h,y){this.type="Feature",this._vectorTileFeature=t,t._z=o,t._x=u,t._y=h,this.properties=t.properties,this.id=y},id={geometry:{configurable:!0}};id.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},id.geometry.set=function(t){this._geometry=t},xc.prototype.toJSON=function(){var t={geometry:this.geometry};for(var o in this)o!=="_geometry"&&o!=="_vectorTileFeature"&&(t[o]=this[o]);return t},Object.defineProperties(xc.prototype,id);var lp=function(){this.state={},this.stateChanges={},this.deletedStates={}};lp.prototype.updateState=function(t,o,u){var h=String(o);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][h]=this.stateChanges[t][h]||{},At(this.stateChanges[t][h],u),this.deletedStates[t]===null)for(var y in this.deletedStates[t]={},this.state[t])y!==h&&(this.deletedStates[t][y]=null);else if(this.deletedStates[t]&&this.deletedStates[t][h]===null)for(var b in this.deletedStates[t][h]={},this.state[t][h])u[b]||(this.deletedStates[t][h][b]=null);else for(var S in u)this.deletedStates[t]&&this.deletedStates[t][h]&&this.deletedStates[t][h][S]===null&&delete this.deletedStates[t][h][S]},lp.prototype.removeFeatureState=function(t,o,u){if(this.deletedStates[t]!==null){var h=String(o);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&o!==void 0)this.deletedStates[t][h]!==null&&(this.deletedStates[t][h]=this.deletedStates[t][h]||{},this.deletedStates[t][h][u]=null);else if(o!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][h])for(u in this.deletedStates[t][h]={},this.stateChanges[t][h])this.deletedStates[t][h][u]=null;else this.deletedStates[t][h]=null;else this.deletedStates[t]=null}},lp.prototype.getState=function(t,o){var u=String(o),h=At({},(this.state[t]||{})[u],(this.stateChanges[t]||{})[u]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){var y=this.deletedStates[t][o];if(y===null)return{};for(var b in y)delete h[b]}return h},lp.prototype.initializeTileState=function(t,o){t.setFeatureState(this.state,o)},lp.prototype.coalesceChanges=function(t,o){var u={};for(var h in this.stateChanges){this.state[h]=this.state[h]||{};var y={};for(var b in this.stateChanges[h])this.state[h][b]||(this.state[h][b]={}),At(this.state[h][b],this.stateChanges[h][b]),y[b]=this.state[h][b];u[h]=y}for(var S in this.deletedStates){this.state[S]=this.state[S]||{};var I={};if(this.deletedStates[S]===null)for(var D in this.state[S])I[D]={},this.state[S][D]={};else for(var z in this.deletedStates[S]){if(this.deletedStates[S][z]===null)this.state[S][z]={};else for(var Z=0,G=Object.keys(this.deletedStates[S][z]);Z<G.length;Z+=1)delete this.state[S][z][G[Z]];I[z]=this.state[S][z]}u[S]=u[S]||{},At(u[S],I)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(var q in t)t[q].setFeatureState(u,o)};var bc=function(t,o){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Iu(8192,16,0),this.grid3D=new Iu(8192,16,0),this.featureIndexArray=new H,this.promoteId=o};function ad(t,o,u,h,y){return Xt(t,function(b,S){var I=o instanceof xu?o.get(S):null;return I&&I.evaluate?I.evaluate(u,h,y):I})}function Ld(t){for(var o=1/0,u=1/0,h=-1/0,y=-1/0,b=0,S=t;b<S.length;b+=1){var I=S[b];o=Math.min(o,I.x),u=Math.min(u,I.y),h=Math.max(h,I.x),y=Math.max(y,I.y)}return{minX:o,minY:u,maxX:h,maxY:y}}function yv(t,o){return o-t}bc.prototype.insert=function(t,o,u,h,y,b){var S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,h,y);for(var I=b?this.grid3D:this.grid,D=0;D<o.length;D++){for(var z=o[D],Z=[1/0,1/0,-1/0,-1/0],G=0;G<z.length;G++){var q=z[G];Z[0]=Math.min(Z[0],q.x),Z[1]=Math.min(Z[1],q.y),Z[2]=Math.max(Z[2],q.x),Z[3]=Math.max(Z[3],q.y)}Z[0]<8192&&Z[1]<8192&&Z[2]>=0&&Z[3]>=0&&I.insert(S,Z[0],Z[1],Z[2],Z[3])}},bc.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Eu.VectorTile(new rf(this.rawTileData)).layers,this.sourceLayerCoder=new Kl(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},bc.prototype.query=function(t,o,u,h){var y=this;this.loadVTLayers();for(var b=t.params||{},S=8192/t.tileSize/t.scale,I=Ll(b.filter),D=t.queryGeometry,z=t.queryPadding*S,Z=Ld(D),G=this.grid.query(Z.minX-z,Z.minY-z,Z.maxX+z,Z.maxY+z),q=Ld(t.cameraQueryGeometry),ne=this.grid3D.query(q.minX-z,q.minY-z,q.maxX+z,q.maxY+z,function(zt,Vt,ir,Tr){return function(Dr,Dn,cn,Vn,pn){for(var Pi=0,ei=Dr;Pi<ei.length;Pi+=1){var wn=ei[Pi];if(Dn<=wn.x&&cn<=wn.y&&Vn>=wn.x&&pn>=wn.y)return!0}var Zi=[new de(Dn,cn),new de(Dn,pn),new de(Vn,pn),new de(Vn,cn)];if(Dr.length>2){for(var Si=0,Ji=Zi;Si<Ji.length;Si+=1)if(tu(Dr,Ji[Si]))return!0}for(var Wn=0;Wn<Dr.length-1;Wn++)if(yl(Dr[Wn],Dr[Wn+1],Zi))return!0;return!1}(t.cameraQueryGeometry,zt-z,Vt-z,ir+z,Tr+z)}),Te=0,Ie=ne;Te<Ie.length;Te+=1)G.push(Ie[Te]);G.sort(yv);for(var k,Ue={},rt=function(zt){var Vt=G[zt];if(Vt!==k){k=Vt;var ir=y.featureIndexArray.get(Vt),Tr=null;y.loadMatchingFeature(Ue,ir.bucketIndex,ir.sourceLayerIndex,ir.featureIndex,I,b.layers,b.availableImages,o,u,h,function(Dr,Dn,cn){return Tr||(Tr=Ga(Dr)),Dn.queryIntersectsFeature(D,Dr,cn,Tr,y.z,t.transform,S,t.pixelPosMatrix)})}},_t=0;_t<G.length;_t++)rt(_t);return Ue},bc.prototype.loadMatchingFeature=function(t,o,u,h,y,b,S,I,D,z,Z){var G=this.bucketLayerIDs[o];if(!b||function(Dr,Dn){for(var cn=0;cn<Dr.length;cn++)if(Dn.indexOf(Dr[cn])>=0)return!0;return!1}(b,G)){var q=this.sourceLayerCoder.decode(u),ne=this.vtLayers[q].feature(h);if(y.needGeometry){var Te=fo(ne,!0);if(!y.filter(new Ai(this.tileID.overscaledZ),Te,this.tileID.canonical))return}else if(!y.filter(new Ai(this.tileID.overscaledZ),ne))return;for(var Ie=this.getId(ne,q),k=0;k<G.length;k++){var Ue=G[k];if(!(b&&b.indexOf(Ue)<0)){var rt=I[Ue];if(rt){var _t={};Ie!==void 0&&z&&(_t=z.getState(rt.sourceLayer||"_geojsonTileLayer",Ie));var zt=At({},D[Ue]);zt.paint=ad(zt.paint,rt.paint,ne,_t,S),zt.layout=ad(zt.layout,rt.layout,ne,_t,S);var Vt=!Z||Z(ne,rt,_t);if(Vt){var ir=new xc(ne,this.z,this.x,this.y,Ie);ir.layer=zt;var Tr=t[Ue];Tr===void 0&&(Tr=t[Ue]=[]),Tr.push({featureIndex:h,feature:ir,intersectionZ:Vt})}}}}}},bc.prototype.lookupSymbolFeatures=function(t,o,u,h,y,b,S,I){var D={};this.loadVTLayers();for(var z=Ll(y),Z=0,G=t;Z<G.length;Z+=1)this.loadMatchingFeature(D,u,h,G[Z],z,b,S,I,o);return D},bc.prototype.hasLayer=function(t){for(var o=0,u=this.bucketLayerIDs;o<u.length;o+=1)for(var h=0,y=u[o];h<y.length;h+=1)if(t===y[h])return!0;return!1},bc.prototype.getId=function(t,o){var u=t.id;return this.promoteId&&typeof(u=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[o]])=="boolean"&&(u=Number(u)),u},hn("FeatureIndex",bc,{omit:["rawTileData","sourceLayerCoder"]});var us=function(t,o){this.tileID=t,this.uid=yt(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};us.prototype.registerFadeDuration=function(t){var o=t+this.timeAdded;o<Nn.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)},us.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},us.prototype.loadVectorData=function(t,o,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var h in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(z,Z){var G={};if(!Z)return G;for(var q=function(){var Ie=Te[ne],k=Ie.layerIds.map(function(_t){return Z.getLayer(_t)}).filter(Boolean);if(k.length!==0){Ie.layers=k,Ie.stateDependentLayerIds&&(Ie.stateDependentLayers=Ie.stateDependentLayerIds.map(function(_t){return k.filter(function(zt){return zt.id===_t})[0]}));for(var Ue=0,rt=k;Ue<rt.length;Ue+=1)G[rt[Ue].id]=Ie}},ne=0,Te=z;ne<Te.length;ne+=1)q();return G}(t.buckets,o.style),this.hasSymbolBuckets=!1,this.buckets){var y=this.buckets[h];if(y instanceof De){if(this.hasSymbolBuckets=!0,!u)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var b in this.buckets){var S=this.buckets[b];if(S instanceof De&&S.hasRTLText){this.hasRTLText=!0,Ms.isLoading()||Ms.isLoaded()||Cf()!=="deferred"||pu();break}}for(var I in this.queryPadding=0,this.buckets){var D=this.buckets[I];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(I).queryRadius(D))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new f},us.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},us.prototype.getBucket=function(t){return this.buckets[t.id]},us.prototype.upload=function(t){for(var o in this.buckets){var u=this.buckets[o];u.uploadPending()&&u.upload(t)}var h=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ln(t,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ln(t,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)},us.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},us.prototype.queryRenderedFeatures=function(t,o,u,h,y,b,S,I,D,z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:h,cameraQueryGeometry:y,scale:b,tileSize:this.tileSize,pixelPosMatrix:z,transform:I,params:S,queryPadding:this.queryPadding*D},t,o,u):{}},us.prototype.querySourceFeatures=function(t,o){var u=this.latestFeatureIndex;if(u&&u.rawTileData){var h=u.loadVTLayers(),y=o?o.sourceLayer:"",b=h._geojsonTileLayer||h[y];if(b)for(var S=Ll(o&&o.filter),I=this.tileID.canonical,D=I.z,z=I.x,Z=I.y,G={z:D,x:z,y:Z},q=0;q<b.length;q++){var ne=b.feature(q);if(S.needGeometry){var Te=fo(ne,!0);if(!S.filter(new Ai(this.tileID.overscaledZ),Te,this.tileID.canonical))continue}else if(!S.filter(new Ai(this.tileID.overscaledZ),ne))continue;var Ie=u.getId(ne,y),k=new xc(ne,D,z,Z,Ie);k.tile=G,t.push(k)}}},us.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},us.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},us.prototype.setExpiryData=function(t){var o=this.expirationTime;if(t.cacheControl){var u=Yr(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var h=Date.now(),y=!1;if(this.expirationTime>h)y=!1;else if(o)if(this.expirationTime<o)y=!0;else{var b=this.expirationTime-o;b?this.expirationTime=h+Math.max(b,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},us.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},us.prototype.setFeatureState=function(t,o){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(t).length!==0){var u=this.latestFeatureIndex.loadVTLayers();for(var h in this.buckets)if(o.style.hasLayer(h)){var y=this.buckets[h],b=y.layers[0].sourceLayer||"_geojsonTileLayer",S=u[b],I=t[b];if(S&&I&&Object.keys(I).length!==0){y.update(I,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});var D=o&&o.style&&o.style.getLayer(h);D&&(this.queryPadding=Math.max(this.queryPadding,D.queryRadius(y)))}}}},us.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},us.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Nn.now()},us.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},us.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=Nn.now()+t},us.prototype.setDependencies=function(t,o){for(var u={},h=0,y=o;h<y.length;h+=1)u[y[h]]=!0;this.dependencies[t]=u},us.prototype.hasDependency=function(t,o){for(var u=0,h=t;u<h.length;u+=1){var y=this.dependencies[h[u]];if(y){for(var b=0,S=o;b<S.length;b+=1)if(y[S[b]])return!0}}return!1};var kf=_e.performance,Vp=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},kf.mark(this._marks.start)};Vp.prototype.finish=function(){kf.mark(this._marks.end);var t=kf.getEntriesByName(this._marks.measure);return t.length===0&&(kf.measure(this._marks.measure,this._marks.start,this._marks.end),t=kf.getEntriesByName(this._marks.measure),kf.clearMarks(this._marks.start),kf.clearMarks(this._marks.end),kf.clearMeasures(this._marks.measure)),t},m.Actor=Ea,m.AlphaImage=iu,m.CanonicalTileID=Zp,m.CollisionBoxArray=f,m.Color=Ui,m.DEMData=_c,m.DataConstantProperty=Rn,m.DictionaryCoder=Kl,m.EXTENT=8192,m.ErrorEvent=Ge,m.EvaluationParameters=Ai,m.Event=Me,m.Evented=Qe,m.FeatureIndex=bc,m.FillBucket=zs,m.FillExtrusionBucket=zu,m.ImageAtlas=xr,m.ImagePosition=nt,m.LineBucket=Yi,m.LngLat=ya,m.LngLatBounds=Va,m.MercatorCoordinate=nf,m.ONE_EM=24,m.OverscaledTileID=Wo,m.Point=de,m.Point$1=de,m.Properties=Go,m.Protobuf=rf,m.RGBAImage=Fo,m.RequestManager=zi,m.RequestPerformance=Vp,m.ResourceType=Sn,m.SegmentVector=se,m.SourceFeatureState=lp,m.StructArrayLayout1ui2=qf,m.StructArrayLayout2f1f2i16=Js,m.StructArrayLayout2i4=fc,m.StructArrayLayout3ui6=dl,m.StructArrayLayout4i8=Qs,m.SymbolBucket=De,m.Texture=ln,m.Tile=us,m.Transitionable=Vo,m.Uniform1f=kr,m.Uniform1i=hr,m.Uniform2f=yr,m.Uniform3f=sn,m.Uniform4f=Zn,m.UniformColor=jn,m.UniformMatrix4f=Ri,m.UnwrappedTileID=nd,m.ValidationError=Le,m.WritingMode=Nr,m.ZoomHistory=bf,m.add=function(t,o,u){return t[0]=o[0]+u[0],t[1]=o[1]+u[1],t[2]=o[2]+u[2],t},m.addDynamicAttributes=Ve,m.asyncAll=function(t,o,u){if(!t.length)return u(null,[]);var h=t.length,y=new Array(t.length),b=null;t.forEach(function(S,I){o(S,function(D,z){D&&(b=D),y[I]=z,--h==0&&u(b,y)})})},m.bezier=mt,m.bindAll=$t,m.browser=Nn,m.cacheEntryPossiblyAdded=function(t){++bi>Rr&&(t.getActor().send("enforceCacheSizeLimit",er),bi=0)},m.clamp=Bt,m.clearTileCache=function(t){var o=_e.caches.delete("mapbox-tiles");t&&o.catch(t).then(function(){return t()})},m.clipLine=So,m.clone=function(t){var o=new ua(16);return o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15],o},m.clone$1=qe,m.clone$2=function(t){var o=new ua(3);return o[0]=t[0],o[1]=t[1],o[2]=t[2],o},m.collisionCircleLayout=Sl,m.config=yn,m.create=function(){var t=new ua(16);return ua!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},m.create$1=function(){var t=new ua(9);return ua!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},m.create$2=function(){var t=new ua(4);return ua!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},m.createCommonjsModule=Re,m.createExpression=ic,m.createLayout=La,m.createStyleLayer=function(t){return t.type==="custom"?new Ur(t):new nn[t.type](t)},m.cross=function(t,o,u){var h=o[0],y=o[1],b=o[2],S=u[0],I=u[1],D=u[2];return t[0]=y*D-b*I,t[1]=b*S-h*D,t[2]=h*I-y*S,t},m.deepEqual=function t(o,u){if(Array.isArray(o)){if(!Array.isArray(u)||o.length!==u.length)return!1;for(var h=0;h<o.length;h++)if(!t(o[h],u[h]))return!1;return!0}if(typeof o=="object"&&o!==null&&u!==null){if(typeof u!="object"||Object.keys(o).length!==Object.keys(u).length)return!1;for(var y in o)if(!t(o[y],u[y]))return!1;return!0}return o===u},m.dot=function(t,o){return t[0]*o[0]+t[1]*o[1]+t[2]*o[2]},m.dot$1=function(t,o){return t[0]*o[0]+t[1]*o[1]+t[2]*o[2]+t[3]*o[3]},m.ease=Ct,m.emitValidationErrors=Uc,m.endsWith=X,m.enforceCacheSizeLimit=function(t){an(),Gi&&Gi.then(function(o){o.keys().then(function(u){for(var h=0;h<u.length-t;h++)o.delete(u[h])})})},m.evaluateSizeForFeature=Qn,m.evaluateSizeForZoom=ci,m.evaluateVariableOffset=ai,m.evented=Xf,m.extend=At,m.featureFilter=Ll,m.filterObject=at,m.fromRotation=function(t,o){var u=Math.sin(o),h=Math.cos(o);return t[0]=h,t[1]=u,t[2]=0,t[3]=-u,t[4]=h,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},m.getAnchorAlignment=Kr,m.getAnchorJustification=we,m.getArrayBuffer=Na,m.getImage=$,m.getJSON=function(t,o){return Uo(At(t,{type:"json"}),o)},m.getRTLTextPluginStatus=Cf,m.getReferrer=Oi,m.getVideo=function(t,o){var u,h,y=_e.document.createElement("video");y.muted=!0,y.onloadstart=function(){o(null,y)};for(var b=0;b<t.length;b++){var S=_e.document.createElement("source");u=t[b],h=void 0,(h=_e.document.createElement("a")).href=u,(h.protocol!==_e.document.location.protocol||h.host!==_e.document.location.host)&&(y.crossOrigin="Anonymous"),S.src=t[b],y.appendChild(S)}return{cancel:function(){}}},m.identity=Ns,m.invert=function(t,o){var u=o[0],h=o[1],y=o[2],b=o[3],S=o[4],I=o[5],D=o[6],z=o[7],Z=o[8],G=o[9],q=o[10],ne=o[11],Te=o[12],Ie=o[13],k=o[14],Ue=o[15],rt=u*I-h*S,_t=u*D-y*S,zt=u*z-b*S,Vt=h*D-y*I,ir=h*z-b*I,Tr=y*z-b*D,Dr=Z*Ie-G*Te,Dn=Z*k-q*Te,cn=Z*Ue-ne*Te,Vn=G*k-q*Ie,pn=G*Ue-ne*Ie,Pi=q*Ue-ne*k,ei=rt*Pi-_t*pn+zt*Vn+Vt*cn-ir*Dn+Tr*Dr;return ei?(t[0]=(I*Pi-D*pn+z*Vn)*(ei=1/ei),t[1]=(y*pn-h*Pi-b*Vn)*ei,t[2]=(Ie*Tr-k*ir+Ue*Vt)*ei,t[3]=(q*ir-G*Tr-ne*Vt)*ei,t[4]=(D*cn-S*Pi-z*Dn)*ei,t[5]=(u*Pi-y*cn+b*Dn)*ei,t[6]=(k*zt-Te*Tr-Ue*_t)*ei,t[7]=(Z*Tr-q*zt+ne*_t)*ei,t[8]=(S*pn-I*cn+z*Dr)*ei,t[9]=(h*cn-u*pn-b*Dr)*ei,t[10]=(Te*ir-Ie*zt+Ue*rt)*ei,t[11]=(G*zt-Z*ir-ne*rt)*ei,t[12]=(I*Dn-S*Vn-D*Dr)*ei,t[13]=(u*Vn-h*Dn+y*Dr)*ei,t[14]=(Ie*_t-Te*Vt-k*rt)*ei,t[15]=(Z*Vt-G*_t+q*rt)*ei,t):null},m.isChar=Zr,m.isMapboxURL=Ii,m.keysDifference=function(t,o){var u=[];for(var h in t)h in o||u.push(h);return u},m.makeRequest=Uo,m.mapObject=Xt,m.mercatorXfromLng=Cl,m.mercatorYfromLat=Uu,m.mercatorZfromAltitude=rd,m.mul=Hc,m.multiply=Qo,m.mvt=Eu,m.nextPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},m.normalize=function(t,o){var u=o[0],h=o[1],y=o[2],b=u*u+h*h+y*y;return b>0&&(b=1/Math.sqrt(b)),t[0]=o[0]*b,t[1]=o[1]*b,t[2]=o[2]*b,t},m.number=ma,m.offscreenCanvasSupported=di,m.ortho=function(t,o,u,h,y,b,S){var I=1/(o-u),D=1/(h-y),z=1/(b-S);return t[0]=-2*I,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*D,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*z,t[11]=0,t[12]=(o+u)*I,t[13]=(y+h)*D,t[14]=(S+b)*z,t[15]=1,t},m.parseGlyphPBF=function(t){return new rf(t).readFields(wr,[])},m.pbf=rf,m.performSymbolLayout=function(t,o,u,h,y,b,S){t.createArrays(),t.tilePixelRatio=8192/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;var I=t.layers[0].layout,D=t.layers[0]._unevaluatedLayout._values,z={};if(t.textSizeData.kind==="composite"){var Z=t.textSizeData,G=Z.maxZoom;z.compositeTextSizes=[D["text-size"].possiblyEvaluate(new Ai(Z.minZoom),S),D["text-size"].possiblyEvaluate(new Ai(G),S)]}if(t.iconSizeData.kind==="composite"){var q=t.iconSizeData,ne=q.maxZoom;z.compositeIconSizes=[D["icon-size"].possiblyEvaluate(new Ai(q.minZoom),S),D["icon-size"].possiblyEvaluate(new Ai(ne),S)]}z.layoutTextSize=D["text-size"].possiblyEvaluate(new Ai(t.zoom+1),S),z.layoutIconSize=D["icon-size"].possiblyEvaluate(new Ai(t.zoom+1),S),z.textMaxSize=D["text-size"].possiblyEvaluate(new Ai(18));for(var Te=24*I.get("text-line-height"),Ie=I.get("text-rotation-alignment")==="map"&&I.get("symbol-placement")!=="point",k=I.get("text-keep-upright"),Ue=I.get("text-size"),rt=function(){var Vt=zt[_t],ir=I.get("text-font").evaluate(Vt,{},S).join(","),Tr=Ue.evaluate(Vt,{},S),Dr=z.layoutTextSize.evaluate(Vt,{},S),Dn=z.layoutIconSize.evaluate(Vt,{},S),cn={horizontal:{},vertical:void 0},Vn=Vt.text,pn=[0,0];if(Vn){var Pi=Vn.toString(),ei=24*I.get("text-letter-spacing").evaluate(Vt,{},S),wn=function(Ci){for(var Fa=0,Aa=Ci;Fa<Aa.length;Fa+=1)if(la=Aa[Fa].charCodeAt(0),Zr.Arabic(la)||Zr["Arabic Supplement"](la)||Zr["Arabic Extended-A"](la)||Zr["Arabic Presentation Forms-A"](la)||Zr["Arabic Presentation Forms-B"](la))return!1;var la;return!0}(Pi)?ei:0,Zi=I.get("text-anchor").evaluate(Vt,{},S),Si=I.get("text-variable-anchor");if(!Si){var Ji=I.get("text-radial-offset").evaluate(Vt,{},S);pn=Ji?ai(Zi,[24*Ji,Bn]):I.get("text-offset").evaluate(Vt,{},S).map(function(Ci){return 24*Ci})}var Wn=Ie?"center":I.get("text-justify").evaluate(Vt,{},S),fa=I.get("symbol-placement"),Ja=fa==="point"?24*I.get("text-max-width").evaluate(Vt,{},S):0,yo=function(){t.allowVerticalPlacement&&cc(Pi)&&(cn.vertical=$r(Vn,o,u,y,ir,Ja,Te,Zi,"left",wn,pn,Nr.vertical,!0,fa,Dr,Tr))};if(!Ie&&Si){for(var Ha=Wn==="auto"?Si.map(function(Ci){return we(Ci)}):[Wn],eo=!1,_o=0;_o<Ha.length;_o++){var Xo=Ha[_o];if(!cn.horizontal[Xo])if(eo)cn.horizontal[Xo]=cn.horizontal[0];else{var es=$r(Vn,o,u,y,ir,Ja,Te,"center",Xo,wn,pn,Nr.horizontal,!1,fa,Dr,Tr);es&&(cn.horizontal[Xo]=es,eo=es.positionedLines.length===1)}}yo()}else{Wn==="auto"&&(Wn=we(Zi));var js=$r(Vn,o,u,y,ir,Ja,Te,Zi,Wn,wn,pn,Nr.horizontal,!1,fa,Dr,Tr);js&&(cn.horizontal[Wn]=js),yo(),cc(Pi)&&Ie&&k&&(cn.vertical=$r(Vn,o,u,y,ir,Ja,Te,Zi,Wn,wn,pn,Nr.vertical,!1,fa,Dr,Tr))}}var ts=void 0,Vs=!1;if(Vt.icon&&Vt.icon.name){var to=h[Vt.icon.name];to&&(ts=function(Ci,Fa,Aa){var la=Kr(Aa),cs=Fa[0]-Ci.displaySize[0]*la.horizontalAlign,Ss=Fa[1]-Ci.displaySize[1]*la.verticalAlign;return{image:Ci,top:Ss,bottom:Ss+Ci.displaySize[1],left:cs,right:cs+Ci.displaySize[0]}}(y[Vt.icon.name],I.get("icon-offset").evaluate(Vt,{},S),I.get("icon-anchor").evaluate(Vt,{},S)),Vs=to.sdf,t.sdfIcons===void 0?t.sdfIcons=to.sdf:t.sdfIcons!==to.sdf&&$e("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(to.pixelRatio!==t.pixelRatio||I.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}var ls=bt(cn.horizontal)||cn.vertical;t.iconsInText=!!ls&&ls.iconsInText,(ls||ts)&&function(Ci,Fa,Aa,la,cs,Ss,Wa,Ro,fs,pa,$l){var au=Ss.textMaxSize.evaluate(Fa,{});au===void 0&&(au=Wa);var af,ko=Ci.layers[0].layout,Ec=ko.get("icon-offset").evaluate(Fa,{},$l),tl=bt(Aa.horizontal),Gp=Wa/24,Lf=Ci.tilePixelRatio*Gp,cp=Ci.tilePixelRatio*au/24,Sc=Ci.tilePixelRatio*Ro,fp=Ci.tilePixelRatio*ko.get("symbol-spacing"),gh=ko.get("text-padding")*Ci.tilePixelRatio,pp=ko.get("icon-padding")*Ci.tilePixelRatio,Hp=ko.get("text-max-angle")/180*Math.PI,yh=ko.get("text-rotation-alignment")==="map"&&ko.get("symbol-placement")!=="point",_h=ko.get("icon-rotation-alignment")==="map"&&ko.get("symbol-placement")!=="point",Cc=ko.get("symbol-placement"),Wp=fp/2,hp=ko.get("icon-text-fit");la&&hp!=="none"&&(Ci.allowVerticalPlacement&&Aa.vertical&&(af=ii(la,Aa.vertical,hp,ko.get("icon-text-fit-padding"),Ec,Gp)),tl&&(la=ii(la,tl,hp,ko.get("icon-text-fit-padding"),Ec,Gp)));var of=function(_v,Ah){Ah.x<0||Ah.x>=8192||Ah.y<0||Ah.y>=8192||function(Co,Ql,xv,sf,ud,Bd,wh,ju,Th,Mh,ld,cd,Nd,_0,Ph,x0,b0,E0,S0,C0,Vu,fd,A0,Ac,bv){var w0,yp,Al,rl,_p,xp=Co.addToLineVertexArray(Ql,xv),Ih=0,zd=0,Ud=0,T0=0,Zd=-1,jd=-1,wc={},Vd=xe(""),pd=0,Oh=0;if(ju._unevaluatedLayout.getValue("text-radial-offset")===void 0?(pd=(w0=ju.layout.get("text-offset").evaluate(Vu,{},Ac).map(function(uf){return 24*uf}))[0],Oh=w0[1]):(pd=24*ju.layout.get("text-radial-offset").evaluate(Vu,{},Ac),Oh=Bn),Co.allowVerticalPlacement&&sf.vertical){var Gd=ju.layout.get("text-rotate").evaluate(Vu,{},Ac)+90;rl=new Oo(Th,Ql,Mh,ld,cd,sf.vertical,Nd,_0,Ph,Gd),wh&&(_p=new Oo(Th,Ql,Mh,ld,cd,wh,b0,E0,Ph,Gd))}if(ud){var Hd=ju.layout.get("icon-rotate").evaluate(Vu,{}),M0=ju.layout.get("icon-text-fit")!=="none",Wd=Ho(ud,Hd,A0,M0),Xd=wh?Ho(wh,Hd,A0,M0):void 0;Al=new Oo(Th,Ql,Mh,ld,cd,ud,b0,E0,!1,Hd),Ih=4*Wd.length;var Yd=Co.iconSizeData,Jp=null;Yd.kind==="source"?(Jp=[128*ju.layout.get("icon-size").evaluate(Vu,{})])[0]>32640&&$e(Co.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):Yd.kind==="composite"&&((Jp=[128*fd.compositeIconSizes[0].evaluate(Vu,{},Ac),128*fd.compositeIconSizes[1].evaluate(Vu,{},Ac)])[0]>32640||Jp[1]>32640)&&$e(Co.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Co.addSymbols(Co.icon,Wd,Jp,C0,S0,Vu,!1,Ql,xp.lineStartIndex,xp.lineLength,-1,Ac),Zd=Co.icon.placedSymbolArray.length-1,Xd&&(zd=4*Xd.length,Co.addSymbols(Co.icon,Xd,Jp,C0,S0,Vu,Nr.vertical,Ql,xp.lineStartIndex,xp.lineLength,-1,Ac),jd=Co.icon.placedSymbolArray.length-1)}for(var qd in sf.horizontal){var Rh=sf.horizontal[qd];if(!yp){Vd=xe(Rh.text);var Ev=ju.layout.get("text-rotate").evaluate(Vu,{},Ac);yp=new Oo(Th,Ql,Mh,ld,cd,Rh,Nd,_0,Ph,Ev)}var P0=Rh.positionedLines.length===1;if(Ud+=Nt(Co,Ql,Rh,Bd,ju,Ph,Vu,x0,xp,sf.vertical?Nr.horizontal:Nr.horizontalOnly,P0?Object.keys(sf.horizontal):[qd],wc,Zd,fd,Ac),P0)break}sf.vertical&&(T0+=Nt(Co,Ql,sf.vertical,Bd,ju,Ph,Vu,x0,xp,Nr.vertical,["vertical"],wc,jd,fd,Ac));var Sv=yp?yp.boxStartIndex:Co.collisionBoxArray.length,Cv=yp?yp.boxEndIndex:Co.collisionBoxArray.length,Av=rl?rl.boxStartIndex:Co.collisionBoxArray.length,wv=rl?rl.boxEndIndex:Co.collisionBoxArray.length,Tv=Al?Al.boxStartIndex:Co.collisionBoxArray.length,I0=Al?Al.boxEndIndex:Co.collisionBoxArray.length,O0=_p?_p.boxStartIndex:Co.collisionBoxArray.length,R0=_p?_p.boxEndIndex:Co.collisionBoxArray.length,wl=-1,kh=function(uf,k0){return uf&&uf.circleDiameter?Math.max(uf.circleDiameter,k0):k0};wl=kh(yp,wl),wl=kh(rl,wl),wl=kh(Al,wl);var Kd=(wl=kh(_p,wl))>-1?1:0;Kd&&(wl*=bv/24),Co.glyphOffsetArray.length>=De.MAX_GLYPHS&&$e("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Vu.sortKey!==void 0&&Co.addToSortKeyRanges(Co.symbolInstances.length,Vu.sortKey),Co.symbolInstances.emplaceBack(Ql.x,Ql.y,wc.right>=0?wc.right:-1,wc.center>=0?wc.center:-1,wc.left>=0?wc.left:-1,wc.vertical||-1,Zd,jd,Vd,Sv,Cv,Av,wv,Tv,I0,O0,R0,Mh,Ud,T0,Ih,zd,Kd,0,Nd,pd,Oh,wl)}(Ci,Ah,_v,Aa,la,cs,af,Ci.layers[0],Ci.collisionBoxArray,Fa.index,Fa.sourceLayerIndex,Ci.index,Lf,gh,yh,fs,Sc,pp,_h,Ec,Fa,Ss,pa,$l,Wa)};if(Cc==="line")for(var dp=0,xh=So(Fa.geometry,0,0,8192,8192);dp<xh.length;dp+=1)for(var bh=xh[dp],Xp=0,ps=Bo(bh,fp,Hp,Aa.vertical||tl,la,24,cp,Ci.overscaling,8192);Xp<ps.length;Xp+=1){var Eh=ps[Xp];tl&&dn(Ci,tl.text,Wp,Eh)||of(bh,Eh)}else if(Cc==="line-center")for(var Yp=0,qp=Fa.geometry;Yp<qp.length;Yp+=1){var Kp=qp[Yp];if(Kp.length>1){var Sh=ja(Kp,Hp,Aa.vertical||tl,la,24,cp);Sh&&of(Kp,Sh)}}else if(Fa.type==="Polygon")for(var vp=0,Ch=Mf(Fa.geometry,0);vp<Ch.length;vp+=1){var mp=Ch[vp],$p=ti(mp,16);of(mp[0],new Hr($p.x,$p.y,0))}else if(Fa.type==="LineString")for(var Df=0,Qp=Fa.geometry;Df<Qp.length;Df+=1){var gp=Qp[Df];of(gp,new Hr(gp[0].x,gp[0].y,0))}else if(Fa.type==="Point")for(var od=0,Dd=Fa.geometry;od<Dd.length;od+=1)for(var sd=0,y0=Dd[od];sd<y0.length;sd+=1){var Fd=y0[sd];of([Fd],new Hr(Fd.x,Fd.y,0))}}(t,Vt,cn,ts,h,z,Dr,Dn,pn,Vs,S)},_t=0,zt=t.features;_t<zt.length;_t+=1)rt();b&&t.generateCollisionDebugBuffers()},m.perspective=function(t,o,u,h,y){var b,S=1/Math.tan(o/2);return t[0]=S/u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=S,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,y!=null&&y!==1/0?(t[10]=(y+h)*(b=1/(h-y)),t[14]=2*y*h*b):(t[10]=-1,t[14]=-2*h),t},m.pick=function(t,o){for(var u={},h=0;h<o.length;h++){var y=o[h];y in t&&(u[y]=t[y])}return u},m.plugin=Ms,m.polygonIntersectsPolygon=Du,m.postMapLoadEvent=Ut,m.postTurnstileEvent=bo,m.potpack=Cr,m.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],m.register=hn,m.registerForPluginStateChange=function(t){return t({pluginStatus:Fs,pluginURL:Ru}),Xf.on("pluginStateChange",t),t},m.renderColorRamp=Kf,m.rotate=function(t,o,u){var h=o[0],y=o[1],b=o[2],S=o[3],I=Math.sin(u),D=Math.cos(u);return t[0]=h*D+b*I,t[1]=y*D+S*I,t[2]=h*-I+b*D,t[3]=y*-I+S*D,t},m.rotateX=function(t,o,u){var h=Math.sin(u),y=Math.cos(u),b=o[4],S=o[5],I=o[6],D=o[7],z=o[8],Z=o[9],G=o[10],q=o[11];return o!==t&&(t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=o[3],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15]),t[4]=b*y+z*h,t[5]=S*y+Z*h,t[6]=I*y+G*h,t[7]=D*y+q*h,t[8]=z*y-b*h,t[9]=Z*y-S*h,t[10]=G*y-I*h,t[11]=q*y-D*h,t},m.rotateZ=function(t,o,u){var h=Math.sin(u),y=Math.cos(u),b=o[0],S=o[1],I=o[2],D=o[3],z=o[4],Z=o[5],G=o[6],q=o[7];return o!==t&&(t[8]=o[8],t[9]=o[9],t[10]=o[10],t[11]=o[11],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15]),t[0]=b*y+z*h,t[1]=S*y+Z*h,t[2]=I*y+G*h,t[3]=D*y+q*h,t[4]=z*y-b*h,t[5]=Z*y-S*h,t[6]=G*y-I*h,t[7]=q*y-D*h,t},m.scale=function(t,o,u){var h=u[0],y=u[1],b=u[2];return t[0]=o[0]*h,t[1]=o[1]*h,t[2]=o[2]*h,t[3]=o[3]*h,t[4]=o[4]*y,t[5]=o[5]*y,t[6]=o[6]*y,t[7]=o[7]*y,t[8]=o[8]*b,t[9]=o[9]*b,t[10]=o[10]*b,t[11]=o[11]*b,t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15],t},m.scale$1=function(t,o,u){return t[0]=o[0]*u,t[1]=o[1]*u,t[2]=o[2]*u,t[3]=o[3]*u,t},m.scale$2=function(t,o,u){return t[0]=o[0]*u,t[1]=o[1]*u,t[2]=o[2]*u,t},m.setCacheLimits=function(t,o){er=t,Rr=o},m.setRTLTextPlugin=function(t,o,u){if(u===void 0&&(u=!1),Fs==="deferred"||Fs==="loading"||Fs==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");Ru=Nn.resolveURL(t),Fs="deferred",Ou=o,cl(),u||pu()},m.sphericalToCartesian=function(t){var o=t[0],u=t[1],h=t[2];return u+=90,u*=Math.PI/180,h*=Math.PI/180,{x:o*Math.cos(u)*Math.sin(h),y:o*Math.sin(u)*Math.sin(h),z:o*Math.cos(h)}},m.sqrLen=function(t){var o=t[0],u=t[1];return o*o+u*u},m.styleSpec=oe,m.sub=function(t,o,u){return t[0]=o[0]-u[0],t[1]=o[1]-u[1],t[2]=o[2]-u[2],t},m.symbolSize=Bi,m.transformMat3=function(t,o,u){var h=o[0],y=o[1],b=o[2];return t[0]=h*u[0]+y*u[3]+b*u[6],t[1]=h*u[1]+y*u[4]+b*u[7],t[2]=h*u[2]+y*u[5]+b*u[8],t},m.transformMat4=Wc,m.translate=function(t,o,u){var h,y,b,S,I,D,z,Z,G,q,ne,Te,Ie=u[0],k=u[1],Ue=u[2];return o===t?(t[12]=o[0]*Ie+o[4]*k+o[8]*Ue+o[12],t[13]=o[1]*Ie+o[5]*k+o[9]*Ue+o[13],t[14]=o[2]*Ie+o[6]*k+o[10]*Ue+o[14],t[15]=o[3]*Ie+o[7]*k+o[11]*Ue+o[15]):(y=o[1],b=o[2],S=o[3],I=o[4],D=o[5],z=o[6],Z=o[7],G=o[8],q=o[9],ne=o[10],Te=o[11],t[0]=h=o[0],t[1]=y,t[2]=b,t[3]=S,t[4]=I,t[5]=D,t[6]=z,t[7]=Z,t[8]=G,t[9]=q,t[10]=ne,t[11]=Te,t[12]=h*Ie+I*k+G*Ue+o[12],t[13]=y*Ie+D*k+q*Ue+o[13],t[14]=b*Ie+z*k+ne*Ue+o[14],t[15]=S*Ie+Z*k+Te*Ue+o[15]),t},m.triggerPluginCompletionEvent=Wf,m.uniqueId=yt,m.validateCustomStyleLayer=function(t){var o=[],u=t.id;return u===void 0&&o.push({message:"layers."+u+': missing required property "id"'}),t.render===void 0&&o.push({message:"layers."+u+': missing required method "render"'}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&o.push({message:"layers."+u+': property "renderingMode" must be either "2d" or "3d"'}),o},m.validateLight=uc,m.validateStyle=Za,m.values=function(t){var o=[];for(var u in t)o.push(t[u]);return o},m.vectorTile=Eu,m.version="1.13.2",m.warnOnce=$e,m.webpSupported=zn,m.window=_e,m.wrap=or}),me(["./shared"],function(m){"use strict";function Re(V){var $=typeof V;if($==="number"||$==="boolean"||$==="string"||V==null)return JSON.stringify(V);if(Array.isArray(V)){for(var te="[",he=0,Me=V;he<Me.length;he+=1)te+=Re(Me[he])+",";return te+"]"}for(var Ge=Object.keys(V).sort(),Qe="{",oe=0;oe<Ge.length;oe++)Qe+=JSON.stringify(Ge[oe])+":"+Re(V[Ge[oe]])+",";return Qe+"}"}function W(V){for(var $="",te=0,he=m.refProperties;te<he.length;te+=1)$+="/"+Re(V[he[te]]);return $}var pe=function(V){this.keyCache={},V&&this.replace(V)};pe.prototype.replace=function(V){this._layerConfigs={},this._layers={},this.update(V,[])},pe.prototype.update=function(V,$){for(var te=this,he=0,Me=V;he<Me.length;he+=1){var Ge=Me[he];this._layerConfigs[Ge.id]=Ge;var Qe=this._layers[Ge.id]=m.createStyleLayer(Ge);Qe._featureFilter=m.featureFilter(Qe.filter),this.keyCache[Ge.id]&&delete this.keyCache[Ge.id]}for(var oe=0,Le=$;oe<Le.length;oe+=1){var ht=Le[oe];delete this.keyCache[ht],delete this._layerConfigs[ht],delete this._layers[ht]}this.familiesBySource={};for(var fr=0,kt=function(Br,Wr){for(var vi={},en=0;en<Br.length;en++){var gn=Wr&&Wr[Br[en].id]||W(Br[en]);Wr&&(Wr[Br[en].id]=gn);var Hi=vi[gn];Hi||(Hi=vi[gn]=[]),Hi.push(Br[en])}var pi=[];for(var wi in vi)pi.push(vi[wi]);return pi}(m.values(this._layerConfigs),this.keyCache);fr<kt.length;fr+=1){var Ft=kt[fr].map(function(Br){return te._layers[Br.id]}),pr=Ft[0];if(pr.visibility!=="none"){var _n=pr.source||"",fn=this.familiesBySource[_n];fn||(fn=this.familiesBySource[_n]={});var Tt=pr.sourceLayer||"_geojsonTileLayer",Jr=fn[Tt];Jr||(Jr=fn[Tt]=[]),Jr.push(Ft)}}};var de=function(V){var $={},te=[];for(var he in V){var Me=V[he],Ge=$[he]={};for(var Qe in Me){var oe=Me[+Qe];if(oe&&oe.bitmap.width!==0&&oe.bitmap.height!==0){var Le={x:0,y:0,w:oe.bitmap.width+2,h:oe.bitmap.height+2};te.push(Le),Ge[Qe]={rect:Le,metrics:oe.metrics}}}}var ht=m.potpack(te),fr=new m.AlphaImage({width:ht.w||1,height:ht.h||1});for(var kt in V){var Ft=V[kt];for(var pr in Ft){var _n=Ft[+pr];if(_n&&_n.bitmap.width!==0&&_n.bitmap.height!==0){var fn=$[kt][pr].rect;m.AlphaImage.copy(_n.bitmap,fr,{x:0,y:0},{x:fn.x+1,y:fn.y+1},_n.bitmap)}}}this.image=fr,this.positions=$};m.register("GlyphAtlas",de);var ze=function(V){this.tileID=new m.OverscaledTileID(V.tileID.overscaledZ,V.tileID.wrap,V.tileID.canonical.z,V.tileID.canonical.x,V.tileID.canonical.y),this.uid=V.uid,this.zoom=V.zoom,this.pixelRatio=V.pixelRatio,this.tileSize=V.tileSize,this.source=V.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=V.showCollisionBoxes,this.collectResourceTiming=!!V.collectResourceTiming,this.returnDependencies=!!V.returnDependencies,this.promoteId=V.promoteId};function _e(V,$,te){for(var he=new m.EvaluationParameters($),Me=0,Ge=V;Me<Ge.length;Me+=1)Ge[Me].recalculate(he,te)}function et(V,$){var te=m.getArrayBuffer(V.request,function(he,Me,Ge,Qe){he?$(he):Me&&$(null,{vectorTile:new m.vectorTile.VectorTile(new m.pbf(Me)),rawData:Me,cacheControl:Ge,expires:Qe})});return function(){te.cancel(),$()}}ze.prototype.parse=function(V,$,te,he,Me){var Ge=this;this.status="parsing",this.data=V,this.collisionBoxArray=new m.CollisionBoxArray;var Qe=new m.DictionaryCoder(Object.keys(V.layers).sort()),oe=new m.FeatureIndex(this.tileID,this.promoteId);oe.bucketLayerIDs=[];var Le,ht,fr,kt,Ft={},pr={featureIndex:oe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:te},_n=$.familiesBySource[this.source];for(var fn in _n){var Tt=V.layers[fn];if(Tt){Tt.version===1&&m.warnOnce('Vector tile source "'+this.source+'" layer "'+fn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var Jr=Qe.encode(fn),Br=[],Wr=0;Wr<Tt.length;Wr++){var vi=Tt.feature(Wr),en=oe.getId(vi,fn);Br.push({feature:vi,id:en,index:Wr,sourceLayerIndex:Jr})}for(var gn=0,Hi=_n[fn];gn<Hi.length;gn+=1){var pi=Hi[gn],wi=pi[0];wi.minzoom&&this.zoom<Math.floor(wi.minzoom)||wi.maxzoom&&this.zoom>=wi.maxzoom||wi.visibility!=="none"&&(_e(pi,this.zoom,te),(Ft[wi.id]=wi.createBucket({index:oe.bucketLayerIDs.length,layers:pi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Jr,sourceID:this.source})).populate(Br,pr,this.tileID.canonical),oe.bucketLayerIDs.push(pi.map(function(Ei){return Ei.id})))}}}var yi=m.mapObject(pr.glyphDependencies,function(Ei){return Object.keys(Ei).map(Number)});Object.keys(yi).length?he.send("getGlyphs",{uid:this.uid,stacks:yi},function(Ei,Ti){Le||(Le=Ei,ht=Ti,wa.call(Ge))}):ht={};var dt=Object.keys(pr.iconDependencies);dt.length?he.send("getImages",{icons:dt,source:this.source,tileID:this.tileID,type:"icons"},function(Ei,Ti){Le||(Le=Ei,fr=Ti,wa.call(Ge))}):fr={};var Mt=Object.keys(pr.patternDependencies);function wa(){if(Le)return Me(Le);if(ht&&fr&&kt){var Ei=new de(ht),Ti=new m.ImageAtlas(fr,kt);for(var Ui in Ft){var Pr=Ft[Ui];Pr instanceof m.SymbolBucket?(_e(Pr.layers,this.zoom,te),m.performSymbolLayout(Pr,ht,Ei.positions,fr,Ti.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Pr.hasPattern&&(Pr instanceof m.LineBucket||Pr instanceof m.FillBucket||Pr instanceof m.FillExtrusionBucket)&&(_e(Pr.layers,this.zoom,te),Pr.addFeatures(pr,this.tileID.canonical,Ti.patternPositions))}this.status="done",Me(null,{buckets:m.values(Ft).filter(function(on){return!on.isEmpty()}),featureIndex:oe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ei.image,imageAtlas:Ti,glyphMap:this.returnDependencies?ht:null,iconMap:this.returnDependencies?fr:null,glyphPositions:this.returnDependencies?Ei.positions:null})}}Mt.length?he.send("getImages",{icons:Mt,source:this.source,tileID:this.tileID,type:"patterns"},function(Ei,Ti){Le||(Le=Ei,kt=Ti,wa.call(Ge))}):kt={},wa.call(this)};var mt=function(V,$,te,he){this.actor=V,this.layerIndex=$,this.availableImages=te,this.loadVectorData=he||et,this.loading={},this.loaded={}};mt.prototype.loadTile=function(V,$){var te=this,he=V.uid;this.loading||(this.loading={});var Me=!!(V&&V.request&&V.request.collectResourceTiming)&&new m.RequestPerformance(V.request),Ge=this.loading[he]=new ze(V);Ge.abort=this.loadVectorData(V,function(Qe,oe){if(delete te.loading[he],Qe||!oe)return Ge.status="done",te.loaded[he]=Ge,$(Qe);var Le=oe.rawData,ht={};oe.expires&&(ht.expires=oe.expires),oe.cacheControl&&(ht.cacheControl=oe.cacheControl);var fr={};if(Me){var kt=Me.finish();kt&&(fr.resourceTiming=JSON.parse(JSON.stringify(kt)))}Ge.vectorTile=oe.vectorTile,Ge.parse(oe.vectorTile,te.layerIndex,te.availableImages,te.actor,function(Ft,pr){if(Ft||!pr)return $(Ft);$(null,m.extend({rawTileData:Le.slice(0)},pr,ht,fr))}),te.loaded=te.loaded||{},te.loaded[he]=Ge})},mt.prototype.reloadTile=function(V,$){var te=this,he=this.loaded,Me=V.uid,Ge=this;if(he&&he[Me]){var Qe=he[Me];Qe.showCollisionBoxes=V.showCollisionBoxes;var oe=function(Le,ht){var fr=Qe.reloadCallback;fr&&(delete Qe.reloadCallback,Qe.parse(Qe.vectorTile,Ge.layerIndex,te.availableImages,Ge.actor,fr)),$(Le,ht)};Qe.status==="parsing"?Qe.reloadCallback=oe:Qe.status==="done"&&(Qe.vectorTile?Qe.parse(Qe.vectorTile,this.layerIndex,this.availableImages,this.actor,oe):oe())}},mt.prototype.abortTile=function(V,$){var te=this.loading,he=V.uid;te&&te[he]&&te[he].abort&&(te[he].abort(),delete te[he]),$()},mt.prototype.removeTile=function(V,$){var te=this.loaded,he=V.uid;te&&te[he]&&delete te[he],$()};var Ct=m.window.ImageBitmap,Bt=function(){this.loaded={}};function or(V,$){if(V.length!==0){At(V[0],$);for(var te=1;te<V.length;te++)At(V[te],!$)}}function At(V,$){for(var te=0,he=0,Me=V.length,Ge=Me-1;he<Me;Ge=he++)te+=(V[he][0]-V[Ge][0])*(V[Ge][1]+V[he][1]);te>=0!=!!$&&V.reverse()}Bt.prototype.loadTile=function(V,$){var te=V.uid,he=V.encoding,Me=V.rawImageData,Ge=Ct&&Me instanceof Ct?this.getImageData(Me):Me,Qe=new m.DEMData(te,Ge,he);this.loaded=this.loaded||{},this.loaded[te]=Qe,$(null,Qe)},Bt.prototype.getImageData=function(V){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(V.width,V.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=V.width,this.offscreenCanvas.height=V.height,this.offscreenCanvasContext.drawImage(V,0,0,V.width,V.height);var $=this.offscreenCanvasContext.getImageData(-1,-1,V.width+2,V.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new m.RGBAImage({width:$.width,height:$.height},$.data)},Bt.prototype.removeTile=function(V){var $=this.loaded,te=V.uid;$&&$[te]&&delete $[te]};var Kt=m.vectorTile.VectorTileFeature.prototype.toGeoJSON,yt=function(V){this._feature=V,this.extent=m.EXTENT,this.type=V.type,this.properties=V.tags,"id"in V&&!isNaN(V.id)&&(this.id=parseInt(V.id,10))};yt.prototype.loadGeometry=function(){if(this._feature.type===1){for(var V=[],$=0,te=this._feature.geometry;$<te.length;$+=1){var he=te[$];V.push([new m.Point$1(he[0],he[1])])}return V}for(var Me=[],Ge=0,Qe=this._feature.geometry;Ge<Qe.length;Ge+=1){for(var oe=[],Le=0,ht=Qe[Ge];Le<ht.length;Le+=1){var fr=ht[Le];oe.push(new m.Point$1(fr[0],fr[1]))}Me.push(oe)}return Me},yt.prototype.toGeoJSON=function(V,$,te){return Kt.call(this,V,$,te)};var ct=function(V){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=m.EXTENT,this.length=V.length,this._features=V};ct.prototype.feature=function(V){return new yt(this._features[V])};var it=m.vectorTile.VectorTileFeature,$t=X;function X(V,$){this.options=$||{},this.features=V,this.length=V.length}function Xt(V,$){this.id=typeof V.id=="number"?V.id:void 0,this.type=V.type,this.rawGeometry=V.type===1?[V.geometry]:V.geometry,this.properties=V.tags,this.extent=$||4096}X.prototype.feature=function(V){return new Xt(this.features[V],this.options.extent)},Xt.prototype.loadGeometry=function(){var V=this.rawGeometry;this.geometry=[];for(var $=0;$<V.length;$++){for(var te=V[$],he=[],Me=0;Me<te.length;Me++)he.push(new m.Point$1(te[Me][0],te[Me][1]));this.geometry.push(he)}return this.geometry},Xt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var V=this.geometry,$=1/0,te=-1/0,he=1/0,Me=-1/0,Ge=0;Ge<V.length;Ge++)for(var Qe=V[Ge],oe=0;oe<Qe.length;oe++){var Le=Qe[oe];$=Math.min($,Le.x),te=Math.max(te,Le.x),he=Math.min(he,Le.y),Me=Math.max(Me,Le.y)}return[$,he,te,Me]},Xt.prototype.toGeoJSON=it.prototype.toGeoJSON;var at=xt,qe=$t;function xt(V){var $=new m.pbf;return function(te,he){for(var Me in te.layers)he.writeMessage(3,$e,te.layers[Me])}(V,$),$.finish()}function $e(V,$){var te;$.writeVarintField(15,V.version||1),$.writeStringField(1,V.name||""),$.writeVarintField(5,V.extent||4096);var he={keys:[],values:[],keycache:{},valuecache:{}};for(te=0;te<V.length;te++)he.feature=V.feature(te),$.writeMessage(2,Ht,he);var Me=he.keys;for(te=0;te<Me.length;te++)$.writeStringField(3,Me[te]);var Ge=he.values;for(te=0;te<Ge.length;te++)$.writeMessage(4,Se,Ge[te])}function Ht(V,$){var te=V.feature;te.id!==void 0&&$.writeVarintField(1,te.id),$.writeMessage(2,vr,V),$.writeVarintField(3,te.type),$.writeMessage(4,A,te)}function vr(V,$){var te=V.feature,he=V.keys,Me=V.values,Ge=V.keycache,Qe=V.valuecache;for(var oe in te.properties){var Le=Ge[oe];Le===void 0&&(he.push(oe),Ge[oe]=Le=he.length-1),$.writeVarint(Le);var ht=te.properties[oe],fr=typeof ht;fr!=="string"&&fr!=="boolean"&&fr!=="number"&&(ht=JSON.stringify(ht));var kt=fr+":"+ht,Ft=Qe[kt];Ft===void 0&&(Me.push(ht),Qe[kt]=Ft=Me.length-1),$.writeVarint(Ft)}}function Fr(V,$){return($<<3)+(7&V)}function Yr(V){return V<<1^V>>31}function A(V,$){for(var te=V.loadGeometry(),he=V.type,Me=0,Ge=0,Qe=te.length,oe=0;oe<Qe;oe++){var Le=te[oe],ht=1;he===1&&(ht=Le.length),$.writeVarint(Fr(1,ht));for(var fr=he===3?Le.length-1:Le.length,kt=0;kt<fr;kt++){kt===1&&he!==1&&$.writeVarint(Fr(2,fr-1));var Ft=Le[kt].x-Me,pr=Le[kt].y-Ge;$.writeVarint(Yr(Ft)),$.writeVarint(Yr(pr)),Me+=Ft,Ge+=pr}he===3&&$.writeVarint(Fr(7,1))}}function Se(V,$){var te=typeof V;te==="string"?$.writeStringField(1,V):te==="boolean"?$.writeBooleanField(7,V):te==="number"&&(V%1!=0?$.writeDoubleField(3,V):V<0?$.writeSVarintField(6,V):$.writeVarintField(5,V))}function ke(V,$,te,he){ut(V,te,he),ut($,2*te,2*he),ut($,2*te+1,2*he+1)}function ut(V,$,te){var he=V[$];V[$]=V[te],V[te]=he}function ft(V,$,te,he){var Me=V-te,Ge=$-he;return Me*Me+Ge*Ge}at.fromVectorTileJs=xt,at.fromGeojsonVt=function(V,$){$=$||{};var te={};for(var he in V)te[he]=new $t(V[he].features,$),te[he].name=he,te[he].version=$.version,te[he].extent=$.extent;return xt({layers:te})},at.GeoJSONWrapper=qe;var Rt=function(V){return V[0]},Dt=function(V){return V[1]},gr=function(V,$,te,he,Me){$===void 0&&($=Rt),te===void 0&&(te=Dt),he===void 0&&(he=64),Me===void 0&&(Me=Float64Array),this.nodeSize=he,this.points=V;for(var Ge=V.length<65536?Uint16Array:Uint32Array,Qe=this.ids=new Ge(V.length),oe=this.coords=new Me(2*V.length),Le=0;Le<V.length;Le++)Qe[Le]=Le,oe[2*Le]=$(V[Le]),oe[2*Le+1]=te(V[Le]);(function ht(fr,kt,Ft,pr,_n,fn){if(!(_n-pr<=Ft)){var Tt=pr+_n>>1;(function Jr(Br,Wr,vi,en,gn,Hi){for(;gn>en;){if(gn-en>600){var pi=gn-en+1,wi=vi-en+1,yi=Math.log(pi),dt=.5*Math.exp(2*yi/3),Mt=.5*Math.sqrt(yi*dt*(pi-dt)/pi)*(wi-pi/2<0?-1:1);Jr(Br,Wr,vi,Math.max(en,Math.floor(vi-wi*dt/pi+Mt)),Math.min(gn,Math.floor(vi+(pi-wi)*dt/pi+Mt)),Hi)}var wa=Wr[2*vi+Hi],Ei=en,Ti=gn;for(ke(Br,Wr,en,vi),Wr[2*gn+Hi]>wa&&ke(Br,Wr,en,gn);Ei<Ti;){for(ke(Br,Wr,Ei,Ti),Ei++,Ti--;Wr[2*Ei+Hi]<wa;)Ei++;for(;Wr[2*Ti+Hi]>wa;)Ti--}Wr[2*en+Hi]===wa?ke(Br,Wr,en,Ti):ke(Br,Wr,++Ti,gn),Ti<=vi&&(en=Ti+1),vi<=Ti&&(gn=Ti-1)}})(fr,kt,Tt,pr,_n,fn%2),ht(fr,kt,Ft,pr,Tt-1,fn+1),ht(fr,kt,Ft,Tt+1,_n,fn+1)}})(Qe,oe,he,0,Qe.length-1,0)};gr.prototype.range=function(V,$,te,he){return function(Me,Ge,Qe,oe,Le,ht,fr){for(var kt,Ft,pr=[0,Me.length-1,0],_n=[];pr.length;){var fn=pr.pop(),Tt=pr.pop(),Jr=pr.pop();if(Tt-Jr<=fr)for(var Br=Jr;Br<=Tt;Br++)Ft=Ge[2*Br+1],(kt=Ge[2*Br])>=Qe&&kt<=Le&&Ft>=oe&&Ft<=ht&&_n.push(Me[Br]);else{var Wr=Math.floor((Jr+Tt)/2);Ft=Ge[2*Wr+1],(kt=Ge[2*Wr])>=Qe&&kt<=Le&&Ft>=oe&&Ft<=ht&&_n.push(Me[Wr]);var vi=(fn+1)%2;(fn===0?Qe<=kt:oe<=Ft)&&(pr.push(Jr),pr.push(Wr-1),pr.push(vi)),(fn===0?Le>=kt:ht>=Ft)&&(pr.push(Wr+1),pr.push(Tt),pr.push(vi))}}return _n}(this.ids,this.coords,V,$,te,he,this.nodeSize)},gr.prototype.within=function(V,$,te){return function(he,Me,Ge,Qe,oe,Le){for(var ht=[0,he.length-1,0],fr=[],kt=oe*oe;ht.length;){var Ft=ht.pop(),pr=ht.pop(),_n=ht.pop();if(pr-_n<=Le)for(var fn=_n;fn<=pr;fn++)ft(Me[2*fn],Me[2*fn+1],Ge,Qe)<=kt&&fr.push(he[fn]);else{var Tt=Math.floor((_n+pr)/2),Jr=Me[2*Tt],Br=Me[2*Tt+1];ft(Jr,Br,Ge,Qe)<=kt&&fr.push(he[Tt]);var Wr=(Ft+1)%2;(Ft===0?Ge-oe<=Jr:Qe-oe<=Br)&&(ht.push(_n),ht.push(Tt-1),ht.push(Wr)),(Ft===0?Ge+oe>=Jr:Qe+oe>=Br)&&(ht.push(Tt+1),ht.push(pr),ht.push(Wr))}}return fr}(this.ids,this.coords,V,$,te,this.nodeSize)};var Yn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(V){return V}},Gr=function(V){this.options=ta(Object.create(Yn),V),this.trees=new Array(this.options.maxZoom+1)};function Nn(V,$,te,he,Me){return{x:V,y:$,zoom:1/0,id:te,parentId:-1,numPoints:he,properties:Me}}function yn(V,$){var te=V.geometry.coordinates,he=te[1];return{x:Gn(te[0]),y:fi(he),zoom:1/0,index:$,parentId:-1}}function zn(V){return{type:"Feature",id:V.id,properties:si(V),geometry:{type:"Point",coordinates:[(he=V.x,360*(he-.5)),($=V.y,te=(180-360*$)*Math.PI/180,360*Math.atan(Math.exp(te))/Math.PI-90)]}};var $,te,he}function si(V){var $=V.numPoints,te=$>=1e4?Math.round($/1e3)+"k":$>=1e3?Math.round($/100)/10+"k":$;return ta(ta({},V.properties),{cluster:!0,cluster_id:V.id,point_count:$,point_count_abbreviated:te})}function Gn(V){return V/360+.5}function fi(V){var $=Math.sin(V*Math.PI/180),te=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return te<0?0:te>1?1:te}function ta(V,$){for(var te in $)V[te]=$[te];return V}function zi(V){return V.x}function Ii(V){return V.y}function Ki(V,$,te,he,Me,Ge){var Qe=Me-te,oe=Ge-he;if(Qe!==0||oe!==0){var Le=((V-te)*Qe+($-he)*oe)/(Qe*Qe+oe*oe);Le>1?(te=Me,he=Ge):Le>0&&(te+=Qe*Le,he+=oe*Le)}return(Qe=V-te)*Qe+(oe=$-he)*oe}function ra(V,$,te,he){var Me={id:V===void 0?null:V,type:$,geometry:te,tags:he,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ge){var Qe=Ge.geometry,oe=Ge.type;if(oe==="Point"||oe==="MultiPoint"||oe==="LineString")Ya(Ge,Qe);else if(oe==="Polygon"||oe==="MultiLineString")for(var Le=0;Le<Qe.length;Le++)Ya(Ge,Qe[Le]);else if(oe==="MultiPolygon")for(Le=0;Le<Qe.length;Le++)for(var ht=0;ht<Qe[Le].length;ht++)Ya(Ge,Qe[Le][ht])}(Me),Me}function Ya(V,$){for(var te=0;te<$.length;te+=3)V.minX=Math.min(V.minX,$[te]),V.minY=Math.min(V.minY,$[te+1]),V.maxX=Math.max(V.maxX,$[te]),V.maxY=Math.max(V.maxY,$[te+1])}function na(V,$,te,he){if($.geometry){var Me=$.geometry.coordinates,Ge=$.geometry.type,Qe=Math.pow(te.tolerance/((1<<te.maxZoom)*te.extent),2),oe=[],Le=$.id;if(te.promoteId?Le=$.properties[te.promoteId]:te.generateId&&(Le=he||0),Ge==="Point")ia(Me,oe);else if(Ge==="MultiPoint")for(var ht=0;ht<Me.length;ht++)ia(Me[ht],oe);else if(Ge==="LineString")ki(Me,oe,Qe,!1);else if(Ge==="MultiLineString"){if(te.lineMetrics){for(ht=0;ht<Me.length;ht++)ki(Me[ht],oe=[],Qe,!1),V.push(ra(Le,"LineString",oe,$.properties));return}qi(Me,oe,Qe,!1)}else if(Ge==="Polygon")qi(Me,oe,Qe,!0);else{if(Ge!=="MultiPolygon"){if(Ge==="GeometryCollection"){for(ht=0;ht<$.geometry.geometries.length;ht++)na(V,{id:Le,geometry:$.geometry.geometries[ht],properties:$.properties},te,he);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ht=0;ht<Me.length;ht++){var fr=[];qi(Me[ht],fr,Qe,!0),oe.push(fr)}}V.push(ra(Le,Ge,oe,$.properties))}}function ia(V,$){$.push(Gi(V[0])),$.push(Cs(V[1])),$.push(0)}function ki(V,$,te,he){for(var Me,Ge,Qe=0,oe=0;oe<V.length;oe++){var Le=Gi(V[oe][0]),ht=Cs(V[oe][1]);$.push(Le),$.push(ht),$.push(0),oe>0&&(Qe+=he?(Me*ht-Le*Ge)/2:Math.sqrt(Math.pow(Le-Me,2)+Math.pow(ht-Ge,2))),Me=Le,Ge=ht}var fr=$.length-3;$[2]=1,function kt(Ft,pr,_n,fn){for(var Tt,Jr=fn,Br=_n-pr>>1,Wr=_n-pr,vi=Ft[pr],en=Ft[pr+1],gn=Ft[_n],Hi=Ft[_n+1],pi=pr+3;pi<_n;pi+=3){var wi=Ki(Ft[pi],Ft[pi+1],vi,en,gn,Hi);if(wi>Jr)Tt=pi,Jr=wi;else if(wi===Jr){var yi=Math.abs(pi-Br);yi<Wr&&(Tt=pi,Wr=yi)}}Jr>fn&&(Tt-pr>3&&kt(Ft,pr,Tt,fn),Ft[Tt+2]=Jr,_n-Tt>3&&kt(Ft,Tt,_n,fn))}($,0,fr,te),$[fr+2]=1,$.size=Math.abs(Qe),$.start=0,$.end=$.size}function qi(V,$,te,he){for(var Me=0;Me<V.length;Me++){var Ge=[];ki(V[Me],Ge,te,he),$.push(Ge)}}function Gi(V){return V/360+.5}function Cs(V){var $=Math.sin(V*Math.PI/180),te=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return te<0?0:te>1?1:te}function fe(V,$,te,he,Me,Ge,Qe,oe){if(he/=$,Ge>=(te/=$)&&Qe<he)return V;if(Qe<te||Ge>=he)return null;for(var Le=[],ht=0;ht<V.length;ht++){var fr=V[ht],kt=fr.geometry,Ft=fr.type,pr=Me===0?fr.minX:fr.minY,_n=Me===0?fr.maxX:fr.maxY;if(pr>=te&&_n<he)Le.push(fr);else if(!(_n<te||pr>=he)){var fn=[];if(Ft==="Point"||Ft==="MultiPoint")ui(kt,fn,te,he,Me);else if(Ft==="LineString")bo(kt,fn,te,he,Me,!1,oe.lineMetrics);else if(Ft==="MultiLineString")Ut(kt,fn,te,he,Me,!1);else if(Ft==="Polygon")Ut(kt,fn,te,he,Me,!0);else if(Ft==="MultiPolygon")for(var Tt=0;Tt<kt.length;Tt++){var Jr=[];Ut(kt[Tt],Jr,te,he,Me,!0),Jr.length&&fn.push(Jr)}if(fn.length){if(oe.lineMetrics&&Ft==="LineString"){for(Tt=0;Tt<fn.length;Tt++)Le.push(ra(fr.id,Ft,fn[Tt],fr.tags));continue}Ft!=="LineString"&&Ft!=="MultiLineString"||(fn.length===1?(Ft="LineString",fn=fn[0]):Ft="MultiLineString"),Ft!=="Point"&&Ft!=="MultiPoint"||(Ft=fn.length===3?"Point":"MultiPoint"),Le.push(ra(fr.id,Ft,fn,fr.tags))}}}return Le.length?Le:null}function ui(V,$,te,he,Me){for(var Ge=0;Ge<V.length;Ge+=3){var Qe=V[Ge+Me];Qe>=te&&Qe<=he&&($.push(V[Ge]),$.push(V[Ge+1]),$.push(V[Ge+2]))}}function bo(V,$,te,he,Me,Ge,Qe){for(var oe,Le,ht=su(V),fr=Me===0?Rr:an,kt=V.start,Ft=0;Ft<V.length-3;Ft+=3){var pr=V[Ft],_n=V[Ft+1],fn=V[Ft+2],Tt=V[Ft+3],Jr=V[Ft+4],Br=Me===0?pr:_n,Wr=Me===0?Tt:Jr,vi=!1;Qe&&(oe=Math.sqrt(Math.pow(pr-Tt,2)+Math.pow(_n-Jr,2))),Br<te?Wr>te&&(Le=fr(ht,pr,_n,Tt,Jr,te),Qe&&(ht.start=kt+oe*Le)):Br>he?Wr<he&&(Le=fr(ht,pr,_n,Tt,Jr,he),Qe&&(ht.start=kt+oe*Le)):er(ht,pr,_n,fn),Wr<te&&Br>=te&&(Le=fr(ht,pr,_n,Tt,Jr,te),vi=!0),Wr>he&&Br<=he&&(Le=fr(ht,pr,_n,Tt,Jr,he),vi=!0),!Ge&&vi&&(Qe&&(ht.end=kt+oe*Le),$.push(ht),ht=su(V)),Qe&&(kt+=oe)}var en=V.length-3;pr=V[en],_n=V[en+1],fn=V[en+2],(Br=Me===0?pr:_n)>=te&&Br<=he&&er(ht,pr,_n,fn),en=ht.length-3,Ge&&en>=3&&(ht[en]!==ht[0]||ht[en+1]!==ht[1])&&er(ht,ht[0],ht[1],ht[2]),ht.length&&$.push(ht)}function su(V){var $=[];return $.size=V.size,$.start=V.start,$.end=V.end,$}function Ut(V,$,te,he,Me,Ge){for(var Qe=0;Qe<V.length;Qe++)bo(V[Qe],$,te,he,Me,Ge,!1)}function er(V,$,te,he){V.push($),V.push(te),V.push(he)}function Rr(V,$,te,he,Me,Ge){var Qe=(Ge-$)/(he-$);return V.push(Ge),V.push(te+(Me-te)*Qe),V.push(1),Qe}function an(V,$,te,he,Me,Ge){var Qe=(Ge-te)/(Me-te);return V.push($+(he-$)*Qe),V.push(Ge),V.push(1),Qe}function Tn(V,$){for(var te=[],he=0;he<V.length;he++){var Me,Ge=V[he],Qe=Ge.type;if(Qe==="Point"||Qe==="MultiPoint"||Qe==="LineString")Me=Un(Ge.geometry,$);else if(Qe==="MultiLineString"||Qe==="Polygon"){Me=[];for(var oe=0;oe<Ge.geometry.length;oe++)Me.push(Un(Ge.geometry[oe],$))}else if(Qe==="MultiPolygon")for(Me=[],oe=0;oe<Ge.geometry.length;oe++){for(var Le=[],ht=0;ht<Ge.geometry[oe].length;ht++)Le.push(Un(Ge.geometry[oe][ht],$));Me.push(Le)}te.push(ra(Ge.id,Qe,Me,Ge.tags))}return te}function Un(V,$){var te=[];te.size=V.size,V.start!==void 0&&(te.start=V.start,te.end=V.end);for(var he=0;he<V.length;he+=3)te.push(V[he]+$,V[he+1],V[he+2]);return te}function bi(V,$){if(V.transformed)return V;var te,he,Me,Ge=1<<V.z,Qe=V.x,oe=V.y;for(te=0;te<V.features.length;te++){var Le=V.features[te],ht=Le.geometry,fr=Le.type;if(Le.geometry=[],fr===1)for(he=0;he<ht.length;he+=2)Le.geometry.push(di(ht[he],ht[he+1],$,Ge,Qe,oe));else for(he=0;he<ht.length;he++){var kt=[];for(Me=0;Me<ht[he].length;Me+=2)kt.push(di(ht[he][Me],ht[he][Me+1],$,Ge,Qe,oe));Le.geometry.push(kt)}}return V.transformed=!0,V}function di(V,$,te,he,Me,Ge){return[Math.round(te*(V*he-Me)),Math.round(te*($*he-Ge))]}function Sn(V,$,te,he,Me){for(var Ge=$===Me.maxZoom?0:Me.tolerance/((1<<$)*Me.extent),Qe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:te,y:he,z:$,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},oe=0;oe<V.length;oe++){Qe.numFeatures++,Li(Qe,V[oe],Ge,Me);var Le=V[oe].minX,ht=V[oe].minY,fr=V[oe].maxX,kt=V[oe].maxY;Le<Qe.minX&&(Qe.minX=Le),ht<Qe.minY&&(Qe.minY=ht),fr>Qe.maxX&&(Qe.maxX=fr),kt>Qe.maxY&&(Qe.maxY=kt)}return Qe}function Li(V,$,te,he){var Me=$.geometry,Ge=$.type,Qe=[];if(Ge==="Point"||Ge==="MultiPoint")for(var oe=0;oe<Me.length;oe+=3)Qe.push(Me[oe]),Qe.push(Me[oe+1]),V.numPoints++,V.numSimplified++;else if(Ge==="LineString")Oi(Qe,Me,V,te,!1,!1);else if(Ge==="MultiLineString"||Ge==="Polygon")for(oe=0;oe<Me.length;oe++)Oi(Qe,Me[oe],V,te,Ge==="Polygon",oe===0);else if(Ge==="MultiPolygon")for(var Le=0;Le<Me.length;Le++){var ht=Me[Le];for(oe=0;oe<ht.length;oe++)Oi(Qe,ht[oe],V,te,!0,oe===0)}if(Qe.length){var fr=$.tags||null;if(Ge==="LineString"&&he.lineMetrics){for(var kt in fr={},$.tags)fr[kt]=$.tags[kt];fr.mapbox_clip_start=Me.start/Me.size,fr.mapbox_clip_end=Me.end/Me.size}var Ft={geometry:Qe,type:Ge==="Polygon"||Ge==="MultiPolygon"?3:Ge==="LineString"||Ge==="MultiLineString"?2:1,tags:fr};$.id!==null&&(Ft.id=$.id),V.features.push(Ft)}}function Oi(V,$,te,he,Me,Ge){var Qe=he*he;if(he>0&&$.size<(Me?Qe:he))te.numPoints+=$.length/3;else{for(var oe=[],Le=0;Le<$.length;Le+=3)(he===0||$[Le+2]>Qe)&&(te.numSimplified++,oe.push($[Le]),oe.push($[Le+1])),te.numPoints++;Me&&function(ht,fr){for(var kt=0,Ft=0,pr=ht.length,_n=pr-2;Ft<pr;_n=Ft,Ft+=2)kt+=(ht[Ft]-ht[_n])*(ht[Ft+1]+ht[_n+1]);if(kt>0===fr)for(Ft=0,pr=ht.length;Ft<pr/2;Ft+=2){var fn=ht[Ft],Tt=ht[Ft+1];ht[Ft]=ht[pr-2-Ft],ht[Ft+1]=ht[pr-1-Ft],ht[pr-2-Ft]=fn,ht[pr-1-Ft]=Tt}}(oe,Ge),V.push(oe)}}function io(V,$){var te=($=this.options=function(Me,Ge){for(var Qe in Ge)Me[Qe]=Ge[Qe];return Me}(Object.create(this.options),$)).debug;if(te&&console.time("preprocess data"),$.maxZoom<0||$.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if($.promoteId&&$.generateId)throw new Error("promoteId and generateId cannot be used together.");var he=function(Me,Ge){var Qe=[];if(Me.type==="FeatureCollection")for(var oe=0;oe<Me.features.length;oe++)na(Qe,Me.features[oe],Ge,oe);else na(Qe,Me.type==="Feature"?Me:{geometry:Me},Ge);return Qe}(V,$);this.tiles={},this.tileCoords=[],te&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",$.indexMaxZoom,$.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(he=function(Me,Ge){var Qe=Ge.buffer/Ge.extent,oe=Me,Le=fe(Me,1,-1-Qe,Qe,0,-1,2,Ge),ht=fe(Me,1,1-Qe,2+Qe,0,-1,2,Ge);return(Le||ht)&&(oe=fe(Me,1,-Qe,1+Qe,0,-1,2,Ge)||[],Le&&(oe=Tn(Le,1).concat(oe)),ht&&(oe=oe.concat(Tn(ht,-1)))),oe}(he,$)).length&&this.splitTile(he,0,0,0),te&&(he.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function hs(V,$,te){return 32*((1<<V)*te+$)+V}function Uo(V,$){var te=V.tileID.canonical;if(!this._geoJSONIndex)return $(null,null);var he=this._geoJSONIndex.getTile(te.z,te.x,te.y);if(!he)return $(null,null);var Me=new ct(he.features),Ge=at(Me);Ge.byteOffset===0&&Ge.byteLength===Ge.buffer.byteLength||(Ge=new Uint8Array(Ge)),$(null,{vectorTile:Me,rawData:Ge.buffer})}Gr.prototype.load=function(V){var $=this.options,te=$.log,he=$.minZoom,Me=$.maxZoom,Ge=$.nodeSize;te&&console.time("total time");var Qe="prepare "+V.length+" points";te&&console.time(Qe),this.points=V;for(var oe=[],Le=0;Le<V.length;Le++)V[Le].geometry&&oe.push(yn(V[Le],Le));this.trees[Me+1]=new gr(oe,zi,Ii,Ge,Float32Array),te&&console.timeEnd(Qe);for(var ht=Me;ht>=he;ht--){var fr=+Date.now();oe=this._cluster(oe,ht),this.trees[ht]=new gr(oe,zi,Ii,Ge,Float32Array),te&&console.log("z%d: %d clusters in %dms",ht,oe.length,+Date.now()-fr)}return te&&console.timeEnd("total time"),this},Gr.prototype.getClusters=function(V,$){var te=((V[0]+180)%360+360)%360-180,he=Math.max(-90,Math.min(90,V[1])),Me=V[2]===180?180:((V[2]+180)%360+360)%360-180,Ge=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)te=-180,Me=180;else if(te>Me){var Qe=this.getClusters([te,he,180,Ge],$),oe=this.getClusters([-180,he,Me,Ge],$);return Qe.concat(oe)}for(var Le=this.trees[this._limitZoom($)],ht=[],fr=0,kt=Le.range(Gn(te),fi(Ge),Gn(Me),fi(he));fr<kt.length;fr+=1){var Ft=Le.points[kt[fr]];ht.push(Ft.numPoints?zn(Ft):this.points[Ft.index])}return ht},Gr.prototype.getChildren=function(V){var $=this._getOriginId(V),te=this._getOriginZoom(V),he="No cluster with the specified id.",Me=this.trees[te];if(!Me)throw new Error(he);var Ge=Me.points[$];if(!Ge)throw new Error(he);for(var Qe=this.options.radius/(this.options.extent*Math.pow(2,te-1)),oe=[],Le=0,ht=Me.within(Ge.x,Ge.y,Qe);Le<ht.length;Le+=1){var fr=Me.points[ht[Le]];fr.parentId===V&&oe.push(fr.numPoints?zn(fr):this.points[fr.index])}if(oe.length===0)throw new Error(he);return oe},Gr.prototype.getLeaves=function(V,$,te){var he=[];return this._appendLeaves(he,V,$=$||10,te=te||0,0),he},Gr.prototype.getTile=function(V,$,te){var he=this.trees[this._limitZoom(V)],Me=Math.pow(2,V),Ge=this.options,Qe=Ge.radius/Ge.extent,oe=(te-Qe)/Me,Le=(te+1+Qe)/Me,ht={features:[]};return this._addTileFeatures(he.range(($-Qe)/Me,oe,($+1+Qe)/Me,Le),he.points,$,te,Me,ht),$===0&&this._addTileFeatures(he.range(1-Qe/Me,oe,1,Le),he.points,Me,te,Me,ht),$===Me-1&&this._addTileFeatures(he.range(0,oe,Qe/Me,Le),he.points,-1,te,Me,ht),ht.features.length?ht:null},Gr.prototype.getClusterExpansionZoom=function(V){for(var $=this._getOriginZoom(V)-1;$<=this.options.maxZoom;){var te=this.getChildren(V);if($++,te.length!==1)break;V=te[0].properties.cluster_id}return $},Gr.prototype._appendLeaves=function(V,$,te,he,Me){for(var Ge=0,Qe=this.getChildren($);Ge<Qe.length;Ge+=1){var oe=Qe[Ge],Le=oe.properties;if(Le&&Le.cluster?Me+Le.point_count<=he?Me+=Le.point_count:Me=this._appendLeaves(V,Le.cluster_id,te,he,Me):Me<he?Me++:V.push(oe),V.length===te)break}return Me},Gr.prototype._addTileFeatures=function(V,$,te,he,Me,Ge){for(var Qe=0,oe=V;Qe<oe.length;Qe+=1){var Le=$[oe[Qe]],ht=Le.numPoints,fr={type:1,geometry:[[Math.round(this.options.extent*(Le.x*Me-te)),Math.round(this.options.extent*(Le.y*Me-he))]],tags:ht?si(Le):this.points[Le.index].properties},kt=void 0;ht?kt=Le.id:this.options.generateId?kt=Le.index:this.points[Le.index].id&&(kt=this.points[Le.index].id),kt!==void 0&&(fr.id=kt),Ge.features.push(fr)}},Gr.prototype._limitZoom=function(V){return Math.max(this.options.minZoom,Math.min(+V,this.options.maxZoom+1))},Gr.prototype._cluster=function(V,$){for(var te=[],he=this.options,Me=he.reduce,Ge=he.minPoints,Qe=he.radius/(he.extent*Math.pow(2,$)),oe=0;oe<V.length;oe++){var Le=V[oe];if(!(Le.zoom<=$)){Le.zoom=$;for(var ht=this.trees[$+1],fr=ht.within(Le.x,Le.y,Qe),kt=Le.numPoints||1,Ft=kt,pr=0,_n=fr;pr<_n.length;pr+=1){var fn=ht.points[_n[pr]];fn.zoom>$&&(Ft+=fn.numPoints||1)}if(Ft>=Ge){for(var Tt=Le.x*kt,Jr=Le.y*kt,Br=Me&&kt>1?this._map(Le,!0):null,Wr=(oe<<5)+($+1)+this.points.length,vi=0,en=fr;vi<en.length;vi+=1){var gn=ht.points[en[vi]];if(!(gn.zoom<=$)){gn.zoom=$;var Hi=gn.numPoints||1;Tt+=gn.x*Hi,Jr+=gn.y*Hi,gn.parentId=Wr,Me&&(Br||(Br=this._map(Le,!0)),Me(Br,this._map(gn)))}}Le.parentId=Wr,te.push(Nn(Tt/Ft,Jr/Ft,Wr,Ft,Br))}else if(te.push(Le),Ft>1)for(var pi=0,wi=fr;pi<wi.length;pi+=1){var yi=ht.points[wi[pi]];yi.zoom<=$||(yi.zoom=$,te.push(yi))}}}return te},Gr.prototype._getOriginId=function(V){return V-this.points.length>>5},Gr.prototype._getOriginZoom=function(V){return(V-this.points.length)%32},Gr.prototype._map=function(V,$){if(V.numPoints)return $?ta({},V.properties):V.properties;var te=this.points[V.index].properties,he=this.options.map(te);return $&&he===te?ta({},he):he},io.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},io.prototype.splitTile=function(V,$,te,he,Me,Ge,Qe){for(var oe=[V,$,te,he],Le=this.options,ht=Le.debug;oe.length;){he=oe.pop(),te=oe.pop(),$=oe.pop(),V=oe.pop();var fr=1<<$,kt=hs($,te,he),Ft=this.tiles[kt];if(!Ft&&(ht>1&&console.time("creation"),Ft=this.tiles[kt]=Sn(V,$,te,he,Le),this.tileCoords.push({z:$,x:te,y:he}),ht)){ht>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",$,te,he,Ft.numFeatures,Ft.numPoints,Ft.numSimplified),console.timeEnd("creation"));var pr="z"+$;this.stats[pr]=(this.stats[pr]||0)+1,this.total++}if(Ft.source=V,Me){if($===Le.maxZoom||$===Me)continue;var _n=1<<Me-$;if(te!==Math.floor(Ge/_n)||he!==Math.floor(Qe/_n))continue}else if($===Le.indexMaxZoom||Ft.numPoints<=Le.indexMaxPoints)continue;if(Ft.source=null,V.length!==0){ht>1&&console.time("clipping");var fn,Tt,Jr,Br,Wr,vi,en=.5*Le.buffer/Le.extent,gn=.5-en,Hi=.5+en,pi=1+en;fn=Tt=Jr=Br=null,Wr=fe(V,fr,te-en,te+Hi,0,Ft.minX,Ft.maxX,Le),vi=fe(V,fr,te+gn,te+pi,0,Ft.minX,Ft.maxX,Le),V=null,Wr&&(fn=fe(Wr,fr,he-en,he+Hi,1,Ft.minY,Ft.maxY,Le),Tt=fe(Wr,fr,he+gn,he+pi,1,Ft.minY,Ft.maxY,Le),Wr=null),vi&&(Jr=fe(vi,fr,he-en,he+Hi,1,Ft.minY,Ft.maxY,Le),Br=fe(vi,fr,he+gn,he+pi,1,Ft.minY,Ft.maxY,Le),vi=null),ht>1&&console.timeEnd("clipping"),oe.push(fn||[],$+1,2*te,2*he),oe.push(Tt||[],$+1,2*te,2*he+1),oe.push(Jr||[],$+1,2*te+1,2*he),oe.push(Br||[],$+1,2*te+1,2*he+1)}}},io.prototype.getTile=function(V,$,te){var he=this.options,Me=he.extent,Ge=he.debug;if(V<0||V>24)return null;var Qe=1<<V,oe=hs(V,$=($%Qe+Qe)%Qe,te);if(this.tiles[oe])return bi(this.tiles[oe],Me);Ge>1&&console.log("drilling down to z%d-%d-%d",V,$,te);for(var Le,ht=V,fr=$,kt=te;!Le&&ht>0;)ht--,fr=Math.floor(fr/2),kt=Math.floor(kt/2),Le=this.tiles[hs(ht,fr,kt)];return Le&&Le.source?(Ge>1&&console.log("found parent tile z%d-%d-%d",ht,fr,kt),Ge>1&&console.time("drilling down"),this.splitTile(Le.source,ht,fr,kt,V,$,te),Ge>1&&console.timeEnd("drilling down"),this.tiles[oe]?bi(this.tiles[oe],Me):null):null};var Na=function(V){function $(te,he,Me,Ge){V.call(this,te,he,Me,Uo),Ge&&(this.loadGeoJSON=Ge)}return V&&($.__proto__=V),($.prototype=Object.create(V&&V.prototype)).constructor=$,$.prototype.loadData=function(te,he){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=he,this._pendingLoadDataParams=te,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},$.prototype._loadData=function(){var te=this;if(this._pendingCallback&&this._pendingLoadDataParams){var he=this._pendingCallback,Me=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var Ge=!!(Me&&Me.request&&Me.request.collectResourceTiming)&&new m.RequestPerformance(Me.request);this.loadGeoJSON(Me,function(Qe,oe){if(Qe||!oe)return he(Qe);if(typeof oe!="object")return he(new Error("Input data given to '"+Me.source+"' is not a valid GeoJSON object."));(function Ft(pr,_n){var fn,Tt=pr&&pr.type;if(Tt==="FeatureCollection")for(fn=0;fn<pr.features.length;fn++)Ft(pr.features[fn],_n);else if(Tt==="GeometryCollection")for(fn=0;fn<pr.geometries.length;fn++)Ft(pr.geometries[fn],_n);else if(Tt==="Feature")Ft(pr.geometry,_n);else if(Tt==="Polygon")or(pr.coordinates,_n);else if(Tt==="MultiPolygon")for(fn=0;fn<pr.coordinates.length;fn++)or(pr.coordinates[fn],_n);return pr})(oe,!0);try{if(Me.filter){var Le=m.createExpression(Me.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Le.result==="error")throw new Error(Le.value.map(function(Ft){return Ft.key+": "+Ft.message}).join(", "));var ht=oe.features.filter(function(Ft){return Le.value.evaluate({zoom:0},Ft)});oe={type:"FeatureCollection",features:ht}}te._geoJSONIndex=Me.cluster?new Gr(function(Ft){var pr=Ft.superclusterOptions,_n=Ft.clusterProperties;if(!_n||!pr)return pr;for(var fn={},Tt={},Jr={accumulated:null,zoom:0},Br={properties:null},Wr=Object.keys(_n),vi=0,en=Wr;vi<en.length;vi+=1){var gn=en[vi],Hi=_n[gn],pi=Hi[0],wi=m.createExpression(Hi[1]),yi=m.createExpression(typeof pi=="string"?[pi,["accumulated"],["get",gn]]:pi);fn[gn]=wi.value,Tt[gn]=yi.value}return pr.map=function(dt){Br.properties=dt;for(var Mt={},wa=0,Ei=Wr;wa<Ei.length;wa+=1){var Ti=Ei[wa];Mt[Ti]=fn[Ti].evaluate(Jr,Br)}return Mt},pr.reduce=function(dt,Mt){Br.properties=Mt;for(var wa=0,Ei=Wr;wa<Ei.length;wa+=1){var Ti=Ei[wa];Jr.accumulated=dt[Ti],dt[Ti]=Tt[Ti].evaluate(Jr,Br)}},pr}(Me)).load(oe.features):function(Ft,pr){return new io(Ft,pr)}(oe,Me.geojsonVtOptions)}catch(Ft){return he(Ft)}te.loaded={};var fr={};if(Ge){var kt=Ge.finish();kt&&(fr.resourceTiming={},fr.resourceTiming[Me.source]=JSON.parse(JSON.stringify(kt)))}he(null,fr)})}},$.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},$.prototype.reloadTile=function(te,he){var Me=this.loaded;return Me&&Me[te.uid]?V.prototype.reloadTile.call(this,te,he):this.loadTile(te,he)},$.prototype.loadGeoJSON=function(te,he){if(te.request)m.getJSON(te.request,he);else{if(typeof te.data!="string")return he(new Error("Input data given to '"+te.source+"' is not a valid GeoJSON object."));try{return he(null,JSON.parse(te.data))}catch(Me){return he(new Error("Input data given to '"+te.source+"' is not a valid GeoJSON object."))}}},$.prototype.removeSource=function(te,he){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),he()},$.prototype.getClusterExpansionZoom=function(te,he){try{he(null,this._geoJSONIndex.getClusterExpansionZoom(te.clusterId))}catch(Me){he(Me)}},$.prototype.getClusterChildren=function(te,he){try{he(null,this._geoJSONIndex.getChildren(te.clusterId))}catch(Me){he(Me)}},$.prototype.getClusterLeaves=function(te,he){try{he(null,this._geoJSONIndex.getLeaves(te.clusterId,te.limit,te.offset))}catch(Me){he(Me)}},$}(mt),xa=function(V){var $=this;this.self=V,this.actor=new m.Actor(V,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:mt,geojson:Na},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(te,he){if($.workerSourceTypes[te])throw new Error('Worker source with name "'+te+'" already registered.');$.workerSourceTypes[te]=he},this.self.registerRTLTextPlugin=function(te){if(m.plugin.isParsed())throw new Error("RTL text plugin already registered.");m.plugin.applyArabicShaping=te.applyArabicShaping,m.plugin.processBidirectionalText=te.processBidirectionalText,m.plugin.processStyledBidirectionalText=te.processStyledBidirectionalText}};return xa.prototype.setReferrer=function(V,$){this.referrer=$},xa.prototype.setImages=function(V,$,te){for(var he in this.availableImages[V]=$,this.workerSources[V]){var Me=this.workerSources[V][he];for(var Ge in Me)Me[Ge].availableImages=$}te()},xa.prototype.setLayers=function(V,$,te){this.getLayerIndex(V).replace($),te()},xa.prototype.updateLayers=function(V,$,te){this.getLayerIndex(V).update($.layers,$.removedIds),te()},xa.prototype.loadTile=function(V,$,te){this.getWorkerSource(V,$.type,$.source).loadTile($,te)},xa.prototype.loadDEMTile=function(V,$,te){this.getDEMWorkerSource(V,$.source).loadTile($,te)},xa.prototype.reloadTile=function(V,$,te){this.getWorkerSource(V,$.type,$.source).reloadTile($,te)},xa.prototype.abortTile=function(V,$,te){this.getWorkerSource(V,$.type,$.source).abortTile($,te)},xa.prototype.removeTile=function(V,$,te){this.getWorkerSource(V,$.type,$.source).removeTile($,te)},xa.prototype.removeDEMTile=function(V,$){this.getDEMWorkerSource(V,$.source).removeTile($)},xa.prototype.removeSource=function(V,$,te){if(this.workerSources[V]&&this.workerSources[V][$.type]&&this.workerSources[V][$.type][$.source]){var he=this.workerSources[V][$.type][$.source];delete this.workerSources[V][$.type][$.source],he.removeSource!==void 0?he.removeSource($,te):te()}},xa.prototype.loadWorkerSource=function(V,$,te){try{this.self.importScripts($.url),te()}catch(he){te(he.toString())}},xa.prototype.syncRTLPluginState=function(V,$,te){try{m.plugin.setState($);var he=m.plugin.getPluginURL();if(m.plugin.isLoaded()&&!m.plugin.isParsed()&&he!=null){this.self.importScripts(he);var Me=m.plugin.isParsed();te(Me?void 0:new Error("RTL Text Plugin failed to import scripts from "+he),Me)}}catch(Ge){te(Ge.toString())}},xa.prototype.getAvailableImages=function(V){var $=this.availableImages[V];return $||($=[]),$},xa.prototype.getLayerIndex=function(V){var $=this.layerIndexes[V];return $||($=this.layerIndexes[V]=new pe),$},xa.prototype.getWorkerSource=function(V,$,te){var he=this;return this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][$]||(this.workerSources[V][$]={}),this.workerSources[V][$][te]||(this.workerSources[V][$][te]=new this.workerSourceTypes[$]({send:function(Me,Ge,Qe){he.actor.send(Me,Ge,Qe,V)}},this.getLayerIndex(V),this.getAvailableImages(V))),this.workerSources[V][$][te]},xa.prototype.getDEMWorkerSource=function(V,$){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][$]||(this.demWorkerSources[V][$]=new Bt),this.demWorkerSources[V][$]},xa.prototype.enforceCacheSizeLimit=function(V,$){m.enforceCacheSizeLimit($)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new xa(self)),xa}),me(["./shared"],function(m){"use strict";var Re=m.createCommonjsModule(function(l){function f(E){return!c(E)}function c(E){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var P,L,U=new Blob([""],{type:"text/javascript"}),H=URL.createObjectURL(U);try{L=new Worker(H),P=!0}catch(ae){P=!1}return L&&L.terminate(),URL.revokeObjectURL(H),P}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var P=document.createElement("canvas");P.width=P.height=1;var L=P.getContext("2d");if(!L)return!1;var U=L.getImageData(0,0,1,1);return U&&U.width===P.width}()?(d[w=E&&E.failIfMajorPerformanceCaveat]===void 0&&(d[w]=function(P){var L=function(H){var ae=document.createElement("canvas"),se=Object.create(f.webGLContextAttributes);return se.failIfMajorPerformanceCaveat=H,ae.probablySupportsContext?ae.probablySupportsContext("webgl",se)||ae.probablySupportsContext("experimental-webgl",se):ae.supportsContext?ae.supportsContext("webgl",se)||ae.supportsContext("experimental-webgl",se):ae.getContext("webgl",se)||ae.getContext("experimental-webgl",se)}(P);if(!L)return!1;var U=L.createShader(L.VERTEX_SHADER);return!(!U||L.isContextLost())&&(L.shaderSource(U,"void main() {}"),L.compileShader(U),L.getShaderParameter(U,L.COMPILE_STATUS)===!0)}(w)),d[w]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var w}l.exports?l.exports=f:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=f,window.mapboxgl.notSupportedReason=c);var d={};f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),W={create:function(l,f,c){var d=m.window.document.createElement(l);return f!==void 0&&(d.className=f),c&&c.appendChild(d),d},createNS:function(l,f){return m.window.document.createElementNS(l,f)}},pe=m.window.document&&m.window.document.documentElement.style;function de(l){if(!pe)return l[0];for(var f=0;f<l.length;f++)if(l[f]in pe)return l[f];return l[0]}var ze,_e=de(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);W.disableDrag=function(){pe&&_e&&(ze=pe[_e],pe[_e]="none")},W.enableDrag=function(){pe&&_e&&(pe[_e]=ze)};var et=de(["transform","WebkitTransform"]);W.setTransform=function(l,f){l.style[et]=f};var mt=!1;try{var Ct=Object.defineProperty({},"passive",{get:function(){mt=!0}});m.window.addEventListener("test",Ct,Ct),m.window.removeEventListener("test",Ct,Ct)}catch(l){mt=!1}W.addEventListener=function(l,f,c,d){d===void 0&&(d={}),l.addEventListener(f,c,"passive"in d&&mt?d:d.capture)},W.removeEventListener=function(l,f,c,d){d===void 0&&(d={}),l.removeEventListener(f,c,"passive"in d&&mt?d:d.capture)};var Bt=function(l){l.preventDefault(),l.stopPropagation(),m.window.removeEventListener("click",Bt,!0)};function or(l){var f=l.userImage;return!!(f&&f.render&&f.render())&&(l.data.replace(new Uint8Array(f.data.buffer)),!0)}W.suppressClick=function(){m.window.addEventListener("click",Bt,!0),m.window.setTimeout(function(){m.window.removeEventListener("click",Bt,!0)},0)},W.mousePos=function(l,f){var c=l.getBoundingClientRect();return new m.Point(f.clientX-c.left-l.clientLeft,f.clientY-c.top-l.clientTop)},W.touchPos=function(l,f){for(var c=l.getBoundingClientRect(),d=[],E=0;E<f.length;E++)d.push(new m.Point(f[E].clientX-c.left-l.clientLeft,f[E].clientY-c.top-l.clientTop));return d},W.mouseButton=function(l){return m.window.InstallTrigger!==void 0&&l.button===2&&l.ctrlKey&&m.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:l.button},W.remove=function(l){l.parentNode&&l.parentNode.removeChild(l)};var At=function(l){function f(){l.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new m.RGBAImage({width:1,height:1}),this.dirty=!0}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.isLoaded=function(){return this.loaded},f.prototype.setLoaded=function(c){if(this.loaded!==c&&(this.loaded=c,c)){for(var d=0,E=this.requestors;d<E.length;d+=1){var w=E[d];this._notify(w.ids,w.callback)}this.requestors=[]}},f.prototype.getImage=function(c){return this.images[c]},f.prototype.addImage=function(c,d){this._validate(c,d)&&(this.images[c]=d)},f.prototype._validate=function(c,d){var E=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new m.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchX" value'))),E=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new m.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchY" value'))),E=!1),this._validateContent(d.content,d)||(this.fire(new m.ErrorEvent(new Error('Image "'+c+'" has invalid "content" value'))),E=!1),E},f.prototype._validateStretch=function(c,d){if(!c)return!0;for(var E=0,w=0,P=c;w<P.length;w+=1){var L=P[w];if(L[0]<E||L[1]<L[0]||d<L[1])return!1;E=L[1]}return!0},f.prototype._validateContent=function(c,d){return!(c&&(c.length!==4||c[0]<0||d.data.width<c[0]||c[1]<0||d.data.height<c[1]||c[2]<0||d.data.width<c[2]||c[3]<0||d.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))},f.prototype.updateImage=function(c,d){d.version=this.images[c].version+1,this.images[c]=d,this.updatedImages[c]=!0},f.prototype.removeImage=function(c){var d=this.images[c];delete this.images[c],delete this.patterns[c],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()},f.prototype.listImages=function(){return Object.keys(this.images)},f.prototype.getImages=function(c,d){var E=!0;if(!this.isLoaded())for(var w=0,P=c;w<P.length;w+=1)this.images[P[w]]||(E=!1);this.isLoaded()||E?this._notify(c,d):this.requestors.push({ids:c,callback:d})},f.prototype._notify=function(c,d){for(var E={},w=0,P=c;w<P.length;w+=1){var L=P[w];this.images[L]||this.fire(new m.Event("styleimagemissing",{id:L}));var U=this.images[L];U?E[L]={data:U.data.clone(),pixelRatio:U.pixelRatio,sdf:U.sdf,version:U.version,stretchX:U.stretchX,stretchY:U.stretchY,content:U.content,hasRenderCallback:Boolean(U.userImage&&U.userImage.render)}:m.warnOnce('Image "'+L+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}d(null,E)},f.prototype.getPixelSize=function(){var c=this.atlasImage;return{width:c.width,height:c.height}},f.prototype.getPattern=function(c){var d=this.patterns[c],E=this.getImage(c);if(!E)return null;if(d&&d.position.version===E.version)return d.position;if(d)d.position.version=E.version;else{var w={w:E.data.width+2,h:E.data.height+2,x:0,y:0},P=new m.ImagePosition(w,E);this.patterns[c]={bin:w,position:P}}return this._updatePatternAtlas(),this.patterns[c].position},f.prototype.bind=function(c){var d=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new m.Texture(c,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)},f.prototype._updatePatternAtlas=function(){var c=[];for(var d in this.patterns)c.push(this.patterns[d].bin);var E=m.potpack(c),w=E.w,P=E.h,L=this.atlasImage;for(var U in L.resize({width:w||1,height:P||1}),this.patterns){var H=this.patterns[U].bin,ae=H.x+1,se=H.y+1,le=this.images[U].data,Oe=le.width,Pe=le.height;m.RGBAImage.copy(le,L,{x:0,y:0},{x:ae,y:se},{width:Oe,height:Pe}),m.RGBAImage.copy(le,L,{x:0,y:Pe-1},{x:ae,y:se-1},{width:Oe,height:1}),m.RGBAImage.copy(le,L,{x:0,y:0},{x:ae,y:se+Pe},{width:Oe,height:1}),m.RGBAImage.copy(le,L,{x:Oe-1,y:0},{x:ae-1,y:se},{width:1,height:Pe}),m.RGBAImage.copy(le,L,{x:0,y:0},{x:ae+Oe,y:se},{width:1,height:Pe})}this.dirty=!0},f.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},f.prototype.dispatchRenderCallbacks=function(c){for(var d=0,E=c;d<E.length;d+=1){var w=E[d];if(!this.callbackDispatchedThisFrame[w]){this.callbackDispatchedThisFrame[w]=!0;var P=this.images[w];or(P)&&this.updateImage(w,P)}}},f}(m.Evented),Kt=it,yt=it,ct=1e20;function it(l,f,c,d,E,w){this.fontSize=l||24,this.buffer=f===void 0?3:f,this.cutoff=d||.25,this.fontFamily=E||"sans-serif",this.fontWeight=w||"normal",this.radius=c||8;var P=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=P,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(P*P),this.gridInner=new Float64Array(P*P),this.f=new Float64Array(P),this.d=new Float64Array(P),this.z=new Float64Array(P+1),this.v=new Int16Array(P),this.middle=Math.round(P/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function $t(l,f,c,d,E,w,P){for(var L=0;L<f;L++){for(var U=0;U<c;U++)d[U]=l[U*f+L];for(X(d,E,w,P,c),U=0;U<c;U++)l[U*f+L]=E[U]}for(U=0;U<c;U++){for(L=0;L<f;L++)d[L]=l[U*f+L];for(X(d,E,w,P,f),L=0;L<f;L++)l[U*f+L]=Math.sqrt(E[L])}}function X(l,f,c,d,E){c[0]=0,d[0]=-ct,d[1]=+ct;for(var w=1,P=0;w<E;w++){for(var L=(l[w]+w*w-(l[c[P]]+c[P]*c[P]))/(2*w-2*c[P]);L<=d[P];)P--,L=(l[w]+w*w-(l[c[P]]+c[P]*c[P]))/(2*w-2*c[P]);c[++P]=w,d[P]=L,d[P+1]=+ct}for(w=0,P=0;w<E;w++){for(;d[P+1]<w;)P++;f[w]=(w-c[P])*(w-c[P])+l[c[P]]}}it.prototype.draw=function(l){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(l,this.buffer,this.middle);for(var f=this.ctx.getImageData(0,0,this.size,this.size),c=new Uint8ClampedArray(this.size*this.size),d=0;d<this.size*this.size;d++){var E=f.data[4*d+3]/255;this.gridOuter[d]=E===1?0:E===0?ct:Math.pow(Math.max(0,.5-E),2),this.gridInner[d]=E===1?ct:E===0?0:Math.pow(Math.max(0,E-.5),2)}for($t(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),$t(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),d=0;d<this.size*this.size;d++)c[d]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[d]-this.gridInner[d])/this.radius+this.cutoff))));return c},Kt.default=yt;var Xt=function(l,f){this.requestManager=l,this.localIdeographFontFamily=f,this.entries={}};Xt.prototype.setURL=function(l){this.url=l},Xt.prototype.getGlyphs=function(l,f){var c=this,d=[];for(var E in l)for(var w=0,P=l[E];w<P.length;w+=1)d.push({stack:E,id:P[w]});m.asyncAll(d,function(L,U){var H=L.stack,ae=L.id,se=c.entries[H];se||(se=c.entries[H]={glyphs:{},requests:{},ranges:{}});var le=se.glyphs[ae];if(le===void 0){if(le=c._tinySDF(se,H,ae))return se.glyphs[ae]=le,void U(null,{stack:H,id:ae,glyph:le});var Oe=Math.floor(ae/256);if(256*Oe>65535)U(new Error("glyphs > 65535 not supported"));else if(se.ranges[Oe])U(null,{stack:H,id:ae,glyph:le});else{var Pe=se.requests[Oe];Pe||(Pe=se.requests[Oe]=[],Xt.loadGlyphRange(H,Oe,c.url,c.requestManager,function(Ne,xe){if(xe){for(var je in xe)c._doesCharSupportLocalGlyph(+je)||(se.glyphs[+je]=xe[+je]);se.ranges[Oe]=!0}for(var Ke=0,vt=Pe;Ke<vt.length;Ke+=1)(0,vt[Ke])(Ne,xe);delete se.requests[Oe]})),Pe.push(function(Ne,xe){Ne?U(Ne):xe&&U(null,{stack:H,id:ae,glyph:xe[ae]||null})})}}else U(null,{stack:H,id:ae,glyph:le})},function(L,U){if(L)f(L);else if(U){for(var H={},ae=0,se=U;ae<se.length;ae+=1){var le=se[ae],Oe=le.stack,Pe=le.id,Ne=le.glyph;(H[Oe]||(H[Oe]={}))[Pe]=Ne&&{id:Ne.id,bitmap:Ne.bitmap.clone(),metrics:Ne.metrics}}f(null,H)}})},Xt.prototype._doesCharSupportLocalGlyph=function(l){return!!this.localIdeographFontFamily&&(m.isChar["CJK Unified Ideographs"](l)||m.isChar["Hangul Syllables"](l)||m.isChar.Hiragana(l)||m.isChar.Katakana(l))},Xt.prototype._tinySDF=function(l,f,c){var d=this.localIdeographFontFamily;if(d&&this._doesCharSupportLocalGlyph(c)){var E=l.tinySDF;if(!E){var w="400";/bold/i.test(f)?w="900":/medium/i.test(f)?w="500":/light/i.test(f)&&(w="200"),E=l.tinySDF=new Xt.TinySDF(24,3,8,.25,d,w)}return{id:c,bitmap:new m.AlphaImage({width:30,height:30},E.draw(String.fromCharCode(c))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},Xt.loadGlyphRange=function(l,f,c,d,E){var w=256*f,P=w+255,L=d.transformRequest(d.normalizeGlyphsURL(c).replace("{fontstack}",l).replace("{range}",w+"-"+P),m.ResourceType.Glyphs);m.getArrayBuffer(L,function(U,H){if(U)E(U);else if(H){for(var ae={},se=0,le=m.parseGlyphPBF(H);se<le.length;se+=1){var Oe=le[se];ae[Oe.id]=Oe}E(null,ae)}})},Xt.TinySDF=Kt;var at=function(){this.specification=m.styleSpec.light.position};at.prototype.possiblyEvaluate=function(l,f){return m.sphericalToCartesian(l.expression.evaluate(f))},at.prototype.interpolate=function(l,f,c){return{x:m.number(l.x,f.x,c),y:m.number(l.y,f.y,c),z:m.number(l.z,f.z,c)}};var qe=new m.Properties({anchor:new m.DataConstantProperty(m.styleSpec.light.anchor),position:new at,color:new m.DataConstantProperty(m.styleSpec.light.color),intensity:new m.DataConstantProperty(m.styleSpec.light.intensity)}),xt=function(l){function f(c){l.call(this),this._transitionable=new m.Transitionable(qe),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getLight=function(){return this._transitionable.serialize()},f.prototype.setLight=function(c,d){if(d===void 0&&(d={}),!this._validate(m.validateLight,c,d))for(var E in c){var w=c[E];m.endsWith(E,"-transition")?this._transitionable.setTransition(E.slice(0,-"-transition".length),w):this._transitionable.setValue(E,w)}},f.prototype.updateTransitions=function(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)},f.prototype.hasTransition=function(){return this._transitioning.hasTransition()},f.prototype.recalculate=function(c){this.properties=this._transitioning.possiblyEvaluate(c)},f.prototype._validate=function(c,d,E){return(!E||E.validate!==!1)&&m.emitValidationErrors(this,c.call(m.validateStyle,m.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:m.styleSpec})))},f}(m.Evented),$e=function(l,f){this.width=l,this.height=f,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};$e.prototype.getDash=function(l,f){var c=l.join(",")+String(f);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(l,f)),this.dashEntry[c]},$e.prototype.getDashRanges=function(l,f,c){var d=[],E=l.length%2==1?-l[l.length-1]*c:0,w=l[0]*c,P=!0;d.push({left:E,right:w,isDash:P,zeroLength:l[0]===0});for(var L=l[0],U=1;U<l.length;U++){var H=l[U];d.push({left:E=L*c,right:w=(L+=H)*c,isDash:P=!P,zeroLength:H===0})}return d},$e.prototype.addRoundDash=function(l,f,c){for(var d=f/2,E=-c;E<=c;E++)for(var w=this.width*(this.nextRow+c+E),P=0,L=l[P],U=0;U<this.width;U++){U/L.right>1&&(L=l[++P]);var H=Math.abs(U-L.left),ae=Math.abs(U-L.right),se=Math.min(H,ae),le=void 0,Oe=E/c*(d+1);if(L.isDash){var Pe=d-Math.abs(Oe);le=Math.sqrt(se*se+Pe*Pe)}else le=d-Math.sqrt(se*se+Oe*Oe);this.data[w+U]=Math.max(0,Math.min(255,le+128))}},$e.prototype.addRegularDash=function(l){for(var f=l.length-1;f>=0;--f){var c=l[f],d=l[f+1];c.zeroLength?l.splice(f,1):d&&d.isDash===c.isDash&&(d.left=c.left,l.splice(f,1))}var E=l[0],w=l[l.length-1];E.isDash===w.isDash&&(E.left=w.left-this.width,w.right=E.right+this.width);for(var P=this.width*this.nextRow,L=0,U=l[L],H=0;H<this.width;H++){H/U.right>1&&(U=l[++L]);var ae=Math.abs(H-U.left),se=Math.abs(H-U.right),le=Math.min(ae,se);this.data[P+H]=Math.max(0,Math.min(255,(U.isDash?le:-le)+128))}},$e.prototype.addDash=function(l,f){var c=f?7:0,d=2*c+1;if(this.nextRow+d>this.height)return m.warnOnce("LineAtlas out of space"),null;for(var E=0,w=0;w<l.length;w++)E+=l[w];if(E!==0){var P=this.width/E,L=this.getDashRanges(l,this.width,P);f?this.addRoundDash(L,P,c):this.addRegularDash(L)}var U={y:(this.nextRow+c+.5)/this.height,height:2*c/this.height,width:E};return this.nextRow+=d,this.dirty=!0,U},$e.prototype.bind=function(l){var f=l.gl;this.texture?(f.bindTexture(f.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,f.texSubImage2D(f.TEXTURE_2D,0,0,0,this.width,this.height,f.ALPHA,f.UNSIGNED_BYTE,this.data))):(this.texture=f.createTexture(),f.bindTexture(f.TEXTURE_2D,this.texture),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texImage2D(f.TEXTURE_2D,0,f.ALPHA,this.width,this.height,0,f.ALPHA,f.UNSIGNED_BYTE,this.data))};var Ht=function l(f,c){this.workerPool=f,this.actors=[],this.currentActor=0,this.id=m.uniqueId();for(var d=this.workerPool.acquire(this.id),E=0;E<d.length;E++){var w=new l.Actor(d[E],c,this.id);w.name="Worker "+E,this.actors.push(w)}};function vr(l,f,c){var d=function(E,w){if(E)return c(E);if(w){var P=m.pick(m.extend(w,l),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);w.vector_layers&&(P.vectorLayers=w.vector_layers,P.vectorLayerIds=P.vectorLayers.map(function(L){return L.id})),P.tiles=f.canonicalizeTileset(P,l.url),c(null,P)}};return l.url?m.getJSON(f.transformRequest(f.normalizeSourceURL(l.url),m.ResourceType.Source),d):m.browser.frame(function(){return d(null,l)})}Ht.prototype.broadcast=function(l,f,c){m.asyncAll(this.actors,function(d,E){d.send(l,f,E)},c=c||function(){})},Ht.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Ht.prototype.remove=function(){this.actors.forEach(function(l){l.remove()}),this.actors=[],this.workerPool.release(this.id)},Ht.Actor=m.Actor;var Fr=function(l,f,c){this.bounds=m.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=f||0,this.maxzoom=c||24};Fr.prototype.validateBounds=function(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]},Fr.prototype.contains=function(l){var f=Math.pow(2,l.z),c=Math.floor(m.mercatorXfromLng(this.bounds.getWest())*f),d=Math.floor(m.mercatorYfromLat(this.bounds.getNorth())*f),E=Math.ceil(m.mercatorXfromLng(this.bounds.getEast())*f),w=Math.ceil(m.mercatorYfromLat(this.bounds.getSouth())*f);return l.x>=c&&l.x<E&&l.y>=d&&l.y<w};var Yr=function(l){function f(c,d,E,w){if(l.call(this),this.id=c,this.dispatcher=E,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,m.extend(this,m.pick(d,["url","scheme","tileSize","promoteId"])),this._options=m.extend({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=vr(this._options,this.map._requestManager,function(d,E){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new m.ErrorEvent(d)):E&&(m.extend(c,E),E.bounds&&(c.tileBounds=new Fr(E.bounds,c.minzoom,c.maxzoom)),m.postTurnstileEvent(E.tiles,c.map._requestManager._customAccessToken),m.postMapLoadEvent(E.tiles,c.map._getMapId(),c.map._requestManager._skuToken,c.map._requestManager._customAccessToken),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setSourceProperty=function(c){this._tileJSONRequest&&this._tileJSONRequest.cancel(),c(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},f.prototype.setTiles=function(c){var d=this;return this.setSourceProperty(function(){d._options.tiles=c}),this},f.prototype.setUrl=function(c){var d=this;return this.setSourceProperty(function(){d.url=c,d._options.url=c}),this},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return m.extend({},this._options)},f.prototype.loadTile=function(c,d){var E=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),w={request:this.map._requestManager.transformRequest(E,m.ResourceType.Tile),uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:m.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function P(L,U){return delete c.request,c.aborted?d(null):L&&L.status!==404?d(L):(U&&U.resourceTiming&&(c.resourceTiming=U.resourceTiming),this.map._refreshExpiredTiles&&U&&c.setExpiryData(U),c.loadVectorData(U,this.map.painter),m.cacheEntryPossiblyAdded(this.dispatcher),d(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}w.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired"?c.state==="loading"?c.reloadCallback=d:c.request=c.actor.send("reloadTile",w,P.bind(this)):(c.actor=this.dispatcher.getActor(),c.request=c.actor.send("loadTile",w,P.bind(this)))},f.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id},void 0)},f.prototype.unloadTile=function(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id},void 0)},f.prototype.hasTransition=function(){return!1},f}(m.Evented),A=function(l){function f(c,d,E,w){l.call(this),this.id=c,this.dispatcher=E,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=m.extend({type:"raster"},d),m.extend(this,m.pick(d,["url","scheme","tileSize"]))}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=vr(this._options,this.map._requestManager,function(d,E){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new m.ErrorEvent(d)):E&&(m.extend(c,E),E.bounds&&(c.tileBounds=new Fr(E.bounds,c.minzoom,c.maxzoom)),m.postTurnstileEvent(E.tiles),m.postMapLoadEvent(E.tiles,c.map._getMapId(),c.map._requestManager._skuToken),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return m.extend({},this._options)},f.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},f.prototype.loadTile=function(c,d){var E=this,w=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);c.request=m.getImage(this.map._requestManager.transformRequest(w,m.ResourceType.Tile),function(P,L){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(P)c.state="errored",d(P);else if(L){E.map._refreshExpiredTiles&&c.setExpiryData(L),delete L.cacheControl,delete L.expires;var U=E.map.painter.context,H=U.gl;c.texture=E.map.painter.getTileTexture(L.width),c.texture?c.texture.update(L,{useMipmap:!0}):(c.texture=new m.Texture(U,L,H.RGBA,{useMipmap:!0}),c.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST),U.extTextureFilterAnisotropic&&H.texParameterf(H.TEXTURE_2D,U.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,U.extTextureFilterAnisotropicMax)),c.state="loaded",m.cacheEntryPossiblyAdded(E.dispatcher),d(null)}})},f.prototype.abortTile=function(c,d){c.request&&(c.request.cancel(),delete c.request),d()},f.prototype.unloadTile=function(c,d){c.texture&&this.map.painter.saveTileTexture(c.texture),d()},f.prototype.hasTransition=function(){return!1},f}(m.Evented),Se=function(l){function f(c,d,E,w){l.call(this,c,d,E,w),this.type="raster-dem",this.maxzoom=22,this._options=m.extend({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox"}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},f.prototype.loadTile=function(c,d){var E=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function w(P,L){P&&(c.state="errored",d(P)),L&&(c.dem=L,c.needsHillshadePrepare=!0,c.state="loaded",d(null))}c.request=m.getImage(this.map._requestManager.transformRequest(E,m.ResourceType.Tile),function(P,L){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(P)c.state="errored",d(P);else if(L){this.map._refreshExpiredTiles&&c.setExpiryData(L),delete L.cacheControl,delete L.expires;var U=m.window.ImageBitmap&&L instanceof m.window.ImageBitmap&&m.offscreenCanvasSupported()?L:m.browser.getImageData(L,1),H={uid:c.uid,coord:c.tileID,source:this.id,rawImageData:U,encoding:this.encoding};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",H,w.bind(this)))}}.bind(this)),c.neighboringTiles=this._getNeighboringTiles(c.tileID)},f.prototype._getNeighboringTiles=function(c){var d=c.canonical,E=Math.pow(2,d.z),w=(d.x-1+E)%E,P=d.x===0?c.wrap-1:c.wrap,L=(d.x+1+E)%E,U=d.x+1===E?c.wrap+1:c.wrap,H={};return H[new m.OverscaledTileID(c.overscaledZ,P,d.z,w,d.y).key]={backfilled:!1},H[new m.OverscaledTileID(c.overscaledZ,U,d.z,L,d.y).key]={backfilled:!1},d.y>0&&(H[new m.OverscaledTileID(c.overscaledZ,P,d.z,w,d.y-1).key]={backfilled:!1},H[new m.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},H[new m.OverscaledTileID(c.overscaledZ,U,d.z,L,d.y-1).key]={backfilled:!1}),d.y+1<E&&(H[new m.OverscaledTileID(c.overscaledZ,P,d.z,w,d.y+1).key]={backfilled:!1},H[new m.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},H[new m.OverscaledTileID(c.overscaledZ,U,d.z,L,d.y+1).key]={backfilled:!1}),H},f.prototype.unloadTile=function(c){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded",c.actor&&c.actor.send("removeDEMTile",{uid:c.uid,source:this.id})},f}(A),ke=function(l){function f(c,d,E,w){l.call(this),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=E.getActor(),this.setEventedParent(w),this._data=d.data,this._options=m.extend({},d),this._collectResourceTiming=d.collectResourceTiming,this._resourceTiming=[],d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;var P=m.EXTENT/this.tileSize;this.workerOptions=m.extend({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*P,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*P,extent:m.EXTENT,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?Math.min(d.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:m.EXTENT,radius:(d.clusterRadius||50)*P,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this.fire(new m.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(d){if(d)c.fire(new m.ErrorEvent(d));else{var E={dataType:"source",sourceDataType:"metadata"};c._collectResourceTiming&&c._resourceTiming&&c._resourceTiming.length>0&&(E.resourceTiming=c._resourceTiming,c._resourceTiming=[]),c.fire(new m.Event("data",E))}})},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setData=function(c){var d=this;return this._data=c,this.fire(new m.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(E){if(E)d.fire(new m.ErrorEvent(E));else{var w={dataType:"source",sourceDataType:"content"};d._collectResourceTiming&&d._resourceTiming&&d._resourceTiming.length>0&&(w.resourceTiming=d._resourceTiming,d._resourceTiming=[]),d.fire(new m.Event("data",w))}}),this},f.prototype.getClusterExpansionZoom=function(c,d){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id},d),this},f.prototype.getClusterChildren=function(c,d){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id},d),this},f.prototype.getClusterLeaves=function(c,d,E,w){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:c,limit:d,offset:E},w),this},f.prototype._updateWorkerData=function(c){var d=this;this._loaded=!1;var E=m.extend({},this.workerOptions),w=this._data;typeof w=="string"?(E.request=this.map._requestManager.transformRequest(m.browser.resolveURL(w),m.ResourceType.Source),E.request.collectResourceTiming=this._collectResourceTiming):E.data=JSON.stringify(w),this.actor.send(this.type+".loadData",E,function(P,L){d._removed||L&&L.abandoned||(d._loaded=!0,L&&L.resourceTiming&&L.resourceTiming[d.id]&&(d._resourceTiming=L.resourceTiming[d.id].slice(0)),d.actor.send(d.type+".coalesce",{source:E.source},null),c(P))})},f.prototype.loaded=function(){return this._loaded},f.prototype.loadTile=function(c,d){var E=this,w=c.actor?"reloadTile":"loadTile";c.actor=this.actor,c.request=this.actor.send(w,{type:this.type,uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:m.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(P,L){return delete c.request,c.unloadVectorData(),c.aborted?d(null):P?d(P):(c.loadVectorData(L,E.map.painter,w==="reloadTile"),d(null))})},f.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0},f.prototype.unloadTile=function(c){c.unloadVectorData(),this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})},f.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},f.prototype.serialize=function(){return m.extend({},this._options,{type:this.type,data:this._data})},f.prototype.hasTransition=function(){return!1},f}(m.Evented),ut=m.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),ft=function(l){function f(c,d,E,w){l.call(this),this.id=c,this.dispatcher=E,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(w),this.options=d}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(c,d){var E=this;this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this.url=this.options.url,m.getImage(this.map._requestManager.transformRequest(this.url,m.ResourceType.Image),function(w,P){E._loaded=!0,w?E.fire(new m.ErrorEvent(w)):P&&(E.image=P,c&&(E.coordinates=c),d&&d(),E._finishLoading())})},f.prototype.loaded=function(){return this._loaded},f.prototype.updateImage=function(c){var d=this;return this.image&&c.url?(this.options.url=c.url,this.load(c.coordinates,function(){d.texture=null}),this):this},f.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})))},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setCoordinates=function(c){var d=this;this.coordinates=c;var E=c.map(m.MercatorCoordinate.fromLngLat);this.tileID=function(P){for(var L=1/0,U=1/0,H=-1/0,ae=-1/0,se=0,le=P;se<le.length;se+=1){var Oe=le[se];L=Math.min(L,Oe.x),U=Math.min(U,Oe.y),H=Math.max(H,Oe.x),ae=Math.max(ae,Oe.y)}var Pe=Math.max(H-L,ae-U),Ne=Math.max(0,Math.floor(-Math.log(Pe)/Math.LN2)),xe=Math.pow(2,Ne);return new m.CanonicalTileID(Ne,Math.floor((L+H)/2*xe),Math.floor((U+ae)/2*xe))}(E),this.minzoom=this.maxzoom=this.tileID.z;var w=E.map(function(P){return d.tileID.getTilePoint(P)._round()});return this._boundsArray=new m.StructArrayLayout4i8,this._boundsArray.emplaceBack(w[0].x,w[0].y,0,0),this._boundsArray.emplaceBack(w[1].x,w[1].y,m.EXTENT,0),this._boundsArray.emplaceBack(w[3].x,w[3].y,0,m.EXTENT),this._boundsArray.emplaceBack(w[2].x,w[2].y,m.EXTENT,m.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})),this},f.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var c=this.map.painter.context,d=c.gl;for(var E in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,ut.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new m.Texture(c,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[E];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},f.prototype.loadTile=function(c,d){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},d(null)):(c.state="errored",d(null))},f.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return!1},f}(m.Evented),Rt=function(l){function f(c,d,E,w){l.call(this,c,d,E,w),this.roundZoom=!0,this.type="video",this.options=d}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1;var d=this.options;this.urls=[];for(var E=0,w=d.urls;E<w.length;E+=1)this.urls.push(this.map._requestManager.transformRequest(w[E],m.ResourceType.Source).url);m.getVideo(this.urls,function(P,L){c._loaded=!0,P?c.fire(new m.ErrorEvent(P)):L&&(c.video=L,c.video.loop=!0,c.video.addEventListener("playing",function(){c.map.triggerRepaint()}),c.map&&c.video.play(),c._finishLoading())})},f.prototype.pause=function(){this.video&&this.video.pause()},f.prototype.play=function(){this.video&&this.video.play()},f.prototype.seek=function(c){if(this.video){var d=this.video.seekable;c<d.start(0)||c>d.end(0)?this.fire(new m.ErrorEvent(new m.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+d.start(0)+" and "+d.end(0)+"-second mark."))):this.video.currentTime=c}},f.prototype.getVideo=function(){return this.video},f.prototype.onAdd=function(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},f.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var c=this.map.painter.context,d=c.gl;for(var E in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,ut.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new m.Texture(c,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[E];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this.video&&!this.video.paused},f}(ft),Dt=function(l){function f(c,d,E,w){l.call(this,c,d,E,w),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(function(P){return!Array.isArray(P)||P.length!==2||P.some(function(L){return typeof L!="number"})})||this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof m.window.HTMLCanvasElement||this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof m.window.HTMLCanvasElement?this.options.canvas:m.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new m.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},f.prototype.getCanvas=function(){return this.canvas},f.prototype.onAdd=function(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()},f.prototype.onRemove=function(){this.pause()},f.prototype.prepare=function(){var c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var d=this.map.painter.context,E=d.gl;for(var w in this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,ut.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new m.Texture(d,this.canvas,E.RGBA,{premultiply:!0}),this.tiles){var P=this.tiles[w];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this._playing},f.prototype._hasInvalidDimensions=function(){for(var c=0,d=[this.canvas.width,this.canvas.height];c<d.length;c+=1){var E=d[c];if(isNaN(E)||E<=0)return!0}return!1},f}(ft),gr={vector:Yr,raster:A,"raster-dem":Se,geojson:ke,video:Rt,image:ft,canvas:Dt};function Yn(l,f){var c=m.identity([]);return m.translate(c,c,[1,1,0]),m.scale(c,c,[.5*l.width,.5*l.height,1]),m.multiply(c,c,l.calculatePosMatrix(f.toUnwrapped()))}function Gr(l,f,c,d,E,w){var P=function(Ne,xe,je){if(Ne)for(var Ke=0,vt=Ne;Ke<vt.length;Ke+=1){var Wt=xe[vt[Ke]];if(Wt&&Wt.source===je&&Wt.type==="fill-extrusion")return!0}else for(var Zt in xe){var qt=xe[Zt];if(qt.source===je&&qt.type==="fill-extrusion")return!0}return!1}(E&&E.layers,f,l.id),L=w.maxPitchScaleFactor(),U=l.tilesIn(d,L,P);U.sort(Nn);for(var H=[],ae=0,se=U;ae<se.length;ae+=1){var le=se[ae];H.push({wrappedTileID:le.tileID.wrapped().key,queryResults:le.tile.queryRenderedFeatures(f,c,l._state,le.queryGeometry,le.cameraQueryGeometry,le.scale,E,w,L,Yn(l.transform,le.tileID))})}var Oe=function(Ne){for(var xe={},je={},Ke=0,vt=Ne;Ke<vt.length;Ke+=1){var Wt=vt[Ke],Zt=Wt.queryResults,qt=Wt.wrappedTileID,hr=je[qt]=je[qt]||{};for(var kr in Zt)for(var yr=Zt[kr],sn=hr[kr]=hr[kr]||{},Zn=xe[kr]=xe[kr]||[],jn=0,Ln=yr;jn<Ln.length;jn+=1){var Ri=Ln[jn];sn[Ri.featureIndex]||(sn[Ri.featureIndex]=!0,Zn.push(Ri))}}return xe}(H);for(var Pe in Oe)Oe[Pe].forEach(function(Ne){var xe=Ne.feature,je=l.getFeatureState(xe.layer["source-layer"],xe.id);xe.source=xe.layer.source,xe.layer["source-layer"]&&(xe.sourceLayer=xe.layer["source-layer"]),xe.state=je});return Oe}function Nn(l,f){var c=l.tileID,d=f.tileID;return c.overscaledZ-d.overscaledZ||c.canonical.y-d.canonical.y||c.wrap-d.wrap||c.canonical.x-d.canonical.x}var yn=function(l,f){this.max=l,this.onRemove=f,this.reset()};yn.prototype.reset=function(){for(var l in this.data)for(var f=0,c=this.data[l];f<c.length;f+=1){var d=c[f];d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value)}return this.data={},this.order=[],this},yn.prototype.add=function(l,f,c){var d=this,E=l.wrapped().key;this.data[E]===void 0&&(this.data[E]=[]);var w={value:f,timeout:void 0};if(c!==void 0&&(w.timeout=setTimeout(function(){d.remove(l,w)},c)),this.data[E].push(w),this.order.push(E),this.order.length>this.max){var P=this._getAndRemoveByKey(this.order[0]);P&&this.onRemove(P)}return this},yn.prototype.has=function(l){return l.wrapped().key in this.data},yn.prototype.getAndRemove=function(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null},yn.prototype._getAndRemoveByKey=function(l){var f=this.data[l].shift();return f.timeout&&clearTimeout(f.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),f.value},yn.prototype.getByKey=function(l){var f=this.data[l];return f?f[0].value:null},yn.prototype.get=function(l){return this.has(l)?this.data[l.wrapped().key][0].value:null},yn.prototype.remove=function(l,f){if(!this.has(l))return this;var c=l.wrapped().key,d=f===void 0?0:this.data[c].indexOf(f),E=this.data[c][d];return this.data[c].splice(d,1),E.timeout&&clearTimeout(E.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(E.value),this.order.splice(this.order.indexOf(c),1),this},yn.prototype.setMaxSize=function(l){for(this.max=l;this.order.length>this.max;){var f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this},yn.prototype.filter=function(l){var f=[];for(var c in this.data)for(var d=0,E=this.data[c];d<E.length;d+=1){var w=E[d];l(w.value)||f.push(w)}for(var P=0,L=f;P<L.length;P+=1){var U=L[P];this.remove(U.value.tileID,U)}};var zn=function(l,f,c){this.context=l;var d=l.gl;this.buffer=d.createBuffer(),this.dynamicDraw=Boolean(c),this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer};zn.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},zn.prototype.updateData=function(l){var f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)},zn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var si={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Gn=function(l,f,c,d){this.length=f.length,this.attributes=c,this.itemSize=f.bytesPerElement,this.dynamicDraw=d,this.context=l;var E=l.gl;this.buffer=E.createBuffer(),l.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer};Gn.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Gn.prototype.updateData=function(l){var f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,l.arrayBuffer)},Gn.prototype.enableAttributes=function(l,f){for(var c=0;c<this.attributes.length;c++){var d=f.attributes[this.attributes[c].name];d!==void 0&&l.enableVertexAttribArray(d)}},Gn.prototype.setVertexAttribPointers=function(l,f,c){for(var d=0;d<this.attributes.length;d++){var E=this.attributes[d],w=f.attributes[E.name];w!==void 0&&l.vertexAttribPointer(w,E.components,l[si[E.type]],!1,this.itemSize,E.offset+this.itemSize*(c||0))}},Gn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var fi=function(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};fi.prototype.get=function(){return this.current},fi.prototype.set=function(l){},fi.prototype.getDefault=function(){return this.default},fi.prototype.setDefault=function(){this.set(this.default)};var ta=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return m.Color.transparent},f.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},f}(fi),zi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 1},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)},f}(fi),Ii=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)},f}(fi),Ki=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return[!0,!0,!0,!0]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},f}(fi),ra=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)},f}(fi),Ya=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 255},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)},f}(fi),na=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},f.prototype.set=function(c){var d=this.current;(c.func!==d.func||c.ref!==d.ref||c.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)},f}(fi),ia=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)},f}(fi),ki=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=c,this.dirty=!1}},f}(fi),qi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return[0,1]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)},f}(fi),Gi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=c,this.dirty=!1}},f}(fi),Cs=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.LESS},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)},f}(fi),fe=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.BLEND):d.disable(d.BLEND),this.current=c,this.dirty=!1}},f}(fi),ui=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[c.ONE,c.ZERO]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)},f}(fi),bo=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return m.Color.transparent},f.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},f}(fi),su=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.FUNC_ADD},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)},f}(fi),Ut=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=c,this.dirty=!1}},f}(fi),er=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.BACK},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)},f}(fi),Rr=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.CCW},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)},f}(fi),an=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)},f}(fi),Tn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.TEXTURE0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)},f}(fi),Un=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},f}(fi),bi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,c),this.current=c,this.dirty=!1}},f}(fi),di=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},f}(fi),Sn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindTexture(d.TEXTURE_2D,c),this.current=c,this.dirty=!1}},f}(fi),Li=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}},f}(fi),Oi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){var d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1},f}(fi),io=function(l){function f(c){l.call(this,c),this.vao=c.extVertexArrayObject}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){this.vao&&(c!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(c),this.current=c,this.dirty=!1)},f}(fi),hs=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 4},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}},f}(fi),Uo=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}},f}(fi),Na=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}},f}(fi),xa=function(l){function f(c,d){l.call(this,c),this.context=c,this.parent=d}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f}(fi),V=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.setDirty=function(){this.dirty=!0},f.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}},f}(xa),$=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},f}(xa),te=function(l,f,c,d){this.context=l,this.width=f,this.height=c;var E=this.framebuffer=l.gl.createFramebuffer();this.colorAttachment=new V(l,E),d&&(this.depthAttachment=new $(l,E))};te.prototype.destroy=function(){var l=this.context.gl,f=this.colorAttachment.get();if(f&&l.deleteTexture(f),this.depthAttachment){var c=this.depthAttachment.get();c&&l.deleteRenderbuffer(c)}l.deleteFramebuffer(this.framebuffer)};var he=function(l,f,c){this.func=l,this.mask=f,this.range=c};he.ReadOnly=!1,he.ReadWrite=!0,he.disabled=new he(519,he.ReadOnly,[0,1]);var Me=function(l,f,c,d,E,w){this.test=l,this.ref=f,this.mask=c,this.fail=d,this.depthFail=E,this.pass=w};Me.disabled=new Me({func:519,mask:0},0,0,7680,7680,7680);var Ge=function(l,f,c){this.blendFunction=l,this.blendColor=f,this.mask=c};Ge.disabled=new Ge(Ge.Replace=[1,0],m.Color.transparent,[!1,!1,!1,!1]),Ge.unblended=new Ge(Ge.Replace,m.Color.transparent,[!0,!0,!0,!0]),Ge.alphaBlended=new Ge([1,771],m.Color.transparent,[!0,!0,!0,!0]);var Qe=function(l,f,c){this.enable=l,this.mode=f,this.frontFace=c};Qe.disabled=new Qe(!1,1029,2305),Qe.backCCW=new Qe(!0,1029,2305);var oe=function(l){this.gl=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new ta(this),this.clearDepth=new zi(this),this.clearStencil=new Ii(this),this.colorMask=new Ki(this),this.depthMask=new ra(this),this.stencilMask=new Ya(this),this.stencilFunc=new na(this),this.stencilOp=new ia(this),this.stencilTest=new ki(this),this.depthRange=new qi(this),this.depthTest=new Gi(this),this.depthFunc=new Cs(this),this.blend=new fe(this),this.blendFunc=new ui(this),this.blendColor=new bo(this),this.blendEquation=new su(this),this.cullFace=new Ut(this),this.cullFaceSide=new er(this),this.frontFace=new Rr(this),this.program=new an(this),this.activeTexture=new Tn(this),this.viewport=new Un(this),this.bindFramebuffer=new bi(this),this.bindRenderbuffer=new di(this),this.bindTexture=new Sn(this),this.bindVertexBuffer=new Li(this),this.bindElementBuffer=new Oi(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new io(this),this.pixelStoreUnpack=new hs(this),this.pixelStoreUnpackPremultiplyAlpha=new Uo(this),this.pixelStoreUnpackFlipY=new Na(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=l.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(l.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)};oe.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},oe.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},oe.prototype.createIndexBuffer=function(l,f){return new zn(this,l,f)},oe.prototype.createVertexBuffer=function(l,f,c){return new Gn(this,l,f,c)},oe.prototype.createRenderbuffer=function(l,f,c){var d=this.gl,E=d.createRenderbuffer();return this.bindRenderbuffer.set(E),d.renderbufferStorage(d.RENDERBUFFER,l,f,c),this.bindRenderbuffer.set(null),E},oe.prototype.createFramebuffer=function(l,f,c){return new te(this,l,f,c)},oe.prototype.clear=function(l){var f=l.color,c=l.depth,d=this.gl,E=0;f&&(E|=d.COLOR_BUFFER_BIT,this.clearColor.set(f),this.colorMask.set([!0,!0,!0,!0])),c!==void 0&&(E|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),d.clear(E)},oe.prototype.setCullFace=function(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))},oe.prototype.setDepthMode=function(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)},oe.prototype.setStencilMode=function(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)},oe.prototype.setColorMode=function(l){m.deepEqual(l.blendFunction,Ge.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)},oe.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Le=function(l){function f(c,d,E){var w=this;l.call(this),this.id=c,this.dispatcher=E,this.on("data",function(P){P.dataType==="source"&&P.sourceDataType==="metadata"&&(w._sourceLoaded=!0),w._sourceLoaded&&!w._paused&&P.dataType==="source"&&P.sourceDataType==="content"&&(w.reload(),w.transform&&w.update(w.transform))}),this.on("error",function(){w._sourceErrored=!0}),this._source=function(P,L,U,H){var ae=new gr[L.type](P,L,U,H);if(ae.id!==P)throw new Error("Expected Source id to be "+P+" instead of "+ae.id);return m.bindAll(["load","abort","unload","serialize","prepare"],ae),ae}(c,d,E,this),this._tiles={},this._cache=new yn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new m.SourceFeatureState}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.onAdd=function(c){this.map=c,this._maxTileCacheSize=c?c._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(c)},f.prototype.onRemove=function(c){this._source&&this._source.onRemove&&this._source.onRemove(c)},f.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var c in this._tiles){var d=this._tiles[c];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0},f.prototype.getSource=function(){return this._source},f.prototype.pause=function(){this._paused=!0},f.prototype.resume=function(){if(this._paused){var c=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,c&&this.reload(),this.transform&&this.update(this.transform)}},f.prototype._loadTile=function(c,d){return this._source.loadTile(c,d)},f.prototype._unloadTile=function(c){if(this._source.unloadTile)return this._source.unloadTile(c,function(){})},f.prototype._abortTile=function(c){if(this._source.abortTile)return this._source.abortTile(c,function(){})},f.prototype.serialize=function(){return this._source.serialize()},f.prototype.prepare=function(c){for(var d in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var E=this._tiles[d];E.upload(c),E.prepare(this.map.style.imageManager)}},f.prototype.getIds=function(){return m.values(this._tiles).map(function(c){return c.tileID}).sort(ht).map(function(c){return c.key})},f.prototype.getRenderableIds=function(c){var d=this,E=[];for(var w in this._tiles)this._isIdRenderable(w,c)&&E.push(this._tiles[w]);return c?E.sort(function(P,L){var U=P.tileID,H=L.tileID,ae=new m.Point(U.canonical.x,U.canonical.y)._rotate(d.transform.angle),se=new m.Point(H.canonical.x,H.canonical.y)._rotate(d.transform.angle);return U.overscaledZ-H.overscaledZ||se.y-ae.y||se.x-ae.x}).map(function(P){return P.tileID.key}):E.map(function(P){return P.tileID}).sort(ht).map(function(P){return P.key})},f.prototype.hasRenderableParent=function(c){var d=this.findLoadedParent(c,0);return!!d&&this._isIdRenderable(d.tileID.key)},f.prototype._isIdRenderable=function(c,d){return this._tiles[c]&&this._tiles[c].hasData()&&!this._coveredTiles[c]&&(d||!this._tiles[c].holdingForFade())},f.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var c in this._cache.reset(),this._tiles)this._tiles[c].state!=="errored"&&this._reloadTile(c,"reloading")},f.prototype._reloadTile=function(c,d){var E=this._tiles[c];E&&(E.state!=="loading"&&(E.state=d),this._loadTile(E,this._tileLoaded.bind(this,E,c,d)))},f.prototype._tileLoaded=function(c,d,E,w){if(w)return c.state="errored",void(w.status!==404?this._source.fire(new m.ErrorEvent(w,{tile:c})):this.update(this.transform));c.timeAdded=m.browser.now(),E==="expired"&&(c.refreshedUponExpiration=!0),this._setTileReloadTimer(d,c),this.getSource().type==="raster-dem"&&c.dem&&this._backfillDEM(c),this._state.initializeTileState(c,this.map?this.map.painter:null),this._source.fire(new m.Event("data",{dataType:"source",tile:c,coord:c.tileID}))},f.prototype._backfillDEM=function(c){for(var d=this.getRenderableIds(),E=0;E<d.length;E++){var w=d[E];if(c.neighboringTiles&&c.neighboringTiles[w]){var P=this.getTileByID(w);L(c,P),L(P,c)}}function L(U,H){U.needsHillshadePrepare=!0;var ae=H.tileID.canonical.x-U.tileID.canonical.x,se=H.tileID.canonical.y-U.tileID.canonical.y,le=Math.pow(2,U.tileID.canonical.z),Oe=H.tileID.key;ae===0&&se===0||Math.abs(se)>1||(Math.abs(ae)>1&&(Math.abs(ae+le)===1?ae+=le:Math.abs(ae-le)===1&&(ae-=le)),H.dem&&U.dem&&(U.dem.backfillBorder(H.dem,ae,se),U.neighboringTiles&&U.neighboringTiles[Oe]&&(U.neighboringTiles[Oe].backfilled=!0)))}},f.prototype.getTile=function(c){return this.getTileByID(c.key)},f.prototype.getTileByID=function(c){return this._tiles[c]},f.prototype._retainLoadedChildren=function(c,d,E,w){for(var P in this._tiles){var L=this._tiles[P];if(!(w[P]||!L.hasData()||L.tileID.overscaledZ<=d||L.tileID.overscaledZ>E)){for(var U=L.tileID;L&&L.tileID.overscaledZ>d+1;){var H=L.tileID.scaledTo(L.tileID.overscaledZ-1);(L=this._tiles[H.key])&&L.hasData()&&(U=H)}for(var ae=U;ae.overscaledZ>d;)if(c[(ae=ae.scaledTo(ae.overscaledZ-1)).key]){w[U.key]=U;break}}}},f.prototype.findLoadedParent=function(c,d){if(c.key in this._loadedParentTiles){var E=this._loadedParentTiles[c.key];return E&&E.tileID.overscaledZ>=d?E:null}for(var w=c.overscaledZ-1;w>=d;w--){var P=c.scaledTo(w),L=this._getLoadedTile(P);if(L)return L}},f.prototype._getLoadedTile=function(c){var d=this._tiles[c.key];return d&&d.hasData()?d:this._cache.getByKey(c.wrapped().key)},f.prototype.updateCacheSize=function(c){var d=Math.ceil(c.width/this._source.tileSize)+1,E=Math.ceil(c.height/this._source.tileSize)+1,w=Math.floor(d*E*5),P=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(P)},f.prototype.handleWrapJump=function(c){var d=Math.round((c-(this._prevLng===void 0?c:this._prevLng))/360);if(this._prevLng=c,d){var E={};for(var w in this._tiles){var P=this._tiles[w];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+d),E[P.tileID.key]=P}for(var L in this._tiles=E,this._timers)clearTimeout(this._timers[L]),delete this._timers[L];for(var U in this._tiles)this._setTileReloadTimer(U,this._tiles[U])}},f.prototype.update=function(c){var d=this;if(this.transform=c,this._sourceLoaded&&!this._paused){var E;this.updateCacheSize(c),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?E=c.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(hr){return new m.OverscaledTileID(hr.canonical.z,hr.wrap,hr.canonical.z,hr.canonical.x,hr.canonical.y)}):(E=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(E=E.filter(function(hr){return d._source.hasTile(hr)}))):E=[];var w=c.coveringZoomLevel(this._source),P=Math.max(w-f.maxOverzooming,this._source.minzoom),L=Math.max(w+f.maxUnderzooming,this._source.minzoom),U=this._updateRetainedTiles(E,w);if(fr(this._source.type)){for(var H={},ae={},se=0,le=Object.keys(U);se<le.length;se+=1){var Oe=le[se],Pe=U[Oe],Ne=this._tiles[Oe];if(Ne&&!(Ne.fadeEndTime&&Ne.fadeEndTime<=m.browser.now())){var xe=this.findLoadedParent(Pe,P);xe&&(this._addTile(xe.tileID),H[xe.tileID.key]=xe.tileID),ae[Oe]=Pe}}for(var je in this._retainLoadedChildren(ae,w,L,U),H)U[je]||(this._coveredTiles[je]=!0,U[je]=H[je])}for(var Ke in U)this._tiles[Ke].clearFadeHold();for(var vt=0,Wt=m.keysDifference(this._tiles,U);vt<Wt.length;vt+=1){var Zt=Wt[vt],qt=this._tiles[Zt];qt.hasSymbolBuckets&&!qt.holdingForFade()?qt.setHoldDuration(this.map._fadeDuration):qt.hasSymbolBuckets&&!qt.symbolFadeFinished()||this._removeTile(Zt)}this._updateLoadedParentTileCache()}},f.prototype.releaseSymbolFadeTiles=function(){for(var c in this._tiles)this._tiles[c].holdingForFade()&&this._removeTile(c)},f.prototype._updateRetainedTiles=function(c,d){for(var E={},w={},P=Math.max(d-f.maxOverzooming,this._source.minzoom),L=Math.max(d+f.maxUnderzooming,this._source.minzoom),U={},H=0,ae=c;H<ae.length;H+=1){var se=ae[H],le=this._addTile(se);E[se.key]=se,le.hasData()||d<this._source.maxzoom&&(U[se.key]=se)}this._retainLoadedChildren(U,d,L,E);for(var Oe=0,Pe=c;Oe<Pe.length;Oe+=1){var Ne=Pe[Oe],xe=this._tiles[Ne.key];if(!xe.hasData()){if(d+1>this._source.maxzoom){var je=Ne.children(this._source.maxzoom)[0],Ke=this.getTile(je);if(Ke&&Ke.hasData()){E[je.key]=je;continue}}else{var vt=Ne.children(this._source.maxzoom);if(E[vt[0].key]&&E[vt[1].key]&&E[vt[2].key]&&E[vt[3].key])continue}for(var Wt=xe.wasRequested(),Zt=Ne.overscaledZ-1;Zt>=P;--Zt){var qt=Ne.scaledTo(Zt);if(w[qt.key]||(w[qt.key]=!0,!(xe=this.getTile(qt))&&Wt&&(xe=this._addTile(qt)),xe&&(E[qt.key]=qt,Wt=xe.wasRequested(),xe.hasData())))break}}}return E},f.prototype._updateLoadedParentTileCache=function(){for(var c in this._loadedParentTiles={},this._tiles){for(var d=[],E=void 0,w=this._tiles[c].tileID;w.overscaledZ>0;){if(w.key in this._loadedParentTiles){E=this._loadedParentTiles[w.key];break}d.push(w.key);var P=w.scaledTo(w.overscaledZ-1);if(E=this._getLoadedTile(P))break;w=P}for(var L=0,U=d;L<U.length;L+=1)this._loadedParentTiles[U[L]]=E}},f.prototype._addTile=function(c){var d=this._tiles[c.key];if(d)return d;(d=this._cache.getAndRemove(c))&&(this._setTileReloadTimer(c.key,d),d.tileID=c,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[c.key]&&(clearTimeout(this._cacheTimers[c.key]),delete this._cacheTimers[c.key],this._setTileReloadTimer(c.key,d)));var E=Boolean(d);return E||(d=new m.Tile(c,this._source.tileSize*c.overscaleFactor()),this._loadTile(d,this._tileLoaded.bind(this,d,c.key,d.state))),d?(d.uses++,this._tiles[c.key]=d,E||this._source.fire(new m.Event("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d):null},f.prototype._setTileReloadTimer=function(c,d){var E=this;c in this._timers&&(clearTimeout(this._timers[c]),delete this._timers[c]);var w=d.getExpiryTimeout();w&&(this._timers[c]=setTimeout(function(){E._reloadTile(c,"expired"),delete E._timers[c]},w))},f.prototype._removeTile=function(c){var d=this._tiles[c];d&&(d.uses--,delete this._tiles[c],this._timers[c]&&(clearTimeout(this._timers[c]),delete this._timers[c]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))},f.prototype.clearTiles=function(){for(var c in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(c);this._cache.reset()},f.prototype.tilesIn=function(c,d,E){var w=this,P=[],L=this.transform;if(!L)return P;for(var U=E?L.getCameraQueryGeometry(c):c,H=c.map(function(Zt){return L.pointCoordinate(Zt)}),ae=U.map(function(Zt){return L.pointCoordinate(Zt)}),se=this.getIds(),le=1/0,Oe=1/0,Pe=-1/0,Ne=-1/0,xe=0,je=ae;xe<je.length;xe+=1){var Ke=je[xe];le=Math.min(le,Ke.x),Oe=Math.min(Oe,Ke.y),Pe=Math.max(Pe,Ke.x),Ne=Math.max(Ne,Ke.y)}for(var vt=function(Zt){var qt=w._tiles[se[Zt]];if(!qt.holdingForFade()){var hr=qt.tileID,kr=Math.pow(2,L.zoom-qt.tileID.overscaledZ),yr=d*qt.queryPadding*m.EXTENT/qt.tileSize/kr,sn=[hr.getTilePoint(new m.MercatorCoordinate(le,Oe)),hr.getTilePoint(new m.MercatorCoordinate(Pe,Ne))];if(sn[0].x-yr<m.EXTENT&&sn[0].y-yr<m.EXTENT&&sn[1].x+yr>=0&&sn[1].y+yr>=0){var Zn=H.map(function(Ln){return hr.getTilePoint(Ln)}),jn=ae.map(function(Ln){return hr.getTilePoint(Ln)});P.push({tile:qt,tileID:hr,queryGeometry:Zn,cameraQueryGeometry:jn,scale:kr})}}},Wt=0;Wt<se.length;Wt++)vt(Wt);return P},f.prototype.getVisibleCoordinates=function(c){for(var d=this,E=this.getRenderableIds(c).map(function(U){return d._tiles[U].tileID}),w=0,P=E;w<P.length;w+=1){var L=P[w];L.posMatrix=this.transform.calculatePosMatrix(L.toUnwrapped())}return E},f.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(fr(this._source.type))for(var c in this._tiles){var d=this._tiles[c];if(d.fadeEndTime!==void 0&&d.fadeEndTime>=m.browser.now())return!0}return!1},f.prototype.setFeatureState=function(c,d,E){this._state.updateState(c=c||"_geojsonTileLayer",d,E)},f.prototype.removeFeatureState=function(c,d,E){this._state.removeFeatureState(c=c||"_geojsonTileLayer",d,E)},f.prototype.getFeatureState=function(c,d){return this._state.getState(c=c||"_geojsonTileLayer",d)},f.prototype.setDependencies=function(c,d,E){var w=this._tiles[c];w&&w.setDependencies(d,E)},f.prototype.reloadTilesForDependencies=function(c,d){for(var E in this._tiles)this._tiles[E].hasDependency(c,d)&&this._reloadTile(E,"reloading");this._cache.filter(function(w){return!w.hasDependency(c,d)})},f}(m.Evented);function ht(l,f){var c=Math.abs(2*l.wrap)-+(l.wrap<0),d=Math.abs(2*f.wrap)-+(f.wrap<0);return l.overscaledZ-f.overscaledZ||d-c||f.canonical.y-l.canonical.y||f.canonical.x-l.canonical.x}function fr(l){return l==="raster"||l==="image"||l==="video"}function kt(){return new m.window.Worker(jl.workerUrl)}Le.maxOverzooming=10,Le.maxUnderzooming=3;var Ft="mapboxgl_preloaded_worker_pool",pr=function(){this.active={}};pr.prototype.acquire=function(l){if(!this.workers)for(this.workers=[];this.workers.length<pr.workerCount;)this.workers.push(new kt);return this.active[l]=!0,this.workers.slice()},pr.prototype.release=function(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(function(f){f.terminate()}),this.workers=null)},pr.prototype.isPreloaded=function(){return!!this.active[Ft]},pr.prototype.numActive=function(){return Object.keys(this.active).length};var _n,fn=Math.floor(m.browser.hardwareConcurrency/2);function Tt(){return _n||(_n=new pr),_n}function Jr(l,f){var c={};for(var d in l)d!=="ref"&&(c[d]=l[d]);return m.refProperties.forEach(function(E){E in f&&(c[E]=f[E])}),c}function Br(l){l=l.slice();for(var f=Object.create(null),c=0;c<l.length;c++)f[l[c].id]=l[c];for(var d=0;d<l.length;d++)"ref"in l[d]&&(l[d]=Jr(l[d],f[l[d].ref]));return l}pr.workerCount=Math.max(Math.min(fn,6),1);var Wr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function vi(l,f,c){c.push({command:Wr.addSource,args:[l,f[l]]})}function en(l,f,c){f.push({command:Wr.removeSource,args:[l]}),c[l]=!0}function gn(l,f,c,d){en(l,c,d),vi(l,f,c)}function Hi(l,f,c){var d;for(d in l[c])if(l[c].hasOwnProperty(d)&&d!=="data"&&!m.deepEqual(l[c][d],f[c][d]))return!1;for(d in f[c])if(f[c].hasOwnProperty(d)&&d!=="data"&&!m.deepEqual(l[c][d],f[c][d]))return!1;return!0}function pi(l,f,c,d,E,w){var P;for(P in f=f||{},l=l||{})l.hasOwnProperty(P)&&(m.deepEqual(l[P],f[P])||c.push({command:w,args:[d,P,f[P],E]}));for(P in f)f.hasOwnProperty(P)&&!l.hasOwnProperty(P)&&(m.deepEqual(l[P],f[P])||c.push({command:w,args:[d,P,f[P],E]}))}function wi(l){return l.id}function yi(l,f){return l[f.id]=f,l}var dt=function(l,f){this.reset(l,f)};dt.prototype.reset=function(l,f){this.points=l||[],this._distances=[0];for(var c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding},dt.prototype.lerp=function(l){if(this.points.length===1)return this.points[0];l=m.clamp(l,0,1);for(var f=1,c=this._distances[f],d=l*this.paddedLength+this.padding;c<d&&f<this._distances.length;)c=this._distances[++f];var E=f-1,w=this._distances[E],P=c-w,L=P>0?(d-w)/P:0;return this.points[E].mult(1-L).add(this.points[f].mult(L))};var Mt=function(l,f,c){var d=this.boxCells=[],E=this.circleCells=[];this.xCellCount=Math.ceil(l/c),this.yCellCount=Math.ceil(f/c);for(var w=0;w<this.xCellCount*this.yCellCount;w++)d.push([]),E.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=f,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0};function wa(l,f,c,d,E){var w=m.create();return f?(m.scale(w,w,[1/E,1/E,1]),c||m.rotateZ(w,w,d.angle)):m.multiply(w,d.labelPlaneMatrix,l),w}function Ei(l,f,c,d,E){if(f){var w=m.clone(l);return m.scale(w,w,[E,E,1]),c||m.rotateZ(w,w,-d.angle),w}return d.glCoordMatrix}function Ti(l,f){var c=[l.x,l.y,0,1];Ta(c,c,f);var d=c[3];return{point:new m.Point(c[0]/d,c[1]/d),signedDistanceFromCamera:d}}function Ui(l,f){return .5+l/f*.5}function Pr(l,f){var c=l[0]/l[3],d=l[1]/l[3];return c>=-f[0]&&c<=f[0]&&d>=-f[1]&&d<=f[1]}function on(l,f,c,d,E,w,P,L){var U=d?l.textSizeData:l.iconSizeData,H=m.evaluateSizeForZoom(U,c.transform.zoom),ae=[256/c.width*2+1,256/c.height*2+1],se=d?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;se.clear();for(var le=l.lineVertexArray,Oe=d?l.text.placedSymbolArray:l.icon.placedSymbolArray,Pe=c.transform.width/c.transform.height,Ne=!1,xe=0;xe<Oe.length;xe++){var je=Oe.get(xe);if(je.hidden||je.writingMode===m.WritingMode.vertical&&!Ne)za(je.numGlyphs,se);else{Ne=!1;var Ke=[je.anchorX,je.anchorY,0,1];if(m.transformMat4(Ke,Ke,f),Pr(Ke,ae)){var vt=Ui(c.transform.cameraToCenterDistance,Ke[3]),Wt=m.evaluateSizeForFeature(U,H,je),Zt=P?Wt/vt:Wt*vt,qt=new m.Point(je.anchorX,je.anchorY),hr=Ti(qt,E).point,kr={},yr=ue(je,Zt,!1,L,f,E,w,l.glyphOffsetArray,le,se,hr,qt,kr,Pe);Ne=yr.useVertical,(yr.notEnoughRoom||Ne||yr.needsFlipping&&ue(je,Zt,!0,L,f,E,w,l.glyphOffsetArray,le,se,hr,qt,kr,Pe).notEnoughRoom)&&za(je.numGlyphs,se)}else za(je.numGlyphs,se)}}d?l.text.dynamicLayoutVertexBuffer.updateData(se):l.icon.dynamicLayoutVertexBuffer.updateData(se)}function gt(l,f,c,d,E,w,P,L,U,H,ae){var se=L.glyphStartIndex+L.numGlyphs,le=L.lineStartIndex,Oe=L.lineStartIndex+L.lineLength,Pe=f.getoffsetX(L.glyphStartIndex),Ne=f.getoffsetX(se-1),xe=ea(l*Pe,c,d,E,w,P,L.segment,le,Oe,U,H,ae);if(!xe)return null;var je=ea(l*Ne,c,d,E,w,P,L.segment,le,Oe,U,H,ae);return je?{first:xe,last:je}:null}function aa(l,f,c,d){return l===m.WritingMode.horizontal&&Math.abs(c.y-f.y)>Math.abs(c.x-f.x)*d?{useVertical:!0}:(l===m.WritingMode.vertical?f.y<c.y:f.x>c.x)?{needsFlipping:!0}:null}function ue(l,f,c,d,E,w,P,L,U,H,ae,se,le,Oe){var Pe,Ne=f/24,xe=l.lineOffsetX*Ne,je=l.lineOffsetY*Ne;if(l.numGlyphs>1){var Ke=l.glyphStartIndex+l.numGlyphs,vt=l.lineStartIndex,Wt=l.lineStartIndex+l.lineLength,Zt=gt(Ne,L,xe,je,c,ae,se,l,U,w,le);if(!Zt)return{notEnoughRoom:!0};var qt=Ti(Zt.first.point,P).point,hr=Ti(Zt.last.point,P).point;if(d&&!c){var kr=aa(l.writingMode,qt,hr,Oe);if(kr)return kr}Pe=[Zt.first];for(var yr=l.glyphStartIndex+1;yr<Ke-1;yr++)Pe.push(ea(Ne*L.getoffsetX(yr),xe,je,c,ae,se,l.segment,vt,Wt,U,w,le));Pe.push(Zt.last)}else{if(d&&!c){var sn=Ti(se,E).point,Zn=l.lineStartIndex+l.segment+1,jn=new m.Point(U.getx(Zn),U.gety(Zn)),Ln=Ti(jn,E),Ri=Ln.signedDistanceFromCamera>0?Ln.point:qo(se,jn,sn,1,E),tn=aa(l.writingMode,sn,Ri,Oe);if(tn)return tn}var ni=ea(Ne*L.getoffsetX(l.glyphStartIndex),xe,je,c,ae,se,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,U,w,le);if(!ni)return{notEnoughRoom:!0};Pe=[ni]}for(var li=0,Kn=Pe;li<Kn.length;li+=1){var Hn=Kn[li];m.addDynamicAttributes(H,Hn.point,Hn.angle)}return{}}function qo(l,f,c,d,E){var w=Ti(l.add(l.sub(f)._unit()),E).point,P=c.sub(w);return c.add(P._mult(d/P.mag()))}function ea(l,f,c,d,E,w,P,L,U,H,ae,se){var le=d?l-f:l+f,Oe=le>0?1:-1,Pe=0;d&&(Oe*=-1,Pe=Math.PI),Oe<0&&(Pe+=Math.PI);for(var Ne=Oe>0?L+P:L+P+1,xe=E,je=E,Ke=0,vt=0,Wt=Math.abs(le),Zt=[];Ke+vt<=Wt;){if((Ne+=Oe)<L||Ne>=U)return null;if(je=xe,Zt.push(xe),(xe=se[Ne])===void 0){var qt=new m.Point(H.getx(Ne),H.gety(Ne)),hr=Ti(qt,ae);if(hr.signedDistanceFromCamera>0)xe=se[Ne]=hr.point;else{var kr=Ne-Oe;xe=qo(Ke===0?w:new m.Point(H.getx(kr),H.gety(kr)),qt,je,Wt-Ke+1,ae)}}Ke+=vt,vt=je.dist(xe)}var yr=(Wt-Ke)/vt,sn=xe.sub(je),Zn=sn.mult(yr)._add(je);Zn._add(sn._unit()._perp()._mult(c*Oe));var jn=Pe+Math.atan2(xe.y-je.y,xe.x-je.x);return Zt.push(Zn),{point:Zn,angle:jn,path:Zt}}Mt.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Mt.prototype.insert=function(l,f,c,d,E){this._forEachCell(f,c,d,E,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(f),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(E)},Mt.prototype.insertCircle=function(l,f,c,d){this._forEachCell(f-d,c-d,f+d,c+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(f),this.circles.push(c),this.circles.push(d)},Mt.prototype._insertBoxCell=function(l,f,c,d,E,w){this.boxCells[E].push(w)},Mt.prototype._insertCircleCell=function(l,f,c,d,E,w){this.circleCells[E].push(w)},Mt.prototype._query=function(l,f,c,d,E,w){if(c<0||l>this.width||d<0||f>this.height)return!E&&[];var P=[];if(l<=0&&f<=0&&this.width<=c&&this.height<=d){if(E)return!0;for(var L=0;L<this.boxKeys.length;L++)P.push({key:this.boxKeys[L],x1:this.bboxes[4*L],y1:this.bboxes[4*L+1],x2:this.bboxes[4*L+2],y2:this.bboxes[4*L+3]});for(var U=0;U<this.circleKeys.length;U++){var H=this.circles[3*U],ae=this.circles[3*U+1],se=this.circles[3*U+2];P.push({key:this.circleKeys[U],x1:H-se,y1:ae-se,x2:H+se,y2:ae+se})}return w?P.filter(w):P}return this._forEachCell(l,f,c,d,this._queryCell,P,{hitTest:E,seenUids:{box:{},circle:{}}},w),E?P.length>0:P},Mt.prototype._queryCircle=function(l,f,c,d,E){var w=l-c,P=l+c,L=f-c,U=f+c;if(P<0||w>this.width||U<0||L>this.height)return!d&&[];var H=[];return this._forEachCell(w,L,P,U,this._queryCellCircle,H,{hitTest:d,circle:{x:l,y:f,radius:c},seenUids:{box:{},circle:{}}},E),d?H.length>0:H},Mt.prototype.query=function(l,f,c,d,E){return this._query(l,f,c,d,!1,E)},Mt.prototype.hitTest=function(l,f,c,d,E){return this._query(l,f,c,d,!0,E)},Mt.prototype.hitTestCircle=function(l,f,c,d){return this._queryCircle(l,f,c,!0,d)},Mt.prototype._queryCell=function(l,f,c,d,E,w,P,L){var U=P.seenUids,H=this.boxCells[E];if(H!==null)for(var ae=this.bboxes,se=0,le=H;se<le.length;se+=1){var Oe=le[se];if(!U.box[Oe]){U.box[Oe]=!0;var Pe=4*Oe;if(l<=ae[Pe+2]&&f<=ae[Pe+3]&&c>=ae[Pe+0]&&d>=ae[Pe+1]&&(!L||L(this.boxKeys[Oe]))){if(P.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[Oe],x1:ae[Pe],y1:ae[Pe+1],x2:ae[Pe+2],y2:ae[Pe+3]})}}}var Ne=this.circleCells[E];if(Ne!==null)for(var xe=this.circles,je=0,Ke=Ne;je<Ke.length;je+=1){var vt=Ke[je];if(!U.circle[vt]){U.circle[vt]=!0;var Wt=3*vt;if(this._circleAndRectCollide(xe[Wt],xe[Wt+1],xe[Wt+2],l,f,c,d)&&(!L||L(this.circleKeys[vt]))){if(P.hitTest)return w.push(!0),!0;var Zt=xe[Wt],qt=xe[Wt+1],hr=xe[Wt+2];w.push({key:this.circleKeys[vt],x1:Zt-hr,y1:qt-hr,x2:Zt+hr,y2:qt+hr})}}}},Mt.prototype._queryCellCircle=function(l,f,c,d,E,w,P,L){var U=P.circle,H=P.seenUids,ae=this.boxCells[E];if(ae!==null)for(var se=this.bboxes,le=0,Oe=ae;le<Oe.length;le+=1){var Pe=Oe[le];if(!H.box[Pe]){H.box[Pe]=!0;var Ne=4*Pe;if(this._circleAndRectCollide(U.x,U.y,U.radius,se[Ne+0],se[Ne+1],se[Ne+2],se[Ne+3])&&(!L||L(this.boxKeys[Pe])))return w.push(!0),!0}}var xe=this.circleCells[E];if(xe!==null)for(var je=this.circles,Ke=0,vt=xe;Ke<vt.length;Ke+=1){var Wt=vt[Ke];if(!H.circle[Wt]){H.circle[Wt]=!0;var Zt=3*Wt;if(this._circlesCollide(je[Zt],je[Zt+1],je[Zt+2],U.x,U.y,U.radius)&&(!L||L(this.circleKeys[Wt])))return w.push(!0),!0}}},Mt.prototype._forEachCell=function(l,f,c,d,E,w,P,L){for(var U=this._convertToXCellCoord(l),H=this._convertToYCellCoord(f),ae=this._convertToXCellCoord(c),se=this._convertToYCellCoord(d),le=U;le<=ae;le++)for(var Oe=H;Oe<=se;Oe++)if(E.call(this,l,f,c,d,this.xCellCount*Oe+le,w,P,L))return},Mt.prototype._convertToXCellCoord=function(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))},Mt.prototype._convertToYCellCoord=function(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))},Mt.prototype._circlesCollide=function(l,f,c,d,E,w){var P=d-l,L=E-f,U=c+w;return U*U>P*P+L*L},Mt.prototype._circleAndRectCollide=function(l,f,c,d,E,w,P){var L=(w-d)/2,U=Math.abs(l-(d+L));if(U>L+c)return!1;var H=(P-E)/2,ae=Math.abs(f-(E+H));if(ae>H+c)return!1;if(U<=L||ae<=H)return!0;var se=U-L,le=ae-H;return se*se+le*le<=c*c};var _u=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function za(l,f){for(var c=0;c<l;c++){var d=f.length;f.resize(d+4),f.float32.set(_u,3*d)}}function Ta(l,f,c){var d=f[0],E=f[1];return l[0]=c[0]*d+c[4]*E+c[12],l[1]=c[1]*d+c[5]*E+c[13],l[3]=c[3]*d+c[7]*E+c[15],l}var qa=function(l,f,c){f===void 0&&(f=new Mt(l.width+200,l.height+200,25)),c===void 0&&(c=new Mt(l.width+200,l.height+200,25)),this.transform=l,this.grid=f,this.ignoredGrid=c,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+100,this.screenBottomBoundary=l.height+100,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200};function oa(l,f,c){return f*(m.EXTENT/(l.tileSize*Math.pow(2,c-l.tileID.overscaledZ)))}qa.prototype.placeCollisionBox=function(l,f,c,d,E){var w=this.projectAndGetPerspectiveRatio(d,l.anchorPointX,l.anchorPointY),P=c*w.perspectiveRatio,L=l.x1*P+w.point.x,U=l.y1*P+w.point.y,H=l.x2*P+w.point.x,ae=l.y2*P+w.point.y;return!this.isInsideGrid(L,U,H,ae)||!f&&this.grid.hitTest(L,U,H,ae,E)?{box:[],offscreen:!1}:{box:[L,U,H,ae],offscreen:this.isOffscreen(L,U,H,ae)}},qa.prototype.placeCollisionCircles=function(l,f,c,d,E,w,P,L,U,H,ae,se,le){var Oe=[],Pe=new m.Point(f.anchorX,f.anchorY),Ne=Ti(Pe,w),xe=Ui(this.transform.cameraToCenterDistance,Ne.signedDistanceFromCamera),je=(H?E/xe:E*xe)/m.ONE_EM,Ke=Ti(Pe,P).point,vt=gt(je,d,f.lineOffsetX*je,f.lineOffsetY*je,!1,Ke,Pe,f,c,P,{}),Wt=!1,Zt=!1,qt=!0;if(vt){for(var hr=.5*se*xe+le,kr=new m.Point(-100,-100),yr=new m.Point(this.screenRightBoundary,this.screenBottomBoundary),sn=new dt,Zn=vt.first,jn=vt.last,Ln=[],Ri=Zn.path.length-1;Ri>=1;Ri--)Ln.push(Zn.path[Ri]);for(var tn=1;tn<jn.path.length;tn++)Ln.push(jn.path[tn]);var ni=2.5*hr;if(L){var li=Ln.map(function(Os){return Ti(Os,L)});Ln=li.some(function(Os){return Os.signedDistanceFromCamera<=0})?[]:li.map(function(Os){return Os.point})}var Kn=[];if(Ln.length>0){for(var Hn=Ln[0].clone(),hi=Ln[0].clone(),qn=1;qn<Ln.length;qn++)Hn.x=Math.min(Hn.x,Ln[qn].x),Hn.y=Math.min(Hn.y,Ln[qn].y),hi.x=Math.max(hi.x,Ln[qn].x),hi.y=Math.max(hi.y,Ln[qn].y);Kn=Hn.x>=kr.x&&hi.x<=yr.x&&Hn.y>=kr.y&&hi.y<=yr.y?[Ln]:hi.x<kr.x||Hn.x>yr.x||hi.y<kr.y||Hn.y>yr.y?[]:m.clipLine([Ln],kr.x,kr.y,yr.x,yr.y)}for(var Xn=0,go=Kn;Xn<go.length;Xn+=1){var Qa;sn.reset(go[Xn],.25*hr),Qa=sn.length<=.5*hr?1:Math.ceil(sn.paddedLength/ni)+1;for(var To=0;To<Qa;To++){var Da=To/Math.max(Qa-1,1),Ga=sn.lerp(Da),fo=Ga.x+100,Is=Ga.y+100;Oe.push(fo,Is,hr,0);var is=fo-hr,Du=Is-hr,as=fo+hr,mu=Is+hr;if(qt=qt&&this.isOffscreen(is,Du,as,mu),Zt=Zt||this.isInsideGrid(is,Du,as,mu),!l&&this.grid.hitTestCircle(fo,Is,hr,ae)&&(Wt=!0,!U))return{circles:[],offscreen:!1,collisionDetected:Wt}}}}return{circles:!U&&Wt||!Zt?[]:Oe,offscreen:qt,collisionDetected:Wt}},qa.prototype.queryRenderedSymbols=function(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var f=[],c=1/0,d=1/0,E=-1/0,w=-1/0,P=0,L=l;P<L.length;P+=1){var U=L[P],H=new m.Point(U.x+100,U.y+100);c=Math.min(c,H.x),d=Math.min(d,H.y),E=Math.max(E,H.x),w=Math.max(w,H.y),f.push(H)}for(var ae={},se={},le=0,Oe=this.grid.query(c,d,E,w).concat(this.ignoredGrid.query(c,d,E,w));le<Oe.length;le+=1){var Pe=Oe[le],Ne=Pe.key;if(ae[Ne.bucketInstanceId]===void 0&&(ae[Ne.bucketInstanceId]={}),!ae[Ne.bucketInstanceId][Ne.featureIndex]){var xe=[new m.Point(Pe.x1,Pe.y1),new m.Point(Pe.x2,Pe.y1),new m.Point(Pe.x2,Pe.y2),new m.Point(Pe.x1,Pe.y2)];m.polygonIntersectsPolygon(f,xe)&&(ae[Ne.bucketInstanceId][Ne.featureIndex]=!0,se[Ne.bucketInstanceId]===void 0&&(se[Ne.bucketInstanceId]=[]),se[Ne.bucketInstanceId].push(Ne.featureIndex))}}return se},qa.prototype.insertCollisionBox=function(l,f,c,d,E){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:d,collisionGroupID:E},l[0],l[1],l[2],l[3])},qa.prototype.insertCollisionCircles=function(l,f,c,d,E){for(var w=f?this.ignoredGrid:this.grid,P={bucketInstanceId:c,featureIndex:d,collisionGroupID:E},L=0;L<l.length;L+=4)w.insertCircle(P,l[L],l[L+1],l[L+2])},qa.prototype.projectAndGetPerspectiveRatio=function(l,f,c){var d=[f,c,0,1];return Ta(d,d,l),{point:new m.Point((d[0]/d[3]+1)/2*this.transform.width+100,(-d[1]/d[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/d[3]*.5}},qa.prototype.isOffscreen=function(l,f,c,d){return c<100||l>=this.screenRightBoundary||d<100||f>this.screenBottomBoundary},qa.prototype.isInsideGrid=function(l,f,c,d){return c>=0&&l<this.gridRightBoundary&&d>=0&&f<this.gridBottomBoundary},qa.prototype.getViewportMatrix=function(){var l=m.identity([]);return m.translate(l,l,[-100,-100,0]),l};var Ao=function(l,f,c,d){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?f:-f))):d&&c?1:0,this.placed=c};Ao.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Zo=function(l,f,c,d,E){this.text=new Ao(l?l.text:null,f,c,E),this.icon=new Ao(l?l.icon:null,f,d,E)};Zo.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Cu=function(l,f,c){this.text=l,this.icon=f,this.skipFade=c},ho=function(){this.invProjMatrix=m.create(),this.viewportMatrix=m.create(),this.circles=[]},Lo=function(l,f,c,d,E){this.bucketInstanceId=l,this.featureIndex=f,this.sourceLayerIndex=c,this.bucketIndex=d,this.tileID=E},sa=function(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}};function Ka(l,f,c,d,E){var w=m.getAnchorAlignment(l),P=-(w.horizontalAlign-.5)*f,L=-(w.verticalAlign-.5)*c,U=m.evaluateVariableOffset(l,d);return new m.Point(P+U[0]*E,L+U[1]*E)}function Do(l,f,c,d,E,w){var P=l.x1,L=l.x2,U=l.y1,H=l.y2,ae=l.anchorPointX,se=l.anchorPointY,le=new m.Point(f,c);return d&&le._rotate(E?w:-w),{x1:P+le.x,y1:U+le.y,x2:L+le.x,y2:H+le.y,anchorPointX:ae,anchorPointY:se}}sa.prototype.get=function(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){var f=++this.maxGroupID;this.collisionGroups[l]={ID:f,predicate:function(c){return c.collisionGroupID===f}}}return this.collisionGroups[l]};var $a=function(l,f,c,d){this.transform=l.clone(),this.collisionIndex=new qa(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new sa(c),this.collisionCircleArrays={},this.prevPlacement=d,d&&(d.prevPlacement=void 0),this.placedOrientations={}};function As(l,f,c,d,E){l.emplaceBack(f?1:0,c?1:0,d||0,E||0),l.emplaceBack(f?1:0,c?1:0,d||0,E||0),l.emplaceBack(f?1:0,c?1:0,d||0,E||0),l.emplaceBack(f?1:0,c?1:0,d||0,E||0)}$a.prototype.getBucketParts=function(l,f,c,d){var E=c.getBucket(f),w=c.latestFeatureIndex;if(E&&w&&f.id===E.layerIds[0]){var P=c.collisionBoxArray,L=E.layers[0].layout,U=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),H=c.tileSize/m.EXTENT,ae=this.transform.calculatePosMatrix(c.tileID.toUnwrapped()),se=L.get("text-pitch-alignment")==="map",le=L.get("text-rotation-alignment")==="map",Oe=oa(c,1,this.transform.zoom),Pe=wa(ae,se,le,this.transform,Oe),Ne=null;if(se){var xe=Ei(ae,se,le,this.transform,Oe);Ne=m.multiply([],this.transform.labelPlaneMatrix,xe)}this.retainedQueryData[E.bucketInstanceId]=new Lo(E.bucketInstanceId,w,E.sourceLayerIndex,E.index,c.tileID);var je={bucket:E,layout:L,posMatrix:ae,textLabelPlaneMatrix:Pe,labelToScreenMatrix:Ne,scale:U,textPixelRatio:H,holdingForFade:c.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:m.evaluateSizeForZoom(E.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(E.sourceID)};if(d)for(var Ke=0,vt=E.sortKeyRanges;Ke<vt.length;Ke+=1){var Wt=vt[Ke];l.push({sortKey:Wt.sortKey,symbolInstanceStart:Wt.symbolInstanceStart,symbolInstanceEnd:Wt.symbolInstanceEnd,parameters:je})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:je})}},$a.prototype.attemptAnchorPlacement=function(l,f,c,d,E,w,P,L,U,H,ae,se,le,Oe,Pe){var Ne,xe=[se.textOffset0,se.textOffset1],je=Ka(l,c,d,xe,E),Ke=this.collisionIndex.placeCollisionBox(Do(f,je.x,je.y,w,P,this.transform.angle),ae,L,U,H.predicate);if(!Pe||this.collisionIndex.placeCollisionBox(Do(Pe,je.x,je.y,w,P,this.transform.angle),ae,L,U,H.predicate).box.length!==0)return Ke.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[se.crossTileID]&&this.prevPlacement.placements[se.crossTileID]&&this.prevPlacement.placements[se.crossTileID].text&&(Ne=this.prevPlacement.variableOffsets[se.crossTileID].anchor),this.variableOffsets[se.crossTileID]={textOffset:xe,width:c,height:d,anchor:l,textBoxScale:E,prevAnchor:Ne},this.markUsedJustification(le,l,se,Oe),le.allowVerticalPlacement&&(this.markUsedOrientation(le,Oe,se),this.placedOrientations[se.crossTileID]=Oe),{shift:je,placedGlyphBoxes:Ke}):void 0},$a.prototype.placeLayerBucketPart=function(l,f,c){var d=this,E=l.parameters,w=E.bucket,P=E.layout,L=E.posMatrix,U=E.textLabelPlaneMatrix,H=E.labelToScreenMatrix,ae=E.textPixelRatio,se=E.holdingForFade,le=E.collisionBoxArray,Oe=E.partiallyEvaluatedTextSize,Pe=E.collisionGroup,Ne=P.get("text-optional"),xe=P.get("icon-optional"),je=P.get("text-allow-overlap"),Ke=P.get("icon-allow-overlap"),vt=P.get("text-rotation-alignment")==="map",Wt=P.get("text-pitch-alignment")==="map",Zt=P.get("icon-text-fit")!=="none",qt=P.get("symbol-z-order")==="viewport-y",hr=je&&(Ke||!w.hasIconData()||xe),kr=Ke&&(je||!w.hasTextData()||Ne);!w.collisionArrays&&le&&w.deserializeCollisionBoxes(le);var yr=function(tn,ni){if(!f[tn.crossTileID])if(se)d.placements[tn.crossTileID]=new Cu(!1,!1,!1);else{var li,Kn=!1,Hn=!1,hi=!0,qn=null,Xn={box:null,offscreen:null},go={box:null,offscreen:null},Qa=null,To=null,Da=0,Ga=0,fo=0;ni.textFeatureIndex?Da=ni.textFeatureIndex:tn.useRuntimeCollisionCircles&&(Da=tn.featureIndex),ni.verticalTextFeatureIndex&&(Ga=ni.verticalTextFeatureIndex);var Is=ni.textBox;if(Is){var is=function(ua){var Ns=m.WritingMode.horizontal;if(w.allowVerticalPlacement&&!ua&&d.prevPlacement){var Qo=d.prevPlacement.placedOrientations[tn.crossTileID];Qo&&(d.placedOrientations[tn.crossTileID]=Qo,d.markUsedOrientation(w,Ns=Qo,tn))}return Ns},Du=function(ua,Ns){if(w.allowVerticalPlacement&&tn.numVerticalGlyphVertices>0&&ni.verticalTextBox)for(var Qo=0,gu=w.writingModes;Qo<gu.length&&(gu[Qo]===m.WritingMode.vertical?(Xn=Ns(),go=Xn):Xn=ua(),!(Xn&&Xn.box&&Xn.box.length));Qo+=1);else Xn=ua()};if(P.get("text-variable-anchor")){var as=P.get("text-variable-anchor");if(d.prevPlacement&&d.prevPlacement.variableOffsets[tn.crossTileID]){var mu=d.prevPlacement.variableOffsets[tn.crossTileID];as.indexOf(mu.anchor)>0&&(as=as.filter(function(ua){return ua!==mu.anchor})).unshift(mu.anchor)}var Os=function(ua,Ns,Qo){for(var gu=ua.x2-ua.x1,Hc=ua.y2-ua.y1,Wc=tn.textBoxScale,Af=Zt&&!Ke?Ns:null,ru={box:[],offscreen:!1},hc=je?2*as.length:as.length,nu=0;nu<hc;++nu){var _l=d.attemptAnchorPlacement(as[nu%as.length],ua,gu,Hc,Wc,vt,Wt,ae,L,Pe,nu>=as.length,tn,w,Qo,Af);if(_l&&(ru=_l.placedGlyphBoxes)&&ru.box&&ru.box.length){Kn=!0,qn=_l.shift;break}}return ru};Du(function(){return Os(Is,ni.iconBox,m.WritingMode.horizontal)},function(){var ua=ni.verticalTextBox;return w.allowVerticalPlacement&&!(Xn&&Xn.box&&Xn.box.length)&&tn.numVerticalGlyphVertices>0&&ua?Os(ua,ni.verticalIconBox,m.WritingMode.vertical):{box:null,offscreen:null}}),Xn&&(Kn=Xn.box,hi=Xn.offscreen);var Es=is(Xn&&Xn.box);if(!Kn&&d.prevPlacement){var Vl=d.prevPlacement.variableOffsets[tn.crossTileID];Vl&&(d.variableOffsets[tn.crossTileID]=Vl,d.markUsedJustification(w,Vl.anchor,tn,Es))}}else{var Fu=function(ua,Ns){var Qo=d.collisionIndex.placeCollisionBox(ua,je,ae,L,Pe.predicate);return Qo&&Qo.box&&Qo.box.length&&(d.markUsedOrientation(w,Ns,tn),d.placedOrientations[tn.crossTileID]=Ns),Qo};Du(function(){return Fu(Is,m.WritingMode.horizontal)},function(){var ua=ni.verticalTextBox;return w.allowVerticalPlacement&&tn.numVerticalGlyphVertices>0&&ua?Fu(ua,m.WritingMode.vertical):{box:null,offscreen:null}}),is(Xn&&Xn.box&&Xn.box.length)}}if(Kn=(li=Xn)&&li.box&&li.box.length>0,hi=li&&li.offscreen,tn.useRuntimeCollisionCircles){var gl=w.text.placedSymbolArray.get(tn.centerJustifiedTextSymbolIndex),Gl=m.evaluateSizeForFeature(w.textSizeData,Oe,gl),tu=P.get("text-padding");Qa=d.collisionIndex.placeCollisionCircles(je,gl,w.lineVertexArray,w.glyphOffsetArray,Gl,L,U,H,c,Wt,Pe.predicate,tn.collisionCircleDiameter,tu),Kn=je||Qa.circles.length>0&&!Qa.collisionDetected,hi=hi&&Qa.offscreen}if(ni.iconFeatureIndex&&(fo=ni.iconFeatureIndex),ni.iconBox){var yl=function(ua){var Ns=Zt&&qn?Do(ua,qn.x,qn.y,vt,Wt,d.transform.angle):ua;return d.collisionIndex.placeCollisionBox(Ns,Ke,ae,L,Pe.predicate)};Hn=go&&go.box&&go.box.length&&ni.verticalIconBox?(To=yl(ni.verticalIconBox)).box.length>0:(To=yl(ni.iconBox)).box.length>0,hi=hi&&To.offscreen}var bu=Ne||tn.numHorizontalGlyphVertices===0&&tn.numVerticalGlyphVertices===0,Eo=xe||tn.numIconVertices===0;if(bu||Eo?Eo?bu||(Hn=Hn&&Kn):Kn=Hn&&Kn:Hn=Kn=Hn&&Kn,Kn&&li&&li.box&&d.collisionIndex.insertCollisionBox(li.box,P.get("text-ignore-placement"),w.bucketInstanceId,go&&go.box&&Ga?Ga:Da,Pe.ID),Hn&&To&&d.collisionIndex.insertCollisionBox(To.box,P.get("icon-ignore-placement"),w.bucketInstanceId,fo,Pe.ID),Qa&&(Kn&&d.collisionIndex.insertCollisionCircles(Qa.circles,P.get("text-ignore-placement"),w.bucketInstanceId,Da,Pe.ID),c)){var Bu=w.bucketInstanceId,Nu=d.collisionCircleArrays[Bu];Nu===void 0&&(Nu=d.collisionCircleArrays[Bu]=new ho);for(var Ju=0;Ju<Qa.circles.length;Ju+=4)Nu.circles.push(Qa.circles[Ju+0]),Nu.circles.push(Qa.circles[Ju+1]),Nu.circles.push(Qa.circles[Ju+2]),Nu.circles.push(Qa.collisionDetected?1:0)}d.placements[tn.crossTileID]=new Cu(Kn||hr,Hn||kr,hi||w.justReloaded),f[tn.crossTileID]=!0}};if(qt)for(var sn=w.getSortedSymbolIndexes(this.transform.angle),Zn=sn.length-1;Zn>=0;--Zn){var jn=sn[Zn];yr(w.symbolInstances.get(jn),w.collisionArrays[jn])}else for(var Ln=l.symbolInstanceStart;Ln<l.symbolInstanceEnd;Ln++)yr(w.symbolInstances.get(Ln),w.collisionArrays[Ln]);if(c&&w.bucketInstanceId in this.collisionCircleArrays){var Ri=this.collisionCircleArrays[w.bucketInstanceId];m.invert(Ri.invProjMatrix,L),Ri.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1},$a.prototype.markUsedJustification=function(l,f,c,d){var E;E=d===m.WritingMode.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[m.getAnchorJustification(f)];for(var w=0,P=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];w<P.length;w+=1){var L=P[w];L>=0&&(l.text.placedSymbolArray.get(L).crossTileID=E>=0&&L!==E?0:c.crossTileID)}},$a.prototype.markUsedOrientation=function(l,f,c){for(var d=f===m.WritingMode.horizontal||f===m.WritingMode.horizontalOnly?f:0,E=f===m.WritingMode.vertical?f:0,w=0,P=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];w<P.length;w+=1)l.text.placedSymbolArray.get(P[w]).placedOrientation=d;c.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=E)},$a.prototype.commit=function(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;var f=this.prevPlacement,c=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;var d=f?f.symbolFadeChange(l):1,E=f?f.opacities:{},w=f?f.variableOffsets:{},P=f?f.placedOrientations:{};for(var L in this.placements){var U=this.placements[L],H=E[L];H?(this.opacities[L]=new Zo(H,d,U.text,U.icon),c=c||U.text!==H.text.placed||U.icon!==H.icon.placed):(this.opacities[L]=new Zo(null,d,U.text,U.icon,U.skipFade),c=c||U.text||U.icon)}for(var ae in E){var se=E[ae];if(!this.opacities[ae]){var le=new Zo(se,d,!1,!1);le.isHidden()||(this.opacities[ae]=le,c=c||se.text.placed||se.icon.placed)}}for(var Oe in w)this.variableOffsets[Oe]||!this.opacities[Oe]||this.opacities[Oe].isHidden()||(this.variableOffsets[Oe]=w[Oe]);for(var Pe in P)this.placedOrientations[Pe]||!this.opacities[Pe]||this.opacities[Pe].isHidden()||(this.placedOrientations[Pe]=P[Pe]);c?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:l)},$a.prototype.updateLayerOpacities=function(l,f){for(var c={},d=0,E=f;d<E.length;d+=1){var w=E[d],P=w.getBucket(l);P&&w.latestFeatureIndex&&l.id===P.layerIds[0]&&this.updateBucketOpacities(P,c,w.collisionBoxArray)}},$a.prototype.updateBucketOpacities=function(l,f,c){var d=this;l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();var E=l.layers[0].layout,w=new Zo(null,0,!1,!1,!0),P=E.get("text-allow-overlap"),L=E.get("icon-allow-overlap"),U=E.get("text-variable-anchor"),H=E.get("text-rotation-alignment")==="map",ae=E.get("text-pitch-alignment")==="map",se=E.get("icon-text-fit")!=="none",le=new Zo(null,0,P&&(L||!l.hasIconData()||E.get("icon-optional")),L&&(P||!l.hasTextData()||E.get("text-optional")),!0);!l.collisionArrays&&c&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(c);for(var Oe=function(je,Ke,vt){for(var Wt=0;Wt<Ke/4;Wt++)je.opacityVertexArray.emplaceBack(vt)},Pe=function(je){var Ke=l.symbolInstances.get(je),vt=Ke.numHorizontalGlyphVertices,Wt=Ke.numVerticalGlyphVertices,Zt=Ke.crossTileID,qt=d.opacities[Zt];f[Zt]?qt=w:qt||(d.opacities[Zt]=qt=le),f[Zt]=!0;var hr=Ke.numIconVertices>0,kr=d.placedOrientations[Ke.crossTileID],yr=kr===m.WritingMode.vertical,sn=kr===m.WritingMode.horizontal||kr===m.WritingMode.horizontalOnly;if(vt>0||Wt>0){var Zn=In(qt.text);Oe(l.text,vt,yr?Mi:Zn),Oe(l.text,Wt,sn?Mi:Zn);var jn=qt.text.isHidden();[Ke.rightJustifiedTextSymbolIndex,Ke.centerJustifiedTextSymbolIndex,Ke.leftJustifiedTextSymbolIndex].forEach(function(Xn){Xn>=0&&(l.text.placedSymbolArray.get(Xn).hidden=jn||yr?1:0)}),Ke.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(Ke.verticalPlacedTextSymbolIndex).hidden=jn||sn?1:0);var Ln=d.variableOffsets[Ke.crossTileID];Ln&&d.markUsedJustification(l,Ln.anchor,Ke,kr);var Ri=d.placedOrientations[Ke.crossTileID];Ri&&(d.markUsedJustification(l,"left",Ke,Ri),d.markUsedOrientation(l,Ri,Ke))}if(hr){var tn=In(qt.icon),ni=!(se&&Ke.verticalPlacedIconSymbolIndex&&yr);Ke.placedIconSymbolIndex>=0&&(Oe(l.icon,Ke.numIconVertices,ni?tn:Mi),l.icon.placedSymbolArray.get(Ke.placedIconSymbolIndex).hidden=qt.icon.isHidden()),Ke.verticalPlacedIconSymbolIndex>=0&&(Oe(l.icon,Ke.numVerticalIconVertices,ni?Mi:tn),l.icon.placedSymbolArray.get(Ke.verticalPlacedIconSymbolIndex).hidden=qt.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){var li=l.collisionArrays[je];if(li){var Kn=new m.Point(0,0);if(li.textBox||li.verticalTextBox){var Hn=!0;if(U){var hi=d.variableOffsets[Zt];hi?(Kn=Ka(hi.anchor,hi.width,hi.height,hi.textOffset,hi.textBoxScale),H&&Kn._rotate(ae?d.transform.angle:-d.transform.angle)):Hn=!1}li.textBox&&As(l.textCollisionBox.collisionVertexArray,qt.text.placed,!Hn||yr,Kn.x,Kn.y),li.verticalTextBox&&As(l.textCollisionBox.collisionVertexArray,qt.text.placed,!Hn||sn,Kn.x,Kn.y)}var qn=Boolean(!sn&&li.verticalIconBox);li.iconBox&&As(l.iconCollisionBox.collisionVertexArray,qt.icon.placed,qn,se?Kn.x:0,se?Kn.y:0),li.verticalIconBox&&As(l.iconCollisionBox.collisionVertexArray,qt.icon.placed,!qn,se?Kn.x:0,se?Kn.y:0)}}},Ne=0;Ne<l.symbolInstances.length;Ne++)Pe(Ne);if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){var xe=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=xe.invProjMatrix,l.placementViewportMatrix=xe.viewportMatrix,l.collisionCircleArray=xe.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}},$a.prototype.symbolFadeChange=function(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},$a.prototype.zoomAdjustment=function(l){return Math.max(0,(this.transform.zoom-l)/1.5)},$a.prototype.hasTransitions=function(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration},$a.prototype.stillRecent=function(l,f){var c=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*c>l},$a.prototype.setStale=function(){this.stale=!0};var Ml=Math.pow(2,25),ds=Math.pow(2,24),ee=Math.pow(2,17),ye=Math.pow(2,16),We=Math.pow(2,9),It=Math.pow(2,8),Ir=Math.pow(2,1);function In(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;var f=l.placed?1:0,c=Math.floor(127*l.opacity);return c*Ml+f*ds+c*ee+f*ye+c*We+f*It+c*Ir+f}var Mi=0,ao=function(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};ao.prototype.continuePlacement=function(l,f,c,d,E){for(var w=this._bucketParts;this._currentTileIndex<l.length;)if(f.getBucketParts(w,d,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,E())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort(function(P,L){return P.sortKey-L.sortKey}));this._currentPartIndex<w.length;)if(f.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,E())return!0;return!1};var Ra=function(l,f,c,d,E,w,P){this.placement=new $a(l,E,w,P),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=d,this._done=!1};Ra.prototype.isDone=function(){return this._done},Ra.prototype.continuePlacement=function(l,f,c){for(var d=this,E=m.browser.now(),w=function(){var U=m.browser.now()-E;return!d._forceFullPlacement&&U>2};this._currentPlacementIndex>=0;){var P=f[l[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(P.type==="symbol"&&(!P.minzoom||P.minzoom<=L)&&(!P.maxzoom||P.maxzoom>L)){if(this._inProgressLayer||(this._inProgressLayer=new ao(P)),this._inProgressLayer.continuePlacement(c[P.source],this.placement,this._showCollisionBoxes,P,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Ra.prototype.commit=function(l){return this.placement.commit(l),this.placement};var Ua=512/m.EXTENT/2,jo=function(l,f,c){this.tileID=l,this.indexedSymbolInstances={},this.bucketInstanceId=c;for(var d=0;d<f.length;d++){var E=f.get(d),w=E.key;this.indexedSymbolInstances[w]||(this.indexedSymbolInstances[w]=[]),this.indexedSymbolInstances[w].push({crossTileID:E.crossTileID,coord:this.getScaledCoordinates(E,l)})}};jo.prototype.getScaledCoordinates=function(l,f){var c=Ua/Math.pow(2,f.canonical.z-this.tileID.canonical.z);return{x:Math.floor((f.canonical.x*m.EXTENT+l.anchorX)*c),y:Math.floor((f.canonical.y*m.EXTENT+l.anchorY)*c)}},jo.prototype.findMatches=function(l,f,c){for(var d=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z),E=0;E<l.length;E++){var w=l.get(E);if(!w.crossTileID){var P=this.indexedSymbolInstances[w.key];if(P)for(var L=this.getScaledCoordinates(w,f),U=0,H=P;U<H.length;U+=1){var ae=H[U];if(Math.abs(ae.coord.x-L.x)<=d&&Math.abs(ae.coord.y-L.y)<=d&&!c[ae.crossTileID]){c[ae.crossTileID]=!0,w.crossTileID=ae.crossTileID;break}}}}};var vs=function(){this.maxCrossTileID=0};vs.prototype.generate=function(){return++this.maxCrossTileID};var uo=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};uo.prototype.handleWrapJump=function(l){var f=Math.round((l-this.lng)/360);if(f!==0)for(var c in this.indexes){var d=this.indexes[c],E={};for(var w in d){var P=d[w];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+f),E[P.tileID.key]=P}this.indexes[c]=E}this.lng=l},uo.prototype.addBucket=function(l,f,c){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(var d=0;d<f.symbolInstances.length;d++)f.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});var E=this.usedCrossTileIDs[l.overscaledZ];for(var w in this.indexes){var P=this.indexes[w];if(Number(w)>l.overscaledZ)for(var L in P){var U=P[L];U.tileID.isChildOf(l)&&U.findMatches(f.symbolInstances,l,E)}else{var H=P[l.scaledTo(Number(w)).key];H&&H.findMatches(f.symbolInstances,l,E)}}for(var ae=0;ae<f.symbolInstances.length;ae++){var se=f.symbolInstances.get(ae);se.crossTileID||(se.crossTileID=c.generate(),E[se.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new jo(l,f.symbolInstances,f.bucketInstanceId),!0},uo.prototype.removeBucketCrossTileIDs=function(l,f){for(var c in f.indexedSymbolInstances)for(var d=0,E=f.indexedSymbolInstances[c];d<E.length;d+=1)delete this.usedCrossTileIDs[l][E[d].crossTileID]},uo.prototype.removeStaleBuckets=function(l){var f=!1;for(var c in this.indexes){var d=this.indexes[c];for(var E in d)l[d[E].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,d[E]),delete d[E],f=!0)}return f};var wo=function(){this.layerIndexes={},this.crossTileIDs=new vs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};wo.prototype.addLayer=function(l,f,c){var d=this.layerIndexes[l.id];d===void 0&&(d=this.layerIndexes[l.id]=new uo);var E=!1,w={};d.handleWrapJump(c);for(var P=0,L=f;P<L.length;P+=1){var U=L[P],H=U.getBucket(l);H&&l.id===H.layerIds[0]&&(H.bucketInstanceId||(H.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(U.tileID,H,this.crossTileIDs)&&(E=!0),w[H.bucketInstanceId]=!0)}return d.removeStaleBuckets(w)&&(E=!0),E},wo.prototype.pruneUnusedLayers=function(l){var f={};for(var c in l.forEach(function(d){f[d]=!0}),this.layerIndexes)f[c]||delete this.layerIndexes[c]};var ms=function(l,f){return m.emitValidationErrors(l,f&&f.filter(function(c){return c.identifier!=="source.canvas"}))},ws=m.pick(Wr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Ds=m.pick(Wr,["setCenter","setZoom","setBearing","setPitch"]),uu=function(){var l={},f=m.styleSpec.$version;for(var c in m.styleSpec.$root){var d,E=m.styleSpec.$root[c];E.required&&(d=c==="version"?f:E.type==="array"?[]:{})!=null&&(l[c]=d)}return l}(),gs=function(l){function f(c,d){var E=this;d===void 0&&(d={}),l.call(this),this.map=c,this.dispatcher=new Ht(Tt(),this),this.imageManager=new At,this.imageManager.setEventedParent(this),this.glyphManager=new Xt(c._requestManager,d.localIdeographFontFamily),this.lineAtlas=new $e(256,512),this.crossTileSymbolIndex=new wo,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new m.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",m.getReferrer());var w=this;this._rtlTextPluginCallback=f.registerForPluginStateChange(function(P){w.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:P.pluginStatus,pluginURL:P.pluginURL},function(L,U){if(m.triggerPluginCompletionEvent(L),U&&U.every(function(ae){return ae}))for(var H in w.sourceCaches)w.sourceCaches[H].reload()})}),this.on("data",function(P){if(P.dataType==="source"&&P.sourceDataType==="metadata"){var L=E.sourceCaches[P.sourceId];if(L){var U=L.getSource();if(U&&U.vectorLayerIds)for(var H in E._layers){var ae=E._layers[H];ae.source===U.id&&E._validateLayer(ae)}}}})}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.loadURL=function(c,d){var E=this;d===void 0&&(d={}),this.fire(new m.Event("dataloading",{dataType:"style"}));var w=typeof d.validate=="boolean"?d.validate:!m.isMapboxURL(c);c=this.map._requestManager.normalizeStyleURL(c,d.accessToken);var P=this.map._requestManager.transformRequest(c,m.ResourceType.Style);this._request=m.getJSON(P,function(L,U){E._request=null,L?E.fire(new m.ErrorEvent(L)):U&&E._load(U,w)})},f.prototype.loadJSON=function(c,d){var E=this;d===void 0&&(d={}),this.fire(new m.Event("dataloading",{dataType:"style"})),this._request=m.browser.frame(function(){E._request=null,E._load(c,d.validate!==!1)})},f.prototype.loadEmpty=function(){this.fire(new m.Event("dataloading",{dataType:"style"})),this._load(uu,!1)},f.prototype._load=function(c,d){if(!d||!ms(this,m.validateStyle(c))){for(var E in this._loaded=!0,this.stylesheet=c,c.sources)this.addSource(E,c.sources[E],{validate:!1});c.sprite?this._loadSprite(c.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(c.glyphs);var w=Br(this.stylesheet.layers);this._order=w.map(function(H){return H.id}),this._layers={},this._serializedLayers={};for(var P=0,L=w;P<L.length;P+=1){var U=L[P];(U=m.createStyleLayer(U)).setEventedParent(this,{layer:{id:U.id}}),this._layers[U.id]=U,this._serializedLayers[U.id]=U.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new xt(this.stylesheet.light),this.fire(new m.Event("data",{dataType:"style"})),this.fire(new m.Event("style.load"))}},f.prototype._loadSprite=function(c){var d=this;this._spriteRequest=function(E,w,P){var L,U,H,ae=m.browser.devicePixelRatio>1?"@2x":"",se=m.getJSON(w.transformRequest(w.normalizeSpriteURL(E,ae,".json"),m.ResourceType.SpriteJSON),function(Pe,Ne){se=null,H||(H=Pe,L=Ne,Oe())}),le=m.getImage(w.transformRequest(w.normalizeSpriteURL(E,ae,".png"),m.ResourceType.SpriteImage),function(Pe,Ne){le=null,H||(H=Pe,U=Ne,Oe())});function Oe(){if(H)P(H);else if(L&&U){var Pe=m.browser.getImageData(U),Ne={};for(var xe in L){var je=L[xe],Ke=je.width,vt=je.height,Wt=je.x,Zt=je.y,qt=je.sdf,hr=je.pixelRatio,kr=je.stretchX,yr=je.stretchY,sn=je.content,Zn=new m.RGBAImage({width:Ke,height:vt});m.RGBAImage.copy(Pe,Zn,{x:Wt,y:Zt},{x:0,y:0},{width:Ke,height:vt}),Ne[xe]={data:Zn,pixelRatio:hr,sdf:qt,stretchX:kr,stretchY:yr,content:sn}}P(null,Ne)}}return{cancel:function(){se&&(se.cancel(),se=null),le&&(le.cancel(),le=null)}}}(c,this.map._requestManager,function(E,w){if(d._spriteRequest=null,E)d.fire(new m.ErrorEvent(E));else if(w)for(var P in w)d.imageManager.addImage(P,w[P]);d.imageManager.setLoaded(!0),d._availableImages=d.imageManager.listImages(),d.dispatcher.broadcast("setImages",d._availableImages),d.fire(new m.Event("data",{dataType:"style"}))})},f.prototype._validateLayer=function(c){var d=this.sourceCaches[c.source];if(d){var E=c.sourceLayer;if(E){var w=d.getSource();(w.type==="geojson"||w.vectorLayerIds&&w.vectorLayerIds.indexOf(E)===-1)&&this.fire(new m.ErrorEvent(new Error('Source layer "'+E+'" does not exist on source "'+w.id+'" as specified by style layer "'+c.id+'"')))}}},f.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var c in this.sourceCaches)if(!this.sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()},f.prototype._serializeLayers=function(c){for(var d=[],E=0,w=c;E<w.length;E+=1){var P=this._layers[w[E]];P.type!=="custom"&&d.push(P.serialize())}return d},f.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var c in this.sourceCaches)if(this.sourceCaches[c].hasTransition())return!0;for(var d in this._layers)if(this._layers[d].hasTransition())return!0;return!1},f.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},f.prototype.update=function(c){if(this._loaded){var d=this._changed;if(this._changed){var E=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);for(var P in(E.length||w.length)&&this._updateWorkerLayers(E,w),this._updatedSources){var L=this._updatedSources[P];L==="reload"?this._reloadSource(P):L==="clear"&&this._clearSource(P)}for(var U in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[U].updateTransitions(c);this.light.updateTransitions(c),this._resetUpdates()}var H={};for(var ae in this.sourceCaches){var se=this.sourceCaches[ae];H[ae]=se.used,se.used=!1}for(var le=0,Oe=this._order;le<Oe.length;le+=1){var Pe=this._layers[Oe[le]];Pe.recalculate(c,this._availableImages),!Pe.isHidden(c.zoom)&&Pe.source&&(this.sourceCaches[Pe.source].used=!0)}for(var Ne in H){var xe=this.sourceCaches[Ne];H[Ne]!==xe.used&&xe.fire(new m.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:Ne}))}this.light.recalculate(c),this.z=c.zoom,d&&this.fire(new m.Event("data",{dataType:"style"}))}},f.prototype._updateTilesForChangedImages=function(){var c=Object.keys(this._changedImages);if(c.length){for(var d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}},f.prototype._updateWorkerLayers=function(c,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(c),removedIds:d})},f.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},f.prototype.setState=function(c){var d=this;if(this._checkLoaded(),ms(this,m.validateStyle(c)))return!1;(c=m.clone$1(c)).layers=Br(c.layers);var E=function(P,L){if(!P)return[{command:Wr.setStyle,args:[L]}];var U=[];try{if(!m.deepEqual(P.version,L.version))return[{command:Wr.setStyle,args:[L]}];m.deepEqual(P.center,L.center)||U.push({command:Wr.setCenter,args:[L.center]}),m.deepEqual(P.zoom,L.zoom)||U.push({command:Wr.setZoom,args:[L.zoom]}),m.deepEqual(P.bearing,L.bearing)||U.push({command:Wr.setBearing,args:[L.bearing]}),m.deepEqual(P.pitch,L.pitch)||U.push({command:Wr.setPitch,args:[L.pitch]}),m.deepEqual(P.sprite,L.sprite)||U.push({command:Wr.setSprite,args:[L.sprite]}),m.deepEqual(P.glyphs,L.glyphs)||U.push({command:Wr.setGlyphs,args:[L.glyphs]}),m.deepEqual(P.transition,L.transition)||U.push({command:Wr.setTransition,args:[L.transition]}),m.deepEqual(P.light,L.light)||U.push({command:Wr.setLight,args:[L.light]});var H={},ae=[];(function(le,Oe,Pe,Ne){var xe;for(xe in Oe=Oe||{},le=le||{})le.hasOwnProperty(xe)&&(Oe.hasOwnProperty(xe)||en(xe,Pe,Ne));for(xe in Oe)Oe.hasOwnProperty(xe)&&(le.hasOwnProperty(xe)?m.deepEqual(le[xe],Oe[xe])||(le[xe].type==="geojson"&&Oe[xe].type==="geojson"&&Hi(le,Oe,xe)?Pe.push({command:Wr.setGeoJSONSourceData,args:[xe,Oe[xe].data]}):gn(xe,Oe,Pe,Ne)):vi(xe,Oe,Pe))})(P.sources,L.sources,ae,H);var se=[];P.layers&&P.layers.forEach(function(le){H[le.source]?U.push({command:Wr.removeLayer,args:[le.id]}):se.push(le)}),U=U.concat(ae),function(le,Oe,Pe){Oe=Oe||[];var Ne,xe,je,Ke,vt,Wt,Zt,qt=(le=le||[]).map(wi),hr=Oe.map(wi),kr=le.reduce(yi,{}),yr=Oe.reduce(yi,{}),sn=qt.slice(),Zn=Object.create(null);for(Ne=0,xe=0;Ne<qt.length;Ne++)yr.hasOwnProperty(je=qt[Ne])?xe++:(Pe.push({command:Wr.removeLayer,args:[je]}),sn.splice(sn.indexOf(je,xe),1));for(Ne=0,xe=0;Ne<hr.length;Ne++)sn[sn.length-1-Ne]!==(je=hr[hr.length-1-Ne])&&(kr.hasOwnProperty(je)?(Pe.push({command:Wr.removeLayer,args:[je]}),sn.splice(sn.lastIndexOf(je,sn.length-xe),1)):xe++,Pe.push({command:Wr.addLayer,args:[yr[je],Wt=sn[sn.length-Ne]]}),sn.splice(sn.length-Ne,0,je),Zn[je]=!0);for(Ne=0;Ne<hr.length;Ne++)if(Ke=kr[je=hr[Ne]],vt=yr[je],!Zn[je]&&!m.deepEqual(Ke,vt))if(m.deepEqual(Ke.source,vt.source)&&m.deepEqual(Ke["source-layer"],vt["source-layer"])&&m.deepEqual(Ke.type,vt.type)){for(Zt in pi(Ke.layout,vt.layout,Pe,je,null,Wr.setLayoutProperty),pi(Ke.paint,vt.paint,Pe,je,null,Wr.setPaintProperty),m.deepEqual(Ke.filter,vt.filter)||Pe.push({command:Wr.setFilter,args:[je,vt.filter]}),m.deepEqual(Ke.minzoom,vt.minzoom)&&m.deepEqual(Ke.maxzoom,vt.maxzoom)||Pe.push({command:Wr.setLayerZoomRange,args:[je,vt.minzoom,vt.maxzoom]}),Ke)Ke.hasOwnProperty(Zt)&&Zt!=="layout"&&Zt!=="paint"&&Zt!=="filter"&&Zt!=="metadata"&&Zt!=="minzoom"&&Zt!=="maxzoom"&&(Zt.indexOf("paint.")===0?pi(Ke[Zt],vt[Zt],Pe,je,Zt.slice(6),Wr.setPaintProperty):m.deepEqual(Ke[Zt],vt[Zt])||Pe.push({command:Wr.setLayerProperty,args:[je,Zt,vt[Zt]]}));for(Zt in vt)vt.hasOwnProperty(Zt)&&!Ke.hasOwnProperty(Zt)&&Zt!=="layout"&&Zt!=="paint"&&Zt!=="filter"&&Zt!=="metadata"&&Zt!=="minzoom"&&Zt!=="maxzoom"&&(Zt.indexOf("paint.")===0?pi(Ke[Zt],vt[Zt],Pe,je,Zt.slice(6),Wr.setPaintProperty):m.deepEqual(Ke[Zt],vt[Zt])||Pe.push({command:Wr.setLayerProperty,args:[je,Zt,vt[Zt]]}))}else Pe.push({command:Wr.removeLayer,args:[je]}),Wt=sn[sn.lastIndexOf(je)+1],Pe.push({command:Wr.addLayer,args:[vt,Wt]})}(se,L.layers,U)}catch(le){console.warn("Unable to compute style diff:",le),U=[{command:Wr.setStyle,args:[L]}]}return U}(this.serialize(),c).filter(function(P){return!(P.command in Ds)});if(E.length===0)return!1;var w=E.filter(function(P){return!(P.command in ws)});if(w.length>0)throw new Error("Unimplemented: "+w.map(function(P){return P.command}).join(", ")+".");return E.forEach(function(P){P.command!=="setTransition"&&d[P.command].apply(d,P.args)}),this.stylesheet=c,!0},f.prototype.addImage=function(c,d){if(this.getImage(c))return this.fire(new m.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(c,d),this._afterImageUpdated(c)},f.prototype.updateImage=function(c,d){this.imageManager.updateImage(c,d)},f.prototype.getImage=function(c){return this.imageManager.getImage(c)},f.prototype.removeImage=function(c){if(!this.getImage(c))return this.fire(new m.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(c),this._afterImageUpdated(c)},f.prototype._afterImageUpdated=function(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new m.Event("data",{dataType:"style"}))},f.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},f.prototype.addSource=function(c,d,E){var w=this;if(E===void 0&&(E={}),this._checkLoaded(),this.sourceCaches[c]!==void 0)throw new Error("There is already a source with this ID");if(!d.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(d).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(m.validateStyle.source,"sources."+c,d,null,E))){this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);var P=this.sourceCaches[c]=new Le(c,d,this.dispatcher);P.style=this,P.setEventedParent(this,function(){return{isSourceLoaded:w.loaded(),source:P.serialize(),sourceId:c}}),P.onAdd(this.map),this._changed=!0}},f.prototype.removeSource=function(c){if(this._checkLoaded(),this.sourceCaches[c]===void 0)throw new Error("There is no source with this ID");for(var d in this._layers)if(this._layers[d].source===c)return this.fire(new m.ErrorEvent(new Error('Source "'+c+'" cannot be removed while layer "'+d+'" is using it.')));var E=this.sourceCaches[c];delete this.sourceCaches[c],delete this._updatedSources[c],E.fire(new m.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:c})),E.setEventedParent(null),E.clearTiles(),E.onRemove&&E.onRemove(this.map),this._changed=!0},f.prototype.setGeoJSONSourceData=function(c,d){this._checkLoaded(),this.sourceCaches[c].getSource().setData(d),this._changed=!0},f.prototype.getSource=function(c){return this.sourceCaches[c]&&this.sourceCaches[c].getSource()},f.prototype.addLayer=function(c,d,E){E===void 0&&(E={}),this._checkLoaded();var w=c.id;if(this.getLayer(w))this.fire(new m.ErrorEvent(new Error('Layer with id "'+w+'" already exists on this map')));else{var P;if(c.type==="custom"){if(ms(this,m.validateCustomStyleLayer(c)))return;P=m.createStyleLayer(c)}else{if(typeof c.source=="object"&&(this.addSource(w,c.source),c=m.clone$1(c),c=m.extend(c,{source:w})),this._validate(m.validateStyle.layer,"layers."+w,c,{arrayIndex:-1},E))return;P=m.createStyleLayer(c),this._validateLayer(P),P.setEventedParent(this,{layer:{id:w}}),this._serializedLayers[P.id]=P.serialize()}var L=d?this._order.indexOf(d):this._order.length;if(d&&L===-1)this.fire(new m.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.')));else{if(this._order.splice(L,0,w),this._layerOrderChanged=!0,this._layers[w]=P,this._removedLayers[w]&&P.source&&P.type!=="custom"){var U=this._removedLayers[w];delete this._removedLayers[w],U.type!==P.type?this._updatedSources[P.source]="clear":(this._updatedSources[P.source]="reload",this.sourceCaches[P.source].pause())}this._updateLayer(P),P.onAdd&&P.onAdd(this.map)}}},f.prototype.moveLayer=function(c,d){if(this._checkLoaded(),this._changed=!0,this._layers[c]){if(c!==d){var E=this._order.indexOf(c);this._order.splice(E,1);var w=d?this._order.indexOf(d):this._order.length;d&&w===-1?this.fire(new m.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.'))):(this._order.splice(w,0,c),this._layerOrderChanged=!0)}}else this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be moved.")))},f.prototype.removeLayer=function(c){this._checkLoaded();var d=this._layers[c];if(d){d.setEventedParent(null);var E=this._order.indexOf(c);this._order.splice(E,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=d,delete this._layers[c],delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],d.onRemove&&d.onRemove(this.map)}else this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be removed.")))},f.prototype.getLayer=function(c){return this._layers[c]},f.prototype.hasLayer=function(c){return c in this._layers},f.prototype.setLayerZoomRange=function(c,d,E){this._checkLoaded();var w=this.getLayer(c);w?w.minzoom===d&&w.maxzoom===E||(d!=null&&(w.minzoom=d),E!=null&&(w.maxzoom=E),this._updateLayer(w)):this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot have zoom extent.")))},f.prototype.setFilter=function(c,d,E){E===void 0&&(E={}),this._checkLoaded();var w=this.getLayer(c);if(w){if(!m.deepEqual(w.filter,d))return d==null?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(m.validateStyle.filter,"layers."+w.id+".filter",d,null,E)||(w.filter=m.clone$1(d),this._updateLayer(w)))}else this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be filtered.")))},f.prototype.getFilter=function(c){return m.clone$1(this.getLayer(c).filter)},f.prototype.setLayoutProperty=function(c,d,E,w){w===void 0&&(w={}),this._checkLoaded();var P=this.getLayer(c);P?m.deepEqual(P.getLayoutProperty(d),E)||(P.setLayoutProperty(d,E,w),this._updateLayer(P)):this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getLayoutProperty=function(c,d){var E=this.getLayer(c);if(E)return E.getLayoutProperty(d);this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style.")))},f.prototype.setPaintProperty=function(c,d,E,w){w===void 0&&(w={}),this._checkLoaded();var P=this.getLayer(c);P?m.deepEqual(P.getPaintProperty(d),E)||(P.setPaintProperty(d,E,w)&&this._updateLayer(P),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getPaintProperty=function(c,d){return this.getLayer(c).getPaintProperty(d)},f.prototype.setFeatureState=function(c,d){this._checkLoaded();var E=c.source,w=c.sourceLayer,P=this.sourceCaches[E];if(P!==void 0){var L=P.getSource().type;L==="geojson"&&w?this.fire(new m.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):L!=="vector"||w?(c.id===void 0&&this.fire(new m.ErrorEvent(new Error("The feature id parameter must be provided."))),P.setFeatureState(w,c.id,d)):this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error("The source '"+E+"' does not exist in the map's style.")))},f.prototype.removeFeatureState=function(c,d){this._checkLoaded();var E=c.source,w=this.sourceCaches[E];if(w!==void 0){var P=w.getSource().type,L=P==="vector"?c.sourceLayer:void 0;P!=="vector"||L?d&&typeof c.id!="string"&&typeof c.id!="number"?this.fire(new m.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):w.removeFeatureState(L,c.id,d):this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error("The source '"+E+"' does not exist in the map's style.")))},f.prototype.getFeatureState=function(c){this._checkLoaded();var d=c.source,E=c.sourceLayer,w=this.sourceCaches[d];if(w!==void 0){if(w.getSource().type!=="vector"||E)return c.id===void 0&&this.fire(new m.ErrorEvent(new Error("The feature id parameter must be provided."))),w.getFeatureState(E,c.id);this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error("The source '"+d+"' does not exist in the map's style.")))},f.prototype.getTransition=function(){return m.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},f.prototype.serialize=function(){return m.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:m.mapObject(this.sourceCaches,function(c){return c.serialize()}),layers:this._serializeLayers(this._order)},function(c){return c!==void 0})},f.prototype._updateLayer=function(c){this._updatedLayers[c.id]=!0,c.source&&!this._updatedSources[c.source]&&this.sourceCaches[c.source].getSource().type!=="raster"&&(this._updatedSources[c.source]="reload",this.sourceCaches[c.source].pause()),this._changed=!0},f.prototype._flattenAndSortRenderedFeatures=function(c){for(var d=this,E=function(kr){return d._layers[kr].type==="fill-extrusion"},w={},P=[],L=this._order.length-1;L>=0;L--){var U=this._order[L];if(E(U)){w[U]=L;for(var H=0,ae=c;H<ae.length;H+=1){var se=ae[H][U];if(se)for(var le=0,Oe=se;le<Oe.length;le+=1)P.push(Oe[le])}}}P.sort(function(kr,yr){return yr.intersectionZ-kr.intersectionZ});for(var Pe=[],Ne=this._order.length-1;Ne>=0;Ne--){var xe=this._order[Ne];if(E(xe))for(var je=P.length-1;je>=0;je--){var Ke=P[je].feature;if(w[Ke.layer.id]<Ne)break;Pe.push(Ke),P.pop()}else for(var vt=0,Wt=c;vt<Wt.length;vt+=1){var Zt=Wt[vt][xe];if(Zt)for(var qt=0,hr=Zt;qt<hr.length;qt+=1)Pe.push(hr[qt].feature)}}return Pe},f.prototype.queryRenderedFeatures=function(c,d,E){d&&d.filter&&this._validate(m.validateStyle.filter,"queryRenderedFeatures.filter",d.filter,null,d);var w={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new m.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var P=0,L=d.layers;P<L.length;P+=1){var U=L[P],H=this._layers[U];if(!H)return this.fire(new m.ErrorEvent(new Error("The layer '"+U+"' does not exist in the map's style and cannot be queried for features."))),[];w[H.source]=!0}}var ae=[];for(var se in d.availableImages=this._availableImages,this.sourceCaches)d.layers&&!w[se]||ae.push(Gr(this.sourceCaches[se],this._layers,this._serializedLayers,c,d,E));return this.placement&&ae.push(function(le,Oe,Pe,Ne,xe,je,Ke){for(var vt={},Wt=je.queryRenderedSymbols(Ne),Zt=[],qt=0,hr=Object.keys(Wt).map(Number);qt<hr.length;qt+=1)Zt.push(Ke[hr[qt]]);Zt.sort(Nn);for(var kr=function(){var Ln=sn[yr],Ri=Ln.featureIndex.lookupSymbolFeatures(Wt[Ln.bucketInstanceId],Oe,Ln.bucketIndex,Ln.sourceLayerIndex,xe.filter,xe.layers,xe.availableImages,le);for(var tn in Ri){var ni=vt[tn]=vt[tn]||[],li=Ri[tn];li.sort(function(hi,qn){var Xn=Ln.featureSortOrder;if(Xn){var go=Xn.indexOf(hi.featureIndex);return Xn.indexOf(qn.featureIndex)-go}return qn.featureIndex-hi.featureIndex});for(var Kn=0,Hn=li;Kn<Hn.length;Kn+=1)ni.push(Hn[Kn])}},yr=0,sn=Zt;yr<sn.length;yr+=1)kr();var Zn=function(Ln){vt[Ln].forEach(function(Ri){var tn=Ri.feature,ni=Pe[le[Ln].source].getFeatureState(tn.layer["source-layer"],tn.id);tn.source=tn.layer.source,tn.layer["source-layer"]&&(tn.sourceLayer=tn.layer["source-layer"]),tn.state=ni})};for(var jn in vt)Zn(jn);return vt}(this._layers,this._serializedLayers,this.sourceCaches,c,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(ae)},f.prototype.querySourceFeatures=function(c,d){d&&d.filter&&this._validate(m.validateStyle.filter,"querySourceFeatures.filter",d.filter,null,d);var E=this.sourceCaches[c];return E?function(w,P){for(var L=w.getRenderableIds().map(function(Oe){return w.getTileByID(Oe)}),U=[],H={},ae=0;ae<L.length;ae++){var se=L[ae],le=se.tileID.canonical.key;H[le]||(H[le]=!0,se.querySourceFeatures(U,P))}return U}(E,d):[]},f.prototype.addSourceType=function(c,d,E){return f.getSourceType(c)?E(new Error('A source type called "'+c+'" already exists.')):(f.setSourceType(c,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:d.workerSourceURL},E):E(null,null))},f.prototype.getLight=function(){return this.light.getLight()},f.prototype.setLight=function(c,d){d===void 0&&(d={}),this._checkLoaded();var E=this.light.getLight(),w=!1;for(var P in c)if(!m.deepEqual(c[P],E[P])){w=!0;break}if(w){var L={now:m.browser.now(),transition:m.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(c,d),this.light.updateTransitions(L)}},f.prototype._validate=function(c,d,E,w,P){return P===void 0&&(P={}),(!P||P.validate!==!1)&&ms(this,c.call(m.validateStyle,m.extend({key:d,style:this.serialize(),value:E,styleSpec:m.styleSpec},w)))},f.prototype._remove=function(){for(var c in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),m.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[c].setEventedParent(null);for(var d in this.sourceCaches)this.sourceCaches[d].clearTiles(),this.sourceCaches[d].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},f.prototype._clearSource=function(c){this.sourceCaches[c].clearTiles()},f.prototype._reloadSource=function(c){this.sourceCaches[c].resume(),this.sourceCaches[c].reload()},f.prototype._updateSources=function(c){for(var d in this.sourceCaches)this.sourceCaches[d].update(c)},f.prototype._generateCollisionBoxes=function(){for(var c in this.sourceCaches)this._reloadSource(c)},f.prototype._updatePlacement=function(c,d,E,w,P){P===void 0&&(P=!1);for(var L=!1,U=!1,H={},ae=0,se=this._order;ae<se.length;ae+=1){var le=this._layers[se[ae]];if(le.type==="symbol"){if(!H[le.source]){var Oe=this.sourceCaches[le.source];H[le.source]=Oe.getRenderableIds(!0).map(function(Ke){return Oe.getTileByID(Ke)}).sort(function(Ke,vt){return vt.tileID.overscaledZ-Ke.tileID.overscaledZ||(Ke.tileID.isLessThan(vt.tileID)?-1:1)})}var Pe=this.crossTileSymbolIndex.addLayer(le,H[le.source],c.center.lng);L=L||Pe}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((P=P||this._layerOrderChanged||E===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(m.browser.now(),c.zoom))&&(this.pauseablePlacement=new Ra(c,this._order,P,d,E,w,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,H),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(m.browser.now()),U=!0),L&&this.pauseablePlacement.placement.setStale()),U||L)for(var Ne=0,xe=this._order;Ne<xe.length;Ne+=1){var je=this._layers[xe[Ne]];je.type==="symbol"&&this.placement.updateLayerOpacities(je,H[je.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(m.browser.now())},f.prototype._releaseSymbolFadeTiles=function(){for(var c in this.sourceCaches)this.sourceCaches[c].releaseSymbolFadeTiles()},f.prototype.getImages=function(c,d,E){this.imageManager.getImages(d.icons,E),this._updateTilesForChangedImages();var w=this.sourceCaches[d.source];w&&w.setDependencies(d.tileID.key,d.type,d.icons)},f.prototype.getGlyphs=function(c,d,E){this.glyphManager.getGlyphs(d.stacks,E)},f.prototype.getResource=function(c,d,E){return m.makeRequest(d,E)},f}(m.Evented);gs.getSourceType=function(l){return gr[l]},gs.setSourceType=function(l,f){gr[l]=f},gs.registerForPluginStateChange=m.registerForPluginStateChange;var ma=m.createLayout([{name:"a_pos",type:"Int16",components:2}]),_a=ji(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),rs=ji(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),pf=ji(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Pl=ji(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Ws=ji("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),rc=ji(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Wu=ji(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Xs=ji("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),al=ji("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),_=ji("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),M=ji(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),B=ji(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),O=ji(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),K=ji(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),ge=ji(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),He=ji(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),lt=ji(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),pt=ji(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),nr=ji(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),sr=ji(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Mn=ji(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),ri=ji(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),kn=ji(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Wi=ji(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),da=ji(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),Sa=ji(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function ji(l,f){var c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=f.match(/attribute ([\w]+) ([\w]+)/g),E=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),P=w?w.concat(E):E,L={};return{fragmentSource:l=l.replace(c,function(U,H,ae,se,le){return L[le]=!0,H==="define"?`
#ifndef HAS_UNIFORM_u_`+le+`
varying `+ae+" "+se+" "+le+`;
#else
uniform `+ae+" "+se+" u_"+le+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+le+`
    `+ae+" "+se+" "+le+" = u_"+le+`;
#endif
`}),vertexSource:f=f.replace(c,function(U,H,ae,se,le){var Oe=se==="float"?"vec2":"vec4",Pe=le.match(/color/)?"color":Oe;return L[le]?H==="define"?`
#ifndef HAS_UNIFORM_u_`+le+`
uniform lowp float u_`+le+`_t;
attribute `+ae+" "+Oe+" a_"+le+`;
varying `+ae+" "+se+" "+le+`;
#else
uniform `+ae+" "+se+" u_"+le+`;
#endif
`:Pe==="vec4"?`
#ifndef HAS_UNIFORM_u_`+le+`
    `+le+" = a_"+le+`;
#else
    `+ae+" "+se+" "+le+" = u_"+le+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+le+`
    `+le+" = unpack_mix_"+Pe+"(a_"+le+", u_"+le+`_t);
#else
    `+ae+" "+se+" "+le+" = u_"+le+`;
#endif
`:H==="define"?`
#ifndef HAS_UNIFORM_u_`+le+`
uniform lowp float u_`+le+`_t;
attribute `+ae+" "+Oe+" a_"+le+`;
#else
uniform `+ae+" "+se+" u_"+le+`;
#endif
`:Pe==="vec4"?`
#ifndef HAS_UNIFORM_u_`+le+`
    `+ae+" "+se+" "+le+" = a_"+le+`;
#else
    `+ae+" "+se+" "+le+" = u_"+le+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+le+`
    `+ae+" "+se+" "+le+" = unpack_mix_"+Pe+"(a_"+le+", u_"+le+`_t);
#else
    `+ae+" "+se+" "+le+" = u_"+le+`;
#endif
`}),staticAttributes:d,staticUniforms:P}}var ys=Object.freeze({__proto__:null,prelude:_a,background:rs,backgroundPattern:pf,circle:Pl,clippingMask:Ws,heatmap:rc,heatmapTexture:Wu,collisionBox:Xs,collisionCircle:al,debug:_,fill:M,fillOutline:B,fillOutlinePattern:O,fillPattern:K,fillExtrusion:ge,fillExtrusionPattern:He,hillshadePrepare:lt,hillshade:pt,line:nr,lineGradient:sr,linePattern:Mn,lineSDF:ri,raster:kn,symbolIcon:Wi,symbolSDF:da,symbolTextAndIcon:Sa}),lu=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Xu(l){for(var f=[],c=0;c<l.length;c++)if(l[c]!==null){var d=l[c].split(" ");f.push(d.pop())}return f}lu.prototype.bind=function(l,f,c,d,E,w,P,L){this.context=l;for(var U=this.boundPaintVertexBuffers.length!==d.length,H=0;!U&&H<d.length;H++)this.boundPaintVertexBuffers[H]!==d[H]&&(U=!0);l.extVertexArrayObject&&this.vao&&this.boundProgram===f&&this.boundLayoutVertexBuffer===c&&!U&&this.boundIndexBuffer===E&&this.boundVertexOffset===w&&this.boundDynamicVertexBuffer===P&&this.boundDynamicVertexBuffer2===L?(l.bindVertexArrayOES.set(this.vao),P&&P.bind(),E&&E.dynamicDraw&&E.bind(),L&&L.bind()):this.freshBind(f,c,d,E,w,P,L)},lu.prototype.freshBind=function(l,f,c,d,E,w,P){var L,U=l.numAttributes,H=this.context,ae=H.gl;if(H.extVertexArrayObject)this.vao&&this.destroy(),this.vao=H.extVertexArrayObject.createVertexArrayOES(),H.bindVertexArrayOES.set(this.vao),L=0,this.boundProgram=l,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=d,this.boundVertexOffset=E,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=P;else{L=H.currentNumAttributes||0;for(var se=U;se<L;se++)ae.disableVertexAttribArray(se)}f.enableAttributes(ae,l);for(var le=0,Oe=c;le<Oe.length;le+=1)Oe[le].enableAttributes(ae,l);w&&w.enableAttributes(ae,l),P&&P.enableAttributes(ae,l),f.bind(),f.setVertexAttribPointers(ae,l,E);for(var Pe=0,Ne=c;Pe<Ne.length;Pe+=1){var xe=Ne[Pe];xe.bind(),xe.setVertexAttribPointers(ae,l,E)}w&&(w.bind(),w.setVertexAttribPointers(ae,l,E)),d&&d.bind(),P&&(P.bind(),P.setVertexAttribPointers(ae,l,E)),H.currentNumAttributes=U},lu.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var hf=function(l,f,c,d,E,w){var P=l.gl;this.program=P.createProgram();for(var L=Xu(c.staticAttributes),U=d?d.getBinderAttributes():[],H=L.concat(U),ae=c.staticUniforms?Xu(c.staticUniforms):[],se=d?d.getBinderUniforms():[],le=[],Oe=0,Pe=ae.concat(se);Oe<Pe.length;Oe+=1){var Ne=Pe[Oe];le.indexOf(Ne)<0&&le.push(Ne)}var xe=d?d.defines():[];w&&xe.push("#define OVERDRAW_INSPECTOR;");var je=xe.concat(_a.fragmentSource,c.fragmentSource).join(`
`),Ke=xe.concat(_a.vertexSource,c.vertexSource).join(`
`),vt=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(vt,je),P.compileShader(vt),P.attachShader(this.program,vt);var Wt=P.createShader(P.VERTEX_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(Wt,Ke),P.compileShader(Wt),P.attachShader(this.program,Wt),this.attributes={};var Zt={};this.numAttributes=H.length;for(var qt=0;qt<this.numAttributes;qt++)H[qt]&&(P.bindAttribLocation(this.program,qt,H[qt]),this.attributes[H[qt]]=qt);P.linkProgram(this.program),P.deleteShader(Wt),P.deleteShader(vt);for(var hr=0;hr<le.length;hr++){var kr=le[hr];if(kr&&!Zt[kr]){var yr=P.getUniformLocation(this.program,kr);yr&&(Zt[kr]=yr)}}this.fixedUniforms=E(l,Zt),this.binderUniforms=d?d.getUniforms(l,Zt):[]}}};function ol(l,f,c){var d=1/oa(c,1,f.transform.tileZoom),E=Math.pow(2,c.tileID.overscaledZ),w=c.tileSize*Math.pow(2,f.transform.tileZoom)/E,P=w*(c.tileID.canonical.x+c.tileID.wrap*E),L=w*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[d,l.fromScale,l.toScale],u_fade:l.t,u_pixel_coord_upper:[P>>16,L>>16],u_pixel_coord_lower:[65535&P,65535&L]}}hf.prototype.draw=function(l,f,c,d,E,w,P,L,U,H,ae,se,le,Oe,Pe,Ne){var xe,je=l.gl;if(!this.failedToCreate){for(var Ke in l.program.set(this.program),l.setDepthMode(c),l.setStencilMode(d),l.setColorMode(E),l.setCullFace(w),this.fixedUniforms)this.fixedUniforms[Ke].set(P[Ke]);Oe&&Oe.setUniforms(l,this.binderUniforms,se,{zoom:le});for(var vt=(xe={},xe[je.LINES]=2,xe[je.TRIANGLES]=3,xe[je.LINE_STRIP]=1,xe)[f],Wt=0,Zt=ae.get();Wt<Zt.length;Wt+=1){var qt=Zt[Wt],hr=qt.vaos||(qt.vaos={});(hr[L]||(hr[L]=new lu)).bind(l,this,U,Oe?Oe.getPaintVertexBuffers():[],H,qt.vertexOffset,Pe,Ne),je.drawElements(f,qt.primitiveLength*vt,je.UNSIGNED_SHORT,qt.primitiveOffset*vt*2)}}};var kc=function(l,f,c,d){var E=f.style.light,w=E.properties.get("position"),P=[w.x,w.y,w.z],L=m.create$1();E.properties.get("anchor")==="viewport"&&m.fromRotation(L,-f.transform.angle),m.transformMat3(P,P,L);var U=E.properties.get("color");return{u_matrix:l,u_lightpos:P,u_lightintensity:E.properties.get("intensity"),u_lightcolor:[U.r,U.g,U.b],u_vertical_gradient:+c,u_opacity:d}},Au=function(l,f,c,d,E,w,P){return m.extend(kc(l,f,c,d),ol(w,f,P),{u_height_factor:-Math.pow(2,E.overscaledZ)/P.tileSize/8})},wu=function(l){return{u_matrix:l}},Tu=function(l,f,c,d){return m.extend(wu(l),ol(c,f,d))},lo=function(l,f){return{u_matrix:l,u_world:f}},Zf=function(l,f,c,d,E){return m.extend(Tu(l,f,c,d),{u_world:E})},jf=function(l,f,c,d){var E,w,P=l.transform;if(d.paint.get("circle-pitch-alignment")==="map"){var L=oa(c,1,P.zoom);E=!0,w=[L,L]}else E=!1,w=P.pixelsToGLUnits;return{u_camera_to_center_distance:P.cameraToCenterDistance,u_scale_with_map:+(d.paint.get("circle-pitch-scale")==="map"),u_matrix:l.translatePosMatrix(f.posMatrix,c,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_pitch_with_map:+E,u_device_pixel_ratio:m.browser.devicePixelRatio,u_extrude_scale:w}},Ko=function(l,f,c){var d=oa(c,1,f.zoom),E=Math.pow(2,f.zoom-c.tileID.overscaledZ),w=c.tileID.overscaleFactor();return{u_matrix:l,u_camera_to_center_distance:f.cameraToCenterDistance,u_pixels_to_tile_units:d,u_extrude_scale:[f.pixelsToGLUnits[0]/(d*E),f.pixelsToGLUnits[1]/(d*E)],u_overscale_factor:w}},Lc=function(l,f,c){return{u_matrix:l,u_inv_matrix:f,u_camera_to_center_distance:c.cameraToCenterDistance,u_viewport_size:[c.width,c.height]}},Mu=function(l,f,c){return c===void 0&&(c=1),{u_matrix:l,u_color:f,u_overlay:0,u_overlay_scale:c}},cu=function(l){return{u_matrix:l}},df=function(l,f,c,d){return{u_matrix:l,u_extrude_scale:oa(f,1,c),u_intensity:d}},Il=function(l,f,c){var d=l.transform;return{u_matrix:Dc(l,f,c),u_ratio:1/oa(f,1,d.zoom),u_device_pixel_ratio:m.browser.devicePixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},Fi=function(l,f,c,d){return m.extend(Il(l,f,c),{u_image:0,u_image_height:d})},Ol=function(l,f,c,d){var E=l.transform,w=sl(f,E);return{u_matrix:Dc(l,f,c),u_texsize:f.imageAtlasTexture.size,u_ratio:1/oa(f,1,E.zoom),u_device_pixel_ratio:m.browser.devicePixelRatio,u_image:0,u_scale:[w,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]]}},Ap=function(l,f,c,d,E){var w=l.lineAtlas,P=sl(f,l.transform),L=c.layout.get("line-cap")==="round",U=w.getDash(d.from,L),H=w.getDash(d.to,L),ae=U.width*E.fromScale,se=H.width*E.toScale;return m.extend(Il(l,f,c),{u_patternscale_a:[P/ae,-U.height/2],u_patternscale_b:[P/se,-H.height/2],u_sdfgamma:w.width/(256*Math.min(ae,se)*m.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:U.y,u_tex_y_b:H.y,u_mix:E.t})};function sl(l,f){return 1/oa(l,1,f.tileZoom)}function Dc(l,f,c){return l.translatePosMatrix(f.tileID.posMatrix,f,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}var Vf=function(l,f,c,d,E){return{u_matrix:l,u_tl_parent:f,u_scale_parent:c,u_buffer_scale:1,u_fade_t:d.mix,u_opacity:d.opacity*E.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:E.paint.get("raster-brightness-min"),u_brightness_high:E.paint.get("raster-brightness-max"),u_saturation_factor:(P=E.paint.get("raster-saturation"),P>0?1-1/(1.001-P):-P),u_contrast_factor:(w=E.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:wp(E.paint.get("raster-hue-rotate"))};var w,P};function wp(l){l*=Math.PI/180;var f=Math.sin(l),c=Math.cos(l);return[(2*c+1)/3,(-Math.sqrt(3)*f-c+1)/3,(Math.sqrt(3)*f-c+1)/3]}var Gf,Fc=function(l,f,c,d,E,w,P,L,U,H){var ae=E.transform;return{u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:f?f.uSizeT:0,u_size:f?f.uSize:0,u_camera_to_center_distance:ae.cameraToCenterDistance,u_pitch:ae.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:ae.width/ae.height,u_fade_change:E.options.fadeDuration?E.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:P,u_coord_matrix:L,u_is_text:+U,u_pitch_with_map:+d,u_texsize:H,u_texture:0}},nc=function(l,f,c,d,E,w,P,L,U,H,ae){var se=E.transform;return m.extend(Fc(l,f,c,d,E,w,P,L,U,H),{u_gamma_scale:d?Math.cos(se._pitch)*se.cameraToCenterDistance:1,u_device_pixel_ratio:m.browser.devicePixelRatio,u_is_halo:+ae})},ic=function(l,f,c,d,E,w,P,L,U,H){return m.extend(nc(l,f,c,d,E,w,P,L,!0,U,!0),{u_texsize_icon:H,u_texture_icon:1})},Rl=function(l,f,c){return{u_matrix:l,u_opacity:f,u_color:c}},ul=function(l,f,c,d,E,w){return m.extend(function(P,L,U,H){var ae=U.imageManager.getPattern(P.from.toString()),se=U.imageManager.getPattern(P.to.toString()),le=U.imageManager.getPixelSize(),Oe=le.width,Pe=le.height,Ne=Math.pow(2,H.tileID.overscaledZ),xe=H.tileSize*Math.pow(2,U.transform.tileZoom)/Ne,je=xe*(H.tileID.canonical.x+H.tileID.wrap*Ne),Ke=xe*H.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:ae.tl,u_pattern_br_a:ae.br,u_pattern_tl_b:se.tl,u_pattern_br_b:se.br,u_texsize:[Oe,Pe],u_mix:L.t,u_pattern_size_a:ae.displaySize,u_pattern_size_b:se.displaySize,u_scale_a:L.fromScale,u_scale_b:L.toScale,u_tile_units_to_pixels:1/oa(H,1,U.transform.tileZoom),u_pixel_coord_upper:[je>>16,Ke>>16],u_pixel_coord_lower:[65535&je,65535&Ke]}}(d,w,c,E),{u_matrix:l,u_opacity:f})},kl={fillExtrusion:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_lightpos:new m.Uniform3f(l,f.u_lightpos),u_lightintensity:new m.Uniform1f(l,f.u_lightintensity),u_lightcolor:new m.Uniform3f(l,f.u_lightcolor),u_vertical_gradient:new m.Uniform1f(l,f.u_vertical_gradient),u_opacity:new m.Uniform1f(l,f.u_opacity)}},fillExtrusionPattern:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_lightpos:new m.Uniform3f(l,f.u_lightpos),u_lightintensity:new m.Uniform1f(l,f.u_lightintensity),u_lightcolor:new m.Uniform3f(l,f.u_lightcolor),u_vertical_gradient:new m.Uniform1f(l,f.u_vertical_gradient),u_height_factor:new m.Uniform1f(l,f.u_height_factor),u_image:new m.Uniform1i(l,f.u_image),u_texsize:new m.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new m.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new m.Uniform3f(l,f.u_scale),u_fade:new m.Uniform1f(l,f.u_fade),u_opacity:new m.Uniform1f(l,f.u_opacity)}},fill:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix)}},fillPattern:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_image:new m.Uniform1i(l,f.u_image),u_texsize:new m.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new m.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new m.Uniform3f(l,f.u_scale),u_fade:new m.Uniform1f(l,f.u_fade)}},fillOutline:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_world:new m.Uniform2f(l,f.u_world)}},fillOutlinePattern:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_world:new m.Uniform2f(l,f.u_world),u_image:new m.Uniform1i(l,f.u_image),u_texsize:new m.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new m.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new m.Uniform3f(l,f.u_scale),u_fade:new m.Uniform1f(l,f.u_fade)}},circle:function(l,f){return{u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_scale_with_map:new m.Uniform1i(l,f.u_scale_with_map),u_pitch_with_map:new m.Uniform1i(l,f.u_pitch_with_map),u_extrude_scale:new m.Uniform2f(l,f.u_extrude_scale),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_matrix:new m.UniformMatrix4f(l,f.u_matrix)}},collisionBox:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_pixels_to_tile_units:new m.Uniform1f(l,f.u_pixels_to_tile_units),u_extrude_scale:new m.Uniform2f(l,f.u_extrude_scale),u_overscale_factor:new m.Uniform1f(l,f.u_overscale_factor)}},collisionCircle:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_inv_matrix:new m.UniformMatrix4f(l,f.u_inv_matrix),u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_viewport_size:new m.Uniform2f(l,f.u_viewport_size)}},debug:function(l,f){return{u_color:new m.UniformColor(l,f.u_color),u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_overlay:new m.Uniform1i(l,f.u_overlay),u_overlay_scale:new m.Uniform1f(l,f.u_overlay_scale)}},clippingMask:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix)}},heatmap:function(l,f){return{u_extrude_scale:new m.Uniform1f(l,f.u_extrude_scale),u_intensity:new m.Uniform1f(l,f.u_intensity),u_matrix:new m.UniformMatrix4f(l,f.u_matrix)}},heatmapTexture:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_world:new m.Uniform2f(l,f.u_world),u_image:new m.Uniform1i(l,f.u_image),u_color_ramp:new m.Uniform1i(l,f.u_color_ramp),u_opacity:new m.Uniform1f(l,f.u_opacity)}},hillshade:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_image:new m.Uniform1i(l,f.u_image),u_latrange:new m.Uniform2f(l,f.u_latrange),u_light:new m.Uniform2f(l,f.u_light),u_shadow:new m.UniformColor(l,f.u_shadow),u_highlight:new m.UniformColor(l,f.u_highlight),u_accent:new m.UniformColor(l,f.u_accent)}},hillshadePrepare:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_image:new m.Uniform1i(l,f.u_image),u_dimension:new m.Uniform2f(l,f.u_dimension),u_zoom:new m.Uniform1f(l,f.u_zoom),u_unpack:new m.Uniform4f(l,f.u_unpack)}},line:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_ratio:new m.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(l,f.u_units_to_pixels)}},lineGradient:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_ratio:new m.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(l,f.u_units_to_pixels),u_image:new m.Uniform1i(l,f.u_image),u_image_height:new m.Uniform1f(l,f.u_image_height)}},linePattern:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_texsize:new m.Uniform2f(l,f.u_texsize),u_ratio:new m.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_image:new m.Uniform1i(l,f.u_image),u_units_to_pixels:new m.Uniform2f(l,f.u_units_to_pixels),u_scale:new m.Uniform3f(l,f.u_scale),u_fade:new m.Uniform1f(l,f.u_fade)}},lineSDF:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_ratio:new m.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(l,f.u_units_to_pixels),u_patternscale_a:new m.Uniform2f(l,f.u_patternscale_a),u_patternscale_b:new m.Uniform2f(l,f.u_patternscale_b),u_sdfgamma:new m.Uniform1f(l,f.u_sdfgamma),u_image:new m.Uniform1i(l,f.u_image),u_tex_y_a:new m.Uniform1f(l,f.u_tex_y_a),u_tex_y_b:new m.Uniform1f(l,f.u_tex_y_b),u_mix:new m.Uniform1f(l,f.u_mix)}},raster:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_tl_parent:new m.Uniform2f(l,f.u_tl_parent),u_scale_parent:new m.Uniform1f(l,f.u_scale_parent),u_buffer_scale:new m.Uniform1f(l,f.u_buffer_scale),u_fade_t:new m.Uniform1f(l,f.u_fade_t),u_opacity:new m.Uniform1f(l,f.u_opacity),u_image0:new m.Uniform1i(l,f.u_image0),u_image1:new m.Uniform1i(l,f.u_image1),u_brightness_low:new m.Uniform1f(l,f.u_brightness_low),u_brightness_high:new m.Uniform1f(l,f.u_brightness_high),u_saturation_factor:new m.Uniform1f(l,f.u_saturation_factor),u_contrast_factor:new m.Uniform1f(l,f.u_contrast_factor),u_spin_weights:new m.Uniform3f(l,f.u_spin_weights)}},symbolIcon:function(l,f){return{u_is_size_zoom_constant:new m.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new m.Uniform1f(l,f.u_size_t),u_size:new m.Uniform1f(l,f.u_size),u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new m.Uniform1f(l,f.u_pitch),u_rotate_symbol:new m.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new m.Uniform1f(l,f.u_fade_change),u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new m.Uniform1i(l,f.u_is_text),u_pitch_with_map:new m.Uniform1i(l,f.u_pitch_with_map),u_texsize:new m.Uniform2f(l,f.u_texsize),u_texture:new m.Uniform1i(l,f.u_texture)}},symbolSDF:function(l,f){return{u_is_size_zoom_constant:new m.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new m.Uniform1f(l,f.u_size_t),u_size:new m.Uniform1f(l,f.u_size),u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new m.Uniform1f(l,f.u_pitch),u_rotate_symbol:new m.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new m.Uniform1f(l,f.u_fade_change),u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new m.Uniform1i(l,f.u_is_text),u_pitch_with_map:new m.Uniform1i(l,f.u_pitch_with_map),u_texsize:new m.Uniform2f(l,f.u_texsize),u_texture:new m.Uniform1i(l,f.u_texture),u_gamma_scale:new m.Uniform1f(l,f.u_gamma_scale),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_is_halo:new m.Uniform1i(l,f.u_is_halo)}},symbolTextAndIcon:function(l,f){return{u_is_size_zoom_constant:new m.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new m.Uniform1f(l,f.u_size_t),u_size:new m.Uniform1f(l,f.u_size),u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new m.Uniform1f(l,f.u_pitch),u_rotate_symbol:new m.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new m.Uniform1f(l,f.u_fade_change),u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new m.Uniform1i(l,f.u_is_text),u_pitch_with_map:new m.Uniform1i(l,f.u_pitch_with_map),u_texsize:new m.Uniform2f(l,f.u_texsize),u_texsize_icon:new m.Uniform2f(l,f.u_texsize_icon),u_texture:new m.Uniform1i(l,f.u_texture),u_texture_icon:new m.Uniform1i(l,f.u_texture_icon),u_gamma_scale:new m.Uniform1f(l,f.u_gamma_scale),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_is_halo:new m.Uniform1i(l,f.u_is_halo)}},background:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_opacity:new m.Uniform1f(l,f.u_opacity),u_color:new m.UniformColor(l,f.u_color)}},backgroundPattern:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_opacity:new m.Uniform1f(l,f.u_opacity),u_image:new m.Uniform1i(l,f.u_image),u_pattern_tl_a:new m.Uniform2f(l,f.u_pattern_tl_a),u_pattern_br_a:new m.Uniform2f(l,f.u_pattern_br_a),u_pattern_tl_b:new m.Uniform2f(l,f.u_pattern_tl_b),u_pattern_br_b:new m.Uniform2f(l,f.u_pattern_br_b),u_texsize:new m.Uniform2f(l,f.u_texsize),u_mix:new m.Uniform1f(l,f.u_mix),u_pattern_size_a:new m.Uniform2f(l,f.u_pattern_size_a),u_pattern_size_b:new m.Uniform2f(l,f.u_pattern_size_b),u_scale_a:new m.Uniform1f(l,f.u_scale_a),u_scale_b:new m.Uniform1f(l,f.u_scale_b),u_pixel_coord_upper:new m.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,f.u_pixel_coord_lower),u_tile_units_to_pixels:new m.Uniform1f(l,f.u_tile_units_to_pixels)}}};function Yu(l,f,c,d,E,w,P){for(var L=l.context,U=L.gl,H=l.useProgram("collisionBox"),ae=[],se=0,le=0,Oe=0;Oe<d.length;Oe++){var Pe=d[Oe],Ne=f.getTile(Pe),xe=Ne.getBucket(c);if(xe){var je=Pe.posMatrix;E[0]===0&&E[1]===0||(je=l.translatePosMatrix(Pe.posMatrix,Ne,E,w));var Ke=P?xe.textCollisionBox:xe.iconCollisionBox,vt=xe.collisionCircleArray;if(vt.length>0){var Wt=m.create(),Zt=je;m.mul(Wt,xe.placementInvProjMatrix,l.transform.glCoordMatrix),m.mul(Wt,Wt,xe.placementViewportMatrix),ae.push({circleArray:vt,circleOffset:le,transform:Zt,invTransform:Wt}),le=se+=vt.length/4}Ke&&H.draw(L,U.LINES,he.disabled,Me.disabled,l.colorModeForRenderPass(),Qe.disabled,Ko(je,l.transform,Ne),c.id,Ke.layoutVertexBuffer,Ke.indexBuffer,Ke.segments,null,l.transform.zoom,null,null,Ke.collisionVertexBuffer)}}if(P&&ae.length){var qt=l.useProgram("collisionCircle"),hr=new m.StructArrayLayout2f1f2i16;hr.resize(4*se),hr._trim();for(var kr=0,yr=0,sn=ae;yr<sn.length;yr+=1)for(var Zn=sn[yr],jn=0;jn<Zn.circleArray.length/4;jn++){var Ln=4*jn,Ri=Zn.circleArray[Ln+0],tn=Zn.circleArray[Ln+1],ni=Zn.circleArray[Ln+2],li=Zn.circleArray[Ln+3];hr.emplace(kr++,Ri,tn,ni,li,0),hr.emplace(kr++,Ri,tn,ni,li,1),hr.emplace(kr++,Ri,tn,ni,li,2),hr.emplace(kr++,Ri,tn,ni,li,3)}(!Gf||Gf.length<2*se)&&(Gf=function(Qa){var To=2*Qa,Da=new m.StructArrayLayout3ui6;Da.resize(To),Da._trim();for(var Ga=0;Ga<To;Ga++){var fo=6*Ga;Da.uint16[fo+0]=4*Ga+0,Da.uint16[fo+1]=4*Ga+1,Da.uint16[fo+2]=4*Ga+2,Da.uint16[fo+3]=4*Ga+2,Da.uint16[fo+4]=4*Ga+3,Da.uint16[fo+5]=4*Ga+0}return Da}(se));for(var Kn=L.createIndexBuffer(Gf,!0),Hn=L.createVertexBuffer(hr,m.collisionCircleLayout.members,!0),hi=0,qn=ae;hi<qn.length;hi+=1){var Xn=qn[hi],go=Lc(Xn.transform,Xn.invTransform,l.transform);qt.draw(L,U.TRIANGLES,he.disabled,Me.disabled,l.colorModeForRenderPass(),Qe.disabled,go,c.id,Hn,Kn,m.SegmentVector.simpleSegment(0,2*Xn.circleOffset,Xn.circleArray.length,Xn.circleArray.length/2),null,l.transform.zoom,null,null,null)}Hn.destroy(),Kn.destroy()}}var Ys=m.identity(new Float32Array(16));function vf(l,f,c,d,E,w){var P=m.getAnchorAlignment(l),L=-(P.horizontalAlign-.5)*f,U=-(P.verticalAlign-.5)*c,H=m.evaluateVariableOffset(l,d);return new m.Point((L/E+H[0])*w,(U/E+H[1])*w)}function mf(l,f,c,d,E,w,P,L,U,H,ae){var se=l.text.placedSymbolArray,le=l.text.dynamicLayoutVertexArray,Oe=l.icon.dynamicLayoutVertexArray,Pe={};le.clear();for(var Ne=0;Ne<se.length;Ne++){var xe=se.get(Ne),je=xe.hidden||!xe.crossTileID||l.allowVerticalPlacement&&!xe.placedOrientation?null:d[xe.crossTileID];if(je){var Ke=new m.Point(xe.anchorX,xe.anchorY),vt=Ti(Ke,c?L:P),Wt=Ui(w.cameraToCenterDistance,vt.signedDistanceFromCamera),Zt=E.evaluateSizeForFeature(l.textSizeData,H,xe)*Wt/m.ONE_EM;c&&(Zt*=l.tilePixelRatio/U);for(var qt=vf(je.anchor,je.width,je.height,je.textOffset,je.textBoxScale,Zt),hr=c?Ti(Ke.add(qt),P).point:vt.point.add(f?qt.rotate(-w.angle):qt),kr=l.allowVerticalPlacement&&xe.placedOrientation===m.WritingMode.vertical?Math.PI/2:0,yr=0;yr<xe.numGlyphs;yr++)m.addDynamicAttributes(le,hr,kr);ae&&xe.associatedIconIndex>=0&&(Pe[xe.associatedIconIndex]={shiftedAnchor:hr,angle:kr})}else za(xe.numGlyphs,le)}if(ae){Oe.clear();for(var sn=l.icon.placedSymbolArray,Zn=0;Zn<sn.length;Zn++){var jn=sn.get(Zn);if(jn.hidden)za(jn.numGlyphs,Oe);else{var Ln=Pe[Zn];if(Ln)for(var Ri=0;Ri<jn.numGlyphs;Ri++)m.addDynamicAttributes(Oe,Ln.shiftedAnchor,Ln.angle);else za(jn.numGlyphs,Oe)}}l.icon.dynamicLayoutVertexBuffer.updateData(Oe)}l.text.dynamicLayoutVertexBuffer.updateData(le)}function Hf(l,f,c){return c.iconsInText&&f?"symbolTextAndIcon":l?"symbolSDF":"symbolIcon"}function fu(l,f,c,d,E,w,P,L,U,H,ae,se){for(var le=l.context,Oe=le.gl,Pe=l.transform,Ne=L==="map",xe=U==="map",je=Ne&&c.layout.get("symbol-placement")!=="point",Ke=Ne&&!xe&&!je,vt=c.layout.get("symbol-sort-key").constantOr(1)!==void 0,Wt=!1,Zt=l.depthModeForSublayer(0,he.ReadOnly),qt=c.layout.get("text-variable-anchor"),hr=[],kr=0,yr=d;kr<yr.length;kr+=1){var sn=yr[kr],Zn=f.getTile(sn),jn=Zn.getBucket(c);if(jn){var Ln=E?jn.text:jn.icon;if(Ln&&Ln.segments.get().length){var Ri=Ln.programConfigurations.get(c.id),tn=E||jn.sdfIcons,ni=E?jn.textSizeData:jn.iconSizeData,li=xe||Pe.pitch!==0,Kn=l.useProgram(Hf(tn,E,jn),Ri),Hn=m.evaluateSizeForZoom(ni,Pe.zoom),hi=void 0,qn=[0,0],Xn=void 0,go=void 0,Qa=null,To=void 0;if(E)Xn=Zn.glyphAtlasTexture,go=Oe.LINEAR,hi=Zn.glyphAtlasTexture.size,jn.iconsInText&&(qn=Zn.imageAtlasTexture.size,Qa=Zn.imageAtlasTexture,To=li||l.options.rotating||l.options.zooming||ni.kind==="composite"||ni.kind==="camera"?Oe.LINEAR:Oe.NEAREST);else{var Da=c.layout.get("icon-size").constantOr(0)!==1||jn.iconsNeedLinear;Xn=Zn.imageAtlasTexture,go=tn||l.options.rotating||l.options.zooming||Da||li?Oe.LINEAR:Oe.NEAREST,hi=Zn.imageAtlasTexture.size}var Ga=oa(Zn,1,l.transform.zoom),fo=wa(sn.posMatrix,xe,Ne,l.transform,Ga),Is=Ei(sn.posMatrix,xe,Ne,l.transform,Ga),is=qt&&jn.hasTextData(),Du=c.layout.get("icon-text-fit")!=="none"&&is&&jn.hasIconData();je&&on(jn,sn.posMatrix,l,E,fo,Is,xe,H);var as=l.translatePosMatrix(sn.posMatrix,Zn,w,P),mu=je||E&&qt||Du?Ys:fo,Os=l.translatePosMatrix(Is,Zn,w,P,!0),Es=tn&&c.paint.get(E?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Vl={program:Kn,buffers:Ln,uniformValues:tn?jn.iconsInText?ic(ni.kind,Hn,Ke,xe,l,as,mu,Os,hi,qn):nc(ni.kind,Hn,Ke,xe,l,as,mu,Os,E,hi,!0):Fc(ni.kind,Hn,Ke,xe,l,as,mu,Os,E,hi),atlasTexture:Xn,atlasTextureIcon:Qa,atlasInterpolation:go,atlasInterpolationIcon:To,isSDF:tn,hasHalo:Es};if(vt&&jn.canOverlap){Wt=!0;for(var Fu=0,gl=Ln.segments.get();Fu<gl.length;Fu+=1){var Gl=gl[Fu];hr.push({segments:new m.SegmentVector([Gl]),sortKey:Gl.sortKey,state:Vl})}}else hr.push({segments:Ln.segments,sortKey:0,state:Vl})}}}Wt&&hr.sort(function(Nu,Ju){return Nu.sortKey-Ju.sortKey});for(var tu=0,yl=hr;tu<yl.length;tu+=1){var bu=yl[tu],Eo=bu.state;if(le.activeTexture.set(Oe.TEXTURE0),Eo.atlasTexture.bind(Eo.atlasInterpolation,Oe.CLAMP_TO_EDGE),Eo.atlasTextureIcon&&(le.activeTexture.set(Oe.TEXTURE1),Eo.atlasTextureIcon&&Eo.atlasTextureIcon.bind(Eo.atlasInterpolationIcon,Oe.CLAMP_TO_EDGE)),Eo.isSDF){var Bu=Eo.uniformValues;Eo.hasHalo&&(Bu.u_is_halo=1,ac(Eo.buffers,bu.segments,c,l,Eo.program,Zt,ae,se,Bu)),Bu.u_is_halo=0}ac(Eo.buffers,bu.segments,c,l,Eo.program,Zt,ae,se,Eo.uniformValues)}}function ac(l,f,c,d,E,w,P,L,U){var H=d.context;E.draw(H,H.gl.TRIANGLES,w,P,L,Qe.disabled,U,c.id,l.layoutVertexBuffer,l.indexBuffer,f,c.paint,d.transform.zoom,l.programConfigurations.get(c.id),l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer)}function Bc(l,f,c,d,E,w,P){var L,U,H,ae,se,le=l.context.gl,Oe=c.paint.get("fill-pattern"),Pe=Oe&&Oe.constantOr(1),Ne=c.getCrossfadeParameters();P?(U=Pe&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=le.LINES):(U=Pe?"fillPattern":"fill",L=le.TRIANGLES);for(var xe=0,je=d;xe<je.length;xe+=1){var Ke=je[xe],vt=f.getTile(Ke);if(!Pe||vt.patternsLoaded()){var Wt=vt.getBucket(c);if(Wt){var Zt=Wt.programConfigurations.get(c.id),qt=l.useProgram(U,Zt);Pe&&(l.context.activeTexture.set(le.TEXTURE0),vt.imageAtlasTexture.bind(le.LINEAR,le.CLAMP_TO_EDGE),Zt.updatePaintBuffers(Ne));var hr=Oe.constantOr(null);if(hr&&vt.imageAtlas){var kr=vt.imageAtlas,yr=kr.patternPositions[hr.to.toString()],sn=kr.patternPositions[hr.from.toString()];yr&&sn&&Zt.setConstantPatternPositions(yr,sn)}var Zn=l.translatePosMatrix(Ke.posMatrix,vt,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(P){ae=Wt.indexBuffer2,se=Wt.segments2;var jn=[le.drawingBufferWidth,le.drawingBufferHeight];H=U==="fillOutlinePattern"&&Pe?Zf(Zn,l,Ne,vt,jn):lo(Zn,jn)}else ae=Wt.indexBuffer,se=Wt.segments,H=Pe?Tu(Zn,l,Ne,vt):wu(Zn);qt.draw(l.context,L,E,l.stencilModeForClipping(Ke),w,Qe.disabled,H,c.id,Wt.layoutVertexBuffer,ae,se,c.paint,l.transform.zoom,Zt)}}}}function gf(l,f,c,d,E,w,P){for(var L=l.context,U=L.gl,H=c.paint.get("fill-extrusion-pattern"),ae=H.constantOr(1),se=c.getCrossfadeParameters(),le=c.paint.get("fill-extrusion-opacity"),Oe=0,Pe=d;Oe<Pe.length;Oe+=1){var Ne=Pe[Oe],xe=f.getTile(Ne),je=xe.getBucket(c);if(je){var Ke=je.programConfigurations.get(c.id),vt=l.useProgram(ae?"fillExtrusionPattern":"fillExtrusion",Ke);ae&&(l.context.activeTexture.set(U.TEXTURE0),xe.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),Ke.updatePaintBuffers(se));var Wt=H.constantOr(null);if(Wt&&xe.imageAtlas){var Zt=xe.imageAtlas,qt=Zt.patternPositions[Wt.to.toString()],hr=Zt.patternPositions[Wt.from.toString()];qt&&hr&&Ke.setConstantPatternPositions(qt,hr)}var kr=l.translatePosMatrix(Ne.posMatrix,xe,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),yr=c.paint.get("fill-extrusion-vertical-gradient"),sn=ae?Au(kr,l,yr,le,Ne,se,xe):kc(kr,l,yr,le);vt.draw(L,L.gl.TRIANGLES,E,w,P,Qe.backCCW,sn,c.id,je.layoutVertexBuffer,je.indexBuffer,je.segments,c.paint,l.transform.zoom,Ke)}}}function Ll(l,f,c,d,E,w){var P=l.context,L=P.gl,U=f.fbo;if(U){var H=l.useProgram("hillshade");P.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,U.colorAttachment.get());var ae=function(se,le,Oe){var Pe=Oe.paint.get("hillshade-shadow-color"),Ne=Oe.paint.get("hillshade-highlight-color"),xe=Oe.paint.get("hillshade-accent-color"),je=Oe.paint.get("hillshade-illumination-direction")*(Math.PI/180);Oe.paint.get("hillshade-illumination-anchor")==="viewport"&&(je-=se.transform.angle);var Ke,vt,Wt,Zt=!se.options.moving;return{u_matrix:se.transform.calculatePosMatrix(le.tileID.toUnwrapped(),Zt),u_image:0,u_latrange:(Ke=le.tileID,vt=Math.pow(2,Ke.canonical.z),Wt=Ke.canonical.y,[new m.MercatorCoordinate(0,Wt/vt).toLngLat().lat,new m.MercatorCoordinate(0,(Wt+1)/vt).toLngLat().lat]),u_light:[Oe.paint.get("hillshade-exaggeration"),je],u_shadow:Pe,u_highlight:Ne,u_accent:xe}}(l,f,c);H.draw(P,L.TRIANGLES,d,E,w,Qe.disabled,ae,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}}function uh(l,f,c,d,E,w){var P=l.context,L=P.gl,U=f.dem;if(U&&U.data){var H=U.dim,ae=U.stride,se=U.getPixels();if(P.activeTexture.set(L.TEXTURE1),P.pixelStoreUnpackPremultiplyAlpha.set(!1),f.demTexture=f.demTexture||l.getTileTexture(ae),f.demTexture){var le=f.demTexture;le.update(se,{premultiply:!1}),le.bind(L.NEAREST,L.CLAMP_TO_EDGE)}else f.demTexture=new m.Texture(P,se,L.RGBA,{premultiply:!1}),f.demTexture.bind(L.NEAREST,L.CLAMP_TO_EDGE);P.activeTexture.set(L.TEXTURE0);var Oe=f.fbo;if(!Oe){var Pe=new m.Texture(P,{width:H,height:H,data:null},L.RGBA);Pe.bind(L.LINEAR,L.CLAMP_TO_EDGE),(Oe=f.fbo=P.createFramebuffer(H,H,!0)).colorAttachment.set(Pe.texture)}P.bindFramebuffer.set(Oe.framebuffer),P.viewport.set([0,0,H,H]),l.useProgram("hillshadePrepare").draw(P,L.TRIANGLES,d,E,w,Qe.disabled,function(Ne,xe){var je=xe.stride,Ke=m.create();return m.ortho(Ke,0,m.EXTENT,-m.EXTENT,0,0,1),m.translate(Ke,Ke,[0,-m.EXTENT,0]),{u_matrix:Ke,u_image:1,u_dimension:[je,je],u_zoom:Ne.overscaledZ,u_unpack:xe.getUnpackVector()}}(f.tileID,U),c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments),f.needsHillshadePrepare=!1}}function yf(l,f,c,d,E){var w=d.paint.get("raster-fade-duration");if(w>0){var P=m.browser.now(),L=(P-l.timeAdded)/w,U=f?(P-f.timeAdded)/w:-1,H=c.getSource(),ae=E.coveringZoomLevel({tileSize:H.tileSize,roundZoom:H.roundZoom}),se=!f||Math.abs(f.tileID.overscaledZ-ae)>Math.abs(l.tileID.overscaledZ-ae),le=se&&l.refreshedUponExpiration?1:m.clamp(se?L:1-U,0,1);return l.refreshedUponExpiration&&L>=1&&(l.refreshedUponExpiration=!1),f?{opacity:1,mix:1-le}:{opacity:le,mix:0}}return{opacity:1,mix:0}}var Dl=new m.Color(1,0,0,1),_f=new m.Color(0,1,0,1),xf=new m.Color(0,0,1,1),Fl=new m.Color(1,0,1,1),Nc=new m.Color(0,1,1,1);function Tp(l,f,c,d){oc(l,0,f+c/2,l.transform.width,c,d)}function Mp(l,f,c,d){oc(l,f-c/2,0,c,l.transform.height,d)}function oc(l,f,c,d,E,w){var P=l.context,L=P.gl;L.enable(L.SCISSOR_TEST),L.scissor(f*m.browser.devicePixelRatio,c*m.browser.devicePixelRatio,d*m.browser.devicePixelRatio,E*m.browser.devicePixelRatio),P.clear({color:w}),L.disable(L.SCISSOR_TEST)}function Pp(l,f,c){var d=l.context,E=d.gl,w=c.posMatrix,P=l.useProgram("debug"),L=he.disabled,U=Me.disabled,H=l.colorModeForRenderPass();d.activeTexture.set(E.TEXTURE0),l.emptyTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),P.draw(d,E.LINE_STRIP,L,U,H,Qe.disabled,Mu(w,m.Color.red),"$debug",l.debugBuffer,l.tileBorderIndexBuffer,l.debugSegments);var ae=f.getTileByID(c.key).latestRawTileData,se=Math.floor((ae&&ae.byteLength||0)/1024),le=f.getTile(c).tileSize,Oe=512/Math.min(le,512)*(c.overscaledZ/l.transform.zoom)*.5,Pe=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(Pe+=" => "+c.overscaledZ),function(Ne,xe){Ne.initDebugOverlayCanvas();var je=Ne.debugOverlayCanvas,Ke=Ne.context.gl,vt=Ne.debugOverlayCanvas.getContext("2d");vt.clearRect(0,0,je.width,je.height),vt.shadowColor="white",vt.shadowBlur=2,vt.lineWidth=1.5,vt.strokeStyle="white",vt.textBaseline="top",vt.font="bold 36px Open Sans, sans-serif",vt.fillText(xe,5,5),vt.strokeText(xe,5,5),Ne.debugOverlayTexture.update(je),Ne.debugOverlayTexture.bind(Ke.LINEAR,Ke.CLAMP_TO_EDGE)}(l,Pe+" "+se+"kb"),P.draw(d,E.TRIANGLES,L,U,Ge.alphaBlended,Qe.disabled,Mu(w,m.Color.transparent,Oe),"$debug",l.debugBuffer,l.quadTriangleIndexBuffer,l.debugSegments)}var Bl={symbol:function(l,f,c,d,E){if(l.renderPass==="translucent"){var w=Me.disabled,P=l.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(L,U,H,ae,se,le,Oe){for(var Pe=U.transform,Ne=se==="map",xe=le==="map",je=0,Ke=L;je<Ke.length;je+=1){var vt=Ke[je],Wt=ae.getTile(vt),Zt=Wt.getBucket(H);if(Zt&&Zt.text&&Zt.text.segments.get().length){var qt=m.evaluateSizeForZoom(Zt.textSizeData,Pe.zoom),hr=oa(Wt,1,U.transform.zoom),kr=wa(vt.posMatrix,xe,Ne,U.transform,hr),yr=H.layout.get("icon-text-fit")!=="none"&&Zt.hasIconData();if(qt){var sn=Math.pow(2,Pe.zoom-Wt.tileID.overscaledZ);mf(Zt,Ne,xe,Oe,m.symbolSize,Pe,kr,vt.posMatrix,sn,qt,yr)}}}}(d,l,c,f,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),E),c.paint.get("icon-opacity").constantOr(1)!==0&&fu(l,f,c,d,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),w,P),c.paint.get("text-opacity").constantOr(1)!==0&&fu(l,f,c,d,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),w,P),f.map.showCollisionBoxes&&(Yu(l,f,c,d,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),Yu(l,f,c,d,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))}},circle:function(l,f,c,d){if(l.renderPass==="translucent"){var E=c.paint.get("circle-opacity"),w=c.paint.get("circle-stroke-width"),P=c.paint.get("circle-stroke-opacity"),L=c.layout.get("circle-sort-key").constantOr(1)!==void 0;if(E.constantOr(1)!==0||w.constantOr(1)!==0&&P.constantOr(1)!==0){for(var U=l.context,H=U.gl,ae=l.depthModeForSublayer(0,he.ReadOnly),se=Me.disabled,le=l.colorModeForRenderPass(),Oe=[],Pe=0;Pe<d.length;Pe++){var Ne=d[Pe],xe=f.getTile(Ne),je=xe.getBucket(c);if(je){var Ke=je.programConfigurations.get(c.id),vt={programConfiguration:Ke,program:l.useProgram("circle",Ke),layoutVertexBuffer:je.layoutVertexBuffer,indexBuffer:je.indexBuffer,uniformValues:jf(l,Ne,xe,c)};if(L)for(var Wt=0,Zt=je.segments.get();Wt<Zt.length;Wt+=1){var qt=Zt[Wt];Oe.push({segments:new m.SegmentVector([qt]),sortKey:qt.sortKey,state:vt})}else Oe.push({segments:je.segments,sortKey:0,state:vt})}}L&&Oe.sort(function(Zn,jn){return Zn.sortKey-jn.sortKey});for(var hr=0,kr=Oe;hr<kr.length;hr+=1){var yr=kr[hr],sn=yr.state;sn.program.draw(U,H.TRIANGLES,ae,se,le,Qe.disabled,sn.uniformValues,c.id,sn.layoutVertexBuffer,sn.indexBuffer,yr.segments,c.paint,l.transform.zoom,sn.programConfiguration)}}}},heatmap:function(l,f,c,d){if(c.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){var E=l.context,w=E.gl,P=Me.disabled,L=new Ge([w.ONE,w.ONE],m.Color.transparent,[!0,!0,!0,!0]);(function(Oe,Pe,Ne){var xe=Oe.gl;Oe.activeTexture.set(xe.TEXTURE1),Oe.viewport.set([0,0,Pe.width/4,Pe.height/4]);var je=Ne.heatmapFbo;if(je)xe.bindTexture(xe.TEXTURE_2D,je.colorAttachment.get()),Oe.bindFramebuffer.set(je.framebuffer);else{var Ke=xe.createTexture();xe.bindTexture(xe.TEXTURE_2D,Ke),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_WRAP_S,xe.CLAMP_TO_EDGE),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_WRAP_T,xe.CLAMP_TO_EDGE),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_MIN_FILTER,xe.LINEAR),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_MAG_FILTER,xe.LINEAR),je=Ne.heatmapFbo=Oe.createFramebuffer(Pe.width/4,Pe.height/4,!1),function(vt,Wt,Zt,qt){var hr=vt.gl;hr.texImage2D(hr.TEXTURE_2D,0,hr.RGBA,Wt.width/4,Wt.height/4,0,hr.RGBA,vt.extRenderToTextureHalfFloat?vt.extTextureHalfFloat.HALF_FLOAT_OES:hr.UNSIGNED_BYTE,null),qt.colorAttachment.set(Zt)}(Oe,Pe,Ke,je)}})(E,l,c),E.clear({color:m.Color.transparent});for(var U=0;U<d.length;U++){var H=d[U];if(!f.hasRenderableParent(H)){var ae=f.getTile(H),se=ae.getBucket(c);if(se){var le=se.programConfigurations.get(c.id);l.useProgram("heatmap",le).draw(E,w.TRIANGLES,he.disabled,P,L,Qe.disabled,df(H.posMatrix,ae,l.transform.zoom,c.paint.get("heatmap-intensity")),c.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,c.paint,l.transform.zoom,le)}}}E.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(Oe,Pe){var Ne=Oe.context,xe=Ne.gl,je=Pe.heatmapFbo;if(je){Ne.activeTexture.set(xe.TEXTURE0),xe.bindTexture(xe.TEXTURE_2D,je.colorAttachment.get()),Ne.activeTexture.set(xe.TEXTURE1);var Ke=Pe.colorRampTexture;Ke||(Ke=Pe.colorRampTexture=new m.Texture(Ne,Pe.colorRamp,xe.RGBA)),Ke.bind(xe.LINEAR,xe.CLAMP_TO_EDGE),Oe.useProgram("heatmapTexture").draw(Ne,xe.TRIANGLES,he.disabled,Me.disabled,Oe.colorModeForRenderPass(),Qe.disabled,function(vt,Wt,Zt,qt){var hr=m.create();m.ortho(hr,0,vt.width,vt.height,0,0,1);var kr=vt.context.gl;return{u_matrix:hr,u_world:[kr.drawingBufferWidth,kr.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Wt.paint.get("heatmap-opacity")}}(Oe,Pe),Pe.id,Oe.viewportBuffer,Oe.quadTriangleIndexBuffer,Oe.viewportSegments,Pe.paint,Oe.transform.zoom)}}(l,c))},line:function(l,f,c,d){if(l.renderPass==="translucent"){var E=c.paint.get("line-opacity"),w=c.paint.get("line-width");if(E.constantOr(1)!==0&&w.constantOr(1)!==0)for(var P=l.depthModeForSublayer(0,he.ReadOnly),L=l.colorModeForRenderPass(),U=c.paint.get("line-dasharray"),H=c.paint.get("line-pattern"),ae=H.constantOr(1),se=c.paint.get("line-gradient"),le=c.getCrossfadeParameters(),Oe=ae?"linePattern":U?"lineSDF":se?"lineGradient":"line",Pe=l.context,Ne=Pe.gl,xe=!0,je=0,Ke=d;je<Ke.length;je+=1){var vt=Ke[je],Wt=f.getTile(vt);if(!ae||Wt.patternsLoaded()){var Zt=Wt.getBucket(c);if(Zt){var qt=Zt.programConfigurations.get(c.id),hr=l.context.program.get(),kr=l.useProgram(Oe,qt),yr=xe||kr.program!==hr,sn=H.constantOr(null);if(sn&&Wt.imageAtlas){var Zn=Wt.imageAtlas,jn=Zn.patternPositions[sn.to.toString()],Ln=Zn.patternPositions[sn.from.toString()];jn&&Ln&&qt.setConstantPatternPositions(jn,Ln)}var Ri=ae?Ol(l,Wt,c,le):U?Ap(l,Wt,c,U,le):se?Fi(l,Wt,c,Zt.lineClipsArray.length):Il(l,Wt,c);if(ae)Pe.activeTexture.set(Ne.TEXTURE0),Wt.imageAtlasTexture.bind(Ne.LINEAR,Ne.CLAMP_TO_EDGE),qt.updatePaintBuffers(le);else if(U&&(yr||l.lineAtlas.dirty))Pe.activeTexture.set(Ne.TEXTURE0),l.lineAtlas.bind(Pe);else if(se){var tn=Zt.gradients[c.id],ni=tn.texture;if(c.gradientVersion!==tn.version){var li=256;if(c.stepInterpolant){var Kn=f.getSource().maxzoom,Hn=vt.canonical.z===Kn?Math.ceil(1<<l.transform.maxZoom-vt.canonical.z):1;li=m.clamp(m.nextPowerOfTwo(Zt.maxLineLength/m.EXTENT*1024*Hn),256,Pe.maxTextureSize)}tn.gradient=m.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:li,image:tn.gradient||void 0,clips:Zt.lineClipsArray}),tn.texture?tn.texture.update(tn.gradient):tn.texture=new m.Texture(Pe,tn.gradient,Ne.RGBA),tn.version=c.gradientVersion,ni=tn.texture}Pe.activeTexture.set(Ne.TEXTURE0),ni.bind(c.stepInterpolant?Ne.NEAREST:Ne.LINEAR,Ne.CLAMP_TO_EDGE)}kr.draw(Pe,Ne.TRIANGLES,P,l.stencilModeForClipping(vt),L,Qe.disabled,Ri,c.id,Zt.layoutVertexBuffer,Zt.indexBuffer,Zt.segments,c.paint,l.transform.zoom,qt,Zt.layoutVertexBuffer2),xe=!1}}}}},fill:function(l,f,c,d){var E=c.paint.get("fill-color"),w=c.paint.get("fill-opacity");if(w.constantOr(1)!==0){var P=l.colorModeForRenderPass(),L=c.paint.get("fill-pattern"),U=l.opaquePassEnabledForLayer()&&!L.constantOr(1)&&E.constantOr(m.Color.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";if(l.renderPass===U){var H=l.depthModeForSublayer(1,l.renderPass==="opaque"?he.ReadWrite:he.ReadOnly);Bc(l,f,c,d,H,P,!1)}if(l.renderPass==="translucent"&&c.paint.get("fill-antialias")){var ae=l.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,he.ReadOnly);Bc(l,f,c,d,ae,P,!0)}}},"fill-extrusion":function(l,f,c,d){var E=c.paint.get("fill-extrusion-opacity");if(E!==0&&l.renderPass==="translucent"){var w=new he(l.context.gl.LEQUAL,he.ReadWrite,l.depthRangeFor3D);if(E!==1||c.paint.get("fill-extrusion-pattern").constantOr(1))gf(l,f,c,d,w,Me.disabled,Ge.disabled),gf(l,f,c,d,w,l.stencilModeFor3D(),l.colorModeForRenderPass());else{var P=l.colorModeForRenderPass();gf(l,f,c,d,w,Me.disabled,P)}}},hillshade:function(l,f,c,d){if(l.renderPass==="offscreen"||l.renderPass==="translucent"){for(var E=l.context,w=l.depthModeForSublayer(0,he.ReadOnly),P=l.colorModeForRenderPass(),L=l.renderPass==="translucent"?l.stencilConfigForOverlap(d):[{},d],U=L[0],H=0,ae=L[1];H<ae.length;H+=1){var se=ae[H],le=f.getTile(se);le.needsHillshadePrepare&&l.renderPass==="offscreen"?uh(l,le,c,w,Me.disabled,P):l.renderPass==="translucent"&&Ll(l,le,c,w,U[se.overscaledZ],P)}E.viewport.set([0,0,l.width,l.height])}},raster:function(l,f,c,d){if(l.renderPass==="translucent"&&c.paint.get("raster-opacity")!==0&&d.length)for(var E=l.context,w=E.gl,P=f.getSource(),L=l.useProgram("raster"),U=l.colorModeForRenderPass(),H=P instanceof ft?[{},d]:l.stencilConfigForOverlap(d),ae=H[0],se=H[1],le=se[se.length-1].overscaledZ,Oe=!l.options.moving,Pe=0,Ne=se;Pe<Ne.length;Pe+=1){var xe=Ne[Pe],je=l.depthModeForSublayer(xe.overscaledZ-le,c.paint.get("raster-opacity")===1?he.ReadWrite:he.ReadOnly,w.LESS),Ke=f.getTile(xe),vt=l.transform.calculatePosMatrix(xe.toUnwrapped(),Oe);Ke.registerFadeDuration(c.paint.get("raster-fade-duration"));var Wt=f.findLoadedParent(xe,0),Zt=yf(Ke,Wt,f,c,l.transform),qt=void 0,hr=void 0,kr=c.paint.get("raster-resampling")==="nearest"?w.NEAREST:w.LINEAR;E.activeTexture.set(w.TEXTURE0),Ke.texture.bind(kr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),E.activeTexture.set(w.TEXTURE1),Wt?(Wt.texture.bind(kr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),qt=Math.pow(2,Wt.tileID.overscaledZ-Ke.tileID.overscaledZ),hr=[Ke.tileID.canonical.x*qt%1,Ke.tileID.canonical.y*qt%1]):Ke.texture.bind(kr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST);var yr=Vf(vt,hr||[0,0],qt||1,Zt,c);P instanceof ft?L.draw(E,w.TRIANGLES,je,Me.disabled,U,Qe.disabled,yr,c.id,P.boundsBuffer,l.quadTriangleIndexBuffer,P.boundsSegments):L.draw(E,w.TRIANGLES,je,ae[xe.overscaledZ],U,Qe.disabled,yr,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}},background:function(l,f,c){var d=c.paint.get("background-color"),E=c.paint.get("background-opacity");if(E!==0){var w=l.context,P=w.gl,L=l.transform,U=L.tileSize,H=c.paint.get("background-pattern");if(!l.isPatternMissing(H)){var ae=!H&&d.a===1&&E===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass===ae){var se=Me.disabled,le=l.depthModeForSublayer(0,ae==="opaque"?he.ReadWrite:he.ReadOnly),Oe=l.colorModeForRenderPass(),Pe=l.useProgram(H?"backgroundPattern":"background"),Ne=L.coveringTiles({tileSize:U});H&&(w.activeTexture.set(P.TEXTURE0),l.imageManager.bind(l.context));for(var xe=c.getCrossfadeParameters(),je=0,Ke=Ne;je<Ke.length;je+=1){var vt=Ke[je],Wt=l.transform.calculatePosMatrix(vt.toUnwrapped()),Zt=H?ul(Wt,E,l,H,{tileID:vt,tileSize:U},xe):Rl(Wt,E,d);Pe.draw(w,P.TRIANGLES,le,se,Oe,Qe.disabled,Zt,c.id,l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments)}}}}},debug:function(l,f,c){for(var d=0;d<c.length;d++)Pp(l,f,c[d])},custom:function(l,f,c){var d=l.context,E=c.implementation;if(l.renderPass==="offscreen"){var w=E.prerender;w&&(l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),w.call(E,d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState())}else if(l.renderPass==="translucent"){l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),d.setStencilMode(Me.disabled);var P=E.renderingMode==="3d"?new he(l.context.gl.LEQUAL,he.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,he.ReadOnly);d.setDepthMode(P),E.render(d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState(),d.bindFramebuffer.set(null)}}},$i=function(l,f){this.context=new oe(l),this.transform=f,this._tileTextures={},this.setup(),this.numSublayers=Le.maxUnderzooming+Le.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new wo,this.gpuTimers={}};$i.prototype.resize=function(l,f){if(this.width=l*m.browser.devicePixelRatio,this.height=f*m.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var c=0,d=this.style._order;c<d.length;c+=1)this.style._layers[d[c]].resize()},$i.prototype.setup=function(){var l=this.context,f=new m.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(m.EXTENT,0),f.emplaceBack(0,m.EXTENT),f.emplaceBack(m.EXTENT,m.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(f,ma.members),this.tileExtentSegments=m.SegmentVector.simpleSegment(0,0,4,2);var c=new m.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(m.EXTENT,0),c.emplaceBack(0,m.EXTENT),c.emplaceBack(m.EXTENT,m.EXTENT),this.debugBuffer=l.createVertexBuffer(c,ma.members),this.debugSegments=m.SegmentVector.simpleSegment(0,0,4,5);var d=new m.StructArrayLayout4i8;d.emplaceBack(0,0,0,0),d.emplaceBack(m.EXTENT,0,m.EXTENT,0),d.emplaceBack(0,m.EXTENT,0,m.EXTENT),d.emplaceBack(m.EXTENT,m.EXTENT,m.EXTENT,m.EXTENT),this.rasterBoundsBuffer=l.createVertexBuffer(d,ut.members),this.rasterBoundsSegments=m.SegmentVector.simpleSegment(0,0,4,2);var E=new m.StructArrayLayout2i4;E.emplaceBack(0,0),E.emplaceBack(1,0),E.emplaceBack(0,1),E.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(E,ma.members),this.viewportSegments=m.SegmentVector.simpleSegment(0,0,4,2);var w=new m.StructArrayLayout1ui2;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(w);var P=new m.StructArrayLayout3ui6;P.emplaceBack(0,1,2),P.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(P),this.emptyTexture=new m.Texture(l,{width:1,height:1,data:new Uint8Array([0,0,0,0])},l.gl.RGBA);var L=this.context.gl;this.stencilClearMode=new Me({func:L.ALWAYS,mask:0},0,255,L.ZERO,L.ZERO,L.ZERO)},$i.prototype.clearStencil=function(){var l=this.context,f=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var c=m.create();m.ortho(c,0,this.width,this.height,0,0,1),m.scale(c,c,[f.drawingBufferWidth,f.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,f.TRIANGLES,he.disabled,this.stencilClearMode,Ge.disabled,Qe.disabled,cu(c),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},$i.prototype._renderTileClippingMasks=function(l,f){if(this.currentStencilSource!==l.source&&l.isTileClipped()&&f&&f.length){this.currentStencilSource=l.source;var c=this.context,d=c.gl;this.nextStencilID+f.length>256&&this.clearStencil(),c.setColorMode(Ge.disabled),c.setDepthMode(he.disabled);var E=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var w=0,P=f;w<P.length;w+=1){var L=P[w],U=this._tileClippingMaskIDs[L.key]=this.nextStencilID++;E.draw(c,d.TRIANGLES,he.disabled,new Me({func:d.ALWAYS,mask:0},U,255,d.KEEP,d.KEEP,d.REPLACE),Ge.disabled,Qe.disabled,cu(L.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},$i.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var l=this.nextStencilID++,f=this.context.gl;return new Me({func:f.NOTEQUAL,mask:255},l,255,f.KEEP,f.KEEP,f.REPLACE)},$i.prototype.stencilModeForClipping=function(l){var f=this.context.gl;return new Me({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,f.KEEP,f.KEEP,f.REPLACE)},$i.prototype.stencilConfigForOverlap=function(l){var f,c=this.context.gl,d=l.sort(function(U,H){return H.overscaledZ-U.overscaledZ}),E=d[d.length-1].overscaledZ,w=d[0].overscaledZ-E+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();for(var P={},L=0;L<w;L++)P[L+E]=new Me({func:c.GEQUAL,mask:255},L+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=w,[P,d]}return[(f={},f[E]=Me.disabled,f),d]},$i.prototype.colorModeForRenderPass=function(){var l=this.context.gl;return this._showOverdrawInspector?new Ge([l.CONSTANT_COLOR,l.ONE],new m.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ge.unblended:Ge.alphaBlended},$i.prototype.depthModeForSublayer=function(l,f,c){if(!this.opaquePassEnabledForLayer())return he.disabled;var d=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new he(c||this.context.gl.LEQUAL,f,[d,d])},$i.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},$i.prototype.render=function(l,f){var c=this;this.style=l,this.options=f,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(m.browser.now()),this.imageManager.beginFrame();var d=this.style._order,E=this.style.sourceCaches;for(var w in E){var P=E[w];P.used&&P.prepare(this.context)}var L,U,H={},ae={},se={};for(var le in E){var Oe=E[le];H[le]=Oe.getVisibleCoordinates(),ae[le]=H[le].slice().reverse(),se[le]=Oe.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Pe=0;Pe<d.length;Pe++)if(this.style._layers[d[Pe]].is3D()){this.opaquePassCutoff=Pe;break}this.renderPass="offscreen";for(var Ne=0,xe=d;Ne<xe.length;Ne+=1){var je=this.style._layers[xe[Ne]];if(je.hasOffscreenPass()&&!je.isHidden(this.transform.zoom)){var Ke=ae[je.source];(je.type==="custom"||Ke.length)&&this.renderLayer(this,E[je.source],je,Ke)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:f.showOverdrawInspector?m.Color.black:m.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){var vt=this.style._layers[d[this.currentLayer]],Wt=E[vt.source],Zt=H[vt.source];this._renderTileClippingMasks(vt,Zt),this.renderLayer(this,Wt,vt,Zt)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){var qt=this.style._layers[d[this.currentLayer]],hr=E[qt.source],kr=(qt.type==="symbol"?se:ae)[qt.source];this._renderTileClippingMasks(qt,H[qt.source]),this.renderLayer(this,hr,qt,kr)}this.options.showTileBoundaries&&(m.values(this.style._layers).forEach(function(yr){yr.source&&!yr.isHidden(c.transform.zoom)&&(yr.source!==(U&&U.id)&&(U=c.style.sourceCaches[yr.source]),(!L||L.getSource().maxzoom<U.getSource().maxzoom)&&(L=U))}),L&&Bl.debug(this,L,L.getVisibleCoordinates())),this.options.showPadding&&function(yr){var sn=yr.transform.padding;Tp(yr,yr.transform.height-(sn.top||0),3,Dl),Tp(yr,sn.bottom||0,3,_f),Mp(yr,sn.left||0,3,xf),Mp(yr,yr.transform.width-(sn.right||0),3,Fl);var Zn=yr.transform.centerPoint;(function(jn,Ln,Ri,tn){oc(jn,Ln-1,Ri-10,2,20,tn),oc(jn,Ln-10,Ri-1,20,2,tn)})(yr,Zn.x,yr.transform.height-Zn.y,Nc)}(this),this.context.setDefault()},$i.prototype.renderLayer=function(l,f,c,d){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||d.length)&&(this.id=c.id,this.gpuTimingStart(c),Bl[c.type](l,f,c,d,this.style.placement.variableOffsets),this.gpuTimingEnd())},$i.prototype.gpuTimingStart=function(l){if(this.options.gpuTiming){var f=this.context.extTimerQuery,c=this.gpuTimers[l.id];c||(c=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:f.createQueryEXT()}),c.calls++,f.beginQueryEXT(f.TIME_ELAPSED_EXT,c.query)}},$i.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}},$i.prototype.collectGpuTimers=function(){var l=this.gpuTimers;return this.gpuTimers={},l},$i.prototype.queryGpuTimers=function(l){var f={};for(var c in l){var d=l[c],E=this.context.extTimerQuery,w=E.getQueryObjectEXT(d.query,E.QUERY_RESULT_EXT)/1e6;E.deleteQueryEXT(d.query),f[c]=w}return f},$i.prototype.translatePosMatrix=function(l,f,c,d,E){if(!c[0]&&!c[1])return l;var w=E?d==="map"?this.transform.angle:0:d==="viewport"?-this.transform.angle:0;if(w){var P=Math.sin(w),L=Math.cos(w);c=[c[0]*L-c[1]*P,c[0]*P+c[1]*L]}var U=[E?c[0]:oa(f,c[0],this.transform.zoom),E?c[1]:oa(f,c[1],this.transform.zoom),0],H=new Float32Array(16);return m.translate(H,l,U),H},$i.prototype.saveTileTexture=function(l){var f=this._tileTextures[l.size[0]];f?f.push(l):this._tileTextures[l.size[0]]=[l]},$i.prototype.getTileTexture=function(l){var f=this._tileTextures[l];return f&&f.length>0?f.pop():null},$i.prototype.isPatternMissing=function(l){if(!l)return!1;if(!l.from||!l.to)return!0;var f=this.imageManager.getPattern(l.from.toString()),c=this.imageManager.getPattern(l.to.toString());return!f||!c},$i.prototype.useProgram=function(l,f){this.cache=this.cache||{};var c=""+l+(f?f.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[c]||(this.cache[c]=new hf(this.context,l,ys[l],f,kl[l],this._showOverdrawInspector)),this.cache[c]},$i.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},$i.prototype.setBaseState=function(){var l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)},$i.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=m.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new m.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},$i.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var sc=function(l,f){this.points=l,this.planes=f};sc.fromInvProjectionMatrix=function(l,f,c){var d=Math.pow(2,c),E=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(P){return m.transformMat4([],P,l)}).map(function(P){return m.scale$1([],P,1/P[3]/f*d)}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(P){var L=m.sub([],E[P[0]],E[P[1]]),U=m.sub([],E[P[2]],E[P[1]]),H=m.normalize([],m.cross([],L,U)),ae=-m.dot(H,E[P[1]]);return H.concat(ae)});return new sc(E,w)};var ca=function(l,f){this.min=l,this.max=f,this.center=m.scale$2([],m.add([],this.min,this.max),.5)};ca.prototype.quadrant=function(l){for(var f=[l%2==0,l<2],c=m.clone$2(this.min),d=m.clone$2(this.max),E=0;E<f.length;E++)c[E]=f[E]?this.min[E]:this.center[E],d[E]=f[E]?this.center[E]:this.max[E];return d[2]=this.max[2],new ca(c,d)},ca.prototype.distanceX=function(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]},ca.prototype.distanceY=function(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]},ca.prototype.intersects=function(l){for(var f=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],c=!0,d=0;d<l.planes.length;d++){for(var E=l.planes[d],w=0,P=0;P<f.length;P++)w+=m.dot$1(E,f[P])>=0;if(w===0)return 0;w!==f.length&&(c=!1)}if(c)return 2;for(var L=0;L<3;L++){for(var U=Number.MAX_VALUE,H=-Number.MAX_VALUE,ae=0;ae<l.points.length;ae++){var se=l.points[ae][L]-this.min[L];U=Math.min(U,se),H=Math.max(H,se)}if(H<0||U>this.max[L]-this.min[L])return 0}return 1};var Pu=function(l,f,c,d){if(l===void 0&&(l=0),f===void 0&&(f=0),c===void 0&&(c=0),d===void 0&&(d=0),isNaN(l)||l<0||isNaN(f)||f<0||isNaN(c)||c<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=f,this.left=c,this.right=d};Pu.prototype.interpolate=function(l,f,c){return f.top!=null&&l.top!=null&&(this.top=m.number(l.top,f.top,c)),f.bottom!=null&&l.bottom!=null&&(this.bottom=m.number(l.bottom,f.bottom,c)),f.left!=null&&l.left!=null&&(this.left=m.number(l.left,f.left,c)),f.right!=null&&l.right!=null&&(this.right=m.number(l.right,f.right,c)),this},Pu.prototype.getCenter=function(l,f){var c=m.clamp((this.left+l-this.right)/2,0,l),d=m.clamp((this.top+f-this.bottom)/2,0,f);return new m.Point(c,d)},Pu.prototype.equals=function(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right},Pu.prototype.clone=function(){return new Pu(this.top,this.bottom,this.left,this.right)},Pu.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Xi=function(l,f,c,d,E){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=E===void 0||E,this._minZoom=l||0,this._maxZoom=f||22,this._minPitch=c==null?0:c,this._maxPitch=d==null?60:d,this.setMaxBounds(),this.width=0,this.height=0,this._center=new m.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Pu,this._posMatrixCache={},this._alignedPosMatrixCache={}},Ma={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Xi.prototype.clone=function(){var l=new Xi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.tileSize=this.tileSize,l.latRange=this.latRange,l.width=this.width,l.height=this.height,l._center=this._center,l.zoom=this.zoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._calcMatrices(),l},Ma.minZoom.get=function(){return this._minZoom},Ma.minZoom.set=function(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))},Ma.maxZoom.get=function(){return this._maxZoom},Ma.maxZoom.set=function(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))},Ma.minPitch.get=function(){return this._minPitch},Ma.minPitch.set=function(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))},Ma.maxPitch.get=function(){return this._maxPitch},Ma.maxPitch.set=function(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))},Ma.renderWorldCopies.get=function(){return this._renderWorldCopies},Ma.renderWorldCopies.set=function(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l},Ma.worldSize.get=function(){return this.tileSize*this.scale},Ma.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Ma.size.get=function(){return new m.Point(this.width,this.height)},Ma.bearing.get=function(){return-this.angle/Math.PI*180},Ma.bearing.set=function(l){var f=-m.wrap(l,-180,180)*Math.PI/180;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=m.create$2(),m.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Ma.pitch.get=function(){return this._pitch/Math.PI*180},Ma.pitch.set=function(l){var f=m.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())},Ma.fov.get=function(){return this._fov/Math.PI*180},Ma.fov.set=function(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())},Ma.zoom.get=function(){return this._zoom},Ma.zoom.set=function(l){var f=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._zoom=f,this.scale=this.zoomScale(f),this.tileZoom=Math.floor(f),this.zoomFraction=f-this.tileZoom,this._constrain(),this._calcMatrices())},Ma.center.get=function(){return this._center},Ma.center.set=function(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())},Ma.padding.get=function(){return this._edgeInsets.toJSON()},Ma.padding.set=function(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())},Ma.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Xi.prototype.isPaddingEqual=function(l){return this._edgeInsets.equals(l)},Xi.prototype.interpolatePadding=function(l,f,c){this._unmodified=!1,this._edgeInsets.interpolate(l,f,c),this._constrain(),this._calcMatrices()},Xi.prototype.coveringZoomLevel=function(l){var f=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,f)},Xi.prototype.getVisibleUnwrappedCoordinates=function(l){var f=[new m.UnwrappedTileID(0,l)];if(this._renderWorldCopies)for(var c=this.pointCoordinate(new m.Point(0,0)),d=this.pointCoordinate(new m.Point(this.width,0)),E=this.pointCoordinate(new m.Point(this.width,this.height)),w=this.pointCoordinate(new m.Point(0,this.height)),P=Math.floor(Math.min(c.x,d.x,E.x,w.x)),L=Math.floor(Math.max(c.x,d.x,E.x,w.x)),U=P-1;U<=L+1;U++)U!==0&&f.push(new m.UnwrappedTileID(U,l));return f},Xi.prototype.coveringTiles=function(l){var f=this.coveringZoomLevel(l),c=f;if(l.minzoom!==void 0&&f<l.minzoom)return[];l.maxzoom!==void 0&&f>l.maxzoom&&(f=l.maxzoom);var d=m.MercatorCoordinate.fromLngLat(this.center),E=Math.pow(2,f),w=[E*d.x,E*d.y,0],P=sc.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f),L=l.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(L=f);var U=function(yr){return{aabb:new ca([yr*E,0,0],[(yr+1)*E,E,0]),zoom:0,x:0,y:0,wrap:yr,fullyVisible:!1}},H=[],ae=[],se=f,le=l.reparseOverscaled?c:f;if(this._renderWorldCopies)for(var Oe=1;Oe<=3;Oe++)H.push(U(-Oe)),H.push(U(Oe));for(H.push(U(0));H.length>0;){var Pe=H.pop(),Ne=Pe.x,xe=Pe.y,je=Pe.fullyVisible;if(!je){var Ke=Pe.aabb.intersects(P);if(Ke===0)continue;je=Ke===2}var vt=Pe.aabb.distanceX(w),Wt=Pe.aabb.distanceY(w),Zt=Math.max(Math.abs(vt),Math.abs(Wt));if(Pe.zoom===se||Zt>3+(1<<se-Pe.zoom)-2&&Pe.zoom>=L)ae.push({tileID:new m.OverscaledTileID(Pe.zoom===se?le:Pe.zoom,Pe.wrap,Pe.zoom,Ne,xe),distanceSq:m.sqrLen([w[0]-.5-Ne,w[1]-.5-xe])});else for(var qt=0;qt<4;qt++){var hr=(Ne<<1)+qt%2,kr=(xe<<1)+(qt>>1);H.push({aabb:Pe.aabb.quadrant(qt),zoom:Pe.zoom+1,x:hr,y:kr,wrap:Pe.wrap,fullyVisible:je})}}return ae.sort(function(yr,sn){return yr.distanceSq-sn.distanceSq}).map(function(yr){return yr.tileID})},Xi.prototype.resize=function(l,f){this.width=l,this.height=f,this.pixelsToGLUnits=[2/l,-2/f],this._constrain(),this._calcMatrices()},Ma.unmodified.get=function(){return this._unmodified},Xi.prototype.zoomScale=function(l){return Math.pow(2,l)},Xi.prototype.scaleZoom=function(l){return Math.log(l)/Math.LN2},Xi.prototype.project=function(l){var f=m.clamp(l.lat,-this.maxValidLatitude,this.maxValidLatitude);return new m.Point(m.mercatorXfromLng(l.lng)*this.worldSize,m.mercatorYfromLat(f)*this.worldSize)},Xi.prototype.unproject=function(l){return new m.MercatorCoordinate(l.x/this.worldSize,l.y/this.worldSize).toLngLat()},Ma.point.get=function(){return this.project(this.center)},Xi.prototype.setLocationAtPoint=function(l,f){var c=this.pointCoordinate(f),d=this.pointCoordinate(this.centerPoint),E=this.locationCoordinate(l),w=new m.MercatorCoordinate(E.x-(c.x-d.x),E.y-(c.y-d.y));this.center=this.coordinateLocation(w),this._renderWorldCopies&&(this.center=this.center.wrap())},Xi.prototype.locationPoint=function(l){return this.coordinatePoint(this.locationCoordinate(l))},Xi.prototype.pointLocation=function(l){return this.coordinateLocation(this.pointCoordinate(l))},Xi.prototype.locationCoordinate=function(l){return m.MercatorCoordinate.fromLngLat(l)},Xi.prototype.coordinateLocation=function(l){return l.toLngLat()},Xi.prototype.pointCoordinate=function(l){var f=[l.x,l.y,0,1],c=[l.x,l.y,1,1];m.transformMat4(f,f,this.pixelMatrixInverse),m.transformMat4(c,c,this.pixelMatrixInverse);var d=f[3],E=c[3],w=f[1]/d,P=c[1]/E,L=f[2]/d,U=c[2]/E,H=L===U?0:(0-L)/(U-L);return new m.MercatorCoordinate(m.number(f[0]/d,c[0]/E,H)/this.worldSize,m.number(w,P,H)/this.worldSize)},Xi.prototype.coordinatePoint=function(l){var f=[l.x*this.worldSize,l.y*this.worldSize,0,1];return m.transformMat4(f,f,this.pixelMatrix),new m.Point(f[0]/f[3],f[1]/f[3])},Xi.prototype.getBounds=function(){return new m.LngLatBounds().extend(this.pointLocation(new m.Point(0,0))).extend(this.pointLocation(new m.Point(this.width,0))).extend(this.pointLocation(new m.Point(this.width,this.height))).extend(this.pointLocation(new m.Point(0,this.height)))},Xi.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new m.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Xi.prototype.setMaxBounds=function(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Xi.prototype.calculatePosMatrix=function(l,f){f===void 0&&(f=!1);var c=l.key,d=f?this._alignedPosMatrixCache:this._posMatrixCache;if(d[c])return d[c];var E=l.canonical,w=this.worldSize/this.zoomScale(E.z),P=E.x+Math.pow(2,E.z)*l.wrap,L=m.identity(new Float64Array(16));return m.translate(L,L,[P*w,E.y*w,0]),m.scale(L,L,[w/m.EXTENT,w/m.EXTENT,1]),m.multiply(L,f?this.alignedProjMatrix:this.projMatrix,L),d[c]=new Float32Array(L),d[c]},Xi.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Xi.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var l,f,c,d,E=-90,w=90,P=-180,L=180,U=this.size,H=this._unmodified;if(this.latRange){var ae=this.latRange;E=m.mercatorYfromLat(ae[1])*this.worldSize,l=(w=m.mercatorYfromLat(ae[0])*this.worldSize)-E<U.y?U.y/(w-E):0}if(this.lngRange){var se=this.lngRange;P=m.mercatorXfromLng(se[0])*this.worldSize,f=(L=m.mercatorXfromLng(se[1])*this.worldSize)-P<U.x?U.x/(L-P):0}var le=this.point,Oe=Math.max(f||0,l||0);if(Oe)return this.center=this.unproject(new m.Point(f?(L+P)/2:le.x,l?(w+E)/2:le.y)),this.zoom+=this.scaleZoom(Oe),this._unmodified=H,void(this._constraining=!1);if(this.latRange){var Pe=le.y,Ne=U.y/2;Pe-Ne<E&&(d=E+Ne),Pe+Ne>w&&(d=w-Ne)}if(this.lngRange){var xe=le.x,je=U.x/2;xe-je<P&&(c=P+je),xe+je>L&&(c=L-je)}c===void 0&&d===void 0||(this.center=this.unproject(new m.Point(c!==void 0?c:le.x,d!==void 0?d:le.y))),this._unmodified=H,this._constraining=!1}},Xi.prototype._calcMatrices=function(){if(this.height){var l=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var f=Math.PI/2+this._pitch,c=this._fov*(.5+l.y/this.height),d=Math.sin(c)*this.cameraToCenterDistance/Math.sin(m.clamp(Math.PI-f-c,.01,Math.PI-.01)),E=this.point,w=E.x,P=E.y,L=1.01*(Math.cos(Math.PI/2-this._pitch)*d+this.cameraToCenterDistance),U=this.height/50,H=new Float64Array(16);m.perspective(H,this._fov,this.width/this.height,U,L),H[8]=2*-l.x/this.width,H[9]=2*l.y/this.height,m.scale(H,H,[1,-1,1]),m.translate(H,H,[0,0,-this.cameraToCenterDistance]),m.rotateX(H,H,this._pitch),m.rotateZ(H,H,this.angle),m.translate(H,H,[-w,-P,0]),this.mercatorMatrix=m.scale([],H,[this.worldSize,this.worldSize,this.worldSize]),m.scale(H,H,[1,1,m.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=H,this.invProjMatrix=m.invert([],this.projMatrix);var ae=this.width%2/2,se=this.height%2/2,le=Math.cos(this.angle),Oe=Math.sin(this.angle),Pe=w-Math.round(w)+le*ae+Oe*se,Ne=P-Math.round(P)+le*se+Oe*ae,xe=new Float64Array(H);if(m.translate(xe,xe,[Pe>.5?Pe-1:Pe,Ne>.5?Ne-1:Ne,0]),this.alignedProjMatrix=xe,H=m.create(),m.scale(H,H,[this.width/2,-this.height/2,1]),m.translate(H,H,[1,-1,0]),this.labelPlaneMatrix=H,H=m.create(),m.scale(H,H,[1,-1,1]),m.translate(H,H,[-1,-1,0]),m.scale(H,H,[2/this.width,2/this.height,1]),this.glCoordMatrix=H,this.pixelMatrix=m.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(H=m.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=H,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Xi.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var l=this.pointCoordinate(new m.Point(0,0)),f=[l.x*this.worldSize,l.y*this.worldSize,0,1];return m.transformMat4(f,f,this.pixelMatrix)[3]/this.cameraToCenterDistance},Xi.prototype.getCameraPoint=function(){var l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new m.Point(0,l))},Xi.prototype.getCameraQueryGeometry=function(l){var f=this.getCameraPoint();if(l.length===1)return[l[0],f];for(var c=f.x,d=f.y,E=f.x,w=f.y,P=0,L=l;P<L.length;P+=1){var U=L[P];c=Math.min(c,U.x),d=Math.min(d,U.y),E=Math.max(E,U.x),w=Math.max(w,U.y)}return[new m.Point(c,d),new m.Point(E,d),new m.Point(E,w),new m.Point(c,w),new m.Point(c,d)]},Object.defineProperties(Xi.prototype,Ma);var _s=function(l){var f,c,d,E;this._hashName=l&&encodeURIComponent(l),m.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(f=this._updateHashUnthrottled.bind(this),c=!1,d=null,E=function(){d=null,c&&(f(),d=setTimeout(E,300),c=!1)},function(){return c=!0,d||E(),d})};_s.prototype.addTo=function(l){return this._map=l,m.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},_s.prototype.remove=function(){return m.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},_s.prototype.getHashString=function(l){var f=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,d=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,d),w=Math.round(f.lng*E)/E,P=Math.round(f.lat*E)/E,L=this._map.getBearing(),U=this._map.getPitch(),H="";if(H+=l?"/"+w+"/"+P+"/"+c:c+"/"+P+"/"+w,(L||U)&&(H+="/"+Math.round(10*L)/10),U&&(H+="/"+Math.round(U)),this._hashName){var ae=this._hashName,se=!1,le=m.window.location.hash.slice(1).split("&").map(function(Oe){var Pe=Oe.split("=")[0];return Pe===ae?(se=!0,Pe+"="+H):Oe}).filter(function(Oe){return Oe});return se||le.push(ae+"="+H),"#"+le.join("&")}return"#"+H},_s.prototype._getCurrentHash=function(){var l,f=this,c=m.window.location.hash.replace("#","");return this._hashName?(c.split("&").map(function(d){return d.split("=")}).forEach(function(d){d[0]===f._hashName&&(l=d)}),(l&&l[1]||"").split("/")):c.split("/")},_s.prototype._onHashChange=function(){var l=this._getCurrentHash();if(l.length>=3&&!l.some(function(c){return isNaN(c)})){var f=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(l[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:f,pitch:+(l[4]||0)}),!0}return!1},_s.prototype._updateHashUnthrottled=function(){var l=m.window.location.href.replace(/(#.+)?$/,this.getHashString());try{m.window.history.replaceState(m.window.history.state,null,l)}catch(f){}};var zc={linearity:.3,easing:m.bezier(0,0,.3,1)},qu=m.extend({deceleration:2500,maxSpeed:1400},zc),Za=m.extend({deceleration:20,maxSpeed:1400},zc),uc=m.extend({deceleration:1e3,maxSpeed:360},zc),Nl=m.extend({deceleration:1e3,maxSpeed:90},zc),Ku=function(l){this._map=l,this.clear()};function Uc(l,f){(!l.duration||l.duration<f.duration)&&(l.duration=f.duration,l.easing=f.easing)}function Iu(l,f,c){var d=c.maxSpeed,E=c.linearity,w=c.deceleration,P=m.clamp(l*E/(f/1e3),-d,d),L=Math.abs(P)/(w*E);return{easing:c.easing,duration:1e3*L,amount:P*(L/2)}}Ku.prototype.clear=function(){this._inertiaBuffer=[]},Ku.prototype.record=function(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:m.browser.now(),settings:l})},Ku.prototype._drainInertiaBuffer=function(){for(var l=this._inertiaBuffer,f=m.browser.now();l.length>0&&f-l[0].time>160;)l.shift()},Ku.prototype._onMoveEnd=function(l){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var f={zoom:0,bearing:0,pitch:0,pan:new m.Point(0,0),pinchAround:void 0,around:void 0},c=0,d=this._inertiaBuffer;c<d.length;c+=1){var E=d[c].settings;f.zoom+=E.zoomDelta||0,f.bearing+=E.bearingDelta||0,f.pitch+=E.pitchDelta||0,E.panDelta&&f.pan._add(E.panDelta),E.around&&(f.around=E.around),E.pinchAround&&(f.pinchAround=E.pinchAround)}var w=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,P={};if(f.pan.mag()){var L=Iu(f.pan.mag(),w,m.extend({},qu,l||{}));P.offset=f.pan.mult(L.amount/f.pan.mag()),P.center=this._map.transform.center,Uc(P,L)}if(f.zoom){var U=Iu(f.zoom,w,Za);P.zoom=this._map.transform.zoom+U.amount,Uc(P,U)}if(f.bearing){var H=Iu(f.bearing,w,uc);P.bearing=this._map.transform.bearing+m.clamp(H.amount,-179,179),Uc(P,H)}if(f.pitch){var ae=Iu(f.pitch,w,Nl);P.pitch=this._map.transform.pitch+ae.amount,Uc(P,ae)}if(P.zoom||P.bearing){var se=f.pinchAround===void 0?f.around:f.pinchAround;P.around=se?this._map.unproject(se):this._map.getCenter()}return this.clear(),m.extend(P,{noMoveStart:!0})}};var vo=function(l){function f(d,E,w,P){P===void 0&&(P={});var L=W.mousePos(E.getCanvasContainer(),w),U=E.unproject(L);l.call(this,d,m.extend({point:L,lngLat:U,originalEvent:w},P)),this._defaultPrevented=!1,this.target=E}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(m.Event),zl=function(l){function f(d,E,w){var P=d==="touchend"?w.changedTouches:w.touches,L=W.touchPos(E.getCanvasContainer(),P),U=L.map(function(se){return E.unproject(se)}),H=L.reduce(function(se,le,Oe,Pe){return se.add(le.div(Pe.length))},new m.Point(0,0)),ae=E.unproject(H);l.call(this,d,{points:L,point:H,lngLats:U,lngLat:ae,originalEvent:w}),this._defaultPrevented=!1}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(m.Event),lc=function(l){function f(d,E,w){l.call(this,d,{originalEvent:w}),this._defaultPrevented=!1}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(m.Event),mo=function(l,f){this._map=l,this._clickTolerance=f.clickTolerance};mo.prototype.reset=function(){delete this._mousedownPos},mo.prototype.wheel=function(l){return this._firePreventable(new lc(l.type,this._map,l))},mo.prototype.mousedown=function(l,f){return this._mousedownPos=f,this._firePreventable(new vo(l.type,this._map,l))},mo.prototype.mouseup=function(l){this._map.fire(new vo(l.type,this._map,l))},mo.prototype.click=function(l,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||this._map.fire(new vo(l.type,this._map,l))},mo.prototype.dblclick=function(l){return this._firePreventable(new vo(l.type,this._map,l))},mo.prototype.mouseover=function(l){this._map.fire(new vo(l.type,this._map,l))},mo.prototype.mouseout=function(l){this._map.fire(new vo(l.type,this._map,l))},mo.prototype.touchstart=function(l){return this._firePreventable(new zl(l.type,this._map,l))},mo.prototype.touchmove=function(l){this._map.fire(new zl(l.type,this._map,l))},mo.prototype.touchend=function(l){this._map.fire(new zl(l.type,this._map,l))},mo.prototype.touchcancel=function(l){this._map.fire(new zl(l.type,this._map,l))},mo.prototype._firePreventable=function(l){if(this._map.fire(l),l.defaultPrevented)return{}},mo.prototype.isEnabled=function(){return!0},mo.prototype.isActive=function(){return!1},mo.prototype.enable=function(){},mo.prototype.disable=function(){};var hn=function(l){this._map=l};hn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},hn.prototype.mousemove=function(l){this._map.fire(new vo(l.type,this._map,l))},hn.prototype.mousedown=function(){this._delayContextMenu=!0},hn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new vo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},hn.prototype.contextmenu=function(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new vo(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()},hn.prototype.isEnabled=function(){return!0},hn.prototype.isActive=function(){return!1},hn.prototype.enable=function(){},hn.prototype.disable=function(){};var co=function(l,f){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=f.clickTolerance||1};function $u(l,f){for(var c={},d=0;d<l.length;d++)c[l[d].identifier]=f[d];return c}co.prototype.isEnabled=function(){return!!this._enabled},co.prototype.isActive=function(){return!!this._active},co.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},co.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},co.prototype.mousedown=function(l,f){this.isEnabled()&&l.shiftKey&&l.button===0&&(W.disableDrag(),this._startPos=this._lastPos=f,this._active=!0)},co.prototype.mousemoveWindow=function(l,f){if(this._active){var c=f;if(!(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)){var d=this._startPos;this._lastPos=c,this._box||(this._box=W.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));var E=Math.min(d.x,c.x),w=Math.max(d.x,c.x),P=Math.min(d.y,c.y),L=Math.max(d.y,c.y);W.setTransform(this._box,"translate("+E+"px,"+P+"px)"),this._box.style.width=w-E+"px",this._box.style.height=L-P+"px"}}},co.prototype.mouseupWindow=function(l,f){var c=this;if(this._active&&l.button===0){var d=this._startPos,E=f;if(this.reset(),W.suppressClick(),d.x!==E.x||d.y!==E.y)return this._map.fire(new m.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:function(w){return w.fitScreenCoordinates(d,E,c._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",l)}},co.prototype.keydown=function(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))},co.prototype.blur=function(){this.reset()},co.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(W.remove(this._box),this._box=null),W.enableDrag(),delete this._startPos,delete this._lastPos},co.prototype._fireEvent=function(l,f){return this._map.fire(new m.Event(l,{originalEvent:f}))};var ka=function(l){this.reset(),this.numTouches=l.numTouches};ka.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},ka.prototype.touchstart=function(l,f,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),c.length===this.numTouches&&(this.centroid=function(d){for(var E=new m.Point(0,0),w=0,P=d;w<P.length;w+=1)E._add(P[w]);return E.div(d.length)}(f),this.touches=$u(c,f)))},ka.prototype.touchmove=function(l,f,c){if(!this.aborted&&this.centroid){var d=$u(c,f);for(var E in this.touches){var w=d[E];(!w||w.dist(this.touches[E])>30)&&(this.aborted=!0)}}},ka.prototype.touchend=function(l,f,c){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){var d=!this.aborted&&this.centroid;if(this.reset(),d)return d}};var qs=function(l){this.singleTap=new ka(l),this.numTaps=l.numTaps,this.reset()};qs.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},qs.prototype.touchstart=function(l,f,c){this.singleTap.touchstart(l,f,c)},qs.prototype.touchmove=function(l,f,c){this.singleTap.touchmove(l,f,c)},qs.prototype.touchend=function(l,f,c){var d=this.singleTap.touchend(l,f,c);if(d){var E=l.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(d)<30;if(E&&w||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}};var Ts=function(){this._zoomIn=new qs({numTouches:1,numTaps:2}),this._zoomOut=new qs({numTouches:2,numTaps:1}),this.reset()};Ts.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Ts.prototype.touchstart=function(l,f,c){this._zoomIn.touchstart(l,f,c),this._zoomOut.touchstart(l,f,c)},Ts.prototype.touchmove=function(l,f,c){this._zoomIn.touchmove(l,f,c),this._zoomOut.touchmove(l,f,c)},Ts.prototype.touchend=function(l,f,c){var d=this,E=this._zoomIn.touchend(l,f,c),w=this._zoomOut.touchend(l,f,c);return E?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(P){return P.easeTo({duration:300,zoom:P.getZoom()+1,around:P.unproject(E)},{originalEvent:l})}}):w?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(P){return P.easeTo({duration:300,zoom:P.getZoom()-1,around:P.unproject(w)},{originalEvent:l})}}):void 0},Ts.prototype.touchcancel=function(){this.reset()},Ts.prototype.enable=function(){this._enabled=!0},Ts.prototype.disable=function(){this._enabled=!1,this.reset()},Ts.prototype.isEnabled=function(){return this._enabled},Ts.prototype.isActive=function(){return this._active};var bf={0:1,2:2},Zr=function(l){this.reset(),this._clickTolerance=l.clickTolerance||1};Zr.prototype.blur=function(){this.reset()},Zr.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Zr.prototype._correctButton=function(l,f){return!1},Zr.prototype._move=function(l,f){return{}},Zr.prototype.mousedown=function(l,f){if(!this._lastPoint){var c=W.mouseButton(l);this._correctButton(l,c)&&(this._lastPoint=f,this._eventButton=c)}},Zr.prototype.mousemoveWindow=function(l,f){var c=this._lastPoint;if(c){if(l.preventDefault(),function(d,E){var w=bf[E];return d.buttons===void 0||(d.buttons&w)!==w}(l,this._eventButton))this.reset();else if(this._moved||!(f.dist(c)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(c,f)}},Zr.prototype.mouseupWindow=function(l){this._lastPoint&&W.mouseButton(l)===this._eventButton&&(this._moved&&W.suppressClick(),this.reset())},Zr.prototype.enable=function(){this._enabled=!0},Zr.prototype.disable=function(){this._enabled=!1,this.reset()},Zr.prototype.isEnabled=function(){return this._enabled},Zr.prototype.isActive=function(){return this._active};var cc=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.mousedown=function(c,d){l.prototype.mousedown.call(this,c,d),this._lastPoint&&(this._active=!0)},f.prototype._correctButton=function(c,d){return d===0&&!c.ctrlKey},f.prototype._move=function(c,d){return{around:d,panDelta:d.sub(c)}},f}(Zr),Ef=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},f.prototype._move=function(c,d){var E=.8*(d.x-c.x);if(E)return this._active=!0,{bearingDelta:E}},f.prototype.contextmenu=function(c){c.preventDefault()},f}(Zr),ll=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},f.prototype._move=function(c,d){var E=-.5*(d.y-c.y);if(E)return this._active=!0,{pitchDelta:E}},f.prototype.contextmenu=function(c){c.preventDefault()},f}(Zr),Ca=function(l){this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset()};Ca.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new m.Point(0,0)},Ca.prototype.touchstart=function(l,f,c){return this._calculateTransform(l,f,c)},Ca.prototype.touchmove=function(l,f,c){if(this._active&&!(c.length<this._minTouches))return l.preventDefault(),this._calculateTransform(l,f,c)},Ca.prototype.touchend=function(l,f,c){this._calculateTransform(l,f,c),this._active&&c.length<this._minTouches&&this.reset()},Ca.prototype.touchcancel=function(){this.reset()},Ca.prototype._calculateTransform=function(l,f,c){c.length>0&&(this._active=!0);var d=$u(c,f),E=new m.Point(0,0),w=new m.Point(0,0),P=0;for(var L in d){var U=d[L],H=this._touches[L];H&&(E._add(U),w._add(U.sub(H)),P++,d[L]=U)}if(this._touches=d,!(P<this._minTouches)&&w.mag()){var ae=w.div(P);if(this._sum._add(ae),!(this._sum.mag()<this._clickTolerance))return{around:E.div(P),panDelta:ae}}},Ca.prototype.enable=function(){this._enabled=!0},Ca.prototype.disable=function(){this._enabled=!1,this.reset()},Ca.prototype.isEnabled=function(){return this._enabled},Ca.prototype.isActive=function(){return this._active};var xs=function(){this.reset()};function Sf(l,f,c){for(var d=0;d<l.length;d++)if(l[d].identifier===c)return f[d]}function Ou(l,f){return Math.log(l/f)/Math.LN2}xs.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},xs.prototype._start=function(l){},xs.prototype._move=function(l,f,c){return{}},xs.prototype.touchstart=function(l,f,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([f[0],f[1]]))},xs.prototype.touchmove=function(l,f,c){if(this._firstTwoTouches){l.preventDefault();var d=this._firstTwoTouches,E=d[1],w=Sf(c,f,d[0]),P=Sf(c,f,E);if(w&&P){var L=this._aroundCenter?null:w.add(P).div(2);return this._move([w,P],L,l)}}},xs.prototype.touchend=function(l,f,c){if(this._firstTwoTouches){var d=this._firstTwoTouches,E=d[1],w=Sf(c,f,d[0]),P=Sf(c,f,E);w&&P||(this._active&&W.suppressClick(),this.reset())}},xs.prototype.touchcancel=function(){this.reset()},xs.prototype.enable=function(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"},xs.prototype.disable=function(){this._enabled=!1,this.reset()},xs.prototype.isEnabled=function(){return this._enabled},xs.prototype.isActive=function(){return this._active};var Fs=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),delete this._distance,delete this._startDistance},f.prototype._start=function(c){this._startDistance=this._distance=c[0].dist(c[1])},f.prototype._move=function(c,d){var E=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(Ou(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ou(this._distance,E),pinchAround:d}},f}(xs);function Ru(l,f){return 180*l.angleWith(f)/Math.PI}var Wf=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},f.prototype._start=function(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])},f.prototype._move=function(c,d){var E=this._vector;if(this._vector=c[0].sub(c[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Ru(this._vector,E),pinchAround:d}},f.prototype._isBelowThreshold=function(c){this._minDiameter=Math.min(this._minDiameter,c.mag());var d=25/(Math.PI*this._minDiameter)*360,E=Ru(c,this._startVector);return Math.abs(E)<d},f}(xs);function cl(l){return Math.abs(l.y)>Math.abs(l.x)}var Xf=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},f.prototype._start=function(c){this._lastPoints=c,cl(c[0].sub(c[1]))&&(this._valid=!1)},f.prototype._move=function(c,d,E){var w=c[0].sub(this._lastPoints[0]),P=c[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(w,P,E.timeStamp),this._valid)return this._lastPoints=c,this._active=!0,{pitchDelta:(w.y+P.y)/2*-.5}},f.prototype.gestureBeginsVertically=function(c,d,E){if(this._valid!==void 0)return this._valid;var w=c.mag()>=2,P=d.mag()>=2;if(w||P){if(!w||!P)return this._firstMove===void 0&&(this._firstMove=E),E-this._firstMove<100&&void 0;var L=c.y>0==d.y>0;return cl(c)&&cl(d)&&L}},f}(xs),Cf={panStep:100,bearingStep:15,pitchStep:10},pu=function(){var l=Cf;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1};function Ms(l){return l*(2-l)}pu.prototype.blur=function(){this.reset()},pu.prototype.reset=function(){this._active=!1},pu.prototype.keydown=function(l){var f=this;if(!(l.altKey||l.ctrlKey||l.metaKey)){var c=0,d=0,E=0,w=0,P=0;switch(l.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:l.shiftKey?d=-1:(l.preventDefault(),w=-1);break;case 39:l.shiftKey?d=1:(l.preventDefault(),w=1);break;case 38:l.shiftKey?E=1:(l.preventDefault(),P=-1);break;case 40:l.shiftKey?E=-1:(l.preventDefault(),P=1);break;default:return}return this._rotationDisabled&&(d=0,E=0),{cameraAnimation:function(L){var U=L.getZoom();L.easeTo({duration:300,easeId:"keyboardHandler",easing:Ms,zoom:c?Math.round(U)+c*(l.shiftKey?2:1):U,bearing:L.getBearing()+d*f._bearingStep,pitch:L.getPitch()+E*f._pitchStep,offset:[-w*f._panStep,-P*f._panStep],center:L.getCenter()},{originalEvent:l})}}}},pu.prototype.enable=function(){this._enabled=!0},pu.prototype.disable=function(){this._enabled=!1,this.reset()},pu.prototype.isEnabled=function(){return this._enabled},pu.prototype.isActive=function(){return this._active},pu.prototype.disableRotation=function(){this._rotationDisabled=!0},pu.prototype.enableRotation=function(){this._rotationDisabled=!1};var Ai=function(l,f){this._map=l,this._el=l.getCanvasContainer(),this._handler=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,m.bindAll(["_onTimeout"],this)};Ai.prototype.setZoomRate=function(l){this._defaultZoomRate=l},Ai.prototype.setWheelZoomRate=function(l){this._wheelZoomRate=l},Ai.prototype.isEnabled=function(){return!!this._enabled},Ai.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Ai.prototype.isZooming=function(){return!!this._zooming},Ai.prototype.enable=function(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=l&&l.around==="center")},Ai.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Ai.prototype.wheel=function(l){if(this.isEnabled()){var f=l.deltaMode===m.window.WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY,c=m.browser.now(),d=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,f!==0&&f%4.000244140625==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(d*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),l.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=l,this._delta-=f,this._active||this._start(l)),l.preventDefault()}},Ai.prototype._onTimeout=function(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},Ai.prototype._start=function(l){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var f=W.mousePos(this._el,l);this._around=m.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(f)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Ai.prototype.renderFrame=function(){var l=this;if(this._frameId&&(this._frameId=null,this.isActive())){var f=this._map.transform;if(this._delta!==0){var c=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,d=2/(1+Math.exp(-Math.abs(this._delta*c)));this._delta<0&&d!==0&&(d=1/d);var E=typeof this._targetZoom=="number"?f.zoomScale(this._targetZoom):f.scale;this._targetZoom=Math.min(f.maxZoom,Math.max(f.minZoom,f.scaleZoom(E*d))),this._type==="wheel"&&(this._startZoom=f.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var w,P=typeof this._targetZoom=="number"?this._targetZoom:f.zoom,L=this._startZoom,U=this._easing,H=!1;if(this._type==="wheel"&&L&&U){var ae=Math.min((m.browser.now()-this._lastWheelEventTime)/200,1),se=U(ae);w=m.number(L,P,se),ae<1?this._frameId||(this._frameId=!0):H=!0}else w=P,H=!0;return this._active=!0,H&&(this._active=!1,this._finishTimeout=setTimeout(function(){l._zooming=!1,l._handler._triggerRenderFrame(),delete l._targetZoom,delete l._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!H,zoomDelta:w-f.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Ai.prototype._smoothOutEasing=function(l){var f=m.ease;if(this._prevEase){var c=this._prevEase,d=(m.browser.now()-c.start)/c.duration,E=c.easing(d+.01)-c.easing(d),w=.27/Math.sqrt(E*E+1e-4)*.01,P=Math.sqrt(.0729-w*w);f=m.bezier(w,P,.25,1)}return this._prevEase={start:m.browser.now(),duration:l,easing:f},f},Ai.prototype.blur=function(){this.reset()},Ai.prototype.reset=function(){this._active=!1};var ku=function(l,f){this._clickZoom=l,this._tapZoom=f};ku.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},ku.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},ku.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},ku.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var hu=function(){this.reset()};hu.prototype.reset=function(){this._active=!1},hu.prototype.blur=function(){this.reset()},hu.prototype.dblclick=function(l,f){return l.preventDefault(),{cameraAnimation:function(c){c.easeTo({duration:300,zoom:c.getZoom()+(l.shiftKey?-1:1),around:c.unproject(f)},{originalEvent:l})}}},hu.prototype.enable=function(){this._enabled=!0},hu.prototype.disable=function(){this._enabled=!1,this.reset()},hu.prototype.isEnabled=function(){return this._enabled},hu.prototype.isActive=function(){return this._active};var Vo=function(){this._tap=new qs({numTouches:1,numTaps:1}),this.reset()};Vo.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Vo.prototype.touchstart=function(l,f,c){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?c.length>0&&(this._swipePoint=f[0],this._swipeTouch=c[0].identifier):this._tap.touchstart(l,f,c))},Vo.prototype.touchmove=function(l,f,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;var d=f[0],E=d.y-this._swipePoint.y;return this._swipePoint=d,l.preventDefault(),this._active=!0,{zoomDelta:E/128}}}else this._tap.touchmove(l,f,c)},Vo.prototype.touchend=function(l,f,c){this._tapTime?this._swipePoint&&c.length===0&&this.reset():this._tap.touchend(l,f,c)&&(this._tapTime=l.timeStamp)},Vo.prototype.touchcancel=function(){this.reset()},Vo.prototype.enable=function(){this._enabled=!0},Vo.prototype.disable=function(){this._enabled=!1,this.reset()},Vo.prototype.isEnabled=function(){return this._enabled},Vo.prototype.isActive=function(){return this._active};var fl=function(l,f,c){this._el=l,this._mousePan=f,this._touchPan=c};fl.prototype.enable=function(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},fl.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},fl.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},fl.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var ns=function(l,f,c){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=f,this._mousePitch=c};ns.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},ns.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},ns.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},ns.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var Ks=function(l,f,c,d){this._el=l,this._touchZoom=f,this._touchRotate=c,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0};Ks.prototype.enable=function(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},Ks.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},Ks.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},Ks.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},Ks.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},Ks.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var bs=function(l){return l.zoom||l.drag||l.pitch||l.rotate},xu=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f}(m.Event);function Rn(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}var Cn=function(l,f){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ku(l),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(f),m.bindAll(["handleEvent","handleWindowEvent"],this);var c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[m.window.document,"mousemove",{capture:!0}],[m.window.document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[m.window,"blur",void 0]];for(var d=0,E=this._listeners;d<E.length;d+=1){var w=E[d],P=w[0];W.addEventListener(P,w[1],P===m.window.document?this.handleWindowEvent:this.handleEvent,w[2])}};Cn.prototype.destroy=function(){for(var l=0,f=this._listeners;l<f.length;l+=1){var c=f[l],d=c[0];W.removeEventListener(d,c[1],d===m.window.document?this.handleWindowEvent:this.handleEvent,c[2])}},Cn.prototype._addDefaultHandlers=function(l){var f=this._map,c=f.getCanvasContainer();this._add("mapEvent",new mo(f,l));var d=f.boxZoom=new co(f,l);this._add("boxZoom",d);var E=new Ts,w=new hu;f.doubleClickZoom=new ku(w,E),this._add("tapZoom",E),this._add("clickZoom",w);var P=new Vo;this._add("tapDragZoom",P);var L=f.touchPitch=new Xf;this._add("touchPitch",L);var U=new Ef(l),H=new ll(l);f.dragRotate=new ns(l,U,H),this._add("mouseRotate",U,["mousePitch"]),this._add("mousePitch",H,["mouseRotate"]);var ae=new cc(l),se=new Ca(l);f.dragPan=new fl(c,ae,se),this._add("mousePan",ae),this._add("touchPan",se,["touchZoom","touchRotate"]);var le=new Wf,Oe=new Fs;f.touchZoomRotate=new Ks(c,Oe,le,P),this._add("touchRotate",le,["touchPan","touchZoom"]),this._add("touchZoom",Oe,["touchPan","touchRotate"]);var Pe=f.scrollZoom=new Ai(f,this);this._add("scrollZoom",Pe,["mousePan"]);var Ne=f.keyboard=new pu;this._add("keyboard",Ne),this._add("blockableMapEvent",new hn(f));for(var xe=0,je=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];xe<je.length;xe+=1){var Ke=je[xe];l.interactive&&l[Ke]&&f[Ke].enable(l[Ke])}},Cn.prototype._add=function(l,f,c){this._handlers.push({handlerName:l,handler:f,allowed:c}),this._handlersById[l]=f},Cn.prototype.stop=function(l){if(!this._updatingCamera){for(var f=0,c=this._handlers;f<c.length;f+=1)c[f].handler.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}},Cn.prototype.isActive=function(){for(var l=0,f=this._handlers;l<f.length;l+=1)if(f[l].handler.isActive())return!0;return!1},Cn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},Cn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},Cn.prototype.isMoving=function(){return Boolean(bs(this._eventsInProgress))||this.isZooming()},Cn.prototype._blockedByActive=function(l,f,c){for(var d in l)if(d!==c&&(!f||f.indexOf(d)<0))return!0;return!1},Cn.prototype.handleWindowEvent=function(l){this.handleEvent(l,l.type+"Window")},Cn.prototype._getMapTouches=function(l){for(var f=[],c=0,d=l;c<d.length;c+=1){var E=d[c];this._el.contains(E.target)&&f.push(E)}return f},Cn.prototype.handleEvent=function(l,f){this._updatingCamera=!0;for(var c=l.type==="renderFrame"?void 0:l,d={needsRenderFrame:!1},E={},w={},P=l.touches?this._getMapTouches(l.touches):void 0,L=P?W.touchPos(this._el,P):W.mousePos(this._el,l),U=0,H=this._handlers;U<H.length;U+=1){var ae=H[U],se=ae.handlerName,le=ae.handler,Oe=ae.allowed;if(le.isEnabled()){var Pe=void 0;this._blockedByActive(w,Oe,se)?le.reset():le[f||l.type]&&(Pe=le[f||l.type](l,L,P),this.mergeHandlerResult(d,E,Pe,se,c),Pe&&Pe.needsRenderFrame&&this._triggerRenderFrame()),(Pe||le.isActive())&&(w[se]=le)}}var Ne={};for(var xe in this._previousActiveHandlers)w[xe]||(Ne[xe]=c);this._previousActiveHandlers=w,(Object.keys(Ne).length||Rn(d))&&(this._changes.push([d,E,Ne]),this._triggerRenderFrame()),(Object.keys(w).length||Rn(d))&&this._map._stop(!0),this._updatingCamera=!1;var je=d.cameraAnimation;je&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],je(this._map))},Cn.prototype.mergeHandlerResult=function(l,f,c,d,E){if(c){m.extend(l,c);var w={handlerName:d,originalEvent:c.originalEvent||E};c.zoomDelta!==void 0&&(f.zoom=w),c.panDelta!==void 0&&(f.drag=w),c.pitchDelta!==void 0&&(f.pitch=w),c.bearingDelta!==void 0&&(f.rotate=w)}},Cn.prototype._applyChanges=function(){for(var l={},f={},c={},d=0,E=this._changes;d<E.length;d+=1){var w=E[d],P=w[0],L=w[1],U=w[2];P.panDelta&&(l.panDelta=(l.panDelta||new m.Point(0,0))._add(P.panDelta)),P.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+P.zoomDelta),P.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+P.bearingDelta),P.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+P.pitchDelta),P.around!==void 0&&(l.around=P.around),P.pinchAround!==void 0&&(l.pinchAround=P.pinchAround),P.noInertia&&(l.noInertia=P.noInertia),m.extend(f,L),m.extend(c,U)}this._updateMapTransform(l,f,c),this._changes=[]},Cn.prototype._updateMapTransform=function(l,f,c){var d=this._map,E=d.transform;if(!Rn(l))return this._fireEvents(f,c,!0);var w=l.panDelta,P=l.zoomDelta,L=l.bearingDelta,U=l.pitchDelta,H=l.around,ae=l.pinchAround;ae!==void 0&&(H=ae),d._stop(!0),H=H||d.transform.centerPoint;var se=E.pointLocation(w?H.sub(w):H);L&&(E.bearing+=L),U&&(E.pitch+=U),P&&(E.zoom+=P),E.setLocationAtPoint(se,H),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(f,c,!0)},Cn.prototype._fireEvents=function(l,f,c){var d=this,E=bs(this._eventsInProgress),w=bs(l),P={};for(var L in l)this._eventsInProgress[L]||(P[L+"start"]=l[L].originalEvent),this._eventsInProgress[L]=l[L];for(var U in!E&&w&&this._fireEvent("movestart",w.originalEvent),P)this._fireEvent(U,P[U]);for(var H in w&&this._fireEvent("move",w.originalEvent),l)this._fireEvent(H,l[H].originalEvent);var ae,se={};for(var le in this._eventsInProgress){var Oe=this._eventsInProgress[le],Pe=Oe.handlerName,Ne=Oe.originalEvent;this._handlersById[Pe].isActive()||(delete this._eventsInProgress[le],se[le+"end"]=ae=f[Pe]||Ne)}for(var xe in se)this._fireEvent(xe,se[xe]);var je=bs(this._eventsInProgress);if(c&&(E||w)&&!je){this._updatingCamera=!0;var Ke=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),vt=function(Wt){return Wt!==0&&-d._bearingSnap<Wt&&Wt<d._bearingSnap};Ke?(vt(Ke.bearing||this._map.getBearing())&&(Ke.bearing=0),this._map.easeTo(Ke,{originalEvent:ae})):(this._map.fire(new m.Event("moveend",{originalEvent:ae})),vt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},Cn.prototype._fireEvent=function(l,f){this._map.fire(new m.Event(l,f?{originalEvent:f}:{}))},Cn.prototype._requestFrame=function(){var l=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(f){delete l._frameId,l.handleEvent(new xu("renderFrame",{timeStamp:f})),l._applyChanges()})},Cn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Zc=function(l){function f(c,d){l.call(this),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=d.bearingSnap,m.bindAll(["_renderFrameCallback"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getCenter=function(){return new m.LngLat(this.transform.center.lng,this.transform.center.lat)},f.prototype.setCenter=function(c,d){return this.jumpTo({center:c},d)},f.prototype.panBy=function(c,d,E){return c=m.Point.convert(c).mult(-1),this.panTo(this.transform.center,m.extend({offset:c},d),E)},f.prototype.panTo=function(c,d,E){return this.easeTo(m.extend({center:c},d),E)},f.prototype.getZoom=function(){return this.transform.zoom},f.prototype.setZoom=function(c,d){return this.jumpTo({zoom:c},d),this},f.prototype.zoomTo=function(c,d,E){return this.easeTo(m.extend({zoom:c},d),E)},f.prototype.zoomIn=function(c,d){return this.zoomTo(this.getZoom()+1,c,d),this},f.prototype.zoomOut=function(c,d){return this.zoomTo(this.getZoom()-1,c,d),this},f.prototype.getBearing=function(){return this.transform.bearing},f.prototype.setBearing=function(c,d){return this.jumpTo({bearing:c},d),this},f.prototype.getPadding=function(){return this.transform.padding},f.prototype.setPadding=function(c,d){return this.jumpTo({padding:c},d),this},f.prototype.rotateTo=function(c,d,E){return this.easeTo(m.extend({bearing:c},d),E)},f.prototype.resetNorth=function(c,d){return this.rotateTo(0,m.extend({duration:1e3},c),d),this},f.prototype.resetNorthPitch=function(c,d){return this.easeTo(m.extend({bearing:0,pitch:0,duration:1e3},c),d),this},f.prototype.snapToNorth=function(c,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,d):this},f.prototype.getPitch=function(){return this.transform.pitch},f.prototype.setPitch=function(c,d){return this.jumpTo({pitch:c},d),this},f.prototype.cameraForBounds=function(c,d){c=m.LngLatBounds.convert(c);var E=d&&d.bearing||0;return this._cameraForBoxAndBearing(c.getNorthWest(),c.getSouthEast(),E,d)},f.prototype._cameraForBoxAndBearing=function(c,d,E,w){var P={top:0,bottom:0,right:0,left:0};if(typeof(w=m.extend({padding:P,offset:[0,0],maxZoom:this.transform.maxZoom},w)).padding=="number"){var L=w.padding;w.padding={top:L,bottom:L,right:L,left:L}}w.padding=m.extend(P,w.padding);var U=this.transform,H=U.padding,ae=U.project(m.LngLat.convert(c)),se=U.project(m.LngLat.convert(d)),le=ae.rotate(-E*Math.PI/180),Oe=se.rotate(-E*Math.PI/180),Pe=new m.Point(Math.max(le.x,Oe.x),Math.max(le.y,Oe.y)),Ne=new m.Point(Math.min(le.x,Oe.x),Math.min(le.y,Oe.y)),xe=Pe.sub(Ne),je=(U.width-(H.left+H.right+w.padding.left+w.padding.right))/xe.x,Ke=(U.height-(H.top+H.bottom+w.padding.top+w.padding.bottom))/xe.y;if(!(Ke<0||je<0)){var vt=Math.min(U.scaleZoom(U.scale*Math.min(je,Ke)),w.maxZoom),Wt=typeof w.offset.x=="number"?new m.Point(w.offset.x,w.offset.y):m.Point.convert(w.offset),Zt=new m.Point((w.padding.left-w.padding.right)/2,(w.padding.top-w.padding.bottom)/2).rotate(E*Math.PI/180),qt=Wt.add(Zt).mult(U.scale/U.zoomScale(vt));return{center:U.unproject(ae.add(se).div(2).sub(qt)),zoom:vt,bearing:E}}m.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},f.prototype.fitBounds=function(c,d,E){return this._fitInternal(this.cameraForBounds(c,d),d,E)},f.prototype.fitScreenCoordinates=function(c,d,E,w,P){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(m.Point.convert(c)),this.transform.pointLocation(m.Point.convert(d)),E,w),w,P)},f.prototype._fitInternal=function(c,d,E){return c?(delete(d=m.extend(c,d)).padding,d.linear?this.easeTo(d,E):this.flyTo(d,E)):this},f.prototype.jumpTo=function(c,d){this.stop();var E=this.transform,w=!1,P=!1,L=!1;return"zoom"in c&&E.zoom!==+c.zoom&&(w=!0,E.zoom=+c.zoom),c.center!==void 0&&(E.center=m.LngLat.convert(c.center)),"bearing"in c&&E.bearing!==+c.bearing&&(P=!0,E.bearing=+c.bearing),"pitch"in c&&E.pitch!==+c.pitch&&(L=!0,E.pitch=+c.pitch),c.padding==null||E.isPaddingEqual(c.padding)||(E.padding=c.padding),this.fire(new m.Event("movestart",d)).fire(new m.Event("move",d)),w&&this.fire(new m.Event("zoomstart",d)).fire(new m.Event("zoom",d)).fire(new m.Event("zoomend",d)),P&&this.fire(new m.Event("rotatestart",d)).fire(new m.Event("rotate",d)).fire(new m.Event("rotateend",d)),L&&this.fire(new m.Event("pitchstart",d)).fire(new m.Event("pitch",d)).fire(new m.Event("pitchend",d)),this.fire(new m.Event("moveend",d))},f.prototype.easeTo=function(c,d){var E=this;this._stop(!1,c.easeId),((c=m.extend({offset:[0,0],duration:500,easing:m.ease},c)).animate===!1||!c.essential&&m.browser.prefersReducedMotion)&&(c.duration=0);var w=this.transform,P=this.getZoom(),L=this.getBearing(),U=this.getPitch(),H=this.getPadding(),ae="zoom"in c?+c.zoom:P,se="bearing"in c?this._normalizeBearing(c.bearing,L):L,le="pitch"in c?+c.pitch:U,Oe="padding"in c?c.padding:w.padding,Pe=m.Point.convert(c.offset),Ne=w.centerPoint.add(Pe),xe=w.pointLocation(Ne),je=m.LngLat.convert(c.center||xe);this._normalizeCenter(je);var Ke,vt,Wt=w.project(xe),Zt=w.project(je).sub(Wt),qt=w.zoomScale(ae-P);c.around&&(Ke=m.LngLat.convert(c.around),vt=w.locationPoint(Ke));var hr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ae!==P,this._rotating=this._rotating||L!==se,this._pitching=this._pitching||le!==U,this._padding=!w.isPaddingEqual(Oe),this._easeId=c.easeId,this._prepareEase(d,c.noMoveStart,hr),this._ease(function(kr){if(E._zooming&&(w.zoom=m.number(P,ae,kr)),E._rotating&&(w.bearing=m.number(L,se,kr)),E._pitching&&(w.pitch=m.number(U,le,kr)),E._padding&&(w.interpolatePadding(H,Oe,kr),Ne=w.centerPoint.add(Pe)),Ke)w.setLocationAtPoint(Ke,vt);else{var yr=w.zoomScale(w.zoom-P),sn=ae>P?Math.min(2,qt):Math.max(.5,qt),Zn=Math.pow(sn,1-kr),jn=w.unproject(Wt.add(Zt.mult(kr*Zn)).mult(yr));w.setLocationAtPoint(w.renderWorldCopies?jn.wrap():jn,Ne)}E._fireMoveEvents(d)},function(kr){E._afterEase(d,kr)},c),this},f.prototype._prepareEase=function(c,d,E){E===void 0&&(E={}),this._moving=!0,d||E.moving||this.fire(new m.Event("movestart",c)),this._zooming&&!E.zooming&&this.fire(new m.Event("zoomstart",c)),this._rotating&&!E.rotating&&this.fire(new m.Event("rotatestart",c)),this._pitching&&!E.pitching&&this.fire(new m.Event("pitchstart",c))},f.prototype._fireMoveEvents=function(c){this.fire(new m.Event("move",c)),this._zooming&&this.fire(new m.Event("zoom",c)),this._rotating&&this.fire(new m.Event("rotate",c)),this._pitching&&this.fire(new m.Event("pitch",c))},f.prototype._afterEase=function(c,d){if(!this._easeId||!d||this._easeId!==d){delete this._easeId;var E=this._zooming,w=this._rotating,P=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,E&&this.fire(new m.Event("zoomend",c)),w&&this.fire(new m.Event("rotateend",c)),P&&this.fire(new m.Event("pitchend",c)),this.fire(new m.Event("moveend",c))}},f.prototype.flyTo=function(c,d){var E=this;if(!c.essential&&m.browser.prefersReducedMotion){var w=m.pick(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(w,d)}this.stop(),c=m.extend({offset:[0,0],speed:1.2,curve:1.42,easing:m.ease},c);var P=this.transform,L=this.getZoom(),U=this.getBearing(),H=this.getPitch(),ae=this.getPadding(),se="zoom"in c?m.clamp(+c.zoom,P.minZoom,P.maxZoom):L,le="bearing"in c?this._normalizeBearing(c.bearing,U):U,Oe="pitch"in c?+c.pitch:H,Pe="padding"in c?c.padding:P.padding,Ne=P.zoomScale(se-L),xe=m.Point.convert(c.offset),je=P.centerPoint.add(xe),Ke=P.pointLocation(je),vt=m.LngLat.convert(c.center||Ke);this._normalizeCenter(vt);var Wt=P.project(Ke),Zt=P.project(vt).sub(Wt),qt=c.curve,hr=Math.max(P.width,P.height),kr=hr/Ne,yr=Zt.mag();if("minZoom"in c){var sn=m.clamp(Math.min(c.minZoom,L,se),P.minZoom,P.maxZoom),Zn=hr/P.zoomScale(sn-L);qt=Math.sqrt(Zn/yr*2)}var jn=qt*qt;function Ln(qn){var Xn=(kr*kr-hr*hr+(qn?-1:1)*jn*jn*yr*yr)/(2*(qn?kr:hr)*jn*yr);return Math.log(Math.sqrt(Xn*Xn+1)-Xn)}function Ri(qn){return(Math.exp(qn)-Math.exp(-qn))/2}function tn(qn){return(Math.exp(qn)+Math.exp(-qn))/2}var ni=Ln(0),li=function(qn){return tn(ni)/tn(ni+qt*qn)},Kn=function(qn){return hr*((tn(ni)*(Ri(Xn=ni+qt*qn)/tn(Xn))-Ri(ni))/jn)/yr;var Xn},Hn=(Ln(1)-ni)/qt;if(Math.abs(yr)<1e-6||!isFinite(Hn)){if(Math.abs(hr-kr)<1e-6)return this.easeTo(c,d);var hi=kr<hr?-1:1;Hn=Math.abs(Math.log(kr/hr))/qt,Kn=function(){return 0},li=function(qn){return Math.exp(hi*qt*qn)}}return c.duration="duration"in c?+c.duration:1e3*Hn/("screenSpeed"in c?+c.screenSpeed/qt:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0),this._zooming=!0,this._rotating=U!==le,this._pitching=Oe!==H,this._padding=!P.isPaddingEqual(Pe),this._prepareEase(d,!1),this._ease(function(qn){var Xn=qn*Hn,go=1/li(Xn);P.zoom=qn===1?se:L+P.scaleZoom(go),E._rotating&&(P.bearing=m.number(U,le,qn)),E._pitching&&(P.pitch=m.number(H,Oe,qn)),E._padding&&(P.interpolatePadding(ae,Pe,qn),je=P.centerPoint.add(xe));var Qa=qn===1?vt:P.unproject(Wt.add(Zt.mult(Kn(Xn))).mult(go));P.setLocationAtPoint(P.renderWorldCopies?Qa.wrap():Qa,je),E._fireMoveEvents(d)},function(){return E._afterEase(d)},c),this},f.prototype.isEasing=function(){return!!this._easeFrameId},f.prototype.stop=function(){return this._stop()},f.prototype._stop=function(c,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var E=this._onEaseEnd;delete this._onEaseEnd,E.call(this,d)}if(!c){var w=this.handlers;w&&w.stop(!1)}return this},f.prototype._ease=function(c,d,E){E.animate===!1||E.duration===0?(c(1),d()):(this._easeStart=m.browser.now(),this._easeOptions=E,this._onEaseFrame=c,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},f.prototype._renderFrameCallback=function(){var c=Math.min((m.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},f.prototype._normalizeBearing=function(c,d){c=m.wrap(c,-180,180);var E=Math.abs(c-d);return Math.abs(c-360-d)<E&&(c-=360),Math.abs(c+360-d)<E&&(c+=360),c},f.prototype._normalizeCenter=function(c){var d=this.transform;if(d.renderWorldCopies&&!d.lngRange){var E=c.lng-d.center.lng;c.lng+=E>180?-360:E<-180?360:0}},f}(m.Evented),$o=function(l){l===void 0&&(l={}),this.options=l,m.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};$o.prototype.getDefaultPosition=function(){return"bottom-right"},$o.prototype.onAdd=function(l){var f=this.options&&this.options.compact;return this._map=l,this._container=W.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=W.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=W.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),f&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),f===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},$o.prototype.onRemove=function(){W.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},$o.prototype._setElementTitle=function(l,f){var c=this._map._getUIString("AttributionControl."+f);l.title=c,l.setAttribute("aria-label",c)},$o.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},$o.prototype._updateEditLink=function(){var l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));var f=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||m.config.ACCESS_TOKEN}];if(l){var c=f.reduce(function(d,E,w){return E.value&&(d+=E.key+"="+E.value+(w<f.length-1?"&":"")),d},"?");l.href=m.config.FEEDBACK_URL+"/"+c+(this._map._hash?this._map._hash.getHashString(!0):""),l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}},$o.prototype._updateData=function(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},$o.prototype._updateAttributions=function(){if(this._map.style){var l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(function(L){return typeof L!="string"?"":L})):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){var f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}var c=this._map.style.sourceCaches;for(var d in c){var E=c[d];if(E.used){var w=E.getSource();w.attribution&&l.indexOf(w.attribution)<0&&l.push(w.attribution)}}l.sort(function(L,U){return L.length-U.length});var P=(l=l.filter(function(L,U){for(var H=U+1;H<l.length;H++)if(l[H].indexOf(L)>=0)return!1;return!0})).join(" | ");P!==this._attribHTML&&(this._attribHTML=P,l.length?(this._innerContainer.innerHTML=P,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},$o.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var $s=function(){m.bindAll(["_updateLogo"],this),m.bindAll(["_updateCompact"],this)};$s.prototype.onAdd=function(l){this._map=l,this._container=W.create("div","mapboxgl-ctrl");var f=W.create("a","mapboxgl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://www.mapbox.com/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},$s.prototype.onRemove=function(){W.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},$s.prototype.getDefaultPosition=function(){return"bottom-left"},$s.prototype._updateLogo=function(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},$s.prototype._logoRequired=function(){if(this._map.style){var l=this._map.style.sourceCaches;for(var f in l)if(l[f].getSource().mapbox_logo)return!0;return!1}},$s.prototype._updateCompact=function(){var l=this._container.children;if(l.length){var f=l[0];this._map.getCanvasContainer().offsetWidth<250?f.classList.add("mapboxgl-compact"):f.classList.remove("mapboxgl-compact")}};var Go=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Go.prototype.add=function(l){var f=++this._id;return this._queue.push({callback:l,id:f,cancelled:!1}),f},Go.prototype.remove=function(l){for(var f=this._currentlyRunning,c=0,d=f?this._queue.concat(f):this._queue;c<d.length;c+=1){var E=d[c];if(E.id===l)return void(E.cancelled=!0)}},Go.prototype.run=function(l){l===void 0&&(l=0);var f=this._currentlyRunning=this._queue;this._queue=[];for(var c=0,d=f;c<d.length;c+=1){var E=d[c];if(!E.cancelled&&(E.callback(l),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Go.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var du={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Yf=m.window.HTMLImageElement,jc=m.window.HTMLElement,ga=m.window.ImageBitmap,La={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},pl=function(l){function f(d){var E=this;if((d=m.extend({},La,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var w=new Xi(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies);if(l.call(this,w,d),this._interactive=d.interactive,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._crossSourceCollisions=d.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=d.collectResourceTiming,this._renderTaskQueue=new Go,this._controls=[],this._mapId=m.uniqueId(),this._locale=m.extend({},du,d.locale),this._clickTolerance=d.clickTolerance,this._requestManager=new m.RequestManager(d.transformRequest,d.accessToken),typeof d.container=="string"){if(this._container=m.window.document.getElementById(d.container),!this._container)throw new Error("Container '"+d.container+"' not found.")}else{if(!(d.container instanceof jc))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(d.maxBounds&&this.setMaxBounds(d.maxBounds),m.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return E._update(!1)}),this.on("moveend",function(){return E._update(!1)}),this.on("zoom",function(){return E._update(!0)}),m.window!==void 0&&(m.window.addEventListener("online",this._onWindowOnline,!1),m.window.addEventListener("resize",this._onWindowResize,!1),m.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Cn(this,d),this._hash=d.hash&&new _s(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,m.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localIdeographFontFamily:d.localIdeographFontFamily}),d.attributionControl&&this.addControl(new $o({customAttribution:d.customAttribution})),this.addControl(new $s,d.logoPosition),this.on("style.load",function(){E.transform.unmodified&&E.jumpTo(E.style.stylesheet)}),this.on("data",function(P){E._update(P.dataType==="style"),E.fire(new m.Event(P.dataType+"data",P))}),this.on("dataloading",function(P){E.fire(new m.Event(P.dataType+"dataloading",P))})}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return f.prototype._getMapId=function(){return this._mapId},f.prototype.addControl=function(d,E){if(E===void 0&&(E=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new m.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var w=d.onAdd(this);this._controls.push(d);var P=this._controlPositions[E];return E.indexOf("bottom")!==-1?P.insertBefore(w,P.firstChild):P.appendChild(w),this},f.prototype.removeControl=function(d){if(!d||!d.onRemove)return this.fire(new m.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var E=this._controls.indexOf(d);return E>-1&&this._controls.splice(E,1),d.onRemove(this),this},f.prototype.hasControl=function(d){return this._controls.indexOf(d)>-1},f.prototype.resize=function(d){var E=this._containerDimensions(),w=E[0],P=E[1];if(w===this.transform.width&&P===this.transform.height)return this;this._resizeCanvas(w,P),this.transform.resize(w,P),this.painter.resize(w,P);var L=!this._moving;return L&&this.fire(new m.Event("movestart",d)).fire(new m.Event("move",d)),this.fire(new m.Event("resize",d)),L&&this.fire(new m.Event("moveend",d)),this},f.prototype.getBounds=function(){return this.transform.getBounds()},f.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},f.prototype.setMaxBounds=function(d){return this.transform.setMaxBounds(m.LngLatBounds.convert(d)),this._update()},f.prototype.setMinZoom=function(d){if((d=d==null?-2:d)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d&&this.setZoom(d),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},f.prototype.getMinZoom=function(){return this.transform.minZoom},f.prototype.setMaxZoom=function(d){if((d=d==null?22:d)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d&&this.setZoom(d),this;throw new Error("maxZoom must be greater than the current minZoom")},f.prototype.getMaxZoom=function(){return this.transform.maxZoom},f.prototype.setMinPitch=function(d){if((d=d==null?0:d)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d&&this.setPitch(d),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},f.prototype.getMinPitch=function(){return this.transform.minPitch},f.prototype.setMaxPitch=function(d){if((d=d==null?60:d)>60)throw new Error("maxPitch must be less than or equal to 60");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d&&this.setPitch(d),this;throw new Error("maxPitch must be greater than the current minPitch")},f.prototype.getMaxPitch=function(){return this.transform.maxPitch},f.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},f.prototype.setRenderWorldCopies=function(d){return this.transform.renderWorldCopies=d,this._update()},f.prototype.project=function(d){return this.transform.locationPoint(m.LngLat.convert(d))},f.prototype.unproject=function(d){return this.transform.pointLocation(m.Point.convert(d))},f.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},f.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},f.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},f.prototype._createDelegatedListener=function(d,E,w){var P,L=this;if(d==="mouseenter"||d==="mouseover"){var U=!1;return{layer:E,listener:w,delegates:{mousemove:function(ae){var se=L.getLayer(E)?L.queryRenderedFeatures(ae.point,{layers:[E]}):[];se.length?U||(U=!0,w.call(L,new vo(d,L,ae.originalEvent,{features:se}))):U=!1},mouseout:function(){U=!1}}}}if(d==="mouseleave"||d==="mouseout"){var H=!1;return{layer:E,listener:w,delegates:{mousemove:function(ae){(L.getLayer(E)?L.queryRenderedFeatures(ae.point,{layers:[E]}):[]).length?H=!0:H&&(H=!1,w.call(L,new vo(d,L,ae.originalEvent)))},mouseout:function(ae){H&&(H=!1,w.call(L,new vo(d,L,ae.originalEvent)))}}}}return{layer:E,listener:w,delegates:(P={},P[d]=function(ae){var se=L.getLayer(E)?L.queryRenderedFeatures(ae.point,{layers:[E]}):[];se.length&&(ae.features=se,w.call(L,ae),delete ae.features)},P)}},f.prototype.on=function(d,E,w){if(w===void 0)return l.prototype.on.call(this,d,E);var P=this._createDelegatedListener(d,E,w);for(var L in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(P),P.delegates)this.on(L,P.delegates[L]);return this},f.prototype.once=function(d,E,w){if(w===void 0)return l.prototype.once.call(this,d,E);var P=this._createDelegatedListener(d,E,w);for(var L in P.delegates)this.once(L,P.delegates[L]);return this},f.prototype.off=function(d,E,w){var P=this;return w===void 0?l.prototype.off.call(this,d,E):(this._delegatedListeners&&this._delegatedListeners[d]&&function(L){for(var U=L[d],H=0;H<U.length;H++){var ae=U[H];if(ae.layer===E&&ae.listener===w){for(var se in ae.delegates)P.off(se,ae.delegates[se]);return U.splice(H,1),P}}}(this._delegatedListeners),this)},f.prototype.queryRenderedFeatures=function(d,E){if(!this.style)return[];var w;if(E!==void 0||d===void 0||d instanceof m.Point||Array.isArray(d)||(E=d,d=void 0),E=E||{},(d=d||[[0,0],[this.transform.width,this.transform.height]])instanceof m.Point||typeof d[0]=="number")w=[m.Point.convert(d)];else{var P=m.Point.convert(d[0]),L=m.Point.convert(d[1]);w=[P,new m.Point(L.x,P.y),L,new m.Point(P.x,L.y),P]}return this.style.queryRenderedFeatures(w,E,this.transform)},f.prototype.querySourceFeatures=function(d,E){return this.style.querySourceFeatures(d,E)},f.prototype.setStyle=function(d,E){return(E=m.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},E)).diff!==!1&&E.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&d?(this._diffStyle(d,E),this):(this._localIdeographFontFamily=E.localIdeographFontFamily,this._updateStyle(d,E))},f.prototype._getUIString=function(d){var E=this._locale[d];if(E==null)throw new Error("Missing UI string '"+d+"'");return E},f.prototype._updateStyle=function(d,E){return this.style&&(this.style.setEventedParent(null),this.style._remove()),d?(this.style=new gs(this,E||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d):this.style.loadJSON(d),this):(delete this.style,this)},f.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new gs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},f.prototype._diffStyle=function(d,E){var w=this;if(typeof d=="string"){var P=this._requestManager.normalizeStyleURL(d),L=this._requestManager.transformRequest(P,m.ResourceType.Style);m.getJSON(L,function(U,H){U?w.fire(new m.ErrorEvent(U)):H&&w._updateDiff(H,E)})}else typeof d=="object"&&this._updateDiff(d,E)},f.prototype._updateDiff=function(d,E){try{this.style.setState(d)&&this._update(!0)}catch(w){m.warnOnce("Unable to perform style diff: "+(w.message||w.error||w)+".  Rebuilding the style from scratch."),this._updateStyle(d,E)}},f.prototype.getStyle=function(){if(this.style)return this.style.serialize()},f.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():m.warnOnce("There is no style added to the map.")},f.prototype.addSource=function(d,E){return this._lazyInitEmptyStyle(),this.style.addSource(d,E),this._update(!0)},f.prototype.isSourceLoaded=function(d){var E=this.style&&this.style.sourceCaches[d];if(E!==void 0)return E.loaded();this.fire(new m.ErrorEvent(new Error("There is no source with ID '"+d+"'")))},f.prototype.areTilesLoaded=function(){var d=this.style&&this.style.sourceCaches;for(var E in d){var w=d[E]._tiles;for(var P in w){var L=w[P];if(L.state!=="loaded"&&L.state!=="errored")return!1}}return!0},f.prototype.addSourceType=function(d,E,w){return this._lazyInitEmptyStyle(),this.style.addSourceType(d,E,w)},f.prototype.removeSource=function(d){return this.style.removeSource(d),this._update(!0)},f.prototype.getSource=function(d){return this.style.getSource(d)},f.prototype.addImage=function(d,E,w){w===void 0&&(w={});var P=w.pixelRatio;P===void 0&&(P=1);var L=w.sdf;L===void 0&&(L=!1);var U=w.stretchX,H=w.stretchY,ae=w.content;if(this._lazyInitEmptyStyle(),E instanceof Yf||ga&&E instanceof ga){var se=m.browser.getImageData(E);this.style.addImage(d,{data:new m.RGBAImage({width:se.width,height:se.height},se.data),pixelRatio:P,stretchX:U,stretchY:H,content:ae,sdf:L,version:0})}else{if(E.width===void 0||E.height===void 0)return this.fire(new m.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var le=E;this.style.addImage(d,{data:new m.RGBAImage({width:E.width,height:E.height},new Uint8Array(E.data)),pixelRatio:P,stretchX:U,stretchY:H,content:ae,sdf:L,version:0,userImage:le}),le.onAdd&&le.onAdd(this,d)}},f.prototype.updateImage=function(d,E){var w=this.style.getImage(d);if(!w)return this.fire(new m.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var P=E instanceof Yf||ga&&E instanceof ga?m.browser.getImageData(E):E,L=P.width,U=P.height,H=P.data;return L===void 0||U===void 0?this.fire(new m.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):L!==w.data.width||U!==w.data.height?this.fire(new m.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(w.data.replace(H,!(E instanceof Yf||ga&&E instanceof ga)),void this.style.updateImage(d,w))},f.prototype.hasImage=function(d){return d?!!this.style.getImage(d):(this.fire(new m.ErrorEvent(new Error("Missing required image id"))),!1)},f.prototype.removeImage=function(d){this.style.removeImage(d)},f.prototype.loadImage=function(d,E){m.getImage(this._requestManager.transformRequest(d,m.ResourceType.Image),E)},f.prototype.listImages=function(){return this.style.listImages()},f.prototype.addLayer=function(d,E){return this._lazyInitEmptyStyle(),this.style.addLayer(d,E),this._update(!0)},f.prototype.moveLayer=function(d,E){return this.style.moveLayer(d,E),this._update(!0)},f.prototype.removeLayer=function(d){return this.style.removeLayer(d),this._update(!0)},f.prototype.getLayer=function(d){return this.style.getLayer(d)},f.prototype.setLayerZoomRange=function(d,E,w){return this.style.setLayerZoomRange(d,E,w),this._update(!0)},f.prototype.setFilter=function(d,E,w){return w===void 0&&(w={}),this.style.setFilter(d,E,w),this._update(!0)},f.prototype.getFilter=function(d){return this.style.getFilter(d)},f.prototype.setPaintProperty=function(d,E,w,P){return P===void 0&&(P={}),this.style.setPaintProperty(d,E,w,P),this._update(!0)},f.prototype.getPaintProperty=function(d,E){return this.style.getPaintProperty(d,E)},f.prototype.setLayoutProperty=function(d,E,w,P){return P===void 0&&(P={}),this.style.setLayoutProperty(d,E,w,P),this._update(!0)},f.prototype.getLayoutProperty=function(d,E){return this.style.getLayoutProperty(d,E)},f.prototype.setLight=function(d,E){return E===void 0&&(E={}),this._lazyInitEmptyStyle(),this.style.setLight(d,E),this._update(!0)},f.prototype.getLight=function(){return this.style.getLight()},f.prototype.setFeatureState=function(d,E){return this.style.setFeatureState(d,E),this._update()},f.prototype.removeFeatureState=function(d,E){return this.style.removeFeatureState(d,E),this._update()},f.prototype.getFeatureState=function(d){return this.style.getFeatureState(d)},f.prototype.getContainer=function(){return this._container},f.prototype.getCanvasContainer=function(){return this._canvasContainer},f.prototype.getCanvas=function(){return this._canvas},f.prototype._containerDimensions=function(){var d=0,E=0;return this._container&&(d=this._container.clientWidth||400,E=this._container.clientHeight||300),[d,E]},f.prototype._detectMissingCSS=function(){m.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&m.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},f.prototype._setupContainer=function(){var d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=W.create("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();var E=this._canvasContainer=W.create("div","mapboxgl-canvas-container",d);this._interactive&&E.classList.add("mapboxgl-interactive"),this._canvas=W.create("canvas","mapboxgl-canvas",E),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var w=this._containerDimensions();this._resizeCanvas(w[0],w[1]);var P=this._controlContainer=W.create("div","mapboxgl-control-container",d),L=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(U){L[U]=W.create("div","mapboxgl-ctrl-"+U,P)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},f.prototype._resizeCanvas=function(d,E){var w=m.browser.devicePixelRatio||1;this._canvas.width=w*d,this._canvas.height=w*E,this._canvas.style.width=d+"px",this._canvas.style.height=E+"px"},f.prototype._setupPainter=function(){var d=m.extend({},Re.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),E=this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);E?(this.painter=new $i(E,this.transform),m.webpSupported.testSupport(E)):this.fire(new m.ErrorEvent(new Error("Failed to initialize WebGL")))},f.prototype._contextLost=function(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new m.Event("webglcontextlost",{originalEvent:d}))},f.prototype._contextRestored=function(d){this._setupPainter(),this.resize(),this._update(),this.fire(new m.Event("webglcontextrestored",{originalEvent:d}))},f.prototype._onMapScroll=function(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},f.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},f.prototype._update=function(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this},f.prototype._requestRenderFrame=function(d){return this._update(),this._renderTaskQueue.add(d)},f.prototype._cancelRenderFrame=function(d){this._renderTaskQueue.remove(d)},f.prototype._render=function(d){var E,w=this,P=0,L=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(E=L.createQueryEXT(),L.beginQueryEXT(L.TIME_ELAPSED_EXT,E),P=m.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),!this._removed){var U=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var H=this.transform.zoom,ae=m.browser.now();this.style.zoomHistory.update(H,ae);var se=new m.EvaluationParameters(H,{now:ae,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),le=se.crossFadingFactor();le===1&&le===this._crossFadingFactor||(U=!0,this._crossFadingFactor=le),this.style.update(se)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new m.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new m.Event("load"))),this.style&&(this.style.hasTransitions()||U)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Oe=m.browser.now()-P;L.endQueryEXT(L.TIME_ELAPSED_EXT,E),setTimeout(function(){var xe=L.getQueryObjectEXT(E,L.QUERY_RESULT_EXT)/1e6;L.deleteQueryEXT(E),w.fire(new m.Event("gpu-timing-frame",{cpuTime:Oe,gpuTime:xe}))},50)}if(this.listens("gpu-timing-layer")){var Pe=this.painter.collectGpuTimers();setTimeout(function(){var xe=w.painter.queryGpuTimers(Pe);w.fire(new m.Event("gpu-timing-layer",{layerTimes:xe}))},50)}var Ne=this._sourcesDirty||this._styleDirty||this._placementDirty;return Ne||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new m.Event("idle")),!this._loaded||this._fullyLoaded||Ne||(this._fullyLoaded=!0),this}},f.prototype.remove=function(){this._hash&&this._hash.remove();for(var d=0,E=this._controls;d<E.length;d+=1)E[d].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),m.window!==void 0&&(m.window.removeEventListener("resize",this._onWindowResize,!1),m.window.removeEventListener("orientationchange",this._onWindowResize,!1),m.window.removeEventListener("online",this._onWindowOnline,!1));var w=this.painter.context.gl.getExtension("WEBGL_lose_context");w&&w.loseContext(),fc(this._canvasContainer),fc(this._controlContainer),fc(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new m.Event("remove"))},f.prototype.triggerRepaint=function(){var d=this;this.style&&!this._frame&&(this._frame=m.browser.frame(function(E){d._frame=null,d._render(E)}))},f.prototype._onWindowOnline=function(){this._update()},f.prototype._onWindowResize=function(d){this._trackResize&&this.resize({originalEvent:d})._update()},c.showTileBoundaries.get=function(){return!!this._showTileBoundaries},c.showTileBoundaries.set=function(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())},c.showPadding.get=function(){return!!this._showPadding},c.showPadding.set=function(d){this._showPadding!==d&&(this._showPadding=d,this._update())},c.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},c.showCollisionBoxes.set=function(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())},c.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},c.showOverdrawInspector.set=function(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())},c.repaint.get=function(){return!!this._repaint},c.repaint.set=function(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())},c.vertices.get=function(){return!!this._vertices},c.vertices.set=function(d){this._vertices=d,this._update()},f.prototype._setCacheLimits=function(d,E){m.setCacheLimits(d,E)},c.version.get=function(){return m.version},Object.defineProperties(f.prototype,c),f}(Zc);function fc(l){l.parentNode&&l.parentNode.removeChild(l)}var Qs={showCompass:!0,showZoom:!0,visualizePitch:!1},vu=function(l){var f=this;this.options=m.extend({},Qs,l),this._container=W.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(c){return c.preventDefault()}),this.options.showZoom&&(m.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(c){return f._map.zoomIn({},{originalEvent:c})}),W.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(c){return f._map.zoomOut({},{originalEvent:c})}),W.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(m.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(c){f.options.visualizePitch?f._map.resetNorthPitch({},{originalEvent:c}):f._map.resetNorth({},{originalEvent:c})}),this._compassIcon=W.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};vu.prototype._updateZoomButtons=function(){var l=this._map.getZoom(),f=l===this._map.getMaxZoom(),c=l===this._map.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},vu.prototype._rotateCompassArrow=function(){var l=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=l},vu.prototype.onAdd=function(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new _i(this._map,this._compass,this.options.visualizePitch)),this._container},vu.prototype.onRemove=function(){W.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},vu.prototype._createButton=function(l,f){var c=W.create("button",l,this._container);return c.type="button",c.addEventListener("click",f),c},vu.prototype._setButtonTitle=function(l,f){var c=this._map._getUIString("NavigationControl."+f);l.title=c,l.setAttribute("aria-label",c)};var _i=function(l,f,c){c===void 0&&(c=!1),this._clickTolerance=10,this.element=f,this.mouseRotate=new Ef({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,c&&(this.mousePitch=new ll({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),m.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),W.addEventListener(f,"mousedown",this.mousedown),W.addEventListener(f,"touchstart",this.touchstart,{passive:!1}),W.addEventListener(f,"touchmove",this.touchmove),W.addEventListener(f,"touchend",this.touchend),W.addEventListener(f,"touchcancel",this.reset)};function Bs(l,f,c){if(l=new m.LngLat(l.lng,l.lat),f){var d=new m.LngLat(l.lng-360,l.lat),E=new m.LngLat(l.lng+360,l.lat),w=c.locationPoint(l).distSqr(f);c.locationPoint(d).distSqr(f)<w?l=d:c.locationPoint(E).distSqr(f)<w&&(l=E)}for(;Math.abs(l.lng-c.center.lng)>180;){var P=c.locationPoint(l);if(P.x>=0&&P.y>=0&&P.x<=c.width&&P.y<=c.height)break;l.lng>c.center.lng?l.lng-=360:l.lng+=360}return l}_i.prototype.down=function(l,f){this.mouseRotate.mousedown(l,f),this.mousePitch&&this.mousePitch.mousedown(l,f),W.disableDrag()},_i.prototype.move=function(l,f){var c=this.map,d=this.mouseRotate.mousemoveWindow(l,f);if(d&&d.bearingDelta&&c.setBearing(c.getBearing()+d.bearingDelta),this.mousePitch){var E=this.mousePitch.mousemoveWindow(l,f);E&&E.pitchDelta&&c.setPitch(c.getPitch()+E.pitchDelta)}},_i.prototype.off=function(){var l=this.element;W.removeEventListener(l,"mousedown",this.mousedown),W.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),W.removeEventListener(l,"touchmove",this.touchmove),W.removeEventListener(l,"touchend",this.touchend),W.removeEventListener(l,"touchcancel",this.reset),this.offTemp()},_i.prototype.offTemp=function(){W.enableDrag(),W.removeEventListener(m.window,"mousemove",this.mousemove),W.removeEventListener(m.window,"mouseup",this.mouseup)},_i.prototype.mousedown=function(l){this.down(m.extend({},l,{ctrlKey:!0,preventDefault:function(){return l.preventDefault()}}),W.mousePos(this.element,l)),W.addEventListener(m.window,"mousemove",this.mousemove),W.addEventListener(m.window,"mouseup",this.mouseup)},_i.prototype.mousemove=function(l){this.move(l,W.mousePos(this.element,l))},_i.prototype.mouseup=function(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()},_i.prototype.touchstart=function(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=W.touchPos(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return l.preventDefault()}},this._startPos))},_i.prototype.touchmove=function(l){l.targetTouches.length!==1?this.reset():(this._lastPos=W.touchPos(this.element,l.targetTouches)[0],this.move({preventDefault:function(){return l.preventDefault()}},this._lastPos))},_i.prototype.touchend=function(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},_i.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Ps={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function hl(l,f,c){var d=l.classList;for(var E in Ps)d.remove("mapboxgl-"+c+"-anchor-"+E);d.add("mapboxgl-"+c+"-anchor-"+f)}var Lu,Qu=function(l){function f(c,d){if(l.call(this),(c instanceof m.window.HTMLElement||d)&&(c=m.extend({element:c},d)),m.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment!=="auto"?c.pitchAlignment:this._rotationAlignment,c&&c.element)this._element=c.element,this._offset=m.Point.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=W.create("div"),this._element.setAttribute("aria-label","Map marker");var E=W.createNS("http://www.w3.org/2000/svg","svg");E.setAttributeNS(null,"display","block"),E.setAttributeNS(null,"height","41px"),E.setAttributeNS(null,"width","27px"),E.setAttributeNS(null,"viewBox","0 0 27 41");var w=W.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"stroke","none"),w.setAttributeNS(null,"stroke-width","1"),w.setAttributeNS(null,"fill","none"),w.setAttributeNS(null,"fill-rule","evenodd");var P=W.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill-rule","nonzero");var L=W.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"transform","translate(3.0, 29.0)"),L.setAttributeNS(null,"fill","#000000");for(var U=0,H=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];U<H.length;U+=1){var ae=H[U],se=W.createNS("http://www.w3.org/2000/svg","ellipse");se.setAttributeNS(null,"opacity","0.04"),se.setAttributeNS(null,"cx","10.5"),se.setAttributeNS(null,"cy","5.80029008"),se.setAttributeNS(null,"rx",ae.rx),se.setAttributeNS(null,"ry",ae.ry),L.appendChild(se)}var le=W.createNS("http://www.w3.org/2000/svg","g");le.setAttributeNS(null,"fill",this._color);var Oe=W.createNS("http://www.w3.org/2000/svg","path");Oe.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),le.appendChild(Oe);var Pe=W.createNS("http://www.w3.org/2000/svg","g");Pe.setAttributeNS(null,"opacity","0.25"),Pe.setAttributeNS(null,"fill","#000000");var Ne=W.createNS("http://www.w3.org/2000/svg","path");Ne.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Pe.appendChild(Ne);var xe=W.createNS("http://www.w3.org/2000/svg","g");xe.setAttributeNS(null,"transform","translate(6.0, 7.0)"),xe.setAttributeNS(null,"fill","#FFFFFF");var je=W.createNS("http://www.w3.org/2000/svg","g");je.setAttributeNS(null,"transform","translate(8.0, 8.0)");var Ke=W.createNS("http://www.w3.org/2000/svg","circle");Ke.setAttributeNS(null,"fill","#000000"),Ke.setAttributeNS(null,"opacity","0.25"),Ke.setAttributeNS(null,"cx","5.5"),Ke.setAttributeNS(null,"cy","5.5"),Ke.setAttributeNS(null,"r","5.4999962");var vt=W.createNS("http://www.w3.org/2000/svg","circle");vt.setAttributeNS(null,"fill","#FFFFFF"),vt.setAttributeNS(null,"cx","5.5"),vt.setAttributeNS(null,"cy","5.5"),vt.setAttributeNS(null,"r","5.4999962"),je.appendChild(Ke),je.appendChild(vt),P.appendChild(L),P.appendChild(le),P.appendChild(Pe),P.appendChild(xe),P.appendChild(je),E.appendChild(P),E.setAttributeNS(null,"height",41*this._scale+"px"),E.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(E),this._offset=m.Point.convert(c&&c.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(Wt){Wt.preventDefault()}),this._element.addEventListener("mousedown",function(Wt){Wt.preventDefault()}),hl(this._element,this._anchor,"marker"),this._popup=null}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.addTo=function(c){return this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._update),c.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},f.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),W.remove(this._element),this._popup&&this._popup.remove(),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(c){return this._lngLat=m.LngLat.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},f.prototype.getElement=function(){return this._element},f.prototype.setPopup=function(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){var d=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(24.6+d)],"bottom-right":[-d,-1*(24.6+d)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=c,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},f.prototype._onKeyPress=function(c){var d=c.code,E=c.charCode||c.keyCode;d!=="Space"&&d!=="Enter"&&E!==32&&E!==13||this.togglePopup()},f.prototype._onMapClick=function(c){var d=c.originalEvent.target,E=this._element;this._popup&&(d===E||E.contains(d))&&this.togglePopup()},f.prototype.getPopup=function(){return this._popup},f.prototype.togglePopup=function(){var c=this._popup;return c?(c.isOpen()?c.remove():c.addTo(this._map),this):this},f.prototype._update=function(c){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Bs(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(d="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var E="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?E="rotateX(0deg)":this._pitchAlignment==="map"&&(E="rotateX("+this._map.getPitch()+"deg)"),c&&c.type!=="moveend"||(this._pos=this._pos.round()),W.setTransform(this._element,Ps[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+E+" "+d)}},f.prototype.getOffset=function(){return this._offset},f.prototype.setOffset=function(c){return this._offset=m.Point.convert(c),this._update(),this},f.prototype._onMove=function(c){if(!this._isDragging){var d=this._clickTolerance||this._map._clickTolerance;this._isDragging=c.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=c.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new m.Event("dragstart"))),this.fire(new m.Event("drag")))},f.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new m.Event("dragend")),this._state="inactive"},f.prototype._addDragHandler=function(c){this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(this._pos).add(this._offset),this._pointerdownPos=c.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},f.prototype.setDraggable=function(c){return this._draggable=!!c,this._map&&(c?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},f.prototype.isDraggable=function(){return this._draggable},f.prototype.setRotation=function(c){return this._rotation=c||0,this._update(),this},f.prototype.getRotation=function(){return this._rotation},f.prototype.setRotationAlignment=function(c){return this._rotationAlignment=c||"auto",this._update(),this},f.prototype.getRotationAlignment=function(){return this._rotationAlignment},f.prototype.setPitchAlignment=function(c){return this._pitchAlignment=c&&c!=="auto"?c:this._rotationAlignment,this._update(),this},f.prototype.getPitchAlignment=function(){return this._pitchAlignment},f}(m.Evented),Vc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Pa=0,Js=!1,Ul=function(l){function f(c){l.call(this),this.options=m.extend({},Vc,c),m.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.onAdd=function(c){var d;return this._map=c,this._container=W.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),d=this._setupUI,Lu!==void 0?d(Lu):m.window.navigator.permissions!==void 0?m.window.navigator.permissions.query({name:"geolocation"}).then(function(E){d(Lu=E.state!=="denied")}):d(Lu=!!m.window.navigator.geolocation),this._container},f.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(m.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),W.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Pa=0,Js=!1},f.prototype._isOutOfMapMaxBounds=function(c){var d=this._map.getMaxBounds(),E=c.coords;return d&&(E.longitude<d.getWest()||E.longitude>d.getEast()||E.latitude<d.getSouth()||E.latitude>d.getNorth())},f.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},f.prototype._onSuccess=function(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new m.Event("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new m.Event("geolocate",c)),this._finish()}},f.prototype._updateCamera=function(c){var d=new m.LngLat(c.coords.longitude,c.coords.latitude),E=c.coords.accuracy,w=this._map.getBearing(),P=m.extend({bearing:w},this.options.fitBoundsOptions);this._map.fitBounds(d.toBounds(E),P,{geolocateSource:!0})},f.prototype._updateMarker=function(c){if(c){var d=new m.LngLat(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},f.prototype._updateCircleRadius=function(){var c=this._map._container.clientHeight/2,d=this._map.unproject([0,c]),E=this._map.unproject([1,c]),w=d.distanceTo(E),P=Math.ceil(2*this._accuracy/w);this._circleElement.style.width=P+"px",this._circleElement.style.height=P+"px"},f.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},f.prototype._onError=function(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&Js)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new m.Event("error",c)),this._finish()}},f.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},f.prototype._setupUI=function(c){var d=this;if(this._container.addEventListener("contextmenu",function(P){return P.preventDefault()}),this._geolocateButton=W.create("button","mapboxgl-ctrl-geolocate",this._container),W.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",c===!1){m.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var E=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=E,this._geolocateButton.setAttribute("aria-label",E)}else{var w=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=w,this._geolocateButton.setAttribute("aria-label",w)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=W.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Qu(this._dotElement),this._circleElement=W.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Qu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(P){P.geolocateSource||d._watchState!=="ACTIVE_LOCK"||P.originalEvent&&P.originalEvent.type==="resize"||(d._watchState="BACKGROUND",d._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),d._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),d.fire(new m.Event("trackuserlocationend")))})},f.prototype.trigger=function(){if(!this._setup)return m.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new m.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Pa--,Js=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new m.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new m.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++Pa>1?(c={maximumAge:6e5,timeout:0},Js=!0):(c=this.options.positionOptions,Js=!1),this._geolocationWatchID=m.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,c)}}else m.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},f.prototype._clearWatch=function(){m.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},f}(m.Evented),dl={maxWidth:100,unit:"metric"},vl=function(l){this.options=m.extend({},dl,l),m.bindAll(["_onMove","setUnit"],this)};function Gc(l,f,c){var d=c&&c.maxWidth||100,E=l._container.clientHeight/2,w=l.unproject([0,E]),P=l.unproject([d,E]),L=w.distanceTo(P);if(c&&c.unit==="imperial"){var U=3.2808*L;U>5280?ml(f,d,U/5280,l._getUIString("ScaleControl.Miles")):ml(f,d,U,l._getUIString("ScaleControl.Feet"))}else c&&c.unit==="nautical"?ml(f,d,L/1852,l._getUIString("ScaleControl.NauticalMiles")):L>=1e3?ml(f,d,L/1e3,l._getUIString("ScaleControl.Kilometers")):ml(f,d,L,l._getUIString("ScaleControl.Meters"))}function ml(l,f,c,d){var E,w,P,L=(E=c,(w=Math.pow(10,(""+Math.floor(E)).length-1))*(P=(P=E/w)>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(U){var H=Math.pow(10,Math.ceil(-Math.log(U)/Math.LN10));return Math.round(U*H)/H}(P)));l.style.width=f*(L/c)+"px",l.innerHTML=L+"&nbsp;"+d}vl.prototype.getDefaultPosition=function(){return"bottom-left"},vl.prototype._onMove=function(){Gc(this._map,this._container,this.options)},vl.prototype.onAdd=function(l){return this._map=l,this._container=W.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},vl.prototype.onRemove=function(){W.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},vl.prototype.setUnit=function(l){this.options.unit=l,Gc(this._map,this._container,this.options)};var eu=function(l){this._fullscreen=!1,l&&l.container&&(l.container instanceof m.window.HTMLElement?this._container=l.container:m.warnOnce("Full screen control 'container' must be a DOM element.")),m.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in m.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in m.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in m.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in m.window.document&&(this._fullscreenchange="MSFullscreenChange")};eu.prototype.onAdd=function(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=W.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",m.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},eu.prototype.onRemove=function(){W.remove(this._controlContainer),this._map=null,m.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},eu.prototype._checkFullscreenSupport=function(){return!!(m.window.document.fullscreenEnabled||m.window.document.mozFullScreenEnabled||m.window.document.msFullscreenEnabled||m.window.document.webkitFullscreenEnabled)},eu.prototype._setupUI=function(){var l=this._fullscreenButton=W.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);W.create("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden",!0),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),m.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},eu.prototype._updateTitle=function(){var l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.title=l},eu.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},eu.prototype._isFullscreen=function(){return this._fullscreen},eu.prototype._changeIcon=function(){(m.window.document.fullscreenElement||m.window.document.mozFullScreenElement||m.window.document.webkitFullscreenElement||m.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},eu.prototype._onClickFullscreen=function(){this._isFullscreen()?m.window.document.exitFullscreen?m.window.document.exitFullscreen():m.window.document.mozCancelFullScreen?m.window.document.mozCancelFullScreen():m.window.document.msExitFullscreen?m.window.document.msExitFullscreen():m.window.document.webkitCancelFullScreen&&m.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var pc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Zl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),qf=function(l){function f(c){l.call(this),this.options=m.extend(Object.create(pc),c),m.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.addTo=function(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new m.Event("open")),this},f.prototype.isOpen=function(){return!!this._map},f.prototype.remove=function(){return this._content&&W.remove(this._content),this._container&&(W.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new m.Event("close")),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(c){return this._lngLat=m.LngLat.convert(c),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},f.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},f.prototype.getElement=function(){return this._container},f.prototype.setText=function(c){return this.setDOMContent(m.window.document.createTextNode(c))},f.prototype.setHTML=function(c){var d,E=m.window.document.createDocumentFragment(),w=m.window.document.createElement("body");for(w.innerHTML=c;d=w.firstChild;)E.appendChild(d);return this.setDOMContent(E)},f.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},f.prototype.setMaxWidth=function(c){return this.options.maxWidth=c,this._update(),this},f.prototype.setDOMContent=function(c){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=W.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(c),this._createCloseButton(),this._update(),this._focusFirstElement(),this},f.prototype.addClassName=function(c){this._container&&this._container.classList.add(c)},f.prototype.removeClassName=function(c){this._container&&this._container.classList.remove(c)},f.prototype.setOffset=function(c){return this.options.offset=c,this._update(),this},f.prototype.toggleClassName=function(c){if(this._container)return this._container.classList.toggle(c)},f.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=W.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},f.prototype._onMouseUp=function(c){this._update(c.point)},f.prototype._onMouseMove=function(c){this._update(c.point)},f.prototype._onDrag=function(c){this._update(c.point)},f.prototype._update=function(c){var d=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=W.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=W.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(se){return d._container.classList.add(se)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Bs(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||c)){var E=this._pos=this._trackPointer&&c?c:this._map.project(this._lngLat),w=this.options.anchor,P=function se(le){if(le){if(typeof le=="number"){var Oe=Math.round(Math.sqrt(.5*Math.pow(le,2)));return{center:new m.Point(0,0),top:new m.Point(0,le),"top-left":new m.Point(Oe,Oe),"top-right":new m.Point(-Oe,Oe),bottom:new m.Point(0,-le),"bottom-left":new m.Point(Oe,-Oe),"bottom-right":new m.Point(-Oe,-Oe),left:new m.Point(le,0),right:new m.Point(-le,0)}}if(le instanceof m.Point||Array.isArray(le)){var Pe=m.Point.convert(le);return{center:Pe,top:Pe,"top-left":Pe,"top-right":Pe,bottom:Pe,"bottom-left":Pe,"bottom-right":Pe,left:Pe,right:Pe}}return{center:m.Point.convert(le.center||[0,0]),top:m.Point.convert(le.top||[0,0]),"top-left":m.Point.convert(le["top-left"]||[0,0]),"top-right":m.Point.convert(le["top-right"]||[0,0]),bottom:m.Point.convert(le.bottom||[0,0]),"bottom-left":m.Point.convert(le["bottom-left"]||[0,0]),"bottom-right":m.Point.convert(le["bottom-right"]||[0,0]),left:m.Point.convert(le.left||[0,0]),right:m.Point.convert(le.right||[0,0])}}return se(new m.Point(0,0))}(this.options.offset);if(!w){var L,U=this._container.offsetWidth,H=this._container.offsetHeight;L=E.y+P.bottom.y<H?["top"]:E.y>this._map.transform.height-H?["bottom"]:[],E.x<U/2?L.push("left"):E.x>this._map.transform.width-U/2&&L.push("right"),w=L.length===0?"bottom":L.join("-")}var ae=E.add(P[w]).round();W.setTransform(this._container,Ps[w]+" translate("+ae.x+"px,"+ae.y+"px)"),hl(this._container,w,"popup")}},f.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var c=this._container.querySelector(Zl);c&&c.focus()}},f.prototype._onClose=function(){this.remove()},f}(m.Evented),jl={version:m.version,supported:Re,setRTLTextPlugin:m.setRTLTextPlugin,getRTLTextPluginStatus:m.getRTLTextPluginStatus,Map:pl,NavigationControl:vu,GeolocateControl:Ul,AttributionControl:$o,ScaleControl:vl,FullscreenControl:eu,Popup:qf,Marker:Qu,Style:gs,LngLat:m.LngLat,LngLatBounds:m.LngLatBounds,Point:m.Point,MercatorCoordinate:m.MercatorCoordinate,Evented:m.Evented,config:m.config,prewarm:function(){Tt().acquire(Ft)},clearPrewarmedResources:function(){var l=_n;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(Ft),_n=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return m.config.ACCESS_TOKEN},set accessToken(l){m.config.ACCESS_TOKEN=l},get baseApiUrl(){return m.config.API_URL},set baseApiUrl(l){m.config.API_URL=l},get workerCount(){return pr.workerCount},set workerCount(l){pr.workerCount=l},get maxParallelImageRequests(){return m.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){m.config.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage:function(l){m.clearTileCache(l)},workerUrl:""};return jl}),Ce})},28660:function(Er,re,Q){var Ce=Q(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var me;(function(m){(function(Re){var W=typeof Q.g=="object"?Q.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),pe=de(m);typeof W.Reflect=="undefined"?W.Reflect=m:pe=de(W.Reflect,pe),Re(pe);function de(ze,_e){return function(et,mt){typeof ze[et]!="function"&&Object.defineProperty(ze,et,{configurable:!0,writable:!0,value:mt}),_e&&_e(et,mt)}}})(function(Re){var W=Object.prototype.hasOwnProperty,pe=typeof Symbol=="function",de=pe&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",ze=pe&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",_e=typeof Object.create=="function",et={__proto__:[]}instanceof Array,mt=!_e&&!et,Ct={create:_e?function(){return su(Object.create(null))}:et?function(){return su({__proto__:null})}:function(){return su({})},has:mt?function(Ut,er){return W.call(Ut,er)}:function(Ut,er){return er in Ut},get:mt?function(Ut,er){return W.call(Ut,er)?Ut[er]:void 0}:function(Ut,er){return Ut[er]}},Bt=Object.getPrototypeOf(Function),or=typeof Ce=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",At=!or&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:fe(),Kt=!or&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:ui(),yt=!or&&typeof WeakMap=="function"?WeakMap:bo(),ct=new yt;function it(Ut,er,Rr,an){if(Gr(Rr)){if(!Ii(Ut))throw new TypeError;if(!ra(er))throw new TypeError;return Fr(Ut,er)}else{if(!Ii(Ut))throw new TypeError;if(!zn(er))throw new TypeError;if(!zn(an)&&!Gr(an)&&!Nn(an))throw new TypeError;return Nn(an)&&(an=void 0),Rr=zi(Rr),Yr(Ut,er,Rr,an)}}Re("decorate",it);function $t(Ut,er){function Rr(an,Tn){if(!zn(an))throw new TypeError;if(!Gr(Tn)&&!Ya(Tn))throw new TypeError;Rt(Ut,er,an,Tn)}return Rr}Re("metadata",$t);function X(Ut,er,Rr,an){if(!zn(Rr))throw new TypeError;return Gr(an)||(an=zi(an)),Rt(Ut,er,Rr,an)}Re("defineMetadata",X);function Xt(Ut,er,Rr){if(!zn(er))throw new TypeError;return Gr(Rr)||(Rr=zi(Rr)),Se(Ut,er,Rr)}Re("hasMetadata",Xt);function at(Ut,er,Rr){if(!zn(er))throw new TypeError;return Gr(Rr)||(Rr=zi(Rr)),ke(Ut,er,Rr)}Re("hasOwnMetadata",at);function qe(Ut,er,Rr){if(!zn(er))throw new TypeError;return Gr(Rr)||(Rr=zi(Rr)),ut(Ut,er,Rr)}Re("getMetadata",qe);function xt(Ut,er,Rr){if(!zn(er))throw new TypeError;return Gr(Rr)||(Rr=zi(Rr)),ft(Ut,er,Rr)}Re("getOwnMetadata",xt);function $e(Ut,er){if(!zn(Ut))throw new TypeError;return Gr(er)||(er=zi(er)),Dt(Ut,er)}Re("getMetadataKeys",$e);function Ht(Ut,er){if(!zn(Ut))throw new TypeError;return Gr(er)||(er=zi(er)),gr(Ut,er)}Re("getOwnMetadataKeys",Ht);function vr(Ut,er,Rr){if(!zn(er))throw new TypeError;Gr(Rr)||(Rr=zi(Rr));var an=A(er,Rr,!1);if(Gr(an)||!an.delete(Ut))return!1;if(an.size>0)return!0;var Tn=ct.get(er);return Tn.delete(Rr),Tn.size>0||ct.delete(er),!0}Re("deleteMetadata",vr);function Fr(Ut,er){for(var Rr=Ut.length-1;Rr>=0;--Rr){var an=Ut[Rr],Tn=an(er);if(!Gr(Tn)&&!Nn(Tn)){if(!ra(Tn))throw new TypeError;er=Tn}}return er}function Yr(Ut,er,Rr,an){for(var Tn=Ut.length-1;Tn>=0;--Tn){var Un=Ut[Tn],bi=Un(er,Rr,an);if(!Gr(bi)&&!Nn(bi)){if(!zn(bi))throw new TypeError;an=bi}}return an}function A(Ut,er,Rr){var an=ct.get(Ut);if(Gr(an)){if(!Rr)return;an=new At,ct.set(Ut,an)}var Tn=an.get(er);if(Gr(Tn)){if(!Rr)return;Tn=new At,an.set(er,Tn)}return Tn}function Se(Ut,er,Rr){var an=ke(Ut,er,Rr);if(an)return!0;var Tn=Cs(er);return Nn(Tn)?!1:Se(Ut,Tn,Rr)}function ke(Ut,er,Rr){var an=A(er,Rr,!1);return Gr(an)?!1:fi(an.has(Ut))}function ut(Ut,er,Rr){var an=ke(Ut,er,Rr);if(an)return ft(Ut,er,Rr);var Tn=Cs(er);if(!Nn(Tn))return ut(Ut,Tn,Rr)}function ft(Ut,er,Rr){var an=A(er,Rr,!1);if(!Gr(an))return an.get(Ut)}function Rt(Ut,er,Rr,an){var Tn=A(Rr,an,!0);Tn.set(Ut,er)}function Dt(Ut,er){var Rr=gr(Ut,er),an=Cs(Ut);if(an===null)return Rr;var Tn=Dt(an,er);if(Tn.length<=0)return Rr;if(Rr.length<=0)return Tn;for(var Un=new Kt,bi=[],di=0,Sn=Rr;di<Sn.length;di++){var Li=Sn[di],Oi=Un.has(Li);Oi||(Un.add(Li),bi.push(Li))}for(var io=0,hs=Tn;io<hs.length;io++){var Li=hs[io],Oi=Un.has(Li);Oi||(Un.add(Li),bi.push(Li))}return bi}function gr(Ut,er){var Rr=[],an=A(Ut,er,!1);if(Gr(an))return Rr;for(var Tn=an.keys(),Un=ia(Tn),bi=0;;){var di=qi(Un);if(!di)return Rr.length=bi,Rr;var Sn=ki(di);try{Rr[bi]=Sn}catch(Li){try{Gi(Un)}finally{throw Li}}bi++}}function Yn(Ut){if(Ut===null)return 1;switch(typeof Ut){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Ut===null?1:6;default:return 6}}function Gr(Ut){return Ut===void 0}function Nn(Ut){return Ut===null}function yn(Ut){return typeof Ut=="symbol"}function zn(Ut){return typeof Ut=="object"?Ut!==null:typeof Ut=="function"}function si(Ut,er){switch(Yn(Ut)){case 0:return Ut;case 1:return Ut;case 2:return Ut;case 3:return Ut;case 4:return Ut;case 5:return Ut}var Rr=er===3?"string":er===5?"number":"default",an=na(Ut,de);if(an!==void 0){var Tn=an.call(Ut,Rr);if(zn(Tn))throw new TypeError;return Tn}return Gn(Ut,Rr==="default"?"number":Rr)}function Gn(Ut,er){if(er==="string"){var Rr=Ut.toString;if(Ki(Rr)){var an=Rr.call(Ut);if(!zn(an))return an}var Tn=Ut.valueOf;if(Ki(Tn)){var an=Tn.call(Ut);if(!zn(an))return an}}else{var Tn=Ut.valueOf;if(Ki(Tn)){var an=Tn.call(Ut);if(!zn(an))return an}var Un=Ut.toString;if(Ki(Un)){var an=Un.call(Ut);if(!zn(an))return an}}throw new TypeError}function fi(Ut){return!!Ut}function ta(Ut){return""+Ut}function zi(Ut){var er=si(Ut,3);return yn(er)?er:ta(er)}function Ii(Ut){return Array.isArray?Array.isArray(Ut):Ut instanceof Object?Ut instanceof Array:Object.prototype.toString.call(Ut)==="[object Array]"}function Ki(Ut){return typeof Ut=="function"}function ra(Ut){return typeof Ut=="function"}function Ya(Ut){switch(Yn(Ut)){case 3:return!0;case 4:return!0;default:return!1}}function na(Ut,er){var Rr=Ut[er];if(Rr!=null){if(!Ki(Rr))throw new TypeError;return Rr}}function ia(Ut){var er=na(Ut,ze);if(!Ki(er))throw new TypeError;var Rr=er.call(Ut);if(!zn(Rr))throw new TypeError;return Rr}function ki(Ut){return Ut.value}function qi(Ut){var er=Ut.next();return er.done?!1:er}function Gi(Ut){var er=Ut.return;er&&er.call(Ut)}function Cs(Ut){var er=Object.getPrototypeOf(Ut);if(typeof Ut!="function"||Ut===Bt||er!==Bt)return er;var Rr=Ut.prototype,an=Rr&&Object.getPrototypeOf(Rr);if(an==null||an===Object.prototype)return er;var Tn=an.constructor;return typeof Tn!="function"||Tn===Ut?er:Tn}function fe(){var Ut={},er=[],Rr=function(){function bi(di,Sn,Li){this._index=0,this._keys=di,this._values=Sn,this._selector=Li}return bi.prototype["@@iterator"]=function(){return this},bi.prototype[ze]=function(){return this},bi.prototype.next=function(){var di=this._index;if(di>=0&&di<this._keys.length){var Sn=this._selector(this._keys[di],this._values[di]);return di+1>=this._keys.length?(this._index=-1,this._keys=er,this._values=er):this._index++,{value:Sn,done:!1}}return{value:void 0,done:!0}},bi.prototype.throw=function(di){throw this._index>=0&&(this._index=-1,this._keys=er,this._values=er),di},bi.prototype.return=function(di){return this._index>=0&&(this._index=-1,this._keys=er,this._values=er),{value:di,done:!0}},bi}();return function(){function bi(){this._keys=[],this._values=[],this._cacheKey=Ut,this._cacheIndex=-2}return Object.defineProperty(bi.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),bi.prototype.has=function(di){return this._find(di,!1)>=0},bi.prototype.get=function(di){var Sn=this._find(di,!1);return Sn>=0?this._values[Sn]:void 0},bi.prototype.set=function(di,Sn){var Li=this._find(di,!0);return this._values[Li]=Sn,this},bi.prototype.delete=function(di){var Sn=this._find(di,!1);if(Sn>=0){for(var Li=this._keys.length,Oi=Sn+1;Oi<Li;Oi++)this._keys[Oi-1]=this._keys[Oi],this._values[Oi-1]=this._values[Oi];return this._keys.length--,this._values.length--,di===this._cacheKey&&(this._cacheKey=Ut,this._cacheIndex=-2),!0}return!1},bi.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Ut,this._cacheIndex=-2},bi.prototype.keys=function(){return new Rr(this._keys,this._values,an)},bi.prototype.values=function(){return new Rr(this._keys,this._values,Tn)},bi.prototype.entries=function(){return new Rr(this._keys,this._values,Un)},bi.prototype["@@iterator"]=function(){return this.entries()},bi.prototype[ze]=function(){return this.entries()},bi.prototype._find=function(di,Sn){return this._cacheKey!==di&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=di)),this._cacheIndex<0&&Sn&&(this._cacheIndex=this._keys.length,this._keys.push(di),this._values.push(void 0)),this._cacheIndex},bi}();function an(bi,di){return bi}function Tn(bi,di){return di}function Un(bi,di){return[bi,di]}}function ui(){return function(){function Ut(){this._map=new At}return Object.defineProperty(Ut.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Ut.prototype.has=function(er){return this._map.has(er)},Ut.prototype.add=function(er){return this._map.set(er,er),this},Ut.prototype.delete=function(er){return this._map.delete(er)},Ut.prototype.clear=function(){this._map.clear()},Ut.prototype.keys=function(){return this._map.keys()},Ut.prototype.values=function(){return this._map.values()},Ut.prototype.entries=function(){return this._map.entries()},Ut.prototype["@@iterator"]=function(){return this.keys()},Ut.prototype[ze]=function(){return this.keys()},Ut}()}function bo(){var Ut=16,er=Ct.create(),Rr=an();return function(){function Sn(){this._key=an()}return Sn.prototype.has=function(Li){var Oi=Tn(Li,!1);return Oi!==void 0?Ct.has(Oi,this._key):!1},Sn.prototype.get=function(Li){var Oi=Tn(Li,!1);return Oi!==void 0?Ct.get(Oi,this._key):void 0},Sn.prototype.set=function(Li,Oi){var io=Tn(Li,!0);return io[this._key]=Oi,this},Sn.prototype.delete=function(Li){var Oi=Tn(Li,!1);return Oi!==void 0?delete Oi[this._key]:!1},Sn.prototype.clear=function(){this._key=an()},Sn}();function an(){var Sn;do Sn="@@WeakMap@@"+di();while(Ct.has(er,Sn));return er[Sn]=!0,Sn}function Tn(Sn,Li){if(!W.call(Sn,Rr)){if(!Li)return;Object.defineProperty(Sn,Rr,{value:Ct.create()})}return Sn[Rr]}function Un(Sn,Li){for(var Oi=0;Oi<Li;++Oi)Sn[Oi]=Math.random()*255|0;return Sn}function bi(Sn){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(Sn)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(Sn)):Un(new Uint8Array(Sn),Sn):Un(new Array(Sn),Sn)}function di(){var Sn=bi(Ut);Sn[6]=Sn[6]&79|64,Sn[8]=Sn[8]&191|128;for(var Li="",Oi=0;Oi<Ut;++Oi){var io=Sn[Oi];(Oi===4||Oi===6||Oi===8)&&(Li+="-"),io<16&&(Li+="0"),Li+=io.toString(16).toLowerCase()}return Li}}function su(Ut){return Ut.__=void 0,delete Ut.__,Ut}})})(me||(me={}))},69848:function(Er){(function(re,Q){Er.exports=Q()})(this,function(){"use strict";function re(at,qe,xt,$e,Ht,vr){if(!(Ht-$e<=xt)){var Fr=$e+Ht>>1;Q(at,qe,Fr,$e,Ht,vr%2),re(at,qe,xt,$e,Fr-1,vr+1),re(at,qe,xt,Fr+1,Ht,vr+1)}}function Q(at,qe,xt,$e,Ht,vr){for(;Ht>$e;){if(Ht-$e>600){var Fr=Ht-$e+1,Yr=xt-$e+1,A=Math.log(Fr),Se=.5*Math.exp(2*A/3),ke=.5*Math.sqrt(A*Se*(Fr-Se)/Fr)*(Yr-Fr/2<0?-1:1),ut=Math.max($e,Math.floor(xt-Yr*Se/Fr+ke)),ft=Math.min(Ht,Math.floor(xt+(Fr-Yr)*Se/Fr+ke));Q(at,qe,xt,ut,ft,vr)}var Rt=qe[2*xt+vr],Dt=$e,gr=Ht;for(Ce(at,qe,$e,xt),qe[2*Ht+vr]>Rt&&Ce(at,qe,$e,Ht);Dt<gr;){for(Ce(at,qe,Dt,gr),Dt++,gr--;qe[2*Dt+vr]<Rt;)Dt++;for(;qe[2*gr+vr]>Rt;)gr--}qe[2*$e+vr]===Rt?Ce(at,qe,$e,gr):(gr++,Ce(at,qe,gr,Ht)),gr<=xt&&($e=gr+1),xt<=gr&&(Ht=gr-1)}}function Ce(at,qe,xt,$e){me(at,xt,$e),me(qe,2*xt,2*$e),me(qe,2*xt+1,2*$e+1)}function me(at,qe,xt){var $e=at[qe];at[qe]=at[xt],at[xt]=$e}function m(at,qe,xt,$e,Ht,vr,Fr){for(var Yr=[0,at.length-1,0],A=[],Se,ke;Yr.length;){var ut=Yr.pop(),ft=Yr.pop(),Rt=Yr.pop();if(ft-Rt<=Fr){for(var Dt=Rt;Dt<=ft;Dt++)Se=qe[2*Dt],ke=qe[2*Dt+1],Se>=xt&&Se<=Ht&&ke>=$e&&ke<=vr&&A.push(at[Dt]);continue}var gr=Math.floor((Rt+ft)/2);Se=qe[2*gr],ke=qe[2*gr+1],Se>=xt&&Se<=Ht&&ke>=$e&&ke<=vr&&A.push(at[gr]);var Yn=(ut+1)%2;(ut===0?xt<=Se:$e<=ke)&&(Yr.push(Rt),Yr.push(gr-1),Yr.push(Yn)),(ut===0?Ht>=Se:vr>=ke)&&(Yr.push(gr+1),Yr.push(ft),Yr.push(Yn))}return A}function Re(at,qe,xt,$e,Ht,vr){for(var Fr=[0,at.length-1,0],Yr=[],A=Ht*Ht;Fr.length;){var Se=Fr.pop(),ke=Fr.pop(),ut=Fr.pop();if(ke-ut<=vr){for(var ft=ut;ft<=ke;ft++)W(qe[2*ft],qe[2*ft+1],xt,$e)<=A&&Yr.push(at[ft]);continue}var Rt=Math.floor((ut+ke)/2),Dt=qe[2*Rt],gr=qe[2*Rt+1];W(Dt,gr,xt,$e)<=A&&Yr.push(at[Rt]);var Yn=(Se+1)%2;(Se===0?xt-Ht<=Dt:$e-Ht<=gr)&&(Fr.push(ut),Fr.push(Rt-1),Fr.push(Yn)),(Se===0?xt+Ht>=Dt:$e+Ht>=gr)&&(Fr.push(Rt+1),Fr.push(ke),Fr.push(Yn))}return Yr}function W(at,qe,xt,$e){var Ht=at-xt,vr=qe-$e;return Ht*Ht+vr*vr}var pe=function(at){return at[0]},de=function(at){return at[1]},ze=function(qe,xt,$e,Ht,vr){xt===void 0&&(xt=pe),$e===void 0&&($e=de),Ht===void 0&&(Ht=64),vr===void 0&&(vr=Float64Array),this.nodeSize=Ht,this.points=qe;for(var Fr=qe.length<65536?Uint16Array:Uint32Array,Yr=this.ids=new Fr(qe.length),A=this.coords=new vr(qe.length*2),Se=0;Se<qe.length;Se++)Yr[Se]=Se,A[2*Se]=xt(qe[Se]),A[2*Se+1]=$e(qe[Se]);re(Yr,A,Ht,0,Yr.length-1,0)};ze.prototype.range=function(qe,xt,$e,Ht){return m(this.ids,this.coords,qe,xt,$e,Ht,this.nodeSize)},ze.prototype.within=function(qe,xt,$e){return Re(this.ids,this.coords,qe,xt,$e,this.nodeSize)};var _e={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(at){return at}},et=Math.fround||function(at){return function(qe){return at[0]=+qe,at[0]}}(new Float32Array(1)),mt=function(qe){this.options=$t(Object.create(_e),qe),this.trees=new Array(this.options.maxZoom+1)};mt.prototype.load=function(qe){var xt=this.options,$e=xt.log,Ht=xt.minZoom,vr=xt.maxZoom,Fr=xt.nodeSize;$e&&console.time("total time");var Yr="prepare "+qe.length+" points";$e&&console.time(Yr),this.points=qe;for(var A=[],Se=0;Se<qe.length;Se++)!qe[Se].geometry||A.push(Bt(qe[Se],Se));this.trees[vr+1]=new ze(A,X,Xt,Fr,Float32Array),$e&&console.timeEnd(Yr);for(var ke=vr;ke>=Ht;ke--){var ut=+Date.now();A=this._cluster(A,ke),this.trees[ke]=new ze(A,X,Xt,Fr,Float32Array),$e&&console.log("z%d: %d clusters in %dms",ke,A.length,+Date.now()-ut)}return $e&&console.timeEnd("total time"),this},mt.prototype.getClusters=function(qe,xt){var $e=((qe[0]+180)%360+360)%360-180,Ht=Math.max(-90,Math.min(90,qe[1])),vr=qe[2]===180?180:((qe[2]+180)%360+360)%360-180,Fr=Math.max(-90,Math.min(90,qe[3]));if(qe[2]-qe[0]>=360)$e=-180,vr=180;else if($e>vr){var Yr=this.getClusters([$e,Ht,180,Fr],xt),A=this.getClusters([-180,Ht,vr,Fr],xt);return Yr.concat(A)}for(var Se=this.trees[this._limitZoom(xt)],ke=Se.range(Kt($e),yt(Fr),Kt(vr),yt(Ht)),ut=[],ft=0,Rt=ke;ft<Rt.length;ft+=1){var Dt=Rt[ft],gr=Se.points[Dt];ut.push(gr.numPoints?or(gr):this.points[gr.index])}return ut},mt.prototype.getChildren=function(qe){var xt=this._getOriginId(qe),$e=this._getOriginZoom(qe),Ht="No cluster with the specified id.",vr=this.trees[$e];if(!vr)throw new Error(Ht);var Fr=vr.points[xt];if(!Fr)throw new Error(Ht);for(var Yr=this.options.radius/(this.options.extent*Math.pow(2,$e-1)),A=vr.within(Fr.x,Fr.y,Yr),Se=[],ke=0,ut=A;ke<ut.length;ke+=1){var ft=ut[ke],Rt=vr.points[ft];Rt.parentId===qe&&Se.push(Rt.numPoints?or(Rt):this.points[Rt.index])}if(Se.length===0)throw new Error(Ht);return Se},mt.prototype.getLeaves=function(qe,xt,$e){xt=xt||10,$e=$e||0;var Ht=[];return this._appendLeaves(Ht,qe,xt,$e,0),Ht},mt.prototype.getTile=function(qe,xt,$e){var Ht=this.trees[this._limitZoom(qe)],vr=Math.pow(2,qe),Fr=this.options,Yr=Fr.extent,A=Fr.radius,Se=A/Yr,ke=($e-Se)/vr,ut=($e+1+Se)/vr,ft={features:[]};return this._addTileFeatures(Ht.range((xt-Se)/vr,ke,(xt+1+Se)/vr,ut),Ht.points,xt,$e,vr,ft),xt===0&&this._addTileFeatures(Ht.range(1-Se/vr,ke,1,ut),Ht.points,vr,$e,vr,ft),xt===vr-1&&this._addTileFeatures(Ht.range(0,ke,Se/vr,ut),Ht.points,-1,$e,vr,ft),ft.features.length?ft:null},mt.prototype.getClusterExpansionZoom=function(qe){for(var xt=this._getOriginZoom(qe)-1;xt<=this.options.maxZoom;){var $e=this.getChildren(qe);if(xt++,$e.length!==1)break;qe=$e[0].properties.cluster_id}return xt},mt.prototype._appendLeaves=function(qe,xt,$e,Ht,vr){for(var Fr=this.getChildren(xt),Yr=0,A=Fr;Yr<A.length;Yr+=1){var Se=A[Yr],ke=Se.properties;if(ke&&ke.cluster?vr+ke.point_count<=Ht?vr+=ke.point_count:vr=this._appendLeaves(qe,ke.cluster_id,$e,Ht,vr):vr<Ht?vr++:qe.push(Se),qe.length===$e)break}return vr},mt.prototype._addTileFeatures=function(qe,xt,$e,Ht,vr,Fr){for(var Yr=0,A=qe;Yr<A.length;Yr+=1){var Se=A[Yr],ke=xt[Se],ut=ke.numPoints,ft=void 0,Rt=void 0,Dt=void 0;if(ut)ft=At(ke),Rt=ke.x,Dt=ke.y;else{var gr=this.points[ke.index];ft=gr.properties,Rt=Kt(gr.geometry.coordinates[0]),Dt=yt(gr.geometry.coordinates[1])}var Yn={type:1,geometry:[[Math.round(this.options.extent*(Rt*vr-$e)),Math.round(this.options.extent*(Dt*vr-Ht))]],tags:ft},Gr=void 0;ut?Gr=ke.id:this.options.generateId?Gr=ke.index:this.points[ke.index].id&&(Gr=this.points[ke.index].id),Gr!==void 0&&(Yn.id=Gr),Fr.features.push(Yn)}},mt.prototype._limitZoom=function(qe){return Math.max(this.options.minZoom,Math.min(Math.floor(+qe),this.options.maxZoom+1))},mt.prototype._cluster=function(qe,xt){for(var $e=[],Ht=this.options,vr=Ht.radius,Fr=Ht.extent,Yr=Ht.reduce,A=Ht.minPoints,Se=vr/(Fr*Math.pow(2,xt)),ke=0;ke<qe.length;ke++){var ut=qe[ke];if(!(ut.zoom<=xt)){ut.zoom=xt;for(var ft=this.trees[xt+1],Rt=ft.within(ut.x,ut.y,Se),Dt=ut.numPoints||1,gr=Dt,Yn=0,Gr=Rt;Yn<Gr.length;Yn+=1){var Nn=Gr[Yn],yn=ft.points[Nn];yn.zoom>xt&&(gr+=yn.numPoints||1)}if(gr>Dt&&gr>=A){for(var zn=ut.x*Dt,si=ut.y*Dt,Gn=Yr&&Dt>1?this._map(ut,!0):null,fi=(ke<<5)+(xt+1)+this.points.length,ta=0,zi=Rt;ta<zi.length;ta+=1){var Ii=zi[ta],Ki=ft.points[Ii];if(!(Ki.zoom<=xt)){Ki.zoom=xt;var ra=Ki.numPoints||1;zn+=Ki.x*ra,si+=Ki.y*ra,Ki.parentId=fi,Yr&&(Gn||(Gn=this._map(ut,!0)),Yr(Gn,this._map(Ki)))}}ut.parentId=fi,$e.push(Ct(zn/gr,si/gr,fi,gr,Gn))}else if($e.push(ut),gr>1)for(var Ya=0,na=Rt;Ya<na.length;Ya+=1){var ia=na[Ya],ki=ft.points[ia];ki.zoom<=xt||(ki.zoom=xt,$e.push(ki))}}}return $e},mt.prototype._getOriginId=function(qe){return qe-this.points.length>>5},mt.prototype._getOriginZoom=function(qe){return(qe-this.points.length)%32},mt.prototype._map=function(qe,xt){if(qe.numPoints)return xt?$t({},qe.properties):qe.properties;var $e=this.points[qe.index].properties,Ht=this.options.map($e);return xt&&Ht===$e?$t({},Ht):Ht};function Ct(at,qe,xt,$e,Ht){return{x:et(at),y:et(qe),zoom:Infinity,id:xt,parentId:-1,numPoints:$e,properties:Ht}}function Bt(at,qe){var xt=at.geometry.coordinates,$e=xt[0],Ht=xt[1];return{x:et(Kt($e)),y:et(yt(Ht)),zoom:Infinity,index:qe,parentId:-1}}function or(at){return{type:"Feature",id:at.id,properties:At(at),geometry:{type:"Point",coordinates:[ct(at.x),it(at.y)]}}}function At(at){var qe=at.numPoints,xt=qe>=1e4?Math.round(qe/1e3)+"k":qe>=1e3?Math.round(qe/100)/10+"k":qe;return $t($t({},at.properties),{cluster:!0,cluster_id:at.id,point_count:qe,point_count_abbreviated:xt})}function Kt(at){return at/360+.5}function yt(at){var qe=Math.sin(at*Math.PI/180),xt=.5-.25*Math.log((1+qe)/(1-qe))/Math.PI;return xt<0?0:xt>1?1:xt}function ct(at){return(at-.5)*360}function it(at){var qe=(180-at*360)*Math.PI/180;return 360*Math.atan(Math.exp(qe))/Math.PI-90}function $t(at,qe){for(var xt in qe)at[xt]=qe[xt];return at}function X(at){return at.x}function Xt(at){return at.y}return mt})},75752:function(Er){Er.exports.RADIUS=6378137,Er.exports.FLATTENING=1/298.257223563,Er.exports.POLAR_RADIUS=63567523142e-4}}]);
