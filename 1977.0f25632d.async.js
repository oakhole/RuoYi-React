(self.webpackChunkruoyi_react=self.webpackChunkruoyi_react||[]).push([[1977],{4157:function(){window._iconfont_svg_string_3580659='<svg><symbol id="l7-icon-area1" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.064889 219.136l38.798223 466.261333a113.777778 113.777778 0 1 1-133.518223 145.237334H279.210667a113.777778 113.777778 0 1 1-60.302223-137.272889L697.856 227.555556A113.777778 113.777778 0 0 1 796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m577.592889-534.072889L269.198222 796.444444c4.152889 7.168 7.509333 14.791111 10.012445 22.812445h465.578666a114.119111 114.119111 0 0 1 65.479111-71.224889l-38.798222-466.261333a112.924444 112.924444 0 0 1-23.210666-7.964445zM796.444444 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-area" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.008 219.136l38.855112 466.261333a113.777778 113.777778 0 0 1-16.497778 224.540445L853.333333 967.111111a113.777778 113.777778 0 0 1-108.544-79.644444H279.210667a113.834667 113.834667 0 0 1-100.067556 79.36L170.666667 967.111111a113.777778 113.777778 0 0 1-17.066667-226.304l30.492444-351.175111a113.777778 113.777778 0 0 1 34.986667-218.680889L227.555556 170.666667a113.777778 113.777778 0 0 1 99.896888 59.221333l355.84-71.395556a113.777778 113.777778 0 0 1 104.675556-101.262222L796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m526.051555-582.314666L340.650667 296.903111a113.891556 113.891556 0 0 1-88.462223 98.645333l-30.947555 355.84c27.477333 13.653333 48.64 38.115556 58.026667 67.754667h465.521777a114.119111 114.119111 0 0 1 65.536-71.168l-38.855111-466.261333a113.948444 113.948444 0 0 1-74.752-56.206222zM227.555556 238.933333a45.511111 45.511111 0 1 0 0 91.022223 45.511111 45.511111 0 0 0 0-91.022223z m568.888888-113.777777a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-delete" viewBox="0 0 1024 1024"><path d="M705.422222 85.333333a34.133333 34.133333 0 0 1 34.133334 34.133334V227.555556h136.533333a34.133333 34.133333 0 0 1 0 68.266666h-25.543111l-24.348445 610.076445a34.133333 34.133333 0 0 1-34.133333 32.768H231.936a34.133333 34.133333 0 0 1-34.076444-32.768L173.340444 295.822222H147.911111a34.133333 34.133333 0 1 1 0-68.266666H284.444444V119.466667a34.133333 34.133333 0 0 1 34.133334-34.133334h386.844444zM241.720889 295.822222l22.983111 574.577778h494.535111l23.04-574.577778H241.720889zM671.288889 153.6H352.711111V227.555556h318.577778V153.6z"  ></path></symbol><symbol id="l7-icon-color" viewBox="0 0 1024 1024"><path d="M512 56.888889c9.841778 0 19.626667 0.341333 29.354667 0.910222 69.176889 4.437333 119.068444 62.577778 124.302222 131.072l0.455111 9.386667c0.739556 44.600889 15.303111 84.935111 44.999111 114.631111 27.022222 27.022222 62.805333 41.528889 102.570667 44.430222l12.060444 0.568889c72.476444 1.194667 135.793778 52.451556 140.458667 124.757333 1.137778 18.261333 1.251556 36.807111 0.170667 55.637334-13.198222 233.585778-211.399111 424.220444-445.326223 428.714666L512 967.111111a455.111111 455.111111 0 0 1-455.054222-464.156444c4.551111-233.927111 195.185778-432.128 428.771555-445.326223C494.535111 57.116444 503.296 56.888889 512 56.888889z m0 68.266667a385.706667 385.706667 0 0 0-22.414222 0.625777C291.726222 136.988444 129.080889 305.948444 125.155556 504.263111c-4.152889 212.366222 163.100444 387.185778 372.508444 394.353778l13.425778 0.227555 8.533333-0.113777c198.371556-3.811556 367.331556-166.456889 378.538667-364.373334a396.174222 396.174222 0 0 0-0.170667-47.331555c-1.991111-31.232-29.127111-56.604444-67.128889-60.472889l-8.248889-0.455111-14.051555-0.682667c-56.547556-4.209778-107.406222-25.884444-145.806222-64.284444-38.855111-38.798222-60.416-90.225778-64.284445-145.749334l-0.910222-21.333333c-2.901333-38.001778-28.785778-66.048-60.302222-68.096A433.891556 433.891556 0 0 0 512 125.155556zM438.044444 682.666667a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m-170.666666-227.555556a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m142.222222-227.555555a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z"  ></path></symbol><symbol id="l7-icon-base-map" viewBox="0 0 1024 1024"><path d="M923.761778 115.029333A34.133333 34.133333 0 0 1 967.111111 147.911111v624.128a34.133333 34.133333 0 0 1-22.186667 32.028445l-278.755555 103.992888a34.133333 34.133333 0 0 1-23.665778 0.056889L381.724444 812.714667a34.133333 34.133333 0 0 0-23.665777 0.113777L102.968889 908.060444a34.133333 34.133333 0 0 1-45.738667-26.965333L56.888889 876.088889V251.960889a34.133333 34.133333 0 0 1 22.186667-32.028445l278.755555-103.992888a34.133333 34.133333 0 0 1 20.992-0.967112l266.183111 72.988445a34.133333 34.133333 0 0 0 18.204445 0zM403.911111 192.625778v555.576889l216.177778 79.075555V251.960889l-216.177778-59.335111z m-68.266667 4.380444L125.155556 275.569778v551.310222l210.432-78.506667V197.006222zM898.844444 192.853333l-210.545777 58.936889v575.089778l210.545777-78.563556V192.853333z"  ></path></symbol><symbol id="l7-icon-dot" viewBox="0 0 1024 1024"><path d="M341.333333 739.555556a113.777778 113.777778 0 0 1 8.533334 227.271111L341.333333 967.111111a113.777778 113.777778 0 0 1-8.533333-227.271111L341.333333 739.555556z m0 68.266666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM910.222222 341.333333a113.777778 113.777778 0 0 1 8.533334 227.271111L910.222222 568.888889a113.777778 113.777778 0 0 1-8.533333-227.271111L910.222222 341.333333z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM227.555556 56.888889a113.777778 113.777778 0 0 1 8.533333 227.271111L227.555556 284.444444a113.777778 113.777778 0 0 1-8.533334-227.271111L227.555556 56.888889z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-display" viewBox="0 0 1024 1024"><path d="M512 170.666667c284.444444 0 455.111111 227.555556 455.111111 341.333333s-170.666667 341.333333-455.111111 341.333333-455.111111-227.555556-455.111111-341.333333 170.666667-341.333333 455.111111-341.333333z m0 68.266666C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 110.762667 178.574222 273.066667 386.844444 273.066667s386.844444-162.304 386.844444-273.066667c0-110.762667-178.574222-273.066667-386.844444-273.066667zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-enlarge" viewBox="0 0 1024 1024"><path d="M546.133333 147.911111l-0.056889 329.955556H876.088889a34.133333 34.133333 0 0 1 0 68.266666H546.076444v329.955556a34.133333 34.133333 0 0 1-68.266666 0V546.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h329.898667V147.911111a34.133333 34.133333 0 0 1 68.266666 0z"  ></path></symbol><symbol id="l7-icon-export-picture" viewBox="0 0 1024 1024"><path d="M883.873684 161.684211a32.336842 32.336842 0 0 1 32.336842 32.336842v582.063158a32.336842 32.336842 0 0 1-32.336842 32.336842H86.231579a32.336842 32.336842 0 0 1-32.336842-32.336842V194.021053a32.336842 32.336842 0 0 1 32.336842-32.336842h797.642105z m-32.336842 64.673684H118.568421v517.389473h170.792421a32.175158 32.175158 0 0 1 0.431158-0.646736l3.772632-4.473264 330.320842-330.374736a32.336842 32.336842 0 0 1 38.588631-5.389474l4.473263 3.018105 184.589474 147.725474V226.357895z m-202.428631 248.131368L379.850105 743.747368H851.536842v-107.304421l-202.428631-161.953684zM323.368421 323.368421a107.789474 107.789474 0 1 1 0 215.578947 107.789474 107.789474 0 0 1 0-215.578947z m0 64.673684a43.115789 43.115789 0 1 0 0 86.231579 43.115789 43.115789 0 0 0 0-86.231579z"  ></path></symbol><symbol id="l7-icon-exit-fullscreen" viewBox="0 0 1024 1024"><path d="M841.955556 591.644444a34.133333 34.133333 0 0 1 5.518222 67.811556l-5.518222 0.455111h-133.745778l192 192.056889a34.133333 34.133333 0 0 1-38.343111 55.182222l-5.176889-2.958222-4.721778-3.982222L659.911111 708.266667V841.955556a34.133333 34.133333 0 0 1-28.615111 33.678222L625.777778 876.088889a34.133333 34.133333 0 0 1-33.678222-28.615111L591.644444 841.955556V625.777778a34.133333 34.133333 0 0 1 28.615112-33.678222L625.777778 591.644444h216.177778z m-443.733334 0a34.133333 34.133333 0 0 1 33.678222 28.615112L432.355556 625.777778v216.177778a34.133333 34.133333 0 0 1-67.811556 5.518222L364.088889 841.955556v-133.745778l-192.056889 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L315.847111 659.911111H182.044444a34.133333 34.133333 0 0 1-33.678222-28.615111L147.911111 625.777778a34.133333 34.133333 0 0 1 28.615111-33.678222L182.044444 591.644444H398.222222zM167.310222 119.808l4.721778 3.982222L364.088889 315.847111V182.044444a34.133333 34.133333 0 0 1 28.615111-33.678222L398.222222 147.911111a34.133333 34.133333 0 0 1 33.678222 28.615111L432.355556 182.044444V398.222222a34.133333 34.133333 0 0 1-28.615112 33.678222L398.222222 432.355556H182.044444a34.133333 34.133333 0 0 1-5.518222-67.811556L182.044444 364.088889h133.802667L123.790222 172.032a34.133333 34.133333 0 0 1 43.52-52.224z m732.899556 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L708.266667 364.088889H841.955556a34.133333 34.133333 0 0 1 33.678222 28.615111L876.088889 398.222222a34.133333 34.133333 0 0 1-28.615111 33.678222L841.955556 432.355556H625.777778a34.133333 34.133333 0 0 1-33.678222-28.615112L591.644444 398.222222V182.044444a34.133333 34.133333 0 0 1 67.811556-5.518222l0.455111 5.518222v133.802667l192.056889-192.056889a34.133333 34.133333 0 0 1 48.241778 0z"  ></path></symbol><symbol id="l7-icon-line" viewBox="0 0 1024 1024"><path d="M853.333333 56.888889a113.777778 113.777778 0 0 1 8.533334 227.271111L853.333333 284.444444c-19.000889 0-36.864-4.664889-52.622222-12.856888l-529.123555 529.066666a113.777778 113.777778 0 0 1-92.387556 166.115556L170.666667 967.111111a113.777778 113.777778 0 0 1-8.533334-227.271111L170.666667 739.555556c19.000889 0 36.864 4.664889 52.622222 12.856888l529.123555-529.066666a113.777778 113.777778 0 0 1 92.387556-166.115556L853.333333 56.888889zM170.666667 807.822222a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m682.666666-682.666666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-layer" viewBox="0 0 1024 1024"><path d="M767.089778 625.777778l180.167111 82.773333a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730667-420.977778 193.422222a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422222a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730667L256.853333 625.777778l81.749334 37.546666L172.771556 739.555556 512 895.374222 851.171556 739.555556l-165.831112-76.231112 81.749334-37.546666z m0-227.555556l180.167111 82.773334a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730666-420.977778 193.422223a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422223a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730666L256.853333 398.222222l81.749334 37.546667-165.831111 76.174222L512 667.818667l339.171556-155.875556-165.831112-76.174222L767.089778 398.222222zM497.720889 60.017778a34.133333 34.133333 0 0 1 28.558222 0l420.977778 193.422222a34.133333 34.133333 0 0 1 0 62.008889l-420.977778 193.422222a34.133333 34.133333 0 0 1-28.558222 0l-420.977778-193.422222a34.133333 34.133333 0 0 1 0-62.008889zM512 128.568889L172.771556 284.387556 512 440.263111l339.171556-155.875555L512 128.568889z"  ></path></symbol><symbol id="l7-icon-narrow" viewBox="0 0 1024 1024"><path d="M910.222222 512a34.133333 34.133333 0 0 1-34.133333 34.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h728.177778a34.133333 34.133333 0 0 1 34.133333 34.133333z"  ></path></symbol><symbol id="l7-icon-fullscreen" viewBox="0 0 1024 1024"><path d="M645.176889 597.674667l4.721778 3.982222L841.955556 793.6l0.056888-133.688889a34.133333 34.133333 0 0 1 28.615112-33.678222L876.088889 625.777778a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 659.911111v216.177778a34.133333 34.133333 0 0 1-28.615111 33.678222L876.088889 910.222222h-216.177778a34.133333 34.133333 0 0 1-5.518222-67.811555l5.518222-0.455111h133.745778l-192-192.056889a34.133333 34.133333 0 0 1 43.52-52.224z m-222.833778 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L230.286222 841.955556H364.088889a34.133333 34.133333 0 0 1 33.678222 28.615111L398.222222 876.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L364.088889 910.222222H147.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 876.088889v-216.177778a34.133333 34.133333 0 0 1 67.811555-5.518222l0.455111 5.518222-0.056888 133.745778 192.113777-192a34.133333 34.133333 0 0 1 48.241778 0zM364.088889 113.777778a34.133333 34.133333 0 0 1 5.518222 67.811555L364.088889 182.044444H230.343111l192 192.056889a34.133333 34.133333 0 0 1-43.52 52.224l-4.721778-3.982222-192.113777-192.056889L182.044444 364.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L147.911111 398.222222a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 364.088889V147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L147.911111 113.777778h216.177778z m512 0a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 147.911111v216.177778a34.133333 34.133333 0 0 1-67.811555 5.518222L841.955556 364.088889l-0.056889-133.745778-192 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L793.6 182.044444H659.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L625.777778 147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L659.911111 113.777778h216.177778z"  ></path></symbol><symbol id="l7-icon-hide" viewBox="0 0 1024 1024"><path d="M875.52 87.836444a34.133333 34.133333 0 0 1 7.281778 43.121778l-3.527111 5.006222-682.666667 796.444445a34.133333 34.133333 0 0 1-55.409778-39.367111l3.527111-5.006222 97.166223-113.379556C123.164444 697.969778 56.888889 582.940444 56.888889 512c0-113.777778 170.666667-341.333333 455.111111-341.333333a496.64 496.64 0 0 1 208.952889 45.112889l106.439111-124.188445a34.133333 34.133333 0 0 1 48.128-3.754667z m-38.684444 202.524445C921.031111 362.951111 967.111111 452.835556 967.111111 512c0 113.777778-170.666667 341.333333-455.111111 341.333333-50.631111 0-97.678222-7.224889-140.8-19.740444l50.232889-58.595556A417.393778 417.393778 0 0 0 512 785.066667c208.270222 0 386.844444-162.304 386.844444-273.066667 0-52.849778-40.675556-117.418667-105.813333-170.496l43.804445-51.2zM512 238.933333C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 66.787556 64.853333 152.291556 162.133333 209.692444L377.173333 616.675556a170.666667 170.666667 0 0 1 217.713778-253.895112l78.620445-91.704888A432.924444 432.924444 0 0 0 512 238.933333z m166.684444 236.088889a170.666667 170.666667 0 0 1-177.664 207.303111l177.607112-207.303111zM512 409.6a102.4 102.4 0 0 0-88.746667 153.486222L548.864 416.426667A102.172444 102.172444 0 0 0 512 409.6z"  ></path></symbol><symbol id="l7-icon-rectangle" viewBox="0 0 1024 1024"><path d="M170.666667 56.888889a113.777778 113.777778 0 0 1 108.544 79.644444H853.333333a34.133333 34.133333 0 0 1 33.678223 28.615111L887.466667 170.666667v574.122666a113.777778 113.777778 0 1 1-142.677334 142.734223L170.666667 887.466667a34.133333 34.133333 0 0 1-33.678223-28.615111L136.533333 853.333333V279.210667A113.777778 113.777778 0 0 1 170.666667 56.888889z m682.666666 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-34.133333-603.022222H279.210667a114.062222 114.062222 0 0 1-74.353778 74.410667L204.8 819.2h539.989333a114.062222 114.062222 0 0 1 74.410667-74.410667V204.8zM170.666667 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-ranging" viewBox="0 0 1024 1024"><path d="M723.171556 50.403556l250.424888 250.424888a31.061333 31.061333 0 0 1 0 43.918223L344.746667 973.596444a31.061333 31.061333 0 0 1-43.918223 0L50.403556 723.171556a31.061333 31.061333 0 0 1 0-43.918223L679.253333 50.403556a31.061333 31.061333 0 0 1 43.918223 0z m-21.959112 74.524444l-39.765333 39.822222 98.986667 98.872889a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222 62.179556 62.122667a34.133333 34.133333 0 0 1-44.088889 51.882667L563.2 387.242667 501.077333 325.063111 437.191111 388.949333l98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222L387.242667 563.2a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.584-62.122667-62.179556-63.886222 63.886222 98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-39.765333 39.822222 197.802667 197.745778 576.284444-576.284444-197.802667-197.745778z"  ></path></symbol><symbol id="l7-icon-reposition" viewBox="0 0 1024 1024"><path d="M512 56.888889a34.133333 34.133333 0 0 1 34.133333 34.133333v24.177778A398.336 398.336 0 0 1 908.856889 477.866667h24.177778a34.133333 34.133333 0 0 1 0 68.266666h-24.177778A398.336 398.336 0 0 1 546.133333 908.856889L546.133333 932.977778a34.133333 34.133333 0 0 1-68.266666 0v-24.177778A398.336 398.336 0 0 1 115.2 546.133333L91.022222 546.133333a34.133333 34.133333 0 1 1 0-68.266666h24.177778A398.336 398.336 0 0 1 477.866667 115.2V91.022222A34.133333 34.133333 0 0 1 512 56.888889z m34.190222 126.862222L546.133333 193.422222a34.133333 34.133333 0 1 1-68.266666 0v-9.671111A330.069333 330.069333 0 0 0 183.751111 477.866667h9.671111a34.133333 34.133333 0 1 1 0 68.266666l-9.671111 0.056889A330.069333 330.069333 0 0 0 477.866667 840.248889V830.577778a34.133333 34.133333 0 0 1 68.266666 0l0.056889 9.671111A330.069333 330.069333 0 0 0 840.248889 546.133333L830.577778 546.133333a34.133333 34.133333 0 0 1 0-68.266666h9.671111A330.069333 330.069333 0 0 0 546.133333 183.751111zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-round" viewBox="0 0 1024 1024"><path d="M512 56.888889a455.111111 455.111111 0 0 1 391.395556 687.502222 113.777778 113.777778 0 0 1-159.061334 158.890667A455.111111 455.111111 0 0 1 120.604444 279.608889 113.777778 113.777778 0 0 1 279.608889 120.604444 452.835556 452.835556 0 0 1 512 56.888889z m0 68.266667a384.910222 384.910222 0 0 0-191.715556 50.744888A113.777778 113.777778 0 0 1 175.957333 320.284444a386.844444 386.844444 0 0 0 527.815111 527.758223 113.777778 113.777778 0 0 1 144.270223-144.440889A386.844444 386.844444 0 0 0 512 125.155556z m299.406222 640.739555a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM212.593778 167.082667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-guanbi" viewBox="0 0 1024 1024"><path d="M576 512l277.333333 277.333333-64 64-277.333333-277.333333L234.666667 853.333333 170.666667 789.333333l277.333333-277.333333L170.666667 234.666667 234.666667 170.666667l277.333333 277.333333L789.333333 170.666667 853.333333 234.666667 576 512z"  ></path></symbol></svg>',function(Br){try{let _e=function(){W||(W=!0,y())},Qe=function(){try{Te.documentElement.doScroll("left")}catch(lt){return void setTimeout(Qe,50)}_e()};var se=_e,Ye=Qe,pe=(pe=document.getElementsByTagName("script"))[pe.length-1],K=pe.getAttribute("data-injectcss"),pe=pe.getAttribute("data-disable-injectsvg");if(!pe){var Ee,ne,y,Te,W,ye=function(bt,gt){gt.parentNode.insertBefore(bt,gt)};if(K&&!Br.__iconfont__svg__cssinject__){Br.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(lt){console&&console.log(lt)}}Ee=function(){var bt,gt=document.createElement("div");gt.innerHTML=Br._iconfont_svg_string_3580659,(gt=gt.getElementsByTagName("svg")[0])&&(gt.setAttribute("aria-hidden","true"),gt.style.position="absolute",gt.style.width=0,gt.style.height=0,gt.style.overflow="hidden",gt=gt,(bt=document.body).firstChild?ye(gt,bt.firstChild):bt.appendChild(gt))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(Ee,0):(ne=function(){document.removeEventListener("DOMContentLoaded",ne,!1),Ee()},document.addEventListener("DOMContentLoaded",ne,!1)):document.attachEvent&&(y=Ee,Te=Br.document,W=!1,Qe(),Te.onreadystatechange=function(){Te.readyState=="complete"&&(Te.onreadystatechange=null,_e())})}}catch(_e){}}(window)},47321:function(Br,pe,K){"use strict";K.d(pe,{zP:function(){return xP},JE:function(){return C7},ns:function(){return _P}});var Ee={};K.r(Ee),K.d(Ee,{add:function(){return dh},adjoint:function(){return Xn},clone:function(){return dn},copy:function(){return Kn},create:function(){return Hr},determinant:function(){return Wi},equals:function(){return Rf},exactEquals:function(){return od},frob:function(){return Vh},fromQuat:function(){return uu},fromQuat2:function(){return Vo},fromRotation:function(){return cs},fromRotationTranslation:function(){return zs},fromRotationTranslationScale:function(){return Fa},fromRotationTranslationScaleOrigin:function(){return ma},fromScaling:function(){return Lo},fromTranslation:function(){return so},fromValues:function(){return kn},fromXRotation:function(){return fs},fromYRotation:function(){return $s},fromZRotation:function(){return Es},frustum:function(){return Zs},getRotation:function(){return Ha},getScaling:function(){return Ki},getTranslation:function(){return Ss},identity:function(){return In},invert:function(){return di},lookAt:function(){return Go},mul:function(){return bp},multiply:function(){return xi},multiplyScalar:function(){return af},multiplyScalarAndAdd:function(){return jh},ortho:function(){return Hu},orthoNO:function(){return Ql},orthoZO:function(){return wc},perspective:function(){return jo},perspectiveFromFieldOfView:function(){return Ea},perspectiveNO:function(){return eo},perspectiveZO:function(){return Us},rotate:function(){return ba},rotateX:function(){return $a},rotateY:function(){return xo},rotateZ:function(){return vo},scale:function(){return Qn},set:function(){return ai},str:function(){return Al},sub:function(){return sd},subtract:function(){return vh},targetTo:function(){return Cc},translate:function(){return qi},transpose:function(){return zi}});var ne=K(67294),y=(0,ne.createContext)({});function Te(){return(0,ne.useContext)(y)}var W={},ye={},se=function(i){return ye[i]},Ye=function(i,r){ye[i]=r},_e=function(i){return W[i]},Qe=function(i,r){W[i]=r},lt={},bt={},gt=34,ur=10,Mt=13;function qt(e){return new Function("d","return {"+e.map(function(i,r){return JSON.stringify(i)+": d["+r+'] || ""'}).join(",")+"}")}function zt(e,i){var r=qt(e);return function(n,t){return i(r(n),t,e)}}function yt(e){var i=Object.create(null),r=[];return e.forEach(function(n){for(var t in n)t in i||r.push(i[t]=t)}),r}function At(e,i){var r=e+"",n=r.length;return n<i?new Array(i-n+1).join(0)+r:r}function ar(e){return e<0?"-"+At(-e,6):e>9999?"+"+At(e,6):At(e,4)}function J(e){var i=e.getUTCHours(),r=e.getUTCMinutes(),n=e.getUTCSeconds(),t=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":ar(e.getUTCFullYear(),4)+"-"+At(e.getUTCMonth()+1,2)+"-"+At(e.getUTCDate(),2)+(t?"T"+At(i,2)+":"+At(r,2)+":"+At(n,2)+"."+At(t,3)+"Z":n?"T"+At(i,2)+":"+At(r,2)+":"+At(n,2)+"Z":r||i?"T"+At(i,2)+":"+At(r,2)+"Z":"")}function Qt(e){var i=new RegExp('["'+e+`
\r]`),r=e.charCodeAt(0);function n(E,C){var T,O,L=t(E,function(B,H){if(T)return T(B,H-1);O=B,T=C?zt(B,C):qt(B)});return L.columns=O||[],L}function t(E,C){var T=[],O=E.length,L=0,B=0,H,oe=O<=0,le=!1;E.charCodeAt(O-1)===ur&&--O,E.charCodeAt(O-1)===Mt&&--O;function Re(){if(oe)return bt;if(le)return le=!1,lt;var ut,Ot=L,Nt;if(E.charCodeAt(Ot)===gt){for(;L++<O&&E.charCodeAt(L)!==gt||E.charCodeAt(++L)===gt;);return(ut=L)>=O?oe=!0:(Nt=E.charCodeAt(L++))===ur?le=!0:Nt===Mt&&(le=!0,E.charCodeAt(L)===ur&&++L),E.slice(Ot+1,ut-1).replace(/""/g,'"')}for(;L<O;){if((Nt=E.charCodeAt(ut=L++))===ur)le=!0;else if(Nt===Mt)le=!0,E.charCodeAt(L)===ur&&++L;else if(Nt!==r)continue;return E.slice(Ot,ut)}return oe=!0,E.slice(Ot,O)}for(;(H=Re())!==bt;){for(var Ne=[];H!==lt&&H!==bt;)Ne.push(H),H=Re();C&&(Ne=C(Ne,B++))==null||T.push(Ne)}return T}function o(E,C){return E.map(function(T){return C.map(function(O){return x(T[O])}).join(e)})}function u(E,C){return C==null&&(C=yt(E)),[C.map(x).join(e)].concat(o(E,C)).join(`
`)}function l(E,C){return C==null&&(C=yt(E)),o(E,C).join(`
`)}function p(E){return E.map(v).join(`
`)}function v(E){return E.map(x).join(e)}function x(E){return E==null?"":E instanceof Date?J(E):i.test(E+="")?'"'+E.replace(/"/g,'""')+'"':E}return{parse:n,parseRows:t,format:u,formatBody:l,formatRows:p,formatRow:v,formatValue:x}}var Ct=Qt(","),ft=Ct.parse,Ut=Ct.parseRows,dt=Ct.format,rr=Ct.formatBody,wr=Ct.formatRows,re=Ct.formatRow,Fe=Ct.formatValue,N=K(85061),z=K(28991),ce=K(38163),ze=K.n(ce),et=63710088e-1,ht={centimeters:et*100,centimetres:et*100,degrees:et/111325,feet:et*3.28084,inches:et*39.37,kilometers:et/1e3,kilometres:et/1e3,meters:et,metres:et,miles:et/1609.344,millimeters:et*1e3,millimetres:et*1e3,nauticalmiles:et/1852,radians:1,yards:et*1.0936},Rt={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/et,yards:1.0936133},Jt={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Or(e,i,r){r===void 0&&(r={});var n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=i||{},n.geometry=e,n}function Tr(e,i,r){switch(r===void 0&&(r={}),e){case"Point":return Pn(i).geometry;case"LineString":return mi(i).geometry;case"Polygon":return wn(i).geometry;case"MultiPoint":return li(i).geometry;case"MultiLineString":return bi(i).geometry;case"MultiPolygon":return Zn(i).geometry;default:throw new Error(e+" is invalid")}}function Pn(e,i,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Xt(e[0])||!Xt(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return Or(n,i,r)}function Nr(e,i,r){return r===void 0&&(r={}),ki(e.map(function(n){return Pn(n,i)}),r)}function wn(e,i,r){r===void 0&&(r={});for(var n=0,t=e;n<t.length;n++){var o=t[n];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var u=0;u<o[o.length-1].length;u++)if(o[o.length-1][u]!==o[0][u])throw new Error("First and last Position are not equivalent.")}var l={type:"Polygon",coordinates:e};return Or(l,i,r)}function Xi(e,i,r){return r===void 0&&(r={}),ki(e.map(function(n){return wn(n,i)}),r)}function mi(e,i,r){if(r===void 0&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return Or(n,i,r)}function si(e,i,r){return r===void 0&&(r={}),ki(e.map(function(n){return mi(n,i)}),r)}function ki(e,i){i===void 0&&(i={});var r={type:"FeatureCollection"};return i.id&&(r.id=i.id),i.bbox&&(r.bbox=i.bbox),r.features=e,r}function bi(e,i,r){r===void 0&&(r={});var n={type:"MultiLineString",coordinates:e};return Or(n,i,r)}function li(e,i,r){r===void 0&&(r={});var n={type:"MultiPoint",coordinates:e};return Or(n,i,r)}function Zn(e,i,r){r===void 0&&(r={});var n={type:"MultiPolygon",coordinates:e};return Or(n,i,r)}function qn(e,i,r){r===void 0&&(r={});var n={type:"GeometryCollection",geometries:e};return Or(n,i,r)}function ro(e,i){if(i===void 0&&(i=0),i&&!(i>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,i||0);return Math.round(e*r)/r}function ka(e,i){i===void 0&&(i="kilometers");var r=ht[i];if(!r)throw new Error(i+" units is invalid");return e*r}function oa(e,i){i===void 0&&(i="kilometers");var r=ht[i];if(!r)throw new Error(i+" units is invalid");return e/r}function Tt(e,i){return ue(oa(e,i))}function ge(e){var i=e%360;return i<0&&(i+=360),i}function ue(e){var i=e%(2*Math.PI);return i*180/Math.PI}function we(e){var i=e%360;return i*Math.PI/180}function Z(e,i,r){if(i===void 0&&(i="kilometers"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("length must be a positive number");return ka(oa(e,i),r)}function Je(e,i,r){if(i===void 0&&(i="meters"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=Jt[i];if(!n)throw new Error("invalid original units");var t=Jt[r];if(!t)throw new Error("invalid final units");return e/n*t}function Xt(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Dr(e){return!!e&&e.constructor===Object}function tt(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(i){if(!Xt(i))throw new Error("bbox must only contain numbers")})}function It(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function mr(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ir(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function $r(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return $r(e[0]);throw new Error("coordinates must only contain numbers")}function tn(e,i,r){if(!i||!r)throw new Error("type and name required");if(!e||e.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.type)}function $n(e,i,r){if(!e)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!e.geometry||e.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.geometry.type)}function Vn(e,i,r){if(!e)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(var n=0,t=e.features;n<t.length;n++){var o=t[n];if(!o||o.type!=="Feature"||!o.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!o.geometry||o.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+o.geometry.type)}}function rn(e){return e.type==="Feature"?e.geometry:e}function vi(e,i){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function ni(e,i,r){if(e!==null)for(var n,t,o,u,l,p,v,x=0,E=0,C,T=e.type,O=T==="FeatureCollection",L=T==="Feature",B=O?e.features.length:1,H=0;H<B;H++){v=O?e.features[H].geometry:L?e.geometry:e,C=v?v.type==="GeometryCollection":!1,l=C?v.geometries.length:1;for(var oe=0;oe<l;oe++){var le=0,Re=0;if(u=C?v.geometries[oe]:v,u!==null){p=u.coordinates;var Ne=u.type;switch(x=r&&(Ne==="Polygon"||Ne==="MultiPolygon")?1:0,Ne){case null:break;case"Point":if(i(p,E,H,le,Re)===!1)return!1;E++,le++;break;case"LineString":case"MultiPoint":for(n=0;n<p.length;n++){if(i(p[n],E,H,le,Re)===!1)return!1;E++,Ne==="MultiPoint"&&le++}Ne==="LineString"&&le++;break;case"Polygon":case"MultiLineString":for(n=0;n<p.length;n++){for(t=0;t<p[n].length-x;t++){if(i(p[n][t],E,H,le,Re)===!1)return!1;E++}Ne==="MultiLineString"&&le++,Ne==="Polygon"&&Re++}Ne==="Polygon"&&le++;break;case"MultiPolygon":for(n=0;n<p.length;n++){for(Re=0,t=0;t<p[n].length;t++){for(o=0;o<p[n][t].length-x;o++){if(i(p[n][t][o],E,H,le,Re)===!1)return!1;E++}Re++}le++}break;case"GeometryCollection":for(n=0;n<u.geometries.length;n++)if(ni(u.geometries[n],i,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function sa(e,i,r,n){var t=r;return ni(e,function(o,u,l,p,v){u===0&&r===void 0?t=o:t=i(t,o,u,l,p,v)},n),t}function Sa(e,i){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length&&i(e.features[r].properties,r)!==!1;r++);break;case"Feature":i(e.properties,0);break}}function Na(e,i,r){var n=r;return Sa(e,function(t,o){o===0&&r===void 0?n=t:n=i(n,t,o)}),n}function ga(e,i){if(e.type==="Feature")i(e,0);else if(e.type==="FeatureCollection")for(var r=0;r<e.features.length&&i(e.features[r],r)!==!1;r++);}function ta(e,i,r){var n=r;return ga(e,function(t,o){o===0&&r===void 0?n=t:n=i(n,t,o)}),n}function Q(e){var i=[];return ni(e,function(r){i.push(r)}),i}function ae(e,i){var r,n,t,o,u,l,p,v,x,E,C=0,T=e.type==="FeatureCollection",O=e.type==="Feature",L=T?e.features.length:1;for(r=0;r<L;r++){for(l=T?e.features[r].geometry:O?e.geometry:e,v=T?e.features[r].properties:O?e.properties:{},x=T?e.features[r].bbox:O?e.bbox:void 0,E=T?e.features[r].id:O?e.id:void 0,p=l?l.type==="GeometryCollection":!1,u=p?l.geometries.length:1,t=0;t<u;t++){if(o=p?l.geometries[t]:l,o===null){if(i(null,C,v,x,E)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(i(o,C,v,x,E)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(i(o.geometries[n],C,v,x,E)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}C++}}function me(e,i,r){var n=r;return ae(e,function(t,o,u,l,p){o===0&&r===void 0?n=t:n=i(n,t,o,u,l,p)}),n}function Me(e,i){ae(e,function(r,n,t,o,u){var l=r===null?null:r.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return i(Or(r,t,{bbox:o,id:u}),n,0)===!1?!1:void 0}var p;switch(l){case"MultiPoint":p="Point";break;case"MultiLineString":p="LineString";break;case"MultiPolygon":p="Polygon";break}for(var v=0;v<r.coordinates.length;v++){var x=r.coordinates[v],E={type:p,coordinates:x};if(i(Or(E,t),n,v)===!1)return!1}})}function Ve(e,i,r){var n=r;return Me(e,function(t,o,u){o===0&&u===0&&r===void 0?n=t:n=i(n,t,o,u)}),n}function at(e,i){Me(e,function(r,n,t){var o=0;if(!!r.geometry){var u=r.geometry.type;if(!(u==="Point"||u==="MultiPoint")){var l,p=0,v=0,x=0;if(ni(r,function(E,C,T,O,L){if(l===void 0||n>p||O>v||L>x){l=E,p=n,v=O,x=L,o=0;return}var B=lineString([l,E],r.properties);if(i(B,n,t,L,o)===!1)return!1;o++,l=E})===!1)return!1}}})}function _t(e,i,r){var n=r,t=!1;return at(e,function(o,u,l,p,v){t===!1&&r===void 0?n=o:n=i(n,o,u,l,p,v),t=!0}),n}function Ce(e,i){if(!e)throw new Error("geojson is required");Me(e,function(r,n,t){if(r.geometry!==null){var o=r.geometry.type,u=r.geometry.coordinates;switch(o){case"LineString":if(i(r,n,t,0,0)===!1)return!1;break;case"Polygon":for(var l=0;l<u.length;l++)if(i(lineString(u[l],r.properties),n,t,l)===!1)return!1;break}}})}function $e(e,i,r){var n=r;return Ce(e,function(t,o,u,l){o===0&&r===void 0?n=t:n=i(n,t,o,u,l)}),n}function Zt(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,t=i.geometryIndex||0,o=i.segmentIndex||0,u=i.properties,l;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),u=u||e.features[r].properties,l=e.features[r].geometry;break;case"Feature":u=u||e.properties,l=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=e;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var p=l.coordinates;switch(l.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=p.length+o-1),lineString([p[o],p[o+1]],u,i);case"Polygon":return t<0&&(t=p.length+t),o<0&&(o=p[t].length+o-1),lineString([p[t][o],p[t][o+1]],u,i);case"MultiLineString":return n<0&&(n=p.length+n),o<0&&(o=p[n].length+o-1),lineString([p[n][o],p[n][o+1]],u,i);case"MultiPolygon":return n<0&&(n=p.length+n),t<0&&(t=p[n].length+t),o<0&&(o=p[n][t].length-o-1),lineString([p[n][t][o],p[n][t][o+1]],u,i)}throw new Error("geojson is invalid")}function Rr(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,t=i.geometryIndex||0,o=i.coordIndex||0,u=i.properties,l;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),u=u||e.features[r].properties,l=e.features[r].geometry;break;case"Feature":u=u||e.properties,l=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=e;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var p=l.coordinates;switch(l.type){case"Point":return point(p,u,i);case"MultiPoint":return n<0&&(n=p.length+n),point(p[n],u,i);case"LineString":return o<0&&(o=p.length+o),point(p[o],u,i);case"Polygon":return t<0&&(t=p.length+t),o<0&&(o=p[t].length+o),point(p[t][o],u,i);case"MultiLineString":return n<0&&(n=p.length+n),o<0&&(o=p[n].length+o),point(p[n][o],u,i);case"MultiPolygon":return n<0&&(n=p.length+n),t<0&&(t=p[n].length+t),o<0&&(o=p[n][t].length-o),point(p[n][t][o],u,i)}throw new Error("geojson is invalid")}function nr(e,i){var r=i.x,n=i.y,t=i.x1,o=i.y1,u=i.coordinates,l=i.geometry,p=[];if(!Array.isArray(e))return{dataArray:[]};if(l)return e.filter(function(H){return H[l]&&H[l].type&&H[l].coordinates&&H[l].coordinates.length>0}).forEach(function(H,oe){var le=ze()((0,z.Z)({},H[l]),!0);Me(le,function(Re){var Ne=Ir(Re),ut=(0,z.Z)((0,z.Z)({},H),{},{_id:oe,coordinates:Ne});p.push(ut)})}),{dataArray:p};for(var v=0;v<e.length;v++){var x=e[v],E=[];if(u){var C="Polygon";Array.isArray(u[0])||(C="Point"),Array.isArray(u[0])&&!Array.isArray(u[0][0])&&(C="LineString");var T=ze()({type:C,coordinates:(0,N.Z)(x[u])},!0);E=T.coordinates}else if(r&&n&&t&&o){var O=[parseFloat(x[r]),parseFloat(x[n])],L=[parseFloat(x[t]),parseFloat(x[o])];E=[O,L]}else r&&n&&(E=[parseFloat(x[r]),parseFloat(x[n])]);var B=(0,z.Z)((0,z.Z)({},x),{},{_id:v,coordinates:E});p.push(B)}return{dataArray:p}}function lr(e,i){var r=ft(e);return nr(r,i)}function Lr(e){for(var i=e.toString(),r=5381,n=i.length;n;)r=r*33^i.charCodeAt(--n);return r>>>0}function Dn(e,i){return i===void 0?null:e.properties[i]?e.properties[i]:e.properties&&e.properties[i]?Lr(e.properties[i]+"")%1000019:null}function Mn(e,i){var r=[],n={};return e.features?(e.features=e.features.filter(function(t){var o=t.geometry;return t!=null&&o&&o.type&&o.coordinates&&o.coordinates.length>0}),ze()(e,!0),e.features.length===0?{dataArray:[],featureKeys:n}:(Me(e,function(t,o){var u=Dn(t,i==null?void 0:i.featureId);u===null&&(u=o);var l=u,p=Ir(t),v=(0,z.Z)((0,z.Z)({},t.properties),{},{coordinates:p,_id:l});r.push(v)}),{dataArray:r,featureKeys:n})):(e.features=[],{dataArray:[]})}function $t(e){var i=131,r=137,n=0;e+="x";for(var t=Math.floor(9007199254740991/r),o=0;o<e.length;o++)n>t&&(n=Math.floor(n/r)),n=n*i+e.charCodeAt(o);return n}function Cn(e){e=e.toString();for(var i=5381,r=e.length;r;)i=i*33^e.charCodeAt(--r);return i>>>0}var hr=K(28481),St=K(96486),Ei="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function mn(e){this.message=e}mn.prototype=new Error,mn.prototype.name="InvalidCharacterError";function Oi(e){var i=String(e).replace(/=+$/,"");if(i.length%4==1)throw new mn("'atob' failed: The string to be decoded is not correctly encoded.");for(var r="",n=0,t,o,u=0;o=i.charAt(u++);~o&&(t=n%4?t*64+o:o,n++%4)?r+=String.fromCharCode(255&t>>(-2*n&6)):0)o=Ei.indexOf(o);return r}function ua(e){e=String(e);for(var i,r,n,t,o="",u=0,l=e.length%3;u<e.length;){if((r=e.charCodeAt(u++))>255||(n=e.charCodeAt(u++))>255||(t=e.charCodeAt(u++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");i=r<<16|n<<8|t,o+=Ei.charAt(i>>18&63)+Ei.charAt(i>>12&63)+Ei.charAt(i>>6&63)+Ei.charAt(i&63)}return l?o.slice(0,l-3)+"===".substring(l):o}var xt=K(6610),wt=K(5991),Ri=function(){function e(i,r){(0,xt.Z)(this,e),this.buffers=i,this.type=r}return(0,wt.Z)(e,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(r,n,t){throw new Error("not implemented")}}]),e}(),pi,Ji=function(){return pi||(pi=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof K.g!="undefined"?K.g:{})};pi=Ji();var ea;typeof window=="undefined"?ea={devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(i){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(i){return!0},Event:function(i,r){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:ea=window;var la=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Di=la?my.getSystemInfoSync().pixelRatio:ea.devicePixelRatio,gr=K(10379),Cr=K(46070),rt=K(77608),Aa=(0,wt.Z)(function e(i,r){(0,xt.Z)(this,e),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=i,this.timeStamp=Date.now()}),De=K(63349);function ws(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=os(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function os(e,i){if(!!e){if(typeof e=="string")return ia(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ia(e,i)}}function ia(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Vs=new WeakMap,no=function(){function e(){(0,xt.Z)(this,e),Vs.set(this,{})}return(0,wt.Z)(e,[{key:"addEventListener",value:function(r,n){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=Vs.get(this);o||(o={}),o[r]||(o[r]=[]),o[r].push(n),Vs.set(this,o),t.capture,t.once,t.passive}},{key:"removeEventListener",value:function(r,n){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=Vs.get(this);if(o){var u=o[r];if(u&&u.length>0){for(var l=u.length;l--;l>0)if(u[l]===n){u.splice(l,1);break}}}}},{key:"dispatchEvent",value:function(r){var n=Vs.get(this)[r.type];if(n){var t=ws(n),o;try{for(t.s();!(o=t.n()).done;){var u=o.value;u(r)}}catch(l){t.e(l)}finally{t.f()}}}}]),e}();function Wa(e){var i=io();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function io(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ca=function(e){(0,gr.Z)(r,e);var i=Wa(r);function r(){var n;return(0,xt.Z)(this,r),n=i.call(this),n.childNodes=[],n}return(0,wt.Z)(r,[{key:"appendChild",value:function(t){this.childNodes.push(t)}},{key:"cloneNode",value:function(){var t=Object.create(this);return Object.assign(t,this),t}},{key:"removeChild",value:function(t){var o=this.childNodes.findIndex(function(u){return u===t});return o>-1?this.childNodes.splice(o,1):null}}]),r}(no);function Ho(e){var i=Jo();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function Jo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wu=function(e){(0,gr.Z)(r,e);var i=Ho(r);function r(){var n;return(0,xt.Z)(this,r),n=i.call(this),n.className="",n.children=[],n}return(0,wt.Z)(r,[{key:"setAttribute",value:function(t,o){this[t]=o}},{key:"getAttribute",value:function(t){return this[t]}},{key:"setAttributeNS",value:function(t,o){this[t]=o}},{key:"getAttributeNS",value:function(t){return this[t]}}]),r}(ca),To=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Mo,ha,ao,Wo;if(To){var Ya=my.getSystemInfoSync();Mo=Ya.screenWidth,ha=Ya.screenHeight,ao=Ya.windowWidth,Wo=Ya.windowHeight}else{var qs=ea.innerWidth,Il=ea.innerHeight;Mo=qs,ha=Il,ao=qs,Wo=Il}var es={width:Mo,height:ha,availWidth:ao,availHeight:Wo,availLeft:0,availTop:0},ve=es.availWidth,Oe=es.availHeight,mt={style:[]};function er(e,i){if(!("parentNode"in e)){var r;i===0?r=function(){return null}:i===1?r=function(){return mt}:r=function(){return null},Object.defineProperty(e,"parentNode",{enumerable:!0,get:r})}if(!("parentElement"in e)){var n;i===0?n=function(){return null}:i===1?n=function(){return mt}:n=function(){return null},Object.defineProperty(e,"parentElement",{enumerable:!0,get:n})}}function en(e){e.style=e.style||{},Object.assign(e.style,{top:"0px",left:"0px",width:ve+"px",height:Oe+"px",margin:"0px",padding:"0px"})}function Hn(e){"clientLeft"in e||(e.clientLeft=0,e.clientTop=0),"clientWidth"in e||(e.clientWidth=ve,e.clientHeight=Oe),"getBoundingClientRect"in e||(e.getBoundingClientRect=function(){var i={x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight};return i})}function Fi(e){"offsetLeft"in e||(e.offsetLeft=0,e.offsetTop=0),"offsetWidth"in e||(e.offsetWidth=ve,e.offsetHeight=Oe)}function fo(e){"scrollLeft"in e||(e.scrollLeft=0,e.scrollTop=0),"scrollWidth"in e||(e.scrollWidth=ve,e.scrollHeight=Oe)}function za(e){var i=function(){return!0};e.classList=[],e.classList.add=i,e.classList.remove=i,e.classList.contains=i,e.classList.toggle=i}function qa(e){var i=ts();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function ts(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Do(){}var mo=function(e){(0,gr.Z)(r,e);var i=qa(r);function r(){var n,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",o=arguments.length>1?arguments[1]:void 0;return(0,xt.Z)(this,r),n=i.call(this),n.className="",n.children=[],n.focus=Do,n.blur=Do,n.insertBefore=Do,n.appendChild=Do,n.removeChild=Do,n.remove=Do,n.innerHTML="",n.tagName=t.toUpperCase(),er((0,De.Z)(n),o),en((0,De.Z)(n)),za((0,De.Z)(n)),Hn((0,De.Z)(n)),Fi((0,De.Z)(n)),fo((0,De.Z)(n)),n}return(0,wt.Z)(r)}(wu);function Cs(e){var i=As();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function As(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ts=function(e){(0,gr.Z)(r,e);var i=Cs(r);function r(n){return(0,xt.Z)(this,r),i.call(this,n)}return(0,wt.Z)(r,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),r}(mo);function Ks(e){var i=cu();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function cu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ps=function(e){(0,gr.Z)(r,e);var i=Ks(r);function r(){return(0,xt.Z)(this,r),i.call(this,"video")}return(0,wt.Z)(r)}(Ts),Zi={},Ia={};function Oc(e,i){Zi=e,Zi.id=i,"tagName"in Zi||(Zi.tagName="CANVAS"),Zi.type="canvas",Mixin.parentNode(Zi),Mixin.style(Zi),Mixin.classList(Zi),Mixin.clientRegion(Zi),Mixin.offsetRegion(Zi),Zi.focus=function(){},Zi.blur=function(){}}function ff(e,i){var r=1024,n=1024;Ia={width:r,height:n,clientWidth:r/devicePixelRatio,clientHeight:n/devicePixelRatio,id:i,type:"canvas"},"tagName"in Ia||(Ia.tagName="CANVAS"),Mixin.parentNode(Ia),Mixin.style(Ia),Mixin.classList(Ia),Mixin.clientRegion(Ia),Mixin.offsetRegion(Ia),Ia.getContext=function(t){if(t==="2d")return e},Ia.focus=function(){},Ia.blur=function(){}}function Ms(){return Zi}function hf(){return Ia}var al=(0,wt.Z)(function e(){(0,xt.Z)(this,e);var i=Ms(),r=i.createImage&&i.createImage()||{};return"tagName"in r||(r.tagName="IMG",r.__proto__=e.prototype),er(r),za(r),Object.assign(r,{addEventListener:function(t,o){r["on".concat(t)]=o.bind(r)},removeEventListener:function(t){r["on".concat(t)]=null}}),r}),$u={href:"",protocol:"",host:""};function Qs(e){var i=Pl();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function Pl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var b=function(e){(0,gr.Z)(r,e);var i=Qs(r);function r(){return(0,xt.Z)(this,r),i.call(this,"body",0)}return(0,wt.Z)(r,[{key:"addEventListener",value:function(t,o){var u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(t,o,u){}},{key:"dispatchEvent",value:function(t){}}]),r}(mo),k=function(e){(0,gr.Z)(r,e);var i=Qs(r);function r(){return(0,xt.Z)(this,r),i.call(this,"html",0)}return(0,wt.Z)(r,[{key:"addEventListener",value:function(t,o){var u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(t,o){}},{key:"dispatchEvent",value:function(t){}}]),r}(mo),U={},R={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:$u,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(i){return i=i.toLowerCase(),i==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):i==="img"?new al:i==="video"?new ps:new mo(i)},createElementNS:function(i,r){return this.createElement(r)},createTextNode:function(i){return i},getElementById:function(i){return null},getElementsByTagName:function(i){return i=i.toLowerCase(),[]},getElementsByTagNameNS:function(i,r){return this.getElementsByTagName(r)},getElementsByName:function(i){return[]},querySelector:function(i){return null},querySelectorAll:function(i){return[]},addEventListener:function(i,r,n){U[i]||(U[i]=[]),U[i].push(r)},removeEventListener:function(i,r){var n=U[i];if(n&&n.length>0){for(var t=n.length;t--;t>0)if(n[t]===r){n.splice(t,1);break}}},dispatchEvent:function(i){var r=i.type,n=U[r];if(n)for(var t=0;t<n.length;t++)n[t](i);i.target&&typeof i.target["on"+r]=="function"&&i.target["on"+r](i)},createEvent:function(i){return new Aa(i)}};R.documentElement=new k,R.head=new mo("head"),R.body=new b;var ie=Object,Pe=K(90484),ct=function(){function e(){(0,xt.Z)(this,e);var i=arguments.length;if(i===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){this._w=arguments[0],this._h=arguments[1],this._data=new Uint8ClampedArray(this._w*this._h*4);return}}else i===3&&(0,Pe.Z)(arguments[0])==="object"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number"&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return(0,wt.Z)(e,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),e}(),Ft=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Bt,Er,Zr;if(Ft){var Wn=my.getSystemInfoSync();Bt=Wn.system,Er=Wn.platform,Zr=Wn.language}else{var ti={versions:function(){var e=ea.navigator.userAgent;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")===-1,mobile:!!e.match(/AppleWebKit.*Mobile.*/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:e.indexOf("Safari")===-1,weixin:e.indexOf("MicroMessenger")>-1,qq:e.match(/\sQQ/i)===" qq"}}(),language:(ea.navigator.browserLanguage||ea.navigator.language).toLowerCase()};ti.versions.android?Er="android":ti.versions.trident?Er="IE":ti.versions.presto?Er="Opera":ti.versions.webKit?Er="webKit":ti.versions.gecko?Er="Firefox":ti.versions.mobile?Er="mobile":ti.versions.ios?Er="ios":ti.versions.iPhone?Er="iPhone":ti.versions.iPad?Er="ipad":ti.versions.webApp?Er="webApp":ti.versions.weixin?Er="weixin":ti.versions.qq&&(Er="qq"),Bt=ea.navigator.userAgent,Zr=ti.language}var gi=Bt.toLowerCase().indexOf("android")!==-1,$i=gi?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",wa="Mozilla/5.0 (".concat($i,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(Zr),Oa={platform:Er,language:Zr,appVersion:"5.0 (".concat($i,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:wa},Yi={mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){}},ds=0,fu=0;function ol(e){var i=Date.now(),r=Math.max(ds+23,i);return fu=setTimeout(function(){e(ds=r)},r-i),fu}function pf(e){var i=Ms();return i.requestAnimationFrame?i.requestAnimationFrame(e):ol(e)}function sl(e){var i=Ms();return i.cancelAnimationFrame?i.cancelAnimationFrame(e):clearTimeout(e)}var Lc=function(){function e(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if((0,xt.Z)(this,e),i.indexOf("http://")==0||i.indexOf("https://")==0){this.href=i;return}this.href=r+i}return(0,wt.Z)(e,null,[{key:"createObjectURL",value:function(r){var n=r.buffers[0],t=r.type,o=Bu(n),u="data:".concat(t,";base64, ");return u+o}}]),e}();function Bu(e){for(var i="",r=new Uint8Array(e),n=r.byteLength,t=0;t<n;t++)i+=String.fromCharCode(r[t]);return ua(i)}var Nu={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:18446744073709552e3,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},zu={};function go(e){var i=Uf();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function Uf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Dc=new Map,vs=new Map,df=new Map,Yu={json:"application/json",text:"application/text",arraybuffer:"application/octet-stream"};function Js(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{target:this};typeof this["on".concat(e)]=="function"&&this["on".concat(e)].call(this,i)}function Vf(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{readyState:e};this.readyState=e,Js.call(this,"readystatechange",i)}var js=function(e){(0,gr.Z)(r,e);var i=go(r);function r(){var n;return(0,xt.Z)(this,r),n=i.call(this),n.onabort=null,n.onerror=null,n.onload=null,n.onloadstart=null,n.onprogress=null,n.ontimeout=null,n.onloadend=null,n.onreadystatechange=null,n.readyState=0,n.response=null,n.responseText=null,n._responseType="text",n.responseXML=null,n.status=0,n.statusText="",n.upload={},n.withCredentials=!1,Dc.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),n}return(0,wt.Z)(r,[{key:"responseType",set:function(t){this._responseType=t}},{key:"abort",value:function(){var t=df.get("requestTask");t&&t.abort()}},{key:"getAllResponseHeaders",value:function(){var t=vs.get("responseHeader");return Object.keys(t).map(function(o){return"".concat(o,": ").concat(t[o])}).join(`
`)}},{key:"getResponseHeader",value:function(t){return vs.get("responseHeader")[t]}},{key:"open",value:function(t,o,u){this._method=t,this._url=o}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:""}},{key:"setRequestHeader",value:function(t,o){var u=Dc.get("requestHeader");u[t]=o,Dc.set("requestHeader",u)}},{key:"addEventListener",value:function(t,o){var u=this;typeof o=="function"&&(this["on"+t]=function(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};l.target=l.target||u,o.call(u,l)})}},{key:"removeEventListener",value:function(t,o){this["on"+t]===o&&(this["on"+t]=null)}}]),r}(no);js.UNSEND=0,js.OPENED=1,js.HEADERS_RECEIVED=2,js.LOADING=3,js.DONE=4;function Ta(e){var i=Rl();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function Rl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Mh=function(e){(0,gr.Z)(r,e);var i=Ta(r);function r(n){var t;return(0,xt.Z)(this,r),t=i.call(this,n),t.touches=[],t.targetTouches=[],t.changedTouches=[],t.target=Ms(),t.currentTarget=Ms(),t}return(0,wt.Z)(r)}(Aa);function Zu(e){var i=e||{},r=i.x,n=r===void 0?0:r,t=i.y,o=t===void 0?0:t,u=i.clientX,l=u===void 0?0:u,p=i.clientY,v=p===void 0?0:p;Object.keys(e).indexOf("x")!==-1?(e.pageX=e.clientX=n,e.pageY=e.clientY=o):(e.x=l,e.y=v)}function Fc(e){return function(i){var r=new Mh(e);r.changedTouches=i.changedTouches,r.touches=i.touches,r.targetTouches=Array.prototype.slice.call(i.touches),r.timeStamp=i.timeStamp,r.changedTouches.forEach(function(n){return Zu(n)}),r.touches.forEach(function(n){return Zu(n)}),r.targetTouches.forEach(function(n){return Zu(n)}),R.dispatchEvent(r)}}function op(e){return function(i){i.type=e,R.dispatchEvent(i)}}var sp=Fc("touchstart"),jf=Fc("touchmove"),Bc=Fc("touchend"),ac=op("mapCameaParams");function Ol(e){var i=Ll();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function Ll(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ul=function(e){(0,gr.Z)(r,e);var i=Ol(r);function r(n){var t;return(0,xt.Z)(this,r),t=i.call(this,n),t.target=Ms(),t.currentTarget=Ms(),t}return(0,wt.Z)(r)}(Aa),ll=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],cl=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0],eu="touch";function vf(e,i,r){for(var n=new ul(e),t=0;t<ll.length;t++){var o=ll[t];n[o]=i[o]||cl[t]}return n.type=e,n.target=Ms(),n.currentTarget=Ms(),n.buttons=mf(e),n.which=n.buttons,n.pointerId=(i.identifier||0)+2,n.bubbles=!0,n.cancelable=!0,n.button=0,n.width=(i.radiusX||.5)*2,n.height=(i.radiusY||.5)*2,n.pressure=i.force||.5,n.isPrimary=fl(i),n.pointerType=eu,n.altKey=r.altKey,n.ctrlKey=r.ctrlKey,n.metaKey=r.metaKey,n.shiftKey=r.shiftKey,r.preventDefault&&(n.preventDefault=function(){r.preventDefault()}),n}function mf(e){var i=0;return(e==="touchstart"||e==="touchmove"||e==="pointerdown"||e==="pointermove")&&(i=1),i}var Dl=null;function fl(e){return Dl===e.identifier}function oc(e){Dl===null&&(Dl=e.identifier)}function Nc(e){Dl===e.identifier&&(Dl=null)}function sc(e){return function(i){for(var r=i.changedTouches,n=0;n<r.length;n++){var t=r[n];n===0&&e==="pointerdown"?oc(t):(e==="pointerup"||e==="pointercancel")&&Nc(t);var o=vf(e,t,i);R.dispatchEvent(o)}}}var gf=sc("pointerdown"),up=sc("pointermove"),yf=sc("pointerup");function hl(e){var i=_f();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function _f(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Gf=function(e){(0,gr.Z)(r,e);var i=hl(r);function r(n){return(0,xt.Z)(this,r),i.call(this,n)}return(0,wt.Z)(r)}(Aa);function Uu(e){return function(i){i.type=e,R.dispatchEvent(i)}}var kh=Uu("mousedown"),Ih=Uu("mousemove"),Ph=Uu("mouseup"),Fl=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Rh=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),rs=Fl||Rh,Ka={atob:Oi,btoa:ua,devicePixelRatio:Di,Blob:Ri,document:R,Element:wu,Event:Aa,EventTarget:no,HTMLCanvasElement:ie,HTMLElement:mo,HTMLMediaElement:Ts,HTMLVideoElement:ps,Image:al,ImageData:ct,navigator:Oa,Node:ca,requestAnimationFrame:pf,cancelAnimationFrame:sl,screen:es,XMLHttpRequest:js,performance:Yi,URL:Lc,WebGLRenderingContext:Nu,WebGL2RenderingContext:zu,addEventListener:function(i,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};R.addEventListener(i,r,n)},removeEventListener:function(i,r,n){R.removeEventListener(i,r)},dispatchEvent:function(i){R.dispatchEvent(i)},innerWidth:es.availWidth,innerHeight:es.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},pa=rs?Ka:ea,Bl=rs?js:ea.XMLHttpRequest,qu=rs?$u:ea.location;function Gi(e){var i=e;return typeof e=="string"&&(i=pa.document.getElementById(e)),i}function La(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Rs(e){return La(e).split(/\s+/)}function zc(e){var i,r,n=pa==null||(i=pa.document)===null||i===void 0||(r=i.documentElement)===null||r===void 0?void 0:r.style;if(!n)return e[0];for(var t in e)if(e[t]&&e[t]in n)return e[t];return e[0]}function Bi(e,i,r){var n=pa.document.createElement(e);return i&&(n.className=i||""),r&&r.appendChild(n),n}function ks(e){var i=e.parentNode;i&&i.removeChild(e)}function Cu(e,i){if(e.classList!==void 0)for(var r=Rs(i),n=0,t=r.length;n<t;n++)e.classList.add(r[n]);else if(!Zc(e,i)){var o=Au(e);uc(e,(o?o+" ":"")+i)}}function Nl(e,i){e.classList!==void 0?e.classList.remove(i):uc(e,La((" "+Au(e)+" ").replace(" "+i+" "," ")))}function Zc(e,i){if(e.classList!==void 0)return e.classList.contains(i);var r=Au(e);return r.length>0&&new RegExp("(^|\\s)"+i+"(\\s|$)").test(r)}function uc(e,i){e instanceof HTMLElement?e.className=i:e.className.baseVal=i}function Au(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function Xo(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var lc=zc(["transform","WebkitTransform"]);function zl(e,i){e.style[lc]=i}function ko(){if(typeof Event=="function")pa.dispatchEvent(new Event("resize"));else{var e=pa.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,pa,0),pa.dispatchEvent(e)}}function Fn(e){var i=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,i.join(""))}function ho(){var e,i=pa.document.querySelector('meta[name="viewport"]');if(!i)return 1;var r=(e=i.content)===null||e===void 0?void 0:e.split(","),n=r.find(function(t){var o=t.split("="),u=(0,hr.Z)(o,1),l=u[0];return l==="initial-scale"});return n?n.split("=")[1]*1:1}var Da=ho()<1?1:pa.devicePixelRatio;function pl(e,i){e.setAttribute("style","".concat(e.style.cssText).concat(i))}function tu(e){return e.split(";").map(function(i){return i.trim()}).filter(function(i){return i})}function Gs(e,i){var r,n=tu((r=e.getAttribute("style"))!==null&&r!==void 0?r:""),t=tu(i),o=St.pull.apply(void 0,[n].concat((0,N.Z)(t)));e.setAttribute("style",o.join(";"))}function xf(e){return Object.entries(e).map(function(i){var r=(0,hr.Z)(i,2),n=r[0],t=r[1];return"".concat(n,": ").concat(t)}).join(";")}function vn(e,i){return{left:e.left-i.left,top:e.top-i.top,right:i.left+i.width-e.left-e.width,bottom:i.top+i.height-e.top-e.height}}function cc(e,i){e.checked=i,i?e.setAttribute("checked","true"):e.removeAttribute("checked")}function Zl(e){e.innerHTML=""}function Ku(e){e.setAttribute("draggable","false")}function Va(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i*1}function Os(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i*1}function fc(e){if(e.length===0)return 0;for(var i=e[0]*1,r=1;r<e.length;r++)i+=e[r]*1;return i}function Vu(e){if(e.length===0)throw new Error("mean requires at least one data point");return fc(e)/e.length}function Ls(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var i=e[0],r=NaN,n=0,t=1,o=1;o<e.length+1;o++)e[o]!==i?(t>n&&(n=t,r=i),t=1,i=e[o]):t++;return r*1}var hu={min:Os,max:Va,mean:Vu,sum:fc,mode:Ls};function bf(e,i){return e.map(function(r){return r[i]})}function Uc(e,i){return hu[e](i)}var Ef=K(14665);function Hf(e){return Function.toString.call(e).indexOf("[native code]")!==-1}var ru=K(51814);function ms(e,i,r){return(0,ru.Z)()?ms=Reflect.construct.bind():ms=function(t,o,u){var l=[null];l.push.apply(l,o);var p=Function.bind.apply(t,l),v=new p;return u&&(0,Ef.Z)(v,u.prototype),v},ms.apply(null,arguments)}function Li(e){var i=typeof Map=="function"?new Map:void 0;return Li=function(n){if(n===null||!Hf(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof i!="undefined"){if(i.has(n))return i.get(n);i.set(n,t)}function t(){return ms(n,arguments,(0,rt.Z)(this).constructor)}return t.prototype=Object.create(n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),(0,Ef.Z)(t,n)},Li(e)}function Tu(e){var i=pu();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function pu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ns=function(e){(0,gr.Z)(r,e);var i=Tu(r);function r(n,t,o,u){var l;return(0,xt.Z)(this,r),l=i.call(this,"AJAXError: ".concat(t," (").concat(n,"): ").concat(o)),l.status=n,l.statusText=t,l.url=o,l.body=u,l}return(0,wt.Z)(r)}(Li(Error));function Qu(e,i){var r=new Bl,n=Array.isArray(e.url)?e.url[0]:e.url;r.open(e.method||"GET",n,!0),e.type==="arrayBuffer"&&(r.responseType="arraybuffer");for(var t in e.headers)e.headers.hasOwnProperty(t)&&r.setRequestHeader(t,e.headers[t]);return e.type==="json"&&(r.responseType="text",r.setRequestHeader("Accept","application/json")),r.withCredentials=e.credentials==="include",r.onerror=function(){i(new Error(r.statusText))},r.onload=function(){if((r.status>=200&&r.status<300||r.status===0)&&r.response!==null){var o=r.response;if(e.type==="json")try{o=JSON.parse(r.response)}catch(l){return i(l)}i(null,o,r.getResponseHeader("Cache-Control"),r.getResponseHeader("Expires"),r)}else{var u=new Blob([r.response],{type:r.getResponseHeader("Content-Type")});i(new ns(r.status,r.statusText,n.toString(),u))}},r.send(e.body),r}function dl(e){return new Promise(function(i,r){Qu(e,function(n,t,o,u,l){n?r({err:n,data:null,xhr:l}):i({err:null,data:t,cacheControl:o,expires:u,xhr:l})})})}function Is(e,i){return Qu(e,i)}var Ds=function(i,r){return Is(_objectSpread(_objectSpread({},i),{},{type:"json"}),r)},Hs=function(i,r){return Is((0,z.Z)((0,z.Z)({},i),{},{type:"arrayBuffer"}),r)},Yn=function(i,r){return Is(_objectSpread(_objectSpread({},i),{},{method:"POST"}),r)};function Gn(e){var i=$window.document.createElement("a");return i.href=e,i.protocol===$window.document.location.protocol&&i.host===$window.document.location.host}var hc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function gs(e,i){var r=new pa.Image,n=pa.URL||pa.webkitURL;r.crossOrigin="anonymous",r.onload=function(){i(null,r),n.revokeObjectURL(r.src),r.onload=null,window.requestAnimationFrame(function(){r.src=hc})},r.onerror=function(){return i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var t=new Blob([new Uint8Array(e)],{type:"image/png"});r.src=e.byteLength?n.createObjectURL(t):hc}function du(e,i){var r=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(r).then(function(n){i(null,n)}).catch(function(n){i(new Error("Could not load image because of ".concat(n.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))})}var Fo=function(i,r){return Hs(i,function(n,t){if(n)r(n);else if(t){var o=typeof createImageBitmap=="function";o?du(t,r):gs(t,r)}})};function nu(e){return typeof e=="number"}function pc(e){var i=[Infinity,Infinity,-Infinity,-Infinity];return ni(e,function(r){i[0]>r[0]&&(i[0]=r[0]),i[1]>r[1]&&(i[1]=r[1]),i[2]<r[0]&&(i[2]=r[0]),i[3]<r[1]&&(i[3]=r[1])}),i}pc.default=pc;var Vc=pc,fa=2*Math.PI*6378137/2;function ja(e,i){var r=(0,hr.Z)(i,4),n=r[0],t=r[1],o=r[2],u=r[3];return e.lng>n&&e.lng<=o&&e.lat>t&&e.lat<=u}function Wf(e){var i=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(r){var n=r.coordinates;vl(i,n)}),i}function vl(e,i){return Array.isArray(i[0])?i.forEach(function(r){vl(e,r)}):(e[0]>i[0]&&(e[0]=i[0]),e[1]>i[1]&&(e[1]=i[1]),e[2]<i[0]&&(e[2]=i[0]),e[3]<i[1]&&(e[3]=i[1])),e}function ju(e,i){return vu(e,i)}function vu(e,i){return Array.isArray(e[0])?e.map(function(r){return vu(r,i)}):i(e)}function Io(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=Ul(e,i);var n=e[0],t=e[1],o=n*fa/180,u=Math.log(Math.tan((90+t)*Math.PI/360))/(Math.PI/180);return u=u*fa/180,r.enable&&(o=Number(o.toFixed(r.decimal)),u=Number(u.toFixed(r.decimal))),e.length===3?[o,u,e[2]]:[o,u]}function ml(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,r=e[0],n=e[1],t=r/fa*180,o=n/fa*180;return o=180/Math.PI*(2*Math.atan(Math.exp(o*Math.PI/180))-Math.PI/2),i!=null&&(t=Number(t.toFixed(i)),o=Number(o.toFixed(i))),e.length===3?[t,o,e[2]]:[t,o]}function Mu(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function jc(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function Ul(e,i){if(i===!1)return e;var r=Mu(e[0]),n=jc(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[r,n,e[2]]:[r,n]}function Eo(e){var i=85.0511287798,r=Math.max(Math.min(i,e[1]),-i),n=256<<20,t=Math.PI/180,o=e[0]*t,u=r*t;u=Math.log(Math.tan(Math.PI/4+u/2));var l=.5/Math.PI,p=.5,v=-.5/Math.PI;return t=.5,o=n*(l*o+p),u=n*(v*u+t),[Math.floor(o),Math.floor(u)]}function Xf(e){var i=.5/Math.PI,r=.5,n=-.5/Math.PI,t=.5,o=256<<20,u=_slicedToArray(e,2),l=u[0],p=u[1];l=(l/o-r)/i,p=(p/o-t)/n,p=(Math.atan(Math.pow(Math.E,p))-Math.PI/4)*2,t=Math.PI/180;var v=p/t,x=l/t;return[x,v]}function Gc(e,i){var r=85.0511287798,n=Math.PI/180,t=6378137;return i=Math.max(Math.min(r,i),-r),e*=n,i*=n,i=Math.log(Math.tan(Math.PI/4+i/2)),[e*t,i*t]}function dc(e,i){var r=Math.PI/180,n=6378137,t=e/n/r,o=2*(Math.atan(Math.exp(i/n))-Math.PI/4)/r;return[t,o]}function $f(e,i,r){var n=we(i[1]-e[1]),t=we(i[0]-e[0]),o=we(e[1]),u=we(i[1]),l=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(t/2),2)*Math.cos(o)*Math.cos(u);return ka(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),r="meters")}function Vl(e){var i=Math.PI/180,r=85.0511287798,n=6378137,t=Math.max(Math.min(r,e[1]),-r),o=Math.sin(t*i),u=n*e[0]*i,l=n*Math.log((1+o)/(1-o))/2;return[u,l]}function iu(e,i){var r=Math.abs(e[1][1]-e[0][1])*i,n=Math.abs(e[1][0]-e[0][0])*i;return[[e[0][0]-n,e[0][1]-r],[e[1][0]+n,e[1][1]+r]]}function vc(e,i){return e[0][0]<=i[0][0]&&e[0][1]<=i[0][1]&&e[1][0]>=i[1][0]&&e[1][1]>=i[1][1]}function ku(e){return[[e[0],e[1]],[e[2],e[3]]]}function Ws(e){var i=Hc(e,[0,0]);return[e[0]/i,e[1]/i]}function Hc(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))}function Wc(e,i){return e[0]*i[0]+e[1]*i[1]}function Sf(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Xc(e,i){return Math.acos(Wc(e,i)/(Sf(e)*Sf(i)))*180/Math.PI}function f(e,i){return i[0]>0?i[1]>0?90-Math.atan(i[1]/i[0])*180/Math.PI:90+Math.atan(-i[1]/i[0])*180/Math.PI:i[1]<0?180+(90-Math.atan(i[1]/i[0])*180/Math.PI):270+Math.atan(i[1]/-i[0])*180/Math.PI}function d(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!e||e.length<2)){for(var r=[0,1],n=0,t=[],o=0;o<e.length-1;o++){var u=e[o],l=e[o+1],p=Hc(u,l);n+=p;var v=[u[0]-l[0],u[1]-l[1]],x=f(r,v);if(o>0){var E=t[o-1].rotation;E-x>360-E+x&&(x=x+360)}t.push({start:u,end:l,dis:p,rotation:x,duration:0})}return t.map(function(C){C.duration=i*(C.dis/n)}),t}}function h(e){if(nu(e[0]))return e;if(nu(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(nu(e[0][0][0])){var i=e,r=0,n=0,t=0;return i.forEach(function(o){o.forEach(function(u){r+=u[0],n+=u[1],t++})}),[r/t,n/t,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function g(e){for(var i=e[0],r=e[1],n=e[0],t=e[1],o=0,u=0,l=0,p=0;p<e.length;p+=2){var v=e[p],x=e[p+1];v&&x&&(i=Math.max(v,i),r=Math.max(x,r),n=Math.min(v,n),t=Math.min(x,t),o+=v,u+=x,l++)}return{center:[o/l,u/l],radius:Math.sqrt(Math.pow(i-n,2)+Math.pow(r-t,2))/2}}function w(e){return Vc(ki([mi(e)]))}var M=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,r=arguments.length>1?arguments[1]:void 0;(0,xt.Z)(this,e),this.limit=i,this.destroy=r||this.defaultDestroy,this.order=[],this.clear()}return(0,wt.Z)(e,[{key:"clear",value:function(){var r=this;this.order.forEach(function(n){r.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(r){var n=this.cache[r];return n&&(this.deleteOrder(r),this.appendOrder(r)),n}},{key:"set",value:function(r,n){this.cache[r]?(this.delete(r),this.cache[r]=n,this.appendOrder(r)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[r]=n,this.appendOrder(r))}},{key:"delete",value:function(r){var n=this.cache[r];n&&(this.deleteCache(r),this.deleteOrder(r),this.destroy(n,r))}},{key:"deleteCache",value:function(r){delete this.cache[r]}},{key:"deleteOrder",value:function(r){var n=this.order.findIndex(function(t){return t===r});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(r){this.order.push(r)}},{key:"defaultDestroy",value:function(r,n){return null}}]),e}();function I(e,i){e.forEach(function(r){!i[r]||(i[r]=i[r].bind(i))})}var D=null,G=K(2650);function te(e){return typeof e=="string"?!!d3.color(e):!1}function he(e){var i=G.ZP(e),r=[0,0,0,0];return i!=null&&(r[0]=i.r/255,r[1]=i.g/255,r[2]=i.b/255,r[3]=i.opacity),r}function Se(e){var i=e&&e[0],r=e&&e[1],n=e&&e[2],t=i+r*256+n*65536-1;return t}function Ae(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function We(e){var i=pa.document.createElement("canvas"),r=i.getContext("2d");i.width=256,i.height=1;var n=null;if(e.weights){var t=0;e.weights.map(function(C,T){var O=e.colors[T]||"rgba(0, 0, 0, 0)",L=t+C;r.fillStyle=O,r.fillRect(t*256,0,L*256,1),t=L})}else{for(var o=r.createLinearGradient(0,0,256,1),u=e.positions[0],l=e.positions[e.positions.length-1],p=0;p<e.colors.length;++p){var v=(e.positions[p]-u)/(l-u);o.addColorStop(v,e.colors[p])}r.fillStyle=o,r.fillRect(0,0,256,1)}if(rs)return n=new Uint8ClampedArray(r.getImageData(0,0,256,1).data),i=null,r=null,{data:n,width:256,height:1};n=r.getImageData(0,0,256,1).data;for(var x=r.createImageData(256,1),E=0;E<x.data.length;E+=4)x.data[E+0]=n[E+0],x.data[E+1]=n[E+1],x.data[E+2]=n[E+2],x.data[E+3]=n[E+3];return i=null,r=null,x}var Ge;(function(e){e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e["BOTTOM-RIGHT"]="bottom-right",e.LEFT="left",e.RIGHT="right"})(Ge||(Ge={}));var ot={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ze(e,i,r){var n=e.classList;for(var t in ot)ot.hasOwnProperty(t)&&n.remove("l7-".concat(r,"-anchor-").concat(t));n.add("l7-".concat(r,"-anchor-").concat(i))}function Xe(e,i){return{enable:e,mask:255,func:{cmp:514,ref:i?1:0,mask:255}}}var de=K(92137),Vt=K(87757),q=K.n(Vt);function or(e,i){if(!e)throw new Error(i||"web worker helper assertion failed.")}var dr={self:typeof self!="undefined"&&self,window:typeof window!="undefined"&&window,document:typeof document!="undefined"&&document},Fr=dr.self||dr.window||{},on=dr.window||dr.self||{},nn=dr.self||dr.window||{},Tn=dr.document||{},ri=typeof importScripts=="function",Jn=typeof window!="undefined"&&typeof window.orientation!="undefined",ii=function(){function e(i,r){var n=this;this.name=i,this.workerThread=r,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise(function(t,o){n.resolve=t,n.reject=o})}return e.prototype.postMessage=function(i,r){this.workerThread.postMessage({source:"Main thread",type:i,payload:r})},e.prototype.done=function(i){or(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(i)},e.prototype.error=function(i){or(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(i)},e}(),Ui=ii,En=new Map;function wi(e){or(e.source&&!e.url||!e.source&&e.url);var i=En.get(e.source||e.url);return i||(e.url&&(i=Ti(e.url),En.set(e.url,i)),e.source&&(i=yi(e.source),En.set(e.source,i))),or(i),i}function Ti(e){if(!e.startsWith("http"))return e;var i=ui(e);return yi(i)}function yi(e){var i=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(i)}function ui(e){return`try {
  importScripts('`+e+`');
} catch (error) {
  console.error(error);
  throw error;
}`}function Mi(e,i,r){i===void 0&&(i=!0);var n=r||new Set;if(e){if(ci(e))n.add(e);else if(ci(e.buffer))n.add(e.buffer);else if(!ArrayBuffer.isView(e)){if(i&&typeof e=="object")for(var t in e)Mi(e[t],i,n)}}return r===void 0?Array.from(n):[]}function ci(e){return e?e instanceof ArrayBuffer||typeof MessagePort!="undefined"&&e instanceof MessagePort||typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap||typeof OffscreenCanvas!="undefined"&&e instanceof OffscreenCanvas:!1}var oi=function(){},Po=function(){function e(i){this.terminated=!1,this.loadableURL="";var r=i.name,n=i.source,t=i.url;or(n||t),this.name=r,this.source=n,this.url=t,this.onMessage=oi,this.onError=function(o){return console.log(o)},this.worker=this.createBrowserWorker()}return e.isSupported=function(){return typeof Worker!="undefined"},e.prototype.destroy=function(){this.onMessage=oi,this.onError=oi,this.worker.terminate(),this.terminated=!0},Object.defineProperty(e.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),e.prototype.postMessage=function(i,r){r=r||Mi(i),this.worker.postMessage(i,r)},e.prototype.getErrorFromErrorEvent=function(i){var r="Failed to load ";return r+="worker "+this.name+" from "+this.url+". ",i.message&&(r+=i.message+" in "),i.lineno&&(r+=":"+i.lineno+":"+i.colno),new Error(r)},e.prototype.createBrowserWorker=function(){var i=this;this.loadableURL=wi({source:this.source,url:this.url});var r=new Worker(this.loadableURL,{name:this.name});return r.onmessage=function(n){n.data?i.onMessage(n.data):i.onError(new Error("No data received"))},r.onerror=function(n){i.onError(i.getErrorFromErrorEvent(n)),i.terminated=!0},r.onmessageerror=function(n){return console.error("worker "+i.name+", message error: "+n)},r},e}(),Qa=Po,So=function(){return So=Object.assign||function(e){for(var i,r=1,n=arguments.length;r<n;r++){i=arguments[r];for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[t]=i[t])}return e},So.apply(this,arguments)},Bo=function(e,i,r,n){function t(o){return o instanceof r?o:new r(function(u){u(o)})}return new(r||(r=Promise))(function(o,u){function l(x){try{v(n.next(x))}catch(E){u(E)}}function p(x){try{v(n.throw(x))}catch(E){u(E)}}function v(x){x.done?o(x.value):t(x.value).then(l,p)}v((n=n.apply(e,i||[])).next())})},Ja=function(e,i){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,t,o,u;return u={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function l(v){return function(x){return p([v,x])}}function p(v){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,t&&(o=v[0]&2?t.return:v[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,v[1])).done)return o;switch(t=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return r.label++,{value:v[1],done:!1};case 5:r.label++,t=v[1],v=[0];continue;case 7:v=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){r=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){r.label=v[1];break}if(v[0]===6&&r.label<o[1]){r.label=o[1],o=v;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(v);break}o[2]&&r.ops.pop(),r.trys.pop();continue}v=i.call(e,r)}catch(x){v=[6,x],t=0}finally{n=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}},yo=function(){function e(i){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=i.source,this.url=i.url,this.setProps(i)}return e.prototype.destroy=function(){this.idleQueue.forEach(function(i){return i.destroy()}),this.isDestroyed=!0},e.prototype.setProps=function(i){this.props=So(So({},this.props),i),i.name!==void 0&&(this.name=i.name),i.maxConcurrency!==void 0&&(this.maxConcurrency=i.maxConcurrency),i.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=i.maxMobileConcurrency),i.reuseWorkers!==void 0&&(this.reuseWorkers=i.reuseWorkers),i.onDebug!==void 0&&(this.onDebug=i.onDebug)},e.prototype.startJob=function(i,r,n){return r===void 0&&(r=function(t,o,u){return t.done(u)}),n===void 0&&(n=function(t,o){return t.error(o)}),Bo(this,void 0,void 0,function(){var t,o=this;return Ja(this,function(u){switch(u.label){case 0:return t=new Promise(function(l){return o.jobQueue.push({name:i,onMessage:r,onError:n,onStart:l}),o}),this.startQueuedJob(),[4,t];case 1:return[2,u.sent()]}})})},e.prototype.startQueuedJob=function(){return Bo(this,void 0,void 0,function(){var i,r,n;return Ja(this,function(t){switch(t.label){case 0:if(!this.jobQueue.length)return[2];if(i=this.getAvailableWorker(),!i)return[2];if(r=this.jobQueue.shift(),!r)return[3,4];this.onDebug({message:"Starting job",name:r.name,backlog:this.jobQueue.length,workerThread:i}),n=new Ui(r.name,i),i.onMessage=function(o){return r.onMessage(n,o.type,o.payload)},i.onError=function(o){return r.onError(n,o)},r.onStart(n),t.label=1;case 1:return t.trys.push([1,,3,4]),[4,n.result];case 2:return t.sent(),[3,4];case 3:return this.returnWorkerToQueue(i),[7];case 4:return[2]}})})},e.prototype.returnWorkerToQueue=function(i){var r=this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency();r?(i.destroy(),this.count--):this.idleQueue.push(i),this.isDestroyed||this.startQueuedJob()},e.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var i=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new Qa({name:i,source:this.source,url:this.url})}return null},e.prototype.getMaxConcurrency=function(){return Jn?this.maxMobileConcurrency:this.maxConcurrency},e}(),Fs=yo,No=function(){return No=Object.assign||function(e){for(var i,r=1,n=arguments.length;r<n;r++){i=arguments[r];for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[t]=i[t])}return e},No.apply(this,arguments)},Iu=function(e){var i=typeof Symbol=="function"&&Symbol.iterator,r=i&&e[i],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")},ys={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},mu=function(){function e(i){this.workerPools=new Map,this.props=No({},ys),this.setProps(i),this.workerPools=new Map}return e.isSupported=function(){return Qa.isSupported()},e.getWorkerFarm=function(i){return i===void 0&&(i={}),e.workerFarm=e.workerFarm||new e({}),e.workerFarm.setProps(i),e.workerFarm},e.prototype.destroy=function(){var i,r;try{for(var n=Iu(this.workerPools.values()),t=n.next();!t.done;t=n.next()){var o=t.value;o.destroy()}}catch(u){i={error:u}}finally{try{t&&!t.done&&(r=n.return)&&r.call(n)}finally{if(i)throw i.error}}},e.prototype.setProps=function(i){var r,n;this.props=No(No({},this.props),i);try{for(var t=Iu(this.workerPools.values()),o=t.next();!o.done;o=t.next()){var u=o.value;u.setProps(this.getWorkerPoolProps())}}catch(l){r={error:l}}finally{try{o&&!o.done&&(n=t.return)&&n.call(t)}finally{if(r)throw r.error}}},e.prototype.getWorkerPool=function(i){var r=i.name,n=i.source,t=i.url,o=this.workerPools.get(r);return o||(o=new Fs({name:r,source:n,url:t}),o.setProps(this.getWorkerPoolProps()),this.workerPools.set(r,o)),o},e.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}},e}(),au=mu,gl=new Map,jl=function(){function e(){}return Object.defineProperty(e,"onmessage",{set:function(i){self.onmessage=function(r){if(!!yl(r)){var n=r.data,t=n.type,o=n.payload;i(t,o)}}},enumerable:!1,configurable:!0}),e.addEventListener=function(i){var r=gl.get(i);r||(r=function(n){if(!!yl(n)){var t=n.data,o=t.type,u=t.payload;i(o,u)}}),self.addEventListener("message",r)},e.removeEventListener=function(i){var r=gl.get(i);gl.delete(i),self.removeEventListener("message",r)},e.postMessage=function(i,r){if(self){var n={source:"Worker thread",type:i,payload:r},t=Mi(r);self.postMessage(n,t)}},e}(),ss=jl;function yl(e){var i=e.type,r=e.data;return i==="message"&&r&&typeof r.source=="string"&&r.source==="Main thread"}function $c(e){return JSON.parse(gu(e))}function gu(e){var i=new Set;return JSON.stringify(e,function(r,n){if(typeof n=="object"&&n!==null){if(i.has(n))try{return JSON.parse(JSON.stringify(n))}catch(t){return}i.add(n)}return n})}function mc(e){return""+e.name}function Gu(e,i){i===void 0&&(i={});var r=i[e.id]||{},n=e.name+".worker.js",t=r.workerUrl;return i._workerType==="test"&&(t=e.module+"/dist/"+n),t||(t="https://unpkg.com/"+e.module+"/dist/"+n),assert(t),t}var wo=function(e,i,r,n){function t(o){return o instanceof r?o:new r(function(u){u(o)})}return new(r||(r=Promise))(function(o,u){function l(x){try{v(n.next(x))}catch(E){u(E)}}function p(x){try{v(n.throw(x))}catch(E){u(E)}}function v(x){x.done?o(x.value):t(x.value).then(l,p)}v((n=n.apply(e,i||[])).next())})},Pu=function(e,i){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,t,o,u;return u={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function l(v){return function(x){return p([v,x])}}function p(v){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,t&&(o=v[0]&2?t.return:v[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,v[1])).done)return o;switch(t=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return r.label++,{value:v[1],done:!1};case 5:r.label++,t=v[1],v=[0];continue;case 7:v=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){r=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){r.label=v[1];break}if(v[0]===6&&r.label<o[1]){r.label=o[1],o=v;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(v);break}o[2]&&r.ops.pop(),r.trys.pop();continue}v=i.call(e,r)}catch(x){v=[6,x],t=0}finally{n=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}};function _l(e,i){return WorkerFarm.isSupported()?e.worker&&(i==null?void 0:i.worker):!1}function xl(e,i,r,n){return r===void 0&&(r={}),n===void 0&&(n={}),wo(this,void 0,void 0,function(){var t,o,u,l,p,v,x,E;return Pu(this,function(C){switch(C.label){case 0:return t=getWorkerName(e),o=getWorkerURL(e,r),u=WorkerFarm.getWorkerFarm(r),l=u.getWorkerPool({name:t,url:o}),p=r.jobName||e.name,[4,l.startJob(p,da.bind(null,n))];case 1:return v=C.sent(),x=removeNontransferableOptions(r),v.postMessage("process",{input:i,options:x}),[4,v.result];case 2:return E=C.sent(),[2,E.result]}})})}function da(e,i,r,n){return wo(this,void 0,void 0,function(){var t,o,u,l,p,v,x;return Pu(this,function(E){switch(E.label){case 0:switch(t=r,t){case"done":return[3,1];case"error":return[3,2];case"process":return[3,3]}return[3,8];case 1:return i.done(n),[3,9];case 2:return i.error(new Error(n.error)),[3,9];case 3:o=n.id,u=n.input,l=n.options,E.label=4;case 4:return E.trys.push([4,6,,7]),e.process?[4,e.process(u,l)]:(i.postMessage("error",{id:o,error:"Worker not set up to process on main thread"}),[2]);case 5:return p=E.sent(),i.postMessage("done",{id:o,result:p}),[3,7];case 6:return v=E.sent(),x=v instanceof Error?v.message:"unknown error",i.postMessage("error",{id:o,error:x}),[3,7];case 7:return[3,9];case 8:console.warn("process-on-worker: unknown message "+r),E.label=9;case 9:return[2]}})})}var Xs=function(){function e(){this._values=[],this._settlers=[],this._closed=!1}return e.prototype[Symbol.asyncIterator]=function(){return this},e.prototype.push=function(i){return this.enqueue(i)},e.prototype.enqueue=function(i){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var r=this._settlers.shift();i instanceof Error?r.reject(i):r.resolve({value:i})}else this._values.push(i)},e.prototype.close=function(){for(;this._settlers.length>0;){var i=this._settlers.shift();i.resolve({done:!0})}this._closed=!0},e.prototype.next=function(){var i=this;if(this._values.length>0){var r=this._values.shift();return r instanceof Error?Promise.reject(r):Promise.resolve({done:!1,value:r})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise(function(n,t){i._settlers.push({resolve:n,reject:t})})},e}(),_s=Xs,Ju=function(e,i,r,n){function t(o){return o instanceof r?o:new r(function(u){u(o)})}return new(r||(r=Promise))(function(o,u){function l(x){try{v(n.next(x))}catch(E){u(E)}}function p(x){try{v(n.throw(x))}catch(E){u(E)}}function v(x){x.done?o(x.value):t(x.value).then(l,p)}v((n=n.apply(e,i||[])).next())})},Yc=function(e,i){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,t,o,u;return u={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function l(v){return function(x){return p([v,x])}}function p(v){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,t&&(o=v[0]&2?t.return:v[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,v[1])).done)return o;switch(t=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return r.label++,{value:v[1],done:!1};case 5:r.label++,t=v[1],v=[0];continue;case 7:v=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){r=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){r.label=v[1];break}if(v[0]===6&&r.label<o[1]){r.label=o[1],o=v;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(v);break}o[2]&&r.ops.pop(),r.trys.pop();continue}v=i.call(e,r)}catch(x){v=[6,x],t=0}finally{n=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}},qc=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=e[Symbol.asyncIterator],r;return i?i.call(e):(e=typeof __values=="function"?__values(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(o){r[o]=e[o]&&function(u){return new Promise(function(l,p){u=e[o](u),t(l,p,u.done,u.value)})}}function t(o,u,l,p){Promise.resolve(p).then(function(v){o({value:v,done:l})},u)}},wf=0,Ps,Gl;function yu(e,i){var r=this;if(typeof self!="undefined"){var n={process:bl};ss.onmessage=function(t,o){return Ju(r,void 0,void 0,function(){var u,l,p,v,x,E,C,T,O,L,B;return Yc(this,function(H){switch(H.label){case 0:switch(H.trys.push([0,19,,20]),u=t,u){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!e)throw new Error("Worker does not support atomic processing");return[4,e(o.input,o.options||{},n)];case 2:return l=H.sent(),ss.postMessage("done",{result:l}),[3,18];case 3:if(!i)throw new Error("Worker does not support batched processing");Ps=new _s,Gl=o.options||{},p=i(Ps,Gl,n),H.label=4;case 4:H.trys.push([4,9,10,15]),v=qc(p),H.label=5;case 5:return[4,v.next()];case 6:if(x=H.sent(),!!x.done)return[3,8];E=x.value,ss.postMessage("output-batch",{result:E}),H.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return C=H.sent(),L={error:C},[3,15];case 10:return H.trys.push([10,,13,14]),x&&!x.done&&(B=v.return)?[4,B.call(v)]:[3,12];case 11:H.sent(),H.label=12;case 12:return[3,14];case 13:if(L)throw L.error;return[7];case 14:return[7];case 15:return ss.postMessage("done",{}),[3,18];case 16:return Ps.push(o.input),[3,18];case 17:return Ps.close(),[3,18];case 18:return[3,20];case 19:return T=H.sent(),O=T instanceof Error?T.message:"",ss.postMessage("error",{error:O}),[3,20];case 20:return[2]}})})}}}function bl(e,i){return i===void 0&&(i={}),new Promise(function(r,n){var t=wf++,o=function(l,p){if(p.id===t)switch(l){case"done":ss.removeEventListener(o),r(p.result);break;case"error":ss.removeEventListener(o),n(p.error);break;default:}};ss.addEventListener(o);var u={id:t,input:e,options:i};ss.postMessage("process",u)})}var gc=function(e,i,r,n){function t(o){return o instanceof r?o:new r(function(u){u(o)})}return new(r||(r=Promise))(function(o,u){function l(x){try{v(n.next(x))}catch(E){u(E)}}function p(x){try{v(n.throw(x))}catch(E){u(E)}}function v(x){x.done?o(x.value):t(x.value).then(l,p)}v((n=n.apply(e,i||[])).next())})},_u=function(e,i){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,t,o,u;return u={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function l(v){return function(x){return p([v,x])}}function p(v){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,t&&(o=v[0]&2?t.return:v[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,v[1])).done)return o;switch(t=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return r.label++,{value:v[1],done:!1};case 5:r.label++,t=v[1],v=[0];continue;case 7:v=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){r=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){r.label=v[1];break}if(v[0]===6&&r.label<o[1]){r.label=o[1],o=v;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(v);break}o[2]&&r.ops.pop(),r.trys.pop();continue}v=i.call(e,r)}catch(x){v=[6,x],t=0}finally{n=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}},Ro={};function Cf(e,i,r){return i===void 0&&(i=null),r===void 0&&(r={}),gc(this,void 0,void 0,function(){return _u(this,function(n){switch(n.label){case 0:return i&&(e=Yf(e,i,r)),Ro[e]=Ro[e]||Oh(e),[4,Ro[e]];case 1:return[2,n.sent()]}})})}function Yf(e,i,r){if(e.startsWith("http"))return e;var n=r.modules||{};return n[e]?n[e]:r.CDN?(assert(r.CDN.startsWith("http")),r.CDN+"/"+i+"/dist/libs/"+e):isWorker?"../src/libs/"+e:"modules/"+i+"/src/libs/"+e}function Oh(e){return gc(this,void 0,void 0,function(){var i,r,n;return _u(this,function(t){switch(t.label){case 0:return e.endsWith("wasm")?[4,fetch(e)]:[3,3];case 1:return i=t.sent(),[4,i.arrayBuffer()];case 2:return[2,t.sent()];case 3:return isWorker?[2,importScripts(e)]:[4,fetch(e)];case 4:return r=t.sent(),[4,r.text()];case 5:return n=t.sent(),[2,qf(n,e)]}})})}function qf(e,i){if(isWorker)return eval.call(global,e),null;var r=document.createElement("script");r.id=i;try{r.appendChild(document.createTextNode(e))}catch(n){r.text=e}return document.body.appendChild(r),null}var qp="0.0.3",Kp={id:"null",name:"null",module:"web-worker-helper",options:{}};function El(e){var i=e.color;return!i||!i.length?[1,1,1,1]:i}function yc(e,i,r){return r.length===2?[r[0],r[1],0]:[r[0],r[1],r[2]]}function Af(e){var i=e.filter;return i?[1]:[0]}function Lh(e,i){return[i]}var Hl=K(9187),Bs=K.n(Hl),Y=K(96156),qr=K(31437),Wl=qr.create(),Qp=qr.create(),us=qr.create(),_c=qr.create(),Kc=qr.create();function Kf(e,i,r,n,t){qr.add(e,r,n),qr.normalize(e,e),i=qr.fromValues(-e[1],e[0]);var o=qr.fromValues(-r[1],r[0]);return[t/qr.dot(i,o),i]}function xc(e,i){return qr.set(e,-i[1],i[0])}function el(e,i,r){return qr.sub(e,i,r),qr.normalize(e,e),e}function lp(e,i){return e[0]===i[0]&&e[1]===i[1]}function $o(e){for(var i=new Map,r=0;r<e.length;r++){var n=e[0].toString()+"-"+e[1].toString();i.get(n)?(e.splice(r,1),r++):i.set(n,n)}return e}var Dh=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,xt.Z)(this,e),(0,Y.Z)(this,"lastFlip",-1),(0,Y.Z)(this,"miter",qr.fromValues(0,0)),(0,Y.Z)(this,"started",!1),(0,Y.Z)(this,"dash",!1),(0,Y.Z)(this,"totalDistance",0),(0,Y.Z)(this,"currentIndex",0),this.join=i.join||"miter",this.cap=i.cap||"butt",this.miterLimit=i.miterLimit||10,this.thickness=i.thickness||1,this.dash=i.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,wt.Z)(e,[{key:"extrude_gaode2",value:function(r,n){var t=this.complex;if(r.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=r.length,u=t.startIndex,l=1;l<o;l++){var p,v,x,E=r[l-1];E.push((p=n[l-1][2])!==null&&p!==void 0?p:0);var C=n[l-1],T=r[l];T.push((v=n[l][2])!==null&&v!==void 0?v:0);var O=n[l],L=l<r.length-1?[].concat((0,N.Z)(r[l+1]),[(x=n[l+1][2])!==null&&x!==void 0?x:0]):null,B=l<n.length-1?n[l+1]:null,H=this.segment_gaode2(t,u,E,T,L,C,O,B);u+=H}if(this.dash)for(var oe=0;oe<t.positions.length/6;oe++)t.positions[oe*6+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"simpleExtrude_gaode2",value:function(r,n){var t=this.complex;if(r.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=r.length,u=t.startIndex,l=1;l<o;l++){var p,v,x,E=r[l-1];E.push((p=n[l-1][2])!==null&&p!==void 0?p:0);var C=n[l-1],T=r[l];T.push((v=n[l][2])!==null&&v!==void 0?v:0);var O=n[l],L=l<r.length-1?[].concat((0,N.Z)(r[l+1]),[(x=n[l+1][2])!==null&&x!==void 0?x:0]):null,B=l<n.length-1?n[l+1]:null,H=this.simpleSegment(t,u,E,T,L,C,O,B);u+=H}if(this.dash)for(var oe=0;oe<t.positions.length/6;oe++)t.positions[oe*6+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"extrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var t=r.length,o=n.startIndex,u=1;u<t;u++){var l=r[u-1],p=r[u],v=u<r.length-1?r[u+1]:null,x=this.segment(n,o,l,p,v);o+=x}if(this.dash)for(var E=0;E<n.positions.length/6;E++)n.positions[E*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var t=r.length,o=n.startIndex,u=1;u<t;u++){var l=r[u-1],p=r[u],v=u<r.length-1?r[u+1]:null,x=this.simpleSegment(n,o,l,p,v);o+=x}if(this.dash)for(var E=0;E<n.positions.length/6;E++)n.positions[E*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(r,n,t,o,u,l,p,v){var x=0,E=r.indices,C=r.positions,T=r.normals,O=this.cap==="square",L=this.join==="bevel",B=Eo([p[0],p[1]]),H=Eo([l[0],l[1]]);el(us,o,t);var oe=0;if(this.dash&&(oe=this.lineSegmentDistance(B,H),this.totalDistance+=oe),this.normal||(this.normal=qr.create(),xc(this.normal,us)),!this.started)if(this.started=!0,O){var le=qr.create(),Re=qr.create();qr.add(le,this.normal,us),qr.add(Re,this.normal,us),T.push(Re[0],Re[1],0),T.push(le[0],le[1],0),C.push(t[0],t[1],t[2]|0,this.totalDistance-oe,-this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),C.push(t[0],t[1],t[2]|0,this.totalDistance-oe,this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(C,T,t,this.normal,this.thickness,this.totalDistance-oe);if(E.push(n+0,n+1,n+2),u){lp(o,u)&&qr.add(u,o,qr.normalize(u,qr.subtract(u,o,t))),el(_c,u,o);var Ot=Kf(Kc,qr.create(),us,_c,this.thickness),Nt=(0,hr.Z)(Ot,2),jt=Nt[0],br=Nt[1],yr=qr.dot(Kc,this.normal)<0?-1:1,Ur=L;if(!Ur&&this.join==="miter"){var An=jt;An>this.miterLimit&&(Ur=!0)}Ur?(T.push(this.normal[0],this.normal[1],0),T.push(br[0],br[1],0),C.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*yr,o[2]|0),this.complex.indexes.push(this.currentIndex),C.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*yr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,E.push.apply(E,(0,N.Z)(this.lastFlip!==-yr?[n,n+2,n+3]:[n+2,n+1,n+3])),E.push(n+2,n+3,n+4),xc(Wl,_c),qr.copy(this.normal,Wl),T.push(this.normal[0],this.normal[1],0),C.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*yr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,x+=3):(this.extrusions(C,T,o,br,jt,this.totalDistance),E.push.apply(E,(0,N.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),yr=-1,qr.copy(this.normal,br),x+=2),this.lastFlip=yr}else{if(xc(this.normal,us),O){var Ne=qr.create(),ut=qr.create();qr.sub(ut,us,this.normal),qr.add(Ne,us,this.normal),T.push(ut[0],ut[1],0),T.push(Ne[0],Ne[1],0),C.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),C.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(C,T,o,this.normal,this.thickness,this.totalDistance);E.push.apply(E,(0,N.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),x+=2}return x}},{key:"simpleSegment",value:function(r,n,t,o,u){var l=0,p=r.indices,v=r.positions,x=r.normals,E=Eo([o[0],o[1]]),C=Eo([t[0],t[1]]);el(us,E,C);var T=0;if(this.dash&&(T=this.lineSegmentDistance(E,C),this.totalDistance+=T),this.normal||(this.normal=qr.create(),xc(this.normal,us)),this.started||(this.started=!0,this.extrusions(v,x,t,this.normal,this.thickness,this.totalDistance-T)),p.push(n+0,n+1,n+2),!u)xc(this.normal,us),this.extrusions(v,x,o,this.normal,this.thickness,this.totalDistance),p.push.apply(p,(0,N.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2;else{var O=Eo([u[0],u[1]]);lp(E,O)&&qr.add(O,E,qr.normalize(O,qr.subtract(O,E,C))),el(_c,O,E);var L=Kf(Kc,qr.create(),us,_c,this.thickness),B=(0,hr.Z)(L,2),H=B[0],oe=B[1],le=qr.dot(Kc,this.normal)<0?-1:1;this.extrusions(v,x,o,oe,H,this.totalDistance),p.push.apply(p,(0,N.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),le=-1,qr.copy(this.normal,oe),l+=2,this.lastFlip=le}return l}},{key:"segment",value:function(r,n,t,o,u){var l=0,p=r.indices,v=r.positions,x=r.normals,E=this.cap==="square",C=this.join==="bevel",T=Eo([o[0],o[1]]),O=Eo([t[0],t[1]]);el(us,T,O);var L=0;if(this.dash&&(L=this.lineSegmentDistance(T,O),this.totalDistance+=L),this.normal||(this.normal=qr.create(),xc(this.normal,us)),!this.started)if(this.started=!0,E){var B=qr.create(),H=qr.create();qr.add(B,this.normal,us),qr.add(H,this.normal,us),x.push(H[0],H[1],0),x.push(B[0],B[1],0),v.push(t[0],t[1],t[2]|0,this.totalDistance-L,-this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),v.push(t[0],t[1],t[2]|0,this.totalDistance-L,this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(v,x,t,this.normal,this.thickness,this.totalDistance-L);if(p.push(n+0,n+1,n+2),u){var Re=Eo([u[0],u[1]]);lp(T,Re)&&qr.add(Re,T,qr.normalize(Re,qr.subtract(Re,T,O))),el(_c,Re,T);var Ne=Kf(Kc,qr.create(),us,_c,this.thickness),ut=(0,hr.Z)(Ne,2),Ot=ut[0],Nt=ut[1],jt=qr.dot(Kc,this.normal)<0?-1:1,br=C;if(!br&&this.join==="miter"){var yr=Ot;yr>this.miterLimit&&(br=!0)}br?(x.push(this.normal[0],this.normal[1],0),x.push(Nt[0],Nt[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*jt,o[2]|0),this.complex.indexes.push(this.currentIndex),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*jt,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,p.push.apply(p,(0,N.Z)(this.lastFlip!==-jt?[n,n+2,n+3]:[n+2,n+1,n+3])),p.push(n+2,n+3,n+4),xc(Wl,_c),qr.copy(this.normal,Wl),x.push(this.normal[0],this.normal[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*jt,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l+=3):(this.extrusions(v,x,o,Nt,Ot,this.totalDistance),p.push.apply(p,(0,N.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),jt=-1,qr.copy(this.normal,Nt),l+=2),this.lastFlip=jt}else{if(xc(this.normal,us),E){var oe=qr.create(),le=qr.create();qr.sub(le,us,this.normal),qr.add(oe,us,this.normal),x.push(le[0],le[1],0),x.push(oe[0],oe[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(v,x,o,this.normal,this.thickness,this.totalDistance);p.push.apply(p,(0,N.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2}return l}},{key:"extrusions",value:function(r,n,t,o,u,l){n.push(o[0],o[1],0),n.push(o[0],o[1],0),r.push(t[0],t[1],t[2]|0,l,-u,t[2]|0),this.complex.indexes.push(this.currentIndex),r.push(t[0],t[1],t[2]|0,l,u,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(r,n){var t=n[0]-r[0],o=n[1]-r[1];return Math.sqrt(t*t+o*o)}}]),e}();function Fh(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,t=new Dh({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var o=i;Array.isArray(o[0][0])||(o=[i]);var u=r;Array.isArray(u[0][0])||(u=[r]);for(var l=0;l<o.length;l++){var p=o[l],v=u[l];t.extrude_gaode2(p,v)}}else{var x=i;x[0]&&!Array.isArray(x[0][0])&&(x=[i]),x.forEach(function(C){t.extrude(C)})}var E=t.complex;return{vertices:E.positions,indices:E.indices,normals:E.normals,indexes:E.indexes,size:6}}function Qc(e){var i=h(e.coordinates);return{vertices:[].concat((0,N.Z)(i),(0,N.Z)(i),(0,N.Z)(i),(0,N.Z)(i)),indices:[0,1,2,2,3,0],size:i.length}}function Qf(e){var i=e.coordinates,r=Bs().flatten(i),n=r.vertices,t=r.dimensions,o=r.holes;return{indices:Bs()(n,o,t),vertices:n,size:t}}var Jf=function(){var e=(0,de.Z)(q().mark(function i(r){var n,t,o,u,l,p,v,x,E;return q().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return n=r.descriptors,t=r.features,o=r.enablePicking,u=r.iconMap,l={a_Color:El,a_Position:yc,filter:Af,a_vertexId:Lh,a_PickingColor:function(L){var B=L.id;return o?Ae(B):[0,0,0]},a_DistanceAndIndex:function(L,B,H,oe,le,Re){return Re===void 0?[H[3],10]:[H[3],Re]},a_Total_Distance:function(L,B,H){return[H[5]]},a_Size:function(L){var B=L.size,H=B===void 0?1:B;return Array.isArray(H)?[H[0],H[1]]:[H,0]},a_Normal:function(L,B,H,oe,le){return le},a_Miter:function(L,B,H){return[H[4]]},a_iconMapUV:function(L){var B=L.texture,H=u[B]||{x:0,y:0},oe=H.x,le=H.y;return[oe,le]}},p={sizePerElement:0,elements:[]},v=0,x=[],E=3,t.forEach(function(O,L){var B=Fh(O),H=B.indices,oe=B.vertices,le=B.normals,Re=B.size,Ne=B.indexes;H.forEach(function(jt){x.push(jt+v)}),E=Re;var ut=oe.length/Re;p.sizePerElement=E,p.elements.push({featureIdx:L,vertices:oe,normals:le,offset:v}),v+=ut;for(var Ot=function(br){var yr=(le==null?void 0:le.slice(br*3,br*3+3))||[],Ur=oe.slice(br*Re,br*Re+Re),An=0;Ne&&Ne[br]!==void 0&&(An=Ne[br]),n.forEach(function(jn){if(jn&&l[jn.name]){var Qi;(Qi=jn.buffer.data).push.apply(Qi,(0,N.Z)(l[jn.name](O,L,Ur,br,yr,An)))}})},Nt=0;Nt<ut;Nt++)Ot(Nt)}),T.abrupt("return",{descriptors:n,featureLayout:p,indices:x});case 8:case"end":return T.stop()}},i)}));return function(r){return e.apply(this,arguments)}}(),Bh=function(){var e=(0,de.Z)(q().mark(function i(r){var n,t,o,u,l,p,v,x,E;return q().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return n=r.descriptors,t=r.features,o=r.enablePicking,u=r.shape2d,l={a_Color:El,a_Position:yc,filter:Af,a_vertexId:Lh,a_PickingColor:function(L){var B=L.id;return o?Ae(B):[0,0,0]},a_Shape:function(L){var B=L.shape,H=B===void 0?2:B,oe=u.indexOf(H);return[oe]},a_Extrude:function(L,B,H,oe){var le=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],Re=oe%4*3;return[le[Re],le[Re+1],le[Re+2]]},a_Size:function(L){var B=L.size,H=B===void 0?5:B;return Array.isArray(H)?[H[0]]:[H]}},p={sizePerElement:0,elements:[]},v=0,x=[],E=3,t.forEach(function(O,L){var B=Qc(O),H=B.indices,oe=B.vertices,le=B.normals,Re=B.size,Ne=B.indexes;H.forEach(function(jt){x.push(jt+v)}),E=Re;var ut=oe.length/Re;p.sizePerElement=E,p.elements.push({featureIdx:L,vertices:oe,normals:le,offset:v}),v+=ut;for(var Ot=function(br){var yr=(le==null?void 0:le.slice(br*3,br*3+3))||[],Ur=oe.slice(br*Re,br*Re+Re),An=0;Ne&&Ne[br]!==void 0&&(An=Ne[br]),n.forEach(function(jn){if(jn&&l[jn.name]){var Qi;(Qi=jn.buffer.data).push.apply(Qi,(0,N.Z)(l[jn.name](O,L,Ur,br,yr,An)))}})},Nt=0;Nt<ut;Nt++)Ot(Nt)}),T.abrupt("return",{descriptors:n,featureLayout:p,indices:x});case 8:case"end":return T.stop()}},i)}));return function(r){return e.apply(this,arguments)}}(),eh=function(){var e=(0,de.Z)(q().mark(function i(r){var n,t,o,u,l,p,v,x;return q().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return n=r.descriptors,t=r.features,o=r.enablePicking,u={a_Color:El,a_Position:yc,filter:Af,a_vertexId:Lh,a_PickingColor:function(O){var L=O.id;return o?Ae(L):[0,0,0]}},l={sizePerElement:0,elements:[]},p=0,v=[],x=3,t.forEach(function(T,O){var L=Qf(T),B=L.indices,H=L.vertices,oe=L.normals,le=L.size,Re=L.indexes;B.forEach(function(Nt){v.push(Nt+p)}),x=le;var Ne=H.length/le;l.sizePerElement=x,l.elements.push({featureIdx:O,vertices:H,normals:oe,offset:p}),p+=Ne;for(var ut=function(jt){var br=(oe==null?void 0:oe.slice(jt*3,jt*3+3))||[],yr=H.slice(jt*le,jt*le+le),Ur=0;Re&&Re[jt]!==void 0&&(Ur=Re[jt]),n.forEach(function(An){if(An&&u[An.name]){var jn;(jn=An.buffer.data).push.apply(jn,(0,N.Z)(u[An.name](T,O,yr,jt,br,Ur)))}})},Ot=0;Ot<Ne;Ot++)ut(Ot)}),C.abrupt("return",{descriptors:n,featureLayout:l,indices:v});case 8:case"end":return C.stop()}},i)}));return function(r){return e.apply(this,arguments)}}(),Xl={pointFill:Bh,line:Jf,polygonFill:eh},Jc=(0,z.Z)({},Xl);function th(e){return Tf.apply(this,arguments)}function Tf(){return Tf=(0,de.Z)(q().mark(function e(i){var r,n;return q().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(r=i.workerType,n=i.data,!Jc[r]){o.next=3;break}return o.abrupt("return",Jc[r](n));case 3:return o.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(r,'" non-existent.'))));case 4:case"end":return o.stop()}},e)})),Tf.apply(this,arguments)}yu(th);var $l=new Map;function Nh(e,i){$l.set(e,i)}function rh(e){var i=$l.get(e);return i}var zh=`var L7=function(t){"use strict";function e(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function r(){r=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function f(t,e,r,n){var i=e&&e.prototype instanceof p?e:p,a=Object.create(i.prototype),u=new T(n||[]);return o(a,"_invoke",{value:E(t,r,u)}),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=f;var h={};function p(){}function v(){}function d(){}var y={};c(y,a,(function(){return this}));var g=Object.getPrototypeOf,m=g&&g(g(k([])));m&&m!==e&&n.call(m,a)&&(y=m);var x=d.prototype=p.prototype=Object.create(y);function b(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){var r;o(this,"_invoke",{value:function(o,i){function a(){return new e((function(r,a){!function r(o,i,a,u){var s=l(t[o],t,i);if("throw"!==s.type){var c=s.arg,f=c.value;return f&&"object"==typeof f&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(f).then((function(t){c.value=t,a(c)}),(function(t){return r("throw",t,a,u)}))}u(s.arg)}(o,i,r,a)}))}return r=r?r.then(a,a):a()}})}function E(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return I()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var u=A(a,r);if(u){if(u===h)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var s=l(t,e,r);if("normal"===s.type){if(n=r.done?"completed":"suspendedYield",s.arg===h)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(n="completed",r.method="throw",r.arg=s.arg)}}}function A(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,A(t,e),"throw"===e.method))return h;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return h}var n=l(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,h;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,h):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,h)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function S(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function k(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:I}}function I(){return{value:void 0,done:!0}}return v.prototype=d,o(x,"constructor",{value:d,configurable:!0}),o(d,"constructor",{value:v,configurable:!0}),v.displayName=c(d,s,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,c(t,s,"GeneratorFunction")),t.prototype=Object.create(x),t},t.awrap=function(t){return{__await:t}},b(w.prototype),c(w.prototype,u,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(f(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},b(x),c(x,s,"Generator"),c(x,a,(function(){return this})),c(x,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},t.values=k,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(u&&s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,h):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),S(r),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;S(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:k(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),h}},t}function n(t,e,r,n,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void r(t)}u.done?e(s):Promise.resolve(s).then(n,o)}function o(t){return function(){var e=this,r=arguments;return new Promise((function(o,i){var a=t.apply(e,r);function u(t){n(a,o,i,u,s,"next",t)}function s(t){n(a,o,i,u,s,"throw",t)}u(void 0)}))}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function u(t,e,r){return e&&a(t.prototype,e),r&&a(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&l(t,e)}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function l(t,e){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function h(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function p(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return h(t)}function v(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=f(t);if(e){var o=f(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return p(this,r)}}function d(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==r)return;var n,o,i=[],a=!0,u=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(i.push(n.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==r.return||r.return()}finally{if(u)throw o}}return i}(t,e)||g(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(t){return function(t){if(Array.isArray(t))return m(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||g(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(t,e){if(t){if("string"==typeof t)return m(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?m(t,e):void 0}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var x="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function b(t,e){return t(e={exports:{}},e.exports),e.exports}var w,E,A=function(t){return t&&t.Math==Math&&t},O=A("object"==typeof globalThis&&globalThis)||A("object"==typeof window&&window)||A("object"==typeof self&&self)||A("object"==typeof x&&x)||function(){return this}()||Function("return this")(),S=Object.defineProperty,T=function(t,e){try{S(O,t,{value:e,configurable:!0,writable:!0})}catch(r){O[t]=e}return e},k=O["__core-js_shared__"]||T("__core-js_shared__",{}),I=b((function(t){(t.exports=function(t,e){return k[t]||(k[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.26.1",mode:"global",copyright:"\xA9 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.26.1/LICENSE",source:"https://github.com/zloirock/core-js"})})),j=function(t){try{return!!t()}catch(t){return!0}},P=!j((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})),_=Function.prototype,M=_.call,L=P&&_.bind.bind(M,M),R=P?L:function(t){return function(){return M.apply(t,arguments)}},C=function(t){return null==t},N=TypeError,D=function(t){if(C(t))throw N("Can't call method on "+t);return t},F=Object,W=function(t){return F(D(t))},z=R({}.hasOwnProperty),B=Object.hasOwn||function(t,e){return z(W(t),e)},U=0,G=Math.random(),H=R(1..toString),V=function(t){return"Symbol("+(void 0===t?"":t)+")_"+H(++U+G,36)},q="object"==typeof document&&document.all,Z={all:q,IS_HTMLDDA:void 0===q&&void 0!==q},Y=Z.all,$=Z.IS_HTMLDDA?function(t){return"function"==typeof t||t===Y}:function(t){return"function"==typeof t},K=function(t){return $(t)?t:void 0},Q=function(t,e){return arguments.length<2?K(O[t]):O[t]&&O[t][e]},X=Q("navigator","userAgent")||"",J=O.process,tt=O.Deno,et=J&&J.versions||tt&&tt.version,rt=et&&et.v8;rt&&(E=(w=rt.split("."))[0]>0&&w[0]<4?1:+(w[0]+w[1])),!E&&X&&(!(w=X.match(/Edge\\/(\\d+)/))||w[1]>=74)&&(w=X.match(/Chrome\\/(\\d+)/))&&(E=+w[1]);var nt=E,ot=!!Object.getOwnPropertySymbols&&!j((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&nt&&nt<41})),it=ot&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,at=I("wks"),ut=O.Symbol,st=ut&&ut.for,ct=it?ut:ut&&ut.withoutSetter||V,ft=function(t){if(!B(at,t)||!ot&&"string"!=typeof at[t]){var e="Symbol."+t;ot&&B(ut,t)?at[t]=ut[t]:at[t]=it&&st?st(e):ct(e)}return at[t]},lt={};lt[ft("toStringTag")]="z";var ht="[object z]"===String(lt),pt=!j((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),vt=Z.all,dt=Z.IS_HTMLDDA?function(t){return"object"==typeof t?null!==t:$(t)||t===vt}:function(t){return"object"==typeof t?null!==t:$(t)},yt=O.document,gt=dt(yt)&&dt(yt.createElement),mt=function(t){return gt?yt.createElement(t):{}},xt=!pt&&!j((function(){return 7!=Object.defineProperty(mt("div"),"a",{get:function(){return 7}}).a})),bt=pt&&j((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),wt=String,Et=TypeError,At=function(t){if(dt(t))return t;throw Et(wt(t)+" is not an object")},Ot=Function.prototype.call,St=P?Ot.bind(Ot):function(){return Ot.apply(Ot,arguments)},Tt=R({}.isPrototypeOf),kt=Object,It=it?function(t){return"symbol"==typeof t}:function(t){var e=Q("Symbol");return $(e)&&Tt(e.prototype,kt(t))},jt=String,Pt=function(t){try{return jt(t)}catch(t){return"Object"}},_t=TypeError,Mt=function(t){if($(t))return t;throw _t(Pt(t)+" is not a function")},Lt=function(t,e){var r=t[e];return C(r)?void 0:Mt(r)},Rt=TypeError,Ct=TypeError,Nt=ft("toPrimitive"),Dt=function(t,e){if(!dt(t)||It(t))return t;var r,n=Lt(t,Nt);if(n){if(void 0===e&&(e="default"),r=St(n,t,e),!dt(r)||It(r))return r;throw Ct("Can't convert object to primitive value")}return void 0===e&&(e="number"),function(t,e){var r,n;if("string"===e&&$(r=t.toString)&&!dt(n=St(r,t)))return n;if($(r=t.valueOf)&&!dt(n=St(r,t)))return n;if("string"!==e&&$(r=t.toString)&&!dt(n=St(r,t)))return n;throw Rt("Can't convert object to primitive value")}(t,e)},Ft=function(t){var e=Dt(t,"string");return It(e)?e:e+""},Wt=TypeError,zt=Object.defineProperty,Bt=Object.getOwnPropertyDescriptor,Ut={f:pt?bt?function(t,e,r){if(At(t),e=Ft(e),At(r),"function"==typeof t&&"prototype"===e&&"value"in r&&"writable"in r&&!r.writable){var n=Bt(t,e);n&&n.writable&&(t[e]=r.value,r={configurable:"configurable"in r?r.configurable:n.configurable,enumerable:"enumerable"in r?r.enumerable:n.enumerable,writable:!1})}return zt(t,e,r)}:zt:function(t,e,r){if(At(t),e=Ft(e),At(r),xt)try{return zt(t,e,r)}catch(t){}if("get"in r||"set"in r)throw Wt("Accessors not supported");return"value"in r&&(t[e]=r.value),t}},Gt=Function.prototype,Ht=pt&&Object.getOwnPropertyDescriptor,Vt=B(Gt,"name"),qt={EXISTS:Vt,PROPER:Vt&&"something"===function(){}.name,CONFIGURABLE:Vt&&(!pt||pt&&Ht(Gt,"name").configurable)},Zt=R(Function.toString);$(k.inspectSource)||(k.inspectSource=function(t){return Zt(t)});var Yt,$t,Kt,Qt=k.inspectSource,Xt=O.WeakMap,Jt=$(Xt)&&/native code/.test(String(Xt)),te=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},ee=pt?function(t,e,r){return Ut.f(t,e,te(1,r))}:function(t,e,r){return t[e]=r,t},re=I("keys"),ne=function(t){return re[t]||(re[t]=V(t))},oe={},ie=O.TypeError,ae=O.WeakMap;if(Jt||k.state){var ue=k.state||(k.state=new ae);ue.get=ue.get,ue.has=ue.has,ue.set=ue.set,Yt=function(t,e){if(ue.has(t))throw ie("Object already initialized");return e.facade=t,ue.set(t,e),e},$t=function(t){return ue.get(t)||{}},Kt=function(t){return ue.has(t)}}else{var se=ne("state");oe[se]=!0,Yt=function(t,e){if(B(t,se))throw ie("Object already initialized");return e.facade=t,ee(t,se,e),e},$t=function(t){return B(t,se)?t[se]:{}},Kt=function(t){return B(t,se)}}var ce={set:Yt,get:$t,has:Kt,enforce:function(t){return Kt(t)?$t(t):Yt(t,{})},getterFor:function(t){return function(e){var r;if(!dt(e)||(r=$t(e)).type!==t)throw ie("Incompatible receiver, "+t+" required");return r}}},fe=b((function(t){var e=qt.CONFIGURABLE,r=ce.enforce,n=ce.get,o=Object.defineProperty,i=pt&&!j((function(){return 8!==o((function(){}),"length",{value:8}).length})),a=String(String).split("String"),u=t.exports=function(t,n,u){"Symbol("===String(n).slice(0,7)&&(n="["+String(n).replace(/^Symbol\\(([^)]*)\\)/,"$1")+"]"),u&&u.getter&&(n="get "+n),u&&u.setter&&(n="set "+n),(!B(t,"name")||e&&t.name!==n)&&(pt?o(t,"name",{value:n,configurable:!0}):t.name=n),i&&u&&B(u,"arity")&&t.length!==u.arity&&o(t,"length",{value:u.arity});try{u&&B(u,"constructor")&&u.constructor?pt&&o(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}var s=r(t);return B(s,"source")||(s.source=a.join("string"==typeof n?n:"")),t};Function.prototype.toString=u((function(){return $(this)&&n(this).source||Qt(this)}),"toString")})),le=function(t,e,r,n){n||(n={});var o=n.enumerable,i=void 0!==n.name?n.name:e;if($(r)&&fe(r,i,n),n.global)o?t[e]=r:T(e,r);else{try{n.unsafe?t[e]&&(o=!0):delete t[e]}catch(t){}o?t[e]=r:Ut.f(t,e,{value:r,enumerable:!1,configurable:!n.nonConfigurable,writable:!n.nonWritable})}return t},he=R({}.toString),pe=R("".slice),ve=function(t){return pe(he(t),8,-1)},de=ft("toStringTag"),ye=Object,ge="Arguments"==ve(function(){return arguments}()),me=ht?ve:function(t){var e,r,n;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=function(t,e){try{return t[e]}catch(t){}}(e=ye(t),de))?r:ge?ve(e):"Object"==(n=ve(e))&&$(e.callee)?"Arguments":n},xe=ht?{}.toString:function(){return"[object "+me(this)+"]"};ht||le(Object.prototype,"toString",xe,{unsafe:!0});var be={}.propertyIsEnumerable,we=Object.getOwnPropertyDescriptor,Ee={f:we&&!be.call({1:2},1)?function(t){var e=we(this,t);return!!e&&e.enumerable}:be},Ae=Object,Oe=R("".split),Se=j((function(){return!Ae("z").propertyIsEnumerable(0)}))?function(t){return"String"==ve(t)?Oe(t,""):Ae(t)}:Ae,Te=function(t){return Se(D(t))},ke=Object.getOwnPropertyDescriptor,Ie={f:pt?ke:function(t,e){if(t=Te(t),e=Ft(e),xt)try{return ke(t,e)}catch(t){}if(B(t,e))return te(!St(Ee.f,t,e),t[e])}},je=Math.ceil,Pe=Math.floor,_e=Math.trunc||function(t){var e=+t;return(e>0?Pe:je)(e)},Me=function(t){var e=+t;return e!=e||0===e?0:_e(e)},Le=Math.max,Re=Math.min,Ce=function(t,e){var r=Me(t);return r<0?Le(r+e,0):Re(r,e)},Ne=Math.min,De=function(t){return t>0?Ne(Me(t),9007199254740991):0},Fe=function(t){return De(t.length)},We=function(t){return function(e,r,n){var o,i=Te(e),a=Fe(i),u=Ce(n,a);if(t&&r!=r){for(;a>u;)if((o=i[u++])!=o)return!0}else for(;a>u;u++)if((t||u in i)&&i[u]===r)return t||u||0;return!t&&-1}},ze={includes:We(!0),indexOf:We(!1)},Be=ze.indexOf,Ue=R([].push),Ge=function(t,e){var r,n=Te(t),o=0,i=[];for(r in n)!B(oe,r)&&B(n,r)&&Ue(i,r);for(;e.length>o;)B(n,r=e[o++])&&(~Be(i,r)||Ue(i,r));return i},He=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Ve=He.concat("length","prototype"),qe={f:Object.getOwnPropertyNames||function(t){return Ge(t,Ve)}},Ze={f:Object.getOwnPropertySymbols},Ye=R([].concat),$e=Q("Reflect","ownKeys")||function(t){var e=qe.f(At(t)),r=Ze.f;return r?Ye(e,r(t)):e},Ke=function(t,e,r){for(var n=$e(e),o=Ut.f,i=Ie.f,a=0;a<n.length;a++){var u=n[a];B(t,u)||r&&B(r,u)||o(t,u,i(e,u))}},Qe=/#|\\.prototype\\./,Xe=function(t,e){var r=tr[Je(t)];return r==rr||r!=er&&($(e)?j(e):!!e)},Je=Xe.normalize=function(t){return String(t).replace(Qe,".").toLowerCase()},tr=Xe.data={},er=Xe.NATIVE="N",rr=Xe.POLYFILL="P",nr=Xe,or=Ie.f,ir=function(t,e){var r,n,o,i,a,u=t.target,s=t.global,c=t.stat;if(r=s?O:c?O[u]||T(u,{}):(O[u]||{}).prototype)for(n in e){if(i=e[n],o=t.dontCallGetSet?(a=or(r,n))&&a.value:r[n],!nr(s?n:u+(c?".":"#")+n,t.forced)&&void 0!==o){if(typeof i==typeof o)continue;Ke(i,o)}(t.sham||o&&o.sham)&&ee(i,"sham",!0),le(r,n,i,t)}},ar="process"==ve(O.process),ur=String,sr=TypeError,cr=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,r={};try{(t=R(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(r,[]),e=r instanceof Array}catch(t){}return function(r,n){return At(r),function(t){if("object"==typeof t||$(t))return t;throw sr("Can't set "+ur(t)+" as a prototype")}(n),e?t(r,n):r.__proto__=n,r}}():void 0),fr=Ut.f,lr=ft("toStringTag"),hr=function(t,e,r){t&&!r&&(t=t.prototype),t&&!B(t,lr)&&fr(t,lr,{configurable:!0,value:e})},pr=ft("species"),vr=function(t){var e=Q(t),r=Ut.f;pt&&e&&!e[pr]&&r(e,pr,{configurable:!0,get:function(){return this}})},dr=TypeError,yr=function(t,e){if(Tt(e,t))return t;throw dr("Incorrect invocation")},gr=function(){},mr=[],xr=Q("Reflect","construct"),br=/^\\s*(?:class|function)\\b/,wr=R(br.exec),Er=!br.exec(gr),Ar=function(t){if(!$(t))return!1;try{return xr(gr,mr,t),!0}catch(t){return!1}},Or=function(t){if(!$(t))return!1;switch(me(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Er||!!wr(br,Qt(t))}catch(t){return!0}};Or.sham=!0;var Sr,Tr,kr,Ir,jr=!xr||j((function(){var t;return Ar(Ar.call)||!Ar(Object)||!Ar((function(){t=!0}))||t}))?Or:Ar,Pr=TypeError,_r=function(t){if(jr(t))return t;throw Pr(Pt(t)+" is not a constructor")},Mr=ft("species"),Lr=function(t,e){var r,n=At(t).constructor;return void 0===n||C(r=At(n)[Mr])?e:_r(r)},Rr=Function.prototype,Cr=Rr.apply,Nr=Rr.call,Dr="object"==typeof Reflect&&Reflect.apply||(P?Nr.bind(Cr):function(){return Nr.apply(Cr,arguments)}),Fr=function(t){if("Function"===ve(t))return R(t)},Wr=Fr(Fr.bind),zr=function(t,e){return Mt(t),void 0===e?t:P?Wr(t,e):function(){return t.apply(e,arguments)}},Br=Q("document","documentElement"),Ur=R([].slice),Gr=TypeError,Hr=function(t,e){if(t<e)throw Gr("Not enough arguments");return t},Vr=/(?:ipad|iphone|ipod).*applewebkit/i.test(X),qr=O.setImmediate,Zr=O.clearImmediate,Yr=O.process,$r=O.Dispatch,Kr=O.Function,Qr=O.MessageChannel,Xr=O.String,Jr=0,tn={};try{Sr=O.location}catch(t){}var en=function(t){if(B(tn,t)){var e=tn[t];delete tn[t],e()}},rn=function(t){return function(){en(t)}},nn=function(t){en(t.data)},on=function(t){O.postMessage(Xr(t),Sr.protocol+"//"+Sr.host)};qr&&Zr||(qr=function(t){Hr(arguments.length,1);var e=$(t)?t:Kr(t),r=Ur(arguments,1);return tn[++Jr]=function(){Dr(e,void 0,r)},Tr(Jr),Jr},Zr=function(t){delete tn[t]},ar?Tr=function(t){Yr.nextTick(rn(t))}:$r&&$r.now?Tr=function(t){$r.now(rn(t))}:Qr&&!Vr?(Ir=(kr=new Qr).port2,kr.port1.onmessage=nn,Tr=zr(Ir.postMessage,Ir)):O.addEventListener&&$(O.postMessage)&&!O.importScripts&&Sr&&"file:"!==Sr.protocol&&!j(on)?(Tr=on,O.addEventListener("message",nn,!1)):Tr="onreadystatechange"in mt("script")?function(t){Br.appendChild(mt("script")).onreadystatechange=function(){Br.removeChild(this),en(t)}}:function(t){setTimeout(rn(t),0)});var an,un,sn,cn,fn,ln,hn,pn,vn={set:qr,clear:Zr},dn=/ipad|iphone|ipod/i.test(X)&&void 0!==O.Pebble,yn=/web0s(?!.*chrome)/i.test(X),gn=Ie.f,mn=vn.set,xn=O.MutationObserver||O.WebKitMutationObserver,bn=O.document,wn=O.process,En=O.Promise,An=gn(O,"queueMicrotask"),On=An&&An.value;On||(an=function(){var t,e;for(ar&&(t=wn.domain)&&t.exit();un;){e=un.fn,un=un.next;try{e()}catch(t){throw un?cn():sn=void 0,t}}sn=void 0,t&&t.enter()},Vr||ar||yn||!xn||!bn?!dn&&En&&En.resolve?((hn=En.resolve(void 0)).constructor=En,pn=zr(hn.then,hn),cn=function(){pn(an)}):ar?cn=function(){wn.nextTick(an)}:(mn=zr(mn,O),cn=function(){mn(an)}):(fn=!0,ln=bn.createTextNode(""),new xn(an).observe(ln,{characterData:!0}),cn=function(){ln.data=fn=!fn}));var Sn=On||function(t){var e={fn:t,next:void 0};sn&&(sn.next=e),un||(un=e,cn()),sn=e},Tn=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},kn=function(){this.head=null,this.tail=null};kn.prototype={add:function(t){var e={item:t,next:null};this.head?this.tail.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return this.head=t.next,this.tail===t&&(this.tail=null),t.item}};var In,jn,Pn,_n=kn,Mn=O.Promise,Ln="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,Rn=!Ln&&!ar&&"object"==typeof window&&"object"==typeof document,Cn=(Mn&&Mn.prototype,ft("species")),Nn=!1,Dn=$(O.PromiseRejectionEvent),Fn={CONSTRUCTOR:nr("Promise",(function(){var t=Qt(Mn),e=t!==String(Mn);if(!e&&66===nt)return!0;if(!nt||nt<51||!/native code/.test(t)){var r=new Mn((function(t){t(1)})),n=function(t){t((function(){}),(function(){}))};if((r.constructor={})[Cn]=n,!(Nn=r.then((function(){}))instanceof n))return!0}return!e&&(Rn||Ln)&&!Dn})),REJECTION_EVENT:Dn,SUBCLASSING:Nn},Wn=TypeError,zn=function(t){var e,r;this.promise=new t((function(t,n){if(void 0!==e||void 0!==r)throw Wn("Bad Promise constructor");e=t,r=n})),this.resolve=Mt(e),this.reject=Mt(r)},Bn={f:function(t){return new zn(t)}},Un=vn.set,Gn=Fn.CONSTRUCTOR,Hn=Fn.REJECTION_EVENT,Vn=Fn.SUBCLASSING,qn=ce.getterFor("Promise"),Zn=ce.set,Yn=Mn&&Mn.prototype,$n=Mn,Kn=Yn,Qn=O.TypeError,Xn=O.document,Jn=O.process,to=Bn.f,eo=to,ro=!!(Xn&&Xn.createEvent&&O.dispatchEvent),no=function(t){var e;return!(!dt(t)||!$(e=t.then))&&e},oo=function(t,e){var r,n,o,i=e.value,a=1==e.state,u=a?t.ok:t.fail,s=t.resolve,c=t.reject,f=t.domain;try{u?(a||(2===e.rejection&&co(e),e.rejection=1),!0===u?r=i:(f&&f.enter(),r=u(i),f&&(f.exit(),o=!0)),r===t.promise?c(Qn("Promise-chain cycle")):(n=no(r))?St(n,r,s,c):s(r)):c(i)}catch(t){f&&!o&&f.exit(),c(t)}},io=function(t,e){t.notified||(t.notified=!0,Sn((function(){for(var r,n=t.reactions;r=n.get();)oo(r,t);t.notified=!1,e&&!t.rejection&&uo(t)})))},ao=function(t,e,r){var n,o;ro?((n=Xn.createEvent("Event")).promise=e,n.reason=r,n.initEvent(t,!1,!0),O.dispatchEvent(n)):n={promise:e,reason:r},!Hn&&(o=O["on"+t])?o(n):"unhandledrejection"===t&&function(t,e){var r=O.console;r&&r.error&&(1==arguments.length?r.error(t):r.error(t,e))}("Unhandled promise rejection",r)},uo=function(t){St(Un,O,(function(){var e,r=t.facade,n=t.value;if(so(t)&&(e=Tn((function(){ar?Jn.emit("unhandledRejection",n,r):ao("unhandledrejection",r,n)})),t.rejection=ar||so(t)?2:1,e.error))throw e.value}))},so=function(t){return 1!==t.rejection&&!t.parent},co=function(t){St(Un,O,(function(){var e=t.facade;ar?Jn.emit("rejectionHandled",e):ao("rejectionhandled",e,t.value)}))},fo=function(t,e,r){return function(n){t(e,n,r)}},lo=function(t,e,r){t.done||(t.done=!0,r&&(t=r),t.value=e,t.state=2,io(t,!0))},ho=function(t,e,r){if(!t.done){t.done=!0,r&&(t=r);try{if(t.facade===e)throw Qn("Promise can't be resolved itself");var n=no(e);n?Sn((function(){var r={done:!1};try{St(n,e,fo(ho,r,t),fo(lo,r,t))}catch(e){lo(r,e,t)}})):(t.value=e,t.state=1,io(t,!1))}catch(e){lo({done:!1},e,t)}}};if(Gn&&(Kn=($n=function(t){yr(this,Kn),Mt(t),St(In,this);var e=qn(this);try{t(fo(ho,e),fo(lo,e))}catch(t){lo(e,t)}}).prototype,(In=function(t){Zn(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:new _n,rejection:!1,state:0,value:void 0})}).prototype=le(Kn,"then",(function(t,e){var r=qn(this),n=to(Lr(this,$n));return r.parent=!0,n.ok=!$(t)||t,n.fail=$(e)&&e,n.domain=ar?Jn.domain:void 0,0==r.state?r.reactions.add(n):Sn((function(){oo(n,r)})),n.promise})),jn=function(){var t=new In,e=qn(t);this.promise=t,this.resolve=fo(ho,e),this.reject=fo(lo,e)},Bn.f=to=function(t){return t===$n||void 0===t?new jn(t):eo(t)},$(Mn)&&Yn!==Object.prototype)){Pn=Yn.then,Vn||le(Yn,"then",(function(t,e){var r=this;return new $n((function(t,e){St(Pn,r,t,e)})).then(t,e)}),{unsafe:!0});try{delete Yn.constructor}catch(t){}cr&&cr(Yn,Kn)}ir({global:!0,constructor:!0,wrap:!0,forced:Gn},{Promise:$n}),hr($n,"Promise",!1),vr("Promise");var po={},vo=ft("iterator"),yo=Array.prototype,go=function(t){return void 0!==t&&(po.Array===t||yo[vo]===t)},mo=ft("iterator"),xo=function(t){if(!C(t))return Lt(t,mo)||Lt(t,"@@iterator")||po[me(t)]},bo=TypeError,wo=function(t,e){var r=arguments.length<2?xo(t):e;if(Mt(r))return At(St(r,t));throw bo(Pt(t)+" is not iterable")},Eo=function(t,e,r){var n,o;At(t);try{if(!(n=Lt(t,"return"))){if("throw"===e)throw r;return r}n=St(n,t)}catch(t){o=!0,n=t}if("throw"===e)throw r;if(o)throw n;return At(n),r},Ao=TypeError,Oo=function(t,e){this.stopped=t,this.result=e},So=Oo.prototype,To=function(t,e,r){var n,o,i,a,u,s,c,f=r&&r.that,l=!(!r||!r.AS_ENTRIES),h=!(!r||!r.IS_RECORD),p=!(!r||!r.IS_ITERATOR),v=!(!r||!r.INTERRUPTED),d=zr(e,f),y=function(t){return n&&Eo(n,"normal",t),new Oo(!0,t)},g=function(t){return l?(At(t),v?d(t[0],t[1],y):d(t[0],t[1])):v?d(t,y):d(t)};if(h)n=t.iterator;else if(p)n=t;else{if(!(o=xo(t)))throw Ao(Pt(t)+" is not iterable");if(go(o)){for(i=0,a=Fe(t);a>i;i++)if((u=g(t[i]))&&Tt(So,u))return u;return new Oo(!1)}n=wo(t,o)}for(s=h?t.next:n.next;!(c=St(s,n)).done;){try{u=g(c.value)}catch(t){Eo(n,"throw",t)}if("object"==typeof u&&u&&Tt(So,u))return u}return new Oo(!1)},ko=ft("iterator"),Io=!1;try{var jo=0,Po={next:function(){return{done:!!jo++}},return:function(){Io=!0}};Po[ko]=function(){return this},Array.from(Po,(function(){throw 2}))}catch(t){}var _o=function(t,e){if(!e&&!Io)return!1;var r=!1;try{var n={};n[ko]=function(){return{next:function(){return{done:r=!0}}}},t(n)}catch(t){}return r},Mo=Fn.CONSTRUCTOR||!_o((function(t){Mn.all(t).then(void 0,(function(){}))}));ir({target:"Promise",stat:!0,forced:Mo},{all:function(t){var e=this,r=Bn.f(e),n=r.resolve,o=r.reject,i=Tn((function(){var r=Mt(e.resolve),i=[],a=0,u=1;To(t,(function(t){var s=a++,c=!1;u++,St(r,e,t).then((function(t){c||(c=!0,i[s]=t,--u||n(i))}),o)})),--u||n(i)}));return i.error&&o(i.value),r.promise}});var Lo=Fn.CONSTRUCTOR,Ro=Mn&&Mn.prototype;if(ir({target:"Promise",proto:!0,forced:Lo,real:!0},{catch:function(t){return this.then(void 0,t)}}),$(Mn)){var Co=Q("Promise").prototype.catch;Ro.catch!==Co&&le(Ro,"catch",Co,{unsafe:!0})}ir({target:"Promise",stat:!0,forced:Mo},{race:function(t){var e=this,r=Bn.f(e),n=r.reject,o=Tn((function(){var o=Mt(e.resolve);To(t,(function(t){St(o,e,t).then(r.resolve,n)}))}));return o.error&&n(o.value),r.promise}}),ir({target:"Promise",stat:!0,forced:Fn.CONSTRUCTOR},{reject:function(t){var e=Bn.f(this);return St(e.reject,void 0,t),e.promise}});var No=Fn.CONSTRUCTOR;Q("Promise");function Do(t,e){if(!t)throw new Error(e||"web worker helper assertion failed.")}ir({target:"Promise",stat:!0,forced:No},{resolve:function(t){return function(t,e){if(At(t),dt(e)&&e.constructor===t)return e;var r=Bn.f(t);return(0,r.resolve)(e),r.promise}(this,t)}});var Fo="undefined"!=typeof window&&void 0!==window.orientation,Wo=function(){function t(t,e){var r=this;this.name=t,this.workerThread=e,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise((function(t,e){r.resolve=t,r.reject=e}))}return t.prototype.postMessage=function(t,e){this.workerThread.postMessage({source:"Main thread",type:t,payload:e})},t.prototype.done=function(t){Do(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(t)},t.prototype.error=function(t){Do(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(t)},t}(),zo=new Map;function Bo(t){Do(t.source&&!t.url||!t.source&&t.url);var e=zo.get(t.source||t.url);return e||(t.url&&(e=function(t){if(!t.startsWith("http"))return t;return Uo((e=t,"try {\\n  importScripts('"+e+"');\\n} catch (error) {\\n  console.error(error);\\n  throw error;\\n}"));var e}(t.url),zo.set(t.url,e)),t.source&&(e=Uo(t.source),zo.set(t.source,e))),Do(e),e}function Uo(t){var e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function Go(t,e,r){void 0===e&&(e=!0);var n=r||new Set;if(t){if(Ho(t))n.add(t);else if(Ho(t.buffer))n.add(t.buffer);else if(ArrayBuffer.isView(t));else if(e&&"object"==typeof t)for(var o in t)Go(t[o],e,n)}else;return void 0===r?Array.from(n):[]}function Ho(t){return!!t&&(t instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&t instanceof MessagePort||("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas)))}var Vo=function(){},qo=function(){function t(t){this.terminated=!1,this.loadableURL="";var e=t.name,r=t.source,n=t.url;Do(r||n),this.name=e,this.source=r,this.url=n,this.onMessage=Vo,this.onError=function(t){return console.log(t)},this.worker=this.createBrowserWorker()}return t.isSupported=function(){return"undefined"!=typeof Worker},t.prototype.destroy=function(){this.onMessage=Vo,this.onError=Vo,this.worker.terminate(),this.terminated=!0},Object.defineProperty(t.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),t.prototype.postMessage=function(t,e){e=e||Go(t),this.worker.postMessage(t,e)},t.prototype.getErrorFromErrorEvent=function(t){var e="Failed to load ";return e+="worker "+this.name+" from "+this.url+". ",t.message&&(e+=t.message+" in "),t.lineno&&(e+=":"+t.lineno+":"+t.colno),new Error(e)},t.prototype.createBrowserWorker=function(){var t=this;this.loadableURL=Bo({source:this.source,url:this.url});var e=new Worker(this.loadableURL,{name:this.name});return e.onmessage=function(e){e.data?t.onMessage(e.data):t.onError(new Error("No data received"))},e.onerror=function(e){t.onError(t.getErrorFromErrorEvent(e)),t.terminated=!0},e.onmessageerror=function(e){return console.error("worker "+t.name+", message error: "+e)},e},t}(),Zo=self&&self.__assign||function(){return(Zo=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Yo=self&&self.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{s(n.next(t))}catch(t){i(t)}}function u(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,u)}s((n=n.apply(t,e||[])).next())}))},$o=self&&self.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Ko=function(){function t(t){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=t.source,this.url=t.url,this.setProps(t)}return t.prototype.destroy=function(){this.idleQueue.forEach((function(t){return t.destroy()})),this.isDestroyed=!0},t.prototype.setProps=function(t){this.props=Zo(Zo({},this.props),t),void 0!==t.name&&(this.name=t.name),void 0!==t.maxConcurrency&&(this.maxConcurrency=t.maxConcurrency),void 0!==t.maxMobileConcurrency&&(this.maxMobileConcurrency=t.maxMobileConcurrency),void 0!==t.reuseWorkers&&(this.reuseWorkers=t.reuseWorkers),void 0!==t.onDebug&&(this.onDebug=t.onDebug)},t.prototype.startJob=function(t,e,r){return void 0===e&&(e=function(t,e,r){return t.done(r)}),void 0===r&&(r=function(t,e){return t.error(e)}),Yo(this,void 0,void 0,(function(){var n,o=this;return $o(this,(function(i){switch(i.label){case 0:return n=new Promise((function(n){return o.jobQueue.push({name:t,onMessage:e,onError:r,onStart:n}),o})),this.startQueuedJob(),[4,n];case 1:return[2,i.sent()]}}))}))},t.prototype.startQueuedJob=function(){return Yo(this,void 0,void 0,(function(){var t,e,r;return $o(this,(function(n){switch(n.label){case 0:if(!this.jobQueue.length)return[2];if(!(t=this.getAvailableWorker()))return[2];if(!(e=this.jobQueue.shift()))return[3,4];this.onDebug({message:"Starting job",name:e.name,backlog:this.jobQueue.length,workerThread:t}),r=new Wo(e.name,t),t.onMessage=function(t){return e.onMessage(r,t.type,t.payload)},t.onError=function(t){return e.onError(r,t)},e.onStart(r),n.label=1;case 1:return n.trys.push([1,,3,4]),[4,r.result];case 2:return n.sent(),[3,4];case 3:return this.returnWorkerToQueue(t),[7];case 4:return[2]}}))}))},t.prototype.returnWorkerToQueue=function(t){this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this.startQueuedJob()},t.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var t=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new qo({name:t,source:this.source,url:this.url})}return null},t.prototype.getMaxConcurrency=function(){return Fo?this.maxMobileConcurrency:this.maxConcurrency},t}(),Qo=self&&self.__assign||function(){return(Qo=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Xo=self&&self.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Jo={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},ti=(function(){function t(t){this.workerPools=new Map,this.props=Qo({},Jo),this.setProps(t),this.workerPools=new Map}t.isSupported=function(){return qo.isSupported()},t.getWorkerFarm=function(e){return void 0===e&&(e={}),t.workerFarm=t.workerFarm||new t({}),t.workerFarm.setProps(e),t.workerFarm},t.prototype.destroy=function(){var t,e;try{for(var r=Xo(this.workerPools.values()),n=r.next();!n.done;n=r.next()){n.value.destroy()}}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},t.prototype.setProps=function(t){var e,r;this.props=Qo(Qo({},this.props),t);try{for(var n=Xo(this.workerPools.values()),o=n.next();!o.done;o=n.next()){o.value.setProps(this.getWorkerPoolProps())}}catch(t){e={error:t}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}},t.prototype.getWorkerPool=function(t){var e=t.name,r=t.source,n=t.url,o=this.workerPools.get(e);return o||((o=new Ko({name:e,source:r,url:n})).setProps(this.getWorkerPoolProps()),this.workerPools.set(e,o)),o},t.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}(),new Map),ei=function(){function t(){}return Object.defineProperty(t,"onmessage",{set:function(t){self.onmessage=function(e){if(ri(e)){var r=e.data,n=r.type,o=r.payload;t(n,o)}}},enumerable:!1,configurable:!0}),t.addEventListener=function(t){var e=ti.get(t);e||(e=function(e){if(ri(e)){var r=e.data,n=r.type,o=r.payload;t(n,o)}}),self.addEventListener("message",e)},t.removeEventListener=function(t){var e=ti.get(t);ti.delete(t),self.removeEventListener("message",e)},t.postMessage=function(t,e){if(self){var r={source:"Worker thread",type:t,payload:e},n=Go(e);self.postMessage(r,n)}},t}();function ri(t){var e=t.type,r=t.data;return"message"===e&&r&&"string"==typeof r.source&&"Main thread"===r.source}self&&self.__awaiter,self&&self.__generator;var ni,oi,ii=function(){function t(){this._values=[],this._settlers=[],this._closed=!1}return t.prototype[Symbol.asyncIterator]=function(){return this},t.prototype.push=function(t){return this.enqueue(t)},t.prototype.enqueue=function(t){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var e=this._settlers.shift();t instanceof Error?e.reject(t):e.resolve({value:t})}else this._values.push(t)},t.prototype.close=function(){for(;this._settlers.length>0;){this._settlers.shift().resolve({done:!0})}this._closed=!0},t.prototype.next=function(){var t=this;if(this._values.length>0){var e=this._values.shift();return e instanceof Error?Promise.reject(e):Promise.resolve({done:!1,value:e})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise((function(e,r){t._settlers.push({resolve:e,reject:r})}))},t}(),ai=self&&self.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{s(n.next(t))}catch(t){i(t)}}function u(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,u)}s((n=n.apply(t,e||[])).next())}))},ui=self&&self.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},si=self&&self.__asyncValues||function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,r=t[Symbol.asyncIterator];return r?r.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(r){e[r]=t[r]&&function(e){return new Promise((function(n,o){(function(t,e,r,n){Promise.resolve(n).then((function(e){t({value:e,done:r})}),e)})(n,o,(e=t[r](e)).done,e.value)}))}}},ci=0;function fi(t,e){var r=this;if("undefined"!=typeof self){var n={process:li};ei.onmessage=function(o,i){return ai(r,void 0,void 0,(function(){var r,a,u,s,c,f,l,h,p,v;return ui(this,(function(d){switch(d.label){case 0:switch(d.trys.push([0,19,,20]),o){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!t)throw new Error("Worker does not support atomic processing");return[4,t(i.input,i.options||{},n)];case 2:return r=d.sent(),ei.postMessage("done",{result:r}),[3,18];case 3:if(!e)throw new Error("Worker does not support batched processing");ni=new ii,oi=i.options||{},a=e(ni,oi,n),d.label=4;case 4:d.trys.push([4,9,10,15]),u=si(a),d.label=5;case 5:return[4,u.next()];case 6:if((s=d.sent()).done)return[3,8];c=s.value,ei.postMessage("output-batch",{result:c}),d.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return f=d.sent(),p={error:f},[3,15];case 10:return d.trys.push([10,,13,14]),s&&!s.done&&(v=u.return)?[4,v.call(u)]:[3,12];case 11:d.sent(),d.label=12;case 12:return[3,14];case 13:if(p)throw p.error;return[7];case 14:return[7];case 15:return ei.postMessage("done",{}),[3,18];case 16:return ni.push(i.input),[3,18];case 17:return ni.close(),[3,18];case 18:return[3,20];case 19:return l=d.sent(),h=l instanceof Error?l.message:"",ei.postMessage("error",{error:h}),[3,20];case 20:return[2]}}))}))}}}function li(t,e){return void 0===e&&(e={}),new Promise((function(r,n){var o=ci++,i=function(t,e){if(e.id===o)switch(t){case"done":ei.removeEventListener(i),r(e.result);break;case"error":ei.removeEventListener(i),n(e.error)}};ei.addEventListener(i);var a={id:o,input:t,options:e};ei.postMessage("process",a)}))}self&&self.__awaiter,self&&self.__generator;var hi={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},pi=mt("span").classList,vi=pi&&pi.constructor&&pi.constructor.prototype,di=vi===Object.prototype?void 0:vi,yi=Array.isArray||function(t){return"Array"==ve(t)},gi=ft("species"),mi=Array,xi=function(t,e){return new(function(t){var e;return yi(t)&&(e=t.constructor,(jr(e)&&(e===mi||yi(e.prototype))||dt(e)&&null===(e=e[gi]))&&(e=void 0)),void 0===e?mi:e}(t))(0===e?0:e)},bi=R([].push),wi=function(t){var e=1==t,r=2==t,n=3==t,o=4==t,i=6==t,a=7==t,u=5==t||i;return function(s,c,f,l){for(var h,p,v=W(s),d=Se(v),y=zr(c,f),g=Fe(d),m=0,x=l||xi,b=e?x(s,g):r||a?x(s,0):void 0;g>m;m++)if((u||m in d)&&(p=y(h=d[m],m,v),t))if(e)b[m]=p;else if(p)switch(t){case 3:return!0;case 5:return h;case 6:return m;case 2:bi(b,h)}else switch(t){case 4:return!1;case 7:bi(b,h)}return i?-1:n||o?o:b}},Ei={forEach:wi(0),map:wi(1),filter:wi(2),some:wi(3),every:wi(4),find:wi(5),findIndex:wi(6),filterReject:wi(7)},Ai=function(t,e){var r=[][t];return!!r&&j((function(){r.call(null,e||function(){return 1},1)}))},Oi=Ei.forEach,Si=Ai("forEach")?[].forEach:function(t){return Oi(this,t,arguments.length>1?arguments[1]:void 0)},Ti=function(t){if(t&&t.forEach!==Si)try{ee(t,"forEach",Si)}catch(e){t.forEach=Si}};for(var ki in hi)hi[ki]&&Ti(O[ki]&&O[ki].prototype);Ti(di);var Ii=function(t,e,r){var n=Ft(e);n in t?Ut.f(t,n,te(0,r)):t[n]=r},ji=ft("species"),Pi=function(t){return nt>=51||!j((function(){var e=[];return(e.constructor={})[ji]=function(){return{foo:1}},1!==e[t](Boolean).foo}))},_i=Pi("slice"),Mi=ft("species"),Li=Array,Ri=Math.max;ir({target:"Array",proto:!0,forced:!_i},{slice:function(t,e){var r,n,o,i=Te(this),a=Fe(i),u=Ce(t,a),s=Ce(void 0===e?a:e,a);if(yi(i)&&(r=i.constructor,(jr(r)&&(r===Li||yi(r.prototype))||dt(r)&&null===(r=r[Mi]))&&(r=void 0),r===Li||void 0===r))return Ur(i,u,s);for(n=new(void 0===r?Li:r)(Ri(s-u,0)),o=0;u<s;u++,o++)u in i&&Ii(n,o,i[u]);return n.length=o,n}});var Ci=qt.EXISTS,Ni=Ut.f,Di=Function.prototype,Fi=R(Di.toString),Wi=/function\\b(?:\\s|\\/\\*[\\S\\s]*?\\*\\/|\\/\\/[^\\n\\r]*[\\n\\r]+)*([^\\s(/]*)/,zi=R(Wi.exec);pt&&!Ci&&Ni(Di,"name",{configurable:!0,get:function(){try{return zi(Wi,Fi(this))[1]}catch(t){return""}}});var Bi=Ei.map,Ui=Pi("map");ir({target:"Array",proto:!0,forced:!Ui},{map:function(t){return Bi(this,t,arguments.length>1?arguments[1]:void 0)}});var Gi,Hi=Object.keys||function(t){return Ge(t,He)},Vi={f:pt&&!bt?Object.defineProperties:function(t,e){At(t);for(var r,n=Te(e),o=Hi(e),i=o.length,a=0;i>a;)Ut.f(t,r=o[a++],n[r]);return t}},qi=ne("IE_PROTO"),Zi=function(){},Yi=function(t){return"<script>"+t+"<\\/script>"},$i=function(t){t.write(Yi("")),t.close();var e=t.parentWindow.Object;return t=null,e},Ki=function(){try{Gi=new ActiveXObject("htmlfile")}catch(t){}var t,e;Ki="undefined"!=typeof document?document.domain&&Gi?$i(Gi):((e=mt("iframe")).style.display="none",Br.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write(Yi("document.F=Object")),t.close(),t.F):$i(Gi);for(var r=He.length;r--;)delete Ki.prototype[He[r]];return Ki()};oe[qi]=!0;var Qi=Object.create||function(t,e){var r;return null!==t?(Zi.prototype=At(t),r=new Zi,Zi.prototype=null,r[qi]=t):r=Ki(),void 0===e?r:Vi.f(r,e)},Xi=Ut.f,Ji=ft("unscopables"),ta=Array.prototype;null==ta[Ji]&&Xi(ta,Ji,{configurable:!0,value:Qi(null)});var ea,ra,na,oa=function(t){ta[Ji][t]=!0},ia=!j((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),aa=ne("IE_PROTO"),ua=Object,sa=ua.prototype,ca=ia?ua.getPrototypeOf:function(t){var e=W(t);if(B(e,aa))return e[aa];var r=e.constructor;return $(r)&&e instanceof r?r.prototype:e instanceof ua?sa:null},fa=ft("iterator"),la=!1;[].keys&&("next"in(na=[].keys())?(ra=ca(ca(na)))!==Object.prototype&&(ea=ra):la=!0),(!dt(ea)||j((function(){var t={};return ea[fa].call(t)!==t})))&&(ea={}),$(ea[fa])||le(ea,fa,(function(){return this}));var ha={IteratorPrototype:ea,BUGGY_SAFARI_ITERATORS:la},pa=ha.IteratorPrototype,va=function(){return this},da=qt.PROPER,ya=qt.CONFIGURABLE,ga=ha.IteratorPrototype,ma=ha.BUGGY_SAFARI_ITERATORS,xa=ft("iterator"),ba=function(){return this},wa=function(t,e,r,n,o,i,a){!function(t,e,r,n){var o=e+" Iterator";t.prototype=Qi(pa,{next:te(+!n,r)}),hr(t,o,!1),po[o]=va}(r,e,n);var u,s,c,f=function(t){if(t===o&&d)return d;if(!ma&&t in p)return p[t];switch(t){case"keys":case"values":case"entries":return function(){return new r(this,t)}}return function(){return new r(this)}},l=e+" Iterator",h=!1,p=t.prototype,v=p[xa]||p["@@iterator"]||o&&p[o],d=!ma&&v||f(o),y="Array"==e&&p.entries||v;if(y&&(u=ca(y.call(new t)))!==Object.prototype&&u.next&&(ca(u)!==ga&&(cr?cr(u,ga):$(u[xa])||le(u,xa,ba)),hr(u,l,!0)),da&&"values"==o&&v&&"values"!==v.name&&(ya?ee(p,"name","values"):(h=!0,d=function(){return St(v,this)})),o)if(s={values:f("values"),keys:i?d:f("keys"),entries:f("entries")},a)for(c in s)(ma||h||!(c in p))&&le(p,c,s[c]);else ir({target:e,proto:!0,forced:ma||h},s);return p[xa]!==d&&le(p,xa,d,{name:o}),po[e]=d,s},Ea=function(t,e){return{value:t,done:e}},Aa=Ut.f,Oa=ce.set,Sa=ce.getterFor("Array Iterator"),Ta=wa(Array,"Array",(function(t,e){Oa(this,{type:"Array Iterator",target:Te(t),index:0,kind:e})}),(function(){var t=Sa(this),e=t.target,r=t.kind,n=t.index++;return!e||n>=e.length?(t.target=void 0,Ea(void 0,!0)):Ea("keys"==r?n:"values"==r?e[n]:[n,e[n]],!1)}),"values"),ka=po.Arguments=po.Array;if(oa("keys"),oa("values"),oa("entries"),pt&&"values"!==ka.name)try{Aa(ka,"name",{value:"values"})}catch(t){}var Ia,ja,Pa,_a="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,Ma=Ut.f,La=ce.enforce,Ra=ce.get,Ca=O.Int8Array,Na=Ca&&Ca.prototype,Da=O.Uint8ClampedArray,Fa=Da&&Da.prototype,Wa=Ca&&ca(Ca),za=Na&&ca(Na),Ba=Object.prototype,Ua=O.TypeError,Ga=ft("toStringTag"),Ha=V("TYPED_ARRAY_TAG"),Va=_a&&!!cr&&"Opera"!==me(O.opera),qa=!1,Za={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Ya={BigInt64Array:8,BigUint64Array:8},$a=function(t){var e=ca(t);if(dt(e)){var r=Ra(e);return r&&B(r,"TypedArrayConstructor")?r.TypedArrayConstructor:$a(e)}},Ka=function(t){if(!dt(t))return!1;var e=me(t);return B(Za,e)||B(Ya,e)};for(Ia in Za)(Pa=(ja=O[Ia])&&ja.prototype)?La(Pa).TypedArrayConstructor=ja:Va=!1;for(Ia in Ya)(Pa=(ja=O[Ia])&&ja.prototype)&&(La(Pa).TypedArrayConstructor=ja);if((!Va||!$(Wa)||Wa===Function.prototype)&&(Wa=function(){throw Ua("Incorrect invocation")},Va))for(Ia in Za)O[Ia]&&cr(O[Ia],Wa);if((!Va||!za||za===Ba)&&(za=Wa.prototype,Va))for(Ia in Za)O[Ia]&&cr(O[Ia].prototype,za);if(Va&&ca(Fa)!==za&&cr(Fa,za),pt&&!B(za,Ga))for(Ia in qa=!0,Ma(za,Ga,{get:function(){return dt(this)?this[Ha]:void 0}}),Za)O[Ia]&&ee(O[Ia],Ha,Ia);var Qa={NATIVE_ARRAY_BUFFER_VIEWS:Va,TYPED_ARRAY_TAG:qa&&Ha,aTypedArray:function(t){if(Ka(t))return t;throw Ua("Target is not a typed array")},aTypedArrayConstructor:function(t){if($(t)&&(!cr||Tt(Wa,t)))return t;throw Ua(Pt(t)+" is not a typed array constructor")},exportTypedArrayMethod:function(t,e,r,n){if(pt){if(r)for(var o in Za){var i=O[o];if(i&&B(i.prototype,t))try{delete i.prototype[t]}catch(r){try{i.prototype[t]=e}catch(t){}}}za[t]&&!r||le(za,t,r?e:Va&&Na[t]||e,n)}},exportTypedArrayStaticMethod:function(t,e,r){var n,o;if(pt){if(cr){if(r)for(n in Za)if((o=O[n])&&B(o,t))try{delete o[t]}catch(t){}if(Wa[t]&&!r)return;try{return le(Wa,t,r?e:Va&&Wa[t]||e)}catch(t){}}for(n in Za)!(o=O[n])||o[t]&&!r||le(o,t,e)}},getTypedArrayConstructor:$a,isView:function(t){if(!dt(t))return!1;var e=me(t);return"DataView"===e||B(Za,e)||B(Ya,e)},isTypedArray:Ka,TypedArray:Wa,TypedArrayPrototype:za},Xa=Qa.NATIVE_ARRAY_BUFFER_VIEWS,Ja=O.ArrayBuffer,tu=O.Int8Array,eu=!Xa||!j((function(){tu(1)}))||!j((function(){new tu(-1)}))||!_o((function(t){new tu,new tu(null),new tu(1.5),new tu(t)}),!0)||j((function(){return 1!==new tu(new Ja(2),1,void 0).length})),ru=function(t,e,r){for(var n in e)le(t,n,e[n],r);return t},nu=RangeError,ou=function(t){if(void 0===t)return 0;var e=Me(t),r=De(e);if(e!==r)throw nu("Wrong length or index");return r},iu=Array,au=Math.abs,uu=Math.pow,su=Math.floor,cu=Math.log,fu=Math.LN2,lu=function(t,e,r){var n,o,i,a=iu(r),u=8*r-e-1,s=(1<<u)-1,c=s>>1,f=23===e?uu(2,-24)-uu(2,-77):0,l=t<0||0===t&&1/t<0?1:0,h=0;for((t=au(t))!=t||t===1/0?(o=t!=t?1:0,n=s):(n=su(cu(t)/fu),t*(i=uu(2,-n))<1&&(n--,i*=2),(t+=n+c>=1?f/i:f*uu(2,1-c))*i>=2&&(n++,i/=2),n+c>=s?(o=0,n=s):n+c>=1?(o=(t*i-1)*uu(2,e),n+=c):(o=t*uu(2,c-1)*uu(2,e),n=0));e>=8;)a[h++]=255&o,o/=256,e-=8;for(n=n<<e|o,u+=e;u>0;)a[h++]=255&n,n/=256,u-=8;return a[--h]|=128*l,a},hu=function(t,e){var r,n=t.length,o=8*n-e-1,i=(1<<o)-1,a=i>>1,u=o-7,s=n-1,c=t[s--],f=127&c;for(c>>=7;u>0;)f=256*f+t[s--],u-=8;for(r=f&(1<<-u)-1,f>>=-u,u+=e;u>0;)r=256*r+t[s--],u-=8;if(0===f)f=1-a;else{if(f===i)return r?NaN:c?-1/0:1/0;r+=uu(2,e),f-=a}return(c?-1:1)*r*uu(2,f-e)},pu=function(t){for(var e=W(this),r=Fe(e),n=arguments.length,o=Ce(n>1?arguments[1]:void 0,r),i=n>2?arguments[2]:void 0,a=void 0===i?r:Ce(i,r);a>o;)e[o++]=t;return e},vu=Array,du=Math.max,yu=function(t,e,r){for(var n=Fe(t),o=Ce(e,n),i=Ce(void 0===r?n:r,n),a=vu(du(i-o,0)),u=0;o<i;o++,u++)Ii(a,u,t[o]);return a.length=u,a},gu=qe.f,mu=Ut.f,xu=qt.PROPER,bu=qt.CONFIGURABLE,wu=ce.get,Eu=ce.set,Au=O.ArrayBuffer,Ou=Au,Su=Ou&&Ou.prototype,Tu=O.DataView,ku=Tu&&Tu.prototype,Iu=Object.prototype,ju=O.Array,Pu=O.RangeError,_u=R(pu),Mu=R([].reverse),Lu=lu,Ru=hu,Cu=function(t){return[255&t]},Nu=function(t){return[255&t,t>>8&255]},Du=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},Fu=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},Wu=function(t){return Lu(t,23,4)},zu=function(t){return Lu(t,52,8)},Bu=function(t,e){mu(t.prototype,e,{get:function(){return wu(this)[e]}})},Uu=function(t,e,r,n){var o=ou(r),i=wu(t);if(o+e>i.byteLength)throw Pu("Wrong index");var a=wu(i.buffer).bytes,u=o+i.byteOffset,s=yu(a,u,u+e);return n?s:Mu(s)},Gu=function(t,e,r,n,o,i){var a=ou(r),u=wu(t);if(a+e>u.byteLength)throw Pu("Wrong index");for(var s=wu(u.buffer).bytes,c=a+u.byteOffset,f=n(+o),l=0;l<e;l++)s[c+l]=f[i?l:e-l-1]};if(_a){var Hu=xu&&"ArrayBuffer"!==Au.name;if(j((function(){Au(1)}))&&j((function(){new Au(-1)}))&&!j((function(){return new Au,new Au(1.5),new Au(NaN),1!=Au.length||Hu&&!bu})))Hu&&bu&&ee(Au,"name","ArrayBuffer");else{(Ou=function(t){return yr(this,Su),new Au(ou(t))}).prototype=Su;for(var Vu,qu=gu(Au),Zu=0;qu.length>Zu;)(Vu=qu[Zu++])in Ou||ee(Ou,Vu,Au[Vu]);Su.constructor=Ou}cr&&ca(ku)!==Iu&&cr(ku,Iu);var Yu=new Tu(new Ou(2)),$u=R(ku.setInt8);Yu.setInt8(0,2147483648),Yu.setInt8(1,2147483649),!Yu.getInt8(0)&&Yu.getInt8(1)||ru(ku,{setInt8:function(t,e){$u(this,t,e<<24>>24)},setUint8:function(t,e){$u(this,t,e<<24>>24)}},{unsafe:!0})}else Su=(Ou=function(t){yr(this,Su);var e=ou(t);Eu(this,{bytes:_u(ju(e),0),byteLength:e}),pt||(this.byteLength=e)}).prototype,ku=(Tu=function(t,e,r){yr(this,ku),yr(t,Su);var n=wu(t).byteLength,o=Me(e);if(o<0||o>n)throw Pu("Wrong offset");if(o+(r=void 0===r?n-o:De(r))>n)throw Pu("Wrong length");Eu(this,{buffer:t,byteLength:r,byteOffset:o}),pt||(this.buffer=t,this.byteLength=r,this.byteOffset=o)}).prototype,pt&&(Bu(Ou,"byteLength"),Bu(Tu,"buffer"),Bu(Tu,"byteLength"),Bu(Tu,"byteOffset")),ru(ku,{getInt8:function(t){return Uu(this,1,t)[0]<<24>>24},getUint8:function(t){return Uu(this,1,t)[0]},getInt16:function(t){var e=Uu(this,2,t,arguments.length>1?arguments[1]:void 0);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=Uu(this,2,t,arguments.length>1?arguments[1]:void 0);return e[1]<<8|e[0]},getInt32:function(t){return Fu(Uu(this,4,t,arguments.length>1?arguments[1]:void 0))},getUint32:function(t){return Fu(Uu(this,4,t,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(t){return Ru(Uu(this,4,t,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(t){return Ru(Uu(this,8,t,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(t,e){Gu(this,1,t,Cu,e)},setUint8:function(t,e){Gu(this,1,t,Cu,e)},setInt16:function(t,e){Gu(this,2,t,Nu,e,arguments.length>2?arguments[2]:void 0)},setUint16:function(t,e){Gu(this,2,t,Nu,e,arguments.length>2?arguments[2]:void 0)},setInt32:function(t,e){Gu(this,4,t,Du,e,arguments.length>2?arguments[2]:void 0)},setUint32:function(t,e){Gu(this,4,t,Du,e,arguments.length>2?arguments[2]:void 0)},setFloat32:function(t,e){Gu(this,4,t,Wu,e,arguments.length>2?arguments[2]:void 0)},setFloat64:function(t,e){Gu(this,8,t,zu,e,arguments.length>2?arguments[2]:void 0)}});hr(Ou,"ArrayBuffer"),hr(Tu,"DataView");var Ku={ArrayBuffer:Ou,DataView:Tu},Qu=Math.floor,Xu=Number.isInteger||function(t){return!dt(t)&&isFinite(t)&&Qu(t)===t},Ju=RangeError,ts=RangeError,es=function(t,e){var r=function(t){var e=Me(t);if(e<0)throw Ju("The argument can't be less than 0");return e}(t);if(r%e)throw ts("Wrong offset");return r},rs=R("".slice),ns=function(t){return"Big"===rs(me(t),0,3)},os=TypeError,is=function(t){var e=Dt(t,"number");if("number"==typeof e)throw os("Can't convert number to bigint");return BigInt(e)},as=Qa.aTypedArrayConstructor,us=function(t){var e,r,n,o,i,a,u,s,c=_r(this),f=W(t),l=arguments.length,h=l>1?arguments[1]:void 0,p=void 0!==h,v=xo(f);if(v&&!go(v))for(s=(u=wo(f,v)).next,f=[];!(a=St(s,u)).done;)f.push(a.value);for(p&&l>2&&(h=zr(h,arguments[2])),r=Fe(f),n=new(as(c))(r),o=ns(n),e=0;r>e;e++)i=p?h(f[e],e):f[e],n[e]=o?is(i):+i;return n},ss=function(t,e,r){var n,o;return cr&&$(n=e.constructor)&&n!==r&&dt(o=n.prototype)&&o!==r.prototype&&cr(t,o),t},cs=b((function(t){var e=qe.f,r=Ei.forEach,n=ce.get,o=ce.set,i=ce.enforce,a=Ut.f,u=Ie.f,s=Math.round,c=O.RangeError,f=Ku.ArrayBuffer,l=f.prototype,h=Ku.DataView,p=Qa.NATIVE_ARRAY_BUFFER_VIEWS,v=Qa.TYPED_ARRAY_TAG,d=Qa.TypedArray,y=Qa.TypedArrayPrototype,g=Qa.aTypedArrayConstructor,m=Qa.isTypedArray,x=function(t,e){g(t);for(var r=0,n=e.length,o=new t(n);n>r;)o[r]=e[r++];return o},b=function(t,e){a(t,e,{get:function(){return n(this)[e]}})},w=function(t){var e;return Tt(l,t)||"ArrayBuffer"==(e=me(t))||"SharedArrayBuffer"==e},E=function(t,e){return m(t)&&!It(e)&&e in t&&Xu(+e)&&e>=0},A=function(t,e){return e=Ft(e),E(t,e)?te(2,t[e]):u(t,e)},S=function(t,e,r){return e=Ft(e),!(E(t,e)&&dt(r)&&B(r,"value"))||B(r,"get")||B(r,"set")||r.configurable||B(r,"writable")&&!r.writable||B(r,"enumerable")&&!r.enumerable?a(t,e,r):(t[e]=r.value,t)};pt?(p||(Ie.f=A,Ut.f=S,b(y,"buffer"),b(y,"byteOffset"),b(y,"byteLength"),b(y,"length")),ir({target:"Object",stat:!0,forced:!p},{getOwnPropertyDescriptor:A,defineProperty:S}),t.exports=function(t,u,l){var g=t.match(/\\d+$/)[0]/8,b=t+(l?"Clamped":"")+"Array",E="get"+t,A="set"+t,S=O[b],T=S,k=T&&T.prototype,I={},j=function(t,e){a(t,e,{get:function(){return function(t,e){var r=n(t);return r.view[E](e*g+r.byteOffset,!0)}(this,e)},set:function(t){return function(t,e,r){var o=n(t);l&&(r=(r=s(r))<0?0:r>255?255:255&r),o.view[A](e*g+o.byteOffset,r,!0)}(this,e,t)},enumerable:!0})};p?eu&&(T=u((function(t,e,r,n){return yr(t,k),ss(dt(e)?w(e)?void 0!==n?new S(e,es(r,g),n):void 0!==r?new S(e,es(r,g)):new S(e):m(e)?x(T,e):St(us,T,e):new S(ou(e)),t,T)})),cr&&cr(T,d),r(e(S),(function(t){t in T||ee(T,t,S[t])})),T.prototype=k):(T=u((function(t,e,r,n){yr(t,k);var i,a,u,s=0,l=0;if(dt(e)){if(!w(e))return m(e)?x(T,e):St(us,T,e);i=e,l=es(r,g);var p=e.byteLength;if(void 0===n){if(p%g)throw c("Wrong length");if((a=p-l)<0)throw c("Wrong length")}else if((a=De(n)*g)+l>p)throw c("Wrong length");u=a/g}else u=ou(e),i=new f(a=u*g);for(o(t,{buffer:i,byteOffset:l,byteLength:a,length:u,view:new h(i)});s<u;)j(t,s++)})),cr&&cr(T,d),k=T.prototype=Qi(y)),k.constructor!==T&&ee(k,"constructor",T),i(k).TypedArrayConstructor=T,v&&ee(k,v,b);var P=T!=S;I[b]=T,ir({global:!0,constructor:!0,forced:P,sham:!p},I),"BYTES_PER_ELEMENT"in T||ee(T,"BYTES_PER_ELEMENT",g),"BYTES_PER_ELEMENT"in k||ee(k,"BYTES_PER_ELEMENT",g),vr(b)}):t.exports=function(){}}));cs("Uint8",(function(t){return function(e,r,n){return t(this,e,r,n)}}),!0);var fs=TypeError,ls=function(t,e){if(!delete t[e])throw fs("Cannot delete property "+Pt(e)+" of "+Pt(t))},hs=Math.min,ps=R([].copyWithin||function(t,e){var r=W(this),n=Fe(r),o=Ce(t,n),i=Ce(e,n),a=arguments.length>2?arguments[2]:void 0,u=hs((void 0===a?n:Ce(a,n))-i,n-o),s=1;for(i<o&&o<i+u&&(s=-1,i+=u-1,o+=u-1);u-- >0;)i in r?r[o]=r[i]:ls(r,o),o+=s,i+=s;return r}),vs=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("copyWithin",(function(t,e){return ps(vs(this),t,e,arguments.length>2?arguments[2]:void 0)}));var ds=Ei.every,ys=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("every",(function(t){return ds(ys(this),t,arguments.length>1?arguments[1]:void 0)}));var gs=Qa.aTypedArray,ms=Qa.exportTypedArrayMethod,xs=R("".slice);ms("fill",(function(t){var e=arguments.length;gs(this);var r="Big"===xs(me(this),0,3)?is(t):+t;return St(pu,this,r,e>1?arguments[1]:void 0,e>2?arguments[2]:void 0)}),j((function(){var t=0;return new Int8Array(2).fill({valueOf:function(){return t++}}),1!==t})));var bs=Qa.aTypedArrayConstructor,ws=Qa.getTypedArrayConstructor,Es=function(t){return bs(Lr(t,ws(t)))},As=function(t,e){return function(t,e){for(var r=0,n=Fe(e),o=new t(n);n>r;)o[r]=e[r++];return o}(Es(t),e)},Os=Ei.filter,Ss=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("filter",(function(t){var e=Os(Ss(this),t,arguments.length>1?arguments[1]:void 0);return As(this,e)}));var Ts=Ei.find,ks=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("find",(function(t){return Ts(ks(this),t,arguments.length>1?arguments[1]:void 0)}));var Is=Ei.findIndex,js=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("findIndex",(function(t){return Is(js(this),t,arguments.length>1?arguments[1]:void 0)}));var Ps=Ei.forEach,_s=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("forEach",(function(t){Ps(_s(this),t,arguments.length>1?arguments[1]:void 0)}));var Ms=ze.includes,Ls=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("includes",(function(t){return Ms(Ls(this),t,arguments.length>1?arguments[1]:void 0)}));var Rs=ze.indexOf,Cs=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("indexOf",(function(t){return Rs(Cs(this),t,arguments.length>1?arguments[1]:void 0)}));var Ns=ft("iterator"),Ds=O.Uint8Array,Fs=R(Ta.values),Ws=R(Ta.keys),zs=R(Ta.entries),Bs=Qa.aTypedArray,Us=Qa.exportTypedArrayMethod,Gs=Ds&&Ds.prototype,Hs=!j((function(){Gs[Ns].call([1])})),Vs=!!Gs&&Gs.values&&Gs[Ns]===Gs.values&&"values"===Gs.values.name,qs=function(){return Fs(Bs(this))};Us("entries",(function(){return zs(Bs(this))}),Hs),Us("keys",(function(){return Ws(Bs(this))}),Hs),Us("values",qs,Hs||!Vs,{name:"values"}),Us(Ns,qs,Hs||!Vs,{name:"values"});var Zs=Qa.aTypedArray,Ys=Qa.exportTypedArrayMethod,$s=R([].join);Ys("join",(function(t){return $s(Zs(this),t)}));var Ks=Math.min,Qs=[].lastIndexOf,Xs=!!Qs&&1/[1].lastIndexOf(1,-0)<0,Js=Ai("lastIndexOf"),tc=Xs||!Js?function(t){if(Xs)return Dr(Qs,this,arguments)||0;var e=Te(this),r=Fe(e),n=r-1;for(arguments.length>1&&(n=Ks(n,Me(arguments[1]))),n<0&&(n=r+n);n>=0;n--)if(n in e&&e[n]===t)return n||0;return-1}:Qs,ec=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("lastIndexOf",(function(t){var e=arguments.length;return Dr(tc,ec(this),e>1?[t,arguments[1]]:[t])}));var rc=Ei.map,nc=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("map",(function(t){return rc(nc(this),t,arguments.length>1?arguments[1]:void 0,(function(t,e){return new(Es(t))(e)}))}));var oc=TypeError,ic=function(t){return function(e,r,n,o){Mt(r);var i=W(e),a=Se(i),u=Fe(i),s=t?u-1:0,c=t?-1:1;if(n<2)for(;;){if(s in a){o=a[s],s+=c;break}if(s+=c,t?s<0:u<=s)throw oc("Reduce of empty array with no initial value")}for(;t?s>=0:u>s;s+=c)s in a&&(o=r(o,a[s],s,i));return o}},ac={left:ic(!1),right:ic(!0)},uc=ac.left,sc=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("reduce",(function(t){var e=arguments.length;return uc(sc(this),t,e,e>1?arguments[1]:void 0)}));var cc=ac.right,fc=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("reduceRight",(function(t){var e=arguments.length;return cc(fc(this),t,e,e>1?arguments[1]:void 0)}));var lc=Qa.aTypedArray,hc=Qa.exportTypedArrayMethod,pc=Math.floor;hc("reverse",(function(){for(var t,e=lc(this).length,r=pc(e/2),n=0;n<r;)t=this[n],this[n++]=this[--e],this[e]=t;return this}));var vc=O.RangeError,dc=O.Int8Array,yc=dc&&dc.prototype,gc=yc&&yc.set,mc=Qa.aTypedArray,xc=Qa.exportTypedArrayMethod,bc=!j((function(){var t=new Uint8ClampedArray(2);return St(gc,t,{length:1,0:3},1),3!==t[1]})),wc=bc&&Qa.NATIVE_ARRAY_BUFFER_VIEWS&&j((function(){var t=new dc(2);return t.set(1),t.set("2",1),0!==t[0]||2!==t[1]}));xc("set",(function(t){mc(this);var e=es(arguments.length>1?arguments[1]:void 0,1),r=W(t);if(bc)return St(gc,this,r,e);var n=this.length,o=Fe(r),i=0;if(o+e>n)throw vc("Wrong length");for(;i<o;)this[e+i]=r[i++]}),!bc||wc);var Ec=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("slice",(function(t,e){for(var r=Ur(Ec(this),t,e),n=Es(this),o=0,i=r.length,a=new n(i);i>o;)a[o]=r[o++];return a}),j((function(){new Int8Array(1).slice()})));var Ac=Ei.some,Oc=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("some",(function(t){return Ac(Oc(this),t,arguments.length>1?arguments[1]:void 0)}));var Sc=Math.floor,Tc=function(t,e){var r=t.length,n=Sc(r/2);return r<8?kc(t,e):Ic(t,Tc(yu(t,0,n),e),Tc(yu(t,n),e),e)},kc=function(t,e){for(var r,n,o=t.length,i=1;i<o;){for(n=i,r=t[i];n&&e(t[n-1],r)>0;)t[n]=t[--n];n!==i++&&(t[n]=r)}return t},Ic=function(t,e,r,n){for(var o=e.length,i=r.length,a=0,u=0;a<o||u<i;)t[a+u]=a<o&&u<i?n(e[a],r[u])<=0?e[a++]:r[u++]:a<o?e[a++]:r[u++];return t},jc=Tc,Pc=X.match(/firefox\\/(\\d+)/i),_c=!!Pc&&+Pc[1],Mc=/MSIE|Trident/.test(X),Lc=X.match(/AppleWebKit\\/(\\d+)\\./),Rc=!!Lc&&+Lc[1],Cc=Qa.aTypedArray,Nc=Qa.exportTypedArrayMethod,Dc=O.Uint16Array,Fc=Dc&&Fr(Dc.prototype.sort),Wc=!(!Fc||j((function(){Fc(new Dc(2),null)}))&&j((function(){Fc(new Dc(2),{})}))),zc=!!Fc&&!j((function(){if(nt)return nt<74;if(_c)return _c<67;if(Mc)return!0;if(Rc)return Rc<602;var t,e,r=new Dc(516),n=Array(516);for(t=0;t<516;t++)e=t%4,r[t]=515-t,n[t]=t-2*e+3;for(Fc(r,(function(t,e){return(t/4|0)-(e/4|0)})),t=0;t<516;t++)if(r[t]!==n[t])return!0}));Nc("sort",(function(t){return void 0!==t&&Mt(t),zc?Fc(this,t):jc(Cc(this),function(t){return function(e,r){return void 0!==t?+t(e,r)||0:r!=r?-1:e!=e?1:0===e&&0===r?1/e>0&&1/r<0?1:-1:e>r}}(t))}),!zc||Wc);var Bc=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("subarray",(function(t,e){var r=Bc(this),n=r.length,o=Ce(t,n);return new(Es(r))(r.buffer,r.byteOffset+o*r.BYTES_PER_ELEMENT,De((void 0===e?n:Ce(e,n))-o))}));var Uc=O.Int8Array,Gc=Qa.aTypedArray,Hc=Qa.exportTypedArrayMethod,Vc=[].toLocaleString,qc=!!Uc&&j((function(){Vc.call(new Uc(1))}));Hc("toLocaleString",(function(){return Dr(Vc,qc?Ur(Gc(this)):Gc(this),Ur(arguments))}),j((function(){return[1,2].toLocaleString()!=new Uc([1,2]).toLocaleString()}))||!j((function(){Uc.prototype.toLocaleString.call([1,2])})));var Zc=Qa.exportTypedArrayMethod,Yc=O.Uint8Array,$c=Yc&&Yc.prototype||{},Kc=[].toString,Qc=R([].join);j((function(){Kc.call({})}))&&(Kc=function(){return Qc(this)});var Xc=$c.toString!=Kc;Zc("toString",Kc,Xc);var Jc,tf,ef=String,rf=function(t){if("Symbol"===me(t))throw TypeError("Cannot convert a Symbol value to a string");return ef(t)},nf=function(){var t=At(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e},of=O.RegExp,af=j((function(){var t=of("a","y");return t.lastIndex=2,null!=t.exec("abcd")})),uf=af||j((function(){return!of("a","y").sticky})),sf={BROKEN_CARET:af||j((function(){var t=of("^r","gy");return t.lastIndex=2,null!=t.exec("str")})),MISSED_STICKY:uf,UNSUPPORTED_Y:af},cf=O.RegExp,ff=j((function(){var t=cf(".","s");return!(t.dotAll&&t.exec("\\n")&&"s"===t.flags)})),lf=O.RegExp,hf=j((function(){var t=lf("(?<a>b)","g");return"b"!==t.exec("b").groups.a||"bc"!=="b".replace(t,"$<a>c")})),pf=ce.get,vf=I("native-string-replace",String.prototype.replace),df=RegExp.prototype.exec,yf=df,gf=R("".charAt),mf=R("".indexOf),xf=R("".replace),bf=R("".slice),wf=(tf=/b*/g,St(df,Jc=/a/,"a"),St(df,tf,"a"),0!==Jc.lastIndex||0!==tf.lastIndex),Ef=sf.BROKEN_CARET,Af=void 0!==/()??/.exec("")[1];(wf||Af||Ef||ff||hf)&&(yf=function(t){var e,r,n,o,i,a,u,s=this,c=pf(s),f=rf(t),l=c.raw;if(l)return l.lastIndex=s.lastIndex,e=St(yf,l,f),s.lastIndex=l.lastIndex,e;var h=c.groups,p=Ef&&s.sticky,v=St(nf,s),d=s.source,y=0,g=f;if(p&&(v=xf(v,"y",""),-1===mf(v,"g")&&(v+="g"),g=bf(f,s.lastIndex),s.lastIndex>0&&(!s.multiline||s.multiline&&"\\n"!==gf(f,s.lastIndex-1))&&(d="(?: "+d+")",g=" "+g,y++),r=new RegExp("^(?:"+d+")",v)),Af&&(r=new RegExp("^"+d+"$(?!\\\\s)",v)),wf&&(n=s.lastIndex),o=St(df,p?r:s,g),p?o?(o.input=bf(o.input,y),o[0]=bf(o[0],y),o.index=s.lastIndex,s.lastIndex+=o[0].length):s.lastIndex=0:wf&&o&&(s.lastIndex=s.global?o.index+o[0].length:n),Af&&o&&o.length>1&&St(vf,o[0],r,(function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(o[i]=void 0)})),o&&h)for(o.groups=a=Qi(null),i=0;i<h.length;i++)a[(u=h[i])[0]]=o[u[1]];return o});var Of=yf;ir({target:"RegExp",proto:!0,forced:/./.exec!==Of},{exec:Of});var Sf,Tf=ft("species"),kf=RegExp.prototype,If=function(t,e,r,n){var o=ft(t),i=!j((function(){var e={};return e[o]=function(){return 7},7!=""[t](e)})),a=i&&!j((function(){var e=!1,r=/a/;return"split"===t&&((r={}).constructor={},r.constructor[Tf]=function(){return r},r.flags="",r[o]=/./[o]),r.exec=function(){return e=!0,null},r[o](""),!e}));if(!i||!a||r){var u=Fr(/./[o]),s=e(o,""[t],(function(t,e,r,n,o){var a=Fr(t),s=e.exec;return s===Of||s===kf.exec?i&&!o?{done:!0,value:u(e,r,n)}:{done:!0,value:a(r,e,n)}:{done:!1}}));le(String.prototype,t,s[0]),le(kf,o,s[1])}n&&ee(kf[o],"sham",!0)},jf=R("".charAt),Pf=R("".charCodeAt),_f=R("".slice),Mf=function(t){return function(e,r){var n,o,i=rf(D(e)),a=Me(r),u=i.length;return a<0||a>=u?t?"":void 0:(n=Pf(i,a))<55296||n>56319||a+1===u||(o=Pf(i,a+1))<56320||o>57343?t?jf(i,a):n:t?_f(i,a,a+2):o-56320+(n-55296<<10)+65536}},Lf={codeAt:Mf(!1),charAt:Mf(!0)},Rf=Lf.charAt,Cf=function(t,e,r){return e+(r?Rf(t,e).length:1)},Nf=Math.floor,Df=R("".charAt),Ff=R("".replace),Wf=R("".slice),zf=/\\$([$&'\`]|\\d{1,2}|<[^>]*>)/g,Bf=/\\$([$&'\`]|\\d{1,2})/g,Uf=function(t,e,r,n,o,i){var a=r+t.length,u=n.length,s=Bf;return void 0!==o&&(o=W(o),s=zf),Ff(i,s,(function(i,s){var c;switch(Df(s,0)){case"$":return"$";case"&":return t;case"\`":return Wf(e,0,r);case"'":return Wf(e,a);case"<":c=o[Wf(s,1,-1)];break;default:var f=+s;if(0===f)return i;if(f>u){var l=Nf(f/10);return 0===l?i:l<=u?void 0===n[l-1]?Df(s,1):n[l-1]+Df(s,1):i}c=n[f-1]}return void 0===c?"":c}))},Gf=TypeError,Hf=function(t,e){var r=t.exec;if($(r)){var n=St(r,t,e);return null!==n&&At(n),n}if("RegExp"===ve(t))return St(Of,t,e);throw Gf("RegExp#exec called on incompatible receiver")},Vf=ft("replace"),qf=Math.max,Zf=Math.min,Yf=R([].concat),$f=R([].push),Kf=R("".indexOf),Qf=R("".slice),Xf="$0"==="a".replace(/./,"$0"),Jf=!!/./[Vf]&&""===/./[Vf]("a","$0");function tl(t){this.message=t}If("replace",(function(t,e,r){var n=Jf?"$":"$0";return[function(t,r){var n=D(this),o=C(t)?void 0:Lt(t,Vf);return o?St(o,t,n,r):St(e,rf(n),t,r)},function(t,o){var i=At(this),a=rf(t);if("string"==typeof o&&-1===Kf(o,n)&&-1===Kf(o,"$<")){var u=r(e,i,a,o);if(u.done)return u.value}var s=$(o);s||(o=rf(o));var c=i.global;if(c){var f=i.unicode;i.lastIndex=0}for(var l=[];;){var h=Hf(i,a);if(null===h)break;if($f(l,h),!c)break;""===rf(h[0])&&(i.lastIndex=Cf(a,De(i.lastIndex),f))}for(var p,v="",d=0,y=0;y<l.length;y++){for(var g=rf((h=l[y])[0]),m=qf(Zf(Me(h.index),a.length),0),x=[],b=1;b<h.length;b++)$f(x,void 0===(p=h[b])?p:String(p));var w=h.groups;if(s){var E=Yf([g],x,m,a);void 0!==w&&$f(E,w);var A=rf(Dr(o,void 0,E))}else A=Uf(g,a,m,x,w,o);m>=d&&(v+=Qf(a,d,m)+A,d=m+g.length)}return v+Qf(a,d)}]}),!!j((function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")}))||!Xf||Jf),tl.prototype=new Error,tl.prototype.name="InvalidCharacterError",ir({global:!0,forced:O.globalThis!==O},{globalThis:O}),Sf="undefined"==typeof window?{devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(t){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(t){return null},clearMeasures:function(t){return null},clearMarks:function(t){return null},measure:function(t,e,r){return{duration:0}},now:function(){return(new Date).getTime()}},Blob:"",dispatchEvent:function(t){return!0},Event:function(t,e){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:window,"undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM?my.getSystemInfoSync().pixelRatio:Sf.devicePixelRatio;var el=TypeError,rl=Object.getOwnPropertyDescriptor,nl=pt&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}}()?function(t,e){if(yi(t)&&!rl(t,"length").writable)throw el("Cannot set read only .length");return t.length=e}:function(t,e){return t.length=e},ol=TypeError,il=function(t){if(t>9007199254740991)throw ol("Maximum allowed index exceeded");return t},al=Pi("splice"),ul=Math.max,sl=Math.min;ir({target:"Array",proto:!0,forced:!al},{splice:function(t,e){var r,n,o,i,a,u,s=W(this),c=Fe(s),f=Ce(t,c),l=arguments.length;for(0===l?r=n=0:1===l?(r=0,n=c-f):(r=l-2,n=sl(ul(Me(e),0),c-f)),il(c+r-n),o=xi(s,n),i=0;i<n;i++)(a=f+i)in s&&Ii(o,i,s[a]);if(o.length=n,r<n){for(i=f;i<c-n;i++)u=i+r,(a=i+n)in s?s[u]=s[a]:ls(s,u);for(i=c;i>c-n+r;i--)ls(s,i-1)}else if(r>n)for(i=c-n;i>f;i--)u=i+r-1,(a=i+n-1)in s?s[u]=s[a]:ls(s,u);for(i=0;i<r;i++)s[i+f]=arguments[i+2];return nl(s,c-n+r),o}});var cl=u((function t(e,r){i(this,t),s(this,"cancelBubble",void 0),s(this,"cancelable",void 0),s(this,"target",void 0),s(this,"currentTarget",void 0),s(this,"preventDefault",void 0),s(this,"stopPropagation",void 0),s(this,"type",void 0),s(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=e,this.timeStamp=Date.now()})),fl=Object.assign,ll=Object.defineProperty,hl=R([].concat),pl=!fl||j((function(){if(pt&&1!==fl({b:1},fl(ll({},"a",{enumerable:!0,get:function(){ll(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},e={},r=Symbol();return t[r]=7,"abcdefghijklmnopqrst".split("").forEach((function(t){e[t]=t})),7!=fl({},t)[r]||"abcdefghijklmnopqrst"!=Hi(fl({},e)).join("")}))?function(t,e){for(var r=W(t),n=arguments.length,o=1,i=Ze.f,a=Ee.f;n>o;)for(var u,s=Se(arguments[o++]),c=i?hl(Hi(s),i(s)):Hi(s),f=c.length,l=0;f>l;)u=c[l++],pt&&!St(a,s,u)||(r[u]=s[u]);return r}:fl;ir({target:"Object",stat:!0,arity:2,forced:Object.assign!==pl},{assign:pl});var vl=Ei.findIndex,dl=!0;"findIndex"in[]&&Array(1).findIndex((function(){dl=!1})),ir({target:"Array",proto:!0,forced:dl},{findIndex:function(t){return vl(this,t,arguments.length>1?arguments[1]:void 0)}}),oa("findIndex");var yl=Lf.charAt,gl=ce.set,ml=ce.getterFor("String Iterator");wa(String,"String",(function(t){gl(this,{type:"String Iterator",string:rf(t),index:0})}),(function(){var t,e=ml(this),r=e.string,n=e.index;return n>=r.length?Ea(void 0,!0):(t=yl(r,n),e.index+=t.length,Ea(t,!1))}));var xl=qe.f,bl="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],wl={f:function(t){return bl&&"Window"==ve(t)?function(t){try{return xl(t)}catch(t){return yu(bl)}}(t):xl(Te(t))}},El=j((function(){if("function"==typeof ArrayBuffer){var t=new ArrayBuffer(8);Object.isExtensible(t)&&Object.defineProperty(t,"a",{value:8})}})),Al=Object.isExtensible,Ol=j((function(){Al(1)}))||El?function(t){return!!dt(t)&&((!El||"ArrayBuffer"!=ve(t))&&(!Al||Al(t)))}:Al,Sl=!j((function(){return Object.isExtensible(Object.preventExtensions({}))})),Tl=b((function(t){var e=Ut.f,r=!1,n=V("meta"),o=0,i=function(t){e(t,n,{value:{objectID:"O"+o++,weakData:{}}})},a=t.exports={enable:function(){a.enable=function(){},r=!0;var t=qe.f,e=R([].splice),o={};o[n]=1,t(o).length&&(qe.f=function(r){for(var o=t(r),i=0,a=o.length;i<a;i++)if(o[i]===n){e(o,i,1);break}return o},ir({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:wl.f}))},fastKey:function(t,e){if(!dt(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!B(t,n)){if(!Ol(t))return"F";if(!e)return"E";i(t)}return t[n].objectID},getWeakData:function(t,e){if(!B(t,n)){if(!Ol(t))return!0;if(!e)return!1;i(t)}return t[n].weakData},onFreeze:function(t){return Sl&&r&&Ol(t)&&!B(t,n)&&i(t),t}};oe[n]=!0})),kl=(Tl.enable,Tl.fastKey,Tl.getWeakData,Tl.onFreeze,function(t,e,r){var n=-1!==t.indexOf("Map"),o=-1!==t.indexOf("Weak"),i=n?"set":"add",a=O[t],u=a&&a.prototype,s=a,c={},f=function(t){var e=R(u[t]);le(u,t,"add"==t?function(t){return e(this,0===t?0:t),this}:"delete"==t?function(t){return!(o&&!dt(t))&&e(this,0===t?0:t)}:"get"==t?function(t){return o&&!dt(t)?void 0:e(this,0===t?0:t)}:"has"==t?function(t){return!(o&&!dt(t))&&e(this,0===t?0:t)}:function(t,r){return e(this,0===t?0:t,r),this})};if(nr(t,!$(a)||!(o||u.forEach&&!j((function(){(new a).entries().next()})))))s=r.getConstructor(e,t,n,i),Tl.enable();else if(nr(t,!0)){var l=new s,h=l[i](o?{}:-0,1)!=l,p=j((function(){l.has(1)})),v=_o((function(t){new a(t)})),d=!o&&j((function(){for(var t=new a,e=5;e--;)t[i](e,e);return!t.has(-0)}));v||((s=e((function(t,e){yr(t,u);var r=ss(new a,t,s);return C(e)||To(e,r[i],{that:r,AS_ENTRIES:n}),r}))).prototype=u,u.constructor=s),(p||d)&&(f("delete"),f("has"),n&&f("get")),(d||h)&&f(i),o&&u.clear&&delete u.clear}return c[t]=s,ir({global:!0,constructor:!0,forced:s!=a},c),hr(s,t),o||r.setStrong(s,t,n),s}),Il=Tl.getWeakData,jl=ce.set,Pl=ce.getterFor,_l=Ei.find,Ml=Ei.findIndex,Ll=R([].splice),Rl=0,Cl=function(t){return t.frozen||(t.frozen=new Nl)},Nl=function(){this.entries=[]},Dl=function(t,e){return _l(t.entries,(function(t){return t[0]===e}))};Nl.prototype={get:function(t){var e=Dl(this,t);if(e)return e[1]},has:function(t){return!!Dl(this,t)},set:function(t,e){var r=Dl(this,t);r?r[1]=e:this.entries.push([t,e])},delete:function(t){var e=Ml(this.entries,(function(e){return e[0]===t}));return~e&&Ll(this.entries,e,1),!!~e}};var Fl,Wl={getConstructor:function(t,e,r,n){var o=t((function(t,o){yr(t,i),jl(t,{type:e,id:Rl++,frozen:void 0}),C(o)||To(o,t[n],{that:t,AS_ENTRIES:r})})),i=o.prototype,a=Pl(e),u=function(t,e,r){var n=a(t),o=Il(At(e),!0);return!0===o?Cl(n).set(e,r):o[n.id]=r,t};return ru(i,{delete:function(t){var e=a(this);if(!dt(t))return!1;var r=Il(t);return!0===r?Cl(e).delete(t):r&&B(r,e.id)&&delete r[e.id]},has:function(t){var e=a(this);if(!dt(t))return!1;var r=Il(t);return!0===r?Cl(e).has(t):r&&B(r,e.id)}}),ru(i,r?{get:function(t){var e=a(this);if(dt(t)){var r=Il(t);return!0===r?Cl(e).get(t):r?r[e.id]:void 0}},set:function(t,e){return u(this,t,e)}}:{add:function(t){return u(this,t,!0)}}),o}},zl=ce.enforce,Bl=!O.ActiveXObject&&"ActiveXObject"in O,Ul=function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}},Gl=kl("WeakMap",Ul,Wl);if(Jt&&Bl){Fl=Wl.getConstructor(Ul,"WeakMap",!0),Tl.enable();var Hl=Gl.prototype,Vl=R(Hl.delete),ql=R(Hl.has),Zl=R(Hl.get),Yl=R(Hl.set);ru(Hl,{delete:function(t){if(dt(t)&&!Ol(t)){var e=zl(this);return e.frozen||(e.frozen=new Fl),Vl(this,t)||e.frozen.delete(t)}return Vl(this,t)},has:function(t){if(dt(t)&&!Ol(t)){var e=zl(this);return e.frozen||(e.frozen=new Fl),ql(this,t)||e.frozen.has(t)}return ql(this,t)},get:function(t){if(dt(t)&&!Ol(t)){var e=zl(this);return e.frozen||(e.frozen=new Fl),ql(this,t)?Zl(this,t):e.frozen.get(t)}return Zl(this,t)},set:function(t,e){if(dt(t)&&!Ol(t)){var r=zl(this);r.frozen||(r.frozen=new Fl),ql(this,t)?Yl(this,t,e):r.frozen.set(t,e)}else Yl(this,t,e);return this}})}var $l=ft("iterator"),Kl=ft("toStringTag"),Ql=Ta.values,Xl=function(t,e){if(t){if(t[$l]!==Ql)try{ee(t,$l,Ql)}catch(e){t[$l]=Ql}if(t[Kl]||ee(t,Kl,e),hi[e])for(var r in Ta)if(t[r]!==Ta[r])try{ee(t,r,Ta[r])}catch(e){t[r]=Ta[r]}}};for(var Jl in hi)Xl(O[Jl]&&O[Jl].prototype,Jl);Xl(di,"DOMTokenList");var th,eh,rh,nh,oh=new WeakMap,ih=function(){function t(){i(this,t),oh.set(this,{})}return u(t,[{key:"addEventListener",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=oh.get(this);n||(n={}),n[t]||(n[t]=[]),n[t].push(e),oh.set(this,n),r.capture,r.once,r.passive}},{key:"removeEventListener",value:function(t,e){var r=oh.get(this);if(r){var n=r[t];if(n&&n.length>0)for(var o=n.length;o--;o>0)if(n[o]===e){n.splice(o,1);break}}}},{key:"dispatchEvent",value:function(t){var e=oh.get(this)[t.type];if(e){var r,n=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=g(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){u=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw i}}}}(e);try{for(n.s();!(r=n.n()).done;){(0,r.value)(t)}}catch(t){n.e(t)}finally{n.f()}}}}]),t}(),ah=function(t){c(r,t);var e=v(r);function r(){var t;return i(this,r),s(h(t=e.call(this)),"className",void 0),s(h(t),"children",void 0),t.className="",t.children=[],t}return u(r,[{key:"setAttribute",value:function(t,e){this[t]=e}},{key:"getAttribute",value:function(t){return this[t]}},{key:"setAttributeNS",value:function(t,e){this[t]=e}},{key:"getAttributeNS",value:function(t){return this[t]}}]),r}(function(t){c(r,t);var e=v(r);function r(){var t;return i(this,r),s(h(t=e.call(this)),"childNodes",void 0),t.childNodes=[],t}return u(r,[{key:"appendChild",value:function(t){this.childNodes.push(t)}},{key:"cloneNode",value:function(){var t=Object.create(this);return Object.assign(t,this),t}},{key:"removeChild",value:function(t){var e=this.childNodes.findIndex((function(e){return e===t}));return e>-1?this.childNodes.splice(e,1):null}}]),r}(ih));if("undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM){var uh=my.getSystemInfoSync();th=uh.screenWidth,eh=uh.screenHeight,rh=uh.windowWidth,nh=uh.windowHeight}else{var sh=Sf.innerWidth,ch=Sf.innerHeight;th=sh,eh=ch,rh=sh,nh=ch}var fh={width:th,height:eh,availWidth:rh,availHeight:nh,availLeft:0,availTop:0},lh=fh.availWidth,hh=fh.availHeight,ph={style:[]};function vh(t,e){var r,n;"parentNode"in t||(r=0===e?function(){return null}:1===e?function(){return ph}:function(){return null},Object.defineProperty(t,"parentNode",{enumerable:!0,get:r}));"parentElement"in t||(n=0===e?function(){return null}:1===e?function(){return ph}:function(){return null},Object.defineProperty(t,"parentElement",{enumerable:!0,get:n}))}function dh(t){t.style=t.style||{},Object.assign(t.style,{top:"0px",left:"0px",width:lh+"px",height:hh+"px",margin:"0px",padding:"0px"})}function yh(t){"clientLeft"in t||(t.clientLeft=0,t.clientTop=0),"clientWidth"in t||(t.clientWidth=lh,t.clientHeight=hh),"getBoundingClientRect"in t||(t.getBoundingClientRect=function(){return{x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight}})}function gh(t){"offsetLeft"in t||(t.offsetLeft=0,t.offsetTop=0),"offsetWidth"in t||(t.offsetWidth=lh,t.offsetHeight=hh)}function mh(t){"scrollLeft"in t||(t.scrollLeft=0,t.scrollTop=0),"scrollWidth"in t||(t.scrollWidth=lh,t.scrollHeight=hh)}function xh(t){var e=function(){return!0};t.classList=[],t.classList.add=e,t.classList.remove=e,t.classList.contains=e,t.classList.toggle=e}function bh(){}var wh=function(t){c(r,t);var e=v(r);function r(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",o=arguments.length>1?arguments[1]:void 0;return i(this,r),s(h(t=e.call(this)),"className",void 0),s(h(t),"children",void 0),s(h(t),"focus",void 0),s(h(t),"blur",void 0),s(h(t),"insertBefore",void 0),s(h(t),"appendChild",void 0),s(h(t),"removeChild",void 0),s(h(t),"remove",void 0),s(h(t),"innerHTML",void 0),s(h(t),"tagName",void 0),t.className="",t.children=[],t.focus=bh,t.blur=bh,t.insertBefore=bh,t.appendChild=bh,t.removeChild=bh,t.remove=bh,t.innerHTML="",t.tagName=n.toUpperCase(),vh(h(t),o),dh(h(t)),xh(h(t)),yh(h(t)),gh(h(t)),mh(h(t)),t}return u(r)}(ah),Eh=function(t){c(r,t);var e=v(r);function r(){return i(this,r),e.call(this,"video")}return u(r)}(function(t){c(r,t);var e=v(r);function r(t){return i(this,r),e.call(this,t)}return u(r,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),r}(wh)),Ah={};function Oh(){return Ah}var Sh=u((function t(){i(this,t);var e=Oh(),r=e.createImage&&e.createImage()||{};return"tagName"in r||(r.tagName="IMG",r.__proto__=t.prototype),vh(r),xh(r),Object.assign(r,{addEventListener:function(t,e){r["on".concat(t)]=e.bind(r)},removeEventListener:function(t){r["on".concat(t)]=null}}),r})),Th={href:"",protocol:"",host:""},kh=function(t){c(r,t);var e=v(r);function r(){return i(this,r),e.call(this,"body",0)}return u(r,[{key:"addEventListener",value:function(t,e){}},{key:"removeEventListener",value:function(t,e,r){}},{key:"dispatchEvent",value:function(t){}}]),r}(wh),Ih=function(t){c(r,t);var e=v(r);function r(){return i(this,r),e.call(this,"html",0)}return u(r,[{key:"addEventListener",value:function(t,e){}},{key:"removeEventListener",value:function(t,e){}},{key:"dispatchEvent",value:function(t){}}]),r}(wh),jh={},Ph={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:Th,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(t){return"canvas"===(t=t.toLowerCase())?my.createOffscreenCanvas(1024,128,"2d"):"img"===t?new Sh:"video"===t?new Eh:new wh(t)},createElementNS:function(t,e){return this.createElement(e)},createTextNode:function(t){return t},getElementById:function(t){return null},getElementsByTagName:function(t){return t=t.toLowerCase(),[]},getElementsByTagNameNS:function(t,e){return this.getElementsByTagName(e)},getElementsByName:function(t){return[]},querySelector:function(t){return null},querySelectorAll:function(t){return[]},addEventListener:function(t,e,r){jh[t]||(jh[t]=[]),jh[t].push(e)},removeEventListener:function(t,e){var r=jh[t];if(r&&r.length>0)for(var n=r.length;n--;n>0)if(r[n]===e){r.splice(n,1);break}},dispatchEvent:function(t){var e=t.type,r=jh[e];if(r)for(var n=0;n<r.length;n++)r[n](t);t.target&&"function"==typeof t.target["on"+e]&&t.target["on"+e](t)},createEvent:function(t){return new cl(t)}};Ph.documentElement=new Ih,Ph.head=new wh("head"),Ph.body=new kh,If("match",(function(t,e,r){return[function(e){var r=D(this),n=C(e)?void 0:Lt(e,t);return n?St(n,e,r):new RegExp(e)[t](rf(r))},function(t){var n=At(this),o=rf(t),i=r(e,n,o);if(i.done)return i.value;if(!n.global)return Hf(n,o);var a=n.unicode;n.lastIndex=0;for(var u,s=[],c=0;null!==(u=Hf(n,o));){var f=rf(u[0]);s[c]=f,""===f&&(n.lastIndex=Cf(o,De(n.lastIndex),a)),c++}return 0===c?null:s}]}));var _h,Mh,Lh=ft("isConcatSpreadable"),Rh=nt>=51||!j((function(){var t=[];return t[Lh]=!1,t.concat()[0]!==t})),Ch=Pi("concat"),Nh=function(t){if(!dt(t))return!1;var e=t[Lh];return void 0!==e?!!e:yi(t)};if(ir({target:"Array",proto:!0,arity:1,forced:!Rh||!Ch},{concat:function(t){var e,r,n,o,i,a=W(this),u=xi(a,0),s=0;for(e=-1,n=arguments.length;e<n;e++)if(Nh(i=-1===e?a:arguments[e]))for(o=Fe(i),il(s+o),r=0;r<o;r++,s++)r in i&&Ii(u,s,i[r]);else il(s+1),Ii(u,s++,i);return u.length=s,u}}),"undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM){var Dh=my.getSystemInfoSync();_h=Dh.system,Dh.platform,Dh.language}else{var Fh={versions:(Mh=Sf.navigator.userAgent,{trident:Mh.indexOf("Trident")>-1,presto:Mh.indexOf("Presto")>-1,webKit:Mh.indexOf("AppleWebKit")>-1,gecko:Mh.indexOf("Gecko")>-1&&-1===Mh.indexOf("KHTML"),mobile:!!Mh.match(/AppleWebKit.*Mobile.*/),ios:!!Mh.match(/\\(i[^;]+;( U;)? CPU.+Mac OS X/),android:Mh.indexOf("Android")>-1||Mh.indexOf("Linux")>-1,iPhone:Mh.indexOf("iPhone")>-1,iPad:Mh.indexOf("iPad")>-1,webApp:-1===Mh.indexOf("Safari"),weixin:Mh.indexOf("MicroMessenger")>-1,qq:" qq"===Mh.match(/\\sQQ/i)}),language:(Sf.navigator.browserLanguage||Sf.navigator.language).toLowerCase()};Fh.versions.android?"android":Fh.versions.trident?"IE":Fh.versions.presto?"Opera":Fh.versions.webKit?"webKit":Fh.versions.gecko?"Firefox":Fh.versions.mobile?"mobile":Fh.versions.ios?"ios":Fh.versions.iPhone?"iPhone":Fh.versions.iPad?"ipad":Fh.versions.webApp?"webApp":Fh.versions.weixin?"weixin":Fh.versions.qq&&"qq",_h=Sf.navigator.userAgent,Fh.language}_h.toLowerCase().indexOf("android");cs("Uint8",(function(t){return function(e,r,n){return t(this,e,r,n)}}));var Wh=Ut.f,zh=Tl.fastKey,Bh=ce.set,Uh=ce.getterFor;kl("Map",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),{getConstructor:function(t,e,r,n){var o=t((function(t,o){yr(t,i),Bh(t,{type:e,index:Qi(null),first:void 0,last:void 0,size:0}),pt||(t.size=0),C(o)||To(o,t[n],{that:t,AS_ENTRIES:r})})),i=o.prototype,a=Uh(e),u=function(t,e,r){var n,o,i=a(t),u=s(t,e);return u?u.value=r:(i.last=u={index:o=zh(e,!0),key:e,value:r,previous:n=i.last,next:void 0,removed:!1},i.first||(i.first=u),n&&(n.next=u),pt?i.size++:t.size++,"F"!==o&&(i.index[o]=u)),t},s=function(t,e){var r,n=a(t),o=zh(e);if("F"!==o)return n.index[o];for(r=n.first;r;r=r.next)if(r.key==e)return r};return ru(i,{clear:function(){for(var t=a(this),e=t.index,r=t.first;r;)r.removed=!0,r.previous&&(r.previous=r.previous.next=void 0),delete e[r.index],r=r.next;t.first=t.last=void 0,pt?t.size=0:this.size=0},delete:function(t){var e=a(this),r=s(this,t);if(r){var n=r.next,o=r.previous;delete e.index[r.index],r.removed=!0,o&&(o.next=n),n&&(n.previous=o),e.first==r&&(e.first=n),e.last==r&&(e.last=o),pt?e.size--:this.size--}return!!r},forEach:function(t){for(var e,r=a(this),n=zr(t,arguments.length>1?arguments[1]:void 0);e=e?e.next:r.first;)for(n(e.value,e.key,this);e&&e.removed;)e=e.previous},has:function(t){return!!s(this,t)}}),ru(i,r?{get:function(t){var e=s(this,t);return e&&e.value},set:function(t,e){return u(this,0===t?0:t,e)}}:{add:function(t){return u(this,t=0===t?0:t,t)}}),pt&&Wh(i,"size",{get:function(){return a(this).size}}),o},setStrong:function(t,e,r){var n=e+" Iterator",o=Uh(e),i=Uh(n);wa(t,e,(function(t,e){Bh(this,{type:n,target:t,state:o(t),kind:e,last:void 0})}),(function(){for(var t=i(this),e=t.kind,r=t.last;r&&r.removed;)r=r.previous;return t.target&&(t.last=r=r?r.next:t.state.first)?Ea("keys"==e?r.key:"values"==e?r.value:[r.key,r.value],!1):(t.target=void 0,Ea(void 0,!0))}),r?"entries":"values",!r,!0),vr(e)}});var Gh=R([].join),Hh=Se!=Object,Vh=Ai("join",",");ir({target:"Array",proto:!0,forced:Hh||!Vh},{join:function(t){return Gh(Te(this),void 0===t?",":t)}});var qh=j((function(){Hi(1)}));ir({target:"Object",stat:!0,forced:qh},{keys:function(t){return Hi(W(t))}});var Zh=new Map,Yh=new Map,$h=new Map,Kh=function(t){c(r,t);var e=v(r);function r(){var t;return i(this,r),s(h(t=e.call(this)),"onabort",void 0),s(h(t),"onerror",void 0),s(h(t),"onload",void 0),s(h(t),"onloadstart",void 0),s(h(t),"onprogress",void 0),s(h(t),"ontimeout",void 0),s(h(t),"onloadend",void 0),s(h(t),"onreadystatechange",void 0),s(h(t),"readyState",void 0),s(h(t),"response",void 0),s(h(t),"responseText",void 0),s(h(t),"_responseType",void 0),s(h(t),"responseXML",void 0),s(h(t),"status",void 0),s(h(t),"statusText",void 0),s(h(t),"upload",void 0),s(h(t),"withCredentials",void 0),s(h(t),"timeout",void 0),s(h(t),"_url",void 0),s(h(t),"_method",void 0),t.onabort=null,t.onerror=null,t.onload=null,t.onloadstart=null,t.onprogress=null,t.ontimeout=null,t.onloadend=null,t.onreadystatechange=null,t.readyState=0,t.response=null,t.responseText=null,t._responseType="text",t.responseXML=null,t.status=0,t.statusText="",t.upload={},t.withCredentials=!1,Zh.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),t}return u(r,[{key:"responseType",set:function(t){this._responseType=t}},{key:"abort",value:function(){var t=$h.get("requestTask");t&&t.abort()}},{key:"getAllResponseHeaders",value:function(){var t=Yh.get("responseHeader");return Object.keys(t).map((function(e){return"".concat(e,": ").concat(t[e])})).join("\\n")}},{key:"getResponseHeader",value:function(t){return Yh.get("responseHeader")[t]}},{key:"open",value:function(t,e,r){this._method=t,this._url=e}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){}},{key:"setRequestHeader",value:function(t,e){var r=Zh.get("requestHeader");r[t]=e,Zh.set("requestHeader",r)}},{key:"addEventListener",value:function(t,e){var r=this;"function"==typeof e&&(this["on"+t]=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.target=t.target||r,e.call(r,t)})}},{key:"removeEventListener",value:function(t,e){this["on"+t]===e&&(this["on"+t]=null)}}]),r}(ih);s(Kh,"UNSEND",void 0),s(Kh,"OPENED",void 0),s(Kh,"HEADERS_RECEIVED",void 0),s(Kh,"LOADING",void 0),s(Kh,"DONE",void 0),Kh.UNSEND=0,Kh.OPENED=1,Kh.HEADERS_RECEIVED=2,Kh.LOADING=3,Kh.DONE=4;var Qh="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,Xh="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram),Jh=Qh||Xh;Jh||Sf.XMLHttpRequest,Jh||Sf.location;function tp(t){return[t+1&255,t+1>>8&255,t+1>>8>>8&255]}var ep=Ei.filter,rp=Pi("filter");function np(t){var e=t.color;return e&&e.length?e:[1,1,1,1]}function op(t,e,r){return 2===r.length?[r[0],r[1],0]:[r[0],r[1],r[2]]}function ip(t){return t.filter?[1]:[0]}function ap(t,e){return[e]}ir({target:"Array",proto:!0,forced:!rp},{filter:function(t){return ep(this,t,arguments.length>1?arguments[1]:void 0)}});var up=cp,sp=cp;function cp(t,e,r){r=r||2;var n,o,i,a,u,s,c,f=e&&e.length,l=f?e[0]*r:t.length,h=fp(t,0,l,r,!0),p=[];if(!h||h.next===h.prev)return p;if(f&&(h=function(t,e,r,n){var o,i,a,u,s,c=[];for(o=0,i=e.length;o<i;o++)a=e[o]*n,u=o<i-1?e[o+1]*n:t.length,(s=fp(t,a,u,n,!1))===s.next&&(s.steiner=!0),c.push(wp(s));for(c.sort(gp),o=0;o<c.length;o++)r=mp(c[o],r);return r}(t,e,h,r)),t.length>80*r){n=i=t[0],o=a=t[1];for(var v=r;v<l;v+=r)(u=t[v])<n&&(n=u),(s=t[v+1])<o&&(o=s),u>i&&(i=u),s>a&&(a=s);c=0!==(c=Math.max(i-n,a-o))?32767/c:0}return hp(h,p,r,n,o,c,0),p}function fp(t,e,r,n,o){var i,a;if(o===Rp(t,e,r,n)>0)for(i=e;i<r;i+=n)a=_p(i,t[i],t[i+1],a);else for(i=r-n;i>=e;i-=n)a=_p(i,t[i],t[i+1],a);return a&&Sp(a,a.next)&&(Mp(a),a=a.next),a}function lp(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!Sp(n,n.next)&&0!==Op(n.prev,n,n.next))n=n.next;else{if(Mp(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function hp(t,e,r,n,o,i,a){if(t){!a&&i&&function(t,e,r,n){var o=t;do{0===o.z&&(o.z=bp(o.x,o.y,e,r,n)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next}while(o!==t);o.prevZ.nextZ=null,o.prevZ=null,function(t){var e,r,n,o,i,a,u,s,c=1;do{for(r=t,t=null,i=null,a=0;r;){for(a++,n=r,u=0,e=0;e<c&&(u++,n=n.nextZ);e++);for(s=c;u>0||s>0&&n;)0!==u&&(0===s||!n||r.z<=n.z)?(o=r,r=r.nextZ,u--):(o=n,n=n.nextZ,s--),i?i.nextZ=o:t=o,o.prevZ=i,i=o;r=n}i.nextZ=null,c*=2}while(a>1)}(o)}(t,n,o,i);for(var u,s,c=t;t.prev!==t.next;)if(u=t.prev,s=t.next,i?vp(t,n,o,i):pp(t))e.push(u.i/r|0),e.push(t.i/r|0),e.push(s.i/r|0),Mp(t),t=s.next,c=s.next;else if((t=s)===c){a?1===a?hp(t=dp(lp(t),e,r),e,r,n,o,i,2):2===a&&yp(t,e,r,n,o,i):hp(lp(t),e,r,n,o,i,1);break}}}function pp(t){var e=t.prev,r=t,n=t.next;if(Op(e,r,n)>=0)return!1;for(var o=e.x,i=r.x,a=n.x,u=e.y,s=r.y,c=n.y,f=o<i?o<a?o:a:i<a?i:a,l=u<s?u<c?u:c:s<c?s:c,h=o>i?o>a?o:a:i>a?i:a,p=u>s?u>c?u:c:s>c?s:c,v=n.next;v!==e;){if(v.x>=f&&v.x<=h&&v.y>=l&&v.y<=p&&Ep(o,u,i,s,a,c,v.x,v.y)&&Op(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function vp(t,e,r,n){var o=t.prev,i=t,a=t.next;if(Op(o,i,a)>=0)return!1;for(var u=o.x,s=i.x,c=a.x,f=o.y,l=i.y,h=a.y,p=u<s?u<c?u:c:s<c?s:c,v=f<l?f<h?f:h:l<h?l:h,d=u>s?u>c?u:c:s>c?s:c,y=f>l?f>h?f:h:l>h?l:h,g=bp(p,v,e,r,n),m=bp(d,y,e,r,n),x=t.prevZ,b=t.nextZ;x&&x.z>=g&&b&&b.z<=m;){if(x.x>=p&&x.x<=d&&x.y>=v&&x.y<=y&&x!==o&&x!==a&&Ep(u,f,s,l,c,h,x.x,x.y)&&Op(x.prev,x,x.next)>=0)return!1;if(x=x.prevZ,b.x>=p&&b.x<=d&&b.y>=v&&b.y<=y&&b!==o&&b!==a&&Ep(u,f,s,l,c,h,b.x,b.y)&&Op(b.prev,b,b.next)>=0)return!1;b=b.nextZ}for(;x&&x.z>=g;){if(x.x>=p&&x.x<=d&&x.y>=v&&x.y<=y&&x!==o&&x!==a&&Ep(u,f,s,l,c,h,x.x,x.y)&&Op(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;b&&b.z<=m;){if(b.x>=p&&b.x<=d&&b.y>=v&&b.y<=y&&b!==o&&b!==a&&Ep(u,f,s,l,c,h,b.x,b.y)&&Op(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function dp(t,e,r){var n=t;do{var o=n.prev,i=n.next.next;!Sp(o,i)&&Tp(o,n,n.next,i)&&jp(o,i)&&jp(i,o)&&(e.push(o.i/r|0),e.push(n.i/r|0),e.push(i.i/r|0),Mp(n),Mp(n.next),n=t=i),n=n.next}while(n!==t);return lp(n)}function yp(t,e,r,n,o,i){var a=t;do{for(var u=a.next.next;u!==a.prev;){if(a.i!==u.i&&Ap(a,u)){var s=Pp(a,u);return a=lp(a,a.next),s=lp(s,s.next),hp(a,e,r,n,o,i,0),void hp(s,e,r,n,o,i,0)}u=u.next}a=a.next}while(a!==t)}function gp(t,e){return t.x-e.x}function mp(t,e){var r=function(t,e){var r,n=e,o=t.x,i=t.y,a=-1/0;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){var u=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(u<=o&&u>a&&(a=u,r=n.x<n.next.x?n:n.next,u===o))return r}n=n.next}while(n!==e);if(!r)return null;var s,c=r,f=r.x,l=r.y,h=1/0;n=r;do{o>=n.x&&n.x>=f&&o!==n.x&&Ep(i<l?o:a,i,f,l,i<l?a:o,i,n.x,n.y)&&(s=Math.abs(i-n.y)/(o-n.x),jp(n,t)&&(s<h||s===h&&(n.x>r.x||n.x===r.x&&xp(r,n)))&&(r=n,h=s)),n=n.next}while(n!==c);return r}(t,e);if(!r)return e;var n=Pp(r,t);return lp(n,n.next),lp(r,r.next)}function xp(t,e){return Op(t.prev,t,e.prev)<0&&Op(e.next,t,t.next)<0}function bp(t,e,r,n,o){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*o|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*o|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function wp(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function Ep(t,e,r,n,o,i,a,u){return(o-a)*(e-u)>=(t-a)*(i-u)&&(t-a)*(n-u)>=(r-a)*(e-u)&&(r-a)*(i-u)>=(o-a)*(n-u)}function Ap(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&Tp(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&(jp(t,e)&&jp(e,t)&&function(t,e){var r=t,n=!1,o=(t.x+e.x)/2,i=(t.y+e.y)/2;do{r.y>i!=r.next.y>i&&r.next.y!==r.y&&o<(r.next.x-r.x)*(i-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}(t,e)&&(Op(t.prev,t,e.prev)||Op(t,e.prev,e))||Sp(t,e)&&Op(t.prev,t,t.next)>0&&Op(e.prev,e,e.next)>0)}function Op(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function Sp(t,e){return t.x===e.x&&t.y===e.y}function Tp(t,e,r,n){var o=Ip(Op(t,e,r)),i=Ip(Op(t,e,n)),a=Ip(Op(r,n,t)),u=Ip(Op(r,n,e));return o!==i&&a!==u||(!(0!==o||!kp(t,r,e))||(!(0!==i||!kp(t,n,e))||(!(0!==a||!kp(r,t,n))||!(0!==u||!kp(r,e,n)))))}function kp(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function Ip(t){return t>0?1:t<0?-1:0}function jp(t,e){return Op(t.prev,t,t.next)<0?Op(t,e,t.next)>=0&&Op(t,t.prev,e)>=0:Op(t,e,t.prev)<0||Op(t,t.next,e)<0}function Pp(t,e){var r=new Lp(t.i,t.x,t.y),n=new Lp(e.i,e.x,e.y),o=t.next,i=e.prev;return t.next=e,e.prev=t,r.next=o,o.prev=r,n.next=r,r.prev=n,i.next=n,n.prev=i,n}function _p(t,e,r,n){var o=new Lp(t,e,r);return n?(o.next=n.next,o.prev=n,n.next.prev=o,n.next=o):(o.prev=o,o.next=o),o}function Mp(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Lp(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Rp(t,e,r,n){for(var o=0,i=e,a=r-n;i<r;i+=n)o+=(t[a]-t[i])*(t[i+1]+t[a+1]),a=i;return o}cp.deviation=function(t,e,r,n){var o=e&&e.length,i=o?e[0]*r:t.length,a=Math.abs(Rp(t,0,i,r));if(o)for(var u=0,s=e.length;u<s;u++){var c=e[u]*r,f=u<s-1?e[u+1]*r:t.length;a-=Math.abs(Rp(t,c,f,r))}var l=0;for(u=0;u<n.length;u+=3){var h=n[u]*r,p=n[u+1]*r,v=n[u+2]*r;l+=Math.abs((t[h]-t[v])*(t[p+1]-t[h+1])-(t[h]-t[p])*(t[v+1]-t[h+1]))}return 0===a&&0===l?0:Math.abs((l-a)/a)},cp.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,o=0;o<t.length;o++){for(var i=0;i<t[o].length;i++)for(var a=0;a<e;a++)r.vertices.push(t[o][i][a]);o>0&&(n+=t[o-1].length,r.holes.push(n))}return r},up.default=sp;var Cp=R(1..valueOf),Np=R("".replace),Dp="[\\t\\n\\v\\f\\r \xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\\u2028\\u2029\\ufeff]",Fp=RegExp("^"+Dp+Dp+"*"),Wp=RegExp(Dp+Dp+"*$"),zp=function(t){return function(e){var r=rf(D(e));return 1&t&&(r=Np(r,Fp,"")),2&t&&(r=Np(r,Wp,"")),r}},Bp={start:zp(1),end:zp(2),trim:zp(3)},Up=qe.f,Gp=Ie.f,Hp=Ut.f,Vp=Bp.trim,qp=O.Number,Zp=qp.prototype,Yp=O.TypeError,$p=R("".slice),Kp=R("".charCodeAt),Qp=function(t){var e=Dt(t,"number");return"bigint"==typeof e?e:Xp(e)},Xp=function(t){var e,r,n,o,i,a,u,s,c=Dt(t,"number");if(It(c))throw Yp("Cannot convert a Symbol value to a number");if("string"==typeof c&&c.length>2)if(c=Vp(c),43===(e=Kp(c,0))||45===e){if(88===(r=Kp(c,2))||120===r)return NaN}else if(48===e){switch(Kp(c,1)){case 66:case 98:n=2,o=49;break;case 79:case 111:n=8,o=55;break;default:return+c}for(a=(i=$p(c,2)).length,u=0;u<a;u++)if((s=Kp(i,u))<48||s>o)return NaN;return parseInt(i,n)}return+c};if(nr("Number",!qp(" 0o1")||!qp("0b1")||qp("+0x1"))){for(var Jp,tv=function(t){var e=arguments.length<1?0:qp(Qp(t)),r=this;return Tt(Zp,r)&&j((function(){Cp(r)}))?ss(Object(e),r,tv):e},ev=pt?Up(qp):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),rv=0;ev.length>rv;rv++)B(qp,Jp=ev[rv])&&!B(tv,Jp)&&Hp(tv,Jp,Gp(qp,Jp));tv.prototype=Zp,Zp.constructor=tv,le(O,"Number",tv,{constructor:!0})}var nv=RangeError,ov=RangeError,iv=String,av=Math.floor,uv=R((function(t){var e=rf(D(this)),r="",n=Me(t);if(n<0||n==1/0)throw nv("Wrong number of repetitions");for(;n>0;(n>>>=1)&&(e+=e))1&n&&(r+=e);return r})),sv=R("".slice),cv=R(1..toFixed),fv=function(t,e,r){return 0===e?r:e%2==1?fv(t,e-1,r*t):fv(t*t,e/2,r)},lv=function(t,e,r){for(var n=-1,o=r;++n<6;)o+=e*t[n],t[n]=o%1e7,o=av(o/1e7)},hv=function(t,e){for(var r=6,n=0;--r>=0;)n+=t[r],t[r]=av(n/e),n=n%e*1e7},pv=function(t){for(var e=6,r="";--e>=0;)if(""!==r||0===e||0!==t[e]){var n=iv(t[e]);r=""===r?n:r+uv("0",7-n.length)+n}return r},vv=j((function(){return"0.000"!==cv(8e-5,3)||"1"!==cv(.9,0)||"1.25"!==cv(1.255,2)||"1000000000000000128"!==cv(0xde0b6b3a7640080,0)}))||!j((function(){cv({})}));function dv(t){return"number"==typeof t}function yv(t){var e=Math.max(Math.min(85.0511287798,t[1]),-85.0511287798),r=Math.PI/180,n=t[0]*r,o=e*r;o=Math.log(Math.tan(Math.PI/4+o/2));return n=(256<<20)*(.5/Math.PI*n+.5),o=(256<<20)*(-.5/Math.PI*o+(r=.5)),[Math.floor(n),Math.floor(o)]}ir({target:"Number",proto:!0,forced:vv},{toFixed:function(t){var e,r,n,o,i=Cp(this),a=Me(t),u=[0,0,0,0,0,0],s="",c="0";if(a<0||a>20)throw ov("Incorrect fraction digits");if(i!=i)return"NaN";if(i<=-1e21||i>=1e21)return iv(i);if(i<0&&(s="-",i=-i),i>1e-21)if(r=(e=function(t){for(var e=0,r=t;r>=4096;)e+=12,r/=4096;for(;r>=2;)e+=1,r/=2;return e}(i*fv(2,69,1))-69)<0?i*fv(2,-e,1):i/fv(2,e,1),r*=4503599627370496,(e=52-e)>0){for(lv(u,0,r),n=a;n>=7;)lv(u,1e7,0),n-=7;for(lv(u,fv(10,n,1),0),n=e-1;n>=23;)hv(u,1<<23),n-=23;hv(u,1<<n),lv(u,1,1),hv(u,2),c=pv(u)}else lv(u,0,r),lv(u,1<<-e,0),c=pv(u)+uv("0",a);return c=a>0?s+((o=c.length)<=a?"0."+uv("0",a-o)+c:sv(c,0,o-a)+"."+sv(c,o-a)):s+c}});var gv,mv=/"/g,xv=R("".replace);ir({target:"String",proto:!0,forced:(gv="sub",j((function(){var t=""[gv]('"');return t!==t.toLowerCase()||t.split('"').length>3})))},{sub:function(){return t="sub",e="",r="",n=rf(D(this)),o="<"+t,""!==e&&(o+=" "+e+'="'+xv(rf(r),mv,"&quot;")+'"'),o+">"+n+"</"+t+">";var t,e,r,n,o}});var bv=RegExp.prototype,wv=qt.PROPER,Ev=RegExp.prototype.toString,Av=j((function(){return"/a/b"!=Ev.call({source:"a",flags:"b"})})),Ov=wv&&"toString"!=Ev.name;(Av||Ov)&&le(RegExp.prototype,"toString",(function(){var t=At(this);return"/"+rf(t.source)+"/"+rf(function(t){var e=t.flags;return void 0!==e||"flags"in bv||B(t,"flags")||!Tt(bv,t)?e:St(nf,t)}(t))}),{unsafe:!0});var Sv="undefined"!=typeof Float32Array?Float32Array:Array;function Tv(){var t=new Sv(2);return Sv!=Float32Array&&(t[0]=0,t[1]=0),t}function kv(t,e){var r=new Sv(2);return r[0]=t,r[1]=e,r}function Iv(t,e){return t[0]=e[0],t[1]=e[1],t}function jv(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function Pv(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function _v(t,e){var r=e[0],n=e[1],o=r*r+n*n;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t}function Mv(t,e){return t[0]*e[0]+t[1]*e[1]}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Lv,Rv=Pv,Cv=(Lv=Tv(),Tv()),Nv=(Tv(),Tv()),Dv=Tv(),Fv=Tv();function Wv(t,e,r,n,o){return jv(t,r,n),_v(t,t),[o/Mv(e=kv(-t[1],t[0]),kv(-r[1],r[0])),e]}function zv(t,e){return function(t,e,r){return t[0]=e,t[1]=r,t}(t,-e[1],e[0])}function Bv(t,e,r){return Rv(t,e,r),_v(t,t),t}function Uv(t,e){return t[0]===e[0]&&t[1]===e[1]}var Gv=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,t),s(this,"complex",void 0),s(this,"join",void 0),s(this,"cap",void 0),s(this,"miterLimit",void 0),s(this,"thickness",void 0),s(this,"normal",void 0),s(this,"lastFlip",-1),s(this,"miter",kv(0,0)),s(this,"started",!1),s(this,"dash",!1),s(this,"totalDistance",0),s(this,"currentIndex",0),this.join=e.join||"miter",this.cap=e.cap||"butt",this.miterLimit=e.miterLimit||10,this.thickness=e.thickness||1,this.dash=e.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return u(t,[{key:"extrude_gaode2",value:function(t,e){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,o=r.startIndex,i=1;i<n;i++){var a,u,s,c=t[i-1];c.push(null!==(a=e[i-1][2])&&void 0!==a?a:0);var f=e[i-1],l=t[i];l.push(null!==(u=e[i][2])&&void 0!==u?u:0);var h=e[i],p=i<t.length-1?[].concat(y(t[i+1]),[null!==(s=e[i+1][2])&&void 0!==s?s:0]):null,v=i<e.length-1?e[i+1]:null;o+=this.segment_gaode2(r,o,c,l,p,f,h,v)}if(this.dash)for(var d=0;d<r.positions.length/6;d++)r.positions[6*d+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"simpleExtrude_gaode2",value:function(t,e){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,o=r.startIndex,i=1;i<n;i++){var a,u,s,c=t[i-1];c.push(null!==(a=e[i-1][2])&&void 0!==a?a:0);var f=e[i-1],l=t[i];l.push(null!==(u=e[i][2])&&void 0!==u?u:0);var h=e[i],p=i<t.length-1?[].concat(y(t[i+1]),[null!==(s=e[i+1][2])&&void 0!==s?s:0]):null,v=i<e.length-1?e[i+1]:null;o+=this.simpleSegment(r,o,c,l,p,f,h,v)}if(this.dash)for(var d=0;d<r.positions.length/6;d++)r.positions[6*d+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"extrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,n=e.startIndex,o=1;o<r;o++){var i=t[o-1],a=t[o],u=o<t.length-1?t[o+1]:null;n+=this.segment(e,n,i,a,u)}if(this.dash)for(var s=0;s<e.positions.length/6;s++)e.positions[6*s+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"simpleExtrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,n=e.startIndex,o=1;o<r;o++){var i=t[o-1],a=t[o],u=o<t.length-1?t[o+1]:null;n+=this.simpleSegment(e,n,i,a,u)}if(this.dash)for(var s=0;s<e.positions.length/6;s++)e.positions[6*s+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"segment_gaode2",value:function(t,e,r,n,o,i,a,u){var s=0,c=t.indices,f=t.positions,l=t.normals,h="square"===this.cap,p="bevel"===this.join,v=yv([a[0],a[1]]),g=yv([i[0],i[1]]);Bv(Nv,n,r);var m=0;if(this.dash&&(m=this.lineSegmentDistance(v,g),this.totalDistance+=m),this.normal||(this.normal=Tv(),zv(this.normal,Nv)),!this.started)if(this.started=!0,h){var x=Tv(),b=Tv();jv(x,this.normal,Nv),jv(b,this.normal,Nv),l.push(b[0],b[1],0),l.push(x[0],x[1],0),f.push(r[0],r[1],0|r[2],this.totalDistance-m,-this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),f.push(r[0],r[1],0|r[2],this.totalDistance-m,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(f,l,r,this.normal,this.thickness,this.totalDistance-m);if(c.push(e+0,e+1,e+2),o){Uv(n,o)&&jv(o,n,_v(o,Pv(o,n,r))),Bv(Dv,o,n);var w=d(Wv(Fv,Tv(),Nv,Dv,this.thickness),2),E=w[0],A=w[1],O=Mv(Fv,this.normal)<0?-1:1,S=p;if(!S&&"miter"===this.join)E>this.miterLimit&&(S=!0);S?(l.push(this.normal[0],this.normal[1],0),l.push(A[0],A[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c.push.apply(c,y(this.lastFlip!==-O?[e,e+2,e+3]:[e+2,e+1,e+3])),c.push(e+2,e+3,e+4),zv(Cv,Dv),Iv(this.normal,Cv),l.push(this.normal[0],this.normal[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,s+=3):(this.extrusions(f,l,n,A,E,this.totalDistance),c.push.apply(c,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),O=-1,Iv(this.normal,A),s+=2),this.lastFlip=O}else{if(zv(this.normal,Nv),h){var T=Tv(),k=Tv();Rv(k,Nv,this.normal),jv(T,Nv,this.normal),l.push(k[0],k[1],0),l.push(T[0],T[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(f,l,n,this.normal,this.thickness,this.totalDistance);c.push.apply(c,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),s+=2}return s}},{key:"simpleSegment",value:function(t,e,r,n,o){var i=0,a=t.indices,u=t.positions,s=t.normals,c=yv([n[0],n[1]]),f=yv([r[0],r[1]]);Bv(Nv,c,f);var l=0;if(this.dash&&(l=this.lineSegmentDistance(c,f),this.totalDistance+=l),this.normal||(this.normal=Tv(),zv(this.normal,Nv)),this.started||(this.started=!0,this.extrusions(u,s,r,this.normal,this.thickness,this.totalDistance-l)),a.push(e+0,e+1,e+2),o){var h=yv([o[0],o[1]]);Uv(c,h)&&jv(h,c,_v(h,Pv(h,c,f))),Bv(Dv,h,c);var p=d(Wv(Fv,Tv(),Nv,Dv,this.thickness),2),v=p[0],g=p[1];Mv(Fv,this.normal);this.extrusions(u,s,n,g,v,this.totalDistance),a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),-1,Iv(this.normal,g),i+=2,this.lastFlip=-1}else zv(this.normal,Nv),this.extrusions(u,s,n,this.normal,this.thickness,this.totalDistance),a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),i+=2;return i}},{key:"segment",value:function(t,e,r,n,o){var i=0,a=t.indices,u=t.positions,s=t.normals,c="square"===this.cap,f="bevel"===this.join,l=yv([n[0],n[1]]),h=yv([r[0],r[1]]);Bv(Nv,l,h);var p=0;if(this.dash&&(p=this.lineSegmentDistance(l,h),this.totalDistance+=p),this.normal||(this.normal=Tv(),zv(this.normal,Nv)),!this.started)if(this.started=!0,c){var v=Tv(),g=Tv();jv(v,this.normal,Nv),jv(g,this.normal,Nv),s.push(g[0],g[1],0),s.push(v[0],v[1],0),u.push(r[0],r[1],0|r[2],this.totalDistance-p,-this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),u.push(r[0],r[1],0|r[2],this.totalDistance-p,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(u,s,r,this.normal,this.thickness,this.totalDistance-p);if(a.push(e+0,e+1,e+2),o){var m=yv([o[0],o[1]]);Uv(l,m)&&jv(m,l,_v(m,Pv(m,l,h))),Bv(Dv,m,l);var x=d(Wv(Fv,Tv(),Nv,Dv,this.thickness),2),b=x[0],w=x[1],E=Mv(Fv,this.normal)<0?-1:1,A=f;if(!A&&"miter"===this.join)b>this.miterLimit&&(A=!0);A?(s.push(this.normal[0],this.normal[1],0),s.push(w[0],w[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,a.push.apply(a,y(this.lastFlip!==-E?[e,e+2,e+3]:[e+2,e+1,e+3])),a.push(e+2,e+3,e+4),zv(Cv,Dv),Iv(this.normal,Cv),s.push(this.normal[0],this.normal[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,i+=3):(this.extrusions(u,s,n,w,b,this.totalDistance),a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),E=-1,Iv(this.normal,w),i+=2),this.lastFlip=E}else{if(zv(this.normal,Nv),c){var O=Tv(),S=Tv();Rv(S,Nv,this.normal),jv(O,Nv,this.normal),s.push(S[0],S[1],0),s.push(O[0],O[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(u,s,n,this.normal,this.thickness,this.totalDistance);a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),i+=2}return i}},{key:"extrusions",value:function(t,e,r,n,o,i){e.push(n[0],n[1],0),e.push(n[0],n[1],0),t.push(r[0],r[1],0|r[2],i,-o,0|r[2]),this.complex.indexes.push(this.currentIndex),t.push(r[0],r[1],0|r[2],i,o,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,e){var r=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(r*r+n*n)}}]),t}();function Hv(t){var e=t.coordinates,r=t.originCoordinates,n=t.version,o=new Gv({dash:!0,join:"bevel"});if("GAODE2.x"===n){var i=e;Array.isArray(i[0][0])||(i=[e]);var a=r;Array.isArray(a[0][0])||(a=[r]);for(var u=0;u<i.length;u++){var s=i[u],c=a[u];o.extrude_gaode2(s,c)}}else{var f=e;f[0]&&!Array.isArray(f[0][0])&&(f=[e]),f.forEach((function(t){o.extrude(t)}))}var l=o.complex;return{vertices:l.positions,indices:l.indices,normals:l.normals,indexes:l.indexes,size:6}}function Vv(t){var e=function(t){if(dv(t[0]))return t;if(dv(t[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(dv(t[0][0][0])){var e=0,r=0,n=0;return t.forEach((function(t){t.forEach((function(t){e+=t[0],r+=t[1],n++}))})),[e/n,r/n,0]}throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}(t.coordinates);return{vertices:[].concat(y(e),y(e),y(e),y(e)),indices:[0,1,2,2,3,0],size:e.length}}function qv(t){var e=t.coordinates,r=up.flatten(e),n=r.vertices,o=r.dimensions,i=r.holes;return{indices:up(n,i,o),vertices:n,size:o}}var Zv=function(){var t=o(r().mark((function t(e){var n,o,i,a,u,s,c,f,l;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,o=e.features,i=e.enablePicking,a=e.iconMap,u={a_Color:np,a_Position:op,filter:ip,a_vertexId:ap,a_PickingColor:function(t){var e=t.id;return i?tp(e):[0,0,0]},a_DistanceAndIndex:function(t,e,r,n,o,i){return void 0===i?[r[3],10]:[r[3],i]},a_Total_Distance:function(t,e,r){return[r[5]]},a_Size:function(t){var e=t.size,r=void 0===e?1:e;return Array.isArray(r)?[r[0],r[1]]:[r,0]},a_Normal:function(t,e,r,n,o){return o},a_Miter:function(t,e,r){return[r[4]]},a_iconMapUV:function(t){var e=t.texture,r=a[e]||{x:0,y:0};return[r.x,r.y]}},s={sizePerElement:0,elements:[]},c=0,f=[],l=3,o.forEach((function(t,e){var r=Hv(t),o=r.indices,i=r.vertices,a=r.normals,h=r.size,p=r.indexes;o.forEach((function(t){f.push(t+c)})),l=h;var v=i.length/h;s.sizePerElement=l,s.elements.push({featureIdx:e,vertices:i,normals:a,offset:c}),c+=v;for(var d=function(r){var o=(null==a?void 0:a.slice(3*r,3*r+3))||[],s=i.slice(r*h,r*h+h),c=0;p&&void 0!==p[r]&&(c=p[r]),n.forEach((function(n){var i;n&&u[n.name]&&(i=n.buffer.data).push.apply(i,y(u[n.name](t,e,s,r,o,c)))}))},g=0;g<v;g++)d(g)})),t.abrupt("return",{descriptors:n,featureLayout:s,indices:f});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Yv={pointFill:function(){var t=o(r().mark((function t(e){var n,o,i,a,u,s,c,f,l;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,o=e.features,i=e.enablePicking,a=e.shape2d,u={a_Color:np,a_Position:op,filter:ip,a_vertexId:ap,a_PickingColor:function(t){var e=t.id;return i?tp(e):[0,0,0]},a_Shape:function(t){var e=t.shape,r=void 0===e?2:e;return[a.indexOf(r)]},a_Extrude:function(t,e,r,n){var o=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],i=n%4*3;return[o[i],o[i+1],o[i+2]]},a_Size:function(t){var e=t.size,r=void 0===e?5:e;return Array.isArray(r)?[r[0]]:[r]}},s={sizePerElement:0,elements:[]},c=0,f=[],l=3,o.forEach((function(t,e){var r=Vv(t),o=r.indices,i=r.vertices,a=r.normals,h=r.size;o.forEach((function(t){f.push(t+c)})),l=h;var p=i.length/h;s.sizePerElement=l,s.elements.push({featureIdx:e,vertices:i,normals:a,offset:c}),c+=p;for(var v=function(r){var o=[],a=i.slice(r*h,r*h+h);n.forEach((function(n){var i;n&&u[n.name]&&(i=n.buffer.data).push.apply(i,y(u[n.name](t,e,a,r,o,0)))}))},d=0;d<p;d++)v(d)})),t.abrupt("return",{descriptors:n,featureLayout:s,indices:f});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),line:Zv,polygonFill:function(){var t=o(r().mark((function t(e){var n,o,i,a,u,s,c,f;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,o=e.features,i=e.enablePicking,a={a_Color:np,a_Position:op,filter:ip,a_vertexId:ap,a_PickingColor:function(t){var e=t.id;return i?tp(e):[0,0,0]}},u={sizePerElement:0,elements:[]},s=0,c=[],f=3,o.forEach((function(t,e){var r=qv(t),o=r.indices,i=r.vertices,l=r.normals,h=r.size;o.forEach((function(t){c.push(t+s)})),f=h;var p=i.length/h;u.sizePerElement=f,u.elements.push({featureIdx:e,vertices:i,normals:l,offset:s}),s+=p;for(var v=function(r){var o=[],u=i.slice(r*h,r*h+h);n.forEach((function(n){var i;n&&a[n.name]&&(i=n.buffer.data).push.apply(i,y(a[n.name](t,e,u,r,o,0)))}))},d=0;d<p;d++)v(d)})),t.abrupt("return",{descriptors:n,featureLayout:u,indices:c});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},$v=function(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?e(Object(n),!0).forEach((function(e){s(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):e(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},Yv);function Kv(t){return Qv.apply(this,arguments)}function Qv(){return(Qv=o(r().mark((function t(e){var n,o;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.workerType,o=e.data,!$v[n]){t.next=3;break}return t.abrupt("return",$v[n](o));case 3:return t.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(n,'" non-existent.'))));case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return fi(Kv),t.WorkerSourceMap=Yv,t.createWorker=fi,t.worker=Kv,t}({});
`,Sl="l7-worker",Mf=3,ou=!0;function nh(e){Nh(Sl,e)}function ih(){var e=rh(Sl);if(!e)throw new Error("get worker failed by workerName: ".concat(Sl,"."));return e}function ah(e,i){return ef.apply(this,arguments)}function ef(){return ef=(0,de.Z)(q().mark(function e(i,r){var n,t,o,u,l;return q().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return n=ih(),t=au.getWorkerFarm({maxConcurrency:Mf,reuseWorkers:ou}),o=t.getWorkerPool({name:Sl,source:n}),v.next=5,o.startJob(Sl,function(x,E,C){return x.done(C)});case 5:return u=v.sent,u.postMessage("process",{input:{workerType:i,data:r}}),v.next=9,u.result;case 9:return l=v.sent,v.abrupt("return",l.result);case 11:case"end":return v.stop()}},e)})),ef.apply(this,arguments)}nh(zh);var wl={BACK:1029,FRONT:1028};function xu(e){switch(e){case"GAODE1.x":return wl.BACK;case"GAODE2.x":return wl.BACK;case"MAPBOX":return wl.FRONT;case"SIMPLE":return wl.FRONT;case"GLOBEL":return wl.BACK;case"DEBAULT":return wl.FRONT;default:return wl.FRONT}}function tf(e){return typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap}function Jp(){return typeof importScripts=="function"}var cp=Jp()?function(){return self.worker&&self.worker.referrer}:function(){return(window.location.protocol==="blob:"?window.parent:window).location.href},rf;(function(e){e.Realtime="realtime",e.Overlap="overlap",e.Replace="replace"})(rf||(rf={}));var Ru;(function(e){e.Loading="Loading",e.Loaded="Loaded",e.Failure="Failure",e.Cancelled="Cancelled"})(Ru||(Ru={}));var ed=0,bu=1,oh=2;function Zh(e){e.forEach(function(i){i.isCurrent&&(i.isVisible=i.isLoaded)})}function kf(e){e.forEach(function(i){i.properties.state=ed}),e.forEach(function(i){i.isCurrent&&!fp(i)&&hp(i)}),e.forEach(function(i){i.isVisible=Boolean(i.properties.state&oh)})}function tl(e){e.forEach(function(r){r.properties.state=ed}),e.forEach(function(r){r.isCurrent&&fp(r)});var i=e.slice().sort(function(r,n){return r.z-n.z});i.forEach(function(r){r.isVisible=Boolean(r.properties.state&oh),r.children.length&&(r.isVisible||r.properties.state&bu)?r.children.forEach(function(n){n.properties.state=bu}):r.isCurrent&&hp(r)})}function fp(e){for(;e;){if(e.isLoaded)return e.properties.state|=oh,!0;e=e.parent}return!1}function hp(e){e.children.forEach(function(i){i.isLoaded?i.properties.state|=oh:hp(i)})}var Eu,sh=256,bc=[-Infinity,-Infinity,Infinity,Infinity],Ec=.2,td=5,pp=(Eu={},(0,Y.Z)(Eu,rf.Realtime,Zh),(0,Y.Z)(Eu,rf.Overlap,kf),(0,Y.Z)(Eu,rf.Replace,tl),Eu),Uh=function(){};function uh(e,i,r){var n=Math.floor((e+180)/360*Math.pow(2,r)),t=Math.floor((1-Math.log(Math.tan(i*Math.PI/180)+1/Math.cos(i*Math.PI/180))/Math.PI)/2*Math.pow(2,r));return[n,t]}function ya(e,i,r){var n=e/Math.pow(2,r)*360-180,t=Math.PI-2*Math.PI*i/Math.pow(2,r),o=180/Math.PI*Math.atan(.5*(Math.exp(t)-Math.exp(-t)));return[n,o]}var Yl=function(i,r,n){var t=ya(i,r,n),o=(0,hr.Z)(t,2),u=o[0],l=o[1],p=ya(i+1,r+1,n),v=(0,hr.Z)(p,2),x=v[0],E=v[1];return[u,E,x,l]};function zo(e){var i=e.zoom,r=e.latLonBounds,n=e.maxZoom,t=n===void 0?Infinity:n,o=e.minZoom,u=o===void 0?0:o,l=e.zoomOffset,p=l===void 0?0:l,v=e.extent,x=v===void 0?bc:v,E=Math.ceil(i)+p;if(Number.isFinite(u)&&E<u)return[];Number.isFinite(t)&&E>t&&(E=t);for(var C=(0,hr.Z)(r,4),T=C[0],O=C[1],L=C[2],B=C[3],H=[Math.max(T,x[0]),Math.max(O,x[1]),Math.min(L,x[2]),Math.min(B,x[3])],oe=[],le=uh(H[0],H[1],E),Re=(0,hr.Z)(le,2),Ne=Re[0],ut=Re[1],Ot=uh(H[2],H[3],E),Nt=(0,hr.Z)(Ot,2),jt=Nt[0],br=Nt[1],yr=Ne;yr<=jt;yr++)for(var Ur=br;Ur<=ut;Ur++)oe.push({x:yr,y:Ur,z:E});var An=(jt+Ne)/2,jn=(ut+br)/2,Qi=function(bo,Ao){return Math.abs(bo-An)+Math.abs(Ao-jn)};return oe.sort(function(Ca,bo){return Qi(Ca.x,Ca.y)-Qi(bo.x,bo.y)}),oe}var su=function(i,r,n){var t=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,o=Math.pow(2,n),u=o-1,l=o,p=i,v=r;return t&&(p<0?p=p+l:p>u&&(p=p%l)),{warpX:p,warpY:v}};function zd(e){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)}function rd(e){var i=[],r=/\{([a-z])-([a-z])\}/.exec(e);if(r){var n=r[1].charCodeAt(0),t=r[2].charCodeAt(0),o;for(o=n;o<=t;++o)i.push(e.replace(r[0],String.fromCharCode(o)));return i}if(r=/\{(\d+)-(\d+)\}/.exec(e),r){for(var u=parseInt(r[2],10),l=parseInt(r[1],10);l<=u;l++)i.push(e.replace(r[0],l.toString()));return i}return i.push(e),i}function lh(e,i){if(!e||!e.length)throw new Error("url is not allowed to be empty");var r=i.x,n=i.y,t=i.z,o=rd(e),u=Math.abs(r+n)%o.length,l=o[u];return l.replace(/\{x\}/g,r.toString()).replace(/\{y\}/g,n.toString()).replace(/\{z\}/g,t.toString()).replace(/\{bbox\}/g,Yl(r,n,t).join(",")).replace(/\{-y\}/g,(Math.pow(2,t)-n-1).toString())}function Zd(e,i){var r=i.x,n=i.y,t=i.z,o=i.layer,u=i.version,l=u===void 0?"1.0.0":u,p=i.style,v=p===void 0?"default":p,x=i.format,E=i.service,C=E===void 0?"WMTS":E,T=i.tileMatrixset,O="".concat(e,"&SERVICE=").concat(C,"&REQUEST=GetTile&VERSION=").concat(l,"&LAYER=").concat(o,"&STYLE=").concat(v,"&TILEMATRIXSET=").concat(T,"&FORMAT=").concat(x,"&TILECOL=").concat(r,"&TILEROW=").concat(n,"&TILEMATRIX=").concat(t);return O}function Ud(e,i){i===void 0&&(i={});var r=Number(e[0]),n=Number(e[1]),t=Number(e[2]),o=Number(e[3]);if(e.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var u=[r,n],l=[r,o],p=[t,o],v=[t,n];return wn([[u,v,p,l,u]],i.properties,{bbox:e,id:i.id})}var Ns=K(26729),dp=K.n(Ns);function Vd(e){var i=ch();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function ch(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nd=function(e){(0,gr.Z)(r,e);var i=Vd(r);function r(n){var t;(0,xt.Z)(this,r),t=i.call(this),(0,Y.Z)((0,De.Z)(t),"tileSize",256),(0,Y.Z)((0,De.Z)(t),"isVisible",!1),(0,Y.Z)((0,De.Z)(t),"isCurrent",!1),(0,Y.Z)((0,De.Z)(t),"isVisibleChange",!1),(0,Y.Z)((0,De.Z)(t),"loadedLayers",0),(0,Y.Z)((0,De.Z)(t),"isLayerLoaded",!1),(0,Y.Z)((0,De.Z)(t),"isLoad",!1),(0,Y.Z)((0,De.Z)(t),"isChildLoad",!1),(0,Y.Z)((0,De.Z)(t),"parent",null),(0,Y.Z)((0,De.Z)(t),"children",[]),(0,Y.Z)((0,De.Z)(t),"data",null),(0,Y.Z)((0,De.Z)(t),"properties",{}),(0,Y.Z)((0,De.Z)(t),"loadDataId",0);var o=n.x,u=n.y,l=n.z,p=n.tileSize,v=n.warp,x=v===void 0?!0:v;return t.x=o,t.y=u,t.z=l,t.warp=x||!0,t.tileSize=p,t}return(0,wt.Z)(r,[{key:"isLoading",get:function(){return this.loadStatus===Ru.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===Ru.Loaded}},{key:"isFailure",get:function(){return this.loadStatus===Ru.Failure}},{key:"setTileLayerLoaded",value:function(){this.isLayerLoaded=!0}},{key:"isCancelled",get:function(){return this.loadStatus===Ru.Cancelled}},{key:"isDone",get:function(){return[Ru.Loaded,Ru.Cancelled,Ru.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return Yl(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var t=(0,hr.Z)(this.bounds,4),o=t[0],u=t[1],l=t[2],p=t[3],v=[(l-o)/2,(p-u)/2],x=Ud(this.bounds,{properties:{key:this.key,id:this.key,bbox:this.bounds,center:v,meta:`
      `.concat(this.key,`
      `)}});return x}},{key:"key",get:function(){var t="".concat(this.x,"_").concat(this.y,"_").concat(this.z);return t}},{key:"layerLoad",value:function(){this.loadedLayers++,this.emit("layerLoaded")}},{key:"loadData",value:function(){var n=(0,de.Z)(q().mark(function o(u){var l,p,v,x,E,C,T,O,L,B,H,oe,le,Re,Ne,ut,Ot;return q().wrap(function(jt){for(;;)switch(jt.prev=jt.next){case 0:return l=u.getData,p=u.onLoad,v=u.onError,this.loadDataId++,x=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=Ru.Loading,E=null,jt.prev=7,T=this.x,O=this.y,L=this.z,B=this.bounds,H=this.tileSize,oe=this.warp,le=su(T,O,L,oe),Re=le.warpX,Ne=le.warpY,ut=this.abortController.signal,Ot={x:Re,y:Ne,z:L,bounds:B,tileSize:H,signal:ut,warp:oe},jt.next=14,l(Ot,this);case 14:E=jt.sent,jt.next=20;break;case 17:jt.prev=17,jt.t0=jt.catch(7),C=jt.t0;case 20:if(x===this.loadDataId){jt.next=22;break}return jt.abrupt("return");case 22:if(!(this.isCancelled&&!E)){jt.next=24;break}return jt.abrupt("return");case 24:if(!(C||!E)){jt.next=28;break}return this.loadStatus=Ru.Failure,v(C,this),jt.abrupt("return");case 28:this.loadStatus=Ru.Loaded,this.data=E,p(this);case 31:case"end":return jt.stop()}},o,this,[[7,17]])}));function t(o){return n.apply(this,arguments)}return t}()},{key:"reloadData",value:function(t){this.isLoading&&this.abortLoad(),this.loadData(t)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=Ru.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}}]),r}(Ns.EventEmitter),id=function(i,r){var n=ku(i),t=iu(n,r),o=360*3-180,u=85.0511287798065,l=[Math.max(t[0][0],-o),Math.max(t[0][1],-u),Math.min(t[1][0],o),Math.min(t[1][1],u)];return l},fh=function(i,r){var n=ku(i),t=ku(r),o=vc(n,t);return o};function va(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=vp(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function vp(e,i){if(!!e){if(typeof e=="string")return Cl(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Cl(e,i)}}function Cl(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function If(e){var i=mp();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function mp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jd=function(e){(0,gr.Z)(r,e);var i=If(r);function r(n){var t;return(0,xt.Z)(this,r),t=i.call(this),(0,Y.Z)((0,De.Z)(t),"currentTiles",[]),(0,Y.Z)((0,De.Z)(t),"cacheTiles",new Map),(0,Y.Z)((0,De.Z)(t),"throttleUpdate",(0,St.throttle)(function(o,u){t.update(o,u)},16)),(0,Y.Z)((0,De.Z)(t),"onTileLoad",function(o){t.emit("tile-loaded",o),t.updateTileVisible()}),(0,Y.Z)((0,De.Z)(t),"onTileError",function(o,u){t.emit("tile-error",{error:o,tile:u}),t.updateTileVisible()}),(0,Y.Z)((0,De.Z)(t),"onTileUnload",function(o){t.emit("tile-unload",o)}),t.options={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,extent:bc,getTileData:Uh,warp:!0,updateStrategy:rf.Overlap},t.updateOptions(n),t}return(0,wt.Z)(r,[{key:"isLoaded",get:function(){return this.currentTiles.every(function(t){return t.isDone})}},{key:"tiles",get:function(){var t=Array.from(this.cacheTiles.values()).sort(function(o,u){return o.z-u.z});return t}},{key:"updateOptions",value:function(t){var o=t.minZoom===void 0?this.options.minZoom:Math.ceil(t.minZoom),u=t.maxZoom===void 0?this.options.maxZoom:Math.floor(t.maxZoom);this.options=(0,z.Z)((0,z.Z)((0,z.Z)({},this.options),t),{},{minZoom:o,maxZoom:u})}},{key:"update",value:function(t,o){var u=this,l=Math.max(0,Math.ceil(t));if(!(this.lastViewStates&&this.lastViewStates.zoom===l&&fh(this.lastViewStates.latLonBoundsBuffer,o))){var p=id(o,Ec);this.lastViewStates={zoom:l,latLonBounds:o,latLonBoundsBuffer:p};var v=!1,x=this.getTileIndices(l,p).filter(function(E){return u.options.warp||E.x>=0&&E.x<Math.pow(2,l)});this.currentTiles=x.map(function(E){var C=E.x,T=E.y,O=E.z,L=u.getTile(C,T,O);if(L){var B,H,oe=((B=L)===null||B===void 0?void 0:B.isFailure)||((H=L)===null||H===void 0?void 0:H.isCancelled);return oe&&L.loadData({getData:u.options.getTileData,onLoad:u.onTileLoad,onError:u.onTileError}),L}return L=u.createTile(C,T,O),v=!0,L}),v&&this.resizeCacheTiles(),this.updateTileVisible(),this.pruneRequests()}}},{key:"reloadAll",value:function(){var t=va(this.cacheTiles),o;try{for(t.s();!(o=t.n()).done;){var u=(0,hr.Z)(o.value,2),l=u[0],p=u[1];this.currentTiles.includes(p)||(this.cacheTiles.delete(l),this.onTileUnload(p)),this.onTileUnload(p),p.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(v){t.e(v)}finally{t.f()}}},{key:"pruneRequests",value:function(){var t=[],o=va(this.cacheTiles.values()),u;try{for(o.s();!(u=o.n()).done;){var l=u.value;l.isLoading&&!l.isCurrent&&!l.isVisible&&t.push(l)}}catch(v){o.e(v)}finally{o.f()}for(;t.length>0;){var p=t.shift();p.abortLoad()}}},{key:"getTileByLngLat",value:function(t,o,u){var l=this.options.zoomOffset,p=Math.ceil(u)+l,v=uh(t,o,p),x=this.tiles.filter(function(E){return E.key==="".concat(v[0],"_").concat(v[1],"_").concat(p)});return x[0]}},{key:"destroy",value:function(){var t=va(this.cacheTiles.values()),o;try{for(t.s();!(o=t.n()).done;){var u=o.value;u.isLoading&&u.abortLoad()}}catch(l){t.e(l)}finally{t.f()}this.cacheTiles.clear(),this.currentTiles=[],this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var t=this.options.updateStrategy,o=new Map,u=va(this.cacheTiles.values()),l;try{for(u.s();!(l=u.n()).done;){var p=l.value;o.set(p.key,p.isVisible),p.isCurrent=!1,p.isVisible=!1}}catch(O){u.e(O)}finally{u.f()}var v=va(this.currentTiles),x;try{for(v.s();!(x=v.n()).done;){var E=x.value;E.isCurrent=!0,E.isVisible=!0}}catch(O){v.e(O)}finally{v.f()}var C=Array.from(this.cacheTiles.values());typeof t=="function"?t(C):pp[t](C);var T=!1;Array.from(this.cacheTiles.values()).forEach(function(O){O.isVisible!==o.get(O.key)?(O.isVisibleChange=!0,T=!0):O.isVisibleChange=!1}),T&&this.emit("tile-update")}},{key:"getTileIndices",value:function(t,o){var u=this.options,l=u.tileSize,p=u.extent,v=u.zoomOffset,x=Math.floor(this.options.maxZoom),E=Math.ceil(this.options.minZoom),C=zo({maxZoom:x,minZoom:E,zoomOffset:v,tileSize:l,zoom:t,latLonBounds:o,extent:p});return C}},{key:"getTileId",value:function(t,o,u){var l="".concat(t,",").concat(o,",").concat(u);return l}},{key:"getTile",value:function(t,o,u){var l=this.getTileId(t,o,u),p=this.cacheTiles.get(l);return p}},{key:"createTile",value:function(t,o,u){var l=this.getTileId(t,o,u),p=new nd({x:t,y:o,z:u,tileSize:this.options.tileSize,warp:this.options.warp});return this.cacheTiles.set(l,p),p.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),p}},{key:"resizeCacheTiles",value:function(){var t=td*this.currentTiles.length,o=this.cacheTiles.size>t;if(o){var u=va(this.cacheTiles),l;try{for(u.s();!(l=u.n()).done;){var p=(0,hr.Z)(l.value,2),v=p[0],x=p[1];if(!x.isVisible&&!this.currentTiles.includes(x)&&(this.cacheTiles.delete(v),this.onTileUnload(x)),this.cacheTiles.size<=t)break}}catch(E){u.e(E)}finally{u.f()}}this.rebuildTileTree()}},{key:"rebuildTileTree",value:function(){var t=va(this.cacheTiles.values()),o;try{for(t.s();!(o=t.n()).done;){var u=o.value;u.parent=null,u.children.length=0}}catch(E){t.e(E)}finally{t.f()}var l=va(this.cacheTiles.values()),p;try{for(l.s();!(p=l.n()).done;){var v=p.value,x=this.getNearestAncestor(v.x,v.y,v.z);v.parent=x,x!=null&&x.children&&x.children.push(v)}}catch(E){l.e(E)}finally{l.f()}}},{key:"getNearestAncestor",value:function(t,o,u){for(;u>this.options.minZoom;){t=Math.floor(t/2),o=Math.floor(o/2),u=u-1;var l=this.getTile(t,o,u);if(l)return l}return null}}]),r}(dp()),V;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.DEFAULT="DEFAUlTMAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL"})(V||(V={}));function ke(e,i,r,n,t){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,u=arguments.length>6?arguments[6]:void 0,l=r;return u&&(l=Math.round(r*(o-1))/(o-1)),n?tr(e,i,l,n,t):tr(e,i,l,.314,t)}function Ke(e,i){var r=1-i;return(e[0]*r+e[1]*i)*r+(e[1]*r+e[2]*i)*i}function ir(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))}function Ar(e,i,r){var n=[i[0]-e[0],i[1]-e[1]],t=ir(n,[0,0]),o=Math.atan2(n[1],n[0]),u=t/2/Math.cos(r),l=o+r,p=[u*Math.cos(l)+e[0],u*Math.sin(l)+e[1]];return p}function tr(e,i,r,n,t){if(t===Version["GAODE2.x"]){var o=amap2Project(e[0],e[1]),u=amap2Project(i[0],i[1]),l=Ar(o,u,n),p=[o[0],l[0],u[0]],v=[o[1],l[1],u[1]];return[].concat(_toConsumableArray(amap2UnProject(Ke(p,r),Ke(v,r))),[0])}else{var x=Ar(e,i,n),E=[e[0],x[0],i[0]],C=[e[1],x[1],i[1]];return[Ke(E,r),Ke(C,r),0]}}function xr(e,i,r,n,t){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,u=arguments.length>6?arguments[6]:void 0,l=r;return u&&(l=Math.round(r*29)/29),Yr(e,i,l,t)}function Pr(e,i){var r=[i[0]-e[0],i[1]-e[1]],n=calDistance(r,[0,0]),t=Math.atan2(r[1],r[0]),o=.314,u=n/2/Math.cos(o),l=t+o,p=[u*Math.cos(l)+e[0],u*Math.sin(l)+e[1]];return p}function zr(e,i){var r=1-i;return(e[0]*r+e[1]*i)*r+(e[1]*r+e[2]*i)*i}function Gr(e,i){var r=[e[0]-i[0],e[1]-i[1]],n=[Math.sin(r[0]/2),Math.sin(r[1]/2)],t=n[1]*n[1]+Math.cos(e[1])*Math.cos(i[1])*n[0]*n[0];return 2*Math.atan2(Math.sqrt(t),Math.sqrt(1-t))}function Yr(e,i,r,n){var t=[degreesToRadians(e[0]),degreesToRadians(e[1])],o=[degreesToRadians(i[0]),degreesToRadians(i[1])];if(n==="GAODE2.x"){var u=Pr(t,o),l=[t[0],u[0],o[0]],p=[t[1],u[1],o[1]];return[zr(l,r),zr(p,r),0]}else{var v=Gr(t,o);if(Math.abs(v-Math.PI)<.001)return[(1-r)*t[0]+r*o[0],(1-r)*t[1]+r*o[1]];var x=Math.sin((1-r)*v)/Math.sin(v),E=Math.sin(r*v)/Math.sin(v),C=[Math.sin(t[0]),Math.sin(t[1])],T=[Math.cos(t[0]),Math.cos(t[1])],O=[Math.sin(o[0]),Math.sin(o[1])],L=[Math.cos(o[0]),Math.cos(o[1])],B=x*T[1]*T[0]+E*L[1]*L[0],H=x*T[1]*C[0]+E*L[1]*O[0],oe=x*C[1]+E*O[1];return[radiansToDegrees(Math.atan2(H,B)),radiansToDegrees(Math.atan2(oe,Math.sqrt(B*B+H*H)))]}}function Kr(e,i){for(var r=0,n=[],t=0;t<e.length-1;t++){var o=e[t],u=e[t+1],l=Vr(o,u),p=r;r+=l,n.push({p1:o,p2:u,totalDistance:r,distance:l,lastTotalDistance:p})}for(var v=r*i,x,E,C=0,T=n;C<T.length;C++){var O=T[C],L=O.totalDistance;if(L>v){var B=O.p1,H=O.p2,oe=(v-O.lastTotalDistance)/O.distance,le=hn(H,B,oe);x=le[0],E=le[1];break}}return{lng:x,lat:E,height:0}}function hn(e,i,r){return[e[0]*r+i[0]*(1-r),e[1]*r+i[1]*(1-r)]}function Vr(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))}function Xr(e,i){var r=i.featureId,n=e.data.dataArray;return typeof r=="number"&&(n=n.filter(function(t){var o=t.id;return o===r})),n.map(function(t){var o=pr(t,i);return _objectSpread(_objectSpread({},t),o)})}function Pt(e,i){return new Promise(function(r){e.inited?r(Xr(e,i)):e.once("update",function(){r(Xr(e,i))})})}function pr(e,i){var r=i.offset,n=i.shape,t=i.thetaOffset,o=i.mapVersion,u=i.segmentNumber,l=u===void 0?30:u,p=i.autoFit,v=p===void 0?!0:p,x=e.coordinates;if(n==="line")return pathLineAtOffset(x,r);var E=x[0],C=x[1],T=typeof t=="string"?e[t]||0:t,O;switch(n){case"arc":O=arcLineAtOffset;break;case"greatcircle":O=greatCircleLineAtOffset;break;default:O=arcLineAtOffset}var L=O(E,C,r,T,o,l,v),B=_slicedToArray(L,3),H=B[0],oe=B[1],le=B[2];return{lng:H,lat:oe,height:le}}function jr(e,i){var r=i.extent,n=r===void 0?[121.168,30.2828,121.384,30.4219]:r,t=new Promise(function(u){e instanceof HTMLImageElement||tf(e)?u([e]):ln(e,function(l){u(l)})}),o={originData:e,images:t,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return o}function ln(e,i){var r=e,n=[];if(typeof r=="string")Fo({url:r},function(u,l){l&&(n.push(l),i(n))});else{var t=r.length,o=0;r.forEach(function(u){Fo({url:u},function(l,p){o++,p&&n.push(p),o===t&&i(n)})})}return jr}var Mr=K(38929),Jr=K(3614),gn=K.n(Jr),ei=function(){function e(i,r,n,t){(0,xt.Z)(this,e),(0,Y.Z)(this,"vectorLayerCache",{}),this.x=r,this.y=n,this.z=t,this.vectorTile=new Mr.VectorTile(new(gn())(i))}return(0,wt.Z)(e,[{key:"getTileData",value:function(r){if(!r||!this.vectorTile.layers[r])return[];if(this.vectorLayerCache[r])return this.vectorLayerCache[r];var n=this.vectorTile.layers[r];if(Array.isArray(n.features))return this.vectorLayerCache[r]=n.features,n.features;for(var t=[],o=0;o<n.length;o++){var u=n.feature(o),l=u.toGeoJSON(this.x,this.y,this.z);t.push((0,z.Z)((0,z.Z)({},l),{},{properties:(0,z.Z)({id:l.id},l.properties)}))}return this.vectorLayerCache[r]=t,t}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),_r={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,warp:!0},Sr=function(){var e=(0,de.Z)(q().mark(function i(r,n,t,o){var u;return q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=lh(r,n),p.abrupt("return",new Promise(function(v){var x=Hs((0,z.Z)((0,z.Z)({},o),{},{url:u}),function(E,C){if(E||!C)v(void 0);else{var T=new ei(C,t.x,t.y,t.z);v(T)}});t.xhrCancel=function(){return x.abort()}}));case 2:case"end":return p.stop()}},i)}));return function(r,n,t,o){return e.apply(this,arguments)}}();function Nn(e,i){var r=Array.isArray(e)?e[0]:e,n=function(u,l){return Sr(r,u,l,i==null?void 0:i.requestParameters)},t=(0,z.Z)((0,z.Z)((0,z.Z)({},_r),i),{},{getTileData:n});return{data:r,dataArray:[],tilesetOptions:t,isTile:!0}}function pn(e,i,r,n){for(var t=n,o=r-i>>1,u=r-i,l,p=e[i],v=e[i+1],x=e[r],E=e[r+1],C=i+3;C<r;C+=3){var T=Wr(e[C],e[C+1],p,v,x,E);if(T>t)l=C,t=T;else if(T===t){var O=Math.abs(C-o);O<u&&(l=C,u=O)}}t>n&&(l-i>3&&pn(e,i,l,n),e[l+2]=t,r-l>3&&pn(e,l,r,n))}function Wr(e,i,r,n,t,o){var u=t-r,l=o-n;if(u!==0||l!==0){var p=((e-r)*u+(i-n)*l)/(u*u+l*l);p>1?(r=t,n=o):p>0&&(r+=u*p,n+=l*p)}return u=e-r,l=i-n,u*u+l*l}function cn(e,i,r,n){var t={id:typeof e=="undefined"?null:e,type:i,geometry:r,tags:n,minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity};return yn(t),t}function yn(e){var i=e.geometry,r=e.type;if(r==="Point"||r==="MultiPoint"||r==="LineString")Ii(e,i);else if(r==="Polygon"||r==="MultiLineString")for(var n=0;n<i.length;n++)Ii(e,i[n]);else if(r==="MultiPolygon")for(n=0;n<i.length;n++)for(var t=0;t<i[n].length;t++)Ii(e,i[n][t])}function Ii(e,i){for(var r=0;r<i.length;r+=3)e.minX=Math.min(e.minX,i[r]),e.minY=Math.min(e.minY,i[r+1]),e.maxX=Math.max(e.maxX,i[r]),e.maxY=Math.max(e.maxY,i[r+1])}function Si(e,i){var r=[];if(e.type==="FeatureCollection")for(var n=0;n<e.features.length;n++)fn(r,e.features[n],i,n);else e.type==="Feature"?fn(r,e,i):fn(r,{geometry:e},i);return r}function fn(e,i,r,n){if(!!i.geometry){var t=i.geometry.coordinates,o=i.geometry.type,u=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),l=[],p=i.id;if(r.promoteId?p=i.properties[r.promoteId]:r.generateId&&(p=n||0),o==="Point")xn(t,l);else if(o==="MultiPoint")for(var v=0;v<t.length;v++)xn(t[v],l);else if(o==="LineString")fi(t,l,u,!1);else if(o==="MultiLineString")if(r.lineMetrics){for(v=0;v<t.length;v++)l=[],fi(t[v],l,u,!1),e.push(cn(p,"LineString",l,i.properties));return}else Ci(t,l,u,!1);else if(o==="Polygon")Ci(t,l,u,!0);else if(o==="MultiPolygon")for(v=0;v<t.length;v++){var x=[];Ci(t[v],x,u,!0),l.push(x)}else if(o==="GeometryCollection"){for(v=0;v<i.geometry.geometries.length;v++)fn(e,{id:p,geometry:i.geometry.geometries[v],properties:i.properties},r,n);return}else throw new Error("Input data is not a valid GeoJSON object.");e.push(cn(p,o,l,i.properties))}}function xn(e,i){i.push(Vi(e[0])),i.push(oo(e[1])),i.push(0)}function fi(e,i,r,n){for(var t,o,u=0,l=0;l<e.length;l++){var p=Vi(e[l][0]),v=oo(e[l][1]);i.push(p),i.push(v),i.push(0),l>0&&(n?u+=(t*v-p*o)/2:u+=Math.sqrt(Math.pow(p-t,2)+Math.pow(v-o,2))),t=p,o=v}var x=i.length-3;i[2]=1,pn(i,0,x,r),i[x+2]=1,i.size=Math.abs(u),i.start=0,i.end=i.size}function Ci(e,i,r,n){for(var t=0;t<e.length;t++){var o=[];fi(e[t],o,r,n),i.push(o)}}function Vi(e){return e/360+.5}function oo(e){var i=Math.sin(e*Math.PI/180),r=.5-.25*Math.log((1+i)/(1-i))/Math.PI;return r<0?0:r>1?1:r}function Pa(e,i,r,n,t,o,u,l){if(r/=i,n/=i,o>=r&&u<n)return e;if(u<r||o>=n)return null;for(var p=[],v=0;v<e.length;v++){var x=e[v],E=x.geometry,C=x.type,T=t===0?x.minX:x.minY,O=t===0?x.maxX:x.maxY;if(T>=r&&O<n){p.push(x);continue}else if(O<r||T>=n)continue;var L=[];if(C==="Point"||C==="MultiPoint")ji(E,L,r,n,t);else if(C==="LineString")is(E,L,r,n,t,!1,l.lineMetrics);else if(C==="MultiLineString")Zo(E,L,r,n,t,!1);else if(C==="Polygon")Zo(E,L,r,n,t,!0);else if(C==="MultiPolygon")for(var B=0;B<E.length;B++){var H=[];Zo(E[B],H,r,n,t,!0),H.length&&L.push(H)}if(L.length){if(l.lineMetrics&&C==="LineString"){for(B=0;B<L.length;B++)p.push(cn(x.id,C,L[B],x.tags));continue}(C==="LineString"||C==="MultiLineString")&&(L.length===1?(C="LineString",L=L[0]):C="MultiLineString"),(C==="Point"||C==="MultiPoint")&&(C=L.length===3?"Point":"MultiPoint"),p.push(cn(x.id,C,L,x.tags))}}return p.length?p:null}function ji(e,i,r,n,t){for(var o=0;o<e.length;o+=3){var u=e[o+t];u>=r&&u<=n&&(i.push(e[o]),i.push(e[o+1]),i.push(e[o+2]))}}function is(e,i,r,n,t,o,u){for(var l=Xa(e),p=t===0?as:Yo,v=e.start,x,E,C=0;C<e.length-3;C+=3){var T=e[C],O=e[C+1],L=e[C+2],B=e[C+3],H=e[C+4],oe=t===0?T:O,le=t===0?B:H,Re=!1;u&&(x=Math.sqrt(Math.pow(T-B,2)+Math.pow(O-H,2))),oe<r?le>r&&(E=p(l,T,O,B,H,r),u&&(l.start=v+x*E)):oe>n?le<n&&(E=p(l,T,O,B,H,n),u&&(l.start=v+x*E)):_o(l,T,O,L),le<r&&oe>=r&&(E=p(l,T,O,B,H,r),Re=!0),le>n&&oe<=n&&(E=p(l,T,O,B,H,n),Re=!0),!o&&Re&&(u&&(l.end=v+x*E),i.push(l),l=Xa(e)),u&&(v+=x)}var Ne=e.length-3;T=e[Ne],O=e[Ne+1],L=e[Ne+2],oe=t===0?T:O,oe>=r&&oe<=n&&_o(l,T,O,L),Ne=l.length-3,o&&Ne>=3&&(l[Ne]!==l[0]||l[Ne+1]!==l[1])&&_o(l,l[0],l[1],l[2]),l.length&&i.push(l)}function Xa(e){var i=[];return i.size=e.size,i.start=e.start,i.end=e.end,i}function Zo(e,i,r,n,t,o){for(var u=0;u<e.length;u++)is(e[u],i,r,n,t,o,!1)}function _o(e,i,r,n){e.push(i),e.push(r),e.push(n)}function as(e,i,r,n,t,o){var u=(o-i)/(n-i);return e.push(o),e.push(r+(t-r)*u),e.push(1),u}function Yo(e,i,r,n,t,o){var u=(o-r)/(t-r);return e.push(i+(n-i)*u),e.push(o),e.push(1),u}function xs(e,i){var r=i.buffer/i.extent,n=e,t=Pa(e,1,-1-r,r,0,-1,2,i),o=Pa(e,1,1-r,2+r,0,-1,2,i);return(t||o)&&(n=Pa(e,1,-r,1+r,0,-1,2,i)||[],t&&(n=po(t,1).concat(n)),o&&(n=n.concat(po(o,-1)))),n}function po(e,i){for(var r=[],n=0;n<e.length;n++){var t=e[n],o=t.type,u;if(o==="Point"||o==="MultiPoint"||o==="LineString")u=Pi(t.geometry,i);else if(o==="MultiLineString"||o==="Polygon"){u=[];for(var l=0;l<t.geometry.length;l++)u.push(Pi(t.geometry[l],i))}else if(o==="MultiPolygon")for(u=[],l=0;l<t.geometry.length;l++){for(var p=[],v=0;v<t.geometry[l].length;v++)p.push(Pi(t.geometry[l][v],i));u.push(p)}r.push(cn(t.id,o,u,t.tags))}return r}function Pi(e,i){var r=[];r.size=e.size,e.start!==void 0&&(r.start=e.start,r.end=e.end);for(var n=0;n<e.length;n+=3)r.push(e[n]+i,e[n+1],e[n+2]);return r}function Uo(e,i){if(e.transformed)return e;var r=1<<e.z,n=e.x,t=e.y,o,u,l;for(o=0;o<e.features.length;o++){var p=e.features[o],v=p.geometry,x=p.type;if(p.geometry=[],x===1)for(u=0;u<v.length;u+=2)p.geometry.push(aa(v[u],v[u+1],i,r,n,t));else for(u=0;u<v.length;u++){var E=[];for(l=0;l<v[u].length;l+=2)E.push(aa(v[u][l],v[u][l+1],i,r,n,t));p.geometry.push(E)}}return e.transformed=!0,e}function aa(e,i,r,n,t,o){return[Math.round(r*(e*n-t)),Math.round(r*(i*n-o))]}function ls(e,i,r,n,t){for(var o=i===t.maxZoom?0:t.tolerance/((1<<i)*t.extent),u={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:n,z:i,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},l=0;l<e.length;l++){u.numFeatures++,_i(u,e[l],o,t);var p=e[l].minX,v=e[l].minY,x=e[l].maxX,E=e[l].maxY;p<u.minX&&(u.minX=p),v<u.minY&&(u.minY=v),x>u.maxX&&(u.maxX=x),E>u.maxY&&(u.maxY=E)}return u}function _i(e,i,r,n){var t=i.geometry,o=i.type,u=[];if(o==="Point"||o==="MultiPoint")for(var l=0;l<t.length;l+=3)u.push(t[l]),u.push(t[l+1]),e.numPoints++,e.numSimplified++;else if(o==="LineString")Ni(u,t,e,r,!1,!1);else if(o==="MultiLineString"||o==="Polygon")for(l=0;l<t.length;l++)Ni(u,t[l],e,r,o==="Polygon",l===0);else if(o==="MultiPolygon")for(var p=0;p<t.length;p++){var v=t[p];for(l=0;l<v.length;l++)Ni(u,v[l],e,r,!0,l===0)}if(u.length){var x=i.tags||null;if(o==="LineString"&&n.lineMetrics){x={};for(var E in i.tags)x[E]=i.tags[E];x.mapbox_clip_start=t.start/t.size,x.mapbox_clip_end=t.end/t.size}var C={geometry:u,type:o==="Polygon"||o==="MultiPolygon"?3:o==="LineString"||o==="MultiLineString"?2:1,tags:x};i.id!==null&&(C.id=i.id),e.features.push(C)}}function Ni(e,i,r,n,t,o){var u=n*n;if(n>0&&i.size<(t?u:n)){r.numPoints+=i.length/3;return}for(var l=[],p=0;p<i.length;p+=3)(n===0||i[p+2]>u)&&(r.numSimplified++,l.push(i[p]),l.push(i[p+1])),r.numPoints++;t&&_a(l,o),e.push(l)}function _a(e,i){for(var r=0,n=0,t=e.length,o=t-2;n<t;o=n,n+=2)r+=(e[n]-e[o])*(e[n+1]+e[o+1]);if(r>0===i)for(n=0,t=e.length;n<t/2;n+=2){var u=e[n],l=e[n+1];e[n]=e[t-2-n],e[n+1]=e[t-1-n],e[t-2-n]=u,e[t-1-n]=l}}function Oo(e,i){return new Ou(e,i)}function Ou(e,i){i=this.options=cr(Object.create(this.options),i);var r=i.debug;if(r&&console.time("preprocess data"),i.maxZoom<0||i.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(i.promoteId&&i.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=Si(e,i);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",i.indexMaxZoom,i.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),n=xs(n,i),n.length&&this.splitTile(n,0,0,0),r&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}Ou.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ou.prototype.splitTile=function(e,i,r,n,t,o,u){for(var l=[e,i,r,n],p=this.options,v=p.debug;l.length;){n=l.pop(),r=l.pop(),i=l.pop(),e=l.pop();var x=1<<i,E=Ue(i,r,n),C=this.tiles[E];if(!C&&(v>1&&console.time("creation"),C=this.tiles[E]=ls(e,i,r,n,p),this.tileCoords.push({z:i,x:r,y:n}),v)){v>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",i,r,n,C.numFeatures,C.numPoints,C.numSimplified),console.timeEnd("creation"));var T="z"+i;this.stats[T]=(this.stats[T]||0)+1,this.total++}if(C.source=e,t){if(i===p.maxZoom||i===t)continue;var O=1<<t-i;if(r!==Math.floor(o/O)||n!==Math.floor(u/O))continue}else if(i===p.indexMaxZoom||C.numPoints<=p.indexMaxPoints)continue;if(C.source=null,e.length!==0){v>1&&console.time("clipping");var L=.5*p.buffer/p.extent,B=.5-L,H=.5+L,oe=1+L,le,Re,Ne,ut,Ot,Nt;le=Re=Ne=ut=null,Ot=Pa(e,x,r-L,r+H,0,C.minX,C.maxX,p),Nt=Pa(e,x,r+B,r+oe,0,C.minX,C.maxX,p),e=null,Ot&&(le=Pa(Ot,x,n-L,n+H,1,C.minY,C.maxY,p),Re=Pa(Ot,x,n+B,n+oe,1,C.minY,C.maxY,p),Ot=null),Nt&&(Ne=Pa(Nt,x,n-L,n+H,1,C.minY,C.maxY,p),ut=Pa(Nt,x,n+B,n+oe,1,C.minY,C.maxY,p),Nt=null),v>1&&console.timeEnd("clipping"),l.push(le||[],i+1,r*2,n*2),l.push(Re||[],i+1,r*2,n*2+1),l.push(Ne||[],i+1,r*2+1,n*2),l.push(ut||[],i+1,r*2+1,n*2+1)}}},Ou.prototype.getTile=function(e,i,r){var n=this.options,t=n.extent,o=n.debug;if(e<0||e>24)return null;var u=1<<e;i=(i%u+u)%u;var l=Ue(e,i,r);if(this.tiles[l])return Uo(this.tiles[l],t);o>1&&console.log("drilling down to z%d-%d-%d",e,i,r);for(var p=e,v=i,x=r,E;!E&&p>0;)p--,v=Math.floor(v/2),x=Math.floor(x/2),E=this.tiles[Ue(p,v,x)];return!E||!E.source?null:(o>1&&console.log("found parent tile z%d-%d-%d",p,v,x),o>1&&console.time("drilling down"),this.splitTile(E.source,p,v,x,e,i,r),o>1&&console.timeEnd("drilling down"),this.tiles[l]?Uo(this.tiles[l],t):null)};function Ue(e,i,r){return((1<<e)*r+i)*32+e}function cr(e,i){for(var r in i)e[r]=i[r];return e}var Ht=function(){function e(i,r,n,t){(0,xt.Z)(this,e),(0,Y.Z)(this,"vectorLayerCache",{}),this.x=r,this.y=n,this.z=t,this.vectorTile=i}return(0,wt.Z)(e,[{key:"getTileData",value:function(r){if(!r||!this.vectorTile.layers[r])return[];if(this.vectorLayerCache[r])return this.vectorLayerCache[r];var n=this.vectorTile.layers[r];return n.features}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),Rn={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0};function Hi(e){for(var i=0,r=0,n=e.length,t=n-1,o,u;r<n;t=r++)o=e[r],u=e[t],i+=(u.x-o.x)*(o.y+u.y);return i}function Le(e){var i=e.length;if(i<=1)return[e];for(var r=[],n,t,o=0;o<i;o++){var u=Hi(e[o]);u!==0&&(t===void 0&&(t=u<0),t===u<0?(n&&r.push(n),n=[e[o]]):n.push(e[o]))}return n&&r.push(n),r}var be=["Unknown","Point","LineString","Polygon"];function st(e,i,r,n,t){var o=t.geometry,u=t.type,l=t.tags,p=t.id,v=e*Math.pow(2,n),x=e*i,E=e*r,C=be[u],T,O;function L(oe){for(var le=0;le<oe.length;le++){var Re=oe[le];if(Re[3])break;var Ne=180-(Re[1]+E)*360/v,ut=(Re[0]+x)*360/v-180,Ot=360/Math.PI*Math.atan(Math.exp(Ne*Math.PI/180))-90;oe[le]=[ut,Ot,0,1]}}switch(u){case 1:var B=[];for(T=0;T<o.length;T++)B[T]=o[T][0];o=B,L(o);break;case 2:for(T=0;T<o.length;T++)L(o[T]);break;case 3:for(o=Le(o),T=0;T<o.length;T++)for(O=0;O<o[T].length;O++)L(o[T][O]);break}o.length===1?o=o[0]:C="Multi"+C;var H={type:"Feature",geometry:{type:C,coordinates:o},properties:l,id:p,tileOrigin:[0,0],coord:""};return H}var Lt=function(){var e=(0,de.Z)(q().mark(function i(r,n,t,o){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",new Promise(function(p){var v=n.getTile(r.z,r.x,r.y),x=v?v.features.map(function(T){return st(o,t.x,t.y,t.z,T)}):[],E={layers:{defaultLayer:{features:x}}},C=new Ht(E,r.x,r.y,r.z);p(C)}));case 1:case"end":return l.stop()}},i)}));return function(r,n,t,o){return e.apply(this,arguments)}}();function Kt(e){var i={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return e===void 0||typeof e.geojsonvtOptions=="undefined"?i:(0,z.Z)((0,z.Z)({},i),e.geojsonvtOptions)}function vt(e,i){var r=Kt(i),n=r.extent||4096,t=Oo(e,r),o=function(p,v){return Lt(v,t,p,n)},u=(0,z.Z)((0,z.Z)((0,z.Z)({},Rn),i),{},{getTileData:o});return{data:e,dataArray:[],tilesetOptions:u,isTile:!0}}function qe(e,i,r){switch(e){case"+":return i+r;case"-":return i-r;case"*":return i*r;case"/":return i/r;case"%":return i%r;case"^":return Math.pow(i,r);case"abs":return Math.abs(i);case"floor":return Math.floor(i);case"round":return Math.round(i);case"ceil":return Math.ceil(i);case"sin":return Math.sin(i);case"cos":return Math.cos(i);case"atan":return r===-1?Math.atan(i):Math.atan2(i,r);default:return console.warn("Calculate symbol err! Return default 0"),0}}function Et(e,i){for(var r=i[0],n=r.width,t=r.height,o=i.map(function(T){return T.rasterData}),u=n*t,l=[],p=JSON.stringify(e),v=0;v<u;v++){var x=JSON.parse(p),E=Ie(x,o,v);if(typeof E=="number")l.push(E);else{var C=Be(x);l.push(C)}}return l}function Ie(e,i,r){if(e.length===2&&e[0]==="band"&&typeof e[1]=="number")try{return i[e[1]][r]}catch(n){return console.warn("Raster Data err!"),0}e.map(function(n,t){if(Array.isArray(n)&&n.length>0)switch(n[0]){case"band":try{e[t]=i[n[1]][r]}catch(o){console.warn("Raster Data err!"),e[t]=0}break;default:Ie(n,i,r)}})}function it(e){var i=(0,hr.Z)(e,3),r=i[0],n=i[1],t=n===void 0?-1:n,o=i[2],u=o===void 0?-1:o;if(r===void 0)return console.warn("Express err!"),["+",0,0];var l=r.replace(/\s+/g,"");return[l,t,u]}function Be(e){var i=it(e),r=i[0],n=i[1],t=i[2];return Array.isArray(n)&&(n=Be(e[1])),Array.isArray(t)&&(t=Be(e[2])),qe(r,n,t)}var Dt={nd:{type:"operation",expression:["/",["-",["band",1],["band",0]],["+",["band",1],["band",0]]]},rgb:{type:"function",method:Wt}};function Wt(e,i){for(var r=e[0].rasterData,n=e[1].rasterData,t=e[2].rasterData,o=[],u=(i==null?void 0:i.countCut)||[2,98],l=(0,hr.Z)(u,2),p=l[0],v=l[1],x=(i==null?void 0:i.RMinMax)||kr(r,p,v),E=(i==null?void 0:i.GMinMax)||kr(n,p,v),C=(i==null?void 0:i.BMinMax)||kr(t,p,v),T=0;T<r.length;T++)o.push(Math.max(0,r[T]-x[0])),o.push(Math.max(0,n[T]-E[0])),o.push(Math.max(0,t[T]-C[0]));return{rasterData:o,rMinMax:x,gMinMax:E,bMinMax:C}}function kr(e,i,r){var n=e.slice().sort(function(l,p){return l-p}),t=n.length,o=n[Math.ceil(t*i/100)],u=n[Math.ceil(t*r/100)];return[o,u]}function sn(e,i,r){return un.apply(this,arguments)}function un(){return un=(0,de.Z)(q().mark(function e(i,r,n){var t,o,u,l,p,v;return q().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(i.length!==0){E.next=2;break}return E.abrupt("return",{rasterData:[0],width:1,heigh:1});case 2:return E.next=4,Promise.all(i.map(function(C){var T=C.data,O=C.bands,L=O===void 0?[0]:O;return r(T,L)}));case 4:t=E.sent,o=[],t.forEach(function(C){Array.isArray(C)?o.push.apply(o,(0,N.Z)(C)):o.push(C)}),u=o[0],l=u.width,p=u.height,E.t0=(0,Pe.Z)(n),E.next=E.t0==="function"?11:E.t0==="object"?13:15;break;case 11:return v=n(o),E.abrupt("break",16);case 13:return Array.isArray(n)?v={rasterData:Et(n,o)}:v=bn(n,o),E.abrupt("break",16);case 15:v={rasterData:o[0].rasterData};case 16:return E.abrupt("return",(0,z.Z)((0,z.Z)({},v),{},{width:l,height:p}));case 17:case"end":return E.stop()}},e)})),un.apply(this,arguments)}function bn(e,i){var r=Dt[e.type];if(r.type==="function")return r.method(i,e==null?void 0:e.options);if(r.type==="operation")return e.type==="rgb"?an(r.expression,i):{rasterData:Et(r.expression,i)}}function an(e,i){e.r===void 0&&console.warn("Channel R lost in Operation! Use band[0] to fill!"),e.g===void 0&&console.warn("Channel G lost in Operation! Use band[0] to fill!"),e.b===void 0&&console.warn("Channel B lost in Operation! Use band[0] to fill!");var r=Et(e.r||["band",0],i),n=Et(e.g||["band",0],i),t=Et(e.b||["band",0],i);return[r,n,t]}function Un(e,i,r,n){return Sn.apply(this,arguments)}function Sn(){return Sn=(0,de.Z)(q().mark(function e(i,r,n,t){var o;return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,sn(i,r,n);case 2:o=l.sent,t(null,{data:o});case 4:case"end":return l.stop()}},e)})),Sn.apply(this,arguments)}function zn(e,i){return e.map(function(r){return r[i]*1})}function Bn(e){return e===void 0?!1:!Array.isArray(e)&&e.data!==void 0}function On(e){return Array.isArray(e)?e.length===0?!1:!!Bn(e[0]):!1}function hi(e){return Array.isArray(e)?e.length===0||typeof e[0]=="number":!1}function Ma(e,i){var r=i.extent,n=i.width,t=i.height,o=i.min,u=i.max,l=i.format,p=i.operation,v,x,E;if(l===void 0||hi(e))v=Array.from(e),x=n,E=t;else{var C=Array.isArray(e)?e:[e];v=sn(C,l,p)}var T={_id:1,dataArray:[{_id:1,data:v,width:x,height:E,min:o,max:u,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]};return T}var Za=K(81253),Ga=["extent","min","max","width","height","format","operation"];function xa(e,i){var r=i.extent,n=i.min,t=i.max,o=i.width,u=i.height,l=i.format,p=i.operation,v=(0,Za.Z)(i,Ga),x;if(l===void 0||hi(e))x=Array.from(e);else{var E=Array.isArray(e)?e:[e];x=sn(E,l,p)}var C={_id:1,dataArray:[(0,z.Z)((0,z.Z)({_id:1,data:x,width:o,height:u},v),{},{min:n,max:t,coordinates:[[r[0],r[1]],[r[2],r[3]]]})]};return C}var ql=K(28660),Qr=K(86700),rl=K(84879),Yt={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},gp=K(31745),Lu=K.n(gp);function Kl(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=hh(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function hh(e,i){if(!!e){if(typeof e=="string")return Gd(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Gd(e,i)}}function Gd(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Co=30;function yp(e){var i=e.characterSet,r=e.getFontWidth,n=e.fontHeight,t=e.buffer,o=e.maxCanvasWidth,u=e.mapping,l=u===void 0?{}:u,p=e.xOffset,v=p===void 0?0:p,x=e.yOffset,E=x===void 0?0:x,C=0,T=v;Array.from(i).forEach(function(L,B){if(!l[L]){var H=r(L,B);T+Co>o&&(T=0,C++),l[L]={x:T,y:E+C*Co,width:Co,height:Co,advance:H},T+=Co}});var O=n+t*2;return{mapping:l,xOffset:T,yOffset:E+C*O,canvasHeight:xp(E+(C+1)*O)}}function nf(e,i,r){var n=0,t=0,o=0,u=[],l={},p=Kl(e),v;try{for(p.s();!(v=p.n()).done;){var x=v.value;if(!l[x.id]){var E=x.size;n+E+i>r&&(_p(l,u,t),n=0,t=o+t+i,o=0,u=[]),u.push({icon:x,xOffset:n}),n=n+E+i,o=Math.max(o,E)}}}catch(T){p.e(T)}finally{p.f()}u.length>0&&_p(l,u,t);var C=xp(o+t+i);return{mapping:l,canvasHeight:C}}function _p(e,i,r){var n=Kl(i),t;try{for(n.s();!(t=n.n()).done;){var o=t.value,u=o.icon,l=o.xOffset;e[u.id]=(0,z.Z)((0,z.Z)({},u),{},{x:l,y:r,image:u.image,width:u.width,height:u.height})}}catch(p){n.e(p)}finally{n.f()}}function xp(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var ad,ph;function Sc(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Ov(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function Ov(e,i){if(!!e){if(typeof e=="string")return Hd(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Hd(e,i)}}function Hd(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function U0(e){var i=bs();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function bs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Pf=X(),Lv="sans-serif",a="normal",s=24,c=3,m=.25,_=8,S=1024,A=1,P=1,F=3,j=null;function X(){for(var e=[],i=32;i<128;i++)e.push(String.fromCharCode(i));return e}function ee(e,i,r,n){e.font="".concat(n," ").concat(r,"px ").concat(i),e.fillStyle="black",e.textBaseline="middle"}function fe(e,i){for(var r=0;r<e.length;r++)i.data[4*r+3]=e[r]}var xe=(ad=(0,Qr.b2)(),ad(ph=function(e){(0,gr.Z)(r,e);var i=U0(r);function r(){var n;(0,xt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,De.Z)(n),"fontAtlas",void 0),(0,Y.Z)((0,De.Z)(n),"iconFontMap",void 0),(0,Y.Z)((0,De.Z)(n),"iconFontGlyphs",{}),(0,Y.Z)((0,De.Z)(n),"fontOptions",void 0),(0,Y.Z)((0,De.Z)(n),"key",void 0),(0,Y.Z)((0,De.Z)(n),"cache",new M(F)),n}return(0,wt.Z)(r,[{key:"scale",get:function(){return P}},{key:"canvas",get:function(){var t=this.cache.get(this.key);return t&&t.data}},{key:"mapping",get:function(){var t=this.cache.get(this.key);return t&&t.mapping||{}}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:Lv,fontWeight:a,characterSet:Pf,fontSize:s,buffer:c,sdf:!0,cutoff:m,radius:_,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(t){var o=this;t.forEach(function(u){o.iconFontGlyphs[u.name]=u.unicode})}},{key:"addIconFont",value:function(t,o){this.iconFontMap.set(t,o)}},{key:"getIconFontKey",value:function(t){return this.iconFontMap.get(t)||t}},{key:"getGlyph",value:function(t){return this.iconFontGlyphs[t]?String.fromCharCode(parseInt(this.iconFontGlyphs[t],16)):""}},{key:"setFontOptions",value:function(t){this.fontOptions=(0,z.Z)((0,z.Z)({},this.fontOptions),t),this.key=this.getKey();var o=this.getNewChars(this.key,this.fontOptions.characterSet),u=this.cache.get(this.key);if(!(u&&o.length===0)){var l=this.generateFontAtlas(this.key,o,u);this.fontAtlas=l,this.cache.set(this.key,l)}}},{key:"addFontFace",value:function(t,o){var u=this,l=document.createElement("style");l.type="text/css",l.innerText=`
        @font-face{
            font-family: '`.concat(t,`';
            src: url('`).concat(o,`') format('woff2'),
            url('`).concat(o,`') format('woff'),
            url('`).concat(o,`') format('truetype');
        }`),l.onload=function(){if(document.fonts)try{document.fonts.load("24px ".concat(t),"L7text"),document.fonts.ready.then(function(){u.emit("fontloaded",{fontFamily:t})})}catch(p){console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(p)}},document.getElementsByTagName("head")[0].appendChild(l)}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(t,o,u){var l=this.fontOptions,p=l.fontFamily,v=l.fontWeight,x=l.fontSize,E=l.buffer,C=l.sdf,T=l.radius,O=l.cutoff,L=l.iconfont,B=u&&u.data;B||(B=pa.document.createElement("canvas"),B.width=S);var H=B.getContext("2d",{willReadFrequently:!0});ee(H,p,x,v);var oe=yp((0,z.Z)({getFontWidth:function(Ko){return H.measureText(Ko).width},fontHeight:x*P,buffer:E,characterSet:o,maxCanvasWidth:S},u&&{mapping:u.mapping,xOffset:u.xOffset,yOffset:u.yOffset})),le=oe.mapping,Re=oe.canvasHeight,Ne=oe.xOffset,ut=oe.yOffset,Ot=H.getImageData(0,0,B.width,B.height);if(B.height=Re,H.putImageData(Ot,0,0),ee(H,p,x,v),C){var Nt=new(Lu())(x,E,T,O,p,v),jt=H.getImageData(0,0,Nt.size,Nt.size),br=Sc(o),yr;try{for(br.s();!(yr=br.n()).done;){var Ur=yr.value;if(L){var An=String.fromCharCode(parseInt(Ur.replace("&#x","").replace(";",""),16)),jn=Nt.draw(An);fe(jn,jt)}else fe(Nt.draw(Ur),jt);H.putImageData(jt,le[Ur].x,le[Ur].y)}}catch(Ao){br.e(Ao)}finally{br.f()}}else{var Qi=Sc(o),Ca;try{for(Qi.s();!(Ca=Qi.n()).done;){var bo=Ca.value;H.fillText(bo,le[bo].x,le[bo].y+x*A)}}catch(Ao){Qi.e(Ao)}finally{Qi.f()}}return{xOffset:Ne,yOffset:ut,mapping:le,data:B,width:B.width,height:B.height}}},{key:"getKey",value:function(){return"key";var t,o,u,l,p,v,x,E}},{key:"getNewChars",value:function(t,o){var u=this.cache.get(t);if(!u)return o;var l=[],p=u.mapping,v=new Set(Object.keys(p)),x=new Set(o);return x.forEach(function(E){v.has(E)||l.push(E)}),l}}]),r}(Ns.EventEmitter))||ph),je,He;function pt(e){var i=nt();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function nt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kt=3,Gt=1024,sr=64,vr=(je=(0,Qr.b2)(),je(He=function(e){(0,gr.Z)(r,e);var i=pt(r);function r(){var n;(0,xt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,De.Z)(n),"canvasHeight",128),(0,Y.Z)((0,De.Z)(n),"texture",void 0),(0,Y.Z)((0,De.Z)(n),"canvas",void 0),(0,Y.Z)((0,De.Z)(n),"iconData",void 0),(0,Y.Z)((0,De.Z)(n),"iconMap",void 0),(0,Y.Z)((0,De.Z)(n),"ctx",void 0),(0,Y.Z)((0,De.Z)(n),"loadingImageCount",0),n}return(0,wt.Z)(r,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=pa.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(){var n=(0,de.Z)(q().mark(function o(u,l){var p,v;return q().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return p=new Image,this.loadingImageCount++,this.hasImage(u)?console.warn("Image Id already exists"):this.iconData.push({id:u,size:sr}),this.updateIconMap(),E.next=6,this.loadImage(l);case 6:p=E.sent,v=this.iconData.find(function(C){return C.id===u}),v&&(v.image=p,v.width=p.width,v.height=p.height),this.update();case 10:case"end":return E.stop()}},o,this)}));function t(o,u){return n.apply(this,arguments)}return t}()},{key:"addImageMini",value:function(t,o,u){var l=this,p=u.getSceneConfig().canvas,v=p.createImage();if(this.loadingImageCount++,this.hasImage(t))throw new Error("Image Id already exists");this.iconData.push({id:t,size:sr}),this.updateIconMap(),this.loadImageMini(o,p).then(function(x){v=x;var E=l.iconData.find(function(C){return C.id===t});E&&(E.image=v,E.width=v.width,E.height=v.height),l.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(t){return this.iconMap.hasOwnProperty(t)}},{key:"removeImage",value:function(t){this.hasImage(t)&&(this.iconData=this.iconData.filter(function(o){return o.id!==t}),delete this.iconMap[t],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(t){return new Promise(function(o,u){if(t instanceof HTMLImageElement){o(t);return}var l=new Image;l.crossOrigin="anonymous",l.onload=function(){o(l)},l.onerror=function(){u(new Error("Could not load image at "+t))},l.src=t instanceof File?URL.createObjectURL(t):t})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var t=this;this.canvas.width=Gt,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(o){var u=t.iconMap[o],l=u.x,p=u.y,v=u.image,x=u.width,E=x===void 0?64:x,C=u.height,T=C===void 0?64:C,O=Math.max(E,T),L=O/sr,B=T/L,H=E/L;v&&t.ctx.drawImage(v,l+(sr-H)/2,p+(sr-B)/2,H,B)})}},{key:"updateIconMap",value:function(){var t=nf(this.iconData,kt,Gt),o=t.mapping,u=t.canvasHeight;this.iconMap=o,this.canvasHeight=u}},{key:"loadImageMini",value:function(t,o){return new Promise(function(u,l){var p=o.createImage();p.crossOrigin="anonymous",p.onload=function(){u(p)},p.onerror=function(){l(new Error("Could not load image at "+t))},p.src=t})}}]),r}(Ns.EventEmitter))||He),fr=K(49685);function Hr(){var e=new fr.WT(16);return fr.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function dn(e){var i=new fr.WT(16);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function Kn(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function kn(e,i,r,n,t,o,u,l,p,v,x,E,C,T,O,L){var B=new fr.WT(16);return B[0]=e,B[1]=i,B[2]=r,B[3]=n,B[4]=t,B[5]=o,B[6]=u,B[7]=l,B[8]=p,B[9]=v,B[10]=x,B[11]=E,B[12]=C,B[13]=T,B[14]=O,B[15]=L,B}function ai(e,i,r,n,t,o,u,l,p,v,x,E,C,T,O,L,B){return e[0]=i,e[1]=r,e[2]=n,e[3]=t,e[4]=o,e[5]=u,e[6]=l,e[7]=p,e[8]=v,e[9]=x,e[10]=E,e[11]=C,e[12]=T,e[13]=O,e[14]=L,e[15]=B,e}function In(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function zi(e,i){if(e===i){var r=i[1],n=i[2],t=i[3],o=i[6],u=i[7],l=i[11];e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=r,e[6]=i[9],e[7]=i[13],e[8]=n,e[9]=o,e[11]=i[14],e[12]=t,e[13]=u,e[14]=l}else e[0]=i[0],e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=i[1],e[5]=i[5],e[6]=i[9],e[7]=i[13],e[8]=i[2],e[9]=i[6],e[10]=i[10],e[11]=i[14],e[12]=i[3],e[13]=i[7],e[14]=i[11],e[15]=i[15];return e}function di(e,i){var r=i[0],n=i[1],t=i[2],o=i[3],u=i[4],l=i[5],p=i[6],v=i[7],x=i[8],E=i[9],C=i[10],T=i[11],O=i[12],L=i[13],B=i[14],H=i[15],oe=r*l-n*u,le=r*p-t*u,Re=r*v-o*u,Ne=n*p-t*l,ut=n*v-o*l,Ot=t*v-o*p,Nt=x*L-E*O,jt=x*B-C*O,br=x*H-T*O,yr=E*B-C*L,Ur=E*H-T*L,An=C*H-T*B,jn=oe*An-le*Ur+Re*yr+Ne*br-ut*jt+Ot*Nt;return jn?(jn=1/jn,e[0]=(l*An-p*Ur+v*yr)*jn,e[1]=(t*Ur-n*An-o*yr)*jn,e[2]=(L*Ot-B*ut+H*Ne)*jn,e[3]=(C*ut-E*Ot-T*Ne)*jn,e[4]=(p*br-u*An-v*jt)*jn,e[5]=(r*An-t*br+o*jt)*jn,e[6]=(B*Re-O*Ot-H*le)*jn,e[7]=(x*Ot-C*Re+T*le)*jn,e[8]=(u*Ur-l*br+v*Nt)*jn,e[9]=(n*br-r*Ur-o*Nt)*jn,e[10]=(O*ut-L*Re+H*oe)*jn,e[11]=(E*Re-x*ut-T*oe)*jn,e[12]=(l*jt-u*yr-p*Nt)*jn,e[13]=(r*yr-n*jt+t*Nt)*jn,e[14]=(L*le-O*Ne-B*oe)*jn,e[15]=(x*Ne-E*le+C*oe)*jn,e):null}function Xn(e,i){var r=i[0],n=i[1],t=i[2],o=i[3],u=i[4],l=i[5],p=i[6],v=i[7],x=i[8],E=i[9],C=i[10],T=i[11],O=i[12],L=i[13],B=i[14],H=i[15];return e[0]=l*(C*H-T*B)-E*(p*H-v*B)+L*(p*T-v*C),e[1]=-(n*(C*H-T*B)-E*(t*H-o*B)+L*(t*T-o*C)),e[2]=n*(p*H-v*B)-l*(t*H-o*B)+L*(t*v-o*p),e[3]=-(n*(p*T-v*C)-l*(t*T-o*C)+E*(t*v-o*p)),e[4]=-(u*(C*H-T*B)-x*(p*H-v*B)+O*(p*T-v*C)),e[5]=r*(C*H-T*B)-x*(t*H-o*B)+O*(t*T-o*C),e[6]=-(r*(p*H-v*B)-u*(t*H-o*B)+O*(t*v-o*p)),e[7]=r*(p*T-v*C)-u*(t*T-o*C)+x*(t*v-o*p),e[8]=u*(E*H-T*L)-x*(l*H-v*L)+O*(l*T-v*E),e[9]=-(r*(E*H-T*L)-x*(n*H-o*L)+O*(n*T-o*E)),e[10]=r*(l*H-v*L)-u*(n*H-o*L)+O*(n*v-o*l),e[11]=-(r*(l*T-v*E)-u*(n*T-o*E)+x*(n*v-o*l)),e[12]=-(u*(E*B-C*L)-x*(l*B-p*L)+O*(l*C-p*E)),e[13]=r*(E*B-C*L)-x*(n*B-t*L)+O*(n*C-t*E),e[14]=-(r*(l*B-p*L)-u*(n*B-t*L)+O*(n*p-t*l)),e[15]=r*(l*C-p*E)-u*(n*C-t*E)+x*(n*p-t*l),e}function Wi(e){var i=e[0],r=e[1],n=e[2],t=e[3],o=e[4],u=e[5],l=e[6],p=e[7],v=e[8],x=e[9],E=e[10],C=e[11],T=e[12],O=e[13],L=e[14],B=e[15],H=i*u-r*o,oe=i*l-n*o,le=i*p-t*o,Re=r*l-n*u,Ne=r*p-t*u,ut=n*p-t*l,Ot=v*O-x*T,Nt=v*L-E*T,jt=v*B-C*T,br=x*L-E*O,yr=x*B-C*O,Ur=E*B-C*L;return H*Ur-oe*yr+le*br+Re*jt-Ne*Nt+ut*Ot}function xi(e,i,r){var n=i[0],t=i[1],o=i[2],u=i[3],l=i[4],p=i[5],v=i[6],x=i[7],E=i[8],C=i[9],T=i[10],O=i[11],L=i[12],B=i[13],H=i[14],oe=i[15],le=r[0],Re=r[1],Ne=r[2],ut=r[3];return e[0]=le*n+Re*l+Ne*E+ut*L,e[1]=le*t+Re*p+Ne*C+ut*B,e[2]=le*o+Re*v+Ne*T+ut*H,e[3]=le*u+Re*x+Ne*O+ut*oe,le=r[4],Re=r[5],Ne=r[6],ut=r[7],e[4]=le*n+Re*l+Ne*E+ut*L,e[5]=le*t+Re*p+Ne*C+ut*B,e[6]=le*o+Re*v+Ne*T+ut*H,e[7]=le*u+Re*x+Ne*O+ut*oe,le=r[8],Re=r[9],Ne=r[10],ut=r[11],e[8]=le*n+Re*l+Ne*E+ut*L,e[9]=le*t+Re*p+Ne*C+ut*B,e[10]=le*o+Re*v+Ne*T+ut*H,e[11]=le*u+Re*x+Ne*O+ut*oe,le=r[12],Re=r[13],Ne=r[14],ut=r[15],e[12]=le*n+Re*l+Ne*E+ut*L,e[13]=le*t+Re*p+Ne*C+ut*B,e[14]=le*o+Re*v+Ne*T+ut*H,e[15]=le*u+Re*x+Ne*O+ut*oe,e}function qi(e,i,r){var n=r[0],t=r[1],o=r[2],u,l,p,v,x,E,C,T,O,L,B,H;return i===e?(e[12]=i[0]*n+i[4]*t+i[8]*o+i[12],e[13]=i[1]*n+i[5]*t+i[9]*o+i[13],e[14]=i[2]*n+i[6]*t+i[10]*o+i[14],e[15]=i[3]*n+i[7]*t+i[11]*o+i[15]):(u=i[0],l=i[1],p=i[2],v=i[3],x=i[4],E=i[5],C=i[6],T=i[7],O=i[8],L=i[9],B=i[10],H=i[11],e[0]=u,e[1]=l,e[2]=p,e[3]=v,e[4]=x,e[5]=E,e[6]=C,e[7]=T,e[8]=O,e[9]=L,e[10]=B,e[11]=H,e[12]=u*n+x*t+O*o+i[12],e[13]=l*n+E*t+L*o+i[13],e[14]=p*n+C*t+B*o+i[14],e[15]=v*n+T*t+H*o+i[15]),e}function Qn(e,i,r){var n=r[0],t=r[1],o=r[2];return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=i[3]*n,e[4]=i[4]*t,e[5]=i[5]*t,e[6]=i[6]*t,e[7]=i[7]*t,e[8]=i[8]*o,e[9]=i[9]*o,e[10]=i[10]*o,e[11]=i[11]*o,e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function ba(e,i,r,n){var t=n[0],o=n[1],u=n[2],l=Math.hypot(t,o,u),p,v,x,E,C,T,O,L,B,H,oe,le,Re,Ne,ut,Ot,Nt,jt,br,yr,Ur,An,jn,Qi;return l<fr.Ib?null:(l=1/l,t*=l,o*=l,u*=l,p=Math.sin(r),v=Math.cos(r),x=1-v,E=i[0],C=i[1],T=i[2],O=i[3],L=i[4],B=i[5],H=i[6],oe=i[7],le=i[8],Re=i[9],Ne=i[10],ut=i[11],Ot=t*t*x+v,Nt=o*t*x+u*p,jt=u*t*x-o*p,br=t*o*x-u*p,yr=o*o*x+v,Ur=u*o*x+t*p,An=t*u*x+o*p,jn=o*u*x-t*p,Qi=u*u*x+v,e[0]=E*Ot+L*Nt+le*jt,e[1]=C*Ot+B*Nt+Re*jt,e[2]=T*Ot+H*Nt+Ne*jt,e[3]=O*Ot+oe*Nt+ut*jt,e[4]=E*br+L*yr+le*Ur,e[5]=C*br+B*yr+Re*Ur,e[6]=T*br+H*yr+Ne*Ur,e[7]=O*br+oe*yr+ut*Ur,e[8]=E*An+L*jn+le*Qi,e[9]=C*An+B*jn+Re*Qi,e[10]=T*An+H*jn+Ne*Qi,e[11]=O*An+oe*jn+ut*Qi,i!==e&&(e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e)}function $a(e,i,r){var n=Math.sin(r),t=Math.cos(r),o=i[4],u=i[5],l=i[6],p=i[7],v=i[8],x=i[9],E=i[10],C=i[11];return i!==e&&(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[4]=o*t+v*n,e[5]=u*t+x*n,e[6]=l*t+E*n,e[7]=p*t+C*n,e[8]=v*t-o*n,e[9]=x*t-u*n,e[10]=E*t-l*n,e[11]=C*t-p*n,e}function xo(e,i,r){var n=Math.sin(r),t=Math.cos(r),o=i[0],u=i[1],l=i[2],p=i[3],v=i[8],x=i[9],E=i[10],C=i[11];return i!==e&&(e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=o*t-v*n,e[1]=u*t-x*n,e[2]=l*t-E*n,e[3]=p*t-C*n,e[8]=o*n+v*t,e[9]=u*n+x*t,e[10]=l*n+E*t,e[11]=p*n+C*t,e}function vo(e,i,r){var n=Math.sin(r),t=Math.cos(r),o=i[0],u=i[1],l=i[2],p=i[3],v=i[4],x=i[5],E=i[6],C=i[7];return i!==e&&(e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=o*t+v*n,e[1]=u*t+x*n,e[2]=l*t+E*n,e[3]=p*t+C*n,e[4]=v*t-o*n,e[5]=x*t-u*n,e[6]=E*t-l*n,e[7]=C*t-p*n,e}function so(e,i){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function Lo(e,i){return e[0]=i[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=i[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function cs(e,i,r){var n=r[0],t=r[1],o=r[2],u=Math.hypot(n,t,o),l,p,v;return u<fr.Ib?null:(u=1/u,n*=u,t*=u,o*=u,l=Math.sin(i),p=Math.cos(i),v=1-p,e[0]=n*n*v+p,e[1]=t*n*v+o*l,e[2]=o*n*v-t*l,e[3]=0,e[4]=n*t*v-o*l,e[5]=t*t*v+p,e[6]=o*t*v+n*l,e[7]=0,e[8]=n*o*v+t*l,e[9]=t*o*v-n*l,e[10]=o*o*v+p,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function fs(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function $s(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Es(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function zs(e,i,r){var n=i[0],t=i[1],o=i[2],u=i[3],l=n+n,p=t+t,v=o+o,x=n*l,E=n*p,C=n*v,T=t*p,O=t*v,L=o*v,B=u*l,H=u*p,oe=u*v;return e[0]=1-(T+L),e[1]=E+oe,e[2]=C-H,e[3]=0,e[4]=E-oe,e[5]=1-(x+L),e[6]=O+B,e[7]=0,e[8]=C+H,e[9]=O-B,e[10]=1-(x+T),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Vo(e,i){var r=new fr.WT(3),n=-i[0],t=-i[1],o=-i[2],u=i[3],l=i[4],p=i[5],v=i[6],x=i[7],E=n*n+t*t+o*o+u*u;return E>0?(r[0]=(l*u+x*n+p*o-v*t)*2/E,r[1]=(p*u+x*t+v*n-l*o)*2/E,r[2]=(v*u+x*o+l*t-p*n)*2/E):(r[0]=(l*u+x*n+p*o-v*t)*2,r[1]=(p*u+x*t+v*n-l*o)*2,r[2]=(v*u+x*o+l*t-p*n)*2),zs(e,i,r),e}function Ss(e,i){return e[0]=i[12],e[1]=i[13],e[2]=i[14],e}function Ki(e,i){var r=i[0],n=i[1],t=i[2],o=i[4],u=i[5],l=i[6],p=i[8],v=i[9],x=i[10];return e[0]=Math.hypot(r,n,t),e[1]=Math.hypot(o,u,l),e[2]=Math.hypot(p,v,x),e}function Ha(e,i){var r=new fr.WT(3);Ki(r,i);var n=1/r[0],t=1/r[1],o=1/r[2],u=i[0]*n,l=i[1]*t,p=i[2]*o,v=i[4]*n,x=i[5]*t,E=i[6]*o,C=i[8]*n,T=i[9]*t,O=i[10]*o,L=u+x+O,B=0;return L>0?(B=Math.sqrt(L+1)*2,e[3]=.25*B,e[0]=(E-T)/B,e[1]=(C-p)/B,e[2]=(l-v)/B):u>x&&u>O?(B=Math.sqrt(1+u-x-O)*2,e[3]=(E-T)/B,e[0]=.25*B,e[1]=(l+v)/B,e[2]=(C+p)/B):x>O?(B=Math.sqrt(1+x-u-O)*2,e[3]=(C-p)/B,e[0]=(l+v)/B,e[1]=.25*B,e[2]=(E+T)/B):(B=Math.sqrt(1+O-u-x)*2,e[3]=(l-v)/B,e[0]=(C+p)/B,e[1]=(E+T)/B,e[2]=.25*B),e}function Fa(e,i,r,n){var t=i[0],o=i[1],u=i[2],l=i[3],p=t+t,v=o+o,x=u+u,E=t*p,C=t*v,T=t*x,O=o*v,L=o*x,B=u*x,H=l*p,oe=l*v,le=l*x,Re=n[0],Ne=n[1],ut=n[2];return e[0]=(1-(O+B))*Re,e[1]=(C+le)*Re,e[2]=(T-oe)*Re,e[3]=0,e[4]=(C-le)*Ne,e[5]=(1-(E+B))*Ne,e[6]=(L+H)*Ne,e[7]=0,e[8]=(T+oe)*ut,e[9]=(L-H)*ut,e[10]=(1-(E+O))*ut,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function ma(e,i,r,n,t){var o=i[0],u=i[1],l=i[2],p=i[3],v=o+o,x=u+u,E=l+l,C=o*v,T=o*x,O=o*E,L=u*x,B=u*E,H=l*E,oe=p*v,le=p*x,Re=p*E,Ne=n[0],ut=n[1],Ot=n[2],Nt=t[0],jt=t[1],br=t[2],yr=(1-(L+H))*Ne,Ur=(T+Re)*Ne,An=(O-le)*Ne,jn=(T-Re)*ut,Qi=(1-(C+H))*ut,Ca=(B+oe)*ut,bo=(O+le)*Ot,Ao=(B-oe)*Ot,Ko=(1-(C+L))*Ot;return e[0]=yr,e[1]=Ur,e[2]=An,e[3]=0,e[4]=jn,e[5]=Qi,e[6]=Ca,e[7]=0,e[8]=bo,e[9]=Ao,e[10]=Ko,e[11]=0,e[12]=r[0]+Nt-(yr*Nt+jn*jt+bo*br),e[13]=r[1]+jt-(Ur*Nt+Qi*jt+Ao*br),e[14]=r[2]+br-(An*Nt+Ca*jt+Ko*br),e[15]=1,e}function uu(e,i){var r=i[0],n=i[1],t=i[2],o=i[3],u=r+r,l=n+n,p=t+t,v=r*u,x=n*u,E=n*l,C=t*u,T=t*l,O=t*p,L=o*u,B=o*l,H=o*p;return e[0]=1-E-O,e[1]=x+H,e[2]=C-B,e[3]=0,e[4]=x-H,e[5]=1-v-O,e[6]=T+L,e[7]=0,e[8]=C+B,e[9]=T-L,e[10]=1-v-E,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Zs(e,i,r,n,t,o,u){var l=1/(r-i),p=1/(t-n),v=1/(o-u);return e[0]=o*2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o*2*p,e[6]=0,e[7]=0,e[8]=(r+i)*l,e[9]=(t+n)*p,e[10]=(u+o)*v,e[11]=-1,e[12]=0,e[13]=0,e[14]=u*o*2*v,e[15]=0,e}function eo(e,i,r,n,t){var o=1/Math.tan(i/2),u;return e[0]=o/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,t!=null&&t!==Infinity?(u=1/(n-t),e[10]=(t+n)*u,e[14]=2*t*n*u):(e[10]=-1,e[14]=-2*n),e}var jo=eo;function Us(e,i,r,n,t){var o=1/Math.tan(i/2),u;return e[0]=o/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,t!=null&&t!==Infinity?(u=1/(n-t),e[10]=t*u,e[14]=t*n*u):(e[10]=-1,e[14]=-n),e}function Ea(e,i,r,n){var t=Math.tan(i.upDegrees*Math.PI/180),o=Math.tan(i.downDegrees*Math.PI/180),u=Math.tan(i.leftDegrees*Math.PI/180),l=Math.tan(i.rightDegrees*Math.PI/180),p=2/(u+l),v=2/(t+o);return e[0]=p,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=v,e[6]=0,e[7]=0,e[8]=-((u-l)*p*.5),e[9]=(t-o)*v*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function Ql(e,i,r,n,t,o,u){var l=1/(i-r),p=1/(n-t),v=1/(o-u);return e[0]=-2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*p,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*v,e[11]=0,e[12]=(i+r)*l,e[13]=(t+n)*p,e[14]=(u+o)*v,e[15]=1,e}var Hu=Ql;function wc(e,i,r,n,t,o,u){var l=1/(i-r),p=1/(n-t),v=1/(o-u);return e[0]=-2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*p,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=v,e[11]=0,e[12]=(i+r)*l,e[13]=(t+n)*p,e[14]=o*v,e[15]=1,e}function Go(e,i,r,n){var t,o,u,l,p,v,x,E,C,T,O=i[0],L=i[1],B=i[2],H=n[0],oe=n[1],le=n[2],Re=r[0],Ne=r[1],ut=r[2];return Math.abs(O-Re)<fr.Ib&&Math.abs(L-Ne)<fr.Ib&&Math.abs(B-ut)<fr.Ib?In(e):(x=O-Re,E=L-Ne,C=B-ut,T=1/Math.hypot(x,E,C),x*=T,E*=T,C*=T,t=oe*C-le*E,o=le*x-H*C,u=H*E-oe*x,T=Math.hypot(t,o,u),T?(T=1/T,t*=T,o*=T,u*=T):(t=0,o=0,u=0),l=E*u-C*o,p=C*t-x*u,v=x*o-E*t,T=Math.hypot(l,p,v),T?(T=1/T,l*=T,p*=T,v*=T):(l=0,p=0,v=0),e[0]=t,e[1]=l,e[2]=x,e[3]=0,e[4]=o,e[5]=p,e[6]=E,e[7]=0,e[8]=u,e[9]=v,e[10]=C,e[11]=0,e[12]=-(t*O+o*L+u*B),e[13]=-(l*O+p*L+v*B),e[14]=-(x*O+E*L+C*B),e[15]=1,e)}function Cc(e,i,r,n){var t=i[0],o=i[1],u=i[2],l=n[0],p=n[1],v=n[2],x=t-r[0],E=o-r[1],C=u-r[2],T=x*x+E*E+C*C;T>0&&(T=1/Math.sqrt(T),x*=T,E*=T,C*=T);var O=p*C-v*E,L=v*x-l*C,B=l*E-p*x;return T=O*O+L*L+B*B,T>0&&(T=1/Math.sqrt(T),O*=T,L*=T,B*=T),e[0]=O,e[1]=L,e[2]=B,e[3]=0,e[4]=E*B-C*L,e[5]=C*O-x*B,e[6]=x*L-E*O,e[7]=0,e[8]=x,e[9]=E,e[10]=C,e[11]=0,e[12]=t,e[13]=o,e[14]=u,e[15]=1,e}function Al(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Vh(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function dh(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e[4]=i[4]+r[4],e[5]=i[5]+r[5],e[6]=i[6]+r[6],e[7]=i[7]+r[7],e[8]=i[8]+r[8],e[9]=i[9]+r[9],e[10]=i[10]+r[10],e[11]=i[11]+r[11],e[12]=i[12]+r[12],e[13]=i[13]+r[13],e[14]=i[14]+r[14],e[15]=i[15]+r[15],e}function vh(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e[4]=i[4]-r[4],e[5]=i[5]-r[5],e[6]=i[6]-r[6],e[7]=i[7]-r[7],e[8]=i[8]-r[8],e[9]=i[9]-r[9],e[10]=i[10]-r[10],e[11]=i[11]-r[11],e[12]=i[12]-r[12],e[13]=i[13]-r[13],e[14]=i[14]-r[14],e[15]=i[15]-r[15],e}function af(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=i[7]*r,e[8]=i[8]*r,e[9]=i[9]*r,e[10]=i[10]*r,e[11]=i[11]*r,e[12]=i[12]*r,e[13]=i[13]*r,e[14]=i[14]*r,e[15]=i[15]*r,e}function jh(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e[4]=i[4]+r[4]*n,e[5]=i[5]+r[5]*n,e[6]=i[6]+r[6]*n,e[7]=i[7]+r[7]*n,e[8]=i[8]+r[8]*n,e[9]=i[9]+r[9]*n,e[10]=i[10]+r[10]*n,e[11]=i[11]+r[11]*n,e[12]=i[12]+r[12]*n,e[13]=i[13]+r[13]*n,e[14]=i[14]+r[14]*n,e[15]=i[15]+r[15]*n,e}function od(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]&&e[4]===i[4]&&e[5]===i[5]&&e[6]===i[6]&&e[7]===i[7]&&e[8]===i[8]&&e[9]===i[9]&&e[10]===i[10]&&e[11]===i[11]&&e[12]===i[12]&&e[13]===i[13]&&e[14]===i[14]&&e[15]===i[15]}function Rf(e,i){var r=e[0],n=e[1],t=e[2],o=e[3],u=e[4],l=e[5],p=e[6],v=e[7],x=e[8],E=e[9],C=e[10],T=e[11],O=e[12],L=e[13],B=e[14],H=e[15],oe=i[0],le=i[1],Re=i[2],Ne=i[3],ut=i[4],Ot=i[5],Nt=i[6],jt=i[7],br=i[8],yr=i[9],Ur=i[10],An=i[11],jn=i[12],Qi=i[13],Ca=i[14],bo=i[15];return Math.abs(r-oe)<=fr.Ib*Math.max(1,Math.abs(r),Math.abs(oe))&&Math.abs(n-le)<=fr.Ib*Math.max(1,Math.abs(n),Math.abs(le))&&Math.abs(t-Re)<=fr.Ib*Math.max(1,Math.abs(t),Math.abs(Re))&&Math.abs(o-Ne)<=fr.Ib*Math.max(1,Math.abs(o),Math.abs(Ne))&&Math.abs(u-ut)<=fr.Ib*Math.max(1,Math.abs(u),Math.abs(ut))&&Math.abs(l-Ot)<=fr.Ib*Math.max(1,Math.abs(l),Math.abs(Ot))&&Math.abs(p-Nt)<=fr.Ib*Math.max(1,Math.abs(p),Math.abs(Nt))&&Math.abs(v-jt)<=fr.Ib*Math.max(1,Math.abs(v),Math.abs(jt))&&Math.abs(x-br)<=fr.Ib*Math.max(1,Math.abs(x),Math.abs(br))&&Math.abs(E-yr)<=fr.Ib*Math.max(1,Math.abs(E),Math.abs(yr))&&Math.abs(C-Ur)<=fr.Ib*Math.max(1,Math.abs(C),Math.abs(Ur))&&Math.abs(T-An)<=fr.Ib*Math.max(1,Math.abs(T),Math.abs(An))&&Math.abs(O-jn)<=fr.Ib*Math.max(1,Math.abs(O),Math.abs(jn))&&Math.abs(L-Qi)<=fr.Ib*Math.max(1,Math.abs(L),Math.abs(Qi))&&Math.abs(B-Ca)<=fr.Ib*Math.max(1,Math.abs(B),Math.abs(Ca))&&Math.abs(H-bo)<=fr.Ib*Math.max(1,Math.abs(H),Math.abs(bo))}var bp=xi,sd=vh,Ep,Ac,Sp=(Ep=(0,Qr.b2)(),Ep(Ac=function(){function e(){(0,xt.Z)(this,e),(0,Y.Z)(this,"viewport",void 0),(0,Y.Z)(this,"overridedViewProjectionMatrix",void 0),(0,Y.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,Y.Z)(this,"jitteredProjectionMatrix",void 0),(0,Y.Z)(this,"viewMatrixInverse",void 0),(0,Y.Z)(this,"cameraPosition",void 0)}return(0,wt.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(r){this.viewport=r,this.viewMatrixInverse=Hr(),di(this.viewMatrixInverse,r.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var r=this.viewport.getCenter(),n=(0,hr.Z)(r,2),t=n[0],o=n[1];return[t,o]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}},{key:"setViewProjectionMatrix",value:function(r){this.overridedViewProjectionMatrix=r}},{key:"jitterProjectionMatrix",value:function(r,n){var t=so(Hr(),[r,n,0]);this.jitteredProjectionMatrix=xi(Hr(),t,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=xi(Hr(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||Ac),Wu;(function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter",e.LEFTTOP="lefttop",e.RIGHTTOP="righttop",e.LEFTBOTTOM="leftbottom",e.RIGHTBOTTOM="rightbottom"})(Wu||(Wu={}));var of,mh;function ud(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=ld(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function ld(e,i){if(!!e){if(typeof e=="string")return Gh(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Gh(e,i)}}function Gh(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var wp={topleft:"column",topright:"column",bottomright:"column",bottomleft:"column",leftcenter:"column",rightcenter:"column",topcenter:"row",bottomcenter:"row",lefttop:"row",righttop:"row",leftbottom:"row",rightbottom:"row"},cd=(of=(0,Qr.b2)(),of(mh=function(){function e(){(0,xt.Z)(this,e),(0,Y.Z)(this,"container",void 0),(0,Y.Z)(this,"controlCorners",void 0),(0,Y.Z)(this,"controlContainer",void 0),(0,Y.Z)(this,"scene",void 0),(0,Y.Z)(this,"mapsService",void 0),(0,Y.Z)(this,"controls",[]),(0,Y.Z)(this,"unAddControls",[])}return(0,wt.Z)(e,[{key:"init",value:function(r,n){this.container=r.container,this.scene=n,this.mapsService=n.get(Yt.IMapService),this.initControlPos()}},{key:"addControl",value:function(r,n){var t=n.get(Yt.IMapService);t.map?(r.addTo(this.scene),this.controls.push(r)):this.unAddControls.push(r)}},{key:"getControlByName",value:function(r){return this.controls.find(function(n){return n.controlOption.name===r})}},{key:"removeControl",value:function(r){var n=this.controls.indexOf(r);return n>-1&&this.controls.splice(n,1),r.remove(),this}},{key:"addControls",value:function(){var r=this;this.unAddControls.forEach(function(n){n.addTo(r.scene),r.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var r=ud(this.controls),n;try{for(r.s();!(n=r.n()).done;){var t=n.value;t.remove()}}catch(o){r.e(o)}finally{r.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var r=this.controlCorners={},n="l7-",t=this.controlContainer=Bi("div",n+"control-container",this.container);function o(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],p=l.map(function(v){return n+v}).join(" ");r[l.filter(function(v){return!["row","column"].includes(v)}).join("")]=Bi("div",p,t)}function u(l){var p=l.replace(/^(top|bottom|left|right|center)/,"$1-").split("-");return[].concat((0,N.Z)(p),[wp[l]])}Object.values(Wu).forEach(function(l){o(u(l))})}},{key:"clearControlPos",value:function(){for(var r in this.controlCorners)this.controlCorners[r]&&ks(this.controlCorners[r]);this.controlContainer&&ks(this.controlContainer)}}]),e}())||mh),Hh,Wh,Cp=(Hh=(0,Qr.b2)(),Hh(Wh=function(){function e(){(0,xt.Z)(this,e),(0,Y.Z)(this,"container",void 0),(0,Y.Z)(this,"scene",void 0),(0,Y.Z)(this,"mapsService",void 0),(0,Y.Z)(this,"markers",[]),(0,Y.Z)(this,"markerLayers",[]),(0,Y.Z)(this,"unAddMarkers",[]),(0,Y.Z)(this,"unAddMarkerLayers",[])}return(0,wt.Z)(e,[{key:"addMarkerLayer",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(r),r.addTo(this.scene)):this.unAddMarkerLayers.push(r)}},{key:"removeMarkerLayer",value:function(r){r.destroy(),this.markerLayers.indexOf(r);var n=this.markerLayers.indexOf(r);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(r),r.addTo(this.scene)):this.unAddMarkers.push(r)}},{key:"addMarkers",value:function(){var r=this;this.unAddMarkers.forEach(function(n){n.addTo(r.scene),r.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var r=this;this.unAddMarkerLayers.forEach(function(n){r.markerLayers.push(n),n.addTo(r.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(r){r.remove(),this.markers.indexOf(r);var n=this.markers.indexOf(r);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(Yt.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(r){r.remove()}),this.markers=[],this.markerLayers.forEach(function(r){r.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(r){r.destroy()}}]),e}())||Wh),Ap,gh,fd=(Ap=(0,Qr.b2)(),Ap(gh=function(){function e(){(0,xt.Z)(this,e),(0,Y.Z)(this,"scene",void 0),(0,Y.Z)(this,"mapsService",void 0),(0,Y.Z)(this,"popups",[]),(0,Y.Z)(this,"unAddPopups",[])}return(0,wt.Z)(e,[{key:"isMarkerReady",get:function(){return this.mapsService.map&&this.mapsService.getMarkerContainer()}},{key:"removePopup",value:function(r){r.isOpen()&&r.remove();var n=this.popups.indexOf(r);n>-1&&this.popups.splice(n,1);var t=this.unAddPopups.indexOf(r);t>-1&&this.unAddPopups.splice(t,1)}},{key:"destroy",value:function(){this.popups.forEach(function(r){return r.remove()})}},{key:"addPopup",value:function(r){var n=this;r&&r.getOptions().autoClose&&[].concat((0,N.Z)(this.popups),(0,N.Z)(this.unAddPopups)).forEach(function(t){t.getOptions().autoClose&&n.removePopup(t)}),this.isMarkerReady?(r.addTo(this.scene),this.popups.push(r)):this.unAddPopups.push(r),r.on("close",function(){n.removePopup(r)})}},{key:"initPopup",value:function(){var r=this;this.unAddPopups.length&&this.unAddPopups.forEach(function(n){r.addPopup(n),r.unAddPopups=[]})}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(Yt.IMapService)}}]),e}())||gh),Xh={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},Tp=Xh,Of,$h,Yh={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,stencil:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},Wd={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},Dv=(Of=(0,Qr.b2)(),Of($h=function(){function e(){(0,xt.Z)(this,e),(0,Y.Z)(this,"sceneConfigCache",{}),(0,Y.Z)(this,"layerConfigCache",{}),(0,Y.Z)(this,"layerAttributeConfigCache",{})}return(0,wt.Z)(e,[{key:"getSceneConfig",value:function(r){return this.sceneConfigCache[r]}},{key:"getSceneWarninfo",value:function(r){return Tp[r]}},{key:"setSceneConfig",value:function(r,n){this.sceneConfigCache[r]=(0,z.Z)((0,z.Z)({},Yh),n)}},{key:"getLayerConfig",value:function(r){return this.layerConfigCache[r]}},{key:"setLayerConfig",value:function(r,n,t){this.layerConfigCache[n]=(0,z.Z)({},(0,St.merge)({},this.sceneConfigCache[r],Wd,t))}},{key:"getAttributeConfig",value:function(r){return this.layerAttributeConfigCache[r]}},{key:"setAttributeConfig",value:function(r,n){this.layerAttributeConfigCache[r]=(0,z.Z)((0,z.Z)({},this.layerAttributeConfigCache[r]),n)}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||$h);function ra(e,i,r,n){!r||Object.defineProperty(e,i,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}function na(e,i,r,n,t){var o={};return Object.keys(n).forEach(function(u){o[u]=n[u]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=r.slice().reverse().reduce(function(u,l){return l(e,i,u)||u},o),t&&o.initializer!==void 0&&(o.value=o.initializer?o.initializer.call(t):void 0,o.initializer=void 0),o.initializer===void 0&&(Object.defineProperty(e,i,o),o=null),o}function hd(){var e=new fr.WT(4);return fr.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function yg(e){var i=new glMatrix.ARRAY_TYPE(4);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i}function Mp(e,i,r,n){var t=new fr.WT(4);return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t}function qo(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e}function Tc(e,i,r,n,t){return e[0]=i,e[1]=r,e[2]=n,e[3]=t,e}function _g(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e}function yh(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e}function Fv(e,i,r){return e[0]=i[0]*r[0],e[1]=i[1]*r[1],e[2]=i[2]*r[2],e[3]=i[3]*r[3],e}function V0(e,i,r){return e[0]=i[0]/r[0],e[1]=i[1]/r[1],e[2]=i[2]/r[2],e[3]=i[3]/r[3],e}function Xd(e,i){return e[0]=Math.ceil(i[0]),e[1]=Math.ceil(i[1]),e[2]=Math.ceil(i[2]),e[3]=Math.ceil(i[3]),e}function sf(e,i){return e[0]=Math.floor(i[0]),e[1]=Math.floor(i[1]),e[2]=Math.floor(i[2]),e[3]=Math.floor(i[3]),e}function $d(e,i,r){return e[0]=Math.min(i[0],r[0]),e[1]=Math.min(i[1],r[1]),e[2]=Math.min(i[2],r[2]),e[3]=Math.min(i[3],r[3]),e}function pd(e,i,r){return e[0]=Math.max(i[0],r[0]),e[1]=Math.max(i[1],r[1]),e[2]=Math.max(i[2],r[2]),e[3]=Math.max(i[3],r[3]),e}function Yd(e,i){return e[0]=Math.round(i[0]),e[1]=Math.round(i[1]),e[2]=Math.round(i[2]),e[3]=Math.round(i[3]),e}function dd(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e}function Bv(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e}function j0(e,i){var r=i[0]-e[0],n=i[1]-e[1],t=i[2]-e[2],o=i[3]-e[3];return Math.hypot(r,n,t,o)}function vd(e,i){var r=i[0]-e[0],n=i[1]-e[1],t=i[2]-e[2],o=i[3]-e[3];return r*r+n*n+t*t+o*o}function G0(e){var i=e[0],r=e[1],n=e[2],t=e[3];return Math.hypot(i,r,n,t)}function H0(e){var i=e[0],r=e[1],n=e[2],t=e[3];return i*i+r*r+n*n+t*t}function W0(e,i){return e[0]=-i[0],e[1]=-i[1],e[2]=-i[2],e[3]=-i[3],e}function X0(e,i){return e[0]=1/i[0],e[1]=1/i[1],e[2]=1/i[2],e[3]=1/i[3],e}function $0(e,i){var r=i[0],n=i[1],t=i[2],o=i[3],u=r*r+n*n+t*t+o*o;return u>0&&(u=1/Math.sqrt(u)),e[0]=r*u,e[1]=n*u,e[2]=t*u,e[3]=o*u,e}function nl(e,i){return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]+e[3]*i[3]}function qd(e,i,r,n){var t=r[0]*n[1]-r[1]*n[0],o=r[0]*n[2]-r[2]*n[0],u=r[0]*n[3]-r[3]*n[0],l=r[1]*n[2]-r[2]*n[1],p=r[1]*n[3]-r[3]*n[1],v=r[2]*n[3]-r[3]*n[2],x=i[0],E=i[1],C=i[2],T=i[3];return e[0]=E*v-C*p+T*l,e[1]=-(x*v)+C*u-T*o,e[2]=x*p-E*u+T*t,e[3]=-(x*l)+E*o-C*t,e}function Y0(e,i,r,n){var t=i[0],o=i[1],u=i[2],l=i[3];return e[0]=t+n*(r[0]-t),e[1]=o+n*(r[1]-o),e[2]=u+n*(r[2]-u),e[3]=l+n*(r[3]-l),e}function uf(e,i){i=i||1;var r,n,t,o,u,l;do r=glMatrix.RANDOM()*2-1,n=glMatrix.RANDOM()*2-1,u=r*r+n*n;while(u>=1);do t=glMatrix.RANDOM()*2-1,o=glMatrix.RANDOM()*2-1,l=t*t+o*o;while(l>=1);var p=Math.sqrt((1-u)/l);return e[0]=i*r,e[1]=i*n,e[2]=i*t*p,e[3]=i*o*p,e}function Kd(e,i,r){var n=i[0],t=i[1],o=i[2],u=i[3];return e[0]=r[0]*n+r[4]*t+r[8]*o+r[12]*u,e[1]=r[1]*n+r[5]*t+r[9]*o+r[13]*u,e[2]=r[2]*n+r[6]*t+r[10]*o+r[14]*u,e[3]=r[3]*n+r[7]*t+r[11]*o+r[15]*u,e}function q0(e,i,r){var n=i[0],t=i[1],o=i[2],u=r[0],l=r[1],p=r[2],v=r[3],x=v*n+l*o-p*t,E=v*t+p*n-u*o,C=v*o+u*t-l*n,T=-u*n-l*t-p*o;return e[0]=x*v+T*-u+E*-p-C*-l,e[1]=E*v+T*-l+C*-u-x*-p,e[2]=C*v+T*-p+x*-l-E*-u,e[3]=i[3],e}function qh(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function kp(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Ip(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]}function Pp(e,i){var r=e[0],n=e[1],t=e[2],o=e[3],u=i[0],l=i[1],p=i[2],v=i[3];return Math.abs(r-u)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(n-l)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(t-p)<=glMatrix.EPSILON*Math.max(1,Math.abs(t),Math.abs(p))&&Math.abs(o-v)<=glMatrix.EPSILON*Math.max(1,Math.abs(o),Math.abs(v))}var Rp=null,K0=null,Q0=null,J0=null,em=null,Nv=null,zv=null,Lf=function(){var e=hd();return function(i,r,n,t,o,u){var l,p;for(r||(r=4),n||(n=0),t?p=Math.min(t*r+n,i.length):p=i.length,l=n;l<p;l+=r)e[0]=i[l],e[1]=i[l+1],e[2]=i[l+2],e[3]=i[l+3],o(e,e,u),i[l]=e[0],i[l+1]=e[1],i[l+2]=e[2],i[l+3]=e[3];return i}}(),md=Math.PI/180,Qd=512,gd=4003e4;function Jd(e){var i=e.latitude,r=i===void 0?0:i,n=e.zoom,t=n===void 0?0:n,o=e.scale,u=e.highPrecision,l=u===void 0?!1:u,p=e.flipY,v=p===void 0?!1:p;o=o!==void 0?o:Math.pow(2,t);var x={},E=Qd*o,C=Math.cos(r*md),T=E/360,O=T/C,L=E/gd/C;if(x.pixelsPerMeter=[L,-L,L],x.metersPerPixel=[1/L,-1/L,1/L],x.pixelsPerDegree=[T,-O,L],x.degreesPerPixel=[1/T,-1/O,1/L],l){var B=md*Math.tan(r*md)/C,H=T*B/2,oe=E/gd*B,le=oe/O*L;x.pixelsPerDegree2=[0,-H,oe],x.pixelsPerMeter2=[le,0,le],v&&(x.pixelsPerDegree2[1]=-x.pixelsPerDegree2[1],x.pixelsPerMeter2[1]=-x.pixelsPerMeter2[1])}return v&&(x.pixelsPerMeter[1]=-x.pixelsPerMeter[1],x.metersPerPixel[1]=-x.metersPerPixel[1],x.pixelsPerDegree[1]=-x.pixelsPerDegree[1],x.degreesPerPixel[1]=-x.degreesPerPixel[1]),x}var Mc;(function(e){e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2"})(Mc||(Mc={}));var Df={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},ev,yd,tv,_h,rv,_d=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],tm=(ev=(0,Qr.b2)(),yd=(0,Qr.f3)(Yt.ICameraService),ev(tv=(_h=function(){function e(){(0,xt.Z)(this,e),(0,Y.Z)(this,"needRefresh",!0),ra(this,"cameraService",rv,this),(0,Y.Z)(this,"coordinateSystem",void 0),(0,Y.Z)(this,"viewportCenter",void 0),(0,Y.Z)(this,"viewportCenterProjection",void 0),(0,Y.Z)(this,"pixelsPerDegree",void 0),(0,Y.Z)(this,"pixelsPerDegree2",void 0),(0,Y.Z)(this,"pixelsPerMeter",void 0)}return(0,wt.Z)(e,[{key:"refresh",value:function(r){var n=this.cameraService.getZoom(),t=this.cameraService.getZoomScale(),o=r||this.cameraService.getCenter(),u=Jd({latitude:o[1],zoom:n}),l=u.pixelsPerMeter,p=u.pixelsPerDegree;this.viewportCenter=o,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=l,this.pixelsPerDegree=p,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Mc.LNGLAT||this.coordinateSystem===Mc.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Mc.LNGLAT_OFFSET?this.calculateLnglatOffset(o,n):this.coordinateSystem===Mc.P20_OFFSET&&this.calculateLnglatOffset(o,n,t,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(r){this.coordinateSystem=r}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(r,n,t,o){var u=Jd({latitude:r[1],zoom:n,scale:t,flipY:o,highPrecision:!0}),l=u.pixelsPerMeter,p=u.pixelsPerDegree,v=u.pixelsPerDegree2,x=this.cameraService.getViewMatrix(),E=this.cameraService.getProjectionMatrix(),C=xi([],E,x),T=this.cameraService.projectFlat([Math.fround(r[0]),Math.fround(r[1])],Math.pow(2,n));this.viewportCenterProjection=Kd([],[T[0],T[1],0,1],C),x=this.cameraService.getViewMatrixUncentered()||x,C=xi([],E,x),C=xi([],C,_d),this.cameraService.setViewProjectionMatrix(C),this.pixelsPerMeter=l,this.pixelsPerDegree=p,this.pixelsPerDegree2=v}}]),e}(),rv=na(_h.prototype,"cameraService",[yd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_h))||tv),Zv=K(20396),Op=K.n(Zv),lu;(function(e){e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag"})(lu||(lu={}));var Uv,Vv,jv,nv,Gv;function rm(e){var i=kc();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function kc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xd={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},Hv=(Uv=(0,Qr.b2)(),Vv=(0,Qr.f3)(Yt.IMapService),Uv(jv=(nv=function(e){(0,gr.Z)(r,e);var i=rm(r);function r(){var n;(0,xt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,De.Z)(n),"indragging",!1),ra((0,De.Z)(n),"mapService",Gv,(0,De.Z)(n)),(0,Y.Z)((0,De.Z)(n),"hammertime",void 0),(0,Y.Z)((0,De.Z)(n),"lastClickTime",0),(0,Y.Z)((0,De.Z)(n),"lastClickXY",[-1,-1]),(0,Y.Z)((0,De.Z)(n),"clickTimer",void 0),(0,Y.Z)((0,De.Z)(n),"$containter",void 0),(0,Y.Z)((0,De.Z)(n),"onDrag",function(l){var p=n.interactionEvent(l);p.type=xd[p.type],p.type==="dragging"?n.indragging=!0:n.indragging=!1,n.emit(lu.Drag,p)}),(0,Y.Z)((0,De.Z)(n),"onHammer",function(l){l.srcEvent.stopPropagation();var p=n.interactionEvent(l);n.emit(lu.Hover,p)}),(0,Y.Z)((0,De.Z)(n),"onTouch",function(l){var p=l.touches[0];n.onHover({x:p.pageX,y:p.pageY,type:"touch"})}),(0,Y.Z)((0,De.Z)(n),"onHover",function(l){var p=l.clientX,v=l.clientY,x=p,E=v,C=l.type,T=n.mapService.getMapContainer();if(T)if(rs)x=x-T.left-0,E=E-T.top-0;else{var O=T.getBoundingClientRect(),L=O.top,B=O.left;x=x-B-T.clientLeft,E=E-L-T.clientTop}var H=n.mapService.containerToLngLat([x,E]);if(C==="click"){if(!rs&&"ontouchstart"in document.documentElement)return;n.isDoubleTap(x,E,H);return}if(C==="touch"){n.isDoubleTap(x,E,H);return}C!=="click"&&C!=="dblclick"&&n.emit(lu.Hover,{x,y:E,lngLat:H,type:C,target:l})}),n}return(0,wt.Z)(r,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(lu.Hover)}},{key:"triggerHover",value:function(t){var o=t.x,u=t.y;this.emit(lu.Hover,{x:o,y:u})}},{key:"triggerSelect",value:function(t){this.emit(lu.Select,{featureId:t})}},{key:"triggerActive",value:function(t){this.emit(lu.Active,{featureId:t})}},{key:"handleMiniEvent",value:function(t){this.onHover({clientX:t.touches[0].pageX,clientY:t.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var t=this.mapService.getMapContainer();if(t)if(rs)pa.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var o=new(Op()).Manager(t);o.add(new(Op()).Tap({event:"dblclick",taps:2})),o.add(new(Op()).Tap({event:"click"})),o.add(new(Op()).Pan({threshold:0,pointers:0})),o.add(new(Op()).Press({})),o.on("dblclick click",this.onHammer),o.on("panstart panmove panend pancancel",this.onDrag),t.addEventListener("mousemove",this.onHover),t.addEventListener("mousedown",this.onHover,!0),t.addEventListener("mouseup",this.onHover),t.addEventListener("contextmenu",this.onHover),this.hammertime=o}}},{key:"removeEventListenerOnMap",value:function(){if(rs)pa.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var t=this.mapService.getMapContainer();t&&(t.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),t.removeEventListener("mousedown",this.onHover),t.removeEventListener("mouseup",this.onHover),t.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(t){var o=t.type,u=t.pointerType,l,p;u==="touch"?(p=Math.floor(t.pointers[0].clientY),l=Math.floor(t.pointers[0].clientX)):(p=Math.floor(t.srcEvent.y),l=Math.floor(t.srcEvent.x));var v=this.mapService.getMapContainer();if(v){var x=v.getBoundingClientRect(),E=x.top,C=x.left;l-=C,p-=E}var T=this.mapService.containerToLngLat([l,p]);return{x:l,y:p,lngLat:T,type:o,target:t.srcEvent}}},{key:"isDoubleTap",value:function(t,o,u){var l=this,p=new Date().getTime(),v="click";p-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-t)<10&&Math.abs(this.lastClickXY[1]-o)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),v="dblclick",this.emit(lu.Hover,{x:t,y:o,lngLat:u,type:v})):(this.lastClickTime=p,this.lastClickXY=[t,o],this.clickTimer=setTimeout(function(){v="click",l.emit(lu.Hover,{x:t,y:o,lngLat:u,type:v})},400))}}]),r}(dp()),Gv=na(nv.prototype,"mapService",[Vv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nv))||jv),Lp=0;function Wv(e){if(rs)return null;var i=e;if(typeof e=="string"&&(i=document.getElementById(e)),i){var r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,r.id="l7-scene-".concat(Lp++),r.classList.add("l7-scene"),i.appendChild(r),r}return null}function q2(e){var i,r,n=!0;return e==null||(i=e.target)===null||i===void 0||(r=i.path)===null||r===void 0||r.map(function(t){if(t!=null&&t.classList){var o;t==null||(o=t.classList)===null||o===void 0||o.forEach(function(u){(u==="l7-marker"||u==="l7-popup")&&(n=!1)})}}),n}var $;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})($||($={}));var xg,bg,Eg,Sg,wg,Cg,Ag,Dp,Tg,Mg,kg,Ig,Pg,K2=(xg=(0,Qr.b2)(),bg=(0,Qr.f3)(Yt.IMapService),Eg=(0,Qr.f3)(Yt.IRendererService),Sg=(0,Qr.f3)(Yt.IGlobalConfigService),wg=(0,Qr.f3)(Yt.IInteractionService),Cg=(0,Qr.f3)(Yt.ILayerService),xg(Ag=(Dp=function(){function e(){var i=this;(0,xt.Z)(this,e),(0,Y.Z)(this,"pickedColors",void 0),(0,Y.Z)(this,"pickedTileLayers",[]),ra(this,"mapService",Tg,this),ra(this,"rendererService",Mg,this),ra(this,"configService",kg,this),ra(this,"interactionService",Ig,this),ra(this,"layerService",Pg,this),(0,Y.Z)(this,"pickingFBO",void 0),(0,Y.Z)(this,"width",0),(0,Y.Z)(this,"height",0),(0,Y.Z)(this,"alreadyInPicking",!1),(0,Y.Z)(this,"pickBufferScale",1),(0,Y.Z)(this,"pickFromPickingFBO",function(r,n){var t=n.x,o=n.y,u=n.lngLat,l=n.type,p=n.target,v=!1,x=i.rendererService,E=x.readPixels,C=x.getContainer,T=i.getContainerSize(C()),O=T.width,L=T.height;O*=Da,L*=Da;var B=r.getLayerConfig(),H=B.enableHighlight,oe=B.enableSelect,le=t*Da,Re=o*Da;if(le>O-1*Da||le<0||Re>L-1*Da||Re<0)return!1;var Ne=E({x:Math.floor(le/i.pickBufferScale),y:Math.floor((L-(o+1)*Da)/i.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:i.pickingFBO});if(i.pickedColors=Ne,Ne[0]!==0||Ne[1]!==0||Ne[2]!==0){var ut=Se(Ne),Ot=r.layerPickService.getFeatureById(ut);ut!==r.getCurrentPickId()&&l==="mousemove"&&(l="mouseenter");var Nt={x:t,y:o,type:l,lngLat:u,featureId:ut,feature:Ot,target:p};Ot&&(v=!0,r.setCurrentPickId(ut),i.triggerHoverOnLayer(r,Nt))}else{var jt={x:t,y:o,lngLat:u,type:r.getCurrentPickId()!==null&&l==="mousemove"?"mouseout":"un"+l,featureId:null,target:p,feature:null};i.triggerHoverOnLayer(r,(0,z.Z)((0,z.Z)({},jt),{},{type:"unpick"})),i.triggerHoverOnLayer(r,jt),r.setCurrentPickId(null)}if(H&&r.layerPickService.highlightPickedFeature(Ne),oe&&l==="click"&&(Ne==null?void 0:Ne.toString())!==[0,0,0,0].toString()){var br=Se(Ne);r.getCurrentSelectedId()===null||br!==r.getCurrentSelectedId()?(r.layerPickService.selectFeature(Ne),r.setCurrentSelectedId(br)):(r.layerPickService.selectFeature(new Uint8Array([0,0,0,0])),r.setCurrentSelectedId(null))}return v})}return(0,wt.Z)(e,[{key:"init",value:function(r){var n=this.rendererService,t=n.createTexture2D,o=n.createFramebuffer,u=n.getContainer,l=this.getContainerSize(u()),p=l.width,v=l.height;p*=Da,v*=Da,this.pickBufferScale=this.configService.getSceneConfig(r).pickBufferScale||1,this.pickingFBO=o({color:t({width:Math.round(p/this.pickBufferScale),height:Math.round(v/this.pickBufferScale),wrapS:$.CLAMP_TO_EDGE,wrapT:$.CLAMP_TO_EDGE})}),this.interactionService.on(lu.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var i=(0,de.Z)(q().mark(function n(t,o,u){var l=this,p,v,x;return q().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:p=this.rendererService,v=p.useFramebuffer,x=p.clear,this.resizePickingFBO(),v(this.pickingFBO,function(){x({framebuffer:l.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),t.hooks.beforePickingEncode.call(),t.renderModels(),t.hooks.afterPickingEncode.call();var T=l.pickBox(t,o);u(T)});case 3:case"end":return C.stop()}},n,this)}));function r(n,t,o){return i.apply(this,arguments)}return r}()},{key:"pickBox",value:function(r,n){var t=this,o=n.map(function(br){var yr=br<0?0:br;return Math.floor(yr*Da/t.pickBufferScale)}),u=(0,hr.Z)(o,4),l=u[0],p=u[1],v=u[2],x=u[3],E=this.rendererService,C=E.readPixels,T=E.getContainer,O=this.getContainerSize(T()),L=O.width,B=O.height;if(L*=Da,B*=Da,l>(L-1)*Da/this.pickBufferScale||v<0||p>(B-1)*Da/this.pickBufferScale||x<0)return[];for(var H=Math.min(L/this.pickBufferScale,v)-l,oe=Math.min(B/this.pickBufferScale,x)-p,le=C({x:l,y:Math.floor(B/this.pickBufferScale-(x+1)),width:H,height:oe,data:new Uint8Array(H*oe*4),framebuffer:this.pickingFBO}),Re=[],Ne={},ut=0;ut<le.length/4;ut=ut+1){var Ot=le.slice(ut*4,ut*4+4),Nt=Se(Ot);if(Nt!==-1&&!Ne[Nt]){var jt=r.layerPickService.getFeatureById(Nt);Re.push((0,z.Z)((0,z.Z)({},jt),{},{pickedFeatureIdx:Nt})),Ne[Nt]=!0}}return Re}},{key:"handleCursor",value:function(r,n){var t=r.getLayerConfig(),o=t.cursor,u=o===void 0?"":o,l=t.cursorEnabled;if(l){var p=this.mapService.version,v=p==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),x=v==null?void 0:v.style.getPropertyValue("cursor");n==="unmousemove"&&x!==""?v==null||v.style.setProperty("cursor",""):n==="mousemove"&&(v==null||v.style.setProperty("cursor",u))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(r){return r.getContext?{width:r.width/Da,height:r.height/Da}:r.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var i=(0,de.Z)(q().mark(function n(t){return q().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!(!this.layerService.needPick(t.type)||!this.isPickingAllLayer())){u.next=2;break}return u.abrupt("return");case 2:return this.alreadyInPicking=!0,u.next=5,this.pickingLayers(t);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return u.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"isPickingAllLayer",value:function(){return!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())}},{key:"resizePickingFBO",value:function(){var r=this.rendererService.getContainer,n=this.getContainerSize(r()),t=n.width,o=n.height;t*=Da,o*=Da,(this.width!==t||this.height!==o)&&(this.pickingFBO.resize({width:Math.round(t/this.pickBufferScale),height:Math.round(o/this.pickBufferScale)}),this.width=t,this.height=o)}},{key:"pickingLayers",value:function(){var i=(0,de.Z)(q().mark(function n(t){var o=this,u,l,p;return q().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:u=this.rendererService,l=u.useFramebuffer,p=u.clear,this.resizePickingFBO(),l(this.pickingFBO,function(){var E=o.layerService.getRenderList();E.filter(function(C){return C.needPick(t.type)}).reverse().some(function(C){p({framebuffer:o.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),C.layerPickService.pickRender(t);var T=o.pickFromPickingFBO(C,t);return o.layerService.pickedLayerId=T?+C.id:-1,T&&!C.getLayerConfig().enablePropagation})});case 3:case"end":return x.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"triggerHoverOnLayer",value:function(r,n){q2(n)&&(this.handleCursor(r,n.type),r.emit(n.type,n))}}]),e}(),Tg=na(Dp.prototype,"mapService",[bg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mg=na(Dp.prototype,"rendererService",[Eg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kg=na(Dp.prototype,"configService",[Sg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ig=na(Dp.prototype,"interactionService",[wg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pg=na(Dp.prototype,"layerService",[Cg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dp))||Ag),Q2=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,xt.Z)(this,e),(0,Y.Z)(this,"autoStart",void 0),(0,Y.Z)(this,"startTime",0),(0,Y.Z)(this,"oldTime",0),(0,Y.Z)(this,"running",!1),(0,Y.Z)(this,"elapsedTime",0),this.autoStart=i}return(0,wt.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var r=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance=="undefined"?Date:performance).now();r=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=r}return r}}]),e}(),Rg,Og,Lg,Dg,Xv,Fg,Bg;function J2(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=eE(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function eE(e,i){if(!!e){if(typeof e=="string")return Ng(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ng(e,i)}}function Ng(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function tE(e){var i=rE();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function rE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nE=(Rg=(0,Qr.b2)(),Og=(0,Qr.f3)(Yt.IRendererService),Lg=(0,Qr.f3)(Yt.IMapService),Rg(Dg=(Xv=function(e){(0,gr.Z)(r,e);var i=tE(r);function r(){var n;(0,xt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,De.Z)(n),"pickedLayerId",-1),(0,Y.Z)((0,De.Z)(n),"clock",new Q2),(0,Y.Z)((0,De.Z)(n),"alreadyInRendering",!1),(0,Y.Z)((0,De.Z)(n),"layers",[]),(0,Y.Z)((0,De.Z)(n),"layerList",[]),(0,Y.Z)((0,De.Z)(n),"layerRenderID",void 0),(0,Y.Z)((0,De.Z)(n),"sceneInited",!1),(0,Y.Z)((0,De.Z)(n),"animateInstanceCount",0),(0,Y.Z)((0,De.Z)(n),"shaderPicking",!0),(0,Y.Z)((0,De.Z)(n),"enableRender",!0),ra((0,De.Z)(n),"renderService",Fg,(0,De.Z)(n)),ra((0,De.Z)(n),"mapService",Bg,(0,De.Z)(n)),(0,Y.Z)((0,De.Z)(n),"reRender",(0,St.throttle)(function(){n.updateLayerRenderList(),n.renderLayers()},32)),(0,Y.Z)((0,De.Z)(n),"throttleRenderLayers",(0,St.throttle)(function(){n.renderLayers()},16)),n}return(0,wt.Z)(r,[{key:"needPick",value:function(t){return this.layerList.some(function(o){return o.needPick(t)})}},{key:"add",value:function(t){var o=this;this.layers.push(t),this.sceneInited&&t.init().then(function(){o.updateLayerRenderList(),o.renderLayers()})}},{key:"addMask",value:function(t){var o=this;this.sceneInited&&t.init().then(function(){o.renderLayers()})}},{key:"initLayers",value:function(){var n=(0,de.Z)(q().mark(function o(){var u=this;return q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:this.sceneInited=!0,this.layers.forEach(function(){var v=(0,de.Z)(q().mark(function x(E){return q().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(E.startInit){T.next=4;break}return T.next=3,E.init();case 3:u.updateLayerRenderList();case 4:case"end":return T.stop()}},x)}));return function(x){return v.apply(this,arguments)}}());case 2:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(t){return this.layers.find(function(o){return o.id===t})}},{key:"getLayerByName",value:function(t){return this.layers.find(function(o){return o.name===t})}},{key:"remove",value:function(t,o){if(o){var u=o.layerChildren.indexOf(t);u>-1&&o.layerChildren.splice(u,1)}else{var l=this.layers.indexOf(t);l>-1&&this.layers.splice(l,1)}this.updateLayerRenderList(),t.destroy(),this.renderLayers(),this.emit("layerChange",this.layers)}},{key:"removeAllLayers",value:function(){this.destroy(),this.renderLayers()}},{key:"setEnableRender",value:function(t){this.enableRender=t}},{key:"renderLayers",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p;return q().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){x.next=2;break}return x.abrupt("return");case 2:this.alreadyInRendering=!0,this.clear(),u=J2(this.layerList),x.prev=5,u.s();case 7:if((l=u.n()).done){x.next=19;break}if(p=l.value,p.masks.filter(function(E){return E.inited}).length>0&&(this.renderService.clear({stencil:0,depth:1,framebuffer:null}),p.masks.map(function(){var E=(0,de.Z)(q().mark(function C(T){return q().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:T.render();case 1:case"end":return L.stop()}},C)}));return function(C){return E.apply(this,arguments)}}())),!p.getLayerConfig().enableMultiPassRenderer){x.next=15;break}return x.next=13,p.renderMultiPass();case 13:x.next=17;break;case 15:return x.next=17,p.render();case 17:x.next=7;break;case 19:x.next=24;break;case 21:x.prev=21,x.t0=x.catch(5),u.e(x.t0);case 24:return x.prev=24,u.f(),x.finish(24);case 27:this.alreadyInRendering=!1;case 28:case"end":return x.stop()}},o,this,[[5,21,24,27]])}));function t(){return n.apply(this,arguments)}return t}()},{key:"renderMask",value:function(t){t.filter(function(o){return o.inited}).map(function(o){o.render()})}},{key:"beforeRenderData",value:function(){var n=(0,de.Z)(q().mark(function o(u){var l;return q().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,u.hooks.beforeRenderData.promise();case 2:l=v.sent,l&&this.renderLayers();case 4:case"end":return v.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"renderLayer",value:function(){var n=(0,de.Z)(q().mark(function o(u){var l=this;return q().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(u.masks.filter(function(x){return x.inited}).length>0&&u.masks.map(function(x){l.renderService.clear({stencil:0,depth:1,framebuffer:null}),x.render()}),!u.getLayerConfig().enableMultiPassRenderer){v.next=6;break}return v.next=4,u.renderMultiPass();case 4:v.next=8;break;case 6:return v.next=8,u.render();case 8:case"end":return v.stop()}},o)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"updateLayerRenderList",value:function(){var t=this;this.layerList=[],this.layers.filter(function(o){return o.inited}).filter(function(o){return o.isVisible()}).sort(function(o,u){return o.zIndex-u.zIndex}).forEach(function(o){t.layerList.push(o)})}},{key:"destroy",value:function(){this.layers.forEach(function(t){t.destroy()}),this.layers=[],this.layerList=[],this.emit("layerChange",this.layers)}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var t=he(this.mapService.bgColor);this.renderService.clear({color:t,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=pa.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){pa.cancelAnimationFrame(this.layerRenderID)}}]),r}(Ns.EventEmitter),Fg=na(Xv.prototype,"renderService",[Og],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bg=na(Xv.prototype,"mapService",[Lg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xv))||Dg),iE=function(){function e(i){var r=this;(0,xt.Z)(this,e),(0,Y.Z)(this,"name",void 0),(0,Y.Z)(this,"type",void 0),(0,Y.Z)(this,"scale",void 0),(0,Y.Z)(this,"descriptor",void 0),(0,Y.Z)(this,"featureBufferLayout",[]),(0,Y.Z)(this,"needRescale",!1),(0,Y.Z)(this,"needRemapping",!1),(0,Y.Z)(this,"needRegenerateVertices",!1),(0,Y.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,Y.Z)(this,"vertexAttribute",void 0),(0,Y.Z)(this,"defaultCallback",function(n){if(n.length===0){var t;return((t=r.scale)===null||t===void 0?void 0:t.defaultValues)||[]}return n.map(function(o,u){var l,p=(l=r.scale)===null||l===void 0?void 0:l.scalers[u].func,v=p(o);return v})}),this.setProps(i)}return(0,wt.Z)(e,[{key:"setProps",value:function(r){Object.assign(this,r)}},{key:"mapping",value:function(r){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var t,o=(t=this.scale)===null||t===void 0?void 0:t.callback.apply(t,(0,N.Z)(r));if(!(0,St.isNil)(o))return[o]}return this.defaultCallback(r)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),aE=["modelType"],oE=["buffer","update","name"],sE=["buffer","update","name"],uE=["buffer","update","name"],iv,zg,Zg,Ug,nm,Vg,lE=(iv={},(0,Y.Z)(iv,$.FLOAT,4),(0,Y.Z)(iv,$.UNSIGNED_BYTE,1),(0,Y.Z)(iv,$.UNSIGNED_SHORT,2),iv),cE=(zg=(0,Qr.b2)(),Zg=(0,Qr.f3)(Yt.IRendererService),zg(Ug=(nm=function(){function e(){(0,xt.Z)(this,e),(0,Y.Z)(this,"attributesAndIndices",void 0),ra(this,"rendererService",Vg,this),(0,Y.Z)(this,"attributes",[]),(0,Y.Z)(this,"triangulation",void 0),(0,Y.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,wt.Z)(e,[{key:"registerStyleAttribute",value:function(r){var n=this.getLayerStyleAttribute(r.name||"");return n?n.setProps(r):(n=new iE(r),this.attributes.push(n)),n}},{key:"updateStyleAttribute",value:function(r,n,t){var o=this.getLayerStyleAttribute(r);o||(o=this.registerStyleAttribute((0,z.Z)((0,z.Z)({},n),{},{name:r})));var u=n.scale;u&&o&&(o.scale=u,o.needRescale=!0,o.needRemapping=!0,o.needRegenerateVertices=!0,t&&t.featureRange&&(o.featureRange=t.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(r){return this.attributes.find(function(n){return n.name===r})}},{key:"getLayerAttributeScale",value:function(r){var n,t=this.getLayerStyleAttribute(r),o=t==null||(n=t.scale)===null||n===void 0?void 0:n.scalers;return o&&o[0]?o[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(r,n){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0,u=arguments.length>4?arguments[4]:void 0,l=this.attributes.find(function(Ne){return Ne.name===r});if(l&&l.descriptor){var p=l.descriptor,v=p.update,x=p.buffer,E=p.size,C=E===void 0?0:E,T=lE[x.type||$.FLOAT];if(v){var O=this.featureLayout,L=O.elements,B=O.sizePerElement,H=L.slice(t,o);if(!H.length)return;var oe=H[0].offset,le=oe*C*T,Re=H.map(function(Ne,ut){for(var Ot=Ne.featureIdx,Nt=Ne.vertices,jt=Ne.normals,br=Nt.length/B,yr=[],Ur=0;Ur<br;Ur++){var An=jt?jt.slice(Ur*3,Ur*3+3):[];yr.push.apply(yr,(0,N.Z)(v(n[Ot],Ot,Nt.slice(Ur*B,Ur*B+B),ut,An)))}return yr}).reduce(function(Ne,ut){return Ne.push.apply(Ne,(0,N.Z)(ut)),Ne},[]);l.vertexAttribute.updateBuffer({data:Re,offset:le}),u==null||u.emit("legend:".concat(r),{type:r,attr:l})}}}},{key:"createAttributesAndIndicesAscy",value:function(r,n,t){var o=this;this.featureLayout={sizePerElement:0,elements:[]};var u=this.attributes.map(function(O){return O.resetDescriptor(),O.descriptor}).filter(function(O){return O}),l=t.modelType,p=(0,Za.Z)(t,aE),v=this.rendererService,x=v.createAttribute,E=v.createBuffer,C=v.createElements,T={};return new Promise(function(O,L){ah(l,(0,z.Z)({descriptors:o.getDescriptorsWithOutFunc(u),features:r,segmentNumber:n},p)).then(function(B){B.descriptors.forEach(function(oe,le){if(oe){var Re=oe.buffer,Ne=oe.update,ut=oe.name,Ot=(0,Za.Z)(oe,oE),Nt=x((0,z.Z)({buffer:E(Re)},Ot));T[oe.name||""]=Nt,o.attributes[le].vertexAttribute=Nt}}),o.featureLayout=B.featureLayout;var H=C({data:B.indices,type:$.UNSIGNED_INT,count:B.indices.length});o.attributesAndIndices={attributes:T,elements:H,count:null},O(o.attributesAndIndices)}).catch(function(B){console.warn(B),L(B)})})}},{key:"createAttributesAndIndices",value:function(r,n,t){var o=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var u=this.attributes.map(function(le){return le.resetDescriptor(),le.descriptor}),l=0,p=0,v=[],x=[],E=[],C=3;r.forEach(function(le,Re){var Ne=o.triangulation(le,t),ut=Ne.indices,Ot=Ne.vertices,Nt=Ne.normals,jt=Ne.size,br=Ne.indexes,yr=Ne.count;typeof yr=="number"&&(p+=yr),ut.forEach(function(Qi){x.push(Qi+l)}),C=jt;var Ur=Ot.length/jt;o.featureLayout.sizePerElement=C,o.featureLayout.elements.push({featureIdx:Re,vertices:Ot,normals:Nt,offset:l}),l+=Ur;for(var An=function(Ca){var bo=(Nt==null?void 0:Nt.slice(Ca*3,Ca*3+3))||[],Ao=Ot.slice(Ca*jt,Ca*jt+jt),Ko=0;br&&br[Ca]!==void 0&&(Ko=br[Ca]),u.forEach(function(Ml,Pv){if(Ml&&Ml.update){var Nd;(Nd=Ml.buffer.data).push.apply(Nd,(0,N.Z)(Ml.update(le,Re,Ao,Ca,bo,Ko)))}})},jn=0;jn<Ur;jn++)An(jn)});var T=this.rendererService,O=T.createAttribute,L=T.createBuffer,B=T.createElements,H={};u.forEach(function(le,Re){if(le){var Ne=le.buffer,ut=le.update,Ot=le.name,Nt=(0,Za.Z)(le,sE),jt=O((0,z.Z)({buffer:L(Ne)},Nt));H[le.name||""]=jt,o.attributes[Re].vertexAttribute=jt}});var oe=B({data:x,type:$.UNSIGNED_INT,count:x.length});return this.attributesAndIndices={attributes:H,elements:oe,count:p},this.attributesAndIndices}},{key:"createAttributes",value:function(r,n){var t=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var o=this.attributes.map(function(T){return T.resetDescriptor(),T.descriptor}),u=0,l=[],p=3;r.forEach(function(T,O){var L=t.triangulation(T),B=L.indices,H=L.vertices,oe=L.normals,le=L.size,Re=L.indexes;B.forEach(function(Nt){l.push(Nt+u)}),p=le;var Ne=H.length/le;t.featureLayout.sizePerElement=p,t.featureLayout.elements.push({featureIdx:O,vertices:H,normals:oe,offset:u}),u+=Ne;for(var ut=function(jt){var br=(oe==null?void 0:oe.slice(jt*3,jt*3+3))||[],yr=H.slice(jt*le,jt*le+le),Ur=0;Re&&Re[jt]!==void 0&&(Ur=Re[jt]),o.forEach(function(An,jn){if(An&&An.update){var Qi;(Qi=An.buffer.data).push.apply(Qi,(0,N.Z)(An.update(T,O,yr,jt,br,Ur)))}})},Ot=0;Ot<Ne;Ot++)ut(Ot)});var v=this.rendererService,x=v.createAttribute,E=v.createBuffer,C={};return o.forEach(function(T,O){if(T){var L=T.buffer,B=T.update,H=T.name,oe=(0,Za.Z)(T,uE),le=x((0,z.Z)({buffer:E(L)},oe));C[T.name||""]=le,t.attributes[O].vertexAttribute=le}}),{attributes:C}}},{key:"clearAllAttributes",value:function(){var r;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(r=this.attributesAndIndices)===null||r===void 0||r.elements.destroy(),this.attributes=[]}},{key:"getDescriptorsWithOutFunc",value:function(r){return r.map(function(n){return{buffer:n.buffer,name:n.name,size:n.size}})}}]),e}(),Vg=na(nm.prototype,"rendererService",[Zg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nm))||Ug),im=K(34155);function am(e,i,r,n){function t(o){return o instanceof r?o:new r(function(u){u(o)})}return new(r||(r=Promise))(function(o,u){function l(x){try{v(n.next(x))}catch(E){u(E)}}function p(x){try{v(n.throw(x))}catch(E){u(E)}}function v(x){x.done?o(x.value):t(x.value).then(l,p)}v((n=n.apply(e,i||[])).next())})}function om(e,i){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,t,o,u;return u={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function l(v){return function(x){return p([v,x])}}function p(v){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,t&&(o=v[0]&2?t.return:v[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,v[1])).done)return o;switch(t=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return r.label++,{value:v[1],done:!1};case 5:r.label++,t=v[1],v=[0];continue;case 7:v=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){r=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){r.label=v[1];break}if(v[0]===6&&r.label<o[1]){r.label=o[1],o=v;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(v);break}o[2]&&r.ops.pop(),r.trys.pop();continue}v=i.call(e,r)}catch(x){v=[6,x],t=0}finally{n=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}}function $v(e,i){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),t,o=[],u;try{for(;(i===void 0||i-- >0)&&!(t=n.next()).done;)o.push(t.value)}catch(l){u={error:l}}finally{try{t&&!t.done&&(r=n.return)&&r.call(n)}finally{if(u)throw u.error}}return o}function Yv(e,i,r){if(r||arguments.length===2)for(var n=0,t=i.length,o;n<t;n++)(o||!(n in i))&&(o||(o=Array.prototype.slice.call(i,0,n)),o[n]=i[n]);return e.concat(o||Array.prototype.slice.call(i))}function sm(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var um={exports:{}},qv={exports:{}},av={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return n&&typeof n.length=="number"&&n.length>=0&&n.length%1==0}e.exports=i.default})(av,av.exports);var Tl={},lm={exports:{}},cm={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return function(){for(var n=[],t=arguments.length;t--;)n[t]=arguments[t];var o=n.pop();return r.call(this,n,o)}},e.exports=i.default})(cm,cm.exports);var Kh={};Object.defineProperty(Kh,"__esModule",{value:!0}),Kh.fallback=jg,Kh.wrap=Gg;var fE=Kh.hasQueueMicrotask=typeof queueMicrotask=="function"&&queueMicrotask,hE=Kh.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,pE=Kh.hasNextTick=typeof im=="object"&&typeof im.nextTick=="function";function jg(e){setTimeout(e,0)}function Gg(e){return function(i){for(var r=[],n=arguments.length-1;n-- >0;)r[n]=arguments[n+1];return e(function(){return i.apply(void 0,r)})}}var ov;fE?ov=queueMicrotask:hE?ov=setImmediate:pE?ov=im.nextTick:ov=jg,Kh.default=Gg(ov),function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=p;var r=cm.exports,n=l(r),t=Kh,o=l(t),u=Tl;function l(E){return E&&E.__esModule?E:{default:E}}function p(E){return(0,u.isAsync)(E)?function(){for(var C=[],T=arguments.length;T--;)C[T]=arguments[T];var O=C.pop(),L=E.apply(this,C);return v(L,O)}:(0,n.default)(function(C,T){var O;try{O=E.apply(this,C)}catch(L){return T(L)}if(O&&typeof O.then=="function")return v(O,T);T(null,O)})}function v(E,C){return E.then(function(T){x(C,null,T)},function(T){x(C,T&&T.message?T:new Error(T))})}function x(E,C,T){try{E(C,T)}catch(O){(0,o.default)(function(L){throw L},O)}}e.exports=i.default}(lm,lm.exports),Object.defineProperty(Tl,"__esModule",{value:!0}),Tl.isAsyncIterable=Tl.isAsyncGenerator=Tl.isAsync=void 0;var dE=lm.exports,vE=mE(dE);function mE(e){return e&&e.__esModule?e:{default:e}}function Hg(e){return e[Symbol.toStringTag]==="AsyncFunction"}function gE(e){return e[Symbol.toStringTag]==="AsyncGenerator"}function yE(e){return typeof e[Symbol.asyncIterator]=="function"}function _E(e){if(typeof e!="function")throw new Error("expected a function");return Hg(e)?(0,vE.default)(e):e}Tl.default=_E,Tl.isAsync=Hg,Tl.isAsyncGenerator=gE,Tl.isAsyncIterable=yE;var Fp={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n,t){if(t===void 0&&(t=n.length),!t)throw new Error("arity is undefined");function o(){for(var u=this,l=[],p=arguments.length;p--;)l[p]=arguments[p];return typeof l[t-1]=="function"?n.apply(this,l):new Promise(function(v,x){l[t-1]=function(E){for(var C=[],T=arguments.length-1;T-- >0;)C[T]=arguments[T+1];if(E)return x(E);v(C.length>1?C:C[0])},n.apply(u,l)})}return o}e.exports=i.default})(Fp,Fp.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=av.exports,n=p(r),t=Tl,o=p(t),u=Fp.exports,l=p(u);function p(v){return v&&v.__esModule?v:{default:v}}i.default=(0,l.default)(function(v,x,E){var C=(0,n.default)(x)?[]:{};v(x,function(T,O,L){(0,o.default)(T)(function(B){for(var H,oe=[],le=arguments.length-1;le-- >0;)oe[le]=arguments[le+1];oe.length<2&&(H=oe,oe=H[0]),C[O]=oe,L(B)})},function(T){return E(T,C)})},3),e.exports=i.default}(qv,qv.exports);var fm={exports:{}},Kv={exports:{}},hm={exports:{}},sv={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){function t(){for(var o=[],u=arguments.length;u--;)o[u]=arguments[u];if(n!==null){var l=n;n=null,l.apply(this,o)}}return Object.assign(t,n),t}e.exports=i.default})(sv,sv.exports);var pm={exports:{}},dm={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return r[Symbol.iterator]&&r[Symbol.iterator]()},e.exports=i.default})(dm,dm.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=x;var r=av.exports,n=u(r),t=dm.exports,o=u(t);function u(E){return E&&E.__esModule?E:{default:E}}function l(E){var C=-1,T=E.length;return function(){return++C<T?{value:E[C],key:C}:null}}function p(E){var C=-1;return function(){var O=E.next();return O.done?null:(C++,{value:O.value,key:C})}}function v(E){var C=E?Object.keys(E):[],T=-1,O=C.length;return function L(){var B=C[++T];return B==="__proto__"?L():T<O?{value:E[B],key:B}:null}}function x(E){if((0,n.default)(E))return l(E);var C=(0,o.default)(E);return C?p(C):v(E)}e.exports=i.default}(pm,pm.exports);var uv={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return function(){for(var t=[],o=arguments.length;o--;)t[o]=arguments[o];if(n===null)throw new Error("Callback was already called.");var u=n;n=null,u.apply(this,t)}}e.exports=i.default})(uv,uv.exports);var vm={exports:{}},lv={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r={};i.default=r,e.exports=i.default})(lv,lv.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=o;var r=lv.exports,n=t(r);function t(u){return u&&u.__esModule?u:{default:u}}function o(u,l,p,v){var x=!1,E=!1,C=!1,T=0,O=0;function L(){T>=l||C||x||(C=!0,u.next().then(function(oe){var le=oe.value,Re=oe.done;if(!(E||x)){if(C=!1,Re){x=!0,T<=0&&v(null);return}T++,p(le,O,B),O++,L()}}).catch(H))}function B(oe,le){if(T-=1,!E){if(oe)return H(oe);if(oe===!1){x=!0,E=!0;return}if(le===n.default||x&&T<=0)return x=!0,v(null);L()}}function H(oe){E||(C=!1,x=!0,v(oe))}L()}e.exports=i.default}(vm,vm.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=sv.exports,n=T(r),t=pm.exports,o=T(t),u=uv.exports,l=T(u),p=Tl,v=vm.exports,x=T(v),E=lv.exports,C=T(E);function T(O){return O&&O.__esModule?O:{default:O}}i.default=function(O){return function(L,B,H){if(H=(0,n.default)(H),O<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!L)return H(null);if((0,p.isAsyncGenerator)(L))return(0,x.default)(L,O,B,H);if((0,p.isAsyncIterable)(L))return(0,x.default)(L[Symbol.asyncIterator](),O,B,H);var oe=(0,o.default)(L),le=!1,Re=!1,Ne=0,ut=!1;function Ot(jt,br){if(!Re)if(Ne-=1,jt)le=!0,H(jt);else if(jt===!1)le=!0,Re=!0;else{if(br===C.default||le&&Ne<=0)return le=!0,H(null);ut||Nt()}}function Nt(){for(ut=!0;Ne<O&&!le;){var jt=oe();if(jt===null){le=!0,Ne<=0&&H(null);return}Ne+=1,B(jt.value,jt.key,(0,l.default)(Ot))}ut=!1}Nt()}},e.exports=i.default}(hm,hm.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=hm.exports,n=p(r),t=Tl,o=p(t),u=Fp.exports,l=p(u);function p(x){return x&&x.__esModule?x:{default:x}}function v(x,E,C,T){return(0,n.default)(E)(x,(0,o.default)(C),T)}i.default=(0,l.default)(v,4),e.exports=i.default}(Kv,Kv.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=Kv.exports,n=u(r),t=Fp.exports,o=u(t);function u(p){return p&&p.__esModule?p:{default:p}}function l(p,v,x){return(0,n.default)(p,1,v,x)}i.default=(0,o.default)(l,3),e.exports=i.default}(fm,fm.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=l;var r=qv.exports,n=u(r),t=fm.exports,o=u(t);function u(p){return p&&p.__esModule?p:{default:p}}function l(p,v){return(0,n.default)(o.default,p,v)}e.exports=i.default}(um,um.exports);var Qv=sm(um.exports),Ff=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return this.args=r,Qv(this.tasks)},e.prototype.tap=function(i,r){var n=this;this.tasks.push(function(t){r.apply(void 0,Yv([],$v(n.args),!1)),t(null,i)})},e}(),mm={exports:{}},gm={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=av.exports,n=B(r),t=lv.exports,o=B(t),u=Kv.exports,l=B(u),p=sv.exports,v=B(p),x=uv.exports,E=B(x),C=Tl,T=B(C),O=Fp.exports,L=B(O);function B(Re){return Re&&Re.__esModule?Re:{default:Re}}function H(Re,Ne,ut){ut=(0,v.default)(ut);var Ot=0,Nt=0,jt=Re.length,br=!1;jt===0&&ut(null);function yr(Ur,An){Ur===!1&&(br=!0),br!==!0&&(Ur?ut(Ur):(++Nt===jt||An===o.default)&&ut(null))}for(;Ot<jt;Ot++)Ne(Re[Ot],Ot,(0,E.default)(yr))}function oe(Re,Ne,ut){return(0,l.default)(Re,Infinity,Ne,ut)}function le(Re,Ne,ut){var Ot=(0,n.default)(Re)?H:oe;return Ot(Re,(0,T.default)(Ne),ut)}i.default=(0,L.default)(le,3),e.exports=i.default})(gm,gm.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=l;var r=gm.exports,n=u(r),t=qv.exports,o=u(t);function u(p){return p&&p.__esModule?p:{default:p}}function l(p,v){return(0,o.default)(n.default,p,v)}e.exports=i.default}(mm,mm.exports);var xE=sm(mm.exports),NP=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return xE(this.tasks)},e.prototype.tapPromise=function(i,r){var n=this;this.tasks.push(function(t){return am(n,void 0,void 0,function(){return om(this,function(o){switch(o.label){case 0:return[4,r()];case 1:return o.sent(),t(null,i),[2]}})})})},e}(),ym={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=sv.exports,n=x(r),t=uv.exports,o=x(t),u=Tl,l=x(u),p=Fp.exports,v=x(p);function x(C){return C&&C.__esModule?C:{default:C}}function E(C,T){if(T=(0,n.default)(T),!Array.isArray(C))return T(new Error("First argument to waterfall must be an array of functions"));if(!C.length)return T();var O=0;function L(H){var oe=(0,l.default)(C[O++]);oe.apply(void 0,H.concat([(0,o.default)(B)]))}function B(H){for(var oe=[],le=arguments.length-1;le-- >0;)oe[le]=arguments[le+1];if(H!==!1){if(H||O===C.length)return T.apply(void 0,[H].concat(oe));L(oe)}}L([])}i.default=(0,v.default)(E),e.exports=i.default})(ym,ym.exports);var Wg=sm(ym.exports),zP=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return Wg(this.tasks)},e.prototype.tap=function(i,r){this.tasks.length===0?this.tasks.push(function(n){var t=r();n(t?null:!1,t)}):this.tasks.push(function(n,t){var o=r.apply(void 0,Yv([],$v(n),!1));t(o?null:!1,i)})},e}(),Xg=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return Qv(this.tasks)},e.prototype.tap=function(i,r){this.tasks.push(function(n){var t=r();n(t,i)})},e}(),bE=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return this.args=r,Qv(this.tasks)},e.prototype.tapPromise=function(i,r){var n=this;this.tasks.push(function(t){return am(n,void 0,void 0,function(){return om(this,function(o){switch(o.label){case 0:return[4,r.apply(void 0,Yv([],$v(this.args),!1))];case 1:return o.sent(),t(null,i),[2]}})})})},e}(),EE=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return this.args=r,Qv(this.tasks)},e.prototype.tapPromise=function(i,r){var n=this;this.tasks.push(function(t){return am(n,void 0,void 0,function(){var o;return om(this,function(u){switch(u.label){case 0:return[4,r.apply(void 0,Yv([],$v(this.args),!1))];case 1:return o=u.sent(),t(o,i),[2]}})})})},e}(),SE=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return Wg(this.tasks)},e.prototype.tapPromise=function(i,r){this.tasks.length===0?this.tasks.push(function(n){r().then(function(t){n(null,t)})}):this.tasks.push(function(n,t){r(n).then(function(o){t(null,o)})})},e}(),$g=K(67709),wE=K.n($g),Yg,qg,Kg,Qg,Jg,ey,ty,ry,ny,iy,ay,oy,sy,uy,ly,cy,fy,Du,hy,py,dy,vy,gy,yy,_y,xy,by,Ey,Sy,wy,Cy,Ay,Ty;function CE(e){var i=AE();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function AE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var TE=(Yg=(0,Qr.b2)(),qg=(0,Qr.f3)(Yt.SceneID),Kg=(0,Qr.f3)(Yt.IIconService),Qg=(0,Qr.f3)(Yt.IFontService),Jg=(0,Qr.f3)(Yt.IControlService),ey=(0,Qr.f3)(Yt.IGlobalConfigService),ty=(0,Qr.f3)(Yt.IMapService),ry=(0,Qr.f3)(Yt.ICoordinateSystemService),ny=(0,Qr.f3)(Yt.IRendererService),iy=(0,Qr.f3)(Yt.ILayerService),ay=(0,Qr.f3)(Yt.ICameraService),oy=(0,Qr.f3)(Yt.IInteractionService),sy=(0,Qr.f3)(Yt.IPickingService),uy=(0,Qr.f3)(Yt.IShaderModuleService),ly=(0,Qr.f3)(Yt.IMarkerService),cy=(0,Qr.f3)(Yt.IPopupService),Yg(fy=(Du=function(e){(0,gr.Z)(r,e);var i=CE(r);function r(){var n;return(0,xt.Z)(this,r),n=i.call(this),(0,Y.Z)((0,De.Z)(n),"destroyed",!1),(0,Y.Z)((0,De.Z)(n),"loaded",!1),ra((0,De.Z)(n),"id",hy,(0,De.Z)(n)),ra((0,De.Z)(n),"iconService",py,(0,De.Z)(n)),ra((0,De.Z)(n),"fontService",dy,(0,De.Z)(n)),ra((0,De.Z)(n),"controlService",vy,(0,De.Z)(n)),ra((0,De.Z)(n),"configService",gy,(0,De.Z)(n)),ra((0,De.Z)(n),"map",yy,(0,De.Z)(n)),ra((0,De.Z)(n),"coordinateSystemService",_y,(0,De.Z)(n)),ra((0,De.Z)(n),"rendererService",xy,(0,De.Z)(n)),ra((0,De.Z)(n),"layerService",by,(0,De.Z)(n)),ra((0,De.Z)(n),"cameraService",Ey,(0,De.Z)(n)),ra((0,De.Z)(n),"interactionService",Sy,(0,De.Z)(n)),ra((0,De.Z)(n),"pickingService",wy,(0,De.Z)(n)),ra((0,De.Z)(n),"shaderModuleService",Cy,(0,De.Z)(n)),ra((0,De.Z)(n),"markerService",Ay,(0,De.Z)(n)),ra((0,De.Z)(n),"popupService",Ty,(0,De.Z)(n)),(0,Y.Z)((0,De.Z)(n),"inited",!1),(0,Y.Z)((0,De.Z)(n),"initPromise",void 0),(0,Y.Z)((0,De.Z)(n),"rendering",!1),(0,Y.Z)((0,De.Z)(n),"$container",void 0),(0,Y.Z)((0,De.Z)(n),"canvas",void 0),(0,Y.Z)((0,De.Z)(n),"markerContainer",void 0),(0,Y.Z)((0,De.Z)(n),"hooks",void 0),(0,Y.Z)((0,De.Z)(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),ko(),n.coordinateSystemService.needRefresh=!0,n.render())}),(0,Y.Z)((0,De.Z)(n),"handleMapCameraChanged",function(t){n.cameraService.update(t),n.render()}),n.hooks={init:new bE},n}return(0,wt.Z)(r,[{key:"init",value:function(t){var o=this;this.configService.setSceneConfig(this.id,t),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return o.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,de.Z)(q().mark(function u(){return q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,new Promise(function(v){o.map.onCameraChanged(function(x){o.cameraService.init(),o.cameraService.update(x),v()}),o.map.init()});case 2:o.map.onCameraChanged(o.handleMapCameraChanged),o.map.addMarkerContainer(),o.markerService.addMarkers(),o.markerService.addMarkerLayers(),o.popupService.initPopup(),o.interactionService.init(),o.interactionService.on(lu.Drag,o.addSceneEvent.bind(o));case 9:case"end":return p.stop()}},u)}))),this.hooks.init.tapPromise("initRenderer",(0,de.Z)(q().mark(function u(){var l,p;return q().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(l=o.map.getOverlayContainer(),l?o.$container=l:o.$container=Wv(o.configService.getSceneConfig(o.id).id||""),!o.$container){x.next=12;break}return o.canvas=Bi("canvas","",o.$container),o.setCanvas(),x.next=7,o.rendererService.init(o.canvas,o.configService.getSceneConfig(o.id),t.gl);case 7:o.initContainer(),wE()(o.$container,o.handleWindowResized),pa.matchMedia&&((p=pa.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||p===void 0||p.addListener(o.handleWindowResized)),x.next=13;break;case 12:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 13:o.pickingService.init(o.id);case 14:case"end":return x.stop()}},u)}))),this.render()}},{key:"initMiniScene",value:function(t){var o=this;this.configService.setSceneConfig(this.id,t),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return o.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,de.Z)(q().mark(function u(){return q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,new Promise(function(v){o.map.onCameraChanged(function(x){o.cameraService.init(),o.cameraService.update(x),o.map.version!=="GAODE2.x"&&v()}),o.map.initMiniMap()});case 2:o.map.onCameraChanged(o.handleMapCameraChanged),o.interactionService.init(),o.interactionService.on(lu.Drag,o.addSceneEvent.bind(o));case 5:case"end":return p.stop()}},u)}))),this.hooks.init.tapPromise("initRenderer",(0,de.Z)(q().mark(function u(){var l;return q().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(l=t.canvas,o.$container=l||null,!o.$container){v.next=7;break}return v.next=5,o.rendererService.init(t.canvas,o.configService.getSceneConfig(o.id),void 0);case 5:v.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:o.pickingService.init(o.id);case 9:case"end":return v.stop()}},u)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(t){this.layerService.sceneService=this,this.layerService.add(t)}},{key:"addMask",value:function(t){this.layerService.sceneService=this,this.layerService.addMask(t)}},{key:"render",value:function(){var n=(0,de.Z)(q().mark(function o(){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(this.rendering||this.destroyed)){l.next=2;break}return l.abrupt("return");case 2:if(this.rendering=!0,this.inited){l.next=16;break}return l.next=6,this.hooks.init.promise();case 6:return this.destroyed&&this.destroy(),l.next=9,this.layerService.initLayers();case 9:this.layerService.renderLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0,l.next=18;break;case 16:this.layerService.initLayers(),this.layerService.renderLayers();case 18:this.rendering=!1;case 19:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"addFontFace",value:function(t,o){this.fontService.addFontFace(t,o)}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(t){var o,u=(o=this.$container)===null||o===void 0?void 0:o.getElementsByTagName("canvas")[0];this.render();var l=t==="jpg"?u==null?void 0:u.toDataURL("image/jpeg"):u==null?void 0:u.toDataURL("image/png");return l}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var t=this.$container.parentElement;t!==null&&(this.markerContainer=Bi("div","l7-marker-container",t))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var t=this,o,u;if(!this.inited){this.destroyed=!0;return}if((0,$g.unbind)(this.$container,this.handleWindowResized),pa.matchMedia){var l;(l=pa.matchMedia("screen and (min-resolution: 2dppx)"))===null||l===void 0||l.removeListener(this.handleWindowResized)}this.pickingService.destroy(),this.layerService.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),this.removeAllListeners(),this.inited=!1,this.map.destroy(),setTimeout(function(){var p;(p=t.$container)===null||p===void 0||p.removeChild(t.canvas),t.canvas=null,t.rendererService.destroy()}),(o=this.$container)===null||o===void 0||(u=o.parentNode)===null||u===void 0||u.removeChild(this.$container),this.emit("destroy")}},{key:"initContainer",value:function(){var t,o,u=Da,l=((t=this.$container)===null||t===void 0?void 0:t.clientWidth)||400,p=((o=this.$container)===null||o===void 0?void 0:o.clientHeight)||300,v=this.canvas;v&&(v.width=l*u,v.height=p*u),this.rendererService.viewport({x:0,y:0,width:u*l,height:u*p})}},{key:"setCanvas",value:function(){var t,o,u=Da,l=((t=this.$container)===null||t===void 0?void 0:t.clientWidth)||400,p=((o=this.$container)===null||o===void 0?void 0:o.clientHeight)||300,v=this.canvas;v.width=l*u,v.height=p*u,v.style.width="100%",v.style.height="100%"}},{key:"addSceneEvent",value:function(t){this.emit(t.type,t)}}]),r}(Ns.EventEmitter),hy=na(Du.prototype,"id",[qg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),py=na(Du.prototype,"iconService",[Kg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dy=na(Du.prototype,"fontService",[Qg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vy=na(Du.prototype,"controlService",[Jg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gy=na(Du.prototype,"configService",[ey],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yy=na(Du.prototype,"map",[ty],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_y=na(Du.prototype,"coordinateSystemService",[ry],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xy=na(Du.prototype,"rendererService",[ny],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),by=na(Du.prototype,"layerService",[iy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ey=na(Du.prototype,"cameraService",[ay],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sy=na(Du.prototype,"interactionService",[oy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wy=na(Du.prototype,"pickingService",[sy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cy=na(Du.prototype,"shaderModuleService",[uy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ay=na(Du.prototype,"markerService",[ly],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ty=na(Du.prototype,"popupService",[cy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Du))||fy);function ME(e){var i=0;switch(e){case"vec2":case"ivec2":i=2;break;case"vec3":case"ivec3":i=3;break;case"vec4":case"ivec4":case"mat2":i=4;break;case"mat3":i=9;break;case"mat4":i=16;break;default:}return i}var kE=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function My(e){var i={};return e=e.replace(kE,function(r,n,t){var o=t.split(":"),u=o[0].trim(),l="";switch(o.length>1&&(l=o[1].trim()),n){case"bool":l=l==="true";break;case"float":case"int":l=Number(l);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":l?l=l.replace("[","").replace("]","").split(",").reduce(function(p,v){return p.push(Number(v.trim())),p},[]):l=new Array(ME(n)).fill(0);break;default:}return i[u]=l,"uniform ".concat(n," ").concat(u,`;
`)}),{content:e,uniforms:i}}var ky,Iy,Py="#define PI 3.14159265359",IE=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,PE=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,RE=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,OE=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

uniform float u_activeMix: 0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,LE=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec3 u_CurrentSelectedId : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;
uniform float u_EnableSelect: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {
  //   // \u9009\u4E2D\u6001
  //   v_PickingResult.a = SELECT;
  // } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {
  //   // \u9AD8\u4EAE\u6001
  //   v_PickingResult.a = HIGHLIGHT;
  // } else {
  //   v_PickingResult.a = NORMAL;
  // }

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,DE=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,FE=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_mvt_offset_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return project_offset(vec4(0.0, 0.0, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }
  return position;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom));
  }
  return pixel * 2.0;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,BE=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,NE=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasThetaOffset() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 thetaOffset \u7684\u6570\u636E
  return u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 1.0, 0.0, 0.0, // offsets thetaOffset
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0 +  // offsets
          u_cellTypeLayout[2][1];         // thetaOffset
}`,zE=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,ZE=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,UE=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,VE=`
// \u8BA1\u7B97 thetaOffset \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasThetaOffset()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 thetaOffset \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_thetaOffset, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureThetaOffset, textureOffset + 1.0);
  }
}
`,jE=/precision\s+(high|low|medium)p\s+float/,GE=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,HE=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,WE=(ky=(0,Qr.b2)(),ky(Iy=function(){function e(){(0,xt.Z)(this,e),(0,Y.Z)(this,"moduleCache",{}),(0,Y.Z)(this,"rawContentCache",{})}return(0,wt.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:Py,fs:Py}),this.registerModule("decode",{vs:IE,fs:""}),this.registerModule("projection",{vs:FE,fs:""}),this.registerModule("project",{vs:DE,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:BE}),this.registerModule("lighting",{vs:RE,fs:""}),this.registerModule("light",{vs:PE,fs:""}),this.registerModule("picking",{vs:LE,fs:OE}),this.registerModule("styleMapping",{vs:NE,fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:VE,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:zE,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:ZE,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:UE,fs:""})}},{key:"registerModule",value:function(r,n){if(!this.rawContentCache[r]){var t=n.vs,o=n.fs,u=n.uniforms,l=My(t),p=l.content,v=l.uniforms,x=My(o),E=x.content,C=x.uniforms;this.rawContentCache[r]={fs:E,uniforms:(0,z.Z)((0,z.Z)((0,z.Z)({},v),C),u),vs:p}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(r){var n=this;if(this.moduleCache[r])return this.moduleCache[r];var t=this.rawContentCache[r].vs,o=this.rawContentCache[r].fs,u=this.processModule(t,[],"vs"),l=u.content,p=u.includeList,v=this.processModule(o,[],"fs"),x=v.content,E=v.includeList,C=x,T=(0,St.uniq)(p.concat(E).concat(r)).reduce(function(O,L){return(0,z.Z)((0,z.Z)({},O),n.rawContentCache[L].uniforms)},{});return jE.test(x)||(C=GE+x),this.moduleCache[r]={fs:C.trim(),uniforms:T,vs:l.trim()},this.moduleCache[r]}},{key:"processModule",value:function(r,n,t){var o=this,u=r.replace(HE,function(l,p){var v=p.split(" "),x=v[0].replace(/"/g,"");if(n.indexOf(x)>-1)return"";var E=o.rawContentCache[x][t];n.push(x);var C=o.processModule(E,n,t),T=C.content;return T});return{content:u,includeList:n}}}]),e}())||Iy);function XE(e,i){for(;!Object.prototype.hasOwnProperty.call(e,i)&&(e=(0,rt.Z)(e),e!==null););return e}function Ra(){return typeof Reflect!="undefined"&&Reflect.get?Ra=Reflect.get.bind():Ra=function(i,r,n){var t=XE(i,r);if(!!t){var o=Object.getOwnPropertyDescriptor(t,r);return o.get?o.get.call(arguments.length<3?i:n):o.value}},Ra.apply(this,arguments)}var Qh;(function(e){e.Normal="normal",e.PostProcessing="post-processing"})(Qh||(Qh={}));var Ry,Oy,Jv=(Ry=(0,Qr.b2)(),Ry(Oy=function(){function e(){(0,xt.Z)(this,e),(0,Y.Z)(this,"shaderModuleService",void 0),(0,Y.Z)(this,"rendererService",void 0),(0,Y.Z)(this,"cameraService",void 0),(0,Y.Z)(this,"mapService",void 0),(0,Y.Z)(this,"interactionService",void 0),(0,Y.Z)(this,"layerService",void 0),(0,Y.Z)(this,"config",void 0)}return(0,wt.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return Qh.Normal}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(Yt.IRendererService),this.cameraService=r.getContainer().get(Yt.ICameraService),this.mapService=r.getContainer().get(Yt.IMapService),this.interactionService=r.getContainer().get(Yt.IInteractionService),this.layerService=r.getContainer().get(Yt.ILayerService),this.shaderModuleService=r.getContainer().get(Yt.IShaderModuleService)}},{key:"render",value:function(r){}}]),e}())||Oy),Ly,Dy;function $E(e){var i=YE();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function YE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qE=(Ly=(0,Qr.b2)(),Ly(Dy=function(e){(0,gr.Z)(r,e);var i=$E(r);function r(){return(0,xt.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(t,o){Ra((0,rt.Z)(r.prototype),"init",this).call(this,t,o)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),r}(Jv))||Dy),Fy,By,Ny,_m,zy;function KE(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=QE(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function QE(e,i){if(!!e){if(typeof e=="string")return Zy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Zy(e,i)}}function Zy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var JE=(Fy=(0,Qr.b2)(),By=(0,Qr.f3)(Yt.IPostProcessor),Fy(Ny=(_m=function(){function e(){(0,xt.Z)(this,e),(0,Y.Z)(this,"passes",[]),ra(this,"postProcessor",zy,this),(0,Y.Z)(this,"layer",void 0),(0,Y.Z)(this,"renderFlag",void 0),(0,Y.Z)(this,"width",0),(0,Y.Z)(this,"height",0)}return(0,wt.Z)(e,[{key:"setLayer",value:function(r){this.layer=r}},{key:"setRenderFlag",value:function(r){this.renderFlag=r}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var i=(0,de.Z)(q().mark(function n(){var t,o,u;return q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:t=KE(this.passes),p.prev=1,t.s();case 3:if((o=t.n()).done){p.next=9;break}return u=o.value,p.next=7,u.render(this.layer);case 7:p.next=3;break;case 9:p.next=14;break;case 11:p.prev=11,p.t0=p.catch(1),t.e(p.t0);case 14:return p.prev=14,t.f(),p.finish(14);case 17:return p.next=19,this.postProcessor.render(this.layer);case 19:case"end":return p.stop()}},n,this,[[1,11,14,17]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){(this.width!==r||this.height!==n)&&(this.postProcessor.resize(r,n),this.width=r,this.height=n)}},{key:"add",value:function(r,n){r.getType()===Qh.PostProcessing?this.postProcessor.add(r,this.layer,n):(r.init(this.layer,n),this.passes.push(r))}},{key:"insert",value:function(r,n,t){r.init(this.layer,n),this.passes.splice(t,0,r)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),zy=na(_m.prototype,"postProcessor",[By],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_m))||Ny),Uy,Vy;function eS(e){var i=tS();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function tS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rS=(Uy=(0,Qr.b2)(),Uy(Vy=function(e){(0,gr.Z)(r,e);var i=eS(r);function r(){var n;(0,xt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,De.Z)(n),"pickingFBO",void 0),(0,Y.Z)((0,De.Z)(n),"layer",void 0),(0,Y.Z)((0,De.Z)(n),"width",0),(0,Y.Z)((0,De.Z)(n),"height",0),(0,Y.Z)((0,De.Z)(n),"alreadyInRendering",!1),(0,Y.Z)((0,De.Z)(n),"pickFromPickingFBO",function(l){var p=l.x,v=l.y,x=l.lngLat,E=l.type;if(!(!n.layer.isVisible()||!n.layer.needPick(E))){var C=n.rendererService,T=C.getViewportSize,O=C.readPixels,L=C.useFramebuffer,B=T(),H=B.width,oe=B.height,le=n.layer.getLayerConfig(),Re=le.enableHighlight,Ne=le.enableSelect,ut=p*Da,Ot=v*Da;if(!(ut>H||ut<0||Ot>oe||Ot<0)){var Nt;L(n.pickingFBO,function(){var jt;if(Nt=O({x:Math.round(ut),y:Math.round(oe-(v+1)*Da),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),Nt[0]!==0||Nt[1]!==0||Nt[2]!==0){var br=Se(Nt),yr=n.layer.getSource().getFeatureById(br),Ur={x:p,y:v,type:E,lngLat:x,featureId:br,feature:yr};yr&&(n.layer.setCurrentPickId(br),n.triggerHoverOnLayer(Ur))}else{var An={x:p,y:v,lngLat:x,type:n.layer.getCurrentPickId()===null?"un"+E:"mouseout",featureId:null,feature:null};n.triggerHoverOnLayer((0,z.Z)((0,z.Z)({},An),{},{type:"unpick"})),n.triggerHoverOnLayer(An),n.layer.setCurrentPickId(null)}Re&&n.highlightPickedFeature(Nt),Ne&&E==="click"&&((jt=Nt)===null||jt===void 0?void 0:jt.toString())!==[0,0,0,0].toString()&&n.selectFeature(Nt)})}}}),n}return(0,wt.Z)(r,[{key:"getType",value:function(){return Qh.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(t,o){Ra((0,rt.Z)(r.prototype),"init",this).call(this,t,o),this.layer=t;var u=this.rendererService,l=u.createTexture2D,p=u.createFramebuffer,v=u.getViewportSize,x=v(),E=x.width,C=x.height;this.pickingFBO=p({color:l({width:E,height:C,wrapS:$.CLAMP_TO_EDGE,wrapT:$.CLAMP_TO_EDGE})}),this.interactionService.on(lu.Hover,this.pickFromPickingFBO),this.interactionService.on(lu.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(lu.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(t){var o=this;if(!this.alreadyInRendering){var u=this.rendererService,l=u.getViewportSize,p=u.useFramebuffer,v=u.clear,x=l(),E=x.width,C=x.height;this.alreadyInRendering=!0,(this.width!==E||this.height!==C)&&(this.pickingFBO.resize({width:E,height:C}),this.width=E,this.height=C),p(this.pickingFBO,function(){v({framebuffer:o.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var T=o.layer.multiPassRenderer.getRenderFlag();o.layer.multiPassRenderer.setRenderFlag(!1),t.hooks.beforePickingEncode.call(),t.render(),t.hooks.afterPickingEncode.call(),o.layer.multiPassRenderer.setRenderFlag(T),o.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(t){this.layer.emit(t.type,t)}},{key:"highlightPickedFeature",value:function(t){var o=(0,hr.Z)(t,3),u=o[0],l=o[1],p=o[2];this.layer.hooks.beforeHighlight.call([u,l,p]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(t){var o=(0,hr.Z)(t,3),u=o[0],l=o[1],p=o[2];this.layer.hooks.beforeSelect.call([u,l,p]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(t){var o=t.featureId,u=Ae(o);this.selectFeature(new Uint8Array(u))}},{key:"highlightFeatureHandle",value:function(t){var o=t.featureId,u=Ae(o);this.highlightPickedFeature(new Uint8Array(u))}}]),r}(Jv))||Vy),jy,Gy,Hy,xm,Wy,nS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,xh=(jy=(0,Qr.b2)(),Gy=(0,Qr.f3)(Yt.IShaderModuleService),jy(Hy=(xm=function(){function e(){(0,xt.Z)(this,e),ra(this,"shaderModuleService",Wy,this),(0,Y.Z)(this,"rendererService",void 0),(0,Y.Z)(this,"config",void 0),(0,Y.Z)(this,"quad",nS),(0,Y.Z)(this,"enabled",!0),(0,Y.Z)(this,"renderToScreen",!1),(0,Y.Z)(this,"model",void 0),(0,Y.Z)(this,"name",void 0),(0,Y.Z)(this,"optionsToUpdate",{})}return(0,wt.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(r){this.name=r}},{key:"getType",value:function(){return Qh.PostProcessing}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(Yt.IRendererService),this.shaderModuleService=r.getContainer().get(Yt.IShaderModuleService);var t=this.rendererService,o=t.createAttribute,u=t.createBuffer,l=t.createModel,p=this.setupShaders(),v=p.vs,x=p.fs,E=p.uniforms;this.model=l({vs:v,fs:x,attributes:{a_Position:o({buffer:u({data:[-4,-4,4,-4,0,4],type:$.FLOAT}),size:2})},uniforms:(0,z.Z)((0,z.Z)({u_Texture:null},E),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(r,n){var t=this,o=r.multiPassRenderer.getPostProcessor(),u=this.rendererService,l=u.useFramebuffer,p=u.getViewportSize,v=u.clear,x=p(),E=x.width,C=x.height;l(this.renderToScreen?null:o.getWriteFBO(),function(){v({framebuffer:o.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var T=(0,z.Z)({u_BloomFinal:0,u_Texture:o.getReadFBO(),u_ViewportSize:[E,C]},t.convertOptionsToUniforms(t.optionsToUpdate));n&&(T.u_BloomFinal=1,T.u_Texture2=n),t.model.draw({uniforms:T})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(r){this.enabled=r}},{key:"setRenderToScreen",value:function(r){this.renderToScreen=r}},{key:"updateOptions",value:function(r){this.optionsToUpdate=(0,z.Z)((0,z.Z)({},this.optionsToUpdate),r)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(r){var n={};return Object.keys(r).forEach(function(t){(0,St.isNil)(r[t])||(n["u_".concat((0,St.upperFirst)((0,St.camelCase)(t)))]=r[t])}),n}}]),e}(),Wy=na(xm.prototype,"shaderModuleService",[Gy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xm))||Hy),Xy,$y;function iS(e){var i=aS();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function aS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var oS=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,sS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,uS=(Xy=(0,Qr.b2)(),Xy($y=function(e){(0,gr.Z)(r,e);var i=iS(r);function r(){return(0,xt.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:sS,fs:oS});var t=this.shaderModuleService.getModule("blur-pass"),o=t.vs,u=t.fs,l=t.uniforms,p=this.rendererService.getViewportSize(),v=p.width,x=p.height;return{vs:o,fs:u,uniforms:(0,z.Z)((0,z.Z)({},l),{},{u_ViewportSize:[v,x]})}}},{key:"convertOptionsToUniforms",value:function(t){var o={};return(0,St.isNil)(t.bloomRadius)||(o.u_radius=t.bloomRadius),(0,St.isNil)(t.bloomIntensity)||(o.u_intensity=t.bloomIntensity),(0,St.isNil)(t.bloomBaseRadio)||(o.u_baseRadio=t.bloomBaseRadio),o}}]),r}(xh))||$y),Yy,qy;function lS(e){var i=cS();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function cS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fS=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,hS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,pS=(Yy=(0,Qr.b2)(),Yy(qy=function(e){(0,gr.Z)(r,e);var i=lS(r);function r(){return(0,xt.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:hS,fs:fS});var t=this.shaderModuleService.getModule("blur-pass"),o=t.vs,u=t.fs,l=t.uniforms,p=this.rendererService.getViewportSize(),v=p.width,x=p.height;return{vs:o,fs:u,uniforms:(0,z.Z)((0,z.Z)({},l),{},{u_ViewportSize:[v,x]})}}},{key:"convertOptionsToUniforms",value:function(t){var o={};return(0,St.isNil)(t.blurRadius)||(o.u_BlurDir=[t.blurRadius,0]),o}}]),r}(xh))||qy),Ky,Qy;function dS(e){var i=vS();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function vS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mS=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,gS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,yS=(Ky=(0,Qr.b2)(),Ky(Qy=function(e){(0,gr.Z)(r,e);var i=dS(r);function r(){return(0,xt.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:gS,fs:mS});var t=this.shaderModuleService.getModule("blur-pass"),o=t.vs,u=t.fs,l=t.uniforms,p=this.rendererService.getViewportSize(),v=p.width,x=p.height;return{vs:o,fs:u,uniforms:(0,z.Z)((0,z.Z)({},l),{},{u_ViewportSize:[v,x]})}}},{key:"convertOptionsToUniforms",value:function(t){var o={};return(0,St.isNil)(t.blurRadius)||(o.u_BlurDir=[0,t.blurRadius]),o}}]),r}(xh))||Qy),Jy,e_;function _S(e){var i=xS();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function xS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bS=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,ES=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,SS=(Jy=(0,Qr.b2)(),Jy(e_=function(e){(0,gr.Z)(r,e);var i=_S(r);function r(){return(0,xt.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:ES,fs:bS});var t=this.shaderModuleService.getModule("colorhalftone-pass"),o=t.vs,u=t.fs,l=t.uniforms,p=this.rendererService.getViewportSize(),v=p.width,x=p.height;return{vs:o,fs:u,uniforms:(0,z.Z)((0,z.Z)({},l),{},{u_ViewportSize:[v,x]})}}}]),r}(xh))||e_),t_,r_;function wS(e){var i=CS();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function CS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var AS=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,TS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,MS=(t_=(0,Qr.b2)(),t_(r_=function(e){(0,gr.Z)(r,e);var i=wS(r);function r(){return(0,xt.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:TS,fs:AS}),this.shaderModuleService.getModule("copy-pass")}}]),r}(xh))||r_),n_,i_;function kS(e){var i=IS();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function IS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var PS=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,RS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,OS=(n_=(0,Qr.b2)(),n_(i_=function(e){(0,gr.Z)(r,e);var i=kS(r);function r(){return(0,xt.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:RS,fs:PS});var t=this.shaderModuleService.getModule("hexagonalpixelate-pass"),o=t.vs,u=t.fs,l=t.uniforms,p=this.rendererService.getViewportSize(),v=p.width,x=p.height;return{vs:o,fs:u,uniforms:(0,z.Z)((0,z.Z)({},l),{},{u_ViewportSize:[v,x]})}}}]),r}(xh))||i_),a_,o_;function LS(e){var i=DS();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function DS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var FS=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,BS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,NS=(a_=(0,Qr.b2)(),a_(o_=function(e){(0,gr.Z)(r,e);var i=LS(r);function r(){return(0,xt.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:BS,fs:FS});var t=this.shaderModuleService.getModule("ink-pass"),o=t.vs,u=t.fs,l=t.uniforms,p=this.rendererService.getViewportSize(),v=p.width,x=p.height;return{vs:o,fs:u,uniforms:(0,z.Z)((0,z.Z)({},l),{},{u_ViewportSize:[v,x]})}}}]),r}(xh))||o_),s_,u_;function zS(e){var i=ZS();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function ZS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var US=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,VS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,jS=(s_=(0,Qr.b2)(),s_(u_=function(e){(0,gr.Z)(r,e);var i=zS(r);function r(){return(0,xt.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:VS,fs:US}),this.shaderModuleService.getModule("noise-pass")}}]),r}(xh))||u_),l_,c_;function GS(e){var i=HS();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function HS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var WS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,XS=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,$S=(l_=(0,Qr.b2)(),l_(c_=function(e){(0,gr.Z)(r,e);var i=GS(r);function r(){return(0,xt.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:WS,fs:XS}),this.shaderModuleService.getModule("sepia-pass")}}]),r}(xh))||c_),f_,h_,p_,d_,bd,v_,YS=(f_=(0,Qr.b2)(),h_=(0,Qr.f3)(Yt.IRendererService),p_=(0,Qr.zY)(),f_(d_=(bd=function(){function e(){(0,xt.Z)(this,e),ra(this,"rendererService",v_,this),(0,Y.Z)(this,"passes",[]),(0,Y.Z)(this,"readFBO",void 0),(0,Y.Z)(this,"writeFBO",void 0)}return(0,wt.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var r=this.rendererService,n=r.getViewportSize,t=r.createTexture2D,o=n(),u=o.width,l=o.height;return t({x:0,y:0,width:u,height:l,copy:!0})}},{key:"getReadFBOTex",value:function(){var r=this,n=this.rendererService.useFramebuffer;return new Promise(function(t){n(r.readFBO,(0,de.Z)(q().mark(function o(){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:t(r.getCurrentFBOTex());case 1:case"end":return l.stop()}},o)})))})}},{key:"renderBloomPass",value:function(){var i=(0,de.Z)(q().mark(function n(t,o){var u,l;return q().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,this.getReadFBOTex();case 2:u=v.sent,l=0;case 4:if(!(l<4)){v.next=11;break}return v.next=7,o.render(t,u);case 7:this.swap(),l++,v.next=4;break;case 11:case"end":return v.stop()}},n,this)}));function r(n,t){return i.apply(this,arguments)}return r}()},{key:"render",value:function(){var i=(0,de.Z)(q().mark(function n(t){var o,u;return q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:o=0;case 1:if(!(o<this.passes.length)){p.next=15;break}if(u=this.passes[o],u.setRenderToScreen(this.isLastEnabledPass(o)),u.getName()!=="bloom"){p.next=9;break}return p.next=7,this.renderBloomPass(t,u);case 7:p.next=12;break;case 9:return p.next=11,u.render(t);case 11:o!==this.passes.length-1&&this.swap();case 12:o++,p.next=1;break;case 15:case"end":return p.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){this.readFBO.resize({width:r,height:n}),this.writeFBO.resize({width:r,height:n})}},{key:"add",value:function(r,n,t){r.init(n,t),this.passes.push(r)}},{key:"insert",value:function(r,n,t,o){r.init(t,o),this.passes.splice(n,0,r)}},{key:"getPostProcessingPassByName",value:function(r){return this.passes.find(function(n){return n.getName()===r})}},{key:"init",value:function(){var r=this.rendererService,n=r.createFramebuffer,t=r.createTexture2D;this.readFBO=n({color:t({width:1,height:1,wrapS:$.CLAMP_TO_EDGE,wrapT:$.CLAMP_TO_EDGE})}),this.writeFBO=n({color:t({width:1,height:1,wrapS:$.CLAMP_TO_EDGE,wrapT:$.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(r){for(var n=r+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var r=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=r}}]),e}(),v_=na(bd.prototype,"rendererService",[h_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),na(bd.prototype,"init",[p_],Object.getOwnPropertyDescriptor(bd.prototype,"init"),bd.prototype),bd))||d_),m_,g_;function qS(e){var i=KS();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function KS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var QS=(m_=(0,Qr.b2)(),m_(g_=function(e){(0,gr.Z)(r,e);var i=qS(r);function r(){return(0,xt.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getType",value:function(){return Qh.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(t,o){Ra((0,rt.Z)(r.prototype),"init",this).call(this,t,o)}},{key:"render",value:function(t){var o=this.rendererService,u=o.useFramebuffer,l=o.clear,p=t.multiPassRenderer.getPostProcessor().getReadFBO();u(p,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:p}),t.multiPassRenderer.setRenderFlag(!1),t.models.forEach(function(v){v.draw({uniforms:t.layerModel.getUninforms()})}),t.multiPassRenderer.setRenderFlag(!0)})}}]),r}(Jv))||g_),y_,__,x_,bm,b_;function JS(e){var i=ew();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function ew(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tw=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,E_=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,rw=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function S_(e,i){for(var r=0,n=1/i,t=e;t>0;)r=r+n*(t%i),t=Math.floor(t/i),n=n/i;return r}var nw=1,iw=(y_=(0,Qr.b2)(),__=(0,Qr.f3)(Yt.IShaderModuleService),y_(x_=(bm=function(e){(0,gr.Z)(r,e);var i=JS(r);function r(){var n;(0,xt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),ra((0,De.Z)(n),"shaderModuleService",b_,(0,De.Z)(n)),(0,Y.Z)((0,De.Z)(n),"haltonSequence",[]),(0,Y.Z)((0,De.Z)(n),"accumulatingId",0),(0,Y.Z)((0,De.Z)(n),"frame",0),(0,Y.Z)((0,De.Z)(n),"timer",void 0),(0,Y.Z)((0,De.Z)(n),"sampleRenderTarget",void 0),(0,Y.Z)((0,De.Z)(n),"prevRenderTarget",void 0),(0,Y.Z)((0,De.Z)(n),"outputRenderTarget",void 0),(0,Y.Z)((0,De.Z)(n),"copyRenderTarget",void 0),(0,Y.Z)((0,De.Z)(n),"blendModel",void 0),(0,Y.Z)((0,De.Z)(n),"outputModel",void 0),(0,Y.Z)((0,De.Z)(n),"copyModel",void 0),n}return(0,wt.Z)(r,[{key:"getType",value:function(){return Qh.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(t,o){Ra((0,rt.Z)(r.prototype),"init",this).call(this,t,o);var u=this.rendererService,l=u.createFramebuffer,p=u.createTexture2D;this.sampleRenderTarget=l({color:p({width:1,height:1,wrapS:$.CLAMP_TO_EDGE,wrapT:$.CLAMP_TO_EDGE})}),this.prevRenderTarget=l({color:p({width:1,height:1,wrapS:$.CLAMP_TO_EDGE,wrapT:$.CLAMP_TO_EDGE})}),this.outputRenderTarget=l({color:p({width:1,height:1,wrapS:$.CLAMP_TO_EDGE,wrapT:$.CLAMP_TO_EDGE})}),this.copyRenderTarget=l({color:p({width:1,height:1,wrapS:$.CLAMP_TO_EDGE,wrapT:$.CLAMP_TO_EDGE})});for(var v=0;v<30;v++)this.haltonSequence.push([S_(v,2),S_(v,3)]);this.blendModel=this.createTriangleModel("blend-pass",tw),this.outputModel=this.createTriangleModel("copy-pass",E_,{blend:{enable:!0,func:{srcRGB:$.ONE,dstRGB:$.ONE_MINUS_SRC_ALPHA,srcAlpha:$.ONE,dstAlpha:$.ONE_MINUS_SRC_ALPHA},equation:{rgb:$.FUNC_ADD,alpha:$.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",E_)}},{key:"render",value:function(t){var o=this,u=this.rendererService,l=u.clear,p=u.getViewportSize,v=u.useFramebuffer,x=p(),E=x.width,C=x.height;this.sampleRenderTarget.resize({width:E,height:C}),this.prevRenderTarget.resize({width:E,height:C}),this.outputRenderTarget.resize({width:E,height:C}),this.copyRenderTarget.resize({width:E,height:C}),this.resetFrame(),this.stopAccumulating();var T=t.multiPassRenderer.getPostProcessor().getReadFBO();v(T,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:T}),t.multiPassRenderer.setRenderFlag(!1),t.render(),t.multiPassRenderer.setRenderFlag(!0)});var O=function L(B){!o.accumulatingId||B!==o.accumulatingId||o.isFinished()||(o.doRender(t),pa.requestAnimationFrame(function(){L(B)}))};this.accumulatingId=nw++,this.timer=pa.setTimeout(function(){O(o.accumulatingId)},50)}},{key:"doRender",value:function(t){var o=this,u=this.rendererService,l=u.clear,p=u.getViewportSize,v=u.useFramebuffer,x=p(),E=x.width,C=x.height,T=t.getLayerConfig(),O=T.jitterScale,L=O===void 0?1:O,B=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((B[0]*2-1)/E*L,(B[1]*2-1)/C*L),t.multiPassRenderer.setRenderFlag(!1),t.hooks.beforeRender.call(),v(this.sampleRenderTarget,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:o.sampleRenderTarget}),t.render()}),t.hooks.afterRender.call(),t.multiPassRenderer.setRenderFlag(!0);var H=t.getLayerConfig();v(this.outputRenderTarget,function(){o.blendModel.draw({uniforms:{u_opacity:H.opacity||1,u_MixRatio:o.frame===0?1:.9,u_Diffuse1:o.sampleRenderTarget,u_Diffuse2:o.frame===0?t.multiPassRenderer.getPostProcessor().getReadFBO():o.prevRenderTarget}})}),this.frame===0&&l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(v(this.copyRenderTarget,function(){o.outputModel.draw({uniforms:{u_Texture:o.outputRenderTarget}})}),v(t.multiPassRenderer.getPostProcessor().getReadFBO(),function(){o.copyModel.draw({uniforms:{u_Texture:o.copyRenderTarget}})}),t.multiPassRenderer.getPostProcessor().render(t));var oe=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=oe,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,pa.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(t,o,u){this.shaderModuleService.registerModule(t,{vs:rw,fs:o});var l=this.shaderModuleService.getModule(t),p=l.vs,v=l.fs,x=l.uniforms,E=this.rendererService,C=E.createAttribute,T=E.createBuffer,O=E.createModel;return O((0,z.Z)({vs:p,fs:v,attributes:{a_Position:C({buffer:T({data:[-4,-4,4,-4,0,4],type:$.FLOAT}),size:2})},uniforms:(0,z.Z)({},x),depth:{enable:!1},count:3},u))}}]),r}(Jv),b_=na(bm.prototype,"shaderModuleService",[__],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bm))||x_),cv=new Qr.W2;cv.bind(Yt.IGlobalConfigService).to(Dv).inSingletonScope(),(0,Qr.GW)((0,Qr.b2)(),Ns.EventEmitter),cv.bind(Yt.IEventEmitter).to(Ns.EventEmitter);var w_=(0,rl.Z)(cv,!1),Em=function(i){var r=w_.lazyInject(i);return function(n,t,o){r.call(this,n,t),o&&(o.initializer=function(){return n[t]})}},ZP=function(i){var r=w_.lazyMultiInject(i);return function(n,t,o){r.call(this,n,t),o&&(o.initializer=function(){return n[t]})}},Jl=cv,aw=0;function ow(){var e=new Qr.W2;return e.parent=cv,e.bind(Yt.SceneID).toConstantValue("".concat(aw++)),e.bind(Yt.IShaderModuleService).to(WE).inSingletonScope(),e.bind(Yt.ILayerService).to(nE).inSingletonScope(),e.bind(Yt.ISceneService).to(TE).inSingletonScope(),e.bind(Yt.ICameraService).to(Sp).inSingletonScope(),e.bind(Yt.ICoordinateSystemService).to(tm).inSingletonScope(),e.bind(Yt.IInteractionService).to(Hv).inSingletonScope(),e.bind(Yt.IPickingService).to(K2).inSingletonScope(),e.bind(Yt.IControlService).to(cd).inSingletonScope(),e.bind(Yt.IMarkerService).to(Cp).inSingletonScope(),e.bind(Yt.IIconService).to(vr).inSingletonScope(),e.bind(Yt.IFontService).to(xe).inSingletonScope(),e.bind(Yt.IPopupService).to(fd).inSingletonScope(),e.bind(Yt.INormalPass).to(qE).whenTargetNamed("clear"),e.bind(Yt.INormalPass).to(rS).whenTargetNamed("pixelPicking"),e.bind(Yt.INormalPass).to(QS).whenTargetNamed("render"),e.bind(Yt.INormalPass).to(iw).whenTargetNamed("taa"),e.bind(Yt.IFactoryNormalPass).toFactory(function(i){return function(r){return i.container.getNamed(Yt.INormalPass,r)}}),e.bind(Yt.IPostProcessingPass).to(MS).whenTargetNamed("copy"),e.bind(Yt.IPostProcessingPass).to(uS).whenTargetNamed("bloom"),e.bind(Yt.IPostProcessingPass).to(pS).whenTargetNamed("blurH"),e.bind(Yt.IPostProcessingPass).to(yS).whenTargetNamed("blurV"),e.bind(Yt.IPostProcessingPass).to(jS).whenTargetNamed("noise"),e.bind(Yt.IPostProcessingPass).to($S).whenTargetNamed("sepia"),e.bind(Yt.IPostProcessingPass).to(SS).whenTargetNamed("colorHalftone"),e.bind(Yt.IPostProcessingPass).to(OS).whenTargetNamed("hexagonalPixelate"),e.bind(Yt.IPostProcessingPass).to(NS).whenTargetNamed("ink"),e.bind(Yt.IFactoryPostProcessingPass).toFactory(function(i){return function(r){var n=i.container.getNamed(Yt.IPostProcessingPass,r);return n.setName(r),n}}),e}function e0(e){var i=new Qr.W2;return i.parent=e,i.bind(Yt.IStyleAttributeService).to(cE).inSingletonScope(),i.bind(Yt.IMultiPassRenderer).to(JE).inSingletonScope(),i.bind(Yt.IPostProcessor).to(YS).inSingletonScope(),i}var sw=null;function UP(e){return sw.indexOf(e)}var uw=2,VP=4,lw=64,jP=128,cw=256,fw=512,GP=8192,HP=16384,WP=32768,hw=null,C_=131072,XP=262144,pw=524288,$P=1048576,dw=2097152,YP=4194304,vw=8388608,mw=16777216,gw=null;function t0(e,i){return e=clamp(Math.floor(e),0,255),i=clamp(Math.floor(i),0,255),256*e+i}function qP(e){var i=e.color,r=e.radius,n=e.tileX,t=e.tileY,o=e.shape,u=e.opacity,l=e.stroke,p=e.strokeWidth,v=e.strokeOpacity,x=[],E=[],C=[],T=[t0(i[0],i[1]),t0(i[2],i[3])],O=[t0(l[0],l[1]),t0(l[2],l[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(L){var B=_slicedToArray(L,2),H=B[0],oe=B[1];x.push([].concat(T,[(H+1)*vw+(oe+1)*dw+getShapeIndex(o)*C_+r,(n+512)*pw+(t+512)*lw])),E.push([].concat(O,[p,v])),C.push([u,0,0,0])}),{packedBuffer:x,packedBuffer2:E,packedBuffer3:C}}function KP(e,i){if(e===0&&!i)return 0;if(e===1&&i)return 4294967295;var r=i?1:0,n=Math.floor(e*127);return n*gw+r*mw+n*C_+r*hw+n*fw+r*cw+n*uw+r}var lf;(function(e){e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none"})(lf||(lf={}));var uo;(function(e){e.LINEAR="linear",e.SEQUENTIAL="sequential",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat",e.DIVERGING="diverging"})(uo||(uo={}));var Jh;(function(e){e.CONSTANT="constant",e.VARIABLE="variable"})(Jh||(Jh={}));var _n;(function(e){e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform"})(_n||(_n={}));var bh;(function(e){e.IMAGE="image",e.ARRAYBUFFER="arraybuffer",e.RGB="rgb"})(bh||(bh={}));var yw=["mapload","mapchange","mapAfterFrameChange"],Bp={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},r0=["loaded","fontloaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"];function _w(e,i){return Array.isArray(e)?typeof e[0]=="string"?e.map(function(r){return lh(r,i)}):e.map(function(r){return{url:lh(r.url,i),bands:r.bands||[0]}}):lh(e,i)}function xw(e){return typeof e=="string"?[{url:e,bands:[0]}]:typeof e[0]=="string"?e.map(function(i){return{url:i,bands:[0]}}):e}function A_(e,i){e.xhrCancel=function(){i.map(function(r){r.abort()})}}var bw=function(){var e=(0,de.Z)(q().mark(function i(r,n,t,o,u){var l,p,v,x,E,C;return q().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:if(l=xw(n.url),!(l.length>1)){O.next=15;break}return O.next=4,Ew(l,n);case 4:if(p=O.sent,v=p.rasterFiles,x=p.xhrList,E=p.errList,A_(r,x),!(E.length>0)){O.next=12;break}return t(E,null),O.abrupt("return");case 12:Un(v,o,u,t),O.next=17;break;case 15:C=Hs(n,function(L,B){if(L)t(L);else if(B){var H=[{data:B,bands:l[0].bands}];Un(H,o,u,t)}}),A_(r,[C]);case 17:case"end":return O.stop()}},i)}));return function(r,n,t,o,u){return e.apply(this,arguments)}}();function Ew(e,i){return Sm.apply(this,arguments)}function Sm(){return Sm=(0,de.Z)(q().mark(function e(i,r){var n,t,o,u,l,p,v,x,E,C,T;return q().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:n=[],t=[],o=[],u=0;case 4:if(!(u<i.length)){L.next=20;break}return l=i[u],p=(0,z.Z)((0,z.Z)({},r),{},{url:l.url}),v=l.bands,L.next=10,dl((0,z.Z)((0,z.Z)({},p),{},{type:"arrayBuffer"}));case 10:x=L.sent,E=x.err,C=x.data,T=x.xhr,E&&o.push(E),t.push(T),n.push({data:C,bands:v});case 17:u++,L.next=4;break;case 20:return L.abrupt("return",{rasterFiles:n,xhrList:t,errList:o});case 21:case"end":return L.stop()}},e)})),Sm.apply(this,arguments)}var Sw=function(){var e=(0,de.Z)(q().mark(function i(r,n,t,o,u){var l;return q().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return l={url:_w(r,n)},v.abrupt("return",new Promise(function(x,E){bw(t,l,function(C,T){C?E(C):T&&x(T)},o,u)}));case 2:case"end":return v.stop()}},i)}));return function(r,n,t,o,u){return e.apply(this,arguments)}}(),T_=function(){var e=(0,de.Z)(q().mark(function i(r,n,t,o){var u,l;return q().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return l=Array.isArray(r)?r[0]:r,o.wmtsOptions?u=Zd(l,(0,z.Z)((0,z.Z)({},n),o.wmtsOptions)):u=lh(Array.isArray(r)?r[0]:r,n),v.abrupt("return",new Promise(function(x,E){var C=Fo({url:u},function(T,O){T?E(T):O&&x(O)});t.xhrCancel=function(){return C.abort()}}));case 3:case"end":return v.stop()}},i)}));return function(r,n,t,o){return e.apply(this,arguments)}}(),ww=function(){return{rasterData:new Uint8Array([0]),width:1,height:1}},Cw={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,warp:!0},QP=[bh.ARRAYBUFFER,bh.RGB];function Aw(e){return!!(Array.isArray(e)&&e.length===0||!Array.isArray(e)&&typeof e!="string")}function Tw(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(Aw(e))throw new Error("tile server url is error");var r=(i==null?void 0:i.dataType)||bh.IMAGE;r===bh.RGB&&(r=bh.ARRAYBUFFER);var n=function(u,l){switch(r){case bh.IMAGE:return T_(e,u,l,i);case bh.ARRAYBUFFER:return Sw(e,u,l,(i==null?void 0:i.format)||ww,i==null?void 0:i.operation);default:return T_(e,u,l,i)}},t=(0,z.Z)((0,z.Z)((0,z.Z)({},Cw),i),{},{getTileData:n});return{data:e,dataArray:[],tilesetOptions:t,isTile:!0}}var Mw={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0},kw=function(){var e=(0,de.Z)(q().mark(function i(r){return q().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(o){var u=(0,hr.Z)(r.bounds,4),l=u[0],p=u[1],v=u[2],x=u[3],E={layers:{testTile:{features:[{type:"Feature",properties:{key:r.x+"/"+r.y+"/"+r.z,textLng:(l+v)/2,textLat:(p+x)/2},geometry:{type:"LineString",coordinates:[[v,x],[v,p],[l,p],[l,p]]}}]}}};o(E)}));case 1:case"end":return t.stop()}},i)}));return function(r){return e.apply(this,arguments)}}();function Iw(e,i){var r=function(o){return kw(o)},n=(0,z.Z)((0,z.Z)((0,z.Z)({},Mw),i),{},{getTileData:r});return{data:e,dataArray:[],tilesetOptions:n,isTile:!0}}var Pw=K(69848),M_=K.n(Pw);function k_(e,i){var r=i.radius,n=r===void 0?40:r,t=i.maxZoom,o=t===void 0?18:t,u=i.minZoom,l=u===void 0?0:u,p=i.zoom,v=p===void 0?2:p;if(e.pointIndex){var x=e.pointIndex.getClusters(e.extent,Math.floor(v));return e.dataArray=Rw(x),e}var E=new(M_())({radius:n,minZoom:l,maxZoom:o}),C={type:"FeatureCollection",features:[]};return C.features=e.dataArray.map(function(T){return{type:"Feature",geometry:{type:"Point",coordinates:T.coordinates},properties:(0,z.Z)({},T)}}),E.load(C.features),E}function Rw(e){return e.map(function(i,r){return(0,z.Z)({coordinates:i.geometry.coordinates,_id:r+1},i.properties)})}function Ow(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i}function Lw(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i}function I_(e){if(e.length===0)return 0;for(var i=e[0],r=0,n,t=1;t<e.length;t++)n=i+e[t]*1,Math.abs(i)>=Math.abs(e[t])?r+=i-n+e[t]:r+=e[t]-n+i,i=n;return i+r*1}function Dw(e){if(e.length===0)throw new Error("mean requires at least one data point");return I_(e)/e.length}var Fw={min:Lw,max:Ow,mean:Dw,sum:I_};function Bw(e){var i=Nw();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function Nw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function zw(e,i){if(Array.isArray(i))return i}var Zw=function(e){(0,gr.Z)(r,e);var i=Bw(r);function r(n,t){var o;return(0,xt.Z)(this,r),o=i.call(this),(0,Y.Z)((0,De.Z)(o),"type","source"),(0,Y.Z)((0,De.Z)(o),"isTile",!1),(0,Y.Z)((0,De.Z)(o),"inited",!1),(0,Y.Z)((0,De.Z)(o),"hooks",{init:new Ff}),(0,Y.Z)((0,De.Z)(o),"parser",{type:"geojson"}),(0,Y.Z)((0,De.Z)(o),"transforms",[]),(0,Y.Z)((0,De.Z)(o),"cluster",!1),(0,Y.Z)((0,De.Z)(o),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,Y.Z)((0,De.Z)(o),"invalidExtent",!1),(0,Y.Z)((0,De.Z)(o),"dataArrayChanged",!1),(0,Y.Z)((0,De.Z)(o),"cfg",{autoRender:!0}),o.originData=n,o.initCfg(t),o.init().then(function(){o.inited=!0,o.emit("update",{type:"inited"})}),o}return(0,wt.Z)(r,[{key:"getSourceCfg",value:function(){return this.cfg}},{key:"getClusters",value:function(t){return this.clusterIndex.getClusters(this.caculClusterExtent(2),t)}},{key:"getClustersLeaves",value:function(t){return this.clusterIndex.getLeaves(t,Infinity)}},{key:"getParserType",value:function(){return this.parser.type}},{key:"updateClusterData",value:function(t){var o=this,u=this.clusterOptions,l=u.method,p=l===void 0?"sum":l,v=u.field,x=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(t));this.clusterOptions.zoom=t,x.forEach(function(E){E.id||(E.properties.point_count=1)}),(v||(0,St.isFunction)(p))&&(x=x.map(function(E){var C=E.id;if(C){var T=o.clusterIndex.getLeaves(C,Infinity),O=T.map(function(H){return H.properties}),L;if((0,St.isString)(p)&&v){var B=zn(O,v);L=Fw[p](B)}(0,St.isFunction)(p)&&(L=p(O)),E.properties.stat=L}else E.properties.point_count=1;return E})),this.data=se("geojson")({type:"FeatureCollection",features:x}),this.executeTrans()}},{key:"getFeatureById",value:function(t){var o=this.parser,u=o.type,l=u===void 0?"geojson":u,p=o.geometry;if(l==="geojson"&&!this.cluster){var v=t<this.originData.features.length?this.originData.features[t]:"null",x=(0,St.cloneDeep)(v);if(x!=null&&x.properties&&(this.transforms.length!==0||this.dataArrayChanged)){var E=this.data.dataArray.find(function(C){return C._id===t});x.properties=E}return x}else return l==="json"&&p?this.data.dataArray.find(function(C){return C._id===t}):t<this.data.dataArray.length?this.data.dataArray[t]:"null"}},{key:"updateFeaturePropertiesById",value:function(t,o){this.data.dataArray=this.data.dataArray.map(function(u){return u._id===t?(0,z.Z)((0,z.Z)({},u),o):u}),this.dataArrayChanged=!0,this.emit("update",{type:"update"})}},{key:"getFeatureId",value:function(t,o){var u=this.data.dataArray.find(function(l){return l[t]===o});return u==null?void 0:u._id}},{key:"setData",value:function(t,o){var u=this;this.originData=t,this.dataArrayChanged=!1,this.initCfg(o),this.init().then(function(){u.emit("update",{type:"update"})})}},{key:"destroy",value:function(){var t;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,(t=this.tileset)===null||t===void 0||t.destroy()}},{key:"processData",value:function(){var n=(0,de.Z)(q().mark(function o(){var u=this;return q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,new Promise(function(v,x){try{u.excuteParser(),u.initCluster(),u.executeTrans(),v({})}catch(E){x(E)}});case 2:return p.abrupt("return",p.sent);case 3:case"end":return p.stop()}},o)}));function t(){return n.apply(this,arguments)}return t}()},{key:"initCfg",value:function(t){this.cfg=(0,St.mergeWith)(this.cfg,t,zw);var o=this.cfg;o&&(o.parser&&(this.parser=o.parser),o.transforms&&(this.transforms=o.transforms),this.cluster=o.cluster||!1,o.clusterOptions&&(this.cluster=!0,this.clusterOptions=(0,z.Z)((0,z.Z)({},this.clusterOptions),o.clusterOptions)))}},{key:"init",value:function(){var n=(0,de.Z)(q().mark(function o(){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.inited=!1,l.next=3,this.processData();case 3:this.inited=!0;case 4:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"excuteParser",value:function(){var t=this.parser,o=t.type||"geojson",u=se(o);this.data=u(this.originData,t),this.tileset=this.initTileset(),!t.cancelExtent&&(this.extent=Wf(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3])}},{key:"setCenter",value:function(t){this.center=[(t[0]+t[2])/2,(t[1]+t[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var t=this.data.tilesetOptions;if(!!t){if(this.isTile=!0,this.tileset)return this.tileset.updateOptions(t),this.tileset;var o=new jd((0,z.Z)({},t));return o}}},{key:"executeTrans",value:function(){var t=this,o=this.transforms;o.forEach(function(u){var l=u.type,p=_e(l)(t.data,u);Object.assign(t.data,p)})}},{key:"initCluster",value:function(){if(!!this.cluster){var t=this.clusterOptions||{};this.clusterIndex=k_(this.data,t)}}},{key:"caculClusterExtent",value:function(t){var o=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(o=iu(ku(this.extent),t)),o[0].concat(o[1])}}]),r}(Ns.EventEmitter);function Uw(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.filter(r)),e}function P_(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Vw(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function Vw(e,i){if(!!e){if(typeof e=="string")return R_(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return R_(e,i)}}function R_(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var wm=6378e3;function jw(e,i){var r=e.dataArray,n=i.size,t=n===void 0?10:n,o=t/(2*Math.PI*wm)*(256<<20)/2,u=Gw(r,t),l=u.gridHash,p=u.gridOffset,v=$w(l,p,i);return{yOffset:o,xOffset:o,radius:o,type:"grid",dataArray:v}}function Gw(e,i){var r=Infinity,n=-Infinity,t,o=P_(e),u;try{for(o.s();!(u=o.n()).done;){var l=u.value;t=l.coordinates[1],Number.isFinite(t)&&(r=t<r?t:r,n=t>n?t:n)}}catch(le){o.e(le)}finally{o.f()}var p=(r+n)/2,v=Hw(i,p);if(v.xOffset<=0||v.yOffset<=0)return{gridHash:{},gridOffset:v};var x={},E=P_(e),C;try{for(E.s();!(C=E.n()).done;){var T=C.value,O=T.coordinates[1],L=T.coordinates[0];if(Number.isFinite(O)&&Number.isFinite(L)){var B=Math.floor((O+90)/v.yOffset),H=Math.floor((L+180)/v.xOffset),oe="".concat(B,"-").concat(H);x[oe]=x[oe]||{count:0,points:[]},x[oe].count+=1,x[oe].points.push(T)}}}catch(le){E.e(le)}finally{E.f()}return{gridHash:x,gridOffset:v}}function Hw(e,i){var r=Ww(e),n=Xw(i,e);return{yOffset:r,xOffset:n}}function Ww(e){return e/wm*(180/Math.PI)}function Xw(e,i){return i/wm*(180/Math.PI)/Math.cos(e*Math.PI/180)}function $w(e,i,r){return Object.keys(e).reduce(function(n,t,o){var u=t.split("-"),l=parseInt(u[0],10),p=parseInt(u[1],10),v={};if(r.field&&r.method){var x=bf(e[t].points,r.field);v[r.method]=hu[r.method](x)}return Object.assign(v,{_id:o,coordinates:Eo([-180+i.xOffset*(p+.5),-90+i.yOffset*(l+.5)]),rawData:e[t].points,count:e[t].count}),n.push(v),n},[])}var Ed=Math.PI/3,Yw=[0,Ed,2*Ed,3*Ed,4*Ed,5*Ed];function qw(e){return e[0]}function Kw(e){return e[1]}function Qw(){var e=0,i=0,r=1,n=1,t=qw,o=Kw,u,l,p;function v(E){var C={},T=[],O,L=E.length;for(O=0;O<L;++O)if(!(isNaN(H=+t.call(null,B=E[O],O,E))||isNaN(oe=+o.call(null,B,O,E)))){var B,H,oe,le=Math.round(oe=oe/p),Re=Math.round(H=H/l-(le&1)/2),Ne=oe-le;if(Math.abs(Ne)*3>1){var ut=H-Re,Ot=Re+(H<Re?-1:1)/2,Nt=le+(oe<le?-1:1),jt=H-Ot,br=oe-Nt;ut*ut+Ne*Ne>jt*jt+br*br&&(Re=Ot+(le&1?1:-1)/2,le=Nt)}var yr=Re+"-"+le,Ur=C[yr];Ur?Ur.push(B):(T.push(Ur=C[yr]=[B]),Ur.x=(Re+(le&1)/2)*l,Ur.y=le*p)}return T}function x(E){var C=0,T=0;return Yw.map(function(O){var L=Math.sin(O)*E,B=-Math.cos(O)*E,H=L-C,oe=B-T;return C=L,T=B,[H,oe]})}return v.hexagon=function(E){return"m"+x(E==null?u:+E).join("l")+"z"},v.centers=function(){for(var E=[],C=Math.round(i/p),T=Math.round(e/l),O=C*p;O<n+u;O+=p,++C)for(var L=T*l+(C&1)*l/2;L<r+l/2;L+=l)E.push([L,O]);return E},v.mesh=function(){var E=x(u).slice(0,4).join("l");return v.centers().map(function(C){return"M"+C+"m"+E}).join("")},v.x=function(E){return arguments.length?(t=E,v):t},v.y=function(E){return arguments.length?(o=E,v):o},v.radius=function(E){return arguments.length?(u=+E,l=u*2*Math.sin(Ed),p=u*1.5,v):u},v.size=function(E){return arguments.length?(e=i=0,r=+E[0],n=+E[1],v):[r-e,n-i]},v.extent=function(E){return arguments.length?(e=+E[0][0],i=+E[0][1],r=+E[1][0],n=+E[1][1],v):[[e,i],[r,n]]},v.radius(1)}var Jw=6378e3;function eC(e,i){var r=e.dataArray,n=i.size,t=n===void 0?10:n,o=i.method,u=o===void 0?"sum":o,l=t/(2*Math.PI*Jw)*(256<<20)/2,p=r.map(function(C){var T=Eo(C.coordinates),O=(0,hr.Z)(T,2),L=O[0],B=O[1];return(0,z.Z)((0,z.Z)({},C),{},{coordinates:[L,B]})}),v=Qw().radius(l).x(function(C){return C.coordinates[0]}).y(function(C){return C.coordinates[1]}),x=v(p),E={dataArray:x.map(function(C,T){var O;if(i.field&&u){var L=bf(C,i.field);C[u]=hu[u](L)}return O={},(0,Y.Z)(O,i.method,C[u]),(0,Y.Z)(O,"count",C.length),(0,Y.Z)(O,"rawData",C),(0,Y.Z)(O,"coordinates",[C.x,C.y]),(0,Y.Z)(O,"_id",T),O}),radius:l,xOffset:l,yOffset:l,type:"hexagon"};return E}function tC(e,i){var r=i.sourceField,n=i.targetField,t=i.data,o={};return t.forEach(function(u){o[u[r]]=u}),e.dataArray=e.dataArray.map(function(u){var l=u[n];return(0,z.Z)((0,z.Z)({},u),o[l])}),e}function rC(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.map(r)),e}Ye("rasterTile",Tw),Ye("mvt",Nn),Ye("geojsonvt",vt),Ye("testTile",Iw),Ye("geojson",Mn),Ye("image",jr),Ye("csv",lr),Ye("json",nr),Ye("raster",Ma),Ye("rasterRgb",xa),Qe("cluster",k_),Qe("filter",Uw),Qe("join",tC),Qe("map",rC),Qe("grid",jw),Qe("hexagon",eC);var Cm=Zw;function nC(e){var i=iC();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function iC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var O_=function(e){(0,gr.Z)(r,e);var i=nC(r);function r(n){var t;return(0,xt.Z)(this,r),t=i.call(this),(0,Y.Z)((0,De.Z)(t),"added",!1),(0,Y.Z)((0,De.Z)(t),"eventHandle",function(o){t.emit(o.type,{target:o,data:t.markerOption.extData,lngLat:t.lngLat})}),t.markerOption=(0,z.Z)((0,z.Z)({},t.getDefault()),n),I(["update","onMove","onMapClick"],(0,De.Z)(t)),t.init(),t}return(0,wt.Z)(r,[{key:"getMarkerLayerContainerSize",value:function(){}},{key:"getDefault",value:function(){return{element:void 0,anchor:Ge.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(t){this.scene=t,this.mapsService=t.get(Yt.IMapService),this.sceneSerive=t.get(Yt.ISceneService);var o=this.markerOption.element;return this.mapsService.getMarkerContainer().appendChild(o),this.registerMarkerEvent(o),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update)),this.unRegisterMarkerEvent(),this.removeAllListeners();var t=this.markerOption.element;return t&&ks(t),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(t){return this.lngLat=t,Array.isArray(t)&&(this.lngLat={lng:t[0],lat:t[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(t){var o=this;if(!this.added)return this.once("added",function(){o.setElement(t)}),this;var u=this.markerOption.element;return u&&ks(u),this.markerOption.element=t,this.init(),this.mapsService.getMarkerContainer().appendChild(t),this.registerMarkerEvent(t),this.update(),this}},{key:"openPopup",value:function(){var t=this;if(!this.added)return this.once("added",function(){t.openPopup()}),this;var o=this.popup;return o?(o.isOpen()||o.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var t=this;this.added||this.once("added",function(){t.closePopup()});var o=this.popup;return o&&o.remove(),this}},{key:"setPopup",value:function(t){return this.popup=t,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var t=this.popup;if(t)t.isOpen()?t.remove():t.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(t){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(t){this.markerOption.extData=t}},{key:"update",value:function(){if(!!this.mapsService){var t=this.markerOption,o=t.element,u=t.anchor;this.updatePosition(),zl(o,"".concat(ot[u]))}}},{key:"onMapClick",value:function(t){var o=this.markerOption.element;this.popup&&o&&this.togglePopup()}},{key:"getCurrentContainerSize",value:function(){var t=this.mapsService.getContainer();return{containerHeight:(t==null?void 0:t.scrollHeight)||0,containerWidth:(t==null?void 0:t.scrollWidth)||0,bounds:this.mapsService.getBounds()}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var t=this.markerOption,o=t.element,u=t.offsets,l=this.lngLat,p=l.lng,v=l.lat,x=this.mapsService.lngLatToContainer([p,v]);if(o){o.style.display="block",o.style.whiteSpace="nowrap";var E=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize(),C=E.containerHeight,T=E.containerWidth,O=E.bounds;if(!O)return;if(Math.abs(O[0][0])>180||Math.abs(O[1][0])>180){if(x.x>T){var L=this.mapsService.lngLatToContainer([p-360,v]);x.x=L.x}if(x.x<0){var B=this.mapsService.lngLatToContainer([p+360,v]);x.x=B.x}}(x.x>T||x.x<0||x.y>C||x.y<0)&&(o.style.display="none"),o.style.left=x.x+u[0]+"px",o.style.top=x.y-u[1]+"px"}}}},{key:"init",value:function(){var t=this,o=this.markerOption.element,u=this.markerOption,l=u.color,p=u.anchor;if(!o){this.defaultMarker=!0,o=Bi("div"),this.markerOption.element=o;var v=document.createElementNS("http://www.w3.org/2000/svg","svg");v.setAttributeNS(null,"display","block"),v.setAttributeNS(null,"height","48px"),v.setAttributeNS(null,"width","48px"),v.setAttributeNS(null,"viewBox","0 0 1024 1024");var x=document.createElementNS("http://www.w3.org/2000/svg","path");x.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),x.setAttributeNS(null,"fill",l),v.appendChild(x),o.appendChild(v)}Cu(o,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(E){var C,T,O=((C=t.markerOption)===null||C===void 0?void 0:C.style)&&((T=t.markerOption)===null||T===void 0?void 0:T.style[E]);o&&(o.style[E]=O)}),o.addEventListener("click",function(E){t.onMapClick(E)}),o.addEventListener("click",this.eventHandle),Ze(o,p,"marker")}},{key:"registerMarkerEvent",value:function(t){t.addEventListener("mousemove",this.eventHandle),t.addEventListener("click",this.eventHandle),t.addEventListener("mousedown",this.eventHandle),t.addEventListener("mouseup",this.eventHandle),t.addEventListener("dblclick",this.eventHandle),t.addEventListener("contextmenu",this.eventHandle),t.addEventListener("mouseover",this.eventHandle),t.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var t=this.getElement();t.removeEventListener("mousemove",this.eventHandle),t.removeEventListener("click",this.eventHandle),t.removeEventListener("mousedown",this.eventHandle),t.removeEventListener("mouseup",this.eventHandle),t.removeEventListener("dblclick",this.eventHandle),t.removeEventListener("contextmenu",this.eventHandle),t.removeEventListener("mouseover",this.eventHandle),t.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(t){return null}},{key:"onUp",value:function(t){throw new Error("Method not implemented.")}}]),r}(Ns.EventEmitter);function aC(e){var i=oC();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function oC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var JP=function(e){(0,gr.Z)(r,e);var i=aC(r);function r(n){var t,o;return(0,xt.Z)(this,r),o=i.call(this),(0,Y.Z)((0,De.Z)(o),"markers",[]),(0,Y.Z)((0,De.Z)(o),"points",[]),(0,Y.Z)((0,De.Z)(o),"clusterMarkers",[]),o.markerLayerOption=(0,St.merge)(o.getDefault(),n),I(["update"],(0,De.Z)(o)),o.zoom=((t=o.markerLayerOption.clusterOption)===null||t===void 0?void 0:t.zoom)||-99,o}return(0,wt.Z)(r,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(t){return this.scene=t,this.mapsService=t.get(Yt.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.mapsService.on("camerachange",this.setContainerSize.bind(this)),this.mapsService.on("viewchange",this.setContainerSize.bind(this)),this.addMarkers(),this.inited=!0,this}},{key:"setContainerSize",value:function(){if(!!this.mapsService){var t=this.mapsService.getContainer();this.containerSize={containerWidth:(t==null?void 0:t.scrollWidth)||0,containerHeight:(t==null?void 0:t.scrollHeight)||0,bounds:this.mapsService.getBounds()}}}},{key:"getContainerSize",value:function(){return this.containerSize}},{key:"addMarker",value:function(t){var o=this.markerLayerOption.cluster;if(t.getMarkerLayerContainerSize=this.getContainerSize.bind(this),o&&(this.addPoint(t,this.markers.length),this.mapsService)){var u=this.mapsService.getZoom(),l=this.mapsService.getBounds();this.bbox=iu(l,.5),this.zoom=Math.floor(u),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(t)}},{key:"removeMarker",value:function(t){this.markers.indexOf(t);var o=this.markers.indexOf(t);o>-1&&this.markers.splice(o,1)}},{key:"hide",value:function(){this.markers.map(function(t){t.getElement().style.opacity="0"}),this.clusterMarkers.map(function(t){t.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(t){t.getElement().style.opacity="1"}),this.clusterMarkers.map(function(t){t.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var t=this.markerLayerOption.cluster;return t?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var t=this;this.getMarkers().forEach(function(o){o.addTo(t.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(t){t.remove()}),this.clusterMarkers.forEach(function(t){t.remove()}),this.markers=[],this.points=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners(),this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("camerachange",this.setContainerSize.bind(this)),this.mapsService.off("viewchange",this.setContainerSize.bind(this))}},{key:"addPoint",value:function(t,o){var u=t.getLnglat(),l=u.lng,p=u.lat,v={geometry:{type:"Point",coordinates:[l,p]},properties:(0,z.Z)((0,z.Z)({},t.getExtData()),{},{marker_id:o})};this.points.push(v),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var t=this.markerLayerOption.clusterOption,o=t.radius,u=t.minZoom,l=u===void 0?0:u,p=t.maxZoom;this.clusterIndex=new(M_())({radius:o,minZoom:l,maxZoom:p}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(t,o){var u=this,l=t[0].concat(t[1]),p=this.clusterIndex.getClusters(l,o);this.clusterMarkers.forEach(function(v){v.remove()}),this.clusterMarkers=[],p.forEach(function(v){var x,E=u.markerLayerOption.clusterOption,C=E.field,T=E.method;if((x=v.properties)!==null&&x!==void 0&&x.cluster_id){var O,L=u.getLeaves((O=v.properties)===null||O===void 0?void 0:O.cluster_id);if(v.properties.clusterData=L,C&&T){var B=L==null?void 0:L.map(function(Ne){var ut=(0,Y.Z)({},C,Ne.properties[C]);return ut}),H=bf(B,C),oe=Uc(T,H),le="point_"+T;v.properties[le]=oe.toFixed(2)}}var Re=u.clusterMarker(v);u.clusterMarkers.push(Re),Re.addTo(u.scene)})}},{key:"getLeaves",value:function(t){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return t?this.clusterIndex.getLeaves(t,o,u):null}},{key:"clusterMarker",value:function(t){var o=this.markerLayerOption.clusterOption,u=o,l=u.element,p=l===void 0?this.generateElement.bind(this):l,v=new O_({element:p(t)}).setLnglat({lng:t.geometry.coordinates[0],lat:t.geometry.coordinates[1]});return v}},{key:"normalMarker",value:function(t){var o=t.properties.marker_id;return this.markers[o]}},{key:"update",value:function(){if(!!this.mapsService&&this.markers.length!==0){var t=this.mapsService.getZoom(),o=this.mapsService.getBounds();(!this.bbox||Math.abs(t-this.zoom)>=1||!vc(this.bbox,o))&&(this.bbox=iu(o,.5),this.zoom=Math.floor(t),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(t){var o=Bi("div","l7-marker-cluster"),u=Bi("div","",o),l=Bi("span","",u),p=this.markerLayerOption.clusterOption,v=p.field,x=p.method;t.properties.point_count=t.properties.point_count||1;var E=v&&x?t.properties["point_"+x]||t.properties[v]:t.properties.point_count;return l.textContent=E,o}}]),r}(Ns.EventEmitter),eR=K(4157);function sC(e){var i=uC();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function uC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Sd=function(e){(0,gr.Z)(r,e);var i=sC(r);function r(n){var t;return(0,xt.Z)(this,r),t=i.call(this),r.controlCount++,t.controlOption=(0,z.Z)((0,z.Z)({},t.getDefault(n)),n||{}),t}return(0,wt.Z)(r,[{key:"getOptions",value:function(){return this.controlOption}},{key:"setOptions",value:function(t){var o=this.getDefault(t);Object.entries(t).forEach(function(u){var l=(0,hr.Z)(u,2),p=l[0],v=l[1];v===void 0&&(t[p]=o[p])}),"position"in t&&this.setPosition(t.position),"className"in t&&this.setClassName(t.className),"style"in t&&this.setStyle(t.style),this.controlOption=(0,z.Z)((0,z.Z)({},this.controlOption),t)}},{key:"addTo",value:function(t){this.mapsService=t.get(Yt.IMapService),this.renderService=t.get(Yt.IRendererService),this.layerService=t.get(Yt.ILayerService),this.controlService=t.get(Yt.IControlService),this.configService=t.get(Yt.IGlobalConfigService),this.scene=t.get(Yt.ISceneService),this.sceneContainer=t,this.isShow=!0,this.container=this.onAdd(),Cu(this.container,"l7-control");var o=this.controlOption,u=o.className,l=o.style;return u&&this.setClassName(u),l&&this.setStyle(l),this.insertContainer(),this.emit("add",this),this}},{key:"remove",value:function(){if(!this.mapsService)return this;ks(this.container),this.onRemove(),this.emit("remove",this)}},{key:"onAdd",value:function(){return Bi("div")}},{key:"onRemove",value:function(){}},{key:"show",value:function(){var t=this.container;Nl(t,"l7-control--hide"),this.isShow=!0,this.emit("show",this)}},{key:"hide",value:function(){var t=this.container;Cu(t,"l7-control--hide"),this.isShow=!1,this.emit("hide",this)}},{key:"getDefault",value:function(t){return{position:Wu.TOPRIGHT,name:"".concat(r.controlCount)}}},{key:"getContainer",value:function(){return this.container}},{key:"getIsShow",value:function(){return this.isShow}},{key:"_refocusOnMap",value:function(t){if(this.mapsService&&t&&t.screenX>0&&t.screenY>0){var o=this.mapsService.getContainer();o!==null&&o.focus()}}},{key:"setPosition",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Wu.TOPLEFT,o=this.controlService;return o&&o.removeControl(this),this.controlOption.position=t,o&&o.addControl(this,this.sceneContainer),this}},{key:"setClassName",value:function(t){var o=this.container,u=this.controlOption.className;u&&Nl(o,u),t&&Cu(o,t)}},{key:"setStyle",value:function(t){var o=this.container;t?o.setAttribute("style",t):o.removeAttribute("style")}},{key:"insertContainer",value:function(){var t=this.controlOption.position,o=this.container;if(t instanceof Element)t.appendChild(o);else{var u=this.controlService.controlCorners[t];t.indexOf("bottom")!==-1?u.insertBefore(o,u.firstChild):u.appendChild(o)}}},{key:"checkUpdateOption",value:function(t,o){return o.some(function(u){return u in t})}}]),r}(dp());(0,Y.Z)(Sd,"controlCount",0);function lC(e){var i=cC();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function cC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var n0=function(e){(0,gr.Z)(r,e);var i=lC(r);function r(){var n;(0,xt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,De.Z)(n),"isDisable",!1),n}return(0,wt.Z)(r,[{key:"setIsDisable",value:function(t){if(this.isDisable=t,t){var o;(o=this.button)===null||o===void 0||o.setAttribute("disabled","true")}else{var u;(u=this.button)===null||u===void 0||u.removeAttribute("disabled")}}},{key:"createButton",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return Bi("button","l7-button-control ".concat(t))}},{key:"onAdd",value:function(){this.button=this.createButton(),this.isDisable=!1;var t=this.controlOption,o=t.title,u=t.btnText,l=t.btnIcon;return this.setBtnTitle(o),this.setBtnText(u),this.setBtnIcon(l),this.button}},{key:"onRemove",value:function(){this.button=this.buttonIcon=this.buttonText=void 0,this.isDisable=!1}},{key:"setOptions",value:function(t){var o=t.title,u=t.btnText,l=t.btnIcon;this.checkUpdateOption(t,["title"])&&this.setBtnTitle(o),this.checkUpdateOption(t,["btnIcon"])&&this.setBtnIcon(l),this.checkUpdateOption(t,["btnText"])&&this.setBtnText(u),Ra((0,rt.Z)(r.prototype),"setOptions",this).call(this,t)}},{key:"setBtnTitle",value:function(t){var o;(o=this.button)===null||o===void 0||o.setAttribute("title",t!=null?t:"")}},{key:"setBtnIcon",value:function(t){if(this.buttonIcon&&ks(this.buttonIcon),t){var o,u=(o=this.button)===null||o===void 0?void 0:o.firstChild;if(u){var l;(l=this.button)===null||l===void 0||l.insertBefore(t,u)}else{var p;(p=this.button)===null||p===void 0||p.appendChild(t)}this.buttonIcon=t}}},{key:"setBtnText",value:function(t){if(!!this.button)if(Nl(this.button,"l7-button-control--row"),Nl(this.button,"l7-button-control--column"),t){var o=this.buttonText;if(!o){var u;o=Bi("div","l7-button-control__text"),(u=this.button)===null||u===void 0||u.appendChild(o),this.buttonText=o}o.innerText=t,Cu(this.button,this.controlOption.vertical?"l7-button-control--column":"l7-button-control--row")}else!t&&this.buttonText&&(ks(this.buttonText),this.buttonText=void 0)}}]),r}(Sd);function fC(e){var i=hC();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function hC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var L_=function(e){(0,gr.Z)(r,e);var i=fC(r);function r(n,t){var o;return(0,xt.Z)(this,r),o=i.call(this),(0,Y.Z)((0,De.Z)(o),"isShow",!1),(0,Y.Z)((0,De.Z)(o),"timeout",null),(0,Y.Z)((0,De.Z)(o),"show",function(){return o.isShow||!o.contentDOM.innerHTML||(o.resetPopperPosition(),Nl(o.popperDOM,"l7-popper-hide"),o.isShow=!0,o.option.unique&&r.conflictPopperList.forEach(function(u){u!==(0,De.Z)(o)&&u.isShow&&u.hide()}),o.emit("show")),(0,De.Z)(o)}),(0,Y.Z)((0,De.Z)(o),"hide",function(){return o.isShow&&(Cu(o.popperDOM,"l7-popper-hide"),o.isShow=!1,o.emit("hide")),(0,De.Z)(o)}),(0,Y.Z)((0,De.Z)(o),"setHideTimeout",function(){o.timeout||(o.timeout=window.setTimeout(function(){!o.isShow||(o.hide(),o.timeout=null)},300))}),(0,Y.Z)((0,De.Z)(o),"clearHideTimeout",function(){o.timeout&&(window.clearTimeout(o.timeout),o.timeout=null)}),(0,Y.Z)((0,De.Z)(o),"onBtnClick",function(){o.isShow?o.hide():o.show()}),(0,Y.Z)((0,De.Z)(o),"onBtnMouseLeave",function(){o.setHideTimeout()}),(0,Y.Z)((0,De.Z)(o),"onBtnMouseMove",function(){o.clearHideTimeout(),!o.isShow&&o.show()}),o.button=n,o.option=t,o.init(),t.unique&&r.conflictPopperList.push((0,De.Z)(o)),o}return(0,wt.Z)(r,[{key:"buttonRect",get:function(){return this.button.getBoundingClientRect()}},{key:"getPopperDOM",value:function(){return this.popperDOM}},{key:"getIsShow",value:function(){return this.isShow}},{key:"getContent",value:function(){return this.content}},{key:"setContent",value:function(t){typeof t=="string"?this.contentDOM.innerHTML=t:t instanceof HTMLElement&&(Zl(this.contentDOM),this.contentDOM.appendChild(t)),this.content=t}},{key:"init",value:function(){var t=this.option.trigger;this.popperDOM=this.createPopper(),t==="click"?this.button.addEventListener("click",this.onBtnClick):(this.button.addEventListener("mousemove",this.onBtnMouseMove),this.button.addEventListener("mouseleave",this.onBtnMouseLeave),this.popperDOM.addEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.addEventListener("mouseleave",this.onBtnMouseLeave))}},{key:"destroy",value:function(){this.button.removeEventListener("click",this.onBtnClick),this.button.removeEventListener("mousemove",this.onBtnMouseMove),this.button.removeEventListener("mousemove",this.onBtnMouseLeave),this.popperDOM.removeEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.removeEventListener("mouseleave",this.onBtnMouseLeave),ks(this.popperDOM)}},{key:"resetPopperPosition",value:function(){var t={},o=this.option,u=o.container,l=o.offset,p=l===void 0?[0,0]:l,v=o.placement,x=(0,hr.Z)(p,2),E=x[0],C=x[1],T=this.button.getBoundingClientRect(),O=u.getBoundingClientRect(),L=vn(T,O),B=L.left,H=L.right,oe=L.top,le=L.bottom,Re=!1,Ne=!1;/^(left|right)/.test(v)?(v.includes("left")?t.right="".concat(T.width+H,"px"):v.includes("right")&&(t.left="".concat(T.width+B,"px")),v.includes("start")?t.top="".concat(oe,"px"):v.includes("end")?t.bottom="".concat(le,"px"):(t.top="".concat(oe+T.height/2,"px"),Ne=!0,t.transform="translate(".concat(E,"px, calc(").concat(C,"px - 50%))"))):/^(top|bottom)/.test(v)&&(v.includes("top")?t.bottom="".concat(T.height+le,"px"):v.includes("bottom")&&(t.top="".concat(T.height+oe,"px")),v.includes("start")?t.left="".concat(B,"px"):v.includes("end")?t.right="".concat(H,"px"):(t.left="".concat(B+T.width/2,"px"),Re=!0,t.transform="translate(calc(".concat(E,"px - 50%), ").concat(C,"px)"))),t.transform="translate(calc(".concat(E,"px - ").concat(Re?"50%":"0%","), calc(").concat(C,"px - ").concat(Ne?"50%":"0%",")");var ut=v.split("-");ut.length&&Cu(this.popperDOM,ut.map(function(Ot){return"l7-popper-".concat(Ot)}).join(" ")),pl(this.popperDOM,xf(t))}},{key:"createPopper",value:function(){var t=this.option,o=t.container,u=t.className,l=u===void 0?"":u,p=t.content,v=Bi("div","l7-popper l7-popper-hide ".concat(l)),x=Bi("div","l7-popper-content"),E=Bi("div","l7-popper-arrow");return v.appendChild(x),v.appendChild(E),o.appendChild(v),this.popperDOM=v,this.contentDOM=x,p&&this.setContent(p),v}}]),r}(Ns.EventEmitter);(0,Y.Z)(L_,"conflictPopperList",[]);function pC(e){var i=dC();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function dC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vC={topleft:"right-start",topcenter:"bottom",topright:"left-start",bottomleft:"right-end",bottomcenter:"top",bottomright:"left-end",lefttop:"bottom-start",leftcenter:"right",leftbottom:"top-start",righttop:"bottom-end",rightcenter:"left",rightbottom:"top-end"},mC=function(e){(0,gr.Z)(r,e);var i=pC(r);function r(){return(0,xt.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getPopper",value:function(){return this.popper}},{key:"hide",value:function(){this.popper.hide(),Ra((0,rt.Z)(r.prototype),"hide",this).call(this)}},{key:"getDefault",value:function(t){var o,u=Ra((0,rt.Z)(r.prototype),"getDefault",this).call(this,t),l=(o=t==null?void 0:t.position)!==null&&o!==void 0?o:u.position;return(0,z.Z)((0,z.Z)({},Ra((0,rt.Z)(r.prototype),"getDefault",this).call(this,t)),{},{popperPlacement:l instanceof Element?"bottom":vC[l],popperTrigger:"click"})}},{key:"onAdd",value:function(){var t=Ra((0,rt.Z)(r.prototype),"onAdd",this).call(this);return this.initPopper(),t}},{key:"onRemove",value:function(){this.popper.destroy()}},{key:"initPopper",value:function(){var t=this,o=this.controlOption,u=o.popperClassName,l=o.popperPlacement,p=o.popperTrigger,v=this.mapsService.getMapContainer();return this.popper=new L_(this.button,{className:u,placement:l,trigger:p,container:v,unique:!0}),this.popper.on("show",function(){t.emit("popperShow",t)}).on("hide",function(){t.emit("popperHide",t)}),this.popper}},{key:"setOptions",value:function(t){if(Ra((0,rt.Z)(r.prototype),"setOptions",this).call(this,t),this.checkUpdateOption(t,["popperPlacement","popperTrigger","popperClassName"])){var o=this.popper.getContent();this.popper.destroy(),this.initPopper(),this.popper.setContent(o)}}}]),r}(n0);function gC(e){var i=yC();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function yC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Eh;(function(e){e.ActiveOptionClassName="l7-select-control-item-active",e.OptionValueAttrKey="data-option-value",e.OptionIndexAttrKey="data-option-index"})(Eh||(Eh={}));var D_=function(e){(0,gr.Z)(r,e);var i=gC(r);function r(){var n;(0,xt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,De.Z)(n),"selectValue",[]),(0,Y.Z)((0,De.Z)(n),"createNormalOption",function(l){var p=n.selectValue.includes(l.value),v=Bi("div","l7-select-control-item ".concat(p?Eh.ActiveOptionClassName:""));n.getIsMultiple()&&v.appendChild(n.createCheckbox(p)),l.icon&&v.appendChild(l.icon);var x=Bi("span");return x.innerText=l.text,v.appendChild(x),v}),(0,Y.Z)((0,De.Z)(n),"onItemClick",function(l){if(n.getIsMultiple()){var p=n.selectValue.findIndex(function(v){return v===l.value});p>-1?n.selectValue.splice(p,1):n.selectValue=[].concat((0,N.Z)(n.selectValue),[l.value])}else n.selectValue=[l.value];n.setSelectValue(n.selectValue)}),n}return(0,wt.Z)(r,[{key:"setOptions",value:function(t){Ra((0,rt.Z)(r.prototype),"setOptions",this).call(this,t);var o=t.options;o&&this.popper.setContent(this.getPopperContent(o))}},{key:"onAdd",value:function(){var t=Ra((0,rt.Z)(r.prototype),"onAdd",this).call(this),o=this.controlOption.defaultValue;return o&&(this.selectValue=this.transSelectValue(o)),this.popper.setContent(this.getPopperContent(this.controlOption.options)),t}},{key:"getSelectValue",value:function(){return this.getIsMultiple()?this.selectValue:this.selectValue[0]}},{key:"setSelectValue",value:function(t){var o=this,u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,l=this.transSelectValue(t);this.optionDOMList.forEach(function(p){var v=p.getAttribute(Eh.OptionValueAttrKey),x=o.getIsMultiple()?p.querySelector("input[type=checkbox]"):void 0;l.includes(v)?(Cu(p,Eh.ActiveOptionClassName),x&&cc(x,!0)):(Nl(p,Eh.ActiveOptionClassName),x&&cc(x,!1))}),this.selectValue=l,u&&this.emit("selectChange",this.getIsMultiple()?l:l[0])}},{key:"getIsMultiple",value:function(){return!1}},{key:"getPopperContent",value:function(t){var o=this,u=this.isImageOptions(),l=Bi("div",u?"l7-select-control--image":"l7-select-control--normal");this.getIsMultiple()&&Cu(l,"l7-select-control--multiple");var p=t.map(function(v,x){var E=u?o.createImageOption(v):o.createNormalOption(v);return E.setAttribute(Eh.OptionValueAttrKey,v.value),E.setAttribute(Eh.OptionIndexAttrKey,window.String(x)),E.addEventListener("click",o.onItemClick.bind(o,v)),E});return l.append.apply(l,(0,N.Z)(p)),this.optionDOMList=p,l}},{key:"createImageOption",value:function(t){var o=this.selectValue.includes(t.value),u=Bi("div","l7-select-control-item ".concat(o?Eh.ActiveOptionClassName:"")),l=Bi("img");l.setAttribute("src",t.img),Ku(l),u.appendChild(l);var p=Bi("div","l7-select-control-item-row");this.getIsMultiple()&&u.appendChild(this.createCheckbox(o));var v=Bi("span");return v.innerText=t.text,p.appendChild(v),u.appendChild(p),u}},{key:"createCheckbox",value:function(t){var o=Bi("input");return o.setAttribute("type","checkbox"),t&&cc(o,!0),o}},{key:"isImageOptions",value:function(){return!!this.controlOption.options.find(function(t){return t.img})}},{key:"transSelectValue",value:function(t){return Array.isArray(t)?t:[t]}}]),r}(mC);function _C(e){var i=xC();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function xC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var F_=function(e){(0,gr.Z)(r,e);var i=_C(r);function r(){return(0,xt.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getDefault",value:function(){return{position:Wu.BOTTOMLEFT,name:"logo",href:"https://l7.antv.vision/",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*GRb1TKp4HcMAAAAAAAAAAAAAARQnAQ"}}},{key:"onAdd",value:function(){var t=Bi("div","l7-control-logo");return this.setLogoContent(t),t}},{key:"onRemove",value:function(){return null}},{key:"setOptions",value:function(t){Ra((0,rt.Z)(r.prototype),"setOptions",this).call(this,t),this.checkUpdateOption(t,["img","href"])&&(Zl(this.container),this.setLogoContent(this.container))}},{key:"setLogoContent",value:function(t){var o=this.controlOption,u=o.href,l=o.img,p=Bi("img");if(p.setAttribute("src",l),p.setAttribute("aria-label","AntV logo"),Ku(p),u){var v=Bi("a","l7-control-logo-link");v.target="_blank",v.href=u,v.rel="noopener nofollow",v.setAttribute("rel","noopener nofollow"),v.appendChild(p),t.appendChild(v)}else t.appendChild(p)}}]),r}(Sd),Sh=function(i){var r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.classList.add("l7-iconfont"),r.setAttribute("aria-hidden","true");var n=document.createElementNS("http://www.w3.org/2000/svg","use");return n.setAttributeNS("http://www.w3.org/1999/xlink","href","#".concat(i)),r.appendChild(n),r};function B_(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=bC(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function bC(e,i){if(!!e){if(typeof e=="string")return N_(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return N_(e,i)}}function N_(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var z_=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],wh=function(){if(typeof document=="undefined")return!1;var e=z_[0],i={},r=B_(z_),n;try{for(r.s();!(n=r.n()).done;){var t=n.value,o=t==null?void 0:t[1];if(o in document){var u=B_(t.entries()),l;try{for(u.s();!(l=u.n()).done;){var p=(0,hr.Z)(l.value,2),v=p[0],x=p[1];i[e[v]]=x}}catch(E){u.e(E)}finally{u.f()}return i}}}catch(E){r.e(E)}finally{r.f()}return!1}(),Z_={change:wh.fullscreenchange,error:wh.fullscreenerror},ec={request:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:document.documentElement,r=arguments.length>1?arguments[1]:void 0;return new Promise(function(n,t){var o=function l(){ec.off("change",l),n()};ec.on("change",o);var u=i[wh.requestFullscreen](r);u instanceof Promise&&u.then(o).catch(t)})},exit:function(){return new Promise(function(i,r){if(!ec.isFullscreen){i();return}var n=function o(){ec.off("change",o),i()};ec.on("change",n);var t=document[wh.exitFullscreen]();t instanceof Promise&&t.then(n).catch(r)})},toggle:function(i,r){return ec.isFullscreen?ec.exit():ec.request(i,r)},onchange:function(i){ec.on("change",i)},onerror:function(i){ec.on("error",i)},on:function(i,r){var n=Z_[i];n&&document.addEventListener(n,r,!1)},off:function(i,r){var n=Z_[i];n&&document.removeEventListener(n,r,!1)},raw:wh};Object.defineProperties(ec,{isFullscreen:{get:function(){return Boolean(document[wh.fullscreenElement])}},element:{enumerable:!0,get:function(){var i;return(i=document[wh.fullscreenElement])!==null&&i!==void 0?i:void 0}},isEnabled:{enumerable:!0,get:function(){return Boolean(document[wh.fullscreenEnabled])}}}),wh||(ec={isEnabled:!1});var Am=ec;function EC(e){var i=SC();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function SC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wC=function(e){(0,gr.Z)(r,e);var i=EC(r);function r(n){var t;return(0,xt.Z)(this,r),t=i.call(this,n),(0,Y.Z)((0,De.Z)(t),"isFullscreen",!1),(0,Y.Z)((0,De.Z)(t),"toggleFullscreen",(0,de.Z)(q().mark(function o(){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!Am.isEnabled){l.next=3;break}return l.next=3,Am.toggle(t.mapContainer);case 3:case"end":return l.stop()}},o)}))),(0,Y.Z)((0,De.Z)(t),"onClick",function(){t.toggleFullscreen()}),(0,Y.Z)((0,De.Z)(t),"onFullscreenChange",function(){t.isFullscreen=!!document.fullscreenElement;var o=t.controlOption,u=o.btnText,l=o.btnIcon,p=o.title,v=o.exitBtnText,x=o.exitBtnIcon,E=o.exitTitle;t.isFullscreen?(t.setBtnTitle(E),t.setBtnText(v),t.setBtnIcon(x)):(t.setBtnTitle(p),t.setBtnText(u),t.setBtnIcon(l)),t.emit("fullscreenChange",t.isFullscreen)}),Am.isEnabled||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u5BF9\u5730\u56FE\u5168\u5C4F\u5316"),t}return(0,wt.Z)(r,[{key:"setOptions",value:function(t){var o=t.exitBtnText,u=t.exitBtnIcon,l=t.exitTitle;this.isFullscreen&&(this.checkUpdateOption(t,["exitBtnIcon"])&&this.setBtnIcon(u),this.checkUpdateOption(t,["exitBtnText"])&&this.setBtnText(o),this.checkUpdateOption(t,["exitTitle"])&&this.setBtnTitle(l)),Ra((0,rt.Z)(r.prototype),"setOptions",this).call(this,t)}},{key:"onAdd",value:function(){var t=Ra((0,rt.Z)(r.prototype),"onAdd",this).call(this);return t.addEventListener("click",this.onClick),this.mapContainer=Gi(this.scene.getSceneConfig().id),this.mapContainer.addEventListener("fullscreenchange",this.onFullscreenChange),t}},{key:"onRemove",value:function(){Ra((0,rt.Z)(r.prototype),"onRemove",this).call(this),this.mapContainer.removeEventListener("fullscreenchange",this.onFullscreenChange)}},{key:"getDefault",value:function(t){return(0,z.Z)((0,z.Z)({},Ra((0,rt.Z)(r.prototype),"getDefault",this).call(this,t)),{},{title:"\u5168\u5C4F",btnIcon:Sh("l7-icon-fullscreen"),exitTitle:"\u9000\u51FA\u5168\u5C4F",exitBtnIcon:Sh("l7-icon-exit-fullscreen")})}}]),r}(n0);function CC(e){var i=AC();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function AC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var TC=function(e){(0,gr.Z)(r,e);var i=CC(r);function r(){var n;(0,xt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,De.Z)(n),"onClick",(0,de.Z)(q().mark(function l(){var p;return q().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(p=n.controlOption.onExport,p!=null){x.next=5;break}x.next=10;break;case 5:return x.t0=p,x.next=8,n.getImage();case 8:x.t1=x.sent,(0,x.t0)(x.t1);case 10:case"end":return x.stop()}},l)}))),(0,Y.Z)((0,De.Z)(n),"mergeImage",(0,de.Z)(q().mark(function l(){var p,v,x,E,C,T,O,L,B,H,oe,le,Re,Ne,ut=arguments;return q().wrap(function(Nt){for(;;)switch(Nt.prev=Nt.next){case 0:for(x=n.controlOption.imageType,E=(p=(v=n.mapsService.getContainer())===null||v===void 0?void 0:v.getBoundingClientRect())!==null&&p!==void 0?p:{},C=E.width,T=C===void 0?0:C,O=E.height,L=O===void 0?0:O,B=document.createElement("canvas"),B.width=T,B.height=L,H=B.getContext("2d"),oe=ut.length,le=new Array(oe),Re=0;Re<oe;Re++)le[Re]=ut[Re];return Nt.next=9,Promise.all(le.map(function(jt){return new Promise(function(br){var yr=new Image;yr.onload=function(){br(yr)},yr.src=jt})}));case 9:return Ne=Nt.sent,Ne.forEach(function(jt){H==null||H.drawImage(jt,0,0,T,L)}),Nt.abrupt("return",B.toDataURL("image/".concat(x)));case 12:case"end":return Nt.stop()}},l)}))),n}return(0,wt.Z)(r,[{key:"onAdd",value:function(){var t=Ra((0,rt.Z)(r.prototype),"onAdd",this).call(this);return t.addEventListener("click",this.onClick),t}},{key:"getDefault",value:function(t){return(0,z.Z)((0,z.Z)({},Ra((0,rt.Z)(r.prototype),"getDefault",this).call(this,t)),{},{title:"\u5BFC\u51FA\u56FE\u7247",btnIcon:Sh("l7-icon-export-picture"),imageType:"png"})}},{key:"getImage",value:function(){var t=this.mapsService.exportMap("png"),o=this.scene.exportPng("png");return this.mergeImage(t,o)}}]),r}(n0);function MC(e){var i=kC();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function kC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var IC=function(e){(0,gr.Z)(r,e);var i=MC(r);function r(n){var t;return(0,xt.Z)(this,r),t=i.call(this,n),(0,Y.Z)((0,De.Z)(t),"getGeoLocation",function(){return new Promise(function(o,u){window.navigator.geolocation.getCurrentPosition(function(l){var p=l.coords,v=p!=null?p:{},x=v.longitude,E=v.latitude;!(0,St.isNaN)(x)&&!(0,St.isNaN)(E)?o([x,E]):u()},function(l){u(l)})})}),(0,Y.Z)((0,De.Z)(t),"onClick",(0,de.Z)(q().mark(function o(){var u,l,p;return q().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(window.navigator.geolocation){x.next=2;break}return x.abrupt("return");case 2:return u=t.controlOption.transform,x.next=5,t.getGeoLocation();case 5:if(l=x.sent,p=t.mapsService.getZoom(),x.t0=t.mapsService,x.t1=p>15?p:15,!u){x.next=15;break}return x.next=12,u(l);case 12:x.t2=x.sent,x.next=16;break;case 15:x.t2=l;case 16:x.t3=x.t2,x.t0.setZoomAndCenter.call(x.t0,x.t1,x.t3);case 18:case"end":return x.stop()}},o)}))),window.navigator.geolocation||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u83B7\u53D6\u5730\u7406\u5B9A\u4F4D"),t}return(0,wt.Z)(r,[{key:"getDefault",value:function(t){return(0,z.Z)((0,z.Z)({},Ra((0,rt.Z)(r.prototype),"getDefault",this).call(this,t)),{},{title:"\u5B9A\u4F4D",btnIcon:Sh("l7-icon-reposition")})}},{key:"onAdd",value:function(){var t=Ra((0,rt.Z)(r.prototype),"onAdd",this).call(this);return t.addEventListener("click",this.onClick),t}}]),r}(n0),PC={normal:{text:"\u6807\u51C6",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-nqiT6Vu948AAAAAAAAAAAAAARQnAQ"},light:{text:"\u6708\u5149\u94F6",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*J_wYQL_PaUEAAAAAAAAAAAAAARQnAQ"},dark:{text:"\u5E7B\u5F71\u9ED1",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*U7M9QI1yat4AAAAAAAAAAAAAARQnAQ"},fresh:{text:"\u8349\u8272\u9752",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*T-oBT4hB5ucAAAAAAAAAAAAAARQnAQ"},grey:{text:"\u96C5\u58EB\u7070",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*OREXQ4vgQRIAAAAAAAAAAAAAARQnAQ"},graffiti:{text:"\u6D82\u9E26",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*4UApTKmeiy4AAAAAAAAAAAAAARQnAQ"},macaron:{text:"\u9A6C\u5361\u9F99",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*0GrCQLtDjNcAAAAAAAAAAAAAARQnAQ"},darkblue:{text:"\u6781\u591C\u84DD",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*uWxqSZQlPkkAAAAAAAAAAAAAARQnAQ"},wine:{text:"\u9171\u7C7D",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*OFPrTbg3an0AAAAAAAAAAAAAARQnAQ"}},RC={normal:{text:"\u6807\u51C6",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*AnfJTbIBJOkAAAAAAAAAAAAAARQnAQ"},light:{text:"\u4EAE",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*gnuiQIok9qIAAAAAAAAAAAAAARQnAQ"},dark:{text:"\u6697",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*NwG-TbOlBH0AAAAAAAAAAAAAARQnAQ"},satellite:{text:"\u536B\u661F",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*2X5EQLKul3IAAAAAAAAAAAAAARQnAQ"},outdoors:{text:"\u6237\u5916",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*gXFLRIaBUI0AAAAAAAAAAAAAARQnAQ"}};function OC(e){var i=LC();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function LC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var DC=function(e){(0,gr.Z)(r,e);var i=OC(r);function r(){var n;(0,xt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,De.Z)(n),"onMapThemeChange",function(){n.mapsService.setMapStyle(n.selectValue[0])}),n}return(0,wt.Z)(r,[{key:"getDefault",value:function(t){return(0,z.Z)((0,z.Z)({},Ra((0,rt.Z)(r.prototype),"getDefault",this).call(this,t)),{},{title:"\u5730\u56FE\u6837\u5F0F",btnIcon:Sh("l7-icon-color"),options:[]})}},{key:"getStyleOptions",value:function(){var t=this.mapsService.getType()==="mapbox"?RC:PC;return Object.entries(this.mapsService.getMapStyleConfig()).filter(function(o){var u=(0,hr.Z)(o,2),l=u[0],p=u[1];return typeof p=="string"&&l!=="blank"}).map(function(o){var u,l=(0,hr.Z)(o,2),p=l[0],v=l[1],x=(u=t[p])!==null&&u!==void 0?u:{},E=x.text,C=x.img;return{text:E!=null?E:p,value:v,img:C,key:p}})}},{key:"getMapStyle",value:function(){return this.mapsService.getMapStyle()}},{key:"onAdd",value:function(){var t,o=this;if((t=this.controlOption.options)!==null&&t!==void 0&&t.length||(this.controlOption.options=this.getStyleOptions()),this.controlOption.defaultValue){var u,l,p=this.controlOption.defaultValue;this.controlOption.defaultValue=(u=(l=this.controlOption.options.find(function(x){return x.key===p}))===null||l===void 0?void 0:l.value)!==null&&u!==void 0?u:p}else{var v=this.getMapStyle();v?this.controlOption.defaultValue=v:this.mapsService.map.once("styledata",function(){var x=o.mapsService.getMapStyle();o.controlOption.defaultValue=x,o.setSelectValue(x,!1)})}return this.on("selectChange",this.onMapThemeChange),Ra((0,rt.Z)(r.prototype),"onAdd",this).call(this)}},{key:"getIsMultiple",value:function(){return!1}}]),r}(D_);function FC(e){var i=BC();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function BC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var U_=function(e){(0,gr.Z)(r,e);var i=FC(r);function r(){var n;(0,xt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,De.Z)(n),"onLayerChange",function(){var l;(l=n.controlOption.layers)!==null&&l!==void 0&&l.length||(n.selectValue=n.getLayerVisible(),n.setOptions({options:n.getLayerOptions()}))}),(0,Y.Z)((0,De.Z)(n),"onLayerVisibleChane",function(){n.setSelectValue(n.getLayerVisible())}),(0,Y.Z)((0,De.Z)(n),"onSelectChange",function(){n.layers.forEach(function(l){var p=n.selectValue.includes(l.name),v=l.isVisible();p&&!v&&l.show(),!p&&v&&l.hide()})}),n}return(0,wt.Z)(r,[{key:"layers",get:function(){var t=this.layerService,o=this.controlOption.layers;if(Array.isArray(o)&&o.length){var u=[];return o.forEach(function(l){if(l instanceof Object&&u.push(l),typeof l=="string"){var p=t.getLayer(l)||t.getLayerByName(l);p&&u.push(p)}}),u}return t.getLayers()||[]}},{key:"getDefault",value:function(t){return(0,z.Z)((0,z.Z)({},Ra((0,rt.Z)(r.prototype),"getDefault",this).call(this,t)),{},{title:"\u56FE\u5C42\u63A7\u5236",btnIcon:Sh("l7-icon-layer"),options:[]})}},{key:"getLayerVisible",value:function(){return this.layers.filter(function(t){return t.isVisible()}).map(function(t){return t.name})}},{key:"getLayerOptions",value:function(){return this.layers.map(function(t){return{text:t.name,value:t.name}})}},{key:"setOptions",value:function(t){var o=this.checkUpdateOption(t,["layers"]);Ra((0,rt.Z)(r.prototype),"setOptions",this).call(this,t),o&&(this.selectValue=this.getLayerVisible(),this.controlOption.options=this.getLayerOptions(),this.popper.setContent(this.getPopperContent(this.controlOption.options)))}},{key:"onAdd",value:function(){var t;return(t=this.controlOption.options)!==null&&t!==void 0&&t.length||(this.controlOption.options=this.getLayerOptions()),this.controlOption.defaultValue||(this.controlOption.defaultValue=this.getLayerVisible()),this.on("selectChange",this.onSelectChange),this.layerService.on("layerChange",this.onLayerChange),Ra((0,rt.Z)(r.prototype),"onAdd",this).call(this)}},{key:"onRemove",value:function(){this.off("selectChange",this.onSelectChange),this.layerService.off("layerChange",this.onLayerChange)}},{key:"getIsMultiple",value:function(){return!0}}]),r}(D_);function NC(e){var i=zC();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function zC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ZC=function(e){(0,gr.Z)(r,e);var i=NC(r);function r(){var n;(0,xt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,De.Z)(n),"location",[0,0]),(0,Y.Z)((0,De.Z)(n),"onMouseMove",function(l){var p=n.location,v=l.lngLat||l.lnglat,x=n.controlOption.transform;v&&(p=[v.lng,v.lat]),n.location=p,x&&(p=x(p)),n.insertLocation2HTML(p),n.emit("locationChange",p)}),n}return(0,wt.Z)(r,[{key:"getLocation",value:function(){return this.location}},{key:"getDefault",value:function(t){return(0,z.Z)((0,z.Z)({},Ra((0,rt.Z)(r.prototype),"getDefault",this).call(this,t)),{},{position:Wu.BOTTOMLEFT,transform:function(u){var l=(0,hr.Z)(u,2),p=l[0],v=l[1];return[+(+p).toFixed(6),+(+v).toFixed(6)]}})}},{key:"onAdd",value:function(){var t=Bi("div","l7-control-mouse-location");return t.innerHTML="&nbsp;",this.mapsService.on("mousemove",this.onMouseMove),t}},{key:"onRemove",value:function(){this.mapsService.off("mousemove",this.onMouseMove)}},{key:"insertLocation2HTML",value:function(t){this.container.innerText=t.join(", ")}}]),r}(Sd);function UC(e){var i=VC();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function VC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jC=function(e){(0,gr.Z)(r,e);var i=UC(r);function r(){var n;(0,xt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,De.Z)(n),"zoomIn",function(){!n.disabled&&n.mapsService.getZoom()<n.mapsService.getMaxZoom()&&n.mapsService.zoomIn()}),(0,Y.Z)((0,De.Z)(n),"zoomOut",function(){!n.disabled&&n.mapsService.getZoom()>n.mapsService.getMinZoom()&&n.mapsService.zoomOut()}),(0,Y.Z)((0,De.Z)(n),"updateDisabled",function(){var l=n.mapsService;n.zoomInButton.removeAttribute("disabled"),n.zoomOutButton.removeAttribute("disabled"),(n.disabled||l.getZoom()<=l.getMinZoom())&&n.zoomOutButton.setAttribute("disabled","true"),(n.disabled||l.getZoom()>=l.getMaxZoom())&&n.zoomInButton.setAttribute("disabled","true")}),n}return(0,wt.Z)(r,[{key:"getDefault",value:function(t){return(0,z.Z)((0,z.Z)({},Ra((0,rt.Z)(r.prototype),"getDefault",this).call(this,t)),{},{position:Wu.BOTTOMRIGHT,name:"zoom",zoomInText:Sh("l7-icon-enlarge"),zoomInTitle:"Zoom in",zoomOutText:Sh("l7-icon-narrow"),zoomOutTitle:"Zoom out"})}},{key:"setOptions",value:function(t){Ra((0,rt.Z)(r.prototype),"setOptions",this).call(this,t),this.checkUpdateOption(t,["zoomInText","zoomInTitle","zoomOutText","zoomOutTitle"])&&this.resetButtonGroup(this.container)}},{key:"onAdd",value:function(){var t=Bi("div","l7-control-zoom");return this.resetButtonGroup(t),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),t}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"resetButtonGroup",value:function(t){Zl(t),this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,"l7-button-control",t,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,"l7-button-control",t,this.zoomOut),this.updateDisabled()}},{key:"createButton",value:function(t,o,u,l,p){var v=Bi("button",u,l);return typeof t=="string"?v.innerHTML=t:v.append(t),v.title=o,v.addEventListener("click",p),v}}]),r}(Sd);function GC(e){var i=HC();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function HC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var WC=function(e){(0,gr.Z)(r,e);var i=GC(r);function r(){var n;(0,xt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,De.Z)(n),"update",function(){var l=n.mapsService,p=n.controlOption.maxWidth,v=l.getSize()[1]/2,x=l.containerToLngLat([0,v]),E=l.containerToLngLat([p,v]),C=$f([x.lng,x.lat],[E.lng,E.lat]);n.updateScales(C)}),n}return(0,wt.Z)(r,[{key:"getDefault",value:function(t){return(0,z.Z)((0,z.Z)({},Ra((0,rt.Z)(r.prototype),"getDefault",this).call(this,t)),{},{name:"scale",position:Wu.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,lockWidth:!0})}},{key:"onAdd",value:function(){var t="l7-control-scale",o=Bi("div",t);this.resetScaleLines(o);var u=this.controlOption.updateWhenIdle;return this.mapsService.on(u?"moveend":"mapmove",this.update),this.mapsService.on(u?"zoomend":"zoomchange",this.update),o}},{key:"onRemove",value:function(){var t=this.controlOption.updateWhenIdle;this.mapsService.off(t?"zoomend":"zoomchange",this.update),this.mapsService.off(t?"moveend":"mapmove",this.update)}},{key:"setOptions",value:function(t){Ra((0,rt.Z)(r.prototype),"setOptions",this).call(this,t),this.checkUpdateOption(t,["lockWidth","maxWidth","metric","updateWhenIdle","imperial"])&&this.resetScaleLines(this.container)}},{key:"updateScales",value:function(t){var o=this.controlOption,u=o.metric,l=o.imperial;u&&t&&this.updateMetric(t),l&&t&&this.updateImperial(t)}},{key:"resetScaleLines",value:function(t){Zl(t);var o=this.controlOption,u=o.metric,l=o.imperial,p=o.maxWidth,v=o.lockWidth;v&&pl(t,"width: ".concat(p,"px")),u&&(this.mScale=Bi("div","l7-control-scale-line",t)),l&&(this.iScale=Bi("div","l7-control-scale-line",t)),this.update()}},{key:"updateScale",value:function(t,o,u){var l=this.controlOption.maxWidth;t.style.width=Math.round(l*u)+"px",t.innerHTML=o}},{key:"getRoundNum",value:function(t){var o=Math.pow(10,(Math.floor(t)+"").length-1),u=t/o;return u=u>=10?10:u>=5?5:u>=3?3:u>=2?2:1,o*u}},{key:"updateMetric",value:function(t){var o=this.getRoundNum(t),u=o<1e3?o+" m":o/1e3+" km";this.updateScale(this.mScale,u,o/t)}},{key:"updateImperial",value:function(t){var o=t*3.2808399,u,l,p;o>5280?(u=o/5280,l=this.getRoundNum(u),this.updateScale(this.iScale,l+" mi",l/u)):(p=this.getRoundNum(o),this.updateScale(this.iScale,p+" ft",p/o))}}]),r}(Sd);function XC(e){var i=$C();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function $C(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Tm=function(e){(0,gr.Z)(r,e);var i=XC(r);function r(n){var t;(0,xt.Z)(this,r),t=i.call(this),(0,Y.Z)((0,De.Z)(t),"isShow",!0),(0,Y.Z)((0,De.Z)(t),"onMouseMove",function(u){var l,p=t.mapsService.getMapContainer(),v=(l=p==null?void 0:p.getBoundingClientRect())!==null&&l!==void 0?l:{},x=v.left,E=x===void 0?0:x,C=v.top,T=C===void 0?0:C;t.setPopupPosition(u.clientX-E,u.clientY-T)}),(0,Y.Z)((0,De.Z)(t),"updateLngLatPosition",function(){if(!(!t.mapsService||t.popupOption.followCursor)){var u=t.lngLat,l=u.lng,p=u.lat,v=t.mapsService.lngLatToContainer([l,p]),x=v.x,E=v.y;t.setPopupPosition(x,E)}}),(0,Y.Z)((0,De.Z)(t),"onKeyDown",function(u){u.keyCode===27&&t.remove()}),(0,Y.Z)((0,De.Z)(t),"onCloseButtonClick",function(u){u.stopPropagation&&u.stopPropagation(),t.hide()}),(0,Y.Z)((0,De.Z)(t),"update",function(){var u=!!t.lngLat,l=t.popupOption,p=l.className,v=l.style,x=l.maxWidth,E=l.anchor,C=l.stopPropagation;if(!(!t.mapsService||!u||!t.content)){var T=t.mapsService.getMarkerContainer();!t.container&&T&&(t.container=Bi("div","l7-popup ".concat(p!=null?p:""," ").concat(t.isShow?"":"l7-popup-hide"),T),v&&t.container.setAttribute("style",v),t.tip=Bi("div","l7-popup-tip",t.container),t.container.appendChild(t.content),C&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(O){t.container.addEventListener(O,function(L){L.stopPropagation()})}),t.container.style.whiteSpace="nowrap"),x&&t.container.style.maxWidth!==x&&(t.container.style.maxWidth=x),t.updateLngLatPosition(),zl(t.container,"".concat(ot[E])),Ze(t.container,E,"popup")}}),t.popupOption=(0,z.Z)((0,z.Z)({},t.getDefault(n!=null?n:{})),n);var o=t.popupOption.lngLat;return o&&(t.lngLat=o),t}return(0,wt.Z)(r,[{key:"lngLat",get:function(){var t;return(t=this.popupOption.lngLat)!==null&&t!==void 0?t:{lng:0,lat:0}},set:function(t){this.popupOption.lngLat=t}},{key:"getIsShow",value:function(){return this.isShow}},{key:"addTo",value:function(t){this.mapsService=t.get(Yt.IMapService),this.sceneService=t.get(Yt.ISceneService),this.layerService=t.get(Yt.ILayerService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=t,this.update(),this.updateCloseOnClick(),this.updateCloseOnEsc(),this.updateFollowCursor();var o=this.popupOption,u=o.html,l=o.text;return u?this.setHTML(u):l&&this.setText(l),this.emit("open"),this}},{key:"remove",value:function(){if(!!this.isOpen())return this.content&&ks(this.content),this.container&&(ks(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.updateCloseOnClick(!0),this.updateCloseOnEsc(!0),this.updateFollowCursor(!0),delete this.mapsService),this.emit("close"),this}},{key:"getOptions",value:function(){return this.popupOption}},{key:"setOptions",value:function(t){return this.popupOption=(0,z.Z)((0,z.Z)({},this.popupOption),t),this.checkUpdateOption(t,["closeButton","closeButtonOffsets","maxWidth","anchor","stopPropagation","className","style","lngLat","offsets","title"])&&(this.container&&(ks(this.container),this.container=void 0),this.popupOption.html?this.setHTML(this.popupOption.html):this.popupOption.text&&this.setText(this.popupOption.text)),this.checkUpdateOption(t,["closeOnEsc"])&&this.updateCloseOnEsc(),this.checkUpdateOption(t,["closeOnClick"])&&this.updateCloseOnClick(),this.checkUpdateOption(t,["followCursor"])&&this.updateFollowCursor(),this.checkUpdateOption(t,["html"])&&t.html?this.setHTML(t.html):this.checkUpdateOption(t,["text"])&&t.text&&this.setText(t.text),this.checkUpdateOption(t,["lngLat"])&&t.lngLat&&(this.setLnglat(t.lngLat),this.show()),this}},{key:"open",value:function(){return this.addTo(this.scene),this}},{key:"close",value:function(){return this.remove(),this}},{key:"show",value:function(){if(!this.isShow)return this.container&&Nl(this.container,"l7-popup-hide"),this.isShow=!0,this.emit("show"),this}},{key:"hide",value:function(){if(!!this.isShow)return this.container&&Cu(this.container,"l7-popup-hide"),this.isShow=!1,this.emit("hide"),this}},{key:"setHTML",value:function(t){return this.popupOption.html=t,this.setDOMContent(this.getPopupHTMLFragment(t))}},{key:"setText",value:function(t){return this.popupOption.text=t,this.setDOMContent(window.document.createTextNode(t))}},{key:"panToPopup",value:function(){var t=this.lngLat,o=t.lng,u=t.lat;return this.popupOption.autoPan&&this.mapsService.panTo([o,u]),this}},{key:"setLngLat",value:function(t){return this.setLnglat(t)}},{key:"setLnglat",value:function(t){var o=this;return this.lngLat=t,Array.isArray(t)&&(this.lngLat={lng:t[0],lat:t[1]}),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this.popupOption.autoPan&&setTimeout(function(){o.panToPopup()},0),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setMaxWidth",value:function(t){return this.popupOption.maxWidth=t,this.update(),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"getDefault",value:function(t){return{closeButton:!0,closeOnClick:!1,maxWidth:"240px",offsets:[0,0],anchor:Ge.BOTTOM,stopPropagation:!0,autoPan:!1,autoClose:!0,closeOnEsc:!1,followCursor:!1}}},{key:"setDOMContent",value:function(t){return this.createContent(),this.contentPanel.appendChild(t),this.update(),this}},{key:"updateCloseOnClick",value:function(t){var o=this,u=this.mapsService;u&&(u==null||u.off("click",this.onCloseButtonClick),this.popupOption.closeOnClick&&!t&&requestAnimationFrame(function(){u==null||u.on("click",o.onCloseButtonClick)}))}},{key:"updateCloseOnEsc",value:function(t){window.removeEventListener("keydown",this.onKeyDown),this.popupOption.closeOnEsc&&!t&&window.addEventListener("keydown",this.onKeyDown)}},{key:"updateFollowCursor",value:function(t){var o,u=(o=this.mapsService)===null||o===void 0?void 0:o.getContainer();u&&(u==null||u.removeEventListener("mousemove",this.onMouseMove),this.popupOption.followCursor&&!t&&(u==null||u.addEventListener("mousemove",this.onMouseMove)))}},{key:"createContent",value:function(){var t=this;if(this.content&&ks(this.content),this.content=Bi("div","l7-popup-content",this.container),this.popupOption.title){var o;this.contentTitle=Bi("div","l7-popup-content__title",this.content),(o=this.contentTitle)===null||o===void 0||o.append(this.getPopupHTMLFragment(this.popupOption.title))}else this.contentTitle=void 0;if(this.popupOption.closeButton){var u=Sh("l7-icon-guanbi");Cu(u,"l7-popup-close-button"),this.content.appendChild(u),this.popupOption.closeButtonOffsets&&(u.style.right=this.popupOption.closeButtonOffsets[0]+"px",u.style.top=this.popupOption.closeButtonOffsets[1]+"px"),u.setAttribute("aria-label","Close popup"),u.addEventListener("click",function(){t.hide()}),this.closeButton=u}else this.closeButton=void 0;this.contentPanel=Bi("div","l7-popup-content__panel",this.content)}},{key:"setPopupPosition",value:function(t,o){if(this.container){var u=this.popupOption.offsets;this.container.style.left=t+u[0]+"px",this.container.style.top=o-u[1]+"px"}}},{key:"checkUpdateOption",value:function(t,o){return o.some(function(u){return u in t})}},{key:"getPopupHTMLFragment",value:function(t){var o=window.document.createDocumentFragment(),u=window.document.createElement("body"),l;for(typeof t=="string"?u.innerHTML=t:Array.isArray(t)?u.append.apply(u,(0,N.Z)(t)):t instanceof HTMLElement&&u.append(t);l=u.firstChild,!!l;)o.appendChild(l);return o}}]),r}(Ns.EventEmitter);function YC(e){var i=qC();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function qC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tR=function(e){(0,gr.Z)(r,e);var i=YC(r);function r(){var n;(0,xt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,De.Z)(n),"layerConfigMap",new WeakMap),n}return(0,wt.Z)(r,[{key:"layerConfigItems",get:function(){var t,o=this.popupOption,u=o.config,l=o.items;return(t=u!=null?u:l)!==null&&t!==void 0?t:[]}},{key:"addTo",value:function(t){return Ra((0,rt.Z)(r.prototype),"addTo",this).call(this,t),this.bindLayerEvent(),this.hide(),this}},{key:"remove",value:function(){return Ra((0,rt.Z)(r.prototype),"remove",this).call(this),this.unbindLayerEvent(),this}},{key:"setOptions",value:function(t){return this.unbindLayerEvent(),Ra((0,rt.Z)(r.prototype),"setOptions",this).call(this,t),this.bindLayerEvent(),this}},{key:"getDefault",value:function(t){var o=t.trigger==="click";return(0,z.Z)((0,z.Z)({},Ra((0,rt.Z)(r.prototype),"getDefault",this).call(this,t)),{},{trigger:"hover",followCursor:!o,lngLat:{lng:0,lat:0},offsets:[0,10],closeButton:!1,autoClose:!1,closeOnEsc:!1})}},{key:"bindLayerEvent",value:function(){var t=this,o=this.popupOption.trigger;this.layerConfigItems.forEach(function(u){var l,p=t.getLayerByConfig(u);if(!!p){var v=(0,z.Z)({},u);if(o==="hover"){var x=t.onLayerMouseMove.bind(t,p),E=t.onLayerMouseOut.bind(t,p);v.onMouseMove=x,v.onMouseOut=E,p==null||p.on("mousemove",x),p==null||p.on("mouseout",E)}else{var C=t.onLayerClick.bind(t,p);v.onClick=C,p==null||p.on("click",C)}var T=p==null||(l=p.getSource)===null||l===void 0?void 0:l.call(p),O=t.onSourceUpdate.bind(t,p);T==null||T.on("update",O),v.onSourceUpdate=O,t.layerConfigMap.set(p,v)}})}},{key:"unbindLayerEvent",value:function(){var t=this;this.layerConfigItems.forEach(function(o){var u=t.getLayerByConfig(o),l=u&&t.layerConfigMap.get(u);if(!!l){var p=l.onMouseMove,v=l.onMouseOut,x=l.onClick,E=l.onSourceUpdate;if(p&&u.off("mousemove",p),v&&u.off("mouseout",v),x&&u.off("click",x),E){var C;u==null||(C=u.getSource())===null||C===void 0||C.off("update",E)}}})}},{key:"onLayerMouseMove",value:function(t,o){if(!this.isSameFeature(t,o.featureId)){var u=this.getLayerInfoFrag(t,o);this.setDOMContent(u),this.displayFeatureInfo={layer:t,featureId:o.featureId}}this.isShow||this.show()}},{key:"onLayerMouseOut",value:function(t,o){this.displayFeatureInfo=void 0,this.isShow&&this.hide()}},{key:"onLayerClick",value:function(t,o){if(this.isShow&&this.isSameFeature(t,o.featureId))this.hide();else{var u=this.getLayerInfoFrag(t,o);this.setDOMContent(u),this.setLnglat(o.lngLat),this.show(),this.displayFeatureInfo={layer:t,featureId:o.featureId}}}},{key:"onSourceUpdate",value:function(t){var o;((o=this.displayFeatureInfo)===null||o===void 0?void 0:o.layer)===t&&(this.hide(),this.displayFeatureInfo=void 0)}},{key:"getLayerInfoFrag",value:function(t,o){var u=this.layerConfigMap.get(t),l=document.createDocumentFragment();if(u){var p=o.feature;p.type==="Feature"&&"properties"in p&&"geometry"in p&&(p=p.properties);var v=u.fields;v==null||v.forEach(function(x){var E,C,T=typeof x=="string"?{field:x}:x,O=T.field,L=T.formatField,B=T.formatValue,H=T.getValue,oe=Bi("div","l7-layer-popup__row"),le=H?H(o.feature):(0,St.get)(p,O),Re=(E=L instanceof Function?L(O):L)!==null&&E!==void 0?E:O,Ne=(C=B instanceof Function?B(le):B)!==null&&C!==void 0?C:le;oe.innerHTML='<span class="l7-layer-popup__key">'.concat(Re,'</span>: <span class="l7-layer-popup__value">').concat(Ne,"</span>"),l.appendChild(oe)})}return l}},{key:"getLayerByConfig",value:function(t){var o=t.layer;if(o instanceof Object)return o;if(typeof o=="string")return this.layerService.getLayer(o)||this.layerService.getLayerByName(o)}},{key:"isSameFeature",value:function(t,o){var u=this.displayFeatureInfo;return u&&t===u.layer&&o===u.featureId}}]),r}(Tm);function KC(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var t=i.head||i.getElementsByTagName("head")[0];if(!t){t=i.createElement("head");var o=i.body||i.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(t,o):i.documentElement.appendChild(t)}var u=i.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(i.createTextNode(e)),t.appendChild(u),u}}KC(`.l7-marker-container {
  position: absolute;
  width: 100%;
  height: 100%;
  overflow: hidden;
}
.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}
.l7-marker-cluster {
  width: 40px;
  height: 40px;
  background-color: rgba(181, 226, 140, 0.6);
  background-clip: padding-box;
  border-radius: 20px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-top: 5px;
  margin-left: 5px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  text-align: center;
  background-color: rgba(110, 204, 57, 0.6);
  border-radius: 15px;
}
.l7-marker-cluster span {
  line-height: 30px;
}
.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  background-clip: padding-box;
  border: 2px solid rgba(0, 0, 0, 0.2);
}
.mapboxgl-ctrl-logo,
.amap-logo {
  display: none !important;
}
.l7-select-box {
  border: 3px dashed gray;
  border-radius: 2px;
  position: absolute;
  z-index: 1000;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
}
.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-container .l7-control {
  position: relative;
  z-index: 800;
  float: left;
  clear: both;
  color: #595959;
  font-size: 12px;
  pointer-events: visiblePainted;
  /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control-container .l7-control.l7-control--hide {
  display: none;
}
.l7-control-container .l7-top {
  top: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-control-container .l7-top .l7-control:not(.l7-control--hide) {
  margin-top: 8px;
}
.l7-control-container .l7-right {
  right: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-control-container .l7-right .l7-control:not(.l7-control--hide) {
  margin-right: 8px;
}
.l7-control-container .l7-bottom {
  bottom: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-control-container .l7-bottom .l7-control:not(.l7-control--hide) {
  margin-bottom: 8px;
}
.l7-control-container .l7-left {
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-control-container .l7-left .l7-control:not(.l7-control--hide) {
  margin-left: 8px;
}
.l7-control-container .l7-center {
  position: absolute;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-control-container .l7-center.l7-top,
.l7-control-container .l7-center.l7-bottom {
  width: 100%;
}
.l7-control-container .l7-center.l7-left,
.l7-control-container .l7-center.l7-right {
  height: 100%;
}
.l7-control-container .l7-center .l7-control {
  margin-right: 8px;
  margin-bottom: 8px;
}
.l7-control-container .l7-row {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-control-container .l7-row.l7-top {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-control-container .l7-row.l7-bottom {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-control-container .l7-column {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-control-container .l7-column.l7-left {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-control-container .l7-column.l7-right {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-button-control {
  min-width: 28px;
  height: 28px;
  background-color: #fff;
  border-width: 0;
  border-radius: 2px;
  outline: 0;
  cursor: pointer;
  -webkit-transition: all 0.2s;
  transition: all 0.2s;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  padding: 0 6px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  line-height: 16px;
}
.l7-button-control .l7-iconfont {
  fill: #595959;
  color: #595959;
  width: 16px;
  height: 16px;
}
.l7-button-control.l7-button-control--row {
  padding: 0 16px 0 13px;
}
.l7-button-control.l7-button-control--row * + .l7-button-control__text {
  margin-left: 8px;
}
.l7-button-control.l7-button-control--column {
  height: 44px;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-button-control.l7-button-control--column .l7-iconfont {
  margin-top: 3px;
}
.l7-button-control.l7-button-control--column .l7-button-control__text {
  margin-top: 3px;
  font-size: 10px;
  -webkit-transform: scale(0.83333);
          transform: scale(0.83333);
}
.l7-button-control:not(:disabled):hover {
  background-color: #f3f3f3;
}
.l7-button-control:not(:disabled):active {
  background-color: #f3f3f3;
}
.l7-button-control:disabled {
  background-color: #fafafa;
  color: #bdbdbd;
  cursor: not-allowed;
}
.l7-button-control:disabled .l7-iconfont {
  fill: #bdbdbd;
  color: #bdbdbd;
}
.l7-button-control:disabled:hover {
  background-color: #fafafa;
}
.l7-button-control:disabled:active {
  background-color: #fafafa;
}
.l7-popper {
  position: absolute;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  z-index: 5;
  color: #595959;
}
.l7-popper.l7-popper-hide {
  display: none;
}
.l7-popper .l7-popper-content {
  min-height: 28px;
  background: #fff;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper .l7-popper-arrow {
  width: 0;
  height: 0;
  border-width: 4px;
  border-style: solid;
  border-top-color: transparent;
  border-bottom-color: transparent;
  border-left-color: transparent;
  border-right-color: transparent;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper.l7-popper-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-popper.l7-popper-left .l7-popper-arrow {
  border-left-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popper.l7-popper-right .l7-popper-arrow {
  border-right-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-top {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-popper.l7-popper-top .l7-popper-arrow {
  border-top-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-bottom {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}
.l7-popper.l7-popper-bottom .l7-popper-arrow {
  border-bottom-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-start {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-popper.l7-popper-end {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-select-control--normal {
  padding: 4px 0;
}
.l7-select-control--normal .l7-select-control-item {
  height: 24px;
  line-height: 24px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  padding: 0 16px;
  font-size: 12px;
}
.l7-select-control--normal .l7-select-control-item > * + * {
  margin-left: 6px;
}
.l7-select-control--normal .l7-select-control-item input[type='checkbox'] {
  height: 14px;
  width: 14px;
}
.l7-select-control--normal .l7-select-control-item:hover {
  background-color: #f3f3f3;
}
.l7-select-control--image {
  padding: 12px 12px 0 12px;
  width: 474px;
  height: 320px;
  overflow: auto;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -ms-flex-wrap: wrap;
      flex-wrap: wrap;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-select-control--image .l7-select-control-item {
  margin-right: 12px;
  border-radius: 2px;
  overflow: hidden;
  border: 1px solid #fff;
  -webkit-box-sizing: content-box;
          box-sizing: content-box;
  width: calc((100% - 36px) / 3);
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  margin-bottom: 12px;
  position: relative;
  font-size: 12px;
}
.l7-select-control--image .l7-select-control-item img {
  width: 142px;
  height: 80px;
}
.l7-select-control--image .l7-select-control-item input[type='checkbox'] {
  position: absolute;
  right: 0;
  top: 0;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  line-height: 26px;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row > * + * {
  margin-left: 8px;
}
.l7-select-control--image .l7-select-control-item.l7-select-control-item-active {
  border-color: #0370fe;
}
.l7-select-control--image .l7-select-control-item:nth-child(3n) {
  margin-right: 0;
}
.l7-select-control-item {
  cursor: pointer;
}
.l7-select-control-item input[type='checkbox'] {
  margin: 0;
  cursor: pointer;
}
.l7-select-control--multiple .l7-select-control-item:hover {
  background-color: transparent;
}
.l7-control-logo {
  width: 89px;
  height: 16px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}
.l7-control-logo img {
  height: 100%;
  width: 100%;
}
.l7-control-logo .l7-control-logo-link {
  display: block;
  cursor: pointer;
}
.l7-control-logo .l7-control-logo-link img {
  cursor: pointer;
}
.l7-control-mouse-location {
  background-color: #fff;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  padding: 2px 4px;
  min-width: 130px;
}
.l7-control-zoom {
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  border-radius: 2px;
  overflow: hidden;
}
.l7-control-zoom .l7-button-control {
  -webkit-box-shadow: 0 0 0;
          box-shadow: 0 0 0;
  border-radius: 0;
  font-size: 16px;
}
.l7-control-zoom .l7-button-control .l7-iconfont {
  width: 14px;
  height: 14px;
}
.l7-control-zoom .l7-button-control:first-child {
  border-bottom: 1px solid #f0f0f0;
}
.l7-control-scale {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-control-scale .l7-control-scale-line {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  padding: 2px 5px 1px;
  overflow: hidden;
  color: #595959;
  font-size: 10px;
  line-height: 1.1;
  white-space: nowrap;
  background: #fff;
  border: 2px solid #000;
  border-top: 0;
  -webkit-transition: width 0.1s;
  transition: width 0.1s;
}
.l7-control-scale .l7-control-scale-line + .l7-control-scale .l7-control-scale-line {
  margin-top: -2px;
  border-top: 2px solid #777;
  border-bottom: none;
}
.l7-right .l7-control-scale {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-right .l7-control-scale .l7-control-scale-line {
  text-align: right;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 5;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  pointer-events: none;
  will-change: transform;
}
.l7-popup.l7-popup-hide {
  display: none;
}
.l7-popup .l7-popup-content {
  position: relative;
  padding: 16px;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  pointer-events: auto;
  font-size: 14px;
}
.l7-popup .l7-popup-content .l7-popup-content__title {
  font-weight: bold;
  margin-bottom: 8px;
}
.l7-popup .l7-popup-content .l7-popup-close-button {
  position: absolute;
  top: 0;
  right: 0;
  width: 18px;
  height: 18px;
  line-height: 18px;
  text-align: center;
  padding: 0;
  background-color: transparent;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  font-size: 14px;
}
.l7-popup .l7-popup-tip {
  z-index: 1;
  width: 0;
  height: 0;
  border: 10px solid transparent;
}
.l7-popup.l7-popup-anchor-bottom,
.l7-popup.l7-popup-anchor-bottom-left,
.l7-popup.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}
.l7-popup.l7-popup-anchor-top,
.l7-popup.l7-popup-anchor-top-left,
.l7-popup.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-popup.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-popup.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup-anchor-top .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-bottom-color: #fff;
  border-left: none;
}
.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top-color: #fff;
  border-bottom: none;
}
.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top-color: #fff;
  border-bottom: none;
  border-left: none;
}
.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top-color: #fff;
  border-right: none;
  border-bottom: none;
}
.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right-color: #fff;
  border-left: none;
}
.l7-popup-anchor-right .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}
.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}
.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}
.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}
.l7-popup-track-pointer {
  display: none;
}
.l7-popup-track-pointer * {
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
  pointer-events: none;
}
.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}
.l7-map:active .l7-popup-track-pointer {
  display: none;
}
.l7-layer-popup__row {
  font-size: 12px;
}
.l7-layer-popup__row + .l7-layer-popup__row {
  margin-top: 4px;
}
`);var ep,Mm=(ep={},(0,Y.Z)(ep,lf.additive,{enable:!0,func:{srcRGB:$.ONE,dstRGB:$.ONE,srcAlpha:1,dstAlpha:1}}),(0,Y.Z)(ep,lf.none,{enable:!1}),(0,Y.Z)(ep,lf.normal,{enable:!0,func:{srcRGB:$.SRC_ALPHA,dstRGB:$.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,Y.Z)(ep,lf.subtractive,{enable:!0,func:{srcRGB:$.ONE,dstRGB:$.ONE,srcAlpha:$.ZERO,dstAlpha:$.ONE_MINUS_SRC_COLOR},equation:{rgb:$.FUNC_SUBTRACT,alpha:$.FUNC_SUBTRACT}}),(0,Y.Z)(ep,lf.max,{enable:!0,func:{srcRGB:$.ONE,dstRGB:$.ONE},equation:{rgb:$.MAX_EXT}}),(0,Y.Z)(ep,lf.min,{enable:!0,func:{srcRGB:$.ONE,dstRGB:$.ONE},equation:{rgb:$.MIN_EXT}}),ep);function tc(e,i,r,n,t){i.updateStyleAttribute(e,r,n,t)}function QC(e,i){i.tileLayer||i.isTileLayer||(e.opacity&&i0("opacity",i,e.opacity),e.strokeWidth&&i0("strokeWidth",i,e.strokeWidth),e.strokeOpacity&&i0("strokeOpacity",i,e.strokeOpacity),e.stroke&&JC("stroke",i,e.stroke),e.offsets&&V_("offsets",i,e.offsets),e.textOffset&&V_("textOffset",i,e.textOffset),e.thetaOffset&&i0("thetaOffset",i,e.thetaOffset))}function i0(e,i,r){(0,St.isString)(r)?tc(e,i,r,function(n){return n}):(0,St.isNumber)(r)||(Array.isArray(r)&&r.length===2?(0,St.isString)(r[0])&&(0,St.isFunction)(r[1])||(0,St.isString)(r[0])&&Array.isArray(r[1])&&(0,St.isNumber)(r[1][0])&&(0,St.isNumber)(r[1][1])?tc(e,i,r[0],r[1]):tc(e,i,[1],void 0):tc(e,i,[1],void 0))}function V_(e,i,r){(0,St.isString)(r)?tc(e,i,r,function(n){return n}):Array.isArray(r)&&r.length===2&&(0,St.isString)(r[0])&&(0,St.isFunction)(r[1])?tc(e,i,r[0],r[1]):Array.isArray(r)&&r.length===2&&(0,St.isNumber)(r[0])&&(0,St.isNumber)(r[1])?tc(e,i,r,void 0):tc(e,i,[0,0],void 0)}function JC(e,i,r){(0,St.isString)(r)||(Array.isArray(r)&&r.length===2&&((0,St.isString)(r[0])&&(0,St.isFunction)(r[1])||(0,St.isString)(r[0])&&Array.isArray(r[1])&&r[1].length>0)?tc(e,i,r[0],r[1]):tc(e,i,"#fff",void 0))}var hs;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.DEFUALT="DEFUALTMAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL"})(hs||(hs={}));function eA(e,i){var r=[i[0]-e[0],i[1]-e[1]],n=Ws(r),t=[e[0]+n[0]*1e-4,e[1]+n[1]*1e-4];return t}function tA(e,i,r){if(e.length>0&&i.version===hs["GAODE2.x"]){var n=r.coordCenter;typeof e[0].coordinates[0]=="number"?e.filter(function(t){return!t.originCoordinates}).map(function(t){t.version=hs["GAODE2.x"],t.originCoordinates=(0,St.cloneDeep)(t.coordinates),t.coordinates=i.lngLatToCoordByLayer(t.coordinates,n)}):e.filter(function(t){return!t.originCoordinates}).map(function(t){t.version=hs["GAODE2.x"],t.originCoordinates=(0,St.cloneDeep)(t.coordinates),t.coordinates=i.lngLatToCoordsByLayer(t.coordinates,n)})}}function rA(e,i){e.length>0&&i.version===hs.SIMPLE&&e.map(function(r){r.simpleCoordinate||(r.coordinates=nA(r.coordinates,i),r.simpleCoordinate=!0)})}function nA(e,i){if(typeof e[0]=="number")return i.simpleMapCoord.unproject(e);if(e[0]&&e[0][0]instanceof Array){var r=[];return e.map(function(t){var o=[];t.map(function(u){o.push(i.simpleMapCoord.unproject(u))}),r.push(o)}),r}else{var n=[];return e.map(function(t){n.push(i.simpleMapCoord.unproject(t))}),n}}function iA(e,i){var r;if(!e.scale)return[];var n=(e==null||(r=e.scale)===null||r===void 0?void 0:r.scalers)||[],t=[];n.forEach(function(u){var l,p=u.field;(i.hasOwnProperty(p)||((l=e.scale)===null||l===void 0?void 0:l.type)==="variable")&&t.push(i[p])});var o=e.mapping?e.mapping(t):[];return o}function aA(e,i,r,n,t){var o=t==null?void 0:t.getLayerConfig(),u=o.arrow,l=u===void 0?{enable:!1}:u,p=i.map(function(v){var x={id:v._id,coordinates:v.coordinates};if(e.filter(function(T){return T.scale!==void 0}).forEach(function(T){var O=iA(T,v);T.needRemapping=!1,T.name==="color"&&(O=O.map(function(L){return he(L)})),x[T.name]=Array.isArray(O)&&O.length===1?O[0]:O,T.name==="shape"&&(x.shape=r.getIconFontKey(x[T.name]))}),x.shape==="line"&&l.enable){var E=x.coordinates,C=eA(E[0],E[1]);x.coordinates.splice(1,0,C,C)}return x});return tA(p,n,t),rA(p,n),p}function oA(e,i,r,n,t,o){var u=new Cm(t,o),l=n.getLayerStyleAttributes()||[],p=u.data.dataArray,v=p,x=aA(l,v,i,r,e);return u.destroy(),x}function j_(e){return e.map(function(i){return typeof i=="string"&&(i=[i,{}]),i})}function G_(e,i,r,n){var t=e.multiPassRenderer,o=e.getLayerConfig(),u=o.enableTAA;return u?t.add(n("taa")):t.add(n("render")),j_(i).forEach(function(l){var p=(0,hr.Z)(l,2),v=p[0],x=p[1];t.add(r(v),x)}),t.add(r("copy")),t}var sA=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]];function uA(e,i,r){if(typeof i=="string"&&typeof r=="string"&&i!==r){if(e.type==="PointLayer"){e.dataState.dataSourceNeedUpdate=!0;return}sA.map(function(n){if(n.includes(i)&&n.includes(r)){e.dataState.dataSourceNeedUpdate=!0;return}})}}var lA=function(){function e(i){(0,xt.Z)(this,e),this.layer=i}return(0,wt.Z)(e,[{key:"pickRender",value:function(r){var n=this.layer;if(n.tileLayer)return n.tileLayer.pickRender(r);n.hooks.beforePickingEncode.call(),n.masks.length>0&&n.masks.filter(function(t){return t.inited}).forEach(function(){var t=(0,de.Z)(q().mark(function o(u){return q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:u.render();case 1:case"end":return p.stop()}},o)}));return function(o){return t.apply(this,arguments)}}()),n.renderModels(!0),n.hooks.afterPickingEncode.call()}},{key:"pick",value:function(r,n){var t=this.layer.getContainer(),o=t.get(Yt.IPickingService);return r.type==="RasterLayer"?this.pickRasterLayer(r,n):(this.pickRender(n),o.pickFromPickingFBO(r,n))}},{key:"pickRasterLayer",value:function(r,n,t){var o=this.layer.getContainer(),u=o.get(Yt.IPickingService),l=o.get(Yt.IMapService),p=this.layer.getSource().extent,v=ja(n.lngLat,p),x={x:n.x,y:n.y,type:n.type,lngLat:n.lngLat,target:n,rasterValue:null},E=t||r;if(v){var C=this.readRasterValue(r,p,l,n.x,n.y);return x.rasterValue=C,u.triggerHoverOnLayer(E,x),!0}else return x.type=n.type==="mousemove"?"mouseout":"un"+n.type,u.triggerHoverOnLayer(E,(0,z.Z)((0,z.Z)({},x),{},{type:"unpick"})),u.triggerHoverOnLayer(E,x),!1}},{key:"readRasterValue",value:function(r,n,t,o,u){var l=r.getSource().data.dataArray[0],p=(0,hr.Z)(n,4),v=p[0],x=v===void 0?0:v,E=p[1],C=E===void 0?0:E,T=p[2],O=T===void 0?10:T,L=p[3],B=L===void 0?-10:L,H=t.lngLatToContainer([x,C]),oe=t.lngLatToContainer([O,B]),le=oe.x-H.x,Re=H.y-oe.y,Ne=[(o-H.x)/le,(u-oe.y)/Re],ut=l.width||1,Ot=l.height||1,Nt=Math.floor(Ne[0]*ut),jt=Math.floor(Ne[1]*Ot),br=Math.max(0,jt-1)*ut+Nt,yr=l.data[br];return yr}},{key:"selectFeature",value:function(r){var n=this.layer,t=(0,hr.Z)(r,3),o=t[0],u=t[1],l=t[2];n.hooks.beforeSelect.call([o,u,l])}},{key:"highlightPickedFeature",value:function(r){var n=(0,hr.Z)(r,3),t=n[0],o=n[1],u=n[2];this.layer.hooks.beforeHighlight.call([t,o,u])}},{key:"getFeatureById",value:function(r){return this.layer.getSource().getFeatureById(r)}}]),e}(),cA=function(){function e(i){(0,xt.Z)(this,e),this.layer=i;var r=this.layer.getContainer();this.rendererService=r.get(Yt.IRendererService)}return(0,wt.Z)(e,[{key:"getColorTexture",value:function(r){var n=this.getTextureKey(r);return this.key===n?this.colorTexture:(this.createColorTexture(r),this.key=n,this.colorTexture)}},{key:"createColorTexture",value:function(r){var n=this.rendererService.createTexture2D,t=We(r),o=n({data:t.data,width:t.width,height:t.height,flipY:!1});return this.colorTexture=o,o}},{key:"setColorTexture",value:function(r,n){this.key=this.getTextureKey(n),this.colorTexture=r}},{key:"destroy",value:function(){var r;(r=this.colorTexture)===null||r===void 0||r.destroy()}},{key:"getTextureKey",value:function(r){return"".concat(r.colors.join("_"),"_").concat(r.positions.join("_"))}}]),e}(),fA=["passes"],hA=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber","workerEnabled","workerOptions"],H_,km,W_;function pA(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=dA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function dA(e,i){if(!!e){if(typeof e=="string")return X_(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return X_(e,i)}}function X_(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function vA(e){var i=mA();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function mA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $_=0,tp=(H_=Em(Yt.IGlobalConfigService),km=function(e){(0,gr.Z)(r,e);var i=vA(r);function r(){var n,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,xt.Z)(this,r),n=i.call(this),(0,Y.Z)((0,De.Z)(n),"id","".concat($_++)),(0,Y.Z)((0,De.Z)(n),"name","".concat($_)),(0,Y.Z)((0,De.Z)(n),"visible",!0),(0,Y.Z)((0,De.Z)(n),"zIndex",0),(0,Y.Z)((0,De.Z)(n),"inited",!1),(0,Y.Z)((0,De.Z)(n),"layerModelNeedUpdate",!1),(0,Y.Z)((0,De.Z)(n),"pickedFeatureID",null),(0,Y.Z)((0,De.Z)(n),"selectedFeatureID",null),(0,Y.Z)((0,De.Z)(n),"styleNeedUpdate",!1),(0,Y.Z)((0,De.Z)(n),"forceRender",!1),(0,Y.Z)((0,De.Z)(n),"clusterZoom",0),(0,Y.Z)((0,De.Z)(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),(0,Y.Z)((0,De.Z)(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,Y.Z)((0,De.Z)(n),"hooks",{init:new EE,afterInit:new Xg,beforeRender:new Xg,beforeRenderData:new SE,afterRender:new Ff,beforePickingEncode:new Ff,afterPickingEncode:new Ff,beforeHighlight:new Ff(["pickedColor"]),afterHighlight:new Ff,beforeSelect:new Ff(["pickedColor"]),afterSelect:new Ff,beforeDestroy:new Ff,afterDestroy:new Ff}),(0,Y.Z)((0,De.Z)(n),"models",[]),(0,Y.Z)((0,De.Z)(n),"startInit",!1),(0,Y.Z)((0,De.Z)(n),"layerChildren",[]),(0,Y.Z)((0,De.Z)(n),"masks",[]),ra((0,De.Z)(n),"configService",W_,(0,De.Z)(n)),(0,Y.Z)((0,De.Z)(n),"animateOptions",{enable:!1}),(0,Y.Z)((0,De.Z)(n),"currentPickId",null),(0,Y.Z)((0,De.Z)(n),"pendingStyleAttributes",[]),(0,Y.Z)((0,De.Z)(n),"scaleOptions",{}),(0,Y.Z)((0,De.Z)(n),"animateStatus",!1),(0,Y.Z)((0,De.Z)(n),"isDestroyed",!1),(0,Y.Z)((0,De.Z)(n),"encodeDataLength",0),(0,Y.Z)((0,De.Z)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var o=n.getLayerConfig();o&&o.autoFit&&n.fitBounds(o.fitBoundsOptions);var u=n.layerSource.getSourceCfg().autoRender;u&&n.reRender()}),n.name=t.name||n.id,n.zIndex=t.zIndex||0,n.rawConfig=t,n}return(0,wt.Z)(r,[{key:"addMaskLayer",value:function(t){this.masks.push(t)}},{key:"removeMaskLayer",value:function(t){var o=this.masks.indexOf(t);o>-1&&this.masks.splice(o,1),t.destroy()}},{key:"getAttribute",value:function(t){return this.styleAttributeService.getLayerStyleAttribute(t)}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(t){var o=this;if(Object.keys(t).map(function(l){l in o.rawConfig&&(o.rawConfig[l]=t[l])}),!this.startInit)this.needUpdateConfig=(0,z.Z)((0,z.Z)({},this.needUpdateConfig),t);else{var u=this.container.get(Yt.SceneID);QC(t,this),this.configService.setLayerConfig(u,this.id,(0,z.Z)((0,z.Z)((0,z.Z)({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),t)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(t,o){this.container=t,this.sceneContainer=o}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(t){return this.plugins.push(t),this}},{key:"init",value:function(){var n=(0,de.Z)(q().mark(function o(){var u=this,l,p,v,x,E,C,T;return q().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:l=this.container.get(Yt.SceneID),this.startInit=!0,this.configService.setLayerConfig(l,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(Yt.IIconService),this.fontService=this.container.get(Yt.IFontService),this.rendererService=this.container.get(Yt.IRendererService),this.layerService=this.container.get(Yt.ILayerService),this.interactionService=this.container.get(Yt.IInteractionService),this.pickingService=this.container.get(Yt.IPickingService),this.mapService=this.container.get(Yt.IMapService),p=this.getLayerConfig(),v=p.enableMultiPassRenderer,x=p.passes,v&&x!==null&&x!==void 0&&x.length&&x.length>0&&this.mapService.on("mapAfterFrameChange",function(){u.renderLayers()}),this.cameraService=this.container.get(Yt.ICameraService),this.coordinateService=this.container.get(Yt.ICoordinateSystemService),this.shaderModuleService=this.container.get(Yt.IShaderModuleService),this.postProcessingPassFactory=this.container.get(Yt.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(Yt.IFactoryNormalPass),this.styleAttributeService=this.container.get(Yt.IStyleAttributeService),v&&(this.multiPassRenderer=this.container.get(Yt.IMultiPassRenderer),this.multiPassRenderer.setLayer(this)),this.pendingStyleAttributes.forEach(function(B){var H=B.attributeName,oe=B.attributeField,le=B.attributeValues,Re=B.updateOptions;u.styleAttributeService.updateStyleAttribute(H,{scale:(0,z.Z)({field:oe},u.splitValuesAndCallbackInAttribute(le,u.getLayerConfig()[H]))},Re)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(Yt.ILayerPlugin),E=pA(this.plugins);try{for(E.s();!(C=E.n()).done;)T=C.value,T.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}catch(B){E.e(B)}finally{E.f()}return this.layerPickService=new lA(this),this.textureService=new cA(this),L.next=29,this.hooks.init.promise();case 29:this.inited=!0,this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this.hooks.afterInit.call();case 33:case"end":return L.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"updateModelData",value:function(t){t.attributes&&t.elements?this.models.map(function(o){o.updateAttributesAndElements(t.attributes,t.elements)}):console.warn("data error")}},{key:"createModelData",value:function(t,o){var u;if((u=this.layerModel)!==null&&u!==void 0&&u.createModelData)return this.layerModel.createModelData(o);var l=this.calculateEncodeData(t,o),p=this.triangulation;return l&&p?this.styleAttributeService.createAttributesAndIndices(l,p):{attributes:void 0,elements:void 0}}},{key:"setLayerPickService",value:function(t){this.layerPickService=t}},{key:"calculateEncodeData",value:function(t,o){return this.inited?oA(this,this.fontService,this.mapService,this.styleAttributeService,t,o):(console.warn("layer not inited!"),null)}},{key:"prepareBuildModel",value:function(){this.updateLayerConfig((0,z.Z)((0,z.Z)((0,z.Z)({},this.getDefaultConfig()),this.rawConfig),this.needUpdateConfig));var t=this.getLayerConfig(),o=t.animateOption;o!=null&&o.enable&&(this.layerService.startAnimate(),this.animateStatus=!0)}},{key:"color",value:function(t,o,u){return this.updateStyleAttribute("color",t,o,u),this}},{key:"texture",value:function(t,o,u){return this.updateStyleAttribute("texture",t,o,u),this}},{key:"rotate",value:function(t,o,u){return this.updateStyleAttribute("rotate",t,o,u),this}},{key:"size",value:function(t,o,u){return this.updateStyleAttribute("size",t,o,u),this}},{key:"filter",value:function(t,o,u){return this.updateStyleAttribute("filter",t,o,u),this}},{key:"shape",value:function(t,o,u){var l,p,v,x=(l=this.styleAttributeService)===null||l===void 0||(p=l.getLayerStyleAttribute("shape"))===null||p===void 0||(v=p.scale)===null||v===void 0?void 0:v.field,E=t;return this.shapeOption={field:t,values:o},this.updateStyleAttribute("shape",t,o,u),this.tileLayer||uA(this,x,E),this}},{key:"label",value:function(t,o,u){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:t,attributeValues:o,updateOptions:u}),this}},{key:"animate",value:function(t){var o={};return(0,St.isObject)(t)?(o.enable=!0,o=(0,z.Z)((0,z.Z)({},o),t)):o.enable=t,this.updateLayerConfig({animateOption:o}),this}},{key:"source",value:function(t,o){return(t==null?void 0:t.type)==="source"?(this.setSource(t),this):(this.sourceOption={data:t,options:o},this.clusterZoom=0,this)}},{key:"setData",value:function(t,o){var u=this;return this.inited?this.layerSource.setData(t,o):this.on("inited",function(){var l=u.getSource();l?u.layerSource.setData(t,o):u.source(new Cm(t,o))}),this}},{key:"style",value:function(t){var o=this,u=t.passes,l=(0,Za.Z)(t,fA);return u&&j_(u).forEach(function(p){var v=o.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(p[0]);v&&v.updateOptions(p[1])}),this.rawConfig=(0,z.Z)((0,z.Z)({},this.rawConfig),l),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),this}},{key:"scale",value:function(t,o){return(0,St.isObject)(t)?this.scaleOptions=(0,z.Z)((0,z.Z)({},this.scaleOptions),t):this.scaleOptions[t]=o,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.tileLayer?(this.tileLayer.render(),this):(this.layerService.beforeRenderData(this),this.encodeDataLength<=0&&!this.forceRender?this:(this.renderModels(),this))}},{key:"renderMultiPass",value:function(){var n=(0,de.Z)(q().mark(function o(){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(this.encodeDataLength<=0&&!this.forceRender)){l.next=2;break}return l.abrupt("return");case 2:if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){l.next=7;break}return l.next=5,this.multiPassRenderer.render();case 5:l.next=8;break;case 7:this.multiPassRenderer?this.renderModels():this.renderModels();case 8:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"active",value:function(t){var o={};return o.enableHighlight=(0,St.isObject)(t)?!0:t,(0,St.isObject)(t)?(o.enableHighlight=!0,t.color&&(o.highlightColor=t.color),t.mix&&(o.activeMix=t.mix)):o.enableHighlight=!!t,this.updateLayerConfig(o),this}},{key:"setActive",value:function(t,o){var u=this;if((0,St.isObject)(t)){var l=t.x,p=l===void 0?0:l,v=t.y,x=v===void 0?0:v;this.updateLayerConfig({highlightColor:(0,St.isObject)(o)?o.color:this.getLayerConfig().highlightColor,activeMix:(0,St.isObject)(o)?o.mix:this.getLayerConfig().activeMix}),this.pick({x:p,y:x})}else this.updateLayerConfig({pickedFeatureID:t,highlightColor:(0,St.isObject)(o)?o.color:this.getLayerConfig().highlightColor,activeMix:(0,St.isObject)(o)?o.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call(Ae(t)).then(function(){setTimeout(function(){u.reRender()},1)})}},{key:"select",value:function(t){var o={};return o.enableSelect=(0,St.isObject)(t)?!0:t,(0,St.isObject)(t)?(o.enableSelect=!0,t.color&&(o.selectColor=t.color),t.mix&&(o.selectMix=t.mix)):o.enableSelect=!!t,this.updateLayerConfig(o),this}},{key:"setSelect",value:function(t,o){var u=this;if((0,St.isObject)(t)){var l=t.x,p=l===void 0?0:l,v=t.y,x=v===void 0?0:v;this.updateLayerConfig({selectColor:(0,St.isObject)(o)?o.color:this.getLayerConfig().selectColor,selectMix:(0,St.isObject)(o)?o.mix:this.getLayerConfig().selectMix}),this.pick({x:p,y:x})}else this.updateLayerConfig({pickedFeatureID:t,selectColor:(0,St.isObject)(o)?o.color:this.getLayerConfig().selectColor,selectMix:(0,St.isObject)(o)?o.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(Ae(t)).then(function(){setTimeout(function(){u.reRender()},1)})}},{key:"setBlend",value:function(t){return this.updateLayerConfig({blend:t}),this.layerModelNeedUpdate=!0,this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this.emit("show"),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this.emit("hide"),this}},{key:"setIndex",value:function(t){return this.zIndex=t,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(t){this.currentPickId=t}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(t){this.selectedFeatureID=t}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var t=this.mapService.getZoom(),o=this.getLayerConfig(),u=o.visible,l=o.minZoom,p=l===void 0?-Infinity:l,v=o.maxZoom,x=v===void 0?Infinity:v;return!!u&&t>=p&&t<x}},{key:"setMultiPass",value:function(t,o){if(this.updateLayerConfig({enableMultiPassRenderer:t}),o&&this.updateLayerConfig({passes:o}),t){var u=this.getLayerConfig(),l=u.passes,p=l===void 0?[]:l;this.multiPassRenderer=G_(this,p,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var v=this.rendererService.getViewportSize(),x=v.width,E=v.height;this.multiPassRenderer.resize(x,E)}return this}},{key:"setMinZoom",value:function(t){return this.updateLayerConfig({minZoom:t}),this}},{key:"getMinZoom",value:function(){var t=this.getLayerConfig(),o=t.minZoom;return o}},{key:"getMaxZoom",value:function(){var t=this.getLayerConfig(),o=t.maxZoom;return o}},{key:"get",value:function(t){var o=this.getLayerConfig();return o[t]}},{key:"setMaxZoom",value:function(t){return this.updateLayerConfig({maxZoom:t}),this}},{key:"setAutoFit",value:function(t){return this.updateLayerConfig({autoFit:t}),this}},{key:"fitBounds",value:function(t){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var o=this.getSource(),u=o.extent,l=u.some(function(p){return Math.abs(p)===Infinity});return l?this:(this.mapService.fitBounds([[u[0],u[1]],[u[2],u[3]]],t),this)}},{key:"destroy",value:function(){var t,o,u,l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isDestroyed||(this.layerChildren.map(function(p){return p.destroy(!1)}),this.layerChildren=[],this.masks.map(function(p){return p.destroy(!1)}),this.masks=[],this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),(t=this.multiPassRenderer)===null||t===void 0||t.destroy(),this.textureService.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(o=this.layerModel)===null||o===void 0||o.clearModels(l),(u=this.tileLayer)===null||u===void 0||u.destroy(),this.models=[],this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroyed=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){var t;this.models.forEach(function(o){return o.destroy()}),(t=this.layerModel)===null||t===void 0||t.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(t){return t.needRescale||t.needRemapping||t.needRegenerateVertices}).length}},{key:"setSource",value:function(t){var o=this;if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=t,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var u=this.mapService.getZoom();this.layerSource.updateClusterData(u)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("update",function(l){var p=l.type;if(o.coordCenter===void 0){var v,x=o.layerSource.center;o.coordCenter=x,(v=o.mapService)!==null&&v!==void 0&&v.setCoordCenter&&o.mapService.setCoordCenter(x)}p==="update"&&o.sourceEvent()})}},{key:"initSource",value:function(t){this.layerSource=t,this.clusterZoom=0,this.addSourceEvent()}},{key:"getSource",value:function(){return this.layerSource}},{key:"addSourceEvent",value:function(){var t=this;this.layerSource.on("update",function(){if(t.coordCenter===void 0){var o,u=t.layerSource.center;t.coordCenter=u,(o=t.mapService)!==null&&o!==void 0&&o.setCoordCenter&&t.mapService.setCoordCenter(u)}t.sourceEvent()})}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(t){this.encodedData=t,this.encodeDataLength=t.length}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(t){return this.styleAttributeService.getLayerAttributeScale(t)}},{key:"getLegend",value:function(t){var o,u,l,p=this.styleAttributeService.getLayerStyleAttribute(t),v=(p==null||(o=p.scale)===null||o===void 0?void 0:o.scalers)||[];return{type:(u=v[0].option)===null||u===void 0?void 0:u.type,field:p==null||(l=p.scale)===null||l===void 0?void 0:l.field,items:this.getLegendItems(t)}}},{key:"getLegendItems",value:function(t){var o=this.styleAttributeService.getLayerAttributeScale(t);if(!o)return[];if(o.invertExtent){var u=o.range().map(function(v){return(0,Y.Z)({value:o.invertExtent(v)},t,v)});return u}else if(o.ticks){var l=o.ticks().map(function(v){return(0,Y.Z)({value:v},t,o(v))});return l}else if(o!=null&&o.domain){var p=o.domain().filter(function(v){return!(0,St.isUndefined)(v)}).map(function(v){return(0,Y.Z)({value:v},t,o(v))});return p}return[]}},{key:"pick",value:function(t){var o=t.x,u=t.y;this.interactionService.triggerHover({x:o,y:u})}},{key:"boxSelect",value:function(t,o){this.pickingService.boxPickLayer(this,t,o)}},{key:"buildLayerModel",value:function(){var n=(0,de.Z)(q().mark(function o(u){var l=this,p,v,x,E,C,T,O,L,B,H,oe,le,Re,Ne;return q().wrap(function(Ot){for(;;)switch(Ot.prev=Ot.next){case 0:return p=u.moduleName,v=u.vertexShader,x=u.fragmentShader,E=u.triangulation,C=u.segmentNumber,T=u.workerEnabled,O=T===void 0?!1:T,L=u.workerOptions,B=(0,Za.Z)(u,hA),this.shaderModuleService.registerModule(p,{vs:v,fs:x}),H=this.shaderModuleService.getModule(p),oe=H.vs,le=H.fs,Re=H.uniforms,Ne=this.rendererService.createModel,Ot.abrupt("return",new Promise(function(Nt,jt){if(L&&L.modelType in Xl&&O)l.styleAttributeService.createAttributesAndIndicesAscy(l.encodedData,C,L).then(function(Ca){var bo=Ca.attributes,Ao=Ca.elements,Ko=Ne((0,z.Z)({attributes:bo,uniforms:Re,fs:le,vs:oe,elements:Ao,blend:Mm[lf.normal]},B));Nt(Ko)}).catch(function(Ca){return jt(Ca)});else{var br=l.styleAttributeService.createAttributesAndIndices(l.encodedData,E,C),yr=br.attributes,Ur=br.elements,An=br.count,jn=(0,z.Z)({attributes:yr,uniforms:Re,fs:le,vs:oe,elements:Ur,blend:Mm[lf.normal]},B);An&&(jn.count=An);var Qi=Ne(jn);Nt(Qi)}}));case 5:case"end":return Ot.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"createAttributes",value:function(t){var o=t.triangulation,u=this.styleAttributeService.createAttributes(this.encodedData,o),l=u.attributes;return l}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.animateStatus&&(this.layerService.stopAnimate(),this.animateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(t){var o=this.getLayerConfig(),u=o.enableHighlight,l=u===void 0?!0:u,p=o.enableSelect,v=p===void 0?!0:p,x=this.eventNames().indexOf(t)!==-1||this.eventNames().indexOf("un"+t)!==-1;return(t==="click"||t==="dblclick")&&v&&(x=!0),t==="mousemove"&&(l||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(x=!0),this.isVisible()&&x}},{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return l.stop()}},o)}));function t(){return n.apply(this,arguments)}return t}()},{key:"rebuildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"renderMulPass",value:function(){var n=(0,de.Z)(q().mark(function o(u){return q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,u.render();case 2:case"end":return p.stop()}},o)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"renderModels",value:function(t){var o=this;return this.encodeDataLength<=0&&!this.forceRender?this:(this.hooks.beforeRender.call(),this.models.forEach(function(u){u.draw({uniforms:o.layerModel.getUninforms()},t)}),this.hooks.afterRender.call(),this)}},{key:"updateStyleAttribute",value:function(t,o,u,l){["color","size","texture","rotate","filter","label","shape"].indexOf(t)!==-1&&this.configService.setAttributeConfig(this.id,(0,Y.Z)({},t,{field:o,values:u})),this.startInit?this.styleAttributeService.updateStyleAttribute(t,{scale:(0,z.Z)({field:o},this.splitValuesAndCallbackInAttribute(u,this.getLayerConfig()[o]))},l):this.pendingStyleAttributes.push({attributeName:t,attributeField:o,attributeValues:u,updateOptions:l})}},{key:"getLayerAttributeConfig",value:function(){return this.configService.getAttributeConfig(this.id)}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(t){console.warn("empty fn")}},{key:"processData",value:function(t){return t}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"initLayerModels",value:function(){var n=(0,de.Z)(q().mark(function o(){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.models.forEach(function(p){return p.destroy()}),this.models=[],l.next=4,this.layerModel.initModels();case 4:this.models=l.sent;case 5:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"reRender",value:function(){this.inited&&this.layerService.reRender()}},{key:"splitValuesAndCallbackInAttribute",value:function(t,o){return{values:(0,St.isFunction)(t)?void 0:t||o,callback:(0,St.isFunction)(t)?t:void 0}}}]),r}(Ns.EventEmitter),W_=na(km.prototype,"configService",[H_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),km),Y_,Im,q_;function gA(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=yA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function yA(e,i){if(!!e){if(typeof e=="string")return K_(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return K_(e,i)}}function K_(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Ba=(Y_=Em(Yt.IGlobalConfigService),Im=function(){function e(i){(0,xt.Z)(this,e),ra(this,"configService",q_,this),this.layer=i,this.rendererService=i.getContainer().get(Yt.IRendererService),this.pickingService=i.getContainer().get(Yt.IPickingService),this.shaderModuleService=i.getContainer().get(Yt.IShaderModuleService),this.styleAttributeService=i.getContainer().get(Yt.IStyleAttributeService),this.mapService=i.getContainer().get(Yt.IMapService),this.iconService=i.getContainer().get(Yt.IIconService),this.fontService=i.getContainer().get(Yt.IFontService),this.cameraService=i.getContainer().get(Yt.ICameraService),this.layerService=i.getContainer().get(Yt.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var r=this.rendererService.createTexture2D;this.createTexture2D=r,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertiesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8Array(4),mag:$.NEAREST,min:$.NEAREST,width:1,height:1}))}return(0,wt.Z)(e,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertiesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertiesExist.hasOpacity,this.stylePropertiesExist.hasStrokeOpacity,this.stylePropertiesExist.hasStrokeWidth,this.stylePropertiesExist.hasStroke,this.stylePropertiesExist.hasOffsets,this.stylePropertiesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(r){var n=!1;return(0,St.isEqual)(r.thetaOffset,this.cacheStyleProperties.thetaOffset)||(n=!0,this.cacheStyleProperties.thetaOffset=r.thetaOffset),(0,St.isEqual)(r.opacity,this.cacheStyleProperties.opacity)||(n=!0,this.cacheStyleProperties.opacity=r.opacity),(0,St.isEqual)(r.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(n=!0,this.cacheStyleProperties.strokeOpacity=r.strokeOpacity),(0,St.isEqual)(r.strokeWidth,this.cacheStyleProperties.strokeWidth)||(n=!0,this.cacheStyleProperties.strokeWidth=r.strokeWidth),(0,St.isEqual)(r.stroke,this.cacheStyleProperties.stroke)||(n=!0,this.cacheStyleProperties.stroke=r.stroke),(0,St.isEqual)(r.offsets,this.cacheStyleProperties.offsets)||(n=!0,this.cacheStyleProperties.offsets=r.offsets),this.dataTexture===void 0&&(n=!0),n}},{key:"judgeStyleAttributes",value:function(r){this.clearLastCalRes(),r.opacity!==void 0&&!(0,St.isNumber)(r.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertiesExist.hasOpacity=1,this.cellLength+=1),r.strokeOpacity!==void 0&&!(0,St.isNumber)(r.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertiesExist.hasStrokeOpacity=1,this.cellLength+=1),r.strokeWidth!==void 0&&!(0,St.isNumber)(r.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertiesExist.hasStrokeWidth=1,this.cellLength+=1),r.stroke!==void 0&&!this.isStaticColor(r.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertiesExist.hasStroke=1,this.cellLength+=4),r.offsets!==void 0&&!this.isOffsetStatic(r.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertiesExist.hasOffsets=1,this.cellLength+=2),r.thetaOffset!==void 0&&!(0,St.isNumber)(r.thetaOffset)&&(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertiesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(r){return(0,St.isString)(r)?!!(0,G.ZP)(r):!1}},{key:"getStrokeColor",value:function(r){if(this.isStaticColor(r)){var n=he(r);return n[0]=n[0]?n[0]:0,n[1]=n[1]?n[1]:0,n[2]=n[2]?n[2]:0,n[3]=n[3]?n[3]:0,n}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(r){return!!(Array.isArray(r)&&r.length===2&&(0,St.isNumber)(r[0])&&(0,St.isNumber)(r[1]))}},{key:"patchMod",value:function(r,n){for(var t=0;t<n;t++)r.push(-1)}},{key:"patchData",value:function(r,n,t){var o=gA(t),u;try{for(o.s();!(u=o.n()).done;){var l=u.value,p=l.attr,v=l.count,x=n[p];x!==void 0?p==="stroke"?r.push.apply(r,(0,N.Z)(he(x))):p==="offsets"?this.isOffsetStatic(x)?r.push(-x[0],x[1]):r.push(0,0):r.push((0,St.isNumber)(x)?x:1):this.patchMod(r,v)}}catch(E){o.e(E)}finally{o.f()}}},{key:"calDataFrame",value:function(r,n,t){for(var o=n.length,u=Math.ceil(o*r/this.DATA_TEXTURE_WIDTH),l=u*this.DATA_TEXTURE_WIDTH,p=[],v=0;v<o;v++){var x=n[v];this.patchData(p,x,t)}for(var E=p.length;E<l;E++)p.push(-1);return{data:p,width:this.DATA_TEXTURE_WIDTH,height:u}}},{key:"getBlend",value:function(){var r=this.layer.getLayerConfig(),n=r.blend,t=n===void 0?"normal":n;return Mm[lf[t]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){var i=(0,de.Z)(q().mark(function n(){return q().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return o.stop()}},n)}));function r(){return i.apply(this,arguments)}return r}()},{key:"initModels",value:function(){var i=(0,de.Z)(q().mark(function n(){return q().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return o.stop()}},n)}));function r(){return i.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.duration||4,r.interval||.2,r.trailLength||.1]}},{key:"startModelAnimate",value:function(){var r=this.layer.getLayerConfig(),n=r.animateOption;n.enable&&this.layer.setAnimateStartTime()}}]),e}(),q_=na(Im.prototype,"configService",[Y_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Im),Pm=100,rR=36,nR=40;function Q_(e){return e/180*Math.acos(-1)}function J_(e){var i=Q_(e[0])+Math.PI/2,r=Q_(e[1]),n=Pm+Math.random()*.4,t=n*Math.cos(r)*Math.cos(i),o=n*Math.cos(r)*Math.sin(i),u=n*Math.sin(r);return[o,u,t]}function iR(e,i){var r=mat4.create(),n=mat4.create(),t=vec3.fromValues(0,1,0),o=vec3.fromValues(0,0,0);i=i||{},e=typeof e!="undefined"?e:1;for(var u=typeof i.segments!="undefined"?i.segments:32,l=2+u,p=2*l,v=[],x=[],E=[],C=[],T=[],O=[],L=0;L<=l;L++){for(var B=L/l,H=B*Math.PI,oe=0;oe<=p;oe++){var le=oe/p,Re=le*Math.PI*2;mat4.identity(n),mat4.rotateZ(n,n,-H),mat4.identity(r),mat4.rotateY(r,r,Re),vec3.transformMat4(o,t,n),vec3.transformMat4(o,o,r),vec3.scale(o,o,-e),E.push(o.slice()),C.push.apply(C,_toConsumableArray(o.slice())),vec3.normalize(o,o),T.push.apply(T,_toConsumableArray(o.slice())),O.push([le,1-B]),C.push(le,1-B)}if(L>0)for(var Ne=E.length,ut=Ne-2*(p+1);ut+p+2<Ne;ut++)v.push([ut,ut+1,ut+p+1]),x.push(ut,ut+1,ut+p+1),v.push([ut+p+1,ut+1,ut+p+2]),x.push(ut+p+1,ut+1,ut+p+2)}return{cells:v,positions:E,uvs:O,positionsArr:C,indicesArr:x,normalArr:T}}var a0=qr.create(),aR=qr.create(),Ys=qr.create(),rp=qr.create(),wd=qr.create();function Rm(e,i,r,n,t){qr.add(e,r,n),qr.normalize(e,e),i=qr.fromValues(-e[1],e[0]);var o=qr.fromValues(-r[1],r[0]);return[t/qr.dot(i,o),i]}function np(e,i){return qr.set(e,-i[1],i[0])}function Cd(e,i,r){return qr.sub(e,i,r),qr.normalize(e,e),e}function Om(e,i){return e[0]===i[0]&&e[1]===i[1]}function oR(e){for(var i=new Map,r=0;r<e.length;r++){var n=e[0].toString()+"-"+e[1].toString();i.get(n)?(e.splice(r,1),r++):i.set(n,n)}return e}var _A=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,xt.Z)(this,e),(0,Y.Z)(this,"lastFlip",-1),(0,Y.Z)(this,"miter",qr.fromValues(0,0)),(0,Y.Z)(this,"started",!1),(0,Y.Z)(this,"dash",!1),(0,Y.Z)(this,"totalDistance",0),(0,Y.Z)(this,"currentIndex",0),this.join=i.join||"miter",this.cap=i.cap||"butt",this.miterLimit=i.miterLimit||10,this.thickness=i.thickness||1,this.dash=i.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,wt.Z)(e,[{key:"simpleExtrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var t=r.length,o=n.startIndex,u=1;u<t;u++){var l=r[u-1],p=r[u],v=u<r.length-1?r[u+1]:null,x=this.simpleSegment(n,o,l,p,v);o+=x}if(this.dash)for(var E=0;E<n.positions.length/6;E++)n.positions[E*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude_gaode2",value:function(r,n){var t=this.complex;if(r.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=r.length,u=t.startIndex,l=1;l<o;l++){var p,v,x,E=r[l-1];E.push((p=n[l-1][2])!==null&&p!==void 0?p:0);var C=n[l-1],T=r[l];T.push((v=n[l][2])!==null&&v!==void 0?v:0);var O=n[l],L=l<r.length-1?[].concat((0,N.Z)(r[l+1]),[(x=n[l+1][2])!==null&&x!==void 0?x:0]):null,B=l<n.length-1?n[l+1]:null,H=this.simpleSegment(t,u,E,T,L,C,O,B);u+=H}if(this.dash)for(var oe=0;oe<t.positions.length/6;oe++)t.positions[oe*6+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"extrude_gaode2",value:function(r,n){var t=this.complex;if(r.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=r.length,u=t.startIndex,l=1;l<o;l++){var p,v,x,E=r[l-1];E.push((p=n[l-1][2])!==null&&p!==void 0?p:0);var C=n[l-1],T=r[l];T.push((v=n[l][2])!==null&&v!==void 0?v:0);var O=n[l],L=l<r.length-1?[].concat((0,N.Z)(r[l+1]),[(x=n[l+1][2])!==null&&x!==void 0?x:0]):null,B=l<n.length-1?n[l+1]:null,H=this.segment_gaode2(t,u,E,T,L,C,O,B);u+=H}if(this.dash)for(var oe=0;oe<t.positions.length/6;oe++)t.positions[oe*6+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"extrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var t=r.length,o=n.startIndex,u=1;u<t;u++){var l=r[u-1],p=r[u],v=u<r.length-1?r[u+1]:null,x=this.segment(n,o,l,p,v);o+=x}if(this.dash)for(var E=0;E<n.positions.length/6;E++)n.positions[E*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleSegment",value:function(r,n,t,o,u){var l=0,p=r.indices,v=r.positions,x=r.normals,E=Eo([o[0],o[1]]),C=Eo([t[0],t[1]]);Cd(Ys,E,C);var T=0;if(this.dash&&(T=this.lineSegmentDistance(E,C),this.totalDistance+=T),this.normal||(this.normal=qr.create(),np(this.normal,Ys)),this.started||(this.started=!0,this.extrusions(v,x,t,this.normal,this.thickness,this.totalDistance-T)),p.push(n+0,n+1,n+2),!u)np(this.normal,Ys),this.extrusions(v,x,o,this.normal,this.thickness,this.totalDistance),p.push.apply(p,(0,N.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2;else{var O=Eo([u[0],u[1]]);Om(E,O)&&qr.add(O,E,qr.normalize(O,qr.subtract(O,E,C))),Cd(rp,O,E);var L=Rm(wd,qr.create(),Ys,rp,this.thickness),B=(0,hr.Z)(L,2),H=B[0],oe=B[1],le=qr.dot(wd,this.normal)<0?-1:1;this.extrusions(v,x,o,oe,H,this.totalDistance),p.push.apply(p,(0,N.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),le=-1,qr.copy(this.normal,oe),l+=2,this.lastFlip=le}return l}},{key:"segment_gaode2",value:function(r,n,t,o,u,l,p,v){var x=0,E=r.indices,C=r.positions,T=r.normals,O=this.cap==="square",L=this.join==="bevel",B=Eo([p[0],p[1]]),H=Eo([l[0],l[1]]);Cd(Ys,o,t);var oe=0;if(this.dash&&(oe=this.lineSegmentDistance(B,H),this.totalDistance+=oe),this.normal||(this.normal=qr.create(),np(this.normal,Ys)),!this.started)if(this.started=!0,O){var le=qr.create(),Re=qr.create();qr.add(le,this.normal,Ys),qr.add(Re,this.normal,Ys),T.push(Re[0],Re[1],0),T.push(le[0],le[1],0),C.push(t[0],t[1],t[2]|0,this.totalDistance-oe,-this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),C.push(t[0],t[1],t[2]|0,this.totalDistance-oe,this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(C,T,t,this.normal,this.thickness,this.totalDistance-oe);if(E.push(n+0,n+1,n+2),u){Om(o,u)&&qr.add(u,o,qr.normalize(u,qr.subtract(u,o,t))),Cd(rp,u,o);var Ot=Rm(wd,qr.create(),Ys,rp,this.thickness),Nt=(0,hr.Z)(Ot,2),jt=Nt[0],br=Nt[1],yr=qr.dot(wd,this.normal)<0?-1:1,Ur=L;if(!Ur&&this.join==="miter"){var An=jt;An>this.miterLimit&&(Ur=!0)}Ur?(T.push(this.normal[0],this.normal[1],0),T.push(br[0],br[1],0),C.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*yr,o[2]|0),this.complex.indexes.push(this.currentIndex),C.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*yr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,E.push.apply(E,(0,N.Z)(this.lastFlip!==-yr?[n,n+2,n+3]:[n+2,n+1,n+3])),E.push(n+2,n+3,n+4),np(a0,rp),qr.copy(this.normal,a0),T.push(this.normal[0],this.normal[1],0),C.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*yr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,x+=3):(this.extrusions(C,T,o,br,jt,this.totalDistance),E.push.apply(E,(0,N.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),yr=-1,qr.copy(this.normal,br),x+=2),this.lastFlip=yr}else{if(np(this.normal,Ys),O){var Ne=qr.create(),ut=qr.create();qr.sub(ut,Ys,this.normal),qr.add(Ne,Ys,this.normal),T.push(ut[0],ut[1],0),T.push(Ne[0],Ne[1],0),C.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),C.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(C,T,o,this.normal,this.thickness,this.totalDistance);E.push.apply(E,(0,N.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),x+=2}return x}},{key:"segment",value:function(r,n,t,o,u){var l=0,p=r.indices,v=r.positions,x=r.normals,E=this.cap==="square",C=this.join==="bevel",T=Eo([o[0],o[1]]),O=Eo([t[0],t[1]]);Cd(Ys,T,O);var L=0;if(this.dash&&(L=this.lineSegmentDistance(T,O),this.totalDistance+=L),this.normal||(this.normal=qr.create(),np(this.normal,Ys)),!this.started)if(this.started=!0,E){var B=qr.create(),H=qr.create();qr.add(B,this.normal,Ys),qr.add(H,this.normal,Ys),x.push(H[0],H[1],0),x.push(B[0],B[1],0),v.push(t[0],t[1],t[2]|0,this.totalDistance-L,-this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),v.push(t[0],t[1],t[2]|0,this.totalDistance-L,this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(v,x,t,this.normal,this.thickness,this.totalDistance-L);if(p.push(n+0,n+1,n+2),u){var Re=Eo([u[0],u[1]]);Om(T,Re)&&qr.add(Re,T,qr.normalize(Re,qr.subtract(Re,T,O))),Cd(rp,Re,T);var Ne=Rm(wd,qr.create(),Ys,rp,this.thickness),ut=(0,hr.Z)(Ne,2),Ot=ut[0],Nt=ut[1],jt=qr.dot(wd,this.normal)<0?-1:1,br=C;if(!br&&this.join==="miter"){var yr=Ot;yr>this.miterLimit&&(br=!0)}br?(x.push(this.normal[0],this.normal[1],0),x.push(Nt[0],Nt[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*jt,o[2]|0),this.complex.indexes.push(this.currentIndex),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*jt,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,p.push.apply(p,(0,N.Z)(this.lastFlip!==-jt?[n,n+2,n+3]:[n+2,n+1,n+3])),p.push(n+2,n+3,n+4),np(a0,rp),qr.copy(this.normal,a0),x.push(this.normal[0],this.normal[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*jt,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l+=3):(this.extrusions(v,x,o,Nt,Ot,this.totalDistance),p.push.apply(p,(0,N.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),jt=-1,qr.copy(this.normal,Nt),l+=2),this.lastFlip=jt}else{if(np(this.normal,Ys),E){var oe=qr.create(),le=qr.create();qr.sub(le,Ys,this.normal),qr.add(oe,Ys,this.normal),x.push(le[0],le[1],0),x.push(oe[0],oe[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(v,x,o,this.normal,this.thickness,this.totalDistance);p.push.apply(p,(0,N.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2}return l}},{key:"extrusions",value:function(r,n,t,o,u,l){n.push(o[0],o[1],0),n.push(o[0],o[1],0),r.push(t[0],t[1],t[2]|0,l,-u,t[2]|0),this.complex.indexes.push(this.currentIndex),r.push(t[0],t[1],t[2]|0,l,u,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(r,n){var t=n[0]-r[0],o=n[1]-r[1];return Math.sqrt(t*t+o*o)}}]),e}(),to=K(77160);function xA(e){var i=e[0][0],r=e[0][e[0].length-1];i[0]===r[0]&&i[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var n=e[0].length,t=Bs().flatten(e),o=t.vertices,u=t.dimensions,l=[],p=[],v=0;v<o.length/u;v++)u===2?l.push(o[v*2],o[v*2+1],1):l.push(o[v*3],o[v*3+1],1);var x=Bs()(t.vertices,t.holes,t.dimensions);p.push.apply(p,(0,N.Z)(x));for(var E=function(O){var L=t.vertices.slice(O*u,(O+1)*u),B=t.vertices.slice((O+1)*u,(O+2)*u);B.length===0&&(B=t.vertices.slice(0,u));var H=l.length/3;l.push(L[0],L[1],1,B[0],B[1],1,L[0],L[1],0,B[0],B[1],0),p.push.apply(p,(0,N.Z)([0,2,1,2,3,1].map(function(oe){return oe+H})))},C=0;C<n;C++)E(C);return{positions:l,index:p}}function bA(e){var i=Bs().flatten(e),r=Bs()(i.vertices,i.holes,i.dimensions);return{positions:i.vertices,index:r}}function e1(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=e[0][0],n=e[0][e[0].length-1];r[0]===n[0]&&r[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var t=e[0].length,o=Bs().flatten(e),u=o.vertices,l=o.dimensions,p=[],v=[],x=[],E=0;E<u.length/l;E++)l===2?p.push(u[E*2],u[E*2+1],1,-1,-1):p.push(u[E*3],u[E*3+1],1,-1,-1),x.push(0,0,1);var C=Bs()(o.vertices,o.holes,o.dimensions);v.push.apply(v,(0,N.Z)(C));for(var T=function(B){var H=o.vertices.slice(B*l,(B+1)*l),oe=o.vertices.slice((B+1)*l,(B+2)*l);oe.length===0&&(oe=o.vertices.slice(0,l));var le=p.length/5;p.push(H[0],H[1],1,0,0,oe[0],oe[1],1,.1,0,H[0],H[1],0,0,.8,oe[0],oe[1],0,.1,.8);var Re=EA([oe[0],oe[1],1],[H[0],H[1],0],[H[0],H[1],1],i);x.push.apply(x,(0,N.Z)(Re).concat((0,N.Z)(Re),(0,N.Z)(Re),(0,N.Z)(Re))),v.push.apply(v,(0,N.Z)([1,2,0,3,2,1].map(function(Ne){return Ne+le})))},O=0;O<t;O++)T(O);return{positions:p,index:v,normals:x}}function EA(e,i,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,t=to.create(),o=to.create(),u=to.create();n&&(e=Io(e),i=Io(i),r=Io(r));var l=to.fromValues.apply(to,(0,N.Z)(e)),p=to.fromValues.apply(to,(0,N.Z)(i)),v=to.fromValues.apply(to,(0,N.Z)(r));to.sub(t,v,p),to.sub(o,l,p),to.cross(u,t,o);var x=to.create();return to.normalize(x,u),x}var Ic,Np;(function(e){e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn"})(Np||(Np={}));var zp;(function(e){e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon"})(zp||(zp={}));function fv(e){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=Math.PI*2/e,n=[],t=0;t<e;t++)n.push(r*t+i*Math.PI/12);var o=n.map(function(u){var l=Math.sin(u+Math.PI/4),p=Math.cos(u+Math.PI/4);return[l,p,0]});return o}function t1(){return fv(30)}function r1(){return fv(4)}function n1(){return fv(3)}function i1(){return fv(6,1)}function a1(){return fv(5)}var Ad=(Ic={},(0,Y.Z)(Ic,zp.CIRCLE,t1),(0,Y.Z)(Ic,zp.HEXAGON,i1),(0,Y.Z)(Ic,zp.TRIANGLE,n1),(0,Y.Z)(Ic,zp.SQUARE,r1),(0,Y.Z)(Ic,zp.PENTAGON,a1),(0,Y.Z)(Ic,Np.CYLINDER,t1),(0,Y.Z)(Ic,Np.HEXAGONCOLUMN,i1),(0,Y.Z)(Ic,Np.TRIANGLECOLUMN,n1),(0,Y.Z)(Ic,Np.SQUARECOLUMN,r1),(0,Y.Z)(Ic,Np.PENTAGONCOLUMN,a1),Ic),o0={};function Zp(e){var i=h(e.coordinates);return{vertices:[].concat((0,N.Z)(i),(0,N.Z)(i),(0,N.Z)(i),(0,N.Z)(i)),indices:[0,1,2,2,3,0],size:i.length}}function o1(e){var i=h(e.coordinates),r=J_(i);return{vertices:[].concat((0,N.Z)(r),(0,N.Z)(r),(0,N.Z)(r),(0,N.Z)(r)),indices:[0,1,2,2,3,0],size:r.length}}function Lm(e){var i=e.shape,r=kA(i,!1),n=r.positions,t=r.index,o=r.normals;return{vertices:n,indices:t,normals:o,size:5}}function SA(e){var i=h(e.coordinates);return{vertices:(0,N.Z)(i),indices:[0],size:i.length}}function Up(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,t=new _A({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var o=i;Array.isArray(o[0][0])||(o=[i]);var u=r;Array.isArray(u[0][0])||(u=[r]);for(var l=0;l<o.length;l++){var p=o[l],v=u[l];t.extrude_gaode2(p,v)}}else{var x=i;x[0]&&!Array.isArray(x[0][0])&&(x=[i]),x.forEach(function(C){t.extrude(C)})}var E=t.complex;return{vertices:E.positions,indices:E.indices,normals:E.normals,indexes:E.indexes,size:6}}function wA(e){var i=e.coordinates,r=[];if(!Array.isArray(i[0]))return{vertices:[],indices:[],normals:[],size:6,count:0};var n=CA(i),t=n.results,o=n.totalDistance;return t.map(function(u){r.push(u[0],u[1],u[2],u[3],0,o)}),{vertices:r,indices:[],normals:[],size:6,count:t.length}}function sR(e){var i=e.coordinates,r=[];if(!Array.isArray(i[0]))return{vertices:[],indices:[],size:4,count:0};var n=AA(i),t=n.results;return t.map(function(o){r.push(o[0],o[1],o[2],o[3])}),{vertices:r,indices:[],size:4,count:t.length}}function s1(e,i){var r=i[0]-e[0],n=i[1]-e[1];return Math.sqrt(r*r+n*n)}function Td(e,i){return e.length<3&&e.push(0),i!==void 0&&e.push(i),e}function CA(e){var i=e;Array.isArray(i)&&Array.isArray(i[0])&&Array.isArray(i[0][0])&&(i=e.flat());var r=0;if(i.length<2)return{results:i,totalDistance:0};var n=[],t=Td(i[0],r);n.push(t);for(var o=1;o<i.length-1;o++){var u=s1(i[o-1],i[o]);r+=u;var l=Td(i[o],r);n.push(l),n.push(l)}var p=s1(i[i.length-2],i[i.length-1]);return r+=p,n.push(Td(i[i.length-1],r)),{results:n,totalDistance:r}}function AA(e){if(e.length<2)return{results:e};var i=[],r=Td(e[0]);i.push(r);for(var n=1;n<e.length-1;n++){var t=Td(e[n]);i.push(t),i.push(t)}return i.push(Td(e[e.length-1])),{results:i}}function hv(e){var i=e.coordinates,r=Bs().flatten(i),n=r.vertices,t=r.dimensions,o=r.holes;return{indices:Bs()(n,o,t),vertices:n,size:t}}function TA(e){var i=e.coordinates,r=Bs().flatten(i),n=r.vertices,t=r.dimensions,o=r.holes;return{indices:Bs()(n,o,t),vertices:MA(n),size:t+4}}function MA(e){for(var i=[],r=g(e),n=r.center,t=r.radius,o=0;o<e.length;o+=2){var u=e[o],l=e[o+1];i.push.apply(i,[u,l,0].concat((0,N.Z)(n),[t]))}return i}function u1(e){var i=e.coordinates,r=e1(i,!0),n=r.positions,t=r.index,o=r.normals;return{vertices:n,indices:t,normals:o,size:5}}function l1(e){var i=e.shape,r=PA(i),n=r.positions,t=r.index;return{vertices:n,indices:t,size:3}}function s0(e){var i=e.coordinates,r=[].concat((0,N.Z)(i[0]),[0,0,1,i[1][0],i[0][1],0,1,1],(0,N.Z)(i[1]),[0,1,0],(0,N.Z)(i[0]),[0,0,1],(0,N.Z)(i[1]),[0,1,0,i[0][0],i[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:r,indices:n,size:5}}function u0(e,i){for(var r=i||30,n=e.coordinates,t=[],o=[],u=function(v){t.push(v,1,v,n[0][0],n[0][1],n[1][0],n[1][1],v,-1,v,n[0][0],n[0][1],n[1][0],n[1][1]),v!==r-1&&o.push.apply(o,(0,N.Z)([0,1,2,1,3,2].map(function(x){return v*2+x})))},l=0;l<r;l++)u(l);return{vertices:t,indices:o,size:7}}function c1(e){var i=e.coordinates;i.length===2&&i.push(0);var r=l0(-1,1),n=l0(1,1),t=l0(-1,-1),o=l0(1,-1),u=[].concat((0,N.Z)(i),(0,N.Z)(r),(0,N.Z)(i),(0,N.Z)(t),(0,N.Z)(i),(0,N.Z)(o),(0,N.Z)(i),(0,N.Z)(n)),l=[0,1,2,3,0,2];return{vertices:u,indices:l,size:5}}function kA(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(o0&&o0[e])return o0[e];var r=Ad[e]?Ad[e]():Ad.cylinder(),n=e1([r],i);return o0[e]=n,n}function uR(e,i){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,t=new Float32Array(e.length/r*3),o,u,l,p=vec3.create(),v=vec3.create(),x=vec3.create(),E=0,C=i.length;E<C;E+=3){o=i[E+0]*3,u=i[E+1]*3,l=i[E+2]*3;var T=[e[o],e[o+1]],O=[e[u],e[u+1]],L=[e[l],e[l+1]];n&&(T=lngLatToMeters(T),O=lngLatToMeters(O),L=lngLatToMeters(L));var B=T,H=_slicedToArray(B,2),oe=H[0],le=H[1],Re=vec3.fromValues(oe,le,e[o+2]),Ne=O,ut=_slicedToArray(Ne,2),Ot=ut[0],Nt=ut[1],jt=vec3.fromValues(Ot,Nt,e[u+2]),br=L,yr=_slicedToArray(br,2),Ur=yr[0],An=yr[1],jn=vec3.fromValues(Ur,An,e[l+2]);vec3.sub(p,jn,jt),vec3.sub(v,Re,jt),vec3.cross(x,p,v),t[o]+=p[0],t[o+1]+=p[1],t[o+2]+=p[2],t[u]+=p[0],t[u+1]+=p[1],t[u+2]+=p[2],t[l]+=p[0],t[l+1]+=p[1],t[l+2]+=p[2]}return IA(t),t}function IA(e){for(var i=0,r=e.length;i<r;i+=3){var n=vec3.fromValues(e[i],e[i+1],e[i+2]),t=vec3.create();vec3.normalize(t,n),e.set(t,i)}}function lR(e){var i=e[0][0],r=e[0][e[0].length-1];return i[0]===r[0]&&i[1]===r[1]}function PA(e){var i=["cylinder","triangleColumn","hexagonColumn","squareColumn"],r=Ad[e]?Ad[e]():Ad.circle(),n=i.indexOf(e)===-1?bA([r]):xA([r]);return n}function l0(e,i){var r=(e+1)/2,n=(i+1)/2;return[r,n]}function cR(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function fR(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function RA(e){var i=OA();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function OA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var LA=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

uniform float u_circleSweep;
uniform float u_cityMinSize;
uniform vec3 u_circleSweepColor;
uniform float u_circleSweepSpeed;

varying float v_worldDis;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    gl_FragColor.rgb += r * r * u_circleSweepColor;
  }
   
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,DA=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

uniform float u_circleSweep;
uniform vec2 u_cityCenter;

varying float v_worldDis;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,FA=function(e){(0,gr.Z)(r,e);var i=RA(r);function r(){return(0,xt.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.baseColor,p=l===void 0?"rgb(16,16,16)":l,v=t.brightColor,x=v===void 0?"rgb(255,176,38)":v,E=t.windowColor,C=E===void 0?"rgb(30,60,89)":E,T=t.time,O=T===void 0?0:T,L=t.sweep,B=L===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:L;return{u_cityCenter:B.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*B.sweepRadius,u_circleSweep:B.enable?1:0,u_circleSweepColor:he(B.sweepColor).slice(0,3),u_circleSweepSpeed:B.sweepSpeed,u_opacity:u,u_baseColor:he(p),u_brightColor:he(x),u_windowColor:he(C),u_time:this.layer.getLayerAnimateTime()||O}}},{key:"calCityGeo",value:function(){var t=(0,hr.Z)(this.layer.getSource().extent,4),o=t[0],u=t[1],l=t[2],p=t[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(l+o)/2,(p+u)/2]);var v=this.mapService.lngLatToCoord([l,p]),x=this.mapService.lngLatToCoord([o,u]);this.cityMinSize=Math.sqrt(Math.pow(v[0]-x[0],2)+Math.pow(v[1]-x[1],2))/4}else{var E=l-o,C=p-u;this.cityCenter=[(l+o)/2,(p+u)/2],this.cityMinSize=Math.sqrt(Math.pow(E,2)+Math.pow(C,2))/4}}},{key:"initModels",value:function(){var n=(0,de.Z)(q().mark(function o(){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.calCityGeo(),this.startModelAnimate(),l.next=4,this.buildModels();case 4:return l.abrupt("return",l.sent);case 5:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u;return q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:DA,fragmentShader:LA,triangulation:u1,depth:{enable:!0},cull:{enable:!0,face:$.BACK}});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:_n.Attribute,descriptor:{name:"a_Normal",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(o,u,l,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(o){var u=o.size,l=u===void 0?10:u;return Array.isArray(l)?[l[0]]:[l]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:_n.Attribute,descriptor:{name:"a_Uv",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}})}}]),r}(Ba);function BA(e){var i=NA();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function NA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zA=function(e){(0,gr.Z)(r,e);var i=BA(r);function r(){var n;(0,xt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,De.Z)(n),"type","CityBuildingLayer"),n}return(0,wt.Z)(r,[{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.layerModel=new FA(this),l.next=3,this.initLayerModels();case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"setLight",value:function(t){this.updateLayerConfig({time:t})}},{key:"getModelType",value:function(){return"citybuilding"}}]),r}(tp);function ZA(e){var i=UA();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function UA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var VA=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,jA=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,GA=function(e){(0,gr.Z)(r,e);var i=ZA(r);function r(){return(0,xt.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=t.coverage,l=t.angle;return{u_opacity:o||1,u_coverage:u||.9,u_angle:l||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){var n=(0,de.Z)(q().mark(function o(){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p,v,x,E;return q().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,T.next=3,this.layer.buildLayerModel({moduleName:"heatmapGrid",vertexShader:VA,fragmentShader:jA,triangulation:l1,primitive:$.TRIANGLES,depth:{enable:!1},stencil:Xe(p,x)});case 3:return E=T.sent,T.abrupt("return",[E]);case 5:case"end":return T.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:_n.Attribute,descriptor:{name:"a_Pos",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(o){var u=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[u[0],u[1],0]}}})}}]),r}(Ba);function HA(e){var i=WA();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function WA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var XA=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));


  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
 
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,$A=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,YA=function(e){(0,gr.Z)(r,e);var i=HA(r);function r(){return(0,xt.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=t.coverage,l=t.angle;return{u_opacity:o||1,u_coverage:u||1,u_angle:l||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){var n=(0,de.Z)(q().mark(function o(){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p,v,x,E;return q().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,T.next=3,this.layer.buildLayerModel({moduleName:"heatmapGrid3d",vertexShader:XA,fragmentShader:$A,triangulation:Lm,primitive:$.TRIANGLES,depth:{enable:!0},blend:this.getBlend(),stencil:Xe(p,x)});case 3:return E=T.sent,T.abrupt("return",[E]);case 5:case"end":return T.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(o){var u=o.size;return Array.isArray(u)?[u[0]]:[u]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:_n.Attribute,descriptor:{name:"a_Normal",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(o,u,l,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:_n.Attribute,descriptor:{name:"a_Pos",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(o){var u=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[u[0],u[1],0]}}})}}]),r}(Ba);function qA(e,i){for(var r=[],n=[],t=[],o=e+1,u=i+1,l=e/2,p=i/2,v=0;v<u;v++)for(var x=v-p,E=0;E<o;E++){var C=E-l;n.push(C/l,-x/p,0),t.push(E/e),t.push(1-v/i)}for(var T=0;T<i;T++)for(var O=0;O<e;O++){var L=O+o*T,B=O+o*(T+1),H=O+1+o*(T+1),oe=O+1+o*T;r.push(L,B,oe),r.push(B,H,oe)}return{vertices:n,indices:r,uvs:t}}var f1,h1;function KA(e){var i=QA();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function QA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var JA=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,e3=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,t3=`uniform sampler2D u_texture;        // \u70ED\u529B\u5F3A\u5EA6\u56FE
uniform sampler2D u_colorTexture;   // \u6839\u636E\u5F3A\u5EA6\u5206\u5E03\u7684\u8272\u5E26
uniform float u_opacity;
varying vec2 v_texCoord;

uniform vec2 u_ViewportSize;

float getBlurIndusty() {
    float vW = 2.0/u_ViewportSize.x;
    float vH = 2.0/u_ViewportSize.y;
    vec2 vUv = v_texCoord;
    float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;

    float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y) ).r;
    float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;
    float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y) ).r;

    float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;
    float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;
    float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture2D(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));

    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,r3=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;

void main() {
  v_texCoord = a_Uv;

  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,n3=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,i3=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,p1=(f1=(0,Qr.b2)(),f1(h1=function(e){(0,gr.Z)(r,e);var i=KA(r);function r(){return(0,xt.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"render",value:function(){var t=this,o=this.rendererService,u=o.clear,l=o.useFramebuffer;l(this.heatmapFramerBuffer,function(){u({color:[0,0,0,0],depth:1,stencil:0,framebuffer:t.heatmapFramerBuffer}),t.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p,v,x,E,C,T,O,L;return q().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:return l=this.rendererService,p=l.createFramebuffer,v=l.getViewportSize,x=l.createTexture2D,E=this.styleAttributeService.getLayerStyleAttribute("shape"),C=(E==null||(u=E.scale)===null||u===void 0?void 0:u.field)||"heatmap",this.shapeType=C,H.next=6,this.buildHeatMapIntensity();case 6:return this.intensityModel=H.sent,this.colorModel=C==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap(),T=v(),O=T.width,L=T.height,this.heatmapFramerBuffer=p({color:x({width:Math.floor(O/4),height:Math.floor(L/4),wrapS:$.CLAMP_TO_EDGE,wrapT:$.CLAMP_TO_EDGE,min:$.LINEAR,mag:$.LINEAR}),depth:!1}),this.updateColorTexture(),H.abrupt("return",[this.intensityModel,this.colorModel]);case 12:case"end":return H.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.initModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:_n.Attribute,descriptor:{name:"a_Dir",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(o){var u=o.size,l=u===void 0?1:u;return[l]}}})}},{key:"buildHeatMapIntensity",value:function(){var n=(0,de.Z)(q().mark(function o(){var u;return q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return this.layer.triangulation=c1,p.next=3,this.layer.buildLayerModel({moduleName:"heatmapIntensity",vertexShader:i3,fragmentShader:n3,triangulation:c1,depth:{enable:!1},cull:{enable:!0,face:xu(this.mapService.version)},blend:{enable:!0,func:{srcRGB:$.ONE,srcAlpha:1,dstRGB:$.ONE,dstAlpha:1}}});case 3:return u=p.sent,p.abrupt("return",u);case 5:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildHeatmapColor",value:function(){var t=this.layer.getLayerConfig(),o=t.mask,u=o===void 0?!1:o,l=t.maskInside,p=l===void 0?!0:l;this.shaderModuleService.registerModule("heatmapColor",{vs:r3,fs:t3});var v=this.shaderModuleService.getModule("heatmapColor"),x=v.vs,E=v.fs,C=v.uniforms,T=this.rendererService,O=T.createAttribute,L=T.createElements,B=T.createBuffer,H=T.createModel;return H({vs:x,fs:E,attributes:{a_Position:O({buffer:B({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:$.FLOAT}),size:3}),a_Uv:O({buffer:B({data:[0,1,1,1,0,0,1,0],type:$.FLOAT}),size:2})},uniforms:(0,z.Z)({},C),depth:{enable:!1},blend:this.getBlend(),elements:L({data:[0,2,1,2,3,1],type:$.UNSIGNED_INT,count:6}),stencil:Xe(u,p)})}},{key:"drawIntensityMode",value:function(){var t,o=this.layer.getLayerConfig(),u=o.opacity,l=o.intensity,p=l===void 0?10:l,v=o.radius,x=v===void 0?5:v;this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),(t=this.intensityModel)===null||t===void 0||t.draw({uniforms:{u_opacity:u||1,u_radius:x,u_intensity:p}}),this.layer.hooks.afterRender.call()}},{key:"drawColorMode",value:function(){var t,o=this.layer.getLayerConfig(),u=o.opacity;(t=this.colorModel)===null||t===void 0||t.draw({uniforms:{u_opacity:u||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var t,o=this.layer.getLayerConfig(),u=o.opacity,l=Hr();di(l,this.cameraService.getViewProjectionMatrixUncentered()),(t=this.colorModel)===null||t===void 0||t.draw({uniforms:{u_opacity:u||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,N.Z)(l)}})}},{key:"build3dHeatMap",value:function(){var t=this.layer.getLayerConfig(),o=t.mask,u=o===void 0?!1:o,l=t.maskInside,p=l===void 0?!0:l,v=this.rendererService.getViewportSize,x=v(),E=x.width,C=x.height,T=qA(E/4,C/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:e3,fs:JA});var O=this.shaderModuleService.getModule("heatmap3dColor"),L=O.vs,B=O.fs,H=O.uniforms,oe=this.rendererService,le=oe.createAttribute,Re=oe.createElements,Ne=oe.createBuffer,ut=oe.createModel;return ut({vs:L,fs:B,attributes:{a_Position:le({buffer:Ne({data:T.vertices,type:$.FLOAT}),size:3}),a_Uv:le({buffer:Ne({data:T.uvs,type:$.FLOAT}),size:2})},primitive:$.TRIANGLES,uniforms:(0,z.Z)({},H),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:$.SRC_ALPHA,srcAlpha:1,dstRGB:$.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:Re({data:T.indices,type:$.UNSIGNED_INT,count:T.indices.length}),stencil:Xe(u,p)})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var t=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var o=this.layer.getLayerConfig(),u=o.rampColors,l=We(u);this.colorTexture=t({data:new Uint8Array(l.data),width:l.width,height:l.height,wrapS:$.CLAMP_TO_EDGE,wrapT:$.CLAMP_TO_EDGE,min:$.NEAREST,mag:$.NEAREST,flipY:!1})}}]),r}(Ba))||h1);function a3(e){var i=o3();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function o3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var s3=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,u3=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,l3=function(e){(0,gr.Z)(r,e);var i=a3(r);function r(){return(0,xt.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=t.coverage,l=t.angle;return{u_opacity:o||1,u_coverage:u||.9,u_angle:l||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){var n=(0,de.Z)(q().mark(function o(){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p,v,x,E;return q().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,T.next=3,this.layer.buildLayerModel({moduleName:"heatmapHexagon",vertexShader:u3,fragmentShader:s3,triangulation:l1,depth:{enable:!1},primitive:$.TRIANGLES,blend:this.getBlend(),stencil:Xe(p,x)});case 3:return E=T.sent,T.abrupt("return",[E]);case 5:case"end":return T.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:_n.Attribute,descriptor:{name:"a_Pos",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(o){var u=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[u[0],u[1],0]}}})}}]),r}(Ba),c3={heatmap:p1,heatmap3d:p1,grid:GA,grid3d:YA,hexagon:l3},f3=c3;function h3(e){var i=p3();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function p3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var v3=function(e){(0,gr.Z)(r,e);var i=h3(r);function r(){var n;(0,xt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,De.Z)(n),"type","HeatMapLayer"),n}return(0,wt.Z)(r,[{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u;return q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel=new f3[u](this),p.next=4,this.initLayerModels();case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"renderModels",value:function(){var t=this,o=this.getModelType();return o==="heatmap"?(this.layerModel&&this.layerModel.render(),this):this.encodeDataLength<=0&&!this.forceRender?this:(this.hooks.beforeRender.call(),this.models.forEach(function(u){return u.draw({uniforms:t.layerModel.getUninforms()})}),this.hooks.afterRender.call(),this)}},{key:"updateModelData",value:function(t){t.attributes&&t.elements?this.models[0].updateAttributesAndElements(t.attributes,t.elements):console.warn("data error")}},{key:"getModelType",value:function(){var t,o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=this.getLayerConfig(),l=u.shape3d,p=this.getSource(),v=p.data.type,x=(o==null||(t=o.scale)===null||t===void 0?void 0:t.field)||"heatmap";return x==="heatmap"||x==="heatmap3d"?"heatmap":v==="hexagon"?(l==null?void 0:l.indexOf(x))===-1?"hexagon":"grid3d":v==="grid"?(l==null?void 0:l.indexOf(x))===-1?"grid":"grid3d":"heatmap"}}]),r}(tp);function m3(e){var i=g3();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function g3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var y3=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,_3=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,x3=function(e){(0,gr.Z)(r,e);var i=m3(r);function r(){return(0,xt.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity;return{u_opacity:o||1,u_texture:this.texture}}},{key:"initModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u=this,l,p,v,x,E,C,T,O,L,B,H;return q().wrap(function(le){for(;;)switch(le.prev=le.next){case 0:if(l=this.layer.getLayerConfig(),p=l.mask,v=p===void 0?!1:p,x=l.maskInside,E=x===void 0?!0:x,C=this.layer.getSource(),T=this.rendererService.createTexture2D,this.texture=T({height:0,width:0}),!rs){le.next=12;break}O=this.layerService.sceneService.getSceneConfig().canvas,L=O.createImage(),L.crossOrigin="anonymous",L.src=C.data.originData,L.onload=function(){u.texture=T({data:L,width:L.width,height:L.height}),u.layerService.reRender()},le.next=16;break;case 12:return le.next=14,C.data.images;case 14:B=le.sent,this.texture=T({data:B[0],width:B[0].width,height:B[0].height,mag:$.LINEAR,min:$.LINEAR});case 16:return le.next=18,this.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:_3,fragmentShader:y3,triangulation:s0,primitive:$.TRIANGLES,blend:{enable:!0},depth:{enable:!1},stencil:Xe(v,E)});case 18:return H=le.sent,le.abrupt("return",[H]);case 20:case"end":return le.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.initModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:_n.Attribute,descriptor:{name:"a_Uv",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}})}}]),r}(Ba),b3={image:x3},E3=b3;function S3(e){var i=w3();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function w3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var d1=function(e){(0,gr.Z)(r,e);var i=S3(r);function r(){var n;(0,xt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,De.Z)(n),"type","ImageLayer"),n}return(0,wt.Z)(r,[{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u;return q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel=new E3[u](this),p.next=4,this.initLayerModels();case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getDefaultConfig",value:function(){var t=this.getModelType(),o={image:{}};return o[t]}},{key:"getModelType",value:function(){return"image"}}]),r}(tp);function C3(e){var i=A3();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function A3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var T3=`
uniform float u_opacity;

varying vec4 v_dash_array;
varying vec4 v_color;

uniform float segmentNumber;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity;

  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  };
  gl_FragColor.a *=flag;
  
  gl_FragColor = filterColor(gl_FragColor);
}`,M3=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;


uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
  // dash: index / (segmentNumber - 1.);
  // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  vec2 s = source;
  vec2 t = target;
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;

  styleMappingMat[3].b = segmentIndex / segmentNumber;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  gl_PointSize = 5.0;
  setPickingColor(a_PickingColor);
}
`,k3=`
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  
  gl_FragColor.a *= opacity;

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = styleMappingMat[3].g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = styleMappingMat[3].a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
}`,I3=`#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    // dash: index / (segmentNumber - 1.);
    // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    //  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  float arcThetaOffset = styleMappingMat[0][1];
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, arcThetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, arcThetaOffset), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
     styleMappingMat[3].g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,P3=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}`,R3=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,O3={solid:0,dash:1},L3=function(e){(0,gr.Z)(r,e);var i=C3(r);function r(){var n;(0,xt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,De.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:$.NEAREST,min:$.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.sourceColor,p=t.targetColor,v=t.textureBlend,x=v===void 0?"normal":v,E=t.lineType,C=E===void 0?"solid":E,T=t.dashArray,O=T===void 0?[10,5]:T,L=t.forward,B=L===void 0?!0:L,H=t.lineTexture,oe=H===void 0?!1:H,le=t.iconStep,Re=le===void 0?100:le,Ne=t.segmentNumber,ut=Ne===void 0?30:Ne,Ot=t.thetaOffset,Nt=Ot===void 0?.314:Ot;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,thetaOffset:Nt})){this.judgeStyleAttributes({opacity:u,thetaOffset:Nt});var jt=this.layer.getEncodedData(),br=this.calDataFrame(this.cellLength,jt,this.cellProperties),yr=br.data,Ur=br.width,An=br.height;this.rowCount=An,this.dataTexture=this.cellLength>0&&yr.length>0?this.createTexture2D({flipY:!0,data:yr,format:$.LUMINANCE,type:$.FLOAT,width:Ur,height:An}):this.createTexture2D({flipY:!0,data:[1],format:$.LUMINANCE,type:$.FLOAT,width:1,height:1})}O.length===2&&O.push(0,0);var jn=0,Qi=[0,0,0,0],Ca=[0,0,0,0];return l&&p&&(Qi=he(l),Ca=he(p),jn=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:(0,St.isNumber)(Nt)?Nt:0,u_opacity:(0,St.isNumber)(u)?u:1,u_textureBlend:x==="normal"?0:1,segmentNumber:ut,u_line_type:O3[C||"solid"],u_dash_array:O,u_blur:.9,u_lineDir:B?1:-1,u_texture:this.texture,u_line_texture:oe?1:0,u_icon_step:Re,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:jn,u_sourceColor:Qi,u_targetColor:Ca}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,de.Z)(q().mark(function o(){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.next=4,this.buildModels();case 4:return l.abrupt("return",l.sent);case 5:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t,o;(t=this.texture)===null||t===void 0||t.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor,l=t.lineType;return l==="dash"?{frag:T3,vert:M3,type:"Dash"}:o&&u?{frag:P3,vert:R3,type:"Linear"}:{frag:k3,vert:I3,type:""}}},{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p,v,x,E,C,T,O,L,B,H;return q().wrap(function(le){for(;;)switch(le.prev=le.next){case 0:return u=this.layer.getLayerConfig(),l=u.segmentNumber,p=l===void 0?30:l,v=u.mask,x=v===void 0?!1:v,E=u.maskInside,C=E===void 0?!0:E,T=this.getShaders(),O=T.frag,L=T.vert,B=T.type,le.next=4,this.layer.buildLayerModel({moduleName:"lineArc2d"+B,vertexShader:L,fragmentShader:O,triangulation:u0,depth:{enable:!1},blend:this.getBlend(),segmentNumber:p,stencil:Xe(x,C)});case 4:return H=le.sent,le.abrupt("return",[H]);case 6:case"end":return le.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?1:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:_n.Attribute,descriptor:{name:"a_Instance",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:4,update:function(u,l,p){return[p[3],p[4],p[5],p[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:_n.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(u){var l=t.iconService.getIconMap(),p=u.texture,v=l[p]||{x:0,y:0},x=v.x,E=v.y;return[x,E]}}})}}]),r}(Ba);function D3(e){var i=F3();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function F3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var B3=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,N3=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,z3=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,Z3=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;
attribute vec2 a_iconMapUV;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
uniform float u_opacity: 1.0;

varying vec4 v_dash_array;
varying vec4 v_color;
varying float v_segmentIndex;
varying vec2 v_iconMapUV;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143


#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,U3={solid:0,dash:1},V3=function(e){(0,gr.Z)(r,e);var i=D3(r);function r(){var n;(0,xt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,De.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:$.NEAREST,min:$.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.sourceColor,p=t.targetColor,v=t.textureBlend,x=v===void 0?"normal":v,E=t.lineType,C=E===void 0?"solid":E,T=t.dashArray,O=T===void 0?[10,5]:T,L=t.lineTexture,B=L===void 0?!1:L,H=t.iconStep,oe=H===void 0?100:H,le=t.segmentNumber,Re=le===void 0?30:le,Ne=t.globalArcHeight,ut=Ne===void 0?10:Ne;O.length===2&&O.push(0,0);var Ot=0,Nt=[0,0,0,0],jt=[0,0,0,0];if(l&&p&&(Nt=he(l),jt=he(p),Ot=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var br=this.layer.getEncodedData(),yr=this.calDataFrame(this.cellLength,br,this.cellProperties),Ur=yr.data,An=yr.width,jn=yr.height;this.rowCount=jn,this.dataTexture=this.cellLength>0&&Ur.length>0?this.createTexture2D({flipY:!0,data:Ur,format:$.LUMINANCE,type:$.FLOAT,width:An,height:jn}):this.createTexture2D({flipY:!0,data:[1],format:$.LUMINANCE,type:$.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:Pm,u_global_height:ut,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,St.isNumber)(u)?u:1,u_textureBlend:x==="normal"?0:1,segmentNumber:Re,u_line_type:U3[C]||0,u_dash_array:O,u_texture:this.texture,u_line_texture:B?1:0,u_icon_step:oe,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Ot,u_sourceColor:Nt,u_targetColor:jt}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,de.Z)(q().mark(function o(){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.next=4,this.buildModels();case 4:return l.abrupt("return",l.sent);case 5:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t,o;(t=this.texture)===null||t===void 0||t.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor;return o&&u?{frag:z3,vert:Z3,type:"Linear"}:{frag:B3,vert:N3,type:""}}},{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p,v,x,E,C,T,O,L,B,H;return q().wrap(function(le){for(;;)switch(le.prev=le.next){case 0:return u=this.layer.getLayerConfig(),l=u.segmentNumber,p=l===void 0?30:l,v=u.mask,x=v===void 0?!1:v,E=u.maskInside,C=E===void 0?!0:E,T=this.getShaders(),O=T.frag,L=T.vert,B=T.type,le.next=4,this.layer.buildLayerModel({moduleName:"lineArc3d"+B,vertexShader:L,fragmentShader:O,triangulation:u0,blend:this.getBlend(),segmentNumber:p,stencil:Xe(x,C)});case 4:return H=le.sent,le.abrupt("return",[H]);case 6:case"end":return le.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?1:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:_n.Attribute,descriptor:{name:"a_Instance",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:4,update:function(u,l,p){return[p[3],p[4],p[5],p[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:_n.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(u){var l=t.iconService.getIconMap(),p=u.texture,v=l[p]||{x:0,y:0},x=v.x,E=v.y;return[x,E]}}})}}]),r}(Ba);function j3(e){var i=G3();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function G3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var H3=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,W3=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,X3=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,$3=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;
attribute vec2 a_iconMapUV;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
uniform float u_opacity: 1.0;

varying vec4 v_dash_array;
varying vec4 v_color;
varying float v_segmentIndex;
varying vec2 v_iconMapUV;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143


#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,Y3={solid:0,dash:1},q3=function(e){(0,gr.Z)(r,e);var i=j3(r);function r(){var n;(0,xt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,De.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:$.NEAREST,min:$.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.sourceColor,p=t.targetColor,v=t.textureBlend,x=v===void 0?"normal":v,E=t.lineType,C=E===void 0?"solid":E,T=t.dashArray,O=T===void 0?[10,5]:T,L=t.lineTexture,B=L===void 0?!1:L,H=t.iconStep,oe=H===void 0?100:H,le=t.segmentNumber,Re=le===void 0?30:le,Ne=t.globalArcHeight,ut=Ne===void 0?10:Ne;O.length===2&&O.push(0,0);var Ot=0,Nt=[0,0,0,0],jt=[0,0,0,0];if(l&&p&&(Nt=he(l),jt=he(p),Ot=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var br=this.layer.getEncodedData(),yr=this.calDataFrame(this.cellLength,br,this.cellProperties),Ur=yr.data,An=yr.width,jn=yr.height;this.rowCount=jn,this.dataTexture=this.cellLength>0&&Ur.length>0?this.createTexture2D({flipY:!0,data:Ur,format:$.LUMINANCE,type:$.FLOAT,width:An,height:jn}):this.createTexture2D({flipY:!0,data:[1],format:$.LUMINANCE,type:$.FLOAT,width:1,height:1})}return{u_globel:1,u_globel_radius:Pm,u_global_height:ut,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,St.isNumber)(u)?u:1,u_textureBlend:x==="normal"?0:1,segmentNumber:Re,u_line_type:Y3[C]||0,u_dash_array:O,u_texture:this.texture,u_line_texture:B?1:0,u_icon_step:oe,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Ot,u_sourceColor:Nt,u_targetColor:jt}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,de.Z)(q().mark(function o(){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.next=4,this.buildModels();case 4:return l.abrupt("return",l.sent);case 5:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t,o;(t=this.texture)===null||t===void 0||t.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor;return o&&u?{frag:X3,vert:$3,type:"Linear"}:{frag:H3,vert:W3,type:""}}},{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p,v,x,E,C,T,O,L,B,H;return q().wrap(function(le){for(;;)switch(le.prev=le.next){case 0:return u=this.layer.getLayerConfig(),l=u.segmentNumber,p=l===void 0?30:l,v=u.mask,x=v===void 0?!1:v,E=u.maskInside,C=E===void 0?!0:E,T=this.getShaders(),O=T.frag,L=T.vert,B=T.type,le.next=4,this.layer.buildLayerModel({moduleName:"lineEarthArc3d"+B,vertexShader:L,fragmentShader:O,triangulation:u0,depth:{enable:!0},blend:this.getBlend(),segmentNumber:p,stencil:Xe(x,C)});case 4:return H=le.sent,le.abrupt("return",[H]);case 6:case"end":return le.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?1:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:_n.Attribute,descriptor:{name:"a_Instance",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:4,update:function(u,l,p){return[p[3],p[4],p[5],p[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:_n.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(u){var l=t.iconService.getIconMap(),p=u.texture,v=l[p]||{x:0,y:0},x=v.x,E=v.y;return[x,E]}}})}}]),r}(Ba);function K3(e){var i=Q3();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function Q3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var J3=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = styleMappingMat[3].g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      // \u5B9E\u7EBF\u90E8\u5206
    } else {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_animate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,eT=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return index / (segmentNumber - 1.);
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*16.0; // total_Distance*16.0 \u8C03\u6574\u9ED8\u8BA4\u7684\u6548\u679C
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  }

  if(u_animate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  styleMappingMat[3].g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,tT={solid:0,dash:1},rT=function(e){(0,gr.Z)(r,e);var i=K3(r);function r(){var n;(0,xt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,De.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:$.NEAREST,min:$.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.sourceColor,p=t.targetColor,v=t.textureBlend,x=v===void 0?"normal":v,E=t.lineType,C=E===void 0?"solid":E,T=t.dashArray,O=T===void 0?[10,5]:T,L=t.lineTexture,B=L===void 0?!1:L,H=t.iconStep,oe=H===void 0?100:H,le=t.segmentNumber,Re=le===void 0?30:le;O.length===2&&O.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Ne=0,ut=[0,0,0,0],Ot=[0,0,0,0];if(l&&p&&(ut=he(l),Ot=he(p),Ne=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var Nt=this.layer.getEncodedData(),jt=this.calDataFrame(this.cellLength,Nt,this.cellProperties),br=jt.data,yr=jt.width,Ur=jt.height;this.rowCount=Ur,this.dataTexture=this.cellLength>0&&br.length>0?this.createTexture2D({flipY:!0,data:br,format:$.LUMINANCE,type:$.FLOAT,width:yr,height:Ur}):this.createTexture2D({flipY:!0,data:[1],format:$.LUMINANCE,type:$.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,St.isNumber)(u)?u:1,u_textureBlend:x==="normal"?0:1,segmentNumber:Re,u_line_type:tT[C]||0,u_dash_array:O,u_texture:this.texture,u_line_texture:B?1:0,u_icon_step:oe,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Ne,u_sourceColor:ut,u_targetColor:Ot}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,de.Z)(q().mark(function o(){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.next=4,this.buildModels();case 4:return l.abrupt("return",l.sent);case 5:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t,o;(t=this.texture)===null||t===void 0||t.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p,v,x,E;return q().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,T.next=3,this.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:eT,fragmentShader:J3,triangulation:u0,depth:{enable:!1},blend:this.getBlend(),stencil:Xe(p,x)});case 3:return E=T.sent,T.abrupt("return",[E]);case 5:case"end":return T.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?1:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:_n.Attribute,descriptor:{name:"a_Instance",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:4,update:function(u,l,p){return[p[3],p[4],p[5],p[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:_n.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(u){var l=t.iconService.getIconMap(),p=u.texture,v=l[p]||{x:0,y:0},x=v.x,E=v.y;return[x,E]}}})}}]),r}(Ba);function nT(e){var i=iT();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function iT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var aT=`#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0
uniform float u_CoordinateSystem;
varying vec4 v_color;
uniform float u_arrow: 0.0;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

varying mat4 styleMappingMat;
void main() {
  float distanceAndIndex = styleMappingMat[0][3];
  float miter = styleMappingMat[0][2];

  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B


  if(u_arrow > 0.0 && distanceAndIndex < 2.0) { // arrow
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) { 
      if(cross(vec3(styleMappingMat[1].rg, 0.0), vec3(styleMappingMat[1].ba, 0.0)).z < 0.0) { // amap
        discard;
      }
    } else { // amap2 mapbox map
      if(cross(vec3(styleMappingMat[1].rg, 0.0), vec3(styleMappingMat[1].ba, 0.0)).z > 0.0) { 
        discard;
      }
    }
  } else { // line body
    if(miter < 0.0) {
      discard;
    }
  }


  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,oT=`attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute vec4 a_dirPoints;
attribute vec3 a_DistanceAndIndex;

uniform vec4 u_lineDir;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - a_Miter - a_DistanceAndIndex
    0.0, 0.0, 0.0, 0.0, // originX - originY - vectorX - vectorY
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );
  styleMappingMat[0][3] = a_DistanceAndIndex.y;
  styleMappingMat[0][2] = a_Miter;

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97


  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  // styleMappingMat[1].rg = a_Position.xy + offset;

  vec2 copyOffset = vec2(offset.x, offset.y);

  float lineDistance = a_DistanceAndIndex.x;
  float total_Distance = a_DistanceAndIndex.z;
  float currentLinePointRatio = lineDistance / total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z); // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }
  
  if(u_arrow > 0.0 && a_DistanceAndIndex.y < 2.0) {
    vec2 startPoint = a_dirPoints.rg;
    vec2 endPoint = a_dirPoints.ba;
    vec4 t1 = project_position(vec4(startPoint, 0, 1.0));
    vec4 t2 = project_position(vec4(endPoint, 0, 1.0));
    // TODO\uFF1A \u540E\u7EED\u4F18\u5316\u53EF\u4EE5\u628A\u4F4D\u7F6E\u8BA1\u7B97\u653E\u5728 cpu \u4E2D\u5B8C\u6210
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      vec2 p1 = (u_Mvp * vec4(t1.xy, 0.0, 1.0)).xy;
      vec2 p2 = (u_Mvp * vec4(t2.xy, 0.0, 1.0)).xy;
      styleMappingMat[1].rg = normalize(p1 - p2);
      styleMappingMat[1].ba = normalize(gl_Position.xy - p2);
    } else {
      vec2 p1 = project_common_position_to_clipspace(vec4(t1.xy, 0.0, 1.0)).xy;
      vec2 p2 = project_common_position_to_clipspace(vec4(t2.xy, 0.0, 1.0)).xy;
      styleMappingMat[1].rg = normalize(p1 - p2);
      styleMappingMat[1].ba = normalize(gl_Position.xy - p2);
    }
  }

  setPickingColor(a_PickingColor);
}
`,sT=function(e){(0,gr.Z)(r,e);var i=nT(r);function r(){return(0,xt.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.sourceColor,p=t.targetColor,v=t.arrow,x=v===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:v,E=0,C=[0,0,0,0],T=[0,0,0,0];if(l&&p&&(C=he(l),T=he(p),E=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var O=this.layer.getEncodedData(),L=this.calDataFrame(this.cellLength,O,this.cellProperties),B=L.data,H=L.width,oe=L.height;this.rowCount=oe,this.dataTexture=this.cellLength>0&&B.length>0?this.createTexture2D({flipY:!0,data:B,format:$.LUMINANCE,type:$.FLOAT,width:H,height:oe}):this.createTexture2D({flipY:!0,data:[1],format:$.LUMINANCE,type:$.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,St.isNumber)(u)?u:1,u_linearColor:E,u_sourceColor:C,u_targetColor:T,u_arrow:Number(x.enable),u_arrowHeight:x.arrowHeight||3,u_arrowWidth:x.arrowWidth||2,u_tailWidth:x.tailWidth===void 0?1:x.tailWidth}}},{key:"initModels",value:function(){var n=(0,de.Z)(q().mark(function o(){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.dataTexture)===null||t===void 0||t.destroy()}},{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p,v,x,E,C,T,O,L,B;return q().wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,E=u.depth,C=E===void 0?!1:E,T=this.getShaders(),O=T.frag,L=T.vert,this.layer.triangulation=Up,oe.next=5,this.layer.buildLayerModel({moduleName:"lineHalf",vertexShader:L,fragmentShader:O,triangulation:Up,depth:{enable:C},blend:this.getBlend(),stencil:Xe(p,x)});case 5:return B=oe.sent,oe.abrupt("return",[B]);case 7:case"end":return oe.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getShaders",value:function(){return{frag:aT,vert:oT,type:"normal"}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:_n.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(o,u,l,p,v,x){return x===void 0?[l[3],10,l[5]]:[l[3],x,l[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"dirPoints",type:_n.Attribute,descriptor:{name:"a_dirPoints",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:4,update:function(o){var u=o.coordinates[0]||[0,0],l=o.coordinates[3]||[0,0];return[u[0],u[1],l[0],l[1]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(o){var u=o.size,l=u===void 0?1:u;return Array.isArray(l)?[l[0],l[1]]:[l,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:_n.Attribute,descriptor:{name:"a_Normal",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(o,u,l,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:_n.Attribute,descriptor:{name:"a_Miter",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(o,u,l){return[l[4]]}}})}}]),r}(Ba),v1;(function(e){e[e.solid=0]="solid",e[e.dash=1]="dash"})(v1||(v1={}));var Md;(function(e){e.VERTICAL="vertical",e.HORIZONTAL="horizontal"})(Md||(Md={}));var Dm;(function(e){e.NORMAL="normal",e.REPLACE="replace"})(Dm||(Dm={}));var m1;(function(e){e.ALWAYS="always",e.DRAGEND="dragend"})(m1||(m1={}));function uT(e){var i=lT();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function lT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cT=`#define LineTypeSolid 0.0
uniform float u_opacity : 1.0;

varying vec4 v_color;

// dash
varying vec4 v_dash_array;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
 
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    // \u5B9E\u7EBF\u90E8\u5206
  } else {
    // \u865A\u7EBF\u90E8\u5206
    discard;
  };

  gl_FragColor = filterColor(gl_FragColor);
}
`,fT=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  vec2 offset = project_pixel(size.xy);

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = a_DistanceAndIndex.x / a_Total_Distance; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_DistanceAndIndex.x;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));
  } else {
    float lineHeight = a_Size.y;
 
    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,hT=`#define Animate 0.0
#define LineTexture 1.0
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;

uniform vec3 u_blur;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_animate: [ 1, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = styleMappingMat[3].a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth/2.0;

    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) {
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  // blur
  float blurV = styleMappingMat[3][3];
  if(blurV < 0.5) {
    gl_FragColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);
  } else {
    gl_FragColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);
  }
  
  gl_FragColor = filterColor(gl_FragColor);
}
`,g1=`
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,pT=`varying vec4 v_color;
uniform float u_linearDir: 1.0;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"


varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float linearRadio = styleMappingMat[3][0]; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = styleMappingMat[3][3];
  }

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, linearRadio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,dT={solid:0,dash:1},y1=function(e){(0,gr.Z)(r,e);var i=uT(r);function r(){var n;(0,xt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,De.Z)(n),"texture",n.createTexture2D({data:[0,0,0,0],mag:$.NEAREST,min:$.NEAREST,premultiplyAlpha:!1,width:1,height:1})),(0,Y.Z)((0,De.Z)(n),"dataTexture",n.createTexture2D({flipY:!0,data:[1],format:$.LUMINANCE,type:$.FLOAT,width:1,height:1})),(0,Y.Z)((0,De.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:$.NEAREST,min:$.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.sourceColor,p=t.targetColor,v=t.textureBlend,x=v===void 0?"normal":v,E=t.lineType,C=E===void 0?"solid":E,T=t.dashArray,O=T===void 0?[10,5,0,0]:T,L=t.lineTexture,B=L===void 0?!1:L,H=t.iconStep,oe=H===void 0?100:H,le=t.vertexHeightScale,Re=le===void 0?20:le,Ne=t.borderWidth,ut=Ne===void 0?0:Ne,Ot=t.borderColor,Nt=Ot===void 0?"#ccc":Ot,jt=t.raisingHeight,br=jt===void 0?0:jt,yr=t.heightfixed,Ur=yr===void 0?!1:yr,An=t.linearDir,jn=An===void 0?Md.VERTICAL:An,Qi=t.blur,Ca=Qi===void 0?[1,1,1]:Qi,bo=t.arrow,Ao=bo===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:bo;O.length===2&&O.push(0,0),this.rendererService.getDirty()&&this.texture&&this.texture.bind();var Ko=0,Ml=[0,0,0,0],Pv=[0,0,0,0];if(l&&p&&(Ml=he(l),Pv=he(p),Ko=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var Nd=this.layer.getEncodedData(),Rv=this.calDataFrame(this.cellLength,Nd,this.cellProperties),z0=Rv.data,gg=Rv.width,Z0=Rv.height;this.rowCount=Z0,this.dataTexture=this.cellLength>0&&z0.length>0?this.createTexture2D({flipY:!0,data:z0,format:$.LUMINANCE,type:$.FLOAT,width:gg,height:Z0}):this.createTexture2D({flipY:!0,data:[1],format:$.LUMINANCE,type:$.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,St.isNumber)(u)?u:1,u_textureBlend:x===Dm.NORMAL?0:1,u_line_type:dT[C],u_dash_array:O,u_blur:Ca,u_texture:this.texture,u_line_texture:B?1:0,u_icon_step:oe,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:ut,u_borderColor:he(Nt),u_linearDir:jn===Md.VERTICAL?1:0,u_linearColor:Ko,u_sourceColor:Ml,u_targetColor:Pv,u_heightfixed:Number(Ur),u_vertexScale:Re,u_raisingHeight:Number(br),u_arrow:Number(Ao.enable),u_arrowHeight:Ao.arrowHeight||3,u_arrowWidth:Ao.arrowWidth||2,u_tailWidth:Ao.tailWidth===void 0?1:Ao.tailWidth}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,de.Z)(q().mark(function o(){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t,o;(t=this.texture)===null||t===void 0||t.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p,v,x,E,C,T,O,L,B,H,oe,le,Re;return q().wrap(function(ut){for(;;)switch(ut.prev=ut.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,E=u.depth,C=E===void 0?!1:E,T=u.workerEnabled,O=T===void 0?!1:T,L=u.enablePicking,B=this.getShaders(),H=B.frag,oe=B.vert,le=B.type,this.layer.triangulation=Fh,ut.next=5,this.layer.buildLayerModel({moduleName:"line"+le,vertexShader:oe,fragmentShader:H,triangulation:Fh,depth:{enable:C},blend:this.getBlend(),stencil:Xe(p,x),workerEnabled:O,workerOptions:{modelType:"line"+le,enablePicking:L,iconMap:this.iconService.getIconMap()}});case 5:return Re=ut.sent,ut.abrupt("return",[Re]);case 7:case"end":return ut.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor,l=t.lineType;return l==="dash"?{frag:cT,vert:fT,type:"Dash"}:o&&u?{frag:pT,vert:g1,type:"Linear"}:{frag:hT,vert:g1,type:""}}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:_n.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(u,l,p,v,x,E){return E===void 0?[p[3],10]:[p[3],E]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:_n.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(u,l,p){return[p[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(u){var l=u.size,p=l===void 0?1:l;return Array.isArray(p)?[p[0],p[1]]:[p,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:_n.Attribute,descriptor:{name:"a_Normal",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(u,l,p,v,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:_n.Attribute,descriptor:{name:"a_Miter",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(u,l,p){return[p[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:_n.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(u){var l=t.iconService.getIconMap(),p=u.texture,v=l[p]||{x:0,y:0},x=v.x,E=v.y;return[x,E]}}})}}]),r}(Ba);function vT(e){var i=mT();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function mT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gT=`uniform float u_opacity : 1.0;
uniform sampler2D u_texture;
uniform float u_linearDir: 1.0;

#pragma include "picking"

varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float linearRadio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = styleMappingMat[3][3];
  }

  gl_FragColor = texture2D(u_texture, vec2(linearRadio, 0.5));

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,yT=`
attribute float a_Miter;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

uniform float u_opacity: 1.0;

#pragma include "projection"
#pragma include "picking"

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,_T=function(e){(0,gr.Z)(r,e);var i=vT(r);function r(){var n;(0,xt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,De.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;n.colorTexture&&n.colorTexture.destroy();var p=n.layer.getLayerConfig(),v=p.rampColors,x=We(v);n.colorTexture=l({data:new Uint8Array(x.data),width:x.width,height:x.height,wrapS:$.CLAMP_TO_EDGE,wrapT:$.CLAMP_TO_EDGE,min:$.NEAREST,mag:$.NEAREST,flipY:!1})}),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.vertexHeightScale,p=l===void 0?20:l,v=t.raisingHeight,x=v===void 0?0:v,E=t.heightfixed,C=E===void 0?!1:E,T=t.linearDir,O=T===void 0?Md.VERTICAL:T;if(this.rendererService.getDirty()&&this.colorTexture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var L=this.layer.getEncodedData(),B=this.calDataFrame(this.cellLength,L,this.cellProperties),H=B.data,oe=B.width,le=B.height;this.rowCount=le,this.dataTexture=this.cellLength>0&&H.length>0?this.createTexture2D({flipY:!0,data:H,format:$.LUMINANCE,type:$.FLOAT,width:oe,height:le}):this.createTexture2D({flipY:!0,data:[1],format:$.LUMINANCE,type:$.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_linearDir:O===Md.VERTICAL?1:0,u_opacity:(0,St.isNumber)(u)?u:1,u_texture:this.colorTexture,u_heightfixed:Number(C),u_vertexScale:p,u_raisingHeight:Number(x)}}},{key:"initModels",value:function(){var n=(0,de.Z)(q().mark(function o(){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),l.next=3,this.buildModels();case 3:return l.abrupt("return",l.sent);case 4:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t,o;(t=this.colorTexture)===null||t===void 0||t.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p,v,x,E,C,T;return q().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,E=u.depth,C=E===void 0?!1:E,this.layer.triangulation=Up,L.next=4,this.layer.buildLayerModel({moduleName:"lineRampColors",vertexShader:yT,fragmentShader:gT,triangulation:Up,depth:{enable:C},blend:this.getBlend(),stencil:Xe(p,x)});case 4:return T=L.sent,L.abrupt("return",[T]);case 6:case"end":return L.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:_n.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(o,u,l,p,v,x){return x===void 0?[l[3],10]:[l[3],x]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:_n.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(o,u,l){return[l[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(o){var u=o.size,l=u===void 0?1:u;return Array.isArray(l)?[l[0],l[1]]:[l,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:_n.Attribute,descriptor:{name:"a_Normal",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(o,u,l,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:_n.Attribute,descriptor:{name:"a_Miter",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(o,u,l){return[l[4]]}}})}}]),r}(Ba);function xT(e){var i=bT();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function bT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ET=`
varying vec4 v_color;
varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,ST=`uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];

  // styleMappingMat[3][0] \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = mix(u_sourceColor, u_targetColor, styleMappingMat[3][0]);
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,_1=`attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Position;

attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_vertexScale: 1.0;

#pragma include "projection"

varying vec4 v_color;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  v_color = a_Color; 
  styleMappingMat[3][0] = a_Distance / a_Total_Distance;

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
    gl_PointSize = 10.0;
  }
}
`,wT=function(e){(0,gr.Z)(r,e);var i=xT(r);function r(){return(0,xt.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.sourceColor,p=t.targetColor,v=t.vertexHeightScale,x=v===void 0?20:v,E=0,C=[0,0,0,0],T=[0,0,0,0];if(l&&p&&(C=he(l),T=he(p),E=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var O=this.layer.getEncodedData(),L=this.calDataFrame(this.cellLength,O,this.cellProperties),B=L.data,H=L.width,oe=L.height;this.rowCount=oe,this.dataTexture=this.cellLength>0&&B.length>0?this.createTexture2D({flipY:!0,data:B,format:$.LUMINANCE,type:$.FLOAT,width:H,height:oe}):this.createTexture2D({flipY:!0,data:[1],format:$.LUMINANCE,type:$.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,St.isNumber)(u)?u:1,u_linearColor:E,u_sourceColor:C,u_targetColor:T,u_vertexScale:x}}},{key:"initModels",value:function(){var n=(0,de.Z)(q().mark(function o(){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.dataTexture)===null||t===void 0||t.destroy()}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor;return o&&u?{frag:ST,vert:_1,type:"lineSimpleLinear"}:{frag:ET,vert:_1,type:"lineSimpleNormal"}}},{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p,v,x,E,C,T,O,L;return q().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,E=this.getShaders(),C=E.frag,T=E.vert,O=E.type,H.next=4,this.layer.buildLayerModel({moduleName:O,vertexShader:T,fragmentShader:C,triangulation:wA,primitive:$.LINES,depth:{enable:!1},blend:this.getBlend(),stencil:Xe(p,x),pick:!1});case 4:return L=H.sent,H.abrupt("return",[L]);case 6:case"end":return H.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:_n.Attribute,descriptor:{name:"a_Distance",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(o,u,l){return[l[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:_n.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(o,u,l){return[l[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(o){var u=o.size,l=u===void 0?1:u;return Array.isArray(l)?[l[0],l[1]]:[l,0]}}})}}]),r}(Ba);function CT(e){var i=AT();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function AT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var TT=`uniform float u_opacity : 1.0;
varying vec4 v_color;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,MT=`attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// uniform vec2 u_tileOrigin;
// uniform float u_coord;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;


#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

void main() {
  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // if(u_coord > 0.0) { // \u4F7F\u7528\u7ECF\u7EAC\u5EA6\u5750\u6807
      if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
  // } else { // \u4F7F\u7528\u504F\u79FB\u5750\u6807
  //   vec2 pointPos = a_Position.xy;
  //   vec4 tileWorld = vec4(project_mvt_offset_position(vec4(u_tileOrigin, 0.0, 1.0)).xyz, 1.0); // \u74E6\u7247\u8D77\u59CB\u70B9\u7684\u4E16\u754C\u5750\u6807

  //   vec2 pointOffset =  pointPos *  pow(2.0, u_Zoom); // \u74E6\u7247\u5185\u7684\u70B9\u7684\u504F\u79FB\u5750\u6807
    
  //   tileWorld.xy += pointOffset;

  //   tileWorld.xy += offset;

  //   if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
  //     // Needs to be divided with project_uCommonUnitsPerMeter
  //     tileWorld.w *= u_PixelsPerMeter.z;
  //   }
  //   gl_Position = u_ViewProjectionMatrix * tileWorld + u_ViewportCenterProjection;
  // }

  setPickingColor(a_PickingColor);
}
`,kT=`uniform float u_opacity : 1.0;
uniform vec4 u_color;

void main() {
  gl_FragColor = u_color;
  gl_FragColor.a *= u_opacity;
}
`,IT=`attribute float a_Miter;
attribute vec4 a_Color;
attribute vec3 a_Normal;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_size;

#pragma include "projection"

void main() {

  vec3 size = a_Miter * u_size * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
  }
}
`,PT=function(e){(0,gr.Z)(r,e);var i=CT(r);function r(){return(0,xt.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.usage,p=t.color,v=p===void 0?"#fff":p,x=t.size,E=x===void 0?1:x;return{u_opacity:Number(u),u_color:l==="basemap"?he(v):[0,0,0,0],u_size:l==="basemap"?E:1}}},{key:"initModels",value:function(){var n=(0,de.Z)(q().mark(function o(){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p,v,x,E,C,T,O;return q().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,E=u.depth,C=E===void 0?!1:E,T=u.usage,this.layer.triangulation=Up,B.next=4,this.layer.buildLayerModel({moduleName:"lineTile_"+T,vertexShader:T==="basemap"?IT:MT,fragmentShader:T==="basemap"?kT:TT,triangulation:Up,blend:this.getBlend(),depth:{enable:C},stencil:Xe(p,x),pick:T!=="basemap"});case 4:return O=B.sent,B.abrupt("return",[O]);case 6:case"end":return B.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getLayerConfig(),o=t.usage;o!=="basemap"&&this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(l){var p=l.size,v=p===void 0?1:p;return Array.isArray(v)?[v[0],v[1]]:[v,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:_n.Attribute,descriptor:{name:"a_Normal",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(l,p,v,x,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:_n.Attribute,descriptor:{name:"a_Miter",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(l,p,v){return[v[4]]}}})}}]),r}(Ba);function RT(e){var i=OT();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function OT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var LT=`#define Animate 0.0
#define LineTexture 1.0

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;
uniform float u_iconStepCount;
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying vec2 v_iconMapUV;
varying float v_blur;
varying float v_radio;
varying vec4 v_color;
varying vec4 v_dataset;

#pragma include "picking"

void main() {
  float opacity = u_opacity;
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_dataset.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = v_dataset.a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_dataset.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_dataset.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_dataset.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,DT=`#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;
uniform float u_linearColor: 0;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;
varying vec4 v_color;
varying float v_blur;
varying float v_radio;
varying vec4 v_dataset;

void main() {


  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_animate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  v_dataset[0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_dataset[1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  v_dataset[2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  v_dataset[3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    originSize = project_float_pixel(a_Size.x);
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,FT=function(e){(0,gr.Z)(r,e);var i=RT(r);function r(){var n;(0,xt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,De.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:$.NEAREST,min:$.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.sourceColor,p=t.targetColor,v=t.textureBlend,x=v===void 0?"normal":v,E=t.heightfixed,C=E===void 0?!1:E,T=t.lineTexture,O=T===void 0?!1:T,L=t.iconStep,B=L===void 0?100:L,H=t.iconStepCount,oe=H===void 0?1:H;this.rendererService.getDirty()&&this.texture.bind();var le=0,Re=[0,0,0,0],Ne=[0,0,0,0];return l&&p&&(Re=he(l),Ne=he(p),le=1),{u_heightfixed:Number(C),u_opacity:(0,St.isNumber)(u)?u:1,u_textureBlend:x==="normal"?0:1,u_texture:this.texture,u_line_texture:O?1:0,u_iconStepCount:oe,u_icon_step:B,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:le,u_sourceColor:Re,u_targetColor:Ne}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,de.Z)(q().mark(function o(){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.next=4,this.buildModels();case 4:return l.abrupt("return",l.sent);case 5:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u;return q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"lineWall",vertexShader:DT,fragmentShader:LT,triangulation:Up,depth:{enable:!1},blend:this.getBlend()});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:_n.Attribute,descriptor:{name:"a_Distance",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(u,l,p){return[p[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:_n.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(u,l,p){return[p[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(u){var l=u.size,p=l===void 0?1:l;return Array.isArray(p)?[p[0],p[1]]:[p,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:_n.Attribute,descriptor:{name:"a_Normal",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(u,l,p,v,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:_n.Attribute,descriptor:{name:"a_Miter",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(u,l,p){return[p[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:_n.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(u){var l=t.iconService.getIconMap(),p=u.texture,v=l[p]||{x:0,y:0},x=v.x,E=v.y;return[x,E]}}})}}]),r}(Ba),BT={arc:L3,arc3d:V3,greatcircle:rT,wall:FT,line:y1,halfLine:sT,simple:wT,linearline:_T,tileLine:PT,earthArc3d:q3},NT=BT;function zT(e){var i=ZT();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function ZT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Fm=function(e){(0,gr.Z)(r,e);var i=zT(r);function r(){var n;(0,xt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,De.Z)(n),"type","LineLayer"),(0,Y.Z)((0,De.Z)(n),"arrowInsertCount",0),(0,Y.Z)((0,De.Z)(n),"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}}),n}return(0,wt.Z)(r,[{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u;return q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel=new NT[u](this),p.next=4,this.initLayerModels();case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getDefaultConfig",value:function(){var t=this.getModelType(),o={line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},tileLine:{},halfLine:{},earthArc3d:{}};return o[t]}},{key:"getModelType",value:function(){var t;if(this.layerType)return this.layerType;var o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=o==null||(t=o.scale)===null||t===void 0?void 0:t.field;return u||"line"}},{key:"processData",value:function(t){if(this.getModelType()!=="simple")return t;var o=[];return t.map(function(u){if(Array.isArray(u.coordinates)&&Array.isArray(u.coordinates[0])&&Array.isArray(u.coordinates[0][0])){var l=(0,z.Z)({},u);u.coordinates.map(function(p){o.push((0,z.Z)((0,z.Z)({},l),{},{coordinates:p}))})}else o.push(u)}),o}}]),r}(tp);function UT(e){var i=VT();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function VT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jT=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];
  float lightWeight = styleMappingMat[1][3];
  float barLinearZ = styleMappingMat[2][3];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, barLinearZ);
    gl_FragColor.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - barLinearZ): barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,GT=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA - lightWeight
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - linearZ(\u5782\u76F4\u65B9\u5411 0 - 1 \u7684\u503C)
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  styleMappingMat[2][3] =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  styleMappingMat[1][3] = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  
  // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
  //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
  float xRadian = getXRadian(a_Pos.y, r);
  float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 mx = mat4(
    1,0,0,0,  
    0,xcos,-xsin,0,  
    0,xsin,xcos,0,  
    0,0,0,1);

  //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
  float yRadian = getYRadian(a_Pos.x, a_Pos.z);
  float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 my = mat4(
    ycos,0,-ysin,0,  
    0,1,0,0,  
    ysin,0,ycos,0,  
    0,0,0,1);

  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  

  setPickingColor(a_PickingColor);
}
`,HT=function(e){(0,gr.Z)(r,e);var i=UT(r);function r(){var n;(0,xt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,De.Z)(n),"raiseCount",0),(0,Y.Z)((0,De.Z)(n),"raiseRepeat",0),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption,u=o===void 0?{enable:!1,speed:.01,repeat:!1}:o,l=t.opacity,p=l===void 0?1:l,v=t.sourceColor,x=t.targetColor,E=t.pickLight,C=E===void 0?!1:E,T=t.heightfixed,O=T===void 0?!1:T,L=t.opacityLinear,B=L===void 0?{enable:!1,dir:"up"}:L,H=t.lightEnable,oe=H===void 0?!0:H;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var le=this.layer.getEncodedData(),Re=this.calDataFrame(this.cellLength,le,this.cellProperties),Ne=Re.data,ut=Re.width,Ot=Re.height;this.rowCount=Ot,this.dataTexture=this.cellLength>0&&Ne.length>0?this.createTexture2D({flipY:!0,data:Ne,format:$.LUMINANCE,type:$.FLOAT,width:ut,height:Ot}):this.createTexture2D({flipY:!0,data:[1],format:$.LUMINANCE,type:$.FLOAT,width:1,height:1})}var Nt=0,jt=[0,0,0,0],br=[0,0,0,0];if(v&&x&&(jt=he(v),br=he(x),Nt=1),this.raiseCount<1&&this.raiseRepeat>0&&u.enable){var yr=u.speed,Ur=yr===void 0?.01:yr;this.raiseCount+=Ur,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(C),u_heightfixed:Number(O),u_r:u.enable&&this.raiseRepeat>0?this.raiseCount:1,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,St.isNumber)(p)?p:1,u_linearColor:Nt,u_sourceColor:jt,u_targetColor:br,u_opacitylinear:Number(B.enable),u_opacitylinear_dir:B.dir==="up"?1:0,u_lightEnable:Number(oe)}}},{key:"initModels",value:function(){var n=(0,de.Z)(q().mark(function o(){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p,v;return q().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return u=this.layer.getLayerConfig(),l=u.animateOption.repeat,p=l===void 0?1:l,this.raiseRepeat=p,E.next=4,this.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:GT,fragmentShader:jT,triangulation:Lm,depth:{enable:!0},cull:{enable:!0,face:xu(this.mapService.version)},blend:this.getBlend()});case 4:return v=E.sent,E.abrupt("return",[v]);case 6:case"end":return E.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.dataTexture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(o){var u=o.size;if(u){var l=[];return Array.isArray(u)&&(l=u.length===2?[u[0],u[0],u[1]]:u),Array.isArray(u)||(l=[u,u,u]),l}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:_n.Attribute,descriptor:{name:"a_Normal",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(o,u,l,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:_n.Attribute,descriptor:{name:"a_Pos",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(o){var u=h(o.coordinates);return J_([u[0],u[1]])}}})}}]),r}(Ba);function WT(e){var i=XT();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function XT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $T=`uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(outer_df > antialiasblur + 0.018) discard;

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,YT=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);

  setPickingColor(a_PickingColor);
}
`,qT=function(e){(0,gr.Z)(r,e);var i=WT(r);function r(){return(0,xt.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.strokeOpacity,p=l===void 0?1:l,v=t.strokeWidth,x=v===void 0?0:v,E=t.stroke,C=E===void 0?"rgba(0,0,0,0)":E,T=t.offsets,O=T===void 0?[0,0]:T,L=t.blend,B=t.blur,H=B===void 0?0:B;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,strokeOpacity:p,strokeWidth:x,stroke:C,offsets:O})){this.judgeStyleAttributes({opacity:u,strokeOpacity:p,strokeWidth:x,stroke:C,offsets:O});var oe=this.layer.getEncodedData(),le=this.calDataFrame(this.cellLength,oe,this.cellProperties),Re=le.data,Ne=le.width,ut=le.height;this.rowCount=ut,this.dataTexture=this.cellLength>0&&Re.length>0?this.createTexture2D({flipY:!0,data:Re,format:$.LUMINANCE,type:$.FLOAT,width:Ne,height:ut}):this.createTexture2D({flipY:!0,data:[1],format:$.LUMINANCE,type:$.FLOAT,width:1,height:1})}return{u_blur:H,u_additive:L==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,St.isNumber)(u)?u:1,u_stroke_opacity:(0,St.isNumber)(p)?p:1,u_stroke_width:(0,St.isNumber)(x)?x:1,u_stroke_color:this.getStrokeColor(C),u_offsets:this.isOffsetStatic(O)?O:[0,0]}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption,u=o===void 0?{enable:!1}:o;return{u_animate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,de.Z)(q().mark(function o(){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u;return q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return this.layer.triangulation=o1,p.next=3,this.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:YT,fragmentShader:$T,triangulation:o1,depth:{enable:!0},blend:this.getBlend()});case 3:return u=p.sent,p.abrupt("return",[u]);case 5:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.dataTexture)===null||t===void 0||t.destroy()}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:_n.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(u,l,p,v){var x=(0,hr.Z)(p,3),E=x[0],C=x[1],T=x[2],O=to.fromValues(0,0,1),L=to.fromValues(E,0,T),B=E>=0?to.angle(O,L):Math.PI*2-to.angle(O,L),H=Math.PI*2-Math.asin(C/100),oe=Hr();xo(oe,oe,B),$a(oe,oe,H);var le=to.fromValues(1,1,0);to.transformMat4(le,le,oe),to.normalize(le,le);var Re=to.fromValues(-1,1,0);to.transformMat4(Re,Re,oe),to.normalize(Re,Re);var Ne=to.fromValues(-1,-1,0);to.transformMat4(Ne,Ne,oe),to.normalize(Ne,Ne);var ut=to.fromValues(1,-1,0);to.transformMat4(ut,ut,oe),to.normalize(ut,ut);var Ot=[].concat((0,N.Z)(le),(0,N.Z)(Re),(0,N.Z)(Ne),(0,N.Z)(ut)),Nt=v%4*3;return[Ot[Nt],Ot[Nt+1],Ot[Nt+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?5:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:_n.Attribute,descriptor:{name:"a_Shape",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(u){var l=u.shape,p=l===void 0?2:l,v=t.layer.getLayerConfig().shape2d,x=v.indexOf(p);return[x]}}})}}]),r}(Ba);function KT(e){var i=QT();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function QT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var JT=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];
  float lightWeight = styleMappingMat[1][3];
  float barLinearZ = styleMappingMat[2][3];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, barLinearZ);
    gl_FragColor.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - barLinearZ): barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,e5=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA - lightWeight
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - linearZ(\u5782\u76F4\u65B9\u5411 0 - 1 \u7684\u503C)
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  styleMappingMat[2][3] =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  styleMappingMat[1][3] = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }

  setPickingColor(a_PickingColor);
}
`,x1=function(e){(0,gr.Z)(r,e);var i=KT(r);function r(){var n;(0,xt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,De.Z)(n),"raiseCount",0),(0,Y.Z)((0,De.Z)(n),"raiseRepeat",0),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption,u=o===void 0?{enable:!1,speed:.01,repeat:!1}:o,l=t.opacity,p=l===void 0?1:l,v=t.sourceColor,x=t.targetColor,E=t.pickLight,C=E===void 0?!1:E,T=t.heightfixed,O=T===void 0?!1:T,L=t.opacityLinear,B=L===void 0?{enable:!1,dir:"up"}:L,H=t.lightEnable,oe=H===void 0?!0:H;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var le=this.layer.getEncodedData(),Re=this.calDataFrame(this.cellLength,le,this.cellProperties),Ne=Re.data,ut=Re.width,Ot=Re.height;this.rowCount=Ot,this.dataTexture=this.cellLength>0&&Ne.length>0?this.createTexture2D({flipY:!0,data:Ne,format:$.LUMINANCE,type:$.FLOAT,width:ut,height:Ot}):this.createTexture2D({flipY:!0,data:[1],format:$.LUMINANCE,type:$.FLOAT,width:1,height:1})}var Nt=0,jt=[0,0,0,0],br=[0,0,0,0];if(v&&x&&(jt=he(v),br=he(x),Nt=1),this.raiseCount<1&&this.raiseRepeat>0&&u.enable){var yr=u.speed,Ur=yr===void 0?.01:yr;this.raiseCount+=Ur,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(C),u_heightfixed:Number(O),u_r:u.enable&&this.raiseRepeat>0?this.raiseCount:1,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,St.isNumber)(p)?p:1,u_linearColor:Nt,u_sourceColor:jt,u_targetColor:br,u_opacitylinear:Number(B.enable),u_opacitylinear_dir:B.dir==="up"?1:0,u_lightEnable:Number(oe)}}},{key:"initModels",value:function(){var n=(0,de.Z)(q().mark(function o(){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p,v,x,E;return q().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return u=this.layer.getLayerConfig(),l=u.depth,p=l===void 0?!0:l,v=u.animateOption.repeat,x=v===void 0?1:v,this.raiseRepeat=x,T.next=4,this.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:e5,fragmentShader:JT,triangulation:Lm,blend:this.getBlend(),cull:{enable:!0,face:xu(this.mapService.version)},depth:{enable:p}});case 4:return E=T.sent,T.abrupt("return",[E]);case 6:case"end":return T.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.dataTexture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(o){var u=o.size;if(u){var l=[];return Array.isArray(u)&&(l=u.length===2?[u[0],u[0],u[1]]:u),Array.isArray(u)||(l=[u,u,u]),l}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:_n.Attribute,descriptor:{name:"a_Normal",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(o,u,l,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:_n.Attribute,descriptor:{name:"a_Pos",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(o){var u=h(o.coordinates);return[u[0],u[1],0]}}})}}]),r}(Ba);function t5(e){var i=r5();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function r5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var b1=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  
  outer_df = sdCircle(v_data.xy, 1.0);
  inner_df = sdCircle(v_data.xy, r);


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

 gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  float d = length(v_data.xy);
  if(d > 0.5) {
    discard;
  }
  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_animate.z - u_animate.y * u_time)), 0.0, 1.0);
  
  // \u6839\u636E\u53E0\u52A0\u6A21\u5F0F\u9009\u62E9\u6548\u679C
  if(u_additive > 0.0) {
    gl_FragColor *= intensity;
    // \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,n5=`uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,Bm=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_meter2coord;
uniform float u_meteryScale;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;
uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  *  u_meter2coord \u5728\u7B49\u9762\u79EF\u5927\u5C0F\u7684\u65F6\u5019\u8BBE\u7F6E\u5355\u4F4D
  */
  float newSize = setPickingSize(a_Size) * u_meter2coord;
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    if(newSize * pow(2.0, u_Zoom) < 48.0) {
      antialiasblur = max(antialiasblur, -0.05);
    } else if(newSize * pow(2.0, u_Zoom) < 128.0) {
      antialiasblur = max(antialiasblur, -0.6/pow(u_Zoom, 2.0));
    } else {
      antialiasblur = max(antialiasblur, -0.8/pow(u_Zoom, 2.0));
    }
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.x += offset.x / u_meteryScale;
      aPosition.y += offset.y;
      offset = vec2(0.0);
    }
  }

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raisingHeight = u_raisingHeight;

  if(u_heightfixed < 1.0) { // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }
 

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,E1=function(e){(0,gr.Z)(r,e);var i=t5(r);function r(){var n;(0,xt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,De.Z)(n),"meter2coord",1),(0,Y.Z)((0,De.Z)(n),"meterYScale",1),(0,Y.Z)((0,De.Z)(n),"isMeter",!1),(0,Y.Z)((0,De.Z)(n),"unit","l7size"),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.strokeOpacity,p=l===void 0?1:l,v=t.strokeWidth,x=v===void 0?0:v,E=t.stroke,C=E===void 0?"rgba(0,0,0,0)":E,T=t.offsets,O=T===void 0?[0,0]:T,L=t.blend,B=t.blur,H=B===void 0?0:B,oe=t.raisingHeight,le=oe===void 0?0:oe,Re=t.heightfixed,Ne=Re===void 0?!1:Re,ut=t.unit,Ot=ut===void 0?"l7size":ut;if(this.updateUnit(Ot),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,strokeOpacity:p,strokeWidth:x,stroke:C,offsets:O})){this.judgeStyleAttributes({opacity:u,strokeOpacity:p,strokeWidth:x,stroke:C,offsets:O});var Nt=this.layer.getEncodedData(),jt=this.calDataFrame(this.cellLength,Nt,this.cellProperties),br=jt.data,yr=jt.width,Ur=jt.height;this.rowCount=Ur,this.dataTexture=this.cellLength>0&&br.length>0?this.createTexture2D({flipY:!0,data:br,format:$.LUMINANCE,type:$.FLOAT,width:yr,height:Ur}):this.createTexture2D({flipY:!0,data:[1],format:$.LUMINANCE,type:$.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(le),u_heightfixed:Number(Ne),u_meter2coord:this.meter2coord,u_meteryScale:this.meterYScale,u_isMeter:Number(this.isMeter),u_blur:H,u_additive:L==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,St.isNumber)(u)?u:1,u_stroke_opacity:(0,St.isNumber)(p)?p:1,u_stroke_width:(0,St.isNumber)(x)?x:1,u_stroke_color:this.getStrokeColor(C),u_offsets:this.isOffsetStatic(O)?O:[0,0]}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption,u=o===void 0?{enable:!1}:o;return{u_animate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Qc)}},{key:"initModels",value:function(){var n=(0,de.Z)(q().mark(function o(){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateUnit("l7size"),l.next=3,this.buildModels();case 3:return l.abrupt("return",l.sent);case 4:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"calMeter2Coord",value:function(){var t=(0,hr.Z)(this.layer.getSource().extent,4),o=t[0],u=t[1],l=t[2],p=t[3],v=[(o+l)/2,(u+p)/2],x=this.mapService.version,E=pa==null?void 0:pa.mapboxgl;if(x===hs.MAPBOX&&E!==null&&E!==void 0&&E.MercatorCoordinate){var C=E.MercatorCoordinate.fromLngLat({lng:v[0],lat:v[1]},0),T=C.meterInMercatorCoordinateUnits(),O=new E.MercatorCoordinate(C.x-T,C.y,C.z),L=O.toLngLat(),B=new E.MercatorCoordinate(C.x,C.y-T,C.z),H=B.toLngLat();this.meter2coord=v[0]-L.lng,this.meterYScale=(H.lat-v[1])/this.meter2coord;return}var oe=this.mapService.meterToCoord(v,[o,u]),le=this.mapService.meterToCoord(v,[l===o?l+.1:l,p===u?u+.1:p]);this.meter2coord=(oe+le)/2,this.meter2coord||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p,v,x,E,C,T,O,L,B,H,oe,le,Re,Ne;return q().wrap(function(Ot){for(;;)switch(Ot.prev=Ot.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,E=u.animateOption,C=E===void 0?{enable:!1}:E,T=u.workerEnabled,O=T===void 0?!1:T,L=u.enablePicking,B=u.shape2d,H=this.getShaders(C),oe=H.frag,le=H.vert,Re=H.type,this.layer.triangulation=Qc,Ot.next=5,this.layer.buildLayerModel({moduleName:Re,vertexShader:le,fragmentShader:oe,triangulation:Qc,depth:{enable:!1},blend:this.getBlend(),stencil:Xe(p,x),workerEnabled:O,workerOptions:{modelType:Re,enablePicking:L,shape2d:B}});case 5:return Ne=Ot.sent,Ot.abrupt("return",[Ne]);case 7:case"end":return Ot.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getShaders",value:function(t){if(t.enable)switch(t.type){case"wave":return{frag:b1,vert:Bm,type:"pointWave"};default:return{frag:b1,vert:Bm,type:"pointWave"}}else return{frag:n5,vert:Bm,type:"pointFill"}}},{key:"clearModels",value:function(){var t;(t=this.dataTexture)===null||t===void 0||t.destroy()}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getLayerConfig().shape2d;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:_n.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(u,l,p,v){var x=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],E=v%4*3;return[x[E],x[E+1],x[E+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?5:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:_n.Attribute,descriptor:{name:"a_Shape",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(u){var l=u.shape,p=l===void 0?2:l,v=t.indexOf(p);return[v]}}})}},{key:"updateUnit",value:function(t){var o=this.mapService.version;this.unit!==t&&(this.unit!=="meter"&&t==="meter"&&o!==hs.DEFUALT&&o!==hs.GLOBEL?(this.isMeter=!0,this.calMeter2Coord()):this.unit==="meter"&&t!=="meter"&&(this.isMeter=!1,this.meter2coord=1),this.unit=t)}}]),r}(Ba);function i5(e){var i=a5();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function a5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var o5=`uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "sdf_2d"
#pragma include "picking"
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv;

void main() {

  float opacity = styleMappingMat[0][0];

  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  gl_FragColor = texture2D(u_texture, pos);
  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,s5=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute vec2 a_Uv;
attribute float a_Rotate;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform mat2 u_RotateMatrix;
uniform float u_isMeter;

varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv; // icon \u8D34\u56FE\u7684 uv \u5750\u6807

uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;
uniform float u_opacity : 1;
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;

  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);

  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (rotation_matrix * u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // height fixed
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,u5=function(e){(0,gr.Z)(r,e);var i=i5(r);function r(){var n;(0,xt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,De.Z)(n),"meter2coord",1),(0,Y.Z)((0,De.Z)(n),"isMeter",!1),(0,Y.Z)((0,De.Z)(n),"radian",0),(0,Y.Z)((0,De.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layerService.throttleRenderLayers();return}n.texture=l({data:n.iconService.getCanvas(),mag:$.LINEAR,min:$.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.offsets,p=l===void 0?[0,0]:l,v=t.rotation,x=t.raisingHeight,E=x===void 0?0:x,C=t.heightfixed,T=C===void 0?!1:C;this.rendererService.getDirty()&&this.texture.bind();var O=1;if((this.mapService.version==="GAODE2.x"||this.mapService.version==="GAODE1.x")&&(O=-1),this.radian=v!==void 0?O*Math.PI*v/180:O*Math.PI*(this.mapService.getRotation()%360)/180,this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:p})){this.judgeStyleAttributes({opacity:u,offsets:p});var L=this.layer.getEncodedData(),B=this.calDataFrame(this.cellLength,L,this.cellProperties),H=B.data,oe=B.width,le=B.height;this.rowCount=le,this.dataTexture=this.cellLength>0&&H.length>0?this.createTexture2D({flipY:!0,data:H,format:$.LUMINANCE,type:$.FLOAT,width:oe,height:le}):this.createTexture2D({flipY:!0,data:[1],format:$.LUMINANCE,type:$.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(E),u_heightfixed:Number(T),u_isMeter:Number(this.isMeter),u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:(0,St.isNumber)(u)?u:1,u_offsets:this.isOffsetStatic(p)?p:[0,0]}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Zp)}},{key:"initModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p,v;return q().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),u=this.layer.getLayerConfig(),l=u.unit,p=l===void 0?"l7size":l,v=this.mapService.version,p==="meter"&&v!==hs.DEFUALT&&v!==hs.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),E.next=7,this.buildModels();case 7:return E.abrupt("return",E.sent);case 8:case"end":return E.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"calMeter2Coord",value:function(){var t=(0,hr.Z)(this.layer.getSource().extent,4),o=t[0],u=t[1],l=t[2],p=t[3],v=[(o+l)/2,(u+p)/2],x=this.mapService.version;if(x===hs.MAPBOX&&window.mapboxgl.MercatorCoordinate){var E=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:v[0],lat:v[1]},0),C=1,T=C*E.meterInMercatorCoordinateUnits(),O=new window.mapboxgl.MercatorCoordinate(E.x-T,E.y,E.z),L=O.toLngLat();this.meter2coord=v[0]-L.lng;return}var B=this.mapService.meterToCoord(v,[o,u]),H=this.mapService.meterToCoord(v,[l===o?l+.1:l,p===u?u+.1:p]);this.meter2coord=(B+H)/2,this.meter2coord||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p,v,x,E;return q().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,T.next=3,this.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:s5,fragmentShader:o5,triangulation:Zp,depth:{enable:!1},blend:this.getBlend(),stencil:Xe(p,x),cull:{enable:!0,face:xu(this.mapService.version)}});case 3:return E=T.sent,T.abrupt("return",[E]);case 5:case"end":return T.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t,o;this.iconService.off("imageUpdate",this.updateTexture),(t=this.texture)===null||t===void 0||t.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"rotate",type:_n.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(u){var l=u.rotate,p=l===void 0?0:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:_n.Attribute,descriptor:{name:"a_Uv",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(u){var l=t.iconService.getIconMap(),p=u.shape,v=l[p]||{x:0,y:0},x=v.x,E=v.y;return[x,E]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:_n.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(u,l,p,v){var x=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],E=v%4*3;return[x[E],x[E+1],x[E+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?5:l;return Array.isArray(p)?[p[0]*t.meter2coord]:[p*t.meter2coord]}}})}}]),r}(Ba);function l5(e){var i=c5();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function c5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var f5=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,h5=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec2 u_offsets;

uniform float u_opacity : 1;
uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  v_color = a_Color;
  v_uv = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  vec2 offset = project_pixel(textrueOffsets);

  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`,S1=function(e){(0,gr.Z)(r,e);var i=l5(r);function r(){var n;(0,xt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,De.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),setTimeout(function(){n.layerService.throttleRenderLayers()});return}n.texture=l({data:n.iconService.getCanvas(),mag:$.LINEAR,min:$.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.offsets,p=l===void 0?[0,0]:l,v=t.raisingHeight,x=v===void 0?0:v,E=t.heightfixed,C=E===void 0?!1:E;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:p})){this.judgeStyleAttributes({opacity:u,offsets:p});var T=this.layer.getEncodedData(),O=this.calDataFrame(this.cellLength,T,this.cellProperties),L=O.data,B=O.width,H=O.height;this.rowCount=H,this.dataTexture=this.cellLength>0&&L.length>0?this.createTexture2D({flipY:!0,data:L,format:$.LUMINANCE,type:$.FLOAT,width:B,height:H}):this.createTexture2D({flipY:!0,data:[1],format:$.LUMINANCE,type:$.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(x),u_heightfixed:Number(C),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:(0,St.isNumber)(u)?u:1,u_offsets:this.isOffsetStatic(p)?p:[0,0]}}},{key:"initModels",value:function(){var n=(0,de.Z)(q().mark(function o(){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.iconService.off("imageUpdate",this.updateTexture),this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),l.next=5,this.buildModels();case 5:return l.abrupt("return",l.sent);case 6:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t,o;(t=this.texture)===null||t===void 0||t.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p,v,x,E;return q().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,T.next=3,this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:h5,fragmentShader:f5,triangulation:SA,depth:{enable:!1},primitive:$.POINTS,blend:this.getBlend(),stencil:Xe(p,x)});case 3:return E=T.sent,T.abrupt("return",[E]);case 5:case"end":return T.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?5:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:_n.Attribute,descriptor:{name:"a_Uv",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(u){var l=t.iconService.getIconMap(),p=u.shape,v=l[p]||{x:0,y:0},x=v.x,E=v.y;return[x,E]}}})}}]),r}(Ba);function p5(e){var i=d5();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function d5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var v5=`uniform float u_opacity : 1;
varying vec4 v_color;
void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;
}
`,m5=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;

varying vec4 v_color;

#pragma include "projection"
#pragma include "project"

void main() {
  v_color = a_Color;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy, a_Position.z, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
}
`;function w1(e){var i=e.coordinates;return{vertices:(0,N.Z)(i),indices:[0],size:i.length}}var C1=function(e){(0,gr.Z)(r,e);var i=p5(r);function r(){return(0,xt.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o;return{u_opacity:(0,St.isNumber)(u)?u:1}}},{key:"initModels",value:function(){var n=(0,de.Z)(q().mark(function o(){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p,v,x,E;return q().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,this.layer.triangulation=w1,T.next=4,this.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:m5,fragmentShader:v5,triangulation:w1,depth:{enable:!1},primitive:$.POINTS,blend:this.getBlend(),stencil:Xe(p,x),pick:!1});case 4:return E=T.sent,T.abrupt("return",[E]);case 6:case"end":return T.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(o){var u=o.size,l=u===void 0?1:u;return Array.isArray(l)?[l[0]]:[l]}}})}}]),r}(Ba);function g5(e){var i=y5();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function y5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _5=`
uniform float u_additive;
uniform float u_opacity: 1.0;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec2 v_exteude;
#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }

  vec2 extrude =  v_exteude;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  // full circle
  // float rades = dot(dir, baseDir);
  // float flag = sign(dir.y);
  // float radar_v = (flag - 1.0) * -0.5 + flag * acos(rades)/pi/2.0;
  
  // half circle
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }

  gl_FragColor.a *= radar_v;
}
`,x5=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
uniform float u_speed: 1.0;
uniform float u_time;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec2 v_exteude;

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float newSize = setPickingSize(a_Size);

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  v_exteude = rotateMatrix * a_Extrude.xy;

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  float blur = 0.0;
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);

  vec2 offset = (extrude.xy * (newSize));
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  v_data = vec4(extrude.x, extrude.y, antialiasblur, -1.0);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,b5=function(e){(0,gr.Z)(r,e);var i=g5(r);function r(){var n;(0,xt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,De.Z)(n),"meter2coord",1),(0,Y.Z)((0,De.Z)(n),"isMeter",!1),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.blend,p=t.speed,v=p===void 0?1:p;return{u_isMeter:Number(this.isMeter),u_speed:v,u_additive:l==="additive"?1:0,u_opacity:(0,St.isNumber)(u)?u:1}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption,u=o===void 0?{enable:!1}:o;return{u_animate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Zp)}},{key:"initModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p,v;return q().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return u=this.layer.getLayerConfig(),l=u.unit,p=l===void 0?"l7size":l,v=this.mapService.version,p==="meter"&&v!==hs.DEFUALT&&v!==hs.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),E.next=5,this.buildModels();case 5:return E.abrupt("return",E.sent);case 6:case"end":return E.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"calMeter2Coord",value:function(){var t=(0,hr.Z)(this.layer.getSource().extent,4),o=t[0],u=t[1],l=t[2],p=t[3],v=[(o+l)/2,(u+p)/2],x=this.mapService.version;if(x===hs.MAPBOX&&window.mapboxgl.MercatorCoordinate){var E=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:v[0],lat:v[1]},0),C=1,T=C*E.meterInMercatorCoordinateUnits(),O=new window.mapboxgl.MercatorCoordinate(E.x-T,E.y,E.z),L=O.toLngLat();this.meter2coord=v[0]-L.lng;return}var B=this.mapService.meterToCoord(v,[o,u]),H=this.mapService.meterToCoord(v,[l===o?l+.1:l,p===u?u+.1:p]);this.meter2coord=(B+H)/2,this.meter2coord||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p,v,x,E;return q().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,T.next=3,this.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:x5,fragmentShader:_5,triangulation:Zp,depth:{enable:!1},blend:this.getBlend(),stencil:Xe(p,x)});case 3:return E=T.sent,T.abrupt("return",[E]);case 5:case"end":return T.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.dataTexture)===null||t===void 0||t.destroy()}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:_n.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(u,l,p,v){var x=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],E=v%4*3;return[x[E],x[E+1],x[E+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?5:l;return Array.isArray(p)?[p[0]*t.meter2coord]:[p*t.meter2coord]}}})}}]),r}(Ba);function E5(e){var i=S5();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function S5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var w5=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_additive;

uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  float opacity = styleMappingMat[0][0];
  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,C5=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143
varying float v_blur;
varying float v_innerRadius;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  vec2 offset = project_pixel(textrueOffsets);
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function A1(e){var i=e.coordinates;return{vertices:(0,N.Z)(i),indices:[0],size:i.length}}var A5=function(e){(0,gr.Z)(r,e);var i=E5(r);function r(){return(0,xt.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.offsets,p=l===void 0?[0,0]:l,v=t.blend,x=t.strokeOpacity,E=x===void 0?1:x,C=t.strokeWidth,T=C===void 0?0:C,O=t.stroke,L=O===void 0?"#fff":O;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:p})){this.judgeStyleAttributes({opacity:u,offsets:p});var B=this.layer.getEncodedData(),H=this.calDataFrame(this.cellLength,B,this.cellProperties),oe=H.data,le=H.width,Re=H.height;this.rowCount=Re,this.dataTexture=this.cellLength>0&&oe.length>0?this.createTexture2D({flipY:!0,data:oe,format:$.LUMINANCE,type:$.FLOAT,width:le,height:Re}):this.createTexture2D({flipY:!0,data:[1],format:$.LUMINANCE,type:$.FLOAT,width:1,height:1})}return{u_additive:v==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,St.isNumber)(u)?u:1,u_offsets:this.isOffsetStatic(p)?p:[0,0],u_stroke_opacity:(0,St.isNumber)(E)?E:1,u_stroke_width:(0,St.isNumber)(T)?T:1,u_stroke_color:this.getStrokeColor(L)}}},{key:"initModels",value:function(){var n=(0,de.Z)(q().mark(function o(){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p,v,x,E;return q().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,this.layer.triangulation=A1,T.next=4,this.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:C5,fragmentShader:w5,triangulation:A1,depth:{enable:!1},primitive:$.POINTS,blend:this.getBlend(),stencil:Xe(p,x)});case 4:return E=T.sent,T.abrupt("return",[E]);case 6:case"end":return T.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.dataTexture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(o){var u=o.size,l=u===void 0?1:u;return Array.isArray(l)?[l[0]]:[l]}}})}}]),r}(Ba);function T5(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=M5(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function M5(e,i){if(!!e){if(typeof e=="string")return T1(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return T1(e,i)}}function T1(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var k5=function(){function e(i,r,n){(0,xt.Z)(this,e),(0,Y.Z)(this,"boxCells",[]);var t=this.boxCells;this.xCellCount=Math.ceil(i/n),this.yCellCount=Math.ceil(r/n);for(var o=0;o<this.xCellCount*this.yCellCount;o++)t.push([]);this.boxKeys=[],this.bboxes=[],this.width=i,this.height=r,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/r,this.boxUid=0}return(0,wt.Z)(e,[{key:"insert",value:function(r,n,t,o,u){this.forEachCell(n,t,o,u,this.insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(n),this.bboxes.push(t),this.bboxes.push(o),this.bboxes.push(u)}},{key:"query",value:function(r,n,t,o,u){return this.queryHitTest(r,n,t,o,!1,u)}},{key:"hitTest",value:function(r,n,t,o,u){return this.queryHitTest(r,n,t,o,!0,u)}},{key:"insertBoxCell",value:function(r,n,t,o,u,l){this.boxCells[u].push(l)}},{key:"queryHitTest",value:function(r,n,t,o,u,l){if(t<0||r>this.width||o<0||n>this.height)return u?!1:[];var p=[];if(r<=0&&n<=0&&this.width<=t&&this.height<=o){if(u)return!0;for(var v=0;v<this.boxKeys.length;v++)p.push({key:this.boxKeys[v],x1:this.bboxes[v*4],y1:this.bboxes[v*4+1],x2:this.bboxes[v*4+2],y2:this.bboxes[v*4+3]});return l?p.filter(l):p}var x={hitTest:u,seenUids:{box:{},circle:{}}};return this.forEachCell(r,n,t,o,this.queryCell,p,x,l),u?p.length>0:p}},{key:"queryCell",value:function(r,n,t,o,u,l,p,v){var x=p.seenUids,E=this.boxCells[u];if(E!==null){var C=this.bboxes,T=T5(E),O;try{for(T.s();!(O=T.n()).done;){var L=O.value;if(!x.box[L]){x.box[L]=!0;var B=L*4;if(r<=C[B+2]&&n<=C[B+3]&&t>=C[B+0]&&o>=C[B+1]&&(!v||v(this.boxKeys[L]))){if(p.hitTest)return l.push(!0),!0;l.push({key:this.boxKeys[L],x1:C[B],y1:C[B+1],x2:C[B+2],y2:C[B+3]})}}}}catch(H){T.e(H)}finally{T.f()}}return!1}},{key:"forEachCell",value:function(r,n,t,o,u,l,p,v){for(var x=this.convertToXCellCoord(r),E=this.convertToYCellCoord(n),C=this.convertToXCellCoord(t),T=this.convertToYCellCoord(o),O=x;O<=C;O++)for(var L=E;L<=T;L++){var B=this.xCellCount*L+O;if(u.call(this,r,n,t,o,B,l,p,v))return}}},{key:"convertToXCellCoord",value:function(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}},{key:"convertToYCellCoord",value:function(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}}]),e}(),I5=k5,M1=function(){function e(i,r){(0,xt.Z)(this,e),(0,Y.Z)(this,"viewportPadding",100),this.width=i,this.height=r,this.viewportPadding=Math.max(i,r),this.grid=new I5(i+this.viewportPadding,r+this.viewportPadding,25),this.screenRightBoundary=i+this.viewportPadding,this.screenBottomBoundary=r+this.viewportPadding,this.gridRightBoundary=i+2*this.viewportPadding,this.gridBottomBoundary=r+2*this.viewportPadding}return(0,wt.Z)(e,[{key:"placeCollisionBox",value:function(r){var n=r.x1+r.anchorPointX+this.viewportPadding,t=r.y1+r.anchorPointY+this.viewportPadding,o=r.x2+r.anchorPointX+this.viewportPadding,u=r.y2+r.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,t,o,u)||this.grid.hitTest(n,t,o,u)?{box:[]}:{box:[n,t,o,u]}}},{key:"insertCollisionBox",value:function(r,n){var t={featureIndex:n};this.grid.insert(t,r[0],r[1],r[2],r[3])}},{key:"project",value:function(r,n,t){var o=Mp(n,t,0,1),u=hd(),l=kn.apply(Ee,(0,N.Z)(r));return Kd(u,o,l),{x:(u[0]/u[3]+1)/2*this.width+this.viewportPadding,y:(-u[1]/u[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(r,n,t,o){return t>=0&&r<this.gridRightBoundary&&o>=0&&n<this.gridBottomBoundary}}]),e}();function k1(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=P5(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function P5(e,i){if(!!e){if(typeof e=="string")return I1(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return I1(e,i)}}function I1(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function P1(e){var i=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0;break;default:i=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0;break;default:r=.5}return{horizontalAlign:i,verticalAlign:r}}function R1(e,i,r,n,t){if(!!t){var o=e[n],u=o.glyph;if(u)for(var l=i[u].advance*o.scale,p=(e[n].x+l)*t,v=r;v<=n;v++)e[v].x-=p}}function O1(e,i,r,n,t,o,u){var l=(i-r)*t,p=(-n*u+.5)*o,v=k1(e),x;try{for(v.s();!(x=v.n()).done;){var E=x.value;E.x+=l,E.y+=p}}catch(C){v.e(C)}finally{v.f()}}function R5(e,i,r,n,t,o,u){var l=-8,p=0,v=l,x=0,E=e.positionedGlyphs,C=o==="right"?1:o==="left"?0:.5,T=E.length;r.forEach(function(oe){if(oe.split("").forEach(function(Re){var Ne=i[Re],ut=0;Ne&&(E.push({glyph:Re,x:p,y:v+ut,vertical:!1,scale:1,metrics:Ne}),p+=Ne.advance+u)}),E.length!==T){var le=p-u;x=Math.max(le,x),R1(E,i,T,E.length-1,C)}p=0,v-=n+5});var O=P1(t),L=O.horizontalAlign,B=O.verticalAlign;O1(E,C,L,B,x,n,r.length);var H=v-l;e.top+=-B*H,e.bottom=e.top-H,e.left+=-L*x,e.right=e.left+x}function O5(e,i,r,n,t,o,u){var l=-8,p=0,v=l,x=0,E=e.positionedGlyphs,C=o==="right"?1:o==="left"?0:.5,T=E.length;r.forEach(function(oe){var le=i[oe],Re=0;if(le&&(E.push({glyph:oe,x:le.advance/2,y:v+Re,vertical:!1,scale:1,metrics:le}),p+=le.advance+u),E.length!==T){var Ne=p-u;x=Math.max(Ne,x),R1(E,i,T,E.length-1,C)}p=0,v-=n+5});var O=P1(t),L=O.horizontalAlign,B=O.verticalAlign;O1(E,C,L,B,x,n,r.length);var H=v-l;e.top+=-B*H,e.bottom=e.top-H,e.left+=-L*x,e.right=e.left+x}function L1(e,i,r,n,t,o){var u=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],l=arguments.length>7?arguments[7]:void 0,p=e.split(`
`),v=[],x={positionedGlyphs:v,top:u[1],bottom:u[1],left:u[0],right:u[0],lineCount:p.length,text:e};return l?O5(x,i,p,r,n,t,o):R5(x,i,p,r,n,t,o),v.length?x:!1}function D1(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,n=e.positionedGlyphs,t=n===void 0?[]:n,o=[],u=k1(t),l;try{for(u.s();!(l=u.n()).done;){var p=l.value,v=p.metrics,x=4,E=v.advance*p.scale/2,C=r?[p.x+E,p.y]:[0,0],T=r?[0,0]:[p.x+E+i[0],p.y+i[1]],O=(0-x)*p.scale-E+T[0],L=(0-x)*p.scale+T[1],B=O+v.width*p.scale,H=L+v.height*p.scale,oe={x:O,y:L},le={x:B,y:L},Re={x:O,y:H},Ne={x:B,y:H};o.push({tl:oe,tr:le,bl:Re,br:Ne,tex:v,glyphOffset:C})}}catch(ut){u.e(ut)}finally{u.f()}return o}function L5(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=D5(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function D5(e,i){if(!!e){if(typeof e=="string")return F1(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return F1(e,i)}}function F1(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function F5(e){var i=B5();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function B5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var B1=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,N1=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_raisingHeight: 0.0;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function z1(e){var i=this,r=e.id,n=[],t=[];if(!i.glyphInfoMap||!i.glyphInfoMap[r])return{vertices:[],indices:[],size:7};var o=i.glyphInfoMap[r].centroid,u=o.length===2?[o[0],o[1],0]:o;return i.glyphInfoMap[r].glyphQuads.forEach(function(l,p){n.push.apply(n,(0,N.Z)(u).concat([l.tex.x,l.tex.y+l.tex.height,l.tl.x,l.tl.y],(0,N.Z)(u),[l.tex.x+l.tex.width,l.tex.y+l.tex.height,l.tr.x,l.tr.y],(0,N.Z)(u),[l.tex.x+l.tex.width,l.tex.y,l.br.x,l.br.y],(0,N.Z)(u),[l.tex.x,l.tex.y,l.bl.x,l.bl.y])),t.push(0+p*4,1+p*4,2+p*4,2+p*4,3+p*4,0+p*4)}),{vertices:n,indices:t,size:7}}var Z1=function(e){(0,gr.Z)(r,e);var i=F5(r);function r(){var n;(0,xt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,De.Z)(n),"glyphInfoMap",{}),(0,Y.Z)((0,De.Z)(n),"currentZoom",-1),(0,Y.Z)((0,De.Z)(n),"textureHeight",0),(0,Y.Z)((0,De.Z)(n),"textCount",0),(0,Y.Z)((0,De.Z)(n),"preTextStyle",{}),(0,Y.Z)((0,De.Z)(n),"mapping",(0,de.Z)(q().mark(function l(){return q().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return n.initGlyph(),n.updateTexture(),v.next=4,n.reBuildModel();case 4:case"end":return v.stop()}},l)}))),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.stroke,p=l===void 0?"#fff":l,v=t.strokeWidth,x=v===void 0?0:v,E=t.textAnchor,C=E===void 0?"center":E,T=t.textAllowOverlap,O=T===void 0?!1:T,L=t.halo,B=L===void 0?.5:L,H=t.gamma,oe=H===void 0?2:H,le=t.raisingHeight,Re=le===void 0?0:le,Ne=this.fontService,ut=Ne.canvas,Ot=Ne.mapping;if(Ot&&Object.keys(Ot).length!==this.textCount&&ut&&(this.updateTexture(),this.textCount=Object.keys(Ot).length),this.preTextStyle={textAnchor:C,textAllowOverlap:O},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,strokeWidth:x,stroke:p})){this.judgeStyleAttributes({opacity:u,strokeWidth:x,stroke:p});var Nt=this.layer.getEncodedData(),jt=this.calDataFrame(this.cellLength,Nt,this.cellProperties),br=jt.data,yr=jt.width,Ur=jt.height;this.rowCount=Ur,this.dataTexture=this.cellLength>0&&br.length>0?this.createTexture2D({flipY:!0,data:br,format:$.LUMINANCE,type:$.FLOAT,width:yr,height:Ur}):this.createTexture2D({flipY:!0,data:[1],format:$.LUMINANCE,type:$.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(Re),u_opacity:(0,St.isNumber)(u)?u:1,u_stroke_width:(0,St.isNumber)(x)?x:1,u_stroke_color:this.getStrokeColor(p),u_sdf_map:this.texture,u_halo_blur:B,u_gamma_scale:oe,u_sdf_map_size:[(ut==null?void 0:ut.width)||1,(ut==null?void 0:ut.height)||1]}}},{key:"initModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p,v,x;return q().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return this.layer.inited||this.bindEvent(),this.extent=this.textExtent(),u=this.layer.getLayerConfig(),l=u.textAnchor,p=l===void 0?"center":l,v=u.textAllowOverlap,x=v===void 0?!0:v,this.preTextStyle={textAnchor:p,textAllowOverlap:x},C.next=6,this.buildModels();case 6:return C.abrupt("return",C.sent);case 7:case"end":return C.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p,v,x,E,C,T;return q().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,E=u.textAllowOverlap,C=E===void 0?!1:E,this.initGlyph(),this.updateTexture(),C||this.filterGlyphs(),L.next=6,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:N1,fragmentShader:B1,triangulation:z1.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:Xe(p,x)});case 6:return T=L.sent,L.abrupt("return",[T]);case 8:case"end":return L.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"needUpdate",value:function(){var t=this.layer.getLayerConfig(),o=t.textAllowOverlap,u=o===void 0?!1:o,l=this.layer.getEncodedData();if(l.length<5||u)return!1;var p=this.mapService.getZoom(),v=this.mapService.getBounds(),x=vc(this.extent,v);return Math.abs(this.currentZoom-p)>1||!x||u!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var t,o;(t=this.texture)===null||t===void 0||t.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.layer.off("remapping",this.mapping)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:_n.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(o){var u=o.rotate,l=u===void 0?0:u;return Array.isArray(l)?[l[0]]:[l]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:_n.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(o,u,l){return[l[5],l[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(o){var u=o.size,l=u===void 0?12:u;return Array.isArray(l)?[l[0]]:[l]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:_n.Attribute,descriptor:{name:"a_tex",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}})}},{key:"bindEvent",value:function(){this.layer.isTileLayer||this.layer.on("remapping",this.mapping)}},{key:"textExtent",value:function(){var t=this.mapService.getBounds();return iu(t,.5)}},{key:"initTextFont",value:function(){var t=this.layer.getLayerConfig(),o=t.fontWeight,u=o===void 0?"400":o,l=t.fontFamily,p=l===void 0?"sans-serif":l,v=this.layer.getEncodedData(),x=[];v.forEach(function(E){var C=E.shape,T=C===void 0?"":C;T=T.toString();var O=L5(T),L;try{for(O.s();!(L=O.n()).done;){var B=L.value;x.indexOf(B)===-1&&x.push(B)}}catch(H){O.e(H)}finally{O.f()}}),this.fontService.setFontOptions({characterSet:x,fontWeight:u,fontFamily:p,iconfont:!1})}},{key:"initIconFontTex",value:function(){var t=this.layer.getLayerConfig(),o=t.fontWeight,u=o===void 0?"400":o,l=t.fontFamily,p=l===void 0?"sans-serif":l,v=this.layer.getEncodedData(),x=[];v.forEach(function(E){var C=E.shape,T=C===void 0?"":C;T="".concat(T),x.indexOf(T)===-1&&x.push(T)}),this.fontService.setFontOptions({characterSet:x,fontWeight:u,fontFamily:p,iconfont:!0})}},{key:"generateGlyphLayout",value:function(t){var o=this,u=this.fontService.mapping,l=this.layer.getLayerConfig(),p=l.spacing,v=p===void 0?2:p,x=l.textAnchor,E=x===void 0?"center":x,C=this.layer.getEncodedData();this.glyphInfo=C.map(function(T){var O=T.shape,L=O===void 0?"":O,B=T.id,H=T.size,oe=H===void 0?1:H,le=T.textOffset,Re=le===void 0?[0,0]:le,Ne=L1(L.toString(),u,oe,E,"left",v,Re,t),ut=D1(Ne,Re,!1);return T.shaping=Ne,T.glyphQuads=ut,T.centroid=h(T.coordinates),T.originCentroid=T.version==="GAODE2.x"?h(T.originCoordinates):T.originCentroid=T.centroid,o.glyphInfoMap[B]={shaping:Ne,glyphQuads:ut,centroid:h(T.coordinates)},T})}},{key:"filterGlyphs",value:function(){var t=this,o=this.layer.getLayerConfig(),u=o.padding,l=u===void 0?[4,4]:u,p=o.textAllowOverlap,v=p===void 0?!1:p;if(!v){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var x=this.rendererService.getViewportSize(),E=x.width,C=x.height,T=new M1(E,C),O=this.glyphInfo.filter(function(L){var B=L.shaping,H=L.id,oe=H===void 0?0:H,le=L.version==="GAODE2.x"?L.originCentroid:L.centroid,Re=L.size,Ne=Re/16,ut=t.mapService.lngLatToContainer(le),Ot=T.placeCollisionBox({x1:B.left*Ne-l[0],x2:B.right*Ne+l[0],y1:B.top*Ne-l[1],y2:B.bottom*Ne+l[1],anchorPointX:ut.x,anchorPointY:ut.y}),Nt=Ot.box;return Nt&&Nt.length?(T.insertCollisionBox(Nt,oe),!0):!1});O.forEach(function(L){t.glyphInfoMap[L.id]=L})}}},{key:"initGlyph",value:function(){var t=this.layer.getLayerConfig(),o=t.iconfont,u=o===void 0?!1:o;u?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(u)}},{key:"updateTexture",value:function(){var t=this.rendererService.createTexture2D,o=this.fontService.canvas;this.textureHeight=o.height,this.texture&&this.texture.destroy(),this.texture=t({data:o,mag:$.LINEAR,min:$.LINEAR,width:o.width,height:o.height})}},{key:"reBuildModel",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p,v,x,E;return q().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,this.filterGlyphs(),T.next=4,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:N1,fragmentShader:B1,triangulation:z1.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:Xe(p,x)});case 4:E=T.sent,this.layer.models=[E];case 6:case"end":return T.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()}]),r}(Ba);function N5(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=z5(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function z5(e,i){if(!!e){if(typeof e=="string")return U1(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return U1(e,i)}}function U1(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Z5(e){var i=U5();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function U5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var V1=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

#pragma include "picking"
void main() {
  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,j1=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "projection"
#pragma include "picking"

void main() {
  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`,G1=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;

uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;
uniform vec4 u_color;

void main() {
  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  
  gl_FragColor = mix(vec4(u_color.rgb, u_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
}
`,H1=`#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_size;

varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

#pragma include "projection"

void main() {
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = u_size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;

}
`;function W1(e){var i=this,r=e.id,n=[],t=[];if(!i.glyphInfoMap||!i.glyphInfoMap[r])return{vertices:[],indices:[],size:7};var o=i.glyphInfoMap[r].centroid,u=o.length===2?[o[0],o[1],0]:o;return i.glyphInfoMap[r].glyphQuads.forEach(function(l,p){n.push.apply(n,(0,N.Z)(u).concat([l.tex.x,l.tex.y+l.tex.height,l.tl.x,l.tl.y],(0,N.Z)(u),[l.tex.x+l.tex.width,l.tex.y+l.tex.height,l.tr.x,l.tr.y],(0,N.Z)(u),[l.tex.x+l.tex.width,l.tex.y,l.br.x,l.br.y],(0,N.Z)(u),[l.tex.x,l.tex.y,l.bl.x,l.bl.y])),t.push(0+p*4,1+p*4,2+p*4,2+p*4,3+p*4,0+p*4)}),{vertices:n,indices:t,size:7}}var V5=function(e){(0,gr.Z)(r,e);var i=Z5(r);function r(){var n;(0,xt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,De.Z)(n),"glyphInfoMap",{}),(0,Y.Z)((0,De.Z)(n),"currentZoom",-1),(0,Y.Z)((0,De.Z)(n),"textureHeight",0),(0,Y.Z)((0,De.Z)(n),"textCount",0),(0,Y.Z)((0,De.Z)(n),"preTextStyle",{}),(0,Y.Z)((0,De.Z)(n),"mapping",function(){n.initGlyph(),n.updateTexture(),n.filterGlyphs(),n.reBuildModel()}),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.stroke,p=l===void 0?"#fff":l,v=t.strokeWidth,x=v===void 0?0:v,E=t.textAnchor,C=E===void 0?"center":E,T=t.textAllowOverlap,O=T===void 0?!1:T,L=t.halo,B=L===void 0?.5:L,H=t.gamma,oe=H===void 0?2:H,le=t.usage,Re=t.color,Ne=Re===void 0?"#fff":Re,ut=t.size,Ot=ut===void 0?1:ut,Nt=this.fontService,jt=Nt.canvas,br=Nt.mapping;return Object.keys(br).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(br).length),this.preTextStyle={textAnchor:C,textAllowOverlap:O},{u_opacity:(0,St.isNumber)(u)?u:1,u_stroke_width:(0,St.isNumber)(x)?x:1,u_stroke_color:this.getStrokeColor(p),u_sdf_map:this.texture,u_halo_blur:B,u_gamma_scale:oe,u_sdf_map_size:[jt.width,jt.height],u_color:le==="basemap"?he(Ne):[0,0,0,0],u_size:le==="basemap"?Ot:1}}},{key:"initModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p,v,x;return q().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return this.extent=this.textExtent(),u=this.layer.getLayerConfig(),l=u.textAnchor,p=l===void 0?"center":l,v=u.textAllowOverlap,x=v===void 0?!0:v,this.preTextStyle={textAnchor:p,textAllowOverlap:x},C.next=5,this.buildModels();case 5:return C.abrupt("return",C.sent);case 6:case"end":return C.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p;return q().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return this.mapping(),u=this.layer.getLayerConfig(),l=u.usage,x.next=4,this.layer.buildLayerModel({moduleName:"pointTileText_"+l,vertexShader:l==="basemap"?H1:j1,fragmentShader:l==="basemap"?G1:V1,triangulation:W1.bind(this),depth:{enable:!1},blend:this.getBlend(),pick:l!=="basemap"});case 4:return p=x.sent,x.abrupt("return",[p]);case 6:case"end":return x.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getLayerConfig(),o=t.usage;this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:_n.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(l,p,v){return[v[5],v[6]]}}}),o!=="basemap"&&this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(l){var p=l.size,v=p===void 0?12:p;return Array.isArray(v)?[v[0]]:[v]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:_n.Attribute,descriptor:{name:"a_tex",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(l,p,v){return[v[3],v[4]]}}})}},{key:"textExtent",value:function(){var t=this.mapService.getBounds();return iu(t,.5)}},{key:"initTextFont",value:function(){var t=this.layer.getLayerConfig(),o=t.fontWeight,u=o===void 0?"400":o,l=t.fontFamily,p=l===void 0?"sans-serif":l,v=this.layer.getEncodedData(),x=[];v.forEach(function(E){var C=E.shape,T=C===void 0?"":C;T=T.toString();var O=N5(T),L;try{for(O.s();!(L=O.n()).done;){var B=L.value;x.indexOf(B)===-1&&x.push(B)}}catch(H){O.e(H)}finally{O.f()}}),this.fontService.setFontOptions({characterSet:x,fontWeight:u,fontFamily:p,iconfont:!1})}},{key:"generateGlyphLayout",value:function(){var t=this,o=this.fontService.mapping,u=this.layer.getLayerConfig(),l=u.spacing,p=l===void 0?2:l,v=u.textAnchor,x=v===void 0?"center":v,E=this.layer.getEncodedData();this.glyphInfo=E.map(function(C){var T=C.shape,O=T===void 0?"":T,L=C.id,B=C.size,H=B===void 0?1:B,oe=C.textOffset,le=oe===void 0?[0,0]:oe,Re=L1(O.toString(),o,H,x,"left",p,le,!1),Ne=D1(Re,le,!1);return C.shaping=Re,C.glyphQuads=Ne,C.centroid=h(C.coordinates),C.originCentroid=C.version==="GAODE2.x"?h(C.originCoordinates):C.originCentroid=C.centroid,t.glyphInfoMap[L]={shaping:Re,glyphQuads:Ne,centroid:h(C.coordinates)},C})}},{key:"filterGlyphs",value:function(){var t=this,o=this.layer.getLayerConfig(),u=o.padding,l=u===void 0?[4,4]:u,p=o.textAllowOverlap,v=p===void 0?!1:p;if(!v){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var x=this.rendererService.getViewportSize(),E=x.width,C=x.height,T=new M1(E,C),O=this.glyphInfo.filter(function(L){var B=L.shaping,H=L.id,oe=H===void 0?0:H,le=L.version==="GAODE2.x"?L.originCentroid:L.centroid,Re=L.size,Ne=Re/24,ut=t.mapService.lngLatToContainer(le),Ot=T.placeCollisionBox({x1:B.left*Ne-l[0],x2:B.right*Ne+l[0],y1:B.top*Ne-l[1],y2:B.bottom*Ne+l[1],anchorPointX:ut.x,anchorPointY:ut.y}),Nt=Ot.box;return Nt&&Nt.length?(T.insertCollisionBox(Nt,oe),!0):!1});O.forEach(function(L){t.glyphInfoMap[L.id]=L})}}},{key:"initGlyph",value:function(){this.initTextFont(),this.generateGlyphLayout()}},{key:"updateTexture",value:function(){var t=this.rendererService.createTexture2D,o=this.fontService.canvas;this.textureHeight=o.height,this.texture&&this.texture.destroy(),this.texture=t({data:o,mag:$.LINEAR,min:$.LINEAR,width:o.width,height:o.height})}},{key:"reBuildModel",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p;return q().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return u=this.layer.getLayerConfig(),l=u.usage,this.filterGlyphs(),x.next=4,this.layer.buildLayerModel({moduleName:"pointTileText_"+l,vertexShader:l==="basemap"?H1:j1,fragmentShader:l==="basemap"?G1:V1,triangulation:W1.bind(this),depth:{enable:!1},blend:this.getBlend(),pick:l!=="basemap"});case 4:return p=x.sent,x.abrupt("return",[p]);case 6:case"end":return x.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()}]),r}(Ba);function j5(e){var i=G5();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function G5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var H5=`uniform float u_additive;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  int shape = int(floor(v_data.w + 0.5));


  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(u_stroke_width < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), u_stroke_color * u_stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,W5=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

// uniform vec2 u_tileOrigin;
// uniform float u_coord;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping

  v_color = a_Color;
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, 0.0);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width));
  offset = project_pixel(offset);

  v_data = vec4(extrude.x, extrude.y, antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
  }

// if(u_coord > 0.0) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
  }
// } else {

  // vec2 pointPos = a_Position.xy;
  // vec4 world = vec4(project_mvt_offset_position(vec4(u_tileOrigin, 0.0, 1.0)).xyz, 1.0); // \u74E6\u7247\u8D77\u59CB\u70B9\u7684\u4E16\u754C\u5750\u6807

  // vec2 pointOffset =  pointPos *  pow(2.0, u_Zoom); // \u74E6\u7247\u5185\u7684\u70B9\u7684\u504F\u79FB\u5750\u6807
  
  // world.xy += offset;
  // world.xy += pointOffset;

  // if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
  //   // Needs to be divided with project_uCommonUnitsPerMeter
  //   world.w *= u_PixelsPerMeter.z;
  // }

  // gl_Position = u_ViewProjectionMatrix * world + u_ViewportCenterProjection;
// }

 
  setPickingColor(a_PickingColor);


}
`,X5=function(e){(0,gr.Z)(r,e);var i=j5(r);function r(){return(0,xt.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.strokeOpacity,p=l===void 0?1:l,v=t.strokeWidth,x=v===void 0?0:v,E=t.stroke,C=E===void 0?"rgba(0,0,0,0)":E,T=t.blend;return{u_additive:T==="additive"?1:0,u_opacity:Number(u),u_stroke_opacity:Number(p),u_stroke_width:Number(x),u_stroke_color:this.getStrokeColor(C)}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Zp)}},{key:"initModels",value:function(){var n=(0,de.Z)(q().mark(function o(){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p,v,x;return q().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return u=this.layer.getLayerConfig(),l=u.workerEnabled,p=l===void 0?!1:l,v=u.usage,this.layer.triangulation=Zp,C.next=4,this.layer.buildLayerModel({moduleName:"pointTile_"+v,vertexShader:W5,fragmentShader:H5,triangulation:Zp,depth:{enable:!1},cull:{enable:!0,face:xu(this.mapService.version)},blend:this.getBlend(),workerEnabled:p,workerOptions:{modelType:"pointTile"},pick:v!=="basemap"});case 4:return x=C.sent,C.abrupt("return",[x]);case 6:case"end":return C.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:_n.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(u,l,p,v){var x=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],E=v%4*3;return[x[E],x[E+1],x[E+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?5:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:_n.Attribute,descriptor:{name:"a_Shape",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(u){var l=u.shape,p=l===void 0?2:l,v=t.layer.getLayerConfig().shape2d,x=v.indexOf(p);return[x]}}})}}]),r}(Ba),$5={fillImage:u5,fill:E1,radar:b5,image:S1,normal:C1,simplePoint:A5,extrude:x1,text:Z1,tile:X5,tileText:V5,earthFill:qT,earthExtrude:HT},Y5=$5;function q5(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=K5(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function K5(e,i){if(!!e){if(typeof e=="string")return X1(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return X1(e,i)}}function X1(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Q5(e){var i=J5();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function J5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var c0=function(e){(0,gr.Z)(r,e);var i=Q5(r);function r(){var n;(0,xt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,De.Z)(n),"type","PointLayer"),(0,Y.Z)((0,De.Z)(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}}),n}return(0,wt.Z)(r,[{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u;return q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel=new Y5[u](this),p.next=4,this.initLayerModels();case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"rebuildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var t=this.shapeOption,o=t.field,u=t.values,l=this.getLayerConfig(),p=l.shape2d,v=this.iconService.getIconMap();if(o&&(p==null?void 0:p.indexOf(o))!==-1)return"fill";if(u==="text")return"text";if(u&&u instanceof Array){var x=q5(u),E;try{for(x.s();!(E=x.n()).done;){var C=E.value;if(typeof C=="string"&&v.hasOwnProperty(C))return"image"}}catch(T){x.e(T)}finally{x.f()}}}return"normal"}},{key:"getDefaultConfig",value:function(){var t=this.getModelType(),o={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},tile:{},tileText:{},earthFill:{},earthExtrude:{}};return o[t]}},{key:"getModelType",value:function(){var t=this.getEncodedData(),o=this.getLayerConfig(),u=o.shape2d,l=o.shape3d,p=this.iconService.getIconMap(),v=t.find(function(E){return E.hasOwnProperty("shape")});if(v){var x=v.shape;return x==="dot"?"normal":x==="simple"?"simplePoint":x==="radar"?"radar":this.layerType==="fillImage"?"fillImage":(u==null?void 0:u.indexOf(x))!==-1?this.mapService.version==="GLOBEL"?"earthFill":"fill":(l==null?void 0:l.indexOf(x))!==-1?this.mapService.version==="GLOBEL"?"earthExtrude":"extrude":p.hasOwnProperty(x)?"image":"text"}else return this.getModelTypeWillEmptyData()}}]),r}(tp);function eM(e){var i=tM();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function tM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rM=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];  
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }

  } else {
     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,nM=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,iM=`uniform sampler2D u_texture;
uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float lightWeight = styleMappingMat[3][1];
  float topU = styleMappingMat[2][2];
  float topV = styleMappingMat[2][3];

  float sidey = styleMappingMat[3][0];
  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }
  } else {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = texture2D(u_texture, vec2(topU, topV));
  }
  

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,aM=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  v_Color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - a_Position.z(judge side by a_Position.z)
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - u - v
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[2][2] = a_uvs[0];
  styleMappingMat[2][3] = 1.0 - a_uvs[1];
  styleMappingMat[3][0] = a_uvs[2];


  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,oM=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      // side notuse linear
       gl_FragColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
}
`,sM=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,uM=function(e){(0,gr.Z)(r,e);var i=eM(r);function r(){return(0,xt.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.heightfixed,p=l===void 0?!1:l,v=t.raisingHeight,x=v===void 0?0:v,E=t.topsurface,C=E===void 0?!0:E,T=t.sidesurface,O=T===void 0?!0:T,L=t.sourceColor,B=t.targetColor;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var H=this.layer.getEncodedData(),oe=this.calDataFrame(this.cellLength,H,this.cellProperties),le=oe.data,Re=oe.width,Ne=oe.height;this.rowCount=Ne,this.dataTexture=this.cellLength>0&&le.length>0?this.createTexture2D({flipY:!0,data:le,format:$.LUMINANCE,type:$.FLOAT,width:Re,height:Ne}):this.createTexture2D({flipY:!0,data:[1],format:$.LUMINANCE,type:$.FLOAT,width:1,height:1})}var ut=0,Ot=[1,1,1,1],Nt=[1,1,1,1];return L&&B&&(Ot=he(L),Nt=he(B),ut=1),{u_topsurface:Number(C),u_sidesurface:Number(O),u_heightfixed:Number(p),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(x),u_opacity:(0,St.isNumber)(u)?u:1,u_linearColor:ut,u_sourceColor:Ot,u_targetColor:Nt,u_texture:this.texture}}},{key:"initModels",value:function(){var n=(0,de.Z)(q().mark(function o(){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.loadTexture(),l.next=3,this.buildModels();case 3:return l.abrupt("return",l.sent);case 4:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p,v,x,E,C,T,O,L;return q().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,E=this.getShaders(),C=E.frag,T=E.vert,O=E.type,H.next=4,this.layer.buildLayerModel({moduleName:O,vertexShader:T,fragmentShader:C,triangulation:u1,stencil:Xe(p,x)});case 4:return L=H.sent,H.abrupt("return",[L]);case 6:case"end":return H.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.pickLight,u=t.mapTexture;return u?{frag:iM,vert:aM,type:"polygonExtrudeTexture"}:o?{frag:oM,vert:sM,type:"polygonExtrudePickLight"}:{frag:rM,vert:nM,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var t,o;(t=this.dataTexture)===null||t===void 0||t.destroy(),(o=this.texture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getSource().extent,o=(0,hr.Z)(t,4),u=o[0],l=o[1],p=o[2],v=o[3],x=p-u,E=v-l;this.styleAttributeService.registerStyleAttribute({name:"uvs",type:_n.Attribute,descriptor:{name:"a_uvs",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(T,O,L){var B=L[0],H=L[1];return[(B-u)/x,(H-l)/E,L[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:_n.Attribute,descriptor:{name:"a_Normal",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(T,O,L,B,H){return H}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(T){var O=T.size,L=O===void 0?10:O;return Array.isArray(L)?[L[0]]:[L]}}})}},{key:"loadTexture",value:function(){var t=this,o=this.layer.getLayerConfig(),u=o.mapTexture,l=this.rendererService.createTexture2D;if(this.texture=l({height:0,width:0}),u){var p=new Image;p.crossOrigin="",p.src=u,p.onload=function(){t.texture=l({data:p,width:p.width,height:p.height,wrapS:$.CLAMP_TO_EDGE,wrapT:$.CLAMP_TO_EDGE,min:$.LINEAR,mag:$.LINEAR}),t.layerService.reRender()}}}}]),r}(Ba);function lM(e){var i=cM();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function cM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fM=`uniform float u_opacity: 1.0;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,hM=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;


void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,pM=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}`,dM=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,vM=function(e){(0,gr.Z)(r,e);var i=lM(r);function r(){return(0,xt.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.raisingHeight,u=o===void 0?0:o,l=t.opacity,p=l===void 0?1:l,v=t.opacityLinear,x=v===void 0?{enable:!1,dir:"in"}:v;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var E=this.layer.getEncodedData(),C=this.calDataFrame(this.cellLength,E,this.cellProperties),T=C.data,O=C.width,L=C.height;this.rowCount=L,this.dataTexture=this.cellLength>0&&T.length>0?this.createTexture2D({flipY:!0,data:T,format:$.LUMINANCE,type:$.FLOAT,width:O,height:L}):this.createTexture2D({flipY:!0,data:[1],format:$.LUMINANCE,type:$.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(u),u_opacity:(0,St.isNumber)(p)?p:1,u_opacitylinear:Number(x.enable),u_dir:x.dir==="in"?1:0}}},{key:"initModels",value:function(){var n=(0,de.Z)(q().mark(function o(){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p,v,x,E,C,T,O,L,B,H,oe,le;return q().wrap(function(Ne){for(;;)switch(Ne.prev=Ne.next){case 0:return u=this.getModelParams(),l=u.frag,p=u.vert,v=u.triangulation,x=u.type,E=this.layer.getLayerConfig(),C=E.mask,T=C===void 0?!1:C,O=E.maskInside,L=O===void 0?!0:O,B=E.workerEnabled,H=B===void 0?!1:B,oe=E.enablePicking,this.layer.triangulation=v,Ne.next=5,this.layer.buildLayerModel({moduleName:x,vertexShader:p,fragmentShader:l,triangulation:v,primitive:$.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:Xe(T,L),workerEnabled:H,workerOptions:{modelType:x,enablePicking:oe}});case 5:return le=Ne.sent,Ne.abrupt("return",[le]);case 7:case"end":return Ne.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.dataTexture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getLayerConfig(),o=t.opacityLinear,u=o===void 0?{enable:!1,dir:"in"}:o;u.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:_n.Attribute,descriptor:{name:"a_linear",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(p,v,x){return[x[3],x[4],x[5]]}}})}},{key:"getModelParams",value:function(){var t=this.layer.getLayerConfig(),o=t.opacityLinear,u=o===void 0?{enable:!1}:o;return u.enable?{frag:hM,vert:pM,type:"polygonLinear",triangulation:TA}:{frag:fM,vert:dM,type:"polygonFill",triangulation:Qf}}}]),r}(Ba);function mM(e){var i=gM();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function gM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yM=`
uniform float u_time: 0.0;
uniform float u_opacity: 1.0;

varying vec2 v_uv;

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;
// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)
// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)
uniform vec4 u_watercolor;
uniform vec4 u_watercolor2;
vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture2D(u_texture2,p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture2D(u_texture1,fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    

  float opacity = u_opacity;
  gl_FragColor = vec4(col, opacity);  
}
`,_M=`attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;

#pragma include "projection"

void main() {
  v_uv = a_uv;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,xM=function(e){(0,gr.Z)(r,e);var i=mM(r);function r(){return(0,xt.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.watercolor,p=l===void 0?"#6D99A8":l,v=t.watercolor2,x=v===void 0?"#0F121C":v;return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:he(p),u_watercolor2:he(x),u_opacity:(0,St.isNumber)(u)?u:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,de.Z)(q().mark(function o(){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.loadTexture(),l.next=3,this.buildModels();case 3:return l.abrupt("return",l.sent);case 4:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p,v,x,E;return q().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,T.next=3,this.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:_M,fragmentShader:yM,triangulation:hv,primitive:$.TRIANGLES,depth:{enable:!1},stencil:Xe(p,x)});case 3:return E=T.sent,T.abrupt("return",[E]);case 5:case"end":return T.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t,o,u;(t=this.texture1)===null||t===void 0||t.destroy(),(o=this.texture2)===null||o===void 0||o.destroy(),(u=this.texture3)===null||u===void 0||u.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getSource().extent,o=(0,hr.Z)(t,4),u=o[0],l=o[1],p=o[2],v=o[3],x=p-u,E=v-l;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:_n.Attribute,descriptor:{name:"a_uv",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(T,O,L,B){var H=T.version===hs["GAODE2.x"]?T.originCoordinates[0][B]:L,oe=(0,hr.Z)(H,2),le=oe[0],Re=oe[1];return[(le-u)/x,(Re-l)/E]}}})}},{key:"loadTexture",value:function(){var t=this,o=this.rendererService.createTexture2D,u={height:0,width:0};this.texture1=o(u),this.texture2=o(u),this.texture3=o(u),l(function(v){t.texture1=p(v[0]),t.texture2=p(v[1]),t.texture3=p(v[2]),t.layerService.reRender()});function l(v){var x=0,E=[],C=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];C.map(function(T){var O=new Image;O.crossOrigin="",O.src=T,E.push(O),O.onload=function(){x++,x===3&&v(E)}})}function p(v){return o({data:v,width:v.width,height:v.height,wrapS:$.MIRRORED_REPEAT,wrapT:$.MIRRORED_REPEAT,min:$.LINEAR,mag:$.LINEAR})}}}]),r}(Ba);function bM(e){var i=EM();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function EM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var SM=`uniform float u_opacity : 1.0;
varying vec4 v_color;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,wM=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

// uniform vec2 u_tileOrigin;
// uniform float u_coord;

varying vec4 v_color;

#pragma include "projection"
#pragma include "picking"

void main() {
  v_color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  // if(u_coord > 0.0) {
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
    }
  // } else {
  //   vec4 world = vec4(project_mvt_offset_position(vec4(u_tileOrigin, 0.0, 1.0)).xyz, 1.0); // \u74E6\u7247\u8D77\u59CB\u70B9\u7684\u4E16\u754C\u5750\u6807

  //   vec2 pointOffset = a_Position.xy *  pow(2.0, u_Zoom); // \u74E6\u7247\u5185\u7684\u70B9\u7684\u504F\u79FB\u5750\u6807
    
  //   world.xy += pointOffset;

  //   if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
  //     // Needs to be divided with project_uCommonUnitsPerMeter
  //     world.w *= u_PixelsPerMeter.z;
  //   }

  //   gl_Position = u_ViewProjectionMatrix * world + u_ViewportCenterProjection;
  // }

  setPickingColor(a_PickingColor);
}

`,CM=`uniform float u_opacity : 1.0;
uniform vec4 u_color;

void main() {
  gl_FragColor = u_color;
  gl_FragColor.a *= u_opacity;
}
`,AM=`attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#pragma include "projection"

void main() {
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}`,TM=function(e){(0,gr.Z)(r,e);var i=bM(r);function r(){return(0,xt.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.usage,p=t.color,v=p===void 0?"#fff":p;return{u_opacity:u,u_color:l==="basemap"?he(v):[0,0,0,0]}}},{key:"initModels",value:function(){var n=(0,de.Z)(q().mark(function o(){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p,v,x,E,C;return q().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,E=u.usage,this.layer.triangulation=hv,O.next=4,this.layer.buildLayerModel({moduleName:"polygonTile_"+E,vertexShader:E==="basemap"?AM:wM,fragmentShader:E==="basemap"?CM:SM,triangulation:hv,depth:{enable:!1},blend:this.getBlend(),stencil:Xe(p,x),pick:E!=="basemap"});case 4:return C=O.sent,O.abrupt("return",[C]);case 6:case"end":return O.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){}}]),r}(Ba);function MM(e){var i=kM();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function kM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var IM=`uniform sampler2D u_texture;
uniform float u_time: 0.0;
uniform float u_speed: 1.0;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;

float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

float water(vec3 p) {
  float t = u_time * u_speed;
  p.z += t * 2.; p.x += t * 2.;
  vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 3.; p.x += t * 0.52;
  vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 4.; p.x += t * 0.8;
  vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;
  c1 += c2 - c3;
  float z = (c1.x + c1.y + c1.z) / 3.;
  return p.y + z / 4.;
}

float map(vec3 p) {
  float d = 100.0;
  d = water(p);
  return d;
}

float intersect(vec3 ro, vec3 rd) {
  float d = 0.0;
  for (int i = 0; i <= 100; i++) {
    float h = map(ro + rd * d);
    if (h < 0.1) return  d;
    d += h;
  }
  return 0.0;
}

vec3 norm(vec3 p) {
  float eps = .1;
  return normalize(vec3(
    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
  ));
} 

float calSpc() {
  vec3 l1 = normalize(vec3(1, 1, 1));
  vec3 ro = vec3(-3, 20, -8);
  vec3 rc = vec3(0, 0, 0);
  vec3 ww = normalize(rc - ro);
  vec3 uu = normalize(cross(vec3(0,1,0), ww));
  vec3 vv = normalize(cross(rc - ro, uu));
  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
  float d = intersect(ro, rd);
  vec3 p = ro + rd * d;
  vec3 n = norm(p);
  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
  return spc;
}

void main() {
  float opacity = u_opacity;
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;

  float spc = calSpc();
  gl_FragColor += spc * 0.4;
}
`,PM=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;


#pragma include "projection"

void main() {
  v_uv = a_uv;

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,RM=function(e){(0,gr.Z)(r,e);var i=MM(r);function r(){return(0,xt.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.speed,p=l===void 0?.5:l;return{u_texture:this.texture,u_speed:p,u_opacity:(0,St.isNumber)(u)?u:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,de.Z)(q().mark(function o(){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.loadTexture(),l.next=3,this.buildModels();case 3:return l.abrupt("return",l.sent);case 4:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p,v,x,E;return q().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,T.next=3,this.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:PM,fragmentShader:IM,triangulation:hv,primitive:$.TRIANGLES,depth:{enable:!1},stencil:Xe(p,x)});case 3:return E=T.sent,T.abrupt("return",[E]);case 5:case"end":return T.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getSource().extent,o=(0,hr.Z)(t,4),u=o[0],l=o[1],p=o[2],v=o[3],x=p-u,E=v-l;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:_n.Attribute,descriptor:{name:"a_uv",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(T,O,L,B){var H=T.version===hs["GAODE2.x"]?T.originCoordinates[0][B]:L,oe=(0,hr.Z)(H,2),le=oe[0],Re=oe[1];return[(le-u)/x,(Re-l)/E]}}})}},{key:"loadTexture",value:function(){var t=this,o=this.layer.getLayerConfig(),u=o.waterTexture,l=this.rendererService.createTexture2D;this.texture=l({height:0,width:0});var p=new Image;p.crossOrigin="",u?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),p.src=u):p.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",p.onload=function(){t.texture=l({data:p,width:p.width,height:p.height,wrapS:$.MIRRORED_REPEAT,wrapT:$.MIRRORED_REPEAT,min:$.LINEAR,mag:$.LINEAR}),t.layerService.reRender()}}}]),r}(Ba),OM={fill:vM,line:y1,extrude:uM,text:Z1,point_fill:E1,point_image:S1,point_normal:C1,point_extrude:x1,water:RM,ocean:xM,tile:TM},LM=OM;function DM(e){var i=FM();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function FM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Nm=function(e){(0,gr.Z)(r,e);var i=DM(r);function r(){var n;(0,xt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,De.Z)(n),"type","PolygonLayer"),n}return(0,wt.Z)(r,[{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u;return q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel=new LM[u](this),p.next=4,this.initLayerModels();case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getModelType",value:function(){var t,o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=o==null||(t=o.scale)===null||t===void 0?void 0:t.field;return u==="fill"?"fill":u==="extrude"?"extrude":u==="water"?"water":u==="ocean"?"ocean":u==="line"?"line":u==="tile"?"tile":this.getPointModelType()}},{key:"getPointModelType",value:function(){var t=this.getEncodedData(),o=this.getLayerConfig(),u=o.shape2d,l=o.shape3d,p=this.iconService.getIconMap(),v=t.find(function(E){return E.hasOwnProperty("shape")});if(v){var x=v.shape;return x==="dot"?"point_normal":(u==null?void 0:u.indexOf(x))!==-1?"point_fill":(l==null?void 0:l.indexOf(x))!==-1?"point_extrude":p.hasOwnProperty(x)?"point_image":"text"}else return"fill"}}]),r}(tp);function BM(e){var i=NM();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function NM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zM=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;
bool isnan_emu(float x) { return (x > 0.0 || x < 0.0) ? x != x : x != 0.0; }


void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue || isnan_emu(value))
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }
}
`,ZM=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,$1=function(e){(0,gr.Z)(r,e);var i=BM(r);function r(){return(0,xt.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.clampLow,p=l===void 0?!0:l,v=t.clampHigh,x=v===void 0?!0:v,E=t.noDataValue,C=E===void 0?-9999999:E,T=t.domain,O=T===void 0?[0,1]:T,L=t.rampColors;return this.colorTexture=this.layer.textureService.getColorTexture(L),{u_opacity:u||1,u_texture:this.texture,u_domain:O,u_clampLow:p,u_clampHigh:typeof x!="undefined"?x:p,u_noDataValue:C,u_colorTexture:this.colorTexture}}},{key:"getRasterData",value:function(){var n=(0,de.Z)(q().mark(function o(u){var l,p,v,x;return q().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(!Array.isArray(u.data)){C.next=4;break}return C.abrupt("return",{data:u.data,width:u.width,height:u.height});case 4:return C.next=6,u.data;case 6:return l=C.sent,p=l.rasterData,v=l.width,x=l.height,C.abrupt("return",{data:Array.from(p),width:v,height:x});case 11:case"end":return C.stop()}},o)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"initModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p,v,x,E,C,T,O,L,B,H,oe;return q().wrap(function(Re){for(;;)switch(Re.prev=Re.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,E=this.layer.getSource(),C=this.rendererService.createTexture2D,T=E.data.dataArray[0],Re.next=6,this.getRasterData(T);case 6:return O=Re.sent,L=O.data,B=O.width,H=O.height,this.texture=C({data:L,width:B,height:H,format:$.LUMINANCE,type:$.FLOAT}),Re.next=13,this.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:ZM,fragmentShader:zM,triangulation:s0,primitive:$.TRIANGLES,depth:{enable:!1},stencil:Xe(p,x)});case 13:return oe=Re.sent,Re.abrupt("return",[oe]);case 15:case"end":return Re.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.initModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t,o;(t=this.texture)===null||t===void 0||t.destroy(),(o=this.colorTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:_n.Attribute,descriptor:{name:"a_Uv",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}})}},{key:"updateColorTexture",value:function(){var t=this.rendererService.createTexture2D,o=this.layer.getLayerConfig(),u=o.rampColors,l=We(u);this.colorTexture=t({data:l.data,width:l.width,height:l.height,flipY:!1})}}]),r}(Ba),UM=["data"],VM=["rasterData"];function jM(e){var i=GM();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function GM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var HM=`precision mediump float;
uniform vec2 u_rminmax: vec2(0,255); 
uniform vec2 u_gminmax: vec2(0,255);
uniform vec2 u_bminmax: vec2(0,255);
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform float u_noDataValue : 0.0;
varying vec2 v_texCoord;

void main() {
  vec3 rgb = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).rgb;
  if(rgb == vec3(u_noDataValue)) {
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else {
    gl_FragColor = vec4(rgb.r / (u_rminmax.y -u_rminmax.x), rgb.g /(u_gminmax.y -u_gminmax.x), rgb.b/ (u_bminmax.y - u_bminmax.x), u_opacity);
  }
 
}`,WM=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,XM=function(e){(0,gr.Z)(r,e);var i=jM(r);function r(){var n;(0,xt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,De.Z)(n),"dataOption",{}),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.noDataValue,p=l===void 0?0:l,v=this.dataOption,x=v.rMinMax,E=v.gMinMax,C=v.bMinMax;return{u_opacity:u||1,u_texture:this.texture,u_noDataValue:p,u_rminmax:x,u_gminmax:E,u_bminmax:C}}},{key:"getRasterData",value:function(){var n=(0,de.Z)(q().mark(function o(u){var l,p,v,x,E;return q().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(!Array.isArray(u.data)){T.next=4;break}return l=u.data,p=(0,Za.Z)(u,UM),this.dataOption=p,T.abrupt("return",(0,z.Z)({data:l},p));case 4:return T.next=6,u.data;case 6:if(v=T.sent,x=v.rasterData,E=(0,Za.Z)(v,VM),this.dataOption=E,!Array.isArray(x)){T.next=14;break}return T.abrupt("return",(0,z.Z)({data:x},E));case 14:return T.abrupt("return",(0,z.Z)({data:Array.from(x)},E));case 15:case"end":return T.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"initModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p,v,x,E,C,T,O,L,B,H,oe;return q().wrap(function(Re){for(;;)switch(Re.prev=Re.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,E=this.layer.getSource(),C=this.rendererService.createTexture2D,T=E.data.dataArray[0],Re.next=6,this.getRasterData(T);case 6:return O=Re.sent,L=O.data,B=O.width,H=O.height,this.texture=C({data:L,width:B,height:H,format:$.RGB,type:$.FLOAT}),Re.next=13,this.layer.buildLayerModel({moduleName:"rasterImageDataRGBA",vertexShader:WM,fragmentShader:HM,triangulation:s0,primitive:$.TRIANGLES,depth:{enable:!1},stencil:Xe(p,x)});case 13:return oe=Re.sent,Re.abrupt("return",[oe]);case 15:case"end":return Re.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.initModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:_n.Attribute,descriptor:{name:"a_Uv",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}})}}]),r}(Ba);function $M(e){var i=YM();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function YM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qM=`precision mediump float;
uniform float u_opacity: 1.0;

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

varying vec2 v_texCoord;

uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;

void main() {
  vec4 baseColor = texture2D(u_texture, vec2(v_texCoord.x, v_texCoord.y)) * 256.0;
  float r = baseColor.r * 256.0 * 256.0;
  float g = baseColor.g * 256.0;
  float b = baseColor.b;
  float value =  (r + g + b) * 0.1 - 10000.0;
  
  if (value == u_noDataValue) {
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1])) {
     gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec4 color = texture2D(u_colorTexture, vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }
}
`,KM=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,QM=function(e){(0,gr.Z)(r,e);var i=$M(r);function r(){return(0,xt.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=t.clampLow,l=u===void 0?!0:u,p=t.clampHigh,v=p===void 0?!0:p,x=t.noDataValue,E=x===void 0?-9999999:x,C=t.domain,T=C===void 0?[0,1]:C,O=t.rampColors,L=t.colorTexture,B=L;return L?this.layer.textureService.setColorTexture(L,O):B=this.layer.textureService.getColorTexture(O),{u_opacity:o||1,u_texture:this.texture,u_domain:T,u_clampLow:l,u_clampHigh:typeof v!="undefined"?v:l,u_noDataValue:E,u_colorTexture:B}}},{key:"initModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p,v,x,E,C,T,O;return q().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,E=this.layer.getSource(),C=this.rendererService.createTexture2D,B.next=5,E.data.images;case 5:return T=B.sent,this.texture=C({data:T[0],width:T[0].width,height:T[0].height}),B.next=9,this.layer.buildLayerModel({moduleName:"RasterTileDataImage",vertexShader:KM,fragmentShader:qM,triangulation:s0,primitive:$.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:Xe(p,x)});case 9:return O=B.sent,B.abrupt("return",[O]);case 11:case"end":return B.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.initModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:_n.Attribute,descriptor:{name:"a_Uv",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}})}}]),r}(Ba),JM={raster:$1,rasterRgb:XM,raster3d:$1,rasterTerrainRgb:QM},e4=JM;function t4(e){var i=r4();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function r4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var f0=function(e){(0,gr.Z)(r,e);var i=t4(r);function r(){var n;(0,xt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,De.Z)(n),"type","RasterLayer"),n}return(0,wt.Z)(r,[{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u;return q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel=new e4[u](this),p.next=4,this.initLayerModels();case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getDefaultConfig",value:function(){var t=this.getModelType(),o={raster:{},rasterRgb:{},raster3d:{},rasterTerrainRgb:{}};return o[t]}},{key:"getModelType",value:function(){var t=this.layerSource.getParserType();switch(t){case"raster":return"raster";case"rasterRgb":return"rasterRgb";case"image":return"rasterTerrainRgb";default:return"raster"}}}]),r}(tp);function n4(e){var i=i4();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function i4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var a4=`uniform float u_opacity : 1.0;
uniform vec4 u_color;

void main() {
  gl_FragColor = u_color;
  gl_FragColor.a *= u_opacity;
}
`,o4=`attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#pragma include "projection"

void main() {
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,s4=function(e){(0,gr.Z)(r,e);var i=n4(r);function r(){return(0,xt.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?0:o,l=t.color,p=l===void 0?"#000":l;return{u_opacity:(0,St.isNumber)(u)?u:0,u_color:he(p)}}},{key:"initModels",value:function(){var n=(0,de.Z)(q().mark(function o(){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u;return q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"mask",vertexShader:o4,fragmentShader:a4,triangulation:hv,depth:{enable:!1},blend:this.getBlend(),stencil:{enable:!0,mask:255,func:{cmp:$.ALWAYS,ref:1,mask:255},opFront:{fail:$.REPLACE,zfail:$.REPLACE,zpass:$.REPLACE}},pick:!1});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;t&&this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),r}(Ba),u4={fill:s4},l4=u4;function c4(e){var i=f4();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function f4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zm=function(e){(0,gr.Z)(r,e);var i=c4(r);function r(){var n;(0,xt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,De.Z)(n),"type","MaskLayer"),n}return(0,wt.Z)(r,[{key:"buildModels",value:function(){var n=(0,de.Z)(q().mark(function o(){var u;return q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel=new l4[u](this),p.next=4,this.initLayerModels();case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getModelType",value:function(){return"fill"}}]),r}(tp),Y1,q1,K1,Q1,h0,J1,ex,h4=(Y1=(0,Qr.b2)(),q1=(0,Qr.f3)(Yt.IMapService),K1=(0,Qr.f3)(Yt.IFontService),Y1(Q1=(h0=function(){function e(){(0,xt.Z)(this,e),ra(this,"mapService",J1,this),ra(this,"fontService",ex,this)}return(0,wt.Z)(e,[{key:"apply",value:function(r,n){var t=this,o=n.styleAttributeService;r.hooks.init.tapPromise("DataMappingPlugin",(0,de.Z)(q().mark(function u(){return q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:t.generateMaping(r,{styleAttributeService:o});case 1:case"end":return p.stop()}},u)}))),r.hooks.beforeRenderData.tapPromise("DataMappingPlugin",function(){var u=(0,de.Z)(q().mark(function l(p){return q().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(p){x.next=2;break}return x.abrupt("return",p);case 2:return r.dataState.dataMappingNeedUpdate=!1,t.generateMaping(r,{styleAttributeService:o}),x.abrupt("return",!0);case 5:case"end":return x.stop()}},l)}));return function(l){return u.apply(this,arguments)}}()),r.hooks.beforeRender.tap("DataMappingPlugin",function(){var u=r.getSource();if(!(r.layerModelNeedUpdate||!u||!u.inited)){var l=o.getLayerStyleAttributes()||[],p=o.getLayerStyleAttribute("filter"),v=u.data.dataArray;if(!(Array.isArray(v)&&v.length===0)){var x=l.filter(function(O){return O.needRemapping}),E=v;if(p!=null&&p.needRemapping&&p!==null&&p!==void 0&&p.scale&&(E=v.filter(function(O){return t.applyAttributeMapping(p,O)[0]})),x.length)if(p!=null&&p.needRemapping){var C=t.mapping(r,l,E,void 0);r.setEncodedData(C),p.needRemapping=!1}else{var T=t.mapping(r,x,E,r.getEncodedData());r.setEncodedData(T)}}}})}},{key:"generateMaping",value:function(r,n){var t=this,o=n.styleAttributeService,u=o.getLayerStyleAttributes()||[],l=o.getLayerStyleAttribute("filter"),p=r.getSource().data.dataArray,v=p;l!=null&&l.scale&&(v=p.filter(function(E){return t.applyAttributeMapping(l,E)[0]})),v=r.processData(v);var x=this.mapping(r,u,v,void 0);r.setEncodedData(x),r.emit("dataUpdate",null)}},{key:"mapping",value:function(r,n,t,o){var u=this,l=r.getLayerConfig(),p=l.arrow,v=p===void 0?{enable:!1}:p,x=n.filter(function(C){return C.scale!==void 0}),E=t.map(function(C,T){var O=o?o[T]:{},L=(0,z.Z)({id:C._id,coordinates:C.coordinates},O);if(x.forEach(function(oe){var le=u.applyAttributeMapping(oe,C);oe.needRemapping=!1,oe.name==="color"&&(le=le.map(function(Re){return he(Re)})),L[oe.name]=Array.isArray(le)&&le.length===1?le[0]:le,oe.name==="shape"&&(L.shape=u.fontService.getIconFontKey(L[oe.name]))}),v.enable&&(L.shape==="line"||L.shape==="halfLine")){var B=L.coordinates;if(r.arrowInsertCount<r.encodeDataLength){var H=u.getArrowPoints(B[0],B[1]);L.coordinates.splice(1,0,H,H),r.arrowInsertCount++}}return L});return this.adjustData2Amap2Coordinates(E,r),this.adjustData2SimpleCoordinates(E),E}},{key:"adjustData2Amap2Coordinates",value:function(r,n){var t=this;if(r.length>0&&this.mapService.version===hs["GAODE2.x"]){var o=n.coordCenter||n.getSource().center;typeof r[0].coordinates[0]=="number"?r.filter(function(u){return!u.originCoordinates}).map(function(u){u.version=hs["GAODE2.x"],u.originCoordinates=(0,St.cloneDeep)(u.coordinates),u.coordinates=t.mapService.lngLatToCoordByLayer(u.coordinates,o)}):r.filter(function(u){return!u.originCoordinates}).map(function(u){u.version=hs["GAODE2.x"],u.originCoordinates=(0,St.cloneDeep)(u.coordinates),u.coordinates=t.mapService.lngLatToCoordsByLayer(u.coordinates,o)})}}},{key:"adjustData2SimpleCoordinates",value:function(r){var n=this;r.length>0&&this.mapService.version===hs.SIMPLE&&r.map(function(t){t.simpleCoordinate||(t.coordinates=n.unProjectCoordinates(t.coordinates),t.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(r){var n=this;if(typeof r[0]=="number")return this.mapService.simpleMapCoord.unproject(r);if(r[0]&&r[0][0]instanceof Array){var t=[];return r.map(function(u){var l=[];u.map(function(p){l.push(n.mapService.simpleMapCoord.unproject(p))}),t.push(l)}),t}else{var o=[];return r.map(function(u){o.push(n.mapService.simpleMapCoord.unproject(u))}),o}}},{key:"applyAttributeMapping",value:function(r,n){var t;if(!r.scale)return[];var o=(r==null||(t=r.scale)===null||t===void 0?void 0:t.scalers)||[],u=[];o.forEach(function(p){var v,x=p.field;(n.hasOwnProperty(x)||((v=r.scale)===null||v===void 0?void 0:v.type)==="variable")&&u.push(n[x])});var l=r.mapping?r.mapping(u):[];return l}},{key:"getArrowPoints",value:function(r,n){var t=[n[0]-r[0],n[1]-r[1]],o=Ws(t),u=[r[0]+o[0]*1e-4,r[1]+o[1]*1e-4];return u}}]),e}(),J1=na(h0.prototype,"mapService",[q1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ex=na(h0.prototype,"fontService",[K1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),h0))||Q1),tx,rx,p4=(tx=(0,Qr.b2)(),tx(rx=function(){function e(){(0,xt.Z)(this,e)}return(0,wt.Z)(e,[{key:"apply",value:function(r){var n=this;this.mapService=r.getContainer().get(Yt.IMapService),r.hooks.init.tapPromise("DataSourcePlugin",(0,de.Z)(q().mark(function t(){var o,u,l,p;return q().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(o=r.getSource(),o||(u=r.sourceOption||r.defaultSourceConfig,l=u.data,p=u.options,o=new Cm(l,p),r.setSource(o)),!o.inited){x.next=6;break}n.updateClusterData(r),x.next=8;break;case 6:return x.next=8,new Promise(function(E){o.on("update",function(C){C.type==="inited"&&n.updateClusterData(r),E(null)})});case 8:case"end":return x.stop()}},t)}))),r.hooks.beforeRenderData.tapPromise("DataSourcePlugin",(0,de.Z)(q().mark(function t(){var o,u;return q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return o=n.updateClusterData(r),u=r.dataState.dataSourceNeedUpdate,r.dataState.dataSourceNeedUpdate=!1,p.abrupt("return",o||u);case 4:case"end":return p.stop()}},t)})))}},{key:"updateClusterData",value:function(r){if(r.isTileLayer||r.tileLayer||!r.getSource())return!1;var n=r.getSource(),t=n.cluster,o=n.clusterOptions.zoom,u=o===void 0?0:o,l=this.mapService.getZoom()-1,p=r.dataState.dataSourceNeedUpdate;return t&&p&&n.updateClusterData(Math.floor(l)),t&&Math.abs(r.clusterZoom-l)>=1?(u!==Math.floor(l)&&n.updateClusterData(Math.floor(l)),r.clusterZoom=l,!0):!1}}]),e}())||rx);function Zm(e,i){return e<i?-1:e>i?1:e>=i?0:NaN}function nx(e){return e.length===1&&(e=d4(e)),{left:function(i,r,n,t){for(n==null&&(n=0),t==null&&(t=i.length);n<t;){var o=n+t>>>1;e(i[o],r)<0?n=o+1:t=o}return n},right:function(i,r,n,t){for(n==null&&(n=0),t==null&&(t=i.length);n<t;){var o=n+t>>>1;e(i[o],r)>0?t=o:n=o+1}return n}}}function d4(e){return function(i,r){return Zm(e(i),r)}}var ix=nx(Zm),v4=ix.right,hR=ix.left,p0=v4;function ax(e,i){var r=e.length,n=-1,t,o,u;if(i==null){for(;++n<r;)if((t=e[n])!=null&&t>=t)for(o=u=t;++n<r;)(t=e[n])!=null&&(o>t&&(o=t),u<t&&(u=t))}else for(;++n<r;)if((t=i(e[n],n,e))!=null&&t>=t)for(o=u=t;++n<r;)(t=i(e[n],n,e))!=null&&(o>t&&(o=t),u<t&&(u=t));return[o,u]}var ox=Array.prototype,pR=ox.slice,dR=ox.map,Um=Math.sqrt(50),Vm=Math.sqrt(10),jm=Math.sqrt(2);function sx(e,i,r){var n,t=-1,o,u,l;if(i=+i,e=+e,r=+r,e===i&&r>0)return[e];if((n=i<e)&&(o=e,e=i,i=o),(l=d0(e,i,r))===0||!isFinite(l))return[];if(l>0)for(e=Math.ceil(e/l),i=Math.floor(i/l),u=new Array(o=Math.ceil(i-e+1));++t<o;)u[t]=(e+t)*l;else for(e=Math.floor(e*l),i=Math.ceil(i*l),u=new Array(o=Math.ceil(e-i+1));++t<o;)u[t]=(e-t)/l;return n&&u.reverse(),u}function d0(e,i,r){var n=(i-e)/Math.max(0,r),t=Math.floor(Math.log(n)/Math.LN10),o=n/Math.pow(10,t);return t>=0?(o>=Um?10:o>=Vm?5:o>=jm?2:1)*Math.pow(10,t):-Math.pow(10,-t)/(o>=Um?10:o>=Vm?5:o>=jm?2:1)}function Gm(e,i,r){var n=Math.abs(i-e)/Math.max(0,r),t=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),o=n/t;return o>=Um?t*=10:o>=Vm?t*=5:o>=jm&&(t*=2),i<e?-t:t}function vR(){var e=identity,i=extent,r=sturges;function n(t){var o,u=t.length,l,p=new Array(u);for(o=0;o<u;++o)p[o]=e(t[o],o,t);var v=i(p),x=v[0],E=v[1],C=r(p,x,E);Array.isArray(C)||(C=tickStep(x,E,C),C=range(Math.ceil(x/C)*C,E,C));for(var T=C.length;C[0]<=x;)C.shift(),--T;for(;C[T-1]>E;)C.pop(),--T;var O=new Array(T+1),L;for(o=0;o<=T;++o)L=O[o]=[],L.x0=o>0?C[o-1]:x,L.x1=o<T?C[o]:E;for(o=0;o<u;++o)l=p[o],x<=l&&l<=E&&O[bisect(C,l,0,T)].push(t[o]);return O}return n.value=function(t){return arguments.length?(e=typeof t=="function"?t:constant(t),n):e},n.domain=function(t){return arguments.length?(i=typeof t=="function"?t:constant([t[0],t[1]]),n):i},n.thresholds=function(t){return arguments.length?(r=typeof t=="function"?t:Array.isArray(t)?constant(slice.call(t)):constant(t),n):r},n}function mR(e,i,r){return e=map.call(e,number).sort(ascending),Math.ceil((r-i)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function m4(e){return e===null?NaN:+e}function g4(e,i,r){if(r==null&&(r=m4),!!(n=e.length)){if((i=+i)<=0||n<2)return+r(e[0],0,e);if(i>=1)return+r(e[n-1],n-1,e);var n,t=(n-1)*i,o=Math.floor(t),u=+r(e[o],o,e),l=+r(e[o+1],o+1,e);return u+(l-u)*(t-o)}}var y4=K(87765),Pc="$";function v0(){}v0.prototype=ux.prototype={constructor:v0,has:function(e){return Pc+e in this},get:function(e){return this[Pc+e]},set:function(e,i){return this[Pc+e]=i,this},remove:function(e){var i=Pc+e;return i in this&&delete this[i]},clear:function(){for(var e in this)e[0]===Pc&&delete this[e]},keys:function(){var e=[];for(var i in this)i[0]===Pc&&e.push(i.slice(1));return e},values:function(){var e=[];for(var i in this)i[0]===Pc&&e.push(this[i]);return e},entries:function(){var e=[];for(var i in this)i[0]===Pc&&e.push({key:i.slice(1),value:this[i]});return e},size:function(){var e=0;for(var i in this)i[0]===Pc&&++e;return e},empty:function(){for(var e in this)if(e[0]===Pc)return!1;return!0},each:function(e){for(var i in this)i[0]===Pc&&e(this[i],i.slice(1),this)}};function ux(e,i){var r=new v0;if(e instanceof v0)e.each(function(l,p){r.set(p,l)});else if(Array.isArray(e)){var n=-1,t=e.length,o;if(i==null)for(;++n<t;)r.set(n,e[n]);else for(;++n<t;)r.set(i(o=e[n],n,e),o)}else if(e)for(var u in e)r.set(u,e[u]);return r}var Hm=ux;function gR(){var e=[],i=[],r,n,t;function o(l,p,v,x){if(p>=e.length)return r!=null&&l.sort(r),n!=null?n(l):l;for(var E=-1,C=l.length,T=e[p++],O,L,B=map(),H,oe=v();++E<C;)(H=B.get(O=T(L=l[E])+""))?H.push(L):B.set(O,[L]);return B.each(function(le,Re){x(oe,Re,o(le,p,v,x))}),oe}function u(l,p){if(++p>e.length)return l;var v,x=i[p-1];return n!=null&&p>=e.length?v=l.entries():(v=[],l.each(function(E,C){v.push({key:C,values:u(E,p)})})),x!=null?v.sort(function(E,C){return x(E.key,C.key)}):v}return t={object:function(l){return o(l,0,_4,x4)},map:function(l){return o(l,0,lx,cx)},entries:function(l){return u(o(l,0,lx,cx),0)},key:function(l){return e.push(l),t},sortKeys:function(l){return i[e.length-1]=l,t},sortValues:function(l){return r=l,t},rollup:function(l){return n=l,t}}}function _4(){return{}}function x4(e,i,r){e[i]=r}function lx(){return map()}function cx(e,i,r){e.set(i,r)}function m0(){}var Vp=Hm.prototype;m0.prototype=b4.prototype={constructor:m0,has:Vp.has,add:function(e){return e+="",this[Pc+e]=e,this},remove:Vp.remove,clear:Vp.clear,values:Vp.keys,size:Vp.size,empty:Vp.empty,each:Vp.each};function b4(e,i){var r=new m0;if(e instanceof m0)e.each(function(o){r.add(o)});else if(e){var n=-1,t=e.length;if(i==null)for(;++n<t;)r.add(e[n]);else for(;++n<t;)r.add(i(e[n],n,e))}return r}var yR=null,fx=Array.prototype,g0=fx.map,jp=fx.slice;function ip(e,i){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(i).domain(e);break}return this}function hx(e,i){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(i).domain(e);break}return this}var px={name:"implicit"};function y0(){var e=Hm(),i=[],r=[],n=px;function t(o){var u=o+"",l=e.get(u);if(!l){if(n!==px)return n;e.set(u,l=i.push(o))}return r[(l-1)%r.length]}return t.domain=function(o){if(!arguments.length)return i.slice();i=[],e=Hm();for(var u=-1,l=o.length,p,v;++u<l;)e.has(v=(p=o[u])+"")||e.set(v,i.push(p));return t},t.range=function(o){return arguments.length?(r=jp.call(o),t):r.slice()},t.unknown=function(o){return arguments.length?(n=o,t):n},t.copy=function(){return y0(i,r).unknown(n)},ip.apply(t,arguments),t}function dx(){var e=ordinal().unknown(void 0),i=e.domain,r=e.range,n=[0,1],t,o,u=!1,l=0,p=0,v=.5;delete e.unknown;function x(){var E=i().length,C=n[1]<n[0],T=n[C-0],O=n[1-C];t=(O-T)/Math.max(1,E-l+p*2),u&&(t=Math.floor(t)),T+=(O-T-t*(E-l))*v,o=t*(1-l),u&&(T=Math.round(T),o=Math.round(o));var L=sequence(E).map(function(B){return T+t*B});return r(C?L.reverse():L)}return e.domain=function(E){return arguments.length?(i(E),x()):i()},e.range=function(E){return arguments.length?(n=[+E[0],+E[1]],x()):n.slice()},e.rangeRound=function(E){return n=[+E[0],+E[1]],u=!0,x()},e.bandwidth=function(){return o},e.step=function(){return t},e.round=function(E){return arguments.length?(u=!!E,x()):u},e.padding=function(E){return arguments.length?(l=Math.min(1,p=+E),x()):l},e.paddingInner=function(E){return arguments.length?(l=Math.min(1,E),x()):l},e.paddingOuter=function(E){return arguments.length?(p=+E,x()):p},e.align=function(E){return arguments.length?(v=Math.max(0,Math.min(1,E)),x()):v},e.copy=function(){return dx(i(),n).round(u).paddingInner(l).paddingOuter(p).align(v)},initRange.apply(x(),arguments)}function vx(e){var i=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return vx(i())},e}function _R(){return vx(dx.apply(null,arguments).paddingInner(1))}var E4=K(21775),S4=K(73626);function w4(e,i){return e=+e,i=+i,function(r){return Math.round(e*(1-r)+i*r)}}function C4(e){return function(){return e}}function Wm(e){return+e}var mx=[0,1];function Xu(e){return e}function Xm(e,i){return(i-=e=+e)?function(r){return(r-e)/i}:C4(isNaN(i)?NaN:.5)}function gx(e){var i=e[0],r=e[e.length-1],n;return i>r&&(n=i,i=r,r=n),function(t){return Math.max(i,Math.min(r,t))}}function A4(e,i,r){var n=e[0],t=e[1],o=i[0],u=i[1];return t<n?(n=Xm(t,n),o=r(u,o)):(n=Xm(n,t),o=r(o,u)),function(l){return o(n(l))}}function T4(e,i,r){var n=Math.min(e.length,i.length)-1,t=new Array(n),o=new Array(n),u=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),i=i.slice().reverse());++u<n;)t[u]=Xm(e[u],e[u+1]),o[u]=r(i[u],i[u+1]);return function(l){var p=p0(e,l,1,n)-1;return o[p](t[p](l))}}function _0(e,i){return i.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function $m(){var e=mx,i=mx,r=E4.Z,n,t,o,u=Xu,l,p,v;function x(){return l=Math.min(e.length,i.length)>2?T4:A4,p=v=null,E}function E(C){return isNaN(C=+C)?o:(p||(p=l(e.map(n),i,r)))(n(u(C)))}return E.invert=function(C){return u(t((v||(v=l(i,e.map(n),S4.Z)))(C)))},E.domain=function(C){return arguments.length?(e=g0.call(C,Wm),u===Xu||(u=gx(e)),x()):e.slice()},E.range=function(C){return arguments.length?(i=jp.call(C),x()):i.slice()},E.rangeRound=function(C){return i=jp.call(C),r=w4,x()},E.clamp=function(C){return arguments.length?(u=C?gx(e):Xu,E):u!==Xu},E.interpolate=function(C){return arguments.length?(r=C,x()):r},E.unknown=function(C){return arguments.length?(o=C,E):o},function(C,T){return n=C,t=T,x()}}function yx(e,i){return $m()(e,i)}var M4=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function x0(e){if(!(i=M4.exec(e)))throw new Error("invalid format: "+e);var i;return new Ym({fill:i[1],align:i[2],sign:i[3],symbol:i[4],zero:i[5],width:i[6],comma:i[7],precision:i[8]&&i[8].slice(1),trim:i[9],type:i[10]})}x0.prototype=Ym.prototype;function Ym(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}Ym.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function k4(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function b0(e,i){if((r=(e=i?e.toExponential(i-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function kd(e){return e=b0(Math.abs(e)),e?e[1]:NaN}function I4(e,i){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(kd(i)/3)))*3-kd(Math.abs(e)))}function P4(e,i){return function(r,n){for(var t=r.length,o=[],u=0,l=e[0],p=0;t>0&&l>0&&(p+l+1>n&&(l=Math.max(1,n-p)),o.push(r.substring(t-=l,t+l)),!((p+=l+1)>n));)l=e[u=(u+1)%e.length];return o.reverse().join(i)}}function R4(e){return function(i){return i.replace(/[0-9]/g,function(r){return e[+r]})}}function O4(e){e:for(var i=e.length,r=1,n=-1,t;r<i;++r)switch(e[r]){case".":n=t=r;break;case"0":n===0&&(n=r),t=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(t+1):e}var _x;function L4(e,i){var r=b0(e,i);if(!r)return e+"";var n=r[0],t=r[1],o=t-(_x=Math.max(-8,Math.min(8,Math.floor(t/3)))*3)+1,u=n.length;return o===u?n:o>u?n+new Array(o-u+1).join("0"):o>0?n.slice(0,o)+"."+n.slice(o):"0."+new Array(1-o).join("0")+b0(e,Math.max(0,i+o-1))[0]}function xx(e,i){var r=b0(e,i);if(!r)return e+"";var n=r[0],t=r[1];return t<0?"0."+new Array(-t).join("0")+n:n.length>t+1?n.slice(0,t+1)+"."+n.slice(t+1):n+new Array(t-n.length+2).join("0")}var bx={"%":function(e,i){return(e*100).toFixed(i)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:k4,e:function(e,i){return e.toExponential(i)},f:function(e,i){return e.toFixed(i)},g:function(e,i){return e.toPrecision(i)},o:function(e){return Math.round(e).toString(8)},p:function(e,i){return xx(e*100,i)},r:xx,s:L4,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function Ex(e){return e}var Sx=Array.prototype.map,Cx=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function D4(e){var i=e.grouping===void 0||e.thousands===void 0?Ex:P4(Sx.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",t=e.decimal===void 0?".":e.decimal+"",o=e.numerals===void 0?Ex:R4(Sx.call(e.numerals,String)),u=e.percent===void 0?"%":e.percent+"",l=e.minus===void 0?"-":e.minus+"",p=e.nan===void 0?"NaN":e.nan+"";function v(E){E=x0(E);var C=E.fill,T=E.align,O=E.sign,L=E.symbol,B=E.zero,H=E.width,oe=E.comma,le=E.precision,Re=E.trim,Ne=E.type;Ne==="n"?(oe=!0,Ne="g"):bx[Ne]||(le===void 0&&(le=12),Re=!0,Ne="g"),(B||C==="0"&&T==="=")&&(B=!0,C="0",T="=");var ut=L==="$"?r:L==="#"&&/[boxX]/.test(Ne)?"0"+Ne.toLowerCase():"",Ot=L==="$"?n:/[%p]/.test(Ne)?u:"",Nt=bx[Ne],jt=/[defgprs%]/.test(Ne);le=le===void 0?6:/[gprs]/.test(Ne)?Math.max(1,Math.min(21,le)):Math.max(0,Math.min(20,le));function br(yr){var Ur=ut,An=Ot,jn,Qi,Ca;if(Ne==="c")An=Nt(yr)+An,yr="";else{yr=+yr;var bo=yr<0||1/yr<0;if(yr=isNaN(yr)?p:Nt(Math.abs(yr),le),Re&&(yr=O4(yr)),bo&&+yr==0&&O!=="+"&&(bo=!1),Ur=(bo?O==="("?O:l:O==="-"||O==="("?"":O)+Ur,An=(Ne==="s"?Cx[8+_x/3]:"")+An+(bo&&O==="("?")":""),jt){for(jn=-1,Qi=yr.length;++jn<Qi;)if(Ca=yr.charCodeAt(jn),48>Ca||Ca>57){An=(Ca===46?t+yr.slice(jn+1):yr.slice(jn))+An,yr=yr.slice(0,jn);break}}}oe&&!B&&(yr=i(yr,Infinity));var Ao=Ur.length+yr.length+An.length,Ko=Ao<H?new Array(H-Ao+1).join(C):"";switch(oe&&B&&(yr=i(Ko+yr,Ko.length?H-An.length:Infinity),Ko=""),T){case"<":yr=Ur+yr+An+Ko;break;case"=":yr=Ur+Ko+yr+An;break;case"^":yr=Ko.slice(0,Ao=Ko.length>>1)+Ur+yr+An+Ko.slice(Ao);break;default:yr=Ko+Ur+yr+An;break}return o(yr)}return br.toString=function(){return E+""},br}function x(E,C){var T=v((E=x0(E),E.type="f",E)),O=Math.max(-8,Math.min(8,Math.floor(kd(C)/3)))*3,L=Math.pow(10,-O),B=Cx[8+O/3];return function(H){return T(L*H)+B}}return{format:v,formatPrefix:x}}var E0,qm,Ax;F4({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function F4(e){return E0=D4(e),qm=E0.format,Ax=E0.formatPrefix,E0}function B4(e,i){return e=Math.abs(e),i=Math.abs(i)-e,Math.max(0,kd(i)-kd(e))+1}function N4(e){return Math.max(0,-kd(Math.abs(e)))}function z4(e,i,r,n){var t=Gm(e,i,r),o;switch(n=x0(n==null?",f":n),n.type){case"s":{var u=Math.max(Math.abs(e),Math.abs(i));return n.precision==null&&!isNaN(o=I4(t,u))&&(n.precision=o),Ax(n,u)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(o=B4(t,Math.max(Math.abs(e),Math.abs(i))))&&(n.precision=o-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(o=N4(t))&&(n.precision=o-(n.type==="%")*2);break}}return qm(n)}function Id(e){var i=e.domain;return e.ticks=function(r){var n=i();return sx(n[0],n[n.length-1],r==null?10:r)},e.tickFormat=function(r,n){var t=i();return z4(t[0],t[t.length-1],r==null?10:r,n)},e.nice=function(r){r==null&&(r=10);var n=i(),t=0,o=n.length-1,u=n[t],l=n[o],p;return l<u&&(p=u,u=l,l=p,p=t,t=o,o=p),p=d0(u,l,r),p>0?(u=Math.floor(u/p)*p,l=Math.ceil(l/p)*p,p=d0(u,l,r)):p<0&&(u=Math.ceil(u*p)/p,l=Math.floor(l*p)/p,p=d0(u,l,r)),p>0?(n[t]=Math.floor(u/p)*p,n[o]=Math.ceil(l/p)*p,i(n)):p<0&&(n[t]=Math.ceil(u*p)/p,n[o]=Math.floor(l*p)/p,i(n)),e},e}function Tx(){var e=yx(Xu,Xu);return e.copy=function(){return _0(e,Tx())},ip.apply(e,arguments),Id(e)}function Mx(e){var i;function r(n){return isNaN(n=+n)?i:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=g0.call(n,Wm),r):e.slice()},r.unknown=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return Mx(e).unknown(i)},e=arguments.length?g0.call(e,Wm):[0,1],Id(r)}function kx(e,i){e=e.slice();var r=0,n=e.length-1,t=e[r],o=e[n],u;return o<t&&(u=r,r=n,n=u,u=t,t=o,o=u),e[r]=i.floor(t),e[n]=i.ceil(o),e}function Ix(e){return Math.log(e)}function Px(e){return Math.exp(e)}function Z4(e){return-Math.log(-e)}function U4(e){return-Math.exp(-e)}function V4(e){return isFinite(e)?+("1e"+e):e<0?0:e}function j4(e){return e===10?V4:e===Math.E?Math.exp:function(i){return Math.pow(e,i)}}function G4(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(i){return Math.log(i)/e})}function Rx(e){return function(i){return-e(-i)}}function H4(e){var i=e(Ix,Px),r=i.domain,n=10,t,o;function u(){return t=G4(n),o=j4(n),r()[0]<0?(t=Rx(t),o=Rx(o),e(Z4,U4)):e(Ix,Px),i}return i.base=function(l){return arguments.length?(n=+l,u()):n},i.domain=function(l){return arguments.length?(r(l),u()):r()},i.ticks=function(l){var p=r(),v=p[0],x=p[p.length-1],E;(E=x<v)&&(C=v,v=x,x=C);var C=t(v),T=t(x),O,L,B,H=l==null?10:+l,oe=[];if(!(n%1)&&T-C<H){if(C=Math.round(C)-1,T=Math.round(T)+1,v>0){for(;C<T;++C)for(L=1,O=o(C);L<n;++L)if(B=O*L,!(B<v)){if(B>x)break;oe.push(B)}}else for(;C<T;++C)for(L=n-1,O=o(C);L>=1;--L)if(B=O*L,!(B<v)){if(B>x)break;oe.push(B)}}else oe=sx(C,T,Math.min(T-C,H)).map(o);return E?oe.reverse():oe},i.tickFormat=function(l,p){if(p==null&&(p=n===10?".0e":","),typeof p!="function"&&(p=qm(p)),l===Infinity)return p;l==null&&(l=10);var v=Math.max(1,n*l/i.ticks().length);return function(x){var E=x/o(Math.round(t(x)));return E*n<n-.5&&(E*=n),E<=v?p(x):""}},i.nice=function(){return r(kx(r(),{floor:function(l){return o(Math.floor(t(l)))},ceil:function(l){return o(Math.ceil(t(l)))}}))},i}function Ox(){var e=H4($m()).domain([1,10]);return e.copy=function(){return _0(e,Ox()).base(e.base())},ip.apply(e,arguments),e}function Lx(e){return function(i){return Math.sign(i)*Math.log1p(Math.abs(i/e))}}function Dx(e){return function(i){return Math.sign(i)*Math.expm1(Math.abs(i))*e}}function W4(e){var i=1,r=e(Lx(i),Dx(i));return r.constant=function(n){return arguments.length?e(Lx(i=+n),Dx(i)):i},linearish(r)}function X4(){var e=W4(transformer());return e.copy=function(){return copy(e,X4()).constant(e.constant())},initRange.apply(e,arguments)}function Fx(e){return function(i){return i<0?-Math.pow(-i,e):Math.pow(i,e)}}function $4(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function Y4(e){return e<0?-e*e:e*e}function q4(e){var i=e(Xu,Xu),r=1;function n(){return r===1?e(Xu,Xu):r===.5?e($4,Y4):e(Fx(r),Fx(1/r))}return i.exponent=function(t){return arguments.length?(r=+t,n()):r},Id(i)}function Km(){var e=q4($m());return e.copy=function(){return _0(e,Km()).exponent(e.exponent())},ip.apply(e,arguments),e}function xR(){return Km.apply(null,arguments).exponent(.5)}function Bx(){var e=[],i=[],r=[],n;function t(){var u=0,l=Math.max(1,i.length);for(r=new Array(l-1);++u<l;)r[u-1]=g4(e,u/l);return o}function o(u){return isNaN(u=+u)?n:i[p0(r,u)]}return o.invertExtent=function(u){var l=i.indexOf(u);return l<0?[NaN,NaN]:[l>0?r[l-1]:e[0],l<r.length?r[l]:e[e.length-1]]},o.domain=function(u){if(!arguments.length)return e.slice();e=[];for(var l=0,p=u.length,v;l<p;++l)v=u[l],v!=null&&!isNaN(v=+v)&&e.push(v);return e.sort(Zm),t()},o.range=function(u){return arguments.length?(i=jp.call(u),t()):i.slice()},o.unknown=function(u){return arguments.length?(n=u,o):n},o.quantiles=function(){return r.slice()},o.copy=function(){return Bx().domain(e).range(i).unknown(n)},ip.apply(o,arguments)}function Nx(){var e=0,i=1,r=1,n=[.5],t=[0,1],o;function u(p){return p<=p?t[p0(n,p,0,r)]:o}function l(){var p=-1;for(n=new Array(r);++p<r;)n[p]=((p+1)*i-(p-r)*e)/(r+1);return u}return u.domain=function(p){return arguments.length?(e=+p[0],i=+p[1],l()):[e,i]},u.range=function(p){return arguments.length?(r=(t=jp.call(p)).length-1,l()):t.slice()},u.invertExtent=function(p){var v=t.indexOf(p);return v<0?[NaN,NaN]:v<1?[e,n[0]]:v>=r?[n[r-1],i]:[n[v-1],n[v]]},u.unknown=function(p){return arguments.length&&(o=p),u},u.thresholds=function(){return n.slice()},u.copy=function(){return Nx().domain([e,i]).range(t).unknown(o)},ip.apply(Id(u),arguments)}function zx(){var e=[.5],i=[0,1],r,n=1;function t(o){return o<=o?i[p0(e,o,0,n)]:r}return t.domain=function(o){return arguments.length?(e=jp.call(o),n=Math.min(e.length,i.length-1),t):e.slice()},t.range=function(o){return arguments.length?(i=jp.call(o),n=Math.min(e.length,i.length-1),t):i.slice()},t.invertExtent=function(o){var u=i.indexOf(o);return[e[u-1],e[u]]},t.unknown=function(o){return arguments.length?(r=o,t):r},t.copy=function(){return zx().domain(e).range(i).unknown(r)},ip.apply(t,arguments)}var Qm=new Date,Jm=new Date;function il(e,i,r,n){function t(o){return e(o=arguments.length===0?new Date:new Date(+o)),o}return t.floor=function(o){return e(o=new Date(+o)),o},t.ceil=function(o){return e(o=new Date(o-1)),i(o,1),e(o),o},t.round=function(o){var u=t(o),l=t.ceil(o);return o-u<l-o?u:l},t.offset=function(o,u){return i(o=new Date(+o),u==null?1:Math.floor(u)),o},t.range=function(o,u,l){var p=[],v;if(o=t.ceil(o),l=l==null?1:Math.floor(l),!(o<u)||!(l>0))return p;do p.push(v=new Date(+o)),i(o,l),e(o);while(v<o&&o<u);return p},t.filter=function(o){return il(function(u){if(u>=u)for(;e(u),!o(u);)u.setTime(u-1)},function(u,l){if(u>=u)if(l<0)for(;++l<=0;)for(;i(u,-1),!o(u););else for(;--l>=0;)for(;i(u,1),!o(u););})},r&&(t.count=function(o,u){return Qm.setTime(+o),Jm.setTime(+u),e(Qm),e(Jm),Math.floor(r(Qm,Jm))},t.every=function(o){return o=Math.floor(o),!isFinite(o)||!(o>0)?null:o>1?t.filter(n?function(u){return n(u)%o==0}:function(u){return t.count(0,u)%o==0}):t}),t}var eg=il(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,i){e.setFullYear(e.getFullYear()+i)},function(e,i){return i.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});eg.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:il(function(i){i.setFullYear(Math.floor(i.getFullYear()/e)*e),i.setMonth(0,1),i.setHours(0,0,0,0)},function(i,r){i.setFullYear(i.getFullYear()+r*e)})};var Pd=eg,bR=eg.range,Zx=il(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,i){e.setMonth(e.getMonth()+i)},function(e,i){return i.getMonth()-e.getMonth()+(i.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),K4=Zx,ER=Zx.range,S0=1e3,pv=6e4,Ux=36e5,Vx=864e5,jx=6048e5;function Gp(e){return il(function(i){i.setDate(i.getDate()-(i.getDay()+7-e)%7),i.setHours(0,0,0,0)},function(i,r){i.setDate(i.getDate()+r*7)},function(i,r){return(r-i-(r.getTimezoneOffset()-i.getTimezoneOffset())*pv)/jx})}var tg=Gp(0),w0=Gp(1),Q4=Gp(2),J4=Gp(3),Rd=Gp(4),e6=Gp(5),t6=Gp(6),SR=tg.range,wR=w0.range,CR=Q4.range,AR=J4.range,TR=Rd.range,MR=e6.range,kR=t6.range,Gx=il(function(e){e.setHours(0,0,0,0)},function(e,i){e.setDate(e.getDate()+i)},function(e,i){return(i-e-(i.getTimezoneOffset()-e.getTimezoneOffset())*pv)/Vx},function(e){return e.getDate()-1}),rg=Gx,IR=Gx.range,Hx=il(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*S0-e.getMinutes()*pv)},function(e,i){e.setTime(+e+i*Ux)},function(e,i){return(i-e)/Ux},function(e){return e.getHours()}),r6=Hx,PR=Hx.range,Wx=il(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*S0)},function(e,i){e.setTime(+e+i*pv)},function(e,i){return(i-e)/pv},function(e){return e.getMinutes()}),n6=Wx,RR=Wx.range,Xx=il(function(e){e.setTime(e-e.getMilliseconds())},function(e,i){e.setTime(+e+i*S0)},function(e,i){return(i-e)/S0},function(e){return e.getUTCSeconds()}),i6=Xx,OR=Xx.range,C0=il(function(){},function(e,i){e.setTime(+e+i)},function(e,i){return i-e});C0.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?il(function(i){i.setTime(Math.floor(i/e)*e)},function(i,r){i.setTime(+i+r*e)},function(i,r){return(r-i)/e}):C0};var a6=C0,LR=C0.range;function Hp(e){return il(function(i){i.setUTCDate(i.getUTCDate()-(i.getUTCDay()+7-e)%7),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCDate(i.getUTCDate()+r*7)},function(i,r){return(r-i)/jx})}var $x=Hp(0),A0=Hp(1),o6=Hp(2),s6=Hp(3),Od=Hp(4),u6=Hp(5),l6=Hp(6),DR=$x.range,FR=A0.range,BR=o6.range,NR=s6.range,zR=Od.range,ZR=u6.range,UR=l6.range,Yx=il(function(e){e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCDate(e.getUTCDate()+i)},function(e,i){return(i-e)/Vx},function(e){return e.getUTCDate()-1}),qx=Yx,VR=Yx.range,ng=il(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCFullYear(e.getUTCFullYear()+i)},function(e,i){return i.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});ng.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:il(function(i){i.setUTCFullYear(Math.floor(i.getUTCFullYear()/e)*e),i.setUTCMonth(0,1),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCFullYear(i.getUTCFullYear()+r*e)})};var dv=ng,jR=ng.range;function ig(e){if(0<=e.y&&e.y<100){var i=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return i.setFullYear(e.y),i}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function ag(e){if(0<=e.y&&e.y<100){var i=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return i.setUTCFullYear(e.y),i}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function vv(e,i,r){return{y:e,m:i,d:r,H:0,M:0,S:0,L:0}}function c6(e){var i=e.dateTime,r=e.date,n=e.time,t=e.periods,o=e.days,u=e.shortDays,l=e.months,p=e.shortMonths,v=mv(t),x=gv(t),E=mv(o),C=gv(o),T=mv(u),O=gv(u),L=mv(l),B=gv(l),H=mv(p),oe=gv(p),le={a:bo,A:Ao,b:Ko,B:Ml,c:null,d:rb,e:rb,f:O6,g:j6,G:H6,H:I6,I:P6,j:R6,L:nb,m:L6,M:D6,p:Pv,q:Nd,Q:lb,s:cb,S:F6,u:B6,U:N6,V:z6,w:Z6,W:U6,x:null,X:null,y:V6,Y:G6,Z:W6,"%":ub},Re={a:Rv,A:z0,b:gg,B:Z0,c:null,d:ab,e:ab,f:q6,g:ok,G:uk,H:X6,I:$6,j:Y6,L:ob,m:K6,M:Q6,p:FP,q:BP,Q:lb,s:cb,S:J6,u:ek,U:tk,V:rk,w:nk,W:ik,x:null,X:null,y:ak,Y:sk,Z:lk,"%":ub},Ne={a:br,A:yr,b:Ur,B:An,c:jn,d:eb,e:eb,f:A6,g:Jx,G:Qx,H:tb,I:tb,j:E6,L:C6,m:b6,M:S6,p:jt,q:x6,Q:M6,s:k6,S:w6,u:v6,U:m6,V:g6,w:d6,W:y6,x:Qi,X:Ca,y:Jx,Y:Qx,Z:_6,"%":T6};le.x=ut(r,le),le.X=ut(n,le),le.c=ut(i,le),Re.x=ut(r,Re),Re.X=ut(n,Re),Re.c=ut(i,Re);function ut(Ai,Ua){return function(co){var Ln=[],kl=-1,Qo=0,nc=Ai.length,ic,Yp,Y2;for(co instanceof Date||(co=new Date(+co));++kl<nc;)Ai.charCodeAt(kl)===37&&(Ln.push(Ai.slice(Qo,kl)),(Yp=Kx[ic=Ai.charAt(++kl)])!=null?ic=Ai.charAt(++kl):Yp=ic==="e"?" ":"0",(Y2=Ua[ic])&&(ic=Y2(co,Yp)),Ln.push(ic),Qo=kl+1);return Ln.push(Ai.slice(Qo,kl)),Ln.join("")}}function Ot(Ai,Ua){return function(co){var Ln=vv(1900,void 0,1),kl=Nt(Ln,Ai,co+="",0),Qo,nc;if(kl!=co.length)return null;if("Q"in Ln)return new Date(Ln.Q);if("s"in Ln)return new Date(Ln.s*1e3+("L"in Ln?Ln.L:0));if(Ua&&!("Z"in Ln)&&(Ln.Z=0),"p"in Ln&&(Ln.H=Ln.H%12+Ln.p*12),Ln.m===void 0&&(Ln.m="q"in Ln?Ln.q:0),"V"in Ln){if(Ln.V<1||Ln.V>53)return null;"w"in Ln||(Ln.w=1),"Z"in Ln?(Qo=ag(vv(Ln.y,0,1)),nc=Qo.getUTCDay(),Qo=nc>4||nc===0?A0.ceil(Qo):A0(Qo),Qo=qx.offset(Qo,(Ln.V-1)*7),Ln.y=Qo.getUTCFullYear(),Ln.m=Qo.getUTCMonth(),Ln.d=Qo.getUTCDate()+(Ln.w+6)%7):(Qo=ig(vv(Ln.y,0,1)),nc=Qo.getDay(),Qo=nc>4||nc===0?w0.ceil(Qo):w0(Qo),Qo=rg.offset(Qo,(Ln.V-1)*7),Ln.y=Qo.getFullYear(),Ln.m=Qo.getMonth(),Ln.d=Qo.getDate()+(Ln.w+6)%7)}else("W"in Ln||"U"in Ln)&&("w"in Ln||(Ln.w="u"in Ln?Ln.u%7:"W"in Ln?1:0),nc="Z"in Ln?ag(vv(Ln.y,0,1)).getUTCDay():ig(vv(Ln.y,0,1)).getDay(),Ln.m=0,Ln.d="W"in Ln?(Ln.w+6)%7+Ln.W*7-(nc+5)%7:Ln.w+Ln.U*7-(nc+6)%7);return"Z"in Ln?(Ln.H+=Ln.Z/100|0,Ln.M+=Ln.Z%100,ag(Ln)):ig(Ln)}}function Nt(Ai,Ua,co,Ln){for(var kl=0,Qo=Ua.length,nc=co.length,ic,Yp;kl<Qo;){if(Ln>=nc)return-1;if(ic=Ua.charCodeAt(kl++),ic===37){if(ic=Ua.charAt(kl++),Yp=Ne[ic in Kx?Ua.charAt(kl++):ic],!Yp||(Ln=Yp(Ai,co,Ln))<0)return-1}else if(ic!=co.charCodeAt(Ln++))return-1}return Ln}function jt(Ai,Ua,co){var Ln=v.exec(Ua.slice(co));return Ln?(Ai.p=x[Ln[0].toLowerCase()],co+Ln[0].length):-1}function br(Ai,Ua,co){var Ln=T.exec(Ua.slice(co));return Ln?(Ai.w=O[Ln[0].toLowerCase()],co+Ln[0].length):-1}function yr(Ai,Ua,co){var Ln=E.exec(Ua.slice(co));return Ln?(Ai.w=C[Ln[0].toLowerCase()],co+Ln[0].length):-1}function Ur(Ai,Ua,co){var Ln=H.exec(Ua.slice(co));return Ln?(Ai.m=oe[Ln[0].toLowerCase()],co+Ln[0].length):-1}function An(Ai,Ua,co){var Ln=L.exec(Ua.slice(co));return Ln?(Ai.m=B[Ln[0].toLowerCase()],co+Ln[0].length):-1}function jn(Ai,Ua,co){return Nt(Ai,i,Ua,co)}function Qi(Ai,Ua,co){return Nt(Ai,r,Ua,co)}function Ca(Ai,Ua,co){return Nt(Ai,n,Ua,co)}function bo(Ai){return u[Ai.getDay()]}function Ao(Ai){return o[Ai.getDay()]}function Ko(Ai){return p[Ai.getMonth()]}function Ml(Ai){return l[Ai.getMonth()]}function Pv(Ai){return t[+(Ai.getHours()>=12)]}function Nd(Ai){return 1+~~(Ai.getMonth()/3)}function Rv(Ai){return u[Ai.getUTCDay()]}function z0(Ai){return o[Ai.getUTCDay()]}function gg(Ai){return p[Ai.getUTCMonth()]}function Z0(Ai){return l[Ai.getUTCMonth()]}function FP(Ai){return t[+(Ai.getUTCHours()>=12)]}function BP(Ai){return 1+~~(Ai.getUTCMonth()/3)}return{format:function(Ai){var Ua=ut(Ai+="",le);return Ua.toString=function(){return Ai},Ua},parse:function(Ai){var Ua=Ot(Ai+="",!1);return Ua.toString=function(){return Ai},Ua},utcFormat:function(Ai){var Ua=ut(Ai+="",Re);return Ua.toString=function(){return Ai},Ua},utcParse:function(Ai){var Ua=Ot(Ai+="",!0);return Ua.toString=function(){return Ai},Ua}}}var Kx={"-":"",_:" ","0":"0"},Su=/^\s*\d+/,f6=/^%/,h6=/[\\^$*+?|[\]().{}]/g;function lo(e,i,r){var n=e<0?"-":"",t=(n?-e:e)+"",o=t.length;return n+(o<r?new Array(r-o+1).join(i)+t:t)}function p6(e){return e.replace(h6,"\\$&")}function mv(e){return new RegExp("^(?:"+e.map(p6).join("|")+")","i")}function gv(e){for(var i={},r=-1,n=e.length;++r<n;)i[e[r].toLowerCase()]=r;return i}function d6(e,i,r){var n=Su.exec(i.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function v6(e,i,r){var n=Su.exec(i.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function m6(e,i,r){var n=Su.exec(i.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function g6(e,i,r){var n=Su.exec(i.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function y6(e,i,r){var n=Su.exec(i.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function Qx(e,i,r){var n=Su.exec(i.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function Jx(e,i,r){var n=Su.exec(i.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function _6(e,i,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(i.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function x6(e,i,r){var n=Su.exec(i.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function b6(e,i,r){var n=Su.exec(i.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function eb(e,i,r){var n=Su.exec(i.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function E6(e,i,r){var n=Su.exec(i.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function tb(e,i,r){var n=Su.exec(i.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function S6(e,i,r){var n=Su.exec(i.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function w6(e,i,r){var n=Su.exec(i.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function C6(e,i,r){var n=Su.exec(i.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function A6(e,i,r){var n=Su.exec(i.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function T6(e,i,r){var n=f6.exec(i.slice(r,r+1));return n?r+n[0].length:-1}function M6(e,i,r){var n=Su.exec(i.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function k6(e,i,r){var n=Su.exec(i.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function rb(e,i){return lo(e.getDate(),i,2)}function I6(e,i){return lo(e.getHours(),i,2)}function P6(e,i){return lo(e.getHours()%12||12,i,2)}function R6(e,i){return lo(1+rg.count(Pd(e),e),i,3)}function nb(e,i){return lo(e.getMilliseconds(),i,3)}function O6(e,i){return nb(e,i)+"000"}function L6(e,i){return lo(e.getMonth()+1,i,2)}function D6(e,i){return lo(e.getMinutes(),i,2)}function F6(e,i){return lo(e.getSeconds(),i,2)}function B6(e){var i=e.getDay();return i===0?7:i}function N6(e,i){return lo(tg.count(Pd(e)-1,e),i,2)}function ib(e){var i=e.getDay();return i>=4||i===0?Rd(e):Rd.ceil(e)}function z6(e,i){return e=ib(e),lo(Rd.count(Pd(e),e)+(Pd(e).getDay()===4),i,2)}function Z6(e){return e.getDay()}function U6(e,i){return lo(w0.count(Pd(e)-1,e),i,2)}function V6(e,i){return lo(e.getFullYear()%100,i,2)}function j6(e,i){return e=ib(e),lo(e.getFullYear()%100,i,2)}function G6(e,i){return lo(e.getFullYear()%1e4,i,4)}function H6(e,i){var r=e.getDay();return e=r>=4||r===0?Rd(e):Rd.ceil(e),lo(e.getFullYear()%1e4,i,4)}function W6(e){var i=e.getTimezoneOffset();return(i>0?"-":(i*=-1,"+"))+lo(i/60|0,"0",2)+lo(i%60,"0",2)}function ab(e,i){return lo(e.getUTCDate(),i,2)}function X6(e,i){return lo(e.getUTCHours(),i,2)}function $6(e,i){return lo(e.getUTCHours()%12||12,i,2)}function Y6(e,i){return lo(1+qx.count(dv(e),e),i,3)}function ob(e,i){return lo(e.getUTCMilliseconds(),i,3)}function q6(e,i){return ob(e,i)+"000"}function K6(e,i){return lo(e.getUTCMonth()+1,i,2)}function Q6(e,i){return lo(e.getUTCMinutes(),i,2)}function J6(e,i){return lo(e.getUTCSeconds(),i,2)}function ek(e){var i=e.getUTCDay();return i===0?7:i}function tk(e,i){return lo($x.count(dv(e)-1,e),i,2)}function sb(e){var i=e.getUTCDay();return i>=4||i===0?Od(e):Od.ceil(e)}function rk(e,i){return e=sb(e),lo(Od.count(dv(e),e)+(dv(e).getUTCDay()===4),i,2)}function nk(e){return e.getUTCDay()}function ik(e,i){return lo(A0.count(dv(e)-1,e),i,2)}function ak(e,i){return lo(e.getUTCFullYear()%100,i,2)}function ok(e,i){return e=sb(e),lo(e.getUTCFullYear()%100,i,2)}function sk(e,i){return lo(e.getUTCFullYear()%1e4,i,4)}function uk(e,i){var r=e.getUTCDay();return e=r>=4||r===0?Od(e):Od.ceil(e),lo(e.getUTCFullYear()%1e4,i,4)}function lk(){return"+0000"}function ub(){return"%"}function lb(e){return+e}function cb(e){return Math.floor(+e/1e3)}var Ld,fb,ck,fk,hk;pk({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function pk(e){return Ld=c6(e),fb=Ld.format,ck=Ld.parse,fk=Ld.utcFormat,hk=Ld.utcParse,Ld}var yv=1e3,_v=yv*60,xv=_v*60,bv=xv*24,dk=bv*7,hb=bv*30,og=bv*365;function vk(e){return new Date(e)}function mk(e){return e instanceof Date?+e:+new Date(+e)}function pb(e,i,r,n,t,o,u,l,p){var v=yx(Xu,Xu),x=v.invert,E=v.domain,C=p(".%L"),T=p(":%S"),O=p("%I:%M"),L=p("%I %p"),B=p("%a %d"),H=p("%b %d"),oe=p("%B"),le=p("%Y"),Re=[[u,1,yv],[u,5,5*yv],[u,15,15*yv],[u,30,30*yv],[o,1,_v],[o,5,5*_v],[o,15,15*_v],[o,30,30*_v],[t,1,xv],[t,3,3*xv],[t,6,6*xv],[t,12,12*xv],[n,1,bv],[n,2,2*bv],[r,1,dk],[i,1,hb],[i,3,3*hb],[e,1,og]];function Ne(Ot){return(u(Ot)<Ot?C:o(Ot)<Ot?T:t(Ot)<Ot?O:n(Ot)<Ot?L:i(Ot)<Ot?r(Ot)<Ot?B:H:e(Ot)<Ot?oe:le)(Ot)}function ut(Ot,Nt,jt,br){if(Ot==null&&(Ot=10),typeof Ot=="number"){var yr=Math.abs(jt-Nt)/Ot,Ur=nx(function(An){return An[2]}).right(Re,yr);Ur===Re.length?(br=Gm(Nt/og,jt/og,Ot),Ot=e):Ur?(Ur=Re[yr/Re[Ur-1][2]<Re[Ur][2]/yr?Ur-1:Ur],br=Ur[1],Ot=Ur[0]):(br=Math.max(Gm(Nt,jt,Ot),1),Ot=l)}return br==null?Ot:Ot.every(br)}return v.invert=function(Ot){return new Date(x(Ot))},v.domain=function(Ot){return arguments.length?E(g0.call(Ot,mk)):E().map(vk)},v.ticks=function(Ot,Nt){var jt=E(),br=jt[0],yr=jt[jt.length-1],Ur=yr<br,An;return Ur&&(An=br,br=yr,yr=An),An=ut(Ot,br,yr,Nt),An=An?An.range(br,yr+1):[],Ur?An.reverse():An},v.tickFormat=function(Ot,Nt){return Nt==null?Ne:p(Nt)},v.nice=function(Ot,Nt){var jt=E();return(Ot=ut(Ot,jt[0],jt[jt.length-1],Nt))?E(kx(jt,Ot)):v},v.copy=function(){return _0(v,pb(e,i,r,n,t,o,u,l,p))},v}function gk(){return ip.apply(pb(Pd,K4,tg,rg,r6,n6,i6,a6,fb).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function GR(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function T0(){var e=0,i=1,r,n,t,o,u=Xu,l=!1,p;function v(x){return isNaN(x=+x)?p:u(t===0?.5:(x=(o(x)-r)*t,l?Math.max(0,Math.min(1,x)):x))}return v.domain=function(x){return arguments.length?(r=o(e=+x[0]),n=o(i=+x[1]),t=r===n?0:1/(n-r),v):[e,i]},v.clamp=function(x){return arguments.length?(l=!!x,v):l},v.interpolator=function(x){return arguments.length?(u=x,v):u},v.unknown=function(x){return arguments.length?(p=x,v):p},function(x){return o=x,r=x(e),n=x(i),t=r===n?0:1/(n-r),v}}function Ev(e,i){return i.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function db(){var e=Id(T0()(Xu));return e.copy=function(){return Ev(e,db())},hx.apply(e,arguments)}function yk(){var e=loggish(T0()).domain([1,10]);return e.copy=function(){return Ev(e,yk()).base(e.base())},initInterpolator.apply(e,arguments)}function _k(){var e=symlogish(T0());return e.copy=function(){return Ev(e,_k()).constant(e.constant())},initInterpolator.apply(e,arguments)}function vb(){var e=powish(T0());return e.copy=function(){return Ev(e,vb()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function HR(){return vb.apply(null,arguments).exponent(.5)}function xk(){var e=[],i=identity;function r(n){if(!isNaN(n=+n))return i((bisect(e,n)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(var t=0,o=n.length,u;t<o;++t)u=n[t],u!=null&&!isNaN(u=+u)&&e.push(u);return e.sort(ascending),r},r.interpolator=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return xk(i).domain(e)},initInterpolator.apply(r,arguments)}function M0(){var e=0,i=.5,r=1,n,t,o,u,l,p=Xu,v,x=!1,E;function C(T){return isNaN(T=+T)?E:(T=.5+((T=+v(T))-t)*(T<t?u:l),p(x?Math.max(0,Math.min(1,T)):T))}return C.domain=function(T){return arguments.length?(n=v(e=+T[0]),t=v(i=+T[1]),o=v(r=+T[2]),u=n===t?0:.5/(t-n),l=t===o?0:.5/(o-t),C):[e,i,r]},C.clamp=function(T){return arguments.length?(x=!!T,C):x},C.interpolator=function(T){return arguments.length?(p=T,C):p},C.unknown=function(T){return arguments.length?(E=T,C):E},function(T){return v=T,n=T(e),t=T(i),o=T(r),u=n===t?0:.5/(t-n),l=t===o?0:.5/(o-t),C}}function mb(){var e=Id(M0()(Xu));return e.copy=function(){return Ev(e,mb())},hx.apply(e,arguments)}function bk(){var e=loggish(M0()).domain([.1,1,10]);return e.copy=function(){return copy(e,bk()).base(e.base())},initInterpolator.apply(e,arguments)}function Ek(){var e=symlogish(M0());return e.copy=function(){return copy(e,Ek()).constant(e.constant())},initInterpolator.apply(e,arguments)}function gb(){var e=powish(M0());return e.copy=function(){return copy(e,gb()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function WR(){return gb.apply(null,arguments).exponent(.5)}var rc,yb,_b,Sk=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,wk=(rc={},(0,Y.Z)(rc,uo.LINEAR,Tx),(0,Y.Z)(rc,uo.POWER,Km),(0,Y.Z)(rc,uo.LOG,Ox),(0,Y.Z)(rc,uo.IDENTITY,Mx),(0,Y.Z)(rc,uo.SEQUENTIAL,db),(0,Y.Z)(rc,uo.TIME,gk),(0,Y.Z)(rc,uo.QUANTILE,Bx),(0,Y.Z)(rc,uo.QUANTIZE,Nx),(0,Y.Z)(rc,uo.THRESHOLD,zx),(0,Y.Z)(rc,uo.CAT,y0),(0,Y.Z)(rc,uo.DIVERGING,mb),rc),Ck=(yb=(0,Qr.b2)(),yb(_b=function(){function e(){(0,xt.Z)(this,e),(0,Y.Z)(this,"scaleOptions",{})}return(0,wt.Z)(e,[{key:"apply",value:function(r,n){var t=this,o=n.styleAttributeService;r.hooks.init.tapPromise("FeatureScalePlugin",(0,de.Z)(q().mark(function u(){var l,p,v;return q().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(t.scaleOptions=r.getScaleOptions(),p=o.getLayerStyleAttributes(),v=(l=r.getSource())===null||l===void 0?void 0:l.data.dataArray,!(Array.isArray(v)&&v.length===0)){E.next=7;break}return E.abrupt("return");case 7:t.caculateScalesForAttributes(p||[],v);case 8:case"end":return E.stop()}},u)}))),r.hooks.beforeRenderData.tapPromise("FeatureScalePlugin",function(){var u=(0,de.Z)(q().mark(function l(p){var v,x;return q().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(p){C.next=2;break}return C.abrupt("return",p);case 2:if(t.scaleOptions=r.getScaleOptions(),v=o.getLayerStyleAttributes(),x=r.getSource().data.dataArray,!(Array.isArray(x)&&x.length===0)){C.next=7;break}return C.abrupt("return",!0);case 7:return t.caculateScalesForAttributes(v||[],x),r.layerModelNeedUpdate=!0,C.abrupt("return",!0);case 10:case"end":return C.stop()}},l)}));return function(l){return u.apply(this,arguments)}}()),r.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!r.layerModelNeedUpdate){t.scaleOptions=r.getScaleOptions();var u=o.getLayerStyleAttributes(),l=r.getSource().data.dataArray;if(!(Array.isArray(l)&&l.length===0)&&u){var p=u.filter(function(v){return v.needRescale});p.length&&t.caculateScalesForAttributes(p,l)}}})}},{key:"isNumber",value:function(r){return!isNaN(parseFloat(r))&&isFinite(r)}},{key:"caculateScalesForAttributes",value:function(r,n){var t=this;r.forEach(function(o){if(o.scale){var u=o.scale;u.names=t.parseFields(o.scale.field||[]);var l=[];u.names.forEach(function(p){var v;l.push(t.createScale(p,o.name,(v=o.scale)===null||v===void 0?void 0:v.values,n))}),l.some(function(p){return p.type===Jh.VARIABLE})?(u.type=Jh.VARIABLE,l.forEach(function(p){var v;if(!u.callback&&u.values!=="text")switch((v=p.option)===null||v===void 0?void 0:v.type){case uo.LOG:case uo.LINEAR:case uo.POWER:if(u.values&&u.values.length>2){var x=p.scale.ticks(u.values.length);p.scale.domain(x)}u.values?p.scale.range(u.values):p.scale.range(p.option.domain);break;case uo.QUANTILE:case uo.QUANTIZE:case uo.THRESHOLD:p.scale.range(u.values);break;case uo.CAT:u.values?p.scale.range(u.values):p.scale.range(p.option.domain);break;case uo.DIVERGING:case uo.SEQUENTIAL:p.scale.interpolator(y4.hD(u.values));break}if(u.values==="text"){var E;p.scale.range((E=p.option)===null||E===void 0?void 0:E.domain)}})):(u.type=Jh.CONSTANT,u.defaultValues=l.map(function(p,v){return p.scale(u.names[v])})),u.scalers=l.map(function(p){return{field:p.field,func:p.scale,option:p.option}}),o.needRescale=!1}})}},{key:"parseFields",value:function(r){return Array.isArray(r)?r:(0,St.isString)(r)?r.split("*"):[r]}},{key:"createScale",value:function(r,n,t,o){var u,l,p=this.scaleOptions[n]&&((u=this.scaleOptions[n])===null||u===void 0?void 0:u.field)===r?this.scaleOptions[n]:this.scaleOptions[r],v={field:r,scale:void 0,type:Jh.VARIABLE,option:p};if(!o||!o.length)return p&&p.type?v.scale=this.createDefaultScale(p):(v.scale=y0([r]),v.type=Jh.CONSTANT),v;var x=(l=o.find(function(T){return!(0,St.isNil)(T[r])}))===null||l===void 0?void 0:l[r];if(this.isNumber(r)||(0,St.isNil)(x)&&!p)v.scale=y0([r]),v.type=Jh.CONSTANT;else{var E=p&&p.type||this.getDefaultType(x);t==="text"&&(E=uo.CAT);var C=this.createScaleConfig(E,r,p,o);v.scale=this.createDefaultScale(C),v.option=C}return v}},{key:"getDefaultType",value:function(r){var n=uo.LINEAR;return typeof r=="string"&&(n=Sk.test(r)?uo.TIME:uo.CAT),n}},{key:"createScaleConfig",value:function(r,n,t,o){var u={type:r},l=(o==null?void 0:o.map(function(x){return x[n]}))||[];if(t!=null&&t.domain)u.domain=t==null?void 0:t.domain;else if(r!==uo.CAT&&r!==uo.QUANTILE&&r!==uo.DIVERGING)u.domain=ax(l);else if(r===uo.CAT)u.domain=(0,St.uniq)(l);else if(r===uo.QUANTILE)u.domain=l;else if(r===uo.DIVERGING){var p=ax(l),v=(t==null?void 0:t.neutral)!==void 0?t==null?void 0:t.neutral:(p[0]+p[1])/2;u.domain=[p[0],v,p[1]]}return(0,z.Z)((0,z.Z)({},u),t)}},{key:"createDefaultScale",value:function(r){var n=r.type,t=r.domain,o=r.unknown,u=r.clamp,l=r.nice,p=wk[n]();return t&&p.domain&&p.domain(t),o&&p.unknown(o),u!==void 0&&p.clamp&&p.clamp(u),l!==void 0&&p.nice&&p.nice(l),p}}]),e}())||_b),xb,bb,Ak=(xb=(0,Qr.b2)(),xb(bb=function(){function e(){(0,xt.Z)(this,e)}return(0,wt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){var n=r.animateStatus;n&&r.models.forEach(function(t){t.addUniforms((0,z.Z)({},r.layerModel.getAnimateUniforms()))})})}}]),e}())||bb),Tk=function(){function e(i){var r=i.rendererService,n=i.layerService,t=i.parent;(0,xt.Z)(this,e),(0,Y.Z)(this,"tileResource",new Map),(0,Y.Z)(this,"_tiles",[]),this.rendererService=r,this.layerService=n,this.parent=t}return(0,wt.Z)(e,[{key:"tiles",get:function(){return this._tiles}},{key:"hasTile",value:function(r){return this._tiles.some(function(n){return n.key===r})}},{key:"addTile",value:function(r){this._tiles.push(r)}},{key:"getTile",value:function(r){return this._tiles.find(function(n){return n.key===r})}},{key:"getVisibleTileBylngLat",value:function(r){return this._tiles.find(function(n){return n.isLoaded&&n.visible&&n.lnglatInBounds(r)})}},{key:"removeTile",value:function(r){var n=this._tiles.findIndex(function(o){return o.key===r}),t=this._tiles.splice(n,1);t[0]&&t[0].destroy()}},{key:"updateTileVisible",value:function(r){var n=this.getTile(r.key);n==null||n.updateVisible(r.isVisible)}},{key:"isParentLoaded",value:function(r){var n=r.parent;if(!n)return!0;var t=this.getTile(n==null?void 0:n.key);return!!(t!=null&&t.isLoaded)}},{key:"isChildrenLoaded",value:function(r){var n=this,t=r==null?void 0:r.children;return t.length===0?!0:t.some(function(o){var u=n.getTile(o==null?void 0:o.key);return(u==null?void 0:u.isLoaded)===!1})}},{key:"render",value:function(){var i=(0,de.Z)(q().mark(function n(){var t=this,o;return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:o=this.getRenderLayers(),o.map(function(){var p=(0,de.Z)(q().mark(function v(x){return q().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.next=2,t.layerService.renderLayer(x);case 2:case"end":return C.stop()}},v)}));return function(v){return p.apply(this,arguments)}}());case 2:case"end":return l.stop()}},n,this)}));function r(){return i.apply(this,arguments)}return r}()},{key:"getRenderLayers",value:function(){var r=this._tiles.filter(function(t){return t.visible&&t.isLoaded}),n=[];return r.map(function(t){return n.push.apply(n,(0,N.Z)(t.getLayers()))}),n}},{key:"getLayers",value:function(){var r=this._tiles.filter(function(t){return t.isLoaded}),n=[];return r.map(function(t){return n.push.apply(n,(0,N.Z)(t.getLayers()))}),n}},{key:"getTiles",value:function(){return this._tiles}},{key:"destroy",value:function(){this._tiles.forEach(function(r){return r.destroy()}),this.tileResource.clear()}}]),e}(),Mk=K(32676);function kk(e,i,r){r===void 0&&(r={});var n=rn(e),t=rn(i),o=Mk.union(n.coordinates,t.coordinates);return o.length===0?null:o.length===1?wn(o[0],r.properties):Zn(o,r.properties)}var Ik=kk,Pk=function(){function e(){(0,xt.Z)(this,e)}return(0,wt.Z)(e,[{key:"getCombineFeature",value:function(r){var n=null,t=r[0];return r.map(function(o){var u=wn(o.coordinates);n===null?n=u:n=Ik(n,u)}),t&&(n.properties=(0,z.Z)({},t)),n}}]),e}(),Sv="select",wv="active",Rk=function(){function e(i){var r=i.layerService,n=i.tileLayerService,t=i.parent;(0,xt.Z)(this,e),(0,Y.Z)(this,"tilePickID",new Map),this.layerService=r,this.tileLayerService=n,this.parent=t,this.tileSourceService=new Pk}return(0,wt.Z)(e,[{key:"pickRender",value:function(r){var n=this.tileLayerService.getVisibleTileBylngLat(r.lngLat);if(n){var t=n.getMainLayer();t==null||t.layerPickService.pickRender(r)}}},{key:"pick",value:function(r,n){var t=this.parent.getContainer(),o=t.get(Yt.IPickingService);if(r.type==="RasterLayer"){var u=this.tileLayerService.getVisibleTileBylngLat(n.lngLat);if(u&&u.getMainLayer()!==void 0){var l=u.getMainLayer();return l.layerPickService.pickRasterLayer(l,n,this.parent)}return!1}return this.pickRender(n),o.pickFromPickingFBO(r,n)}},{key:"selectFeature",value:function(r){var n=(0,hr.Z)(r,3),t=n[0],o=n[1],u=n[2],l=this.color2PickId(t,o,u);this.tilePickID.set(Sv,l),this.updateHighLight(t,o,u,Sv)}},{key:"highlightPickedFeature",value:function(r){var n=(0,hr.Z)(r,3),t=n[0],o=n[1],u=n[2],l=this.color2PickId(t,o,u);this.tilePickID.set(wv,l),this.updateHighLight(t,o,u,wv)}},{key:"updateHighLight",value:function(r,n,t,o){this.tileLayerService.tiles.map(function(u){var l=u.getMainLayer();switch(o){case Sv:l==null||l.hooks.beforeSelect.call([r,n,t]);break;case wv:l==null||l.hooks.beforeHighlight.call([r,n,t]);break}})}},{key:"setPickState",value:function(){var r=this.tilePickID.get(Sv),n=this.tilePickID.get(wv);if(r){var t=this.pickId2Color(r),o=(0,hr.Z)(t,3),u=o[0],l=o[1],p=o[2];this.updateHighLight(u,l,p,Sv);return}if(n){var v=this.pickId2Color(n),x=(0,hr.Z)(v,3),E=x[0],C=x[1],T=x[2];this.updateHighLight(E,C,T,wv);return}}},{key:"color2PickId",value:function(r,n,t){return Se(new Uint8Array([r,n,t]))}},{key:"pickId2Color",value:function(r){return Ae(r)}},{key:"getFeatureById",value:function(r){var n=this.tileLayerService.getTiles().filter(function(o){return o.visible}),t=[];return n.map(function(o){t.push.apply(t,(0,N.Z)(o.getFeatureById(r)))}),t.length<=0?null:[]}},{key:"pickRasterLayer",value:function(r,n,t){return!1}}]),e}();function Ok(e){return e==="PolygonLayer"?Nm:e==="LineLayer"?Fm:c0}function Lk(e){return["PolygonLayer","LineLayer"].indexOf(e)!==-1}var Wp=function(){function e(i,r){(0,xt.Z)(this,e),(0,Y.Z)(this,"visible",!0),(0,Y.Z)(this,"layers",[]),(0,Y.Z)(this,"isLoaded",!1),this.parent=r,this.sourceTile=i,this.x=i.x,this.y=i.y,this.z=i.z,this.key="".concat(this.x,"_").concat(this.y,"_").concat(this.z)}return(0,wt.Z)(e,[{key:"getLayers",value:function(){return this.layers}},{key:"styleUpdate",value:function(){}},{key:"lnglatInBounds",value:function(r){var n=(0,hr.Z)(this.sourceTile.bounds,4),t=n[0],o=n[1],u=n[2],l=n[3],p=r.lng,v=r.lat;return p>=t&&p<=u&&v>=o&&v<=l}},{key:"getLayerOptions",value:function(){var r=this.parent.getLayerConfig();return(0,z.Z)((0,z.Z)({},r),{},{autoFit:!1,mask:Lk(this.parent.type)||r.mask})}},{key:"addMask",value:function(){var i=(0,de.Z)(q().mark(function n(t,o){var u;return q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=e0(this.parent.sceneContainer),o.setContainer(u,this.parent.sceneContainer),p.next=4,o.init();case 4:t.addMaskLayer(o);case 5:case"end":return p.stop()}},n,this)}));function r(n,t){return i.apply(this,arguments)}return r}()},{key:"addLayer",value:function(){var i=(0,de.Z)(q().mark(function n(t){var o;return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return t.isTileLayer=!0,o=e0(this.parent.sceneContainer),t.setContainer(o,this.parent.sceneContainer),this.layers.push(t),l.next=6,t.init();case 6:case"end":return l.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"updateVisible",value:function(r){this.visible=r,this.updateOptions("visible",r)}},{key:"updateOptions",value:function(r,n){this.layers.forEach(function(t){t.updateLayerConfig((0,Y.Z)({},r,n))})}},{key:"getMainLayer",value:function(){return this.layers[0]}},{key:"getFeatures",value:function(r){return[]}},{key:"getFeatureById",value:function(r){return[]}},{key:"destroy",value:function(){this.layers.forEach(function(r){return r.destroy()})}}]),e}();function Dk(e){var i=Fk();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function Fk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var k0=function(e){(0,gr.Z)(r,e);var i=Dk(r);function r(){return(0,xt.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p,v,x;return q().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(u=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),p=Ok(this.parent.type),v=this.getSourceOption(),v){C.next=7;break}return this.isLoaded=!0,C.abrupt("return");case 7:if(x=new p((0,z.Z)({},l)).source(v.data,v.options),Object.keys(u).forEach(function(T){var O,L,B=T;x[B]((O=u[B])===null||O===void 0?void 0:O.field,(L=u[B])===null||L===void 0?void 0:L.values)}),!l.mask){C.next=12;break}return C.next=12,this.addTileMask(x);case 12:return C.next=14,this.addLayer(x);case 14:this.setLayerMinMaxZoom(x),this.isLoaded=!0;case 16:case"end":return C.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"addTileMask",value:function(){var n=(0,de.Z)(q().mark(function o(u){var l;return q().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return l=new zm({layerType:"MaskLayer"}).source({type:"FeatureCollection",features:[this.sourceTile.bboxPolygon]},{parser:{type:"geojson",featureId:"id"}}),v.next=3,this.addMask(u,l);case 3:case"end":return v.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"getSourceOption",value:function(){var t=this.parent.getSource(),o=this.parent.getLayerConfig(),u=o.sourceLayer,l=u===void 0?"defaultLayer":u,p=o.featureId,v=p===void 0?"id":p,x=this.getFeatures(l);return{data:{type:"FeatureCollection",features:x},options:{parser:{type:"geojson",featureId:v},transforms:t.transforms}}}},{key:"setLayerMinMaxZoom",value:function(t){t.getModelType()==="text"&&t.updateLayerConfig({maxZoom:this.z+1,minZoom:this.z-1})}},{key:"getFeatures",value:function(t){var o=this.sourceTile.data;return o.getTileData(t)}},{key:"getFeatureById",value:function(t){var o=this.getMainLayer();return o?o.getSource().data.dataArray.filter(function(u){return u._id===t}):[]}}]),r}(Wp);function Bk(e){var i=Nk();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function Nk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zk=function(e){(0,gr.Z)(r,e);var i=Bk(r);function r(){return(0,xt.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p,v;return q().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return u=this.getSourceOption(),l=u.data.features[0].properties,p=new Fm().source(u.data,u.options).size(1).shape("line").color("red"),v=new c0({minZoom:this.z-1,maxZoom:this.z+1}).source([l],{parser:{type:"json",x:"textLng",y:"textLat"}}).size(20).color("red").shape(this.key).style({stroke:"#fff",strokeWidth:2}),E.next=6,this.addLayer(p);case 6:return E.next=8,this.addLayer(v);case 8:this.isLoaded=!0;case 9:case"end":return E.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getSourceOption",value:function(){var t=this.parent.getSource(),o=this.sourceTile.data.layers.testTile.features;return{data:{type:"FeatureCollection",features:o},options:{parser:{type:"geojson"},transforms:t.transforms}}}}]),r}(Wp);function Zk(e){var i=Uk();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function Uk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Vk=function(e){(0,gr.Z)(r,e);var i=Zk(r);function r(){return(0,xt.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p,v;return q().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return u=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),p=this.getSourceOption(),v=new d1((0,z.Z)({},l)).source(p.data,p.options),u&&Object.keys(u).forEach(function(C){var T,O,L=C;v[L]((T=u[L])===null||T===void 0?void 0:T.field,(O=u[L])===null||O===void 0?void 0:O.values)}),E.next=7,this.addLayer(v);case 7:this.isLoaded=!0;case 8:case"end":return E.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getSourceOption",value:function(){var t=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:t.transforms}}}}]),r}(Wp),jk=["rasterData"];function Gk(e){var i=Hk();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function Hk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Wk={positions:[0,1],colors:["#000","#fff"]},Xk=function(e){(0,gr.Z)(r,e);var i=Gk(r);function r(){return(0,xt.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p,v;return q().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return u=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),p=this.getSourceOption(),this.colorTexture=this.parent.textureService.getColorTexture(l.rampColors),v=new f0((0,z.Z)((0,z.Z)({},l),{},{colorTexture:this.colorTexture})).source(p.data,p.options),u&&Object.keys(u).forEach(function(C){var T,O,L=C;v[L]((T=u[L])===null||T===void 0?void 0:T.field,(O=u[L])===null||O===void 0?void 0:O.values)}),E.next=8,this.addLayer(v);case 8:this.isLoaded=!0;case 9:case"end":return E.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getSourceOption",value:function(){var t=this.parent.getSource(),o=this.sourceTile.data.data,u=o.rasterData,l=(0,Za.Z)(o,jk);return{data:u,options:{parser:(0,z.Z)({type:"raster",extent:this.sourceTile.bounds},l),transforms:t.transforms}}}},{key:"styleUpdate",value:function(){for(var t=this,o=arguments.length,u=new Array(o),l=0;l<o;l++)u[l]=arguments[l];var p=u.rampColors,v=p===void 0?Wk:p;this.colorTexture=this.parent.textureService.getColorTexture(v),this.layers.forEach(function(x){return x.style({colorTexture:t.colorTexture})})}},{key:"destroy",value:function(){this.layers.forEach(function(t){return t.destroy()})}}]),r}(Wp),$k=["rasterData"];function Yk(e){var i=qk();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function qk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Kk=function(e){(0,gr.Z)(r,e);var i=Yk(r);function r(){return(0,xt.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p,v;return q().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return u=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),p=this.getSourceOption(),v=new f0((0,z.Z)({},l)).source(p.data,p.options),u&&Object.keys(u).forEach(function(C){var T,O,L=C;v[L]((T=u[L])===null||T===void 0?void 0:T.field,(O=u[L])===null||O===void 0?void 0:O.values)}),E.next=7,this.addLayer(v);case 7:this.isLoaded=!0;case 8:case"end":return E.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getSourceOption",value:function(){var t=this.parent.getSource(),o=this.sourceTile.data.data,u=o.rasterData,l=(0,Za.Z)(o,$k);return{data:u,options:{parser:(0,z.Z)({type:"rasterRgb",extent:this.sourceTile.bounds},l),transforms:t.transforms}}}}]),r}(Wp);function Qk(e){var i=Jk();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function Jk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var eI=function(e){(0,gr.Z)(r,e);var i=Qk(r);function r(){return(0,xt.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p,v;return q().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return u=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),p=this.getSourceOption(),v=new f0((0,z.Z)({},l)).source(p.data,p.options),u&&Object.keys(u).forEach(function(C){var T,O,L=C;v[L]((T=u[L])===null||T===void 0?void 0:T.field,(O=u[L])===null||O===void 0?void 0:O.values)}),E.next=7,this.addLayer(v);case 7:this.isLoaded=!0;case 8:case"end":return E.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getSourceOption",value:function(){var t=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:t.transforms}}}}]),r}(Wp);function tI(e){var i=rI();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function rI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nI=function(e){(0,gr.Z)(r,e);var i=tI(r);function r(){return(0,xt.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,de.Z)(q().mark(function o(){var u,l,p,v;return q().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return u=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),p=this.getSourceOption(),v=new zm((0,z.Z)({},l)).source(p.data,p.options),u&&Object.keys(u).forEach(function(C){var T,O,L=C;v[L]((T=u[L])===null||T===void 0?void 0:T.field,(O=u[L])===null||O===void 0?void 0:O.values)}),E.next=7,this.addLayer(v);case 7:this.isLoaded=!0;case 8:case"end":return E.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getFeatures",value:function(t){if(!t)return[];var o=this.sourceTile.data;return o.getTileData(t)}},{key:"getSourceOption",value:function(){var t=this.parent.getSource(),o=this.parent.getLayerConfig(),u=o.sourceLayer,l=o.featureId,p=this.getFeatures(u);return{data:{type:"FeatureCollection",features:p},options:{parser:{type:"geojson",featureId:l},transforms:t.transforms}}}}]),r}(Wp);function iI(e){var i=e.type;switch(i){case"PolygonLayer":return k0;case"LineLayer":return k0;case"PointLayer":return k0;case"TileDebugLayer":return zk;case"MaskLayer":return nI;case"RasterLayer":var r=e.getSource().parser.dataType;switch(r){case"rgb":return Kk;case"arraybuffer":return Xk;case"terrainRGB":return eI;default:return Vk}default:return k0}}var aI=["shape","color","size","style","animate","filter","rotate","scale","setBlend","setSelect","setActive"],Eb=function(){function e(i){(0,xt.Z)(this,e),(0,Y.Z)(this,"initedTileset",!1),(0,Y.Z)(this,"viewchange",(0,St.debounce)(this.mapchange,24)),this.parent=i;var r=this.parent.getContainer();this.rendererService=r.get(Yt.IRendererService),this.layerService=r.get(Yt.ILayerService),this.mapService=r.get(Yt.IMapService),this.pickingService=r.get(Yt.IPickingService),this.tileLayerService=new Tk({rendererService:this.rendererService,layerService:this.layerService,parent:i}),this.tilePickService=new Rk({tileLayerService:this.tileLayerService,layerService:this.layerService,parent:i}),this.parent.setLayerPickService(this.tilePickService),this.proxy(i),this.initTileSetManager()}return(0,wt.Z)(e,[{key:"initTileSetManager",value:function(){var r,n=this.parent.getSource();this.tilesetManager=n.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0);var t=this.getCurrentView(),o=t.latLonBounds,u=t.zoom;(r=this.tilesetManager)===null||r===void 0||r.update(u,o)}},{key:"mapchange",value:function(){var r,n=this.getCurrentView(),t=n.latLonBounds,o=n.zoom;if(this.mapService.version==="GAODE1.x"){var u=this.parent.getLayerConfig(),l=u.visible;o<3&&l?(this.parent.updateLayerConfig({visible:!1}),this.layerService.reRender()):o>=3&&!l&&(this.parent.updateLayerConfig({visible:!0}),this.layerService.reRender())}this.lastViewStates&&this.lastViewStates.zoom===o&&this.lastViewStates.latLonBounds.toString()===t.toString()||(this.lastViewStates={zoom:o,latLonBounds:t},(r=this.tilesetManager)===null||r===void 0||r.throttleUpdate(o,t))}},{key:"getCurrentView",value:function(){var r=this.mapService.getBounds(),n=[r[0][0],r[0][1],r[1][0],r[1][1]],t=this.mapService.getZoom();return{latLonBounds:n,zoom:t}}},{key:"bindTilesetEvent",value:function(){var r=this;this.tilesetManager.on("tile-loaded",function(n){}),this.tilesetManager.on("tile-unload",function(n){r.tileUnLoad(n)}),this.tilesetManager.on("tile-error",function(n,t){r.tileError(n)}),this.tilesetManager.on("tile-update",function(){r.tileUpdate()}),this.mapService.on("zoomend",function(){return r.mapchange()}),this.mapService.on("moveend",function(){return r.viewchange()})}},{key:"render",value:function(){this.tileLayerService.render()}},{key:"getLayers",value:function(){return this.tileLayerService.getLayers()}},{key:"getTiles",value:function(){return this.tileLayerService.getTiles()}},{key:"tileLoaded",value:function(r){}},{key:"tileError",value:function(r){console.warn("error:",r)}},{key:"destroy",value:function(){var r;(r=this.tilesetManager)===null||r===void 0||r.destroy(),this.tileLayerService.destroy()}},{key:"tileUnLoad",value:function(r){this.tileLayerService.removeTile(r.key)}},{key:"tileUpdate",value:function(){var i=(0,de.Z)(q().mark(function n(){var t=this,o,u;return q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(this.tilesetManager){p.next=2;break}return p.abrupt("return");case 2:return o=this.parent.getMinZoom(),u=this.parent.getMaxZoom(),p.next=6,Promise.all(this.tilesetManager.tiles.filter(function(v){return v.isLoaded}).filter(function(v){return v.isVisibleChange}).filter(function(v){return v.data}).filter(function(v){return v.z>=o&&v.z<u}).map(function(){var v=(0,de.Z)(q().mark(function x(E){var C,T;return q().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:if(t.tileLayerService.hasTile(E.key)){L.next=9;break}return C=iI(t.parent),T=new C(E,t.parent),L.next=5,T.initTileLayer();case 5:t.tilePickService.setPickState(),T.getLayers().length!==0&&(t.tileLayerService.addTile(T),t.tileLayerService.updateTileVisible(E),t.layerService.reRender()),L.next=12;break;case 9:t.tileLayerService.updateTileVisible(E),t.tilePickService.setPickState(),t.layerService.reRender();case 12:case"end":return L.stop()}},x)}));return function(x){return v.apply(this,arguments)}}()));case 6:this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles);case 7:case"end":return p.stop()}},n,this)}));function r(){return i.apply(this,arguments)}return r}()},{key:"setPickState",value:function(r){}},{key:"pickRender",value:function(r){this.tilePickService.pickRender(r)}},{key:"selectFeature",value:function(r){this.tilePickService.selectFeature(r)}},{key:"highlightPickedFeature",value:function(r){this.tilePickService.highlightPickedFeature(r)}},{key:"proxy",value:function(r){var n=this;aI.forEach(function(t){var o=r[t].bind(r);r[t]=function(){for(var u=arguments.length,l=new Array(u),p=0;p<u;p++)l[p]=arguments[p];return o.apply(void 0,l),n.getLayers().map(function(v){v[t].apply(v,l)}),t==="style"&&n.getTiles().forEach(function(v){return v.styleUpdate.apply(v,l)}),r}})}}]),e}(),Sb,wb,oI=(Sb=(0,Qr.b2)(),Sb(wb=function(){function e(){(0,xt.Z)(this,e)}return(0,wt.Z)(e,[{key:"initLayerModel",value:function(){var i=(0,de.Z)(q().mark(function n(t){return q().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return t.prepareBuildModel(),u.next=3,t.buildModels();case 3:t.styleNeedUpdate=!1;case 4:case"end":return u.stop()}},n)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"prepareLayerModel",value:function(){var i=(0,de.Z)(q().mark(function n(t){return q().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return t.prepareBuildModel(),u.next=3,t.buildModels();case 3:case"end":return u.stop()}},n)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"apply",value:function(r){var n=this;r.hooks.init.tapPromise("LayerModelPlugin",(0,de.Z)(q().mark(function t(){return q().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!r.getSource().isTile){u.next=4;break}return r.prepareBuildModel(),r.tileLayer=new Eb(r),u.abrupt("return");case 4:return u.next=6,n.initLayerModel(r);case 6:case"end":return u.stop()}},t)}))),r.hooks.beforeRenderData.tapPromise("LayerModelPlugin",function(){var t=(0,de.Z)(q().mark(function o(u){return q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(u){p.next=2;break}return p.abrupt("return",!1);case 2:if(!r.getSource().isTile){p.next=5;break}return r.tileLayer=new Eb(r),p.abrupt("return",!1);case 5:return p.next=7,n.prepareLayerModel(r);case 7:return p.abrupt("return",!0);case 8:case"end":return p.stop()}},o)}));return function(o){return t.apply(this,arguments)}}())}}]),e}())||wb),Cb,Ab,sI=(Cb=(0,Qr.b2)(),Cb(Ab=function(){function e(){(0,xt.Z)(this,e)}return(0,wt.Z)(e,[{key:"apply",value:function(r){r.hooks.afterInit.tap("LayerStylePlugin",function(){var n=r.getLayerConfig(),t=n.autoFit,o=n.fitBoundsOptions;t&&r.fitBounds(o)})}}]),e}())||Ab),Tb,Mb,uI=["type"],kb={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},lI={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},cI={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},fI={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5};function hI(e){var i={u_DirectionalLights:new Array(3).fill((0,z.Z)({},cI)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill((0,z.Z)({},fI)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[lI]),e.forEach(function(r){var n=r.type,t=n===void 0?"directional":n,o=(0,Za.Z)(r,uI),u=kb[t].lights,l=kb[t].num,p=i[l];i[u][p]=(0,z.Z)((0,z.Z)({},i[u][p]),o),i[l]++}),i}var pI=(Tb=(0,Qr.b2)(),Tb(Mb=function(){function e(){(0,xt.Z)(this,e)}return(0,wt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LightingPlugin",function(){var n=r.getLayerConfig(),t=n.enableLighting;t&&r.models.forEach(function(o){return o.addUniforms((0,z.Z)({},hI()))})})}}]),e}())||Mb),Ib,Pb,dI=(Ib=(0,Qr.b2)(),Ib(Pb=function(){function e(){(0,xt.Z)(this,e)}return(0,wt.Z)(e,[{key:"apply",value:function(r,n){var t=this,o=n.rendererService,u=n.postProcessingPassFactory,l=n.normalPassFactory;r.hooks.init.tapPromise("MultiPassRendererPlugin",function(){var p=r.getLayerConfig(),v=p.enableMultiPassRenderer,x=p.passes,E=x===void 0?[]:x;t.enabled=!!v&&r.getLayerConfig().enableMultiPassRenderer!==!1,t.enabled&&(r.multiPassRenderer=G_(r,E,u,l),r.multiPassRenderer.setRenderFlag(!0))}),r.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(t.enabled){var p=o.getViewportSize(),v=p.width,x=p.height;r.multiPassRenderer.resize(v,x)}})}}]),e}())||Pb),Rb,Ob,I0={NONE:0,ENCODE:1,HIGHLIGHT:2},vI=(Rb=(0,Qr.b2)(),Rb(Ob=function(){function e(){(0,xt.Z)(this,e)}return(0,wt.Z)(e,[{key:"apply",value:function(r,n){var t=n.styleAttributeService;r.hooks.init.tapPromise("PixelPickingPlugin",function(){var o=r.getLayerConfig(),u=o.enablePicking;t.registerStyleAttribute({name:"pickingColor",type:_n.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:$.FLOAT},size:3,update:function(p){var v=p.id;return u?Ae(v):[0,0,0]}}})}),r.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var o=r.getLayerConfig(),u=o.enablePicking;u&&r.isVisible()&&r.models.forEach(function(l){return l.addUniforms({u_PickingStage:I0.ENCODE})})}),r.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var o=r.getLayerConfig(),u=o.enablePicking;u&&r.isVisible()&&r.models.forEach(function(l){return l.addUniforms({u_PickingStage:I0.HIGHLIGHT})})}),r.hooks.beforeHighlight.tap("PixelPickingPlugin",function(o){var u=r.getLayerConfig(),l=u.highlightColor,p=u.activeMix,v=p===void 0?0:p,x=typeof l=="string"?he(l):l||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:Se(new Uint8Array(o))}),r.models.forEach(function(E){return E.addUniforms({u_PickingStage:I0.HIGHLIGHT,u_PickingColor:o,u_HighlightColor:x.map(function(C){return C*255}),u_activeMix:v})})}),r.hooks.beforeSelect.tap("PixelPickingPlugin",function(o){var u=r.getLayerConfig(),l=u.selectColor,p=u.selectMix,v=p===void 0?0:p,x=typeof l=="string"?he(l):l||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:Se(new Uint8Array(o))}),r.models.forEach(function(E){return E.addUniforms({u_PickingStage:I0.HIGHLIGHT,u_PickingColor:o,u_HighlightColor:x.map(function(C){return C*255}),u_activeMix:v,u_CurrentSelectedId:o,u_SelectColor:x.map(function(C){return C*255}),u_EnableSelect:1})})})}}]),e}())||Ob),mI=["mvt","geojsonvt","testTile"];function gI(e){var i=e.getSource();return mI.includes(i.parser.type)}function XR(e){return e.getContext?{width:e.width/DOM.DPR,height:e.height/DOM.DPR}:e.getBoundingClientRect()}var Lb,Db,yI=(Lb=(0,Qr.b2)(),Lb(Db=function(){function e(){(0,xt.Z)(this,e)}return(0,wt.Z)(e,[{key:"apply",value:function(r,n){var t=this,o=n.styleAttributeService;r.hooks.init.tapPromise("RegisterStyleAttributePlugin",function(){gI(r)||t.registerBuiltinAttributes(o,r)})}},{key:"registerBuiltinAttributes",value:function(r,n){if(n.type==="MaskLayer"){this.registerPositionAttribute(r);return}this.registerPositionAttribute(r),this.registerFilterAttribute(r),this.registerColorAttribute(r),this.registerVertexIdAttribute(r)}},{key:"registerPositionAttribute",value:function(r){r.registerStyleAttribute({name:"position",type:_n.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:$.FLOAT},size:3,update:function(t,o,u){return u.length===2?[u[0],u[1],0]:[u[0],u[1],u[2]]}}})}},{key:"registerFilterAttribute",value:function(r){r.registerStyleAttribute({name:"filter",type:_n.Attribute,descriptor:{name:"filter",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(t){var o=t.filter;return o?[1]:[0]}}})}},{key:"registerColorAttribute",value:function(r){r.registerStyleAttribute({name:"color",type:_n.Attribute,descriptor:{name:"a_Color",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:4,update:function(t){var o=t.color;return!o||!o.length?[1,1,1,1]:o}}})}},{key:"registerVertexIdAttribute",value:function(r){r.registerStyleAttribute({name:"vertexId",type:_n.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(t,o){return[o]}}})}}]),e}())||Db),Fb,Bb,Nb,zb,Zb,Ub,Dd,Vb,jb,Gb,Hb,_I=(Fb=(0,Qr.b2)(),Bb=(0,Qr.f3)(Yt.ICameraService),Nb=(0,Qr.f3)(Yt.ICoordinateSystemService),zb=(0,Qr.f3)(Yt.IRendererService),Zb=(0,Qr.f3)(Yt.IMapService),Fb(Ub=(Dd=function(){function e(){(0,xt.Z)(this,e),ra(this,"cameraService",Vb,this),ra(this,"coordinateSystemService",jb,this),ra(this,"rendererService",Gb,this),ra(this,"mapService",Hb,this)}return(0,wt.Z)(e,[{key:"apply",value:function(r){var n=this,t=this.mapService.version,o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],u=[0,0];r.hooks.beforeRender.tap("ShaderUniformPlugin",function(){var l=r.getLayerConfig().tileOrigin;n.coordinateSystemService.refresh(l),t==="GAODE2.x"&&(n.setLayerCenter(r),o=n.mapService.map.customCoords.getMVPMatrix(),u=n.mapService.getCustomCoordCenter());var p=n.rendererService.getViewportSize(),v=p.width,x=p.height;r.models.forEach(function(E){var C;E.addUniforms((C={},(0,Y.Z)(C,Bp.ProjectionMatrix,n.cameraService.getProjectionMatrix()),(0,Y.Z)(C,Bp.ViewMatrix,n.cameraService.getViewMatrix()),(0,Y.Z)(C,Bp.ViewProjectionMatrix,n.cameraService.getViewProjectionMatrix()),(0,Y.Z)(C,Bp.Zoom,n.cameraService.getZoom()),(0,Y.Z)(C,Bp.ZoomScale,n.cameraService.getZoomScale()),(0,Y.Z)(C,Bp.FocalDistance,n.cameraService.getFocalDistance()),(0,Y.Z)(C,Bp.CameraPosition,n.cameraService.getCameraPosition()),(0,Y.Z)(C,Df.CoordinateSystem,n.coordinateSystemService.getCoordinateSystem()),(0,Y.Z)(C,Df.ViewportCenter,n.coordinateSystemService.getViewportCenter()),(0,Y.Z)(C,Df.ViewportCenterProjection,n.coordinateSystemService.getViewportCenterProjection()),(0,Y.Z)(C,Df.PixelsPerDegree,n.coordinateSystemService.getPixelsPerDegree()),(0,Y.Z)(C,Df.PixelsPerDegree2,n.coordinateSystemService.getPixelsPerDegree2()),(0,Y.Z)(C,Df.PixelsPerMeter,n.coordinateSystemService.getPixelsPerMeter()),(0,Y.Z)(C,Df.Mvp,o),(0,Y.Z)(C,"u_SceneCenterMKT",u),(0,Y.Z)(C,"u_ViewportSize",[v,x]),(0,Y.Z)(C,"u_ModelMatrix",n.cameraService.getModelMatrix()),(0,Y.Z)(C,"u_DevicePixelRatio",pa.devicePixelRatio),(0,Y.Z)(C,"u_PickingBuffer",r.getLayerConfig().pickingBuffer||0),(0,Y.Z)(C,"u_shaderPick",Number(r.getShaderPickStat())),C))})})}},{key:"setLayerCenter",value:function(r){r.coordCenter===void 0&&(r.coordCenter=r.getSource().center),this.mapService.setCoordCenter&&this.mapService.setCoordCenter(r.coordCenter)}}]),e}(),Vb=na(Dd.prototype,"cameraService",[Bb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jb=na(Dd.prototype,"coordinateSystemService",[Nb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gb=na(Dd.prototype,"rendererService",[zb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hb=na(Dd.prototype,"mapService",[Zb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dd))||Ub),Wb,Xb,xI=(Wb=(0,Qr.b2)(),Wb(Xb=function(){function e(){(0,xt.Z)(this,e)}return(0,wt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("UpdateModelPlugin",function(){r.layerModel&&r.layerModel.needUpdate()}),r.hooks.afterRender.tap("UpdateModelPlugin",function(){r.layerModelNeedUpdate=!1})}}]),e}())||Xb),$b,Yb,bI=($b=(0,Qr.b2)(),$b(Yb=function(){function e(){(0,xt.Z)(this,e)}return(0,wt.Z)(e,[{key:"apply",value:function(r,n){var t=this,o=n.styleAttributeService;r.hooks.init.tapPromise("UpdateStyleAttributePlugin",function(){t.initStyleAttribute(r,{styleAttributeService:o})}),r.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){r.layerModelNeedUpdate||r.inited&&t.updateStyleAttribute(r,{styleAttributeService:o})})}},{key:"updateStyleAttribute",value:function(r,n){var t=n.styleAttributeService,o=t.getLayerStyleAttributes()||[],u=t.getLayerStyleAttribute("filter");if(u&&u.needRegenerateVertices){r.layerModelNeedUpdate=!0,o.forEach(function(l){return l.needRegenerateVertices=!1});return}o.filter(function(l){return l.needRegenerateVertices}).forEach(function(l){t.updateAttributeByFeatureRange(l.name,r.getEncodedData(),l.featureRange.startIndex,l.featureRange.endIndex,r),l.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(r,n){var t=n.styleAttributeService,o=t.getLayerStyleAttributes()||[];o.filter(function(u){return u.needRegenerateVertices}).forEach(function(u){t.updateAttributeByFeatureRange(u.name,r.getEncodedData(),u.featureRange.startIndex,u.featureRange.endIndex),u.needRegenerateVertices=!1})}}]),e}())||Yb);Jl.bind(Yt.ILayerPlugin).to(p4).inRequestScope(),Jl.bind(Yt.ILayerPlugin).to(yI).inRequestScope(),Jl.bind(Yt.ILayerPlugin).to(Ck).inRequestScope(),Jl.bind(Yt.ILayerPlugin).to(h4).inRequestScope(),Jl.bind(Yt.ILayerPlugin).to(sI).inRequestScope(),Jl.bind(Yt.ILayerPlugin).to(bI).inRequestScope(),Jl.bind(Yt.ILayerPlugin).to(xI).inRequestScope(),Jl.bind(Yt.ILayerPlugin).to(dI).inRequestScope(),Jl.bind(Yt.ILayerPlugin).to(_I).inRequestScope(),Jl.bind(Yt.ILayerPlugin).to(Ak).inRequestScope(),Jl.bind(Yt.ILayerPlugin).to(pI).inRequestScope(),Jl.bind(Yt.ILayerPlugin).to(vI).inRequestScope(),Jl.bind(Yt.ILayerPlugin).to(oI).inRequestScope();var EI=K(88307),SI=K.n(EI),wI=function(){function e(i,r){(0,xt.Z)(this,e);var n=r.buffer,t=r.offset,o=r.stride,u=r.normalized,l=r.size,p=r.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:t||0,stride:o||0,normalized:u||!1,divisor:p||0},l&&(this.attribute.size=l)}return(0,wt.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),Ch,Cv,Ah,Rc,Av,ap,Tv,P0,Bf,Xp,Fu,Nf,zf,R0,CI=(Ch={},(0,Y.Z)(Ch,$.POINTS,"points"),(0,Y.Z)(Ch,$.LINES,"lines"),(0,Y.Z)(Ch,$.LINE_LOOP,"line loop"),(0,Y.Z)(Ch,$.LINE_STRIP,"line strip"),(0,Y.Z)(Ch,$.TRIANGLES,"triangles"),(0,Y.Z)(Ch,$.TRIANGLE_FAN,"triangle fan"),(0,Y.Z)(Ch,$.TRIANGLE_STRIP,"triangle strip"),Ch),qb=(Cv={},(0,Y.Z)(Cv,$.STATIC_DRAW,"static"),(0,Y.Z)(Cv,$.DYNAMIC_DRAW,"dynamic"),(0,Y.Z)(Cv,$.STREAM_DRAW,"stream"),Cv),sg=(Ah={},(0,Y.Z)(Ah,$.BYTE,"int8"),(0,Y.Z)(Ah,$.UNSIGNED_INT,"int16"),(0,Y.Z)(Ah,$.INT,"int32"),(0,Y.Z)(Ah,$.UNSIGNED_BYTE,"uint8"),(0,Y.Z)(Ah,$.UNSIGNED_SHORT,"uint16"),(0,Y.Z)(Ah,$.UNSIGNED_INT,"uint32"),(0,Y.Z)(Ah,$.FLOAT,"float"),Ah),AI=(Rc={},(0,Y.Z)(Rc,$.ALPHA,"alpha"),(0,Y.Z)(Rc,$.LUMINANCE,"luminance"),(0,Y.Z)(Rc,$.LUMINANCE_ALPHA,"luminance alpha"),(0,Y.Z)(Rc,$.RGB,"rgb"),(0,Y.Z)(Rc,$.RGBA,"rgba"),(0,Y.Z)(Rc,$.RGBA4,"rgba4"),(0,Y.Z)(Rc,$.RGB5_A1,"rgb5 a1"),(0,Y.Z)(Rc,$.RGB565,"rgb565"),(0,Y.Z)(Rc,$.DEPTH_COMPONENT,"depth"),(0,Y.Z)(Rc,$.DEPTH_STENCIL,"depth stencil"),Rc),TI=(Av={},(0,Y.Z)(Av,$.DONT_CARE,"dont care"),(0,Y.Z)(Av,$.NICEST,"nice"),(0,Y.Z)(Av,$.FASTEST,"fast"),Av),Kb=(ap={},(0,Y.Z)(ap,$.NEAREST,"nearest"),(0,Y.Z)(ap,$.LINEAR,"linear"),(0,Y.Z)(ap,$.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,Y.Z)(ap,$.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,Y.Z)(ap,$.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,Y.Z)(ap,$.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),ap),Qb=(Tv={},(0,Y.Z)(Tv,$.REPEAT,"repeat"),(0,Y.Z)(Tv,$.CLAMP_TO_EDGE,"clamp"),(0,Y.Z)(Tv,$.MIRRORED_REPEAT,"mirror"),Tv),MI=(P0={},(0,Y.Z)(P0,$.NONE,"none"),(0,Y.Z)(P0,$.BROWSER_DEFAULT_WEBGL,"browser"),P0),kI=(Bf={},(0,Y.Z)(Bf,$.NEVER,"never"),(0,Y.Z)(Bf,$.ALWAYS,"always"),(0,Y.Z)(Bf,$.LESS,"less"),(0,Y.Z)(Bf,$.LEQUAL,"lequal"),(0,Y.Z)(Bf,$.GREATER,"greater"),(0,Y.Z)(Bf,$.GEQUAL,"gequal"),(0,Y.Z)(Bf,$.EQUAL,"equal"),(0,Y.Z)(Bf,$.NOTEQUAL,"notequal"),Bf),Jb=(Xp={},(0,Y.Z)(Xp,$.FUNC_ADD,"add"),(0,Y.Z)(Xp,$.MIN_EXT,"min"),(0,Y.Z)(Xp,$.MAX_EXT,"max"),(0,Y.Z)(Xp,$.FUNC_SUBTRACT,"subtract"),(0,Y.Z)(Xp,$.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Xp),O0=(Fu={},(0,Y.Z)(Fu,$.ZERO,"zero"),(0,Y.Z)(Fu,$.ONE,"one"),(0,Y.Z)(Fu,$.SRC_COLOR,"src color"),(0,Y.Z)(Fu,$.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,Y.Z)(Fu,$.SRC_ALPHA,"src alpha"),(0,Y.Z)(Fu,$.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,Y.Z)(Fu,$.DST_COLOR,"dst color"),(0,Y.Z)(Fu,$.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,Y.Z)(Fu,$.DST_ALPHA,"dst alpha"),(0,Y.Z)(Fu,$.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,Y.Z)(Fu,$.CONSTANT_COLOR,"constant color"),(0,Y.Z)(Fu,$.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,Y.Z)(Fu,$.CONSTANT_ALPHA,"constant alpha"),(0,Y.Z)(Fu,$.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,Y.Z)(Fu,$.SRC_ALPHA_SATURATE,"src alpha saturate"),Fu),II=(Nf={},(0,Y.Z)(Nf,$.NEVER,"never"),(0,Y.Z)(Nf,$.ALWAYS,"always"),(0,Y.Z)(Nf,$.LESS,"less"),(0,Y.Z)(Nf,$.LEQUAL,"lequal"),(0,Y.Z)(Nf,$.GREATER,"greater"),(0,Y.Z)(Nf,$.GEQUAL,"gequal"),(0,Y.Z)(Nf,$.EQUAL,"equal"),(0,Y.Z)(Nf,$.NOTEQUAL,"notequal"),Nf),Fd=(zf={},(0,Y.Z)(zf,$.ZERO,"zero"),(0,Y.Z)(zf,$.KEEP,"keep"),(0,Y.Z)(zf,$.REPLACE,"replace"),(0,Y.Z)(zf,$.INVERT,"invert"),(0,Y.Z)(zf,$.INCR,"increment"),(0,Y.Z)(zf,$.DECR,"decrement"),(0,Y.Z)(zf,$.INCR_WRAP,"increment wrap"),(0,Y.Z)(zf,$.DECR_WRAP,"decrement wrap"),zf),PI=(R0={},(0,Y.Z)(R0,$.FRONT,"front"),(0,Y.Z)(R0,$.BACK,"back"),R0),RI=function(){function e(i,r){(0,xt.Z)(this,e);var n=r.data,t=r.usage,o=r.type;this.buffer=i.buffer({data:n,usage:qb[t||$.STATIC_DRAW],type:sg[o||$.UNSIGNED_BYTE]})}return(0,wt.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(r){var n=r.data,t=r.offset;this.buffer.subdata(n,t)}}]),e}(),OI=function(){function e(i,r){(0,xt.Z)(this,e);var n=r.data,t=r.usage,o=r.type,u=r.count;this.elements=i.elements({data:n,usage:qb[t||$.STATIC_DRAW],type:sg[o||$.UNSIGNED_BYTE],count:u})}return(0,wt.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(r){var n=r.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),e}(),LI=function(){function e(i,r){(0,xt.Z)(this,e);var n=r.width,t=r.height,o=r.color,u=r.colors,l={width:n,height:t};Array.isArray(u)&&(l.colors=u.map(function(p){return p.get()})),o&&typeof o!="boolean"&&(l.color=o.get()),this.framebuffer=i.framebuffer(l)}return(0,wt.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(r){var n=r.width,t=r.height;this.framebuffer.resize(n,t)}}]),e}(),DI=function(){function e(i,r){(0,xt.Z)(this,e),(0,Y.Z)(this,"destroyed",!1),(0,Y.Z)(this,"uniforms",{}),this.reGl=i;var n=r.pick,t=n===void 0?!0:n,o=r.vs,u=r.fs,l=r.attributes,p=r.uniforms,v=r.primitive,x=r.count,E=r.elements,C=r.depth,T=r.blend,O=r.stencil,L=r.cull,B=r.instances,H={};this.options=r,p&&(this.uniforms=this.extractUniforms(p),Object.keys(p).forEach(function(Ne){H[Ne]=i.prop(Ne)}));var oe={};Object.keys(l).forEach(function(Ne){oe[Ne]=l[Ne].get()});var le={attributes:oe,frag:u,uniforms:H,vert:o,blend:{},primitive:CI[v===void 0?$.TRIANGLES:v]};if(B&&(le.instances=B),x?le.count=x:E&&(le.elements=E.get()),this.initDepthDrawParams({depth:C},le),this.initBlendDrawParams({blend:T},le),this.initStencilDrawParams({stencil:O},le),this.initCullDrawParams({cull:L},le),this.drawCommand=i(le),t){var Re=(0,St.cloneDeep)(le);Re.blend=(0,z.Z)((0,z.Z)({},Re.blend),{},{enable:!1}),this.drawPickCommand=i(Re)}this.drawParams=le}return(0,wt.Z)(e,[{key:"updateAttributesAndElements",value:function(r,n){var t={};if(Object.keys(r).forEach(function(u){t[u]=r[u].get()}),this.drawParams.attributes=t,this.drawParams.elements=n.get(),this.drawCommand=this.reGl(this.drawParams),this.options.pick){var o=(0,St.cloneDeep)(this.drawParams);o.blend=(0,z.Z)((0,z.Z)({},o.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(o)}}},{key:"updateAttributes",value:function(r){var n={};if(Object.keys(r).forEach(function(o){n[o]=r[o].get()}),this.drawParams.attributes=n,this.drawCommand=this.reGl(this.drawParams),this.options.pick){var t=(0,St.cloneDeep)(this.drawParams);t.blend=(0,z.Z)((0,z.Z)({},t.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(t)}}},{key:"addUniforms",value:function(r){this.uniforms=(0,z.Z)((0,z.Z)({},this.uniforms),this.extractUniforms(r))}},{key:"draw",value:function(r,n){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var t=(0,z.Z)((0,z.Z)({},this.uniforms),this.extractUniforms(r.uniforms||{})),o={};Object.keys(t).forEach(function(u){var l=(0,Pe.Z)(t[u]);l==="boolean"||l==="number"||Array.isArray(t[u])||t[u].BYTES_PER_ELEMENT?o[u]=t[u]:o[u]=t[u].get()}),n?this.drawPickCommand&&this.drawPickCommand(o):this.drawCommand(o)}}},{key:"destroy",value:function(){var r,n;(r=this.drawParams)===null||r===void 0||(n=r.elements)===null||n===void 0||n.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(t){t==null||t.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(r,n){var t=r.depth;t&&(n.depth={enable:t.enable===void 0?!0:!!t.enable,mask:t.mask===void 0?!0:!!t.mask,func:kI[t.func||$.LESS],range:t.range||[0,1]})}},{key:"initBlendDrawParams",value:function(r,n){var t=r.blend;if(t){var o=t.enable,u=t.func,l=t.equation,p=t.color,v=p===void 0?[0,0,0,0]:p;n.blend={enable:!!o,func:{srcRGB:O0[u&&u.srcRGB||$.SRC_ALPHA],srcAlpha:O0[u&&u.srcAlpha||$.SRC_ALPHA],dstRGB:O0[u&&u.dstRGB||$.ONE_MINUS_SRC_ALPHA],dstAlpha:O0[u&&u.dstAlpha||$.ONE_MINUS_SRC_ALPHA]},equation:{rgb:Jb[l&&l.rgb||$.FUNC_ADD],alpha:Jb[l&&l.alpha||$.FUNC_ADD]},color:v}}}},{key:"initStencilDrawParams",value:function(r,n){var t=r.stencil;if(t){var o=t.enable,u=t.mask,l=u===void 0?-1:u,p=t.func,v=p===void 0?{cmp:$.ALWAYS,ref:0,mask:-1}:p,x=t.opFront,E=x===void 0?{fail:$.KEEP,zfail:$.KEEP,zpass:$.KEEP}:x,C=t.opBack,T=C===void 0?{fail:$.KEEP,zfail:$.KEEP,zpass:$.KEEP}:C;n.stencil={enable:!!o,mask:l,func:(0,z.Z)((0,z.Z)({},v),{},{cmp:II[v.cmp]}),opFront:{fail:Fd[E.fail],zfail:Fd[E.zfail],zpass:Fd[E.zpass]},opBack:{fail:Fd[T.fail],zfail:Fd[T.zfail],zpass:Fd[T.zpass]}}}}},{key:"initCullDrawParams",value:function(r,n){var t=r.cull;if(t){var o=t.enable,u=t.face,l=u===void 0?$.BACK:u;n.cull={enable:!!o,face:PI[l]}}}},{key:"extractUniforms",value:function(r){var n=this,t={};return Object.keys(r).forEach(function(o){n.extractUniformsRecursively(o,r[o],t,"")}),t}},{key:"extractUniformsRecursively",value:function(r,n,t,o){var u=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||(0,St.isTypedArray)(n)||n===""||"resize"in n){t["".concat(o&&o+".").concat(r)]=n;return}(0,St.isPlainObject)(n)&&Object.keys(n).forEach(function(l){u.extractUniformsRecursively(l,n[l],t,"".concat(o&&o+".").concat(r))}),Array.isArray(n)&&n.forEach(function(l,p){Object.keys(l).forEach(function(v){u.extractUniformsRecursively(v,l[v],t,"".concat(o&&o+".").concat(r,"[").concat(p,"]"))})})}}]),e}(),FI=function(){function e(i,r){(0,xt.Z)(this,e),(0,Y.Z)(this,"isDestroy",!1);var n=r.data,t=r.type,o=t===void 0?$.UNSIGNED_BYTE:t,u=r.width,l=r.height,p=r.flipY,v=p===void 0?!1:p,x=r.format,E=x===void 0?$.RGBA:x,C=r.mipmap,T=C===void 0?!1:C,O=r.wrapS,L=O===void 0?$.CLAMP_TO_EDGE:O,B=r.wrapT,H=B===void 0?$.CLAMP_TO_EDGE:B,oe=r.aniso,le=oe===void 0?0:oe,Re=r.alignment,Ne=Re===void 0?1:Re,ut=r.premultiplyAlpha,Ot=ut===void 0?!1:ut,Nt=r.mag,jt=Nt===void 0?$.NEAREST:Nt,br=r.min,yr=br===void 0?$.NEAREST:br,Ur=r.colorSpace,An=Ur===void 0?$.BROWSER_DEFAULT_WEBGL:Ur,jn=r.x,Qi=jn===void 0?0:jn,Ca=r.y,bo=Ca===void 0?0:Ca,Ao=r.copy,Ko=Ao===void 0?!1:Ao;this.width=u,this.height=l;var Ml={width:u,height:l,type:sg[o],format:AI[E],wrapS:Qb[L],wrapT:Qb[H],mag:Kb[jt],min:Kb[yr],alignment:Ne,flipY:v,colorSpace:MI[An],premultiplyAlpha:Ot,aniso:le,x:Qi,y:bo,copy:Ko};n&&(Ml.data=n),typeof T=="number"?Ml.mipmap=TI[T]:typeof T=="boolean"&&(Ml.mipmap=T),this.texture=i.texture(Ml)}return(0,wt.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(r)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(r){var n=r.width,t=r.height;this.texture.resize(n,t),this.width=n,this.height=t}},{key:"destroy",value:function(){if(!this.isDestroy){var r;(r=this.texture)===null||r===void 0||r.destroy()}this.isDestroy=!0}}]),e}(),e2,t2,BI=(e2=(0,Qr.b2)(),e2(t2=function(){function e(){var i=this;(0,xt.Z)(this,e),(0,Y.Z)(this,"createModel",function(r){return new DI(i.gl,r)}),(0,Y.Z)(this,"createAttribute",function(r){return new wI(i.gl,r)}),(0,Y.Z)(this,"createBuffer",function(r){return new RI(i.gl,r)}),(0,Y.Z)(this,"createElements",function(r){return new OI(i.gl,r)}),(0,Y.Z)(this,"createTexture2D",function(r){return new FI(i.gl,r)}),(0,Y.Z)(this,"createFramebuffer",function(r){return new LI(i.gl,r)}),(0,Y.Z)(this,"useFramebuffer",function(r,n){i.gl({framebuffer:r?r.get():null})(n)}),(0,Y.Z)(this,"clear",function(r){var n,t=r.color,o=r.depth,u=r.stencil,l=r.framebuffer,p=l===void 0?null:l,v={color:t,depth:o,stencil:u};v.framebuffer=p===null?p:p.get(),(n=i.gl)===null||n===void 0||n.clear(v)}),(0,Y.Z)(this,"viewport",function(r){var n=r.x,t=r.y,o=r.width,u=r.height;i.gl._gl.viewport(n,t,o,u),i.width=o,i.height=u,i.gl._refresh()}),(0,Y.Z)(this,"readPixels",function(r){var n=r.framebuffer,t=r.x,o=r.y,u=r.width,l=r.height,p={x:t,y:o,width:u,height:l};return n&&(p.framebuffer=n.get()),i.gl.read(p)}),(0,Y.Z)(this,"getViewportSize",function(){return{width:i.gl._gl.drawingBufferWidth,height:i.gl._gl.drawingBufferHeight}}),(0,Y.Z)(this,"getContainer",function(){if(rs)return i.canvas;var r;return(r=i.canvas)===null||r===void 0?void 0:r.parentElement}),(0,Y.Z)(this,"getCanvas",function(){return i.canvas}),(0,Y.Z)(this,"getGLContext",function(){return i.gl._gl}),(0,Y.Z)(this,"destroy",function(){var r,n,t;i.canvas=null,(r=i.gl)===null||r===void 0||(n=r._gl)===null||n===void 0||(t=n.getExtension("WEBGL_lose_context"))===null||t===void 0||t.loseContext(),i.gl.destroy(),i.gl=null})}return(0,wt.Z)(e,[{key:"init",value:function(){var i=(0,de.Z)(q().mark(function n(t,o,u){var l=this;return q().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(this.canvas=t,!u){v.next=5;break}this.gl=u,v.next=8;break;case 5:return v.next=7,new Promise(function(x,E){SI()({canvas:l.canvas,attributes:{alpha:!0,antialias:o.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:o.preserveDrawingBuffer,stencil:o.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(T,O){(T||!O)&&E(T),x(O)}})});case 7:this.gl=v.sent;case 8:this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 9:case"end":return v.stop()}},n,this)}));function r(n,t,o){return i.apply(this,arguments)}return r}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(r){return!!this.getGLContext().getExtension(r)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var r=this.getGLContext();r.disable(r.CULL_FACE)}},{key:"setDirty",value:function(r){this.isDirty=r}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||t2);function NI(e){var i=zI();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function zI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ug=["selectstart","selecting","selectend"],ZI=function(e){(0,gr.Z)(r,e);var i=NI(r);function r(n){var t,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(0,xt.Z)(this,r),t=i.call(this),(0,Y.Z)((0,De.Z)(t),"isEnable",!1),(0,Y.Z)((0,De.Z)(t),"onDragStart",function(u){t.box.style.display="block",t.startEvent=t.endEvent=u,t.syncBoxBound(),t.emit("selectstart",t.getLngLatBox(),t.startEvent,t.endEvent)}),(0,Y.Z)((0,De.Z)(t),"onDragging",function(u){t.endEvent=u,t.syncBoxBound(),t.emit("selecting",t.getLngLatBox(),t.startEvent,t.endEvent)}),(0,Y.Z)((0,De.Z)(t),"onDragEnd",function(u){t.endEvent=u,t.box.style.display="none",t.emit("selectend",t.getLngLatBox(),t.startEvent,t.endEvent)}),t.scene=n,t.options=o,t}return(0,wt.Z)(r,[{key:"container",get:function(){return this.scene.getMapService().getMarkerContainer()}},{key:"enable",value:function(){if(!this.isEnable){var t=this.options.className;if(this.scene.setMapStatus({dragEnable:!1}),this.container.style.cursor="crosshair",!this.box){var o=Bi("div",void 0,this.container);o.classList.add("l7-select-box"),t&&o.classList.add(t),o.style.display="none",this.box=o}this.scene.on("dragstart",this.onDragStart),this.scene.on("dragging",this.onDragging),this.scene.on("dragend",this.onDragEnd),this.isEnable=!0}}},{key:"disable",value:function(){!this.isEnable||(this.scene.setMapStatus({dragEnable:!0}),this.container.style.cursor="auto",this.scene.off("dragstart",this.onDragStart),this.scene.off("dragging",this.onDragging),this.scene.off("dragend",this.onDragEnd),this.isEnable=!1)}},{key:"syncBoxBound",value:function(){var t=this.startEvent,o=t.x,u=t.y,l=this.endEvent,p=l.x,v=l.y,x=Math.min(o,p),E=Math.min(u,v),C=Math.abs(o-p),T=Math.abs(u-v);this.box.style.top="".concat(E,"px"),this.box.style.left="".concat(x,"px"),this.box.style.width="".concat(C,"px"),this.box.style.height="".concat(T,"px")}},{key:"getLngLatBox",value:function(){var t=this.startEvent.lngLat,o=t.lng,u=t.lat,l=this.endEvent.lngLat,p=l.lng,v=l.lat;return w([[o,u],[p,v]])}}]),r}(Ns.EventEmitter),UI=function(){function e(i){(0,xt.Z)(this,e);var r=i.id,n=i.map,t=i.canvas,o=i.hasBaseMap,u=ow();this.container=u,n.setContainer(u,r,t,o),u.bind(Yt.IRendererService).to(BI).inSingletonScope(),this.sceneService=u.get(Yt.ISceneService),this.mapService=u.get(Yt.IMapService),this.iconService=u.get(Yt.IIconService),this.fontService=u.get(Yt.IFontService),this.controlService=u.get(Yt.IControlService),this.layerService=u.get(Yt.ILayerService),this.markerService=u.get(Yt.IMarkerService),this.interactionService=u.get(Yt.IInteractionService),this.popupService=u.get(Yt.IPopupService),this.boxSelect=new ZI(this,{}),rs?this.sceneService.initMiniScene(i):(this.initComponent(r),this.sceneService.init(i),this.initControl())}return(0,wt.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(r){return this.sceneService.exportPng(r)}},{key:"exportMap",value:function(r){return this.sceneService.exportPng(r)}},{key:"registerRenderService",value:function(r){var n=this;if(this.sceneService.loaded){var t=new r(this);t.init()}else this.on("loaded",function(){var o=new r(n);o.init()})}},{key:"setBgColor",value:function(r){this.mapService.setBgColor(r)}},{key:"addLayer",value:function(r){var n=this,t=e0(this.container);if(r.setContainer(t,this.container),this.sceneService.addLayer(r),r.inited){var o=this.initMask(r);this.addMask(o,r.id)}else r.on("inited",function(){var u=n.initMask(r);n.addMask(u,r.id)})}},{key:"initMask",value:function(r){var n=r.getLayerConfig(),t=n.mask,o=n.maskfence,u=n.maskColor,l=u===void 0?"#000":u,p=n.maskOpacity,v=p===void 0?0:p;if(!(!t||!o)){var x=new zm().source(o).shape("fill").style({color:l,opacity:v});return x}}},{key:"addMask",value:function(r,n){if(!!r){var t=this.getLayer(n);if(t){var o=e0(this.container);r.setContainer(o,this.container),t.addMaskLayer(r),this.sceneService.addMask(r)}else console.warn("parent layer not find!")}}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(r){return this.layerService.getLayer(r)}},{key:"getLayerByName",value:function(r){return this.layerService.getLayerByName(r)}},{key:"removeLayer",value:function(r,n){this.layerService.remove(r,n)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(r){this.layerService.setEnableRender(r)}},{key:"addIconFont",value:function(r,n){this.fontService.addIconFont(r,n)}},{key:"addIconFonts",value:function(r){var n=this;r.forEach(function(t){var o=(0,hr.Z)(t,2),u=o[0],l=o[1];n.fontService.addIconFont(u,l)})}},{key:"addFontFace",value:function(r,n){var t=this;this.fontService.once("fontloaded",function(o){t.emit("fontloaded",o)}),this.fontService.addFontFace(r,n)}},{key:"addImage",value:function(){var i=(0,de.Z)(q().mark(function n(t,o){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(rs){l.next=5;break}return l.next=3,this.iconService.addImage(t,o);case 3:l.next=6;break;case 5:this.iconService.addImageMini(t,o,this.sceneService);case 6:case"end":return l.stop()}},n,this)}));function r(n,t){return i.apply(this,arguments)}return r}()},{key:"hasImage",value:function(r){return this.iconService.hasImage(r)}},{key:"removeImage",value:function(r){this.iconService.removeImage(r)}},{key:"addIconFontGlyphs",value:function(r,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(r){this.controlService.addControl(r,this.container)}},{key:"removeControl",value:function(r){this.controlService.removeControl(r)}},{key:"getControlByName",value:function(r){return this.controlService.getControlByName(r)}},{key:"addMarker",value:function(r){this.markerService.addMarker(r)}},{key:"addMarkerLayer",value:function(r){this.markerService.addMarkerLayer(r)}},{key:"removeMarkerLayer",value:function(r){this.markerService.removeMarkerLayer(r)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(r){this.popupService.addPopup(r)}},{key:"removePopup",value:function(r){this.popupService.removePopup(r)}},{key:"on",value:function(r,n){if(ug.includes(r)){var t;(t=this.boxSelect)===null||t===void 0||t.on(r,n)}else r0.includes(r)?this.sceneService.on(r,n):this.mapService.on(r,n)}},{key:"once",value:function(r,n){if(ug.includes(r)){var t;(t=this.boxSelect)===null||t===void 0||t.once(r,n)}else r0.includes(r)?this.sceneService.once(r,n):this.mapService.once(r,n)}},{key:"emit",value:function(r,n){r0.indexOf(r)===-1?this.mapService.on(r,n):this.sceneService.emit(r,n)}},{key:"off",value:function(r,n){if(ug.includes(r)){var t;(t=this.boxSelect)===null||t===void 0||t.off(r,n)}else r0.includes(r)?this.sceneService.off(r,n):this.mapService.off(r,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(r){return this.mapService.getCenter(r)}},{key:"setCenter",value:function(r,n){return this.mapService.setCenter(r,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(r){return this.mapService.setPitch(r)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(r){this.mapService.setRotation(r)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(r){this.mapService.panTo(r)}},{key:"panBy",value:function(r,n){this.mapService.panBy(r,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(r){this.mapService.setZoom(r)}},{key:"fitBounds",value:function(r,n){var t=this.sceneService.getSceneConfig(),o=t.fitBoundsOptions,u=t.animate;this.mapService.fitBounds(r,n||(0,z.Z)((0,z.Z)({},o),{},{animate:u}))}},{key:"setZoomAndCenter",value:function(r,n){this.mapService.setZoomAndCenter(r,n)}},{key:"setMapStyle",value:function(r){this.mapService.setMapStyle(r)}},{key:"setMapStatus",value:function(r){this.mapService.setMapStatus(r)}},{key:"pixelToLngLat",value:function(r){return this.mapService.pixelToLngLat(r)}},{key:"lngLatToPixel",value:function(r){return this.mapService.lngLatToPixel(r)}},{key:"containerToLngLat",value:function(r){return this.mapService.containerToLngLat(r)}},{key:"lngLatToContainer",value:function(r){return this.mapService.lngLatToContainer(r)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(r,n){this.container.bind(Yt.IPostProcessingPass).to(r).whenTargetNamed(n)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"enableBoxSelect",value:function(){var r=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.boxSelect.enable(),n&&this.boxSelect.once("selectend",function(){r.disableBoxSelect()})}},{key:"disableBoxSelect",value:function(){this.boxSelect.disable()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(r){this.controlService.init({container:Gi(r)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var r=this.sceneService.getSceneConfig(),n=r.logoVisible,t=r.logoPosition;n&&this.addControl(new F_({position:t}))}}]),e}(),$R="2.11.1";function r2(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function YR(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?r2(Object(r),!0).forEach(function(n){VI(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):r2(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function VI(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function qR(e,i){return WI(e)||HI(e,i)||GI(e,i)||jI()}function jI(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function GI(e,i){if(!!e){if(typeof e=="string")return n2(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return n2(e,i)}}function n2(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function HI(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],t=!0,o=!1,u,l;try{for(r=r.call(e);!(t=(u=r.next()).done)&&(n.push(u.value),!(i&&n.length===i));t=!0);}catch(p){o=!0,l=p}finally{try{!t&&r.return!=null&&r.return()}finally{if(o)throw l}}return n}}function WI(e){if(Array.isArray(e))return e}var KR=null,QR=null,i2,lg,a2,XI=(i2=Em(Yt.IGlobalConfigService),lg=function(){function e(i){(0,xt.Z)(this,e),ra(this,"configService",a2,this),this.config=i}return(0,wt.Z)(e,[{key:"setContainer",value:function(r,n,t,o){r.bind(Yt.MapConfig).toConstantValue((0,z.Z)((0,z.Z)({},this.config),{},{id:n,canvas:t,hasBaseMap:o})),r.bind(Yt.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),a2=na(lg.prototype,"configService",[i2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lg),$I=K(6158),Mv=K.n($I),YI=function(){function e(i){(0,xt.Z)(this,e),(0,Y.Z)(this,"size",1e4),this.size=i||1e4}return(0,wt.Z)(e,[{key:"setSize",value:function(r){this.size=r}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(r){return(180+r)/360*this.size}},{key:"mercatorYfromLat",value:function(r){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(r){return r/this.size*360-180}},{key:"latFromMercatorY",value:function(r){var n=180-(1-r/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90}},{key:"project",value:function(r){var n=this.mercatorXfromLng(r[0]),t=this.mercatorYfromLat(r[1]);return[n,t]}},{key:"unproject",value:function(r){var n=this.lngFromMercatorX(r[0]),t=this.latFromMercatorY(r[1]);return[n,t]}}]),e}(),qI={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},o2,s2,u2,l2,c2,f2,Bd,h2,p2,d2,v2,m2={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},KI=12,QI=(o2=(0,Qr.b2)(),s2=(0,Qr.f3)(Yt.MapConfig),u2=(0,Qr.f3)(Yt.IGlobalConfigService),l2=(0,Qr.f3)(Yt.ICoordinateSystemService),c2=(0,Qr.f3)(Yt.IEventEmitter),o2(f2=(Bd=function(){function e(){var i=this;(0,xt.Z)(this,e),(0,Y.Z)(this,"version",hs.DEFUALT),(0,Y.Z)(this,"simpleMapCoord",new YI),(0,Y.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),ra(this,"config",h2,this),ra(this,"configService",p2,this),ra(this,"coordinateSystemService",d2,this),ra(this,"eventEmitter",v2,this),(0,Y.Z)(this,"handleCameraChanged",function(r){var n=i.map.getCenter(),t=n.lat,o=n.lng;i.emit("mapchange"),i.viewport.syncWithMapCamera({bearing:i.map.getBearing(),center:[o,t],viewportHeight:i.map.transform.height,pitch:i.map.getPitch(),viewportWidth:i.map.transform.width,zoom:i.map.getZoom(),cameraHeight:0}),i.updateCoordinateSystemService(),i.cameraChangedCallback(i.viewport)})}return(0,wt.Z)(e,[{key:"setBgColor",value:function(r){this.bgColor=r}},{key:"addMarkerContainer",value:function(){var r=this.map.getCanvasContainer();this.markerContainer=Bi("div","l7-marker-container",r),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"getOverlayContainer",value:function(){}},{key:"on",value:function(r,n){yw.indexOf(r)!==-1?this.eventEmitter.on(r,n):this.map.on(m2[r]||r,n)}},{key:"off",value:function(r,n){this.map.off(m2[r]||r,n),this.eventEmitter.off(r,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){if(this.version===hs.SIMPLE)return this.simpleMapCoord.getSize();var r=this.map.transform;return[r.width,r.height]}},{key:"getType",value:function(){return"default"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(r){return this.map.setZoom(r)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(r){this.map.setCenter(r)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(r){this.map.setBearing(r)}},{key:"zoomIn",value:function(r,n){this.map.zoomIn(r,n)}},{key:"zoomOut",value:function(r,n){this.map.zoomOut(r,n)}},{key:"setPitch",value:function(r){return this.map.setPitch(r)}},{key:"panTo",value:function(r){this.map.panTo(r)}},{key:"panBy",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.panTo([r,n])}},{key:"fitBounds",value:function(r,n){this.map.fitBounds(r,n)}},{key:"setMaxZoom",value:function(r){this.map.setMaxZoom(r)}},{key:"setMinZoom",value:function(r){this.map.setMinZoom(r)}},{key:"setMapStatus",value:function(r){r.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),r.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),r.dragEnable===!1&&this.map.dragPan.disable(),r.dragEnable===!0&&this.map.dragPan.enable(),r.rotateEnable===!1&&this.map.dragRotate.disable(),r.dragEnable===!0&&this.map.dragRotate.enable(),r.keyboardEnable===!1&&this.map.keyboard.disable(),r.keyboardEnable===!0&&this.map.keyboard.enable(),r.zoomEnable===!1&&this.map.scrollZoom.disable(),r.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(r,n){this.map.flyTo({zoom:r,center:n})}},{key:"setMapStyle",value:function(r){this.map.setStyle(this.getMapStyleValue(r))}},{key:"meterToCoord",value:function(r,n){return 1}},{key:"pixelToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToPixel",value:function(r){return this.map.project(r)}},{key:"containerToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToContainer",value:function(r){return this.map.project(r)}},{key:"getMapStyle",value:function(){try{var r,n=(r=this.map.getStyle().sprite)!==null&&r!==void 0?r:"";return/^mapbox:\/\/sprites\/zcxduo\/\w+\/\w+$/.test(n)?n==null?void 0:n.replace(/\/\w+$/,"").replace(/sprites/,"styles"):n}catch(t){return""}}},{key:"getMapStyleConfig",value:function(){return qI}},{key:"getMapStyleValue",value:function(r){var n;return(n=this.getMapStyleConfig()[r])!==null&&n!==void 0?n:r}},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(r){for(var n,t=arguments.length,o=new Array(t>1?t-1:0),u=1;u<t;u++)o[u-1]=arguments[u];(n=this.eventEmitter).emit.apply(n,[r].concat(o))}},{key:"once",value:function(r){for(var n,t=arguments.length,o=new Array(t>1?t-1:0),u=1;u<t;u++)o[u-1]=arguments[u];(n=this.eventEmitter).once.apply(n,[r].concat(o))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(r){var n=this.map.getCanvas(),t=r==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return t}},{key:"onCameraChanged",value:function(r){this.cameraChangedCallback=r}},{key:"creatMapContainer",value:function(r){var n=r;return typeof r=="string"&&(n=document.getElementById(r)),n}},{key:"updateView",value:function(r){this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:r.bearing,center:r.center,viewportHeight:r.viewportHeight,pitch:r.pitch,viewportWidth:r.viewportWidth,zoom:r.zoom,cameraHeight:0}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)}},{key:"updateCoordinateSystemService",value:function(){var r=this.config.offsetCoordinate,n=r===void 0?!0:r;this.viewport.getZoom()>KI&&n?this.coordinateSystemService.setCoordinateSystem(Mc.LNGLAT_OFFSET):this.coordinateSystemService.setCoordinateSystem(Mc.LNGLAT)}}]),e}(),h2=na(Bd.prototype,"config",[s2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),p2=na(Bd.prototype,"configService",[u2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),d2=na(Bd.prototype,"coordinateSystemService",[l2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v2=na(Bd.prototype,"eventEmitter",[c2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bd))||f2);function kv(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function L0(e,i){var r=Kd([],i,e);return dd(r,r,1/r[3]),r}function JR(e,i){var r=e%i;return r<0?i+r:r}function eO(e,i,r){return r*i+(1-r)*e}function $p(e,i){if(!e)throw new Error(i||"viewport-mercator-project: assertion failed.")}var cf=Math.PI,g2=cf/4,Th=cf/180,y2=180/cf,cg=512,fg=4003e4,JI=1.5;function _2(e){return Math.pow(2,e)}function e7(e){return Math.log2(e)}function D0(e,i){var r=(0,hr.Z)(e,2),n=r[0],t=r[1];$p(Number.isFinite(n)&&Number.isFinite(i)),$p(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude"),i*=cg;var o=n*Th,u=t*Th,l=i*(o+cf)/(2*cf),p=i*(cf-Math.log(Math.tan(g2+u*.5)))/(2*cf);return[l,p]}function hg(e,i){var r=(0,hr.Z)(e,2),n=r[0],t=r[1];i*=cg;var o=n/i*(2*cf)-cf,u=2*(Math.atan(Math.exp(cf-t/i*(2*cf)))-g2);return[o*y2,u*y2]}function tO(e){var i=e.latitude;assert(Number.isFinite(i));var r=Math.cos(i*Th);return e7(fg*r)-9}function x2(e){var i=e.latitude,r=e.longitude,n=e.zoom,t=e.scale,o=e.highPrecision,u=o===void 0?!1:o;t=t!==void 0?t:_2(n),$p(Number.isFinite(i)&&Number.isFinite(r)&&Number.isFinite(t));var l={},p=cg*t,v=Math.cos(i*Th),x=p/360,E=x/v,C=p/fg/v;if(l.pixelsPerMeter=[C,-C,C],l.metersPerPixel=[1/C,-1/C,1/C],l.pixelsPerDegree=[x,-E,C],l.degreesPerPixel=[1/x,-1/E,1/C],u){var T=Th*Math.tan(i*Th)/v,O=x*T/2,L=p/fg*T,B=L/E*C;l.pixelsPerDegree2=[0,-O,L],l.pixelsPerMeter2=[B,0,B]}return l}function rO(e,i){var r=_slicedToArray(e,3),n=r[0],t=r[1],o=r[2],u=_slicedToArray(i,3),l=u[0],p=u[1],v=u[2],x=1,E=x2({longitude:n,latitude:t,scale:x,highPrecision:!0}),C=E.pixelsPerMeter,T=E.pixelsPerMeter2,O=D0(e,x);O[0]+=l*(C[0]+T[0]*p),O[1]+=p*(C[1]+T[1]*p);var L=hg(O,x),B=(o||0)+(v||0);return Number.isFinite(o)||Number.isFinite(v)?[L[0],L[1],B]:L}function t7(e){var i=e.height,r=e.pitch,n=e.bearing,t=e.altitude,o=e.center,u=o===void 0?null:o,l=e.flipY,p=l===void 0?!1:l,v=kv();return qi(v,v,[0,0,-t]),Qn(v,v,[1,1,1/i]),$a(v,v,-r*Th),vo(v,v,n*Th),p&&Qn(v,v,[1,-1,1]),u&&qi(v,v,to.negate([],u)),v}function r7(e){var i=e.width,r=e.height,n=e.altitude,t=n===void 0?JI:n,o=e.pitch,u=o===void 0?0:o,l=e.nearZMultiplier,p=l===void 0?1:l,v=e.farZMultiplier,x=v===void 0?1:v,E=u*Th,C=Math.atan(.5/t),T=Math.sin(C)*t/Math.sin(Math.PI/2-E-C),O=Math.cos(Math.PI/2-E)*T+t;return{fov:2*Math.atan(r/2/t),aspect:i/r,focalDistance:t,near:p,far:O*x}}function n7(e){var i=e.width,r=e.height,n=e.pitch,t=e.altitude,o=e.nearZMultiplier,u=e.farZMultiplier,l=r7({width:i,height:r,altitude:t,pitch:n,nearZMultiplier:o,farZMultiplier:u}),p=l.fov,v=l.aspect,x=l.near,E=l.far,C=jo([],p,v,x,E);return C}function i7(e,i){var r=(0,hr.Z)(e,3),n=r[0],t=r[1],o=r[2],u=o===void 0?0:o;return $p(Number.isFinite(n)&&Number.isFinite(t)&&Number.isFinite(u)),L0(i,[n,t,u,1])}function b2(e,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=(0,hr.Z)(e,3),t=n[0],o=n[1],u=n[2];if($p(Number.isFinite(t)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(u)){var l=L0(i,[t,o,u,1]);return l}var p=L0(i,[t,o,0,1]),v=L0(i,[t,o,1,1]),x=p[2],E=v[2],C=x===E?0:((r||0)-x)/(E-x);return qr.lerp([],p,v,C)}var E2=kv(),a7=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=i.width,n=i.height,t=i.viewMatrix,o=t===void 0?E2:t,u=i.projectionMatrix,l=u===void 0?E2:u;(0,xt.Z)(this,e),this.width=r||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=o,this.projectionMatrix=l;var p=kv();xi(p,p,this.projectionMatrix),xi(p,p,this.viewMatrix),this.viewProjectionMatrix=p;var v=kv();Qn(v,v,[this.width/2,-this.height/2,1]),qi(v,v,[1,-1,0]),xi(v,v,this.viewProjectionMatrix);var x=di(kv(),v);if(!x)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=v,this.pixelUnprojectionMatrix=x,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,wt.Z)(e,[{key:"equals",value:function(r){return r instanceof e?r.width===this.width&&r.height===this.height&&Rf(r.projectionMatrix,this.projectionMatrix)&&Rf(r.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=n.topLeft,o=t===void 0?!0:t,u=this.projectPosition(r),l=i7(u,this.pixelProjectionMatrix),p=(0,hr.Z)(l,2),v=p[0],x=p[1],E=o?x:this.height-x;return r.length===2?[v,E]:[v,E,l[2]]}},{key:"unproject",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=n.topLeft,o=t===void 0?!0:t,u=n.targetZ,l=(0,hr.Z)(r,3),p=l[0],v=l[1],x=l[2],E=o?v:this.height-v,C=u&&u*this.pixelsPerMeter,T=b2([p,E,x],this.pixelUnprojectionMatrix,C),O=this.unprojectPosition(T),L=(0,hr.Z)(O,3),B=L[0],H=L[1],oe=L[2];return Number.isFinite(x)?[B,H,oe]:Number.isFinite(u)?[B,H,u]:[B,H]}},{key:"projectPosition",value:function(r){var n=this.projectFlat(r),t=(0,hr.Z)(n,2),o=t[0],u=t[1],l=(r[2]||0)*this.pixelsPerMeter;return[o,u,l]}},{key:"unprojectPosition",value:function(r){var n=this.unprojectFlat(r),t=(0,hr.Z)(n,2),o=t[0],u=t[1],l=(r[2]||0)/this.pixelsPerMeter;return[o,u,l]}},{key:"projectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}},{key:"unprojectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}}]),e}();function o7(e){var i=e.width,r=e.height,n=e.bounds,t=e.minExtent,o=t===void 0?0:t,u=e.maxZoom,l=u===void 0?24:u,p=e.padding,v=p===void 0?0:p,x=e.offset,E=x===void 0?[0,0]:x,C=(0,hr.Z)(n,2),T=(0,hr.Z)(C[0],2),O=T[0],L=T[1],B=(0,hr.Z)(C[1],2),H=B[0],oe=B[1];if(Number.isFinite(v)){var le=v;v={top:le,bottom:le,left:le,right:le}}else $p(Number.isFinite(v.top)&&Number.isFinite(v.bottom)&&Number.isFinite(v.left)&&Number.isFinite(v.right));var Re=new S2({width:i,height:r,longitude:0,latitude:0,zoom:0}),Ne=Re.project([O,oe]),ut=Re.project([H,L]),Ot=[Math.max(Math.abs(ut[0]-Ne[0]),o),Math.max(Math.abs(ut[1]-Ne[1]),o)],Nt=[i-v.left-v.right-Math.abs(E[0])*2,r-v.top-v.bottom-Math.abs(E[1])*2];$p(Nt[0]>0&&Nt[1]>0);var jt=Nt[0]/Ot[0],br=Nt[1]/Ot[1],yr=(v.right-v.left)/2/jt,Ur=(v.bottom-v.top)/2/br,An=[(ut[0]+Ne[0])/2+yr,(ut[1]+Ne[1])/2+Ur],jn=Re.unproject(An),Qi=Re.zoom+Math.log2(Math.abs(Math.min(jt,br)));return{longitude:jn[0],latitude:jn[1],zoom:Math.min(Qi,l)}}var S2=function(e){(0,gr.Z)(i,e);function i(){var r,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=n.width,o=n.height,u=n.latitude,l=u===void 0?0:u,p=n.longitude,v=p===void 0?0:p,x=n.zoom,E=x===void 0?0:x,C=n.pitch,T=C===void 0?0:C,O=n.bearing,L=O===void 0?0:O,B=n.altitude,H=B===void 0?1.5:B,oe=n.nearZMultiplier,le=n.farZMultiplier;(0,xt.Z)(this,i),t=t||1,o=o||1;var Re=_2(E);H=Math.max(.75,H);var Ne=D0([v,l],Re);Ne[2]=0;var ut=n7({width:t,height:o,pitch:T,bearing:L,altitude:H,nearZMultiplier:oe||1/o,farZMultiplier:le||1.01}),Ot=t7({height:o,center:Ne,pitch:T,bearing:L,altitude:H,flipY:!0});return r=(0,Cr.Z)(this,(0,rt.Z)(i).call(this,{width:t,height:o,viewMatrix:Ot,projectionMatrix:ut})),r.latitude=l,r.longitude=v,r.zoom=E,r.pitch=T,r.bearing=L,r.altitude=H,r.scale=Re,r.center=Ne,r.pixelsPerMeter=x2((0,De.Z)((0,De.Z)(r))).pixelsPerMeter[2],Object.freeze((0,De.Z)((0,De.Z)(r))),r}return(0,wt.Z)(i,[{key:"projectFlat",value:function(n){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return D0(n,t)}},{key:"unprojectFlat",value:function(n){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return hg(n,t)}},{key:"getMapCenterByLngLatPosition",value:function(n){var t=n.lngLat,o=n.pos,u=b2(o,this.pixelUnprojectionMatrix),l=D0(t,this.scale),p=qr.add([],l,qr.negate([],u)),v=qr.add([],this.center,p);return hg(v,this.scale)}},{key:"getLocationAtPoint",value:function(n){var t=n.lngLat,o=n.pos;return this.getMapCenterByLngLatPosition({lngLat:t,pos:o})}},{key:"fitBounds",value:function(n){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=this.width,u=this.height,l=o7(Object.assign({width:o,height:u,bounds:n},t)),p=l.longitude,v=l.latitude,x=l.zoom;return new i({width:o,height:u,longitude:p,latitude:v,zoom:x})}}]),i}(a7),s7=function(){function e(){(0,xt.Z)(this,e)}return(0,wt.Z)(e,[{key:"syncWithMapCamera",value:function(r){var n=r.center,t=r.zoom,o=r.pitch,u=r.bearing,l=r.viewportHeight,p=r.viewportWidth;this.viewport=new S2({width:p,height:l,longitude:n&&n[0],latitude:n&&n[1],zoom:t,pitch:o,bearing:u})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}}]),e}(),u7=["id","attributionControl","style","token","rotation","mapInstance"],w2,C2;function l7(e){var i=c7();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function c7(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function f7(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var t=i.head||i.getElementsByTagName("head")[0];if(!t){t=i.createElement("head");var o=i.body||i.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(t,o):i.documentElement.appendChild(t)}var u=i.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(i.createTextNode(e)),t.appendChild(u),u}}f7(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=Mv();var h7=0,A2="101MlGsZ2AmmA&access_token=pk.eyJ1IjoiZXhhbXBsZXMiLCJhIjoiY2p0MG01MXRqMW45cjQzb2R6b2ptc3J4MSJ9.zA2W0IkI0c6KaAhJfk9bWg",p7=(w2=(0,Qr.b2)(),w2(C2=function(e){(0,gr.Z)(r,e);var i=l7(r);function r(){var n;(0,xt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,De.Z)(n),"version",hs.MAPBOX),n}return(0,wt.Z)(r,[{key:"getType",value:function(){return"mapbox"}},{key:"lngLatToCoord",value:function(t){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},u=this.lngLatToMercator(t,0),l=u.x,p=u.y;return[l-o.x,p-o.y]}},{key:"lngLatToMercator",value:function(t,o){var u=window.mapboxgl.MercatorCoordinate.fromLngLat(t,o),l=u.x,p=l===void 0?0:l,v=u.y,x=v===void 0?0:v,E=u.z,C=E===void 0?0:E;return{x:p,y:x,z:C}}},{key:"getModelMatrix",value:function(t,o,u){var l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],p=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},v=window.mapboxgl.MercatorCoordinate.fromLngLat(t,o),x=v.meterInMercatorCoordinateUnits(),E=Hr();return qi(E,E,to.fromValues(v.x-p.x,v.y-p.y,v.z||0-p.z)),Qn(E,E,to.fromValues(x*l[0],-x*l[1],x*l[2])),$a(E,E,u[0]),xo(E,E,u[1]),vo(E,E,u[2]),E}},{key:"init",value:function(){var n=(0,de.Z)(q().mark(function o(){var u=this,l,p,v,x,E,C,T,O,L,B,H,oe,le;return q().wrap(function(Ne){for(;;)switch(Ne.prev=Ne.next){case 0:l=this.config,p=l.id,v=p===void 0?"map":p,x=l.attributionControl,E=x===void 0?!1:x,C=l.style,T=C===void 0?"light":C,O=l.token,L=O===void 0?A2:O,B=l.rotation,H=B===void 0?0:B,oe=l.mapInstance,le=(0,Za.Z)(l,u7),this.viewport=new s7,!oe&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),L===A2&&T!=="blank"&&!window.mapboxgl.accessToken&&!oe&&console.warn(this.configService.getSceneWarninfo("MapToken")),!oe&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=L),oe?(this.map=oe,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(v),this.map=new window.mapboxgl.Map((0,z.Z)({container:this.$mapContainer,style:this.getMapStyleValue(T),attributionControl:E,bearing:H},le))),this.map.on("load",function(){u.handleCameraChanged()}),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return Ne.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"destroy",value:function(){var t,o;(t=this.$mapContainer)===null||t===void 0||(o=t.parentNode)===null||o===void 0||o.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var o,u=arguments.length,l=new Array(u>1?u-1:0),p=1;p<u;p++)l[p-1]=arguments[p];(o=this.eventEmitter).emit.apply(o,[t].concat(l))}},{key:"once",value:function(t){for(var o,u=arguments.length,l=new Array(u>1?u-1:0),p=1;p<u;p++)l[p-1]=arguments[p];(o=this.eventEmitter).once.apply(o,[t].concat(l))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(t,o){var u=new(Mv()).LngLat(t[0],t[1]),l=new(Mv()).LngLat(o[0],o[1]),p=u.distanceTo(l),v=Mv().MercatorCoordinate.fromLngLat({lng:t[0],lat:t[1]}),x=Mv().MercatorCoordinate.fromLngLat({lng:o[0],lat:o[1]}),E=v.x,C=v.y,T=x.x,O=x.y,L=Math.sqrt(Math.pow(E-T,2)+Math.pow(C-O,2))*4194304*2;return L/p}},{key:"exportMap",value:function(t){var o=this.map.getCanvas(),u=t==="jpg"?o==null?void 0:o.toDataURL("image/jpeg"):o==null?void 0:o.toDataURL("image/png");return u}},{key:"creatMapContainer",value:function(t){var o=t;typeof t=="string"&&(o=document.getElementById(t));var u=document.createElement("div");return u.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,u.id="l7_mapbox_div"+h7++,o.appendChild(u),u}}]),r}(QI))||C2);function d7(e){var i=v7();return function(){var n=(0,rt.Z)(e),t;if(i){var o=(0,rt.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Cr.Z)(this,t)}}function v7(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function m7(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var t=i.head||i.getElementsByTagName("head")[0];if(!t){t=i.createElement("head");var o=i.body||i.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(t,o):i.documentElement.appendChild(t)}var u=i.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(i.createTextNode(e)),t.appendChild(u),u}}m7(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var g7=function(e){(0,gr.Z)(r,e);var i=d7(r);function r(){return(0,xt.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getServiceConstructor",value:function(){return p7}}]),r}(XI);function T2(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function M2(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?T2(Object(r),!0).forEach(function(n){y7(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):T2(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function y7(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function _7(e,i){return S7(e)||E7(e,i)||b7(e,i)||x7()}function x7(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function b7(e,i){if(!!e){if(typeof e=="string")return k2(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return k2(e,i)}}function k2(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function E7(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],t=!0,o=!1,u,l;try{for(r=r.call(e);!(t=(u=r.next()).done)&&(n.push(u.value),!(i&&n.length===i));t=!0);}catch(p){o=!0,l=p}finally{try{!t&&r.return!=null&&r.return()}finally{if(o)throw l}}return n}}function S7(e){if(Array.isArray(e))return e}var w7=ne.memo(function(e){var i=e.style,r=e.className,n=e.map,t=e.option,o=e.onSceneLoaded,u=(0,ne.createRef)(),l=(0,ne.useState)(),p=_7(l,2),v=p[0],x=p[1];return(0,ne.useEffect)(function(){var E=new UI(M2(M2({id:u.current},t),{},{map:new g7(n)}));return E.on("loaded",function(){x(E),o&&o(E)}),function(){E.destroy()}},[]),(0,ne.useEffect)(function(){v&&n.style&&v.setMapStyle(n.style)},[JSON.stringify(n.style)]),(0,ne.useEffect)(function(){v&&n.zoom&&v.setZoom(n.zoom)},[n.zoom]),(0,ne.useEffect)(function(){v&&n.center&&v.setCenter(n.center)},[JSON.stringify(n.center)]),(0,ne.useEffect)(function(){v&&n.pitch!==void 0&&v.setPitch(n.pitch||0)},[n.pitch]),(0,ne.useEffect)(function(){v&&n.rotation&&v.setRotation(n.rotation)},[n.rotation]),ne.createElement(y.Provider,{value:v},(0,ne.createElement)("div",{ref:u,style:i,className:r},v&&e.children))}),C7=w7;function I2(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function nO(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?I2(Object(r),!0).forEach(function(n){A7(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):I2(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function A7(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function iO(e,i){return I7(e)||k7(e,i)||M7(e,i)||T7()}function T7(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function M7(e,i){if(!!e){if(typeof e=="string")return P2(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return P2(e,i)}}function P2(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function k7(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],t=!0,o=!1,u,l;try{for(r=r.call(e);!(t=(u=r.next()).done)&&(n.push(u.value),!(i&&n.length===i));t=!0);}catch(p){o=!0,l=p}finally{try{!t&&r.return!=null&&r.return()}finally{if(o)throw l}}return n}}function I7(e){if(Array.isArray(e))return e}var aO=null,oO=null;function R2(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function sO(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?R2(Object(r),!0).forEach(function(n){P7(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):R2(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function P7(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function uO(e,i){return D7(e)||L7(e,i)||O7(e,i)||R7()}function R7(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function O7(e,i){if(!!e){if(typeof e=="string")return O2(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return O2(e,i)}}function O2(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function L7(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],t=!0,o=!1,u,l;try{for(r=r.call(e);!(t=(u=r.next()).done)&&(n.push(u.value),!(i&&n.length===i));t=!0);}catch(p){o=!0,l=p}finally{try{!t&&r.return!=null&&r.return()}finally{if(o)throw l}}return n}}function D7(e){if(Array.isArray(e))return e}var lO=null,cO=null;function L2(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function fO(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?L2(Object(r),!0).forEach(function(n){F7(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):L2(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function F7(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function hO(e,i){return Z7(e)||z7(e,i)||N7(e,i)||B7()}function B7(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function N7(e,i){if(!!e){if(typeof e=="string")return D2(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return D2(e,i)}}function D2(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function z7(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],t=!0,o=!1,u,l;try{for(r=r.call(e);!(t=(u=r.next()).done)&&(n.push(u.value),!(i&&n.length===i));t=!0);}catch(p){o=!0,l=p}finally{try{!t&&r.return!=null&&r.return()}finally{if(o)throw l}}return n}}function Z7(e){if(Array.isArray(e))return e}var pO=null,dO=null;function vO(e,i){return G7(e)||j7(e,i)||V7(e,i)||U7()}function U7(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function V7(e,i){if(!!e){if(typeof e=="string")return F2(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return F2(e,i)}}function F2(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function j7(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],t=!0,o=!1,u,l;try{for(r=r.call(e);!(t=(u=r.next()).done)&&(n.push(u.value),!(i&&n.length===i));t=!0);}catch(p){o=!0,l=p}finally{try{!t&&r.return!=null&&r.return()}finally{if(o)throw l}}return n}}function G7(e){if(Array.isArray(e))return e}var mO=null,gO=null;function B2(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function yO(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?B2(Object(r),!0).forEach(function(n){H7(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):B2(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function H7(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function _O(e,i){if(e==null)return{};var r=W7(e,i),n,t;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)n=o[t],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function W7(e,i){if(e==null)return{};var r={},n=Object.keys(e),t,o;for(o=0;o<n.length;o++)t=n[o],!(i.indexOf(t)>=0)&&(r[t]=e[t]);return r}var xO={exportImage:TC,fullscreen:wC,geoLocate:IC,layer:U_,layerSwitch:U_,logo:F_,mapTheme:DC,mouseLocation:ZC,zoom:jC,scale:WC},bO=null,N2=K(73935);function z2(e,i){return q7(e)||Y7(e,i)||$7(e,i)||X7()}function X7(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $7(e,i){if(!!e){if(typeof e=="string")return Z2(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Z2(e,i)}}function Z2(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Y7(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],t=!0,o=!1,u,l;try{for(r=r.call(e);!(t=(u=r.next()).done)&&(n.push(u.value),!(i&&n.length===i));t=!0);}catch(p){o=!0,l=p}finally{try{!t&&r.return!=null&&r.return()}finally{if(o)throw l}}return n}}function q7(e){if(Array.isArray(e))return e}var U2=ne.useEffect,V2=ne.useState,K7=/\B([A-Z])/g,Q7=function(i){return i.replace(K7,"-$1").toLowerCase()};function EO(e){var i=e.className,r=e.style,n=e.children,t=e.position,o=V2(),u=z2(o,2),l=u[0],p=u[1],v=useSceneValue(),x=V2(function(){return document.createElement("div")}),E=z2(x,1),C=E[0];return U2(function(){var T=new Control({position:t});return T.onAdd=function(){if(i&&(C.className=i),r){var O=Object.keys(r).map(function(L){return"".concat(Q7(L),":").concat(r[L])}).join(";");C.style.cssText=O}return C},T.onRemove=function(){},p(T),v.addControl(T),function(){v.removeControl(T)}},[]),U2(function(){l&&l.setPosition(t||"bottomleft")},[t]),createPortal(n,C)}var j2=(0,ne.createContext)({});function SO(){return useContext(j2)}var J7=K(18446),Zf=K.n(J7),eP=ne.memo(function(i){var r=i.layer,n=i.active;return r.active(n.option),null},Zf()),tP=ne.memo(function(i){var r=i.layer,n=i.animate;return r.animate(n),null},Zf()),rP=ne.memo(function(i){var r=i.layer,n=i.color;return n.field?r.color(n.field,n.values):r.color(n.values),null},Zf()),nP=ne.memo(function(i){var r=i.layer,n=i.filter;return n.field&&r.filter(n.field,n.values),null},Zf()),iP=ne.memo(function(i){var r=i.layer,n=i.scale;return r.scale(n.values),null},Zf()),aP=ne.memo(function(i){var r=i.layer,n=i.select;return r.select(n.option),null},Zf()),oP=ne.memo(function(i){var r=i.layer,n=i.shape;return n.field?r.shape(n.field,n.values):r.shape(n.values),null},Zf()),sP=ne.memo(function(i){var r=i.layer,n=i.size;return n.field?r.size(n.field,n.values):r.size(n.values),null},Zf()),uP=["data"];function lP(e,i){if(e==null)return{};var r=cP(e,i),n,t;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)n=o[t],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function cP(e,i){if(e==null)return{};var r={},n=Object.keys(e),t,o;for(o=0;o<n.length;o++)t=n[o],!(i.indexOf(t)>=0)&&(r[t]=e[t]);return r}var fP=ne.memo(function(i){var r=i.layer,n=i.source,t=n.data,o=lP(n,uP);return r.inited?r.setData(t,o):r.source(t,o),o.autoFit&&r.fitBounds(o&&o.fitBoundsOptions),null},Zf()),wO=ne.useEffect,hP=ne.memo(function(i){var r=i.layer,n=i.style;return r.style(n),null},Zf());function pP(e,i){return gP(e)||mP(e,i)||vP(e,i)||dP()}function dP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function vP(e,i){if(!!e){if(typeof e=="string")return G2(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return G2(e,i)}}function G2(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function mP(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],t=!0,o=!1,u,l;try{for(r=r.call(e);!(t=(u=r.next()).done)&&(n.push(u.value),!(i&&n.length===i));t=!0);}catch(p){o=!0,l=p}finally{try{!t&&r.return!=null&&r.return()}finally{if(o)throw l}}return n}}function gP(e){if(Array.isArray(e))return e}var Iv=ne.useEffect,yP=ne.useState;function H2(e,i){var r=i.source,n=i.color,t=i.shape,o=i.style,u=i.size,l=i.scale,p=i.active,v=i.select,x=i.filter,E=i.animate,C=i.options,T=i.onLayerLoaded,O=Te(),L=yP(function(){var oe;switch(e){case"polygonLayer":oe=new Nm(C);break;case"lineLayer":oe=new Fm(C);break;case"pointLayer":oe=new c0(C);break;case"heatmapLayer":oe=new v3(C);break;case"rasterLayer":oe=new f0(C);break;case"imageLayer":oe=new d1(C);break;case"citybuildingLayer":oe=new zA(C);break;default:oe=new Nm(C)}return oe.on("inited",function(){T&&T(oe,O)}),oe}),B=pP(L,1),H=B[0];return Iv(function(){return O.addLayer(H),function(){O.removeLayer(H)}},[]),Iv(function(){H.inited&&C&&H.updateLayerConfig(C)},[C==null?void 0:C.minZoom,C==null?void 0:C.maxZoom,C==null?void 0:C.visible]),Iv(function(){H.inited&&(C==null?void 0:C.zIndex)&&H.setIndex(C.zIndex)},[C==null?void 0:C.zIndex]),Iv(function(){H.inited&&(C==null?void 0:C.blend)&&H.setBlend(C.blend)},[C==null?void 0:C.blend]),Iv(function(){O.render()}),ne.createElement(j2.Provider,{value:H},ne.createElement(fP,{layer:H,source:r}),l&&ne.createElement(iP,{layer:H,scale:l}),n&&ne.createElement(rP,{layer:H,color:n}),u&&ne.createElement(sP,{layer:H,size:u}),t&&ne.createElement(oP,{layer:H,shape:t}),o&&ne.createElement(hP,{layer:H,style:o}),p&&ne.createElement(eP,{layer:H,active:p}),v&&ne.createElement(aP,{layer:H,select:v}),x&&ne.createElement(nP,{layer:H,filter:x}),E&&ne.createElement(tP,{layer:H,animate:E}),i.children)}var CO=null,AO=null,_P=ne.memo(function(i){return H2("pointLayer",i)}),xP=ne.memo(function(i){return H2("heatmapLayer",i)}),TO=null,MO=null,kO=null,IO=ne.useEffect,PO=null,RO=null;function pg(e){return pg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},pg(e)}function W2(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function F0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?W2(Object(r),!0).forEach(function(n){bP(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):W2(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function bP(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function EP(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function X2(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function SP(e,i,r){return i&&X2(e.prototype,i),r&&X2(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function wP(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&dg(e,i)}function dg(e,i){return dg=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,t){return n.__proto__=t,n},dg(e,i)}function CP(e){var i=MP();return function(){var n=B0(e),t;if(i){var o=B0(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return AP(this,t)}}function AP(e,i){if(i&&(pg(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return TP(e)}function TP(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function MP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function B0(e){return B0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},B0(e)}var OO=function(e){wP(r,e);var i=CP(r);function r(n){var t;return EP(this,r),t=i.call(this,n),t.el=void 0,t.scene=void 0,t.popup=void 0,t.el=document.createElement("div"),t}return SP(r,[{key:"componentDidMount",value:function(){var t,o=this.props,u=o.lnglat,l=o.children,p=o.option,v=o.lngLat,x=new Tm(F0(F0({},p),{},{stopPropagation:(t=this.props.option)===null||t===void 0?void 0:t.stopPropagation}));u&&x.setLnglat(u),v&&x.setLnglat(v),l&&x.setHTML(this.el),this.popup=x,this.scene.addPopup(x)}},{key:"componentDidUpdate",value:function(t){var o,u,l,p,v,x,E=Array.isArray(t.lnglat)?t.lnglat:[t==null||(o=t.lnglat)===null||o===void 0?void 0:o.lng,t==null||(u=t.lnglat)===null||u===void 0?void 0:u.lat],C=Array.isArray(this.props.lnglat)?this.props.lnglat:[(l=this.props)===null||l===void 0||(p=l.lnglat)===null||p===void 0?void 0:p.lng,(v=this.props)===null||v===void 0||(x=v.lnglat)===null||x===void 0?void 0:x.lat],T=E.toString()!==C.toString();if(T){var O;this.popup.remove(),this.popup=new Tm(F0(F0({},this.props.option),{},{stopPropagation:(O=this.props.option)===null||O===void 0?void 0:O.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setHTML(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var t=this;return ne.createElement(y.Consumer,{},function(o){return o&&(t.scene=o),(0,N2.createPortal)(t.props.children,t.el)})}}]),r}(ne.PureComponent);function vg(e){return vg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},vg(e)}function kP(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function $2(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function IP(e,i,r){return i&&$2(e.prototype,i),r&&$2(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function PP(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&mg(e,i)}function mg(e,i){return mg=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,t){return n.__proto__=t,n},mg(e,i)}function RP(e){var i=DP();return function(){var n=N0(e),t;if(i){var o=N0(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return OP(this,t)}}function OP(e,i){if(i&&(vg(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return LP(e)}function LP(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function DP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function N0(e){return N0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},N0(e)}var LO=function(e){PP(r,e);var i=RP(r);function r(n){var t;return kP(this,r),t=i.call(this,n),t.el=void 0,t.scene=void 0,t.marker=void 0,t.el=document.createElement("div"),t}return IP(r,[{key:"componentDidMount",value:function(){var t=this.props,o=t.lnglat,u=t.children,l=t.option,p=t.onMarkerLoaded,v=new O_(l);o&&v.setLnglat(o),u&&v.setElement(this.el),this.marker=v,p&&p(v),this.scene.addMarker(v)}},{key:"componentDidUpdate",value:function(t){var o,u=JSON.stringify(t==null?void 0:t.lnglat)!==JSON.stringify((o=this.props)===null||o===void 0?void 0:o.lnglat);u&&this.props.lnglat&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var t=this;return ne.createElement(y.Consumer,{},function(o){return o&&(t.scene=o),(0,N2.createPortal)(t.props.children,t.el)})}}]),r}(ne.PureComponent),DO=ne.useEffect,FO=null,BO=null,NO=ne.useEffect,zO=null},59591:function(Br,pe,K){var Ee=K(50008).default;function ne(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Br.exports=ne=function(){return y},Br.exports.__esModule=!0,Br.exports.default=Br.exports;var y={},Te=Object.prototype,W=Te.hasOwnProperty,ye=Object.defineProperty||function(N,z,ce){N[z]=ce.value},se=typeof Symbol=="function"?Symbol:{},Ye=se.iterator||"@@iterator",_e=se.asyncIterator||"@@asyncIterator",Qe=se.toStringTag||"@@toStringTag";function lt(N,z,ce){return Object.defineProperty(N,z,{value:ce,enumerable:!0,configurable:!0,writable:!0}),N[z]}try{lt({},"")}catch(N){lt=function(ce,ze,et){return ce[ze]=et}}function bt(N,z,ce,ze){var et=z&&z.prototype instanceof Mt?z:Mt,ht=Object.create(et.prototype),Rt=new wr(ze||[]);return ye(ht,"_invoke",{value:ft(N,ce,Rt)}),ht}function gt(N,z,ce){try{return{type:"normal",arg:N.call(z,ce)}}catch(ze){return{type:"throw",arg:ze}}}y.wrap=bt;var ur={};function Mt(){}function qt(){}function zt(){}var yt={};lt(yt,Ye,function(){return this});var At=Object.getPrototypeOf,ar=At&&At(At(re([])));ar&&ar!==Te&&W.call(ar,Ye)&&(yt=ar);var J=zt.prototype=Mt.prototype=Object.create(yt);function Qt(N){["next","throw","return"].forEach(function(z){lt(N,z,function(ce){return this._invoke(z,ce)})})}function Ct(N,z){function ce(et,ht,Rt,Jt){var Or=gt(N[et],N,ht);if(Or.type!=="throw"){var Tr=Or.arg,Pn=Tr.value;return Pn&&Ee(Pn)=="object"&&W.call(Pn,"__await")?z.resolve(Pn.__await).then(function(Nr){ce("next",Nr,Rt,Jt)},function(Nr){ce("throw",Nr,Rt,Jt)}):z.resolve(Pn).then(function(Nr){Tr.value=Nr,Rt(Tr)},function(Nr){return ce("throw",Nr,Rt,Jt)})}Jt(Or.arg)}var ze;ye(this,"_invoke",{value:function(ht,Rt){function Jt(){return new z(function(Or,Tr){ce(ht,Rt,Or,Tr)})}return ze=ze?ze.then(Jt,Jt):Jt()}})}function ft(N,z,ce){var ze="suspendedStart";return function(et,ht){if(ze==="executing")throw new Error("Generator is already running");if(ze==="completed"){if(et==="throw")throw ht;return Fe()}for(ce.method=et,ce.arg=ht;;){var Rt=ce.delegate;if(Rt){var Jt=Ut(Rt,ce);if(Jt){if(Jt===ur)continue;return Jt}}if(ce.method==="next")ce.sent=ce._sent=ce.arg;else if(ce.method==="throw"){if(ze==="suspendedStart")throw ze="completed",ce.arg;ce.dispatchException(ce.arg)}else ce.method==="return"&&ce.abrupt("return",ce.arg);ze="executing";var Or=gt(N,z,ce);if(Or.type==="normal"){if(ze=ce.done?"completed":"suspendedYield",Or.arg===ur)continue;return{value:Or.arg,done:ce.done}}Or.type==="throw"&&(ze="completed",ce.method="throw",ce.arg=Or.arg)}}}function Ut(N,z){var ce=N.iterator[z.method];if(ce===void 0){if(z.delegate=null,z.method==="throw"){if(N.iterator.return&&(z.method="return",z.arg=void 0,Ut(N,z),z.method==="throw"))return ur;z.method="throw",z.arg=new TypeError("The iterator does not provide a 'throw' method")}return ur}var ze=gt(ce,N.iterator,z.arg);if(ze.type==="throw")return z.method="throw",z.arg=ze.arg,z.delegate=null,ur;var et=ze.arg;return et?et.done?(z[N.resultName]=et.value,z.next=N.nextLoc,z.method!=="return"&&(z.method="next",z.arg=void 0),z.delegate=null,ur):et:(z.method="throw",z.arg=new TypeError("iterator result is not an object"),z.delegate=null,ur)}function dt(N){var z={tryLoc:N[0]};1 in N&&(z.catchLoc=N[1]),2 in N&&(z.finallyLoc=N[2],z.afterLoc=N[3]),this.tryEntries.push(z)}function rr(N){var z=N.completion||{};z.type="normal",delete z.arg,N.completion=z}function wr(N){this.tryEntries=[{tryLoc:"root"}],N.forEach(dt,this),this.reset(!0)}function re(N){if(N){var z=N[Ye];if(z)return z.call(N);if(typeof N.next=="function")return N;if(!isNaN(N.length)){var ce=-1,ze=function et(){for(;++ce<N.length;)if(W.call(N,ce))return et.value=N[ce],et.done=!1,et;return et.value=void 0,et.done=!0,et};return ze.next=ze}}return{next:Fe}}function Fe(){return{value:void 0,done:!0}}return qt.prototype=zt,ye(J,"constructor",{value:zt,configurable:!0}),ye(zt,"constructor",{value:qt,configurable:!0}),qt.displayName=lt(zt,Qe,"GeneratorFunction"),y.isGeneratorFunction=function(N){var z=typeof N=="function"&&N.constructor;return!!z&&(z===qt||(z.displayName||z.name)==="GeneratorFunction")},y.mark=function(N){return Object.setPrototypeOf?Object.setPrototypeOf(N,zt):(N.__proto__=zt,lt(N,Qe,"GeneratorFunction")),N.prototype=Object.create(J),N},y.awrap=function(N){return{__await:N}},Qt(Ct.prototype),lt(Ct.prototype,_e,function(){return this}),y.AsyncIterator=Ct,y.async=function(N,z,ce,ze,et){et===void 0&&(et=Promise);var ht=new Ct(bt(N,z,ce,ze),et);return y.isGeneratorFunction(z)?ht:ht.next().then(function(Rt){return Rt.done?Rt.value:ht.next()})},Qt(J),lt(J,Qe,"Generator"),lt(J,Ye,function(){return this}),lt(J,"toString",function(){return"[object Generator]"}),y.keys=function(N){var z=Object(N),ce=[];for(var ze in z)ce.push(ze);return ce.reverse(),function et(){for(;ce.length;){var ht=ce.pop();if(ht in z)return et.value=ht,et.done=!1,et}return et.done=!0,et}},y.values=re,wr.prototype={constructor:wr,reset:function(z){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(rr),!z)for(var ce in this)ce.charAt(0)==="t"&&W.call(this,ce)&&!isNaN(+ce.slice(1))&&(this[ce]=void 0)},stop:function(){this.done=!0;var z=this.tryEntries[0].completion;if(z.type==="throw")throw z.arg;return this.rval},dispatchException:function(z){if(this.done)throw z;var ce=this;function ze(Tr,Pn){return Rt.type="throw",Rt.arg=z,ce.next=Tr,Pn&&(ce.method="next",ce.arg=void 0),!!Pn}for(var et=this.tryEntries.length-1;et>=0;--et){var ht=this.tryEntries[et],Rt=ht.completion;if(ht.tryLoc==="root")return ze("end");if(ht.tryLoc<=this.prev){var Jt=W.call(ht,"catchLoc"),Or=W.call(ht,"finallyLoc");if(Jt&&Or){if(this.prev<ht.catchLoc)return ze(ht.catchLoc,!0);if(this.prev<ht.finallyLoc)return ze(ht.finallyLoc)}else if(Jt){if(this.prev<ht.catchLoc)return ze(ht.catchLoc,!0)}else{if(!Or)throw new Error("try statement without catch or finally");if(this.prev<ht.finallyLoc)return ze(ht.finallyLoc)}}}},abrupt:function(z,ce){for(var ze=this.tryEntries.length-1;ze>=0;--ze){var et=this.tryEntries[ze];if(et.tryLoc<=this.prev&&W.call(et,"finallyLoc")&&this.prev<et.finallyLoc){var ht=et;break}}ht&&(z==="break"||z==="continue")&&ht.tryLoc<=ce&&ce<=ht.finallyLoc&&(ht=null);var Rt=ht?ht.completion:{};return Rt.type=z,Rt.arg=ce,ht?(this.method="next",this.next=ht.finallyLoc,ur):this.complete(Rt)},complete:function(z,ce){if(z.type==="throw")throw z.arg;return z.type==="break"||z.type==="continue"?this.next=z.arg:z.type==="return"?(this.rval=this.arg=z.arg,this.method="return",this.next="end"):z.type==="normal"&&ce&&(this.next=ce),ur},finish:function(z){for(var ce=this.tryEntries.length-1;ce>=0;--ce){var ze=this.tryEntries[ce];if(ze.finallyLoc===z)return this.complete(ze.completion,ze.afterLoc),rr(ze),ur}},catch:function(z){for(var ce=this.tryEntries.length-1;ce>=0;--ce){var ze=this.tryEntries[ce];if(ze.tryLoc===z){var et=ze.completion;if(et.type==="throw"){var ht=et.arg;rr(ze)}return ht}}throw new Error("illegal catch attempt")},delegateYield:function(z,ce,ze){return this.delegate={iterator:re(z),resultName:ce,nextLoc:ze},this.method==="next"&&(this.arg=void 0),ur}},y}Br.exports=ne,Br.exports.__esModule=!0,Br.exports.default=Br.exports},87757:function(Br,pe,K){var Ee=K(59591)();Br.exports=Ee;try{regeneratorRuntime=Ee}catch(ne){typeof globalThis=="object"?globalThis.regeneratorRuntime=Ee:Function("r","regeneratorRuntime = r")(Ee)}},38163:function(Br){Br.exports=pe;function pe(ne,y){var Te=ne&&ne.type,W;if(Te==="FeatureCollection")for(W=0;W<ne.features.length;W++)pe(ne.features[W],y);else if(Te==="GeometryCollection")for(W=0;W<ne.geometries.length;W++)pe(ne.geometries[W],y);else if(Te==="Feature")pe(ne.geometry,y);else if(Te==="Polygon")K(ne.coordinates,y);else if(Te==="MultiPolygon")for(W=0;W<ne.coordinates.length;W++)K(ne.coordinates[W],y);return ne}function K(ne,y){if(ne.length!==0){Ee(ne[0],y);for(var Te=1;Te<ne.length;Te++)Ee(ne[Te],!y)}}function Ee(ne,y){for(var Te=0,W=0,ye=0,se=ne.length,Ye=se-1;ye<se;Ye=ye++){var _e=(ne[ye][0]-ne[Ye][0])*(ne[Ye][1]+ne[ye][1]),Qe=Te+_e;W+=Math.abs(Te)>=Math.abs(_e)?Te-Qe+_e:_e-Qe+Te,Te=Qe}Te+W>=0!=!!y&&ne.reverse()}},75550:function(Br){"use strict";Br.exports=pe;function pe(K,Ee){this.x=K,this.y=Ee}pe.prototype={clone:function(){return new pe(this.x,this.y)},add:function(K){return this.clone()._add(K)},sub:function(K){return this.clone()._sub(K)},multByPoint:function(K){return this.clone()._multByPoint(K)},divByPoint:function(K){return this.clone()._divByPoint(K)},mult:function(K){return this.clone()._mult(K)},div:function(K){return this.clone()._div(K)},rotate:function(K){return this.clone()._rotate(K)},rotateAround:function(K,Ee){return this.clone()._rotateAround(K,Ee)},matMult:function(K){return this.clone()._matMult(K)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(K){return this.x===K.x&&this.y===K.y},dist:function(K){return Math.sqrt(this.distSqr(K))},distSqr:function(K){var Ee=K.x-this.x,ne=K.y-this.y;return Ee*Ee+ne*ne},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(K){return Math.atan2(this.y-K.y,this.x-K.x)},angleWith:function(K){return this.angleWithSep(K.x,K.y)},angleWithSep:function(K,Ee){return Math.atan2(this.x*Ee-this.y*K,this.x*K+this.y*Ee)},_matMult:function(K){var Ee=K[0]*this.x+K[1]*this.y,ne=K[2]*this.x+K[3]*this.y;return this.x=Ee,this.y=ne,this},_add:function(K){return this.x+=K.x,this.y+=K.y,this},_sub:function(K){return this.x-=K.x,this.y-=K.y,this},_mult:function(K){return this.x*=K,this.y*=K,this},_div:function(K){return this.x/=K,this.y/=K,this},_multByPoint:function(K){return this.x*=K.x,this.y*=K.y,this},_divByPoint:function(K){return this.x/=K.x,this.y/=K.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var K=this.y;return this.y=this.x,this.x=-K,this},_rotate:function(K){var Ee=Math.cos(K),ne=Math.sin(K),y=Ee*this.x-ne*this.y,Te=ne*this.x+Ee*this.y;return this.x=y,this.y=Te,this},_rotateAround:function(K,Ee){var ne=Math.cos(K),y=Math.sin(K),Te=Ee.x+ne*(this.x-Ee.x)-y*(this.y-Ee.y),W=Ee.y+y*(this.x-Ee.x)+ne*(this.y-Ee.y);return this.x=Te,this.y=W,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},pe.convert=function(K){return K instanceof pe?K:Array.isArray(K)?new pe(K[0],K[1]):K}},38929:function(Br,pe,K){Br.exports.VectorTile=K(22779),K(66024),K(59701)},22779:function(Br,pe,K){"use strict";var Ee=K(59701);Br.exports=ne;function ne(Te,W){this.layers=Te.readFields(y,{},W)}function y(Te,W,ye){if(Te===3){var se=new Ee(ye,ye.readVarint()+ye.pos);se.length&&(W[se.name]=se)}}},66024:function(Br,pe,K){"use strict";var Ee=K(75550);Br.exports=ne;function ne(se,Ye,_e,Qe,lt){this.properties={},this.extent=_e,this.type=0,this._pbf=se,this._geometry=-1,this._keys=Qe,this._values=lt,se.readFields(y,this,Ye)}function y(se,Ye,_e){se==1?Ye.id=_e.readVarint():se==2?Te(_e,Ye):se==3?Ye.type=_e.readVarint():se==4&&(Ye._geometry=_e.pos)}function Te(se,Ye){for(var _e=se.readVarint()+se.pos;se.pos<_e;){var Qe=Ye._keys[se.readVarint()],lt=Ye._values[se.readVarint()];Ye.properties[Qe]=lt}}ne.types=["Unknown","Point","LineString","Polygon"],ne.prototype.loadGeometry=function(){var se=this._pbf;se.pos=this._geometry;for(var Ye=se.readVarint()+se.pos,_e=1,Qe=0,lt=0,bt=0,gt=[],ur;se.pos<Ye;){if(Qe<=0){var Mt=se.readVarint();_e=Mt&7,Qe=Mt>>3}if(Qe--,_e===1||_e===2)lt+=se.readSVarint(),bt+=se.readSVarint(),_e===1&&(ur&&gt.push(ur),ur=[]),ur.push(new Ee(lt,bt));else if(_e===7)ur&&ur.push(ur[0].clone());else throw new Error("unknown command "+_e)}return ur&&gt.push(ur),gt},ne.prototype.bbox=function(){var se=this._pbf;se.pos=this._geometry;for(var Ye=se.readVarint()+se.pos,_e=1,Qe=0,lt=0,bt=0,gt=Infinity,ur=-Infinity,Mt=Infinity,qt=-Infinity;se.pos<Ye;){if(Qe<=0){var zt=se.readVarint();_e=zt&7,Qe=zt>>3}if(Qe--,_e===1||_e===2)lt+=se.readSVarint(),bt+=se.readSVarint(),lt<gt&&(gt=lt),lt>ur&&(ur=lt),bt<Mt&&(Mt=bt),bt>qt&&(qt=bt);else if(_e!==7)throw new Error("unknown command "+_e)}return[gt,Mt,ur,qt]},ne.prototype.toGeoJSON=function(se,Ye,_e){var Qe=this.extent*Math.pow(2,_e),lt=this.extent*se,bt=this.extent*Ye,gt=this.loadGeometry(),ur=ne.types[this.type],Mt,qt;function zt(ar){for(var J=0;J<ar.length;J++){var Qt=ar[J],Ct=180-(Qt.y+bt)*360/Qe;ar[J]=[(Qt.x+lt)*360/Qe-180,360/Math.PI*Math.atan(Math.exp(Ct*Math.PI/180))-90]}}switch(this.type){case 1:var yt=[];for(Mt=0;Mt<gt.length;Mt++)yt[Mt]=gt[Mt][0];gt=yt,zt(gt);break;case 2:for(Mt=0;Mt<gt.length;Mt++)zt(gt[Mt]);break;case 3:for(gt=W(gt),Mt=0;Mt<gt.length;Mt++)for(qt=0;qt<gt[Mt].length;qt++)zt(gt[Mt][qt]);break}gt.length===1?gt=gt[0]:ur="Multi"+ur;var At={type:"Feature",geometry:{type:ur,coordinates:gt},properties:this.properties};return"id"in this&&(At.id=this.id),At};function W(se){var Ye=se.length;if(Ye<=1)return[se];for(var _e=[],Qe,lt,bt=0;bt<Ye;bt++){var gt=ye(se[bt]);gt!==0&&(lt===void 0&&(lt=gt<0),lt===gt<0?(Qe&&_e.push(Qe),Qe=[se[bt]]):Qe.push(se[bt]))}return Qe&&_e.push(Qe),_e}function ye(se){for(var Ye=0,_e=0,Qe=se.length,lt=Qe-1,bt,gt;_e<Qe;lt=_e++)bt=se[_e],gt=se[lt],Ye+=(gt.x-bt.x)*(bt.y+gt.y);return Ye}},59701:function(Br,pe,K){"use strict";var Ee=K(66024);Br.exports=ne;function ne(W,ye){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=W,this._keys=[],this._values=[],this._features=[],W.readFields(y,this,ye),this.length=this._features.length}function y(W,ye,se){W===15?ye.version=se.readVarint():W===1?ye.name=se.readString():W===5?ye.extent=se.readVarint():W===2?ye._features.push(se.pos):W===3?ye._keys.push(se.readString()):W===4&&ye._values.push(Te(se))}function Te(W){for(var ye=null,se=W.readVarint()+W.pos;W.pos<se;){var Ye=W.readVarint()>>3;ye=Ye===1?W.readString():Ye===2?W.readFloat():Ye===3?W.readDouble():Ye===4?W.readVarint64():Ye===5?W.readVarint():Ye===6?W.readSVarint():Ye===7?W.readBoolean():null}return ye}ne.prototype.feature=function(W){if(W<0||W>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[W];var ye=this._pbf.readVarint()+this._pbf.pos;return new Ee(this._pbf,ye,this.extent,this._keys,this._values)}},80638:function(){},81903:function(){},15746:function(Br,pe,K){"use strict";var Ee=K(21584);pe.Z=Ee.Z},89032:function(Br,pe,K){"use strict";var Ee=K(38663),ne=K.n(Ee),y=K(6999)},99134:function(Br,pe,K){"use strict";var Ee=K(67294),ne=(0,Ee.createContext)({});pe.Z=ne},21584:function(Br,pe,K){"use strict";var Ee=K(96156),ne=K(22122),y=K(90484),Te=K(94184),W=K.n(Te),ye=K(67294),se=K(53124),Ye=K(99134),_e=function(gt,ur){var Mt={};for(var qt in gt)Object.prototype.hasOwnProperty.call(gt,qt)&&ur.indexOf(qt)<0&&(Mt[qt]=gt[qt]);if(gt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var zt=0,qt=Object.getOwnPropertySymbols(gt);zt<qt.length;zt++)ur.indexOf(qt[zt])<0&&Object.prototype.propertyIsEnumerable.call(gt,qt[zt])&&(Mt[qt[zt]]=gt[qt[zt]]);return Mt};function Qe(gt){return typeof gt=="number"?"".concat(gt," ").concat(gt," auto"):/^\d+(\.\d+)?(px|em|rem|%)$/.test(gt)?"0 0 ".concat(gt):gt}var lt=["xs","sm","md","lg","xl","xxl"],bt=ye.forwardRef(function(gt,ur){var Mt,qt=ye.useContext(se.E_),zt=qt.getPrefixCls,yt=qt.direction,At=ye.useContext(Ye.Z),ar=At.gutter,J=At.wrap,Qt=At.supportFlexGap,Ct=gt.prefixCls,ft=gt.span,Ut=gt.order,dt=gt.offset,rr=gt.push,wr=gt.pull,re=gt.className,Fe=gt.children,N=gt.flex,z=gt.style,ce=_e(gt,["prefixCls","span","order","offset","push","pull","className","children","flex","style"]),ze=zt("col",Ct),et={};lt.forEach(function(Tr){var Pn,Nr={},wn=gt[Tr];typeof wn=="number"?Nr.span=wn:(0,y.Z)(wn)==="object"&&(Nr=wn||{}),delete ce[Tr],et=(0,ne.Z)((0,ne.Z)({},et),(Pn={},(0,Ee.Z)(Pn,"".concat(ze,"-").concat(Tr,"-").concat(Nr.span),Nr.span!==void 0),(0,Ee.Z)(Pn,"".concat(ze,"-").concat(Tr,"-order-").concat(Nr.order),Nr.order||Nr.order===0),(0,Ee.Z)(Pn,"".concat(ze,"-").concat(Tr,"-offset-").concat(Nr.offset),Nr.offset||Nr.offset===0),(0,Ee.Z)(Pn,"".concat(ze,"-").concat(Tr,"-push-").concat(Nr.push),Nr.push||Nr.push===0),(0,Ee.Z)(Pn,"".concat(ze,"-").concat(Tr,"-pull-").concat(Nr.pull),Nr.pull||Nr.pull===0),(0,Ee.Z)(Pn,"".concat(ze,"-rtl"),yt==="rtl"),Pn))});var ht=W()(ze,(Mt={},(0,Ee.Z)(Mt,"".concat(ze,"-").concat(ft),ft!==void 0),(0,Ee.Z)(Mt,"".concat(ze,"-order-").concat(Ut),Ut),(0,Ee.Z)(Mt,"".concat(ze,"-offset-").concat(dt),dt),(0,Ee.Z)(Mt,"".concat(ze,"-push-").concat(rr),rr),(0,Ee.Z)(Mt,"".concat(ze,"-pull-").concat(wr),wr),Mt),re,et),Rt={};if(ar&&ar[0]>0){var Jt=ar[0]/2;Rt.paddingLeft=Jt,Rt.paddingRight=Jt}if(ar&&ar[1]>0&&!Qt){var Or=ar[1]/2;Rt.paddingTop=Or,Rt.paddingBottom=Or}return N&&(Rt.flex=Qe(N),J===!1&&!Rt.minWidth&&(Rt.minWidth=0)),ye.createElement("div",(0,ne.Z)({},ce,{style:(0,ne.Z)((0,ne.Z)({},Rt),z),className:ht,ref:ur}),Fe)});pe.Z=bt},92820:function(Br,pe,K){"use strict";var Ee=K(22122),ne=K(96156),y=K(90484),Te=K(28481),W=K(94184),ye=K.n(W),se=K(67294),Ye=K(53124),_e=K(98082),Qe=K(24308),lt=K(93355),bt=K(99134),gt=function(yt,At){var ar={};for(var J in yt)Object.prototype.hasOwnProperty.call(yt,J)&&At.indexOf(J)<0&&(ar[J]=yt[J]);if(yt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Qt=0,J=Object.getOwnPropertySymbols(yt);Qt<J.length;Qt++)At.indexOf(J[Qt])<0&&Object.prototype.propertyIsEnumerable.call(yt,J[Qt])&&(ar[J[Qt]]=yt[J[Qt]]);return ar},ur=(0,lt.b)("top","middle","bottom","stretch"),Mt=(0,lt.b)("start","end","center","space-around","space-between","space-evenly");function qt(yt,At){var ar=se.useState(typeof yt=="string"?yt:""),J=(0,Te.Z)(ar,2),Qt=J[0],Ct=J[1],ft=function(){if((0,y.Z)(yt)==="object")for(var dt=0;dt<Qe.c4.length;dt++){var rr=Qe.c4[dt];if(!!At[rr]){var wr=yt[rr];if(wr!==void 0){Ct(wr);return}}}};return se.useEffect(function(){ft()},[JSON.stringify(yt),At]),Qt}var zt=se.forwardRef(function(yt,At){var ar,J=yt.prefixCls,Qt=yt.justify,Ct=yt.align,ft=yt.className,Ut=yt.style,dt=yt.children,rr=yt.gutter,wr=rr===void 0?0:rr,re=yt.wrap,Fe=gt(yt,["prefixCls","justify","align","className","style","children","gutter","wrap"]),N=se.useContext(Ye.E_),z=N.getPrefixCls,ce=N.direction,ze=se.useState({xs:!0,sm:!0,md:!0,lg:!0,xl:!0,xxl:!0}),et=(0,Te.Z)(ze,2),ht=et[0],Rt=et[1],Jt=se.useState({xs:!1,sm:!1,md:!1,lg:!1,xl:!1,xxl:!1}),Or=(0,Te.Z)(Jt,2),Tr=Or[0],Pn=Or[1],Nr=qt(Ct,Tr),wn=qt(Qt,Tr),Xi=(0,_e.Z)(),mi=se.useRef(wr);se.useEffect(function(){var we=Qe.ZP.subscribe(function(Z){Pn(Z);var Je=mi.current||0;(!Array.isArray(Je)&&(0,y.Z)(Je)==="object"||Array.isArray(Je)&&((0,y.Z)(Je[0])==="object"||(0,y.Z)(Je[1])==="object"))&&Rt(Z)});return function(){return Qe.ZP.unsubscribe(we)}},[]);var si=function(){var Z=[void 0,void 0],Je=Array.isArray(wr)?wr:[wr,void 0];return Je.forEach(function(Xt,Dr){if((0,y.Z)(Xt)==="object")for(var tt=0;tt<Qe.c4.length;tt++){var It=Qe.c4[tt];if(ht[It]&&Xt[It]!==void 0){Z[Dr]=Xt[It];break}}else Z[Dr]=Xt}),Z},ki=z("row",J),bi=si(),li=ye()(ki,(ar={},(0,ne.Z)(ar,"".concat(ki,"-no-wrap"),re===!1),(0,ne.Z)(ar,"".concat(ki,"-").concat(wn),wn),(0,ne.Z)(ar,"".concat(ki,"-").concat(Nr),Nr),(0,ne.Z)(ar,"".concat(ki,"-rtl"),ce==="rtl"),ar),ft),Zn={},qn=bi[0]!=null&&bi[0]>0?bi[0]/-2:void 0,ro=bi[1]!=null&&bi[1]>0?bi[1]/-2:void 0;if(qn&&(Zn.marginLeft=qn,Zn.marginRight=qn),Xi){var ka=(0,Te.Z)(bi,2);Zn.rowGap=ka[1]}else ro&&(Zn.marginTop=ro,Zn.marginBottom=ro);var oa=(0,Te.Z)(bi,2),Tt=oa[0],ge=oa[1],ue=se.useMemo(function(){return{gutter:[Tt,ge],wrap:re,supportFlexGap:Xi}},[Tt,ge,re,Xi]);return se.createElement(bt.Z.Provider,{value:ue},se.createElement("div",(0,Ee.Z)({},Fe,{className:li,style:(0,Ee.Z)((0,Ee.Z)({},Zn),Ut),ref:At}),dt))});pe.Z=zt},6999:function(Br,pe,K){"use strict";var Ee=K(38663),ne=K.n(Ee),y=K(80638),Te=K.n(y)},71230:function(Br,pe,K){"use strict";var Ee=K(92820);pe.Z=Ee.Z},13062:function(Br,pe,K){"use strict";var Ee=K(38663),ne=K.n(Ee),y=K(6999)},7277:function(Br,pe,K){"use strict";K.d(pe,{Z:function(){return rr}});var Ee=K(22122),ne=K(67294),y=K(57838),Te=K(96159),W=K(96156),ye=K(94184),se=K.n(ye),Ye=K(53124),_e=K(19586),Qe=K(11726),lt=K.n(Qe),bt=function(re){var Fe=re.value,N=re.formatter,z=re.precision,ce=re.decimalSeparator,ze=re.groupSeparator,et=ze===void 0?"":ze,ht=re.prefixCls,Rt;if(typeof N=="function")Rt=N(Fe);else{var Jt=String(Fe),Or=Jt.match(/^(-?)(\d*)(\.(\d+))?$/);if(!Or||Jt==="-")Rt=Jt;else{var Tr=Or[1],Pn=Or[2]||"0",Nr=Or[4]||"";Pn=Pn.replace(/\B(?=(\d{3})+(?!\d))/g,et),typeof z=="number"&&(Nr=lt()(Nr,z,"0").slice(0,z>0?z:0)),Nr&&(Nr="".concat(ce).concat(Nr)),Rt=[ne.createElement("span",{key:"int",className:"".concat(ht,"-content-value-int")},Tr,Pn),Nr&&ne.createElement("span",{key:"decimal",className:"".concat(ht,"-content-value-decimal")},Nr)]}}return ne.createElement("span",{className:"".concat(ht,"-content-value")},Rt)},gt=bt,ur=function(re){var Fe=re.prefixCls,N=re.className,z=re.style,ce=re.valueStyle,ze=re.value,et=ze===void 0?0:ze,ht=re.title,Rt=re.valueRender,Jt=re.prefix,Or=re.suffix,Tr=re.loading,Pn=Tr===void 0?!1:Tr,Nr=re.direction,wn=re.onMouseEnter,Xi=re.onMouseLeave,mi=re.decimalSeparator,si=mi===void 0?".":mi,ki=re.groupSeparator,bi=ki===void 0?",":ki,li=ne.createElement(gt,(0,Ee.Z)({decimalSeparator:si,groupSeparator:bi},re,{value:et})),Zn=se()(Fe,(0,W.Z)({},"".concat(Fe,"-rtl"),Nr==="rtl"),N);return ne.createElement("div",{className:Zn,style:z,onMouseEnter:wn,onMouseLeave:Xi},ht&&ne.createElement("div",{className:"".concat(Fe,"-title")},ht),ne.createElement(_e.Z,{paragraph:!1,loading:Pn,className:"".concat(Fe,"-skeleton")},ne.createElement("div",{style:ce,className:"".concat(Fe,"-content")},Jt&&ne.createElement("span",{className:"".concat(Fe,"-content-prefix")},Jt),Rt?Rt(li):li,Or&&ne.createElement("span",{className:"".concat(Fe,"-content-suffix")},Or))))},Mt=(0,Ye.PG)({prefixCls:"statistic"})(ur),qt=Mt,zt=K(28481),yt=K(32475),At=K.n(yt),ar=[["Y",1e3*60*60*24*365],["M",1e3*60*60*24*30],["D",1e3*60*60*24],["H",1e3*60*60],["m",1e3*60],["s",1e3],["S",1]];function J(wr,re){var Fe=wr,N=/\[[^\]]*]/g,z=(re.match(N)||[]).map(function(ht){return ht.slice(1,-1)}),ce=re.replace(N,"[]"),ze=ar.reduce(function(ht,Rt){var Jt=(0,zt.Z)(Rt,2),Or=Jt[0],Tr=Jt[1];if(ht.includes(Or)){var Pn=Math.floor(Fe/Tr);return Fe-=Pn*Tr,ht.replace(new RegExp("".concat(Or,"+"),"g"),function(Nr){var wn=Nr.length;return At()(Pn.toString(),wn,"0")})}return ht},ce),et=0;return ze.replace(N,function(){var ht=z[et];return et+=1,ht})}function Qt(wr,re){var Fe=re.format,N=Fe===void 0?"":Fe,z=new Date(wr).getTime(),ce=Date.now(),ze=Math.max(z-ce,0);return J(ze,N)}var Ct=1e3/30;function ft(wr){return new Date(wr).getTime()}var Ut=function(re){var Fe=re.value,N=re.format,z=N===void 0?"HH:mm:ss":N,ce=re.onChange,ze=re.onFinish,et=(0,y.Z)(),ht=ne.useRef(null),Rt=function(){ze==null||ze(),ht.current&&(clearInterval(ht.current),ht.current=null)},Jt=function(){var Nr=ft(Fe);Nr>=Date.now()&&(ht.current=setInterval(function(){et(),ce==null||ce(Nr-Date.now()),Nr<Date.now()&&Rt()},Ct))};ne.useEffect(function(){return Jt(),function(){ht.current&&(clearInterval(ht.current),ht.current=null)}},[Fe]);var Or=function(Nr,wn){return Qt(Nr,(0,Ee.Z)((0,Ee.Z)({},wn),{format:z}))},Tr=function(Nr){return(0,Te.Tm)(Nr,{title:void 0})};return ne.createElement(qt,(0,Ee.Z)({},re,{valueRender:Tr,formatter:Or}))},dt=ne.memo(Ut);qt.Countdown=dt;var rr=qt},95300:function(Br,pe,K){"use strict";var Ee=K(38663),ne=K.n(Ee),y=K(81903),Te=K.n(y),W=K(71748)},9187:function(Br){"use strict";Br.exports=pe,Br.exports.default=pe;function pe(N,z,ce){ce=ce||2;var ze=z&&z.length,et=ze?z[0]*ce:N.length,ht=K(N,0,et,ce,!0),Rt=[];if(!ht||ht.next===ht.prev)return Rt;var Jt,Or,Tr,Pn,Nr,wn,Xi;if(ze&&(ht=se(N,z,ht,ce)),N.length>80*ce){Jt=Tr=N[0],Or=Pn=N[1];for(var mi=ce;mi<et;mi+=ce)Nr=N[mi],wn=N[mi+1],Nr<Jt&&(Jt=Nr),wn<Or&&(Or=wn),Nr>Tr&&(Tr=Nr),wn>Pn&&(Pn=wn);Xi=Math.max(Tr-Jt,Pn-Or),Xi=Xi!==0?32767/Xi:0}return ne(ht,Rt,ce,Jt,Or,Xi,0),Rt}function K(N,z,ce,ze,et){var ht,Rt;if(et===Fe(N,z,ce,ze)>0)for(ht=z;ht<ce;ht+=ze)Rt=rr(ht,N[ht],N[ht+1],Rt);else for(ht=ce-ze;ht>=z;ht-=ze)Rt=rr(ht,N[ht],N[ht+1],Rt);return Rt&&At(Rt,Rt.next)&&(wr(Rt),Rt=Rt.next),Rt}function Ee(N,z){if(!N)return N;z||(z=N);var ce=N,ze;do if(ze=!1,!ce.steiner&&(At(ce,ce.next)||yt(ce.prev,ce,ce.next)===0)){if(wr(ce),ce=z=ce.prev,ce===ce.next)break;ze=!0}else ce=ce.next;while(ze||ce!==z);return z}function ne(N,z,ce,ze,et,ht,Rt){if(!!N){!Rt&&ht&&bt(N,ze,et,ht);for(var Jt=N,Or,Tr;N.prev!==N.next;){if(Or=N.prev,Tr=N.next,ht?Te(N,ze,et,ht):y(N)){z.push(Or.i/ce|0),z.push(N.i/ce|0),z.push(Tr.i/ce|0),wr(N),N=Tr.next,Jt=Tr.next;continue}if(N=Tr,N===Jt){Rt?Rt===1?(N=W(Ee(N),z,ce),ne(N,z,ce,ze,et,ht,2)):Rt===2&&ye(N,z,ce,ze,et,ht):ne(Ee(N),z,ce,ze,et,ht,1);break}}}}function y(N){var z=N.prev,ce=N,ze=N.next;if(yt(z,ce,ze)>=0)return!1;for(var et=z.x,ht=ce.x,Rt=ze.x,Jt=z.y,Or=ce.y,Tr=ze.y,Pn=et<ht?et<Rt?et:Rt:ht<Rt?ht:Rt,Nr=Jt<Or?Jt<Tr?Jt:Tr:Or<Tr?Or:Tr,wn=et>ht?et>Rt?et:Rt:ht>Rt?ht:Rt,Xi=Jt>Or?Jt>Tr?Jt:Tr:Or>Tr?Or:Tr,mi=ze.next;mi!==z;){if(mi.x>=Pn&&mi.x<=wn&&mi.y>=Nr&&mi.y<=Xi&&qt(et,Jt,ht,Or,Rt,Tr,mi.x,mi.y)&&yt(mi.prev,mi,mi.next)>=0)return!1;mi=mi.next}return!0}function Te(N,z,ce,ze){var et=N.prev,ht=N,Rt=N.next;if(yt(et,ht,Rt)>=0)return!1;for(var Jt=et.x,Or=ht.x,Tr=Rt.x,Pn=et.y,Nr=ht.y,wn=Rt.y,Xi=Jt<Or?Jt<Tr?Jt:Tr:Or<Tr?Or:Tr,mi=Pn<Nr?Pn<wn?Pn:wn:Nr<wn?Nr:wn,si=Jt>Or?Jt>Tr?Jt:Tr:Or>Tr?Or:Tr,ki=Pn>Nr?Pn>wn?Pn:wn:Nr>wn?Nr:wn,bi=ur(Xi,mi,z,ce,ze),li=ur(si,ki,z,ce,ze),Zn=N.prevZ,qn=N.nextZ;Zn&&Zn.z>=bi&&qn&&qn.z<=li;){if(Zn.x>=Xi&&Zn.x<=si&&Zn.y>=mi&&Zn.y<=ki&&Zn!==et&&Zn!==Rt&&qt(Jt,Pn,Or,Nr,Tr,wn,Zn.x,Zn.y)&&yt(Zn.prev,Zn,Zn.next)>=0||(Zn=Zn.prevZ,qn.x>=Xi&&qn.x<=si&&qn.y>=mi&&qn.y<=ki&&qn!==et&&qn!==Rt&&qt(Jt,Pn,Or,Nr,Tr,wn,qn.x,qn.y)&&yt(qn.prev,qn,qn.next)>=0))return!1;qn=qn.nextZ}for(;Zn&&Zn.z>=bi;){if(Zn.x>=Xi&&Zn.x<=si&&Zn.y>=mi&&Zn.y<=ki&&Zn!==et&&Zn!==Rt&&qt(Jt,Pn,Or,Nr,Tr,wn,Zn.x,Zn.y)&&yt(Zn.prev,Zn,Zn.next)>=0)return!1;Zn=Zn.prevZ}for(;qn&&qn.z<=li;){if(qn.x>=Xi&&qn.x<=si&&qn.y>=mi&&qn.y<=ki&&qn!==et&&qn!==Rt&&qt(Jt,Pn,Or,Nr,Tr,wn,qn.x,qn.y)&&yt(qn.prev,qn,qn.next)>=0)return!1;qn=qn.nextZ}return!0}function W(N,z,ce){var ze=N;do{var et=ze.prev,ht=ze.next.next;!At(et,ht)&&ar(et,ze,ze.next,ht)&&ft(et,ht)&&ft(ht,et)&&(z.push(et.i/ce|0),z.push(ze.i/ce|0),z.push(ht.i/ce|0),wr(ze),wr(ze.next),ze=N=ht),ze=ze.next}while(ze!==N);return Ee(ze)}function ye(N,z,ce,ze,et,ht){var Rt=N;do{for(var Jt=Rt.next.next;Jt!==Rt.prev;){if(Rt.i!==Jt.i&&zt(Rt,Jt)){var Or=dt(Rt,Jt);Rt=Ee(Rt,Rt.next),Or=Ee(Or,Or.next),ne(Rt,z,ce,ze,et,ht,0),ne(Or,z,ce,ze,et,ht,0);return}Jt=Jt.next}Rt=Rt.next}while(Rt!==N)}function se(N,z,ce,ze){var et=[],ht,Rt,Jt,Or,Tr;for(ht=0,Rt=z.length;ht<Rt;ht++)Jt=z[ht]*ze,Or=ht<Rt-1?z[ht+1]*ze:N.length,Tr=K(N,Jt,Or,ze,!1),Tr===Tr.next&&(Tr.steiner=!0),et.push(Mt(Tr));for(et.sort(Ye),ht=0;ht<et.length;ht++)ce=_e(et[ht],ce);return ce}function Ye(N,z){return N.x-z.x}function _e(N,z){var ce=Qe(N,z);if(!ce)return z;var ze=dt(ce,N);return Ee(ze,ze.next),Ee(ce,ce.next)}function Qe(N,z){var ce=z,ze=N.x,et=N.y,ht=-Infinity,Rt;do{if(et<=ce.y&&et>=ce.next.y&&ce.next.y!==ce.y){var Jt=ce.x+(et-ce.y)*(ce.next.x-ce.x)/(ce.next.y-ce.y);if(Jt<=ze&&Jt>ht&&(ht=Jt,Rt=ce.x<ce.next.x?ce:ce.next,Jt===ze))return Rt}ce=ce.next}while(ce!==z);if(!Rt)return null;var Or=Rt,Tr=Rt.x,Pn=Rt.y,Nr=Infinity,wn;ce=Rt;do ze>=ce.x&&ce.x>=Tr&&ze!==ce.x&&qt(et<Pn?ze:ht,et,Tr,Pn,et<Pn?ht:ze,et,ce.x,ce.y)&&(wn=Math.abs(et-ce.y)/(ze-ce.x),ft(ce,N)&&(wn<Nr||wn===Nr&&(ce.x>Rt.x||ce.x===Rt.x&&lt(Rt,ce)))&&(Rt=ce,Nr=wn)),ce=ce.next;while(ce!==Or);return Rt}function lt(N,z){return yt(N.prev,N,z.prev)<0&&yt(z.next,N,N.next)<0}function bt(N,z,ce,ze){var et=N;do et.z===0&&(et.z=ur(et.x,et.y,z,ce,ze)),et.prevZ=et.prev,et.nextZ=et.next,et=et.next;while(et!==N);et.prevZ.nextZ=null,et.prevZ=null,gt(et)}function gt(N){var z,ce,ze,et,ht,Rt,Jt,Or,Tr=1;do{for(ce=N,N=null,ht=null,Rt=0;ce;){for(Rt++,ze=ce,Jt=0,z=0;z<Tr&&(Jt++,ze=ze.nextZ,!!ze);z++);for(Or=Tr;Jt>0||Or>0&&ze;)Jt!==0&&(Or===0||!ze||ce.z<=ze.z)?(et=ce,ce=ce.nextZ,Jt--):(et=ze,ze=ze.nextZ,Or--),ht?ht.nextZ=et:N=et,et.prevZ=ht,ht=et;ce=ze}ht.nextZ=null,Tr*=2}while(Rt>1);return N}function ur(N,z,ce,ze,et){return N=(N-ce)*et|0,z=(z-ze)*et|0,N=(N|N<<8)&16711935,N=(N|N<<4)&252645135,N=(N|N<<2)&858993459,N=(N|N<<1)&1431655765,z=(z|z<<8)&16711935,z=(z|z<<4)&252645135,z=(z|z<<2)&858993459,z=(z|z<<1)&1431655765,N|z<<1}function Mt(N){var z=N,ce=N;do(z.x<ce.x||z.x===ce.x&&z.y<ce.y)&&(ce=z),z=z.next;while(z!==N);return ce}function qt(N,z,ce,ze,et,ht,Rt,Jt){return(et-Rt)*(z-Jt)>=(N-Rt)*(ht-Jt)&&(N-Rt)*(ze-Jt)>=(ce-Rt)*(z-Jt)&&(ce-Rt)*(ht-Jt)>=(et-Rt)*(ze-Jt)}function zt(N,z){return N.next.i!==z.i&&N.prev.i!==z.i&&!Ct(N,z)&&(ft(N,z)&&ft(z,N)&&Ut(N,z)&&(yt(N.prev,N,z.prev)||yt(N,z.prev,z))||At(N,z)&&yt(N.prev,N,N.next)>0&&yt(z.prev,z,z.next)>0)}function yt(N,z,ce){return(z.y-N.y)*(ce.x-z.x)-(z.x-N.x)*(ce.y-z.y)}function At(N,z){return N.x===z.x&&N.y===z.y}function ar(N,z,ce,ze){var et=Qt(yt(N,z,ce)),ht=Qt(yt(N,z,ze)),Rt=Qt(yt(ce,ze,N)),Jt=Qt(yt(ce,ze,z));return!!(et!==ht&&Rt!==Jt||et===0&&J(N,ce,z)||ht===0&&J(N,ze,z)||Rt===0&&J(ce,N,ze)||Jt===0&&J(ce,z,ze))}function J(N,z,ce){return z.x<=Math.max(N.x,ce.x)&&z.x>=Math.min(N.x,ce.x)&&z.y<=Math.max(N.y,ce.y)&&z.y>=Math.min(N.y,ce.y)}function Qt(N){return N>0?1:N<0?-1:0}function Ct(N,z){var ce=N;do{if(ce.i!==N.i&&ce.next.i!==N.i&&ce.i!==z.i&&ce.next.i!==z.i&&ar(ce,ce.next,N,z))return!0;ce=ce.next}while(ce!==N);return!1}function ft(N,z){return yt(N.prev,N,N.next)<0?yt(N,z,N.next)>=0&&yt(N,N.prev,z)>=0:yt(N,z,N.prev)<0||yt(N,N.next,z)<0}function Ut(N,z){var ce=N,ze=!1,et=(N.x+z.x)/2,ht=(N.y+z.y)/2;do ce.y>ht!=ce.next.y>ht&&ce.next.y!==ce.y&&et<(ce.next.x-ce.x)*(ht-ce.y)/(ce.next.y-ce.y)+ce.x&&(ze=!ze),ce=ce.next;while(ce!==N);return ze}function dt(N,z){var ce=new re(N.i,N.x,N.y),ze=new re(z.i,z.x,z.y),et=N.next,ht=z.prev;return N.next=z,z.prev=N,ce.next=et,et.prev=ce,ze.next=ce,ce.prev=ze,ht.next=ze,ze.prev=ht,ze}function rr(N,z,ce,ze){var et=new re(N,z,ce);return ze?(et.next=ze.next,et.prev=ze,ze.next.prev=et,ze.next=et):(et.prev=et,et.next=et),et}function wr(N){N.next.prev=N.prev,N.prev.next=N.next,N.prevZ&&(N.prevZ.nextZ=N.nextZ),N.nextZ&&(N.nextZ.prevZ=N.prevZ)}function re(N,z,ce){this.i=N,this.x=z,this.y=ce,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}pe.deviation=function(N,z,ce,ze){var et=z&&z.length,ht=et?z[0]*ce:N.length,Rt=Math.abs(Fe(N,0,ht,ce));if(et)for(var Jt=0,Or=z.length;Jt<Or;Jt++){var Tr=z[Jt]*ce,Pn=Jt<Or-1?z[Jt+1]*ce:N.length;Rt-=Math.abs(Fe(N,Tr,Pn,ce))}var Nr=0;for(Jt=0;Jt<ze.length;Jt+=3){var wn=ze[Jt]*ce,Xi=ze[Jt+1]*ce,mi=ze[Jt+2]*ce;Nr+=Math.abs((N[wn]-N[mi])*(N[Xi+1]-N[wn+1])-(N[wn]-N[Xi])*(N[mi+1]-N[wn+1]))}return Rt===0&&Nr===0?0:Math.abs((Nr-Rt)/Rt)};function Fe(N,z,ce,ze){for(var et=0,ht=z,Rt=ce-ze;ht<ce;ht+=ze)et+=(N[Rt]-N[ht])*(N[ht+1]+N[Rt+1]),Rt=ht;return et}pe.flatten=function(N){for(var z=N[0][0].length,ce={vertices:[],holes:[],dimensions:z},ze=0,et=0;et<N.length;et++){for(var ht=0;ht<N[et].length;ht++)for(var Rt=0;Rt<z;Rt++)ce.vertices.push(N[et][ht][Rt]);et>0&&(ze+=N[et-1].length,ce.holes.push(ze))}return ce}},67709:function(Br){function pe(Ee){var ne=Ee.target||Ee.srcElement;ne.__resizeRAF__&&cancelAnimationFrame(ne.__resizeRAF__),ne.__resizeRAF__=requestAnimationFrame(function(){var y=ne.__resizeTrigger__,Te=y&&y.__resizeListeners__;Te&&Te.forEach(function(W){W.call(y,Ee)})})}var K=function(ne,y){var Te=this,W=Te.document,ye,se=W.attachEvent;typeof navigator!="undefined"&&(ye=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function Ye(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",pe)}if(!ne.__resizeListeners__)if(ne.__resizeListeners__=[],se)ne.__resizeTrigger__=ne,ne.attachEvent("onresize",pe);else{getComputedStyle(ne).position==="static"&&(ne.style.position="relative");var _e=ne.__resizeTrigger__=W.createElement("object");_e.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),_e.setAttribute("class","resize-sensor"),_e.setAttribute("tabindex","-1"),_e.setAttribute("title",""),_e.__resizeElement__=ne,_e.onload=Ye,_e.type="text/html",ye&&ne.appendChild(_e),_e.data="about:blank",ye||ne.appendChild(_e)}ne.__resizeListeners__.push(y)};Br.exports=typeof window=="undefined"?K:K.bind(window),Br.exports.unbind=function(Ee,ne){var y=document.attachEvent,Te=Ee.__resizeListeners__||[];if(ne){var W=Te.indexOf(ne);W!==-1&&Te.splice(W,1)}else Te=Ee.__resizeListeners__=[];if(!Te.length){if(y)Ee.detachEvent("onresize",pe);else if(Ee.__resizeTrigger__){var ye=Ee.__resizeTrigger__.contentDocument,se=ye&&ye.defaultView;se&&(se.removeEventListener("resize",pe),delete se.__resizeTrigger__),Ee.__resizeTrigger__=!Ee.removeChild(Ee.__resizeTrigger__)}delete Ee.__resizeListeners__}}},26729:function(Br){"use strict";var pe=Object.prototype.hasOwnProperty,K="~";function Ee(){}Object.create&&(Ee.prototype=Object.create(null),new Ee().__proto__||(K=!1));function ne(ye,se,Ye){this.fn=ye,this.context=se,this.once=Ye||!1}function y(ye,se,Ye,_e,Qe){if(typeof Ye!="function")throw new TypeError("The listener must be a function");var lt=new ne(Ye,_e||ye,Qe),bt=K?K+se:se;return ye._events[bt]?ye._events[bt].fn?ye._events[bt]=[ye._events[bt],lt]:ye._events[bt].push(lt):(ye._events[bt]=lt,ye._eventsCount++),ye}function Te(ye,se){--ye._eventsCount==0?ye._events=new Ee:delete ye._events[se]}function W(){this._events=new Ee,this._eventsCount=0}W.prototype.eventNames=function(){var se=[],Ye,_e;if(this._eventsCount===0)return se;for(_e in Ye=this._events)pe.call(Ye,_e)&&se.push(K?_e.slice(1):_e);return Object.getOwnPropertySymbols?se.concat(Object.getOwnPropertySymbols(Ye)):se},W.prototype.listeners=function(se){var Ye=K?K+se:se,_e=this._events[Ye];if(!_e)return[];if(_e.fn)return[_e.fn];for(var Qe=0,lt=_e.length,bt=new Array(lt);Qe<lt;Qe++)bt[Qe]=_e[Qe].fn;return bt},W.prototype.listenerCount=function(se){var Ye=K?K+se:se,_e=this._events[Ye];return _e?_e.fn?1:_e.length:0},W.prototype.emit=function(se,Ye,_e,Qe,lt,bt){var gt=K?K+se:se;if(!this._events[gt])return!1;var ur=this._events[gt],Mt=arguments.length,qt,zt;if(ur.fn){switch(ur.once&&this.removeListener(se,ur.fn,void 0,!0),Mt){case 1:return ur.fn.call(ur.context),!0;case 2:return ur.fn.call(ur.context,Ye),!0;case 3:return ur.fn.call(ur.context,Ye,_e),!0;case 4:return ur.fn.call(ur.context,Ye,_e,Qe),!0;case 5:return ur.fn.call(ur.context,Ye,_e,Qe,lt),!0;case 6:return ur.fn.call(ur.context,Ye,_e,Qe,lt,bt),!0}for(zt=1,qt=new Array(Mt-1);zt<Mt;zt++)qt[zt-1]=arguments[zt];ur.fn.apply(ur.context,qt)}else{var yt=ur.length,At;for(zt=0;zt<yt;zt++)switch(ur[zt].once&&this.removeListener(se,ur[zt].fn,void 0,!0),Mt){case 1:ur[zt].fn.call(ur[zt].context);break;case 2:ur[zt].fn.call(ur[zt].context,Ye);break;case 3:ur[zt].fn.call(ur[zt].context,Ye,_e);break;case 4:ur[zt].fn.call(ur[zt].context,Ye,_e,Qe);break;default:if(!qt)for(At=1,qt=new Array(Mt-1);At<Mt;At++)qt[At-1]=arguments[At];ur[zt].fn.apply(ur[zt].context,qt)}}return!0},W.prototype.on=function(se,Ye,_e){return y(this,se,Ye,_e,!1)},W.prototype.once=function(se,Ye,_e){return y(this,se,Ye,_e,!0)},W.prototype.removeListener=function(se,Ye,_e,Qe){var lt=K?K+se:se;if(!this._events[lt])return this;if(!Ye)return Te(this,lt),this;var bt=this._events[lt];if(bt.fn)bt.fn===Ye&&(!Qe||bt.once)&&(!_e||bt.context===_e)&&Te(this,lt);else{for(var gt=0,ur=[],Mt=bt.length;gt<Mt;gt++)(bt[gt].fn!==Ye||Qe&&!bt[gt].once||_e&&bt[gt].context!==_e)&&ur.push(bt[gt]);ur.length?this._events[lt]=ur.length===1?ur[0]:ur:Te(this,lt)}return this},W.prototype.removeAllListeners=function(se){var Ye;return se?(Ye=K?K+se:se,this._events[Ye]&&Te(this,Ye)):(this._events=new Ee,this._eventsCount=0),this},W.prototype.off=W.prototype.removeListener,W.prototype.addListener=W.prototype.on,W.prefixed=K,W.EventEmitter=W,Br.exports=W},80645:function(Br,pe){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */pe.read=function(K,Ee,ne,y,Te){var W,ye,se=Te*8-y-1,Ye=(1<<se)-1,_e=Ye>>1,Qe=-7,lt=ne?Te-1:0,bt=ne?-1:1,gt=K[Ee+lt];for(lt+=bt,W=gt&(1<<-Qe)-1,gt>>=-Qe,Qe+=se;Qe>0;W=W*256+K[Ee+lt],lt+=bt,Qe-=8);for(ye=W&(1<<-Qe)-1,W>>=-Qe,Qe+=y;Qe>0;ye=ye*256+K[Ee+lt],lt+=bt,Qe-=8);if(W===0)W=1-_e;else{if(W===Ye)return ye?NaN:(gt?-1:1)*Infinity;ye=ye+Math.pow(2,y),W=W-_e}return(gt?-1:1)*ye*Math.pow(2,W-y)},pe.write=function(K,Ee,ne,y,Te,W){var ye,se,Ye,_e=W*8-Te-1,Qe=(1<<_e)-1,lt=Qe>>1,bt=Te===23?Math.pow(2,-24)-Math.pow(2,-77):0,gt=y?0:W-1,ur=y?1:-1,Mt=Ee<0||Ee===0&&1/Ee<0?1:0;for(Ee=Math.abs(Ee),isNaN(Ee)||Ee===Infinity?(se=isNaN(Ee)?1:0,ye=Qe):(ye=Math.floor(Math.log(Ee)/Math.LN2),Ee*(Ye=Math.pow(2,-ye))<1&&(ye--,Ye*=2),ye+lt>=1?Ee+=bt/Ye:Ee+=bt*Math.pow(2,1-lt),Ee*Ye>=2&&(ye++,Ye/=2),ye+lt>=Qe?(se=0,ye=Qe):ye+lt>=1?(se=(Ee*Ye-1)*Math.pow(2,Te),ye=ye+lt):(se=Ee*Math.pow(2,lt-1)*Math.pow(2,Te),ye=0));Te>=8;K[ne+gt]=se&255,gt+=ur,se/=256,Te-=8);for(ye=ye<<Te|se,_e+=Te;_e>0;K[ne+gt]=ye&255,gt+=ur,ye/=256,_e-=8);K[ne+gt-ur]|=Mt*128}},7375:function(Br,pe){"use strict";Object.defineProperty(pe,"__esModule",{value:!0});var K=Symbol.for("INJECTION");function Ee(ye,se,Ye,_e){function Qe(){return _e&&!Reflect.hasMetadata(K,this,se)&&Reflect.defineMetadata(K,Ye(),this,se),Reflect.hasMetadata(K,this,se)?Reflect.getMetadata(K,this,se):Ye()}function lt(bt){Reflect.defineMetadata(K,bt,this,se)}Object.defineProperty(ye,se,{configurable:!0,enumerable:!0,get:Qe,set:lt})}function ne(ye,se){return function(Ye){return function(_e,Qe){var lt=function(){return ye.get(Ye)};Ee(_e,Qe,lt,se)}}}pe.makePropertyInjectDecorator=ne;function y(ye,se){return function(Ye,_e){return function(Qe,lt){var bt=function(){return ye.getNamed(Ye,_e)};Ee(Qe,lt,bt,se)}}}pe.makePropertyInjectNamedDecorator=y;function Te(ye,se){return function(Ye,_e,Qe){return function(lt,bt){var gt=function(){return ye.getTagged(Ye,_e,Qe)};Ee(lt,bt,gt,se)}}}pe.makePropertyInjectTaggedDecorator=Te;function W(ye,se){return function(Ye){return function(_e,Qe){var lt=function(){return ye.getAll(Ye)};Ee(_e,Qe,lt,se)}}}pe.makePropertyMultiInjectDecorator=W},84879:function(Br,pe,K){"use strict";var Ee;Ee={value:!0};var ne=K(7375);function y(Te,W){W===void 0&&(W=!0);var ye=ne.makePropertyInjectDecorator(Te,W),se=ne.makePropertyInjectNamedDecorator(Te,W),Ye=ne.makePropertyInjectTaggedDecorator(Te,W),_e=ne.makePropertyMultiInjectDecorator(Te,W);return{lazyInject:ye,lazyInjectNamed:se,lazyInjectTagged:Ye,lazyMultiInject:_e}}pe.Z=y},99934:function(Br,pe,K){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.tagProperty=pe.tagParameter=pe.decorate=void 0;var Ee=K(16674),ne=K(6867);function y(_e,Qe,lt,bt){var gt=ne.TAGGED;W(gt,_e,Qe,bt,lt)}pe.tagParameter=y;function Te(_e,Qe,lt){var bt=ne.TAGGED_PROP;W(bt,_e.constructor,Qe,lt)}pe.tagProperty=Te;function W(_e,Qe,lt,bt,gt){var ur={},Mt=typeof gt=="number",qt=gt!==void 0&&Mt?gt.toString():lt;if(Mt&&lt!==void 0)throw new Error(Ee.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(_e,Qe)&&(ur=Reflect.getMetadata(_e,Qe));var zt=ur[qt];if(!Array.isArray(zt))zt=[];else for(var yt=0,At=zt;yt<At.length;yt++){var ar=At[yt];if(ar.key===bt.key)throw new Error(Ee.DUPLICATED_METADATA+" "+ar.key.toString())}zt.push(bt),ur[qt]=zt,Reflect.defineMetadata(_e,ur,Qe)}function ye(_e,Qe){Reflect.decorate(_e,Qe)}function se(_e,Qe){return function(lt,bt){Qe(lt,bt,_e)}}function Ye(_e,Qe,lt){typeof lt=="number"?ye([se(lt,_e)],Qe):typeof lt=="string"?Reflect.decorate([_e],Qe,lt):ye([_e],Qe)}pe.decorate=Ye},5744:function(Br,pe,K){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.inject=pe.LazyServiceIdentifer=void 0;var Ee=K(16674),ne=K(6867),y=K(47738),Te=K(99934),W=function(){function se(Ye){this._cb=Ye}return se.prototype.unwrap=function(){return this._cb()},se}();pe.LazyServiceIdentifer=W;function ye(se){return function(Ye,_e,Qe){if(se===void 0)throw new Error(Ee.UNDEFINED_INJECT_ANNOTATION(Ye.name));var lt=new y.Metadata(ne.INJECT_TAG,se);typeof Qe=="number"?Te.tagParameter(Ye,_e,Qe,lt):Te.tagProperty(Ye,_e,lt)}}pe.inject=ye},64315:function(Br,pe,K){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.injectable=void 0;var Ee=K(16674),ne=K(6867);function y(){return function(Te){if(Reflect.hasOwnMetadata(ne.PARAM_TYPES,Te))throw new Error(Ee.DUPLICATED_INJECTABLE_DECORATOR);var W=Reflect.getMetadata(ne.DESIGN_PARAM_TYPES,Te)||[];return Reflect.defineMetadata(ne.PARAM_TYPES,W,Te),Te}}pe.injectable=y},71693:function(Br,pe,K){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.multiInject=void 0;var Ee=K(6867),ne=K(47738),y=K(99934);function Te(W){return function(ye,se,Ye){var _e=new ne.Metadata(Ee.MULTI_INJECT_TAG,W);typeof Ye=="number"?y.tagParameter(ye,se,Ye,_e):y.tagProperty(ye,se,_e)}}pe.multiInject=Te},38085:function(Br,pe,K){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.named=void 0;var Ee=K(6867),ne=K(47738),y=K(99934);function Te(W){return function(ye,se,Ye){var _e=new ne.Metadata(Ee.NAMED_TAG,W);typeof Ye=="number"?y.tagParameter(ye,se,Ye,_e):y.tagProperty(ye,se,_e)}}pe.named=Te},6515:function(Br,pe,K){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.optional=void 0;var Ee=K(6867),ne=K(47738),y=K(99934);function Te(){return function(W,ye,se){var Ye=new ne.Metadata(Ee.OPTIONAL_TAG,!0);typeof se=="number"?y.tagParameter(W,ye,se,Ye):y.tagProperty(W,ye,Ye)}}pe.optional=Te},7014:function(Br,pe,K){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.postConstruct=void 0;var Ee=K(16674),ne=K(6867),y=K(47738);function Te(){return function(W,ye,se){var Ye=new y.Metadata(ne.POST_CONSTRUCT,ye);if(Reflect.hasOwnMetadata(ne.POST_CONSTRUCT,W.constructor))throw new Error(Ee.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(ne.POST_CONSTRUCT,Ye,W.constructor)}}pe.postConstruct=Te},32052:function(Br,pe,K){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.tagged=void 0;var Ee=K(47738),ne=K(99934);function y(Te,W){return function(ye,se,Ye){var _e=new Ee.Metadata(Te,W);typeof Ye=="number"?ne.tagParameter(ye,se,Ye,_e):ne.tagProperty(ye,se,_e)}}pe.tagged=y},55638:function(Br,pe,K){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.targetName=void 0;var Ee=K(6867),ne=K(47738),y=K(99934);function Te(W){return function(ye,se,Ye){var _e=new ne.Metadata(Ee.NAME_TAG,W);y.tagParameter(ye,se,Ye,_e)}}pe.targetName=Te},86757:function(Br,pe,K){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.unmanaged=void 0;var Ee=K(6867),ne=K(47738),y=K(99934);function Te(){return function(W,ye,se){var Ye=new ne.Metadata(Ee.UNMANAGED_TAG,!0);y.tagParameter(W,ye,se,Ye)}}pe.unmanaged=Te},44290:function(Br,pe,K){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.Binding=void 0;var Ee=K(28421),ne=K(37791),y=function(){function Te(W,ye){this.id=ne.id(),this.activated=!1,this.serviceIdentifier=W,this.scope=ye,this.type=Ee.BindingTypeEnum.Invalid,this.constraint=function(se){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return Te.prototype.clone=function(){var W=new Te(this.serviceIdentifier,this.scope);return W.activated=W.scope===Ee.BindingScopeEnum.Singleton?this.activated:!1,W.implementationType=this.implementationType,W.dynamicValue=this.dynamicValue,W.scope=this.scope,W.type=this.type,W.factory=this.factory,W.provider=this.provider,W.constraint=this.constraint,W.onActivation=this.onActivation,W.cache=this.cache,W},Te}();pe.Binding=y},23184:function(Br,pe){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.BindingCount=void 0;var K={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};pe.BindingCount=K},16674:function(Br,pe){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.STACK_OVERFLOW=pe.CIRCULAR_DEPENDENCY_IN_FACTORY=pe.POST_CONSTRUCT_ERROR=pe.MULTIPLE_POST_CONSTRUCT_METHODS=pe.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=pe.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=pe.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=pe.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=pe.ARGUMENTS_LENGTH_MISMATCH=pe.INVALID_DECORATOR_OPERATION=pe.INVALID_TO_SELF_VALUE=pe.INVALID_FUNCTION_BINDING=pe.INVALID_MIDDLEWARE_RETURN=pe.NO_MORE_SNAPSHOTS_AVAILABLE=pe.INVALID_BINDING_TYPE=pe.NOT_IMPLEMENTED=pe.CIRCULAR_DEPENDENCY=pe.UNDEFINED_INJECT_ANNOTATION=pe.MISSING_INJECT_ANNOTATION=pe.MISSING_INJECTABLE_ANNOTATION=pe.NOT_REGISTERED=pe.CANNOT_UNBIND=pe.AMBIGUOUS_MATCH=pe.KEY_NOT_FOUND=pe.NULL_ARGUMENT=pe.DUPLICATED_METADATA=pe.DUPLICATED_INJECTABLE_DECORATOR=void 0,pe.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",pe.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",pe.NULL_ARGUMENT="NULL argument",pe.KEY_NOT_FOUND="Key Not Found",pe.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",pe.CANNOT_UNBIND="Could not unbind serviceIdentifier:",pe.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",pe.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",pe.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var K=function(Te){return"@inject called with undefined this could mean that the class "+Te+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};pe.UNDEFINED_INJECT_ANNOTATION=K,pe.CIRCULAR_DEPENDENCY="Circular dependency found:",pe.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",pe.INVALID_BINDING_TYPE="Invalid binding type:",pe.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",pe.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",pe.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",pe.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",pe.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var Ee=function(){for(var Te=[],W=0;W<arguments.length;W++)Te[W]=arguments[W];return"The number of constructor arguments in the derived class "+(Te[0]+" must be >= than the number of constructor arguments of its base class.")};pe.ARGUMENTS_LENGTH_MISMATCH=Ee,pe.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",pe.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",pe.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",pe.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",pe.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var ne=function(){for(var Te=[],W=0;W<arguments.length;W++)Te[W]=arguments[W];return"@postConstruct error in class "+Te[0]+": "+Te[1]};pe.POST_CONSTRUCT_ERROR=ne;var y=function(){for(var Te=[],W=0;W<arguments.length;W++)Te[W]=arguments[W];return"It looks like there is a circular dependency "+("in one of the '"+Te[0]+"' bindings. Please investigate bindings with")+("service identifier '"+Te[1]+"'.")};pe.CIRCULAR_DEPENDENCY_IN_FACTORY=y,pe.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(Br,pe){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.TargetTypeEnum=pe.BindingTypeEnum=pe.BindingScopeEnum=void 0;var K={Request:"Request",Singleton:"Singleton",Transient:"Transient"};pe.BindingScopeEnum=K;var Ee={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};pe.BindingTypeEnum=Ee;var ne={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};pe.TargetTypeEnum=ne},6867:function(Br,pe){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.NON_CUSTOM_TAG_KEYS=pe.POST_CONSTRUCT=pe.DESIGN_PARAM_TYPES=pe.PARAM_TYPES=pe.TAGGED_PROP=pe.TAGGED=pe.MULTI_INJECT_TAG=pe.INJECT_TAG=pe.OPTIONAL_TAG=pe.UNMANAGED_TAG=pe.NAME_TAG=pe.NAMED_TAG=void 0,pe.NAMED_TAG="named",pe.NAME_TAG="name",pe.UNMANAGED_TAG="unmanaged",pe.OPTIONAL_TAG="optional",pe.INJECT_TAG="inject",pe.MULTI_INJECT_TAG="multi_inject",pe.TAGGED="inversify:tagged",pe.TAGGED_PROP="inversify:tagged_props",pe.PARAM_TYPES="inversify:paramtypes",pe.DESIGN_PARAM_TYPES="design:paramtypes",pe.POST_CONSTRUCT="post_construct";function K(){return[pe.INJECT_TAG,pe.MULTI_INJECT_TAG,pe.NAME_TAG,pe.UNMANAGED_TAG,pe.NAMED_TAG,pe.OPTIONAL_TAG]}pe.NON_CUSTOM_TAG_KEYS=K()},51389:function(Br,pe,K){"use strict";var Ee=this&&this.__awaiter||function(zt,yt,At,ar){function J(Qt){return Qt instanceof At?Qt:new At(function(Ct){Ct(Qt)})}return new(At||(At=Promise))(function(Qt,Ct){function ft(rr){try{dt(ar.next(rr))}catch(wr){Ct(wr)}}function Ut(rr){try{dt(ar.throw(rr))}catch(wr){Ct(wr)}}function dt(rr){rr.done?Qt(rr.value):J(rr.value).then(ft,Ut)}dt((ar=ar.apply(zt,yt||[])).next())})},ne=this&&this.__generator||function(zt,yt){var At={label:0,sent:function(){if(Qt[0]&1)throw Qt[1];return Qt[1]},trys:[],ops:[]},ar,J,Qt,Ct;return Ct={next:ft(0),throw:ft(1),return:ft(2)},typeof Symbol=="function"&&(Ct[Symbol.iterator]=function(){return this}),Ct;function ft(dt){return function(rr){return Ut([dt,rr])}}function Ut(dt){if(ar)throw new TypeError("Generator is already executing.");for(;At;)try{if(ar=1,J&&(Qt=dt[0]&2?J.return:dt[0]?J.throw||((Qt=J.return)&&Qt.call(J),0):J.next)&&!(Qt=Qt.call(J,dt[1])).done)return Qt;switch(J=0,Qt&&(dt=[dt[0]&2,Qt.value]),dt[0]){case 0:case 1:Qt=dt;break;case 4:return At.label++,{value:dt[1],done:!1};case 5:At.label++,J=dt[1],dt=[0];continue;case 7:dt=At.ops.pop(),At.trys.pop();continue;default:if(Qt=At.trys,!(Qt=Qt.length>0&&Qt[Qt.length-1])&&(dt[0]===6||dt[0]===2)){At=0;continue}if(dt[0]===3&&(!Qt||dt[1]>Qt[0]&&dt[1]<Qt[3])){At.label=dt[1];break}if(dt[0]===6&&At.label<Qt[1]){At.label=Qt[1],Qt=dt;break}if(Qt&&At.label<Qt[2]){At.label=Qt[2],At.ops.push(dt);break}Qt[2]&&At.ops.pop(),At.trys.pop();continue}dt=yt.call(zt,At)}catch(rr){dt=[6,rr],J=0}finally{ar=Qt=0}if(dt[0]&5)throw dt[1];return{value:dt[0]?dt[1]:void 0,done:!0}}},y=this&&this.__spreadArray||function(zt,yt){for(var At=0,ar=yt.length,J=zt.length;At<ar;At++,J++)zt[J]=yt[At];return zt};Object.defineProperty(pe,"__esModule",{value:!0}),pe.Container=void 0;var Te=K(44290),W=K(16674),ye=K(28421),se=K(6867),Ye=K(51377),_e=K(86311),Qe=K(31927),lt=K(15451),bt=K(37791),gt=K(55800),ur=K(85700),Mt=K(80175),qt=function(){function zt(yt){this._appliedMiddleware=[];var At=yt||{};if(typeof At!="object")throw new Error(""+W.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(At.defaultScope===void 0)At.defaultScope=ye.BindingScopeEnum.Transient;else if(At.defaultScope!==ye.BindingScopeEnum.Singleton&&At.defaultScope!==ye.BindingScopeEnum.Transient&&At.defaultScope!==ye.BindingScopeEnum.Request)throw new Error(""+W.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(At.autoBindInjectable===void 0)At.autoBindInjectable=!1;else if(typeof At.autoBindInjectable!="boolean")throw new Error(""+W.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(At.skipBaseClassChecks===void 0)At.skipBaseClassChecks=!1;else if(typeof At.skipBaseClassChecks!="boolean")throw new Error(""+W.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:At.autoBindInjectable,defaultScope:At.defaultScope,skipBaseClassChecks:At.skipBaseClassChecks},this.id=bt.id(),this._bindingDictionary=new Mt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new Ye.MetadataReader}return zt.merge=function(yt,At){for(var ar=[],J=2;J<arguments.length;J++)ar[J-2]=arguments[J];var Qt=new zt,Ct=y([yt,At],ar).map(function(dt){return _e.getBindingDictionary(dt)}),ft=_e.getBindingDictionary(Qt);function Ut(dt,rr){dt.traverse(function(wr,re){re.forEach(function(Fe){rr.add(Fe.serviceIdentifier,Fe.clone())})})}return Ct.forEach(function(dt){Ut(dt,ft)}),Qt},zt.prototype.load=function(){for(var yt=[],At=0;At<arguments.length;At++)yt[At]=arguments[At];for(var ar=this._getContainerModuleHelpersFactory(),J=0,Qt=yt;J<Qt.length;J++){var Ct=Qt[J],ft=ar(Ct.id);Ct.registry(ft.bindFunction,ft.unbindFunction,ft.isboundFunction,ft.rebindFunction)}},zt.prototype.loadAsync=function(){for(var yt=[],At=0;At<arguments.length;At++)yt[At]=arguments[At];return Ee(this,void 0,void 0,function(){var ar,J,Qt,Ct,ft;return ne(this,function(Ut){switch(Ut.label){case 0:ar=this._getContainerModuleHelpersFactory(),J=0,Qt=yt,Ut.label=1;case 1:return J<Qt.length?(Ct=Qt[J],ft=ar(Ct.id),[4,Ct.registry(ft.bindFunction,ft.unbindFunction,ft.isboundFunction,ft.rebindFunction)]):[3,4];case 2:Ut.sent(),Ut.label=3;case 3:return J++,[3,1];case 4:return[2]}})})},zt.prototype.unload=function(){for(var yt=this,At=[],ar=0;ar<arguments.length;ar++)At[ar]=arguments[ar];var J=function(Qt){return function(Ct){return Ct.moduleId===Qt}};At.forEach(function(Qt){var Ct=J(Qt.id);yt._bindingDictionary.removeByCondition(Ct)})},zt.prototype.bind=function(yt){var At=this.options.defaultScope||ye.BindingScopeEnum.Transient,ar=new Te.Binding(yt,At);return this._bindingDictionary.add(yt,ar),new lt.BindingToSyntax(ar)},zt.prototype.rebind=function(yt){return this.unbind(yt),this.bind(yt)},zt.prototype.unbind=function(yt){try{this._bindingDictionary.remove(yt)}catch(At){throw new Error(W.CANNOT_UNBIND+" "+gt.getServiceIdentifierAsString(yt))}},zt.prototype.unbindAll=function(){this._bindingDictionary=new Mt.Lookup},zt.prototype.isBound=function(yt){var At=this._bindingDictionary.hasKey(yt);return!At&&this.parent&&(At=this.parent.isBound(yt)),At},zt.prototype.isBoundNamed=function(yt,At){return this.isBoundTagged(yt,se.NAMED_TAG,At)},zt.prototype.isBoundTagged=function(yt,At,ar){var J=!1;if(this._bindingDictionary.hasKey(yt)){var Qt=this._bindingDictionary.get(yt),Ct=_e.createMockRequest(this,yt,At,ar);J=Qt.some(function(ft){return ft.constraint(Ct)})}return!J&&this.parent&&(J=this.parent.isBoundTagged(yt,At,ar)),J},zt.prototype.snapshot=function(){this._snapshots.push(ur.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},zt.prototype.restore=function(){var yt=this._snapshots.pop();if(yt===void 0)throw new Error(W.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=yt.bindings,this._middleware=yt.middleware},zt.prototype.createChild=function(yt){var At=new zt(yt||this.options);return At.parent=this,At},zt.prototype.applyMiddleware=function(){for(var yt=[],At=0;At<arguments.length;At++)yt[At]=arguments[At];this._appliedMiddleware=this._appliedMiddleware.concat(yt);var ar=this._middleware?this._middleware:this._planAndResolve();this._middleware=yt.reduce(function(J,Qt){return Qt(J)},ar)},zt.prototype.applyCustomMetadataReader=function(yt){this._metadataReader=yt},zt.prototype.get=function(yt){return this._get(!1,!1,ye.TargetTypeEnum.Variable,yt)},zt.prototype.getTagged=function(yt,At,ar){return this._get(!1,!1,ye.TargetTypeEnum.Variable,yt,At,ar)},zt.prototype.getNamed=function(yt,At){return this.getTagged(yt,se.NAMED_TAG,At)},zt.prototype.getAll=function(yt){return this._get(!0,!0,ye.TargetTypeEnum.Variable,yt)},zt.prototype.getAllTagged=function(yt,At,ar){return this._get(!1,!0,ye.TargetTypeEnum.Variable,yt,At,ar)},zt.prototype.getAllNamed=function(yt,At){return this.getAllTagged(yt,se.NAMED_TAG,At)},zt.prototype.resolve=function(yt){var At=this.createChild();return At.bind(yt).toSelf(),this._appliedMiddleware.forEach(function(ar){At.applyMiddleware(ar)}),At.get(yt)},zt.prototype._getContainerModuleHelpersFactory=function(){var yt=this,At=function(ft,Ut){ft._binding.moduleId=Ut},ar=function(ft){return function(Ut){var dt=yt.bind.bind(yt),rr=dt(Ut);return At(rr,ft),rr}},J=function(ft){return function(Ut){var dt=yt.unbind.bind(yt);dt(Ut)}},Qt=function(ft){return function(Ut){var dt=yt.isBound.bind(yt);return dt(Ut)}},Ct=function(ft){return function(Ut){var dt=yt.rebind.bind(yt),rr=dt(Ut);return At(rr,ft),rr}};return function(ft){return{bindFunction:ar(ft),isboundFunction:Qt(ft),rebindFunction:Ct(ft),unbindFunction:J(ft)}}},zt.prototype._get=function(yt,At,ar,J,Qt,Ct){var ft=null,Ut={avoidConstraints:yt,contextInterceptor:function(dt){return dt},isMultiInject:At,key:Qt,serviceIdentifier:J,targetType:ar,value:Ct};if(this._middleware){if(ft=this._middleware(Ut),ft==null)throw new Error(W.INVALID_MIDDLEWARE_RETURN)}else ft=this._planAndResolve()(Ut);return ft},zt.prototype._planAndResolve=function(){var yt=this;return function(At){var ar=_e.plan(yt._metadataReader,yt,At.isMultiInject,At.targetType,At.serviceIdentifier,At.key,At.value,At.avoidConstraints);ar=At.contextInterceptor(ar);var J=Qe.resolve(ar);return J}},zt}();pe.Container=qt},33244:function(Br,pe,K){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.AsyncContainerModule=pe.ContainerModule=void 0;var Ee=K(37791),ne=function(){function Te(W){this.id=Ee.id(),this.registry=W}return Te}();pe.ContainerModule=ne;var y=function(){function Te(W){this.id=Ee.id(),this.registry=W}return Te}();pe.AsyncContainerModule=y},85700:function(Br,pe){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.ContainerSnapshot=void 0;var K=function(){function Ee(){}return Ee.of=function(ne,y){var Te=new Ee;return Te.bindings=ne,Te.middleware=y,Te},Ee}();pe.ContainerSnapshot=K},80175:function(Br,pe,K){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.Lookup=void 0;var Ee=K(16674),ne=function(){function y(){this._map=new Map}return y.prototype.getMap=function(){return this._map},y.prototype.add=function(Te,W){if(Te==null)throw new Error(Ee.NULL_ARGUMENT);if(W==null)throw new Error(Ee.NULL_ARGUMENT);var ye=this._map.get(Te);ye!==void 0?(ye.push(W),this._map.set(Te,ye)):this._map.set(Te,[W])},y.prototype.get=function(Te){if(Te==null)throw new Error(Ee.NULL_ARGUMENT);var W=this._map.get(Te);if(W!==void 0)return W;throw new Error(Ee.KEY_NOT_FOUND)},y.prototype.remove=function(Te){if(Te==null)throw new Error(Ee.NULL_ARGUMENT);if(!this._map.delete(Te))throw new Error(Ee.KEY_NOT_FOUND)},y.prototype.removeByCondition=function(Te){var W=this;this._map.forEach(function(ye,se){var Ye=ye.filter(function(_e){return!Te(_e)});Ye.length>0?W._map.set(se,Ye):W._map.delete(se)})},y.prototype.hasKey=function(Te){if(Te==null)throw new Error(Ee.NULL_ARGUMENT);return this._map.has(Te)},y.prototype.clone=function(){var Te=new y;return this._map.forEach(function(W,ye){W.forEach(function(se){return Te.add(ye,se.clone())})}),Te},y.prototype.traverse=function(Te){this._map.forEach(function(W,ye){Te(ye,W)})},y}();pe.Lookup=ne},86700:function(Br,pe,K){"use strict";var Ee;Ee={value:!0},Ee=Ee=Ee=Ee=Ee=Ee=pe.GW=Ee=Ee=pe.zY=Ee=Ee=Ee=Ee=Ee=pe.f3=Ee=Ee=pe.b2=Ee=Ee=Ee=Ee=Ee=pe.W2=Ee=void 0;var ne=K(6867);Ee=ne;var y=K(51389);Object.defineProperty(pe,"W2",{enumerable:!0,get:function(){return y.Container}});var Te=K(28421);Ee={enumerable:!0,get:function(){return Te.BindingScopeEnum}},Ee={enumerable:!0,get:function(){return Te.BindingTypeEnum}},Ee={enumerable:!0,get:function(){return Te.TargetTypeEnum}};var W=K(33244);Ee={enumerable:!0,get:function(){return W.AsyncContainerModule}},Ee={enumerable:!0,get:function(){return W.ContainerModule}};var ye=K(64315);Object.defineProperty(pe,"b2",{enumerable:!0,get:function(){return ye.injectable}});var se=K(32052);Ee={enumerable:!0,get:function(){return se.tagged}};var Ye=K(38085);Ee={enumerable:!0,get:function(){return Ye.named}};var _e=K(5744);Object.defineProperty(pe,"f3",{enumerable:!0,get:function(){return _e.inject}}),Ee={enumerable:!0,get:function(){return _e.LazyServiceIdentifer}};var Qe=K(6515);Ee={enumerable:!0,get:function(){return Qe.optional}};var lt=K(86757);Ee={enumerable:!0,get:function(){return lt.unmanaged}};var bt=K(71693);Ee={enumerable:!0,get:function(){return bt.multiInject}};var gt=K(55638);Ee={enumerable:!0,get:function(){return gt.targetName}};var ur=K(7014);Object.defineProperty(pe,"zY",{enumerable:!0,get:function(){return ur.postConstruct}});var Mt=K(51377);Ee={enumerable:!0,get:function(){return Mt.MetadataReader}};var qt=K(37791);Ee={enumerable:!0,get:function(){return qt.id}};var zt=K(99934);Object.defineProperty(pe,"GW",{enumerable:!0,get:function(){return zt.decorate}});var yt=K(80758);Ee={enumerable:!0,get:function(){return yt.traverseAncerstors}},Ee={enumerable:!0,get:function(){return yt.taggedConstraint}},Ee={enumerable:!0,get:function(){return yt.namedConstraint}},Ee={enumerable:!0,get:function(){return yt.typeConstraint}};var At=K(55800);Ee={enumerable:!0,get:function(){return At.getServiceIdentifierAsString}};var ar=K(70600);Ee={enumerable:!0,get:function(){return ar.multiBindToService}}},95228:function(Br,pe,K){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.Context=void 0;var Ee=K(37791),ne=function(){function y(Te){this.id=Ee.id(),this.container=Te}return y.prototype.addPlan=function(Te){this.plan=Te},y.prototype.setCurrentRequest=function(Te){this.currentRequest=Te},y}();pe.Context=ne},47738:function(Br,pe,K){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.Metadata=void 0;var Ee=K(6867),ne=function(){function y(Te,W){this.key=Te,this.value=W}return y.prototype.toString=function(){return this.key===Ee.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},y}();pe.Metadata=ne},51377:function(Br,pe,K){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.MetadataReader=void 0;var Ee=K(6867),ne=function(){function y(){}return y.prototype.getConstructorMetadata=function(Te){var W=Reflect.getMetadata(Ee.PARAM_TYPES,Te),ye=Reflect.getMetadata(Ee.TAGGED,Te);return{compilerGeneratedMetadata:W,userGeneratedMetadata:ye||{}}},y.prototype.getPropertiesMetadata=function(Te){var W=Reflect.getMetadata(Ee.TAGGED_PROP,Te)||[];return W},y}();pe.MetadataReader=ne},55314:function(Br,pe){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.Plan=void 0;var K=function(){function Ee(ne,y){this.parentContext=ne,this.rootRequest=y}return Ee}();pe.Plan=K},86311:function(Br,pe,K){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.getBindingDictionary=pe.createMockRequest=pe.plan=void 0;var Ee=K(23184),ne=K(16674),y=K(28421),Te=K(6867),W=K(85265),ye=K(55800),se=K(95228),Ye=K(47738),_e=K(55314),Qe=K(6e3),lt=K(6748),bt=K(18924);function gt(J){return J._bindingDictionary}pe.getBindingDictionary=gt;function ur(J,Qt,Ct,ft,Ut,dt){var rr=J?Te.MULTI_INJECT_TAG:Te.INJECT_TAG,wr=new Ye.Metadata(rr,Ct),re=new bt.Target(Qt,ft,Ct,wr);if(Ut!==void 0){var Fe=new Ye.Metadata(Ut,dt);re.metadata.push(Fe)}return re}function Mt(J,Qt,Ct,ft,Ut){var dt=yt(Ct.container,Ut.serviceIdentifier),rr=[];return dt.length===Ee.BindingCount.NoBindingsAvailable&&Ct.container.options.autoBindInjectable&&typeof Ut.serviceIdentifier=="function"&&J.getConstructorMetadata(Ut.serviceIdentifier).compilerGeneratedMetadata&&(Ct.container.bind(Ut.serviceIdentifier).toSelf(),dt=yt(Ct.container,Ut.serviceIdentifier)),Qt?rr=dt:rr=dt.filter(function(wr){var re=new lt.Request(wr.serviceIdentifier,Ct,ft,wr,Ut);return wr.constraint(re)}),qt(Ut.serviceIdentifier,rr,Ut,Ct.container),rr}function qt(J,Qt,Ct,ft){switch(Qt.length){case Ee.BindingCount.NoBindingsAvailable:if(Ct.isOptional())return Qt;var Ut=ye.getServiceIdentifierAsString(J),dt=ne.NOT_REGISTERED;throw dt+=ye.listMetadataForTarget(Ut,Ct),dt+=ye.listRegisteredBindingsForServiceIdentifier(ft,Ut,yt),new Error(dt);case Ee.BindingCount.OnlyOneBindingAvailable:if(!Ct.isArray())return Qt;case Ee.BindingCount.MultipleBindingsAvailable:default:if(Ct.isArray())return Qt;var Ut=ye.getServiceIdentifierAsString(J),dt=ne.AMBIGUOUS_MATCH+" "+Ut;throw dt+=ye.listRegisteredBindingsForServiceIdentifier(ft,Ut,yt),new Error(dt)}}function zt(J,Qt,Ct,ft,Ut,dt){var rr,wr;if(Ut===null){rr=Mt(J,Qt,ft,null,dt),wr=new lt.Request(Ct,ft,null,rr,dt);var re=new _e.Plan(ft,wr);ft.addPlan(re)}else rr=Mt(J,Qt,ft,Ut,dt),wr=Ut.addChildRequest(dt.serviceIdentifier,rr,dt);rr.forEach(function(Fe){var N=null;if(dt.isArray())N=wr.addChildRequest(Fe.serviceIdentifier,Fe,dt);else{if(Fe.cache)return;N=wr}if(Fe.type===y.BindingTypeEnum.Instance&&Fe.implementationType!==null){var z=Qe.getDependencies(J,Fe.implementationType);if(!ft.container.options.skipBaseClassChecks){var ce=Qe.getBaseClassDependencyCount(J,Fe.implementationType);if(z.length<ce){var ze=ne.ARGUMENTS_LENGTH_MISMATCH(Qe.getFunctionName(Fe.implementationType));throw new Error(ze)}}z.forEach(function(et){zt(J,!1,et.serviceIdentifier,ft,N,et)})}})}function yt(J,Qt){var Ct=[],ft=gt(J);return ft.hasKey(Qt)?Ct=ft.get(Qt):J.parent!==null&&(Ct=yt(J.parent,Qt)),Ct}function At(J,Qt,Ct,ft,Ut,dt,rr,wr){wr===void 0&&(wr=!1);var re=new se.Context(Qt),Fe=ur(Ct,ft,Ut,"",dt,rr);try{return zt(J,wr,Ut,re,null,Fe),re}catch(N){throw W.isStackOverflowExeption(N)&&re.plan&&ye.circularDependencyToException(re.plan.rootRequest),N}}pe.plan=At;function ar(J,Qt,Ct,ft){var Ut=new bt.Target(y.TargetTypeEnum.Variable,"",Qt,new Ye.Metadata(Ct,ft)),dt=new se.Context(J),rr=new lt.Request(Qt,dt,null,[],Ut);return rr}pe.createMockRequest=ar},88460:function(Br,pe){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.QueryableString=void 0;var K=function(){function Ee(ne){this.str=ne}return Ee.prototype.startsWith=function(ne){return this.str.indexOf(ne)===0},Ee.prototype.endsWith=function(ne){var y="",Te=ne.split("").reverse().join("");return y=this.str.split("").reverse().join(""),this.startsWith.call({str:y},Te)},Ee.prototype.contains=function(ne){return this.str.indexOf(ne)!==-1},Ee.prototype.equals=function(ne){return this.str===ne},Ee.prototype.value=function(){return this.str},Ee}();pe.QueryableString=K},6e3:function(Br,pe,K){"use strict";var Ee=this&&this.__spreadArray||function(Mt,qt){for(var zt=0,yt=qt.length,At=Mt.length;zt<yt;zt++,At++)Mt[At]=qt[zt];return Mt};Object.defineProperty(pe,"__esModule",{value:!0}),pe.getFunctionName=pe.getBaseClassDependencyCount=pe.getDependencies=void 0;var ne=K(5744),y=K(16674),Te=K(28421),W=K(6867),ye=K(55800);Object.defineProperty(pe,"getFunctionName",{enumerable:!0,get:function(){return ye.getFunctionName}});var se=K(18924);function Ye(Mt,qt){var zt=ye.getFunctionName(qt),yt=_e(Mt,zt,qt,!1);return yt}pe.getDependencies=Ye;function _e(Mt,qt,zt,yt){var At=Mt.getConstructorMetadata(zt),ar=At.compilerGeneratedMetadata;if(ar===void 0){var J=y.MISSING_INJECTABLE_ANNOTATION+" "+qt+".";throw new Error(J)}var Qt=At.userGeneratedMetadata,Ct=Object.keys(Qt),ft=zt.length===0&&Ct.length>0,Ut=Ct.length>zt.length,dt=ft||Ut?Ct.length:zt.length,rr=lt(yt,qt,ar,Qt,dt),wr=bt(Mt,zt),re=Ee(Ee([],rr),wr);return re}function Qe(Mt,qt,zt,yt,At){var ar=At[Mt.toString()]||[],J=ur(ar),Qt=J.unmanaged!==!0,Ct=yt[Mt],ft=J.inject||J.multiInject;if(Ct=ft||Ct,Ct instanceof ne.LazyServiceIdentifer&&(Ct=Ct.unwrap()),Qt){var Ut=Ct===Object,dt=Ct===Function,rr=Ct===void 0,wr=Ut||dt||rr;if(!qt&&wr){var re=y.MISSING_INJECT_ANNOTATION+" argument "+Mt+" in class "+zt+".";throw new Error(re)}var Fe=new se.Target(Te.TargetTypeEnum.ConstructorArgument,J.targetName,Ct);return Fe.metadata=ar,Fe}return null}function lt(Mt,qt,zt,yt,At){for(var ar=[],J=0;J<At;J++){var Qt=J,Ct=Qe(Qt,Mt,qt,zt,yt);Ct!==null&&ar.push(Ct)}return ar}function bt(Mt,qt){for(var zt=Mt.getPropertiesMetadata(qt),yt=[],At=Object.keys(zt),ar=0,J=At;ar<J.length;ar++){var Qt=J[ar],Ct=zt[Qt],ft=ur(zt[Qt]),Ut=ft.targetName||Qt,dt=ft.inject||ft.multiInject,rr=new se.Target(Te.TargetTypeEnum.ClassProperty,Ut,dt);rr.metadata=Ct,yt.push(rr)}var wr=Object.getPrototypeOf(qt.prototype).constructor;if(wr!==Object){var re=bt(Mt,wr);yt=Ee(Ee([],yt),re)}return yt}function gt(Mt,qt){var zt=Object.getPrototypeOf(qt.prototype).constructor;if(zt!==Object){var yt=ye.getFunctionName(zt),At=_e(Mt,yt,zt,!0),ar=At.map(function(Ct){return Ct.metadata.filter(function(ft){return ft.key===W.UNMANAGED_TAG})}),J=[].concat.apply([],ar).length,Qt=At.length-J;return Qt>0?Qt:gt(Mt,zt)}else return 0}pe.getBaseClassDependencyCount=gt;function ur(Mt){var qt={};return Mt.forEach(function(zt){qt[zt.key.toString()]=zt.value}),{inject:qt[W.INJECT_TAG],multiInject:qt[W.MULTI_INJECT_TAG],targetName:qt[W.NAME_TAG],unmanaged:qt[W.UNMANAGED_TAG]}}},6748:function(Br,pe,K){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.Request=void 0;var Ee=K(37791),ne=function(){function y(Te,W,ye,se,Ye){this.id=Ee.id(),this.serviceIdentifier=Te,this.parentContext=W,this.parentRequest=ye,this.target=Ye,this.childRequests=[],this.bindings=Array.isArray(se)?se:[se],this.requestScope=ye===null?new Map:null}return y.prototype.addChildRequest=function(Te,W,ye){var se=new y(Te,this.parentContext,this,W,ye);return this.childRequests.push(se),se},y}();pe.Request=ne},18924:function(Br,pe,K){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.Target=void 0;var Ee=K(6867),ne=K(37791),y=K(47738),Te=K(88460),W=function(){function ye(se,Ye,_e,Qe){this.id=ne.id(),this.type=se,this.serviceIdentifier=_e,this.name=new Te.QueryableString(Ye||""),this.metadata=new Array;var lt=null;typeof Qe=="string"?lt=new y.Metadata(Ee.NAMED_TAG,Qe):Qe instanceof y.Metadata&&(lt=Qe),lt!==null&&this.metadata.push(lt)}return ye.prototype.hasTag=function(se){for(var Ye=0,_e=this.metadata;Ye<_e.length;Ye++){var Qe=_e[Ye];if(Qe.key===se)return!0}return!1},ye.prototype.isArray=function(){return this.hasTag(Ee.MULTI_INJECT_TAG)},ye.prototype.matchesArray=function(se){return this.matchesTag(Ee.MULTI_INJECT_TAG)(se)},ye.prototype.isNamed=function(){return this.hasTag(Ee.NAMED_TAG)},ye.prototype.isTagged=function(){return this.metadata.some(function(se){return Ee.NON_CUSTOM_TAG_KEYS.every(function(Ye){return se.key!==Ye})})},ye.prototype.isOptional=function(){return this.matchesTag(Ee.OPTIONAL_TAG)(!0)},ye.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(se){return se.key===Ee.NAMED_TAG})[0]:null},ye.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(se){return Ee.NON_CUSTOM_TAG_KEYS.every(function(Ye){return se.key!==Ye})}):null},ye.prototype.matchesNamedTag=function(se){return this.matchesTag(Ee.NAMED_TAG)(se)},ye.prototype.matchesTag=function(se){var Ye=this;return function(_e){for(var Qe=0,lt=Ye.metadata;Qe<lt.length;Qe++){var bt=lt[Qe];if(bt.key===se&&bt.value===_e)return!0}return!1}},ye}();pe.Target=W},52279:function(Br,pe,K){"use strict";var Ee=this&&this.__spreadArray||function(_e,Qe){for(var lt=0,bt=Qe.length,gt=_e.length;lt<bt;lt++,gt++)_e[gt]=Qe[lt];return _e};Object.defineProperty(pe,"__esModule",{value:!0}),pe.resolveInstance=void 0;var ne=K(16674),y=K(28421),Te=K(6867);function W(_e,Qe,lt){var bt=Qe.filter(function(ur){return ur.target!==null&&ur.target.type===y.TargetTypeEnum.ClassProperty}),gt=bt.map(lt);return bt.forEach(function(ur,Mt){var qt="";qt=ur.target.name.value();var zt=gt[Mt];_e[qt]=zt}),_e}function ye(_e,Qe){return new(_e.bind.apply(_e,Ee([void 0],Qe)))}function se(_e,Qe){if(Reflect.hasMetadata(Te.POST_CONSTRUCT,_e)){var lt=Reflect.getMetadata(Te.POST_CONSTRUCT,_e);try{Qe[lt.value]()}catch(bt){throw new Error(ne.POST_CONSTRUCT_ERROR(_e.name,bt.message))}}}function Ye(_e,Qe,lt){var bt=null;if(Qe.length>0){var gt=Qe.filter(function(Mt){return Mt.target!==null&&Mt.target.type===y.TargetTypeEnum.ConstructorArgument}),ur=gt.map(lt);bt=ye(_e,ur),bt=W(bt,Qe,lt)}else bt=new _e;return se(_e,bt),bt}pe.resolveInstance=Ye},31927:function(Br,pe,K){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.resolve=void 0;var Ee=K(16674),ne=K(28421),y=K(85265),Te=K(55800),W=K(52279),ye=function(_e,Qe,lt){try{return lt()}catch(bt){throw y.isStackOverflowExeption(bt)?new Error(Ee.CIRCULAR_DEPENDENCY_IN_FACTORY(_e,Qe.toString())):bt}},se=function(_e){return function(Qe){Qe.parentContext.setCurrentRequest(Qe);var lt=Qe.bindings,bt=Qe.childRequests,gt=Qe.target&&Qe.target.isArray(),ur=!Qe.parentRequest||!Qe.parentRequest.target||!Qe.target||!Qe.parentRequest.target.matchesArray(Qe.target.serviceIdentifier);if(gt&&ur)return bt.map(function(ar){var J=se(_e);return J(ar)});var Mt=null;if(Qe.target.isOptional()&&lt.length===0)return;var qt=lt[0],zt=qt.scope===ne.BindingScopeEnum.Singleton,yt=qt.scope===ne.BindingScopeEnum.Request;if(zt&&qt.activated)return qt.cache;if(yt&&_e!==null&&_e.has(qt.id))return _e.get(qt.id);if(qt.type===ne.BindingTypeEnum.ConstantValue)Mt=qt.cache,qt.activated=!0;else if(qt.type===ne.BindingTypeEnum.Function)Mt=qt.cache,qt.activated=!0;else if(qt.type===ne.BindingTypeEnum.Constructor)Mt=qt.implementationType;else if(qt.type===ne.BindingTypeEnum.DynamicValue&&qt.dynamicValue!==null)Mt=ye("toDynamicValue",qt.serviceIdentifier,function(){return qt.dynamicValue(Qe.parentContext)});else if(qt.type===ne.BindingTypeEnum.Factory&&qt.factory!==null)Mt=ye("toFactory",qt.serviceIdentifier,function(){return qt.factory(Qe.parentContext)});else if(qt.type===ne.BindingTypeEnum.Provider&&qt.provider!==null)Mt=ye("toProvider",qt.serviceIdentifier,function(){return qt.provider(Qe.parentContext)});else if(qt.type===ne.BindingTypeEnum.Instance&&qt.implementationType!==null)Mt=W.resolveInstance(qt.implementationType,bt,se(_e));else{var At=Te.getServiceIdentifierAsString(Qe.serviceIdentifier);throw new Error(Ee.INVALID_BINDING_TYPE+" "+At)}return typeof qt.onActivation=="function"&&(Mt=qt.onActivation(Qe.parentContext,Mt)),zt&&(qt.cache=Mt,qt.activated=!0),yt&&_e!==null&&!_e.has(qt.id)&&_e.set(qt.id,Mt),Mt}};function Ye(_e){var Qe=se(_e.plan.rootRequest.requestScope);return Qe(_e.plan.rootRequest)}pe.resolve=Ye},83366:function(Br,pe,K){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.BindingInSyntax=void 0;var Ee=K(28421),ne=K(71325),y=function(){function Te(W){this._binding=W}return Te.prototype.inRequestScope=function(){return this._binding.scope=Ee.BindingScopeEnum.Request,new ne.BindingWhenOnSyntax(this._binding)},Te.prototype.inSingletonScope=function(){return this._binding.scope=Ee.BindingScopeEnum.Singleton,new ne.BindingWhenOnSyntax(this._binding)},Te.prototype.inTransientScope=function(){return this._binding.scope=Ee.BindingScopeEnum.Transient,new ne.BindingWhenOnSyntax(this._binding)},Te}();pe.BindingInSyntax=y},74889:function(Br,pe,K){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.BindingInWhenOnSyntax=void 0;var Ee=K(83366),ne=K(51811),y=K(98370),Te=function(){function W(ye){this._binding=ye,this._bindingWhenSyntax=new y.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new ne.BindingOnSyntax(this._binding),this._bindingInSyntax=new Ee.BindingInSyntax(ye)}return W.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},W.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},W.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},W.prototype.when=function(ye){return this._bindingWhenSyntax.when(ye)},W.prototype.whenTargetNamed=function(ye){return this._bindingWhenSyntax.whenTargetNamed(ye)},W.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},W.prototype.whenTargetTagged=function(ye,se){return this._bindingWhenSyntax.whenTargetTagged(ye,se)},W.prototype.whenInjectedInto=function(ye){return this._bindingWhenSyntax.whenInjectedInto(ye)},W.prototype.whenParentNamed=function(ye){return this._bindingWhenSyntax.whenParentNamed(ye)},W.prototype.whenParentTagged=function(ye,se){return this._bindingWhenSyntax.whenParentTagged(ye,se)},W.prototype.whenAnyAncestorIs=function(ye){return this._bindingWhenSyntax.whenAnyAncestorIs(ye)},W.prototype.whenNoAncestorIs=function(ye){return this._bindingWhenSyntax.whenNoAncestorIs(ye)},W.prototype.whenAnyAncestorNamed=function(ye){return this._bindingWhenSyntax.whenAnyAncestorNamed(ye)},W.prototype.whenAnyAncestorTagged=function(ye,se){return this._bindingWhenSyntax.whenAnyAncestorTagged(ye,se)},W.prototype.whenNoAncestorNamed=function(ye){return this._bindingWhenSyntax.whenNoAncestorNamed(ye)},W.prototype.whenNoAncestorTagged=function(ye,se){return this._bindingWhenSyntax.whenNoAncestorTagged(ye,se)},W.prototype.whenAnyAncestorMatches=function(ye){return this._bindingWhenSyntax.whenAnyAncestorMatches(ye)},W.prototype.whenNoAncestorMatches=function(ye){return this._bindingWhenSyntax.whenNoAncestorMatches(ye)},W.prototype.onActivation=function(ye){return this._bindingOnSyntax.onActivation(ye)},W}();pe.BindingInWhenOnSyntax=Te},51811:function(Br,pe,K){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.BindingOnSyntax=void 0;var Ee=K(98370),ne=function(){function y(Te){this._binding=Te}return y.prototype.onActivation=function(Te){return this._binding.onActivation=Te,new Ee.BindingWhenSyntax(this._binding)},y}();pe.BindingOnSyntax=ne},15451:function(Br,pe,K){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.BindingToSyntax=void 0;var Ee=K(16674),ne=K(28421),y=K(74889),Te=K(71325),W=function(){function ye(se){this._binding=se}return ye.prototype.to=function(se){return this._binding.type=ne.BindingTypeEnum.Instance,this._binding.implementationType=se,new y.BindingInWhenOnSyntax(this._binding)},ye.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+Ee.INVALID_TO_SELF_VALUE);var se=this._binding.serviceIdentifier;return this.to(se)},ye.prototype.toConstantValue=function(se){return this._binding.type=ne.BindingTypeEnum.ConstantValue,this._binding.cache=se,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=ne.BindingScopeEnum.Singleton,new Te.BindingWhenOnSyntax(this._binding)},ye.prototype.toDynamicValue=function(se){return this._binding.type=ne.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=se,this._binding.implementationType=null,new y.BindingInWhenOnSyntax(this._binding)},ye.prototype.toConstructor=function(se){return this._binding.type=ne.BindingTypeEnum.Constructor,this._binding.implementationType=se,this._binding.scope=ne.BindingScopeEnum.Singleton,new Te.BindingWhenOnSyntax(this._binding)},ye.prototype.toFactory=function(se){return this._binding.type=ne.BindingTypeEnum.Factory,this._binding.factory=se,this._binding.scope=ne.BindingScopeEnum.Singleton,new Te.BindingWhenOnSyntax(this._binding)},ye.prototype.toFunction=function(se){if(typeof se!="function")throw new Error(Ee.INVALID_FUNCTION_BINDING);var Ye=this.toConstantValue(se);return this._binding.type=ne.BindingTypeEnum.Function,this._binding.scope=ne.BindingScopeEnum.Singleton,Ye},ye.prototype.toAutoFactory=function(se){return this._binding.type=ne.BindingTypeEnum.Factory,this._binding.factory=function(Ye){var _e=function(){return Ye.container.get(se)};return _e},this._binding.scope=ne.BindingScopeEnum.Singleton,new Te.BindingWhenOnSyntax(this._binding)},ye.prototype.toProvider=function(se){return this._binding.type=ne.BindingTypeEnum.Provider,this._binding.provider=se,this._binding.scope=ne.BindingScopeEnum.Singleton,new Te.BindingWhenOnSyntax(this._binding)},ye.prototype.toService=function(se){this.toDynamicValue(function(Ye){return Ye.container.get(se)})},ye}();pe.BindingToSyntax=W},71325:function(Br,pe,K){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.BindingWhenOnSyntax=void 0;var Ee=K(51811),ne=K(98370),y=function(){function Te(W){this._binding=W,this._bindingWhenSyntax=new ne.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new Ee.BindingOnSyntax(this._binding)}return Te.prototype.when=function(W){return this._bindingWhenSyntax.when(W)},Te.prototype.whenTargetNamed=function(W){return this._bindingWhenSyntax.whenTargetNamed(W)},Te.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},Te.prototype.whenTargetTagged=function(W,ye){return this._bindingWhenSyntax.whenTargetTagged(W,ye)},Te.prototype.whenInjectedInto=function(W){return this._bindingWhenSyntax.whenInjectedInto(W)},Te.prototype.whenParentNamed=function(W){return this._bindingWhenSyntax.whenParentNamed(W)},Te.prototype.whenParentTagged=function(W,ye){return this._bindingWhenSyntax.whenParentTagged(W,ye)},Te.prototype.whenAnyAncestorIs=function(W){return this._bindingWhenSyntax.whenAnyAncestorIs(W)},Te.prototype.whenNoAncestorIs=function(W){return this._bindingWhenSyntax.whenNoAncestorIs(W)},Te.prototype.whenAnyAncestorNamed=function(W){return this._bindingWhenSyntax.whenAnyAncestorNamed(W)},Te.prototype.whenAnyAncestorTagged=function(W,ye){return this._bindingWhenSyntax.whenAnyAncestorTagged(W,ye)},Te.prototype.whenNoAncestorNamed=function(W){return this._bindingWhenSyntax.whenNoAncestorNamed(W)},Te.prototype.whenNoAncestorTagged=function(W,ye){return this._bindingWhenSyntax.whenNoAncestorTagged(W,ye)},Te.prototype.whenAnyAncestorMatches=function(W){return this._bindingWhenSyntax.whenAnyAncestorMatches(W)},Te.prototype.whenNoAncestorMatches=function(W){return this._bindingWhenSyntax.whenNoAncestorMatches(W)},Te.prototype.onActivation=function(W){return this._bindingOnSyntax.onActivation(W)},Te}();pe.BindingWhenOnSyntax=y},98370:function(Br,pe,K){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.BindingWhenSyntax=void 0;var Ee=K(51811),ne=K(80758),y=function(){function Te(W){this._binding=W}return Te.prototype.when=function(W){return this._binding.constraint=W,new Ee.BindingOnSyntax(this._binding)},Te.prototype.whenTargetNamed=function(W){return this._binding.constraint=ne.namedConstraint(W),new Ee.BindingOnSyntax(this._binding)},Te.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(W){var ye=W.target!==null&&!W.target.isNamed()&&!W.target.isTagged();return ye},new Ee.BindingOnSyntax(this._binding)},Te.prototype.whenTargetTagged=function(W,ye){return this._binding.constraint=ne.taggedConstraint(W)(ye),new Ee.BindingOnSyntax(this._binding)},Te.prototype.whenInjectedInto=function(W){return this._binding.constraint=function(ye){return ne.typeConstraint(W)(ye.parentRequest)},new Ee.BindingOnSyntax(this._binding)},Te.prototype.whenParentNamed=function(W){return this._binding.constraint=function(ye){return ne.namedConstraint(W)(ye.parentRequest)},new Ee.BindingOnSyntax(this._binding)},Te.prototype.whenParentTagged=function(W,ye){return this._binding.constraint=function(se){return ne.taggedConstraint(W)(ye)(se.parentRequest)},new Ee.BindingOnSyntax(this._binding)},Te.prototype.whenAnyAncestorIs=function(W){return this._binding.constraint=function(ye){return ne.traverseAncerstors(ye,ne.typeConstraint(W))},new Ee.BindingOnSyntax(this._binding)},Te.prototype.whenNoAncestorIs=function(W){return this._binding.constraint=function(ye){return!ne.traverseAncerstors(ye,ne.typeConstraint(W))},new Ee.BindingOnSyntax(this._binding)},Te.prototype.whenAnyAncestorNamed=function(W){return this._binding.constraint=function(ye){return ne.traverseAncerstors(ye,ne.namedConstraint(W))},new Ee.BindingOnSyntax(this._binding)},Te.prototype.whenNoAncestorNamed=function(W){return this._binding.constraint=function(ye){return!ne.traverseAncerstors(ye,ne.namedConstraint(W))},new Ee.BindingOnSyntax(this._binding)},Te.prototype.whenAnyAncestorTagged=function(W,ye){return this._binding.constraint=function(se){return ne.traverseAncerstors(se,ne.taggedConstraint(W)(ye))},new Ee.BindingOnSyntax(this._binding)},Te.prototype.whenNoAncestorTagged=function(W,ye){return this._binding.constraint=function(se){return!ne.traverseAncerstors(se,ne.taggedConstraint(W)(ye))},new Ee.BindingOnSyntax(this._binding)},Te.prototype.whenAnyAncestorMatches=function(W){return this._binding.constraint=function(ye){return ne.traverseAncerstors(ye,W)},new Ee.BindingOnSyntax(this._binding)},Te.prototype.whenNoAncestorMatches=function(W){return this._binding.constraint=function(ye){return!ne.traverseAncerstors(ye,W)},new Ee.BindingOnSyntax(this._binding)},Te}();pe.BindingWhenSyntax=y},80758:function(Br,pe,K){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.typeConstraint=pe.namedConstraint=pe.taggedConstraint=pe.traverseAncerstors=void 0;var Ee=K(6867),ne=K(47738),y=function(se,Ye){var _e=se.parentRequest;return _e!==null?Ye(_e)?!0:y(_e,Ye):!1};pe.traverseAncerstors=y;var Te=function(se){return function(Ye){var _e=function(Qe){return Qe!==null&&Qe.target!==null&&Qe.target.matchesTag(se)(Ye)};return _e.metaData=new ne.Metadata(se,Ye),_e}};pe.taggedConstraint=Te;var W=Te(Ee.NAMED_TAG);pe.namedConstraint=W;var ye=function(se){return function(Ye){var _e=null;if(Ye!==null)if(_e=Ye.bindings[0],typeof se=="string"){var Qe=_e.serviceIdentifier;return Qe===se}else{var lt=Ye.bindings[0].implementationType;return se===lt}return!1}};pe.typeConstraint=ye},70600:function(Br,pe){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.multiBindToService=void 0;var K=function(Ee){return function(ne){return function(){for(var y=[],Te=0;Te<arguments.length;Te++)y[Te]=arguments[Te];return y.forEach(function(W){return Ee.bind(W).toService(ne)})}}};pe.multiBindToService=K},85265:function(Br,pe,K){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.isStackOverflowExeption=void 0;var Ee=K(16674);function ne(y){return y instanceof RangeError||y.message===Ee.STACK_OVERFLOW}pe.isStackOverflowExeption=ne},37791:function(Br,pe){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.id=void 0;var K=0;function Ee(){return K++}pe.id=Ee},55800:function(Br,pe,K){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.circularDependencyToException=pe.listMetadataForTarget=pe.listRegisteredBindingsForServiceIdentifier=pe.getServiceIdentifierAsString=pe.getFunctionName=void 0;var Ee=K(16674);function ne(_e){if(typeof _e=="function"){var Qe=_e;return Qe.name}else{if(typeof _e=="symbol")return _e.toString();var Qe=_e;return Qe}}pe.getServiceIdentifierAsString=ne;function y(_e,Qe,lt){var bt="",gt=lt(_e,Qe);return gt.length!==0&&(bt=`
Registered bindings:`,gt.forEach(function(ur){var Mt="Object";ur.implementationType!==null&&(Mt=Ye(ur.implementationType)),bt=bt+`
 `+Mt,ur.constraint.metaData&&(bt=bt+" - "+ur.constraint.metaData)})),bt}pe.listRegisteredBindingsForServiceIdentifier=y;function Te(_e,Qe){return _e.parentRequest===null?!1:_e.parentRequest.serviceIdentifier===Qe?!0:Te(_e.parentRequest,Qe)}function W(_e){function Qe(bt,gt){gt===void 0&&(gt=[]);var ur=ne(bt.serviceIdentifier);return gt.push(ur),bt.parentRequest!==null?Qe(bt.parentRequest,gt):gt}var lt=Qe(_e);return lt.reverse().join(" --> ")}function ye(_e){_e.childRequests.forEach(function(Qe){if(Te(Qe,Qe.serviceIdentifier)){var lt=W(Qe);throw new Error(Ee.CIRCULAR_DEPENDENCY+" "+lt)}else ye(Qe)})}pe.circularDependencyToException=ye;function se(_e,Qe){if(Qe.isTagged()||Qe.isNamed()){var lt="",bt=Qe.getNamedTag(),gt=Qe.getCustomTags();return bt!==null&&(lt+=bt.toString()+`
`),gt!==null&&gt.forEach(function(ur){lt+=ur.toString()+`
`})," "+_e+`
 `+_e+" - "+lt}else return" "+_e}pe.listMetadataForTarget=se;function Ye(_e){if(_e.name)return _e.name;var Qe=_e.toString(),lt=Qe.match(/^function\s*([^\s(]+)/);return lt?lt[1]:"Anonymous function: "+Qe}pe.getFunctionName=Ye},31745:function(Br){"use strict";Br.exports=K,Br.exports.default=K;var pe=1e20;function K(W,ye,se,Ye,_e,Qe){this.fontSize=W||24,this.buffer=ye===void 0?3:ye,this.cutoff=Ye||.25,this.fontFamily=_e||"sans-serif",this.fontWeight=Qe||"normal",this.radius=se||8;var lt=this.size=this.fontSize+this.buffer*2,bt=lt+this.buffer*2,gt=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;gt?this.canvas=my.createOffscreenCanvas(lt,lt,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=lt),this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(bt*bt),this.gridInner=new Float64Array(bt*bt),this.f=new Float64Array(bt),this.z=new Float64Array(bt+1),this.v=new Uint16Array(bt),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,gt?this.middle=Math.round(lt/2*1):this.middle=Math.round(lt/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Ee(W,ye,se,Ye,_e,Qe,lt){Qe.fill(pe,0,ye*se),lt.fill(0,0,ye*se);for(var bt=(ye-Ye)/2,gt=0;gt<_e;gt++)for(var ur=0;ur<Ye;ur++){var Mt=(gt+bt)*ye+ur+bt,qt=W.data[4*(gt*Ye+ur)+3]/255;if(qt===1)Qe[Mt]=0,lt[Mt]=pe;else if(qt===0)Qe[Mt]=pe,lt[Mt]=0;else{var zt=Math.max(0,.5-qt),yt=Math.max(0,qt-.5);Qe[Mt]=zt*zt,lt[Mt]=yt*yt}}}function ne(W,ye,se,Ye,_e,Qe,lt){for(var bt=0;bt<ye*se;bt++){var gt=Math.sqrt(Ye[bt])-Math.sqrt(_e[bt]);W[bt]=Math.round(255-255*(gt/Qe+lt))}}K.prototype._draw=function(W,ye){var se=this.ctx.measureText(W),Ye=se.width,_e=2*this.buffer,Qe,lt,bt,gt,ur,Mt,qt,zt;ye&&this.useMetrics?(ur=Math.floor(se.actualBoundingBoxAscent),zt=this.buffer+Math.ceil(se.actualBoundingBoxAscent),Mt=this.buffer,qt=this.buffer,lt=Math.min(this.size,Math.ceil(se.actualBoundingBoxRight-se.actualBoundingBoxLeft)),gt=Math.min(this.size-Mt,Math.ceil(se.actualBoundingBoxAscent+se.actualBoundingBoxDescent)),Qe=lt+_e,bt=gt+_e,this.ctx.textBaseline="alphabetic"):(Qe=lt=this.size,bt=gt=this.size,ur=19*this.fontSize/24,Mt=qt=0,zt=this.middle,this.ctx.textBaseline="middle");var yt;lt&&gt&&(this.ctx.clearRect(qt,Mt,lt,gt),this.ctx.fillText(W,this.buffer,zt),yt=this.ctx.getImageData(qt,Mt,lt,gt));var At=new Uint8ClampedArray(Qe*bt);return Ee(yt,Qe,bt,lt,gt,this.gridOuter,this.gridInner),y(this.gridOuter,Qe,bt,this.f,this.v,this.z),y(this.gridInner,Qe,bt,this.f,this.v,this.z),ne(At,Qe,bt,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:At,metrics:{width:lt,height:gt,sdfWidth:Qe,sdfHeight:bt,top:ur,left:0,advance:Ye}}},K.prototype.draw=function(W){return this._draw(W,!1).data},K.prototype.drawWithMetrics=function(W){return this._draw(W,!0)};function y(W,ye,se,Ye,_e,Qe){for(var lt=0;lt<ye;lt++)Te(W,lt,ye,se,Ye,_e,Qe);for(var bt=0;bt<se;bt++)Te(W,bt*ye,1,ye,Ye,_e,Qe)}function Te(W,ye,se,Ye,_e,Qe,lt){var bt,gt,ur,Mt;for(Qe[0]=0,lt[0]=-pe,lt[1]=pe,bt=0;bt<Ye;bt++)_e[bt]=W[ye+bt*se];for(bt=1,gt=0,ur=0;bt<Ye;bt++){do Mt=Qe[gt],ur=(_e[bt]-_e[Mt]+bt*bt-Mt*Mt)/(bt-Mt)/2;while(ur<=lt[gt]&&--gt>-1);gt++,Qe[gt]=bt,lt[gt]=ur,lt[gt+1]=pe}for(bt=0,gt=0;bt<Ye;bt++){for(;lt[gt+1]<bt;)gt++;Mt=Qe[gt],W[ye+bt*se]=_e[Mt]+(bt-Mt)*(bt-Mt)}}},18857:function(Br,pe,K){"use strict";K.r(pe),K.d(pe,{Function:function(){return Qs},Interpreter:function(){return Ia},default:function(){return Pl},evaluate:function(){return $u},vm:function(){return Ee}});var Ee={};K.r(Ee),K.d(Ee,{Script:function(){return al},compileFunction:function(){return ff},createContext:function(){return Oc},runInContext:function(){return Ms},runInNewContext:function(){return hf}});var ne={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},y="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",Te={5:y,"5module":y+" export import",6:y+" const class extends export import super"},W=/^in(stanceof)?$/,ye="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",se="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",Ye=new RegExp("["+ye+"]"),_e=new RegExp("["+ye+se+"]");ye=se=null;var Qe=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],lt=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function bt(b,k){for(var U=65536,R=0;R<k.length;R+=2){if(U+=k[R],U>b)return!1;if(U+=k[R+1],U>=b)return!0}}function gt(b,k){return b<65?b===36:b<91?!0:b<97?b===95:b<123?!0:b<=65535?b>=170&&Ye.test(String.fromCharCode(b)):k===!1?!1:bt(b,Qe)}function ur(b,k){return b<48?b===36:b<58?!0:b<65?!1:b<91?!0:b<97?b===95:b<123?!0:b<=65535?b>=170&&_e.test(String.fromCharCode(b)):k===!1?!1:bt(b,Qe)||bt(b,lt)}var Mt=function(k,U){U===void 0&&(U={}),this.label=k,this.keyword=U.keyword,this.beforeExpr=!!U.beforeExpr,this.startsExpr=!!U.startsExpr,this.isLoop=!!U.isLoop,this.isAssign=!!U.isAssign,this.prefix=!!U.prefix,this.postfix=!!U.postfix,this.binop=U.binop||null,this.updateContext=null};function qt(b,k){return new Mt(b,{beforeExpr:!0,binop:k})}var zt={beforeExpr:!0},yt={startsExpr:!0},At={};function ar(b,k){return k===void 0&&(k={}),k.keyword=b,At[b]=new Mt(b,k)}var J={num:new Mt("num",yt),regexp:new Mt("regexp",yt),string:new Mt("string",yt),name:new Mt("name",yt),eof:new Mt("eof"),bracketL:new Mt("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new Mt("]"),braceL:new Mt("{",{beforeExpr:!0,startsExpr:!0}),braceR:new Mt("}"),parenL:new Mt("(",{beforeExpr:!0,startsExpr:!0}),parenR:new Mt(")"),comma:new Mt(",",zt),semi:new Mt(";",zt),colon:new Mt(":",zt),dot:new Mt("."),question:new Mt("?",zt),questionDot:new Mt("?."),arrow:new Mt("=>",zt),template:new Mt("template"),invalidTemplate:new Mt("invalidTemplate"),ellipsis:new Mt("...",zt),backQuote:new Mt("`",yt),dollarBraceL:new Mt("${",{beforeExpr:!0,startsExpr:!0}),eq:new Mt("=",{beforeExpr:!0,isAssign:!0}),assign:new Mt("_=",{beforeExpr:!0,isAssign:!0}),incDec:new Mt("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new Mt("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:qt("||",1),logicalAND:qt("&&",2),bitwiseOR:qt("|",3),bitwiseXOR:qt("^",4),bitwiseAND:qt("&",5),equality:qt("==/!=/===/!==",6),relational:qt("</>/<=/>=",7),bitShift:qt("<</>>/>>>",8),plusMin:new Mt("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:qt("%",10),star:qt("*",10),slash:qt("/",10),starstar:new Mt("**",{beforeExpr:!0}),coalesce:qt("??",1),_break:ar("break"),_case:ar("case",zt),_catch:ar("catch"),_continue:ar("continue"),_debugger:ar("debugger"),_default:ar("default",zt),_do:ar("do",{isLoop:!0,beforeExpr:!0}),_else:ar("else",zt),_finally:ar("finally"),_for:ar("for",{isLoop:!0}),_function:ar("function",yt),_if:ar("if"),_return:ar("return",zt),_switch:ar("switch"),_throw:ar("throw",zt),_try:ar("try"),_var:ar("var"),_const:ar("const"),_while:ar("while",{isLoop:!0}),_with:ar("with"),_new:ar("new",{beforeExpr:!0,startsExpr:!0}),_this:ar("this",yt),_super:ar("super",yt),_class:ar("class",yt),_extends:ar("extends",zt),_export:ar("export"),_import:ar("import",yt),_null:ar("null",yt),_true:ar("true",yt),_false:ar("false",yt),_in:ar("in",{beforeExpr:!0,binop:7}),_instanceof:ar("instanceof",{beforeExpr:!0,binop:7}),_typeof:ar("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:ar("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:ar("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},Qt=/\r\n?|\n|\u2028|\u2029/,Ct=new RegExp(Qt.source,"g");function ft(b,k){return b===10||b===13||!k&&(b===8232||b===8233)}var Ut=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,dt=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,rr=Object.prototype,wr=rr.hasOwnProperty,re=rr.toString;function Fe(b,k){return wr.call(b,k)}var N=Array.isArray||function(b){return re.call(b)==="[object Array]"};function z(b){return new RegExp("^(?:"+b.replace(/ /g,"|")+")$")}var ce=function(k,U){this.line=k,this.column=U};ce.prototype.offset=function(k){return new ce(this.line,this.column+k)};var ze=function(k,U,R){this.start=U,this.end=R,k.sourceFile!==null&&(this.source=k.sourceFile)};function et(b,k){for(var U=1,R=0;;){Ct.lastIndex=R;var ie=Ct.exec(b);if(ie&&ie.index<k)++U,R=ie.index+ie[0].length;else return new ce(U,k-R)}}var ht={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function Rt(b){var k={};for(var U in ht)k[U]=b&&Fe(b,U)?b[U]:ht[U];if(k.ecmaVersion>=2015&&(k.ecmaVersion-=2009),k.allowReserved==null&&(k.allowReserved=k.ecmaVersion<5),N(k.onToken)){var R=k.onToken;k.onToken=function(ie){return R.push(ie)}}return N(k.onComment)&&(k.onComment=Jt(k,k.onComment)),k}function Jt(b,k){return function(U,R,ie,Pe,ct,Ft){var Bt={type:U?"Block":"Line",value:R,start:ie,end:Pe};b.locations&&(Bt.loc=new ze(this,ct,Ft)),b.ranges&&(Bt.range=[ie,Pe]),k.push(Bt)}}var Or=1,Tr=2,Pn=Or|Tr,Nr=4,wn=8,Xi=16,mi=32,si=64,ki=128;function bi(b,k){return Tr|(b?Nr:0)|(k?wn:0)}var li=0,Zn=1,qn=2,ro=3,ka=4,oa=5,Tt=function(k,U,R){this.options=k=Rt(k),this.sourceFile=k.sourceFile,this.keywords=z(Te[k.ecmaVersion>=6?6:k.sourceType==="module"?"5module":5]);var ie="";if(k.allowReserved!==!0){for(var Pe=k.ecmaVersion;!(ie=ne[Pe]);Pe--);k.sourceType==="module"&&(ie+=" await")}this.reservedWords=z(ie);var ct=(ie?ie+" ":"")+ne.strict;this.reservedWordsStrict=z(ct),this.reservedWordsStrictBind=z(ct+" "+ne.strictBind),this.input=String(U),this.containsEsc=!1,R?(this.pos=R,this.lineStart=this.input.lastIndexOf(`
`,R-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(Qt).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=J.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=k.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&k.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(Or),this.regexpState=null},ge={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};Tt.prototype.parse=function(){var k=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(k)},ge.inFunction.get=function(){return(this.currentVarScope().flags&Tr)>0},ge.inGenerator.get=function(){return(this.currentVarScope().flags&wn)>0},ge.inAsync.get=function(){return(this.currentVarScope().flags&Nr)>0},ge.allowSuper.get=function(){return(this.currentThisScope().flags&si)>0},ge.allowDirectSuper.get=function(){return(this.currentThisScope().flags&ki)>0},ge.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},Tt.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&Tr)>0},Tt.extend=function(){for(var k=[],U=arguments.length;U--;)k[U]=arguments[U];for(var R=this,ie=0;ie<k.length;ie++)R=k[ie](R);return R},Tt.parse=function(k,U){return new this(U,k).parse()},Tt.parseExpressionAt=function(k,U,R){var ie=new this(R,k,U);return ie.nextToken(),ie.parseExpression()},Tt.tokenizer=function(k,U){return new this(U,k)},Object.defineProperties(Tt.prototype,ge);var ue=Tt.prototype,we=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;ue.strictDirective=function(b){for(;;){dt.lastIndex=b,b+=dt.exec(this.input)[0].length;var k=we.exec(this.input.slice(b));if(!k)return!1;if((k[1]||k[2])==="use strict"){dt.lastIndex=b+k[0].length;var U=dt.exec(this.input),R=U.index+U[0].length,ie=this.input.charAt(R);return ie===";"||ie==="}"||Qt.test(U[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(ie)||ie==="!"&&this.input.charAt(R+1)==="=")}b+=k[0].length,dt.lastIndex=b,b+=dt.exec(this.input)[0].length,this.input[b]===";"&&b++}},ue.eat=function(b){return this.type===b?(this.next(),!0):!1},ue.isContextual=function(b){return this.type===J.name&&this.value===b&&!this.containsEsc},ue.eatContextual=function(b){return this.isContextual(b)?(this.next(),!0):!1},ue.expectContextual=function(b){this.eatContextual(b)||this.unexpected()},ue.canInsertSemicolon=function(){return this.type===J.eof||this.type===J.braceR||Qt.test(this.input.slice(this.lastTokEnd,this.start))},ue.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},ue.semicolon=function(){!this.eat(J.semi)&&!this.insertSemicolon()&&this.unexpected()},ue.afterTrailingComma=function(b,k){if(this.type===b)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),k||this.next(),!0},ue.expect=function(b){this.eat(b)||this.unexpected()},ue.unexpected=function(b){this.raise(b!=null?b:this.start,"Unexpected token")};function Z(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}ue.checkPatternErrors=function(b,k){if(!!b){b.trailingComma>-1&&this.raiseRecoverable(b.trailingComma,"Comma is not permitted after the rest element");var U=k?b.parenthesizedAssign:b.parenthesizedBind;U>-1&&this.raiseRecoverable(U,"Parenthesized pattern")}},ue.checkExpressionErrors=function(b,k){if(!b)return!1;var U=b.shorthandAssign,R=b.doubleProto;if(!k)return U>=0||R>=0;U>=0&&this.raise(U,"Shorthand property assignments are valid only in destructuring patterns"),R>=0&&this.raiseRecoverable(R,"Redefinition of __proto__ property")},ue.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},ue.isSimpleAssignTarget=function(b){return b.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(b.expression):b.type==="Identifier"||b.type==="MemberExpression"};var Je=Tt.prototype;Je.parseTopLevel=function(b){var k={};for(b.body||(b.body=[]);this.type!==J.eof;){var U=this.parseStatement(null,!0,k);b.body.push(U)}if(this.inModule)for(var R=0,ie=Object.keys(this.undefinedExports);R<ie.length;R+=1){var Pe=ie[R];this.raiseRecoverable(this.undefinedExports[Pe].start,"Export '"+Pe+"' is not defined")}return this.adaptDirectivePrologue(b.body),this.next(),b.sourceType=this.options.sourceType,this.finishNode(b,"Program")};var Xt={kind:"loop"},Dr={kind:"switch"};Je.isLet=function(b){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;dt.lastIndex=this.pos;var k=dt.exec(this.input),U=this.pos+k[0].length,R=this.input.charCodeAt(U);if(R===91)return!0;if(b)return!1;if(R===123)return!0;if(gt(R,!0)){for(var ie=U+1;ur(this.input.charCodeAt(ie),!0);)++ie;var Pe=this.input.slice(U,ie);if(!W.test(Pe))return!0}return!1},Je.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;dt.lastIndex=this.pos;var b=dt.exec(this.input),k=this.pos+b[0].length;return!Qt.test(this.input.slice(this.pos,k))&&this.input.slice(k,k+8)==="function"&&(k+8===this.input.length||!ur(this.input.charAt(k+8)))},Je.parseStatement=function(b,k,U){var R=this.type,ie=this.startNode(),Pe;switch(this.isLet(b)&&(R=J._var,Pe="let"),R){case J._break:case J._continue:return this.parseBreakContinueStatement(ie,R.keyword);case J._debugger:return this.parseDebuggerStatement(ie);case J._do:return this.parseDoStatement(ie);case J._for:return this.parseForStatement(ie);case J._function:return b&&(this.strict||b!=="if"&&b!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(ie,!1,!b);case J._class:return b&&this.unexpected(),this.parseClass(ie,!0);case J._if:return this.parseIfStatement(ie);case J._return:return this.parseReturnStatement(ie);case J._switch:return this.parseSwitchStatement(ie);case J._throw:return this.parseThrowStatement(ie);case J._try:return this.parseTryStatement(ie);case J._const:case J._var:return Pe=Pe||this.value,b&&Pe!=="var"&&this.unexpected(),this.parseVarStatement(ie,Pe);case J._while:return this.parseWhileStatement(ie);case J._with:return this.parseWithStatement(ie);case J.braceL:return this.parseBlock(!0,ie);case J.semi:return this.parseEmptyStatement(ie);case J._export:case J._import:if(this.options.ecmaVersion>10&&R===J._import){dt.lastIndex=this.pos;var ct=dt.exec(this.input),Ft=this.pos+ct[0].length,Bt=this.input.charCodeAt(Ft);if(Bt===40||Bt===46)return this.parseExpressionStatement(ie,this.parseExpression())}return this.options.allowImportExportEverywhere||(k||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),R===J._import?this.parseImport(ie):this.parseExport(ie,U);default:if(this.isAsyncFunction())return b&&this.unexpected(),this.next(),this.parseFunctionStatement(ie,!0,!b);var Er=this.value,Zr=this.parseExpression();return R===J.name&&Zr.type==="Identifier"&&this.eat(J.colon)?this.parseLabeledStatement(ie,Er,Zr,b):this.parseExpressionStatement(ie,Zr)}},Je.parseBreakContinueStatement=function(b,k){var U=k==="break";this.next(),this.eat(J.semi)||this.insertSemicolon()?b.label=null:this.type!==J.name?this.unexpected():(b.label=this.parseIdent(),this.semicolon());for(var R=0;R<this.labels.length;++R){var ie=this.labels[R];if((b.label==null||ie.name===b.label.name)&&(ie.kind!=null&&(U||ie.kind==="loop")||b.label&&U))break}return R===this.labels.length&&this.raise(b.start,"Unsyntactic "+k),this.finishNode(b,U?"BreakStatement":"ContinueStatement")},Je.parseDebuggerStatement=function(b){return this.next(),this.semicolon(),this.finishNode(b,"DebuggerStatement")},Je.parseDoStatement=function(b){return this.next(),this.labels.push(Xt),b.body=this.parseStatement("do"),this.labels.pop(),this.expect(J._while),b.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(J.semi):this.semicolon(),this.finishNode(b,"DoWhileStatement")},Je.parseForStatement=function(b){this.next();var k=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(Xt),this.enterScope(0),this.expect(J.parenL),this.type===J.semi)return k>-1&&this.unexpected(k),this.parseFor(b,null);var U=this.isLet();if(this.type===J._var||this.type===J._const||U){var R=this.startNode(),ie=U?"let":this.value;return this.next(),this.parseVar(R,!0,ie),this.finishNode(R,"VariableDeclaration"),(this.type===J._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&R.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===J._in?k>-1&&this.unexpected(k):b.await=k>-1),this.parseForIn(b,R)):(k>-1&&this.unexpected(k),this.parseFor(b,R))}var Pe=new Z,ct=this.parseExpression(!0,Pe);return this.type===J._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===J._in?k>-1&&this.unexpected(k):b.await=k>-1),this.toAssignable(ct,!1,Pe),this.checkLVal(ct),this.parseForIn(b,ct)):(this.checkExpressionErrors(Pe,!0),k>-1&&this.unexpected(k),this.parseFor(b,ct))},Je.parseFunctionStatement=function(b,k,U){return this.next(),this.parseFunction(b,It|(U?0:mr),!1,k)},Je.parseIfStatement=function(b){return this.next(),b.test=this.parseParenExpression(),b.consequent=this.parseStatement("if"),b.alternate=this.eat(J._else)?this.parseStatement("if"):null,this.finishNode(b,"IfStatement")},Je.parseReturnStatement=function(b){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(J.semi)||this.insertSemicolon()?b.argument=null:(b.argument=this.parseExpression(),this.semicolon()),this.finishNode(b,"ReturnStatement")},Je.parseSwitchStatement=function(b){this.next(),b.discriminant=this.parseParenExpression(),b.cases=[],this.expect(J.braceL),this.labels.push(Dr),this.enterScope(0);for(var k,U=!1;this.type!==J.braceR;)if(this.type===J._case||this.type===J._default){var R=this.type===J._case;k&&this.finishNode(k,"SwitchCase"),b.cases.push(k=this.startNode()),k.consequent=[],this.next(),R?k.test=this.parseExpression():(U&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),U=!0,k.test=null),this.expect(J.colon)}else k||this.unexpected(),k.consequent.push(this.parseStatement(null));return this.exitScope(),k&&this.finishNode(k,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(b,"SwitchStatement")},Je.parseThrowStatement=function(b){return this.next(),Qt.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),b.argument=this.parseExpression(),this.semicolon(),this.finishNode(b,"ThrowStatement")};var tt=[];Je.parseTryStatement=function(b){if(this.next(),b.block=this.parseBlock(),b.handler=null,this.type===J._catch){var k=this.startNode();if(this.next(),this.eat(J.parenL)){k.param=this.parseBindingAtom();var U=k.param.type==="Identifier";this.enterScope(U?mi:0),this.checkLVal(k.param,U?ka:qn),this.expect(J.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),k.param=null,this.enterScope(0);k.body=this.parseBlock(!1),this.exitScope(),b.handler=this.finishNode(k,"CatchClause")}return b.finalizer=this.eat(J._finally)?this.parseBlock():null,!b.handler&&!b.finalizer&&this.raise(b.start,"Missing catch or finally clause"),this.finishNode(b,"TryStatement")},Je.parseVarStatement=function(b,k){return this.next(),this.parseVar(b,!1,k),this.semicolon(),this.finishNode(b,"VariableDeclaration")},Je.parseWhileStatement=function(b){return this.next(),b.test=this.parseParenExpression(),this.labels.push(Xt),b.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(b,"WhileStatement")},Je.parseWithStatement=function(b){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),b.object=this.parseParenExpression(),b.body=this.parseStatement("with"),this.finishNode(b,"WithStatement")},Je.parseEmptyStatement=function(b){return this.next(),this.finishNode(b,"EmptyStatement")},Je.parseLabeledStatement=function(b,k,U,R){for(var ie=0,Pe=this.labels;ie<Pe.length;ie+=1){var ct=Pe[ie];ct.name===k&&this.raise(U.start,"Label '"+k+"' is already declared")}for(var Ft=this.type.isLoop?"loop":this.type===J._switch?"switch":null,Bt=this.labels.length-1;Bt>=0;Bt--){var Er=this.labels[Bt];if(Er.statementStart===b.start)Er.statementStart=this.start,Er.kind=Ft;else break}return this.labels.push({name:k,kind:Ft,statementStart:this.start}),b.body=this.parseStatement(R?R.indexOf("label")===-1?R+"label":R:"label"),this.labels.pop(),b.label=U,this.finishNode(b,"LabeledStatement")},Je.parseExpressionStatement=function(b,k){return b.expression=k,this.semicolon(),this.finishNode(b,"ExpressionStatement")},Je.parseBlock=function(b,k,U){for(b===void 0&&(b=!0),k===void 0&&(k=this.startNode()),k.body=[],this.expect(J.braceL),b&&this.enterScope(0);this.type!==J.braceR;){var R=this.parseStatement(null);k.body.push(R)}return U&&(this.strict=!1),this.next(),b&&this.exitScope(),this.finishNode(k,"BlockStatement")},Je.parseFor=function(b,k){return b.init=k,this.expect(J.semi),b.test=this.type===J.semi?null:this.parseExpression(),this.expect(J.semi),b.update=this.type===J.parenR?null:this.parseExpression(),this.expect(J.parenR),b.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(b,"ForStatement")},Je.parseForIn=function(b,k){var U=this.type===J._in;return this.next(),k.type==="VariableDeclaration"&&k.declarations[0].init!=null&&(!U||this.options.ecmaVersion<8||this.strict||k.kind!=="var"||k.declarations[0].id.type!=="Identifier")?this.raise(k.start,(U?"for-in":"for-of")+" loop variable declaration may not have an initializer"):k.type==="AssignmentPattern"&&this.raise(k.start,"Invalid left-hand side in for-loop"),b.left=k,b.right=U?this.parseExpression():this.parseMaybeAssign(),this.expect(J.parenR),b.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(b,U?"ForInStatement":"ForOfStatement")},Je.parseVar=function(b,k,U){for(b.declarations=[],b.kind=U;;){var R=this.startNode();if(this.parseVarId(R,U),this.eat(J.eq)?R.init=this.parseMaybeAssign(k):U==="const"&&!(this.type===J._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():R.id.type!=="Identifier"&&!(k&&(this.type===J._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):R.init=null,b.declarations.push(this.finishNode(R,"VariableDeclarator")),!this.eat(J.comma))break}return b},Je.parseVarId=function(b,k){b.id=this.parseBindingAtom(),this.checkLVal(b.id,k==="var"?Zn:qn,!1)};var It=1,mr=2,Ir=4;Je.parseFunction=function(b,k,U,R){this.initFunction(b),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!R)&&(this.type===J.star&&k&mr&&this.unexpected(),b.generator=this.eat(J.star)),this.options.ecmaVersion>=8&&(b.async=!!R),k&It&&(b.id=k&Ir&&this.type!==J.name?null:this.parseIdent(),b.id&&!(k&mr)&&this.checkLVal(b.id,this.strict||b.generator||b.async?this.treatFunctionsAsVar?Zn:qn:ro));var ie=this.yieldPos,Pe=this.awaitPos,ct=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(bi(b.async,b.generator)),k&It||(b.id=this.type===J.name?this.parseIdent():null),this.parseFunctionParams(b),this.parseFunctionBody(b,U,!1),this.yieldPos=ie,this.awaitPos=Pe,this.awaitIdentPos=ct,this.finishNode(b,k&It?"FunctionDeclaration":"FunctionExpression")},Je.parseFunctionParams=function(b){this.expect(J.parenL),b.params=this.parseBindingList(J.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},Je.parseClass=function(b,k){this.next();var U=this.strict;this.strict=!0,this.parseClassId(b,k),this.parseClassSuper(b);var R=this.startNode(),ie=!1;for(R.body=[],this.expect(J.braceL);this.type!==J.braceR;){var Pe=this.parseClassElement(b.superClass!==null);Pe&&(R.body.push(Pe),Pe.type==="MethodDefinition"&&Pe.kind==="constructor"&&(ie&&this.raise(Pe.start,"Duplicate constructor in the same class"),ie=!0))}return this.strict=U,this.next(),b.body=this.finishNode(R,"ClassBody"),this.finishNode(b,k?"ClassDeclaration":"ClassExpression")},Je.parseClassElement=function(b){var k=this;if(this.eat(J.semi))return null;var U=this.startNode(),R=function(Bt,Er){Er===void 0&&(Er=!1);var Zr=k.start,Wn=k.startLoc;return k.eatContextual(Bt)?k.type!==J.parenL&&(!Er||!k.canInsertSemicolon())?!0:(U.key&&k.unexpected(),U.computed=!1,U.key=k.startNodeAt(Zr,Wn),U.key.name=Bt,k.finishNode(U.key,"Identifier"),!1):!1};U.kind="method",U.static=R("static");var ie=this.eat(J.star),Pe=!1;ie||(this.options.ecmaVersion>=8&&R("async",!0)?(Pe=!0,ie=this.options.ecmaVersion>=9&&this.eat(J.star)):R("get")?U.kind="get":R("set")&&(U.kind="set")),U.key||this.parsePropertyName(U);var ct=U.key,Ft=!1;return!U.computed&&!U.static&&(ct.type==="Identifier"&&ct.name==="constructor"||ct.type==="Literal"&&ct.value==="constructor")?(U.kind!=="method"&&this.raise(ct.start,"Constructor can't have get/set modifier"),ie&&this.raise(ct.start,"Constructor can't be a generator"),Pe&&this.raise(ct.start,"Constructor can't be an async method"),U.kind="constructor",Ft=b):U.static&&ct.type==="Identifier"&&ct.name==="prototype"&&this.raise(ct.start,"Classes may not have a static property named prototype"),this.parseClassMethod(U,ie,Pe,Ft),U.kind==="get"&&U.value.params.length!==0&&this.raiseRecoverable(U.value.start,"getter should have no params"),U.kind==="set"&&U.value.params.length!==1&&this.raiseRecoverable(U.value.start,"setter should have exactly one param"),U.kind==="set"&&U.value.params[0].type==="RestElement"&&this.raiseRecoverable(U.value.params[0].start,"Setter cannot use rest params"),U},Je.parseClassMethod=function(b,k,U,R){return b.value=this.parseMethod(k,U,R),this.finishNode(b,"MethodDefinition")},Je.parseClassId=function(b,k){this.type===J.name?(b.id=this.parseIdent(),k&&this.checkLVal(b.id,qn,!1)):(k===!0&&this.unexpected(),b.id=null)},Je.parseClassSuper=function(b){b.superClass=this.eat(J._extends)?this.parseExprSubscripts():null},Je.parseExport=function(b,k){if(this.next(),this.eat(J.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(b.exported=this.parseIdent(!0),this.checkExport(k,b.exported.name,this.lastTokStart)):b.exported=null),this.expectContextual("from"),this.type!==J.string&&this.unexpected(),b.source=this.parseExprAtom(),this.semicolon(),this.finishNode(b,"ExportAllDeclaration");if(this.eat(J._default)){this.checkExport(k,"default",this.lastTokStart);var U;if(this.type===J._function||(U=this.isAsyncFunction())){var R=this.startNode();this.next(),U&&this.next(),b.declaration=this.parseFunction(R,It|Ir,!1,U)}else if(this.type===J._class){var ie=this.startNode();b.declaration=this.parseClass(ie,"nullableID")}else b.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(b,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())b.declaration=this.parseStatement(null),b.declaration.type==="VariableDeclaration"?this.checkVariableExport(k,b.declaration.declarations):this.checkExport(k,b.declaration.id.name,b.declaration.id.start),b.specifiers=[],b.source=null;else{if(b.declaration=null,b.specifiers=this.parseExportSpecifiers(k),this.eatContextual("from"))this.type!==J.string&&this.unexpected(),b.source=this.parseExprAtom();else{for(var Pe=0,ct=b.specifiers;Pe<ct.length;Pe+=1){var Ft=ct[Pe];this.checkUnreserved(Ft.local),this.checkLocalExport(Ft.local)}b.source=null}this.semicolon()}return this.finishNode(b,"ExportNamedDeclaration")},Je.checkExport=function(b,k,U){!b||(Fe(b,k)&&this.raiseRecoverable(U,"Duplicate export '"+k+"'"),b[k]=!0)},Je.checkPatternExport=function(b,k){var U=k.type;if(U==="Identifier")this.checkExport(b,k.name,k.start);else if(U==="ObjectPattern")for(var R=0,ie=k.properties;R<ie.length;R+=1){var Pe=ie[R];this.checkPatternExport(b,Pe)}else if(U==="ArrayPattern")for(var ct=0,Ft=k.elements;ct<Ft.length;ct+=1){var Bt=Ft[ct];Bt&&this.checkPatternExport(b,Bt)}else U==="Property"?this.checkPatternExport(b,k.value):U==="AssignmentPattern"?this.checkPatternExport(b,k.left):U==="RestElement"?this.checkPatternExport(b,k.argument):U==="ParenthesizedExpression"&&this.checkPatternExport(b,k.expression)},Je.checkVariableExport=function(b,k){if(!!b)for(var U=0,R=k;U<R.length;U+=1){var ie=R[U];this.checkPatternExport(b,ie.id)}},Je.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},Je.parseExportSpecifiers=function(b){var k=[],U=!0;for(this.expect(J.braceL);!this.eat(J.braceR);){if(U)U=!1;else if(this.expect(J.comma),this.afterTrailingComma(J.braceR))break;var R=this.startNode();R.local=this.parseIdent(!0),R.exported=this.eatContextual("as")?this.parseIdent(!0):R.local,this.checkExport(b,R.exported.name,R.exported.start),k.push(this.finishNode(R,"ExportSpecifier"))}return k},Je.parseImport=function(b){return this.next(),this.type===J.string?(b.specifiers=tt,b.source=this.parseExprAtom()):(b.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),b.source=this.type===J.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(b,"ImportDeclaration")},Je.parseImportSpecifiers=function(){var b=[],k=!0;if(this.type===J.name){var U=this.startNode();if(U.local=this.parseIdent(),this.checkLVal(U.local,qn),b.push(this.finishNode(U,"ImportDefaultSpecifier")),!this.eat(J.comma))return b}if(this.type===J.star){var R=this.startNode();return this.next(),this.expectContextual("as"),R.local=this.parseIdent(),this.checkLVal(R.local,qn),b.push(this.finishNode(R,"ImportNamespaceSpecifier")),b}for(this.expect(J.braceL);!this.eat(J.braceR);){if(k)k=!1;else if(this.expect(J.comma),this.afterTrailingComma(J.braceR))break;var ie=this.startNode();ie.imported=this.parseIdent(!0),this.eatContextual("as")?ie.local=this.parseIdent():(this.checkUnreserved(ie.imported),ie.local=ie.imported),this.checkLVal(ie.local,qn),b.push(this.finishNode(ie,"ImportSpecifier"))}return b},Je.adaptDirectivePrologue=function(b){for(var k=0;k<b.length&&this.isDirectiveCandidate(b[k]);++k)b[k].directive=b[k].expression.raw.slice(1,-1)},Je.isDirectiveCandidate=function(b){return b.type==="ExpressionStatement"&&b.expression.type==="Literal"&&typeof b.expression.value=="string"&&(this.input[b.start]==='"'||this.input[b.start]==="'")};var $r=Tt.prototype;$r.toAssignable=function(b,k,U){if(this.options.ecmaVersion>=6&&b)switch(b.type){case"Identifier":this.inAsync&&b.name==="await"&&this.raise(b.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":b.type="ObjectPattern",U&&this.checkPatternErrors(U,!0);for(var R=0,ie=b.properties;R<ie.length;R+=1){var Pe=ie[R];this.toAssignable(Pe,k),Pe.type==="RestElement"&&(Pe.argument.type==="ArrayPattern"||Pe.argument.type==="ObjectPattern")&&this.raise(Pe.argument.start,"Unexpected token")}break;case"Property":b.kind!=="init"&&this.raise(b.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(b.value,k);break;case"ArrayExpression":b.type="ArrayPattern",U&&this.checkPatternErrors(U,!0),this.toAssignableList(b.elements,k);break;case"SpreadElement":b.type="RestElement",this.toAssignable(b.argument,k),b.argument.type==="AssignmentPattern"&&this.raise(b.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":b.operator!=="="&&this.raise(b.left.end,"Only '=' operator can be used for specifying default value."),b.type="AssignmentPattern",delete b.operator,this.toAssignable(b.left,k);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(b.expression,k,U);break;case"ChainExpression":this.raiseRecoverable(b.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!k)break;default:this.raise(b.start,"Assigning to rvalue")}else U&&this.checkPatternErrors(U,!0);return b},$r.toAssignableList=function(b,k){for(var U=b.length,R=0;R<U;R++){var ie=b[R];ie&&this.toAssignable(ie,k)}if(U){var Pe=b[U-1];this.options.ecmaVersion===6&&k&&Pe&&Pe.type==="RestElement"&&Pe.argument.type!=="Identifier"&&this.unexpected(Pe.argument.start)}return b},$r.parseSpread=function(b){var k=this.startNode();return this.next(),k.argument=this.parseMaybeAssign(!1,b),this.finishNode(k,"SpreadElement")},$r.parseRestBinding=function(){var b=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==J.name&&this.unexpected(),b.argument=this.parseBindingAtom(),this.finishNode(b,"RestElement")},$r.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case J.bracketL:var b=this.startNode();return this.next(),b.elements=this.parseBindingList(J.bracketR,!0,!0),this.finishNode(b,"ArrayPattern");case J.braceL:return this.parseObj(!0)}return this.parseIdent()},$r.parseBindingList=function(b,k,U){for(var R=[],ie=!0;!this.eat(b);)if(ie?ie=!1:this.expect(J.comma),k&&this.type===J.comma)R.push(null);else{if(U&&this.afterTrailingComma(b))break;if(this.type===J.ellipsis){var Pe=this.parseRestBinding();this.parseBindingListItem(Pe),R.push(Pe),this.type===J.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(b);break}else{var ct=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(ct),R.push(ct)}}return R},$r.parseBindingListItem=function(b){return b},$r.parseMaybeDefault=function(b,k,U){if(U=U||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(J.eq))return U;var R=this.startNodeAt(b,k);return R.left=U,R.right=this.parseMaybeAssign(),this.finishNode(R,"AssignmentPattern")},$r.checkLVal=function(b,k,U){switch(k===void 0&&(k=li),b.type){case"Identifier":k===qn&&b.name==="let"&&this.raiseRecoverable(b.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(b.name)&&this.raiseRecoverable(b.start,(k?"Binding ":"Assigning to ")+b.name+" in strict mode"),U&&(Fe(U,b.name)&&this.raiseRecoverable(b.start,"Argument name clash"),U[b.name]=!0),k!==li&&k!==oa&&this.declareName(b.name,k,b.start);break;case"ChainExpression":this.raiseRecoverable(b.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":k&&this.raiseRecoverable(b.start,"Binding member expression");break;case"ObjectPattern":for(var R=0,ie=b.properties;R<ie.length;R+=1){var Pe=ie[R];this.checkLVal(Pe,k,U)}break;case"Property":this.checkLVal(b.value,k,U);break;case"ArrayPattern":for(var ct=0,Ft=b.elements;ct<Ft.length;ct+=1){var Bt=Ft[ct];Bt&&this.checkLVal(Bt,k,U)}break;case"AssignmentPattern":this.checkLVal(b.left,k,U);break;case"RestElement":this.checkLVal(b.argument,k,U);break;case"ParenthesizedExpression":this.checkLVal(b.expression,k,U);break;default:this.raise(b.start,(k?"Binding":"Assigning to")+" rvalue")}};var tn=Tt.prototype;tn.checkPropClash=function(b,k,U){if(!(this.options.ecmaVersion>=9&&b.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(b.computed||b.method||b.shorthand))){var R=b.key,ie;switch(R.type){case"Identifier":ie=R.name;break;case"Literal":ie=String(R.value);break;default:return}var Pe=b.kind;if(this.options.ecmaVersion>=6){ie==="__proto__"&&Pe==="init"&&(k.proto&&(U?U.doubleProto<0&&(U.doubleProto=R.start):this.raiseRecoverable(R.start,"Redefinition of __proto__ property")),k.proto=!0);return}ie="$"+ie;var ct=k[ie];if(ct){var Ft;Pe==="init"?Ft=this.strict&&ct.init||ct.get||ct.set:Ft=ct.init||ct[Pe],Ft&&this.raiseRecoverable(R.start,"Redefinition of property")}else ct=k[ie]={init:!1,get:!1,set:!1};ct[Pe]=!0}},tn.parseExpression=function(b,k){var U=this.start,R=this.startLoc,ie=this.parseMaybeAssign(b,k);if(this.type===J.comma){var Pe=this.startNodeAt(U,R);for(Pe.expressions=[ie];this.eat(J.comma);)Pe.expressions.push(this.parseMaybeAssign(b,k));return this.finishNode(Pe,"SequenceExpression")}return ie},tn.parseMaybeAssign=function(b,k,U){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(b);this.exprAllowed=!1}var R=!1,ie=-1,Pe=-1;k?(ie=k.parenthesizedAssign,Pe=k.trailingComma,k.parenthesizedAssign=k.trailingComma=-1):(k=new Z,R=!0);var ct=this.start,Ft=this.startLoc;(this.type===J.parenL||this.type===J.name)&&(this.potentialArrowAt=this.start);var Bt=this.parseMaybeConditional(b,k);if(U&&(Bt=U.call(this,Bt,ct,Ft)),this.type.isAssign){var Er=this.startNodeAt(ct,Ft);return Er.operator=this.value,Er.left=this.type===J.eq?this.toAssignable(Bt,!1,k):Bt,R||(k.parenthesizedAssign=k.trailingComma=k.doubleProto=-1),k.shorthandAssign>=Er.left.start&&(k.shorthandAssign=-1),this.checkLVal(Bt),this.next(),Er.right=this.parseMaybeAssign(b),this.finishNode(Er,"AssignmentExpression")}else R&&this.checkExpressionErrors(k,!0);return ie>-1&&(k.parenthesizedAssign=ie),Pe>-1&&(k.trailingComma=Pe),Bt},tn.parseMaybeConditional=function(b,k){var U=this.start,R=this.startLoc,ie=this.parseExprOps(b,k);if(this.checkExpressionErrors(k))return ie;if(this.eat(J.question)){var Pe=this.startNodeAt(U,R);return Pe.test=ie,Pe.consequent=this.parseMaybeAssign(),this.expect(J.colon),Pe.alternate=this.parseMaybeAssign(b),this.finishNode(Pe,"ConditionalExpression")}return ie},tn.parseExprOps=function(b,k){var U=this.start,R=this.startLoc,ie=this.parseMaybeUnary(k,!1);return this.checkExpressionErrors(k)||ie.start===U&&ie.type==="ArrowFunctionExpression"?ie:this.parseExprOp(ie,U,R,-1,b)},tn.parseExprOp=function(b,k,U,R,ie){var Pe=this.type.binop;if(Pe!=null&&(!ie||this.type!==J._in)&&Pe>R){var ct=this.type===J.logicalOR||this.type===J.logicalAND,Ft=this.type===J.coalesce;Ft&&(Pe=J.logicalAND.binop);var Bt=this.value;this.next();var Er=this.start,Zr=this.startLoc,Wn=this.parseExprOp(this.parseMaybeUnary(null,!1),Er,Zr,Pe,ie),ti=this.buildBinary(k,U,b,Wn,Bt,ct||Ft);return(ct&&this.type===J.coalesce||Ft&&(this.type===J.logicalOR||this.type===J.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(ti,k,U,R,ie)}return b},tn.buildBinary=function(b,k,U,R,ie,Pe){var ct=this.startNodeAt(b,k);return ct.left=U,ct.operator=ie,ct.right=R,this.finishNode(ct,Pe?"LogicalExpression":"BinaryExpression")},tn.parseMaybeUnary=function(b,k){var U=this.start,R=this.startLoc,ie;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))ie=this.parseAwait(),k=!0;else if(this.type.prefix){var Pe=this.startNode(),ct=this.type===J.incDec;Pe.operator=this.value,Pe.prefix=!0,this.next(),Pe.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(b,!0),ct?this.checkLVal(Pe.argument):this.strict&&Pe.operator==="delete"&&Pe.argument.type==="Identifier"?this.raiseRecoverable(Pe.start,"Deleting local variable in strict mode"):k=!0,ie=this.finishNode(Pe,ct?"UpdateExpression":"UnaryExpression")}else{if(ie=this.parseExprSubscripts(b),this.checkExpressionErrors(b))return ie;for(;this.type.postfix&&!this.canInsertSemicolon();){var Ft=this.startNodeAt(U,R);Ft.operator=this.value,Ft.prefix=!1,Ft.argument=ie,this.checkLVal(ie),this.next(),ie=this.finishNode(Ft,"UpdateExpression")}}return!k&&this.eat(J.starstar)?this.buildBinary(U,R,ie,this.parseMaybeUnary(null,!1),"**",!1):ie},tn.parseExprSubscripts=function(b){var k=this.start,U=this.startLoc,R=this.parseExprAtom(b);if(R.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return R;var ie=this.parseSubscripts(R,k,U);return b&&ie.type==="MemberExpression"&&(b.parenthesizedAssign>=ie.start&&(b.parenthesizedAssign=-1),b.parenthesizedBind>=ie.start&&(b.parenthesizedBind=-1)),ie},tn.parseSubscripts=function(b,k,U,R){for(var ie=this.options.ecmaVersion>=8&&b.type==="Identifier"&&b.name==="async"&&this.lastTokEnd===b.end&&!this.canInsertSemicolon()&&b.end-b.start==5&&this.potentialArrowAt===b.start,Pe=!1;;){var ct=this.parseSubscript(b,k,U,R,ie,Pe);if(ct.optional&&(Pe=!0),ct===b||ct.type==="ArrowFunctionExpression"){if(Pe){var Ft=this.startNodeAt(k,U);Ft.expression=ct,ct=this.finishNode(Ft,"ChainExpression")}return ct}b=ct}},tn.parseSubscript=function(b,k,U,R,ie,Pe){var ct=this.options.ecmaVersion>=11,Ft=ct&&this.eat(J.questionDot);R&&Ft&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var Bt=this.eat(J.bracketL);if(Bt||Ft&&this.type!==J.parenL&&this.type!==J.backQuote||this.eat(J.dot)){var Er=this.startNodeAt(k,U);Er.object=b,Er.property=Bt?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),Er.computed=!!Bt,Bt&&this.expect(J.bracketR),ct&&(Er.optional=Ft),b=this.finishNode(Er,"MemberExpression")}else if(!R&&this.eat(J.parenL)){var Zr=new Z,Wn=this.yieldPos,ti=this.awaitPos,gi=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var $i=this.parseExprList(J.parenR,this.options.ecmaVersion>=8,!1,Zr);if(ie&&!Ft&&!this.canInsertSemicolon()&&this.eat(J.arrow))return this.checkPatternErrors(Zr,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=Wn,this.awaitPos=ti,this.awaitIdentPos=gi,this.parseArrowExpression(this.startNodeAt(k,U),$i,!0);this.checkExpressionErrors(Zr,!0),this.yieldPos=Wn||this.yieldPos,this.awaitPos=ti||this.awaitPos,this.awaitIdentPos=gi||this.awaitIdentPos;var wa=this.startNodeAt(k,U);wa.callee=b,wa.arguments=$i,ct&&(wa.optional=Ft),b=this.finishNode(wa,"CallExpression")}else if(this.type===J.backQuote){(Ft||Pe)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var Oa=this.startNodeAt(k,U);Oa.tag=b,Oa.quasi=this.parseTemplate({isTagged:!0}),b=this.finishNode(Oa,"TaggedTemplateExpression")}return b},tn.parseExprAtom=function(b){this.type===J.slash&&this.readRegexp();var k,U=this.potentialArrowAt===this.start;switch(this.type){case J._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),k=this.startNode(),this.next(),this.type===J.parenL&&!this.allowDirectSuper&&this.raise(k.start,"super() call outside constructor of a subclass"),this.type!==J.dot&&this.type!==J.bracketL&&this.type!==J.parenL&&this.unexpected(),this.finishNode(k,"Super");case J._this:return k=this.startNode(),this.next(),this.finishNode(k,"ThisExpression");case J.name:var R=this.start,ie=this.startLoc,Pe=this.containsEsc,ct=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!Pe&&ct.name==="async"&&!this.canInsertSemicolon()&&this.eat(J._function))return this.parseFunction(this.startNodeAt(R,ie),0,!1,!0);if(U&&!this.canInsertSemicolon()){if(this.eat(J.arrow))return this.parseArrowExpression(this.startNodeAt(R,ie),[ct],!1);if(this.options.ecmaVersion>=8&&ct.name==="async"&&this.type===J.name&&!Pe)return ct=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(J.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(R,ie),[ct],!0)}return ct;case J.regexp:var Ft=this.value;return k=this.parseLiteral(Ft.value),k.regex={pattern:Ft.pattern,flags:Ft.flags},k;case J.num:case J.string:return this.parseLiteral(this.value);case J._null:case J._true:case J._false:return k=this.startNode(),k.value=this.type===J._null?null:this.type===J._true,k.raw=this.type.keyword,this.next(),this.finishNode(k,"Literal");case J.parenL:var Bt=this.start,Er=this.parseParenAndDistinguishExpression(U);return b&&(b.parenthesizedAssign<0&&!this.isSimpleAssignTarget(Er)&&(b.parenthesizedAssign=Bt),b.parenthesizedBind<0&&(b.parenthesizedBind=Bt)),Er;case J.bracketL:return k=this.startNode(),this.next(),k.elements=this.parseExprList(J.bracketR,!0,!0,b),this.finishNode(k,"ArrayExpression");case J.braceL:return this.parseObj(!1,b);case J._function:return k=this.startNode(),this.next(),this.parseFunction(k,0);case J._class:return this.parseClass(this.startNode(),!1);case J._new:return this.parseNew();case J.backQuote:return this.parseTemplate();case J._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},tn.parseExprImport=function(){var b=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var k=this.parseIdent(!0);switch(this.type){case J.parenL:return this.parseDynamicImport(b);case J.dot:return b.meta=k,this.parseImportMeta(b);default:this.unexpected()}},tn.parseDynamicImport=function(b){if(this.next(),b.source=this.parseMaybeAssign(),!this.eat(J.parenR)){var k=this.start;this.eat(J.comma)&&this.eat(J.parenR)?this.raiseRecoverable(k,"Trailing comma is not allowed in import()"):this.unexpected(k)}return this.finishNode(b,"ImportExpression")},tn.parseImportMeta=function(b){this.next();var k=this.containsEsc;return b.property=this.parseIdent(!0),b.property.name!=="meta"&&this.raiseRecoverable(b.property.start,"The only valid meta property for import is 'import.meta'"),k&&this.raiseRecoverable(b.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(b.start,"Cannot use 'import.meta' outside a module"),this.finishNode(b,"MetaProperty")},tn.parseLiteral=function(b){var k=this.startNode();return k.value=b,k.raw=this.input.slice(this.start,this.end),k.raw.charCodeAt(k.raw.length-1)===110&&(k.bigint=k.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(k,"Literal")},tn.parseParenExpression=function(){this.expect(J.parenL);var b=this.parseExpression();return this.expect(J.parenR),b},tn.parseParenAndDistinguishExpression=function(b){var k=this.start,U=this.startLoc,R,ie=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var Pe=this.start,ct=this.startLoc,Ft=[],Bt=!0,Er=!1,Zr=new Z,Wn=this.yieldPos,ti=this.awaitPos,gi;for(this.yieldPos=0,this.awaitPos=0;this.type!==J.parenR;)if(Bt?Bt=!1:this.expect(J.comma),ie&&this.afterTrailingComma(J.parenR,!0)){Er=!0;break}else if(this.type===J.ellipsis){gi=this.start,Ft.push(this.parseParenItem(this.parseRestBinding())),this.type===J.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else Ft.push(this.parseMaybeAssign(!1,Zr,this.parseParenItem));var $i=this.start,wa=this.startLoc;if(this.expect(J.parenR),b&&!this.canInsertSemicolon()&&this.eat(J.arrow))return this.checkPatternErrors(Zr,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=Wn,this.awaitPos=ti,this.parseParenArrowList(k,U,Ft);(!Ft.length||Er)&&this.unexpected(this.lastTokStart),gi&&this.unexpected(gi),this.checkExpressionErrors(Zr,!0),this.yieldPos=Wn||this.yieldPos,this.awaitPos=ti||this.awaitPos,Ft.length>1?(R=this.startNodeAt(Pe,ct),R.expressions=Ft,this.finishNodeAt(R,"SequenceExpression",$i,wa)):R=Ft[0]}else R=this.parseParenExpression();if(this.options.preserveParens){var Oa=this.startNodeAt(k,U);return Oa.expression=R,this.finishNode(Oa,"ParenthesizedExpression")}else return R},tn.parseParenItem=function(b){return b},tn.parseParenArrowList=function(b,k,U){return this.parseArrowExpression(this.startNodeAt(b,k),U)};var $n=[];tn.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var b=this.startNode(),k=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(J.dot)){b.meta=k;var U=this.containsEsc;return b.property=this.parseIdent(!0),b.property.name!=="target"&&this.raiseRecoverable(b.property.start,"The only valid meta property for new is 'new.target'"),U&&this.raiseRecoverable(b.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(b.start,"'new.target' can only be used in functions"),this.finishNode(b,"MetaProperty")}var R=this.start,ie=this.startLoc,Pe=this.type===J._import;return b.callee=this.parseSubscripts(this.parseExprAtom(),R,ie,!0),Pe&&b.callee.type==="ImportExpression"&&this.raise(R,"Cannot use new with import()"),this.eat(J.parenL)?b.arguments=this.parseExprList(J.parenR,this.options.ecmaVersion>=8,!1):b.arguments=$n,this.finishNode(b,"NewExpression")},tn.parseTemplateElement=function(b){var k=b.isTagged,U=this.startNode();return this.type===J.invalidTemplate?(k||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),U.value={raw:this.value,cooked:null}):U.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),U.tail=this.type===J.backQuote,this.finishNode(U,"TemplateElement")},tn.parseTemplate=function(b){b===void 0&&(b={});var k=b.isTagged;k===void 0&&(k=!1);var U=this.startNode();this.next(),U.expressions=[];var R=this.parseTemplateElement({isTagged:k});for(U.quasis=[R];!R.tail;)this.type===J.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(J.dollarBraceL),U.expressions.push(this.parseExpression()),this.expect(J.braceR),U.quasis.push(R=this.parseTemplateElement({isTagged:k}));return this.next(),this.finishNode(U,"TemplateLiteral")},tn.isAsyncProp=function(b){return!b.computed&&b.key.type==="Identifier"&&b.key.name==="async"&&(this.type===J.name||this.type===J.num||this.type===J.string||this.type===J.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===J.star)&&!Qt.test(this.input.slice(this.lastTokEnd,this.start))},tn.parseObj=function(b,k){var U=this.startNode(),R=!0,ie={};for(U.properties=[],this.next();!this.eat(J.braceR);){if(R)R=!1;else if(this.expect(J.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(J.braceR))break;var Pe=this.parseProperty(b,k);b||this.checkPropClash(Pe,ie,k),U.properties.push(Pe)}return this.finishNode(U,b?"ObjectPattern":"ObjectExpression")},tn.parseProperty=function(b,k){var U=this.startNode(),R,ie,Pe,ct;if(this.options.ecmaVersion>=9&&this.eat(J.ellipsis))return b?(U.argument=this.parseIdent(!1),this.type===J.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(U,"RestElement")):(this.type===J.parenL&&k&&(k.parenthesizedAssign<0&&(k.parenthesizedAssign=this.start),k.parenthesizedBind<0&&(k.parenthesizedBind=this.start)),U.argument=this.parseMaybeAssign(!1,k),this.type===J.comma&&k&&k.trailingComma<0&&(k.trailingComma=this.start),this.finishNode(U,"SpreadElement"));this.options.ecmaVersion>=6&&(U.method=!1,U.shorthand=!1,(b||k)&&(Pe=this.start,ct=this.startLoc),b||(R=this.eat(J.star)));var Ft=this.containsEsc;return this.parsePropertyName(U),!b&&!Ft&&this.options.ecmaVersion>=8&&!R&&this.isAsyncProp(U)?(ie=!0,R=this.options.ecmaVersion>=9&&this.eat(J.star),this.parsePropertyName(U,k)):ie=!1,this.parsePropertyValue(U,b,R,ie,Pe,ct,k,Ft),this.finishNode(U,"Property")},tn.parsePropertyValue=function(b,k,U,R,ie,Pe,ct,Ft){if((U||R)&&this.type===J.colon&&this.unexpected(),this.eat(J.colon))b.value=k?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,ct),b.kind="init";else if(this.options.ecmaVersion>=6&&this.type===J.parenL)k&&this.unexpected(),b.kind="init",b.method=!0,b.value=this.parseMethod(U,R);else if(!k&&!Ft&&this.options.ecmaVersion>=5&&!b.computed&&b.key.type==="Identifier"&&(b.key.name==="get"||b.key.name==="set")&&this.type!==J.comma&&this.type!==J.braceR&&this.type!==J.eq){(U||R)&&this.unexpected(),b.kind=b.key.name,this.parsePropertyName(b),b.value=this.parseMethod(!1);var Bt=b.kind==="get"?0:1;if(b.value.params.length!==Bt){var Er=b.value.start;b.kind==="get"?this.raiseRecoverable(Er,"getter should have no params"):this.raiseRecoverable(Er,"setter should have exactly one param")}else b.kind==="set"&&b.value.params[0].type==="RestElement"&&this.raiseRecoverable(b.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!b.computed&&b.key.type==="Identifier"?((U||R)&&this.unexpected(),this.checkUnreserved(b.key),b.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=ie),b.kind="init",k?b.value=this.parseMaybeDefault(ie,Pe,b.key):this.type===J.eq&&ct?(ct.shorthandAssign<0&&(ct.shorthandAssign=this.start),b.value=this.parseMaybeDefault(ie,Pe,b.key)):b.value=b.key,b.shorthand=!0):this.unexpected()},tn.parsePropertyName=function(b){if(this.options.ecmaVersion>=6){if(this.eat(J.bracketL))return b.computed=!0,b.key=this.parseMaybeAssign(),this.expect(J.bracketR),b.key;b.computed=!1}return b.key=this.type===J.num||this.type===J.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},tn.initFunction=function(b){b.id=null,this.options.ecmaVersion>=6&&(b.generator=b.expression=!1),this.options.ecmaVersion>=8&&(b.async=!1)},tn.parseMethod=function(b,k,U){var R=this.startNode(),ie=this.yieldPos,Pe=this.awaitPos,ct=this.awaitIdentPos;return this.initFunction(R),this.options.ecmaVersion>=6&&(R.generator=b),this.options.ecmaVersion>=8&&(R.async=!!k),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(bi(k,R.generator)|si|(U?ki:0)),this.expect(J.parenL),R.params=this.parseBindingList(J.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(R,!1,!0),this.yieldPos=ie,this.awaitPos=Pe,this.awaitIdentPos=ct,this.finishNode(R,"FunctionExpression")},tn.parseArrowExpression=function(b,k,U){var R=this.yieldPos,ie=this.awaitPos,Pe=this.awaitIdentPos;return this.enterScope(bi(U,!1)|Xi),this.initFunction(b),this.options.ecmaVersion>=8&&(b.async=!!U),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,b.params=this.toAssignableList(k,!0),this.parseFunctionBody(b,!0,!1),this.yieldPos=R,this.awaitPos=ie,this.awaitIdentPos=Pe,this.finishNode(b,"ArrowFunctionExpression")},tn.parseFunctionBody=function(b,k,U){var R=k&&this.type!==J.braceL,ie=this.strict,Pe=!1;if(R)b.body=this.parseMaybeAssign(),b.expression=!0,this.checkParams(b,!1);else{var ct=this.options.ecmaVersion>=7&&!this.isSimpleParamList(b.params);(!ie||ct)&&(Pe=this.strictDirective(this.end),Pe&&ct&&this.raiseRecoverable(b.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var Ft=this.labels;this.labels=[],Pe&&(this.strict=!0),this.checkParams(b,!ie&&!Pe&&!k&&!U&&this.isSimpleParamList(b.params)),this.strict&&b.id&&this.checkLVal(b.id,oa),b.body=this.parseBlock(!1,void 0,Pe&&!ie),b.expression=!1,this.adaptDirectivePrologue(b.body.body),this.labels=Ft}this.exitScope()},tn.isSimpleParamList=function(b){for(var k=0,U=b;k<U.length;k+=1){var R=U[k];if(R.type!=="Identifier")return!1}return!0},tn.checkParams=function(b,k){for(var U={},R=0,ie=b.params;R<ie.length;R+=1){var Pe=ie[R];this.checkLVal(Pe,Zn,k?null:U)}},tn.parseExprList=function(b,k,U,R){for(var ie=[],Pe=!0;!this.eat(b);){if(Pe)Pe=!1;else if(this.expect(J.comma),k&&this.afterTrailingComma(b))break;var ct=void 0;U&&this.type===J.comma?ct=null:this.type===J.ellipsis?(ct=this.parseSpread(R),R&&this.type===J.comma&&R.trailingComma<0&&(R.trailingComma=this.start)):ct=this.parseMaybeAssign(!1,R),ie.push(ct)}return ie},tn.checkUnreserved=function(b){var k=b.start,U=b.end,R=b.name;if(this.inGenerator&&R==="yield"&&this.raiseRecoverable(k,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&R==="await"&&this.raiseRecoverable(k,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(R)&&this.raise(k,"Unexpected keyword '"+R+"'"),!(this.options.ecmaVersion<6&&this.input.slice(k,U).indexOf("\\")!==-1)){var ie=this.strict?this.reservedWordsStrict:this.reservedWords;ie.test(R)&&(!this.inAsync&&R==="await"&&this.raiseRecoverable(k,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(k,"The keyword '"+R+"' is reserved"))}},tn.parseIdent=function(b,k){var U=this.startNode();return this.type===J.name?U.name=this.value:this.type.keyword?(U.name=this.type.keyword,(U.name==="class"||U.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!b),this.finishNode(U,"Identifier"),b||(this.checkUnreserved(U),U.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=U.start)),U},tn.parseYield=function(b){this.yieldPos||(this.yieldPos=this.start);var k=this.startNode();return this.next(),this.type===J.semi||this.canInsertSemicolon()||this.type!==J.star&&!this.type.startsExpr?(k.delegate=!1,k.argument=null):(k.delegate=this.eat(J.star),k.argument=this.parseMaybeAssign(b)),this.finishNode(k,"YieldExpression")},tn.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var b=this.startNode();return this.next(),b.argument=this.parseMaybeUnary(null,!1),this.finishNode(b,"AwaitExpression")};var Vn=Tt.prototype;Vn.raise=function(b,k){var U=et(this.input,b);k+=" ("+U.line+":"+U.column+")";var R=new SyntaxError(k);throw R.pos=b,R.loc=U,R.raisedAt=this.pos,R},Vn.raiseRecoverable=Vn.raise,Vn.curPosition=function(){if(this.options.locations)return new ce(this.curLine,this.pos-this.lineStart)};var rn=Tt.prototype,vi=function(k){this.flags=k,this.var=[],this.lexical=[],this.functions=[]};rn.enterScope=function(b){this.scopeStack.push(new vi(b))},rn.exitScope=function(){this.scopeStack.pop()},rn.treatFunctionsAsVarInScope=function(b){return b.flags&Tr||!this.inModule&&b.flags&Or},rn.declareName=function(b,k,U){var R=!1;if(k===qn){var ie=this.currentScope();R=ie.lexical.indexOf(b)>-1||ie.functions.indexOf(b)>-1||ie.var.indexOf(b)>-1,ie.lexical.push(b),this.inModule&&ie.flags&Or&&delete this.undefinedExports[b]}else if(k===ka){var Pe=this.currentScope();Pe.lexical.push(b)}else if(k===ro){var ct=this.currentScope();this.treatFunctionsAsVar?R=ct.lexical.indexOf(b)>-1:R=ct.lexical.indexOf(b)>-1||ct.var.indexOf(b)>-1,ct.functions.push(b)}else for(var Ft=this.scopeStack.length-1;Ft>=0;--Ft){var Bt=this.scopeStack[Ft];if(Bt.lexical.indexOf(b)>-1&&!(Bt.flags&mi&&Bt.lexical[0]===b)||!this.treatFunctionsAsVarInScope(Bt)&&Bt.functions.indexOf(b)>-1){R=!0;break}if(Bt.var.push(b),this.inModule&&Bt.flags&Or&&delete this.undefinedExports[b],Bt.flags&Pn)break}R&&this.raiseRecoverable(U,"Identifier '"+b+"' has already been declared")},rn.checkLocalExport=function(b){this.scopeStack[0].lexical.indexOf(b.name)===-1&&this.scopeStack[0].var.indexOf(b.name)===-1&&(this.undefinedExports[b.name]=b)},rn.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},rn.currentVarScope=function(){for(var b=this.scopeStack.length-1;;b--){var k=this.scopeStack[b];if(k.flags&Pn)return k}},rn.currentThisScope=function(){for(var b=this.scopeStack.length-1;;b--){var k=this.scopeStack[b];if(k.flags&Pn&&!(k.flags&Xi))return k}};var ni=function(k,U,R){this.type="",this.start=U,this.end=0,k.options.locations&&(this.loc=new ze(k,R)),k.options.directSourceFile&&(this.sourceFile=k.options.directSourceFile),k.options.ranges&&(this.range=[U,0])},sa=Tt.prototype;sa.startNode=function(){return new ni(this,this.start,this.startLoc)},sa.startNodeAt=function(b,k){return new ni(this,b,k)};function Sa(b,k,U,R){return b.type=k,b.end=U,this.options.locations&&(b.loc.end=R),this.options.ranges&&(b.range[1]=U),b}sa.finishNode=function(b,k){return Sa.call(this,b,k,this.lastTokEnd,this.lastTokEndLoc)},sa.finishNodeAt=function(b,k,U,R){return Sa.call(this,b,k,U,R)};var Na=function(k,U,R,ie,Pe){this.token=k,this.isExpr=!!U,this.preserveSpace=!!R,this.override=ie,this.generator=!!Pe},ga={b_stat:new Na("{",!1),b_expr:new Na("{",!0),b_tmpl:new Na("${",!1),p_stat:new Na("(",!1),p_expr:new Na("(",!0),q_tmpl:new Na("`",!0,!0,function(b){return b.tryReadTemplateToken()}),f_stat:new Na("function",!1),f_expr:new Na("function",!0),f_expr_gen:new Na("function",!0,!1,null,!0),f_gen:new Na("function",!1,!1,null,!0)},ta=Tt.prototype;ta.initialContext=function(){return[ga.b_stat]},ta.braceIsBlock=function(b){var k=this.curContext();return k===ga.f_expr||k===ga.f_stat?!0:b===J.colon&&(k===ga.b_stat||k===ga.b_expr)?!k.isExpr:b===J._return||b===J.name&&this.exprAllowed?Qt.test(this.input.slice(this.lastTokEnd,this.start)):b===J._else||b===J.semi||b===J.eof||b===J.parenR||b===J.arrow?!0:b===J.braceL?k===ga.b_stat:b===J._var||b===J._const||b===J.name?!1:!this.exprAllowed},ta.inGeneratorContext=function(){for(var b=this.context.length-1;b>=1;b--){var k=this.context[b];if(k.token==="function")return k.generator}return!1},ta.updateContext=function(b){var k,U=this.type;U.keyword&&b===J.dot?this.exprAllowed=!1:(k=U.updateContext)?k.call(this,b):this.exprAllowed=U.beforeExpr},J.parenR.updateContext=J.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var b=this.context.pop();b===ga.b_stat&&this.curContext().token==="function"&&(b=this.context.pop()),this.exprAllowed=!b.isExpr},J.braceL.updateContext=function(b){this.context.push(this.braceIsBlock(b)?ga.b_stat:ga.b_expr),this.exprAllowed=!0},J.dollarBraceL.updateContext=function(){this.context.push(ga.b_tmpl),this.exprAllowed=!0},J.parenL.updateContext=function(b){var k=b===J._if||b===J._for||b===J._with||b===J._while;this.context.push(k?ga.p_stat:ga.p_expr),this.exprAllowed=!0},J.incDec.updateContext=function(){},J._function.updateContext=J._class.updateContext=function(b){b.beforeExpr&&b!==J.semi&&b!==J._else&&!(b===J._return&&Qt.test(this.input.slice(this.lastTokEnd,this.start)))&&!((b===J.colon||b===J.braceL)&&this.curContext()===ga.b_stat)?this.context.push(ga.f_expr):this.context.push(ga.f_stat),this.exprAllowed=!1},J.backQuote.updateContext=function(){this.curContext()===ga.q_tmpl?this.context.pop():this.context.push(ga.q_tmpl),this.exprAllowed=!1},J.star.updateContext=function(b){if(b===J._function){var k=this.context.length-1;this.context[k]===ga.f_expr?this.context[k]=ga.f_expr_gen:this.context[k]=ga.f_gen}this.exprAllowed=!0},J.name.updateContext=function(b){var k=!1;this.options.ecmaVersion>=6&&b!==J.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(k=!0),this.exprAllowed=k};var Q="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",ae=Q+" Extended_Pictographic",me=ae,Me={9:Q,10:ae,11:me},Ve="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",at="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",_t=at+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",Ce=_t+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",$e={9:at,10:_t,11:Ce},Zt={};function Rr(b){var k=Zt[b]={binary:z(Me[b]+" "+Ve),nonBinary:{General_Category:z(Ve),Script:z($e[b])}};k.nonBinary.Script_Extensions=k.nonBinary.Script,k.nonBinary.gc=k.nonBinary.General_Category,k.nonBinary.sc=k.nonBinary.Script,k.nonBinary.scx=k.nonBinary.Script_Extensions}Rr(9),Rr(10),Rr(11);var nr=Tt.prototype,lr=function(k){this.parser=k,this.validFlags="gim"+(k.options.ecmaVersion>=6?"uy":"")+(k.options.ecmaVersion>=9?"s":""),this.unicodeProperties=Zt[k.options.ecmaVersion>=11?11:k.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};lr.prototype.reset=function(k,U,R){var ie=R.indexOf("u")!==-1;this.start=k|0,this.source=U+"",this.flags=R,this.switchU=ie&&this.parser.options.ecmaVersion>=6,this.switchN=ie&&this.parser.options.ecmaVersion>=9},lr.prototype.raise=function(k){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+k)},lr.prototype.at=function(k,U){U===void 0&&(U=!1);var R=this.source,ie=R.length;if(k>=ie)return-1;var Pe=R.charCodeAt(k);if(!(U||this.switchU)||Pe<=55295||Pe>=57344||k+1>=ie)return Pe;var ct=R.charCodeAt(k+1);return ct>=56320&&ct<=57343?(Pe<<10)+ct-56613888:Pe},lr.prototype.nextIndex=function(k,U){U===void 0&&(U=!1);var R=this.source,ie=R.length;if(k>=ie)return ie;var Pe=R.charCodeAt(k),ct;return!(U||this.switchU)||Pe<=55295||Pe>=57344||k+1>=ie||(ct=R.charCodeAt(k+1))<56320||ct>57343?k+1:k+2},lr.prototype.current=function(k){return k===void 0&&(k=!1),this.at(this.pos,k)},lr.prototype.lookahead=function(k){return k===void 0&&(k=!1),this.at(this.nextIndex(this.pos,k),k)},lr.prototype.advance=function(k){k===void 0&&(k=!1),this.pos=this.nextIndex(this.pos,k)},lr.prototype.eat=function(k,U){return U===void 0&&(U=!1),this.current(U)===k?(this.advance(U),!0):!1};function Lr(b){return b<=65535?String.fromCharCode(b):(b-=65536,String.fromCharCode((b>>10)+55296,(b&1023)+56320))}nr.validateRegExpFlags=function(b){for(var k=b.validFlags,U=b.flags,R=0;R<U.length;R++){var ie=U.charAt(R);k.indexOf(ie)===-1&&this.raise(b.start,"Invalid regular expression flag"),U.indexOf(ie,R+1)>-1&&this.raise(b.start,"Duplicate regular expression flag")}},nr.validateRegExpPattern=function(b){this.regexp_pattern(b),!b.switchN&&this.options.ecmaVersion>=9&&b.groupNames.length>0&&(b.switchN=!0,this.regexp_pattern(b))},nr.regexp_pattern=function(b){b.pos=0,b.lastIntValue=0,b.lastStringValue="",b.lastAssertionIsQuantifiable=!1,b.numCapturingParens=0,b.maxBackReference=0,b.groupNames.length=0,b.backReferenceNames.length=0,this.regexp_disjunction(b),b.pos!==b.source.length&&(b.eat(41)&&b.raise("Unmatched ')'"),(b.eat(93)||b.eat(125))&&b.raise("Lone quantifier brackets")),b.maxBackReference>b.numCapturingParens&&b.raise("Invalid escape");for(var k=0,U=b.backReferenceNames;k<U.length;k+=1){var R=U[k];b.groupNames.indexOf(R)===-1&&b.raise("Invalid named capture referenced")}},nr.regexp_disjunction=function(b){for(this.regexp_alternative(b);b.eat(124);)this.regexp_alternative(b);this.regexp_eatQuantifier(b,!0)&&b.raise("Nothing to repeat"),b.eat(123)&&b.raise("Lone quantifier brackets")},nr.regexp_alternative=function(b){for(;b.pos<b.source.length&&this.regexp_eatTerm(b););},nr.regexp_eatTerm=function(b){return this.regexp_eatAssertion(b)?(b.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(b)&&b.switchU&&b.raise("Invalid quantifier"),!0):(b.switchU?this.regexp_eatAtom(b):this.regexp_eatExtendedAtom(b))?(this.regexp_eatQuantifier(b),!0):!1},nr.regexp_eatAssertion=function(b){var k=b.pos;if(b.lastAssertionIsQuantifiable=!1,b.eat(94)||b.eat(36))return!0;if(b.eat(92)){if(b.eat(66)||b.eat(98))return!0;b.pos=k}if(b.eat(40)&&b.eat(63)){var U=!1;if(this.options.ecmaVersion>=9&&(U=b.eat(60)),b.eat(61)||b.eat(33))return this.regexp_disjunction(b),b.eat(41)||b.raise("Unterminated group"),b.lastAssertionIsQuantifiable=!U,!0}return b.pos=k,!1},nr.regexp_eatQuantifier=function(b,k){return k===void 0&&(k=!1),this.regexp_eatQuantifierPrefix(b,k)?(b.eat(63),!0):!1},nr.regexp_eatQuantifierPrefix=function(b,k){return b.eat(42)||b.eat(43)||b.eat(63)||this.regexp_eatBracedQuantifier(b,k)},nr.regexp_eatBracedQuantifier=function(b,k){var U=b.pos;if(b.eat(123)){var R=0,ie=-1;if(this.regexp_eatDecimalDigits(b)&&(R=b.lastIntValue,b.eat(44)&&this.regexp_eatDecimalDigits(b)&&(ie=b.lastIntValue),b.eat(125)))return ie!==-1&&ie<R&&!k&&b.raise("numbers out of order in {} quantifier"),!0;b.switchU&&!k&&b.raise("Incomplete quantifier"),b.pos=U}return!1},nr.regexp_eatAtom=function(b){return this.regexp_eatPatternCharacters(b)||b.eat(46)||this.regexp_eatReverseSolidusAtomEscape(b)||this.regexp_eatCharacterClass(b)||this.regexp_eatUncapturingGroup(b)||this.regexp_eatCapturingGroup(b)},nr.regexp_eatReverseSolidusAtomEscape=function(b){var k=b.pos;if(b.eat(92)){if(this.regexp_eatAtomEscape(b))return!0;b.pos=k}return!1},nr.regexp_eatUncapturingGroup=function(b){var k=b.pos;if(b.eat(40)){if(b.eat(63)&&b.eat(58)){if(this.regexp_disjunction(b),b.eat(41))return!0;b.raise("Unterminated group")}b.pos=k}return!1},nr.regexp_eatCapturingGroup=function(b){if(b.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(b):b.current()===63&&b.raise("Invalid group"),this.regexp_disjunction(b),b.eat(41))return b.numCapturingParens+=1,!0;b.raise("Unterminated group")}return!1},nr.regexp_eatExtendedAtom=function(b){return b.eat(46)||this.regexp_eatReverseSolidusAtomEscape(b)||this.regexp_eatCharacterClass(b)||this.regexp_eatUncapturingGroup(b)||this.regexp_eatCapturingGroup(b)||this.regexp_eatInvalidBracedQuantifier(b)||this.regexp_eatExtendedPatternCharacter(b)},nr.regexp_eatInvalidBracedQuantifier=function(b){return this.regexp_eatBracedQuantifier(b,!0)&&b.raise("Nothing to repeat"),!1},nr.regexp_eatSyntaxCharacter=function(b){var k=b.current();return Dn(k)?(b.lastIntValue=k,b.advance(),!0):!1};function Dn(b){return b===36||b>=40&&b<=43||b===46||b===63||b>=91&&b<=94||b>=123&&b<=125}nr.regexp_eatPatternCharacters=function(b){for(var k=b.pos,U=0;(U=b.current())!==-1&&!Dn(U);)b.advance();return b.pos!==k},nr.regexp_eatExtendedPatternCharacter=function(b){var k=b.current();return k!==-1&&k!==36&&!(k>=40&&k<=43)&&k!==46&&k!==63&&k!==91&&k!==94&&k!==124?(b.advance(),!0):!1},nr.regexp_groupSpecifier=function(b){if(b.eat(63)){if(this.regexp_eatGroupName(b)){b.groupNames.indexOf(b.lastStringValue)!==-1&&b.raise("Duplicate capture group name"),b.groupNames.push(b.lastStringValue);return}b.raise("Invalid group")}},nr.regexp_eatGroupName=function(b){if(b.lastStringValue="",b.eat(60)){if(this.regexp_eatRegExpIdentifierName(b)&&b.eat(62))return!0;b.raise("Invalid capture group name")}return!1},nr.regexp_eatRegExpIdentifierName=function(b){if(b.lastStringValue="",this.regexp_eatRegExpIdentifierStart(b)){for(b.lastStringValue+=Lr(b.lastIntValue);this.regexp_eatRegExpIdentifierPart(b);)b.lastStringValue+=Lr(b.lastIntValue);return!0}return!1},nr.regexp_eatRegExpIdentifierStart=function(b){var k=b.pos,U=this.options.ecmaVersion>=11,R=b.current(U);return b.advance(U),R===92&&this.regexp_eatRegExpUnicodeEscapeSequence(b,U)&&(R=b.lastIntValue),Mn(R)?(b.lastIntValue=R,!0):(b.pos=k,!1)};function Mn(b){return gt(b,!0)||b===36||b===95}nr.regexp_eatRegExpIdentifierPart=function(b){var k=b.pos,U=this.options.ecmaVersion>=11,R=b.current(U);return b.advance(U),R===92&&this.regexp_eatRegExpUnicodeEscapeSequence(b,U)&&(R=b.lastIntValue),$t(R)?(b.lastIntValue=R,!0):(b.pos=k,!1)};function $t(b){return ur(b,!0)||b===36||b===95||b===8204||b===8205}nr.regexp_eatAtomEscape=function(b){return this.regexp_eatBackReference(b)||this.regexp_eatCharacterClassEscape(b)||this.regexp_eatCharacterEscape(b)||b.switchN&&this.regexp_eatKGroupName(b)?!0:(b.switchU&&(b.current()===99&&b.raise("Invalid unicode escape"),b.raise("Invalid escape")),!1)},nr.regexp_eatBackReference=function(b){var k=b.pos;if(this.regexp_eatDecimalEscape(b)){var U=b.lastIntValue;if(b.switchU)return U>b.maxBackReference&&(b.maxBackReference=U),!0;if(U<=b.numCapturingParens)return!0;b.pos=k}return!1},nr.regexp_eatKGroupName=function(b){if(b.eat(107)){if(this.regexp_eatGroupName(b))return b.backReferenceNames.push(b.lastStringValue),!0;b.raise("Invalid named reference")}return!1},nr.regexp_eatCharacterEscape=function(b){return this.regexp_eatControlEscape(b)||this.regexp_eatCControlLetter(b)||this.regexp_eatZero(b)||this.regexp_eatHexEscapeSequence(b)||this.regexp_eatRegExpUnicodeEscapeSequence(b,!1)||!b.switchU&&this.regexp_eatLegacyOctalEscapeSequence(b)||this.regexp_eatIdentityEscape(b)},nr.regexp_eatCControlLetter=function(b){var k=b.pos;if(b.eat(99)){if(this.regexp_eatControlLetter(b))return!0;b.pos=k}return!1},nr.regexp_eatZero=function(b){return b.current()===48&&!Oi(b.lookahead())?(b.lastIntValue=0,b.advance(),!0):!1},nr.regexp_eatControlEscape=function(b){var k=b.current();return k===116?(b.lastIntValue=9,b.advance(),!0):k===110?(b.lastIntValue=10,b.advance(),!0):k===118?(b.lastIntValue=11,b.advance(),!0):k===102?(b.lastIntValue=12,b.advance(),!0):k===114?(b.lastIntValue=13,b.advance(),!0):!1},nr.regexp_eatControlLetter=function(b){var k=b.current();return Cn(k)?(b.lastIntValue=k%32,b.advance(),!0):!1};function Cn(b){return b>=65&&b<=90||b>=97&&b<=122}nr.regexp_eatRegExpUnicodeEscapeSequence=function(b,k){k===void 0&&(k=!1);var U=b.pos,R=k||b.switchU;if(b.eat(117)){if(this.regexp_eatFixedHexDigits(b,4)){var ie=b.lastIntValue;if(R&&ie>=55296&&ie<=56319){var Pe=b.pos;if(b.eat(92)&&b.eat(117)&&this.regexp_eatFixedHexDigits(b,4)){var ct=b.lastIntValue;if(ct>=56320&&ct<=57343)return b.lastIntValue=(ie-55296)*1024+(ct-56320)+65536,!0}b.pos=Pe,b.lastIntValue=ie}return!0}if(R&&b.eat(123)&&this.regexp_eatHexDigits(b)&&b.eat(125)&&hr(b.lastIntValue))return!0;R&&b.raise("Invalid unicode escape"),b.pos=U}return!1};function hr(b){return b>=0&&b<=1114111}nr.regexp_eatIdentityEscape=function(b){if(b.switchU)return this.regexp_eatSyntaxCharacter(b)?!0:b.eat(47)?(b.lastIntValue=47,!0):!1;var k=b.current();return k!==99&&(!b.switchN||k!==107)?(b.lastIntValue=k,b.advance(),!0):!1},nr.regexp_eatDecimalEscape=function(b){b.lastIntValue=0;var k=b.current();if(k>=49&&k<=57){do b.lastIntValue=10*b.lastIntValue+(k-48),b.advance();while((k=b.current())>=48&&k<=57);return!0}return!1},nr.regexp_eatCharacterClassEscape=function(b){var k=b.current();if(St(k))return b.lastIntValue=-1,b.advance(),!0;if(b.switchU&&this.options.ecmaVersion>=9&&(k===80||k===112)){if(b.lastIntValue=-1,b.advance(),b.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(b)&&b.eat(125))return!0;b.raise("Invalid property name")}return!1};function St(b){return b===100||b===68||b===115||b===83||b===119||b===87}nr.regexp_eatUnicodePropertyValueExpression=function(b){var k=b.pos;if(this.regexp_eatUnicodePropertyName(b)&&b.eat(61)){var U=b.lastStringValue;if(this.regexp_eatUnicodePropertyValue(b)){var R=b.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(b,U,R),!0}}if(b.pos=k,this.regexp_eatLoneUnicodePropertyNameOrValue(b)){var ie=b.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(b,ie),!0}return!1},nr.regexp_validateUnicodePropertyNameAndValue=function(b,k,U){Fe(b.unicodeProperties.nonBinary,k)||b.raise("Invalid property name"),b.unicodeProperties.nonBinary[k].test(U)||b.raise("Invalid property value")},nr.regexp_validateUnicodePropertyNameOrValue=function(b,k){b.unicodeProperties.binary.test(k)||b.raise("Invalid property name")},nr.regexp_eatUnicodePropertyName=function(b){var k=0;for(b.lastStringValue="";Ei(k=b.current());)b.lastStringValue+=Lr(k),b.advance();return b.lastStringValue!==""};function Ei(b){return Cn(b)||b===95}nr.regexp_eatUnicodePropertyValue=function(b){var k=0;for(b.lastStringValue="";mn(k=b.current());)b.lastStringValue+=Lr(k),b.advance();return b.lastStringValue!==""};function mn(b){return Ei(b)||Oi(b)}nr.regexp_eatLoneUnicodePropertyNameOrValue=function(b){return this.regexp_eatUnicodePropertyValue(b)},nr.regexp_eatCharacterClass=function(b){if(b.eat(91)){if(b.eat(94),this.regexp_classRanges(b),b.eat(93))return!0;b.raise("Unterminated character class")}return!1},nr.regexp_classRanges=function(b){for(;this.regexp_eatClassAtom(b);){var k=b.lastIntValue;if(b.eat(45)&&this.regexp_eatClassAtom(b)){var U=b.lastIntValue;b.switchU&&(k===-1||U===-1)&&b.raise("Invalid character class"),k!==-1&&U!==-1&&k>U&&b.raise("Range out of order in character class")}}},nr.regexp_eatClassAtom=function(b){var k=b.pos;if(b.eat(92)){if(this.regexp_eatClassEscape(b))return!0;if(b.switchU){var U=b.current();(U===99||wt(U))&&b.raise("Invalid class escape"),b.raise("Invalid escape")}b.pos=k}var R=b.current();return R!==93?(b.lastIntValue=R,b.advance(),!0):!1},nr.regexp_eatClassEscape=function(b){var k=b.pos;if(b.eat(98))return b.lastIntValue=8,!0;if(b.switchU&&b.eat(45))return b.lastIntValue=45,!0;if(!b.switchU&&b.eat(99)){if(this.regexp_eatClassControlLetter(b))return!0;b.pos=k}return this.regexp_eatCharacterClassEscape(b)||this.regexp_eatCharacterEscape(b)},nr.regexp_eatClassControlLetter=function(b){var k=b.current();return Oi(k)||k===95?(b.lastIntValue=k%32,b.advance(),!0):!1},nr.regexp_eatHexEscapeSequence=function(b){var k=b.pos;if(b.eat(120)){if(this.regexp_eatFixedHexDigits(b,2))return!0;b.switchU&&b.raise("Invalid escape"),b.pos=k}return!1},nr.regexp_eatDecimalDigits=function(b){var k=b.pos,U=0;for(b.lastIntValue=0;Oi(U=b.current());)b.lastIntValue=10*b.lastIntValue+(U-48),b.advance();return b.pos!==k};function Oi(b){return b>=48&&b<=57}nr.regexp_eatHexDigits=function(b){var k=b.pos,U=0;for(b.lastIntValue=0;ua(U=b.current());)b.lastIntValue=16*b.lastIntValue+xt(U),b.advance();return b.pos!==k};function ua(b){return b>=48&&b<=57||b>=65&&b<=70||b>=97&&b<=102}function xt(b){return b>=65&&b<=70?10+(b-65):b>=97&&b<=102?10+(b-97):b-48}nr.regexp_eatLegacyOctalEscapeSequence=function(b){if(this.regexp_eatOctalDigit(b)){var k=b.lastIntValue;if(this.regexp_eatOctalDigit(b)){var U=b.lastIntValue;k<=3&&this.regexp_eatOctalDigit(b)?b.lastIntValue=k*64+U*8+b.lastIntValue:b.lastIntValue=k*8+U}else b.lastIntValue=k;return!0}return!1},nr.regexp_eatOctalDigit=function(b){var k=b.current();return wt(k)?(b.lastIntValue=k-48,b.advance(),!0):(b.lastIntValue=0,!1)};function wt(b){return b>=48&&b<=55}nr.regexp_eatFixedHexDigits=function(b,k){var U=b.pos;b.lastIntValue=0;for(var R=0;R<k;++R){var ie=b.current();if(!ua(ie))return b.pos=U,!1;b.lastIntValue=16*b.lastIntValue+xt(ie),b.advance()}return!0};var Ri=function(k){this.type=k.type,this.value=k.value,this.start=k.start,this.end=k.end,k.options.locations&&(this.loc=new ze(k,k.startLoc,k.endLoc)),k.options.ranges&&(this.range=[k.start,k.end])},pi=Tt.prototype;pi.next=function(b){!b&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new Ri(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},pi.getToken=function(){return this.next(),new Ri(this)},typeof Symbol!="undefined"&&(pi[Symbol.iterator]=function(){var b=this;return{next:function(){var k=b.getToken();return{done:k.type===J.eof,value:k}}}}),pi.curContext=function(){return this.context[this.context.length-1]},pi.nextToken=function(){var b=this.curContext();if((!b||!b.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(J.eof);if(b.override)return b.override(this);this.readToken(this.fullCharCodeAtPos())},pi.readToken=function(b){return gt(b,this.options.ecmaVersion>=6)||b===92?this.readWord():this.getTokenFromCode(b)},pi.fullCharCodeAtPos=function(){var b=this.input.charCodeAt(this.pos);if(b<=55295||b>=57344)return b;var k=this.input.charCodeAt(this.pos+1);return(b<<10)+k-56613888},pi.skipBlockComment=function(){var b=this.options.onComment&&this.curPosition(),k=this.pos,U=this.input.indexOf("*/",this.pos+=2);if(U===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=U+2,this.options.locations){Ct.lastIndex=k;for(var R;(R=Ct.exec(this.input))&&R.index<this.pos;)++this.curLine,this.lineStart=R.index+R[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(k+2,U),k,this.pos,b,this.curPosition())},pi.skipLineComment=function(b){for(var k=this.pos,U=this.options.onComment&&this.curPosition(),R=this.input.charCodeAt(this.pos+=b);this.pos<this.input.length&&!ft(R);)R=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(k+b,this.pos),k,this.pos,U,this.curPosition())},pi.skipSpace=function(){e:for(;this.pos<this.input.length;){var b=this.input.charCodeAt(this.pos);switch(b){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(b>8&&b<14||b>=5760&&Ut.test(String.fromCharCode(b)))++this.pos;else break e}}},pi.finishToken=function(b,k){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var U=this.type;this.type=b,this.value=k,this.updateContext(U)},pi.readToken_dot=function(){var b=this.input.charCodeAt(this.pos+1);if(b>=48&&b<=57)return this.readNumber(!0);var k=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&b===46&&k===46?(this.pos+=3,this.finishToken(J.ellipsis)):(++this.pos,this.finishToken(J.dot))},pi.readToken_slash=function(){var b=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):b===61?this.finishOp(J.assign,2):this.finishOp(J.slash,1)},pi.readToken_mult_modulo_exp=function(b){var k=this.input.charCodeAt(this.pos+1),U=1,R=b===42?J.star:J.modulo;return this.options.ecmaVersion>=7&&b===42&&k===42&&(++U,R=J.starstar,k=this.input.charCodeAt(this.pos+2)),k===61?this.finishOp(J.assign,U+1):this.finishOp(R,U)},pi.readToken_pipe_amp=function(b){var k=this.input.charCodeAt(this.pos+1);if(k===b){if(this.options.ecmaVersion>=12){var U=this.input.charCodeAt(this.pos+2);if(U===61)return this.finishOp(J.assign,3)}return this.finishOp(b===124?J.logicalOR:J.logicalAND,2)}return k===61?this.finishOp(J.assign,2):this.finishOp(b===124?J.bitwiseOR:J.bitwiseAND,1)},pi.readToken_caret=function(){var b=this.input.charCodeAt(this.pos+1);return b===61?this.finishOp(J.assign,2):this.finishOp(J.bitwiseXOR,1)},pi.readToken_plus_min=function(b){var k=this.input.charCodeAt(this.pos+1);return k===b?k===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||Qt.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(J.incDec,2):k===61?this.finishOp(J.assign,2):this.finishOp(J.plusMin,1)},pi.readToken_lt_gt=function(b){var k=this.input.charCodeAt(this.pos+1),U=1;return k===b?(U=b===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+U)===61?this.finishOp(J.assign,U+1):this.finishOp(J.bitShift,U)):k===33&&b===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(k===61&&(U=2),this.finishOp(J.relational,U))},pi.readToken_eq_excl=function(b){var k=this.input.charCodeAt(this.pos+1);return k===61?this.finishOp(J.equality,this.input.charCodeAt(this.pos+2)===61?3:2):b===61&&k===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(J.arrow)):this.finishOp(b===61?J.eq:J.prefix,1)},pi.readToken_question=function(){var b=this.options.ecmaVersion;if(b>=11){var k=this.input.charCodeAt(this.pos+1);if(k===46){var U=this.input.charCodeAt(this.pos+2);if(U<48||U>57)return this.finishOp(J.questionDot,2)}if(k===63){if(b>=12){var R=this.input.charCodeAt(this.pos+2);if(R===61)return this.finishOp(J.assign,3)}return this.finishOp(J.coalesce,2)}}return this.finishOp(J.question,1)},pi.getTokenFromCode=function(b){switch(b){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(J.parenL);case 41:return++this.pos,this.finishToken(J.parenR);case 59:return++this.pos,this.finishToken(J.semi);case 44:return++this.pos,this.finishToken(J.comma);case 91:return++this.pos,this.finishToken(J.bracketL);case 93:return++this.pos,this.finishToken(J.bracketR);case 123:return++this.pos,this.finishToken(J.braceL);case 125:return++this.pos,this.finishToken(J.braceR);case 58:return++this.pos,this.finishToken(J.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(J.backQuote);case 48:var k=this.input.charCodeAt(this.pos+1);if(k===120||k===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(k===111||k===79)return this.readRadixNumber(8);if(k===98||k===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(b);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(b);case 124:case 38:return this.readToken_pipe_amp(b);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(b);case 60:case 62:return this.readToken_lt_gt(b);case 61:case 33:return this.readToken_eq_excl(b);case 63:return this.readToken_question();case 126:return this.finishOp(J.prefix,1)}this.raise(this.pos,"Unexpected character '"+la(b)+"'")},pi.finishOp=function(b,k){var U=this.input.slice(this.pos,this.pos+k);return this.pos+=k,this.finishToken(b,U)},pi.readRegexp=function(){for(var b,k,U=this.pos;;){this.pos>=this.input.length&&this.raise(U,"Unterminated regular expression");var R=this.input.charAt(this.pos);if(Qt.test(R)&&this.raise(U,"Unterminated regular expression"),b)b=!1;else{if(R==="[")k=!0;else if(R==="]"&&k)k=!1;else if(R==="/"&&!k)break;b=R==="\\"}++this.pos}var ie=this.input.slice(U,this.pos);++this.pos;var Pe=this.pos,ct=this.readWord1();this.containsEsc&&this.unexpected(Pe);var Ft=this.regexpState||(this.regexpState=new lr(this));Ft.reset(U,ie,ct),this.validateRegExpFlags(Ft),this.validateRegExpPattern(Ft);var Bt=null;try{Bt=new RegExp(ie,ct)}catch(Er){}return this.finishToken(J.regexp,{pattern:ie,flags:ct,value:Bt})},pi.readInt=function(b,k,U){for(var R=this.options.ecmaVersion>=12&&k===void 0,ie=U&&this.input.charCodeAt(this.pos)===48,Pe=this.pos,ct=0,Ft=0,Bt=0,Er=k==null?Infinity:k;Bt<Er;++Bt,++this.pos){var Zr=this.input.charCodeAt(this.pos),Wn=void 0;if(R&&Zr===95){ie&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),Ft===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),Bt===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),Ft=Zr;continue}if(Zr>=97?Wn=Zr-97+10:Zr>=65?Wn=Zr-65+10:Zr>=48&&Zr<=57?Wn=Zr-48:Wn=Infinity,Wn>=b)break;Ft=Zr,ct=ct*b+Wn}return R&&Ft===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===Pe||k!=null&&this.pos-Pe!==k?null:ct};function Ji(b,k){return k?parseInt(b,8):parseFloat(b.replace(/_/g,""))}function ea(b){return typeof BigInt!="function"?null:BigInt(b.replace(/_/g,""))}pi.readRadixNumber=function(b){var k=this.pos;this.pos+=2;var U=this.readInt(b);return U==null&&this.raise(this.start+2,"Expected number in radix "+b),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(U=ea(this.input.slice(k,this.pos)),++this.pos):gt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(J.num,U)},pi.readNumber=function(b){var k=this.pos;!b&&this.readInt(10,void 0,!0)===null&&this.raise(k,"Invalid number");var U=this.pos-k>=2&&this.input.charCodeAt(k)===48;U&&this.strict&&this.raise(k,"Invalid number");var R=this.input.charCodeAt(this.pos);if(!U&&!b&&this.options.ecmaVersion>=11&&R===110){var ie=ea(this.input.slice(k,this.pos));return++this.pos,gt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(J.num,ie)}U&&/[89]/.test(this.input.slice(k,this.pos))&&(U=!1),R===46&&!U&&(++this.pos,this.readInt(10),R=this.input.charCodeAt(this.pos)),(R===69||R===101)&&!U&&(R=this.input.charCodeAt(++this.pos),(R===43||R===45)&&++this.pos,this.readInt(10)===null&&this.raise(k,"Invalid number")),gt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var Pe=Ji(this.input.slice(k,this.pos),U);return this.finishToken(J.num,Pe)},pi.readCodePoint=function(){var b=this.input.charCodeAt(this.pos),k;if(b===123){this.options.ecmaVersion<6&&this.unexpected();var U=++this.pos;k=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,k>1114111&&this.invalidStringToken(U,"Code point out of bounds")}else k=this.readHexChar(4);return k};function la(b){return b<=65535?String.fromCharCode(b):(b-=65536,String.fromCharCode((b>>10)+55296,(b&1023)+56320))}pi.readString=function(b){for(var k="",U=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var R=this.input.charCodeAt(this.pos);if(R===b)break;R===92?(k+=this.input.slice(U,this.pos),k+=this.readEscapedChar(!1),U=this.pos):(ft(R,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return k+=this.input.slice(U,this.pos++),this.finishToken(J.string,k)};var Di={};pi.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(b){if(b===Di)this.readInvalidTemplateToken();else throw b}this.inTemplateElement=!1},pi.invalidStringToken=function(b,k){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Di;this.raise(b,k)},pi.readTmplToken=function(){for(var b="",k=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var U=this.input.charCodeAt(this.pos);if(U===96||U===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===J.template||this.type===J.invalidTemplate)?U===36?(this.pos+=2,this.finishToken(J.dollarBraceL)):(++this.pos,this.finishToken(J.backQuote)):(b+=this.input.slice(k,this.pos),this.finishToken(J.template,b));if(U===92)b+=this.input.slice(k,this.pos),b+=this.readEscapedChar(!0),k=this.pos;else if(ft(U)){switch(b+=this.input.slice(k,this.pos),++this.pos,U){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:b+=`
`;break;default:b+=String.fromCharCode(U);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),k=this.pos}else++this.pos}},pi.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(J.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},pi.readEscapedChar=function(b){var k=this.input.charCodeAt(++this.pos);switch(++this.pos,k){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return la(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(b){var U=this.pos-1;return this.invalidStringToken(U,"Invalid escape sequence in template string"),null}default:if(k>=48&&k<=55){var R=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],ie=parseInt(R,8);return ie>255&&(R=R.slice(0,-1),ie=parseInt(R,8)),this.pos+=R.length-1,k=this.input.charCodeAt(this.pos),(R!=="0"||k===56||k===57)&&(this.strict||b)&&this.invalidStringToken(this.pos-1-R.length,b?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(ie)}return ft(k)?"":String.fromCharCode(k)}},pi.readHexChar=function(b){var k=this.pos,U=this.readInt(16,b);return U===null&&this.invalidStringToken(k,"Bad character escape sequence"),U},pi.readWord1=function(){this.containsEsc=!1;for(var b="",k=!0,U=this.pos,R=this.options.ecmaVersion>=6;this.pos<this.input.length;){var ie=this.fullCharCodeAtPos();if(ur(ie,R))this.pos+=ie<=65535?1:2;else if(ie===92){this.containsEsc=!0,b+=this.input.slice(U,this.pos);var Pe=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var ct=this.readCodePoint();(k?gt:ur)(ct,R)||this.invalidStringToken(Pe,"Invalid Unicode escape"),b+=la(ct),U=this.pos}else break;k=!1}return b+this.input.slice(U,this.pos)},pi.readWord=function(){var b=this.readWord1(),k=J.name;return this.keywords.test(b)&&(k=At[b]),this.finishToken(k,b)};var gr="7.4.1";Tt.acorn={Parser:Tt,version:gr,defaultOptions:ht,Position:ce,SourceLocation:ze,getLineInfo:et,Node:ni,TokenType:Mt,tokTypes:J,keywordTypes:At,TokContext:Na,tokContexts:ga,isIdentifierChar:ur,isIdentifierStart:gt,Token:Ri,isNewLine:ft,lineBreak:Qt,lineBreakG:Ct,nonASCIIwhitespace:Ut};function Cr(b,k){return Tt.parse(b,k)}function rt(b,k,U){return Tt.parseExpressionAt(b,k,U)}function Aa(b,k){return Tt.tokenizer(b,k)}function De(b,k){b.prototype=Object.create(k.prototype),b.prototype.constructor=b,b.__proto__=k}function ws(b){var k=typeof Map=="function"?new Map:void 0;return ws=function(R){if(R===null||!Vs(R))return R;if(typeof R!="function")throw new TypeError("Super expression must either be null or a function");if(typeof k!="undefined"){if(k.has(R))return k.get(R);k.set(R,ie)}function ie(){return ia(R,arguments,Wa(this).constructor)}return ie.prototype=Object.create(R.prototype,{constructor:{value:ie,enumerable:!1,writable:!0,configurable:!0}}),no(ie,R)},ws(b)}function os(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(b){return!1}}function ia(b,k,U){return os()?ia=Reflect.construct:ia=function(ie,Pe,ct){var Ft=[null];Ft.push.apply(Ft,Pe);var Bt=Function.bind.apply(ie,Ft),Er=new Bt;return ct&&no(Er,ct.prototype),Er},ia.apply(null,arguments)}function Vs(b){return Function.toString.call(b).indexOf("[native code]")!==-1}function no(b,k){return no=Object.setPrototypeOf||function(R,ie){return R.__proto__=ie,R},no(b,k)}function Wa(b){return Wa=Object.setPrototypeOf?Object.getPrototypeOf:function(U){return U.__proto__||Object.getPrototypeOf(U)},Wa(b)}var io=function(b){De(k,b);function k(){return b.apply(this,arguments)||this}return k}(ws(Error)),ca=function(b){De(k,b);function k(){return b.apply(this,arguments)||this}return k}(ws(SyntaxError)),Ho=function(b){De(k,b);function k(){return b.apply(this,arguments)||this}return k}(ws(ReferenceError)),Jo=function(b){De(k,b);function k(){return b.apply(this,arguments)||this}return k}(ws(TypeError)),wu=function(b){De(k,b);function k(){return b.apply(this,arguments)||this}return k}(io),To=function(b){De(k,b);function k(){return b.apply(this,arguments)||this}return k}(ca),Mo=function(b){De(k,b);function k(){return b.apply(this,arguments)||this}return k}(Ho),ha={UnknownError:[3001,"%0",wu],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",wu],NodeTypeSyntaxError:[1001,"Unknown node type: %0",Mo],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",Mo],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",Mo],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",Mo],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",Mo],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",Mo],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",Mo],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",Mo],ParamTypeSyntaxError:[1009,"Unknown param type: %0",Mo],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",Mo],FunctionUndefinedReferenceError:[2001,"%0 is not a function",Ho],VariableUndefinedReferenceError:[2002,"%0 is not defined",Ho],IsNotConstructor:[2003,"%0 is not a constructor",Jo]};function ao(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(b){return!1}}function Wo(b,k,U){return ao()?Wo=Reflect.construct:Wo=function(ie,Pe,ct){var Ft=[null];Ft.push.apply(Ft,Pe);var Bt=Function.bind.apply(ie,Ft),Er=new Bt;return ct&&Ya(Er,ct.prototype),Er},Wo.apply(null,arguments)}function Ya(b,k){return Ya=Object.setPrototypeOf||function(R,ie){return R.__proto__=ie,R},Ya(b,k)}var qs="0.0.3";function Il(b,k){Object.defineProperty(b,"name",{value:k,writable:!1,enumerable:!1,configurable:!0})}var es=Object.prototype.hasOwnProperty,ve=Symbol("Break"),Oe=Symbol("Continue"),mt=Symbol("DefaultCase"),er=Symbol("EmptyStatementReturn"),en=Symbol("WithScopeName"),Hn=Symbol("SuperScopeName"),Fi=Symbol("RootScopeName"),fo=Symbol("GlobalScopeName");function za(b){return typeof b=="function"}var qa=function(){function b(U){this.interpreter=U}var k=b.prototype;return k.generator=function(){var R=this.interpreter;function ie(){return this.getCurrentScope()}function Pe(){return this.getGlobalScope()}function ct(){return this.getCurrentContext()}return{getOptions:R.getOptions.bind(R),getCurrentScope:ie.bind(R),getGlobalScope:Pe.bind(R),getCurrentContext:ct.bind(R),getExecStartTime:R.getExecStartTime.bind(R)}},b}();function ts(b,k,U){if(U===void 0&&(U=!0),!(b instanceof qa))throw new Error("Illegal call");if(typeof k!="string")return k;if(!!k){var R=b.generator(),ie=R.getOptions(),Pe={timeout:ie.timeout,_initEnv:function(){U||this.setCurrentContext(R.getCurrentContext()),this.execStartTime=R.getExecStartTime(),this.execEndTime=this.execStartTime}},ct=U?R.getGlobalScope():R.getCurrentScope(),Ft=new Ia(ct,Pe);return Ft.evaluate(k)}}Object.defineProperty(ts,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function Do(b){if(!(b instanceof qa))throw new Error("Illegal call");for(var k=b.generator(),U=arguments.length,R=new Array(U>1?U-1:0),ie=1;ie<U;ie++)R[ie-1]=arguments[ie];var Pe=R.pop(),ct=new Ia(k.getGlobalScope(),k.getOptions()),Ft=`
		    (function anonymous(`+R.join(",")+`){
		        `+Pe+`
		    });
		    `;return ct.evaluate(Ft)}Object.defineProperty(Do,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var mo=function(k){this.value=k},Cs=function(k){this.value=k},As=function(k){this.value=k},Ts=function(k,U,R){U===void 0&&(U=null),this.name=R,this.parent=U,this.data=k,this.labelStack=[]};function Ks(){}function cu(b,k){return b===void 0&&(b=null),new Ts(Object.create(null),b,k)}function ps(b){return Object.create(b)}var Zi={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Float64Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:ts,Function:Do};typeof JSON!="undefined"&&(Zi.JSON=JSON),typeof Promise!="undefined"&&(Zi.Promise=Promise),typeof Set!="undefined"&&(Zi.Set=Set),typeof Map!="undefined"&&(Zi.Map=Map),typeof Symbol!="undefined"&&(Zi.Symbol=Symbol),typeof Proxy!="undefined"&&(Zi.Proxy=Proxy),typeof WeakMap!="undefined"&&(Zi.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(Zi.WeakSet=WeakSet),typeof Reflect!="undefined"&&(Zi.Reflect=Reflect);var Ia=function(){function b(U,R){U===void 0&&(U=b.global),R===void 0&&(R={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:R.ecmaVersion||b.ecmaVersion,timeout:R.timeout||0,rootContext:R.rootContext,globalContextInFunction:R.globalContextInFunction===void 0?b.globalContextInFunction:R.globalContextInFunction,_initEnv:R._initEnv},this.context=U||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var k=b.prototype;return k.initEnvironment=function(R){var ie;if(R instanceof Ts)ie=R;else{var Pe=null,ct=this.createSuperScope(R);this.options.rootContext&&(Pe=new Ts(ps(this.options.rootContext),ct,Fi)),ie=new Ts(R,Pe||ct,fo)}this.globalScope=ie,this.currentScope=this.globalScope,this.globalContext=ie.data,this.currentContext=ie.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var Ft=this.options._initEnv;Ft&&Ft.call(this)},k.getExecStartTime=function(){return this.execStartTime},k.getExecutionTime=function(){return this.execEndTime-this.execStartTime},k.setExecTimeout=function(R){R===void 0&&(R=0),this.options.timeout=R},k.getOptions=function(){return this.options},k.getGlobalScope=function(){return this.globalScope},k.getCurrentScope=function(){return this.currentScope},k.getCurrentContext=function(){return this.currentContext},k.isInterruptThrow=function(R){return R instanceof wu||R instanceof Mo||R instanceof To},k.createSuperScope=function(R){var ie=Object.assign({},Zi),Pe=Object.keys(ie);return Pe.forEach(function(ct){ct in R&&delete ie[ct]}),new Ts(ie,null,Hn)},k.setCurrentContext=function(R){this.currentContext=R},k.setCurrentScope=function(R){this.currentScope=R},k.evaluate=function(R){R===void 0&&(R="");var ie;if(!!R)return ie=Cr(R,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||b.ecmaVersion}),this.evaluateNode(ie,R)},k.appendCode=function(R){return this.evaluate(R)},k.evaluateNode=function(R,ie){var Pe=this;ie===void 0&&(ie=""),this.value=void 0,this.source=ie,this.sourceList.push(ie),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var ct=this.getCurrentScope(),Ft=this.getCurrentContext(),Bt=ct.labelStack.concat([]),Er=this.callStack.concat([]),Zr=function(){Pe.setCurrentScope(ct),Pe.setCurrentContext(Ft),ct.labelStack=Bt,Pe.callStack=Er};try{var Wn=this.createClosure(R);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),Wn()}catch(ti){throw ti}finally{Zr(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},k.createErrorMessage=function(R,ie,Pe){var ct=R[1].replace("%0",String(ie));return Pe!==null&&(ct+=this.getNodePosition(Pe||this.lastExecNode)),ct},k.createError=function(R,ie){return new ie(R)},k.createThrowError=function(R,ie){return this.createError(R,ie)},k.createInternalThrowError=function(R,ie,Pe){return this.createError(this.createErrorMessage(R,ie,Pe),R[2])},k.checkTimeout=function(){if(!this.isRunning)return!1;var R=this.options.timeout||0,ie=Date.now();return ie-this.execStartTime>R},k.getNodePosition=function(R){if(R){var ie="";return R.loc?" ["+R.loc.start.line+":"+R.loc.start.column+"]"+ie:""}return""},k.createClosure=function(R){var ie=this,Pe;switch(R.type){case"BinaryExpression":Pe=this.binaryExpressionHandler(R);break;case"LogicalExpression":Pe=this.logicalExpressionHandler(R);break;case"UnaryExpression":Pe=this.unaryExpressionHandler(R);break;case"UpdateExpression":Pe=this.updateExpressionHandler(R);break;case"ObjectExpression":Pe=this.objectExpressionHandler(R);break;case"ArrayExpression":Pe=this.arrayExpressionHandler(R);break;case"CallExpression":Pe=this.callExpressionHandler(R);break;case"NewExpression":Pe=this.newExpressionHandler(R);break;case"MemberExpression":Pe=this.memberExpressionHandler(R);break;case"ThisExpression":Pe=this.thisExpressionHandler(R);break;case"SequenceExpression":Pe=this.sequenceExpressionHandler(R);break;case"Literal":Pe=this.literalHandler(R);break;case"Identifier":Pe=this.identifierHandler(R);break;case"AssignmentExpression":Pe=this.assignmentExpressionHandler(R);break;case"FunctionDeclaration":Pe=this.functionDeclarationHandler(R);break;case"VariableDeclaration":Pe=this.variableDeclarationHandler(R);break;case"BlockStatement":case"Program":Pe=this.programHandler(R);break;case"ExpressionStatement":Pe=this.expressionStatementHandler(R);break;case"EmptyStatement":Pe=this.emptyStatementHandler(R);break;case"ReturnStatement":Pe=this.returnStatementHandler(R);break;case"FunctionExpression":Pe=this.functionExpressionHandler(R);break;case"IfStatement":Pe=this.ifStatementHandler(R);break;case"ConditionalExpression":Pe=this.conditionalExpressionHandler(R);break;case"ForStatement":Pe=this.forStatementHandler(R);break;case"WhileStatement":Pe=this.whileStatementHandler(R);break;case"DoWhileStatement":Pe=this.doWhileStatementHandler(R);break;case"ForInStatement":Pe=this.forInStatementHandler(R);break;case"WithStatement":Pe=this.withStatementHandler(R);break;case"ThrowStatement":Pe=this.throwStatementHandler(R);break;case"TryStatement":Pe=this.tryStatementHandler(R);break;case"ContinueStatement":Pe=this.continueStatementHandler(R);break;case"BreakStatement":Pe=this.breakStatementHandler(R);break;case"SwitchStatement":Pe=this.switchStatementHandler(R);break;case"LabeledStatement":Pe=this.labeledStatementHandler(R);break;case"DebuggerStatement":Pe=this.debuggerStatementHandler(R);break;default:throw this.createInternalThrowError(ha.NodeTypeSyntaxError,R.type,R)}return function(){var ct=ie.options.timeout;if(ct&&ct>0&&ie.checkTimeout())throw ie.createInternalThrowError(ha.ExecutionTimeOutError,ct,null);return ie.lastExecNode=R,Pe.apply(void 0,arguments)}},k.binaryExpressionHandler=function(R){var ie=this,Pe=this.createClosure(R.left),ct=this.createClosure(R.right);return function(){var Ft=Pe(),Bt=ct();switch(R.operator){case"==":return Ft==Bt;case"!=":return Ft!=Bt;case"===":return Ft===Bt;case"!==":return Ft!==Bt;case"<":return Ft<Bt;case"<=":return Ft<=Bt;case">":return Ft>Bt;case">=":return Ft>=Bt;case"<<":return Ft<<Bt;case">>":return Ft>>Bt;case">>>":return Ft>>>Bt;case"+":return Ft+Bt;case"-":return Ft-Bt;case"*":return Ft*Bt;case"**":return Math.pow(Ft,Bt);case"/":return Ft/Bt;case"%":return Ft%Bt;case"|":return Ft|Bt;case"^":return Ft^Bt;case"&":return Ft&Bt;case"in":return Ft in Bt;case"instanceof":return Ft instanceof Bt;default:throw ie.createInternalThrowError(ha.BinaryOperatorSyntaxError,R.operator,R)}}},k.logicalExpressionHandler=function(R){var ie=this,Pe=this.createClosure(R.left),ct=this.createClosure(R.right);return function(){switch(R.operator){case"||":return Pe()||ct();case"&&":return Pe()&&ct();default:throw ie.createInternalThrowError(ha.LogicalOperatorSyntaxError,R.operator,R)}}},k.unaryExpressionHandler=function(R){var ie=this;switch(R.operator){case"delete":var Pe=this.createObjectGetter(R.argument),ct=this.createNameGetter(R.argument);return function(){var Zr=Pe(),Wn=ct();return delete Zr[Wn]};default:var Ft;if(R.operator==="typeof"&&R.argument.type==="Identifier"){var Bt=this.createObjectGetter(R.argument),Er=this.createNameGetter(R.argument);Ft=function(){return Bt()[Er()]}}else Ft=this.createClosure(R.argument);return function(){var Zr=Ft();switch(R.operator){case"-":return-Zr;case"+":return+Zr;case"!":return!Zr;case"~":return~Zr;case"void":return;case"typeof":return typeof Zr;default:throw ie.createInternalThrowError(ha.UnaryOperatorSyntaxError,R.operator,R)}}}},k.updateExpressionHandler=function(R){var ie=this,Pe=this.createObjectGetter(R.argument),ct=this.createNameGetter(R.argument);return function(){var Ft=Pe(),Bt=ct();switch(ie.assertVariable(Ft,Bt,R),R.operator){case"++":return R.prefix?++Ft[Bt]:Ft[Bt]++;case"--":return R.prefix?--Ft[Bt]:Ft[Bt]--;default:throw ie.createInternalThrowError(ha.UpdateOperatorSyntaxError,R.operator,R)}}},k.objectExpressionHandler=function(R){var ie=this,Pe=[];function ct(Bt){return Bt.type==="Identifier"?Bt.name:Bt.type==="Literal"?Bt.value:this.throwError(ha.ObjectStructureSyntaxError,Bt.type,Bt)}var Ft=Object.create(null);return R.properties.forEach(function(Bt){var Er=Bt.kind,Zr=ct(Bt.key);(!Ft[Zr]||Er==="init")&&(Ft[Zr]={}),Ft[Zr][Er]=ie.createClosure(Bt.value),Pe.push({key:Zr,property:Bt})}),function(){for(var Bt={},Er=Pe.length,Zr=0;Zr<Er;Zr++){var Wn=Pe[Zr],ti=Wn.key,gi=Ft[ti],$i=gi.init?gi.init():void 0,wa=gi.get?gi.get():function(){},Oa=gi.set?gi.set():function(ol){};if("set"in gi||"get"in gi){var Yi={configurable:!0,enumerable:!0,get:wa,set:Oa};Object.defineProperty(Bt,ti,Yi)}else{var ds=Wn.property,fu=ds.kind;ds.key.type==="Identifier"&&ds.value.type==="FunctionExpression"&&fu==="init"&&!ds.value.id&&Il($i,ds.key.name),Bt[ti]=$i}}return Bt}},k.arrayExpressionHandler=function(R){var ie=this,Pe=R.elements.map(function(ct){return ct&&ie.createClosure(ct)});return function(){for(var ct=Pe.length,Ft=Array(ct),Bt=0;Bt<ct;Bt++){var Er=Pe[Bt];Er&&(Ft[Bt]=Er())}return Ft}},k.safeObjectGet=function(R,ie,Pe){return R[ie]},k.createCallFunctionGetter=function(R){var ie=this;switch(R.type){case"MemberExpression":var Pe=this.createClosure(R.object),ct=this.createMemberKeyGetter(R),Ft=this.source;return function(){var Er=Pe(),Zr=ct(),Wn=ie.safeObjectGet(Er,Zr,R);if(!Wn||!za(Wn)){var ti=Ft.slice(R.start,R.end);throw ie.createInternalThrowError(ha.FunctionUndefinedReferenceError,ti,R)}return Wn.__IS_EVAL_FUNC?function(gi){return Wn(new qa(ie),gi,!0)}:Wn.__IS_FUNCTION_FUNC?function(){for(var gi=arguments.length,$i=new Array(gi),wa=0;wa<gi;wa++)$i[wa]=arguments[wa];return Wn.apply(void 0,[new qa(ie)].concat($i))}:Wn.bind(Er)};default:var Bt=this.createClosure(R);return function(){var Er="";R.type==="Identifier"&&(Er=R.name);var Zr=Bt();if(!Zr||!za(Zr))throw ie.createInternalThrowError(ha.FunctionUndefinedReferenceError,Er,R);if(R.type==="Identifier"&&Zr.__IS_EVAL_FUNC&&Er==="eval")return function(gi){var $i=ie.getScopeFromName(Er,ie.getCurrentScope()),wa=$i.name===Hn||$i.name===fo||$i.name===Fi;return Zr(new qa(ie),gi,!wa)};if(Zr.__IS_EVAL_FUNC)return function(gi){return Zr(new qa(ie),gi,!0)};if(Zr.__IS_FUNCTION_FUNC)return function(){for(var gi=arguments.length,$i=new Array(gi),wa=0;wa<gi;wa++)$i[wa]=arguments[wa];return Zr.apply(void 0,[new qa(ie)].concat($i))};var Wn=ie.options.globalContextInFunction;if(R.type==="Identifier"){var ti=ie.getIdentifierScope(R);ti.name===en&&(Wn=ti.data)}return Zr.bind(Wn)}}},k.callExpressionHandler=function(R){var ie=this,Pe=this.createCallFunctionGetter(R.callee),ct=R.arguments.map(function(Ft){return ie.createClosure(Ft)});return function(){return Pe().apply(void 0,ct.map(function(Ft){return Ft()}))}},k.functionExpressionHandler=function(R){var ie=this,Pe=this,ct=this.source,Ft=this.collectDeclVars,Bt=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var Er=R.id?R.id.name:"",Zr=R.params.length,Wn=R.params.map(function(wa){return ie.createParamNameGetter(wa)}),ti=this.createClosure(R.body),gi=this.collectDeclVars,$i=this.collectDeclFuncs;return this.collectDeclVars=Ft,this.collectDeclFuncs=Bt,function(){var wa=Pe.getCurrentScope(),Oa=function Yi(){for(var ds=arguments.length,fu=new Array(ds),ol=0;ol<ds;ol++)fu[ol]=arguments[ol];Pe.callStack.push(""+Er);var pf=Pe.getCurrentScope(),sl=cu(wa,"FunctionScope("+Er+")");Pe.setCurrentScope(sl),Pe.addDeclarationsToScope(gi,$i,sl),Er&&(sl.data[Er]=Yi),sl.data.arguments=arguments,Wn.forEach(function(Nu,zu){sl.data[Nu()]=fu[zu]});var Lc=Pe.getCurrentContext();Pe.setCurrentContext(this);var Bu=ti();if(Pe.setCurrentContext(Lc),Pe.setCurrentScope(pf),Pe.callStack.pop(),Bu instanceof mo)return Bu.value};return Il(Oa,Er),Object.defineProperty(Oa,"length",{value:Zr,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(Oa,"toString",{value:function(){return ct.slice(R.start,R.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(Oa,"valueOf",{value:function(){return ct.slice(R.start,R.end)},writable:!0,configurable:!0,enumerable:!1}),Oa}},k.newExpressionHandler=function(R){var ie=this,Pe=this.source,ct=this.createClosure(R.callee),Ft=R.arguments.map(function(Bt){return ie.createClosure(Bt)});return function(){var Bt=ct();if(!za(Bt)||Bt.__IS_EVAL_FUNC){var Er=R.callee,Zr=Pe.slice(Er.start,Er.end);throw ie.createInternalThrowError(ha.IsNotConstructor,Zr,R)}return Bt.__IS_FUNCTION_FUNC?Bt.apply(void 0,[new qa(ie)].concat(Ft.map(function(Wn){return Wn()}))):Wo(Bt,Ft.map(function(Wn){return Wn()}))}},k.memberExpressionHandler=function(R){var ie=this.createClosure(R.object),Pe=this.createMemberKeyGetter(R);return function(){var ct=ie(),Ft=Pe();return ct[Ft]}},k.thisExpressionHandler=function(R){var ie=this;return function(){return ie.getCurrentContext()}},k.sequenceExpressionHandler=function(R){var ie=this,Pe=R.expressions.map(function(ct){return ie.createClosure(ct)});return function(){for(var ct,Ft=Pe.length,Bt=0;Bt<Ft;Bt++){var Er=Pe[Bt];ct=Er()}return ct}},k.literalHandler=function(R){return function(){return R.regex?new RegExp(R.regex.pattern,R.regex.flags):R.value}},k.identifierHandler=function(R){var ie=this;return function(){var Pe=ie.getCurrentScope(),ct=ie.getScopeDataFromName(R.name,Pe);return ie.assertVariable(ct,R.name,R),ct[R.name]}},k.getIdentifierScope=function(R){var ie=this.getCurrentScope(),Pe=this.getScopeFromName(R.name,ie);return Pe},k.assignmentExpressionHandler=function(R){var ie=this;R.left.type==="Identifier"&&R.right.type==="FunctionExpression"&&!R.right.id&&(R.right.id={type:"Identifier",name:R.left.name});var Pe=this.createObjectGetter(R.left),ct=this.createNameGetter(R.left),Ft=this.createClosure(R.right);return function(){var Bt=Pe(),Er=ct(),Zr=Ft();switch(R.operator!=="="&&ie.assertVariable(Bt,Er,R),R.operator){case"=":return Bt[Er]=Zr;case"+=":return Bt[Er]+=Zr;case"-=":return Bt[Er]-=Zr;case"*=":return Bt[Er]*=Zr;case"**=":return Bt[Er]=Math.pow(Bt[Er],Zr);case"/=":return Bt[Er]/=Zr;case"%=":return Bt[Er]%=Zr;case"<<=":return Bt[Er]<<=Zr;case">>=":return Bt[Er]>>=Zr;case">>>=":return Bt[Er]>>>=Zr;case"&=":return Bt[Er]&=Zr;case"^=":return Bt[Er]^=Zr;case"|=":return Bt[Er]|=Zr;default:throw ie.createInternalThrowError(ha.AssignmentExpressionSyntaxError,R.type,R)}}},k.functionDeclarationHandler=function(R){if(R.id){var ie=this.functionExpressionHandler(R);Object.defineProperty(ie,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(R.id.name,ie)}return function(){return er}},k.getVariableName=function(R){if(R.type==="Identifier")return R.name;throw this.createInternalThrowError(ha.VariableTypeSyntaxError,R.type,R)},k.variableDeclarationHandler=function(R){for(var ie=this,Pe,ct=[],Ft=0;Ft<R.declarations.length;Ft++){var Bt=R.declarations[Ft];this.varDeclaration(this.getVariableName(Bt.id)),Bt.init&&ct.push({type:"AssignmentExpression",operator:"=",left:Bt.id,right:Bt.init})}return ct.length&&(Pe=this.createClosure({type:"BlockStatement",body:ct})),function(){if(Pe){var Er=ie.isVarDeclMode;ie.isVarDeclMode=!0,Pe(),ie.isVarDeclMode=Er}return er}},k.assertVariable=function(R,ie,Pe){if(R===this.globalScope.data&&!(ie in R))throw this.createInternalThrowError(ha.VariableUndefinedReferenceError,ie,Pe)},k.programHandler=function(R){var ie=this,Pe=R.body.map(function(ct){return ie.createClosure(ct)});return function(){for(var ct=er,Ft=0;Ft<Pe.length;Ft++){var Bt=Pe[Ft],Er=ie.setValue(Bt());if(Er!==er&&(ct=Er,ct instanceof mo||ct instanceof Cs||ct instanceof As||ct===ve||ct===Oe))break}return ct}},k.expressionStatementHandler=function(R){return this.createClosure(R.expression)},k.emptyStatementHandler=function(R){return function(){return er}},k.returnStatementHandler=function(R){var ie=R.argument?this.createClosure(R.argument):Ks;return function(){return new mo(ie())}},k.ifStatementHandler=function(R){var ie=this.createClosure(R.test),Pe=this.createClosure(R.consequent),ct=R.alternate?this.createClosure(R.alternate):function(){return er};return function(){return ie()?Pe():ct()}},k.conditionalExpressionHandler=function(R){return this.ifStatementHandler(R)},k.forStatementHandler=function(R){var ie=this,Pe=Ks,ct=R.test?this.createClosure(R.test):function(){return!0},Ft=Ks,Bt=this.createClosure(R.body);return R.type==="ForStatement"&&(Pe=R.init?this.createClosure(R.init):Pe,Ft=R.update?this.createClosure(R.update):Ks),function(Er){var Zr,Wn=er,ti=R.type==="DoWhileStatement";for(Er&&Er.type==="LabeledStatement"&&(Zr=Er.label.name),Pe();ti||ct();Ft()){ti=!1;var gi=ie.setValue(Bt());if(!(gi===er||gi===Oe)){if(gi===ve)break;if(Wn=gi,Wn instanceof As&&Wn.value===Zr){Wn=er;continue}if(Wn instanceof mo||Wn instanceof Cs||Wn instanceof As)break}}return Wn}},k.whileStatementHandler=function(R){return this.forStatementHandler(R)},k.doWhileStatementHandler=function(R){return this.forStatementHandler(R)},k.forInStatementHandler=function(R){var ie=this,Pe=R.left,ct=this.createClosure(R.right),Ft=this.createClosure(R.body);return R.left.type==="VariableDeclaration"&&(this.createClosure(R.left)(),Pe=R.left.declarations[0].id),function(Bt){var Er,Zr=er,Wn;Bt&&Bt.type==="LabeledStatement"&&(Er=Bt.label.name);var ti=ct();for(Wn in ti){ie.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:Pe,right:{type:"Literal",value:Wn}})();var gi=ie.setValue(Ft());if(!(gi===er||gi===Oe)){if(gi===ve)break;if(Zr=gi,Zr instanceof As&&Zr.value===Er){Zr=er;continue}if(Zr instanceof mo||Zr instanceof Cs||Zr instanceof As)break}}return Zr}},k.withStatementHandler=function(R){var ie=this,Pe=this.createClosure(R.object),ct=this.createClosure(R.body);return function(){var Ft=Pe(),Bt=ie.getCurrentScope(),Er=new Ts(Ft,Bt,en);ie.setCurrentScope(Er);var Zr=ie.setValue(ct());return ie.setCurrentScope(Bt),Zr}},k.throwStatementHandler=function(R){var ie=this,Pe=this.createClosure(R.argument);return function(){throw ie.setValue(void 0),Pe()}},k.tryStatementHandler=function(R){var ie=this,Pe=this.createClosure(R.block),ct=R.handler?this.catchClauseHandler(R.handler):null,Ft=R.finalizer?this.createClosure(R.finalizer):null;return function(){var Bt=ie.getCurrentScope(),Er=ie.getCurrentContext(),Zr=Bt.labelStack.concat([]),Wn=ie.callStack.concat([]),ti=er,gi,$i,wa=function(){ie.setCurrentScope(Bt),ie.setCurrentContext(Er),Bt.labelStack=Zr,ie.callStack=Wn};try{ti=ie.setValue(Pe()),ti instanceof mo&&(gi=ti)}catch(Oa){if(wa(),ie.isInterruptThrow(Oa))throw Oa;if(ct)try{ti=ie.setValue(ct(Oa)),ti instanceof mo&&(gi=ti)}catch(Yi){if(wa(),ie.isInterruptThrow(Yi))throw Yi;$i=Yi}}if(Ft)try{ti=Ft(),ti instanceof mo&&(gi=ti)}catch(Oa){if(wa(),ie.isInterruptThrow(Oa))throw Oa;$i=Oa}if($i)throw $i;return gi||ti}},k.catchClauseHandler=function(R){var ie=this,Pe=this.createParamNameGetter(R.param),ct=this.createClosure(R.body);return function(Ft){var Bt,Er=ie.getCurrentScope(),Zr=Er.data,Wn=Pe(),ti=es.call(Zr,Wn),gi=Zr[Wn];return Zr[Wn]=Ft,Bt=ct(),ti?Zr[Wn]=gi:delete Zr[Wn],Bt}},k.continueStatementHandler=function(R){return function(){return R.label?new As(R.label.name):Oe}},k.breakStatementHandler=function(R){return function(){return R.label?new Cs(R.label.name):ve}},k.switchStatementHandler=function(R){var ie=this,Pe=this.createClosure(R.discriminant),ct=R.cases.map(function(Ft){return ie.switchCaseHandler(Ft)});return function(){for(var Ft=Pe(),Bt=!1,Er,Zr,Wn,ti=0;ti<ct.length;ti++){var gi=ct[ti](),$i=gi.testClosure();if($i===mt){Wn=gi;continue}if(Bt||$i===Ft){if(Bt=!0,Zr=ie.setValue(gi.bodyClosure()),Zr===er)continue;if(Zr===ve||(Er=Zr,Er instanceof mo||Er instanceof Cs||Er instanceof As||Er===Oe))break}}if(!Bt&&Wn){Zr=ie.setValue(Wn.bodyClosure());var wa=Zr===er||Zr===ve||Zr===Oe;wa||(Er=Zr)}return Er}},k.switchCaseHandler=function(R){var ie=R.test?this.createClosure(R.test):function(){return mt},Pe=this.createClosure({type:"BlockStatement",body:R.consequent});return function(){return{testClosure:ie,bodyClosure:Pe}}},k.labeledStatementHandler=function(R){var ie=this,Pe=R.label.name,ct=this.createClosure(R.body);return function(){var Ft,Bt=ie.getCurrentScope();return Bt.labelStack.push(Pe),Ft=ct(R),Ft instanceof Cs&&Ft.value===Pe&&(Ft=er),Bt.labelStack.pop(),Ft}},k.debuggerStatementHandler=function(R){return function(){debugger;return er}},k.createParamNameGetter=function(R){if(R.type==="Identifier")return function(){return R.name};throw this.createInternalThrowError(ha.ParamTypeSyntaxError,R.type,R)},k.createObjectKeyGetter=function(R){var ie;return R.type==="Identifier"?ie=function(){return R.name}:ie=this.createClosure(R),function(){return ie()}},k.createMemberKeyGetter=function(R){return R.computed?this.createClosure(R.property):this.createObjectKeyGetter(R.property)},k.createObjectGetter=function(R){var ie=this;switch(R.type){case"Identifier":return function(){return ie.getScopeDataFromName(R.name,ie.getCurrentScope())};case"MemberExpression":return this.createClosure(R.object);default:throw this.createInternalThrowError(ha.AssignmentTypeSyntaxError,R.type,R)}},k.createNameGetter=function(R){switch(R.type){case"Identifier":return function(){return R.name};case"MemberExpression":return this.createMemberKeyGetter(R);default:throw this.createInternalThrowError(ha.AssignmentTypeSyntaxError,R.type,R)}},k.varDeclaration=function(R){var ie=this.collectDeclVars;ie[R]=void 0},k.funcDeclaration=function(R,ie){var Pe=this.collectDeclFuncs;Pe[R]=ie},k.addDeclarationsToScope=function(R,ie,Pe){var ct=Pe.data;for(var Ft in ie){var Bt=ie[Ft];ct[Ft]=Bt&&Bt()}for(var Er in R)Er in ct||(ct[Er]=void 0)},k.getScopeValue=function(R,ie){var Pe=this.getScopeFromName(R,ie);return Pe.data[R]},k.getScopeDataFromName=function(R,ie){return this.getScopeFromName(R,ie).data},k.getScopeFromName=function(R,ie){var Pe=ie;do if(R in Pe.data)return Pe;while(Pe=Pe.parent);return this.globalScope},k.setValue=function(R){var ie=this.callStack.length;return this.isVarDeclMode||ie||R===er||R===ve||R===Oe||R instanceof Cs||R instanceof As||(this.value=R instanceof mo?R.value:R),R},k.getValue=function(){return this.value},b}();Ia.version=qs,Ia.eval=ts,Ia.Function=Do,Ia.ecmaVersion=5,Ia.globalContextInFunction=void 0,Ia.global=Object.create(null);function Oc(b){return b===void 0&&(b=Object.create(null)),b}function ff(b,k,U){k===void 0&&(k=[]),U===void 0&&(U={});var R=U.parsingContext,ie=U.timeout===void 0?0:U.timeout,Pe=`
    (function anonymous(`+k.join(",")+`){
         `+b+`
    });
    `,ct=new Ia(R,{ecmaVersion:U.ecmaVersion,timeout:ie,rootContext:U.rootContext,globalContextInFunction:U.globalContextInFunction});return ct.evaluate(Pe)}function Ms(b,k,U){var R=new Ia(k,U);return R.evaluate(b)}var hf=Ms,al=function(){function b(U){this._code=U}var k=b.prototype;return k.runInContext=function(R){return Ms(this._code,R)},k.runInNewContext=function(R){return Ms(this._code,R)},b}(),$u=function(b,k,U){return Ms(b,k,U)};function Qs(){for(var b=arguments.length,k=new Array(b),U=0;U<b;U++)k[U]=arguments[U];var R=k.pop();return ff(R||"",k)}var Pl=$u},20396:function(Br,pe,K){var Ee;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(ne,y,Te,W){"use strict";var ye=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,se=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),Ye=ye||se,_e=["","webkit","Moz","MS","ms","o"],Qe=Ye?"":y.createElement("div"),lt="function",bt=Math.round,gt=Math.abs,ur=Date.now;function Mt(ve,Oe,mt){return setTimeout(Ct(ve,mt),Oe)}function qt(ve,Oe,mt){return Array.isArray(ve)?(zt(ve,mt[Oe],mt),!0):!1}function zt(ve,Oe,mt){var er;if(!!ve)if(ve.forEach)ve.forEach(Oe,mt);else if(ve.length!==W)for(er=0;er<ve.length;)Oe.call(mt,ve[er],er,ve),er++;else for(er in ve)ve.hasOwnProperty(er)&&Oe.call(mt,ve[er],er,ve)}function yt(ve,Oe,mt){var er="DEPRECATED METHOD: "+Oe+`
`+mt+` AT 
`;return function(){var en=new Error("get-stack-trace"),Hn=en&&en.stack?en.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Fi=ne.console&&(ne.console.warn||ne.console.log);return Fi&&Fi.call(ne.console,er,Hn),ve.apply(this,arguments)}}var At;typeof Object.assign!="function"?At=function(Oe){if(Oe===W||Oe===null)throw new TypeError("Cannot convert undefined or null to object");for(var mt=Object(Oe),er=1;er<arguments.length;er++){var en=arguments[er];if(en!==W&&en!==null)for(var Hn in en)en.hasOwnProperty(Hn)&&(mt[Hn]=en[Hn])}return mt}:At=Object.assign;var ar=yt(function(Oe,mt,er){for(var en=Object.keys(mt),Hn=0;Hn<en.length;)(!er||er&&Oe[en[Hn]]===W)&&(Oe[en[Hn]]=mt[en[Hn]]),Hn++;return Oe},"extend","Use `assign`."),J=yt(function(Oe,mt){return ar(Oe,mt,!0)},"merge","Use `assign`.");function Qt(ve,Oe,mt){var er=Oe.prototype,en;en=ve.prototype=Object.create(er),en.constructor=ve,en._super=er,mt&&At(en,mt)}function Ct(ve,Oe){return function(){return ve.apply(Oe,arguments)}}function ft(ve,Oe){return typeof ve==lt?ve.apply(Oe&&Oe[0]||W,Oe):ve}function Ut(ve,Oe){return ve===W?Oe:ve}function dt(ve,Oe,mt){zt(Fe(Oe),function(er){ve.addEventListener(er,mt,!1)})}function rr(ve,Oe,mt){zt(Fe(Oe),function(er){ve.removeEventListener(er,mt,!1)})}function wr(ve,Oe){for(;ve;){if(ve==Oe)return!0;ve=ve.parentNode}return!1}function re(ve,Oe){return ve.indexOf(Oe)>-1}function Fe(ve){return ve.trim().split(/\s+/g)}function N(ve,Oe,mt){if(ve.indexOf&&!mt)return ve.indexOf(Oe);for(var er=0;er<ve.length;){if(mt&&ve[er][mt]==Oe||!mt&&ve[er]===Oe)return er;er++}return-1}function z(ve){return Array.prototype.slice.call(ve,0)}function ce(ve,Oe,mt){for(var er=[],en=[],Hn=0;Hn<ve.length;){var Fi=Oe?ve[Hn][Oe]:ve[Hn];N(en,Fi)<0&&er.push(ve[Hn]),en[Hn]=Fi,Hn++}return mt&&(Oe?er=er.sort(function(za,qa){return za[Oe]>qa[Oe]}):er=er.sort()),er}function ze(ve,Oe){for(var mt,er,en=Oe[0].toUpperCase()+Oe.slice(1),Hn=0;Hn<_e.length;){if(mt=_e[Hn],er=mt?mt+en:Oe,er in ve)return er;Hn++}return W}var et=1;function ht(){return et++}function Rt(ve){var Oe=ve.ownerDocument||ve;return Oe.defaultView||Oe.parentWindow||ne}var Jt=/mobile|tablet|ip(ad|hone|od)|android/i,Or="ontouchstart"in ne,Tr=ze(ne,"PointerEvent")!==W,Pn=Or&&Jt.test(navigator.userAgent),Nr="touch",wn="pen",Xi="mouse",mi="kinect",si=25,ki=1,bi=2,li=4,Zn=8,qn=1,ro=2,ka=4,oa=8,Tt=16,ge=ro|ka,ue=oa|Tt,we=ge|ue,Z=["x","y"],Je=["clientX","clientY"];function Xt(ve,Oe){var mt=this;this.manager=ve,this.callback=Oe,this.element=ve.element,this.target=ve.options.inputTarget,this.domHandler=function(er){ft(ve.options.enable,[ve])&&mt.handler(er)},this.init()}Xt.prototype={handler:function(){},init:function(){this.evEl&&dt(this.element,this.evEl,this.domHandler),this.evTarget&&dt(this.target,this.evTarget,this.domHandler),this.evWin&&dt(Rt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&rr(this.element,this.evEl,this.domHandler),this.evTarget&&rr(this.target,this.evTarget,this.domHandler),this.evWin&&rr(Rt(this.element),this.evWin,this.domHandler)}};function Dr(ve){var Oe,mt=ve.options.inputClass;return mt?Oe=mt:Tr?Oe=Ve:Pn?Oe=lr:Or?Oe=$t:Oe=ta,new Oe(ve,tt)}function tt(ve,Oe,mt){var er=mt.pointers.length,en=mt.changedPointers.length,Hn=Oe&ki&&er-en==0,Fi=Oe&(li|Zn)&&er-en==0;mt.isFirst=!!Hn,mt.isFinal=!!Fi,Hn&&(ve.session={}),mt.eventType=Oe,It(ve,mt),ve.emit("hammer.input",mt),ve.recognize(mt),ve.session.prevInput=mt}function It(ve,Oe){var mt=ve.session,er=Oe.pointers,en=er.length;mt.firstInput||(mt.firstInput=$r(Oe)),en>1&&!mt.firstMultiple?mt.firstMultiple=$r(Oe):en===1&&(mt.firstMultiple=!1);var Hn=mt.firstInput,Fi=mt.firstMultiple,fo=Fi?Fi.center:Hn.center,za=Oe.center=tn(er);Oe.timeStamp=ur(),Oe.deltaTime=Oe.timeStamp-Hn.timeStamp,Oe.angle=vi(fo,za),Oe.distance=rn(fo,za),mr(mt,Oe),Oe.offsetDirection=Vn(Oe.deltaX,Oe.deltaY);var qa=$n(Oe.deltaTime,Oe.deltaX,Oe.deltaY);Oe.overallVelocityX=qa.x,Oe.overallVelocityY=qa.y,Oe.overallVelocity=gt(qa.x)>gt(qa.y)?qa.x:qa.y,Oe.scale=Fi?sa(Fi.pointers,er):1,Oe.rotation=Fi?ni(Fi.pointers,er):0,Oe.maxPointers=mt.prevInput?Oe.pointers.length>mt.prevInput.maxPointers?Oe.pointers.length:mt.prevInput.maxPointers:Oe.pointers.length,Ir(mt,Oe);var ts=ve.element;wr(Oe.srcEvent.target,ts)&&(ts=Oe.srcEvent.target),Oe.target=ts}function mr(ve,Oe){var mt=Oe.center,er=ve.offsetDelta||{},en=ve.prevDelta||{},Hn=ve.prevInput||{};(Oe.eventType===ki||Hn.eventType===li)&&(en=ve.prevDelta={x:Hn.deltaX||0,y:Hn.deltaY||0},er=ve.offsetDelta={x:mt.x,y:mt.y}),Oe.deltaX=en.x+(mt.x-er.x),Oe.deltaY=en.y+(mt.y-er.y)}function Ir(ve,Oe){var mt=ve.lastInterval||Oe,er=Oe.timeStamp-mt.timeStamp,en,Hn,Fi,fo;if(Oe.eventType!=Zn&&(er>si||mt.velocity===W)){var za=Oe.deltaX-mt.deltaX,qa=Oe.deltaY-mt.deltaY,ts=$n(er,za,qa);Hn=ts.x,Fi=ts.y,en=gt(ts.x)>gt(ts.y)?ts.x:ts.y,fo=Vn(za,qa),ve.lastInterval=Oe}else en=mt.velocity,Hn=mt.velocityX,Fi=mt.velocityY,fo=mt.direction;Oe.velocity=en,Oe.velocityX=Hn,Oe.velocityY=Fi,Oe.direction=fo}function $r(ve){for(var Oe=[],mt=0;mt<ve.pointers.length;)Oe[mt]={clientX:bt(ve.pointers[mt].clientX),clientY:bt(ve.pointers[mt].clientY)},mt++;return{timeStamp:ur(),pointers:Oe,center:tn(Oe),deltaX:ve.deltaX,deltaY:ve.deltaY}}function tn(ve){var Oe=ve.length;if(Oe===1)return{x:bt(ve[0].clientX),y:bt(ve[0].clientY)};for(var mt=0,er=0,en=0;en<Oe;)mt+=ve[en].clientX,er+=ve[en].clientY,en++;return{x:bt(mt/Oe),y:bt(er/Oe)}}function $n(ve,Oe,mt){return{x:Oe/ve||0,y:mt/ve||0}}function Vn(ve,Oe){return ve===Oe?qn:gt(ve)>=gt(Oe)?ve<0?ro:ka:Oe<0?oa:Tt}function rn(ve,Oe,mt){mt||(mt=Z);var er=Oe[mt[0]]-ve[mt[0]],en=Oe[mt[1]]-ve[mt[1]];return Math.sqrt(er*er+en*en)}function vi(ve,Oe,mt){mt||(mt=Z);var er=Oe[mt[0]]-ve[mt[0]],en=Oe[mt[1]]-ve[mt[1]];return Math.atan2(en,er)*180/Math.PI}function ni(ve,Oe){return vi(Oe[1],Oe[0],Je)+vi(ve[1],ve[0],Je)}function sa(ve,Oe){return rn(Oe[0],Oe[1],Je)/rn(ve[0],ve[1],Je)}var Sa={mousedown:ki,mousemove:bi,mouseup:li},Na="mousedown",ga="mousemove mouseup";function ta(){this.evEl=Na,this.evWin=ga,this.pressed=!1,Xt.apply(this,arguments)}Qt(ta,Xt,{handler:function(Oe){var mt=Sa[Oe.type];mt&ki&&Oe.button===0&&(this.pressed=!0),mt&bi&&Oe.which!==1&&(mt=li),!!this.pressed&&(mt&li&&(this.pressed=!1),this.callback(this.manager,mt,{pointers:[Oe],changedPointers:[Oe],pointerType:Xi,srcEvent:Oe}))}});var Q={pointerdown:ki,pointermove:bi,pointerup:li,pointercancel:Zn,pointerout:Zn},ae={2:Nr,3:wn,4:Xi,5:mi},me="pointerdown",Me="pointermove pointerup pointercancel";!Ye&&ne.MSPointerEvent&&!ne.PointerEvent&&(me="MSPointerDown",Me="MSPointerMove MSPointerUp MSPointerCancel");function Ve(){this.evEl=me,this.evWin=Me,Xt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}Qt(Ve,Xt,{handler:function(Oe){var mt=this.store,er=!1,en=Oe.type.toLowerCase().replace("ms",""),Hn=Q[en],Fi=ae[Oe.pointerType]||Oe.pointerType,fo=Fi==Nr,za=N(mt,Oe.pointerId,"pointerId");Hn&ki&&(Oe.button===0||fo)?za<0&&(mt.push(Oe),za=mt.length-1):Hn&(li|Zn)&&(er=!0),!(za<0)&&(mt[za]=Oe,this.callback(this.manager,Hn,{pointers:mt,changedPointers:[Oe],pointerType:Fi,srcEvent:Oe}),er&&mt.splice(za,1))}});var at={touchstart:ki,touchmove:bi,touchend:li,touchcancel:Zn},_t="touchstart",Ce="touchstart touchmove touchend touchcancel";function $e(){this.evTarget=_t,this.evWin=Ce,this.started=!1,Xt.apply(this,arguments)}Qt($e,Xt,{handler:function(Oe){var mt=at[Oe.type];if(mt===ki&&(this.started=!0),!!this.started){var er=Zt.call(this,Oe,mt);mt&(li|Zn)&&er[0].length-er[1].length==0&&(this.started=!1),this.callback(this.manager,mt,{pointers:er[0],changedPointers:er[1],pointerType:Nr,srcEvent:Oe})}}});function Zt(ve,Oe){var mt=z(ve.touches),er=z(ve.changedTouches);return Oe&(li|Zn)&&(mt=ce(mt.concat(er),"identifier",!0)),[mt,er]}var Rr={touchstart:ki,touchmove:bi,touchend:li,touchcancel:Zn},nr="touchstart touchmove touchend touchcancel";function lr(){this.evTarget=nr,this.targetIds={},Xt.apply(this,arguments)}Qt(lr,Xt,{handler:function(Oe){var mt=Rr[Oe.type],er=Lr.call(this,Oe,mt);!er||this.callback(this.manager,mt,{pointers:er[0],changedPointers:er[1],pointerType:Nr,srcEvent:Oe})}});function Lr(ve,Oe){var mt=z(ve.touches),er=this.targetIds;if(Oe&(ki|bi)&&mt.length===1)return er[mt[0].identifier]=!0,[mt,mt];var en,Hn,Fi=z(ve.changedTouches),fo=[],za=this.target;if(Hn=mt.filter(function(qa){return wr(qa.target,za)}),Oe===ki)for(en=0;en<Hn.length;)er[Hn[en].identifier]=!0,en++;for(en=0;en<Fi.length;)er[Fi[en].identifier]&&fo.push(Fi[en]),Oe&(li|Zn)&&delete er[Fi[en].identifier],en++;if(!!fo.length)return[ce(Hn.concat(fo),"identifier",!0),fo]}var Dn=2500,Mn=25;function $t(){Xt.apply(this,arguments);var ve=Ct(this.handler,this);this.touch=new lr(this.manager,ve),this.mouse=new ta(this.manager,ve),this.primaryTouch=null,this.lastTouches=[]}Qt($t,Xt,{handler:function(Oe,mt,er){var en=er.pointerType==Nr,Hn=er.pointerType==Xi;if(!(Hn&&er.sourceCapabilities&&er.sourceCapabilities.firesTouchEvents)){if(en)Cn.call(this,mt,er);else if(Hn&&St.call(this,er))return;this.callback(Oe,mt,er)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Cn(ve,Oe){ve&ki?(this.primaryTouch=Oe.changedPointers[0].identifier,hr.call(this,Oe)):ve&(li|Zn)&&hr.call(this,Oe)}function hr(ve){var Oe=ve.changedPointers[0];if(Oe.identifier===this.primaryTouch){var mt={x:Oe.clientX,y:Oe.clientY};this.lastTouches.push(mt);var er=this.lastTouches,en=function(){var Hn=er.indexOf(mt);Hn>-1&&er.splice(Hn,1)};setTimeout(en,Dn)}}function St(ve){for(var Oe=ve.srcEvent.clientX,mt=ve.srcEvent.clientY,er=0;er<this.lastTouches.length;er++){var en=this.lastTouches[er],Hn=Math.abs(Oe-en.x),Fi=Math.abs(mt-en.y);if(Hn<=Mn&&Fi<=Mn)return!0}return!1}var Ei=Ye?W:ze(Qe.style,"touchAction"),mn=Ei!==W,Oi="compute",ua="auto",xt="manipulation",wt="none",Ri="pan-x",pi="pan-y",Ji=Di();function ea(ve,Oe){this.manager=ve,this.set(Oe)}ea.prototype={set:function(ve){ve==Oi&&(ve=this.compute()),mn&&this.manager.element.style&&Ji[ve]&&(this.manager.element.style[Ei]=ve),this.actions=ve.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var ve=[];return zt(this.manager.recognizers,function(Oe){ft(Oe.options.enable,[Oe])&&(ve=ve.concat(Oe.getTouchAction()))}),la(ve.join(" "))},preventDefaults:function(ve){var Oe=ve.srcEvent,mt=ve.offsetDirection;if(this.manager.session.prevented){Oe.preventDefault();return}var er=this.actions,en=re(er,wt)&&!Ji[wt],Hn=re(er,pi)&&!Ji[pi],Fi=re(er,Ri)&&!Ji[Ri];if(en){var fo=ve.pointers.length===1,za=ve.distance<2,qa=ve.deltaTime<250;if(fo&&za&&qa)return}if(!(Fi&&Hn)&&(en||Hn&&mt&ge||Fi&&mt&ue))return this.preventSrc(Oe)},preventSrc:function(ve){this.manager.session.prevented=!0,ve.preventDefault()}};function la(ve){if(re(ve,wt))return wt;var Oe=re(ve,Ri),mt=re(ve,pi);return Oe&&mt?wt:Oe||mt?Oe?Ri:pi:re(ve,xt)?xt:ua}function Di(){if(!mn)return!1;var ve={};if(Ye)return ve;var Oe=ne.CSS&&ne.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(mt){ve[mt]=Oe?ne.CSS.supports("touch-action",mt):!0}),ve}var gr=1,Cr=2,rt=4,Aa=8,De=Aa,ws=16,os=32;function ia(ve){this.options=At({},this.defaults,ve||{}),this.id=ht(),this.manager=null,this.options.enable=Ut(this.options.enable,!0),this.state=gr,this.simultaneous={},this.requireFail=[]}ia.prototype={defaults:{},set:function(ve){return At(this.options,ve),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(ve){if(qt(ve,"recognizeWith",this))return this;var Oe=this.simultaneous;return ve=Wa(ve,this),Oe[ve.id]||(Oe[ve.id]=ve,ve.recognizeWith(this)),this},dropRecognizeWith:function(ve){return qt(ve,"dropRecognizeWith",this)?this:(ve=Wa(ve,this),delete this.simultaneous[ve.id],this)},requireFailure:function(ve){if(qt(ve,"requireFailure",this))return this;var Oe=this.requireFail;return ve=Wa(ve,this),N(Oe,ve)===-1&&(Oe.push(ve),ve.requireFailure(this)),this},dropRequireFailure:function(ve){if(qt(ve,"dropRequireFailure",this))return this;ve=Wa(ve,this);var Oe=N(this.requireFail,ve);return Oe>-1&&this.requireFail.splice(Oe,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(ve){return!!this.simultaneous[ve.id]},emit:function(ve){var Oe=this,mt=this.state;function er(en){Oe.manager.emit(en,ve)}mt<Aa&&er(Oe.options.event+Vs(mt)),er(Oe.options.event),ve.additionalEvent&&er(ve.additionalEvent),mt>=Aa&&er(Oe.options.event+Vs(mt))},tryEmit:function(ve){if(this.canEmit())return this.emit(ve);this.state=os},canEmit:function(){for(var ve=0;ve<this.requireFail.length;){if(!(this.requireFail[ve].state&(os|gr)))return!1;ve++}return!0},recognize:function(ve){var Oe=At({},ve);if(!ft(this.options.enable,[this,Oe])){this.reset(),this.state=os;return}this.state&(De|ws|os)&&(this.state=gr),this.state=this.process(Oe),this.state&(Cr|rt|Aa|ws)&&this.tryEmit(Oe)},process:function(ve){},getTouchAction:function(){},reset:function(){}};function Vs(ve){return ve&ws?"cancel":ve&Aa?"end":ve&rt?"move":ve&Cr?"start":""}function no(ve){return ve==Tt?"down":ve==oa?"up":ve==ro?"left":ve==ka?"right":""}function Wa(ve,Oe){var mt=Oe.manager;return mt?mt.get(ve):ve}function io(){ia.apply(this,arguments)}Qt(io,ia,{defaults:{pointers:1},attrTest:function(ve){var Oe=this.options.pointers;return Oe===0||ve.pointers.length===Oe},process:function(ve){var Oe=this.state,mt=ve.eventType,er=Oe&(Cr|rt),en=this.attrTest(ve);return er&&(mt&Zn||!en)?Oe|ws:er||en?mt&li?Oe|Aa:Oe&Cr?Oe|rt:Cr:os}});function ca(){io.apply(this,arguments),this.pX=null,this.pY=null}Qt(ca,io,{defaults:{event:"pan",threshold:10,pointers:1,direction:we},getTouchAction:function(){var ve=this.options.direction,Oe=[];return ve&ge&&Oe.push(pi),ve&ue&&Oe.push(Ri),Oe},directionTest:function(ve){var Oe=this.options,mt=!0,er=ve.distance,en=ve.direction,Hn=ve.deltaX,Fi=ve.deltaY;return en&Oe.direction||(Oe.direction&ge?(en=Hn===0?qn:Hn<0?ro:ka,mt=Hn!=this.pX,er=Math.abs(ve.deltaX)):(en=Fi===0?qn:Fi<0?oa:Tt,mt=Fi!=this.pY,er=Math.abs(ve.deltaY))),ve.direction=en,mt&&er>Oe.threshold&&en&Oe.direction},attrTest:function(ve){return io.prototype.attrTest.call(this,ve)&&(this.state&Cr||!(this.state&Cr)&&this.directionTest(ve))},emit:function(ve){this.pX=ve.deltaX,this.pY=ve.deltaY;var Oe=no(ve.direction);Oe&&(ve.additionalEvent=this.options.event+Oe),this._super.emit.call(this,ve)}});function Ho(){io.apply(this,arguments)}Qt(Ho,io,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[wt]},attrTest:function(ve){return this._super.attrTest.call(this,ve)&&(Math.abs(ve.scale-1)>this.options.threshold||this.state&Cr)},emit:function(ve){if(ve.scale!==1){var Oe=ve.scale<1?"in":"out";ve.additionalEvent=this.options.event+Oe}this._super.emit.call(this,ve)}});function Jo(){ia.apply(this,arguments),this._timer=null,this._input=null}Qt(Jo,ia,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[ua]},process:function(ve){var Oe=this.options,mt=ve.pointers.length===Oe.pointers,er=ve.distance<Oe.threshold,en=ve.deltaTime>Oe.time;if(this._input=ve,!er||!mt||ve.eventType&(li|Zn)&&!en)this.reset();else if(ve.eventType&ki)this.reset(),this._timer=Mt(function(){this.state=De,this.tryEmit()},Oe.time,this);else if(ve.eventType&li)return De;return os},reset:function(){clearTimeout(this._timer)},emit:function(ve){this.state===De&&(ve&&ve.eventType&li?this.manager.emit(this.options.event+"up",ve):(this._input.timeStamp=ur(),this.manager.emit(this.options.event,this._input)))}});function wu(){io.apply(this,arguments)}Qt(wu,io,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[wt]},attrTest:function(ve){return this._super.attrTest.call(this,ve)&&(Math.abs(ve.rotation)>this.options.threshold||this.state&Cr)}});function To(){io.apply(this,arguments)}Qt(To,io,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:ge|ue,pointers:1},getTouchAction:function(){return ca.prototype.getTouchAction.call(this)},attrTest:function(ve){var Oe=this.options.direction,mt;return Oe&(ge|ue)?mt=ve.overallVelocity:Oe&ge?mt=ve.overallVelocityX:Oe&ue&&(mt=ve.overallVelocityY),this._super.attrTest.call(this,ve)&&Oe&ve.offsetDirection&&ve.distance>this.options.threshold&&ve.maxPointers==this.options.pointers&&gt(mt)>this.options.velocity&&ve.eventType&li},emit:function(ve){var Oe=no(ve.offsetDirection);Oe&&this.manager.emit(this.options.event+Oe,ve),this.manager.emit(this.options.event,ve)}});function Mo(){ia.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}Qt(Mo,ia,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[xt]},process:function(ve){var Oe=this.options,mt=ve.pointers.length===Oe.pointers,er=ve.distance<Oe.threshold,en=ve.deltaTime<Oe.time;if(this.reset(),ve.eventType&ki&&this.count===0)return this.failTimeout();if(er&&en&&mt){if(ve.eventType!=li)return this.failTimeout();var Hn=this.pTime?ve.timeStamp-this.pTime<Oe.interval:!0,Fi=!this.pCenter||rn(this.pCenter,ve.center)<Oe.posThreshold;this.pTime=ve.timeStamp,this.pCenter=ve.center,!Fi||!Hn?this.count=1:this.count+=1,this._input=ve;var fo=this.count%Oe.taps;if(fo===0)return this.hasRequireFailures()?(this._timer=Mt(function(){this.state=De,this.tryEmit()},Oe.interval,this),Cr):De}return os},failTimeout:function(){return this._timer=Mt(function(){this.state=os},this.options.interval,this),os},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==De&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function ha(ve,Oe){return Oe=Oe||{},Oe.recognizers=Ut(Oe.recognizers,ha.defaults.preset),new Ya(ve,Oe)}ha.VERSION="2.0.7",ha.defaults={domEvents:!1,touchAction:Oi,enable:!0,inputTarget:null,inputClass:null,preset:[[wu,{enable:!1}],[Ho,{enable:!1},["rotate"]],[To,{direction:ge}],[ca,{direction:ge},["swipe"]],[Mo],[Mo,{event:"doubletap",taps:2},["tap"]],[Jo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var ao=1,Wo=2;function Ya(ve,Oe){this.options=At({},ha.defaults,Oe||{}),this.options.inputTarget=this.options.inputTarget||ve,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=ve,this.input=Dr(this),this.touchAction=new ea(this,this.options.touchAction),qs(this,!0),zt(this.options.recognizers,function(mt){var er=this.add(new mt[0](mt[1]));mt[2]&&er.recognizeWith(mt[2]),mt[3]&&er.requireFailure(mt[3])},this)}Ya.prototype={set:function(ve){return At(this.options,ve),ve.touchAction&&this.touchAction.update(),ve.inputTarget&&(this.input.destroy(),this.input.target=ve.inputTarget,this.input.init()),this},stop:function(ve){this.session.stopped=ve?Wo:ao},recognize:function(ve){var Oe=this.session;if(!Oe.stopped){this.touchAction.preventDefaults(ve);var mt,er=this.recognizers,en=Oe.curRecognizer;(!en||en&&en.state&De)&&(en=Oe.curRecognizer=null);for(var Hn=0;Hn<er.length;)mt=er[Hn],Oe.stopped!==Wo&&(!en||mt==en||mt.canRecognizeWith(en))?mt.recognize(ve):mt.reset(),!en&&mt.state&(Cr|rt|Aa)&&(en=Oe.curRecognizer=mt),Hn++}},get:function(ve){if(ve instanceof ia)return ve;for(var Oe=this.recognizers,mt=0;mt<Oe.length;mt++)if(Oe[mt].options.event==ve)return Oe[mt];return null},add:function(ve){if(qt(ve,"add",this))return this;var Oe=this.get(ve.options.event);return Oe&&this.remove(Oe),this.recognizers.push(ve),ve.manager=this,this.touchAction.update(),ve},remove:function(ve){if(qt(ve,"remove",this))return this;if(ve=this.get(ve),ve){var Oe=this.recognizers,mt=N(Oe,ve);mt!==-1&&(Oe.splice(mt,1),this.touchAction.update())}return this},on:function(ve,Oe){if(ve!==W&&Oe!==W){var mt=this.handlers;return zt(Fe(ve),function(er){mt[er]=mt[er]||[],mt[er].push(Oe)}),this}},off:function(ve,Oe){if(ve!==W){var mt=this.handlers;return zt(Fe(ve),function(er){Oe?mt[er]&&mt[er].splice(N(mt[er],Oe),1):delete mt[er]}),this}},emit:function(ve,Oe){this.options.domEvents&&Il(ve,Oe);var mt=this.handlers[ve]&&this.handlers[ve].slice();if(!(!mt||!mt.length)){Oe.type=ve,Oe.preventDefault=function(){Oe.srcEvent.preventDefault()};for(var er=0;er<mt.length;)mt[er](Oe),er++}},destroy:function(){this.element&&qs(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function qs(ve,Oe){var mt=ve.element;if(!!mt.style){var er;zt(ve.options.cssProps,function(en,Hn){er=ze(mt.style,Hn),Oe?(ve.oldCssProps[er]=mt.style[er],mt.style[er]=en):mt.style[er]=ve.oldCssProps[er]||""}),Oe||(ve.oldCssProps={})}}function Il(ve,Oe){if(!Ye){var mt=y.createEvent("Event");mt.initEvent(ve,!0,!0),mt.gesture=Oe,Oe.target.dispatchEvent(mt)}}if(!Ye){At(ha,{INPUT_START:ki,INPUT_MOVE:bi,INPUT_END:li,INPUT_CANCEL:Zn,STATE_POSSIBLE:gr,STATE_BEGAN:Cr,STATE_CHANGED:rt,STATE_ENDED:Aa,STATE_RECOGNIZED:De,STATE_CANCELLED:ws,STATE_FAILED:os,DIRECTION_NONE:qn,DIRECTION_LEFT:ro,DIRECTION_RIGHT:ka,DIRECTION_UP:oa,DIRECTION_DOWN:Tt,DIRECTION_HORIZONTAL:ge,DIRECTION_VERTICAL:ue,DIRECTION_ALL:we,Manager:Ya,Input:Xt,TouchAction:ea,TouchInput:lr,MouseInput:ta,PointerEventInput:Ve,TouchMouseInput:$t,SingleTouchInput:$e,Recognizer:ia,AttrRecognizer:io,Tap:Mo,Pan:ca,Swipe:To,Pinch:Ho,Rotate:wu,Press:Jo,on:dt,off:rr,each:zt,merge:J,extend:ar,assign:At,inherit:Qt,bindFn:Ct,prefixed:ze});var es=typeof window!="undefined"?window:typeof self!="undefined"?self:{};es.Hammer=ha,Ee=function(){return ha}.call(pe,K,pe,Br),Ee!==W&&(Br.exports=Ee)}})(typeof window!="undefined"?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document,"Hammer")},88307:function(Br,pe,K){(function(Ee,ne){Br.exports=ne(K(18857))})(this,function(Ee){"use strict";var ne=function(V){return V instanceof Uint8Array||V instanceof Uint16Array||V instanceof Uint32Array||V instanceof Int8Array||V instanceof Int16Array||V instanceof Int32Array||V instanceof Float32Array||V instanceof Float64Array||V instanceof Uint8ClampedArray},y=function(V,ke){for(var Ke=Object.keys(ke),ir=0;ir<Ke.length;++ir)V[Ke[ir]]=ke[Ke[ir]];return V},Te=`
`;function W(V){return typeof atob!="undefined"?atob(V):"base64:"+V}function ye(V){var ke=new Error("(regl) "+V);throw console.error(ke),ke}function se(V,ke){V||ye(ke)}function Ye(V){return V?": "+V:""}function _e(V,ke,Ke){V in ke||ye("unknown parameter ("+V+")"+Ye(Ke)+". possible values: "+Object.keys(ke).join())}function Qe(V,ke){ne(V)||ye("invalid parameter type"+Ye(ke)+". must be a typed array")}function lt(V,ke){switch(ke){case"number":return typeof V=="number";case"object":return typeof V=="object";case"string":return typeof V=="string";case"boolean":return typeof V=="boolean";case"function":return typeof V=="function";case"undefined":return typeof V=="undefined";case"symbol":return typeof V=="symbol"}}function bt(V,ke,Ke){lt(V,ke)||ye("invalid parameter type"+Ye(Ke)+". expected "+ke+", got "+typeof V)}function gt(V,ke){V>=0&&(V|0)===V||ye("invalid parameter type, ("+V+")"+Ye(ke)+". must be a nonnegative integer")}function ur(V,ke,Ke){ke.indexOf(V)<0&&ye("invalid value"+Ye(Ke)+". must be one of: "+ke)}var Mt=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function qt(V){Object.keys(V).forEach(function(ke){Mt.indexOf(ke)<0&&ye('invalid regl constructor argument "'+ke+'". must be one of '+Mt)})}function zt(V,ke){for(V=V+"";V.length<ke;)V=" "+V;return V}function yt(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function At(V,ke){this.number=V,this.line=ke,this.errors=[]}function ar(V,ke,Ke){this.file=V,this.line=ke,this.message=Ke}function J(){var V=new Error,ke=(V.stack||V).toString(),Ke=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(ke);if(Ke)return Ke[1];var ir=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(ke);return ir?ir[1]:"unknown"}function Qt(){var V=new Error,ke=(V.stack||V).toString(),Ke=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(ke);if(Ke)return Ke[1];var ir=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(ke);return ir?ir[1]:"unknown"}function Ct(V,ke){var Ke=V.split(`
`),ir=1,Ar=0,tr={unknown:new yt,0:new yt};tr.unknown.name=tr[0].name=ke||J(),tr.unknown.lines.push(new At(0,""));for(var xr=0;xr<Ke.length;++xr){var Pr=Ke[xr],zr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Pr);if(zr)switch(zr[1]){case"line":var Gr=/(\d+)(\s+\d+)?/.exec(zr[2]);Gr&&(ir=Gr[1]|0,Gr[2]&&(Ar=Gr[2]|0,Ar in tr||(tr[Ar]=new yt)));break;case"define":var Yr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(zr[2]);Yr&&(tr[Ar].name=Yr[1]?W(Yr[2]):Yr[2]);break}tr[Ar].lines.push(new At(ir++,Pr))}return Object.keys(tr).forEach(function(Kr){var hn=tr[Kr];hn.lines.forEach(function(Vr){hn.index[Vr.number]=Vr})}),tr}function ft(V){var ke=[];return V.split(`
`).forEach(function(Ke){if(!(Ke.length<5)){var ir=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(Ke);ir?ke.push(new ar(ir[1]|0,ir[2]|0,ir[3].trim())):Ke.length>0&&ke.push(new ar("unknown",0,Ke))}}),ke}function Ut(V,ke){ke.forEach(function(Ke){var ir=V[Ke.file];if(ir){var Ar=ir.index[Ke.line];if(Ar){Ar.errors.push(Ke),ir.hasErrors=!0;return}}V.unknown.hasErrors=!0,V.unknown.lines[0].errors.push(Ke)})}function dt(V,ke,Ke,ir,Ar){if(!V.getShaderParameter(ke,V.COMPILE_STATUS)){var tr=V.getShaderInfoLog(ke),xr=ir===V.FRAGMENT_SHADER?"fragment":"vertex";ce(Ke,"string",xr+" shader source must be a string",Ar);var Pr=Ct(Ke,Ar),zr=ft(tr);Ut(Pr,zr),Object.keys(Pr).forEach(function(Gr){var Yr=Pr[Gr];if(!Yr.hasErrors)return;var Kr=[""],hn=[""];function Vr(Xr,Pt){Kr.push(Xr),hn.push(Pt||"")}Vr("file number "+Gr+": "+Yr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Yr.lines.forEach(function(Xr){if(Xr.errors.length>0){Vr(zt(Xr.number,4)+"|  ","background-color:yellow; font-weight:bold"),Vr(Xr.line+Te,"color:red; background-color:yellow; font-weight:bold");var Pt=0;Xr.errors.forEach(function(pr){var jr=pr.message,ln=/^\s*'(.*)'\s*:\s*(.*)$/.exec(jr);if(ln){var Mr=ln[1];switch(jr=ln[2],Mr){case"assign":Mr="=";break}Pt=Math.max(Xr.line.indexOf(Mr,Pt),0)}else Pt=0;Vr(zt("| ",6)),Vr(zt("^^^",Pt+3)+Te,"font-weight:bold"),Vr(zt("| ",6)),Vr(jr+Te,"font-weight:bold")}),Vr(zt("| ",6)+Te)}else Vr(zt(Xr.number,4)+"|  "),Vr(Xr.line+Te,"color:red")}),typeof document!="undefined"&&!window.chrome?(hn[0]=Kr.join("%c"),console.log.apply(console,hn)):console.log(Kr.join(""))}),se.raise("Error compiling "+xr+" shader, "+Pr[0].name)}}function rr(V,ke,Ke,ir,Ar){if(!V.getProgramParameter(ke,V.LINK_STATUS)){var tr=V.getProgramInfoLog(ke),xr=Ct(Ke,Ar),Pr=Ct(ir,Ar),zr='Error linking program with vertex shader, "'+Pr[0].name+'", and fragment shader "'+xr[0].name+'"';typeof document!="undefined"?console.log("%c"+zr+Te+"%c"+tr,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(zr+Te+tr),se.raise(zr)}}function wr(V){V._commandRef=J()}function re(V,ke,Ke,ir){wr(V);function Ar(zr){return zr?ir.id(zr):0}V._fragId=Ar(V.static.frag),V._vertId=Ar(V.static.vert);function tr(zr,Gr){Object.keys(Gr).forEach(function(Yr){zr[ir.id(Yr)]=!0})}var xr=V._uniformSet={};tr(xr,ke.static),tr(xr,ke.dynamic);var Pr=V._attributeSet={};tr(Pr,Ke.static),tr(Pr,Ke.dynamic),V._hasCount="count"in V.static||"count"in V.dynamic||"elements"in V.static||"elements"in V.dynamic}function Fe(V,ke){var Ke=Qt();ye(V+" in command "+(ke||J())+(Ke==="unknown"?"":" called from "+Ke))}function N(V,ke,Ke){V||Fe(ke,Ke||J())}function z(V,ke,Ke,ir){V in ke||Fe("unknown parameter ("+V+")"+Ye(Ke)+". possible values: "+Object.keys(ke).join(),ir||J())}function ce(V,ke,Ke,ir){lt(V,ke)||Fe("invalid parameter type"+Ye(Ke)+". expected "+ke+", got "+typeof V,ir||J())}function ze(V){V()}function et(V,ke,Ke){V.texture?ur(V.texture._texture.internalformat,ke,"unsupported texture format for attachment"):ur(V.renderbuffer._renderbuffer.format,Ke,"unsupported renderbuffer format for attachment")}var ht=33071,Rt=9728,Jt=9984,Or=9985,Tr=9986,Pn=9987,Nr=5120,wn=5121,Xi=5122,mi=5123,si=5124,ki=5125,bi=5126,li=32819,Zn=32820,qn=33635,ro=34042,ka=36193,oa={};oa[Nr]=oa[wn]=1,oa[Xi]=oa[mi]=oa[ka]=oa[qn]=oa[li]=oa[Zn]=2,oa[si]=oa[ki]=oa[bi]=oa[ro]=4;function Tt(V,ke){return V===Zn||V===li||V===qn?2:V===ro?4:oa[V]*ke}function ge(V){return!(V&V-1)&&!!V}function ue(V,ke,Ke){var ir,Ar=ke.width,tr=ke.height,xr=ke.channels;se(Ar>0&&Ar<=Ke.maxTextureSize&&tr>0&&tr<=Ke.maxTextureSize,"invalid texture shape"),(V.wrapS!==ht||V.wrapT!==ht)&&se(ge(Ar)&&ge(tr),"incompatible wrap mode for texture, both width and height must be power of 2"),ke.mipmask===1?Ar!==1&&tr!==1&&se(V.minFilter!==Jt&&V.minFilter!==Tr&&V.minFilter!==Or&&V.minFilter!==Pn,"min filter requires mipmap"):(se(ge(Ar)&&ge(tr),"texture must be a square power of 2 to support mipmapping"),se(ke.mipmask===(Ar<<1)-1,"missing or incomplete mipmap data")),ke.type===bi&&(Ke.extensions.indexOf("oes_texture_float_linear")<0&&se(V.minFilter===Rt&&V.magFilter===Rt,"filter not supported, must enable oes_texture_float_linear"),se(!V.genMipmaps,"mipmap generation not supported with float textures"));var Pr=ke.images;for(ir=0;ir<16;++ir)if(Pr[ir]){var zr=Ar>>ir,Gr=tr>>ir;se(ke.mipmask&1<<ir,"missing mipmap data");var Yr=Pr[ir];if(se(Yr.width===zr&&Yr.height===Gr,"invalid shape for mip images"),se(Yr.format===ke.format&&Yr.internalformat===ke.internalformat&&Yr.type===ke.type,"incompatible type for mip image"),!Yr.compressed)if(Yr.data){var Kr=Math.ceil(Tt(Yr.type,xr)*zr/Yr.unpackAlignment)*Yr.unpackAlignment;se(Yr.data.byteLength===Kr*Gr,"invalid data for image, buffer size is inconsistent with image format")}else Yr.element||Yr.copy}else V.genMipmaps||se((ke.mipmask&1<<ir)==0,"extra mipmap data");ke.compressed&&se(!V.genMipmaps,"mipmap generation for compressed images not supported")}function we(V,ke,Ke,ir){var Ar=V.width,tr=V.height,xr=V.channels;se(Ar>0&&Ar<=ir.maxTextureSize&&tr>0&&tr<=ir.maxTextureSize,"invalid texture shape"),se(Ar===tr,"cube map must be square"),se(ke.wrapS===ht&&ke.wrapT===ht,"wrap mode not supported by cube map");for(var Pr=0;Pr<Ke.length;++Pr){var zr=Ke[Pr];se(zr.width===Ar&&zr.height===tr,"inconsistent cube map face shape"),ke.genMipmaps&&(se(!zr.compressed,"can not generate mipmap for compressed textures"),se(zr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var Gr=zr.images,Yr=0;Yr<16;++Yr){var Kr=Gr[Yr];if(Kr){var hn=Ar>>Yr,Vr=tr>>Yr;se(zr.mipmask&1<<Yr,"missing mipmap data"),se(Kr.width===hn&&Kr.height===Vr,"invalid shape for mip images"),se(Kr.format===V.format&&Kr.internalformat===V.internalformat&&Kr.type===V.type,"incompatible type for mip image"),Kr.compressed||(Kr.data?se(Kr.data.byteLength===hn*Vr*Math.max(Tt(Kr.type,xr),Kr.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):Kr.element||Kr.copy)}}}}var Z=y(se,{optional:ze,raise:ye,commandRaise:Fe,command:N,parameter:_e,commandParameter:z,constructor:qt,type:bt,commandType:ce,isTypedArray:Qe,nni:gt,oneOf:ur,shaderError:dt,linkError:rr,callSite:Qt,saveCommandRef:wr,saveDrawInfo:re,framebufferFormat:et,guessCommand:J,texture2D:ue,textureCube:we}),Je=0,Xt=0,Dr=5,tt=6;function It(V,ke){this.id=Je++,this.type=V,this.data=ke}function mr(V){return V.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function Ir(V){if(V.length===0)return[];var ke=V.charAt(0),Ke=V.charAt(V.length-1);if(V.length>1&&ke===Ke&&(ke==='"'||ke==="'"))return['"'+mr(V.substr(1,V.length-2))+'"'];var ir=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(V);if(ir)return Ir(V.substr(0,ir.index)).concat(Ir(ir[1])).concat(Ir(V.substr(ir.index+ir[0].length)));var Ar=V.split(".");if(Ar.length===1)return['"'+mr(V)+'"'];for(var tr=[],xr=0;xr<Ar.length;++xr)tr=tr.concat(Ir(Ar[xr]));return tr}function $r(V){return"["+Ir(V).join("][")+"]"}function tn(V,ke){return new It(V,$r(ke+""))}function $n(V){return typeof V=="function"&&!V._reglType||V instanceof It}function Vn(V,ke){if(typeof V=="function")return new It(Xt,V);if(typeof V=="number"||typeof V=="boolean")return new It(Dr,V);if(Array.isArray(V))return new It(tt,V.map(function(Ke,ir){return Vn(Ke,ke+"["+ir+"]")}));if(V instanceof It)return V;Z(!1,"invalid option type in uniform "+ke)}var rn={DynamicVariable:It,define:tn,isDynamic:$n,unbox:Vn,accessor:$r},vi={next:typeof requestAnimationFrame=="function"?function(V){return requestAnimationFrame(V)}:function(V){return setTimeout(V,16)},cancel:typeof cancelAnimationFrame=="function"?function(V){return cancelAnimationFrame(V)}:clearTimeout},ni=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,sa=ni?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function Sa(){var V={"":0},ke=[""];return{id:function(Ke){var ir=V[Ke];return ir||(ir=V[Ke]=ke.length,ke.push(Ke),ir)},str:function(Ke){return ke[Ke]}}}function Na(V,ke,Ke){var ir=document.createElement("canvas");y(ir.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),V.appendChild(ir),V===document.body&&(ir.style.position="absolute",y(V.style,{margin:0,padding:0}));function Ar(){var Pr=window.innerWidth,zr=window.innerHeight;if(V!==document.body){var Gr=ir.getBoundingClientRect();Pr=Gr.right-Gr.left,zr=Gr.bottom-Gr.top}ir.width=Ke*Pr,ir.height=Ke*zr}var tr;V!==document.body&&typeof ResizeObserver=="function"?(tr=new ResizeObserver(function(){setTimeout(Ar)}),tr.observe(V)):window.addEventListener("resize",Ar,!1);function xr(){tr?tr.disconnect():window.removeEventListener("resize",Ar),V.removeChild(ir)}return Ar(),{canvas:ir,onDestroy:xr}}function ga(V,ke){function Ke(ir){try{return V.getContext(ir,ke)}catch(Ar){return null}}return Ke("webgl")||Ke("experimental-webgl")||Ke("webgl-experimental")}function ta(V){return typeof V.nodeName=="string"&&typeof V.appendChild=="function"&&typeof V.getBoundingClientRect=="function"}function Q(V){return typeof V.drawArrays=="function"||typeof V.drawElements=="function"}function ae(V){return typeof V=="string"?V.split():(Z(Array.isArray(V),"invalid extension array"),V)}function me(V){return typeof V=="string"?(Z(typeof document!="undefined","not supported outside of DOM"),document.querySelector(V)):V}function Me(V){var ke=V||{},Ke,ir,Ar,tr,xr={},Pr=[],zr=[],Gr=typeof window=="undefined"?1:window.devicePixelRatio,Yr=!1,Kr=function(Xr){Xr&&Z.raise(Xr)},hn=function(){};if(typeof ke=="string"?(Z(typeof document!="undefined","selector queries only supported in DOM environments"),Ke=document.querySelector(ke),Z(Ke,"invalid query string for element")):typeof ke=="object"?ta(ke)?Ke=ke:Q(ke)?(tr=ke,Ar=tr.canvas):(Z.constructor(ke),"gl"in ke?tr=ke.gl:"canvas"in ke?Ar=me(ke.canvas):"container"in ke&&(ir=me(ke.container)),"attributes"in ke&&(xr=ke.attributes,Z.type(xr,"object","invalid context attributes")),"extensions"in ke&&(Pr=ae(ke.extensions)),"optionalExtensions"in ke&&(zr=ae(ke.optionalExtensions)),"onDone"in ke&&(Z.type(ke.onDone,"function","invalid or missing onDone callback"),Kr=ke.onDone),"profile"in ke&&(Yr=!!ke.profile),"pixelRatio"in ke&&(Gr=+ke.pixelRatio,Z(Gr>0,"invalid pixel ratio"))):Z.raise("invalid arguments to regl"),Ke&&(Ke.nodeName.toLowerCase()==="canvas"?Ar=Ke:ir=Ke),!tr){if(!Ar){Z(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var Vr=Na(ir||document.body,Kr,Gr);if(!Vr)return null;Ar=Vr.canvas,hn=Vr.onDestroy}xr.premultipliedAlpha===void 0&&(xr.premultipliedAlpha=!0),tr=ga(Ar,xr)}return tr?{gl:tr,canvas:Ar,container:ir,extensions:Pr,optionalExtensions:zr,pixelRatio:Gr,profile:Yr,onDone:Kr,onDestroy:hn}:(hn(),Kr("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Ve(V,ke){var Ke={};function ir(Pr){Z.type(Pr,"string","extension name must be string");var zr=Pr.toLowerCase(),Gr;try{Gr=Ke[zr]=Ar(Pr)}catch(Yr){}return!!Gr}function Ar(Pr){return V.getExtension(Pr)?V.getExtension(Pr):V.getExtension(Pr.toLowerCase())?V.getExtension(Pr.toLowerCase()):null}for(var tr=0;tr<ke.extensions.length;++tr){var xr=ke.extensions[tr];if(!ir(xr))return ke.onDestroy(),ke.onDone('"'+xr+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return ke.optionalExtensions.forEach(ir),{extensions:Ke,restore:function(){Object.keys(Ke).forEach(function(Pr){if(Ke[Pr]&&!ir(Pr))throw new Error("(regl): error restoring extension "+Pr)})}}}function at(V,ke){for(var Ke=Array(V),ir=0;ir<V;++ir)Ke[ir]=ke(ir);return Ke}var _t=5120,Ce=5121,$e=5122,Zt=5123,Rr=5124,nr=5125,lr=5126;function Lr(V){for(var ke=16;ke<=1<<28;ke*=16)if(V<=ke)return ke;return 0}function Dn(V){var ke,Ke;return ke=(V>65535)<<4,V>>>=ke,Ke=(V>255)<<3,V>>>=Ke,ke|=Ke,Ke=(V>15)<<2,V>>>=Ke,ke|=Ke,Ke=(V>3)<<1,V>>>=Ke,ke|=Ke,ke|V>>1}function Mn(){var V=at(8,function(){return[]});function ke(tr){var xr=Lr(tr),Pr=V[Dn(xr)>>2];return Pr.length>0?Pr.pop():new ArrayBuffer(xr)}function Ke(tr){V[Dn(tr.byteLength)>>2].push(tr)}function ir(tr,xr){var Pr=null;switch(tr){case _t:Pr=new Int8Array(ke(xr),0,xr);break;case Ce:Pr=new Uint8Array(ke(xr),0,xr);break;case $e:Pr=new Int16Array(ke(2*xr),0,xr);break;case Zt:Pr=new Uint16Array(ke(2*xr),0,xr);break;case Rr:Pr=new Int32Array(ke(4*xr),0,xr);break;case nr:Pr=new Uint32Array(ke(4*xr),0,xr);break;case lr:Pr=new Float32Array(ke(4*xr),0,xr);break;default:return null}return Pr.length!==xr?Pr.subarray(0,xr):Pr}function Ar(tr){Ke(tr.buffer)}return{alloc:ke,free:Ke,allocType:ir,freeType:Ar}}var $t=Mn();$t.zero=Mn();var Cn=3408,hr=3410,St=3411,Ei=3412,mn=3413,Oi=3414,ua=3415,xt=33901,wt=33902,Ri=3379,pi=3386,Ji=34921,ea=36347,la=36348,Di=35661,gr=35660,Cr=34930,rt=36349,Aa=34076,De=34024,ws=7936,os=7937,ia=7938,Vs=35724,no=34047,Wa=36063,io=34852,ca=3553,Ho=34067,Jo=34069,wu=33984,To=6408,Mo=5126,ha=5121,ao=36160,Wo=36053,Ya=36064,qs=16384,Il=function(V,ke){var Ke=1;ke.ext_texture_filter_anisotropic&&(Ke=V.getParameter(no));var ir=1,Ar=1;ke.webgl_draw_buffers&&(ir=V.getParameter(io),Ar=V.getParameter(Wa));var tr=!!ke.oes_texture_float;if(tr){var xr=V.createTexture();V.bindTexture(ca,xr),V.texImage2D(ca,0,To,1,1,0,To,Mo,null);var Pr=V.createFramebuffer();if(V.bindFramebuffer(ao,Pr),V.framebufferTexture2D(ao,Ya,ca,xr,0),V.bindTexture(ca,null),V.checkFramebufferStatus(ao)!==Wo)tr=!1;else{V.viewport(0,0,1,1),V.clearColor(1,0,0,1),V.clear(qs);var zr=$t.allocType(Mo,4);V.readPixels(0,0,1,1,To,Mo,zr),V.getError()?tr=!1:(V.deleteFramebuffer(Pr),V.deleteTexture(xr),tr=zr[0]===1),$t.freeType(zr)}}var Gr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Yr=!0;if(!Gr){var Kr=V.createTexture(),hn=$t.allocType(ha,36);V.activeTexture(wu),V.bindTexture(Ho,Kr),V.texImage2D(Jo,0,To,3,3,0,To,ha,hn),$t.freeType(hn),V.bindTexture(Ho,null),V.deleteTexture(Kr),Yr=!V.getError()}return{colorBits:[V.getParameter(hr),V.getParameter(St),V.getParameter(Ei),V.getParameter(mn)],depthBits:V.getParameter(Oi),stencilBits:V.getParameter(ua),subpixelBits:V.getParameter(Cn),extensions:Object.keys(ke).filter(function(Vr){return!!ke[Vr]}),maxAnisotropic:Ke,maxDrawbuffers:ir,maxColorAttachments:Ar,pointSizeDims:V.getParameter(xt),lineWidthDims:V.getParameter(wt),maxViewportDims:V.getParameter(pi),maxCombinedTextureUnits:V.getParameter(Di),maxCubeMapSize:V.getParameter(Aa),maxRenderbufferSize:V.getParameter(De),maxTextureUnits:V.getParameter(Cr),maxTextureSize:V.getParameter(Ri),maxAttributes:V.getParameter(Ji),maxVertexUniforms:V.getParameter(ea),maxVertexTextureUnits:V.getParameter(gr),maxVaryingVectors:V.getParameter(la),maxFragmentUniforms:V.getParameter(rt),glsl:V.getParameter(Vs),renderer:V.getParameter(os),vendor:V.getParameter(ws),version:V.getParameter(ia),readFloat:tr,npotTextureCube:Yr}};function es(V){return!!V&&typeof V=="object"&&Array.isArray(V.shape)&&Array.isArray(V.stride)&&typeof V.offset=="number"&&V.shape.length===V.stride.length&&(Array.isArray(V.data)||ne(V.data))}var ve=function(V){return Object.keys(V).map(function(ke){return V[ke]})},Oe={shape:fo,flatten:Fi};function mt(V,ke,Ke){for(var ir=0;ir<ke;++ir)Ke[ir]=V[ir]}function er(V,ke,Ke,ir){for(var Ar=0,tr=0;tr<ke;++tr)for(var xr=V[tr],Pr=0;Pr<Ke;++Pr)ir[Ar++]=xr[Pr]}function en(V,ke,Ke,ir,Ar,tr){for(var xr=tr,Pr=0;Pr<ke;++Pr)for(var zr=V[Pr],Gr=0;Gr<Ke;++Gr)for(var Yr=zr[Gr],Kr=0;Kr<ir;++Kr)Ar[xr++]=Yr[Kr]}function Hn(V,ke,Ke,ir,Ar){for(var tr=1,xr=Ke+1;xr<ke.length;++xr)tr*=ke[xr];var Pr=ke[Ke];if(ke.length-Ke==4){var zr=ke[Ke+1],Gr=ke[Ke+2],Yr=ke[Ke+3];for(xr=0;xr<Pr;++xr)en(V[xr],zr,Gr,Yr,ir,Ar),Ar+=tr}else for(xr=0;xr<Pr;++xr)Hn(V[xr],ke,Ke+1,ir,Ar),Ar+=tr}function Fi(V,ke,Ke,ir){var Ar=1;if(ke.length)for(var tr=0;tr<ke.length;++tr)Ar*=ke[tr];else Ar=0;var xr=ir||$t.allocType(Ke,Ar);switch(ke.length){case 0:break;case 1:mt(V,ke[0],xr);break;case 2:er(V,ke[0],ke[1],xr);break;case 3:en(V,ke[0],ke[1],ke[2],xr,0);break;default:Hn(V,ke,0,xr,0)}return xr}function fo(V){for(var ke=[],Ke=V;Ke.length;Ke=Ke[0])ke.push(Ke.length);return ke}var za={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},qa=5120,ts=5122,Do=5124,mo=5121,Cs=5123,As=5125,Ts=5126,Ks=5126,cu={int8:qa,int16:ts,int32:Do,uint8:mo,uint16:Cs,uint32:As,float:Ts,float32:Ks},ps=35048,Zi=35040,Ia={dynamic:ps,stream:Zi,static:35044},Oc=Oe.flatten,ff=Oe.shape,Ms=35044,hf=35040,al=5121,$u=5126,Qs=[];Qs[5120]=1,Qs[5122]=2,Qs[5124]=4,Qs[5121]=1,Qs[5123]=2,Qs[5125]=4,Qs[5126]=4;function Pl(V){return za[Object.prototype.toString.call(V)]|0}function b(V,ke){for(var Ke=0;Ke<ke.length;++Ke)V[Ke]=ke[Ke]}function k(V,ke,Ke,ir,Ar,tr,xr){for(var Pr=0,zr=0;zr<Ke;++zr)for(var Gr=0;Gr<ir;++Gr)V[Pr++]=ke[Ar*zr+tr*Gr+xr]}function U(V,ke,Ke,ir){var Ar=0,tr={};function xr(Pt){this.id=Ar++,this.buffer=V.createBuffer(),this.type=Pt,this.usage=Ms,this.byteLength=0,this.dimension=1,this.dtype=al,this.persistentData=null,Ke.profile&&(this.stats={size:0})}xr.prototype.bind=function(){V.bindBuffer(this.type,this.buffer)},xr.prototype.destroy=function(){hn(this)};var Pr=[];function zr(Pt,pr){var jr=Pr.pop();return jr||(jr=new xr(Pt)),jr.bind(),Kr(jr,pr,hf,0,1,!1),jr}function Gr(Pt){Pr.push(Pt)}function Yr(Pt,pr,jr){Pt.byteLength=pr.byteLength,V.bufferData(Pt.type,pr,jr)}function Kr(Pt,pr,jr,ln,Mr,Jr){var gn;if(Pt.usage=jr,Array.isArray(pr)){if(Pt.dtype=ln||$u,pr.length>0){var ei;if(Array.isArray(pr[0])){gn=ff(pr);for(var _r=1,Sr=1;Sr<gn.length;++Sr)_r*=gn[Sr];Pt.dimension=_r,ei=Oc(pr,gn,Pt.dtype),Yr(Pt,ei,jr),Jr?Pt.persistentData=ei:$t.freeType(ei)}else if(typeof pr[0]=="number"){Pt.dimension=Mr;var Nn=$t.allocType(Pt.dtype,pr.length);b(Nn,pr),Yr(Pt,Nn,jr),Jr?Pt.persistentData=Nn:$t.freeType(Nn)}else ne(pr[0])?(Pt.dimension=pr[0].length,Pt.dtype=ln||Pl(pr[0])||$u,ei=Oc(pr,[pr.length,pr[0].length],Pt.dtype),Yr(Pt,ei,jr),Jr?Pt.persistentData=ei:$t.freeType(ei)):Z.raise("invalid buffer data")}}else if(ne(pr))Pt.dtype=ln||Pl(pr),Pt.dimension=Mr,Yr(Pt,pr,jr),Jr&&(Pt.persistentData=new Uint8Array(new Uint8Array(pr.buffer)));else if(es(pr)){gn=pr.shape;var pn=pr.stride,Wr=pr.offset,cn=0,yn=0,Ii=0,Si=0;gn.length===1?(cn=gn[0],yn=1,Ii=pn[0],Si=0):gn.length===2?(cn=gn[0],yn=gn[1],Ii=pn[0],Si=pn[1]):Z.raise("invalid shape"),Pt.dtype=ln||Pl(pr.data)||$u,Pt.dimension=yn;var fn=$t.allocType(Pt.dtype,cn*yn);k(fn,pr.data,cn,yn,Ii,Si,Wr),Yr(Pt,fn,jr),Jr?Pt.persistentData=fn:$t.freeType(fn)}else pr instanceof ArrayBuffer?(Pt.dtype=al,Pt.dimension=Mr,Yr(Pt,pr,jr),Jr&&(Pt.persistentData=new Uint8Array(new Uint8Array(pr)))):Z.raise("invalid buffer data")}function hn(Pt){ke.bufferCount--,ir(Pt);var pr=Pt.buffer;Z(pr,"buffer must not be deleted already"),V.deleteBuffer(pr),Pt.buffer=null,delete tr[Pt.id]}function Vr(Pt,pr,jr,ln){ke.bufferCount++;var Mr=new xr(pr);tr[Mr.id]=Mr;function Jr(_r){var Sr=Ms,Nn=null,pn=0,Wr=0,cn=1;return Array.isArray(_r)||ne(_r)||es(_r)||_r instanceof ArrayBuffer?Nn=_r:typeof _r=="number"?pn=_r|0:_r&&(Z.type(_r,"object","buffer arguments must be an object, a number or an array"),"data"in _r&&(Z(Nn===null||Array.isArray(Nn)||ne(Nn)||es(Nn),"invalid data for buffer"),Nn=_r.data),"usage"in _r&&(Z.parameter(_r.usage,Ia,"invalid buffer usage"),Sr=Ia[_r.usage]),"type"in _r&&(Z.parameter(_r.type,cu,"invalid buffer type"),Wr=cu[_r.type]),"dimension"in _r&&(Z.type(_r.dimension,"number","invalid dimension"),cn=_r.dimension|0),"length"in _r&&(Z.nni(pn,"buffer length must be a nonnegative integer"),pn=_r.length|0)),Mr.bind(),Nn?Kr(Mr,Nn,Sr,Wr,cn,ln):(pn&&V.bufferData(Mr.type,pn,Sr),Mr.dtype=Wr||al,Mr.usage=Sr,Mr.dimension=cn,Mr.byteLength=pn),Ke.profile&&(Mr.stats.size=Mr.byteLength*Qs[Mr.dtype]),Jr}function gn(_r,Sr){Z(Sr+_r.byteLength<=Mr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+_r.byteLength+" starting from offset "+Sr+" to a buffer of size "+Mr.byteLength),V.bufferSubData(Mr.type,Sr,_r)}function ei(_r,Sr){var Nn=(Sr||0)|0,pn;if(Mr.bind(),ne(_r)||_r instanceof ArrayBuffer)gn(_r,Nn);else if(Array.isArray(_r)){if(_r.length>0)if(typeof _r[0]=="number"){var Wr=$t.allocType(Mr.dtype,_r.length);b(Wr,_r),gn(Wr,Nn),$t.freeType(Wr)}else if(Array.isArray(_r[0])||ne(_r[0])){pn=ff(_r);var cn=Oc(_r,pn,Mr.dtype);gn(cn,Nn),$t.freeType(cn)}else Z.raise("invalid buffer data")}else if(es(_r)){pn=_r.shape;var yn=_r.stride,Ii=0,Si=0,fn=0,xn=0;pn.length===1?(Ii=pn[0],Si=1,fn=yn[0],xn=0):pn.length===2?(Ii=pn[0],Si=pn[1],fn=yn[0],xn=yn[1]):Z.raise("invalid shape");var fi=Array.isArray(_r.data)?Mr.dtype:Pl(_r.data),Ci=$t.allocType(fi,Ii*Si);k(Ci,_r.data,Ii,Si,fn,xn,_r.offset),gn(Ci,Nn),$t.freeType(Ci)}else Z.raise("invalid data for buffer subdata");return Jr}return jr||Jr(Pt),Jr._reglType="buffer",Jr._buffer=Mr,Jr.subdata=ei,Ke.profile&&(Jr.stats=Mr.stats),Jr.destroy=function(){hn(Mr)},Jr}function Xr(){ve(tr).forEach(function(Pt){Pt.buffer=V.createBuffer(),V.bindBuffer(Pt.type,Pt.buffer),V.bufferData(Pt.type,Pt.persistentData||Pt.byteLength,Pt.usage)})}return Ke.profile&&(ke.getTotalBufferSize=function(){var Pt=0;return Object.keys(tr).forEach(function(pr){Pt+=tr[pr].stats.size}),Pt}),{create:Vr,createStream:zr,destroyStream:Gr,clear:function(){ve(tr).forEach(hn),Pr.forEach(hn)},getBuffer:function(Pt){return Pt&&Pt._buffer instanceof xr?Pt._buffer:null},restore:Xr,_initBuffer:Kr}}var R=0,ie=0,Pe=1,ct=1,Ft=4,Bt=4,Er={points:R,point:ie,lines:Pe,line:ct,triangles:Ft,triangle:Bt,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Zr=0,Wn=1,ti=4,gi=5120,$i=5121,wa=5122,Oa=5123,Yi=5124,ds=5125,fu=34963,ol=35040,pf=35044;function sl(V,ke,Ke,ir){var Ar={},tr=0,xr={uint8:$i,uint16:Oa};ke.oes_element_index_uint&&(xr.uint32=ds);function Pr(Xr){this.id=tr++,Ar[this.id]=this,this.buffer=Xr,this.primType=ti,this.vertCount=0,this.type=0}Pr.prototype.bind=function(){this.buffer.bind()};var zr=[];function Gr(Xr){var Pt=zr.pop();return Pt||(Pt=new Pr(Ke.create(null,fu,!0,!1)._buffer)),Kr(Pt,Xr,ol,-1,-1,0,0),Pt}function Yr(Xr){zr.push(Xr)}function Kr(Xr,Pt,pr,jr,ln,Mr,Jr){Xr.buffer.bind();var gn;if(Pt){var ei=Jr;!Jr&&(!ne(Pt)||es(Pt)&&!ne(Pt.data))&&(ei=ke.oes_element_index_uint?ds:Oa),Ke._initBuffer(Xr.buffer,Pt,pr,ei,3)}else V.bufferData(fu,Mr,pr),Xr.buffer.dtype=gn||$i,Xr.buffer.usage=pr,Xr.buffer.dimension=3,Xr.buffer.byteLength=Mr;if(gn=Jr,!Jr){switch(Xr.buffer.dtype){case $i:case gi:gn=$i;break;case Oa:case wa:gn=Oa;break;case ds:case Yi:gn=ds;break;default:Z.raise("unsupported type for element array")}Xr.buffer.dtype=gn}Xr.type=gn,Z(gn!==ds||!!ke.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var _r=ln;_r<0&&(_r=Xr.buffer.byteLength,gn===Oa?_r>>=1:gn===ds&&(_r>>=2)),Xr.vertCount=_r;var Sr=jr;if(jr<0){Sr=ti;var Nn=Xr.buffer.dimension;Nn===1&&(Sr=Zr),Nn===2&&(Sr=Wn),Nn===3&&(Sr=ti)}Xr.primType=Sr}function hn(Xr){ir.elementsCount--,Z(Xr.buffer!==null,"must not double destroy elements"),delete Ar[Xr.id],Xr.buffer.destroy(),Xr.buffer=null}function Vr(Xr,Pt){var pr=Ke.create(null,fu,!0),jr=new Pr(pr._buffer);ir.elementsCount++;function ln(Mr){if(!Mr)pr(),jr.primType=ti,jr.vertCount=0,jr.type=$i;else if(typeof Mr=="number")pr(Mr),jr.primType=ti,jr.vertCount=Mr|0,jr.type=$i;else{var Jr=null,gn=pf,ei=-1,_r=-1,Sr=0,Nn=0;Array.isArray(Mr)||ne(Mr)||es(Mr)?Jr=Mr:(Z.type(Mr,"object","invalid arguments for elements"),"data"in Mr&&(Jr=Mr.data,Z(Array.isArray(Jr)||ne(Jr)||es(Jr),"invalid data for element buffer")),"usage"in Mr&&(Z.parameter(Mr.usage,Ia,"invalid element buffer usage"),gn=Ia[Mr.usage]),"primitive"in Mr&&(Z.parameter(Mr.primitive,Er,"invalid element buffer primitive"),ei=Er[Mr.primitive]),"count"in Mr&&(Z(typeof Mr.count=="number"&&Mr.count>=0,"invalid vertex count for elements"),_r=Mr.count|0),"type"in Mr&&(Z.parameter(Mr.type,xr,"invalid buffer type"),Nn=xr[Mr.type]),"length"in Mr?Sr=Mr.length|0:(Sr=_r,Nn===Oa||Nn===wa?Sr*=2:(Nn===ds||Nn===Yi)&&(Sr*=4))),Kr(jr,Jr,gn,ei,_r,Sr,Nn)}return ln}return ln(Xr),ln._reglType="elements",ln._elements=jr,ln.subdata=function(Mr,Jr){return pr.subdata(Mr,Jr),ln},ln.destroy=function(){hn(jr)},ln}return{create:Vr,createStream:Gr,destroyStream:Yr,getElements:function(Xr){return typeof Xr=="function"&&Xr._elements instanceof Pr?Xr._elements:null},clear:function(){ve(Ar).forEach(hn)}}}var Lc=new Float32Array(1),Bu=new Uint32Array(Lc.buffer),Nu=5123;function zu(V){for(var ke=$t.allocType(Nu,V.length),Ke=0;Ke<V.length;++Ke)if(isNaN(V[Ke]))ke[Ke]=65535;else if(V[Ke]===Infinity)ke[Ke]=31744;else if(V[Ke]===-Infinity)ke[Ke]=64512;else{Lc[0]=V[Ke];var ir=Bu[0],Ar=ir>>>31<<15,tr=(ir<<1>>>24)-127,xr=ir>>13&(1<<10)-1;if(tr<-24)ke[Ke]=Ar;else if(tr<-14){var Pr=-14-tr;ke[Ke]=Ar+(xr+(1<<10)>>Pr)}else tr>15?ke[Ke]=Ar+31744:ke[Ke]=Ar+(tr+15<<10)+xr}return ke}function go(V){return Array.isArray(V)||ne(V)}var Uf=function(V){return!(V&V-1)&&!!V},Dc=34467,vs=3553,df=34067,Yu=34069,Js=6408,Vf=6406,js=6407,Ta=6409,Rl=6410,Mh=32854,Zu=32855,Fc=36194,op=32819,sp=32820,jf=33635,Bc=34042,ac=6402,Ol=34041,Ll=35904,ul=35906,ll=36193,cl=33776,eu=33777,vf=33778,mf=33779,Dl=35986,fl=35987,oc=34798,Nc=35840,sc=35841,gf=35842,up=35843,yf=36196,hl=5121,_f=5123,Gf=5125,Uu=5126,kh=10242,Ih=10243,Ph=10497,Fl=33071,Rh=33648,rs=10240,Ka=10241,pa=9728,Bl=9729,qu=9984,Gi=9985,La=9986,Rs=9987,zc=33170,Bi=4352,ks=4353,Cu=4354,Nl=34046,Zc=3317,uc=37440,Au=37441,Xo=37443,lc=37444,zl=33984,ko=[qu,La,Gi,Rs],Fn=[0,Ta,Rl,js,Js],ho={};ho[Ta]=ho[Vf]=ho[ac]=1,ho[Ol]=ho[Rl]=2,ho[js]=ho[Ll]=3,ho[Js]=ho[ul]=4;function Da(V){return"[object "+V+"]"}var pl=Da("HTMLCanvasElement"),tu=Da("OffscreenCanvas"),Gs=Da("CanvasRenderingContext2D"),xf=Da("ImageBitmap"),vn=Da("HTMLImageElement"),cc=Da("HTMLVideoElement"),Zl=Object.keys(za).concat([pl,tu,Gs,xf,vn,cc]),Ku=[];Ku[hl]=1,Ku[Uu]=4,Ku[ll]=2,Ku[_f]=2,Ku[Gf]=4;var Va=[];Va[Mh]=2,Va[Zu]=2,Va[Fc]=2,Va[Ol]=4,Va[cl]=.5,Va[eu]=.5,Va[vf]=1,Va[mf]=1,Va[Dl]=.5,Va[fl]=1,Va[oc]=1,Va[Nc]=.5,Va[sc]=.25,Va[gf]=.5,Va[up]=.25,Va[yf]=.5;function Os(V){return Array.isArray(V)&&(V.length===0||typeof V[0]=="number")}function fc(V){if(!Array.isArray(V))return!1;var ke=V.length;return!(ke===0||!go(V[0]))}function Vu(V){return Object.prototype.toString.call(V)}function Ls(V){return Vu(V)===pl}function hu(V){return Vu(V)===tu}function bf(V){return Vu(V)===Gs}function Uc(V){return Vu(V)===xf}function Ef(V){return Vu(V)===vn}function Hf(V){return Vu(V)===cc}function ru(V){var ke=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(ke&&V&&V.getContext)}function ms(V){var ke=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(ke&&V&&"src"in V&&"crossOrigin"in V)}function Li(V){if(!V)return!1;if(ru(V)||ms(V))return!0;var ke=Vu(V);return Zl.indexOf(ke)>=0?!0:Os(V)||fc(V)||es(V)}function Tu(V){return za[Object.prototype.toString.call(V)]|0}function pu(V,ke){var Ke=ke.length;switch(V.type){case hl:case _f:case Gf:case Uu:var ir=$t.allocType(V.type,Ke);ir.set(ke),V.data=ir;break;case ll:V.data=zu(ke);break;default:Z.raise("unsupported texture type, must specify a typed array")}}function ns(V,ke){return $t.allocType(V.type===ll?Uu:V.type,ke)}function Qu(V,ke){V.type===ll?(V.data=zu(ke),$t.freeType(ke)):V.data=ke}function dl(V,ke,Ke,ir,Ar,tr){for(var xr=V.width,Pr=V.height,zr=V.channels,Gr=xr*Pr*zr,Yr=ns(V,Gr),Kr=0,hn=0;hn<Pr;++hn)for(var Vr=0;Vr<xr;++Vr)for(var Xr=0;Xr<zr;++Xr)Yr[Kr++]=ke[Ke*Vr+ir*hn+Ar*Xr+tr];Qu(V,Yr)}function Is(V,ke,Ke,ir,Ar,tr){var xr;if(typeof Va[V]!="undefined"?xr=Va[V]:xr=ho[V]*Ku[ke],tr&&(xr*=6),Ar){for(var Pr=0,zr=Ke;zr>=1;)Pr+=xr*zr*zr,zr/=2;return Pr}else return xr*Ke*ir}function Ds(V,ke,Ke,ir,Ar,tr,xr){var Pr={"don't care":Bi,"dont care":Bi,nice:Cu,fast:ks},zr={repeat:Ph,clamp:Fl,mirror:Rh},Gr={nearest:pa,linear:Bl},Yr=y({mipmap:Rs,"nearest mipmap nearest":qu,"linear mipmap nearest":Gi,"nearest mipmap linear":La,"linear mipmap linear":Rs},Gr),Kr={none:0,browser:lc},hn={uint8:hl,rgba4:op,rgb565:jf,"rgb5 a1":sp},Vr={alpha:Vf,luminance:Ta,"luminance alpha":Rl,rgb:js,rgba:Js,rgba4:Mh,"rgb5 a1":Zu,rgb565:Fc},Xr={};ke.ext_srgb&&(Vr.srgb=Ll,Vr.srgba=ul),ke.oes_texture_float&&(hn.float32=hn.float=Uu),ke.oes_texture_half_float&&(hn.float16=hn["half float"]=ll),ke.webgl_depth_texture&&(y(Vr,{depth:ac,"depth stencil":Ol}),y(hn,{uint16:_f,uint32:Gf,"depth stencil":Bc})),ke.webgl_compressed_texture_s3tc&&y(Xr,{"rgb s3tc dxt1":cl,"rgba s3tc dxt1":eu,"rgba s3tc dxt3":vf,"rgba s3tc dxt5":mf}),ke.webgl_compressed_texture_atc&&y(Xr,{"rgb atc":Dl,"rgba atc explicit alpha":fl,"rgba atc interpolated alpha":oc}),ke.webgl_compressed_texture_pvrtc&&y(Xr,{"rgb pvrtc 4bppv1":Nc,"rgb pvrtc 2bppv1":sc,"rgba pvrtc 4bppv1":gf,"rgba pvrtc 2bppv1":up}),ke.webgl_compressed_texture_etc1&&(Xr["rgb etc1"]=yf);var Pt=Array.prototype.slice.call(V.getParameter(Dc)||new Uint32Array(0));Object.keys(Xr).forEach(function(Ue){var cr=Xr[Ue];Pt.indexOf(cr)>=0&&(Vr[Ue]=cr)});var pr=Object.keys(Vr);Ke.textureFormats=pr;var jr=[];Object.keys(Vr).forEach(function(Ue){var cr=Vr[Ue];jr[cr]=Ue});var ln=[];Object.keys(hn).forEach(function(Ue){var cr=hn[Ue];ln[cr]=Ue});var Mr=[];Object.keys(Gr).forEach(function(Ue){var cr=Gr[Ue];Mr[cr]=Ue});var Jr=[];Object.keys(Yr).forEach(function(Ue){var cr=Yr[Ue];Jr[cr]=Ue});var gn=[];Object.keys(zr).forEach(function(Ue){var cr=zr[Ue];gn[cr]=Ue});var ei=pr.reduce(function(Ue,cr){var Ht=Vr[cr];return Ht===Ta||Ht===Vf||Ht===Ta||Ht===Rl||Ht===ac||Ht===Ol||ke.ext_srgb&&(Ht===Ll||Ht===ul)?Ue[Ht]=Ht:Ht===Zu||cr.indexOf("rgba")>=0?Ue[Ht]=Js:Ue[Ht]=js,Ue},{});function _r(){this.internalformat=Js,this.format=Js,this.type=hl,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=lc,this.width=0,this.height=0,this.channels=0}function Sr(Ue,cr){Ue.internalformat=cr.internalformat,Ue.format=cr.format,Ue.type=cr.type,Ue.compressed=cr.compressed,Ue.premultiplyAlpha=cr.premultiplyAlpha,Ue.flipY=cr.flipY,Ue.unpackAlignment=cr.unpackAlignment,Ue.colorSpace=cr.colorSpace,Ue.width=cr.width,Ue.height=cr.height,Ue.channels=cr.channels}function Nn(Ue,cr){if(!(typeof cr!="object"||!cr)){if("premultiplyAlpha"in cr&&(Z.type(cr.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Ue.premultiplyAlpha=cr.premultiplyAlpha),"flipY"in cr&&(Z.type(cr.flipY,"boolean","invalid texture flip"),Ue.flipY=cr.flipY),"alignment"in cr&&(Z.oneOf(cr.alignment,[1,2,4,8],"invalid texture unpack alignment"),Ue.unpackAlignment=cr.alignment),"colorSpace"in cr&&(Z.parameter(cr.colorSpace,Kr,"invalid colorSpace"),Ue.colorSpace=Kr[cr.colorSpace]),"type"in cr){var Ht=cr.type;Z(ke.oes_texture_float||!(Ht==="float"||Ht==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),Z(ke.oes_texture_half_float||!(Ht==="half float"||Ht==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),Z(ke.webgl_depth_texture||!(Ht==="uint16"||Ht==="uint32"||Ht==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),Z.parameter(Ht,hn,"invalid texture type"),Ue.type=hn[Ht]}var Rn=Ue.width,Hi=Ue.height,Le=Ue.channels,be=!1;"shape"in cr?(Z(Array.isArray(cr.shape)&&cr.shape.length>=2,"shape must be an array"),Rn=cr.shape[0],Hi=cr.shape[1],cr.shape.length===3&&(Le=cr.shape[2],Z(Le>0&&Le<=4,"invalid number of channels"),be=!0),Z(Rn>=0&&Rn<=Ke.maxTextureSize,"invalid width"),Z(Hi>=0&&Hi<=Ke.maxTextureSize,"invalid height")):("radius"in cr&&(Rn=Hi=cr.radius,Z(Rn>=0&&Rn<=Ke.maxTextureSize,"invalid radius")),"width"in cr&&(Rn=cr.width,Z(Rn>=0&&Rn<=Ke.maxTextureSize,"invalid width")),"height"in cr&&(Hi=cr.height,Z(Hi>=0&&Hi<=Ke.maxTextureSize,"invalid height")),"channels"in cr&&(Le=cr.channels,Z(Le>0&&Le<=4,"invalid number of channels"),be=!0)),Ue.width=Rn|0,Ue.height=Hi|0,Ue.channels=Le|0;var st=!1;if("format"in cr){var Lt=cr.format;Z(ke.webgl_depth_texture||!(Lt==="depth"||Lt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),Z.parameter(Lt,Vr,"invalid texture format");var Kt=Ue.internalformat=Vr[Lt];Ue.format=ei[Kt],Lt in hn&&("type"in cr||(Ue.type=hn[Lt])),Lt in Xr&&(Ue.compressed=!0),st=!0}!be&&st?Ue.channels=ho[Ue.format]:be&&!st?Ue.channels!==Fn[Ue.format]&&(Ue.format=Ue.internalformat=Fn[Ue.channels]):st&&be&&Z(Ue.channels===ho[Ue.format],"number of channels inconsistent with specified format")}}function pn(Ue){V.pixelStorei(uc,Ue.flipY),V.pixelStorei(Au,Ue.premultiplyAlpha),V.pixelStorei(Xo,Ue.colorSpace),V.pixelStorei(Zc,Ue.unpackAlignment)}function Wr(){_r.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function cn(Ue,cr){var Ht=null;if(Li(cr)?Ht=cr:cr&&(Z.type(cr,"object","invalid pixel data type"),Nn(Ue,cr),"x"in cr&&(Ue.xOffset=cr.x|0),"y"in cr&&(Ue.yOffset=cr.y|0),Li(cr.data)&&(Ht=cr.data)),Z(!Ue.compressed||Ht instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),cr.copy){Z(!Ht,"can not specify copy and data field for the same texture");var Rn=Ar.viewportWidth,Hi=Ar.viewportHeight;Ue.width=Ue.width||Rn-Ue.xOffset,Ue.height=Ue.height||Hi-Ue.yOffset,Ue.needsCopy=!0,Z(Ue.xOffset>=0&&Ue.xOffset<Rn&&Ue.yOffset>=0&&Ue.yOffset<Hi&&Ue.width>0&&Ue.width<=Rn&&Ue.height>0&&Ue.height<=Hi,"copy texture read out of bounds")}else if(!Ht)Ue.width=Ue.width||1,Ue.height=Ue.height||1,Ue.channels=Ue.channels||4;else if(ne(Ht))Ue.channels=Ue.channels||4,Ue.data=Ht,!("type"in cr)&&Ue.type===hl&&(Ue.type=Tu(Ht));else if(Os(Ht))Ue.channels=Ue.channels||4,pu(Ue,Ht),Ue.alignment=1,Ue.needsFree=!0;else if(es(Ht)){var Le=Ht.data;!Array.isArray(Le)&&Ue.type===hl&&(Ue.type=Tu(Le));var be=Ht.shape,st=Ht.stride,Lt,Kt,vt,qe,Et,Ie;be.length===3?(vt=be[2],Ie=st[2]):(Z(be.length===2,"invalid ndarray pixel data, must be 2 or 3D"),vt=1,Ie=1),Lt=be[0],Kt=be[1],qe=st[0],Et=st[1],Ue.alignment=1,Ue.width=Lt,Ue.height=Kt,Ue.channels=vt,Ue.format=Ue.internalformat=Fn[vt],Ue.needsFree=!0,dl(Ue,Le,qe,Et,Ie,Ht.offset)}else if(ru(Ht)||Ls(Ht)||hu(Ht)||bf(Ht))ru(Ht)||Ls(Ht)||hu(Ht)?Ue.element=Ht:Ue.element=Ht.canvas,Ue.width=Ue.element.width,Ue.height=Ue.element.height,Ue.channels=4;else if(Uc(Ht))Ue.element=Ht,Ue.width=Ht.width,Ue.height=Ht.height,Ue.channels=4;else if(Ef(Ht))Ue.element=Ht,Ue.width=Ht.naturalWidth,Ue.height=Ht.naturalHeight,Ue.channels=4;else if(ms(Ht))Ue.element=Ht,Ue.width=Ht.width,Ue.height=Ht.height,Ue.channels=4;else if(Hf(Ht))Ue.element=Ht,Ue.width=Ht.videoWidth,Ue.height=Ht.videoHeight,Ue.channels=4;else if(fc(Ht)){var it=Ue.width||Ht[0].length,Be=Ue.height||Ht.length,Dt=Ue.channels;go(Ht[0][0])?Dt=Dt||Ht[0][0].length:Dt=Dt||1;for(var Wt=Oe.shape(Ht),kr=1,sn=0;sn<Wt.length;++sn)kr*=Wt[sn];var un=ns(Ue,kr);Oe.flatten(Ht,Wt,"",un),Qu(Ue,un),Ue.alignment=1,Ue.width=it,Ue.height=Be,Ue.channels=Dt,Ue.format=Ue.internalformat=Fn[Dt],Ue.needsFree=!0}Ue.type===Uu?Z(Ke.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Ue.type===ll&&Z(Ke.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function yn(Ue,cr,Ht){var Rn=Ue.element,Hi=Ue.data,Le=Ue.internalformat,be=Ue.format,st=Ue.type,Lt=Ue.width,Kt=Ue.height;pn(Ue),Rn?V.texImage2D(cr,Ht,be,be,st,Rn):Ue.compressed?V.compressedTexImage2D(cr,Ht,Le,Lt,Kt,0,Hi):Ue.needsCopy?(ir(),V.copyTexImage2D(cr,Ht,be,Ue.xOffset,Ue.yOffset,Lt,Kt,0)):V.texImage2D(cr,Ht,be,Lt,Kt,0,be,st,Hi||null)}function Ii(Ue,cr,Ht,Rn,Hi){var Le=Ue.element,be=Ue.data,st=Ue.internalformat,Lt=Ue.format,Kt=Ue.type,vt=Ue.width,qe=Ue.height;pn(Ue),Le?V.texSubImage2D(cr,Hi,Ht,Rn,Lt,Kt,Le):Ue.compressed?V.compressedTexSubImage2D(cr,Hi,Ht,Rn,st,vt,qe,be):Ue.needsCopy?(ir(),V.copyTexSubImage2D(cr,Hi,Ht,Rn,Ue.xOffset,Ue.yOffset,vt,qe)):V.texSubImage2D(cr,Hi,Ht,Rn,vt,qe,Lt,Kt,be)}var Si=[];function fn(){return Si.pop()||new Wr}function xn(Ue){Ue.needsFree&&$t.freeType(Ue.data),Wr.call(Ue),Si.push(Ue)}function fi(){_r.call(this),this.genMipmaps=!1,this.mipmapHint=Bi,this.mipmask=0,this.images=Array(16)}function Ci(Ue,cr,Ht){var Rn=Ue.images[0]=fn();Ue.mipmask=1,Rn.width=Ue.width=cr,Rn.height=Ue.height=Ht,Rn.channels=Ue.channels=4}function Vi(Ue,cr){var Ht=null;if(Li(cr))Ht=Ue.images[0]=fn(),Sr(Ht,Ue),cn(Ht,cr),Ue.mipmask=1;else if(Nn(Ue,cr),Array.isArray(cr.mipmap))for(var Rn=cr.mipmap,Hi=0;Hi<Rn.length;++Hi)Ht=Ue.images[Hi]=fn(),Sr(Ht,Ue),Ht.width>>=Hi,Ht.height>>=Hi,cn(Ht,Rn[Hi]),Ue.mipmask|=1<<Hi;else Ht=Ue.images[0]=fn(),Sr(Ht,Ue),cn(Ht,cr),Ue.mipmask=1;Sr(Ue,Ue.images[0]),Ue.compressed&&(Ue.internalformat===cl||Ue.internalformat===eu||Ue.internalformat===vf||Ue.internalformat===mf)&&Z(Ue.width%4==0&&Ue.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function oo(Ue,cr){for(var Ht=Ue.images,Rn=0;Rn<Ht.length;++Rn){if(!Ht[Rn])return;yn(Ht[Rn],cr,Rn)}}var Pa=[];function ji(){var Ue=Pa.pop()||new fi;_r.call(Ue),Ue.mipmask=0;for(var cr=0;cr<16;++cr)Ue.images[cr]=null;return Ue}function is(Ue){for(var cr=Ue.images,Ht=0;Ht<cr.length;++Ht)cr[Ht]&&xn(cr[Ht]),cr[Ht]=null;Pa.push(Ue)}function Xa(){this.minFilter=pa,this.magFilter=pa,this.wrapS=Fl,this.wrapT=Fl,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Bi}function Zo(Ue,cr){if("min"in cr){var Ht=cr.min;Z.parameter(Ht,Yr),Ue.minFilter=Yr[Ht],ko.indexOf(Ue.minFilter)>=0&&!("faces"in cr)&&(Ue.genMipmaps=!0)}if("mag"in cr){var Rn=cr.mag;Z.parameter(Rn,Gr),Ue.magFilter=Gr[Rn]}var Hi=Ue.wrapS,Le=Ue.wrapT;if("wrap"in cr){var be=cr.wrap;typeof be=="string"?(Z.parameter(be,zr),Hi=Le=zr[be]):Array.isArray(be)&&(Z.parameter(be[0],zr),Z.parameter(be[1],zr),Hi=zr[be[0]],Le=zr[be[1]])}else{if("wrapS"in cr){var st=cr.wrapS;Z.parameter(st,zr),Hi=zr[st]}if("wrapT"in cr){var Lt=cr.wrapT;Z.parameter(Lt,zr),Le=zr[Lt]}}if(Ue.wrapS=Hi,Ue.wrapT=Le,"anisotropic"in cr){var Kt=cr.anisotropic;Z(typeof Kt=="number"&&Kt>=1&&Kt<=Ke.maxAnisotropic,"aniso samples must be between 1 and "),Ue.anisotropic=cr.anisotropic}if("mipmap"in cr){var vt=!1;switch(typeof cr.mipmap){case"string":Z.parameter(cr.mipmap,Pr,"invalid mipmap hint"),Ue.mipmapHint=Pr[cr.mipmap],Ue.genMipmaps=!0,vt=!0;break;case"boolean":vt=Ue.genMipmaps=cr.mipmap;break;case"object":Z(Array.isArray(cr.mipmap),"invalid mipmap type"),Ue.genMipmaps=!1,vt=!0;break;default:Z.raise("invalid mipmap type")}vt&&!("min"in cr)&&(Ue.minFilter=qu)}}function _o(Ue,cr){V.texParameteri(cr,Ka,Ue.minFilter),V.texParameteri(cr,rs,Ue.magFilter),V.texParameteri(cr,kh,Ue.wrapS),V.texParameteri(cr,Ih,Ue.wrapT),ke.ext_texture_filter_anisotropic&&V.texParameteri(cr,Nl,Ue.anisotropic),Ue.genMipmaps&&(V.hint(zc,Ue.mipmapHint),V.generateMipmap(cr))}var as=0,Yo={},xs=Ke.maxTextureUnits,po=Array(xs).map(function(){return null});function Pi(Ue){_r.call(this),this.mipmask=0,this.internalformat=Js,this.id=as++,this.refCount=1,this.target=Ue,this.texture=V.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Xa,xr.profile&&(this.stats={size:0})}function Uo(Ue){V.activeTexture(zl),V.bindTexture(Ue.target,Ue.texture)}function aa(){var Ue=po[0];Ue?V.bindTexture(Ue.target,Ue.texture):V.bindTexture(vs,null)}function ls(Ue){var cr=Ue.texture;Z(cr,"must not double destroy texture");var Ht=Ue.unit,Rn=Ue.target;Ht>=0&&(V.activeTexture(zl+Ht),V.bindTexture(Rn,null),po[Ht]=null),V.deleteTexture(cr),Ue.texture=null,Ue.params=null,Ue.pixels=null,Ue.refCount=0,delete Yo[Ue.id],tr.textureCount--}y(Pi.prototype,{bind:function(){var Ue=this;Ue.bindCount+=1;var cr=Ue.unit;if(cr<0){for(var Ht=0;Ht<xs;++Ht){var Rn=po[Ht];if(Rn){if(Rn.bindCount>0)continue;Rn.unit=-1}po[Ht]=Ue,cr=Ht;break}cr>=xs&&Z.raise("insufficient number of texture units"),xr.profile&&tr.maxTextureUnits<cr+1&&(tr.maxTextureUnits=cr+1),Ue.unit=cr,V.activeTexture(zl+cr),V.bindTexture(Ue.target,Ue.texture)}return cr},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&ls(this)}});function _i(Ue,cr){var Ht=new Pi(vs);Yo[Ht.id]=Ht,tr.textureCount++;function Rn(be,st){var Lt=Ht.texInfo;Xa.call(Lt);var Kt=ji();return typeof be=="number"?typeof st=="number"?Ci(Kt,be|0,st|0):Ci(Kt,be|0,be|0):be?(Z.type(be,"object","invalid arguments to regl.texture"),Zo(Lt,be),Vi(Kt,be)):Ci(Kt,1,1),Lt.genMipmaps&&(Kt.mipmask=(Kt.width<<1)-1),Ht.mipmask=Kt.mipmask,Sr(Ht,Kt),Z.texture2D(Lt,Kt,Ke),Ht.internalformat=Kt.internalformat,Rn.width=Kt.width,Rn.height=Kt.height,Uo(Ht),oo(Kt,vs),_o(Lt,vs),aa(),is(Kt),xr.profile&&(Ht.stats.size=Is(Ht.internalformat,Ht.type,Kt.width,Kt.height,Lt.genMipmaps,!1)),Rn.format=jr[Ht.internalformat],Rn.type=ln[Ht.type],Rn.mag=Mr[Lt.magFilter],Rn.min=Jr[Lt.minFilter],Rn.wrapS=gn[Lt.wrapS],Rn.wrapT=gn[Lt.wrapT],Rn}function Hi(be,st,Lt,Kt){Z(!!be,"must specify image data");var vt=st|0,qe=Lt|0,Et=Kt|0,Ie=fn();return Sr(Ie,Ht),Ie.width=0,Ie.height=0,cn(Ie,be),Ie.width=Ie.width||(Ht.width>>Et)-vt,Ie.height=Ie.height||(Ht.height>>Et)-qe,Z(Ht.type===Ie.type&&Ht.format===Ie.format&&Ht.internalformat===Ie.internalformat,"incompatible format for texture.subimage"),Z(vt>=0&&qe>=0&&vt+Ie.width<=Ht.width&&qe+Ie.height<=Ht.height,"texture.subimage write out of bounds"),Z(Ht.mipmask&1<<Et,"missing mipmap data"),Z(Ie.data||Ie.element||Ie.needsCopy,"missing image data"),Uo(Ht),Ii(Ie,vs,vt,qe,Et),aa(),xn(Ie),Rn}function Le(be,st){var Lt=be|0,Kt=st|0||Lt;if(Lt===Ht.width&&Kt===Ht.height)return Rn;Rn.width=Ht.width=Lt,Rn.height=Ht.height=Kt,Uo(Ht);for(var vt=0;Ht.mipmask>>vt;++vt){var qe=Lt>>vt,Et=Kt>>vt;if(!qe||!Et)break;V.texImage2D(vs,vt,Ht.format,qe,Et,0,Ht.format,Ht.type,null)}return aa(),xr.profile&&(Ht.stats.size=Is(Ht.internalformat,Ht.type,Lt,Kt,!1,!1)),Rn}return Rn(Ue,cr),Rn.subimage=Hi,Rn.resize=Le,Rn._reglType="texture2d",Rn._texture=Ht,xr.profile&&(Rn.stats=Ht.stats),Rn.destroy=function(){Ht.decRef()},Rn}function Ni(Ue,cr,Ht,Rn,Hi,Le){var be=new Pi(df);Yo[be.id]=be,tr.cubeCount++;var st=new Array(6);function Lt(qe,Et,Ie,it,Be,Dt){var Wt,kr=be.texInfo;for(Xa.call(kr),Wt=0;Wt<6;++Wt)st[Wt]=ji();if(typeof qe=="number"||!qe){var sn=qe|0||1;for(Wt=0;Wt<6;++Wt)Ci(st[Wt],sn,sn)}else if(typeof qe=="object")if(Et)Vi(st[0],qe),Vi(st[1],Et),Vi(st[2],Ie),Vi(st[3],it),Vi(st[4],Be),Vi(st[5],Dt);else if(Zo(kr,qe),Nn(be,qe),"faces"in qe){var un=qe.faces;for(Z(Array.isArray(un)&&un.length===6,"cube faces must be a length 6 array"),Wt=0;Wt<6;++Wt)Z(typeof un[Wt]=="object"&&!!un[Wt],"invalid input for cube map face"),Sr(st[Wt],be),Vi(st[Wt],un[Wt])}else for(Wt=0;Wt<6;++Wt)Vi(st[Wt],qe);else Z.raise("invalid arguments to cube map");for(Sr(be,st[0]),Z.optional(function(){Ke.npotTextureCube||Z(Uf(be.width)&&Uf(be.height),"your browser does not support non power or two texture dimensions")}),kr.genMipmaps?be.mipmask=(st[0].width<<1)-1:be.mipmask=st[0].mipmask,Z.textureCube(be,kr,st,Ke),be.internalformat=st[0].internalformat,Lt.width=st[0].width,Lt.height=st[0].height,Uo(be),Wt=0;Wt<6;++Wt)oo(st[Wt],Yu+Wt);for(_o(kr,df),aa(),xr.profile&&(be.stats.size=Is(be.internalformat,be.type,Lt.width,Lt.height,kr.genMipmaps,!0)),Lt.format=jr[be.internalformat],Lt.type=ln[be.type],Lt.mag=Mr[kr.magFilter],Lt.min=Jr[kr.minFilter],Lt.wrapS=gn[kr.wrapS],Lt.wrapT=gn[kr.wrapT],Wt=0;Wt<6;++Wt)is(st[Wt]);return Lt}function Kt(qe,Et,Ie,it,Be){Z(!!Et,"must specify image data"),Z(typeof qe=="number"&&qe===(qe|0)&&qe>=0&&qe<6,"invalid face");var Dt=Ie|0,Wt=it|0,kr=Be|0,sn=fn();return Sr(sn,be),sn.width=0,sn.height=0,cn(sn,Et),sn.width=sn.width||(be.width>>kr)-Dt,sn.height=sn.height||(be.height>>kr)-Wt,Z(be.type===sn.type&&be.format===sn.format&&be.internalformat===sn.internalformat,"incompatible format for texture.subimage"),Z(Dt>=0&&Wt>=0&&Dt+sn.width<=be.width&&Wt+sn.height<=be.height,"texture.subimage write out of bounds"),Z(be.mipmask&1<<kr,"missing mipmap data"),Z(sn.data||sn.element||sn.needsCopy,"missing image data"),Uo(be),Ii(sn,Yu+qe,Dt,Wt,kr),aa(),xn(sn),Lt}function vt(qe){var Et=qe|0;if(Et!==be.width){Lt.width=be.width=Et,Lt.height=be.height=Et,Uo(be);for(var Ie=0;Ie<6;++Ie)for(var it=0;be.mipmask>>it;++it)V.texImage2D(Yu+Ie,it,be.format,Et>>it,Et>>it,0,be.format,be.type,null);return aa(),xr.profile&&(be.stats.size=Is(be.internalformat,be.type,Lt.width,Lt.height,!1,!0)),Lt}}return Lt(Ue,cr,Ht,Rn,Hi,Le),Lt.subimage=Kt,Lt.resize=vt,Lt._reglType="textureCube",Lt._texture=be,xr.profile&&(Lt.stats=be.stats),Lt.destroy=function(){be.decRef()},Lt}function _a(){for(var Ue=0;Ue<xs;++Ue)V.activeTexture(zl+Ue),V.bindTexture(vs,null),po[Ue]=null;ve(Yo).forEach(ls),tr.cubeCount=0,tr.textureCount=0}xr.profile&&(tr.getTotalTextureSize=function(){var Ue=0;return Object.keys(Yo).forEach(function(cr){Ue+=Yo[cr].stats.size}),Ue});function Oo(){for(var Ue=0;Ue<xs;++Ue){var cr=po[Ue];cr&&(cr.bindCount=0,cr.unit=-1,po[Ue]=null)}ve(Yo).forEach(function(Ht){Ht.texture=V.createTexture(),V.bindTexture(Ht.target,Ht.texture);for(var Rn=0;Rn<32;++Rn)if((Ht.mipmask&1<<Rn)!=0)if(Ht.target===vs)V.texImage2D(vs,Rn,Ht.internalformat,Ht.width>>Rn,Ht.height>>Rn,0,Ht.internalformat,Ht.type,null);else for(var Hi=0;Hi<6;++Hi)V.texImage2D(Yu+Hi,Rn,Ht.internalformat,Ht.width>>Rn,Ht.height>>Rn,0,Ht.internalformat,Ht.type,null);_o(Ht.texInfo,Ht.target)})}function Ou(){for(var Ue=0;Ue<xs;++Ue){var cr=po[Ue];cr&&(cr.bindCount=0,cr.unit=-1,po[Ue]=null),V.activeTexture(zl+Ue),V.bindTexture(vs,null),V.bindTexture(df,null)}}return{create2D:_i,createCube:Ni,clear:_a,getTexture:function(Ue){return null},restore:Oo,refresh:Ou}}var Hs=36161,Yn=32854,Gn=32855,hc=36194,gs=33189,du=36168,Fo=34041,nu=35907,pc=34836,Vc=34842,fa=34843,ja=[];ja[Yn]=2,ja[Gn]=2,ja[hc]=2,ja[gs]=2,ja[du]=1,ja[Fo]=4,ja[nu]=4,ja[pc]=16,ja[Vc]=8,ja[fa]=6;function Wf(V,ke,Ke){return ja[V]*ke*Ke}var vl=function(V,ke,Ke,ir,Ar){var tr={rgba4:Yn,rgb565:hc,"rgb5 a1":Gn,depth:gs,stencil:du,"depth stencil":Fo};ke.ext_srgb&&(tr.srgba=nu),ke.ext_color_buffer_half_float&&(tr.rgba16f=Vc,tr.rgb16f=fa),ke.webgl_color_buffer_float&&(tr.rgba32f=pc);var xr=[];Object.keys(tr).forEach(function(Vr){var Xr=tr[Vr];xr[Xr]=Vr});var Pr=0,zr={};function Gr(Vr){this.id=Pr++,this.refCount=1,this.renderbuffer=Vr,this.format=Yn,this.width=0,this.height=0,Ar.profile&&(this.stats={size:0})}Gr.prototype.decRef=function(){--this.refCount<=0&&Yr(this)};function Yr(Vr){var Xr=Vr.renderbuffer;Z(Xr,"must not double destroy renderbuffer"),V.bindRenderbuffer(Hs,null),V.deleteRenderbuffer(Xr),Vr.renderbuffer=null,Vr.refCount=0,delete zr[Vr.id],ir.renderbufferCount--}function Kr(Vr,Xr){var Pt=new Gr(V.createRenderbuffer());zr[Pt.id]=Pt,ir.renderbufferCount++;function pr(ln,Mr){var Jr=0,gn=0,ei=Yn;if(typeof ln=="object"&&ln){var _r=ln;if("shape"in _r){var Sr=_r.shape;Z(Array.isArray(Sr)&&Sr.length>=2,"invalid renderbuffer shape"),Jr=Sr[0]|0,gn=Sr[1]|0}else"radius"in _r&&(Jr=gn=_r.radius|0),"width"in _r&&(Jr=_r.width|0),"height"in _r&&(gn=_r.height|0);"format"in _r&&(Z.parameter(_r.format,tr,"invalid renderbuffer format"),ei=tr[_r.format])}else typeof ln=="number"?(Jr=ln|0,typeof Mr=="number"?gn=Mr|0:gn=Jr):ln?Z.raise("invalid arguments to renderbuffer constructor"):Jr=gn=1;if(Z(Jr>0&&gn>0&&Jr<=Ke.maxRenderbufferSize&&gn<=Ke.maxRenderbufferSize,"invalid renderbuffer size"),!(Jr===Pt.width&&gn===Pt.height&&ei===Pt.format))return pr.width=Pt.width=Jr,pr.height=Pt.height=gn,Pt.format=ei,V.bindRenderbuffer(Hs,Pt.renderbuffer),V.renderbufferStorage(Hs,ei,Jr,gn),Z(V.getError()===0,"invalid render buffer format"),Ar.profile&&(Pt.stats.size=Wf(Pt.format,Pt.width,Pt.height)),pr.format=xr[Pt.format],pr}function jr(ln,Mr){var Jr=ln|0,gn=Mr|0||Jr;return Jr===Pt.width&&gn===Pt.height||(Z(Jr>0&&gn>0&&Jr<=Ke.maxRenderbufferSize&&gn<=Ke.maxRenderbufferSize,"invalid renderbuffer size"),pr.width=Pt.width=Jr,pr.height=Pt.height=gn,V.bindRenderbuffer(Hs,Pt.renderbuffer),V.renderbufferStorage(Hs,Pt.format,Jr,gn),Z(V.getError()===0,"invalid render buffer format"),Ar.profile&&(Pt.stats.size=Wf(Pt.format,Pt.width,Pt.height))),pr}return pr(Vr,Xr),pr.resize=jr,pr._reglType="renderbuffer",pr._renderbuffer=Pt,Ar.profile&&(pr.stats=Pt.stats),pr.destroy=function(){Pt.decRef()},pr}Ar.profile&&(ir.getTotalRenderbufferSize=function(){var Vr=0;return Object.keys(zr).forEach(function(Xr){Vr+=zr[Xr].stats.size}),Vr});function hn(){ve(zr).forEach(function(Vr){Vr.renderbuffer=V.createRenderbuffer(),V.bindRenderbuffer(Hs,Vr.renderbuffer),V.renderbufferStorage(Hs,Vr.format,Vr.width,Vr.height)}),V.bindRenderbuffer(Hs,null)}return{create:Kr,clear:function(){ve(zr).forEach(Yr)},restore:hn}},ju=36160,vu=36161,Io=3553,ml=34069,Mu=36064,jc=36096,Ul=36128,Eo=33306,Xf=36053,Gc=36054,dc=36055,$f=36057,Vl=36061,iu=36193,vc=5121,ku=5126,Ws=6407,Hc=6408,Wc=6402,Sf=[Ws,Hc],Xc=[];Xc[Hc]=4,Xc[Ws]=3;var f=[];f[vc]=1,f[ku]=4,f[iu]=2;var d=32854,h=32855,g=36194,w=33189,M=36168,I=34041,D=35907,G=34836,te=34842,he=34843,Se=[d,h,g,D,te,he,G],Ae={};Ae[Xf]="complete",Ae[Gc]="incomplete attachment",Ae[$f]="incomplete dimensions",Ae[dc]="incomplete, missing attachment",Ae[Vl]="unsupported";function We(V,ke,Ke,ir,Ar,tr){var xr={cur:null,next:null,dirty:!1,setFBO:null},Pr=["rgba"],zr=["rgba4","rgb565","rgb5 a1"];ke.ext_srgb&&zr.push("srgba"),ke.ext_color_buffer_half_float&&zr.push("rgba16f","rgb16f"),ke.webgl_color_buffer_float&&zr.push("rgba32f");var Gr=["uint8"];ke.oes_texture_half_float&&Gr.push("half float","float16"),ke.oes_texture_float&&Gr.push("float","float32");function Yr(Wr,cn,yn){this.target=Wr,this.texture=cn,this.renderbuffer=yn;var Ii=0,Si=0;cn?(Ii=cn.width,Si=cn.height):yn&&(Ii=yn.width,Si=yn.height),this.width=Ii,this.height=Si}function Kr(Wr){Wr&&(Wr.texture&&Wr.texture._texture.decRef(),Wr.renderbuffer&&Wr.renderbuffer._renderbuffer.decRef())}function hn(Wr,cn,yn){if(!!Wr)if(Wr.texture){var Ii=Wr.texture._texture,Si=Math.max(1,Ii.width),fn=Math.max(1,Ii.height);Z(Si===cn&&fn===yn,"inconsistent width/height for supplied texture"),Ii.refCount+=1}else{var xn=Wr.renderbuffer._renderbuffer;Z(xn.width===cn&&xn.height===yn,"inconsistent width/height for renderbuffer"),xn.refCount+=1}}function Vr(Wr,cn){cn&&(cn.texture?V.framebufferTexture2D(ju,Wr,cn.target,cn.texture._texture.texture,0):V.framebufferRenderbuffer(ju,Wr,vu,cn.renderbuffer._renderbuffer.renderbuffer))}function Xr(Wr){var cn=Io,yn=null,Ii=null,Si=Wr;typeof Wr=="object"&&(Si=Wr.data,"target"in Wr&&(cn=Wr.target|0)),Z.type(Si,"function","invalid attachment data");var fn=Si._reglType;return fn==="texture2d"?(yn=Si,Z(cn===Io)):fn==="textureCube"?(yn=Si,Z(cn>=ml&&cn<ml+6,"invalid cube map target")):fn==="renderbuffer"?(Ii=Si,cn=vu):Z.raise("invalid regl object for attachment"),new Yr(cn,yn,Ii)}function Pt(Wr,cn,yn,Ii,Si){if(yn){var fn=ir.create2D({width:Wr,height:cn,format:Ii,type:Si});return fn._texture.refCount=0,new Yr(Io,fn,null)}else{var xn=Ar.create({width:Wr,height:cn,format:Ii});return xn._renderbuffer.refCount=0,new Yr(vu,null,xn)}}function pr(Wr){return Wr&&(Wr.texture||Wr.renderbuffer)}function jr(Wr,cn,yn){Wr&&(Wr.texture?Wr.texture.resize(cn,yn):Wr.renderbuffer&&Wr.renderbuffer.resize(cn,yn),Wr.width=cn,Wr.height=yn)}var ln=0,Mr={};function Jr(){this.id=ln++,Mr[this.id]=this,this.framebuffer=V.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function gn(Wr){Wr.colorAttachments.forEach(Kr),Kr(Wr.depthAttachment),Kr(Wr.stencilAttachment),Kr(Wr.depthStencilAttachment)}function ei(Wr){var cn=Wr.framebuffer;Z(cn,"must not double destroy framebuffer"),V.deleteFramebuffer(cn),Wr.framebuffer=null,tr.framebufferCount--,delete Mr[Wr.id]}function _r(Wr){var cn;V.bindFramebuffer(ju,Wr.framebuffer);var yn=Wr.colorAttachments;for(cn=0;cn<yn.length;++cn)Vr(Mu+cn,yn[cn]);for(cn=yn.length;cn<Ke.maxColorAttachments;++cn)V.framebufferTexture2D(ju,Mu+cn,Io,null,0);V.framebufferTexture2D(ju,Eo,Io,null,0),V.framebufferTexture2D(ju,jc,Io,null,0),V.framebufferTexture2D(ju,Ul,Io,null,0),Vr(jc,Wr.depthAttachment),Vr(Ul,Wr.stencilAttachment),Vr(Eo,Wr.depthStencilAttachment);var Ii=V.checkFramebufferStatus(ju);!V.isContextLost()&&Ii!==Xf&&Z.raise("framebuffer configuration not supported, status = "+Ae[Ii]),V.bindFramebuffer(ju,xr.next?xr.next.framebuffer:null),xr.cur=xr.next,V.getError()}function Sr(Wr,cn){var yn=new Jr;tr.framebufferCount++;function Ii(fn,xn){var fi;Z(xr.next!==yn,"can not update framebuffer which is currently in use");var Ci=0,Vi=0,oo=!0,Pa=!0,ji=null,is=!0,Xa="rgba",Zo="uint8",_o=1,as=null,Yo=null,xs=null,po=!1;if(typeof fn=="number")Ci=fn|0,Vi=xn|0||Ci;else if(!fn)Ci=Vi=1;else{Z.type(fn,"object","invalid arguments for framebuffer");var Pi=fn;if("shape"in Pi){var Uo=Pi.shape;Z(Array.isArray(Uo)&&Uo.length>=2,"invalid shape for framebuffer"),Ci=Uo[0],Vi=Uo[1]}else"radius"in Pi&&(Ci=Vi=Pi.radius),"width"in Pi&&(Ci=Pi.width),"height"in Pi&&(Vi=Pi.height);("color"in Pi||"colors"in Pi)&&(ji=Pi.color||Pi.colors,Array.isArray(ji)&&Z(ji.length===1||ke.webgl_draw_buffers,"multiple render targets not supported")),ji||("colorCount"in Pi&&(_o=Pi.colorCount|0,Z(_o>0,"invalid color buffer count")),"colorTexture"in Pi&&(is=!!Pi.colorTexture,Xa="rgba4"),"colorType"in Pi&&(Zo=Pi.colorType,is?(Z(ke.oes_texture_float||!(Zo==="float"||Zo==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),Z(ke.oes_texture_half_float||!(Zo==="half float"||Zo==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Zo==="half float"||Zo==="float16"?(Z(ke.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Xa="rgba16f"):(Zo==="float"||Zo==="float32")&&(Z(ke.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Xa="rgba32f"),Z.oneOf(Zo,Gr,"invalid color type")),"colorFormat"in Pi&&(Xa=Pi.colorFormat,Pr.indexOf(Xa)>=0?is=!0:zr.indexOf(Xa)>=0?is=!1:Z.optional(function(){is?Z.oneOf(Pi.colorFormat,Pr,"invalid color format for texture"):Z.oneOf(Pi.colorFormat,zr,"invalid color format for renderbuffer")}))),("depthTexture"in Pi||"depthStencilTexture"in Pi)&&(po=!!(Pi.depthTexture||Pi.depthStencilTexture),Z(!po||ke.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in Pi&&(typeof Pi.depth=="boolean"?oo=Pi.depth:(as=Pi.depth,Pa=!1)),"stencil"in Pi&&(typeof Pi.stencil=="boolean"?Pa=Pi.stencil:(Yo=Pi.stencil,oo=!1)),"depthStencil"in Pi&&(typeof Pi.depthStencil=="boolean"?oo=Pa=Pi.depthStencil:(xs=Pi.depthStencil,oo=!1,Pa=!1))}var aa=null,ls=null,_i=null,Ni=null;if(Array.isArray(ji))aa=ji.map(Xr);else if(ji)aa=[Xr(ji)];else for(aa=new Array(_o),fi=0;fi<_o;++fi)aa[fi]=Pt(Ci,Vi,is,Xa,Zo);Z(ke.webgl_draw_buffers||aa.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),Z(aa.length<=Ke.maxColorAttachments,"too many color attachments, not supported"),Ci=Ci||aa[0].width,Vi=Vi||aa[0].height,as?ls=Xr(as):oo&&!Pa&&(ls=Pt(Ci,Vi,po,"depth","uint32")),Yo?_i=Xr(Yo):Pa&&!oo&&(_i=Pt(Ci,Vi,!1,"stencil","uint8")),xs?Ni=Xr(xs):!as&&!Yo&&Pa&&oo&&(Ni=Pt(Ci,Vi,po,"depth stencil","depth stencil")),Z(!!as+!!Yo+!!xs<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var _a=null;for(fi=0;fi<aa.length;++fi)if(hn(aa[fi],Ci,Vi),Z(!aa[fi]||aa[fi].texture&&Sf.indexOf(aa[fi].texture._texture.format)>=0||aa[fi].renderbuffer&&Se.indexOf(aa[fi].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+fi+" is invalid"),aa[fi]&&aa[fi].texture){var Oo=Xc[aa[fi].texture._texture.format]*f[aa[fi].texture._texture.type];_a===null?_a=Oo:Z(_a===Oo,"all color attachments much have the same number of bits per pixel.")}return hn(ls,Ci,Vi),Z(!ls||ls.texture&&ls.texture._texture.format===Wc||ls.renderbuffer&&ls.renderbuffer._renderbuffer.format===w,"invalid depth attachment for framebuffer object"),hn(_i,Ci,Vi),Z(!_i||_i.renderbuffer&&_i.renderbuffer._renderbuffer.format===M,"invalid stencil attachment for framebuffer object"),hn(Ni,Ci,Vi),Z(!Ni||Ni.texture&&Ni.texture._texture.format===I||Ni.renderbuffer&&Ni.renderbuffer._renderbuffer.format===I,"invalid depth-stencil attachment for framebuffer object"),gn(yn),yn.width=Ci,yn.height=Vi,yn.colorAttachments=aa,yn.depthAttachment=ls,yn.stencilAttachment=_i,yn.depthStencilAttachment=Ni,Ii.color=aa.map(pr),Ii.depth=pr(ls),Ii.stencil=pr(_i),Ii.depthStencil=pr(Ni),Ii.width=yn.width,Ii.height=yn.height,_r(yn),Ii}function Si(fn,xn){Z(xr.next!==yn,"can not resize a framebuffer which is currently in use");var fi=Math.max(fn|0,1),Ci=Math.max(xn|0||fi,1);if(fi===yn.width&&Ci===yn.height)return Ii;for(var Vi=yn.colorAttachments,oo=0;oo<Vi.length;++oo)jr(Vi[oo],fi,Ci);return jr(yn.depthAttachment,fi,Ci),jr(yn.stencilAttachment,fi,Ci),jr(yn.depthStencilAttachment,fi,Ci),yn.width=Ii.width=fi,yn.height=Ii.height=Ci,_r(yn),Ii}return Ii(Wr,cn),y(Ii,{resize:Si,_reglType:"framebuffer",_framebuffer:yn,destroy:function(){ei(yn),gn(yn)},use:function(fn){xr.setFBO({framebuffer:Ii},fn)}})}function Nn(Wr){var cn=Array(6);function yn(Si){var fn;Z(cn.indexOf(xr.next)<0,"can not update framebuffer which is currently in use");var xn={color:null},fi=0,Ci=null,Vi="rgba",oo="uint8",Pa=1;if(typeof Si=="number")fi=Si|0;else if(!Si)fi=1;else{Z.type(Si,"object","invalid arguments for framebuffer");var ji=Si;if("shape"in ji){var is=ji.shape;Z(Array.isArray(is)&&is.length>=2,"invalid shape for framebuffer"),Z(is[0]===is[1],"cube framebuffer must be square"),fi=is[0]}else"radius"in ji&&(fi=ji.radius|0),"width"in ji?(fi=ji.width|0,"height"in ji&&Z(ji.height===fi,"must be square")):"height"in ji&&(fi=ji.height|0);("color"in ji||"colors"in ji)&&(Ci=ji.color||ji.colors,Array.isArray(Ci)&&Z(Ci.length===1||ke.webgl_draw_buffers,"multiple render targets not supported")),Ci||("colorCount"in ji&&(Pa=ji.colorCount|0,Z(Pa>0,"invalid color buffer count")),"colorType"in ji&&(Z.oneOf(ji.colorType,Gr,"invalid color type"),oo=ji.colorType),"colorFormat"in ji&&(Vi=ji.colorFormat,Z.oneOf(ji.colorFormat,Pr,"invalid color format for texture"))),"depth"in ji&&(xn.depth=ji.depth),"stencil"in ji&&(xn.stencil=ji.stencil),"depthStencil"in ji&&(xn.depthStencil=ji.depthStencil)}var Xa;if(Ci)if(Array.isArray(Ci))for(Xa=[],fn=0;fn<Ci.length;++fn)Xa[fn]=Ci[fn];else Xa=[Ci];else{Xa=Array(Pa);var Zo={radius:fi,format:Vi,type:oo};for(fn=0;fn<Pa;++fn)Xa[fn]=ir.createCube(Zo)}for(xn.color=Array(Xa.length),fn=0;fn<Xa.length;++fn){var _o=Xa[fn];Z(typeof _o=="function"&&_o._reglType==="textureCube","invalid cube map"),fi=fi||_o.width,Z(_o.width===fi&&_o.height===fi,"invalid cube map shape"),xn.color[fn]={target:ml,data:Xa[fn]}}for(fn=0;fn<6;++fn){for(var as=0;as<Xa.length;++as)xn.color[as].target=ml+fn;fn>0&&(xn.depth=cn[0].depth,xn.stencil=cn[0].stencil,xn.depthStencil=cn[0].depthStencil),cn[fn]?cn[fn](xn):cn[fn]=Sr(xn)}return y(yn,{width:fi,height:fi,color:Xa})}function Ii(Si){var fn,xn=Si|0;if(Z(xn>0&&xn<=Ke.maxCubeMapSize,"invalid radius for cube fbo"),xn===yn.width)return yn;var fi=yn.color;for(fn=0;fn<fi.length;++fn)fi[fn].resize(xn);for(fn=0;fn<6;++fn)cn[fn].resize(xn);return yn.width=yn.height=xn,yn}return yn(Wr),y(yn,{faces:cn,resize:Ii,_reglType:"framebufferCube",destroy:function(){cn.forEach(function(Si){Si.destroy()})}})}function pn(){xr.cur=null,xr.next=null,xr.dirty=!0,ve(Mr).forEach(function(Wr){Wr.framebuffer=V.createFramebuffer(),_r(Wr)})}return y(xr,{getFramebuffer:function(Wr){if(typeof Wr=="function"&&Wr._reglType==="framebuffer"){var cn=Wr._framebuffer;if(cn instanceof Jr)return cn}return null},create:Sr,createCube:Nn,clear:function(){ve(Mr).forEach(ei)},restore:pn})}var Ge=5126,ot=34962,Ze=34963,Xe=["attributes","elements","offset","count","primitive","instances"];function de(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Ge,this.offset=0,this.stride=0,this.divisor=0}function Vt(V,ke,Ke,ir,Ar,tr,xr){for(var Pr=Ke.maxAttributes,zr=new Array(Pr),Gr=0;Gr<Pr;++Gr)zr[Gr]=new de;var Yr=0,Kr={},hn={Record:de,scope:{},state:zr,currentVAO:null,targetVAO:null,restore:Xr()?gn:function(){},createVAO:ei,getVAO:pr,destroyBuffer:Vr,setVAO:Xr()?jr:ln,clear:Xr()?Mr:function(){}};function Vr(_r){for(var Sr=0;Sr<zr.length;++Sr){var Nn=zr[Sr];Nn.buffer===_r&&(V.disableVertexAttribArray(Sr),Nn.buffer=null)}}function Xr(){return ke.oes_vertex_array_object}function Pt(){return ke.angle_instanced_arrays}function pr(_r){return typeof _r=="function"&&_r._vao?_r._vao:null}function jr(_r){if(_r!==hn.currentVAO){var Sr=Xr();_r?Sr.bindVertexArrayOES(_r.vao):Sr.bindVertexArrayOES(null),hn.currentVAO=_r}}function ln(_r){if(_r!==hn.currentVAO){if(_r)_r.bindAttrs();else{for(var Sr=Pt(),Nn=0;Nn<zr.length;++Nn){var pn=zr[Nn];pn.buffer?(V.enableVertexAttribArray(Nn),pn.buffer.bind(),V.vertexAttribPointer(Nn,pn.size,pn.type,pn.normalized,pn.stride,pn.offfset),Sr&&pn.divisor&&Sr.vertexAttribDivisorANGLE(Nn,pn.divisor)):(V.disableVertexAttribArray(Nn),V.vertexAttrib4f(Nn,pn.x,pn.y,pn.z,pn.w))}xr.elements?V.bindBuffer(Ze,xr.elements.buffer.buffer):V.bindBuffer(Ze,null)}hn.currentVAO=_r}}function Mr(){ve(Kr).forEach(function(_r){_r.destroy()})}function Jr(){this.id=++Yr,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var _r=Xr();_r?this.vao=_r.createVertexArrayOES():this.vao=null,Kr[this.id]=this,this.buffers=[]}Jr.prototype.bindAttrs=function(){for(var _r=Pt(),Sr=this.attributes,Nn=0;Nn<Sr.length;++Nn){var pn=Sr[Nn];pn.buffer?(V.enableVertexAttribArray(Nn),V.bindBuffer(ot,pn.buffer.buffer),V.vertexAttribPointer(Nn,pn.size,pn.type,pn.normalized,pn.stride,pn.offset),_r&&pn.divisor&&_r.vertexAttribDivisorANGLE(Nn,pn.divisor)):(V.disableVertexAttribArray(Nn),V.vertexAttrib4f(Nn,pn.x,pn.y,pn.z,pn.w))}for(var Wr=Sr.length;Wr<Pr;++Wr)V.disableVertexAttribArray(Wr);var cn=tr.getElements(this.elements);cn?V.bindBuffer(Ze,cn.buffer.buffer):V.bindBuffer(Ze,null)},Jr.prototype.refresh=function(){var _r=Xr();_r&&(_r.bindVertexArrayOES(this.vao),this.bindAttrs(),hn.currentVAO=null,_r.bindVertexArrayOES(null))},Jr.prototype.destroy=function(){if(this.vao){var _r=Xr();this===hn.currentVAO&&(hn.currentVAO=null,_r.bindVertexArrayOES(null)),_r.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),Kr[this.id]&&(delete Kr[this.id],ir.vaoCount-=1)};function gn(){var _r=Xr();_r&&ve(Kr).forEach(function(Sr){Sr.refresh()})}function ei(_r){var Sr=new Jr;ir.vaoCount+=1;function Nn(pn){var Wr;if(Array.isArray(pn))Wr=pn,Sr.elements&&Sr.ownsElements&&Sr.elements.destroy(),Sr.elements=null,Sr.ownsElements=!1,Sr.offset=0,Sr.count=0,Sr.instances=-1,Sr.primitive=4;else{if(Z(typeof pn=="object","invalid arguments for create vao"),Z("attributes"in pn,"must specify attributes for vao"),pn.elements){var cn=pn.elements;Sr.ownsElements?typeof cn=="function"&&cn._reglType==="elements"?(Sr.elements.destroy(),Sr.ownsElements=!1):(Sr.elements(cn),Sr.ownsElements=!1):tr.getElements(pn.elements)?(Sr.elements=pn.elements,Sr.ownsElements=!1):(Sr.elements=tr.create(pn.elements),Sr.ownsElements=!0)}else Sr.elements=null,Sr.ownsElements=!1;Wr=pn.attributes,Sr.offset=0,Sr.count=-1,Sr.instances=-1,Sr.primitive=4,Sr.elements&&(Sr.count=Sr.elements._elements.vertCount,Sr.primitive=Sr.elements._elements.primType),"offset"in pn&&(Sr.offset=pn.offset|0),"count"in pn&&(Sr.count=pn.count|0),"instances"in pn&&(Sr.instances=pn.instances|0),"primitive"in pn&&(Z(pn.primitive in Er,"bad primitive type: "+pn.primitive),Sr.primitive=Er[pn.primitive]),Z.optional(function(){for(var oo=Object.keys(pn),Pa=0;Pa<oo.length;++Pa)Z(Xe.indexOf(oo[Pa])>=0,'invalid option for vao: "'+oo[Pa]+'" valid options are '+Xe)}),Z(Array.isArray(Wr),"attributes must be an array")}Z(Wr.length<Pr,"too many attributes"),Z(Wr.length>0,"must specify at least one attribute");var yn={},Ii=Sr.attributes;Ii.length=Wr.length;for(var Si=0;Si<Wr.length;++Si){var fn=Wr[Si],xn=Ii[Si]=new de,fi=fn.data||fn;if(Array.isArray(fi)||ne(fi)||es(fi)){var Ci;Sr.buffers[Si]&&(Ci=Sr.buffers[Si],ne(fi)&&Ci._buffer.byteLength>=fi.byteLength?Ci.subdata(fi):(Ci.destroy(),Sr.buffers[Si]=null)),Sr.buffers[Si]||(Ci=Sr.buffers[Si]=Ar.create(fn,ot,!1,!0)),xn.buffer=Ar.getBuffer(Ci),xn.size=xn.buffer.dimension|0,xn.normalized=!1,xn.type=xn.buffer.dtype,xn.offset=0,xn.stride=0,xn.divisor=0,xn.state=1,yn[Si]=1}else Ar.getBuffer(fn)?(xn.buffer=Ar.getBuffer(fn),xn.size=xn.buffer.dimension|0,xn.normalized=!1,xn.type=xn.buffer.dtype,xn.offset=0,xn.stride=0,xn.divisor=0,xn.state=1):Ar.getBuffer(fn.buffer)?(xn.buffer=Ar.getBuffer(fn.buffer),xn.size=(+fn.size||xn.buffer.dimension)|0,xn.normalized=!!fn.normalized||!1,"type"in fn?(Z.parameter(fn.type,cu,"invalid buffer type"),xn.type=cu[fn.type]):xn.type=xn.buffer.dtype,xn.offset=(fn.offset||0)|0,xn.stride=(fn.stride||0)|0,xn.divisor=(fn.divisor||0)|0,xn.state=1,Z(xn.size>=1&&xn.size<=4,"size must be between 1 and 4"),Z(xn.offset>=0,"invalid offset"),Z(xn.stride>=0&&xn.stride<=255,"stride must be between 0 and 255"),Z(xn.divisor>=0,"divisor must be positive"),Z(!xn.divisor||!!ke.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in fn?(Z(Si>0,"first attribute must not be a constant"),xn.x=+fn.x||0,xn.y=+fn.y||0,xn.z=+fn.z||0,xn.w=+fn.w||0,xn.state=2):Z(!1,"invalid attribute spec for location "+Si)}for(var Vi=0;Vi<Sr.buffers.length;++Vi)!yn[Vi]&&Sr.buffers[Vi]&&(Sr.buffers[Vi].destroy(),Sr.buffers[Vi]=null);return Sr.refresh(),Nn}return Nn.destroy=function(){for(var pn=0;pn<Sr.buffers.length;++pn)Sr.buffers[pn]&&Sr.buffers[pn].destroy();Sr.buffers.length=0,Sr.ownsElements&&(Sr.elements.destroy(),Sr.elements=null,Sr.ownsElements=!1),Sr.destroy()},Nn._vao=Sr,Nn._reglType="vao",Nn(_r)}return hn}var q=35632,or=35633,dr=35718,Fr=35721;function on(V,ke,Ke,ir){var Ar={},tr={};function xr(Pt,pr,jr,ln){this.name=Pt,this.id=pr,this.location=jr,this.info=ln}function Pr(Pt,pr){for(var jr=0;jr<Pt.length;++jr)if(Pt[jr].id===pr.id){Pt[jr].location=pr.location;return}Pt.push(pr)}function zr(Pt,pr,jr){var ln=Pt===q?Ar:tr,Mr=ln[pr];if(!Mr){var Jr=ke.str(pr);Mr=V.createShader(Pt),V.shaderSource(Mr,Jr),V.compileShader(Mr),Z.shaderError(V,Mr,Jr,Pt,jr),ln[pr]=Mr}return Mr}var Gr={},Yr=[],Kr=0;function hn(Pt,pr){this.id=Kr++,this.fragId=Pt,this.vertId=pr,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,ir.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function Vr(Pt,pr,jr){var ln,Mr,Jr=zr(q,Pt.fragId),gn=zr(or,Pt.vertId),ei=Pt.program=V.createProgram();if(V.attachShader(ei,Jr),V.attachShader(ei,gn),jr)for(ln=0;ln<jr.length;++ln){var _r=jr[ln];V.bindAttribLocation(ei,_r[0],_r[1])}V.linkProgram(ei),Z.linkError(V,ei,ke.str(Pt.fragId),ke.str(Pt.vertId),pr);var Sr=V.getProgramParameter(ei,dr);ir.profile&&(Pt.stats.uniformsCount=Sr);var Nn=Pt.uniforms;for(ln=0;ln<Sr;++ln)if(Mr=V.getActiveUniform(ei,ln),Mr)if(Mr.size>1)for(var pn=0;pn<Mr.size;++pn){var Wr=Mr.name.replace("[0]","["+pn+"]");Pr(Nn,new xr(Wr,ke.id(Wr),V.getUniformLocation(ei,Wr),Mr))}else Pr(Nn,new xr(Mr.name,ke.id(Mr.name),V.getUniformLocation(ei,Mr.name),Mr));var cn=V.getProgramParameter(ei,Fr);ir.profile&&(Pt.stats.attributesCount=cn);var yn=Pt.attributes;for(ln=0;ln<cn;++ln)Mr=V.getActiveAttrib(ei,ln),Mr&&Pr(yn,new xr(Mr.name,ke.id(Mr.name),V.getAttribLocation(ei,Mr.name),Mr))}ir.profile&&(Ke.getMaxUniformsCount=function(){var Pt=0;return Yr.forEach(function(pr){pr.stats.uniformsCount>Pt&&(Pt=pr.stats.uniformsCount)}),Pt},Ke.getMaxAttributesCount=function(){var Pt=0;return Yr.forEach(function(pr){pr.stats.attributesCount>Pt&&(Pt=pr.stats.attributesCount)}),Pt});function Xr(){Ar={},tr={};for(var Pt=0;Pt<Yr.length;++Pt)Vr(Yr[Pt],null,Yr[Pt].attributes.map(function(pr){return[pr.location,pr.name]}))}return{clear:function(){var Pt=V.deleteShader.bind(V);ve(Ar).forEach(Pt),Ar={},ve(tr).forEach(Pt),tr={},Yr.forEach(function(pr){V.deleteProgram(pr.program)}),Yr.length=0,Gr={},Ke.shaderCount=0},program:function(Pt,pr,jr,ln){Z.command(Pt>=0,"missing vertex shader",jr),Z.command(pr>=0,"missing fragment shader",jr);var Mr=Gr[pr];Mr||(Mr=Gr[pr]={});var Jr=Mr[Pt];if(Jr&&(Jr.refCount++,!ln))return Jr;var gn=new hn(pr,Pt);return Ke.shaderCount++,Vr(gn,jr,ln),Jr||(Mr[Pt]=gn),Yr.push(gn),y(gn,{destroy:function(){if(gn.refCount--,gn.refCount<=0){V.deleteProgram(gn.program);var ei=Yr.indexOf(gn);Yr.splice(ei,1),Ke.shaderCount--}Mr[gn.vertId].refCount<=0&&(V.deleteShader(tr[gn.vertId]),delete tr[gn.vertId],delete Gr[gn.fragId][gn.vertId]),Object.keys(Gr[gn.fragId]).length||(V.deleteShader(Ar[gn.fragId]),delete Ar[gn.fragId],delete Gr[gn.fragId])}})},restore:Xr,shader:zr,frag:-1,vert:-1}}var nn=6408,Tn=5121,ri=3333,Jn=5126;function ii(V,ke,Ke,ir,Ar,tr,xr){function Pr(Yr){var Kr;ke.next===null?(Z(Ar.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),Kr=Tn):(Z(ke.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),Kr=ke.next.colorAttachments[0].texture._texture.type,Z.optional(function(){tr.oes_texture_float?(Z(Kr===Tn||Kr===Jn,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),Kr===Jn&&Z(xr.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):Z(Kr===Tn,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var hn=0,Vr=0,Xr=ir.framebufferWidth,Pt=ir.framebufferHeight,pr=null;ne(Yr)?pr=Yr:Yr&&(Z.type(Yr,"object","invalid arguments to regl.read()"),hn=Yr.x|0,Vr=Yr.y|0,Z(hn>=0&&hn<ir.framebufferWidth,"invalid x offset for regl.read"),Z(Vr>=0&&Vr<ir.framebufferHeight,"invalid y offset for regl.read"),Xr=(Yr.width||ir.framebufferWidth-hn)|0,Pt=(Yr.height||ir.framebufferHeight-Vr)|0,pr=Yr.data||null),pr&&(Kr===Tn?Z(pr instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):Kr===Jn&&Z(pr instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),Z(Xr>0&&Xr+hn<=ir.framebufferWidth,"invalid width for read pixels"),Z(Pt>0&&Pt+Vr<=ir.framebufferHeight,"invalid height for read pixels"),Ke();var jr=Xr*Pt*4;return pr||(Kr===Tn?pr=new Uint8Array(jr):Kr===Jn&&(pr=pr||new Float32Array(jr))),Z.isTypedArray(pr,"data buffer for regl.read() must be a typedarray"),Z(pr.byteLength>=jr,"data buffer for regl.read() too small"),V.pixelStorei(ri,4),V.readPixels(hn,Vr,Xr,Pt,nn,Kr,pr),pr}function zr(Yr){var Kr;return ke.setFBO({framebuffer:Yr.framebuffer},function(){Kr=Pr(Yr)}),Kr}function Gr(Yr){return!Yr||!("framebuffer"in Yr)?Pr(Yr):zr(Yr)}return Gr}function Ui(V){return Array.prototype.slice.call(V)}function En(V){return Ui(V).join("")}function wi(){var V=0,ke=[],Ke=[];function ir(Kr){for(var hn=0;hn<Ke.length;++hn)if(Ke[hn]===Kr)return ke[hn];var Vr="g"+V++;return ke.push(Vr),Ke.push(Kr),Vr}function Ar(){var Kr=[];function hn(){Kr.push.apply(Kr,Ui(arguments))}var Vr=[];function Xr(){var Pt="v"+V++;return Vr.push(Pt),arguments.length>0&&(Kr.push(Pt,"="),Kr.push.apply(Kr,Ui(arguments)),Kr.push(";")),Pt}return y(hn,{def:Xr,toString:function(){return En([Vr.length>0?"var "+Vr.join(",")+";":"",En(Kr)])}})}function tr(){var Kr=Ar(),hn=Ar(),Vr=Kr.toString,Xr=hn.toString;function Pt(pr,jr){hn(pr,jr,"=",Kr.def(pr,jr),";")}return y(function(){Kr.apply(Kr,Ui(arguments))},{def:Kr.def,entry:Kr,exit:hn,save:Pt,set:function(pr,jr,ln){Pt(pr,jr),Kr(pr,jr,"=",ln,";")},toString:function(){return Vr()+Xr()}})}function xr(){var Kr=En(arguments),hn=tr(),Vr=tr(),Xr=hn.toString,Pt=Vr.toString;return y(hn,{then:function(){return hn.apply(hn,Ui(arguments)),this},else:function(){return Vr.apply(Vr,Ui(arguments)),this},toString:function(){var pr=Pt();return pr&&(pr="else{"+pr+"}"),En(["if(",Kr,"){",Xr(),"}",pr])}})}var Pr=Ar(),zr={};function Gr(Kr,hn){var Vr=[];function Xr(){var Mr="a"+Vr.length;return Vr.push(Mr),Mr}hn=hn||0;for(var Pt=0;Pt<hn;++Pt)Xr();var pr=tr(),jr=pr.toString,ln=zr[Kr]=y(pr,{arg:Xr,toString:function(){return En(["function(",Vr.join(),"){",jr(),"}"])}});return ln}function Yr(){var Kr=['"use strict";',Pr,"return {"];Object.keys(zr).forEach(function(Pt){Kr.push('"',Pt,'":',zr[Pt].toString(),",")}),Kr.push("}");var hn=En(Kr).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),Vr=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Xr=Vr?Ee.Function.apply(null,ke.concat(hn)):Function.apply(null,ke.concat(hn));return Xr.apply(null,Ke)}return{global:Pr,link:ir,block:Ar,proc:Gr,scope:tr,cond:xr,compile:Yr}}var Ti="xyzw".split(""),yi=5121,ui=1,Mi=2,ci=0,oi=1,Po=2,Qa=3,So=4,Bo=5,Ja=6,yo="dither",Fs="blend.enable",No="blend.color",Iu="blend.equation",ys="blend.func",mu="depth.enable",au="depth.func",gl="depth.range",jl="depth.mask",ss="colorMask",yl="cull.enable",$c="cull.face",gu="frontFace",mc="lineWidth",Gu="polygonOffset.enable",wo="polygonOffset.offset",Pu="sample.alpha",_l="sample.enable",xl="sample.coverage",da="stencil.enable",Xs="stencil.mask",_s="stencil.func",Ju="stencil.opFront",Yc="stencil.opBack",qc="scissor.enable",wf="scissor.box",Ps="viewport",Gl="profile",yu="framebuffer",bl="vert",gc="frag",_u="elements",Ro="primitive",Cf="count",Yf="offset",Oh="instances",qf="vao",qp="Width",Kp="Height",El=yu+qp,yc=yu+Kp,Af=Ps+qp,Lh=Ps+Kp,Hl="drawingBuffer",Bs=Hl+qp,Y=Hl+Kp,qr=[ys,Iu,_s,Ju,Yc,xl,Ps,wf,wo],Wl=34962,Qp=34963,us=35632,_c=35633,Kc=3553,Kf=34067,xc=2884,el=3042,lp=3024,$o=2960,Dh=2929,Fh=3089,Qc=32823,Qf=32926,Jf=32928,Bh=5126,eh=35664,Xl=35665,Jc=35666,th=5124,Tf=35667,$l=35668,Nh=35669,rh=35670,zh=35671,Sl=35672,Mf=35673,ou=35674,nh=35675,ih=35676,ah=35678,ef=35680,wl=4,xu=1028,tf=1029,Jp=2304,cp=2305,rf=32775,Ru=32776,ed=519,bu=7680,oh=0,Zh=1,kf=32774,tl=513,fp=36160,hp=36064,Eu={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},sh=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],bc={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Ec={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},td={frag:us,vert:_c},pp={cw:Jp,ccw:cp};function Uh(V){return Array.isArray(V)||ne(V)||es(V)}function uh(V){return V.sort(function(ke,Ke){return ke===Ps?-1:Ke===Ps?1:ke<Ke?-1:1})}function ya(V,ke,Ke,ir){this.thisDep=V,this.contextDep=ke,this.propDep=Ke,this.append=ir}function Yl(V){return V&&!(V.thisDep||V.contextDep||V.propDep)}function zo(V){return new ya(!1,!1,!1,V)}function su(V,ke){var Ke=V.type;if(Ke===ci){var ir=V.data.length;return new ya(!0,ir>=1,ir>=2,ke)}else if(Ke===So){var Ar=V.data;return new ya(Ar.thisDep,Ar.contextDep,Ar.propDep,ke)}else{if(Ke===Bo)return new ya(!1,!1,!1,ke);if(Ke===Ja){for(var tr=!1,xr=!1,Pr=!1,zr=0;zr<V.data.length;++zr){var Gr=V.data[zr];if(Gr.type===oi)Pr=!0;else if(Gr.type===Po)xr=!0;else if(Gr.type===Qa)tr=!0;else if(Gr.type===ci){tr=!0;var Yr=Gr.data;Yr>=1&&(xr=!0),Yr>=2&&(Pr=!0)}else Gr.type===So&&(tr=tr||Gr.data.thisDep,xr=xr||Gr.data.contextDep,Pr=Pr||Gr.data.propDep)}return new ya(tr,xr,Pr,ke)}else return new ya(Ke===Qa,Ke===Po,Ke===oi,ke)}}var zd=new ya(!1,!1,!1,function(){});function rd(V,ke,Ke,ir,Ar,tr,xr,Pr,zr,Gr,Yr,Kr,hn,Vr,Xr){var Pt=Gr.Record,pr={add:32774,subtract:32778,"reverse subtract":32779};Ke.ext_blend_minmax&&(pr.min=rf,pr.max=Ru);var jr=Ke.angle_instanced_arrays,ln=Ke.webgl_draw_buffers,Mr=Ke.oes_vertex_array_object,Jr={dirty:!0,profile:Xr.profile},gn={},ei=[],_r={},Sr={};function Nn(Le){return Le.replace(".","_")}function pn(Le,be,st){var Lt=Nn(Le);ei.push(Le),gn[Lt]=Jr[Lt]=!!st,_r[Lt]=be}function Wr(Le,be,st){var Lt=Nn(Le);ei.push(Le),Array.isArray(st)?(Jr[Lt]=st.slice(),gn[Lt]=st.slice()):Jr[Lt]=gn[Lt]=st,Sr[Lt]=be}pn(yo,lp),pn(Fs,el),Wr(No,"blendColor",[0,0,0,0]),Wr(Iu,"blendEquationSeparate",[kf,kf]),Wr(ys,"blendFuncSeparate",[Zh,oh,Zh,oh]),pn(mu,Dh,!0),Wr(au,"depthFunc",tl),Wr(gl,"depthRange",[0,1]),Wr(jl,"depthMask",!0),Wr(ss,ss,[!0,!0,!0,!0]),pn(yl,xc),Wr($c,"cullFace",tf),Wr(gu,gu,cp),Wr(mc,mc,1),pn(Gu,Qc),Wr(wo,"polygonOffset",[0,0]),pn(Pu,Qf),pn(_l,Jf),Wr(xl,"sampleCoverage",[1,!1]),pn(da,$o),Wr(Xs,"stencilMask",-1),Wr(_s,"stencilFunc",[ed,0,-1]),Wr(Ju,"stencilOpSeparate",[xu,bu,bu,bu]),Wr(Yc,"stencilOpSeparate",[tf,bu,bu,bu]),pn(qc,Fh),Wr(wf,"scissor",[0,0,V.drawingBufferWidth,V.drawingBufferHeight]),Wr(Ps,Ps,[0,0,V.drawingBufferWidth,V.drawingBufferHeight]);var cn={gl:V,context:hn,strings:ke,next:gn,current:Jr,draw:Kr,elements:tr,buffer:Ar,shader:Yr,attributes:Gr.state,vao:Gr,uniforms:zr,framebuffer:Pr,extensions:Ke,timer:Vr,isBufferArgs:Uh},yn={primTypes:Er,compareFuncs:bc,blendFuncs:Eu,blendEquations:pr,stencilOps:Ec,glTypes:cu,orientationType:pp};Z.optional(function(){cn.isArrayLike=go}),ln&&(yn.backBuffer=[tf],yn.drawBuffer=at(ir.maxDrawbuffers,function(Le){return Le===0?[0]:at(Le,function(be){return hp+be})}));var Ii=0;function Si(){var Le=wi(),be=Le.link,st=Le.global;Le.id=Ii++,Le.batchId="0";var Lt=be(cn),Kt=Le.shared={props:"a0"};Object.keys(cn).forEach(function(it){Kt[it]=st.def(Lt,".",it)}),Z.optional(function(){Le.CHECK=be(Z),Le.commandStr=Z.guessCommand(),Le.command=be(Le.commandStr),Le.assert=function(it,Be,Dt){it("if(!(",Be,"))",this.CHECK,".commandRaise(",be(Dt),",",this.command,");")},yn.invalidBlendCombinations=sh});var vt=Le.next={},qe=Le.current={};Object.keys(Sr).forEach(function(it){Array.isArray(Jr[it])&&(vt[it]=st.def(Kt.next,".",it),qe[it]=st.def(Kt.current,".",it))});var Et=Le.constants={};Object.keys(yn).forEach(function(it){Et[it]=st.def(JSON.stringify(yn[it]))}),Le.invoke=function(it,Be){switch(Be.type){case ci:var Dt=["this",Kt.context,Kt.props,Le.batchId];return it.def(be(Be.data),".call(",Dt.slice(0,Math.max(Be.data.length+1,4)),")");case oi:return it.def(Kt.props,Be.data);case Po:return it.def(Kt.context,Be.data);case Qa:return it.def("this",Be.data);case So:return Be.data.append(Le,it),Be.data.ref;case Bo:return Be.data.toString();case Ja:return Be.data.map(function(Wt){return Le.invoke(it,Wt)})}},Le.attribCache={};var Ie={};return Le.scopeAttrib=function(it){var Be=ke.id(it);if(Be in Ie)return Ie[Be];var Dt=Gr.scope[Be];Dt||(Dt=Gr.scope[Be]=new Pt);var Wt=Ie[Be]=be(Dt);return Wt},Le}function fn(Le){var be=Le.static,st=Le.dynamic,Lt;if(Gl in be){var Kt=!!be[Gl];Lt=zo(function(qe,Et){return Kt}),Lt.enable=Kt}else if(Gl in st){var vt=st[Gl];Lt=su(vt,function(qe,Et){return qe.invoke(Et,vt)})}return Lt}function xn(Le,be){var st=Le.static,Lt=Le.dynamic;if(yu in st){var Kt=st[yu];return Kt?(Kt=Pr.getFramebuffer(Kt),Z.command(Kt,"invalid framebuffer object"),zo(function(qe,Et){var Ie=qe.link(Kt),it=qe.shared;Et.set(it.framebuffer,".next",Ie);var Be=it.context;return Et.set(Be,"."+El,Ie+".width"),Et.set(Be,"."+yc,Ie+".height"),Ie})):zo(function(qe,Et){var Ie=qe.shared;Et.set(Ie.framebuffer,".next","null");var it=Ie.context;return Et.set(it,"."+El,it+"."+Bs),Et.set(it,"."+yc,it+"."+Y),"null"})}else if(yu in Lt){var vt=Lt[yu];return su(vt,function(qe,Et){var Ie=qe.invoke(Et,vt),it=qe.shared,Be=it.framebuffer,Dt=Et.def(Be,".getFramebuffer(",Ie,")");Z.optional(function(){qe.assert(Et,"!"+Ie+"||"+Dt,"invalid framebuffer object")}),Et.set(Be,".next",Dt);var Wt=it.context;return Et.set(Wt,"."+El,Dt+"?"+Dt+".width:"+Wt+"."+Bs),Et.set(Wt,"."+yc,Dt+"?"+Dt+".height:"+Wt+"."+Y),Dt})}else return null}function fi(Le,be,st){var Lt=Le.static,Kt=Le.dynamic;function vt(Ie){if(Ie in Lt){var it=Lt[Ie];Z.commandType(it,"object","invalid "+Ie,st.commandStr);var Be=!0,Dt=it.x|0,Wt=it.y|0,kr,sn;return"width"in it?(kr=it.width|0,Z.command(kr>=0,"invalid "+Ie,st.commandStr)):Be=!1,"height"in it?(sn=it.height|0,Z.command(sn>=0,"invalid "+Ie,st.commandStr)):Be=!1,new ya(!Be&&be&&be.thisDep,!Be&&be&&be.contextDep,!Be&&be&&be.propDep,function(an,Un){var Sn=an.shared.context,zn=kr;"width"in it||(zn=Un.def(Sn,".",El,"-",Dt));var Bn=sn;return"height"in it||(Bn=Un.def(Sn,".",yc,"-",Wt)),[Dt,Wt,zn,Bn]})}else if(Ie in Kt){var un=Kt[Ie],bn=su(un,function(an,Un){var Sn=an.invoke(Un,un);Z.optional(function(){an.assert(Un,Sn+"&&typeof "+Sn+'==="object"',"invalid "+Ie)});var zn=an.shared.context,Bn=Un.def(Sn,".x|0"),On=Un.def(Sn,".y|0"),hi=Un.def('"width" in ',Sn,"?",Sn,".width|0:","(",zn,".",El,"-",Bn,")"),Ma=Un.def('"height" in ',Sn,"?",Sn,".height|0:","(",zn,".",yc,"-",On,")");return Z.optional(function(){an.assert(Un,hi+">=0&&"+Ma+">=0","invalid "+Ie)}),[Bn,On,hi,Ma]});return be&&(bn.thisDep=bn.thisDep||be.thisDep,bn.contextDep=bn.contextDep||be.contextDep,bn.propDep=bn.propDep||be.propDep),bn}else return be?new ya(be.thisDep,be.contextDep,be.propDep,function(an,Un){var Sn=an.shared.context;return[0,0,Un.def(Sn,".",El),Un.def(Sn,".",yc)]}):null}var qe=vt(Ps);if(qe){var Et=qe;qe=new ya(qe.thisDep,qe.contextDep,qe.propDep,function(Ie,it){var Be=Et.append(Ie,it),Dt=Ie.shared.context;return it.set(Dt,"."+Af,Be[2]),it.set(Dt,"."+Lh,Be[3]),Be})}return{viewport:qe,scissor_box:vt(wf)}}function Ci(Le,be){var st=Le.static,Lt=typeof st[gc]=="string"&&typeof st[bl]=="string";if(Lt){if(Object.keys(be.dynamic).length>0)return null;var Kt=be.static,vt=Object.keys(Kt);if(vt.length>0&&typeof Kt[vt[0]]=="number"){for(var qe=[],Et=0;Et<vt.length;++Et)Z(typeof Kt[vt[Et]]=="number","must specify all vertex attribute locations when using vaos"),qe.push([Kt[vt[Et]]|0,vt[Et]]);return qe}}return null}function Vi(Le,be,st){var Lt=Le.static,Kt=Le.dynamic;function vt(Be){if(Be in Lt){var Dt=ke.id(Lt[Be]);Z.optional(function(){Yr.shader(td[Be],Dt,Z.guessCommand())});var Wt=zo(function(){return Dt});return Wt.id=Dt,Wt}else if(Be in Kt){var kr=Kt[Be];return su(kr,function(sn,un){var bn=sn.invoke(un,kr),an=un.def(sn.shared.strings,".id(",bn,")");return Z.optional(function(){un(sn.shared.shader,".shader(",td[Be],",",an,",",sn.command,");")}),an})}return null}var qe=vt(gc),Et=vt(bl),Ie=null,it;return Yl(qe)&&Yl(Et)?(Ie=Yr.program(Et.id,qe.id,null,st),it=zo(function(Be,Dt){return Be.link(Ie)})):it=new ya(qe&&qe.thisDep||Et&&Et.thisDep,qe&&qe.contextDep||Et&&Et.contextDep,qe&&qe.propDep||Et&&Et.propDep,function(Be,Dt){var Wt=Be.shared.shader,kr;qe?kr=qe.append(Be,Dt):kr=Dt.def(Wt,".",gc);var sn;Et?sn=Et.append(Be,Dt):sn=Dt.def(Wt,".",bl);var un=Wt+".program("+sn+","+kr;return Z.optional(function(){un+=","+Be.command}),Dt.def(un+")")}),{frag:qe,vert:Et,progVar:it,program:Ie}}function oo(Le,be){var st=Le.static,Lt=Le.dynamic,Kt={},vt=!1;function qe(){if(qf in st){var Un=st[qf];return Un!==null&&Gr.getVAO(Un)===null&&(Un=Gr.createVAO(Un)),vt=!0,Kt.vao=Un,zo(function(zn){var Bn=Gr.getVAO(Un);return Bn?zn.link(Bn):"null"})}else if(qf in Lt){vt=!0;var Sn=Lt[qf];return su(Sn,function(zn,Bn){var On=zn.invoke(Bn,Sn);return Bn.def(zn.shared.vao+".getVAO("+On+")")})}return null}var Et=qe(),Ie=!1;function it(){if(_u in st){var Un=st[_u];if(Kt.elements=Un,Uh(Un)){var Sn=Kt.elements=tr.create(Un,!0);Un=tr.getElements(Sn),Ie=!0}else Un&&(Un=tr.getElements(Un),Ie=!0,Z.command(Un,"invalid elements",be.commandStr));var zn=zo(function(On,hi){if(Un){var Ma=On.link(Un);return On.ELEMENTS=Ma,Ma}return On.ELEMENTS=null,null});return zn.value=Un,zn}else if(_u in Lt){Ie=!0;var Bn=Lt[_u];return su(Bn,function(On,hi){var Ma=On.shared,Za=Ma.isBufferArgs,Ga=Ma.elements,xa=On.invoke(hi,Bn),ql=hi.def("null"),Qr=hi.def(Za,"(",xa,")"),rl=On.cond(Qr).then(ql,"=",Ga,".createStream(",xa,");").else(ql,"=",Ga,".getElements(",xa,");");return Z.optional(function(){On.assert(rl.else,"!"+xa+"||"+ql,"invalid elements")}),hi.entry(rl),hi.exit(On.cond(Qr).then(Ga,".destroyStream(",ql,");")),On.ELEMENTS=ql,ql})}else if(vt)return new ya(Et.thisDep,Et.contextDep,Et.propDep,function(On,hi){return hi.def(On.shared.vao+".currentVAO?"+On.shared.elements+".getElements("+On.shared.vao+".currentVAO.elements):null")});return null}var Be=it();function Dt(){if(Ro in st){var Un=st[Ro];return Kt.primitive=Un,Z.commandParameter(Un,Er,"invalid primitve",be.commandStr),zo(function(zn,Bn){return Er[Un]})}else if(Ro in Lt){var Sn=Lt[Ro];return su(Sn,function(zn,Bn){var On=zn.constants.primTypes,hi=zn.invoke(Bn,Sn);return Z.optional(function(){zn.assert(Bn,hi+" in "+On,"invalid primitive, must be one of "+Object.keys(Er))}),Bn.def(On,"[",hi,"]")})}else{if(Ie)return Yl(Be)?Be.value?zo(function(zn,Bn){return Bn.def(zn.ELEMENTS,".primType")}):zo(function(){return wl}):new ya(Be.thisDep,Be.contextDep,Be.propDep,function(zn,Bn){var On=zn.ELEMENTS;return Bn.def(On,"?",On,".primType:",wl)});if(vt)return new ya(Et.thisDep,Et.contextDep,Et.propDep,function(zn,Bn){return Bn.def(zn.shared.vao+".currentVAO?"+zn.shared.vao+".currentVAO.primitive:"+wl)})}return null}function Wt(Un,Sn){if(Un in st){var zn=st[Un]|0;return Sn?Kt.offset=zn:Kt.instances=zn,Z.command(!Sn||zn>=0,"invalid "+Un,be.commandStr),zo(function(On,hi){return Sn&&(On.OFFSET=zn),zn})}else if(Un in Lt){var Bn=Lt[Un];return su(Bn,function(On,hi){var Ma=On.invoke(hi,Bn);return Sn&&(On.OFFSET=Ma,Z.optional(function(){On.assert(hi,Ma+">=0","invalid "+Un)})),Ma})}else if(Sn){if(Ie)return zo(function(On,hi){return On.OFFSET=0,0});if(vt)return new ya(Et.thisDep,Et.contextDep,Et.propDep,function(On,hi){return hi.def(On.shared.vao+".currentVAO?"+On.shared.vao+".currentVAO.offset:0")})}else if(vt)return new ya(Et.thisDep,Et.contextDep,Et.propDep,function(On,hi){return hi.def(On.shared.vao+".currentVAO?"+On.shared.vao+".currentVAO.instances:-1")});return null}var kr=Wt(Yf,!0);function sn(){if(Cf in st){var Un=st[Cf]|0;return Kt.count=Un,Z.command(typeof Un=="number"&&Un>=0,"invalid vertex count",be.commandStr),zo(function(){return Un})}else if(Cf in Lt){var Sn=Lt[Cf];return su(Sn,function(hi,Ma){var Za=hi.invoke(Ma,Sn);return Z.optional(function(){hi.assert(Ma,"typeof "+Za+'==="number"&&'+Za+">=0&&"+Za+"===("+Za+"|0)","invalid vertex count")}),Za})}else if(Ie)if(Yl(Be)){if(Be)return kr?new ya(kr.thisDep,kr.contextDep,kr.propDep,function(hi,Ma){var Za=Ma.def(hi.ELEMENTS,".vertCount-",hi.OFFSET);return Z.optional(function(){hi.assert(Ma,Za+">=0","invalid vertex offset/element buffer too small")}),Za}):zo(function(hi,Ma){return Ma.def(hi.ELEMENTS,".vertCount")});var zn=zo(function(){return-1});return Z.optional(function(){zn.MISSING=!0}),zn}else{var Bn=new ya(Be.thisDep||kr.thisDep,Be.contextDep||kr.contextDep,Be.propDep||kr.propDep,function(hi,Ma){var Za=hi.ELEMENTS;return hi.OFFSET?Ma.def(Za,"?",Za,".vertCount-",hi.OFFSET,":-1"):Ma.def(Za,"?",Za,".vertCount:-1")});return Z.optional(function(){Bn.DYNAMIC=!0}),Bn}else if(vt){var On=new ya(Et.thisDep,Et.contextDep,Et.propDep,function(hi,Ma){return Ma.def(hi.shared.vao,".currentVAO?",hi.shared.vao,".currentVAO.count:-1")});return On}return null}var un=Dt(),bn=sn(),an=Wt(Oh,!1);return{elements:Be,primitive:un,count:bn,instances:an,offset:kr,vao:Et,vaoActive:vt,elementsActive:Ie,static:Kt}}function Pa(Le,be){var st=Le.static,Lt=Le.dynamic,Kt={};return ei.forEach(function(vt){var qe=Nn(vt);function Et(Ie,it){if(vt in st){var Be=Ie(st[vt]);Kt[qe]=zo(function(){return Be})}else if(vt in Lt){var Dt=Lt[vt];Kt[qe]=su(Dt,function(Wt,kr){return it(Wt,kr,Wt.invoke(kr,Dt))})}}switch(vt){case yl:case Fs:case yo:case da:case mu:case qc:case Gu:case Pu:case _l:case jl:return Et(function(Ie){return Z.commandType(Ie,"boolean",vt,be.commandStr),Ie},function(Ie,it,Be){return Z.optional(function(){Ie.assert(it,"typeof "+Be+'==="boolean"',"invalid flag "+vt,Ie.commandStr)}),Be});case au:return Et(function(Ie){return Z.commandParameter(Ie,bc,"invalid "+vt,be.commandStr),bc[Ie]},function(Ie,it,Be){var Dt=Ie.constants.compareFuncs;return Z.optional(function(){Ie.assert(it,Be+" in "+Dt,"invalid "+vt+", must be one of "+Object.keys(bc))}),it.def(Dt,"[",Be,"]")});case gl:return Et(function(Ie){return Z.command(go(Ie)&&Ie.length===2&&typeof Ie[0]=="number"&&typeof Ie[1]=="number"&&Ie[0]<=Ie[1],"depth range is 2d array",be.commandStr),Ie},function(Ie,it,Be){Z.optional(function(){Ie.assert(it,Ie.shared.isArrayLike+"("+Be+")&&"+Be+".length===2&&typeof "+Be+'[0]==="number"&&typeof '+Be+'[1]==="number"&&'+Be+"[0]<="+Be+"[1]","depth range must be a 2d array")});var Dt=it.def("+",Be,"[0]"),Wt=it.def("+",Be,"[1]");return[Dt,Wt]});case ys:return Et(function(Ie){Z.commandType(Ie,"object","blend.func",be.commandStr);var it="srcRGB"in Ie?Ie.srcRGB:Ie.src,Be="srcAlpha"in Ie?Ie.srcAlpha:Ie.src,Dt="dstRGB"in Ie?Ie.dstRGB:Ie.dst,Wt="dstAlpha"in Ie?Ie.dstAlpha:Ie.dst;return Z.commandParameter(it,Eu,qe+".srcRGB",be.commandStr),Z.commandParameter(Be,Eu,qe+".srcAlpha",be.commandStr),Z.commandParameter(Dt,Eu,qe+".dstRGB",be.commandStr),Z.commandParameter(Wt,Eu,qe+".dstAlpha",be.commandStr),Z.command(sh.indexOf(it+", "+Dt)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+it+", "+Dt+")",be.commandStr),[Eu[it],Eu[Dt],Eu[Be],Eu[Wt]]},function(Ie,it,Be){var Dt=Ie.constants.blendFuncs;Z.optional(function(){Ie.assert(it,Be+"&&typeof "+Be+'==="object"',"invalid blend func, must be an object")});function Wt(Sn,zn){var Bn=it.def('"',Sn,zn,'" in ',Be,"?",Be,".",Sn,zn,":",Be,".",Sn);return Z.optional(function(){Ie.assert(it,Bn+" in "+Dt,"invalid "+vt+"."+Sn+zn+", must be one of "+Object.keys(Eu))}),Bn}var kr=Wt("src","RGB"),sn=Wt("dst","RGB");Z.optional(function(){var Sn=Ie.constants.invalidBlendCombinations;Ie.assert(it,Sn+".indexOf("+kr+'+", "+'+sn+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var un=it.def(Dt,"[",kr,"]"),bn=it.def(Dt,"[",Wt("src","Alpha"),"]"),an=it.def(Dt,"[",sn,"]"),Un=it.def(Dt,"[",Wt("dst","Alpha"),"]");return[un,an,bn,Un]});case Iu:return Et(function(Ie){if(typeof Ie=="string")return Z.commandParameter(Ie,pr,"invalid "+vt,be.commandStr),[pr[Ie],pr[Ie]];if(typeof Ie=="object")return Z.commandParameter(Ie.rgb,pr,vt+".rgb",be.commandStr),Z.commandParameter(Ie.alpha,pr,vt+".alpha",be.commandStr),[pr[Ie.rgb],pr[Ie.alpha]];Z.commandRaise("invalid blend.equation",be.commandStr)},function(Ie,it,Be){var Dt=Ie.constants.blendEquations,Wt=it.def(),kr=it.def(),sn=Ie.cond("typeof ",Be,'==="string"');return Z.optional(function(){function un(bn,an,Un){Ie.assert(bn,Un+" in "+Dt,"invalid "+an+", must be one of "+Object.keys(pr))}un(sn.then,vt,Be),Ie.assert(sn.else,Be+"&&typeof "+Be+'==="object"',"invalid "+vt),un(sn.else,vt+".rgb",Be+".rgb"),un(sn.else,vt+".alpha",Be+".alpha")}),sn.then(Wt,"=",kr,"=",Dt,"[",Be,"];"),sn.else(Wt,"=",Dt,"[",Be,".rgb];",kr,"=",Dt,"[",Be,".alpha];"),it(sn),[Wt,kr]});case No:return Et(function(Ie){return Z.command(go(Ie)&&Ie.length===4,"blend.color must be a 4d array",be.commandStr),at(4,function(it){return+Ie[it]})},function(Ie,it,Be){return Z.optional(function(){Ie.assert(it,Ie.shared.isArrayLike+"("+Be+")&&"+Be+".length===4","blend.color must be a 4d array")}),at(4,function(Dt){return it.def("+",Be,"[",Dt,"]")})});case Xs:return Et(function(Ie){return Z.commandType(Ie,"number",qe,be.commandStr),Ie|0},function(Ie,it,Be){return Z.optional(function(){Ie.assert(it,"typeof "+Be+'==="number"',"invalid stencil.mask")}),it.def(Be,"|0")});case _s:return Et(function(Ie){Z.commandType(Ie,"object",qe,be.commandStr);var it=Ie.cmp||"keep",Be=Ie.ref||0,Dt="mask"in Ie?Ie.mask:-1;return Z.commandParameter(it,bc,vt+".cmp",be.commandStr),Z.commandType(Be,"number",vt+".ref",be.commandStr),Z.commandType(Dt,"number",vt+".mask",be.commandStr),[bc[it],Be,Dt]},function(Ie,it,Be){var Dt=Ie.constants.compareFuncs;Z.optional(function(){function un(){Ie.assert(it,Array.prototype.join.call(arguments,""),"invalid stencil.func")}un(Be+"&&typeof ",Be,'==="object"'),un('!("cmp" in ',Be,")||(",Be,".cmp in ",Dt,")")});var Wt=it.def('"cmp" in ',Be,"?",Dt,"[",Be,".cmp]",":",bu),kr=it.def(Be,".ref|0"),sn=it.def('"mask" in ',Be,"?",Be,".mask|0:-1");return[Wt,kr,sn]});case Ju:case Yc:return Et(function(Ie){Z.commandType(Ie,"object",qe,be.commandStr);var it=Ie.fail||"keep",Be=Ie.zfail||"keep",Dt=Ie.zpass||"keep";return Z.commandParameter(it,Ec,vt+".fail",be.commandStr),Z.commandParameter(Be,Ec,vt+".zfail",be.commandStr),Z.commandParameter(Dt,Ec,vt+".zpass",be.commandStr),[vt===Yc?tf:xu,Ec[it],Ec[Be],Ec[Dt]]},function(Ie,it,Be){var Dt=Ie.constants.stencilOps;Z.optional(function(){Ie.assert(it,Be+"&&typeof "+Be+'==="object"',"invalid "+vt)});function Wt(kr){return Z.optional(function(){Ie.assert(it,'!("'+kr+'" in '+Be+")||("+Be+"."+kr+" in "+Dt+")","invalid "+vt+"."+kr+", must be one of "+Object.keys(Ec))}),it.def('"',kr,'" in ',Be,"?",Dt,"[",Be,".",kr,"]:",bu)}return[vt===Yc?tf:xu,Wt("fail"),Wt("zfail"),Wt("zpass")]});case wo:return Et(function(Ie){Z.commandType(Ie,"object",qe,be.commandStr);var it=Ie.factor|0,Be=Ie.units|0;return Z.commandType(it,"number",qe+".factor",be.commandStr),Z.commandType(Be,"number",qe+".units",be.commandStr),[it,Be]},function(Ie,it,Be){Z.optional(function(){Ie.assert(it,Be+"&&typeof "+Be+'==="object"',"invalid "+vt)});var Dt=it.def(Be,".factor|0"),Wt=it.def(Be,".units|0");return[Dt,Wt]});case $c:return Et(function(Ie){var it=0;return Ie==="front"?it=xu:Ie==="back"&&(it=tf),Z.command(!!it,qe,be.commandStr),it},function(Ie,it,Be){return Z.optional(function(){Ie.assert(it,Be+'==="front"||'+Be+'==="back"',"invalid cull.face")}),it.def(Be,'==="front"?',xu,":",tf)});case mc:return Et(function(Ie){return Z.command(typeof Ie=="number"&&Ie>=ir.lineWidthDims[0]&&Ie<=ir.lineWidthDims[1],"invalid line width, must be a positive number between "+ir.lineWidthDims[0]+" and "+ir.lineWidthDims[1],be.commandStr),Ie},function(Ie,it,Be){return Z.optional(function(){Ie.assert(it,"typeof "+Be+'==="number"&&'+Be+">="+ir.lineWidthDims[0]+"&&"+Be+"<="+ir.lineWidthDims[1],"invalid line width")}),Be});case gu:return Et(function(Ie){return Z.commandParameter(Ie,pp,qe,be.commandStr),pp[Ie]},function(Ie,it,Be){return Z.optional(function(){Ie.assert(it,Be+'==="cw"||'+Be+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),it.def(Be+'==="cw"?'+Jp+":"+cp)});case ss:return Et(function(Ie){return Z.command(go(Ie)&&Ie.length===4,"color.mask must be length 4 array",be.commandStr),Ie.map(function(it){return!!it})},function(Ie,it,Be){return Z.optional(function(){Ie.assert(it,Ie.shared.isArrayLike+"("+Be+")&&"+Be+".length===4","invalid color.mask")}),at(4,function(Dt){return"!!"+Be+"["+Dt+"]"})});case xl:return Et(function(Ie){Z.command(typeof Ie=="object"&&Ie,qe,be.commandStr);var it="value"in Ie?Ie.value:1,Be=!!Ie.invert;return Z.command(typeof it=="number"&&it>=0&&it<=1,"sample.coverage.value must be a number between 0 and 1",be.commandStr),[it,Be]},function(Ie,it,Be){Z.optional(function(){Ie.assert(it,Be+"&&typeof "+Be+'==="object"',"invalid sample.coverage")});var Dt=it.def('"value" in ',Be,"?+",Be,".value:1"),Wt=it.def("!!",Be,".invert");return[Dt,Wt]})}}),Kt}function ji(Le,be){var st=Le.static,Lt=Le.dynamic,Kt={};return Object.keys(st).forEach(function(vt){var qe=st[vt],Et;if(typeof qe=="number"||typeof qe=="boolean")Et=zo(function(){return qe});else if(typeof qe=="function"){var Ie=qe._reglType;Ie==="texture2d"||Ie==="textureCube"?Et=zo(function(it){return it.link(qe)}):Ie==="framebuffer"||Ie==="framebufferCube"?(Z.command(qe.color.length>0,'missing color attachment for framebuffer sent to uniform "'+vt+'"',be.commandStr),Et=zo(function(it){return it.link(qe.color[0])})):Z.commandRaise('invalid data for uniform "'+vt+'"',be.commandStr)}else go(qe)?Et=zo(function(it){var Be=it.global.def("[",at(qe.length,function(Dt){return Z.command(typeof qe[Dt]=="number"||typeof qe[Dt]=="boolean","invalid uniform "+vt,it.commandStr),qe[Dt]}),"]");return Be}):Z.commandRaise('invalid or missing data for uniform "'+vt+'"',be.commandStr);Et.value=qe,Kt[vt]=Et}),Object.keys(Lt).forEach(function(vt){var qe=Lt[vt];Kt[vt]=su(qe,function(Et,Ie){return Et.invoke(Ie,qe)})}),Kt}function is(Le,be){var st=Le.static,Lt=Le.dynamic,Kt={};return Object.keys(st).forEach(function(vt){var qe=st[vt],Et=ke.id(vt),Ie=new Pt;if(Uh(qe))Ie.state=ui,Ie.buffer=Ar.getBuffer(Ar.create(qe,Wl,!1,!0)),Ie.type=0;else{var it=Ar.getBuffer(qe);if(it)Ie.state=ui,Ie.buffer=it,Ie.type=0;else if(Z.command(typeof qe=="object"&&qe,"invalid data for attribute "+vt,be.commandStr),"constant"in qe){var Be=qe.constant;Ie.buffer="null",Ie.state=Mi,typeof Be=="number"?Ie.x=Be:(Z.command(go(Be)&&Be.length>0&&Be.length<=4,"invalid constant for attribute "+vt,be.commandStr),Ti.forEach(function(an,Un){Un<Be.length&&(Ie[an]=Be[Un])}))}else{Uh(qe.buffer)?it=Ar.getBuffer(Ar.create(qe.buffer,Wl,!1,!0)):it=Ar.getBuffer(qe.buffer),Z.command(!!it,'missing buffer for attribute "'+vt+'"',be.commandStr);var Dt=qe.offset|0;Z.command(Dt>=0,'invalid offset for attribute "'+vt+'"',be.commandStr);var Wt=qe.stride|0;Z.command(Wt>=0&&Wt<256,'invalid stride for attribute "'+vt+'", must be integer betweeen [0, 255]',be.commandStr);var kr=qe.size|0;Z.command(!("size"in qe)||kr>0&&kr<=4,'invalid size for attribute "'+vt+'", must be 1,2,3,4',be.commandStr);var sn=!!qe.normalized,un=0;"type"in qe&&(Z.commandParameter(qe.type,cu,"invalid type for attribute "+vt,be.commandStr),un=cu[qe.type]);var bn=qe.divisor|0;Z.optional(function(){"divisor"in qe&&(Z.command(bn===0||jr,'cannot specify divisor for attribute "'+vt+'", instancing not supported',be.commandStr),Z.command(bn>=0,'invalid divisor for attribute "'+vt+'"',be.commandStr));var an=be.commandStr,Un=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(qe).forEach(function(Sn){Z.command(Un.indexOf(Sn)>=0,'unknown parameter "'+Sn+'" for attribute pointer "'+vt+'" (valid parameters are '+Un+")",an)})}),Ie.buffer=it,Ie.state=ui,Ie.size=kr,Ie.normalized=sn,Ie.type=un||it.dtype,Ie.offset=Dt,Ie.stride=Wt,Ie.divisor=bn}}Kt[vt]=zo(function(an,Un){var Sn=an.attribCache;if(Et in Sn)return Sn[Et];var zn={isStream:!1};return Object.keys(Ie).forEach(function(Bn){zn[Bn]=Ie[Bn]}),Ie.buffer&&(zn.buffer=an.link(Ie.buffer),zn.type=zn.type||zn.buffer+".dtype"),Sn[Et]=zn,zn})}),Object.keys(Lt).forEach(function(vt){var qe=Lt[vt];function Et(Ie,it){var Be=Ie.invoke(it,qe),Dt=Ie.shared,Wt=Ie.constants,kr=Dt.isBufferArgs,sn=Dt.buffer;Z.optional(function(){Ie.assert(it,Be+"&&(typeof "+Be+'==="object"||typeof '+Be+'==="function")&&('+kr+"("+Be+")||"+sn+".getBuffer("+Be+")||"+sn+".getBuffer("+Be+".buffer)||"+kr+"("+Be+'.buffer)||("constant" in '+Be+"&&(typeof "+Be+'.constant==="number"||'+Dt.isArrayLike+"("+Be+".constant))))",'invalid dynamic attribute "'+vt+'"')});var un={isStream:it.def(!1)},bn=new Pt;bn.state=ui,Object.keys(bn).forEach(function(zn){un[zn]=it.def(""+bn[zn])});var an=un.buffer,Un=un.type;it("if(",kr,"(",Be,")){",un.isStream,"=true;",an,"=",sn,".createStream(",Wl,",",Be,");",Un,"=",an,".dtype;","}else{",an,"=",sn,".getBuffer(",Be,");","if(",an,"){",Un,"=",an,".dtype;",'}else if("constant" in ',Be,"){",un.state,"=",Mi,";","if(typeof "+Be+'.constant === "number"){',un[Ti[0]],"=",Be,".constant;",Ti.slice(1).map(function(zn){return un[zn]}).join("="),"=0;","}else{",Ti.map(function(zn,Bn){return un[zn]+"="+Be+".constant.length>"+Bn+"?"+Be+".constant["+Bn+"]:0;"}).join(""),"}}else{","if(",kr,"(",Be,".buffer)){",an,"=",sn,".createStream(",Wl,",",Be,".buffer);","}else{",an,"=",sn,".getBuffer(",Be,".buffer);","}",Un,'="type" in ',Be,"?",Wt.glTypes,"[",Be,".type]:",an,".dtype;",un.normalized,"=!!",Be,".normalized;");function Sn(zn){it(un[zn],"=",Be,".",zn,"|0;")}return Sn("size"),Sn("offset"),Sn("stride"),Sn("divisor"),it("}}"),it.exit("if(",un.isStream,"){",sn,".destroyStream(",an,");","}"),un}Kt[vt]=su(qe,Et)}),Kt}function Xa(Le){var be=Le.static,st=Le.dynamic,Lt={};return Object.keys(be).forEach(function(Kt){var vt=be[Kt];Lt[Kt]=zo(function(qe,Et){return typeof vt=="number"||typeof vt=="boolean"?""+vt:qe.link(vt)})}),Object.keys(st).forEach(function(Kt){var vt=st[Kt];Lt[Kt]=su(vt,function(qe,Et){return qe.invoke(Et,vt)})}),Lt}function Zo(Le,be,st,Lt,Kt){var vt=Le.static,qe=Le.dynamic;Z.optional(function(){var Sn=[yu,bl,gc,_u,Ro,Yf,Cf,Oh,Gl,qf].concat(ei);function zn(Bn){Object.keys(Bn).forEach(function(On){Z.command(Sn.indexOf(On)>=0,'unknown parameter "'+On+'"',Kt.commandStr)})}zn(vt),zn(qe)});var Et=Ci(Le,be),Ie=xn(Le,Kt),it=fi(Le,Ie,Kt),Be=oo(Le,Kt),Dt=Pa(Le,Kt),Wt=Vi(Le,Kt,Et);function kr(Sn){var zn=it[Sn];zn&&(Dt[Sn]=zn)}kr(Ps),kr(Nn(wf));var sn=Object.keys(Dt).length>0,un={framebuffer:Ie,draw:Be,shader:Wt,state:Dt,dirty:sn,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(un.profile=fn(Le,Kt),un.uniforms=ji(st,Kt),un.drawVAO=un.scopeVAO=Be.vao,!un.drawVAO&&Wt.program&&!Et&&Ke.angle_instanced_arrays&&Be.static.elements){var bn=!0,an=Wt.program.attributes.map(function(Sn){var zn=be.static[Sn];return bn=bn&&!!zn,zn});if(bn&&an.length>0){var Un=Gr.getVAO(Gr.createVAO({attributes:an,elements:Be.static.elements}));un.drawVAO=new ya(null,null,null,function(Sn,zn){return Sn.link(Un)}),un.useVAO=!0}}return Et?un.useVAO=!0:un.attributes=is(be,Kt),un.context=Xa(Lt,Kt),un}function _o(Le,be,st){var Lt=Le.shared,Kt=Lt.context,vt=Le.scope();Object.keys(st).forEach(function(qe){be.save(Kt,"."+qe);var Et=st[qe],Ie=Et.append(Le,be);Array.isArray(Ie)?vt(Kt,".",qe,"=[",Ie.join(),"];"):vt(Kt,".",qe,"=",Ie,";")}),be(vt)}function as(Le,be,st,Lt){var Kt=Le.shared,vt=Kt.gl,qe=Kt.framebuffer,Et;ln&&(Et=be.def(Kt.extensions,".webgl_draw_buffers"));var Ie=Le.constants,it=Ie.drawBuffer,Be=Ie.backBuffer,Dt;st?Dt=st.append(Le,be):Dt=be.def(qe,".next"),Lt||be("if(",Dt,"!==",qe,".cur){"),be("if(",Dt,"){",vt,".bindFramebuffer(",fp,",",Dt,".framebuffer);"),ln&&be(Et,".drawBuffersWEBGL(",it,"[",Dt,".colorAttachments.length]);"),be("}else{",vt,".bindFramebuffer(",fp,",null);"),ln&&be(Et,".drawBuffersWEBGL(",Be,");"),be("}",qe,".cur=",Dt,";"),Lt||be("}")}function Yo(Le,be,st){var Lt=Le.shared,Kt=Lt.gl,vt=Le.current,qe=Le.next,Et=Lt.current,Ie=Lt.next,it=Le.cond(Et,".dirty");ei.forEach(function(Be){var Dt=Nn(Be);if(!(Dt in st.state)){var Wt,kr;if(Dt in qe){Wt=qe[Dt],kr=vt[Dt];var sn=at(Jr[Dt].length,function(bn){return it.def(Wt,"[",bn,"]")});it(Le.cond(sn.map(function(bn,an){return bn+"!=="+kr+"["+an+"]"}).join("||")).then(Kt,".",Sr[Dt],"(",sn,");",sn.map(function(bn,an){return kr+"["+an+"]="+bn}).join(";"),";"))}else{Wt=it.def(Ie,".",Dt);var un=Le.cond(Wt,"!==",Et,".",Dt);it(un),Dt in _r?un(Le.cond(Wt).then(Kt,".enable(",_r[Dt],");").else(Kt,".disable(",_r[Dt],");"),Et,".",Dt,"=",Wt,";"):un(Kt,".",Sr[Dt],"(",Wt,");",Et,".",Dt,"=",Wt,";")}}}),Object.keys(st.state).length===0&&it(Et,".dirty=false;"),be(it)}function xs(Le,be,st,Lt){var Kt=Le.shared,vt=Le.current,qe=Kt.current,Et=Kt.gl;uh(Object.keys(st)).forEach(function(Ie){var it=st[Ie];if(!(Lt&&!Lt(it))){var Be=it.append(Le,be);if(_r[Ie]){var Dt=_r[Ie];Yl(it)?Be?be(Et,".enable(",Dt,");"):be(Et,".disable(",Dt,");"):be(Le.cond(Be).then(Et,".enable(",Dt,");").else(Et,".disable(",Dt,");")),be(qe,".",Ie,"=",Be,";")}else if(go(Be)){var Wt=vt[Ie];be(Et,".",Sr[Ie],"(",Be,");",Be.map(function(kr,sn){return Wt+"["+sn+"]="+kr}).join(";"),";")}else be(Et,".",Sr[Ie],"(",Be,");",qe,".",Ie,"=",Be,";")}})}function po(Le,be){jr&&(Le.instancing=be.def(Le.shared.extensions,".angle_instanced_arrays"))}function Pi(Le,be,st,Lt,Kt){var vt=Le.shared,qe=Le.stats,Et=vt.current,Ie=vt.timer,it=st.profile;function Be(){var Sn=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return Sn||typeof performance=="undefined"?"Date.now()":"performance.now()"}var Dt,Wt;function kr(Sn){Dt=be.def(),Sn(Dt,"=",Be(),";"),typeof Kt=="string"?Sn(qe,".count+=",Kt,";"):Sn(qe,".count++;"),Vr&&(Lt?(Wt=be.def(),Sn(Wt,"=",Ie,".getNumPendingQueries();")):Sn(Ie,".beginQuery(",qe,");"))}function sn(Sn){Sn(qe,".cpuTime+=",Be(),"-",Dt,";"),Vr&&(Lt?Sn(Ie,".pushScopeStats(",Wt,",",Ie,".getNumPendingQueries(),",qe,");"):Sn(Ie,".endQuery();"))}function un(Sn){var zn=be.def(Et,".profile");be(Et,".profile=",Sn,";"),be.exit(Et,".profile=",zn,";")}var bn;if(it){if(Yl(it)){it.enable?(kr(be),sn(be.exit),un("true")):un("false");return}bn=it.append(Le,be),un(bn)}else bn=be.def(Et,".profile");var an=Le.block();kr(an),be("if(",bn,"){",an,"}");var Un=Le.block();sn(Un),be.exit("if(",bn,"){",Un,"}")}function Uo(Le,be,st,Lt,Kt){var vt=Le.shared;function qe(Ie){switch(Ie){case eh:case Tf:case zh:return 2;case Xl:case $l:case Sl:return 3;case Jc:case Nh:case Mf:return 4;default:return 1}}function Et(Ie,it,Be){var Dt=vt.gl,Wt=be.def(Ie,".location"),kr=be.def(vt.attributes,"[",Wt,"]"),sn=Be.state,un=Be.buffer,bn=[Be.x,Be.y,Be.z,Be.w],an=["buffer","normalized","offset","stride"];function Un(){be("if(!",kr,".buffer){",Dt,".enableVertexAttribArray(",Wt,");}");var zn=Be.type,Bn;if(Be.size?Bn=be.def(Be.size,"||",it):Bn=it,be("if(",kr,".type!==",zn,"||",kr,".size!==",Bn,"||",an.map(function(hi){return kr+"."+hi+"!=="+Be[hi]}).join("||"),"){",Dt,".bindBuffer(",Wl,",",un,".buffer);",Dt,".vertexAttribPointer(",[Wt,Bn,zn,Be.normalized,Be.stride,Be.offset],");",kr,".type=",zn,";",kr,".size=",Bn,";",an.map(function(hi){return kr+"."+hi+"="+Be[hi]+";"}).join(""),"}"),jr){var On=Be.divisor;be("if(",kr,".divisor!==",On,"){",Le.instancing,".vertexAttribDivisorANGLE(",[Wt,On],");",kr,".divisor=",On,";}")}}function Sn(){be("if(",kr,".buffer){",Dt,".disableVertexAttribArray(",Wt,");",kr,".buffer=null;","}if(",Ti.map(function(zn,Bn){return kr+"."+zn+"!=="+bn[Bn]}).join("||"),"){",Dt,".vertexAttrib4f(",Wt,",",bn,");",Ti.map(function(zn,Bn){return kr+"."+zn+"="+bn[Bn]+";"}).join(""),"}")}sn===ui?Un():sn===Mi?Sn():(be("if(",sn,"===",ui,"){"),Un(),be("}else{"),Sn(),be("}"))}Lt.forEach(function(Ie){var it=Ie.name,Be=st.attributes[it],Dt;if(Be){if(!Kt(Be))return;Dt=Be.append(Le,be)}else{if(!Kt(zd))return;var Wt=Le.scopeAttrib(it);Z.optional(function(){Le.assert(be,Wt+".state","missing attribute "+it)}),Dt={},Object.keys(new Pt).forEach(function(kr){Dt[kr]=be.def(Wt,".",kr)})}Et(Le.link(Ie),qe(Ie.info.type),Dt)})}function aa(Le,be,st,Lt,Kt,vt){for(var qe=Le.shared,Et=qe.gl,Ie,it=0;it<Lt.length;++it){var Be=Lt[it],Dt=Be.name,Wt=Be.info.type,kr=st.uniforms[Dt],sn=Le.link(Be),un=sn+".location",bn;if(kr){if(!Kt(kr))continue;if(Yl(kr)){var an=kr.value;if(Z.command(an!==null&&typeof an!="undefined",'missing uniform "'+Dt+'"',Le.commandStr),Wt===ah||Wt===ef){Z.command(typeof an=="function"&&(Wt===ah&&(an._reglType==="texture2d"||an._reglType==="framebuffer")||Wt===ef&&(an._reglType==="textureCube"||an._reglType==="framebufferCube")),"invalid texture for uniform "+Dt,Le.commandStr);var Un=Le.link(an._texture||an.color[0]._texture);be(Et,".uniform1i(",un,",",Un+".bind());"),be.exit(Un,".unbind();")}else if(Wt===ou||Wt===nh||Wt===ih){Z.optional(function(){Z.command(go(an),"invalid matrix for uniform "+Dt,Le.commandStr),Z.command(Wt===ou&&an.length===4||Wt===nh&&an.length===9||Wt===ih&&an.length===16,"invalid length for matrix uniform "+Dt,Le.commandStr)});var Sn=Le.global.def("new Float32Array(["+Array.prototype.slice.call(an)+"])"),zn=2;Wt===nh?zn=3:Wt===ih&&(zn=4),be(Et,".uniformMatrix",zn,"fv(",un,",false,",Sn,");")}else{switch(Wt){case Bh:Z.commandType(an,"number","uniform "+Dt,Le.commandStr),Ie="1f";break;case eh:Z.command(go(an)&&an.length===2,"uniform "+Dt,Le.commandStr),Ie="2f";break;case Xl:Z.command(go(an)&&an.length===3,"uniform "+Dt,Le.commandStr),Ie="3f";break;case Jc:Z.command(go(an)&&an.length===4,"uniform "+Dt,Le.commandStr),Ie="4f";break;case rh:Z.commandType(an,"boolean","uniform "+Dt,Le.commandStr),Ie="1i";break;case th:Z.commandType(an,"number","uniform "+Dt,Le.commandStr),Ie="1i";break;case zh:Z.command(go(an)&&an.length===2,"uniform "+Dt,Le.commandStr),Ie="2i";break;case Tf:Z.command(go(an)&&an.length===2,"uniform "+Dt,Le.commandStr),Ie="2i";break;case Sl:Z.command(go(an)&&an.length===3,"uniform "+Dt,Le.commandStr),Ie="3i";break;case $l:Z.command(go(an)&&an.length===3,"uniform "+Dt,Le.commandStr),Ie="3i";break;case Mf:Z.command(go(an)&&an.length===4,"uniform "+Dt,Le.commandStr),Ie="4i";break;case Nh:Z.command(go(an)&&an.length===4,"uniform "+Dt,Le.commandStr),Ie="4i";break}be(Et,".uniform",Ie,"(",un,",",go(an)?Array.prototype.slice.call(an):an,");")}continue}else bn=kr.append(Le,be)}else{if(!Kt(zd))continue;bn=be.def(qe.uniforms,"[",ke.id(Dt),"]")}Wt===ah?(Z(!Array.isArray(bn),"must specify a scalar prop for textures"),be("if(",bn,"&&",bn,'._reglType==="framebuffer"){',bn,"=",bn,".color[0];","}")):Wt===ef&&(Z(!Array.isArray(bn),"must specify a scalar prop for cube maps"),be("if(",bn,"&&",bn,'._reglType==="framebufferCube"){',bn,"=",bn,".color[0];","}")),Z.optional(function(){function Qr(Lu,Kl){Le.assert(be,Lu,'bad data or missing for uniform "'+Dt+'".  '+Kl)}function rl(Lu){Z(!Array.isArray(bn),"must not specify an array type for uniform"),Qr("typeof "+bn+'==="'+Lu+'"',"invalid type, expected "+Lu)}function Yt(Lu,Kl){Array.isArray(bn)?Z(bn.length===Lu,"must have length "+Lu):Qr(qe.isArrayLike+"("+bn+")&&"+bn+".length==="+Lu,"invalid vector, should have length "+Lu,Le.commandStr)}function gp(Lu){Z(!Array.isArray(bn),"must not specify a value type"),Qr("typeof "+bn+'==="function"&&'+bn+'._reglType==="texture'+(Lu===Kc?"2d":"Cube")+'"',"invalid texture type",Le.commandStr)}switch(Wt){case th:rl("number");break;case Tf:Yt(2,"number");break;case $l:Yt(3,"number");break;case Nh:Yt(4,"number");break;case Bh:rl("number");break;case eh:Yt(2,"number");break;case Xl:Yt(3,"number");break;case Jc:Yt(4,"number");break;case rh:rl("boolean");break;case zh:Yt(2,"boolean");break;case Sl:Yt(3,"boolean");break;case Mf:Yt(4,"boolean");break;case ou:Yt(4,"number");break;case nh:Yt(9,"number");break;case ih:Yt(16,"number");break;case ah:gp(Kc);break;case ef:gp(Kf);break}});var Bn=1;switch(Wt){case ah:case ef:var On=be.def(bn,"._texture");be(Et,".uniform1i(",un,",",On,".bind());"),be.exit(On,".unbind();");continue;case th:case rh:Ie="1i";break;case Tf:case zh:Ie="2i",Bn=2;break;case $l:case Sl:Ie="3i",Bn=3;break;case Nh:case Mf:Ie="4i",Bn=4;break;case Bh:Ie="1f";break;case eh:Ie="2f",Bn=2;break;case Xl:Ie="3f",Bn=3;break;case Jc:Ie="4f",Bn=4;break;case ou:Ie="Matrix2fv";break;case nh:Ie="Matrix3fv";break;case ih:Ie="Matrix4fv";break}if(Ie.charAt(0)==="M"){be(Et,".uniform",Ie,"(",un,",");var hi=Math.pow(Wt-ou+2,2),Ma=Le.global.def("new Float32Array(",hi,")");Array.isArray(bn)?be("false,(",at(hi,function(Qr){return Ma+"["+Qr+"]="+bn[Qr]}),",",Ma,")"):be("false,(Array.isArray(",bn,")||",bn," instanceof Float32Array)?",bn,":(",at(hi,function(Qr){return Ma+"["+Qr+"]="+bn+"["+Qr+"]"}),",",Ma,")"),be(");")}else if(Bn>1){for(var Za=[],Ga=[],xa=0;xa<Bn;++xa)Array.isArray(bn)?Ga.push(bn[xa]):Ga.push(be.def(bn+"["+xa+"]")),vt&&Za.push(be.def());vt&&be("if(!",Le.batchId,"||",Za.map(function(Qr,rl){return Qr+"!=="+Ga[rl]}).join("||"),"){",Za.map(function(Qr,rl){return Qr+"="+Ga[rl]+";"}).join("")),be(Et,".uniform",Ie,"(",un,",",Ga.join(","),");"),vt&&be("}")}else{if(Z(!Array.isArray(bn),"uniform value must not be an array"),vt){var ql=be.def();be("if(!",Le.batchId,"||",ql,"!==",bn,"){",ql,"=",bn,";")}be(Et,".uniform",Ie,"(",un,",",bn,");"),vt&&be("}")}}}function ls(Le,be,st,Lt){var Kt=Le.shared,vt=Kt.gl,qe=Kt.draw,Et=Lt.draw;function Ie(){var Bn=Et.elements,On,hi=be;return Bn?((Bn.contextDep&&Lt.contextDynamic||Bn.propDep)&&(hi=st),On=Bn.append(Le,hi),Et.elementsActive&&hi("if("+On+")"+vt+".bindBuffer("+Qp+","+On+".buffer.buffer);")):(On=hi.def(),hi(On,"=",qe,".",_u,";","if(",On,"){",vt,".bindBuffer(",Qp,",",On,".buffer.buffer);}","else if(",Kt.vao,".currentVAO){",On,"=",Le.shared.elements+".getElements("+Kt.vao,".currentVAO.elements);",Mr?"":"if("+On+")"+vt+".bindBuffer("+Qp+","+On+".buffer.buffer);","}")),On}function it(){var Bn=Et.count,On,hi=be;return Bn?((Bn.contextDep&&Lt.contextDynamic||Bn.propDep)&&(hi=st),On=Bn.append(Le,hi),Z.optional(function(){Bn.MISSING&&Le.assert(be,"false","missing vertex count"),Bn.DYNAMIC&&Le.assert(hi,On+">=0","missing vertex count")})):(On=hi.def(qe,".",Cf),Z.optional(function(){Le.assert(hi,On+">=0","missing vertex count")})),On}var Be=Ie();function Dt(Bn){var On=Et[Bn];return On?On.contextDep&&Lt.contextDynamic||On.propDep?On.append(Le,st):On.append(Le,be):be.def(qe,".",Bn)}var Wt=Dt(Ro),kr=Dt(Yf),sn=it();if(typeof sn=="number"){if(sn===0)return}else st("if(",sn,"){"),st.exit("}");var un,bn;jr&&(un=Dt(Oh),bn=Le.instancing);var an=Be+".type",Un=Et.elements&&Yl(Et.elements)&&!Et.vaoActive;function Sn(){function Bn(){st(bn,".drawElementsInstancedANGLE(",[Wt,sn,an,kr+"<<(("+an+"-"+yi+")>>1)",un],");")}function On(){st(bn,".drawArraysInstancedANGLE(",[Wt,kr,sn,un],");")}Be&&Be!=="null"?Un?Bn():(st("if(",Be,"){"),Bn(),st("}else{"),On(),st("}")):On()}function zn(){function Bn(){st(vt+".drawElements("+[Wt,sn,an,kr+"<<(("+an+"-"+yi+")>>1)"]+");")}function On(){st(vt+".drawArrays("+[Wt,kr,sn]+");")}Be&&Be!=="null"?Un?Bn():(st("if(",Be,"){"),Bn(),st("}else{"),On(),st("}")):On()}jr&&(typeof un!="number"||un>=0)?typeof un=="string"?(st("if(",un,">0){"),Sn(),st("}else if(",un,"<0){"),zn(),st("}")):Sn():zn()}function _i(Le,be,st,Lt,Kt){var vt=Si(),qe=vt.proc("body",Kt);return Z.optional(function(){vt.commandStr=be.commandStr,vt.command=vt.link(be.commandStr)}),jr&&(vt.instancing=qe.def(vt.shared.extensions,".angle_instanced_arrays")),Le(vt,qe,st,Lt),vt.compile().body}function Ni(Le,be,st,Lt){po(Le,be),st.useVAO?st.drawVAO?be(Le.shared.vao,".setVAO(",st.drawVAO.append(Le,be),");"):be(Le.shared.vao,".setVAO(",Le.shared.vao,".targetVAO);"):(be(Le.shared.vao,".setVAO(null);"),Uo(Le,be,st,Lt.attributes,function(){return!0})),aa(Le,be,st,Lt.uniforms,function(){return!0},!1),ls(Le,be,be,st)}function _a(Le,be){var st=Le.proc("draw",1);po(Le,st),_o(Le,st,be.context),as(Le,st,be.framebuffer),Yo(Le,st,be),xs(Le,st,be.state),Pi(Le,st,be,!1,!0);var Lt=be.shader.progVar.append(Le,st);if(st(Le.shared.gl,".useProgram(",Lt,".program);"),be.shader.program)Ni(Le,st,be,be.shader.program);else{st(Le.shared.vao,".setVAO(null);");var Kt=Le.global.def("{}"),vt=st.def(Lt,".id"),qe=st.def(Kt,"[",vt,"]");st(Le.cond(qe).then(qe,".call(this,a0);").else(qe,"=",Kt,"[",vt,"]=",Le.link(function(Et){return _i(Ni,Le,be,Et,1)}),"(",Lt,");",qe,".call(this,a0);"))}Object.keys(be.state).length>0&&st(Le.shared.current,".dirty=true;"),Le.shared.vao&&st(Le.shared.vao,".setVAO(null);")}function Oo(Le,be,st,Lt){Le.batchId="a1",po(Le,be);function Kt(){return!0}Uo(Le,be,st,Lt.attributes,Kt),aa(Le,be,st,Lt.uniforms,Kt,!1),ls(Le,be,be,st)}function Ou(Le,be,st,Lt){po(Le,be);var Kt=st.contextDep,vt=be.def(),qe="a0",Et="a1",Ie=be.def();Le.shared.props=Ie,Le.batchId=vt;var it=Le.scope(),Be=Le.scope();be(it.entry,"for(",vt,"=0;",vt,"<",Et,";++",vt,"){",Ie,"=",qe,"[",vt,"];",Be,"}",it.exit);function Dt(an){return an.contextDep&&Kt||an.propDep}function Wt(an){return!Dt(an)}if(st.needsContext&&_o(Le,Be,st.context),st.needsFramebuffer&&as(Le,Be,st.framebuffer),xs(Le,Be,st.state,Dt),st.profile&&Dt(st.profile)&&Pi(Le,Be,st,!1,!0),Lt)st.useVAO?st.drawVAO?Dt(st.drawVAO)?Be(Le.shared.vao,".setVAO(",st.drawVAO.append(Le,Be),");"):it(Le.shared.vao,".setVAO(",st.drawVAO.append(Le,it),");"):it(Le.shared.vao,".setVAO(",Le.shared.vao,".targetVAO);"):(it(Le.shared.vao,".setVAO(null);"),Uo(Le,it,st,Lt.attributes,Wt),Uo(Le,Be,st,Lt.attributes,Dt)),aa(Le,it,st,Lt.uniforms,Wt,!1),aa(Le,Be,st,Lt.uniforms,Dt,!0),ls(Le,it,Be,st);else{var kr=Le.global.def("{}"),sn=st.shader.progVar.append(Le,Be),un=Be.def(sn,".id"),bn=Be.def(kr,"[",un,"]");Be(Le.shared.gl,".useProgram(",sn,".program);","if(!",bn,"){",bn,"=",kr,"[",un,"]=",Le.link(function(an){return _i(Oo,Le,st,an,2)}),"(",sn,");}",bn,".call(this,a0[",vt,"],",vt,");")}}function Ue(Le,be){var st=Le.proc("batch",2);Le.batchId="0",po(Le,st);var Lt=!1,Kt=!0;Object.keys(be.context).forEach(function(kr){Lt=Lt||be.context[kr].propDep}),Lt||(_o(Le,st,be.context),Kt=!1);var vt=be.framebuffer,qe=!1;vt?(vt.propDep?Lt=qe=!0:vt.contextDep&&Lt&&(qe=!0),qe||as(Le,st,vt)):as(Le,st,null),be.state.viewport&&be.state.viewport.propDep&&(Lt=!0);function Et(kr){return kr.contextDep&&Lt||kr.propDep}Yo(Le,st,be),xs(Le,st,be.state,function(kr){return!Et(kr)}),(!be.profile||!Et(be.profile))&&Pi(Le,st,be,!1,"a1"),be.contextDep=Lt,be.needsContext=Kt,be.needsFramebuffer=qe;var Ie=be.shader.progVar;if(Ie.contextDep&&Lt||Ie.propDep)Ou(Le,st,be,null);else{var it=Ie.append(Le,st);if(st(Le.shared.gl,".useProgram(",it,".program);"),be.shader.program)Ou(Le,st,be,be.shader.program);else{st(Le.shared.vao,".setVAO(null);");var Be=Le.global.def("{}"),Dt=st.def(it,".id"),Wt=st.def(Be,"[",Dt,"]");st(Le.cond(Wt).then(Wt,".call(this,a0,a1);").else(Wt,"=",Be,"[",Dt,"]=",Le.link(function(kr){return _i(Ou,Le,be,kr,2)}),"(",it,");",Wt,".call(this,a0,a1);"))}}Object.keys(be.state).length>0&&st(Le.shared.current,".dirty=true;"),Le.shared.vao&&st(Le.shared.vao,".setVAO(null);")}function cr(Le,be){var st=Le.proc("scope",3);Le.batchId="a2";var Lt=Le.shared,Kt=Lt.current;_o(Le,st,be.context),be.framebuffer&&be.framebuffer.append(Le,st),uh(Object.keys(be.state)).forEach(function(qe){var Et=be.state[qe],Ie=Et.append(Le,st);go(Ie)?Ie.forEach(function(it,Be){st.set(Le.next[qe],"["+Be+"]",it)}):st.set(Lt.next,"."+qe,Ie)}),Pi(Le,st,be,!0,!0),[_u,Yf,Cf,Oh,Ro].forEach(function(qe){var Et=be.draw[qe];!Et||st.set(Lt.draw,"."+qe,""+Et.append(Le,st))}),Object.keys(be.uniforms).forEach(function(qe){var Et=be.uniforms[qe].append(Le,st);Array.isArray(Et)&&(Et="["+Et.join()+"]"),st.set(Lt.uniforms,"["+ke.id(qe)+"]",Et)}),Object.keys(be.attributes).forEach(function(qe){var Et=be.attributes[qe].append(Le,st),Ie=Le.scopeAttrib(qe);Object.keys(new Pt).forEach(function(it){st.set(Ie,"."+it,Et[it])})}),be.scopeVAO&&st.set(Lt.vao,".targetVAO",be.scopeVAO.append(Le,st));function vt(qe){var Et=be.shader[qe];Et&&st.set(Lt.shader,"."+qe,Et.append(Le,st))}vt(bl),vt(gc),Object.keys(be.state).length>0&&(st(Kt,".dirty=true;"),st.exit(Kt,".dirty=true;")),st("a1(",Le.shared.context,",a0,",Le.batchId,");")}function Ht(Le){if(!(typeof Le!="object"||go(Le))){for(var be=Object.keys(Le),st=0;st<be.length;++st)if(rn.isDynamic(Le[be[st]]))return!0;return!1}}function Rn(Le,be,st){var Lt=be.static[st];if(!Lt||!Ht(Lt))return;var Kt=Le.global,vt=Object.keys(Lt),qe=!1,Et=!1,Ie=!1,it=Le.global.def("{}");vt.forEach(function(Dt){var Wt=Lt[Dt];if(rn.isDynamic(Wt)){typeof Wt=="function"&&(Wt=Lt[Dt]=rn.unbox(Wt));var kr=su(Wt,null);qe=qe||kr.thisDep,Ie=Ie||kr.propDep,Et=Et||kr.contextDep}else{switch(Kt(it,".",Dt,"="),typeof Wt){case"number":Kt(Wt);break;case"string":Kt('"',Wt,'"');break;case"object":Array.isArray(Wt)&&Kt("[",Wt.join(),"]");break;default:Kt(Le.link(Wt));break}Kt(";")}});function Be(Dt,Wt){vt.forEach(function(kr){var sn=Lt[kr];if(!!rn.isDynamic(sn)){var un=Dt.invoke(Wt,sn);Wt(it,".",kr,"=",un,";")}})}be.dynamic[st]=new rn.DynamicVariable(So,{thisDep:qe,contextDep:Et,propDep:Ie,ref:it,append:Be}),delete be.static[st]}function Hi(Le,be,st,Lt,Kt){var vt=Si();vt.stats=vt.link(Kt),Object.keys(be.static).forEach(function(Et){Rn(vt,be,Et)}),qr.forEach(function(Et){Rn(vt,Le,Et)});var qe=Zo(Le,be,st,Lt,vt);return _a(vt,qe),cr(vt,qe),Ue(vt,qe),y(vt.compile(),{destroy:function(){qe.shader.program.destroy()}})}return{next:gn,current:Jr,procs:function(){var Le=Si(),be=Le.proc("poll"),st=Le.proc("refresh"),Lt=Le.block();be(Lt),st(Lt);var Kt=Le.shared,vt=Kt.gl,qe=Kt.next,Et=Kt.current;Lt(Et,".dirty=false;"),as(Le,be),as(Le,st,null,!0);var Ie;jr&&(Ie=Le.link(jr)),Ke.oes_vertex_array_object&&st(Le.link(Ke.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var it=0;it<ir.maxAttributes;++it){var Be=st.def(Kt.attributes,"[",it,"]"),Dt=Le.cond(Be,".buffer");Dt.then(vt,".enableVertexAttribArray(",it,");",vt,".bindBuffer(",Wl,",",Be,".buffer.buffer);",vt,".vertexAttribPointer(",it,",",Be,".size,",Be,".type,",Be,".normalized,",Be,".stride,",Be,".offset);").else(vt,".disableVertexAttribArray(",it,");",vt,".vertexAttrib4f(",it,",",Be,".x,",Be,".y,",Be,".z,",Be,".w);",Be,".buffer=null;"),st(Dt),jr&&st(Ie,".vertexAttribDivisorANGLE(",it,",",Be,".divisor);")}return st(Le.shared.vao,".currentVAO=null;",Le.shared.vao,".setVAO(",Le.shared.vao,".targetVAO);"),Object.keys(_r).forEach(function(Wt){var kr=_r[Wt],sn=Lt.def(qe,".",Wt),un=Le.block();un("if(",sn,"){",vt,".enable(",kr,")}else{",vt,".disable(",kr,")}",Et,".",Wt,"=",sn,";"),st(un),be("if(",sn,"!==",Et,".",Wt,"){",un,"}")}),Object.keys(Sr).forEach(function(Wt){var kr=Sr[Wt],sn=Jr[Wt],un,bn,an=Le.block();if(an(vt,".",kr,"("),go(sn)){var Un=sn.length;un=Le.global.def(qe,".",Wt),bn=Le.global.def(Et,".",Wt),an(at(Un,function(Sn){return un+"["+Sn+"]"}),");",at(Un,function(Sn){return bn+"["+Sn+"]="+un+"["+Sn+"];"}).join("")),be("if(",at(Un,function(Sn){return un+"["+Sn+"]!=="+bn+"["+Sn+"]"}).join("||"),"){",an,"}")}else un=Lt.def(qe,".",Wt),bn=Lt.def(Et,".",Wt),an(un,");",Et,".",Wt,"=",un,";"),be("if(",un,"!==",bn,"){",an,"}");st(an)}),Le.compile()}(),compile:Hi}}function lh(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Zd=34918,Ud=34919,Ns=35007,dp=function(V,ke){if(!ke.ext_disjoint_timer_query)return null;var Ke=[];function ir(){return Ke.pop()||ke.ext_disjoint_timer_query.createQueryEXT()}function Ar(jr){Ke.push(jr)}var tr=[];function xr(jr){var ln=ir();ke.ext_disjoint_timer_query.beginQueryEXT(Ns,ln),tr.push(ln),Vr(tr.length-1,tr.length,jr)}function Pr(){ke.ext_disjoint_timer_query.endQueryEXT(Ns)}function zr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var Gr=[];function Yr(){return Gr.pop()||new zr}function Kr(jr){Gr.push(jr)}var hn=[];function Vr(jr,ln,Mr){var Jr=Yr();Jr.startQueryIndex=jr,Jr.endQueryIndex=ln,Jr.sum=0,Jr.stats=Mr,hn.push(Jr)}var Xr=[],Pt=[];function pr(){var jr,ln,Mr=tr.length;if(Mr!==0){Pt.length=Math.max(Pt.length,Mr+1),Xr.length=Math.max(Xr.length,Mr+1),Xr[0]=0,Pt[0]=0;var Jr=0;for(jr=0,ln=0;ln<tr.length;++ln){var gn=tr[ln];ke.ext_disjoint_timer_query.getQueryObjectEXT(gn,Ud)?(Jr+=ke.ext_disjoint_timer_query.getQueryObjectEXT(gn,Zd),Ar(gn)):tr[jr++]=gn,Xr[ln+1]=Jr,Pt[ln+1]=jr}for(tr.length=jr,jr=0,ln=0;ln<hn.length;++ln){var ei=hn[ln],_r=ei.startQueryIndex,Sr=ei.endQueryIndex;ei.sum+=Xr[Sr]-Xr[_r];var Nn=Pt[_r],pn=Pt[Sr];pn===Nn?(ei.stats.gpuTime+=ei.sum/1e6,Kr(ei)):(ei.startQueryIndex=Nn,ei.endQueryIndex=pn,hn[jr++]=ei)}hn.length=jr}}return{beginQuery:xr,endQuery:Pr,pushScopeStats:Vr,update:pr,getNumPendingQueries:function(){return tr.length},clear:function(){Ke.push.apply(Ke,tr);for(var jr=0;jr<Ke.length;jr++)ke.ext_disjoint_timer_query.deleteQueryEXT(Ke[jr]);tr.length=0,Ke.length=0},restore:function(){tr.length=0,Ke.length=0}}},Vd=16384,ch=256,nd=1024,id=34962,fh="webglcontextlost",va="webglcontextrestored",vp=1,Cl=2,If=3;function mp(V,ke){for(var Ke=0;Ke<V.length;++Ke)if(V[Ke]===ke)return Ke;return-1}function jd(V){var ke=Me(V);if(!ke)return null;var Ke=ke.gl,ir=Ke.getContextAttributes(),Ar=Ke.isContextLost(),tr=Ve(Ke,ke);if(!tr)return null;var xr=Sa(),Pr=lh(),zr=tr.extensions,Gr=dp(Ke,zr),Yr=sa(),Kr=Ke.drawingBufferWidth,hn=Ke.drawingBufferHeight,Vr={tick:0,time:0,viewportWidth:Kr,viewportHeight:hn,framebufferWidth:Kr,framebufferHeight:hn,drawingBufferWidth:Kr,drawingBufferHeight:hn,pixelRatio:ke.pixelRatio},Xr={},Pt={elements:null,primitive:4,count:-1,offset:0,instances:-1},pr=Il(Ke,zr),jr=U(Ke,Pr,ke,Jr),ln=sl(Ke,zr,jr,Pr),Mr=Vt(Ke,zr,pr,Pr,jr,ln,Pt);function Jr(_i){return Mr.destroyBuffer(_i)}var gn=on(Ke,xr,Pr,ke),ei=Ds(Ke,zr,pr,function(){Nn.procs.poll()},Vr,Pr,ke),_r=vl(Ke,zr,pr,Pr,ke),Sr=We(Ke,zr,pr,ei,_r,Pr),Nn=rd(Ke,xr,zr,pr,jr,ln,ei,Sr,Xr,Mr,gn,Pt,Vr,Gr,ke),pn=ii(Ke,Sr,Nn.procs.poll,Vr,ir,zr,pr),Wr=Nn.next,cn=Ke.canvas,yn=[],Ii=[],Si=[],fn=[ke.onDestroy],xn=null;function fi(){if(yn.length===0){Gr&&Gr.update(),xn=null;return}xn=vi.next(fi),po();for(var _i=yn.length-1;_i>=0;--_i){var Ni=yn[_i];Ni&&Ni(Vr,null,0)}Ke.flush(),Gr&&Gr.update()}function Ci(){!xn&&yn.length>0&&(xn=vi.next(fi))}function Vi(){xn&&(vi.cancel(fi),xn=null)}function oo(_i){_i.preventDefault(),Ar=!0,Vi(),Ii.forEach(function(Ni){Ni()})}function Pa(_i){Ke.getError(),Ar=!1,tr.restore(),gn.restore(),jr.restore(),ei.restore(),_r.restore(),Sr.restore(),Mr.restore(),Gr&&Gr.restore(),Nn.procs.refresh(),Ci(),Si.forEach(function(Ni){Ni()})}var ji=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;!ji&&cn&&(cn.addEventListener(fh,oo,!1),cn.addEventListener(va,Pa,!1));function is(){yn.length=0,Vi(),!ji&&cn&&(cn.removeEventListener(fh,oo),cn.removeEventListener(va,Pa)),gn.clear(),Sr.clear(),_r.clear(),Mr.clear(),ei.clear(),ln.clear(),jr.clear(),Gr&&Gr.clear(),fn.forEach(function(_i){_i()})}function Xa(_i){Z(!!_i,"invalid args to regl({...})"),Z.type(_i,"object","invalid args to regl({...})");function Ni(vt){var qe=y({},vt);delete qe.uniforms,delete qe.attributes,delete qe.context,delete qe.vao,"stencil"in qe&&qe.stencil.op&&(qe.stencil.opBack=qe.stencil.opFront=qe.stencil.op,delete qe.stencil.op);function Et(Ie){if(Ie in qe){var it=qe[Ie];delete qe[Ie],Object.keys(it).forEach(function(Be){qe[Ie+"."+Be]=it[Be]})}}return Et("blend"),Et("depth"),Et("cull"),Et("stencil"),Et("polygonOffset"),Et("scissor"),Et("sample"),"vao"in vt&&(qe.vao=vt.vao),qe}function _a(vt,qe){var Et={},Ie={};return Object.keys(vt).forEach(function(it){var Be=vt[it];if(rn.isDynamic(Be)){Ie[it]=rn.unbox(Be,it);return}else if(qe&&Array.isArray(Be)){for(var Dt=0;Dt<Be.length;++Dt)if(rn.isDynamic(Be[Dt])){Ie[it]=rn.unbox(Be,it);return}}Et[it]=Be}),{dynamic:Ie,static:Et}}var Oo=_a(_i.context||{},!0),Ou=_a(_i.uniforms||{},!0),Ue=_a(_i.attributes||{},!1),cr=_a(Ni(_i),!1),Ht={gpuTime:0,cpuTime:0,count:0},Rn=Nn.compile(cr,Ue,Ou,Oo,Ht),Hi=Rn.draw,Le=Rn.batch,be=Rn.scope,st=[];function Lt(vt){for(;st.length<vt;)st.push(null);return st}function Kt(vt,qe){var Et;if(Ar&&Z.raise("context lost"),typeof vt=="function")return be.call(this,null,vt,0);if(typeof qe=="function")if(typeof vt=="number")for(Et=0;Et<vt;++Et)be.call(this,null,qe,Et);else if(Array.isArray(vt))for(Et=0;Et<vt.length;++Et)be.call(this,vt[Et],qe,Et);else return be.call(this,vt,qe,0);else if(typeof vt=="number"){if(vt>0)return Le.call(this,Lt(vt|0),vt|0)}else if(Array.isArray(vt)){if(vt.length)return Le.call(this,vt,vt.length)}else return Hi.call(this,vt)}return y(Kt,{stats:Ht,destroy:function(){Rn.destroy()}})}var Zo=Sr.setFBO=Xa({framebuffer:rn.define.call(null,vp,"framebuffer")});function _o(_i,Ni){var _a=0;Nn.procs.poll();var Oo=Ni.color;Oo&&(Ke.clearColor(+Oo[0]||0,+Oo[1]||0,+Oo[2]||0,+Oo[3]||0),_a|=Vd),"depth"in Ni&&(Ke.clearDepth(+Ni.depth),_a|=ch),"stencil"in Ni&&(Ke.clearStencil(Ni.stencil|0),_a|=nd),Z(!!_a,"called regl.clear with no buffer specified"),Ke.clear(_a)}function as(_i){if(Z(typeof _i=="object"&&_i,"regl.clear() takes an object as input"),"framebuffer"in _i)if(_i.framebuffer&&_i.framebuffer_reglType==="framebufferCube")for(var Ni=0;Ni<6;++Ni)Zo(y({framebuffer:_i.framebuffer.faces[Ni]},_i),_o);else Zo(_i,_o);else _o(null,_i)}function Yo(_i){Z.type(_i,"function","regl.frame() callback must be a function"),yn.push(_i);function Ni(){var _a=mp(yn,_i);Z(_a>=0,"cannot cancel a frame twice");function Oo(){var Ou=mp(yn,Oo);yn[Ou]=yn[yn.length-1],yn.length-=1,yn.length<=0&&Vi()}yn[_a]=Oo}return Ci(),{cancel:Ni}}function xs(){var _i=Wr.viewport,Ni=Wr.scissor_box;_i[0]=_i[1]=Ni[0]=Ni[1]=0,Vr.viewportWidth=Vr.framebufferWidth=Vr.drawingBufferWidth=_i[2]=Ni[2]=Ke.drawingBufferWidth,Vr.viewportHeight=Vr.framebufferHeight=Vr.drawingBufferHeight=_i[3]=Ni[3]=Ke.drawingBufferHeight}function po(){Vr.tick+=1,Vr.time=Uo(),xs(),Nn.procs.poll()}function Pi(){ei.refresh(),xs(),Nn.procs.refresh(),Gr&&Gr.update()}function Uo(){return(sa()-Yr)/1e3}Pi();function aa(_i,Ni){Z.type(Ni,"function","listener callback must be a function");var _a;switch(_i){case"frame":return Yo(Ni);case"lost":_a=Ii;break;case"restore":_a=Si;break;case"destroy":_a=fn;break;default:Z.raise("invalid event, must be one of frame,lost,restore,destroy")}return _a.push(Ni),{cancel:function(){for(var Oo=0;Oo<_a.length;++Oo)if(_a[Oo]===Ni){_a[Oo]=_a[_a.length-1],_a.pop();return}}}}var ls=y(Xa,{clear:as,prop:rn.define.bind(null,vp),context:rn.define.bind(null,Cl),this:rn.define.bind(null,If),draw:Xa({}),buffer:function(_i){return jr.create(_i,id,!1,!1)},elements:function(_i){return ln.create(_i,!1)},texture:ei.create2D,cube:ei.createCube,renderbuffer:_r.create,framebuffer:Sr.create,framebufferCube:Sr.createCube,vao:Mr.createVAO,attributes:ir,frame:Yo,on:aa,limits:pr,hasExtension:function(_i){return pr.extensions.indexOf(_i.toLowerCase())>=0},read:pn,destroy:is,_gl:Ke,_refresh:Pi,poll:function(){po(),Gr&&Gr.update()},now:Uo,stats:Pr});return ke.onDone(null,ls),ls}return jd})},44286:function(Br){function pe(K){return K.split("")}Br.exports=pe},18190:function(Br){var pe=9007199254740991,K=Math.floor;function Ee(ne,y){var Te="";if(!ne||y<1||y>pe)return Te;do y%2&&(Te+=ne),y=K(y/2),y&&(ne+=ne);while(y);return Te}Br.exports=Ee},14259:function(Br){function pe(K,Ee,ne){var y=-1,Te=K.length;Ee<0&&(Ee=-Ee>Te?0:Te+Ee),ne=ne>Te?Te:ne,ne<0&&(ne+=Te),Te=Ee>ne?0:ne-Ee>>>0,Ee>>>=0;for(var W=Array(Te);++y<Te;)W[y]=K[y+Ee];return W}Br.exports=pe},40180:function(Br,pe,K){var Ee=K(14259);function ne(y,Te,W){var ye=y.length;return W=W===void 0?ye:W,!Te&&W>=ye?y:Ee(y,Te,W)}Br.exports=ne},78302:function(Br,pe,K){var Ee=K(18190),ne=K(80531),y=K(40180),Te=K(62689),W=K(88016),ye=K(83140),se=Math.ceil;function Ye(_e,Qe){Qe=Qe===void 0?" ":ne(Qe);var lt=Qe.length;if(lt<2)return lt?Ee(Qe,_e):Qe;var bt=Ee(Qe,se(_e/W(Qe)));return Te(Qe)?y(ye(bt),0,_e).join(""):bt.slice(0,_e)}Br.exports=Ye},83140:function(Br,pe,K){var Ee=K(44286),ne=K(62689),y=K(676);function Te(W){return ne(W)?y(W):Ee(W)}Br.exports=Te},676:function(Br){var pe="\\ud800-\\udfff",K="\\u0300-\\u036f",Ee="\\ufe20-\\ufe2f",ne="\\u20d0-\\u20ff",y=K+Ee+ne,Te="\\ufe0e\\ufe0f",W="["+pe+"]",ye="["+y+"]",se="\\ud83c[\\udffb-\\udfff]",Ye="(?:"+ye+"|"+se+")",_e="[^"+pe+"]",Qe="(?:\\ud83c[\\udde6-\\uddff]){2}",lt="[\\ud800-\\udbff][\\udc00-\\udfff]",bt="\\u200d",gt=Ye+"?",ur="["+Te+"]?",Mt="(?:"+bt+"(?:"+[_e,Qe,lt].join("|")+")"+ur+gt+")*",qt=ur+gt+Mt,zt="(?:"+[_e+ye+"?",ye,Qe,lt,W].join("|")+")",yt=RegExp(se+"(?="+se+")|"+zt+qt,"g");function At(ar){return ar.match(yt)||[]}Br.exports=At},11726:function(Br,pe,K){var Ee=K(78302),ne=K(88016),y=K(40554),Te=K(79833);function W(ye,se,Ye){ye=Te(ye),se=y(se);var _e=se?ne(ye):0;return se&&_e<se?ye+Ee(se-_e,Ye):ye}Br.exports=W},32475:function(Br,pe,K){var Ee=K(78302),ne=K(88016),y=K(40554),Te=K(79833);function W(ye,se,Ye){ye=Te(ye),se=y(se);var _e=se?ne(ye):0;return se&&_e<se?Ee(se-_e,Ye)+ye:ye}Br.exports=W},6158:function(Br){(function(pe,K){Br.exports=K()})(this,function(){"use strict";var pe,K,Ee;function ne(y,Te){if(!pe)pe=Te;else if(!K)K=Te;else{var W="var sharedChunk = {}; ("+pe+")(sharedChunk); ("+K+")(sharedChunk);",ye={};pe(ye),Ee=Te(ye),typeof window!="undefined"&&(Ee.workerUrl=window.URL.createObjectURL(new Blob([W],{type:"text/javascript"})))}}return ne(["exports"],function(y){"use strict";function Te(a,s){return a(s={exports:{}},s.exports),s.exports}var W=ye;function ye(a,s,c,m){this.cx=3*a,this.bx=3*(c-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(m-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=m,this.p2x=c,this.p2y=m}ye.prototype.sampleCurveX=function(a){return((this.ax*a+this.bx)*a+this.cx)*a},ye.prototype.sampleCurveY=function(a){return((this.ay*a+this.by)*a+this.cy)*a},ye.prototype.sampleCurveDerivativeX=function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},ye.prototype.solveCurveX=function(a,s){var c,m,_,S,A;for(s===void 0&&(s=1e-6),_=a,A=0;A<8;A++){if(S=this.sampleCurveX(_)-a,Math.abs(S)<s)return _;var P=this.sampleCurveDerivativeX(_);if(Math.abs(P)<1e-6)break;_-=S/P}if((_=a)<(c=0))return c;if(_>(m=1))return m;for(;c<m;){if(S=this.sampleCurveX(_),Math.abs(S-a)<s)return _;a>S?c=_:m=_,_=.5*(m-c)+c}return _},ye.prototype.solve=function(a,s){return this.sampleCurveY(this.solveCurveX(a,s))};var se=Ye;function Ye(a,s){this.x=a,this.y=s}Ye.prototype={clone:function(){return new Ye(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,s){return this.clone()._rotateAround(a,s)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var s=a.x-this.x,c=a.y-this.y;return s*s+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,s){return Math.atan2(this.x*s-this.y*a,this.x*a+this.y*s)},_matMult:function(a){var s=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=s,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var s=Math.cos(a),c=Math.sin(a),m=c*this.x+s*this.y;return this.x=s*this.x-c*this.y,this.y=m,this},_rotateAround:function(a,s){var c=Math.cos(a),m=Math.sin(a),_=s.y+m*(this.x-s.x)+c*(this.y-s.y);return this.x=s.x+c*(this.x-s.x)-m*(this.y-s.y),this.y=_,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ye.convert=function(a){return a instanceof Ye?a:Array.isArray(a)?new Ye(a[0],a[1]):a};var _e=typeof self!="undefined"?self:{},Qe=Math.pow(2,53)-1;function lt(a,s,c,m){var _=new W(a,s,c,m);return function(S){return _.solve(S)}}var bt=lt(.25,.1,.25,1);function gt(a,s,c){return Math.min(c,Math.max(s,a))}function ur(a,s,c){var m=c-s,_=((a-s)%m+m)%m+s;return _===s?c:_}function Mt(a){for(var s=[],c=arguments.length-1;c-- >0;)s[c]=arguments[c+1];for(var m=0,_=s;m<_.length;m+=1){var S=_[m];for(var A in S)a[A]=S[A]}return a}var qt=1;function zt(){return qt++}function yt(){return function a(s){return s?(s^16*Math.random()>>s/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()}function At(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function ar(a,s){a.forEach(function(c){s[c]&&(s[c]=s[c].bind(s))})}function J(a,s){return a.indexOf(s,a.length-s.length)!==-1}function Qt(a,s,c){var m={};for(var _ in a)m[_]=s.call(c||this,a[_],_,a);return m}function Ct(a,s,c){var m={};for(var _ in a)s.call(c||this,a[_],_,a)&&(m[_]=a[_]);return m}function ft(a){return Array.isArray(a)?a.map(ft):typeof a=="object"&&a?Qt(a,ft):a}var Ut={};function dt(a){Ut[a]||(typeof console!="undefined"&&console.warn(a),Ut[a]=!0)}function rr(a,s,c){return(c.y-a.y)*(s.x-a.x)>(s.y-a.y)*(c.x-a.x)}function wr(a){for(var s=0,c=0,m=a.length,_=m-1,S=void 0,A=void 0;c<m;_=c++)s+=((A=a[_]).x-(S=a[c]).x)*(S.y+A.y);return s}function re(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Fe(a){var s={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(m,_,S,A){var P=S||A;return s[_]=!P||P.toLowerCase(),""}),s["max-age"]){var c=parseInt(s["max-age"],10);isNaN(c)?delete s["max-age"]:s["max-age"]=c}return s}var N=null;function z(a){if(N==null){var s=a.navigator?a.navigator.userAgent:null;N=!!a.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return N}function ce(a){try{var s=_e[a];return s.setItem("_mapbox_test_",1),s.removeItem("_mapbox_test_"),!0}catch(c){return!1}}var ze,et,ht,Rt,Jt=_e.performance&&_e.performance.now?_e.performance.now.bind(_e.performance):Date.now.bind(Date),Or=_e.requestAnimationFrame||_e.mozRequestAnimationFrame||_e.webkitRequestAnimationFrame||_e.msRequestAnimationFrame,Tr=_e.cancelAnimationFrame||_e.mozCancelAnimationFrame||_e.webkitCancelAnimationFrame||_e.msCancelAnimationFrame,Pn={now:Jt,frame:function(a){var s=Or(a);return{cancel:function(){return Tr(s)}}},getImageData:function(a,s){s===void 0&&(s=0);var c=_e.document.createElement("canvas"),m=c.getContext("2d");if(!m)throw new Error("failed to create canvas 2d context");return c.width=a.width,c.height=a.height,m.drawImage(a,0,0,a.width,a.height),m.getImageData(-s,-s,a.width+2*s,a.height+2*s)},resolveURL:function(a){return ze||(ze=_e.document.createElement("a")),ze.href=a,ze.href},hardwareConcurrency:_e.navigator&&_e.navigator.hardwareConcurrency||4,get devicePixelRatio(){return _e.devicePixelRatio},get prefersReducedMotion(){return!!_e.matchMedia&&(et==null&&(et=_e.matchMedia("(prefers-reduced-motion: reduce)")),et.matches)}},Nr={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},wn={supported:!1,testSupport:function(a){!Xi&&Rt&&(mi?si(a):ht=a)}},Xi=!1,mi=!1;function si(a){var s=a.createTexture();a.bindTexture(a.TEXTURE_2D,s);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,Rt),a.isContextLost())return;wn.supported=!0}catch(c){}a.deleteTexture(s),Xi=!0}_e.document&&((Rt=_e.document.createElement("img")).onload=function(){ht&&si(ht),ht=null,mi=!0},Rt.onerror=function(){Xi=!0,ht=null},Rt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var ki="01",bi=function(a,s){this._transformRequestFn=a,this._customAccessToken=s,this._createSkuToken()};function li(a){return a.indexOf("mapbox:")===0}bi.prototype._createSkuToken=function(){var a=function(){for(var s="",c=0;c<10;c++)s+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ki,s].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt},bi.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},bi.prototype.transformRequest=function(a,s){return this._transformRequestFn&&this._transformRequestFn(a,s)||{url:a}},bi.prototype.normalizeStyleURL=function(a,s){if(!li(a))return a;var c=ka(a);return c.path="/styles/v1"+c.path,this._makeAPIURL(c,this._customAccessToken||s)},bi.prototype.normalizeGlyphsURL=function(a,s){if(!li(a))return a;var c=ka(a);return c.path="/fonts/v1"+c.path,this._makeAPIURL(c,this._customAccessToken||s)},bi.prototype.normalizeSourceURL=function(a,s){if(!li(a))return a;var c=ka(a);return c.path="/v4/"+c.authority+".json",c.params.push("secure"),this._makeAPIURL(c,this._customAccessToken||s)},bi.prototype.normalizeSpriteURL=function(a,s,c,m){var _=ka(a);return li(a)?(_.path="/styles/v1"+_.path+"/sprite"+s+c,this._makeAPIURL(_,this._customAccessToken||m)):(_.path+=""+s+c,oa(_))},bi.prototype.normalizeTileURL=function(a,s){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!li(a))return a;var c=ka(a);c.path=c.path.replace(/(\.(png|jpg)\d*)(?=$)/,(Pn.devicePixelRatio>=2||s===512?"@2x":"")+(wn.supported?".webp":"$1")),c.path=c.path.replace(/^.+\/v4\//,"/"),c.path="/v4"+c.path;var m=this._customAccessToken||function(_){for(var S=0,A=_;S<A.length;S+=1){var P=A[S].match(/^access_token=(.*)$/);if(P)return P[1]}return null}(c.params)||Nr.ACCESS_TOKEN;return Nr.REQUIRE_ACCESS_TOKEN&&m&&this._skuToken&&c.params.push("sku="+this._skuToken),this._makeAPIURL(c,m)},bi.prototype.canonicalizeTileURL=function(a,s){var c=ka(a);if(!c.path.match(/(^\/v4\/)/)||!c.path.match(/\.[\w]+$/))return a;var m="mapbox://tiles/";m+=c.path.replace("/v4/","");var _=c.params;return s&&(_=_.filter(function(S){return!S.match(/^access_token=/)})),_.length&&(m+="?"+_.join("&")),m},bi.prototype.canonicalizeTileset=function(a,s){for(var c=!!s&&li(s),m=[],_=0,S=a.tiles||[];_<S.length;_+=1){var A=S[_];qn(A)?m.push(this.canonicalizeTileURL(A,c)):m.push(A)}return m},bi.prototype._makeAPIURL=function(a,s){var c="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",m=ka(Nr.API_URL);if(a.protocol=m.protocol,a.authority=m.authority,a.protocol==="http"){var _=a.params.indexOf("secure");_>=0&&a.params.splice(_,1)}if(m.path!=="/"&&(a.path=""+m.path+a.path),!Nr.REQUIRE_ACCESS_TOKEN)return oa(a);if(!(s=s||Nr.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+c);if(s[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+c);return a.params=a.params.filter(function(S){return S.indexOf("access_token")===-1}),a.params.push("access_token="+s),oa(a)};var Zn=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function qn(a){return Zn.test(a)}var ro=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ka(a){var s=a.match(ro);if(!s)throw new Error("Unable to parse URL object");return{protocol:s[1],authority:s[2],path:s[3]||"/",params:s[4]?s[4].split("&"):[]}}function oa(a){var s=a.params.length?"?"+a.params.join("&"):"";return a.protocol+"://"+a.authority+a.path+s}function Tt(a){if(!a)return null;var s=a.split(".");if(!s||s.length!==3)return null;try{return JSON.parse(decodeURIComponent(_e.atob(s[1]).split("").map(function(c){return"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(c){return null}}var ge=function(a){this.type=a,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};ge.prototype.getStorageKey=function(a){var s,c=Tt(Nr.ACCESS_TOKEN);return s=c&&c.u?_e.btoa(encodeURIComponent(c.u).replace(/%([0-9A-F]{2})/g,function(m,_){return String.fromCharCode(Number("0x"+_))})):Nr.ACCESS_TOKEN||"",a?"mapbox.eventData."+a+":"+s:"mapbox.eventData:"+s},ge.prototype.fetchEventData=function(){var a=ce("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid");if(a)try{var m=_e.localStorage.getItem(s);m&&(this.eventData=JSON.parse(m));var _=_e.localStorage.getItem(c);_&&(this.anonId=_)}catch(S){dt("Unable to read from LocalStorage")}},ge.prototype.saveEventData=function(){var a=ce("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid");if(a)try{_e.localStorage.setItem(c,this.anonId),Object.keys(this.eventData).length>=1&&_e.localStorage.setItem(s,JSON.stringify(this.eventData))}catch(m){dt("Unable to write to LocalStorage")}},ge.prototype.processRequests=function(a){},ge.prototype.postEvent=function(a,s,c,m){var _=this;if(Nr.EVENTS_URL){var S=ka(Nr.EVENTS_URL);S.params.push("access_token="+(m||Nr.ACCESS_TOKEN||""));var A={event:this.type,created:new Date(a).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:ki,userId:this.anonId},P=s?Mt(A,s):A,F={url:oa(S),headers:{"Content-Type":"text/plain"},body:JSON.stringify([P])};this.pendingRequest=ta(F,function(j){_.pendingRequest=null,c(j),_.saveEventData(),_.processRequests(m)})}},ge.prototype.queueRequest=function(a,s){this.queue.push(a),this.processRequests(s)};var ue,we,Z=function(a){function s(){a.call(this,"map.load"),this.success={},this.skuToken=""}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.postMapLoadEvent=function(c,m,_,S){this.skuToken=_,(Nr.EVENTS_URL&&S||Nr.ACCESS_TOKEN&&Array.isArray(c)&&c.some(function(A){return li(A)||qn(A)}))&&this.queueRequest({id:m,timestamp:Date.now()},S)},s.prototype.processRequests=function(c){var m=this;if(!this.pendingRequest&&this.queue.length!==0){var _=this.queue.shift(),S=_.id,A=_.timestamp;S&&this.success[S]||(this.anonId||this.fetchEventData(),At(this.anonId)||(this.anonId=yt()),this.postEvent(A,{skuToken:this.skuToken},function(P){P||S&&(m.success[S]=!0)},c))}},s}(ge),Je=new(function(a){function s(c){a.call(this,"appUserTurnstile"),this._customAccessToken=c}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.postTurnstileEvent=function(c,m){Nr.EVENTS_URL&&Nr.ACCESS_TOKEN&&Array.isArray(c)&&c.some(function(_){return li(_)||qn(_)})&&this.queueRequest(Date.now(),m)},s.prototype.processRequests=function(c){var m=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var _=Tt(Nr.ACCESS_TOKEN),S=_?_.u:Nr.ACCESS_TOKEN,A=S!==this.eventData.tokenU;At(this.anonId)||(this.anonId=yt(),A=!0);var P=this.queue.shift();if(this.eventData.lastSuccess){var F=new Date(this.eventData.lastSuccess),j=new Date(P),X=(P-this.eventData.lastSuccess)/864e5;A=A||X>=1||X<-1||F.getDate()!==j.getDate()}else A=!0;if(!A)return this.processRequests();this.postEvent(P,{"enabled.telemetry":!1},function(ee){ee||(m.eventData.lastSuccess=P,m.eventData.tokenU=S)},c)}},s}(ge)),Xt=Je.postTurnstileEvent.bind(Je),Dr=new Z,tt=Dr.postMapLoadEvent.bind(Dr),It=500,mr=50;function Ir(){_e.caches&&!ue&&(ue=_e.caches.open("mapbox-tiles"))}function $r(a){var s=a.indexOf("?");return s<0?a:a.slice(0,s)}var tn,$n=1/0;function Vn(){return tn==null&&(tn=_e.OffscreenCanvas&&new _e.OffscreenCanvas(1,1).getContext("2d")&&typeof _e.createImageBitmap=="function"),tn}var rn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(rn);var vi=function(a){function s(c,m,_){m===401&&qn(_)&&(c+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),a.call(this,c),this.status=m,this.url=_,this.name=this.constructor.name,this.message=c}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},s}(Error),ni=re()?function(){return self.worker&&self.worker.referrer}:function(){return(_e.location.protocol==="blob:"?_e.parent:_e).location.href},sa,Sa,Na=function(a,s){if(!(/^file:/.test(c=a.url)||/^file:/.test(ni())&&!/^\w+:/.test(c))){if(_e.fetch&&_e.Request&&_e.AbortController&&_e.Request.prototype.hasOwnProperty("signal"))return function(m,_){var S,A=new _e.AbortController,P=new _e.Request(m.url,{method:m.method||"GET",body:m.body,credentials:m.credentials,headers:m.headers,referrer:ni(),signal:A.signal}),F=!1,j=!1,X=(S=P.url).indexOf("sku=")>0&&qn(S);m.type==="json"&&P.headers.set("Accept","application/json");var ee=function(xe,je,He){if(!j){if(xe&&xe.message!=="SecurityError"&&dt(xe),je&&He)return fe(je);var pt=Date.now();_e.fetch(P).then(function(nt){if(nt.ok){var kt=X?nt.clone():null;return fe(nt,kt,pt)}return _(new vi(nt.statusText,nt.status,m.url))}).catch(function(nt){nt.code!==20&&_(new Error(nt.message))})}},fe=function(xe,je,He){(m.type==="arrayBuffer"?xe.arrayBuffer():m.type==="json"?xe.json():xe.text()).then(function(pt){j||(je&&He&&function(nt,kt,Gt){if(Ir(),ue){var sr={status:kt.status,statusText:kt.statusText,headers:new _e.Headers};kt.headers.forEach(function(fr,Hr){return sr.headers.set(Hr,fr)});var vr=Fe(kt.headers.get("Cache-Control")||"");vr["no-store"]||(vr["max-age"]&&sr.headers.set("Expires",new Date(Gt+1e3*vr["max-age"]).toUTCString()),new Date(sr.headers.get("Expires")).getTime()-Gt<42e4||function(fr,Hr){if(we===void 0)try{new Response(new ReadableStream),we=!0}catch(dn){we=!1}we?Hr(fr.body):fr.blob().then(Hr)}(kt,function(fr){var Hr=new _e.Response(fr,sr);Ir(),ue&&ue.then(function(dn){return dn.put($r(nt.url),Hr)}).catch(function(dn){return dt(dn.message)})}))}}(P,je,He),F=!0,_(null,pt,xe.headers.get("Cache-Control"),xe.headers.get("Expires")))}).catch(function(pt){j||_(new Error(pt.message))})};return X?function(xe,je){if(Ir(),!ue)return je(null);var He=$r(xe.url);ue.then(function(pt){pt.match(He).then(function(nt){var kt=function(Gt){if(!Gt)return!1;var sr=new Date(Gt.headers.get("Expires")||0),vr=Fe(Gt.headers.get("Cache-Control")||"");return sr>Date.now()&&!vr["no-cache"]}(nt);pt.delete(He),kt&&pt.put(He,nt.clone()),je(null,nt,kt)}).catch(je)}).catch(je)}(P,ee):ee(null,null),{cancel:function(){j=!0,F||A.abort()}}}(a,s);if(re()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,s,void 0,!0)}var c;return function(m,_){var S=new _e.XMLHttpRequest;for(var A in S.open(m.method||"GET",m.url,!0),m.type==="arrayBuffer"&&(S.responseType="arraybuffer"),m.headers)S.setRequestHeader(A,m.headers[A]);return m.type==="json"&&(S.responseType="text",S.setRequestHeader("Accept","application/json")),S.withCredentials=m.credentials==="include",S.onerror=function(){_(new Error(S.statusText))},S.onload=function(){if((S.status>=200&&S.status<300||S.status===0)&&S.response!==null){var P=S.response;if(m.type==="json")try{P=JSON.parse(S.response)}catch(F){return _(F)}_(null,P,S.getResponseHeader("Cache-Control"),S.getResponseHeader("Expires"))}else _(new vi(S.statusText,S.status,m.url))},S.send(m.body),{cancel:function(){return S.abort()}}}(a,s)},ga=function(a,s){return Na(Mt(a,{type:"arrayBuffer"}),s)},ta=function(a,s){return Na(Mt(a,{method:"POST"}),s)},Q="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";sa=[],Sa=0;var ae=function(a,s){if(wn.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),Sa>=Nr.MAX_PARALLEL_IMAGE_REQUESTS){var c={requestParameters:a,callback:s,cancelled:!1,cancel:function(){this.cancelled=!0}};return sa.push(c),c}Sa++;var m=!1,_=function(){if(!m)for(m=!0,Sa--;sa.length&&Sa<Nr.MAX_PARALLEL_IMAGE_REQUESTS;){var A=sa.shift();A.cancelled||(A.cancel=ae(A.requestParameters,A.callback).cancel)}},S=ga(a,function(A,P,F,j){_(),A?s(A):P&&(Vn()?function(X,ee){var fe=new _e.Blob([new Uint8Array(X)],{type:"image/png"});_e.createImageBitmap(fe).then(function(xe){ee(null,xe)}).catch(function(xe){ee(new Error("Could not load image because of "+xe.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(P,s):function(X,ee,fe,xe){var je=new _e.Image,He=_e.URL;je.onload=function(){ee(null,je),He.revokeObjectURL(je.src),je.onload=null,_e.requestAnimationFrame(function(){je.src=Q})},je.onerror=function(){return ee(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var pt=new _e.Blob([new Uint8Array(X)],{type:"image/png"});je.cacheControl=fe,je.expires=xe,je.src=X.byteLength?He.createObjectURL(pt):Q}(P,s,F,j))});return{cancel:function(){S.cancel(),_()}}};function me(a,s,c){c[a]&&c[a].indexOf(s)!==-1||(c[a]=c[a]||[],c[a].push(s))}function Me(a,s,c){if(c&&c[a]){var m=c[a].indexOf(s);m!==-1&&c[a].splice(m,1)}}var Ve=function(a,s){s===void 0&&(s={}),Mt(this,s),this.type=a},at=function(a){function s(c,m){m===void 0&&(m={}),a.call(this,"error",Mt({error:c},m))}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s}(Ve),_t=function(){};_t.prototype.on=function(a,s){return this._listeners=this._listeners||{},me(a,s,this._listeners),this},_t.prototype.off=function(a,s){return Me(a,s,this._listeners),Me(a,s,this._oneTimeListeners),this},_t.prototype.once=function(a,s){return this._oneTimeListeners=this._oneTimeListeners||{},me(a,s,this._oneTimeListeners),this},_t.prototype.fire=function(a,s){typeof a=="string"&&(a=new Ve(a,s||{}));var c=a.type;if(this.listens(c)){a.target=this;for(var m=0,_=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];m<_.length;m+=1)_[m].call(this,a);for(var S=0,A=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];S<A.length;S+=1){var P=A[S];Me(c,P,this._oneTimeListeners),P.call(this,a)}var F=this._eventedParent;F&&(Mt(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),F.fire(a))}else a instanceof at&&console.error(a.error);return this},_t.prototype.listens=function(a){return this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a)},_t.prototype.setEventedParent=function(a,s){return this._eventedParent=a,this._eventedParentData=s,this};var Ce={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},$e=function(a,s,c,m){this.message=(a?a+": ":"")+c,m&&(this.identifier=m),s!=null&&s.__line__&&(this.line=s.__line__)};function Zt(a){var s=a.value;return s?[new $e(a.key,s,"constants have been deprecated as of v8")]:[]}function Rr(a){for(var s=[],c=arguments.length-1;c-- >0;)s[c]=arguments[c+1];for(var m=0,_=s;m<_.length;m+=1){var S=_[m];for(var A in S)a[A]=S[A]}return a}function nr(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function lr(a){if(Array.isArray(a))return a.map(lr);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){var s={};for(var c in a)s[c]=lr(a[c]);return s}return nr(a)}var Lr=function(a){function s(c,m){a.call(this,m),this.message=m,this.key=c}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s}(Error),Dn=function(a,s){s===void 0&&(s=[]),this.parent=a,this.bindings={};for(var c=0,m=s;c<m.length;c+=1){var _=m[c];this.bindings[_[0]]=_[1]}};Dn.prototype.concat=function(a){return new Dn(this,a)},Dn.prototype.get=function(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(a+" not found in scope.")},Dn.prototype.has=function(a){return!!this.bindings[a]||!!this.parent&&this.parent.has(a)};var Mn={kind:"null"},$t={kind:"number"},Cn={kind:"string"},hr={kind:"boolean"},St={kind:"color"},Ei={kind:"object"},mn={kind:"value"},Oi={kind:"collator"},ua={kind:"formatted"},xt={kind:"resolvedImage"};function wt(a,s){return{kind:"array",itemType:a,N:s}}function Ri(a){if(a.kind==="array"){var s=Ri(a.itemType);return typeof a.N=="number"?"array<"+s+", "+a.N+">":a.itemType.kind==="value"?"array":"array<"+s+">"}return a.kind}var pi=[Mn,$t,Cn,hr,St,ua,Ei,wt(mn),xt];function Ji(a,s){if(s.kind==="error")return null;if(a.kind==="array"){if(s.kind==="array"&&(s.N===0&&s.itemType.kind==="value"||!Ji(a.itemType,s.itemType))&&(typeof a.N!="number"||a.N===s.N))return null}else{if(a.kind===s.kind)return null;if(a.kind==="value"){for(var c=0,m=pi;c<m.length;c+=1)if(!Ji(m[c],s))return null}}return"Expected "+Ri(a)+" but found "+Ri(s)+" instead."}function ea(a,s){return s.some(function(c){return c.kind===a.kind})}function la(a,s){return s.some(function(c){return c==="null"?a===null:c==="array"?Array.isArray(a):c==="object"?a&&!Array.isArray(a)&&typeof a=="object":c===typeof a})}var Di=Te(function(a,s){var c={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function m(P){return(P=Math.round(P))<0?0:P>255?255:P}function _(P){return m(P[P.length-1]==="%"?parseFloat(P)/100*255:parseInt(P))}function S(P){return(F=P[P.length-1]==="%"?parseFloat(P)/100:parseFloat(P))<0?0:F>1?1:F;var F}function A(P,F,j){return j<0?j+=1:j>1&&(j-=1),6*j<1?P+(F-P)*j*6:2*j<1?F:3*j<2?P+(F-P)*(2/3-j)*6:P}try{s.parseCSSColor=function(P){var F,j=P.replace(/ /g,"").toLowerCase();if(j in c)return c[j].slice();if(j[0]==="#")return j.length===4?(F=parseInt(j.substr(1),16))>=0&&F<=4095?[(3840&F)>>4|(3840&F)>>8,240&F|(240&F)>>4,15&F|(15&F)<<4,1]:null:j.length===7&&(F=parseInt(j.substr(1),16))>=0&&F<=16777215?[(16711680&F)>>16,(65280&F)>>8,255&F,1]:null;var X=j.indexOf("("),ee=j.indexOf(")");if(X!==-1&&ee+1===j.length){var fe=j.substr(0,X),xe=j.substr(X+1,ee-(X+1)).split(","),je=1;switch(fe){case"rgba":if(xe.length!==4)return null;je=S(xe.pop());case"rgb":return xe.length!==3?null:[_(xe[0]),_(xe[1]),_(xe[2]),je];case"hsla":if(xe.length!==4)return null;je=S(xe.pop());case"hsl":if(xe.length!==3)return null;var He=(parseFloat(xe[0])%360+360)%360/360,pt=S(xe[1]),nt=S(xe[2]),kt=nt<=.5?nt*(pt+1):nt+pt-nt*pt,Gt=2*nt-kt;return[m(255*A(Gt,kt,He+1/3)),m(255*A(Gt,kt,He)),m(255*A(Gt,kt,He-1/3)),je];default:return null}}return null}}catch(P){}}).parseCSSColor,gr=function(a,s,c,m){m===void 0&&(m=1),this.r=a,this.g=s,this.b=c,this.a=m};gr.parse=function(a){if(a){if(a instanceof gr)return a;if(typeof a=="string"){var s=Di(a);if(s)return new gr(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3])}}},gr.prototype.toString=function(){var a=this.toArray(),s=a[1],c=a[2],m=a[3];return"rgba("+Math.round(a[0])+","+Math.round(s)+","+Math.round(c)+","+m+")"},gr.prototype.toArray=function(){var a=this.a;return a===0?[0,0,0,0]:[255*this.r/a,255*this.g/a,255*this.b/a,a]},gr.black=new gr(0,0,0,1),gr.white=new gr(1,1,1,1),gr.transparent=new gr(0,0,0,0),gr.red=new gr(1,0,0,1);var Cr=function(a,s,c){this.sensitivity=a?s?"variant":"case":s?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Cr.prototype.compare=function(a,s){return this.collator.compare(a,s)},Cr.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var rt=function(a,s,c,m,_){this.text=a,this.image=s,this.scale=c,this.fontStack=m,this.textColor=_},Aa=function(a){this.sections=a};Aa.fromString=function(a){return new Aa([new rt(a,null,null,null,null)])},Aa.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(a){return a.text.length!==0||a.image&&a.image.name.length!==0})},Aa.factory=function(a){return a instanceof Aa?a:Aa.fromString(a)},Aa.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(a){return a.text}).join("")},Aa.prototype.serialize=function(){for(var a=["format"],s=0,c=this.sections;s<c.length;s+=1){var m=c[s];if(m.image)a.push(["image",m.image.name]);else{a.push(m.text);var _={};m.fontStack&&(_["text-font"]=["literal",m.fontStack.split(",")]),m.scale&&(_["font-scale"]=m.scale),m.textColor&&(_["text-color"]=["rgba"].concat(m.textColor.toArray())),a.push(_)}}return a};var De=function(a){this.name=a.name,this.available=a.available};function ws(a,s,c,m){return typeof a=="number"&&a>=0&&a<=255&&typeof s=="number"&&s>=0&&s<=255&&typeof c=="number"&&c>=0&&c<=255?m===void 0||typeof m=="number"&&m>=0&&m<=1?null:"Invalid rgba value ["+[a,s,c,m].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof m=="number"?[a,s,c,m]:[a,s,c]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function os(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof gr||a instanceof Cr||a instanceof Aa||a instanceof De)return!0;if(Array.isArray(a)){for(var s=0,c=a;s<c.length;s+=1)if(!os(c[s]))return!1;return!0}if(typeof a=="object"){for(var m in a)if(!os(a[m]))return!1;return!0}return!1}function ia(a){if(a===null)return Mn;if(typeof a=="string")return Cn;if(typeof a=="boolean")return hr;if(typeof a=="number")return $t;if(a instanceof gr)return St;if(a instanceof Cr)return Oi;if(a instanceof Aa)return ua;if(a instanceof De)return xt;if(Array.isArray(a)){for(var s,c=a.length,m=0,_=a;m<_.length;m+=1){var S=ia(_[m]);if(s){if(s===S)continue;s=mn;break}s=S}return wt(s||mn,c)}return Ei}function Vs(a){var s=typeof a;return a===null?"":s==="string"||s==="number"||s==="boolean"?String(a):a instanceof gr||a instanceof Aa||a instanceof De?a.toString():JSON.stringify(a)}De.prototype.toString=function(){return this.name},De.fromString=function(a){return a?new De({name:a,available:!1}):null},De.prototype.serialize=function(){return["image",this.name]};var no=function(a,s){this.type=a,this.value=s};no.parse=function(a,s){if(a.length!==2)return s.error("'literal' expression requires exactly one argument, but found "+(a.length-1)+" instead.");if(!os(a[1]))return s.error("invalid value");var c=a[1],m=ia(c),_=s.expectedType;return m.kind!=="array"||m.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(m=_),new no(m,c)},no.prototype.evaluate=function(){return this.value},no.prototype.eachChild=function(){},no.prototype.outputDefined=function(){return!0},no.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof gr?["rgba"].concat(this.value.toArray()):this.value instanceof Aa?this.value.serialize():this.value};var Wa=function(a){this.name="ExpressionEvaluationError",this.message=a};Wa.prototype.toJSON=function(){return this.message};var io={string:Cn,number:$t,boolean:hr,object:Ei},ca=function(a,s){this.type=a,this.args=s};ca.parse=function(a,s){if(a.length<2)return s.error("Expected at least one argument.");var c,m=1,_=a[0];if(_==="array"){var S,A;if(a.length>2){var P=a[1];if(typeof P!="string"||!(P in io)||P==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);S=io[P],m++}else S=mn;if(a.length>3){if(a[2]!==null&&(typeof a[2]!="number"||a[2]<0||a[2]!==Math.floor(a[2])))return s.error('The length argument to "array" must be a positive integer literal',2);A=a[2],m++}c=wt(S,A)}else c=io[_];for(var F=[];m<a.length;m++){var j=s.parse(a[m],m,mn);if(!j)return null;F.push(j)}return new ca(c,F)},ca.prototype.evaluate=function(a){for(var s=0;s<this.args.length;s++){var c=this.args[s].evaluate(a);if(!Ji(this.type,ia(c)))return c;if(s===this.args.length-1)throw new Wa("Expected value to be of type "+Ri(this.type)+", but found "+Ri(ia(c))+" instead.")}return null},ca.prototype.eachChild=function(a){this.args.forEach(a)},ca.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},ca.prototype.serialize=function(){var a=this.type,s=[a.kind];if(a.kind==="array"){var c=a.itemType;if(c.kind==="string"||c.kind==="number"||c.kind==="boolean"){s.push(c.kind);var m=a.N;(typeof m=="number"||this.args.length>1)&&s.push(m)}}return s.concat(this.args.map(function(_){return _.serialize()}))};var Ho=function(a){this.type=ua,this.sections=a};Ho.parse=function(a,s){if(a.length<2)return s.error("Expected at least one argument.");var c=a[1];if(!Array.isArray(c)&&typeof c=="object")return s.error("First argument must be an image or text section.");for(var m=[],_=!1,S=1;S<=a.length-1;++S){var A=a[S];if(_&&typeof A=="object"&&!Array.isArray(A)){_=!1;var P=null;if(A["font-scale"]&&!(P=s.parse(A["font-scale"],1,$t)))return null;var F=null;if(A["text-font"]&&!(F=s.parse(A["text-font"],1,wt(Cn))))return null;var j=null;if(A["text-color"]&&!(j=s.parse(A["text-color"],1,St)))return null;var X=m[m.length-1];X.scale=P,X.font=F,X.textColor=j}else{var ee=s.parse(a[S],1,mn);if(!ee)return null;var fe=ee.type.kind;if(fe!=="string"&&fe!=="value"&&fe!=="null"&&fe!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,m.push({content:ee,scale:null,font:null,textColor:null})}}return new Ho(m)},Ho.prototype.evaluate=function(a){return new Aa(this.sections.map(function(s){var c=s.content.evaluate(a);return ia(c)===xt?new rt("",c,null,null,null):new rt(Vs(c),null,s.scale?s.scale.evaluate(a):null,s.font?s.font.evaluate(a).join(","):null,s.textColor?s.textColor.evaluate(a):null)}))},Ho.prototype.eachChild=function(a){for(var s=0,c=this.sections;s<c.length;s+=1){var m=c[s];a(m.content),m.scale&&a(m.scale),m.font&&a(m.font),m.textColor&&a(m.textColor)}},Ho.prototype.outputDefined=function(){return!1},Ho.prototype.serialize=function(){for(var a=["format"],s=0,c=this.sections;s<c.length;s+=1){var m=c[s];a.push(m.content.serialize());var _={};m.scale&&(_["font-scale"]=m.scale.serialize()),m.font&&(_["text-font"]=m.font.serialize()),m.textColor&&(_["text-color"]=m.textColor.serialize()),a.push(_)}return a};var Jo=function(a){this.type=xt,this.input=a};Jo.parse=function(a,s){if(a.length!==2)return s.error("Expected two arguments.");var c=s.parse(a[1],1,Cn);return c?new Jo(c):s.error("No image name provided.")},Jo.prototype.evaluate=function(a){var s=this.input.evaluate(a),c=De.fromString(s);return c&&a.availableImages&&(c.available=a.availableImages.indexOf(s)>-1),c},Jo.prototype.eachChild=function(a){a(this.input)},Jo.prototype.outputDefined=function(){return!1},Jo.prototype.serialize=function(){return["image",this.input.serialize()]};var wu={"to-boolean":hr,"to-color":St,"to-number":$t,"to-string":Cn},To=function(a,s){this.type=a,this.args=s};To.parse=function(a,s){if(a.length<2)return s.error("Expected at least one argument.");var c=a[0];if((c==="to-boolean"||c==="to-string")&&a.length!==2)return s.error("Expected one argument.");for(var m=wu[c],_=[],S=1;S<a.length;S++){var A=s.parse(a[S],S,mn);if(!A)return null;_.push(A)}return new To(m,_)},To.prototype.evaluate=function(a){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(a));if(this.type.kind==="color"){for(var s,c,m=0,_=this.args;m<_.length;m+=1){if(c=null,(s=_[m].evaluate(a))instanceof gr)return s;if(typeof s=="string"){var S=a.parseColor(s);if(S)return S}else if(Array.isArray(s)&&!(c=s.length<3||s.length>4?"Invalid rbga value "+JSON.stringify(s)+": expected an array containing either three or four numeric values.":ws(s[0],s[1],s[2],s[3])))return new gr(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new Wa(c||"Could not parse color from value '"+(typeof s=="string"?s:String(JSON.stringify(s)))+"'")}if(this.type.kind==="number"){for(var A=null,P=0,F=this.args;P<F.length;P+=1){if((A=F[P].evaluate(a))===null)return 0;var j=Number(A);if(!isNaN(j))return j}throw new Wa("Could not convert "+JSON.stringify(A)+" to number.")}return this.type.kind==="formatted"?Aa.fromString(Vs(this.args[0].evaluate(a))):this.type.kind==="resolvedImage"?De.fromString(Vs(this.args[0].evaluate(a))):Vs(this.args[0].evaluate(a))},To.prototype.eachChild=function(a){this.args.forEach(a)},To.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},To.prototype.serialize=function(){if(this.type.kind==="formatted")return new Ho([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Jo(this.args[0]).serialize();var a=["to-"+this.type.kind];return this.eachChild(function(s){a.push(s.serialize())}),a};var Mo=["Unknown","Point","LineString","Polygon"],ha=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};ha.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},ha.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Mo[this.feature.type]:this.feature.type:null},ha.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},ha.prototype.canonicalID=function(){return this.canonical},ha.prototype.properties=function(){return this.feature&&this.feature.properties||{}},ha.prototype.parseColor=function(a){var s=this._parseColorCache[a];return s||(s=this._parseColorCache[a]=gr.parse(a)),s};var ao=function(a,s,c,m){this.name=a,this.type=s,this._evaluate=c,this.args=m};ao.prototype.evaluate=function(a){return this._evaluate(a,this.args)},ao.prototype.eachChild=function(a){this.args.forEach(a)},ao.prototype.outputDefined=function(){return!1},ao.prototype.serialize=function(){return[this.name].concat(this.args.map(function(a){return a.serialize()}))},ao.parse=function(a,s){var c,m=a[0],_=ao.definitions[m];if(!_)return s.error('Unknown expression "'+m+'". If you wanted a literal array, use ["literal", [...]].',0);for(var S=Array.isArray(_)?_[0]:_.type,A=Array.isArray(_)?[[_[1],_[2]]]:_.overloads,P=A.filter(function(ai){var In=ai[0];return!Array.isArray(In)||In.length===a.length-1}),F=null,j=0,X=P;j<X.length;j+=1){var ee=X[j],fe=ee[0],xe=ee[1];F=new Ks(s.registry,s.path,null,s.scope);for(var je=[],He=!1,pt=1;pt<a.length;pt++){var nt=a[pt],kt=Array.isArray(fe)?fe[pt-1]:fe.type,Gt=F.parse(nt,1+je.length,kt);if(!Gt){He=!0;break}je.push(Gt)}if(!He)if(Array.isArray(fe)&&fe.length!==je.length)F.error("Expected "+fe.length+" arguments, but found "+je.length+" instead.");else{for(var sr=0;sr<je.length;sr++){var vr=Array.isArray(fe)?fe[sr]:fe.type,fr=je[sr];F.concat(sr+1).checkSubtype(vr,fr.type)}if(F.errors.length===0)return new ao(m,S,xe,je)}}if(P.length===1)(c=s.errors).push.apply(c,F.errors);else{for(var Hr=(P.length?P:A).map(function(ai){var In;return In=ai[0],Array.isArray(In)?"("+In.map(Ri).join(", ")+")":"("+Ri(In.type)+"...)"}).join(" | "),dn=[],Kn=1;Kn<a.length;Kn++){var kn=s.parse(a[Kn],1+dn.length);if(!kn)return null;dn.push(Ri(kn.type))}s.error("Expected arguments of type "+Hr+", but found ("+dn.join(", ")+") instead.")}return null},ao.register=function(a,s){for(var c in ao.definitions=s,s)a[c]=ao};var Wo=function(a,s,c){this.type=Oi,this.locale=c,this.caseSensitive=a,this.diacriticSensitive=s};function Ya(a,s){a[0]=Math.min(a[0],s[0]),a[1]=Math.min(a[1],s[1]),a[2]=Math.max(a[2],s[0]),a[3]=Math.max(a[3],s[1])}function qs(a,s){return!(a[0]<=s[0]||a[2]>=s[2]||a[1]<=s[1]||a[3]>=s[3])}function Il(a,s){var c=(180+a[0])/360,m=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,_=Math.pow(2,s.z);return[Math.round(c*_*8192),Math.round(m*_*8192)]}function es(a,s,c){return s[1]>a[1]!=c[1]>a[1]&&a[0]<(c[0]-s[0])*(a[1]-s[1])/(c[1]-s[1])+s[0]}function ve(a,s){for(var c,m,_,S,A,P,F,j=!1,X=0,ee=s.length;X<ee;X++)for(var fe=s[X],xe=0,je=fe.length;xe<je-1;xe++){if((S=(c=a)[0]-(m=fe[xe])[0])*(F=c[1]-(_=fe[xe+1])[1])-(P=c[0]-_[0])*(A=c[1]-m[1])==0&&S*P<=0&&A*F<=0)return!1;es(a,fe[xe],fe[xe+1])&&(j=!j)}return j}function Oe(a,s){for(var c=0;c<s.length;c++)if(ve(a,s[c]))return!0;return!1}function mt(a,s,c,m){var _=m[0]-c[0],S=m[1]-c[1],A=(a[0]-c[0])*S-_*(a[1]-c[1]),P=(s[0]-c[0])*S-_*(s[1]-c[1]);return A>0&&P<0||A<0&&P>0}function er(a,s,c){for(var m=0,_=c;m<_.length;m+=1)for(var S=_[m],A=0;A<S.length-1;++A)if((ee=[(X=S[A+1])[0]-(j=S[A])[0],X[1]-j[1]])[0]*(fe=[(F=s)[0]-(P=a)[0],F[1]-P[1]])[1]-ee[1]*fe[0]!=0&&mt(P,F,j,X)&&mt(j,X,P,F))return!0;var P,F,j,X,ee,fe;return!1}function en(a,s){for(var c=0;c<a.length;++c)if(!ve(a[c],s))return!1;for(var m=0;m<a.length-1;++m)if(er(a[m],a[m+1],s))return!1;return!0}function Hn(a,s){for(var c=0;c<s.length;c++)if(en(a,s[c]))return!0;return!1}function Fi(a,s,c){for(var m=[],_=0;_<a.length;_++){for(var S=[],A=0;A<a[_].length;A++){var P=Il(a[_][A],c);Ya(s,P),S.push(P)}m.push(S)}return m}function fo(a,s,c){for(var m=[],_=0;_<a.length;_++){var S=Fi(a[_],s,c);m.push(S)}return m}function za(a,s,c,m){if(a[0]<c[0]||a[0]>c[2]){var _=.5*m,S=a[0]-c[0]>_?-m:c[0]-a[0]>_?m:0;S===0&&(S=a[0]-c[2]>_?-m:c[2]-a[0]>_?m:0),a[0]+=S}Ya(s,a)}function qa(a,s,c,m){for(var _=8192*Math.pow(2,m.z),S=[8192*m.x,8192*m.y],A=[],P=0,F=a;P<F.length;P+=1)for(var j=0,X=F[P];j<X.length;j+=1){var ee=X[j],fe=[ee.x+S[0],ee.y+S[1]];za(fe,s,c,_),A.push(fe)}return A}function ts(a,s,c,m){for(var _,S=8192*Math.pow(2,m.z),A=[8192*m.x,8192*m.y],P=[],F=0,j=a;F<j.length;F+=1){for(var X=[],ee=0,fe=j[F];ee<fe.length;ee+=1){var xe=fe[ee],je=[xe.x+A[0],xe.y+A[1]];Ya(s,je),X.push(je)}P.push(X)}if(s[2]-s[0]<=S/2){(_=s)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(var He=0,pt=P;He<pt.length;He+=1)for(var nt=0,kt=pt[He];nt<kt.length;nt+=1)za(kt[nt],s,c,S)}return P}Wo.parse=function(a,s){if(a.length!==2)return s.error("Expected one argument.");var c=a[1];if(typeof c!="object"||Array.isArray(c))return s.error("Collator options argument must be an object.");var m=s.parse(c["case-sensitive"]!==void 0&&c["case-sensitive"],1,hr);if(!m)return null;var _=s.parse(c["diacritic-sensitive"]!==void 0&&c["diacritic-sensitive"],1,hr);if(!_)return null;var S=null;return c.locale&&!(S=s.parse(c.locale,1,Cn))?null:new Wo(m,_,S)},Wo.prototype.evaluate=function(a){return new Cr(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)},Wo.prototype.eachChild=function(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)},Wo.prototype.outputDefined=function(){return!1},Wo.prototype.serialize=function(){var a={};return a["case-sensitive"]=this.caseSensitive.serialize(),a["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(a.locale=this.locale.serialize()),["collator",a]};var Do=function(a,s){this.type=hr,this.geojson=a,this.geometries=s};function mo(a){if(a instanceof ao&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof Do)return!1;var s=!0;return a.eachChild(function(c){s&&!mo(c)&&(s=!1)}),s}function Cs(a){if(a instanceof ao&&a.name==="feature-state")return!1;var s=!0;return a.eachChild(function(c){s&&!Cs(c)&&(s=!1)}),s}function As(a,s){if(a instanceof ao&&s.indexOf(a.name)>=0)return!1;var c=!0;return a.eachChild(function(m){c&&!As(m,s)&&(c=!1)}),c}Do.parse=function(a,s){if(a.length!==2)return s.error("'within' expression requires exactly one argument, but found "+(a.length-1)+" instead.");if(os(a[1])){var c=a[1];if(c.type==="FeatureCollection")for(var m=0;m<c.features.length;++m){var _=c.features[m].geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new Do(c,c.features[m].geometry)}else if(c.type==="Feature"){var S=c.geometry.type;if(S==="Polygon"||S==="MultiPolygon")return new Do(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new Do(c,c)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Do.prototype.evaluate=function(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return function(s,c){var m=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],S=s.canonicalID();if(c.type==="Polygon"){var A=Fi(c.coordinates,_,S),P=qa(s.geometry(),m,_,S);if(!qs(m,_))return!1;for(var F=0,j=P;F<j.length;F+=1)if(!ve(j[F],A))return!1}if(c.type==="MultiPolygon"){var X=fo(c.coordinates,_,S),ee=qa(s.geometry(),m,_,S);if(!qs(m,_))return!1;for(var fe=0,xe=ee;fe<xe.length;fe+=1)if(!Oe(xe[fe],X))return!1}return!0}(a,this.geometries);if(a.geometryType()==="LineString")return function(s,c){var m=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],S=s.canonicalID();if(c.type==="Polygon"){var A=Fi(c.coordinates,_,S),P=ts(s.geometry(),m,_,S);if(!qs(m,_))return!1;for(var F=0,j=P;F<j.length;F+=1)if(!en(j[F],A))return!1}if(c.type==="MultiPolygon"){var X=fo(c.coordinates,_,S),ee=ts(s.geometry(),m,_,S);if(!qs(m,_))return!1;for(var fe=0,xe=ee;fe<xe.length;fe+=1)if(!Hn(xe[fe],X))return!1}return!0}(a,this.geometries)}return!1},Do.prototype.eachChild=function(){},Do.prototype.outputDefined=function(){return!0},Do.prototype.serialize=function(){return["within",this.geojson]};var Ts=function(a,s){this.type=s.type,this.name=a,this.boundExpression=s};Ts.parse=function(a,s){if(a.length!==2||typeof a[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");var c=a[1];return s.scope.has(c)?new Ts(c,s.scope.get(c)):s.error('Unknown variable "'+c+'". Make sure "'+c+'" has been bound in an enclosing "let" expression before using it.',1)},Ts.prototype.evaluate=function(a){return this.boundExpression.evaluate(a)},Ts.prototype.eachChild=function(){},Ts.prototype.outputDefined=function(){return!1},Ts.prototype.serialize=function(){return["var",this.name]};var Ks=function(a,s,c,m,_){s===void 0&&(s=[]),m===void 0&&(m=new Dn),_===void 0&&(_=[]),this.registry=a,this.path=s,this.key=s.map(function(S){return"["+S+"]"}).join(""),this.scope=m,this.errors=_,this.expectedType=c};function cu(a,s){for(var c,m=a.length-1,_=0,S=m,A=0;_<=S;)if((c=a[A=Math.floor((_+S)/2)])<=s){if(A===m||s<a[A+1])return A;_=A+1}else{if(!(c>s))throw new Wa("Input is not a number.");S=A-1}return 0}Ks.prototype.parse=function(a,s,c,m,_){return _===void 0&&(_={}),s?this.concat(s,c,m)._parse(a,_):this._parse(a,_)},Ks.prototype._parse=function(a,s){function c(j,X,ee){return ee==="assert"?new ca(X,[j]):ee==="coerce"?new To(X,[j]):j}if(a!==null&&typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"||(a=["literal",a]),Array.isArray(a)){if(a.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var m=a[0];if(typeof m!="string")return this.error("Expression name must be a string, but found "+typeof m+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var _=this.registry[m];if(_){var S=_.parse(a,this);if(!S)return null;if(this.expectedType){var A=this.expectedType,P=S.type;if(A.kind!=="string"&&A.kind!=="number"&&A.kind!=="boolean"&&A.kind!=="object"&&A.kind!=="array"||P.kind!=="value")if(A.kind!=="color"&&A.kind!=="formatted"&&A.kind!=="resolvedImage"||P.kind!=="value"&&P.kind!=="string"){if(this.checkSubtype(A,P))return null}else S=c(S,A,s.typeAnnotation||"coerce");else S=c(S,A,s.typeAnnotation||"assert")}if(!(S instanceof no)&&S.type.kind!=="resolvedImage"&&function j(X){if(X instanceof Ts)return j(X.boundExpression);if(X instanceof ao&&X.name==="error"||X instanceof Wo||X instanceof Do)return!1;var ee=X instanceof To||X instanceof ca,fe=!0;return X.eachChild(function(xe){fe=ee?fe&&j(xe):fe&&xe instanceof no}),!!fe&&mo(X)&&As(X,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(S)){var F=new ha;try{S=new no(S.type,S.evaluate(F))}catch(j){return this.error(j.message),null}}return S}return this.error('Unknown expression "'+m+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(a===void 0?"'undefined' value invalid. Use null instead.":typeof a=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof a+" instead.")},Ks.prototype.concat=function(a,s,c){var m=typeof a=="number"?this.path.concat(a):this.path,_=c?this.scope.concat(c):this.scope;return new Ks(this.registry,m,s||null,_,this.errors)},Ks.prototype.error=function(a){for(var s=[],c=arguments.length-1;c-- >0;)s[c]=arguments[c+1];var m=""+this.key+s.map(function(_){return"["+_+"]"}).join("");this.errors.push(new Lr(m,a))},Ks.prototype.checkSubtype=function(a,s){var c=Ji(a,s);return c&&this.error(c),c};var ps=function(a,s,c){this.type=a,this.input=s,this.labels=[],this.outputs=[];for(var m=0,_=c;m<_.length;m+=1){var S=_[m],A=S[1];this.labels.push(S[0]),this.outputs.push(A)}};function Zi(a,s,c){return a*(1-c)+s*c}ps.parse=function(a,s){if(a.length-1<4)return s.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if((a.length-1)%2!=0)return s.error("Expected an even number of arguments.");var c=s.parse(a[1],1,$t);if(!c)return null;var m=[],_=null;s.expectedType&&s.expectedType.kind!=="value"&&(_=s.expectedType);for(var S=1;S<a.length;S+=2){var A=S===1?-1/0:a[S],P=a[S+1],F=S,j=S+1;if(typeof A!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(m.length&&m[m.length-1][0]>=A)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',F);var X=s.parse(P,j,_);if(!X)return null;_=_||X.type,m.push([A,X])}return new ps(_,c,m)},ps.prototype.evaluate=function(a){var s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(a);var m=this.input.evaluate(a);if(m<=s[0])return c[0].evaluate(a);var _=s.length;return m>=s[_-1]?c[_-1].evaluate(a):c[cu(s,m)].evaluate(a)},ps.prototype.eachChild=function(a){a(this.input);for(var s=0,c=this.outputs;s<c.length;s+=1)a(c[s])},ps.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})},ps.prototype.serialize=function(){for(var a=["step",this.input.serialize()],s=0;s<this.labels.length;s++)s>0&&a.push(this.labels[s]),a.push(this.outputs[s].serialize());return a};var Ia=Object.freeze({__proto__:null,number:Zi,color:function(a,s,c){return new gr(Zi(a.r,s.r,c),Zi(a.g,s.g,c),Zi(a.b,s.b,c),Zi(a.a,s.a,c))},array:function(a,s,c){return a.map(function(m,_){return Zi(m,s[_],c)})}}),Oc=6/29*3*(6/29),ff=Math.PI/180,Ms=180/Math.PI;function hf(a){return a>.008856451679035631?Math.pow(a,1/3):a/Oc+4/29}function al(a){return a>6/29?a*a*a:Oc*(a-4/29)}function $u(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function Qs(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Pl(a){var s=Qs(a.r),c=Qs(a.g),m=Qs(a.b),_=hf((.4124564*s+.3575761*c+.1804375*m)/.95047),S=hf((.2126729*s+.7151522*c+.072175*m)/1);return{l:116*S-16,a:500*(_-S),b:200*(S-hf((.0193339*s+.119192*c+.9503041*m)/1.08883)),alpha:a.a}}function b(a){var s=(a.l+16)/116,c=isNaN(a.a)?s:s+a.a/500,m=isNaN(a.b)?s:s-a.b/200;return s=1*al(s),c=.95047*al(c),m=1.08883*al(m),new gr($u(3.2404542*c-1.5371385*s-.4985314*m),$u(-.969266*c+1.8760108*s+.041556*m),$u(.0556434*c-.2040259*s+1.0572252*m),a.alpha)}function k(a,s,c){var m=s-a;return a+c*(m>180||m<-180?m-360*Math.round(m/360):m)}var U={forward:Pl,reverse:b,interpolate:function(a,s,c){return{l:Zi(a.l,s.l,c),a:Zi(a.a,s.a,c),b:Zi(a.b,s.b,c),alpha:Zi(a.alpha,s.alpha,c)}}},R={forward:function(a){var s=Pl(a),c=s.l,m=s.a,_=s.b,S=Math.atan2(_,m)*Ms;return{h:S<0?S+360:S,c:Math.sqrt(m*m+_*_),l:c,alpha:a.a}},reverse:function(a){var s=a.h*ff,c=a.c;return b({l:a.l,a:Math.cos(s)*c,b:Math.sin(s)*c,alpha:a.alpha})},interpolate:function(a,s,c){return{h:k(a.h,s.h,c),c:Zi(a.c,s.c,c),l:Zi(a.l,s.l,c),alpha:Zi(a.alpha,s.alpha,c)}}},ie=Object.freeze({__proto__:null,lab:U,hcl:R}),Pe=function(a,s,c,m,_){this.type=a,this.operator=s,this.interpolation=c,this.input=m,this.labels=[],this.outputs=[];for(var S=0,A=_;S<A.length;S+=1){var P=A[S],F=P[1];this.labels.push(P[0]),this.outputs.push(F)}};function ct(a,s,c,m){var _=m-c,S=a-c;return _===0?0:s===1?S/_:(Math.pow(s,S)-1)/(Math.pow(s,_)-1)}Pe.interpolationFactor=function(a,s,c,m){var _=0;if(a.name==="exponential")_=ct(s,a.base,c,m);else if(a.name==="linear")_=ct(s,1,c,m);else if(a.name==="cubic-bezier"){var S=a.controlPoints;_=new W(S[0],S[1],S[2],S[3]).solve(ct(s,1,c,m))}return _},Pe.parse=function(a,s){var c=a[0],m=a[1],_=a[2],S=a.slice(3);if(!Array.isArray(m)||m.length===0)return s.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){var A=m[1];if(typeof A!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:A}}else{if(m[0]!=="cubic-bezier")return s.error("Unknown interpolation type "+String(m[0]),1,0);var P=m.slice(1);if(P.length!==4||P.some(function(pt){return typeof pt!="number"||pt<0||pt>1}))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:P}}if(a.length-1<4)return s.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if((a.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(!(_=s.parse(_,2,$t)))return null;var F=[],j=null;c==="interpolate-hcl"||c==="interpolate-lab"?j=St:s.expectedType&&s.expectedType.kind!=="value"&&(j=s.expectedType);for(var X=0;X<S.length;X+=2){var ee=S[X],fe=S[X+1],xe=X+3,je=X+4;if(typeof ee!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',xe);if(F.length&&F[F.length-1][0]>=ee)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',xe);var He=s.parse(fe,je,j);if(!He)return null;j=j||He.type,F.push([ee,He])}return j.kind==="number"||j.kind==="color"||j.kind==="array"&&j.itemType.kind==="number"&&typeof j.N=="number"?new Pe(j,c,m,_,F):s.error("Type "+Ri(j)+" is not interpolatable.")},Pe.prototype.evaluate=function(a){var s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(a);var m=this.input.evaluate(a);if(m<=s[0])return c[0].evaluate(a);var _=s.length;if(m>=s[_-1])return c[_-1].evaluate(a);var S=cu(s,m),A=Pe.interpolationFactor(this.interpolation,m,s[S],s[S+1]),P=c[S].evaluate(a),F=c[S+1].evaluate(a);return this.operator==="interpolate"?Ia[this.type.kind.toLowerCase()](P,F,A):this.operator==="interpolate-hcl"?R.reverse(R.interpolate(R.forward(P),R.forward(F),A)):U.reverse(U.interpolate(U.forward(P),U.forward(F),A))},Pe.prototype.eachChild=function(a){a(this.input);for(var s=0,c=this.outputs;s<c.length;s+=1)a(c[s])},Pe.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})},Pe.prototype.serialize=function(){var a;a=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var s=[this.operator,a,this.input.serialize()],c=0;c<this.labels.length;c++)s.push(this.labels[c],this.outputs[c].serialize());return s};var Ft=function(a,s){this.type=a,this.args=s};Ft.parse=function(a,s){if(a.length<2)return s.error("Expectected at least one argument.");var c=null,m=s.expectedType;m&&m.kind!=="value"&&(c=m);for(var _=[],S=0,A=a.slice(1);S<A.length;S+=1){var P=s.parse(A[S],1+_.length,c,void 0,{typeAnnotation:"omit"});if(!P)return null;c=c||P.type,_.push(P)}var F=m&&_.some(function(j){return Ji(m,j.type)});return new Ft(F?mn:c,_)},Ft.prototype.evaluate=function(a){for(var s,c=null,m=0,_=0,S=this.args;_<S.length&&(m++,(c=S[_].evaluate(a))&&c instanceof De&&!c.available&&(s||(s=c.name),c=null,m===this.args.length&&(c=s)),c===null);_+=1);return c},Ft.prototype.eachChild=function(a){this.args.forEach(a)},Ft.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},Ft.prototype.serialize=function(){var a=["coalesce"];return this.eachChild(function(s){a.push(s.serialize())}),a};var Bt=function(a,s){this.type=s.type,this.bindings=[].concat(a),this.result=s};Bt.prototype.evaluate=function(a){return this.result.evaluate(a)},Bt.prototype.eachChild=function(a){for(var s=0,c=this.bindings;s<c.length;s+=1)a(c[s][1]);a(this.result)},Bt.parse=function(a,s){if(a.length<4)return s.error("Expected at least 3 arguments, but found "+(a.length-1)+" instead.");for(var c=[],m=1;m<a.length-1;m+=2){var _=a[m];if(typeof _!="string")return s.error("Expected string, but found "+typeof _+" instead.",m);if(/[^a-zA-Z0-9_]/.test(_))return s.error("Variable names must contain only alphanumeric characters or '_'.",m);var S=s.parse(a[m+1],m+1);if(!S)return null;c.push([_,S])}var A=s.parse(a[a.length-1],a.length-1,s.expectedType,c);return A?new Bt(c,A):null},Bt.prototype.outputDefined=function(){return this.result.outputDefined()},Bt.prototype.serialize=function(){for(var a=["let"],s=0,c=this.bindings;s<c.length;s+=1){var m=c[s];a.push(m[0],m[1].serialize())}return a.push(this.result.serialize()),a};var Er=function(a,s,c){this.type=a,this.index=s,this.input=c};Er.parse=function(a,s){if(a.length!==3)return s.error("Expected 2 arguments, but found "+(a.length-1)+" instead.");var c=s.parse(a[1],1,$t),m=s.parse(a[2],2,wt(s.expectedType||mn));return c&&m?new Er(m.type.itemType,c,m):null},Er.prototype.evaluate=function(a){var s=this.index.evaluate(a),c=this.input.evaluate(a);if(s<0)throw new Wa("Array index out of bounds: "+s+" < 0.");if(s>=c.length)throw new Wa("Array index out of bounds: "+s+" > "+(c.length-1)+".");if(s!==Math.floor(s))throw new Wa("Array index must be an integer, but found "+s+" instead.");return c[s]},Er.prototype.eachChild=function(a){a(this.index),a(this.input)},Er.prototype.outputDefined=function(){return!1},Er.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Zr=function(a,s){this.type=hr,this.needle=a,this.haystack=s};Zr.parse=function(a,s){if(a.length!==3)return s.error("Expected 2 arguments, but found "+(a.length-1)+" instead.");var c=s.parse(a[1],1,mn),m=s.parse(a[2],2,mn);return c&&m?ea(c.type,[hr,Cn,$t,Mn,mn])?new Zr(c,m):s.error("Expected first argument to be of type boolean, string, number or null, but found "+Ri(c.type)+" instead"):null},Zr.prototype.evaluate=function(a){var s=this.needle.evaluate(a),c=this.haystack.evaluate(a);if(!c)return!1;if(!la(s,["boolean","string","number","null"]))throw new Wa("Expected first argument to be of type boolean, string, number or null, but found "+Ri(ia(s))+" instead.");if(!la(c,["string","array"]))throw new Wa("Expected second argument to be of type array or string, but found "+Ri(ia(c))+" instead.");return c.indexOf(s)>=0},Zr.prototype.eachChild=function(a){a(this.needle),a(this.haystack)},Zr.prototype.outputDefined=function(){return!0},Zr.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Wn=function(a,s,c){this.type=$t,this.needle=a,this.haystack=s,this.fromIndex=c};Wn.parse=function(a,s){if(a.length<=2||a.length>=5)return s.error("Expected 3 or 4 arguments, but found "+(a.length-1)+" instead.");var c=s.parse(a[1],1,mn),m=s.parse(a[2],2,mn);if(!c||!m)return null;if(!ea(c.type,[hr,Cn,$t,Mn,mn]))return s.error("Expected first argument to be of type boolean, string, number or null, but found "+Ri(c.type)+" instead");if(a.length===4){var _=s.parse(a[3],3,$t);return _?new Wn(c,m,_):null}return new Wn(c,m)},Wn.prototype.evaluate=function(a){var s=this.needle.evaluate(a),c=this.haystack.evaluate(a);if(!la(s,["boolean","string","number","null"]))throw new Wa("Expected first argument to be of type boolean, string, number or null, but found "+Ri(ia(s))+" instead.");if(!la(c,["string","array"]))throw new Wa("Expected second argument to be of type array or string, but found "+Ri(ia(c))+" instead.");if(this.fromIndex){var m=this.fromIndex.evaluate(a);return c.indexOf(s,m)}return c.indexOf(s)},Wn.prototype.eachChild=function(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)},Wn.prototype.outputDefined=function(){return!1},Wn.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var a=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),a]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var ti=function(a,s,c,m,_,S){this.inputType=a,this.type=s,this.input=c,this.cases=m,this.outputs=_,this.otherwise=S};ti.parse=function(a,s){if(a.length<5)return s.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if(a.length%2!=1)return s.error("Expected an even number of arguments.");var c,m;s.expectedType&&s.expectedType.kind!=="value"&&(m=s.expectedType);for(var _={},S=[],A=2;A<a.length-1;A+=2){var P=a[A],F=a[A+1];Array.isArray(P)||(P=[P]);var j=s.concat(A);if(P.length===0)return j.error("Expected at least one branch label.");for(var X=0,ee=P;X<ee.length;X+=1){var fe=ee[X];if(typeof fe!="number"&&typeof fe!="string")return j.error("Branch labels must be numbers or strings.");if(typeof fe=="number"&&Math.abs(fe)>Number.MAX_SAFE_INTEGER)return j.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof fe=="number"&&Math.floor(fe)!==fe)return j.error("Numeric branch labels must be integer values.");if(c){if(j.checkSubtype(c,ia(fe)))return null}else c=ia(fe);if(_[String(fe)]!==void 0)return j.error("Branch labels must be unique.");_[String(fe)]=S.length}var xe=s.parse(F,A,m);if(!xe)return null;m=m||xe.type,S.push(xe)}var je=s.parse(a[1],1,mn);if(!je)return null;var He=s.parse(a[a.length-1],a.length-1,m);return He?je.type.kind!=="value"&&s.concat(1).checkSubtype(c,je.type)?null:new ti(c,m,je,_,S,He):null},ti.prototype.evaluate=function(a){var s=this.input.evaluate(a);return(ia(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(a)},ti.prototype.eachChild=function(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)},ti.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})&&this.otherwise.outputDefined()},ti.prototype.serialize=function(){for(var a=this,s=["match",this.input.serialize()],c=[],m={},_=0,S=Object.keys(this.cases).sort();_<S.length;_+=1){var A=S[_];(ee=m[this.cases[A]])===void 0?(m[this.cases[A]]=c.length,c.push([this.cases[A],[A]])):c[ee][1].push(A)}for(var P=function(xe){return a.inputType.kind==="number"?Number(xe):xe},F=0,j=c;F<j.length;F+=1){var X=j[F],ee=X[0],fe=X[1];s.push(fe.length===1?P(fe[0]):fe.map(P)),s.push(this.outputs[outputIndex$1].serialize())}return s.push(this.otherwise.serialize()),s};var gi=function(a,s,c){this.type=a,this.branches=s,this.otherwise=c};gi.parse=function(a,s){if(a.length<4)return s.error("Expected at least 3 arguments, but found only "+(a.length-1)+".");if(a.length%2!=0)return s.error("Expected an odd number of arguments.");var c;s.expectedType&&s.expectedType.kind!=="value"&&(c=s.expectedType);for(var m=[],_=1;_<a.length-1;_+=2){var S=s.parse(a[_],_,hr);if(!S)return null;var A=s.parse(a[_+1],_+1,c);if(!A)return null;m.push([S,A]),c=c||A.type}var P=s.parse(a[a.length-1],a.length-1,c);return P?new gi(c,m,P):null},gi.prototype.evaluate=function(a){for(var s=0,c=this.branches;s<c.length;s+=1){var m=c[s],_=m[1];if(m[0].evaluate(a))return _.evaluate(a)}return this.otherwise.evaluate(a)},gi.prototype.eachChild=function(a){for(var s=0,c=this.branches;s<c.length;s+=1){var m=c[s],_=m[1];a(m[0]),a(_)}a(this.otherwise)},gi.prototype.outputDefined=function(){return this.branches.every(function(a){return a[1].outputDefined()})&&this.otherwise.outputDefined()},gi.prototype.serialize=function(){var a=["case"];return this.eachChild(function(s){a.push(s.serialize())}),a};var $i=function(a,s,c,m){this.type=a,this.input=s,this.beginIndex=c,this.endIndex=m};function wa(a,s){return a==="=="||a==="!="?s.kind==="boolean"||s.kind==="string"||s.kind==="number"||s.kind==="null"||s.kind==="value":s.kind==="string"||s.kind==="number"||s.kind==="value"}function Oa(a,s,c,m){return m.compare(s,c)===0}function Yi(a,s,c){var m=a!=="=="&&a!=="!=";return function(){function _(S,A,P){this.type=hr,this.lhs=S,this.rhs=A,this.collator=P,this.hasUntypedArgument=S.type.kind==="value"||A.type.kind==="value"}return _.parse=function(S,A){if(S.length!==3&&S.length!==4)return A.error("Expected two or three arguments.");var P=S[0],F=A.parse(S[1],1,mn);if(!F)return null;if(!wa(P,F.type))return A.concat(1).error('"'+P+`" comparisons are not supported for type '`+Ri(F.type)+"'.");var j=A.parse(S[2],2,mn);if(!j)return null;if(!wa(P,j.type))return A.concat(2).error('"'+P+`" comparisons are not supported for type '`+Ri(j.type)+"'.");if(F.type.kind!==j.type.kind&&F.type.kind!=="value"&&j.type.kind!=="value")return A.error("Cannot compare types '"+Ri(F.type)+"' and '"+Ri(j.type)+"'.");m&&(F.type.kind==="value"&&j.type.kind!=="value"?F=new ca(j.type,[F]):F.type.kind!=="value"&&j.type.kind==="value"&&(j=new ca(F.type,[j])));var X=null;if(S.length===4){if(F.type.kind!=="string"&&j.type.kind!=="string"&&F.type.kind!=="value"&&j.type.kind!=="value")return A.error("Cannot use collator to compare non-string types.");if(!(X=A.parse(S[3],3,Oi)))return null}return new _(F,j,X)},_.prototype.evaluate=function(S){var A=this.lhs.evaluate(S),P=this.rhs.evaluate(S);if(m&&this.hasUntypedArgument){var F=ia(A),j=ia(P);if(F.kind!==j.kind||F.kind!=="string"&&F.kind!=="number")throw new Wa('Expected arguments for "'+a+'" to be (string, string) or (number, number), but found ('+F.kind+", "+j.kind+") instead.")}if(this.collator&&!m&&this.hasUntypedArgument){var X=ia(A),ee=ia(P);if(X.kind!=="string"||ee.kind!=="string")return s(S,A,P)}return this.collator?c(S,A,P,this.collator.evaluate(S)):s(S,A,P)},_.prototype.eachChild=function(S){S(this.lhs),S(this.rhs),this.collator&&S(this.collator)},_.prototype.outputDefined=function(){return!0},_.prototype.serialize=function(){var S=[a];return this.eachChild(function(A){S.push(A.serialize())}),S},_}()}$i.parse=function(a,s){if(a.length<=2||a.length>=5)return s.error("Expected 3 or 4 arguments, but found "+(a.length-1)+" instead.");var c=s.parse(a[1],1,mn),m=s.parse(a[2],2,$t);if(!c||!m)return null;if(!ea(c.type,[wt(mn),Cn,mn]))return s.error("Expected first argument to be of type array or string, but found "+Ri(c.type)+" instead");if(a.length===4){var _=s.parse(a[3],3,$t);return _?new $i(c.type,c,m,_):null}return new $i(c.type,c,m)},$i.prototype.evaluate=function(a){var s=this.input.evaluate(a),c=this.beginIndex.evaluate(a);if(!la(s,["string","array"]))throw new Wa("Expected first argument to be of type array or string, but found "+Ri(ia(s))+" instead.");if(this.endIndex){var m=this.endIndex.evaluate(a);return s.slice(c,m)}return s.slice(c)},$i.prototype.eachChild=function(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)},$i.prototype.outputDefined=function(){return!1},$i.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var a=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),a]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var ds=Yi("==",function(a,s,c){return s===c},Oa),fu=Yi("!=",function(a,s,c){return s!==c},function(a,s,c,m){return!Oa(0,s,c,m)}),ol=Yi("<",function(a,s,c){return s<c},function(a,s,c,m){return m.compare(s,c)<0}),pf=Yi(">",function(a,s,c){return s>c},function(a,s,c,m){return m.compare(s,c)>0}),sl=Yi("<=",function(a,s,c){return s<=c},function(a,s,c,m){return m.compare(s,c)<=0}),Lc=Yi(">=",function(a,s,c){return s>=c},function(a,s,c,m){return m.compare(s,c)>=0}),Bu=function(a,s,c,m,_){this.type=Cn,this.number=a,this.locale=s,this.currency=c,this.minFractionDigits=m,this.maxFractionDigits=_};Bu.parse=function(a,s){if(a.length!==3)return s.error("Expected two arguments.");var c=s.parse(a[1],1,$t);if(!c)return null;var m=a[2];if(typeof m!="object"||Array.isArray(m))return s.error("NumberFormat options argument must be an object.");var _=null;if(m.locale&&!(_=s.parse(m.locale,1,Cn)))return null;var S=null;if(m.currency&&!(S=s.parse(m.currency,1,Cn)))return null;var A=null;if(m["min-fraction-digits"]&&!(A=s.parse(m["min-fraction-digits"],1,$t)))return null;var P=null;return m["max-fraction-digits"]&&!(P=s.parse(m["max-fraction-digits"],1,$t))?null:new Bu(c,_,S,A,P)},Bu.prototype.evaluate=function(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))},Bu.prototype.eachChild=function(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)},Bu.prototype.outputDefined=function(){return!1},Bu.prototype.serialize=function(){var a={};return this.locale&&(a.locale=this.locale.serialize()),this.currency&&(a.currency=this.currency.serialize()),this.minFractionDigits&&(a["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(a["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),a]};var Nu=function(a){this.type=$t,this.input=a};Nu.parse=function(a,s){if(a.length!==2)return s.error("Expected 1 argument, but found "+(a.length-1)+" instead.");var c=s.parse(a[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?s.error("Expected argument of type string or array, but found "+Ri(c.type)+" instead."):new Nu(c):null},Nu.prototype.evaluate=function(a){var s=this.input.evaluate(a);if(typeof s=="string"||Array.isArray(s))return s.length;throw new Wa("Expected value to be of type string or array, but found "+Ri(ia(s))+" instead.")},Nu.prototype.eachChild=function(a){a(this.input)},Nu.prototype.outputDefined=function(){return!1},Nu.prototype.serialize=function(){var a=["length"];return this.eachChild(function(s){a.push(s.serialize())}),a};var zu={"==":ds,"!=":fu,">":pf,"<":ol,">=":Lc,"<=":sl,array:ca,at:Er,boolean:ca,case:gi,coalesce:Ft,collator:Wo,format:Ho,image:Jo,in:Zr,"index-of":Wn,interpolate:Pe,"interpolate-hcl":Pe,"interpolate-lab":Pe,length:Nu,let:Bt,literal:no,match:ti,number:ca,"number-format":Bu,object:ca,slice:$i,step:ps,string:ca,"to-boolean":To,"to-color":To,"to-number":To,"to-string":To,var:Ts,within:Do};function go(a,s){var c=s[0],m=s[1],_=s[2],S=s[3];c=c.evaluate(a),m=m.evaluate(a),_=_.evaluate(a);var A=S?S.evaluate(a):1,P=ws(c,m,_,A);if(P)throw new Wa(P);return new gr(c/255*A,m/255*A,_/255*A,A)}function Uf(a,s){return a in s}function Dc(a,s){var c=s[a];return c===void 0?null:c}function vs(a){return{type:a}}function df(a){return{result:"success",value:a}}function Yu(a){return{result:"error",value:a}}function Js(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function Vf(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function js(a){return!!a.expression&&a.expression.interpolated}function Ta(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function Rl(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function Mh(a){return a}function Zu(a,s,c){return a!==void 0?a:s!==void 0?s:c!==void 0?c:void 0}function Fc(a,s,c,m,_){return Zu(typeof c===_?m[c]:void 0,a.default,s.default)}function op(a,s,c){if(Ta(c)!=="number")return Zu(a.default,s.default);var m=a.stops.length;if(m===1||c<=a.stops[0][0])return a.stops[0][1];if(c>=a.stops[m-1][0])return a.stops[m-1][1];var _=cu(a.stops.map(function(S){return S[0]}),c);return a.stops[_][1]}function sp(a,s,c){var m=a.base!==void 0?a.base:1;if(Ta(c)!=="number")return Zu(a.default,s.default);var _=a.stops.length;if(_===1||c<=a.stops[0][0])return a.stops[0][1];if(c>=a.stops[_-1][0])return a.stops[_-1][1];var S=cu(a.stops.map(function(ee){return ee[0]}),c),A=function(ee,fe,xe,je){var He=je-xe,pt=ee-xe;return He===0?0:fe===1?pt/He:(Math.pow(fe,pt)-1)/(Math.pow(fe,He)-1)}(c,m,a.stops[S][0],a.stops[S+1][0]),P=a.stops[S][1],F=a.stops[S+1][1],j=Ia[s.type]||Mh;if(a.colorSpace&&a.colorSpace!=="rgb"){var X=ie[a.colorSpace];j=function(ee,fe){return X.reverse(X.interpolate(X.forward(ee),X.forward(fe),A))}}return typeof P.evaluate=="function"?{evaluate:function(){for(var ee=[],fe=arguments.length;fe--;)ee[fe]=arguments[fe];var xe=P.evaluate.apply(void 0,ee),je=F.evaluate.apply(void 0,ee);if(xe!==void 0&&je!==void 0)return j(xe,je,A)}}:j(P,F,A)}function jf(a,s,c){return s.type==="color"?c=gr.parse(c):s.type==="formatted"?c=Aa.fromString(c.toString()):s.type==="resolvedImage"?c=De.fromString(c.toString()):Ta(c)===s.type||s.type==="enum"&&s.values[c]||(c=void 0),Zu(c,a.default,s.default)}ao.register(zu,{error:[{kind:"error"},[Cn],function(a,s){throw new Wa(s[0].evaluate(a))}],typeof:[Cn,[mn],function(a,s){return Ri(ia(s[0].evaluate(a)))}],"to-rgba":[wt($t,4),[St],function(a,s){return s[0].evaluate(a).toArray()}],rgb:[St,[$t,$t,$t],go],rgba:[St,[$t,$t,$t,$t],go],has:{type:hr,overloads:[[[Cn],function(a,s){return Uf(s[0].evaluate(a),a.properties())}],[[Cn,Ei],function(a,s){var c=s[1];return Uf(s[0].evaluate(a),c.evaluate(a))}]]},get:{type:mn,overloads:[[[Cn],function(a,s){return Dc(s[0].evaluate(a),a.properties())}],[[Cn,Ei],function(a,s){var c=s[1];return Dc(s[0].evaluate(a),c.evaluate(a))}]]},"feature-state":[mn,[Cn],function(a,s){return Dc(s[0].evaluate(a),a.featureState||{})}],properties:[Ei,[],function(a){return a.properties()}],"geometry-type":[Cn,[],function(a){return a.geometryType()}],id:[mn,[],function(a){return a.id()}],zoom:[$t,[],function(a){return a.globals.zoom}],"heatmap-density":[$t,[],function(a){return a.globals.heatmapDensity||0}],"line-progress":[$t,[],function(a){return a.globals.lineProgress||0}],accumulated:[mn,[],function(a){return a.globals.accumulated===void 0?null:a.globals.accumulated}],"+":[$t,vs($t),function(a,s){for(var c=0,m=0,_=s;m<_.length;m+=1)c+=_[m].evaluate(a);return c}],"*":[$t,vs($t),function(a,s){for(var c=1,m=0,_=s;m<_.length;m+=1)c*=_[m].evaluate(a);return c}],"-":{type:$t,overloads:[[[$t,$t],function(a,s){var c=s[1];return s[0].evaluate(a)-c.evaluate(a)}],[[$t],function(a,s){return-s[0].evaluate(a)}]]},"/":[$t,[$t,$t],function(a,s){var c=s[1];return s[0].evaluate(a)/c.evaluate(a)}],"%":[$t,[$t,$t],function(a,s){var c=s[1];return s[0].evaluate(a)%c.evaluate(a)}],ln2:[$t,[],function(){return Math.LN2}],pi:[$t,[],function(){return Math.PI}],e:[$t,[],function(){return Math.E}],"^":[$t,[$t,$t],function(a,s){var c=s[1];return Math.pow(s[0].evaluate(a),c.evaluate(a))}],sqrt:[$t,[$t],function(a,s){return Math.sqrt(s[0].evaluate(a))}],log10:[$t,[$t],function(a,s){return Math.log(s[0].evaluate(a))/Math.LN10}],ln:[$t,[$t],function(a,s){return Math.log(s[0].evaluate(a))}],log2:[$t,[$t],function(a,s){return Math.log(s[0].evaluate(a))/Math.LN2}],sin:[$t,[$t],function(a,s){return Math.sin(s[0].evaluate(a))}],cos:[$t,[$t],function(a,s){return Math.cos(s[0].evaluate(a))}],tan:[$t,[$t],function(a,s){return Math.tan(s[0].evaluate(a))}],asin:[$t,[$t],function(a,s){return Math.asin(s[0].evaluate(a))}],acos:[$t,[$t],function(a,s){return Math.acos(s[0].evaluate(a))}],atan:[$t,[$t],function(a,s){return Math.atan(s[0].evaluate(a))}],min:[$t,vs($t),function(a,s){return Math.min.apply(Math,s.map(function(c){return c.evaluate(a)}))}],max:[$t,vs($t),function(a,s){return Math.max.apply(Math,s.map(function(c){return c.evaluate(a)}))}],abs:[$t,[$t],function(a,s){return Math.abs(s[0].evaluate(a))}],round:[$t,[$t],function(a,s){var c=s[0].evaluate(a);return c<0?-Math.round(-c):Math.round(c)}],floor:[$t,[$t],function(a,s){return Math.floor(s[0].evaluate(a))}],ceil:[$t,[$t],function(a,s){return Math.ceil(s[0].evaluate(a))}],"filter-==":[hr,[Cn,mn],function(a,s){var c=s[0],m=s[1];return a.properties()[c.value]===m.value}],"filter-id-==":[hr,[mn],function(a,s){var c=s[0];return a.id()===c.value}],"filter-type-==":[hr,[Cn],function(a,s){var c=s[0];return a.geometryType()===c.value}],"filter-<":[hr,[Cn,mn],function(a,s){var c=s[0],m=s[1],_=a.properties()[c.value],S=m.value;return typeof _==typeof S&&_<S}],"filter-id-<":[hr,[mn],function(a,s){var c=s[0],m=a.id(),_=c.value;return typeof m==typeof _&&m<_}],"filter->":[hr,[Cn,mn],function(a,s){var c=s[0],m=s[1],_=a.properties()[c.value],S=m.value;return typeof _==typeof S&&_>S}],"filter-id->":[hr,[mn],function(a,s){var c=s[0],m=a.id(),_=c.value;return typeof m==typeof _&&m>_}],"filter-<=":[hr,[Cn,mn],function(a,s){var c=s[0],m=s[1],_=a.properties()[c.value],S=m.value;return typeof _==typeof S&&_<=S}],"filter-id-<=":[hr,[mn],function(a,s){var c=s[0],m=a.id(),_=c.value;return typeof m==typeof _&&m<=_}],"filter->=":[hr,[Cn,mn],function(a,s){var c=s[0],m=s[1],_=a.properties()[c.value],S=m.value;return typeof _==typeof S&&_>=S}],"filter-id->=":[hr,[mn],function(a,s){var c=s[0],m=a.id(),_=c.value;return typeof m==typeof _&&m>=_}],"filter-has":[hr,[mn],function(a,s){return s[0].value in a.properties()}],"filter-has-id":[hr,[],function(a){return a.id()!==null&&a.id()!==void 0}],"filter-type-in":[hr,[wt(Cn)],function(a,s){return s[0].value.indexOf(a.geometryType())>=0}],"filter-id-in":[hr,[wt(mn)],function(a,s){return s[0].value.indexOf(a.id())>=0}],"filter-in-small":[hr,[Cn,wt(mn)],function(a,s){var c=s[0];return s[1].value.indexOf(a.properties()[c.value])>=0}],"filter-in-large":[hr,[Cn,wt(mn)],function(a,s){var c=s[0],m=s[1];return function(_,S,A,P){for(;A<=P;){var F=A+P>>1;if(S[F]===_)return!0;S[F]>_?P=F-1:A=F+1}return!1}(a.properties()[c.value],m.value,0,m.value.length-1)}],all:{type:hr,overloads:[[[hr,hr],function(a,s){var c=s[1];return s[0].evaluate(a)&&c.evaluate(a)}],[vs(hr),function(a,s){for(var c=0,m=s;c<m.length;c+=1)if(!m[c].evaluate(a))return!1;return!0}]]},any:{type:hr,overloads:[[[hr,hr],function(a,s){var c=s[1];return s[0].evaluate(a)||c.evaluate(a)}],[vs(hr),function(a,s){for(var c=0,m=s;c<m.length;c+=1)if(m[c].evaluate(a))return!0;return!1}]]},"!":[hr,[hr],function(a,s){return!s[0].evaluate(a)}],"is-supported-script":[hr,[Cn],function(a,s){var c=a.globals&&a.globals.isSupportedScript;return!c||c(s[0].evaluate(a))}],upcase:[Cn,[Cn],function(a,s){return s[0].evaluate(a).toUpperCase()}],downcase:[Cn,[Cn],function(a,s){return s[0].evaluate(a).toLowerCase()}],concat:[Cn,vs(mn),function(a,s){return s.map(function(c){return Vs(c.evaluate(a))}).join("")}],"resolved-locale":[Cn,[Oi],function(a,s){return s[0].evaluate(a).resolvedLocale()}]});var Bc=function(a,s){this.expression=a,this._warningHistory={},this._evaluator=new ha,this._defaultValue=s?function(c){return c.type==="color"&&Rl(c.default)?new gr(0,0,0,0):c.type==="color"?gr.parse(c.default)||null:c.default===void 0?null:c.default}(s):null,this._enumValues=s&&s.type==="enum"?s.values:null};function ac(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in zu}function Ol(a,s){var c=new Ks(zu,[],s?function(_){var S={color:St,string:Cn,number:$t,enum:Cn,boolean:hr,formatted:ua,resolvedImage:xt};return _.type==="array"?wt(S[_.value]||mn,_.length):S[_.type]}(s):void 0),m=c.parse(a,void 0,void 0,void 0,s&&s.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?df(new Bc(m,s)):Yu(c.errors)}Bc.prototype.evaluateWithoutErrorHandling=function(a,s,c,m,_,S){return this._evaluator.globals=a,this._evaluator.feature=s,this._evaluator.featureState=c,this._evaluator.canonical=m,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=S,this.expression.evaluate(this._evaluator)},Bc.prototype.evaluate=function(a,s,c,m,_,S){this._evaluator.globals=a,this._evaluator.feature=s||null,this._evaluator.featureState=c||null,this._evaluator.canonical=m,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=S||null;try{var A=this.expression.evaluate(this._evaluator);if(A==null||typeof A=="number"&&A!=A)return this._defaultValue;if(this._enumValues&&!(A in this._enumValues))throw new Wa("Expected value to be one of "+Object.keys(this._enumValues).map(function(P){return JSON.stringify(P)}).join(", ")+", but found "+JSON.stringify(A)+" instead.");return A}catch(P){return this._warningHistory[P.message]||(this._warningHistory[P.message]=!0,typeof console!="undefined"&&console.warn(P.message)),this._defaultValue}};var Ll=function(a,s){this.kind=a,this._styleExpression=s,this.isStateDependent=a!=="constant"&&!Cs(s.expression)};Ll.prototype.evaluateWithoutErrorHandling=function(a,s,c,m,_,S){return this._styleExpression.evaluateWithoutErrorHandling(a,s,c,m,_,S)},Ll.prototype.evaluate=function(a,s,c,m,_,S){return this._styleExpression.evaluate(a,s,c,m,_,S)};var ul=function(a,s,c,m){this.kind=a,this.zoomStops=c,this._styleExpression=s,this.isStateDependent=a!=="camera"&&!Cs(s.expression),this.interpolationType=m};function ll(a,s){if((a=Ol(a,s)).result==="error")return a;var c=a.value.expression,m=mo(c);if(!m&&!Js(s))return Yu([new Lr("","data expressions not supported")]);var _=As(c,["zoom"]);if(!_&&!Vf(s))return Yu([new Lr("","zoom expressions not supported")]);var S=function A(P){var F=null;if(P instanceof Bt)F=A(P.result);else if(P instanceof Ft)for(var j=0,X=P.args;j<X.length&&!(F=A(X[j]));j+=1);else(P instanceof ps||P instanceof Pe)&&P.input instanceof ao&&P.input.name==="zoom"&&(F=P);return F instanceof Lr||P.eachChild(function(ee){var fe=A(ee);fe instanceof Lr?F=fe:!F&&fe?F=new Lr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):F&&fe&&F!==fe&&(F=new Lr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),F}(c);return S||_?S instanceof Lr?Yu([S]):S instanceof Pe&&!js(s)?Yu([new Lr("",'"interpolate" expressions cannot be used with this property')]):df(S?new ul(m?"camera":"composite",a.value,S.labels,S instanceof Pe?S.interpolation:void 0):new Ll(m?"constant":"source",a.value)):Yu([new Lr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}ul.prototype.evaluateWithoutErrorHandling=function(a,s,c,m,_,S){return this._styleExpression.evaluateWithoutErrorHandling(a,s,c,m,_,S)},ul.prototype.evaluate=function(a,s,c,m,_,S){return this._styleExpression.evaluate(a,s,c,m,_,S)},ul.prototype.interpolationFactor=function(a,s,c){return this.interpolationType?Pe.interpolationFactor(this.interpolationType,a,s,c):0};var cl=function(a,s){this._parameters=a,this._specification=s,Rr(this,function c(m,_){var S,A,P,F=_.type==="color",j=m.stops&&typeof m.stops[0][0]=="object",X=j||!(j||m.property!==void 0),ee=m.type||(js(_)?"exponential":"interval");if(F&&((m=Rr({},m)).stops&&(m.stops=m.stops.map(function(kn){return[kn[0],gr.parse(kn[1])]})),m.default=gr.parse(m.default?m.default:_.default)),m.colorSpace&&m.colorSpace!=="rgb"&&!ie[m.colorSpace])throw new Error("Unknown color space: "+m.colorSpace);if(ee==="exponential")S=sp;else if(ee==="interval")S=op;else if(ee==="categorical"){S=Fc,A=Object.create(null);for(var fe=0,xe=m.stops;fe<xe.length;fe+=1){var je=xe[fe];A[je[0]]=je[1]}P=typeof m.stops[0][0]}else{if(ee!=="identity")throw new Error('Unknown function type "'+ee+'"');S=jf}if(j){for(var He={},pt=[],nt=0;nt<m.stops.length;nt++){var kt=m.stops[nt],Gt=kt[0].zoom;He[Gt]===void 0&&(He[Gt]={zoom:Gt,type:m.type,property:m.property,default:m.default,stops:[]},pt.push(Gt)),He[Gt].stops.push([kt[0].value,kt[1]])}for(var sr=[],vr=0,fr=pt;vr<fr.length;vr+=1){var Hr=fr[vr];sr.push([He[Hr].zoom,c(He[Hr],_)])}var dn={name:"linear"};return{kind:"composite",interpolationType:dn,interpolationFactor:Pe.interpolationFactor.bind(void 0,dn),zoomStops:sr.map(function(kn){return kn[0]}),evaluate:function(kn,ai){var In=kn.zoom;return sp({stops:sr,base:m.base},_,In).evaluate(In,ai)}}}if(X){var Kn=ee==="exponential"?{name:"exponential",base:m.base!==void 0?m.base:1}:null;return{kind:"camera",interpolationType:Kn,interpolationFactor:Pe.interpolationFactor.bind(void 0,Kn),zoomStops:m.stops.map(function(kn){return kn[0]}),evaluate:function(kn){return S(m,_,kn.zoom,A,P)}}}return{kind:"source",evaluate:function(kn,ai){var In=ai&&ai.properties?ai.properties[m.property]:void 0;return In===void 0?Zu(m.default,_.default):S(m,_,In,A,P)}}}(this._parameters,this._specification))};function eu(a){var s=a.key,c=a.value,m=a.valueSpec||{},_=a.objectElementValidators||{},S=a.style,A=a.styleSpec,P=[],F=Ta(c);if(F!=="object")return[new $e(s,c,"object expected, "+F+" found")];for(var j in c){var X=j.split(".")[0],ee=m[X]||m["*"],fe=void 0;if(_[X])fe=_[X];else if(m[X])fe=Gi;else if(_["*"])fe=_["*"];else{if(!m["*"]){P.push(new $e(s,c[j],'unknown property "'+j+'"'));continue}fe=Gi}P=P.concat(fe({key:(s&&s+".")+j,value:c[j],valueSpec:ee,style:S,styleSpec:A,object:c,objectKey:j},c))}for(var xe in m)_[xe]||m[xe].required&&m[xe].default===void 0&&c[xe]===void 0&&P.push(new $e(s,c,'missing required property "'+xe+'"'));return P}function vf(a){var s=a.value,c=a.valueSpec,m=a.style,_=a.styleSpec,S=a.key,A=a.arrayElementValidator||Gi;if(Ta(s)!=="array")return[new $e(S,s,"array expected, "+Ta(s)+" found")];if(c.length&&s.length!==c.length)return[new $e(S,s,"array length "+c.length+" expected, length "+s.length+" found")];if(c["min-length"]&&s.length<c["min-length"])return[new $e(S,s,"array length at least "+c["min-length"]+" expected, length "+s.length+" found")];var P={type:c.value,values:c.values};_.$version<7&&(P.function=c.function),Ta(c.value)==="object"&&(P=c.value);for(var F=[],j=0;j<s.length;j++)F=F.concat(A({array:s,arrayIndex:j,value:s[j],valueSpec:P,style:m,styleSpec:_,key:S+"["+j+"]"}));return F}function mf(a){var s=a.key,c=a.value,m=a.valueSpec,_=Ta(c);return _==="number"&&c!=c&&(_="NaN"),_!=="number"?[new $e(s,c,"number expected, "+_+" found")]:"minimum"in m&&c<m.minimum?[new $e(s,c,c+" is less than the minimum value "+m.minimum)]:"maximum"in m&&c>m.maximum?[new $e(s,c,c+" is greater than the maximum value "+m.maximum)]:[]}function Dl(a){var s,c,m,_=a.valueSpec,S=nr(a.value.type),A={},P=S!=="categorical"&&a.value.property===void 0,F=!P,j=Ta(a.value.stops)==="array"&&Ta(a.value.stops[0])==="array"&&Ta(a.value.stops[0][0])==="object",X=eu({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(xe){if(S==="identity")return[new $e(xe.key,xe.value,'identity function may not have a "stops" property')];var je=[],He=xe.value;return je=je.concat(vf({key:xe.key,value:He,valueSpec:xe.valueSpec,style:xe.style,styleSpec:xe.styleSpec,arrayElementValidator:ee})),Ta(He)==="array"&&He.length===0&&je.push(new $e(xe.key,He,"array must have at least one stop")),je},default:function(xe){return Gi({key:xe.key,value:xe.value,valueSpec:_,style:xe.style,styleSpec:xe.styleSpec})}}});return S==="identity"&&P&&X.push(new $e(a.key,a.value,'missing required property "property"')),S==="identity"||a.value.stops||X.push(new $e(a.key,a.value,'missing required property "stops"')),S==="exponential"&&a.valueSpec.expression&&!js(a.valueSpec)&&X.push(new $e(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(F&&!Js(a.valueSpec)?X.push(new $e(a.key,a.value,"property functions not supported")):P&&!Vf(a.valueSpec)&&X.push(new $e(a.key,a.value,"zoom functions not supported"))),S!=="categorical"&&!j||a.value.property!==void 0||X.push(new $e(a.key,a.value,'"property" property is required')),X;function ee(xe){var je=[],He=xe.value,pt=xe.key;if(Ta(He)!=="array")return[new $e(pt,He,"array expected, "+Ta(He)+" found")];if(He.length!==2)return[new $e(pt,He,"array length 2 expected, length "+He.length+" found")];if(j){if(Ta(He[0])!=="object")return[new $e(pt,He,"object expected, "+Ta(He[0])+" found")];if(He[0].zoom===void 0)return[new $e(pt,He,"object stop key must have zoom")];if(He[0].value===void 0)return[new $e(pt,He,"object stop key must have value")];if(m&&m>nr(He[0].zoom))return[new $e(pt,He[0].zoom,"stop zoom values must appear in ascending order")];nr(He[0].zoom)!==m&&(m=nr(He[0].zoom),c=void 0,A={}),je=je.concat(eu({key:pt+"[0]",value:He[0],valueSpec:{zoom:{}},style:xe.style,styleSpec:xe.styleSpec,objectElementValidators:{zoom:mf,value:fe}}))}else je=je.concat(fe({key:pt+"[0]",value:He[0],valueSpec:{},style:xe.style,styleSpec:xe.styleSpec},He));return ac(lr(He[1]))?je.concat([new $e(pt+"[1]",He[1],"expressions are not allowed in function stops.")]):je.concat(Gi({key:pt+"[1]",value:He[1],valueSpec:_,style:xe.style,styleSpec:xe.styleSpec}))}function fe(xe,je){var He=Ta(xe.value),pt=nr(xe.value),nt=xe.value!==null?xe.value:je;if(s){if(He!==s)return[new $e(xe.key,nt,He+" stop domain type must match previous stop domain type "+s)]}else s=He;if(He!=="number"&&He!=="string"&&He!=="boolean")return[new $e(xe.key,nt,"stop domain value must be a number, string, or boolean")];if(He!=="number"&&S!=="categorical"){var kt="number expected, "+He+" found";return Js(_)&&S===void 0&&(kt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new $e(xe.key,nt,kt)]}return S!=="categorical"||He!=="number"||isFinite(pt)&&Math.floor(pt)===pt?S!=="categorical"&&He==="number"&&c!==void 0&&pt<c?[new $e(xe.key,nt,"stop domain values must appear in ascending order")]:(c=pt,S==="categorical"&&pt in A?[new $e(xe.key,nt,"stop domain values must be unique")]:(A[pt]=!0,[])):[new $e(xe.key,nt,"integer expected, found "+pt)]}}function fl(a){var s=(a.expressionContext==="property"?ll:Ol)(lr(a.value),a.valueSpec);if(s.result==="error")return s.value.map(function(m){return new $e(""+a.key+m.key,a.value,m.message)});var c=s.value.expression||s.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!c.outputDefined())return[new $e(a.key,a.value,'Invalid data expression for "'+a.propertyKey+'". Output values must be contained as literals within the expression.')];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!Cs(c))return[new $e(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!Cs(c))return[new $e(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!As(c,["zoom","feature-state"]))return[new $e(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!mo(c))return[new $e(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function oc(a){var s=a.key,c=a.value,m=a.valueSpec,_=[];return Array.isArray(m.values)?m.values.indexOf(nr(c))===-1&&_.push(new $e(s,c,"expected one of ["+m.values.join(", ")+"], "+JSON.stringify(c)+" found")):Object.keys(m.values).indexOf(nr(c))===-1&&_.push(new $e(s,c,"expected one of ["+Object.keys(m.values).join(", ")+"], "+JSON.stringify(c)+" found")),_}function Nc(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(var s=0,c=a.slice(1);s<c.length;s+=1){var m=c[s];if(!Nc(m)&&typeof m!="boolean")return!1}return!0;default:return!0}}cl.deserialize=function(a){return new cl(a._parameters,a._specification)},cl.serialize=function(a){return{_parameters:a._parameters,_specification:a._specification}};var sc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function gf(a){if(a==null)return{filter:function(){return!0},needGeometry:!1};Nc(a)||(a=yf(a));var s=Ol(a,sc);if(s.result==="error")throw new Error(s.value.map(function(c){return c.key+": "+c.message}).join(", "));return{filter:function(c,m,_){return s.value.evaluate(c,m,{},_)},needGeometry:function c(m){if(!Array.isArray(m))return!1;if(m[0]==="within")return!0;for(var _=1;_<m.length;_++)if(c(m[_]))return!0;return!1}(a)}}function up(a,s){return a<s?-1:a>s?1:0}function yf(a){if(!a)return!0;var s,c=a[0];return a.length<=1?c!=="any":c==="=="?hl(a[1],a[2],"=="):c==="!="?Uu(hl(a[1],a[2],"==")):c==="<"||c===">"||c==="<="||c===">="?hl(a[1],a[2],c):c==="any"?(s=a.slice(1),["any"].concat(s.map(yf))):c==="all"?["all"].concat(a.slice(1).map(yf)):c==="none"?["all"].concat(a.slice(1).map(yf).map(Uu)):c==="in"?_f(a[1],a.slice(2)):c==="!in"?Uu(_f(a[1],a.slice(2))):c==="has"?Gf(a[1]):c==="!has"?Uu(Gf(a[1])):c!=="within"||a}function hl(a,s,c){switch(a){case"$type":return["filter-type-"+c,s];case"$id":return["filter-id-"+c,s];default:return["filter-"+c,a,s]}}function _f(a,s){if(s.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",s]];case"$id":return["filter-id-in",["literal",s]];default:return s.length>200&&!s.some(function(c){return typeof c!=typeof s[0]})?["filter-in-large",a,["literal",s.sort(up)]]:["filter-in-small",a,["literal",s]]}}function Gf(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function Uu(a){return["!",a]}function kh(a){return Nc(lr(a.value))?fl(Rr({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function s(c){var m=c.value,_=c.key;if(Ta(m)!=="array")return[new $e(_,m,"array expected, "+Ta(m)+" found")];var S,A=c.styleSpec,P=[];if(m.length<1)return[new $e(_,m,"filter array must have at least 1 element")];switch(P=P.concat(oc({key:_+"[0]",value:m[0],valueSpec:A.filter_operator,style:c.style,styleSpec:c.styleSpec})),nr(m[0])){case"<":case"<=":case">":case">=":m.length>=2&&nr(m[1])==="$type"&&P.push(new $e(_,m,'"$type" cannot be use with operator "'+m[0]+'"'));case"==":case"!=":m.length!==3&&P.push(new $e(_,m,'filter array for operator "'+m[0]+'" must have 3 elements'));case"in":case"!in":m.length>=2&&(S=Ta(m[1]))!=="string"&&P.push(new $e(_+"[1]",m[1],"string expected, "+S+" found"));for(var F=2;F<m.length;F++)S=Ta(m[F]),nr(m[1])==="$type"?P=P.concat(oc({key:_+"["+F+"]",value:m[F],valueSpec:A.geometry_type,style:c.style,styleSpec:c.styleSpec})):S!=="string"&&S!=="number"&&S!=="boolean"&&P.push(new $e(_+"["+F+"]",m[F],"string, number, or boolean expected, "+S+" found"));break;case"any":case"all":case"none":for(var j=1;j<m.length;j++)P=P.concat(s({key:_+"["+j+"]",value:m[j],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":S=Ta(m[1]),m.length!==2?P.push(new $e(_,m,'filter array for "'+m[0]+'" operator must have 2 elements')):S!=="string"&&P.push(new $e(_+"[1]",m[1],"string expected, "+S+" found"));break;case"within":S=Ta(m[1]),m.length!==2?P.push(new $e(_,m,'filter array for "'+m[0]+'" operator must have 2 elements')):S!=="object"&&P.push(new $e(_+"[1]",m[1],"object expected, "+S+" found"))}return P}(a)}function Ih(a,s){var c=a.key,m=a.style,_=a.styleSpec,S=a.value,A=a.objectKey,P=_[s+"_"+a.layerType];if(!P)return[];var F=A.match(/^(.*)-transition$/);if(s==="paint"&&F&&P[F[1]]&&P[F[1]].transition)return Gi({key:c,value:S,valueSpec:_.transition,style:m,styleSpec:_});var j,X=a.valueSpec||P[A];if(!X)return[new $e(c,S,'unknown property "'+A+'"')];if(Ta(S)==="string"&&Js(X)&&!X.tokens&&(j=/^{([^}]+)}$/.exec(S)))return[new $e(c,S,'"'+A+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(j[1])+" }`.")];var ee=[];return a.layerType==="symbol"&&(A==="text-field"&&m&&!m.glyphs&&ee.push(new $e(c,S,'use of "text-field" requires a style "glyphs" property')),A==="text-font"&&Rl(lr(S))&&nr(S.type)==="identity"&&ee.push(new $e(c,S,'"text-font" does not support identity functions'))),ee.concat(Gi({key:a.key,value:S,valueSpec:X,style:m,styleSpec:_,expressionContext:"property",propertyType:s,propertyKey:A}))}function Ph(a){return Ih(a,"paint")}function Fl(a){return Ih(a,"layout")}function Rh(a){var s=[],c=a.value,m=a.key,_=a.style,S=a.styleSpec;c.type||c.ref||s.push(new $e(m,c,'either "type" or "ref" is required'));var A,P=nr(c.type),F=nr(c.ref);if(c.id)for(var j=nr(c.id),X=0;X<a.arrayIndex;X++){var ee=_.layers[X];nr(ee.id)===j&&s.push(new $e(m,c.id,'duplicate layer id "'+c.id+'", previously used at line '+ee.id.__line__))}if("ref"in c)["type","source","source-layer","filter","layout"].forEach(function(je){je in c&&s.push(new $e(m,c[je],'"'+je+'" is prohibited for ref layers'))}),_.layers.forEach(function(je){nr(je.id)===F&&(A=je)}),A?A.ref?s.push(new $e(m,c.ref,"ref cannot reference another ref layer")):P=nr(A.type):s.push(new $e(m,c.ref,'ref layer "'+F+'" not found'));else if(P!=="background")if(c.source){var fe=_.sources&&_.sources[c.source],xe=fe&&nr(fe.type);fe?xe==="vector"&&P==="raster"?s.push(new $e(m,c.source,'layer "'+c.id+'" requires a raster source')):xe==="raster"&&P!=="raster"?s.push(new $e(m,c.source,'layer "'+c.id+'" requires a vector source')):xe!=="vector"||c["source-layer"]?xe==="raster-dem"&&P!=="hillshade"?s.push(new $e(m,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):P!=="line"||!c.paint||!c.paint["line-gradient"]||xe==="geojson"&&fe.lineMetrics||s.push(new $e(m,c,'layer "'+c.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):s.push(new $e(m,c,'layer "'+c.id+'" must specify a "source-layer"')):s.push(new $e(m,c.source,'source "'+c.source+'" not found'))}else s.push(new $e(m,c,'missing required property "source"'));return s=s.concat(eu({key:m,value:c,valueSpec:S.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Gi({key:m+".type",value:c.type,valueSpec:S.layer.type,style:a.style,styleSpec:a.styleSpec,object:c,objectKey:"type"})},filter:kh,layout:function(je){return eu({layer:c,key:je.key,value:je.value,style:je.style,styleSpec:je.styleSpec,objectElementValidators:{"*":function(He){return Fl(Rr({layerType:P},He))}}})},paint:function(je){return eu({layer:c,key:je.key,value:je.value,style:je.style,styleSpec:je.styleSpec,objectElementValidators:{"*":function(He){return Ph(Rr({layerType:P},He))}}})}}}))}function rs(a){var s=a.value,c=a.key,m=Ta(s);return m!=="string"?[new $e(c,s,"string expected, "+m+" found")]:[]}var Ka={promoteId:function(a){var s=a.key,c=a.value;if(Ta(c)==="string")return rs({key:s,value:c});var m=[];for(var _ in c)m.push.apply(m,rs({key:s+"."+_,value:c[_]}));return m}};function pa(a){var s=a.value,c=a.key,m=a.styleSpec,_=a.style;if(!s.type)return[new $e(c,s,'"type" is required')];var S,A=nr(s.type);switch(A){case"vector":case"raster":case"raster-dem":return eu({key:c,value:s,valueSpec:m["source_"+A.replace("-","_")],style:a.style,styleSpec:m,objectElementValidators:Ka});case"geojson":if(S=eu({key:c,value:s,valueSpec:m.source_geojson,style:_,styleSpec:m,objectElementValidators:Ka}),s.cluster)for(var P in s.clusterProperties){var F=s.clusterProperties[P],j=F[0],X=typeof j=="string"?[j,["accumulated"],["get",P]]:j;S.push.apply(S,fl({key:c+"."+P+".map",value:F[1],expressionContext:"cluster-map"})),S.push.apply(S,fl({key:c+"."+P+".reduce",value:X,expressionContext:"cluster-reduce"}))}return S;case"video":return eu({key:c,value:s,valueSpec:m.source_video,style:_,styleSpec:m});case"image":return eu({key:c,value:s,valueSpec:m.source_image,style:_,styleSpec:m});case"canvas":return[new $e(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return oc({key:c+".type",value:s.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:_,styleSpec:m})}}function Bl(a){var s=a.value,c=a.styleSpec,m=c.light,_=a.style,S=[],A=Ta(s);if(s===void 0)return S;if(A!=="object")return S.concat([new $e("light",s,"object expected, "+A+" found")]);for(var P in s){var F=P.match(/^(.*)-transition$/);S=S.concat(F&&m[F[1]]&&m[F[1]].transition?Gi({key:P,value:s[P],valueSpec:c.transition,style:_,styleSpec:c}):m[P]?Gi({key:P,value:s[P],valueSpec:m[P],style:_,styleSpec:c}):[new $e(P,s[P],'unknown property "'+P+'"')])}return S}var qu={"*":function(){return[]},array:vf,boolean:function(a){var s=a.value,c=a.key,m=Ta(s);return m!=="boolean"?[new $e(c,s,"boolean expected, "+m+" found")]:[]},number:mf,color:function(a){var s=a.key,c=a.value,m=Ta(c);return m!=="string"?[new $e(s,c,"color expected, "+m+" found")]:Di(c)===null?[new $e(s,c,'color expected, "'+c+'" found')]:[]},constants:Zt,enum:oc,filter:kh,function:Dl,layer:Rh,object:eu,source:pa,light:Bl,string:rs,formatted:function(a){return rs(a).length===0?[]:fl(a)},resolvedImage:function(a){return rs(a).length===0?[]:fl(a)}};function Gi(a){var s=a.value,c=a.valueSpec,m=a.styleSpec;return c.expression&&Rl(nr(s))?Dl(a):c.expression&&ac(lr(s))?fl(a):c.type&&qu[c.type]?qu[c.type](a):eu(Rr({},a,{valueSpec:c.type?m[c.type]:c}))}function La(a){var s=a.value,c=a.key,m=rs(a);return m.length||(s.indexOf("{fontstack}")===-1&&m.push(new $e(c,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&m.push(new $e(c,s,'"glyphs" url must include a "{range}" token'))),m}function Rs(a,s){s===void 0&&(s=Ce);var c=[];return c=c.concat(Gi({key:"",value:a,valueSpec:s.$root,styleSpec:s,style:a,objectElementValidators:{glyphs:La,"*":function(){return[]}}})),a.constants&&(c=c.concat(Zt({key:"constants",value:a.constants,style:a,styleSpec:s}))),zc(c)}function zc(a){return[].concat(a).sort(function(s,c){return s.line-c.line})}function Bi(a){return function(){for(var s=[],c=arguments.length;c--;)s[c]=arguments[c];return zc(a.apply(this,s))}}Rs.source=Bi(pa),Rs.light=Bi(Bl),Rs.layer=Bi(Rh),Rs.filter=Bi(kh),Rs.paintProperty=Bi(Ph),Rs.layoutProperty=Bi(Fl);var ks=Rs,Cu=ks.light,Nl=ks.paintProperty,Zc=ks.layoutProperty;function uc(a,s){var c=!1;if(s&&s.length)for(var m=0,_=s;m<_.length;m+=1)a.fire(new at(new Error(_[m].message))),c=!0;return c}var Au=Xo;function Xo(a,s,c){var m=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var _=new Int32Array(this.arrayBuffer);a=_[0],this.d=(s=_[1])+2*(c=_[2]);for(var S=0;S<this.d*this.d;S++){var A=_[3+S],P=_[3+S+1];m.push(A===P?null:_.subarray(A,P))}var F=_[3+m.length+1];this.keys=_.subarray(_[3+m.length],F),this.bboxes=_.subarray(F),this.insert=this._insertReadonly}else{this.d=s+2*c;for(var j=0;j<this.d*this.d;j++)m.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=a,this.padding=c,this.scale=s/a,this.uid=0;var X=c/s*a;this.min=-X,this.max=a+X}Xo.prototype.insert=function(a,s,c,m,_){this._forEachCell(s,c,m,_,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(m),this.bboxes.push(_)},Xo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Xo.prototype._insertCell=function(a,s,c,m,_,S){this.cells[_].push(S)},Xo.prototype.query=function(a,s,c,m,_){var S=this.min,A=this.max;if(a<=S&&s<=S&&A<=c&&A<=m&&!_)return Array.prototype.slice.call(this.keys);var P=[];return this._forEachCell(a,s,c,m,this._queryCell,P,{},_),P},Xo.prototype._queryCell=function(a,s,c,m,_,S,A,P){var F=this.cells[_];if(F!==null)for(var j=this.keys,X=this.bboxes,ee=0;ee<F.length;ee++){var fe=F[ee];if(A[fe]===void 0){var xe=4*fe;(P?P(X[xe+0],X[xe+1],X[xe+2],X[xe+3]):a<=X[xe+2]&&s<=X[xe+3]&&c>=X[xe+0]&&m>=X[xe+1])?(A[fe]=!0,S.push(j[fe])):A[fe]=!1}}},Xo.prototype._forEachCell=function(a,s,c,m,_,S,A,P){for(var F=this._convertToCellCoord(a),j=this._convertToCellCoord(s),X=this._convertToCellCoord(c),ee=this._convertToCellCoord(m),fe=F;fe<=X;fe++)for(var xe=j;xe<=ee;xe++){var je=this.d*xe+fe;if((!P||P(this._convertFromCellCoord(fe),this._convertFromCellCoord(xe),this._convertFromCellCoord(fe+1),this._convertFromCellCoord(xe+1)))&&_.call(this,a,s,c,m,je,S,A,P))return}},Xo.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},Xo.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},Xo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,s=3+this.cells.length+1+1,c=0,m=0;m<this.cells.length;m++)c+=this.cells[m].length;var _=new Int32Array(s+c+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;for(var S=s,A=0;A<a.length;A++){var P=a[A];_[3+A]=S,_.set(P,S),S+=P.length}return _[3+a.length]=S,_.set(this.keys,S),_[3+a.length+1]=S+=this.keys.length,_.set(this.bboxes,S),S+=this.bboxes.length,_.buffer};var lc=_e.ImageData,zl=_e.ImageBitmap,ko={};function Fn(a,s,c){c===void 0&&(c={}),Object.defineProperty(s,"_classRegistryKey",{value:a,writeable:!1}),ko[a]={klass:s,omit:c.omit||[],shallow:c.shallow||[]}}for(var ho in Fn("Object",Object),Au.serialize=function(a,s){var c=a.toArrayBuffer();return s&&s.push(c),{buffer:c}},Au.deserialize=function(a){return new Au(a.buffer)},Fn("Grid",Au),Fn("Color",gr),Fn("Error",Error),Fn("ResolvedImage",De),Fn("StylePropertyFunction",cl),Fn("StyleExpression",Bc,{omit:["_evaluator"]}),Fn("ZoomDependentExpression",ul),Fn("ZoomConstantExpression",Ll),Fn("CompoundExpression",ao,{omit:["_evaluate"]}),zu)zu[ho]._classRegistryKey||Fn("Expression_"+ho,zu[ho]);function Da(a){return a&&typeof ArrayBuffer!="undefined"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function pl(a){return zl&&a instanceof zl}function tu(a,s){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(Da(a)||pl(a))return s&&s.push(a),a;if(ArrayBuffer.isView(a)){var c=a;return s&&s.push(c.buffer),c}if(a instanceof lc)return s&&s.push(a.data.buffer),a;if(Array.isArray(a)){for(var m=[],_=0,S=a;_<S.length;_+=1)m.push(tu(S[_],s));return m}if(typeof a=="object"){var A=a.constructor,P=A._classRegistryKey;if(!P)throw new Error("can't serialize object of unregistered class");var F=A.serialize?A.serialize(a,s):{};if(!A.serialize){for(var j in a)if(a.hasOwnProperty(j)&&!(ko[P].omit.indexOf(j)>=0)){var X=a[j];F[j]=ko[P].shallow.indexOf(j)>=0?X:tu(X,s)}a instanceof Error&&(F.message=a.message)}if(F.$name)throw new Error("$name property is reserved for worker serialization logic.");return P!=="Object"&&(F.$name=P),F}throw new Error("can't serialize object of type "+typeof a)}function Gs(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||Da(a)||pl(a)||ArrayBuffer.isView(a)||a instanceof lc)return a;if(Array.isArray(a))return a.map(Gs);if(typeof a=="object"){var s=a.$name||"Object",c=ko[s].klass;if(!c)throw new Error("can't deserialize unregistered class "+s);if(c.deserialize)return c.deserialize(a);for(var m=Object.create(c.prototype),_=0,S=Object.keys(a);_<S.length;_+=1){var A=S[_];if(A!=="$name"){var P=a[A];m[A]=ko[s].shallow.indexOf(A)>=0?P:Gs(P)}}return m}throw new Error("can't deserialize object of type "+typeof a)}var xf=function(){this.first=!0};xf.prototype.update=function(a,s){var c=Math.floor(a);return this.first?(this.first=!1,this.lastIntegerZoom=c,this.lastIntegerZoomTime=0,this.lastZoom=a,this.lastFloorZoom=c,!0):(this.lastFloorZoom>c?(this.lastIntegerZoom=c+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<c&&(this.lastIntegerZoom=c,this.lastIntegerZoomTime=s),a!==this.lastZoom&&(this.lastZoom=a,this.lastFloorZoom=c,!0))};var vn={"Latin-1 Supplement":function(a){return a>=128&&a<=255},Arabic:function(a){return a>=1536&&a<=1791},"Arabic Supplement":function(a){return a>=1872&&a<=1919},"Arabic Extended-A":function(a){return a>=2208&&a<=2303},"Hangul Jamo":function(a){return a>=4352&&a<=4607},"Unified Canadian Aboriginal Syllabics":function(a){return a>=5120&&a<=5759},Khmer:function(a){return a>=6016&&a<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(a){return a>=6320&&a<=6399},"General Punctuation":function(a){return a>=8192&&a<=8303},"Letterlike Symbols":function(a){return a>=8448&&a<=8527},"Number Forms":function(a){return a>=8528&&a<=8591},"Miscellaneous Technical":function(a){return a>=8960&&a<=9215},"Control Pictures":function(a){return a>=9216&&a<=9279},"Optical Character Recognition":function(a){return a>=9280&&a<=9311},"Enclosed Alphanumerics":function(a){return a>=9312&&a<=9471},"Geometric Shapes":function(a){return a>=9632&&a<=9727},"Miscellaneous Symbols":function(a){return a>=9728&&a<=9983},"Miscellaneous Symbols and Arrows":function(a){return a>=11008&&a<=11263},"CJK Radicals Supplement":function(a){return a>=11904&&a<=12031},"Kangxi Radicals":function(a){return a>=12032&&a<=12255},"Ideographic Description Characters":function(a){return a>=12272&&a<=12287},"CJK Symbols and Punctuation":function(a){return a>=12288&&a<=12351},Hiragana:function(a){return a>=12352&&a<=12447},Katakana:function(a){return a>=12448&&a<=12543},Bopomofo:function(a){return a>=12544&&a<=12591},"Hangul Compatibility Jamo":function(a){return a>=12592&&a<=12687},Kanbun:function(a){return a>=12688&&a<=12703},"Bopomofo Extended":function(a){return a>=12704&&a<=12735},"CJK Strokes":function(a){return a>=12736&&a<=12783},"Katakana Phonetic Extensions":function(a){return a>=12784&&a<=12799},"Enclosed CJK Letters and Months":function(a){return a>=12800&&a<=13055},"CJK Compatibility":function(a){return a>=13056&&a<=13311},"CJK Unified Ideographs Extension A":function(a){return a>=13312&&a<=19903},"Yijing Hexagram Symbols":function(a){return a>=19904&&a<=19967},"CJK Unified Ideographs":function(a){return a>=19968&&a<=40959},"Yi Syllables":function(a){return a>=40960&&a<=42127},"Yi Radicals":function(a){return a>=42128&&a<=42191},"Hangul Jamo Extended-A":function(a){return a>=43360&&a<=43391},"Hangul Syllables":function(a){return a>=44032&&a<=55215},"Hangul Jamo Extended-B":function(a){return a>=55216&&a<=55295},"Private Use Area":function(a){return a>=57344&&a<=63743},"CJK Compatibility Ideographs":function(a){return a>=63744&&a<=64255},"Arabic Presentation Forms-A":function(a){return a>=64336&&a<=65023},"Vertical Forms":function(a){return a>=65040&&a<=65055},"CJK Compatibility Forms":function(a){return a>=65072&&a<=65103},"Small Form Variants":function(a){return a>=65104&&a<=65135},"Arabic Presentation Forms-B":function(a){return a>=65136&&a<=65279},"Halfwidth and Fullwidth Forms":function(a){return a>=65280&&a<=65519}};function cc(a){for(var s=0,c=a;s<c.length;s+=1)if(Zl(c[s].charCodeAt(0)))return!0;return!1}function Zl(a){return!(a!==746&&a!==747&&(a<4352||!(vn["Bopomofo Extended"](a)||vn.Bopomofo(a)||vn["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||vn["CJK Compatibility Ideographs"](a)||vn["CJK Compatibility"](a)||vn["CJK Radicals Supplement"](a)||vn["CJK Strokes"](a)||!(!vn["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||vn["CJK Unified Ideographs Extension A"](a)||vn["CJK Unified Ideographs"](a)||vn["Enclosed CJK Letters and Months"](a)||vn["Hangul Compatibility Jamo"](a)||vn["Hangul Jamo Extended-A"](a)||vn["Hangul Jamo Extended-B"](a)||vn["Hangul Jamo"](a)||vn["Hangul Syllables"](a)||vn.Hiragana(a)||vn["Ideographic Description Characters"](a)||vn.Kanbun(a)||vn["Kangxi Radicals"](a)||vn["Katakana Phonetic Extensions"](a)||vn.Katakana(a)&&a!==12540||!(!vn["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!vn["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||vn["Unified Canadian Aboriginal Syllabics"](a)||vn["Unified Canadian Aboriginal Syllabics Extended"](a)||vn["Vertical Forms"](a)||vn["Yijing Hexagram Symbols"](a)||vn["Yi Syllables"](a)||vn["Yi Radicals"](a))))}function Ku(a){return!(Zl(a)||function(s){return!!(vn["Latin-1 Supplement"](s)&&(s===167||s===169||s===174||s===177||s===188||s===189||s===190||s===215||s===247)||vn["General Punctuation"](s)&&(s===8214||s===8224||s===8225||s===8240||s===8241||s===8251||s===8252||s===8258||s===8263||s===8264||s===8265||s===8273)||vn["Letterlike Symbols"](s)||vn["Number Forms"](s)||vn["Miscellaneous Technical"](s)&&(s>=8960&&s<=8967||s>=8972&&s<=8991||s>=8996&&s<=9e3||s===9003||s>=9085&&s<=9114||s>=9150&&s<=9165||s===9167||s>=9169&&s<=9179||s>=9186&&s<=9215)||vn["Control Pictures"](s)&&s!==9251||vn["Optical Character Recognition"](s)||vn["Enclosed Alphanumerics"](s)||vn["Geometric Shapes"](s)||vn["Miscellaneous Symbols"](s)&&!(s>=9754&&s<=9759)||vn["Miscellaneous Symbols and Arrows"](s)&&(s>=11026&&s<=11055||s>=11088&&s<=11097||s>=11192&&s<=11243)||vn["CJK Symbols and Punctuation"](s)||vn.Katakana(s)||vn["Private Use Area"](s)||vn["CJK Compatibility Forms"](s)||vn["Small Form Variants"](s)||vn["Halfwidth and Fullwidth Forms"](s)||s===8734||s===8756||s===8757||s>=9984&&s<=10087||s>=10102&&s<=10131||s===65532||s===65533)}(a))}function Va(a){return a>=1424&&a<=2303||vn["Arabic Presentation Forms-A"](a)||vn["Arabic Presentation Forms-B"](a)}function Os(a,s){return!(!s&&Va(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||vn.Khmer(a))}function fc(a){for(var s=0,c=a;s<c.length;s+=1)if(Va(c[s].charCodeAt(0)))return!0;return!1}var Vu=null,Ls="unavailable",hu=null,bf=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(Ls="error"),Vu&&Vu(a)};function Uc(){Ef.fire(new Ve("pluginStateChange",{pluginStatus:Ls,pluginURL:hu}))}var Ef=new _t,Hf=function(){return Ls},ru=function(){if(Ls!=="deferred"||!hu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ls="loading",Uc(),hu&&ga({url:hu},function(a){a?bf(a):(Ls="loaded",Uc())})},ms={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Ls==="loaded"||ms.applyArabicShaping!=null},isLoading:function(){return Ls==="loading"},setState:function(a){Ls=a.pluginStatus,hu=a.pluginURL},isParsed:function(){return ms.applyArabicShaping!=null&&ms.processBidirectionalText!=null&&ms.processStyledBidirectionalText!=null},getPluginURL:function(){return hu}},Li=function(a,s){this.zoom=a,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new xf,this.transition={})};Li.prototype.isSupportedScript=function(a){return function(s,c){for(var m=0,_=s;m<_.length;m+=1)if(!Os(_[m].charCodeAt(0),c))return!1;return!0}(a,ms.isLoaded())},Li.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Li.prototype.getCrossfadeParameters=function(){var a=this.zoom,s=a-Math.floor(a),c=this.crossFadingFactor();return a>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*c}:{fromScale:.5,toScale:1,t:1-(1-c)*s}};var Tu=function(a,s){this.property=a,this.value=s,this.expression=function(c,m){if(Rl(c))return new cl(c,m);if(ac(c)){var _=ll(c,m);if(_.result==="error")throw new Error(_.value.map(function(A){return A.key+": "+A.message}).join(", "));return _.value}var S=c;return typeof c=="string"&&m.type==="color"&&(S=gr.parse(c)),{kind:"constant",evaluate:function(){return S}}}(s===void 0?a.specification.default:s,a.specification)};Tu.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Tu.prototype.possiblyEvaluate=function(a,s,c){return this.property.possiblyEvaluate(this,a,s,c)};var pu=function(a){this.property=a,this.value=new Tu(a,void 0)};pu.prototype.transitioned=function(a,s){return new Qu(this.property,this.value,s,Mt({},a.transition,this.transition),a.now)},pu.prototype.untransitioned=function(){return new Qu(this.property,this.value,null,{},0)};var ns=function(a){this._properties=a,this._values=Object.create(a.defaultTransitionablePropertyValues)};ns.prototype.getValue=function(a){return ft(this._values[a].value.value)},ns.prototype.setValue=function(a,s){this._values.hasOwnProperty(a)||(this._values[a]=new pu(this._values[a].property)),this._values[a].value=new Tu(this._values[a].property,s===null?void 0:ft(s))},ns.prototype.getTransition=function(a){return ft(this._values[a].transition)},ns.prototype.setTransition=function(a,s){this._values.hasOwnProperty(a)||(this._values[a]=new pu(this._values[a].property)),this._values[a].transition=ft(s)||void 0},ns.prototype.serialize=function(){for(var a={},s=0,c=Object.keys(this._values);s<c.length;s+=1){var m=c[s],_=this.getValue(m);_!==void 0&&(a[m]=_);var S=this.getTransition(m);S!==void 0&&(a[m+"-transition"]=S)}return a},ns.prototype.transitioned=function(a,s){for(var c=new dl(this._properties),m=0,_=Object.keys(this._values);m<_.length;m+=1){var S=_[m];c._values[S]=this._values[S].transitioned(a,s._values[S])}return c},ns.prototype.untransitioned=function(){for(var a=new dl(this._properties),s=0,c=Object.keys(this._values);s<c.length;s+=1){var m=c[s];a._values[m]=this._values[m].untransitioned()}return a};var Qu=function(a,s,c,m,_){this.property=a,this.value=s,this.begin=_+m.delay||0,this.end=this.begin+m.duration||0,a.specification.transition&&(m.delay||m.duration)&&(this.prior=c)};Qu.prototype.possiblyEvaluate=function(a,s,c){var m=a.now||0,_=this.value.possiblyEvaluate(a,s,c),S=this.prior;if(S){if(m>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(m<this.begin)return S.possiblyEvaluate(a,s,c);var A=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(S.possiblyEvaluate(a,s,c),_,function(P){if(P<=0)return 0;if(P>=1)return 1;var F=P*P,j=F*P;return 4*(P<.5?j:3*(P-F)+j-.75)}(A))}return _};var dl=function(a){this._properties=a,this._values=Object.create(a.defaultTransitioningPropertyValues)};dl.prototype.possiblyEvaluate=function(a,s,c){for(var m=new Hs(this._properties),_=0,S=Object.keys(this._values);_<S.length;_+=1){var A=S[_];m._values[A]=this._values[A].possiblyEvaluate(a,s,c)}return m},dl.prototype.hasTransition=function(){for(var a=0,s=Object.keys(this._values);a<s.length;a+=1)if(this._values[s[a]].prior)return!0;return!1};var Is=function(a){this._properties=a,this._values=Object.create(a.defaultPropertyValues)};Is.prototype.getValue=function(a){return ft(this._values[a].value)},Is.prototype.setValue=function(a,s){this._values[a]=new Tu(this._values[a].property,s===null?void 0:ft(s))},Is.prototype.serialize=function(){for(var a={},s=0,c=Object.keys(this._values);s<c.length;s+=1){var m=c[s],_=this.getValue(m);_!==void 0&&(a[m]=_)}return a},Is.prototype.possiblyEvaluate=function(a,s,c){for(var m=new Hs(this._properties),_=0,S=Object.keys(this._values);_<S.length;_+=1){var A=S[_];m._values[A]=this._values[A].possiblyEvaluate(a,s,c)}return m};var Ds=function(a,s,c){this.property=a,this.value=s,this.parameters=c};Ds.prototype.isConstant=function(){return this.value.kind==="constant"},Ds.prototype.constantOr=function(a){return this.value.kind==="constant"?this.value.value:a},Ds.prototype.evaluate=function(a,s,c,m){return this.property.evaluate(this.value,this.parameters,a,s,c,m)};var Hs=function(a){this._properties=a,this._values=Object.create(a.defaultPossiblyEvaluatedValues)};Hs.prototype.get=function(a){return this._values[a]};var Yn=function(a){this.specification=a};Yn.prototype.possiblyEvaluate=function(a,s){return a.expression.evaluate(s)},Yn.prototype.interpolate=function(a,s,c){var m=Ia[this.specification.type];return m?m(a,s,c):a};var Gn=function(a,s){this.specification=a,this.overrides=s};Gn.prototype.possiblyEvaluate=function(a,s,c,m){return new Ds(this,a.expression.kind==="constant"||a.expression.kind==="camera"?{kind:"constant",value:a.expression.evaluate(s,null,{},c,m)}:a.expression,s)},Gn.prototype.interpolate=function(a,s,c){if(a.value.kind!=="constant"||s.value.kind!=="constant")return a;if(a.value.value===void 0||s.value.value===void 0)return new Ds(this,{kind:"constant",value:void 0},a.parameters);var m=Ia[this.specification.type];return m?new Ds(this,{kind:"constant",value:m(a.value.value,s.value.value,c)},a.parameters):a},Gn.prototype.evaluate=function(a,s,c,m,_,S){return a.kind==="constant"?a.value:a.evaluate(s,c,m,_,S)};var hc=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.possiblyEvaluate=function(c,m,_,S){if(c.value===void 0)return new Ds(this,{kind:"constant",value:void 0},m);if(c.expression.kind==="constant"){var A=c.expression.evaluate(m,null,{},_,S),P=c.property.specification.type==="resolvedImage"&&typeof A!="string"?A.name:A,F=this._calculate(P,P,P,m);return new Ds(this,{kind:"constant",value:F},m)}if(c.expression.kind==="camera"){var j=this._calculate(c.expression.evaluate({zoom:m.zoom-1}),c.expression.evaluate({zoom:m.zoom}),c.expression.evaluate({zoom:m.zoom+1}),m);return new Ds(this,{kind:"constant",value:j},m)}return new Ds(this,c.expression,m)},s.prototype.evaluate=function(c,m,_,S,A,P){if(c.kind==="source"){var F=c.evaluate(m,_,S,A,P);return this._calculate(F,F,F,m)}return c.kind==="composite"?this._calculate(c.evaluate({zoom:Math.floor(m.zoom)-1},_,S),c.evaluate({zoom:Math.floor(m.zoom)},_,S),c.evaluate({zoom:Math.floor(m.zoom)+1},_,S),m):c.value},s.prototype._calculate=function(c,m,_,S){return S.zoom>S.zoomHistory.lastIntegerZoom?{from:c,to:m}:{from:_,to:m}},s.prototype.interpolate=function(c){return c},s}(Gn),gs=function(a){this.specification=a};gs.prototype.possiblyEvaluate=function(a,s,c,m){if(a.value!==void 0){if(a.expression.kind==="constant"){var _=a.expression.evaluate(s,null,{},c,m);return this._calculate(_,_,_,s)}return this._calculate(a.expression.evaluate(new Li(Math.floor(s.zoom-1),s)),a.expression.evaluate(new Li(Math.floor(s.zoom),s)),a.expression.evaluate(new Li(Math.floor(s.zoom+1),s)),s)}},gs.prototype._calculate=function(a,s,c,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:a,to:s}:{from:c,to:s}},gs.prototype.interpolate=function(a){return a};var du=function(a){this.specification=a};du.prototype.possiblyEvaluate=function(a,s,c,m){return!!a.expression.evaluate(s,null,{},c,m)},du.prototype.interpolate=function(){return!1};var Fo=function(a){for(var s in this.properties=a,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],a){var c=a[s];c.specification.overridable&&this.overridableProperties.push(s);var m=this.defaultPropertyValues[s]=new Tu(c,void 0),_=this.defaultTransitionablePropertyValues[s]=new pu(c);this.defaultTransitioningPropertyValues[s]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=m.possiblyEvaluate({})}};Fn("DataDrivenProperty",Gn),Fn("DataConstantProperty",Yn),Fn("CrossFadedDataDrivenProperty",hc),Fn("CrossFadedProperty",gs),Fn("ColorRampProperty",du);var nu=function(a){function s(c,m){if(a.call(this),this.id=c.id,this.type=c.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},c.type!=="custom"&&(this.metadata=(c=c).metadata,this.minzoom=c.minzoom,this.maxzoom=c.maxzoom,c.type!=="background"&&(this.source=c.source,this.sourceLayer=c["source-layer"],this.filter=c.filter),m.layout&&(this._unevaluatedLayout=new Is(m.layout)),m.paint)){for(var _ in this._transitionablePaint=new ns(m.paint),c.paint)this.setPaintProperty(_,c.paint[_],{validate:!1});for(var S in c.layout)this.setLayoutProperty(S,c.layout[S],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Hs(m.paint)}}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},s.prototype.getLayoutProperty=function(c){return c==="visibility"?this.visibility:this._unevaluatedLayout.getValue(c)},s.prototype.setLayoutProperty=function(c,m,_){_===void 0&&(_={}),m!=null&&this._validate(Zc,"layers."+this.id+".layout."+c,c,m,_)||(c!=="visibility"?this._unevaluatedLayout.setValue(c,m):this.visibility=m)},s.prototype.getPaintProperty=function(c){return J(c,"-transition")?this._transitionablePaint.getTransition(c.slice(0,-"-transition".length)):this._transitionablePaint.getValue(c)},s.prototype.setPaintProperty=function(c,m,_){if(_===void 0&&(_={}),m!=null&&this._validate(Nl,"layers."+this.id+".paint."+c,c,m,_))return!1;if(J(c,"-transition"))return this._transitionablePaint.setTransition(c.slice(0,-"-transition".length),m||void 0),!1;var S=this._transitionablePaint._values[c],A=S.property.specification["property-type"]==="cross-faded-data-driven",P=S.value.isDataDriven(),F=S.value;this._transitionablePaint.setValue(c,m),this._handleSpecialPaintPropertyUpdate(c);var j=this._transitionablePaint._values[c].value;return j.isDataDriven()||P||A||this._handleOverridablePaintPropertyUpdate(c,F,j)},s.prototype._handleSpecialPaintPropertyUpdate=function(c){},s.prototype._handleOverridablePaintPropertyUpdate=function(c,m,_){return!1},s.prototype.isHidden=function(c){return!!(this.minzoom&&c<this.minzoom)||!!(this.maxzoom&&c>=this.maxzoom)||this.visibility==="none"},s.prototype.updateTransitions=function(c){this._transitioningPaint=this._transitionablePaint.transitioned(c,this._transitioningPaint)},s.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},s.prototype.recalculate=function(c,m){c.getCrossfadeParameters&&(this._crossfadeParameters=c.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(c,void 0,m)),this.paint=this._transitioningPaint.possiblyEvaluate(c,void 0,m)},s.prototype.serialize=function(){var c={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(c.layout=c.layout||{},c.layout.visibility=this.visibility),Ct(c,function(m,_){return!(m===void 0||_==="layout"&&!Object.keys(m).length||_==="paint"&&!Object.keys(m).length)})},s.prototype._validate=function(c,m,_,S,A){return A===void 0&&(A={}),(!A||A.validate!==!1)&&uc(this,c.call(ks,{key:m,layerType:this.type,objectKey:_,value:S,styleSpec:Ce,style:{glyphs:!0,sprite:!0}}))},s.prototype.is3D=function(){return!1},s.prototype.isTileClipped=function(){return!1},s.prototype.hasOffscreenPass=function(){return!1},s.prototype.resize=function(){},s.prototype.isStateDependent=function(){for(var c in this.paint._values){var m=this.paint.get(c);if(m instanceof Ds&&Js(m.property.specification)&&(m.value.kind==="source"||m.value.kind==="composite")&&m.value.isStateDependent)return!0}return!1},s}(_t),pc={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Vc=function(a,s){this._structArray=a,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},fa=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function ja(a,s){s===void 0&&(s=1);var c=0,m=0;return{members:a.map(function(_){var S=pc[_.type].BYTES_PER_ELEMENT,A=c=Wf(c,Math.max(s,S)),P=_.components||1;return m=Math.max(m,S),c+=S*P,{name:_.name,type:_.type,components:P,offset:A}}),size:Wf(c,Math.max(m,s)),alignment:s}}function Wf(a,s){return Math.ceil(a/s)*s}fa.serialize=function(a,s){return a._trim(),s&&(a.isTransferred=!0,s.push(a.arrayBuffer)),{length:a.length,arrayBuffer:a.arrayBuffer}},fa.deserialize=function(a){var s=Object.create(this.prototype);return s.arrayBuffer=a.arrayBuffer,s.length=a.length,s.capacity=a.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s},fa.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},fa.prototype.clear=function(){this.length=0},fa.prototype.resize=function(a){this.reserve(a),this.length=a},fa.prototype.reserve=function(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}},fa.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var vl=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m){var _=this.length;return this.resize(_+1),this.emplace(_,c,m)},s.prototype.emplace=function(c,m,_){var S=2*c;return this.int16[S+0]=m,this.int16[S+1]=_,c},s}(fa);vl.prototype.bytesPerElement=4,Fn("StructArrayLayout2i4",vl);var ju=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,S){var A=this.length;return this.resize(A+1),this.emplace(A,c,m,_,S)},s.prototype.emplace=function(c,m,_,S,A){var P=4*c;return this.int16[P+0]=m,this.int16[P+1]=_,this.int16[P+2]=S,this.int16[P+3]=A,c},s}(fa);ju.prototype.bytesPerElement=8,Fn("StructArrayLayout4i8",ju);var vu=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,S,A,P){var F=this.length;return this.resize(F+1),this.emplace(F,c,m,_,S,A,P)},s.prototype.emplace=function(c,m,_,S,A,P,F){var j=6*c;return this.int16[j+0]=m,this.int16[j+1]=_,this.int16[j+2]=S,this.int16[j+3]=A,this.int16[j+4]=P,this.int16[j+5]=F,c},s}(fa);vu.prototype.bytesPerElement=12,Fn("StructArrayLayout2i4i12",vu);var Io=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,S,A,P){var F=this.length;return this.resize(F+1),this.emplace(F,c,m,_,S,A,P)},s.prototype.emplace=function(c,m,_,S,A,P,F){var j=4*c,X=8*c;return this.int16[j+0]=m,this.int16[j+1]=_,this.uint8[X+4]=S,this.uint8[X+5]=A,this.uint8[X+6]=P,this.uint8[X+7]=F,c},s}(fa);Io.prototype.bytesPerElement=8,Fn("StructArrayLayout2i4ub8",Io);var ml=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m){var _=this.length;return this.resize(_+1),this.emplace(_,c,m)},s.prototype.emplace=function(c,m,_){var S=2*c;return this.float32[S+0]=m,this.float32[S+1]=_,c},s}(fa);ml.prototype.bytesPerElement=8,Fn("StructArrayLayout2f8",ml);var Mu=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,S,A,P,F,j,X,ee){var fe=this.length;return this.resize(fe+1),this.emplace(fe,c,m,_,S,A,P,F,j,X,ee)},s.prototype.emplace=function(c,m,_,S,A,P,F,j,X,ee,fe){var xe=10*c;return this.uint16[xe+0]=m,this.uint16[xe+1]=_,this.uint16[xe+2]=S,this.uint16[xe+3]=A,this.uint16[xe+4]=P,this.uint16[xe+5]=F,this.uint16[xe+6]=j,this.uint16[xe+7]=X,this.uint16[xe+8]=ee,this.uint16[xe+9]=fe,c},s}(fa);Mu.prototype.bytesPerElement=20,Fn("StructArrayLayout10ui20",Mu);var jc=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,S,A,P,F,j,X,ee,fe,xe){var je=this.length;return this.resize(je+1),this.emplace(je,c,m,_,S,A,P,F,j,X,ee,fe,xe)},s.prototype.emplace=function(c,m,_,S,A,P,F,j,X,ee,fe,xe,je){var He=12*c;return this.int16[He+0]=m,this.int16[He+1]=_,this.int16[He+2]=S,this.int16[He+3]=A,this.uint16[He+4]=P,this.uint16[He+5]=F,this.uint16[He+6]=j,this.uint16[He+7]=X,this.int16[He+8]=ee,this.int16[He+9]=fe,this.int16[He+10]=xe,this.int16[He+11]=je,c},s}(fa);jc.prototype.bytesPerElement=24,Fn("StructArrayLayout4i4ui4i24",jc);var Ul=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_){var S=this.length;return this.resize(S+1),this.emplace(S,c,m,_)},s.prototype.emplace=function(c,m,_,S){var A=3*c;return this.float32[A+0]=m,this.float32[A+1]=_,this.float32[A+2]=S,c},s}(fa);Ul.prototype.bytesPerElement=12,Fn("StructArrayLayout3f12",Ul);var Eo=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c){var m=this.length;return this.resize(m+1),this.emplace(m,c)},s.prototype.emplace=function(c,m){return this.uint32[1*c+0]=m,c},s}(fa);Eo.prototype.bytesPerElement=4,Fn("StructArrayLayout1ul4",Eo);var Xf=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,S,A,P,F,j,X){var ee=this.length;return this.resize(ee+1),this.emplace(ee,c,m,_,S,A,P,F,j,X)},s.prototype.emplace=function(c,m,_,S,A,P,F,j,X,ee){var fe=10*c,xe=5*c;return this.int16[fe+0]=m,this.int16[fe+1]=_,this.int16[fe+2]=S,this.int16[fe+3]=A,this.int16[fe+4]=P,this.int16[fe+5]=F,this.uint32[xe+3]=j,this.uint16[fe+8]=X,this.uint16[fe+9]=ee,c},s}(fa);Xf.prototype.bytesPerElement=20,Fn("StructArrayLayout6i1ul2ui20",Xf);var Gc=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,S,A,P){var F=this.length;return this.resize(F+1),this.emplace(F,c,m,_,S,A,P)},s.prototype.emplace=function(c,m,_,S,A,P,F){var j=6*c;return this.int16[j+0]=m,this.int16[j+1]=_,this.int16[j+2]=S,this.int16[j+3]=A,this.int16[j+4]=P,this.int16[j+5]=F,c},s}(fa);Gc.prototype.bytesPerElement=12,Fn("StructArrayLayout2i2i2i12",Gc);var dc=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,S,A){var P=this.length;return this.resize(P+1),this.emplace(P,c,m,_,S,A)},s.prototype.emplace=function(c,m,_,S,A,P){var F=4*c,j=8*c;return this.float32[F+0]=m,this.float32[F+1]=_,this.float32[F+2]=S,this.int16[j+6]=A,this.int16[j+7]=P,c},s}(fa);dc.prototype.bytesPerElement=16,Fn("StructArrayLayout2f1f2i16",dc);var $f=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,S){var A=this.length;return this.resize(A+1),this.emplace(A,c,m,_,S)},s.prototype.emplace=function(c,m,_,S,A){var P=12*c,F=3*c;return this.uint8[P+0]=m,this.uint8[P+1]=_,this.float32[F+1]=S,this.float32[F+2]=A,c},s}(fa);$f.prototype.bytesPerElement=12,Fn("StructArrayLayout2ub2f12",$f);var Vl=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_){var S=this.length;return this.resize(S+1),this.emplace(S,c,m,_)},s.prototype.emplace=function(c,m,_,S){var A=3*c;return this.uint16[A+0]=m,this.uint16[A+1]=_,this.uint16[A+2]=S,c},s}(fa);Vl.prototype.bytesPerElement=6,Fn("StructArrayLayout3ui6",Vl);var iu=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,S,A,P,F,j,X,ee,fe,xe,je,He,pt,nt,kt){var Gt=this.length;return this.resize(Gt+1),this.emplace(Gt,c,m,_,S,A,P,F,j,X,ee,fe,xe,je,He,pt,nt,kt)},s.prototype.emplace=function(c,m,_,S,A,P,F,j,X,ee,fe,xe,je,He,pt,nt,kt,Gt){var sr=24*c,vr=12*c,fr=48*c;return this.int16[sr+0]=m,this.int16[sr+1]=_,this.uint16[sr+2]=S,this.uint16[sr+3]=A,this.uint32[vr+2]=P,this.uint32[vr+3]=F,this.uint32[vr+4]=j,this.uint16[sr+10]=X,this.uint16[sr+11]=ee,this.uint16[sr+12]=fe,this.float32[vr+7]=xe,this.float32[vr+8]=je,this.uint8[fr+36]=He,this.uint8[fr+37]=pt,this.uint8[fr+38]=nt,this.uint32[vr+10]=kt,this.int16[sr+22]=Gt,c},s}(fa);iu.prototype.bytesPerElement=48,Fn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",iu);var vc=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,S,A,P,F,j,X,ee,fe,xe,je,He,pt,nt,kt,Gt,sr,vr,fr,Hr,dn,Kn,kn,ai,In,zi){var di=this.length;return this.resize(di+1),this.emplace(di,c,m,_,S,A,P,F,j,X,ee,fe,xe,je,He,pt,nt,kt,Gt,sr,vr,fr,Hr,dn,Kn,kn,ai,In,zi)},s.prototype.emplace=function(c,m,_,S,A,P,F,j,X,ee,fe,xe,je,He,pt,nt,kt,Gt,sr,vr,fr,Hr,dn,Kn,kn,ai,In,zi,di){var Xn=34*c,Wi=17*c;return this.int16[Xn+0]=m,this.int16[Xn+1]=_,this.int16[Xn+2]=S,this.int16[Xn+3]=A,this.int16[Xn+4]=P,this.int16[Xn+5]=F,this.int16[Xn+6]=j,this.int16[Xn+7]=X,this.uint16[Xn+8]=ee,this.uint16[Xn+9]=fe,this.uint16[Xn+10]=xe,this.uint16[Xn+11]=je,this.uint16[Xn+12]=He,this.uint16[Xn+13]=pt,this.uint16[Xn+14]=nt,this.uint16[Xn+15]=kt,this.uint16[Xn+16]=Gt,this.uint16[Xn+17]=sr,this.uint16[Xn+18]=vr,this.uint16[Xn+19]=fr,this.uint16[Xn+20]=Hr,this.uint16[Xn+21]=dn,this.uint16[Xn+22]=Kn,this.uint32[Wi+12]=kn,this.float32[Wi+13]=ai,this.float32[Wi+14]=In,this.float32[Wi+15]=zi,this.float32[Wi+16]=di,c},s}(fa);vc.prototype.bytesPerElement=68,Fn("StructArrayLayout8i15ui1ul4f68",vc);var ku=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c){var m=this.length;return this.resize(m+1),this.emplace(m,c)},s.prototype.emplace=function(c,m){return this.float32[1*c+0]=m,c},s}(fa);ku.prototype.bytesPerElement=4,Fn("StructArrayLayout1f4",ku);var Ws=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_){var S=this.length;return this.resize(S+1),this.emplace(S,c,m,_)},s.prototype.emplace=function(c,m,_,S){var A=3*c;return this.int16[A+0]=m,this.int16[A+1]=_,this.int16[A+2]=S,c},s}(fa);Ws.prototype.bytesPerElement=6,Fn("StructArrayLayout3i6",Ws);var Hc=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_){var S=this.length;return this.resize(S+1),this.emplace(S,c,m,_)},s.prototype.emplace=function(c,m,_,S){var A=4*c;return this.uint32[2*c+0]=m,this.uint16[A+2]=_,this.uint16[A+3]=S,c},s}(fa);Hc.prototype.bytesPerElement=8,Fn("StructArrayLayout1ul2ui8",Hc);var Wc=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m){var _=this.length;return this.resize(_+1),this.emplace(_,c,m)},s.prototype.emplace=function(c,m,_){var S=2*c;return this.uint16[S+0]=m,this.uint16[S+1]=_,c},s}(fa);Wc.prototype.bytesPerElement=4,Fn("StructArrayLayout2ui4",Wc);var Sf=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c){var m=this.length;return this.resize(m+1),this.emplace(m,c)},s.prototype.emplace=function(c,m){return this.uint16[1*c+0]=m,c},s}(fa);Sf.prototype.bytesPerElement=2,Fn("StructArrayLayout1ui2",Sf);var Xc=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,S){var A=this.length;return this.resize(A+1),this.emplace(A,c,m,_,S)},s.prototype.emplace=function(c,m,_,S,A){var P=4*c;return this.float32[P+0]=m,this.float32[P+1]=_,this.float32[P+2]=S,this.float32[P+3]=A,c},s}(fa);Xc.prototype.bytesPerElement=16,Fn("StructArrayLayout4f16",Xc);var f=function(a){function s(){a.apply(this,arguments)}a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s;var c={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return c.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},c.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},c.x1.get=function(){return this._structArray.int16[this._pos2+2]},c.y1.get=function(){return this._structArray.int16[this._pos2+3]},c.x2.get=function(){return this._structArray.int16[this._pos2+4]},c.y2.get=function(){return this._structArray.int16[this._pos2+5]},c.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},c.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},c.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},c.anchorPoint.get=function(){return new se(this.anchorPointX,this.anchorPointY)},Object.defineProperties(s.prototype,c),s}(Vc);f.prototype.size=20;var d=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.get=function(c){return new f(this,c)},s}(Xf);Fn("CollisionBoxArray",d);var h=function(a){function s(){a.apply(this,arguments)}a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s;var c={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return c.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},c.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},c.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},c.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},c.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},c.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},c.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},c.segment.get=function(){return this._structArray.uint16[this._pos2+10]},c.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},c.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},c.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},c.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},c.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},c.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},c.placedOrientation.set=function(m){this._structArray.uint8[this._pos1+37]=m},c.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},c.hidden.set=function(m){this._structArray.uint8[this._pos1+38]=m},c.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},c.crossTileID.set=function(m){this._structArray.uint32[this._pos4+10]=m},c.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(s.prototype,c),s}(Vc);h.prototype.size=48;var g=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.get=function(c){return new h(this,c)},s}(iu);Fn("PlacedSymbolArray",g);var w=function(a){function s(){a.apply(this,arguments)}a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s;var c={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return c.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},c.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},c.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},c.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},c.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},c.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},c.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},c.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},c.key.get=function(){return this._structArray.uint16[this._pos2+8]},c.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},c.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},c.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},c.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},c.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},c.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},c.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},c.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},c.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},c.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},c.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},c.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},c.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},c.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},c.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},c.crossTileID.set=function(m){this._structArray.uint32[this._pos4+12]=m},c.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},c.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},c.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},c.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(s.prototype,c),s}(Vc);w.prototype.size=68;var M=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.get=function(c){return new w(this,c)},s}(vc);Fn("SymbolInstanceArray",M);var I=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.getoffsetX=function(c){return this.float32[1*c+0]},s}(ku);Fn("GlyphOffsetArray",I);var D=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.getx=function(c){return this.int16[3*c+0]},s.prototype.gety=function(c){return this.int16[3*c+1]},s.prototype.gettileUnitDistanceFromAnchor=function(c){return this.int16[3*c+2]},s}(Ws);Fn("SymbolLineVertexArray",D);var G=function(a){function s(){a.apply(this,arguments)}a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s;var c={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return c.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},c.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},c.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(s.prototype,c),s}(Vc);G.prototype.size=8;var te=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.get=function(c){return new G(this,c)},s}(Hc);Fn("FeatureIndexArray",te);var he=ja([{name:"a_pos",components:2,type:"Int16"}],4).members,Se=function(a){a===void 0&&(a=[]),this.segments=a};function Ae(a,s){return 256*(a=gt(Math.floor(a),0,255))+gt(Math.floor(s),0,255)}Se.prototype.prepareSegment=function(a,s,c,m){var _=this.segments[this.segments.length-1];return a>Se.MAX_VERTEX_ARRAY_LENGTH&&dt("Max vertices per segment is "+Se.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+a),(!_||_.vertexLength+a>Se.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==m)&&(_={vertexOffset:s.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},m!==void 0&&(_.sortKey=m),this.segments.push(_)),_},Se.prototype.get=function(){return this.segments},Se.prototype.destroy=function(){for(var a=0,s=this.segments;a<s.length;a+=1){var c=s[a];for(var m in c.vaos)c.vaos[m].destroy()}},Se.simpleSegment=function(a,s,c,m){return new Se([{vertexOffset:a,primitiveOffset:s,vertexLength:c,primitiveLength:m,vaos:{},sortKey:0}])},Se.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Fn("SegmentVector",Se);var We=ja([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Ge=Te(function(a){a.exports=function(s,c){var m,_,S,A,P,F,j,X;for(_=s.length-(m=3&s.length),S=c,P=3432918353,F=461845907,X=0;X<_;)j=255&s.charCodeAt(X)|(255&s.charCodeAt(++X))<<8|(255&s.charCodeAt(++X))<<16|(255&s.charCodeAt(++X))<<24,++X,S=27492+(65535&(A=5*(65535&(S=(S^=j=(65535&(j=(j=(65535&j)*P+(((j>>>16)*P&65535)<<16)&4294967295)<<15|j>>>17))*F+(((j>>>16)*F&65535)<<16)&4294967295)<<13|S>>>19))+((5*(S>>>16)&65535)<<16)&4294967295))+((58964+(A>>>16)&65535)<<16);switch(j=0,m){case 3:j^=(255&s.charCodeAt(X+2))<<16;case 2:j^=(255&s.charCodeAt(X+1))<<8;case 1:S^=j=(65535&(j=(j=(65535&(j^=255&s.charCodeAt(X)))*P+(((j>>>16)*P&65535)<<16)&4294967295)<<15|j>>>17))*F+(((j>>>16)*F&65535)<<16)&4294967295}return S^=s.length,S=2246822507*(65535&(S^=S>>>16))+((2246822507*(S>>>16)&65535)<<16)&4294967295,S=3266489909*(65535&(S^=S>>>13))+((3266489909*(S>>>16)&65535)<<16)&4294967295,(S^=S>>>16)>>>0}}),ot=Te(function(a){a.exports=function(s,c){for(var m,_=s.length,S=c^_,A=0;_>=4;)m=1540483477*(65535&(m=255&s.charCodeAt(A)|(255&s.charCodeAt(++A))<<8|(255&s.charCodeAt(++A))<<16|(255&s.charCodeAt(++A))<<24))+((1540483477*(m>>>16)&65535)<<16),S=1540483477*(65535&S)+((1540483477*(S>>>16)&65535)<<16)^(m=1540483477*(65535&(m^=m>>>24))+((1540483477*(m>>>16)&65535)<<16)),_-=4,++A;switch(_){case 3:S^=(255&s.charCodeAt(A+2))<<16;case 2:S^=(255&s.charCodeAt(A+1))<<8;case 1:S=1540483477*(65535&(S^=255&s.charCodeAt(A)))+((1540483477*(S>>>16)&65535)<<16)}return S=1540483477*(65535&(S^=S>>>13))+((1540483477*(S>>>16)&65535)<<16),(S^=S>>>15)>>>0}}),Ze=Ge,Xe=ot;Ze.murmur3=Ge,Ze.murmur2=Xe;var de=function(){this.ids=[],this.positions=[],this.indexed=!1};de.prototype.add=function(a,s,c,m){this.ids.push(q(a)),this.positions.push(s,c,m)},de.prototype.getPositions=function(a){for(var s=q(a),c=0,m=this.ids.length-1;c<m;){var _=c+m>>1;this.ids[_]>=s?m=_:c=_+1}for(var S=[];this.ids[c]===s;)S.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return S},de.serialize=function(a,s){var c=new Float64Array(a.ids),m=new Uint32Array(a.positions);return function _(S,A,P,F){for(;P<F;){for(var j=S[P+F>>1],X=P-1,ee=F+1;;){do X++;while(S[X]<j);do ee--;while(S[ee]>j);if(X>=ee)break;or(S,X,ee),or(A,3*X,3*ee),or(A,3*X+1,3*ee+1),or(A,3*X+2,3*ee+2)}ee-P<F-ee?(_(S,A,P,ee),P=ee+1):(_(S,A,ee+1,F),F=ee)}}(c,m,0,c.length-1),s&&s.push(c.buffer,m.buffer),{ids:c,positions:m}},de.deserialize=function(a){var s=new de;return s.ids=a.ids,s.positions=a.positions,s.indexed=!0,s};var Vt=Math.pow(2,53)-1;function q(a){var s=+a;return!isNaN(s)&&s<=Vt?s:Ze(String(a))}function or(a,s,c){var m=a[s];a[s]=a[c],a[c]=m}Fn("FeaturePositionMap",de);var dr=function(a,s){this.gl=a.gl,this.location=s},Fr=function(a){function s(c,m){a.call(this,c,m),this.current=0}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))},s}(dr),on=function(a){function s(c,m){a.call(this,c,m),this.current=0}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))},s}(dr),nn=function(a){function s(c,m){a.call(this,c,m),this.current=[0,0]}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1]))},s}(dr),Tn=function(a){function s(c,m){a.call(this,c,m),this.current=[0,0,0]}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2]))},s}(dr),ri=function(a){function s(c,m){a.call(this,c,m),this.current=[0,0,0,0]}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3]))},s}(dr),Jn=function(a){function s(c,m){a.call(this,c,m),this.current=gr.transparent}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a))},s}(dr),ii=new Float32Array(16),Ui=function(a){function s(c,m){a.call(this,c,m),this.current=ii}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(var m=1;m<16;m++)if(c[m]!==this.current[m]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}},s}(dr);function En(a){return[Ae(255*a.r,255*a.g),Ae(255*a.b,255*a.a)]}var wi=function(a,s,c){this.value=a,this.uniformNames=s.map(function(m){return"u_"+m}),this.type=c};wi.prototype.setUniform=function(a,s,c){a.set(c.constantOr(this.value))},wi.prototype.getBinding=function(a,s,c){return this.type==="color"?new Jn(a,s):new on(a,s)};var Ti=function(a,s){this.uniformNames=s.map(function(c){return"u_"+c}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Ti.prototype.setConstantPatternPositions=function(a,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=a.pixelRatio,this.patternFrom=s.tlbr,this.patternTo=a.tlbr},Ti.prototype.setUniform=function(a,s,c,m){var _=m==="u_pattern_to"?this.patternTo:m==="u_pattern_from"?this.patternFrom:m==="u_pixel_ratio_to"?this.pixelRatioTo:m==="u_pixel_ratio_from"?this.pixelRatioFrom:null;_&&a.set(_)},Ti.prototype.getBinding=function(a,s,c){return c.substr(0,9)==="u_pattern"?new ri(a,s):new on(a,s)};var yi=function(a,s,c,m){this.expression=a,this.type=c,this.maxValue=0,this.paintVertexAttributes=s.map(function(_){return{name:"a_"+_,type:"Float32",components:c==="color"?2:1,offset:0}}),this.paintVertexArray=new m};yi.prototype.populatePaintArray=function(a,s,c,m,_){var S=this.paintVertexArray.length,A=this.expression.evaluate(new Li(0),s,{},m,[],_);this.paintVertexArray.resize(a),this._setPaintValue(S,a,A)},yi.prototype.updatePaintArray=function(a,s,c,m){var _=this.expression.evaluate({zoom:0},c,m);this._setPaintValue(a,s,_)},yi.prototype._setPaintValue=function(a,s,c){if(this.type==="color")for(var m=En(c),_=a;_<s;_++)this.paintVertexArray.emplace(_,m[0],m[1]);else{for(var S=a;S<s;S++)this.paintVertexArray.emplace(S,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}},yi.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},yi.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var ui=function(a,s,c,m,_,S){this.expression=a,this.uniformNames=s.map(function(A){return"u_"+A+"_t"}),this.type=c,this.useIntegerZoom=m,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=s.map(function(A){return{name:"a_"+A,type:"Float32",components:c==="color"?4:2,offset:0}}),this.paintVertexArray=new S};ui.prototype.populatePaintArray=function(a,s,c,m,_){var S=this.expression.evaluate(new Li(this.zoom),s,{},m,[],_),A=this.expression.evaluate(new Li(this.zoom+1),s,{},m,[],_),P=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue(P,a,S,A)},ui.prototype.updatePaintArray=function(a,s,c,m){var _=this.expression.evaluate({zoom:this.zoom},c,m),S=this.expression.evaluate({zoom:this.zoom+1},c,m);this._setPaintValue(a,s,_,S)},ui.prototype._setPaintValue=function(a,s,c,m){if(this.type==="color")for(var _=En(c),S=En(m),A=a;A<s;A++)this.paintVertexArray.emplace(A,_[0],_[1],S[0],S[1]);else{for(var P=a;P<s;P++)this.paintVertexArray.emplace(P,c,m);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(m))}},ui.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ui.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},ui.prototype.setUniform=function(a,s){var c=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,m=gt(this.expression.interpolationFactor(c,this.zoom,this.zoom+1),0,1);a.set(m)},ui.prototype.getBinding=function(a,s,c){return new on(a,s)};var Mi=function(a,s,c,m,_,S){this.expression=a,this.type=s,this.useIntegerZoom=c,this.zoom=m,this.layerId=S,this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _};Mi.prototype.populatePaintArray=function(a,s,c){var m=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(a),this.zoomOutPaintVertexArray.resize(a),this._setPaintValues(m,a,s.patterns&&s.patterns[this.layerId],c)},Mi.prototype.updatePaintArray=function(a,s,c,m,_){this._setPaintValues(a,s,c.patterns&&c.patterns[this.layerId],_)},Mi.prototype._setPaintValues=function(a,s,c,m){if(m&&c){var _=m[c.min],S=m[c.mid],A=m[c.max];if(_&&S&&A)for(var P=a;P<s;P++)this.zoomInPaintVertexArray.emplace(P,S.tl[0],S.tl[1],S.br[0],S.br[1],_.tl[0],_.tl[1],_.br[0],_.br[1],S.pixelRatio,_.pixelRatio),this.zoomOutPaintVertexArray.emplace(P,S.tl[0],S.tl[1],S.br[0],S.br[1],A.tl[0],A.tl[1],A.br[0],A.br[1],S.pixelRatio,A.pixelRatio)}},Mi.prototype.upload=function(a){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=a.createVertexBuffer(this.zoomInPaintVertexArray,We.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=a.createVertexBuffer(this.zoomOutPaintVertexArray,We.members,this.expression.isStateDependent))},Mi.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var ci=function(a,s,c){this.binders={},this._buffers=[];var m=[];for(var _ in a.paint._values)if(c(_)){var S=a.paint.get(_);if(S instanceof Ds&&Js(S.property.specification)){var A=Po(_,a.type),P=S.value,F=S.property.specification.type,j=S.property.useIntegerZoom,X=S.property.specification["property-type"],ee=X==="cross-faded"||X==="cross-faded-data-driven";if(P.kind==="constant")this.binders[_]=ee?new Ti(P.value,A):new wi(P.value,A,F),m.push("/u_"+_);else if(P.kind==="source"||ee){var fe=Qa(_,F,"source");this.binders[_]=ee?new Mi(P,F,j,s,fe,a.id):new yi(P,A,F,fe),m.push("/a_"+_)}else{var xe=Qa(_,F,"composite");this.binders[_]=new ui(P,A,F,j,s,xe),m.push("/z_"+_)}}}this.cacheKey=m.sort().join("")};ci.prototype.getMaxValue=function(a){var s=this.binders[a];return s instanceof yi||s instanceof ui?s.maxValue:0},ci.prototype.populatePaintArrays=function(a,s,c,m,_){for(var S in this.binders){var A=this.binders[S];(A instanceof yi||A instanceof ui||A instanceof Mi)&&A.populatePaintArray(a,s,c,m,_)}},ci.prototype.setConstantPatternPositions=function(a,s){for(var c in this.binders){var m=this.binders[c];m instanceof Ti&&m.setConstantPatternPositions(a,s)}},ci.prototype.updatePaintArrays=function(a,s,c,m,_){var S=!1;for(var A in a)for(var P=0,F=s.getPositions(A);P<F.length;P+=1){var j=F[P],X=c.feature(j.index);for(var ee in this.binders){var fe=this.binders[ee];if((fe instanceof yi||fe instanceof ui||fe instanceof Mi)&&fe.expression.isStateDependent===!0){var xe=m.paint.get(ee);fe.expression=xe.value,fe.updatePaintArray(j.start,j.end,X,a[A],_),S=!0}}}return S},ci.prototype.defines=function(){var a=[];for(var s in this.binders){var c=this.binders[s];(c instanceof wi||c instanceof Ti)&&a.push.apply(a,c.uniformNames.map(function(m){return"#define HAS_UNIFORM_"+m}))}return a},ci.prototype.getBinderAttributes=function(){var a=[];for(var s in this.binders){var c=this.binders[s];if(c instanceof yi||c instanceof ui)for(var m=0;m<c.paintVertexAttributes.length;m++)a.push(c.paintVertexAttributes[m].name);else if(c instanceof Mi)for(var _=0;_<We.members.length;_++)a.push(We.members[_].name)}return a},ci.prototype.getBinderUniforms=function(){var a=[];for(var s in this.binders){var c=this.binders[s];if(c instanceof wi||c instanceof Ti||c instanceof ui)for(var m=0,_=c.uniformNames;m<_.length;m+=1)a.push(_[m])}return a},ci.prototype.getPaintVertexBuffers=function(){return this._buffers},ci.prototype.getUniforms=function(a,s){var c=[];for(var m in this.binders){var _=this.binders[m];if(_ instanceof wi||_ instanceof Ti||_ instanceof ui)for(var S=0,A=_.uniformNames;S<A.length;S+=1){var P=A[S];if(s[P]){var F=_.getBinding(a,s[P],P);c.push({name:P,property:m,binding:F})}}}return c},ci.prototype.setUniforms=function(a,s,c,m){for(var _=0,S=s;_<S.length;_+=1){var A=S[_],P=A.name,F=A.property;this.binders[F].setUniform(A.binding,m,c.get(F),P)}},ci.prototype.updatePaintBuffers=function(a){for(var s in this._buffers=[],this.binders){var c=this.binders[s];if(a&&c instanceof Mi){var m=a.fromScale===2?c.zoomInPaintVertexBuffer:c.zoomOutPaintVertexBuffer;m&&this._buffers.push(m)}else(c instanceof yi||c instanceof ui)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer)}},ci.prototype.upload=function(a){for(var s in this.binders){var c=this.binders[s];(c instanceof yi||c instanceof ui||c instanceof Mi)&&c.upload(a)}this.updatePaintBuffers()},ci.prototype.destroy=function(){for(var a in this.binders){var s=this.binders[a];(s instanceof yi||s instanceof ui||s instanceof Mi)&&s.destroy()}};var oi=function(a,s,c){c===void 0&&(c=function(){return!0}),this.programConfigurations={};for(var m=0,_=a;m<_.length;m+=1){var S=_[m];this.programConfigurations[S.id]=new ci(S,s,c)}this.needsUpload=!1,this._featureMap=new de,this._bufferOffset=0};function Po(a,s){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(s+"-","").replace(/-/g,"_")]}function Qa(a,s,c){var m={color:{source:ml,composite:Xc},number:{source:ku,composite:ml}},_=function(S){return{"line-pattern":{source:Mu,composite:Mu},"fill-pattern":{source:Mu,composite:Mu},"fill-extrusion-pattern":{source:Mu,composite:Mu}}[S]}(a);return _&&_[c]||m[s][c]}oi.prototype.populatePaintArrays=function(a,s,c,m,_,S){for(var A in this.programConfigurations)this.programConfigurations[A].populatePaintArrays(a,s,m,_,S);s.id!==void 0&&this._featureMap.add(s.id,c,this._bufferOffset,a),this._bufferOffset=a,this.needsUpload=!0},oi.prototype.updatePaintArrays=function(a,s,c,m){for(var _=0,S=c;_<S.length;_+=1){var A=S[_];this.needsUpload=this.programConfigurations[A.id].updatePaintArrays(a,this._featureMap,s,A,m)||this.needsUpload}},oi.prototype.get=function(a){return this.programConfigurations[a]},oi.prototype.upload=function(a){if(this.needsUpload){for(var s in this.programConfigurations)this.programConfigurations[s].upload(a);this.needsUpload=!1}},oi.prototype.destroy=function(){for(var a in this.programConfigurations)this.programConfigurations[a].destroy()},Fn("ConstantBinder",wi),Fn("CrossFadedConstantBinder",Ti),Fn("SourceExpressionBinder",yi),Fn("CrossFadedCompositeBinder",Mi),Fn("CompositeExpressionBinder",ui),Fn("ProgramConfiguration",ci,{omit:["_buffers"]}),Fn("ProgramConfigurationSet",oi);var So=Math.pow(2,14)-1,Bo=-So-1;function Ja(a){for(var s=8192/a.extent,c=a.loadGeometry(),m=0;m<c.length;m++)for(var _=c[m],S=0;S<_.length;S++){var A=_[S],P=Math.round(A.x*s),F=Math.round(A.y*s);A.x=gt(P,Bo,So),A.y=gt(F,Bo,So),(P<A.x||P>A.x+1||F<A.y||F>A.y+1)&&dt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return c}function yo(a,s){return{type:a.type,id:a.id,properties:a.properties,geometry:s?Ja(a):[]}}function Fs(a,s,c,m,_){a.emplaceBack(2*s+(m+1)/2,2*c+(_+1)/2)}var No=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new vl,this.indexArray=new Vl,this.segments=new Se,this.programConfigurations=new oi(a.layers,a.zoom),this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};function Iu(a,s){for(var c=0;c<a.length;c++)if(gu(s,a[c]))return!0;for(var m=0;m<s.length;m++)if(gu(a,s[m]))return!0;return!!gl(a,s)}function ys(a,s,c){return!!gu(a,s)||!!ss(s,a,c)}function mu(a,s){if(a.length===1)return $c(s,a[0]);for(var c=0;c<s.length;c++)for(var m=s[c],_=0;_<m.length;_++)if(gu(a,m[_]))return!0;for(var S=0;S<a.length;S++)if($c(s,a[S]))return!0;for(var A=0;A<s.length;A++)if(gl(a,s[A]))return!0;return!1}function au(a,s,c){if(a.length>1){if(gl(a,s))return!0;for(var m=0;m<s.length;m++)if(ss(s[m],a,c))return!0}for(var _=0;_<a.length;_++)if(ss(a[_],s,c))return!0;return!1}function gl(a,s){if(a.length===0||s.length===0)return!1;for(var c=0;c<a.length-1;c++)for(var m=a[c],_=a[c+1],S=0;S<s.length-1;S++)if(jl(m,_,s[S],s[S+1]))return!0;return!1}function jl(a,s,c,m){return rr(a,c,m)!==rr(s,c,m)&&rr(a,s,c)!==rr(a,s,m)}function ss(a,s,c){var m=c*c;if(s.length===1)return a.distSqr(s[0])<m;for(var _=1;_<s.length;_++)if(yl(a,s[_-1],s[_])<m)return!0;return!1}function yl(a,s,c){var m=s.distSqr(c);if(m===0)return a.distSqr(s);var _=((a.x-s.x)*(c.x-s.x)+(a.y-s.y)*(c.y-s.y))/m;return a.distSqr(_<0?s:_>1?c:c.sub(s)._mult(_)._add(s))}function $c(a,s){for(var c,m,_,S=!1,A=0;A<a.length;A++)for(var P=0,F=(c=a[A]).length-1;P<c.length;F=P++)(m=c[P]).y>s.y!=(_=c[F]).y>s.y&&s.x<(_.x-m.x)*(s.y-m.y)/(_.y-m.y)+m.x&&(S=!S);return S}function gu(a,s){for(var c=!1,m=0,_=a.length-1;m<a.length;_=m++){var S=a[m],A=a[_];S.y>s.y!=A.y>s.y&&s.x<(A.x-S.x)*(s.y-S.y)/(A.y-S.y)+S.x&&(c=!c)}return c}function mc(a,s,c){var m=c[0],_=c[2];if(a.x<m.x&&s.x<m.x||a.x>_.x&&s.x>_.x||a.y<m.y&&s.y<m.y||a.y>_.y&&s.y>_.y)return!1;var S=rr(a,s,c[0]);return S!==rr(a,s,c[1])||S!==rr(a,s,c[2])||S!==rr(a,s,c[3])}function Gu(a,s,c){var m=s.paint.get(a).value;return m.kind==="constant"?m.value:c.programConfigurations.get(s.id).getMaxValue(a)}function wo(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function Pu(a,s,c,m,_){if(!s[0]&&!s[1])return a;var S=se.convert(s)._mult(_);c==="viewport"&&S._rotate(-m);for(var A=[],P=0;P<a.length;P++)A.push(a[P].sub(S));return A}No.prototype.populate=function(a,s,c){var m=this.layers[0],_=[],S=null;m.type==="circle"&&(S=m.layout.get("circle-sort-key"));for(var A=0,P=a;A<P.length;A+=1){var F=P[A],j=F.feature,X=F.id,ee=F.index,fe=F.sourceLayerIndex,xe=this.layers[0]._featureFilter.needGeometry,je=yo(j,xe);if(this.layers[0]._featureFilter.filter(new Li(this.zoom),je,c)){var He=S?S.evaluate(je,{},c):void 0,pt={id:X,properties:j.properties,type:j.type,sourceLayerIndex:fe,index:ee,geometry:xe?je.geometry:Ja(j),patterns:{},sortKey:He};_.push(pt)}}S&&_.sort(function(dn,Kn){return dn.sortKey-Kn.sortKey});for(var nt=0,kt=_;nt<kt.length;nt+=1){var Gt=kt[nt],sr=Gt.geometry,vr=Gt.index,fr=Gt.sourceLayerIndex,Hr=a[vr].feature;this.addFeature(Gt,sr,vr,c),s.featureIndex.insert(Hr,sr,vr,fr,this.index)}},No.prototype.update=function(a,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,s,this.stateDependentLayers,c)},No.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},No.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},No.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,he),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},No.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},No.prototype.addFeature=function(a,s,c,m){for(var _=0,S=s;_<S.length;_+=1)for(var A=0,P=S[_];A<P.length;A+=1){var F=P[A],j=F.x,X=F.y;if(!(j<0||j>=8192||X<0||X>=8192)){var ee=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,a.sortKey),fe=ee.vertexLength;Fs(this.layoutVertexArray,j,X,-1,-1),Fs(this.layoutVertexArray,j,X,1,-1),Fs(this.layoutVertexArray,j,X,1,1),Fs(this.layoutVertexArray,j,X,-1,1),this.indexArray.emplaceBack(fe,fe+1,fe+2),this.indexArray.emplaceBack(fe,fe+3,fe+2),ee.vertexLength+=4,ee.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,c,{},m)},Fn("CircleBucket",No,{omit:["layers"]});var _l=new Fo({"circle-sort-key":new Gn(Ce.layout_circle["circle-sort-key"])}),xl={paint:new Fo({"circle-radius":new Gn(Ce.paint_circle["circle-radius"]),"circle-color":new Gn(Ce.paint_circle["circle-color"]),"circle-blur":new Gn(Ce.paint_circle["circle-blur"]),"circle-opacity":new Gn(Ce.paint_circle["circle-opacity"]),"circle-translate":new Yn(Ce.paint_circle["circle-translate"]),"circle-translate-anchor":new Yn(Ce.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Yn(Ce.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Yn(Ce.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Gn(Ce.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Gn(Ce.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Gn(Ce.paint_circle["circle-stroke-opacity"])}),layout:_l},da=typeof Float32Array!="undefined"?Float32Array:Array;function Xs(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function _s(a,s,c){var m=s[0],_=s[1],S=s[2],A=s[3],P=s[4],F=s[5],j=s[6],X=s[7],ee=s[8],fe=s[9],xe=s[10],je=s[11],He=s[12],pt=s[13],nt=s[14],kt=s[15],Gt=c[0],sr=c[1],vr=c[2],fr=c[3];return a[0]=Gt*m+sr*P+vr*ee+fr*He,a[1]=Gt*_+sr*F+vr*fe+fr*pt,a[2]=Gt*S+sr*j+vr*xe+fr*nt,a[3]=Gt*A+sr*X+vr*je+fr*kt,a[4]=(Gt=c[4])*m+(sr=c[5])*P+(vr=c[6])*ee+(fr=c[7])*He,a[5]=Gt*_+sr*F+vr*fe+fr*pt,a[6]=Gt*S+sr*j+vr*xe+fr*nt,a[7]=Gt*A+sr*X+vr*je+fr*kt,a[8]=(Gt=c[8])*m+(sr=c[9])*P+(vr=c[10])*ee+(fr=c[11])*He,a[9]=Gt*_+sr*F+vr*fe+fr*pt,a[10]=Gt*S+sr*j+vr*xe+fr*nt,a[11]=Gt*A+sr*X+vr*je+fr*kt,a[12]=(Gt=c[12])*m+(sr=c[13])*P+(vr=c[14])*ee+(fr=c[15])*He,a[13]=Gt*_+sr*F+vr*fe+fr*pt,a[14]=Gt*S+sr*j+vr*xe+fr*nt,a[15]=Gt*A+sr*X+vr*je+fr*kt,a}Math.hypot||(Math.hypot=function(){for(var a=arguments,s=0,c=arguments.length;c--;)s+=a[c]*a[c];return Math.sqrt(s)});var Ju,Yc=_s;function qc(a,s,c){var m=s[0],_=s[1],S=s[2],A=s[3];return a[0]=c[0]*m+c[4]*_+c[8]*S+c[12]*A,a[1]=c[1]*m+c[5]*_+c[9]*S+c[13]*A,a[2]=c[2]*m+c[6]*_+c[10]*S+c[14]*A,a[3]=c[3]*m+c[7]*_+c[11]*S+c[15]*A,a}Ju=new da(3),da!=Float32Array&&(Ju[0]=0,Ju[1]=0,Ju[2]=0),function(){var a=new da(4);da!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[3]=0)}();var wf=(function(){var a=new da(2);da!=Float32Array&&(a[0]=0,a[1]=0)}(),function(a){function s(c){a.call(this,c,xl)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.createBucket=function(c){return new No(c)},s.prototype.queryRadius=function(c){var m=c;return Gu("circle-radius",this,m)+Gu("circle-stroke-width",this,m)+wo(this.paint.get("circle-translate"))},s.prototype.queryIntersectsFeature=function(c,m,_,S,A,P,F,j){for(var X=Pu(c,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),P.angle,F),ee=this.paint.get("circle-radius").evaluate(m,_)+this.paint.get("circle-stroke-width").evaluate(m,_),fe=this.paint.get("circle-pitch-alignment")==="map",xe=fe?X:function(Hr,dn){return Hr.map(function(Kn){return Ps(Kn,dn)})}(X,j),je=fe?ee*F:ee,He=0,pt=S;He<pt.length;He+=1)for(var nt=0,kt=pt[He];nt<kt.length;nt+=1){var Gt=kt[nt],sr=fe?Gt:Ps(Gt,j),vr=je,fr=qc([],[Gt.x,Gt.y,0,1],j);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?vr*=fr[3]/P.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(vr*=P.cameraToCenterDistance/fr[3]),ys(xe,sr,vr))return!0}return!1},s}(nu));function Ps(a,s){var c=qc([],[a.x,a.y,0,1],s);return new se(c[0]/c[3],c[1]/c[3])}var Gl=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s}(No);function yu(a,s,c,m){var _=s.width,S=s.height;if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==_*S*c)throw new RangeError("mismatched image size")}else m=new Uint8Array(_*S*c);return a.width=_,a.height=S,a.data=m,a}function bl(a,s,c){var m=s.width,_=s.height;if(m!==a.width||_!==a.height){var S=yu({},{width:m,height:_},c);gc(a,S,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,m),height:Math.min(a.height,_)},c),a.width=m,a.height=_,a.data=S.data}}function gc(a,s,c,m,_,S){if(_.width===0||_.height===0)return s;if(_.width>a.width||_.height>a.height||c.x>a.width-_.width||c.y>a.height-_.height)throw new RangeError("out of range source coordinates for image copy");if(_.width>s.width||_.height>s.height||m.x>s.width-_.width||m.y>s.height-_.height)throw new RangeError("out of range destination coordinates for image copy");for(var A=a.data,P=s.data,F=0;F<_.height;F++)for(var j=((c.y+F)*a.width+c.x)*S,X=((m.y+F)*s.width+m.x)*S,ee=0;ee<_.width*S;ee++)P[X+ee]=A[j+ee];return s}Fn("HeatmapBucket",Gl,{omit:["layers"]});var _u=function(a,s){yu(this,a,1,s)};_u.prototype.resize=function(a){bl(this,a,1)},_u.prototype.clone=function(){return new _u({width:this.width,height:this.height},new Uint8Array(this.data))},_u.copy=function(a,s,c,m,_){gc(a,s,c,m,_,1)};var Ro=function(a,s){yu(this,a,4,s)};Ro.prototype.resize=function(a){bl(this,a,4)},Ro.prototype.replace=function(a,s){s?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a},Ro.prototype.clone=function(){return new Ro({width:this.width,height:this.height},new Uint8Array(this.data))},Ro.copy=function(a,s,c,m,_){gc(a,s,c,m,_,4)},Fn("AlphaImage",_u),Fn("RGBAImage",Ro);var Cf={paint:new Fo({"heatmap-radius":new Gn(Ce.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Gn(Ce.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Yn(Ce.paint_heatmap["heatmap-intensity"]),"heatmap-color":new du(Ce.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Yn(Ce.paint_heatmap["heatmap-opacity"])})};function Yf(a){var s={},c=a.resolution||256,m=a.clips?a.clips.length:1,_=a.image||new Ro({width:c,height:m}),S=function(je,He,pt){s[a.evaluationKey]=pt;var nt=a.expression.evaluate(s);_.data[je+He+0]=Math.floor(255*nt.r/nt.a),_.data[je+He+1]=Math.floor(255*nt.g/nt.a),_.data[je+He+2]=Math.floor(255*nt.b/nt.a),_.data[je+He+3]=Math.floor(255*nt.a)};if(a.clips)for(var A=0,P=0;A<m;++A,P+=4*c)for(var F=0,j=0;F<c;F++,j+=4){var X=F/(c-1),ee=a.clips[A];S(P,j,ee.start*(1-X)+ee.end*X)}else for(var fe=0,xe=0;fe<c;fe++,xe+=4)S(0,xe,fe/(c-1));return _}var Oh=function(a){function s(c){a.call(this,c,Cf),this._updateColorRamp()}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.createBucket=function(c){return new Gl(c)},s.prototype._handleSpecialPaintPropertyUpdate=function(c){c==="heatmap-color"&&this._updateColorRamp()},s.prototype._updateColorRamp=function(){this.colorRamp=Yf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},s.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},s.prototype.queryRadius=function(){return 0},s.prototype.queryIntersectsFeature=function(){return!1},s.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},s}(nu),qf={paint:new Fo({"hillshade-illumination-direction":new Yn(Ce.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Yn(Ce.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Yn(Ce.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Yn(Ce.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Yn(Ce.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Yn(Ce.paint_hillshade["hillshade-accent-color"])})},qp=function(a){function s(c){a.call(this,c,qf)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},s}(nu),Kp=ja([{name:"a_pos",components:2,type:"Int16"}],4).members,El=Af,yc=Af;function Af(a,s,c){c=c||2;var m,_,S,A,P,F,j,X=s&&s.length,ee=X?s[0]*c:a.length,fe=Lh(a,0,ee,c,!0),xe=[];if(!fe||fe.next===fe.prev)return xe;if(X&&(fe=function(He,pt,nt,kt){var Gt,sr,vr,fr=[];for(Gt=0,sr=pt.length;Gt<sr;Gt++)(vr=Lh(He,pt[Gt]*kt,Gt<sr-1?pt[Gt+1]*kt:He.length,kt,!1))===vr.next&&(vr.steiner=!0),fr.push(xc(vr));for(fr.sort(us),Gt=0;Gt<fr.length;Gt++)_c(fr[Gt],nt),nt=Hl(nt,nt.next);return nt}(a,s,fe,c)),a.length>80*c){m=S=a[0],_=A=a[1];for(var je=c;je<ee;je+=c)(P=a[je])<m&&(m=P),(F=a[je+1])<_&&(_=F),P>S&&(S=P),F>A&&(A=F);j=(j=Math.max(S-m,A-_))!==0?1/j:0}return Bs(fe,xe,c,m,_,j),xe}function Lh(a,s,c,m,_){var S,A;if(_===th(a,s,c,m)>0)for(S=s;S<c;S+=m)A=eh(S,a[S],a[S+1],A);else for(S=c-m;S>=s;S-=m)A=eh(S,a[S],a[S+1],A);return A&&Dh(A,A.next)&&(Xl(A),A=A.next),A}function Hl(a,s){if(!a)return a;s||(s=a);var c,m=a;do if(c=!1,m.steiner||!Dh(m,m.next)&&$o(m.prev,m,m.next)!==0)m=m.next;else{if(Xl(m),(m=s=m.prev)===m.next)break;c=!0}while(c||m!==s);return s}function Bs(a,s,c,m,_,S,A){if(a){!A&&S&&function(X,ee,fe,xe){var je=X;do je.z===null&&(je.z=Kf(je.x,je.y,ee,fe,xe)),je.prevZ=je.prev,je.nextZ=je.next,je=je.next;while(je!==X);je.prevZ.nextZ=null,je.prevZ=null,function(He){var pt,nt,kt,Gt,sr,vr,fr,Hr,dn=1;do{for(nt=He,He=null,sr=null,vr=0;nt;){for(vr++,kt=nt,fr=0,pt=0;pt<dn&&(fr++,kt=kt.nextZ);pt++);for(Hr=dn;fr>0||Hr>0&&kt;)fr!==0&&(Hr===0||!kt||nt.z<=kt.z)?(Gt=nt,nt=nt.nextZ,fr--):(Gt=kt,kt=kt.nextZ,Hr--),sr?sr.nextZ=Gt:He=Gt,Gt.prevZ=sr,sr=Gt;nt=kt}sr.nextZ=null,dn*=2}while(vr>1)}(je)}(a,m,_,S);for(var P,F,j=a;a.prev!==a.next;)if(P=a.prev,F=a.next,S?qr(a,m,_,S):Y(a))s.push(P.i/c),s.push(a.i/c),s.push(F.i/c),Xl(a),a=F.next,j=F.next;else if((a=F)===j){A?A===1?Bs(a=Wl(Hl(a),s,c),s,c,m,_,S,2):A===2&&Qp(a,s,c,m,_,S):Bs(Hl(a),s,c,m,_,S,1);break}}}function Y(a){var s=a.prev,c=a,m=a.next;if($o(s,c,m)>=0)return!1;for(var _=a.next.next;_!==a.prev;){if(el(s.x,s.y,c.x,c.y,m.x,m.y,_.x,_.y)&&$o(_.prev,_,_.next)>=0)return!1;_=_.next}return!0}function qr(a,s,c,m){var _=a.prev,S=a,A=a.next;if($o(_,S,A)>=0)return!1;for(var P=_.x>S.x?_.x>A.x?_.x:A.x:S.x>A.x?S.x:A.x,F=_.y>S.y?_.y>A.y?_.y:A.y:S.y>A.y?S.y:A.y,j=Kf(_.x<S.x?_.x<A.x?_.x:A.x:S.x<A.x?S.x:A.x,_.y<S.y?_.y<A.y?_.y:A.y:S.y<A.y?S.y:A.y,s,c,m),X=Kf(P,F,s,c,m),ee=a.prevZ,fe=a.nextZ;ee&&ee.z>=j&&fe&&fe.z<=X;){if(ee!==a.prev&&ee!==a.next&&el(_.x,_.y,S.x,S.y,A.x,A.y,ee.x,ee.y)&&$o(ee.prev,ee,ee.next)>=0||(ee=ee.prevZ,fe!==a.prev&&fe!==a.next&&el(_.x,_.y,S.x,S.y,A.x,A.y,fe.x,fe.y)&&$o(fe.prev,fe,fe.next)>=0))return!1;fe=fe.nextZ}for(;ee&&ee.z>=j;){if(ee!==a.prev&&ee!==a.next&&el(_.x,_.y,S.x,S.y,A.x,A.y,ee.x,ee.y)&&$o(ee.prev,ee,ee.next)>=0)return!1;ee=ee.prevZ}for(;fe&&fe.z<=X;){if(fe!==a.prev&&fe!==a.next&&el(_.x,_.y,S.x,S.y,A.x,A.y,fe.x,fe.y)&&$o(fe.prev,fe,fe.next)>=0)return!1;fe=fe.nextZ}return!0}function Wl(a,s,c){var m=a;do{var _=m.prev,S=m.next.next;!Dh(_,S)&&Fh(_,m,m.next,S)&&Jf(_,S)&&Jf(S,_)&&(s.push(_.i/c),s.push(m.i/c),s.push(S.i/c),Xl(m),Xl(m.next),m=a=S),m=m.next}while(m!==a);return Hl(m)}function Qp(a,s,c,m,_,S){var A=a;do{for(var P=A.next.next;P!==A.prev;){if(A.i!==P.i&&lp(A,P)){var F=Bh(A,P);return A=Hl(A,A.next),F=Hl(F,F.next),Bs(A,s,c,m,_,S),void Bs(F,s,c,m,_,S)}P=P.next}A=A.next}while(A!==a)}function us(a,s){return a.x-s.x}function _c(a,s){if(s=function(m,_){var S,A=_,P=m.x,F=m.y,j=-1/0;do{if(F<=A.y&&F>=A.next.y&&A.next.y!==A.y){var X=A.x+(F-A.y)*(A.next.x-A.x)/(A.next.y-A.y);if(X<=P&&X>j){if(j=X,X===P){if(F===A.y)return A;if(F===A.next.y)return A.next}S=A.x<A.next.x?A:A.next}}A=A.next}while(A!==_);if(!S)return null;if(P===j)return S;var ee,fe=S,xe=S.x,je=S.y,He=1/0;A=S;do P>=A.x&&A.x>=xe&&P!==A.x&&el(F<je?P:j,F,xe,je,F<je?j:P,F,A.x,A.y)&&(ee=Math.abs(F-A.y)/(P-A.x),Jf(A,m)&&(ee<He||ee===He&&(A.x>S.x||A.x===S.x&&Kc(S,A)))&&(S=A,He=ee)),A=A.next;while(A!==fe);return S}(a,s)){var c=Bh(s,a);Hl(s,s.next),Hl(c,c.next)}}function Kc(a,s){return $o(a.prev,a,s.prev)<0&&$o(s.next,a,a.next)<0}function Kf(a,s,c,m,_){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-c)*_)|a<<8))|a<<4))|a<<2))|a<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=32767*(s-m)*_)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function xc(a){var s=a,c=a;do(s.x<c.x||s.x===c.x&&s.y<c.y)&&(c=s),s=s.next;while(s!==a);return c}function el(a,s,c,m,_,S,A,P){return(_-A)*(s-P)-(a-A)*(S-P)>=0&&(a-A)*(m-P)-(c-A)*(s-P)>=0&&(c-A)*(S-P)-(_-A)*(m-P)>=0}function lp(a,s){return a.next.i!==s.i&&a.prev.i!==s.i&&!function(c,m){var _=c;do{if(_.i!==c.i&&_.next.i!==c.i&&_.i!==m.i&&_.next.i!==m.i&&Fh(_,_.next,c,m))return!0;_=_.next}while(_!==c);return!1}(a,s)&&(Jf(a,s)&&Jf(s,a)&&function(c,m){var _=c,S=!1,A=(c.x+m.x)/2,P=(c.y+m.y)/2;do _.y>P!=_.next.y>P&&_.next.y!==_.y&&A<(_.next.x-_.x)*(P-_.y)/(_.next.y-_.y)+_.x&&(S=!S),_=_.next;while(_!==c);return S}(a,s)&&($o(a.prev,a,s.prev)||$o(a,s.prev,s))||Dh(a,s)&&$o(a.prev,a,a.next)>0&&$o(s.prev,s,s.next)>0)}function $o(a,s,c){return(s.y-a.y)*(c.x-s.x)-(s.x-a.x)*(c.y-s.y)}function Dh(a,s){return a.x===s.x&&a.y===s.y}function Fh(a,s,c,m){var _=Qf($o(a,s,c)),S=Qf($o(a,s,m)),A=Qf($o(c,m,a)),P=Qf($o(c,m,s));return _!==S&&A!==P||!(_!==0||!Qc(a,c,s))||!(S!==0||!Qc(a,m,s))||!(A!==0||!Qc(c,a,m))||!(P!==0||!Qc(c,s,m))}function Qc(a,s,c){return s.x<=Math.max(a.x,c.x)&&s.x>=Math.min(a.x,c.x)&&s.y<=Math.max(a.y,c.y)&&s.y>=Math.min(a.y,c.y)}function Qf(a){return a>0?1:a<0?-1:0}function Jf(a,s){return $o(a.prev,a,a.next)<0?$o(a,s,a.next)>=0&&$o(a,a.prev,s)>=0:$o(a,s,a.prev)<0||$o(a,a.next,s)<0}function Bh(a,s){var c=new Jc(a.i,a.x,a.y),m=new Jc(s.i,s.x,s.y),_=a.next,S=s.prev;return a.next=s,s.prev=a,c.next=_,_.prev=c,m.next=c,c.prev=m,S.next=m,m.prev=S,m}function eh(a,s,c,m){var _=new Jc(a,s,c);return m?(_.next=m.next,_.prev=m,m.next.prev=_,m.next=_):(_.prev=_,_.next=_),_}function Xl(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function Jc(a,s,c){this.i=a,this.x=s,this.y=c,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function th(a,s,c,m){for(var _=0,S=s,A=c-m;S<c;S+=m)_+=(a[A]-a[S])*(a[S+1]+a[A+1]),A=S;return _}function Tf(a,s,c,m,_){(function S(A,P,F,j,X){for(;j>F;){if(j-F>600){var ee=j-F+1,fe=P-F+1,xe=Math.log(ee),je=.5*Math.exp(2*xe/3),He=.5*Math.sqrt(xe*je*(ee-je)/ee)*(fe-ee/2<0?-1:1);S(A,P,Math.max(F,Math.floor(P-fe*je/ee+He)),Math.min(j,Math.floor(P+(ee-fe)*je/ee+He)),X)}var pt=A[P],nt=F,kt=j;for($l(A,F,P),X(A[j],pt)>0&&$l(A,F,j);nt<kt;){for($l(A,nt,kt),nt++,kt--;X(A[nt],pt)<0;)nt++;for(;X(A[kt],pt)>0;)kt--}X(A[F],pt)===0?$l(A,F,kt):$l(A,++kt,j),kt<=P&&(F=kt+1),P<=kt&&(j=kt-1)}})(a,s,c||0,m||a.length-1,_||Nh)}function $l(a,s,c){var m=a[s];a[s]=a[c],a[c]=m}function Nh(a,s){return a<s?-1:a>s?1:0}function rh(a,s){var c=a.length;if(c<=1)return[a];for(var m,_,S=[],A=0;A<c;A++){var P=wr(a[A]);P!==0&&(a[A].area=Math.abs(P),_===void 0&&(_=P<0),_===P<0?(m&&S.push(m),m=[a[A]]):m.push(a[A]))}if(m&&S.push(m),s>1)for(var F=0;F<S.length;F++)S[F].length<=s||(Tf(S[F],s,1,S[F].length-1,zh),S[F]=S[F].slice(0,s));return S}function zh(a,s){return s.area-a.area}function Sl(a,s,c){for(var m=c.patternDependencies,_=!1,S=0,A=s;S<A.length;S+=1){var P=A[S].paint.get(a+"-pattern");P.isConstant()||(_=!0);var F=P.constantOr(null);F&&(_=!0,m[F.to]=!0,m[F.from]=!0)}return _}function Mf(a,s,c,m,_){for(var S=_.patternDependencies,A=0,P=s;A<P.length;A+=1){var F=P[A],j=F.paint.get(a+"-pattern").value;if(j.kind!=="constant"){var X=j.evaluate({zoom:m-1},c,{},_.availableImages),ee=j.evaluate({zoom:m},c,{},_.availableImages),fe=j.evaluate({zoom:m+1},c,{},_.availableImages);ee=ee&&ee.name?ee.name:ee,fe=fe&&fe.name?fe.name:fe,S[X=X&&X.name?X.name:X]=!0,S[ee]=!0,S[fe]=!0,c.patterns[F.id]={min:X,mid:ee,max:fe}}}return c}Af.deviation=function(a,s,c,m){var _=s&&s.length,S=Math.abs(th(a,0,_?s[0]*c:a.length,c));if(_)for(var A=0,P=s.length;A<P;A++)S-=Math.abs(th(a,s[A]*c,A<P-1?s[A+1]*c:a.length,c));var F=0;for(A=0;A<m.length;A+=3){var j=m[A]*c,X=m[A+1]*c,ee=m[A+2]*c;F+=Math.abs((a[j]-a[ee])*(a[X+1]-a[j+1])-(a[j]-a[X])*(a[ee+1]-a[j+1]))}return S===0&&F===0?0:Math.abs((F-S)/S)},Af.flatten=function(a){for(var s=a[0][0].length,c={vertices:[],holes:[],dimensions:s},m=0,_=0;_<a.length;_++){for(var S=0;S<a[_].length;S++)for(var A=0;A<s;A++)c.vertices.push(a[_][S][A]);_>0&&c.holes.push(m+=a[_-1].length)}return c},El.default=yc;var ou=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new vl,this.indexArray=new Vl,this.indexArray2=new Wc,this.programConfigurations=new oi(a.layers,a.zoom),this.segments=new Se,this.segments2=new Se,this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};ou.prototype.populate=function(a,s,c){this.hasPattern=Sl("fill",this.layers,s);for(var m=this.layers[0].layout.get("fill-sort-key"),_=[],S=0,A=a;S<A.length;S+=1){var P=A[S],F=P.feature,j=P.id,X=P.index,ee=P.sourceLayerIndex,fe=this.layers[0]._featureFilter.needGeometry,xe=yo(F,fe);if(this.layers[0]._featureFilter.filter(new Li(this.zoom),xe,c)){var je=m?m.evaluate(xe,{},c,s.availableImages):void 0,He={id:j,properties:F.properties,type:F.type,sourceLayerIndex:ee,index:X,geometry:fe?xe.geometry:Ja(F),patterns:{},sortKey:je};_.push(He)}}m&&_.sort(function(Hr,dn){return Hr.sortKey-dn.sortKey});for(var pt=0,nt=_;pt<nt.length;pt+=1){var kt=nt[pt],Gt=kt.geometry,sr=kt.index,vr=kt.sourceLayerIndex;if(this.hasPattern){var fr=Mf("fill",this.layers,kt,this.zoom,s);this.patternFeatures.push(fr)}else this.addFeature(kt,Gt,sr,c,{});s.featureIndex.insert(a[sr].feature,Gt,sr,vr,this.index)}},ou.prototype.update=function(a,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,s,this.stateDependentLayers,c)},ou.prototype.addFeatures=function(a,s,c){for(var m=0,_=this.patternFeatures;m<_.length;m+=1){var S=_[m];this.addFeature(S,S.geometry,S.index,s,c)}},ou.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ou.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ou.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Kp),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.indexBuffer2=a.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(a),this.uploaded=!0},ou.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},ou.prototype.addFeature=function(a,s,c,m,_){for(var S=0,A=rh(s,500);S<A.length;S+=1){for(var P=A[S],F=0,j=0,X=P;j<X.length;j+=1)F+=X[j].length;for(var ee=this.segments.prepareSegment(F,this.layoutVertexArray,this.indexArray),fe=ee.vertexLength,xe=[],je=[],He=0,pt=P;He<pt.length;He+=1){var nt=pt[He];if(nt.length!==0){nt!==P[0]&&je.push(xe.length/2);var kt=this.segments2.prepareSegment(nt.length,this.layoutVertexArray,this.indexArray2),Gt=kt.vertexLength;this.layoutVertexArray.emplaceBack(nt[0].x,nt[0].y),this.indexArray2.emplaceBack(Gt+nt.length-1,Gt),xe.push(nt[0].x),xe.push(nt[0].y);for(var sr=1;sr<nt.length;sr++)this.layoutVertexArray.emplaceBack(nt[sr].x,nt[sr].y),this.indexArray2.emplaceBack(Gt+sr-1,Gt+sr),xe.push(nt[sr].x),xe.push(nt[sr].y);kt.vertexLength+=nt.length,kt.primitiveLength+=nt.length}}for(var vr=El(xe,je),fr=0;fr<vr.length;fr+=3)this.indexArray.emplaceBack(fe+vr[fr],fe+vr[fr+1],fe+vr[fr+2]);ee.vertexLength+=F,ee.primitiveLength+=vr.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,c,_,m)},Fn("FillBucket",ou,{omit:["layers","patternFeatures"]});var nh=new Fo({"fill-sort-key":new Gn(Ce.layout_fill["fill-sort-key"])}),ih={paint:new Fo({"fill-antialias":new Yn(Ce.paint_fill["fill-antialias"]),"fill-opacity":new Gn(Ce.paint_fill["fill-opacity"]),"fill-color":new Gn(Ce.paint_fill["fill-color"]),"fill-outline-color":new Gn(Ce.paint_fill["fill-outline-color"]),"fill-translate":new Yn(Ce.paint_fill["fill-translate"]),"fill-translate-anchor":new Yn(Ce.paint_fill["fill-translate-anchor"]),"fill-pattern":new hc(Ce.paint_fill["fill-pattern"])}),layout:nh},ah=function(a){function s(c){a.call(this,c,ih)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.recalculate=function(c,m){a.prototype.recalculate.call(this,c,m);var _=this.paint._values["fill-outline-color"];_.value.kind==="constant"&&_.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},s.prototype.createBucket=function(c){return new ou(c)},s.prototype.queryRadius=function(){return wo(this.paint.get("fill-translate"))},s.prototype.queryIntersectsFeature=function(c,m,_,S,A,P,F){return mu(Pu(c,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),P.angle,F),S)},s.prototype.isTileClipped=function(){return!0},s}(nu),ef=ja([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,wl=xu;function xu(a,s,c,m,_){this.properties={},this.extent=c,this.type=0,this._pbf=a,this._geometry=-1,this._keys=m,this._values=_,a.readFields(tf,this,s)}function tf(a,s,c){a==1?s.id=c.readVarint():a==2?function(m,_){for(var S=m.readVarint()+m.pos;m.pos<S;){var A=_._keys[m.readVarint()],P=_._values[m.readVarint()];_.properties[A]=P}}(c,s):a==3?s.type=c.readVarint():a==4&&(s._geometry=c.pos)}function Jp(a){for(var s,c,m=0,_=0,S=a.length,A=S-1;_<S;A=_++)m+=((c=a[A]).x-(s=a[_]).x)*(s.y+c.y);return m}xu.types=["Unknown","Point","LineString","Polygon"],xu.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var s,c=a.readVarint()+a.pos,m=1,_=0,S=0,A=0,P=[];a.pos<c;){if(_<=0){var F=a.readVarint();m=7&F,_=F>>3}if(_--,m===1||m===2)S+=a.readSVarint(),A+=a.readSVarint(),m===1&&(s&&P.push(s),s=[]),s.push(new se(S,A));else{if(m!==7)throw new Error("unknown command "+m);s&&s.push(s[0].clone())}}return s&&P.push(s),P},xu.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var s=a.readVarint()+a.pos,c=1,m=0,_=0,S=0,A=1/0,P=-1/0,F=1/0,j=-1/0;a.pos<s;){if(m<=0){var X=a.readVarint();c=7&X,m=X>>3}if(m--,c===1||c===2)(_+=a.readSVarint())<A&&(A=_),_>P&&(P=_),(S+=a.readSVarint())<F&&(F=S),S>j&&(j=S);else if(c!==7)throw new Error("unknown command "+c)}return[A,F,P,j]},xu.prototype.toGeoJSON=function(a,s,c){var m,_,S=this.extent*Math.pow(2,c),A=this.extent*a,P=this.extent*s,F=this.loadGeometry(),j=xu.types[this.type];function X(xe){for(var je=0;je<xe.length;je++){var He=xe[je];xe[je]=[360*(He.x+A)/S-180,360/Math.PI*Math.atan(Math.exp((180-360*(He.y+P)/S)*Math.PI/180))-90]}}switch(this.type){case 1:var ee=[];for(m=0;m<F.length;m++)ee[m]=F[m][0];X(F=ee);break;case 2:for(m=0;m<F.length;m++)X(F[m]);break;case 3:for(F=function(xe){var je=xe.length;if(je<=1)return[xe];for(var He,pt,nt=[],kt=0;kt<je;kt++){var Gt=Jp(xe[kt]);Gt!==0&&(pt===void 0&&(pt=Gt<0),pt===Gt<0?(He&&nt.push(He),He=[xe[kt]]):He.push(xe[kt]))}return He&&nt.push(He),nt}(F),m=0;m<F.length;m++)for(_=0;_<F[m].length;_++)X(F[m][_])}F.length===1?F=F[0]:j="Multi"+j;var fe={type:"Feature",geometry:{type:j,coordinates:F},properties:this.properties};return"id"in this&&(fe.id=this.id),fe};var cp=rf;function rf(a,s){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(Ru,this,s),this.length=this._features.length}function Ru(a,s,c){a===15?s.version=c.readVarint():a===1?s.name=c.readString():a===5?s.extent=c.readVarint():a===2?s._features.push(c.pos):a===3?s._keys.push(c.readString()):a===4&&s._values.push(function(m){for(var _=null,S=m.readVarint()+m.pos;m.pos<S;){var A=m.readVarint()>>3;_=A===1?m.readString():A===2?m.readFloat():A===3?m.readDouble():A===4?m.readVarint64():A===5?m.readVarint():A===6?m.readSVarint():A===7?m.readBoolean():null}return _}(c))}function ed(a,s,c){if(a===3){var m=new cp(c,c.readVarint()+c.pos);m.length&&(s[m.name]=m)}}rf.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var s=this._pbf.readVarint()+this._pbf.pos;return new wl(this._pbf,s,this.extent,this._keys,this._values)};var bu={VectorTile:function(a,s){this.layers=a.readFields(ed,{},s)},VectorTileFeature:wl,VectorTileLayer:cp},oh=bu.VectorTileFeature.types,Zh=Math.pow(2,13);function kf(a,s,c,m,_,S,A,P){a.emplaceBack(s,c,2*Math.floor(m*Zh)+A,_*Zh*2,S*Zh*2,Math.round(P))}var tl=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new vu,this.indexArray=new Vl,this.programConfigurations=new oi(a.layers,a.zoom),this.segments=new Se,this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};function fp(a,s){return a.x===s.x&&(a.x<0||a.x>8192)||a.y===s.y&&(a.y<0||a.y>8192)}tl.prototype.populate=function(a,s,c){this.features=[],this.hasPattern=Sl("fill-extrusion",this.layers,s);for(var m=0,_=a;m<_.length;m+=1){var S=_[m],A=S.feature,P=S.id,F=S.index,j=S.sourceLayerIndex,X=this.layers[0]._featureFilter.needGeometry,ee=yo(A,X);if(this.layers[0]._featureFilter.filter(new Li(this.zoom),ee,c)){var fe={id:P,sourceLayerIndex:j,index:F,geometry:X?ee.geometry:Ja(A),properties:A.properties,type:A.type,patterns:{}};this.hasPattern?this.features.push(Mf("fill-extrusion",this.layers,fe,this.zoom,s)):this.addFeature(fe,fe.geometry,F,c,{}),s.featureIndex.insert(A,fe.geometry,F,j,this.index,!0)}}},tl.prototype.addFeatures=function(a,s,c){for(var m=0,_=this.features;m<_.length;m+=1){var S=_[m];this.addFeature(S,S.geometry,S.index,s,c)}},tl.prototype.update=function(a,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,s,this.stateDependentLayers,c)},tl.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},tl.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},tl.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,ef),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},tl.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},tl.prototype.addFeature=function(a,s,c,m,_){for(var S=0,A=rh(s,500);S<A.length;S+=1){for(var P=A[S],F=0,j=0,X=P;j<X.length;j+=1)F+=X[j].length;for(var ee=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),fe=0,xe=P;fe<xe.length;fe+=1){var je=xe[fe];if(je.length!==0&&!((Wi=je).every(function(xi){return xi.x<0})||Wi.every(function(xi){return xi.x>8192})||Wi.every(function(xi){return xi.y<0})||Wi.every(function(xi){return xi.y>8192})))for(var He=0,pt=0;pt<je.length;pt++){var nt=je[pt];if(pt>=1){var kt=je[pt-1];if(!fp(nt,kt)){ee.vertexLength+4>Se.MAX_VERTEX_ARRAY_LENGTH&&(ee=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var Gt=nt.sub(kt)._perp()._unit(),sr=kt.dist(nt);He+sr>32768&&(He=0),kf(this.layoutVertexArray,nt.x,nt.y,Gt.x,Gt.y,0,0,He),kf(this.layoutVertexArray,nt.x,nt.y,Gt.x,Gt.y,0,1,He),kf(this.layoutVertexArray,kt.x,kt.y,Gt.x,Gt.y,0,0,He+=sr),kf(this.layoutVertexArray,kt.x,kt.y,Gt.x,Gt.y,0,1,He);var vr=ee.vertexLength;this.indexArray.emplaceBack(vr,vr+2,vr+1),this.indexArray.emplaceBack(vr+1,vr+2,vr+3),ee.vertexLength+=4,ee.primitiveLength+=2}}}}if(ee.vertexLength+F>Se.MAX_VERTEX_ARRAY_LENGTH&&(ee=this.segments.prepareSegment(F,this.layoutVertexArray,this.indexArray)),oh[a.type]==="Polygon"){for(var fr=[],Hr=[],dn=ee.vertexLength,Kn=0,kn=P;Kn<kn.length;Kn+=1){var ai=kn[Kn];if(ai.length!==0){ai!==P[0]&&Hr.push(fr.length/2);for(var In=0;In<ai.length;In++){var zi=ai[In];kf(this.layoutVertexArray,zi.x,zi.y,0,0,1,1,0),fr.push(zi.x),fr.push(zi.y)}}}for(var di=El(fr,Hr),Xn=0;Xn<di.length;Xn+=3)this.indexArray.emplaceBack(dn+di[Xn],dn+di[Xn+2],dn+di[Xn+1]);ee.primitiveLength+=di.length/3,ee.vertexLength+=F}}var Wi;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,c,_,m)},Fn("FillExtrusionBucket",tl,{omit:["layers","features"]});var hp={paint:new Fo({"fill-extrusion-opacity":new Yn(Ce["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Gn(Ce["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Yn(Ce["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Yn(Ce["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new hc(Ce["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Gn(Ce["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Gn(Ce["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Yn(Ce["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Eu=function(a){function s(c){a.call(this,c,hp)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.createBucket=function(c){return new tl(c)},s.prototype.queryRadius=function(){return wo(this.paint.get("fill-extrusion-translate"))},s.prototype.is3D=function(){return!0},s.prototype.queryIntersectsFeature=function(c,m,_,S,A,P,F,j){var X=Pu(c,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),P.angle,F),ee=this.paint.get("fill-extrusion-height").evaluate(m,_),fe=this.paint.get("fill-extrusion-base").evaluate(m,_),xe=function(He,pt,nt,kt){for(var Gt=[],sr=0,vr=He;sr<vr.length;sr+=1){var fr=vr[sr],Hr=[fr.x,fr.y,0,1];qc(Hr,Hr,pt),Gt.push(new se(Hr[0]/Hr[3],Hr[1]/Hr[3]))}return Gt}(X,j),je=function(He,pt,nt,kt){for(var Gt=[],sr=[],vr=kt[8]*pt,fr=kt[9]*pt,Hr=kt[10]*pt,dn=kt[11]*pt,Kn=kt[8]*nt,kn=kt[9]*nt,ai=kt[10]*nt,In=kt[11]*nt,zi=0,di=He;zi<di.length;zi+=1){for(var Xn=[],Wi=[],xi=0,qi=di[zi];xi<qi.length;xi+=1){var Qn=qi[xi],ba=Qn.x,$a=Qn.y,xo=kt[0]*ba+kt[4]*$a+kt[12],vo=kt[1]*ba+kt[5]*$a+kt[13],so=kt[2]*ba+kt[6]*$a+kt[14],Lo=kt[3]*ba+kt[7]*$a+kt[15],cs=so+Hr,fs=Lo+dn,$s=xo+Kn,Es=vo+kn,zs=so+ai,Vo=Lo+In,Ss=new se((xo+vr)/fs,(vo+fr)/fs);Ss.z=cs/fs,Xn.push(Ss);var Ki=new se($s/Vo,Es/Vo);Ki.z=zs/Vo,Wi.push(Ki)}Gt.push(Xn),sr.push(Wi)}return[Gt,sr]}(S,fe,ee,j);return function(He,pt,nt){var kt=1/0;mu(nt,pt)&&(kt=bc(nt,pt[0]));for(var Gt=0;Gt<pt.length;Gt++)for(var sr=pt[Gt],vr=He[Gt],fr=0;fr<sr.length-1;fr++){var Hr=sr[fr],dn=[Hr,sr[fr+1],vr[fr+1],vr[fr],Hr];Iu(nt,dn)&&(kt=Math.min(kt,bc(nt,dn)))}return kt!==1/0&&kt}(je[0],je[1],xe)},s}(nu);function sh(a,s){return a.x*s.x+a.y*s.y}function bc(a,s){if(a.length===1){for(var c,m=0,_=s[m++];!c||_.equals(c);)if(!(c=s[m++]))return 1/0;for(;m<s.length;m++){var S=s[m],A=a[0],P=c.sub(_),F=S.sub(_),j=A.sub(_),X=sh(P,P),ee=sh(P,F),fe=sh(F,F),xe=sh(j,P),je=sh(j,F),He=X*fe-ee*ee,pt=(fe*xe-ee*je)/He,nt=(X*je-ee*xe)/He,kt=_.z*(1-pt-nt)+c.z*pt+S.z*nt;if(isFinite(kt))return kt}return 1/0}for(var Gt=1/0,sr=0,vr=s;sr<vr.length;sr+=1)Gt=Math.min(Gt,vr[sr].z);return Gt}var Ec=ja([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,td=ja([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,pp=bu.VectorTileFeature.types,Uh=Math.cos(Math.PI/180*37.5),uh=Math.pow(2,14)/.5,ya=function(a){var s=this;this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(c){return c.id}),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(c){s.gradients[c.id]={}}),this.layoutVertexArray=new Io,this.layoutVertexArray2=new ml,this.indexArray=new Vl,this.programConfigurations=new oi(a.layers,a.zoom),this.segments=new Se,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(c){return c.isStateDependent()}).map(function(c){return c.id})};ya.prototype.populate=function(a,s,c){this.hasPattern=Sl("line",this.layers,s);for(var m=this.layers[0].layout.get("line-sort-key"),_=[],S=0,A=a;S<A.length;S+=1){var P=A[S],F=P.feature,j=P.id,X=P.index,ee=P.sourceLayerIndex,fe=this.layers[0]._featureFilter.needGeometry,xe=yo(F,fe);if(this.layers[0]._featureFilter.filter(new Li(this.zoom),xe,c)){var je=m?m.evaluate(xe,{},c):void 0,He={id:j,properties:F.properties,type:F.type,sourceLayerIndex:ee,index:X,geometry:fe?xe.geometry:Ja(F),patterns:{},sortKey:je};_.push(He)}}m&&_.sort(function(Hr,dn){return Hr.sortKey-dn.sortKey});for(var pt=0,nt=_;pt<nt.length;pt+=1){var kt=nt[pt],Gt=kt.geometry,sr=kt.index,vr=kt.sourceLayerIndex;if(this.hasPattern){var fr=Mf("line",this.layers,kt,this.zoom,s);this.patternFeatures.push(fr)}else this.addFeature(kt,Gt,sr,c,{});s.featureIndex.insert(a[sr].feature,Gt,sr,vr,this.index)}},ya.prototype.update=function(a,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,s,this.stateDependentLayers,c)},ya.prototype.addFeatures=function(a,s,c){for(var m=0,_=this.patternFeatures;m<_.length;m+=1){var S=_[m];this.addFeature(S,S.geometry,S.index,s,c)}},ya.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ya.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ya.prototype.upload=function(a){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,td)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Ec),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},ya.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ya.prototype.lineFeatureClips=function(a){if(a.properties&&a.properties.hasOwnProperty("mapbox_clip_start")&&a.properties.hasOwnProperty("mapbox_clip_end"))return{start:+a.properties.mapbox_clip_start,end:+a.properties.mapbox_clip_end}},ya.prototype.addFeature=function(a,s,c,m,_){var S=this.layers[0].layout,A=S.get("line-join").evaluate(a,{}),P=S.get("line-cap"),F=S.get("line-miter-limit"),j=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(a);for(var X=0,ee=s;X<ee.length;X+=1)this.addLine(ee[X],a,A,P,F,j);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,c,_,m)},ya.prototype.addLine=function(a,s,c,m,_,S){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var A=0;A<a.length-1;A++)this.totalDistance+=a[A].dist(a[A+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var P=pp[s.type]==="Polygon",F=a.length;F>=2&&a[F-1].equals(a[F-2]);)F--;for(var j=0;j<F-1&&a[j].equals(a[j+1]);)j++;if(!(F<(P?3:2))){c==="bevel"&&(_=1.05);var X,ee=this.overscaling<=16?122880/(512*this.overscaling):0,fe=this.segments.prepareSegment(10*F,this.layoutVertexArray,this.indexArray),xe=void 0,je=void 0,He=void 0,pt=void 0;this.e1=this.e2=-1,P&&(pt=a[j].sub(X=a[F-2])._unit()._perp());for(var nt=j;nt<F;nt++)if(!(je=nt===F-1?P?a[j+1]:void 0:a[nt+1])||!a[nt].equals(je)){pt&&(He=pt),X&&(xe=X),X=a[nt],pt=je?je.sub(X)._unit()._perp():He;var kt=(He=He||pt).add(pt);kt.x===0&&kt.y===0||kt._unit();var Gt=He.x*pt.x+He.y*pt.y,sr=kt.x*pt.x+kt.y*pt.y,vr=sr!==0?1/sr:1/0,fr=2*Math.sqrt(2-2*sr),Hr=sr<Uh&&xe&&je,dn=He.x*pt.y-He.y*pt.x>0;if(Hr&&nt>j){var Kn=X.dist(xe);if(Kn>2*ee){var kn=X.sub(X.sub(xe)._mult(ee/Kn)._round());this.updateDistance(xe,kn),this.addCurrentVertex(kn,He,0,0,fe),xe=kn}}var ai=xe&&je,In=ai?c:P?"butt":m;if(ai&&In==="round"&&(vr<S?In="miter":vr<=2&&(In="fakeround")),In==="miter"&&vr>_&&(In="bevel"),In==="bevel"&&(vr>2&&(In="flipbevel"),vr<_&&(In="miter")),xe&&this.updateDistance(xe,X),In==="miter")kt._mult(vr),this.addCurrentVertex(X,kt,0,0,fe);else if(In==="flipbevel"){if(vr>100)kt=pt.mult(-1);else{var zi=vr*He.add(pt).mag()/He.sub(pt).mag();kt._perp()._mult(zi*(dn?-1:1))}this.addCurrentVertex(X,kt,0,0,fe),this.addCurrentVertex(X,kt.mult(-1),0,0,fe)}else if(In==="bevel"||In==="fakeround"){var di=-Math.sqrt(vr*vr-1),Xn=dn?di:0,Wi=dn?0:di;if(xe&&this.addCurrentVertex(X,He,Xn,Wi,fe),In==="fakeround")for(var xi=Math.round(180*fr/Math.PI/20),qi=1;qi<xi;qi++){var Qn=qi/xi;if(Qn!==.5){var ba=Qn-.5;Qn+=Qn*ba*(Qn-1)*((1.0904+Gt*(Gt*(3.55645-1.43519*Gt)-3.2452))*ba*ba+(.848013+Gt*(.215638*Gt-1.06021)))}var $a=pt.sub(He)._mult(Qn)._add(He)._unit()._mult(dn?-1:1);this.addHalfVertex(X,$a.x,$a.y,!1,dn,0,fe)}je&&this.addCurrentVertex(X,pt,-Xn,-Wi,fe)}else if(In==="butt")this.addCurrentVertex(X,kt,0,0,fe);else if(In==="square"){var xo=xe?1:-1;this.addCurrentVertex(X,kt,xo,xo,fe)}else In==="round"&&(xe&&(this.addCurrentVertex(X,He,0,0,fe),this.addCurrentVertex(X,He,1,1,fe,!0)),je&&(this.addCurrentVertex(X,pt,-1,-1,fe,!0),this.addCurrentVertex(X,pt,0,0,fe)));if(Hr&&nt<F-1){var vo=X.dist(je);if(vo>2*ee){var so=X.add(je.sub(X)._mult(ee/vo)._round());this.updateDistance(X,so),this.addCurrentVertex(so,pt,0,0,fe),X=so}}}}},ya.prototype.addCurrentVertex=function(a,s,c,m,_,S){S===void 0&&(S=!1);var A=s.y*m-s.x,P=-s.y-s.x*m;this.addHalfVertex(a,s.x+s.y*c,s.y-s.x*c,S,!1,c,_),this.addHalfVertex(a,A,P,S,!0,-m,_),this.distance>uh/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(a,s,c,m,_,S))},ya.prototype.addHalfVertex=function(a,s,c,m,_,S,A){var P=.5*(this.lineClips?this.scaledDistance*(uh-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((a.x<<1)+(m?1:0),(a.y<<1)+(_?1:0),Math.round(63*s)+128,Math.round(63*c)+128,1+(S===0?0:S<0?-1:1)|(63&P)<<2,P>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var F=A.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,F),A.primitiveLength++),_?this.e2=F:this.e1=F},ya.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},ya.prototype.updateDistance=function(a,s){this.distance+=a.dist(s),this.updateScaledDistance()},Fn("LineBucket",ya,{omit:["layers","patternFeatures"]});var Yl=new Fo({"line-cap":new Yn(Ce.layout_line["line-cap"]),"line-join":new Gn(Ce.layout_line["line-join"]),"line-miter-limit":new Yn(Ce.layout_line["line-miter-limit"]),"line-round-limit":new Yn(Ce.layout_line["line-round-limit"]),"line-sort-key":new Gn(Ce.layout_line["line-sort-key"])}),zo={paint:new Fo({"line-opacity":new Gn(Ce.paint_line["line-opacity"]),"line-color":new Gn(Ce.paint_line["line-color"]),"line-translate":new Yn(Ce.paint_line["line-translate"]),"line-translate-anchor":new Yn(Ce.paint_line["line-translate-anchor"]),"line-width":new Gn(Ce.paint_line["line-width"]),"line-gap-width":new Gn(Ce.paint_line["line-gap-width"]),"line-offset":new Gn(Ce.paint_line["line-offset"]),"line-blur":new Gn(Ce.paint_line["line-blur"]),"line-dasharray":new gs(Ce.paint_line["line-dasharray"]),"line-pattern":new hc(Ce.paint_line["line-pattern"]),"line-gradient":new du(Ce.paint_line["line-gradient"])}),layout:Yl},su=new(function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.possiblyEvaluate=function(c,m){return m=new Li(Math.floor(m.zoom),{now:m.now,fadeDuration:m.fadeDuration,zoomHistory:m.zoomHistory,transition:m.transition}),a.prototype.possiblyEvaluate.call(this,c,m)},s.prototype.evaluate=function(c,m,_,S){return m=Mt({},m,{zoom:Math.floor(m.zoom)}),a.prototype.evaluate.call(this,c,m,_,S)},s}(Gn))(zo.paint.properties["line-width"].specification);su.useIntegerZoom=!0;var zd=function(a){function s(c){a.call(this,c,zo),this.gradientVersion=0}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._handleSpecialPaintPropertyUpdate=function(c){c==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof ps,this.gradientVersion=(this.gradientVersion+1)%Qe)},s.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},s.prototype.recalculate=function(c,m){a.prototype.recalculate.call(this,c,m),this.paint._values["line-floorwidth"]=su.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)},s.prototype.createBucket=function(c){return new ya(c)},s.prototype.queryRadius=function(c){var m=c,_=rd(Gu("line-width",this,m),Gu("line-gap-width",this,m)),S=Gu("line-offset",this,m);return _/2+Math.abs(S)+wo(this.paint.get("line-translate"))},s.prototype.queryIntersectsFeature=function(c,m,_,S,A,P,F){var j=Pu(c,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),P.angle,F),X=F/2*rd(this.paint.get("line-width").evaluate(m,_),this.paint.get("line-gap-width").evaluate(m,_)),ee=this.paint.get("line-offset").evaluate(m,_);return ee&&(S=function(fe,xe){for(var je=[],He=new se(0,0),pt=0;pt<fe.length;pt++){for(var nt=fe[pt],kt=[],Gt=0;Gt<nt.length;Gt++){var sr=nt[Gt],vr=nt[Gt+1],fr=Gt===0?He:sr.sub(nt[Gt-1])._unit()._perp(),Hr=Gt===nt.length-1?He:vr.sub(sr)._unit()._perp(),dn=fr._add(Hr)._unit();dn._mult(1/(dn.x*Hr.x+dn.y*Hr.y)),kt.push(dn._mult(xe)._add(sr))}je.push(kt)}return je}(S,ee*F)),function(fe,xe,je){for(var He=0;He<xe.length;He++){var pt=xe[He];if(fe.length>=3){for(var nt=0;nt<pt.length;nt++)if(gu(fe,pt[nt]))return!0}if(au(fe,pt,je))return!0}return!1}(j,S,X)},s.prototype.isTileClipped=function(){return!0},s}(nu);function rd(a,s){return s>0?s+2*a:a}var lh=ja([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Zd=ja([{name:"a_projected_pos",components:3,type:"Float32"}],4),Ud=(ja([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),ja([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Ns=(ja([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),ja([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),dp=ja([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Vd(a,s,c){return a.sections.forEach(function(m){m.text=function(_,S,A){var P=S.layout.get("text-transform").evaluate(A,{});return P==="uppercase"?_=_.toLocaleUpperCase():P==="lowercase"&&(_=_.toLocaleLowerCase()),ms.applyArabicShaping&&(_=ms.applyArabicShaping(_)),_}(m.text,s,c)}),a}ja([{name:"triangle",components:3,type:"Uint16"}]),ja([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),ja([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),ja([{type:"Float32",name:"offsetX"}]),ja([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var ch={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},nd=function(a,s,c,m,_){var S,A,P=8*_-m-1,F=(1<<P)-1,j=F>>1,X=-7,ee=c?_-1:0,fe=c?-1:1,xe=a[s+ee];for(ee+=fe,S=xe&(1<<-X)-1,xe>>=-X,X+=P;X>0;S=256*S+a[s+ee],ee+=fe,X-=8);for(A=S&(1<<-X)-1,S>>=-X,X+=m;X>0;A=256*A+a[s+ee],ee+=fe,X-=8);if(S===0)S=1-j;else{if(S===F)return A?NaN:1/0*(xe?-1:1);A+=Math.pow(2,m),S-=j}return(xe?-1:1)*A*Math.pow(2,S-m)},id=function(a,s,c,m,_,S){var A,P,F,j=8*S-_-1,X=(1<<j)-1,ee=X>>1,fe=_===23?Math.pow(2,-24)-Math.pow(2,-77):0,xe=m?0:S-1,je=m?1:-1,He=s<0||s===0&&1/s<0?1:0;for(s=Math.abs(s),isNaN(s)||s===1/0?(P=isNaN(s)?1:0,A=X):(A=Math.floor(Math.log(s)/Math.LN2),s*(F=Math.pow(2,-A))<1&&(A--,F*=2),(s+=A+ee>=1?fe/F:fe*Math.pow(2,1-ee))*F>=2&&(A++,F/=2),A+ee>=X?(P=0,A=X):A+ee>=1?(P=(s*F-1)*Math.pow(2,_),A+=ee):(P=s*Math.pow(2,ee-1)*Math.pow(2,_),A=0));_>=8;a[c+xe]=255&P,xe+=je,P/=256,_-=8);for(A=A<<_|P,j+=_;j>0;a[c+xe]=255&A,xe+=je,A/=256,j-=8);a[c+xe-je]|=128*He},fh=va;function va(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}va.Varint=0,va.Fixed64=1,va.Bytes=2,va.Fixed32=5;var vp=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Cl(a){return a.type===va.Bytes?a.readVarint()+a.pos:a.pos+1}function If(a,s,c){return c?4294967296*s+(a>>>0):4294967296*(s>>>0)+(a>>>0)}function mp(a,s,c){var m=s<=16383?1:s<=2097151?2:s<=268435455?3:Math.floor(Math.log(s)/(7*Math.LN2));c.realloc(m);for(var _=c.pos-1;_>=a;_--)c.buf[_+m]=c.buf[_]}function jd(a,s){for(var c=0;c<a.length;c++)s.writeVarint(a[c])}function V(a,s){for(var c=0;c<a.length;c++)s.writeSVarint(a[c])}function ke(a,s){for(var c=0;c<a.length;c++)s.writeFloat(a[c])}function Ke(a,s){for(var c=0;c<a.length;c++)s.writeDouble(a[c])}function ir(a,s){for(var c=0;c<a.length;c++)s.writeBoolean(a[c])}function Ar(a,s){for(var c=0;c<a.length;c++)s.writeFixed32(a[c])}function tr(a,s){for(var c=0;c<a.length;c++)s.writeSFixed32(a[c])}function xr(a,s){for(var c=0;c<a.length;c++)s.writeFixed64(a[c])}function Pr(a,s){for(var c=0;c<a.length;c++)s.writeSFixed64(a[c])}function zr(a,s){return(a[s]|a[s+1]<<8|a[s+2]<<16)+16777216*a[s+3]}function Gr(a,s,c){a[c]=s,a[c+1]=s>>>8,a[c+2]=s>>>16,a[c+3]=s>>>24}function Yr(a,s){return(a[s]|a[s+1]<<8|a[s+2]<<16)+(a[s+3]<<24)}function Kr(a,s,c){a===1&&c.readMessage(hn,s)}function hn(a,s,c){if(a===3){var m=c.readMessage(Vr,{}),_=m.width,S=m.height,A=m.left,P=m.top,F=m.advance;s.push({id:m.id,bitmap:new _u({width:_+6,height:S+6},m.bitmap),metrics:{width:_,height:S,left:A,top:P,advance:F}})}}function Vr(a,s,c){a===1?s.id=c.readVarint():a===2?s.bitmap=c.readBytes():a===3?s.width=c.readVarint():a===4?s.height=c.readVarint():a===5?s.left=c.readSVarint():a===6?s.top=c.readSVarint():a===7&&(s.advance=c.readVarint())}function Xr(a){for(var s=0,c=0,m=0,_=a;m<_.length;m+=1){var S=_[m];s+=S.w*S.h,c=Math.max(c,S.w)}a.sort(function(He,pt){return pt.h-He.h});for(var A=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(s/.95)),c),h:1/0}],P=0,F=0,j=0,X=a;j<X.length;j+=1)for(var ee=X[j],fe=A.length-1;fe>=0;fe--){var xe=A[fe];if(!(ee.w>xe.w||ee.h>xe.h)){if(ee.x=xe.x,ee.y=xe.y,F=Math.max(F,ee.y+ee.h),P=Math.max(P,ee.x+ee.w),ee.w===xe.w&&ee.h===xe.h){var je=A.pop();fe<A.length&&(A[fe]=je)}else ee.h===xe.h?(xe.x+=ee.w,xe.w-=ee.w):ee.w===xe.w?(xe.y+=ee.h,xe.h-=ee.h):(A.push({x:xe.x+ee.w,y:xe.y,w:xe.w-ee.w,h:ee.h}),xe.y+=ee.h,xe.h-=ee.h);break}}return{w:P,h:F,fill:s/(P*F)||0}}va.prototype={destroy:function(){this.buf=null},readFields:function(a,s,c){for(c=c||this.length;this.pos<c;){var m=this.readVarint(),_=m>>3,S=this.pos;this.type=7&m,a(_,s,this),this.pos===S&&this.skip(m)}return s},readMessage:function(a,s){return this.readFields(a,s,this.readVarint()+this.pos)},readFixed32:function(){var a=zr(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=Yr(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=zr(this.buf,this.pos)+4294967296*zr(this.buf,this.pos+4);return this.pos+=8,a},readSFixed64:function(){var a=zr(this.buf,this.pos)+4294967296*Yr(this.buf,this.pos+4);return this.pos+=8,a},readFloat:function(){var a=nd(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=nd(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var s,c,m=this.buf;return s=127&(c=m[this.pos++]),c<128?s:(s|=(127&(c=m[this.pos++]))<<7,c<128?s:(s|=(127&(c=m[this.pos++]))<<14,c<128?s:(s|=(127&(c=m[this.pos++]))<<21,c<128?s:function(_,S,A){var P,F,j=A.buf;if(P=(112&(F=j[A.pos++]))>>4,F<128||(P|=(127&(F=j[A.pos++]))<<3,F<128)||(P|=(127&(F=j[A.pos++]))<<10,F<128)||(P|=(127&(F=j[A.pos++]))<<17,F<128)||(P|=(127&(F=j[A.pos++]))<<24,F<128)||(P|=(1&(F=j[A.pos++]))<<31,F<128))return If(_,P,S);throw new Error("Expected varint not more than 10 bytes")}(s|=(15&(c=m[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var a=this.readVarint()+this.pos,s=this.pos;return this.pos=a,a-s>=12&&vp?function(c,m,_){return vp.decode(c.subarray(m,_))}(this.buf,s,a):function(c,m,_){for(var S="",A=m;A<_;){var P,F,j,X=c[A],ee=null,fe=X>239?4:X>223?3:X>191?2:1;if(A+fe>_)break;fe===1?X<128&&(ee=X):fe===2?(192&(P=c[A+1]))==128&&(ee=(31&X)<<6|63&P)<=127&&(ee=null):fe===3?(F=c[A+2],(192&(P=c[A+1]))==128&&(192&F)==128&&((ee=(15&X)<<12|(63&P)<<6|63&F)<=2047||ee>=55296&&ee<=57343)&&(ee=null)):fe===4&&(F=c[A+2],j=c[A+3],(192&(P=c[A+1]))==128&&(192&F)==128&&(192&j)==128&&((ee=(15&X)<<18|(63&P)<<12|(63&F)<<6|63&j)<=65535||ee>=1114112)&&(ee=null)),ee===null?(ee=65533,fe=1):ee>65535&&(ee-=65536,S+=String.fromCharCode(ee>>>10&1023|55296),ee=56320|1023&ee),S+=String.fromCharCode(ee),A+=fe}return S}(this.buf,s,a)},readBytes:function(){var a=this.readVarint()+this.pos,s=this.buf.subarray(this.pos,a);return this.pos=a,s},readPackedVarint:function(a,s){if(this.type!==va.Bytes)return a.push(this.readVarint(s));var c=Cl(this);for(a=a||[];this.pos<c;)a.push(this.readVarint(s));return a},readPackedSVarint:function(a){if(this.type!==va.Bytes)return a.push(this.readSVarint());var s=Cl(this);for(a=a||[];this.pos<s;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==va.Bytes)return a.push(this.readBoolean());var s=Cl(this);for(a=a||[];this.pos<s;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==va.Bytes)return a.push(this.readFloat());var s=Cl(this);for(a=a||[];this.pos<s;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==va.Bytes)return a.push(this.readDouble());var s=Cl(this);for(a=a||[];this.pos<s;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==va.Bytes)return a.push(this.readFixed32());var s=Cl(this);for(a=a||[];this.pos<s;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==va.Bytes)return a.push(this.readSFixed32());var s=Cl(this);for(a=a||[];this.pos<s;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==va.Bytes)return a.push(this.readFixed64());var s=Cl(this);for(a=a||[];this.pos<s;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==va.Bytes)return a.push(this.readSFixed64());var s=Cl(this);for(a=a||[];this.pos<s;)a.push(this.readSFixed64());return a},skip:function(a){var s=7&a;if(s===va.Varint)for(;this.buf[this.pos++]>127;);else if(s===va.Bytes)this.pos=this.readVarint()+this.pos;else if(s===va.Fixed32)this.pos+=4;else{if(s!==va.Fixed64)throw new Error("Unimplemented type: "+s);this.pos+=8}},writeTag:function(a,s){this.writeVarint(a<<3|s)},realloc:function(a){for(var s=this.length||16;s<this.pos+a;)s*=2;if(s!==this.length){var c=new Uint8Array(s);c.set(this.buf),this.buf=c,this.length=s}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),Gr(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),Gr(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),Gr(this.buf,-1&a,this.pos),Gr(this.buf,Math.floor(a*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),Gr(this.buf,-1&a,this.pos),Gr(this.buf,Math.floor(a*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(s,c){var m,_;if(s>=0?(m=s%4294967296|0,_=s/4294967296|0):(_=~(-s/4294967296),4294967295^(m=~(-s%4294967296))?m=m+1|0:(m=0,_=_+1|0)),s>=18446744073709552e3||s<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),function(S,A,P){P.buf[P.pos++]=127&S|128,S>>>=7,P.buf[P.pos++]=127&S|128,S>>>=7,P.buf[P.pos++]=127&S|128,S>>>=7,P.buf[P.pos++]=127&S|128,P.buf[P.pos]=127&(S>>>=7)}(m,0,c),function(S,A){var P=(7&S)<<4;A.buf[A.pos++]|=P|((S>>>=3)?128:0),S&&(A.buf[A.pos++]=127&S|((S>>>=7)?128:0),S&&(A.buf[A.pos++]=127&S|((S>>>=7)?128:0),S&&(A.buf[A.pos++]=127&S|((S>>>=7)?128:0),S&&(A.buf[A.pos++]=127&S|((S>>>=7)?128:0),S&&(A.buf[A.pos++]=127&S)))))}(_,c)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(Boolean(a))},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var s=this.pos;this.pos=function(m,_,S){for(var A,P,F=0;F<_.length;F++){if((A=_.charCodeAt(F))>55295&&A<57344){if(!P){A>56319||F+1===_.length?(m[S++]=239,m[S++]=191,m[S++]=189):P=A;continue}if(A<56320){m[S++]=239,m[S++]=191,m[S++]=189,P=A;continue}A=P-55296<<10|A-56320|65536,P=null}else P&&(m[S++]=239,m[S++]=191,m[S++]=189,P=null);A<128?m[S++]=A:(A<2048?m[S++]=A>>6|192:(A<65536?m[S++]=A>>12|224:(m[S++]=A>>18|240,m[S++]=A>>12&63|128),m[S++]=A>>6&63|128),m[S++]=63&A|128)}return S}(this.buf,a,this.pos);var c=this.pos-s;c>=128&&mp(s,c,this),this.pos=s-1,this.writeVarint(c),this.pos+=c},writeFloat:function(a){this.realloc(4),id(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),id(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var s=a.length;this.writeVarint(s),this.realloc(s);for(var c=0;c<s;c++)this.buf[this.pos++]=a[c]},writeRawMessage:function(a,s){this.pos++;var c=this.pos;a(s,this);var m=this.pos-c;m>=128&&mp(c,m,this),this.pos=c-1,this.writeVarint(m),this.pos+=m},writeMessage:function(a,s,c){this.writeTag(a,va.Bytes),this.writeRawMessage(s,c)},writePackedVarint:function(a,s){s.length&&this.writeMessage(a,jd,s)},writePackedSVarint:function(a,s){s.length&&this.writeMessage(a,V,s)},writePackedBoolean:function(a,s){s.length&&this.writeMessage(a,ir,s)},writePackedFloat:function(a,s){s.length&&this.writeMessage(a,ke,s)},writePackedDouble:function(a,s){s.length&&this.writeMessage(a,Ke,s)},writePackedFixed32:function(a,s){s.length&&this.writeMessage(a,Ar,s)},writePackedSFixed32:function(a,s){s.length&&this.writeMessage(a,tr,s)},writePackedFixed64:function(a,s){s.length&&this.writeMessage(a,xr,s)},writePackedSFixed64:function(a,s){s.length&&this.writeMessage(a,Pr,s)},writeBytesField:function(a,s){this.writeTag(a,va.Bytes),this.writeBytes(s)},writeFixed32Field:function(a,s){this.writeTag(a,va.Fixed32),this.writeFixed32(s)},writeSFixed32Field:function(a,s){this.writeTag(a,va.Fixed32),this.writeSFixed32(s)},writeFixed64Field:function(a,s){this.writeTag(a,va.Fixed64),this.writeFixed64(s)},writeSFixed64Field:function(a,s){this.writeTag(a,va.Fixed64),this.writeSFixed64(s)},writeVarintField:function(a,s){this.writeTag(a,va.Varint),this.writeVarint(s)},writeSVarintField:function(a,s){this.writeTag(a,va.Varint),this.writeSVarint(s)},writeStringField:function(a,s){this.writeTag(a,va.Bytes),this.writeString(s)},writeFloatField:function(a,s){this.writeTag(a,va.Fixed32),this.writeFloat(s)},writeDoubleField:function(a,s){this.writeTag(a,va.Fixed64),this.writeDouble(s)},writeBooleanField:function(a,s){this.writeVarintField(a,Boolean(s))}};var Pt=function(a,s){var c=s.pixelRatio,m=s.version,_=s.stretchX,S=s.stretchY,A=s.content;this.paddedRect=a,this.pixelRatio=c,this.stretchX=_,this.stretchY=S,this.content=A,this.version=m},pr={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};pr.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},pr.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},pr.tlbr.get=function(){return this.tl.concat(this.br)},pr.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(Pt.prototype,pr);var jr=function(a,s){var c={},m={};this.haveRenderCallbacks=[];var _=[];this.addImages(a,c,_),this.addImages(s,m,_);var S=Xr(_),A=new Ro({width:S.w||1,height:S.h||1});for(var P in a){var F=a[P],j=c[P].paddedRect;Ro.copy(F.data,A,{x:0,y:0},{x:j.x+1,y:j.y+1},F.data)}for(var X in s){var ee=s[X],fe=m[X].paddedRect,xe=fe.x+1,je=fe.y+1,He=ee.data.width,pt=ee.data.height;Ro.copy(ee.data,A,{x:0,y:0},{x:xe,y:je},ee.data),Ro.copy(ee.data,A,{x:0,y:pt-1},{x:xe,y:je-1},{width:He,height:1}),Ro.copy(ee.data,A,{x:0,y:0},{x:xe,y:je+pt},{width:He,height:1}),Ro.copy(ee.data,A,{x:He-1,y:0},{x:xe-1,y:je},{width:1,height:pt}),Ro.copy(ee.data,A,{x:0,y:0},{x:xe+He,y:je},{width:1,height:pt})}this.image=A,this.iconPositions=c,this.patternPositions=m};jr.prototype.addImages=function(a,s,c){for(var m in a){var _=a[m],S={x:0,y:0,w:_.data.width+2,h:_.data.height+2};c.push(S),s[m]=new Pt(S,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(m)}},jr.prototype.patchUpdatedImages=function(a,s){for(var c in a.dispatchRenderCallbacks(this.haveRenderCallbacks),a.updatedImages)this.patchUpdatedImage(this.iconPositions[c],a.getImage(c),s),this.patchUpdatedImage(this.patternPositions[c],a.getImage(c),s)},jr.prototype.patchUpdatedImage=function(a,s,c){if(a&&s&&a.version!==s.version){a.version=s.version;var m=a.tl;c.update(s.data,void 0,{x:m[0],y:m[1]})}},Fn("ImagePosition",Pt),Fn("ImageAtlas",jr);var ln={horizontal:1,vertical:2,horizontalOnly:3},Mr=function(){this.scale=1,this.fontStack="",this.imageName=null};Mr.forText=function(a,s){var c=new Mr;return c.scale=a||1,c.fontStack=s,c},Mr.forImage=function(a){var s=new Mr;return s.imageName=a,s};var Jr=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function gn(a,s,c,m,_,S,A,P,F,j,X,ee,fe,xe,je,He){var pt,nt=Jr.fromFeature(a,_);ee===ln.vertical&&nt.verticalizePunctuation();var kt=ms.processBidirectionalText,Gt=ms.processStyledBidirectionalText;if(kt&&nt.sections.length===1){pt=[];for(var sr=0,vr=kt(nt.toString(),cn(nt,j,S,s,m,xe,je));sr<vr.length;sr+=1){var fr=vr[sr],Hr=new Jr;Hr.text=fr,Hr.sections=nt.sections;for(var dn=0;dn<fr.length;dn++)Hr.sectionIndex.push(0);pt.push(Hr)}}else if(Gt){pt=[];for(var Kn=0,kn=Gt(nt.text,nt.sectionIndex,cn(nt,j,S,s,m,xe,je));Kn<kn.length;Kn+=1){var ai=kn[Kn],In=new Jr;In.text=ai[0],In.sectionIndex=ai[1],In.sections=nt.sections,pt.push(In)}}else pt=function(Xn,Wi){for(var xi=[],qi=Xn.text,Qn=0,ba=0,$a=Wi;ba<$a.length;ba+=1){var xo=$a[ba];xi.push(Xn.substring(Qn,xo)),Qn=xo}return Qn<qi.length&&xi.push(Xn.substring(Qn,qi.length)),xi}(nt,cn(nt,j,S,s,m,xe,je));var zi=[],di={positionedLines:zi,text:nt.toString(),top:X[1],bottom:X[1],left:X[0],right:X[0],writingMode:ee,iconsInText:!1,verticalizable:!1};return function(Xn,Wi,xi,qi,Qn,ba,$a,xo,vo,so,Lo,cs){for(var fs=0,$s=-17,Es=0,zs=0,Vo=xo==="right"?1:xo==="left"?0:.5,Ss=0,Ki=0,Ha=Qn;Ki<Ha.length;Ki+=1){var Fa=Ha[Ki];Fa.trim();var ma=Fa.getMaxScale(),uu=24*(ma-1),Zs={positionedGlyphs:[],lineOffset:0};Xn.positionedLines[Ss]=Zs;var eo=Zs.positionedGlyphs,jo=0;if(Fa.length()){for(var Us=0;Us<Fa.length();Us++){var Ea=Fa.getSection(Us),Ql=Fa.getSectionIndex(Us),Hu=Fa.getCharCode(Us),wc=0,Go=null,Cc=null,Al=null,Vh=24,dh=!(vo===ln.horizontal||!Lo&&!Zl(Hu)||Lo&&(ei[Hu]||(Ac=Hu,vn.Arabic(Ac)||vn["Arabic Supplement"](Ac)||vn["Arabic Extended-A"](Ac)||vn["Arabic Presentation Forms-A"](Ac)||vn["Arabic Presentation Forms-B"](Ac))));if(Ea.imageName){var vh=qi[Ea.imageName];if(!vh)continue;Al=Ea.imageName,Xn.iconsInText=Xn.iconsInText||!0,Cc=vh.paddedRect;var af=vh.displaySize;Ea.scale=24*Ea.scale/cs,wc=uu+(24-af[1]*Ea.scale),Vh=(Go={width:af[0],height:af[1],left:1,top:-3,advance:dh?af[1]:af[0]}).advance;var jh=dh?af[0]*Ea.scale-24*ma:af[1]*Ea.scale-24*ma;jh>0&&jh>jo&&(jo=jh)}else{var od=xi[Ea.fontStack],Rf=od&&od[Hu];if(Rf&&Rf.rect)Cc=Rf.rect,Go=Rf.metrics;else{var bp=Wi[Ea.fontStack],sd=bp&&bp[Hu];if(!sd)continue;Go=sd.metrics}wc=24*(ma-Ea.scale)}dh?(Xn.verticalizable=!0,eo.push({glyph:Hu,imageName:Al,x:fs,y:$s+wc,vertical:dh,scale:Ea.scale,fontStack:Ea.fontStack,sectionIndex:Ql,metrics:Go,rect:Cc}),fs+=Vh*Ea.scale+so):(eo.push({glyph:Hu,imageName:Al,x:fs,y:$s+wc,vertical:dh,scale:Ea.scale,fontStack:Ea.fontStack,sectionIndex:Ql,metrics:Go,rect:Cc}),fs+=Go.advance*Ea.scale+so)}eo.length!==0&&(Es=Math.max(fs-so,Es),Ii(eo,0,eo.length-1,Vo,jo)),fs=0;var Ep=ba*ma+jo;Zs.lineOffset=Math.max(jo,uu),$s+=Ep,zs=Math.max(Ep,zs),++Ss}else $s+=ba,++Ss}var Ac,Sp=$s- -17,Wu=yn($a),of=Wu.horizontalAlign,mh=Wu.verticalAlign;(function(ud,ld,Gh,wp,cd,Hh,Wh,Cp,Ap){var gh,fd=(ld-Gh)*cd;gh=Hh!==Wh?-Cp*wp- -17:(-wp*Ap+.5)*Wh;for(var Xh=0,Tp=ud;Xh<Tp.length;Xh+=1)for(var Of=0,$h=Tp[Xh].positionedGlyphs;Of<$h.length;Of+=1){var Yh=$h[Of];Yh.x+=fd,Yh.y+=gh}})(Xn.positionedLines,Vo,of,mh,Es,zs,ba,Sp,Qn.length),Xn.top+=-mh*Sp,Xn.bottom=Xn.top+Sp,Xn.left+=-of*Es,Xn.right=Xn.left+Es}(di,s,c,m,pt,A,P,F,ee,j,fe,He),!function(Xn){for(var Wi=0,xi=Xn;Wi<xi.length;Wi+=1)if(xi[Wi].positionedGlyphs.length!==0)return!1;return!0}(zi)&&di}Jr.fromFeature=function(a,s){for(var c=new Jr,m=0;m<a.sections.length;m++){var _=a.sections[m];_.image?c.addImageSection(_):c.addTextSection(_,s)}return c},Jr.prototype.length=function(){return this.text.length},Jr.prototype.getSection=function(a){return this.sections[this.sectionIndex[a]]},Jr.prototype.getSectionIndex=function(a){return this.sectionIndex[a]},Jr.prototype.getCharCode=function(a){return this.text.charCodeAt(a)},Jr.prototype.verticalizePunctuation=function(){this.text=function(a){for(var s="",c=0;c<a.length;c++){var m=a.charCodeAt(c+1)||null,_=a.charCodeAt(c-1)||null;s+=m&&Ku(m)&&!ch[a[c+1]]||_&&Ku(_)&&!ch[a[c-1]]||!ch[a[c]]?a[c]:ch[a[c]]}return s}(this.text)},Jr.prototype.trim=function(){for(var a=0,s=0;s<this.text.length&&ei[this.text.charCodeAt(s)];s++)a++;for(var c=this.text.length,m=this.text.length-1;m>=0&&m>=a&&ei[this.text.charCodeAt(m)];m--)c--;this.text=this.text.substring(a,c),this.sectionIndex=this.sectionIndex.slice(a,c)},Jr.prototype.substring=function(a,s){var c=new Jr;return c.text=this.text.substring(a,s),c.sectionIndex=this.sectionIndex.slice(a,s),c.sections=this.sections,c},Jr.prototype.toString=function(){return this.text},Jr.prototype.getMaxScale=function(){var a=this;return this.sectionIndex.reduce(function(s,c){return Math.max(s,a.sections[c].scale)},0)},Jr.prototype.addTextSection=function(a,s){this.text+=a.text,this.sections.push(Mr.forText(a.scale,a.fontStack||s));for(var c=this.sections.length-1,m=0;m<a.text.length;++m)this.sectionIndex.push(c)},Jr.prototype.addImageSection=function(a){var s=a.image?a.image.name:"";if(s.length!==0){var c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(Mr.forImage(s)),this.sectionIndex.push(this.sections.length-1)):dt("Reached maximum number of images 6401")}else dt("Can't add FormattedSection with an empty image.")},Jr.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var ei={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},_r={};function Sr(a,s,c,m,_,S){if(s.imageName){var A=m[s.imageName];return A?A.displaySize[0]*s.scale*24/S+_:0}var P=c[s.fontStack],F=P&&P[a];return F?F.metrics.advance*s.scale+_:0}function Nn(a,s,c,m){var _=Math.pow(a-s,2);return m?a<s?_/2:2*_:_+Math.abs(c)*c}function pn(a,s,c){var m=0;return a===10&&(m-=1e4),c&&(m+=150),a!==40&&a!==65288||(m+=50),s!==41&&s!==65289||(m+=50),m}function Wr(a,s,c,m,_,S){for(var A=null,P=Nn(s,c,_,S),F=0,j=m;F<j.length;F+=1){var X=j[F],ee=Nn(s-X.x,c,_,S)+X.badness;ee<=P&&(A=X,P=ee)}return{index:a,x:s,priorBreak:A,badness:P}}function cn(a,s,c,m,_,S,A){if(S!=="point")return[];if(!a)return[];for(var P,F=[],j=function(pt,nt,kt,Gt,sr,vr){for(var fr=0,Hr=0;Hr<pt.length();Hr++){var dn=pt.getSection(Hr);fr+=Sr(pt.getCharCode(Hr),dn,Gt,sr,nt,vr)}return fr/Math.max(1,Math.ceil(fr/kt))}(a,s,c,m,_,A),X=a.text.indexOf("\u200B")>=0,ee=0,fe=0;fe<a.length();fe++){var xe=a.getSection(fe),je=a.getCharCode(fe);if(ei[je]||(ee+=Sr(je,xe,m,_,s,A)),fe<a.length()-1){var He=!((P=je)<11904||!(vn["Bopomofo Extended"](P)||vn.Bopomofo(P)||vn["CJK Compatibility Forms"](P)||vn["CJK Compatibility Ideographs"](P)||vn["CJK Compatibility"](P)||vn["CJK Radicals Supplement"](P)||vn["CJK Strokes"](P)||vn["CJK Symbols and Punctuation"](P)||vn["CJK Unified Ideographs Extension A"](P)||vn["CJK Unified Ideographs"](P)||vn["Enclosed CJK Letters and Months"](P)||vn["Halfwidth and Fullwidth Forms"](P)||vn.Hiragana(P)||vn["Ideographic Description Characters"](P)||vn["Kangxi Radicals"](P)||vn["Katakana Phonetic Extensions"](P)||vn.Katakana(P)||vn["Vertical Forms"](P)||vn["Yi Radicals"](P)||vn["Yi Syllables"](P)));(_r[je]||He||xe.imageName)&&F.push(Wr(fe+1,ee,j,F,pn(je,a.getCharCode(fe+1),He&&X),!1))}}return function pt(nt){return nt?pt(nt.priorBreak).concat(nt.index):[]}(Wr(a.length(),ee,j,F,0,!0))}function yn(a){var s=.5,c=.5;switch(a){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:s,verticalAlign:c}}function Ii(a,s,c,m,_){if(m||_)for(var S=a[c],A=(a[c].x+S.metrics.advance*S.scale)*m,P=s;P<=c;P++)a[P].x-=A,a[P].y+=_}function Si(a,s,c,m,_,S){var A,P=a.image;if(P.content){var F=P.content,j=P.pixelRatio||1;A=[F[0]/j,F[1]/j,P.displaySize[0]-F[2]/j,P.displaySize[1]-F[3]/j]}var X,ee,fe,xe,je=s.left*S,He=s.right*S;c==="width"||c==="both"?(xe=_[0]+je-m[3],ee=_[0]+He+m[1]):ee=(xe=_[0]+(je+He-P.displaySize[0])/2)+P.displaySize[0];var pt=s.top*S,nt=s.bottom*S;return c==="height"||c==="both"?(X=_[1]+pt-m[0],fe=_[1]+nt+m[2]):fe=(X=_[1]+(pt+nt-P.displaySize[1])/2)+P.displaySize[1],{image:P,top:X,right:ee,bottom:fe,left:xe,collisionPadding:A}}_r[10]=!0,_r[32]=!0,_r[38]=!0,_r[40]=!0,_r[41]=!0,_r[43]=!0,_r[45]=!0,_r[47]=!0,_r[173]=!0,_r[183]=!0,_r[8203]=!0,_r[8208]=!0,_r[8211]=!0,_r[8231]=!0;var fn=function(a){function s(c,m,_,S){a.call(this,c,m),this.angle=_,S!==void 0&&(this.segment=S)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.clone=function(){return new s(this.x,this.y,this.angle,this.segment)},s}(se);function xn(a,s){var c=s.expression;if(c.kind==="constant")return{kind:"constant",layoutSize:c.evaluate(new Li(a+1))};if(c.kind==="source")return{kind:"source"};for(var m=c.zoomStops,_=c.interpolationType,S=0;S<m.length&&m[S]<=a;)S++;for(var A=S=Math.max(0,S-1);A<m.length&&m[A]<a+1;)A++;A=Math.min(m.length-1,A);var P=m[S],F=m[A];return c.kind==="composite"?{kind:"composite",minZoom:P,maxZoom:F,interpolationType:_}:{kind:"camera",minZoom:P,maxZoom:F,minSize:c.evaluate(new Li(P)),maxSize:c.evaluate(new Li(F)),interpolationType:_}}function fi(a,s,c){var m=s.uSize,_=c.lowerSize;return a.kind==="source"?_/128:a.kind==="composite"?Zi(_/128,c.upperSize/128,s.uSizeT):m}function Ci(a,s){var c=0,m=0;if(a.kind==="constant")m=a.layoutSize;else if(a.kind!=="source"){var _=a.interpolationType,S=_?gt(Pe.interpolationFactor(_,s,a.minZoom,a.maxZoom),0,1):0;a.kind==="camera"?m=Zi(a.minSize,a.maxSize,S):c=S}return{uSizeT:c,uSize:m}}Fn("Anchor",fn);var Vi=Object.freeze({__proto__:null,getSizeData:xn,evaluateSizeForFeature:fi,evaluateSizeForZoom:Ci,SIZE_PACK_FACTOR:128});function oo(a,s,c,m,_){if(s.segment===void 0)return!0;for(var S=s,A=s.segment+1,P=0;P>-c/2;){if(--A<0)return!1;P-=a[A].dist(S),S=a[A]}P+=a[A].dist(a[A+1]),A++;for(var F=[],j=0;P<c/2;){var X=a[A],ee=a[A+1];if(!ee)return!1;var fe=a[A-1].angleTo(X)-X.angleTo(ee);for(fe=Math.abs((fe+3*Math.PI)%(2*Math.PI)-Math.PI),F.push({distance:P,angleDelta:fe}),j+=fe;P-F[0].distance>m;)j-=F.shift().angleDelta;if(j>_)return!1;A++,P+=X.dist(ee)}return!0}function Pa(a){for(var s=0,c=0;c<a.length-1;c++)s+=a[c].dist(a[c+1]);return s}function ji(a,s,c){return a?.6*s*c:0}function is(a,s){return Math.max(a?a.right-a.left:0,s?s.right-s.left:0)}function Xa(a,s,c,m,_,S){for(var A=ji(c,_,S),P=is(c,m)*S,F=0,j=Pa(a)/2,X=0;X<a.length-1;X++){var ee=a[X],fe=a[X+1],xe=ee.dist(fe);if(F+xe>j){var je=(j-F)/xe,He=Zi(ee.x,fe.x,je),pt=Zi(ee.y,fe.y,je),nt=new fn(He,pt,fe.angleTo(ee),X);return nt._round(),!A||oo(a,nt,P,A,s)?nt:void 0}F+=xe}}function Zo(a,s,c,m,_,S,A,P,F){var j=ji(m,S,A),X=is(m,_),ee=X*A,fe=a[0].x===0||a[0].x===F||a[0].y===0||a[0].y===F;return s-ee<s/4&&(s=ee+s/4),function xe(je,He,pt,nt,kt,Gt,sr,vr,fr){for(var Hr=Gt/2,dn=Pa(je),Kn=0,kn=He-pt,ai=[],In=0;In<je.length-1;In++){for(var zi=je[In],di=je[In+1],Xn=zi.dist(di),Wi=di.angleTo(zi);kn+pt<Kn+Xn;){var xi=((kn+=pt)-Kn)/Xn,qi=Zi(zi.x,di.x,xi),Qn=Zi(zi.y,di.y,xi);if(qi>=0&&qi<fr&&Qn>=0&&Qn<fr&&kn-Hr>=0&&kn+Hr<=dn){var ba=new fn(qi,Qn,Wi,In);ba._round(),nt&&!oo(je,ba,Gt,nt,kt)||ai.push(ba)}}Kn+=Xn}return vr||ai.length||sr||(ai=xe(je,Kn/2,pt,nt,kt,Gt,sr,!0,fr)),ai}(a,fe?s/2*P%s:(X/2+2*S)*A*P%s,s,j,c,ee,fe,!1,F)}function _o(a,s,c,m,_){for(var S=[],A=0;A<a.length;A++)for(var P=a[A],F=void 0,j=0;j<P.length-1;j++){var X=P[j],ee=P[j+1];X.x<s&&ee.x<s||(X.x<s?X=new se(s,X.y+(s-X.x)/(ee.x-X.x)*(ee.y-X.y))._round():ee.x<s&&(ee=new se(s,X.y+(s-X.x)/(ee.x-X.x)*(ee.y-X.y))._round()),X.y<c&&ee.y<c||(X.y<c?X=new se(X.x+(c-X.y)/(ee.y-X.y)*(ee.x-X.x),c)._round():ee.y<c&&(ee=new se(X.x+(c-X.y)/(ee.y-X.y)*(ee.x-X.x),c)._round()),X.x>=m&&ee.x>=m||(X.x>=m?X=new se(m,X.y+(m-X.x)/(ee.x-X.x)*(ee.y-X.y))._round():ee.x>=m&&(ee=new se(m,X.y+(m-X.x)/(ee.x-X.x)*(ee.y-X.y))._round()),X.y>=_&&ee.y>=_||(X.y>=_?X=new se(X.x+(_-X.y)/(ee.y-X.y)*(ee.x-X.x),_)._round():ee.y>=_&&(ee=new se(X.x+(_-X.y)/(ee.y-X.y)*(ee.x-X.x),_)._round()),F&&X.equals(F[F.length-1])||S.push(F=[X]),F.push(ee)))))}return S}function as(a,s,c,m){var _=[],S=a.image,A=S.pixelRatio,P=S.paddedRect.w-2,F=S.paddedRect.h-2,j=a.right-a.left,X=a.bottom-a.top,ee=S.stretchX||[[0,P]],fe=S.stretchY||[[0,F]],xe=function(qi,Qn){return qi+Qn[1]-Qn[0]},je=ee.reduce(xe,0),He=fe.reduce(xe,0),pt=P-je,nt=F-He,kt=0,Gt=je,sr=0,vr=He,fr=0,Hr=pt,dn=0,Kn=nt;if(S.content&&m){var kn=S.content;kt=Yo(ee,0,kn[0]),sr=Yo(fe,0,kn[1]),Gt=Yo(ee,kn[0],kn[2]),vr=Yo(fe,kn[1],kn[3]),fr=kn[0]-kt,dn=kn[1]-sr,Hr=kn[2]-kn[0]-Gt,Kn=kn[3]-kn[1]-vr}var ai=function(qi,Qn,ba,$a){var xo=po(qi.stretch-kt,Gt,j,a.left),vo=Pi(qi.fixed-fr,Hr,qi.stretch,je),so=po(Qn.stretch-sr,vr,X,a.top),Lo=Pi(Qn.fixed-dn,Kn,Qn.stretch,He),cs=po(ba.stretch-kt,Gt,j,a.left),fs=Pi(ba.fixed-fr,Hr,ba.stretch,je),$s=po($a.stretch-sr,vr,X,a.top),Es=Pi($a.fixed-dn,Kn,$a.stretch,He),zs=new se(xo,so),Vo=new se(cs,so),Ss=new se(cs,$s),Ki=new se(xo,$s),Ha=new se(vo/A,Lo/A),Fa=new se(fs/A,Es/A),ma=s*Math.PI/180;if(ma){var uu=Math.sin(ma),Zs=Math.cos(ma),eo=[Zs,-uu,uu,Zs];zs._matMult(eo),Vo._matMult(eo),Ki._matMult(eo),Ss._matMult(eo)}var jo=qi.stretch+qi.fixed,Us=Qn.stretch+Qn.fixed;return{tl:zs,tr:Vo,bl:Ki,br:Ss,tex:{x:S.paddedRect.x+1+jo,y:S.paddedRect.y+1+Us,w:ba.stretch+ba.fixed-jo,h:$a.stretch+$a.fixed-Us},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ha,pixelOffsetBR:Fa,minFontScaleX:Hr/A/j,minFontScaleY:Kn/A/X,isSDF:c}};if(m&&(S.stretchX||S.stretchY))for(var In=xs(ee,pt,je),zi=xs(fe,nt,He),di=0;di<In.length-1;di++)for(var Xn=In[di],Wi=In[di+1],xi=0;xi<zi.length-1;xi++)_.push(ai(Xn,zi[xi],Wi,zi[xi+1]));else _.push(ai({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:P+1},{fixed:0,stretch:F+1}));return _}function Yo(a,s,c){for(var m=0,_=0,S=a;_<S.length;_+=1){var A=S[_];m+=Math.max(s,Math.min(c,A[1]))-Math.max(s,Math.min(c,A[0]))}return m}function xs(a,s,c){for(var m=[{fixed:-1,stretch:0}],_=0,S=a;_<S.length;_+=1){var A=S[_],P=A[0],F=A[1],j=m[m.length-1];m.push({fixed:P-j.stretch,stretch:j.stretch}),m.push({fixed:P-j.stretch,stretch:j.stretch+(F-P)})}return m.push({fixed:s+1,stretch:c}),m}function po(a,s,c,m){return a/s*c+m}function Pi(a,s,c,m){return a-s*c/m}var Uo=function(a,s,c,m,_,S,A,P,F,j){if(this.boxStartIndex=a.length,F){var X=S.top,ee=S.bottom,fe=S.collisionPadding;fe&&(X-=fe[1],ee+=fe[3]);var xe=ee-X;xe>0&&(xe=Math.max(10,xe),this.circleDiameter=xe)}else{var je=S.top*A-P,He=S.bottom*A+P,pt=S.left*A-P,nt=S.right*A+P,kt=S.collisionPadding;if(kt&&(pt-=kt[0]*A,je-=kt[1]*A,nt+=kt[2]*A,He+=kt[3]*A),j){var Gt=new se(pt,je),sr=new se(nt,je),vr=new se(pt,He),fr=new se(nt,He),Hr=j*Math.PI/180;Gt._rotate(Hr),sr._rotate(Hr),vr._rotate(Hr),fr._rotate(Hr),pt=Math.min(Gt.x,sr.x,vr.x,fr.x),nt=Math.max(Gt.x,sr.x,vr.x,fr.x),je=Math.min(Gt.y,sr.y,vr.y,fr.y),He=Math.max(Gt.y,sr.y,vr.y,fr.y)}a.emplaceBack(s.x,s.y,pt,je,nt,He,c,m,_)}this.boxEndIndex=a.length},aa=function(a,s){if(a===void 0&&(a=[]),s===void 0&&(s=ls),this.data=a,this.length=this.data.length,this.compare=s,this.length>0)for(var c=(this.length>>1)-1;c>=0;c--)this._down(c)};function ls(a,s){return a<s?-1:a>s?1:0}function _i(a,s,c){s===void 0&&(s=1),c===void 0&&(c=!1);for(var m=1/0,_=1/0,S=-1/0,A=-1/0,P=a[0],F=0;F<P.length;F++){var j=P[F];(!F||j.x<m)&&(m=j.x),(!F||j.y<_)&&(_=j.y),(!F||j.x>S)&&(S=j.x),(!F||j.y>A)&&(A=j.y)}var X=Math.min(S-m,A-_),ee=X/2,fe=new aa([],Ni);if(X===0)return new se(m,_);for(var xe=m;xe<S;xe+=X)for(var je=_;je<A;je+=X)fe.push(new _a(xe+ee,je+ee,ee,a));for(var He=function(kt){for(var Gt=0,sr=0,vr=0,fr=kt[0],Hr=0,dn=fr.length,Kn=dn-1;Hr<dn;Kn=Hr++){var kn=fr[Hr],ai=fr[Kn],In=kn.x*ai.y-ai.x*kn.y;sr+=(kn.x+ai.x)*In,vr+=(kn.y+ai.y)*In,Gt+=3*In}return new _a(sr/Gt,vr/Gt,0,kt)}(a),pt=fe.length;fe.length;){var nt=fe.pop();(nt.d>He.d||!He.d)&&(He=nt,c&&console.log("found best %d after %d probes",Math.round(1e4*nt.d)/1e4,pt)),nt.max-He.d<=s||(fe.push(new _a(nt.p.x-(ee=nt.h/2),nt.p.y-ee,ee,a)),fe.push(new _a(nt.p.x+ee,nt.p.y-ee,ee,a)),fe.push(new _a(nt.p.x-ee,nt.p.y+ee,ee,a)),fe.push(new _a(nt.p.x+ee,nt.p.y+ee,ee,a)),pt+=4)}return c&&(console.log("num probes: "+pt),console.log("best distance: "+He.d)),He.p}function Ni(a,s){return s.max-a.max}function _a(a,s,c,m){this.p=new se(a,s),this.h=c,this.d=function(_,S){for(var A=!1,P=1/0,F=0;F<S.length;F++)for(var j=S[F],X=0,ee=j.length,fe=ee-1;X<ee;fe=X++){var xe=j[X],je=j[fe];xe.y>_.y!=je.y>_.y&&_.x<(je.x-xe.x)*(_.y-xe.y)/(je.y-xe.y)+xe.x&&(A=!A),P=Math.min(P,yl(_,xe,je))}return(A?1:-1)*Math.sqrt(P)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}aa.prototype.push=function(a){this.data.push(a),this.length++,this._up(this.length-1)},aa.prototype.pop=function(){if(this.length!==0){var a=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),a}},aa.prototype.peek=function(){return this.data[0]},aa.prototype._up=function(a){for(var s=this.data,c=this.compare,m=s[a];a>0;){var _=a-1>>1,S=s[_];if(c(m,S)>=0)break;s[a]=S,a=_}s[a]=m},aa.prototype._down=function(a){for(var s=this.data,c=this.compare,m=this.length>>1,_=s[a];a<m;){var S=1+(a<<1),A=s[S],P=S+1;if(P<this.length&&c(s[P],A)<0&&(S=P,A=s[P]),c(A,_)>=0)break;s[a]=A,a=S}s[a]=_};var Oo=Number.POSITIVE_INFINITY;function Ou(a,s){return s[1]!==Oo?function(c,m,_){var S=0,A=0;switch(m=Math.abs(m),_=Math.abs(_),c){case"top-right":case"top-left":case"top":A=_-7;break;case"bottom-right":case"bottom-left":case"bottom":A=7-_}switch(c){case"top-right":case"bottom-right":case"right":S=-m;break;case"top-left":case"bottom-left":case"left":S=m}return[S,A]}(a,s[0],s[1]):function(c,m){var _=0,S=0;m<0&&(m=0);var A=m/Math.sqrt(2);switch(c){case"top-right":case"top-left":S=A-7;break;case"bottom-right":case"bottom-left":S=7-A;break;case"bottom":S=7-m;break;case"top":S=m-7}switch(c){case"top-right":case"bottom-right":_=-A;break;case"top-left":case"bottom-left":_=A;break;case"left":_=m;break;case"right":_=-m}return[_,S]}(a,s[0])}function Ue(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function cr(a,s,c,m,_,S,A,P,F,j,X,ee,fe,xe,je){var He=function(sr,vr,fr,Hr,dn,Kn,kn,ai){for(var In=Hr.layout.get("text-rotate").evaluate(Kn,{})*Math.PI/180,zi=[],di=0,Xn=vr.positionedLines;di<Xn.length;di+=1)for(var Wi=Xn[di],xi=0,qi=Wi.positionedGlyphs;xi<qi.length;xi+=1){var Qn=qi[xi];if(Qn.rect){var ba=Qn.rect||{},$a=4,xo=!0,vo=1,so=0,Lo=(dn||ai)&&Qn.vertical,cs=Qn.metrics.advance*Qn.scale/2;if(ai&&vr.verticalizable&&(so=Wi.lineOffset/2-(Qn.imageName?-(24-Qn.metrics.width*Qn.scale)/2:24*(Qn.scale-1))),Qn.imageName){var fs=kn[Qn.imageName];xo=fs.sdf,$a=1/(vo=fs.pixelRatio)}var $s=dn?[Qn.x+cs,Qn.y]:[0,0],Es=dn?[0,0]:[Qn.x+cs+fr[0],Qn.y+fr[1]-so],zs=[0,0];Lo&&(zs=Es,Es=[0,0]);var Vo=(Qn.metrics.left-$a)*Qn.scale-cs+Es[0],Ss=(-Qn.metrics.top-$a)*Qn.scale+Es[1],Ki=Vo+ba.w*Qn.scale/vo,Ha=Ss+ba.h*Qn.scale/vo,Fa=new se(Vo,Ss),ma=new se(Ki,Ss),uu=new se(Vo,Ha),Zs=new se(Ki,Ha);if(Lo){var eo=new se(-cs,cs- -17),jo=-Math.PI/2,Us=12-cs,Ea=new se(22-Us,-(Qn.imageName?Us:0)),Ql=new(Function.prototype.bind.apply(se,[null].concat(zs)));Fa._rotateAround(jo,eo)._add(Ea)._add(Ql),ma._rotateAround(jo,eo)._add(Ea)._add(Ql),uu._rotateAround(jo,eo)._add(Ea)._add(Ql),Zs._rotateAround(jo,eo)._add(Ea)._add(Ql)}if(In){var Hu=Math.sin(In),wc=Math.cos(In),Go=[wc,-Hu,Hu,wc];Fa._matMult(Go),ma._matMult(Go),uu._matMult(Go),Zs._matMult(Go)}var Cc=new se(0,0),Al=new se(0,0);zi.push({tl:Fa,tr:ma,bl:uu,br:Zs,tex:ba,writingMode:vr.writingMode,glyphOffset:$s,sectionIndex:Qn.sectionIndex,isSDF:xo,pixelOffsetTL:Cc,pixelOffsetBR:Al,minFontScaleX:0,minFontScaleY:0})}}return zi}(0,c,P,_,S,A,m,a.allowVerticalPlacement),pt=a.textSizeData,nt=null;pt.kind==="source"?(nt=[128*_.layout.get("text-size").evaluate(A,{})])[0]>32640&&dt(a.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):pt.kind==="composite"&&((nt=[128*xe.compositeTextSizes[0].evaluate(A,{},je),128*xe.compositeTextSizes[1].evaluate(A,{},je)])[0]>32640||nt[1]>32640)&&dt(a.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),a.addSymbols(a.text,He,nt,P,S,A,j,s,F.lineStartIndex,F.lineLength,fe,je);for(var kt=0,Gt=X;kt<Gt.length;kt+=1)ee[Gt[kt]]=a.text.placedSymbolArray.length-1;return 4*He.length}function Ht(a){for(var s in a)return a[s];return null}function Rn(a,s,c,m){var _=a.compareText;if(s in _){for(var S=_[s],A=S.length-1;A>=0;A--)if(m.dist(S[A])<c)return!0}else _[s]=[];return _[s].push(m),!1}var Hi=bu.VectorTileFeature.types,Le=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function be(a,s,c,m,_,S,A,P,F,j,X,ee,fe){var xe=P?Math.min(32640,Math.round(P[0])):0,je=P?Math.min(32640,Math.round(P[1])):0;a.emplaceBack(s,c,Math.round(32*m),Math.round(32*_),S,A,(xe<<1)+(F?1:0),je,16*j,16*X,256*ee,256*fe)}function st(a,s,c){a.emplaceBack(s.x,s.y,c),a.emplaceBack(s.x,s.y,c),a.emplaceBack(s.x,s.y,c),a.emplaceBack(s.x,s.y,c)}function Lt(a){for(var s=0,c=a.sections;s<c.length;s+=1)if(fc(c[s].text))return!0;return!1}var Kt=function(a){this.layoutVertexArray=new jc,this.indexArray=new Vl,this.programConfigurations=a,this.segments=new Se,this.dynamicLayoutVertexArray=new Ul,this.opacityVertexArray=new Eo,this.placedSymbolArray=new g};Kt.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Kt.prototype.upload=function(a,s,c,m){this.isEmpty()||(c&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,lh.members),this.indexBuffer=a.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,Zd.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,Le,!0),this.opacityVertexBuffer.itemSize=1),(c||m)&&this.programConfigurations.upload(a))},Kt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Fn("SymbolBuffers",Kt);var vt=function(a,s,c){this.layoutVertexArray=new a,this.layoutAttributes=s,this.indexArray=new c,this.segments=new Se,this.collisionVertexArray=new $f};vt.prototype.upload=function(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,Ud.members,!0)},vt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Fn("CollisionBuffers",vt);var qe=function(a){this.collisionBoxArray=a.collisionBoxArray,this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(S){return S.id}),this.index=a.index,this.pixelRatio=a.pixelRatio,this.sourceLayerIndex=a.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Xs([]),this.placementViewportMatrix=Xs([]);var s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=xn(this.zoom,s["text-size"]),this.iconSizeData=xn(this.zoom,s["icon-size"]);var c=this.layers[0].layout,m=c.get("symbol-sort-key"),_=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&m.constantOr(1)!==void 0,this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,c.get("symbol-placement")==="point"&&(this.writingModes=c.get("text-writing-mode").map(function(S){return ln[S]})),this.stateDependentLayerIds=this.layers.filter(function(S){return S.isStateDependent()}).map(function(S){return S.id}),this.sourceID=a.sourceID};qe.prototype.createArrays=function(){this.text=new Kt(new oi(this.layers,this.zoom,function(a){return/^text/.test(a)})),this.icon=new Kt(new oi(this.layers,this.zoom,function(a){return/^icon/.test(a)})),this.glyphOffsetArray=new I,this.lineVertexArray=new D,this.symbolInstances=new M},qe.prototype.calculateGlyphDependencies=function(a,s,c,m,_){for(var S=0;S<a.length;S++)if(s[a.charCodeAt(S)]=!0,(c||m)&&_){var A=ch[a.charAt(S)];A&&(s[A.charCodeAt(0)]=!0)}},qe.prototype.populate=function(a,s,c){var m=this.layers[0],_=m.layout,S=_.get("text-font"),A=_.get("text-field"),P=_.get("icon-image"),F=(A.value.kind!=="constant"||A.value.value instanceof Aa&&!A.value.value.isEmpty()||A.value.value.toString().length>0)&&(S.value.kind!=="constant"||S.value.value.length>0),j=P.value.kind!=="constant"||!!P.value.value||Object.keys(P.parameters).length>0,X=_.get("symbol-sort-key");if(this.features=[],F||j){for(var ee=s.iconDependencies,fe=s.glyphDependencies,xe=s.availableImages,je=new Li(this.zoom),He=0,pt=a;He<pt.length;He+=1){var nt=pt[He],kt=nt.feature,Gt=nt.id,sr=nt.index,vr=nt.sourceLayerIndex,fr=m._featureFilter.needGeometry,Hr=yo(kt,fr);if(m._featureFilter.filter(je,Hr,c)){fr||(Hr.geometry=Ja(kt));var dn=void 0;if(F){var Kn=m.getValueAndResolveTokens("text-field",Hr,c,xe),kn=Aa.factory(Kn);Lt(kn)&&(this.hasRTLText=!0),(!this.hasRTLText||Hf()==="unavailable"||this.hasRTLText&&ms.isParsed())&&(dn=Vd(kn,m,Hr))}var ai=void 0;if(j){var In=m.getValueAndResolveTokens("icon-image",Hr,c,xe);ai=In instanceof De?In:De.fromString(In)}if(dn||ai){var zi=this.sortFeaturesByKey?X.evaluate(Hr,{},c):void 0;if(this.features.push({id:Gt,text:dn,icon:ai,index:sr,sourceLayerIndex:vr,geometry:Hr.geometry,properties:kt.properties,type:Hi[kt.type],sortKey:zi}),ai&&(ee[ai.name]=!0),dn){var di=S.evaluate(Hr,{},c).join(","),Xn=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ln.vertical)>=0;for(var Wi=0,xi=dn.sections;Wi<xi.length;Wi+=1){var qi=xi[Wi];if(qi.image)ee[qi.image.name]=!0;else{var Qn=cc(dn.toString()),ba=qi.fontStack||di,$a=fe[ba]=fe[ba]||{};this.calculateGlyphDependencies(qi.text,$a,Xn,this.allowVerticalPlacement,Qn)}}}}}}_.get("symbol-placement")==="line"&&(this.features=function(xo){var vo={},so={},Lo=[],cs=0;function fs(eo){Lo.push(xo[eo]),cs++}function $s(eo,jo,Us){var Ea=so[eo];return delete so[eo],so[jo]=Ea,Lo[Ea].geometry[0].pop(),Lo[Ea].geometry[0]=Lo[Ea].geometry[0].concat(Us[0]),Ea}function Es(eo,jo,Us){var Ea=vo[jo];return delete vo[jo],vo[eo]=Ea,Lo[Ea].geometry[0].shift(),Lo[Ea].geometry[0]=Us[0].concat(Lo[Ea].geometry[0]),Ea}function zs(eo,jo,Us){var Ea=Us?jo[0][jo[0].length-1]:jo[0][0];return eo+":"+Ea.x+":"+Ea.y}for(var Vo=0;Vo<xo.length;Vo++){var Ss=xo[Vo],Ki=Ss.geometry,Ha=Ss.text?Ss.text.toString():null;if(Ha){var Fa=zs(Ha,Ki),ma=zs(Ha,Ki,!0);if(Fa in so&&ma in vo&&so[Fa]!==vo[ma]){var uu=Es(Fa,ma,Ki),Zs=$s(Fa,ma,Lo[uu].geometry);delete vo[Fa],delete so[ma],so[zs(Ha,Lo[Zs].geometry,!0)]=Zs,Lo[uu].geometry=null}else Fa in so?$s(Fa,ma,Ki):ma in vo?Es(Fa,ma,Ki):(fs(Vo),vo[Fa]=cs-1,so[ma]=cs-1)}else fs(Vo)}return Lo.filter(function(eo){return eo.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(xo,vo){return xo.sortKey-vo.sortKey})}},qe.prototype.update=function(a,s,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(a,s,this.layers,c),this.icon.programConfigurations.updatePaintArrays(a,s,this.layers,c))},qe.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},qe.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},qe.prototype.upload=function(a){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},qe.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},qe.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},qe.prototype.addToLineVertexArray=function(a,s){var c=this.lineVertexArray.length;if(a.segment!==void 0){for(var m=a.dist(s[a.segment+1]),_=a.dist(s[a.segment]),S={},A=a.segment+1;A<s.length;A++)S[A]={x:s[A].x,y:s[A].y,tileUnitDistanceFromAnchor:m},A<s.length-1&&(m+=s[A+1].dist(s[A]));for(var P=a.segment||0;P>=0;P--)S[P]={x:s[P].x,y:s[P].y,tileUnitDistanceFromAnchor:_},P>0&&(_+=s[P-1].dist(s[P]));for(var F=0;F<s.length;F++){var j=S[F];this.lineVertexArray.emplaceBack(j.x,j.y,j.tileUnitDistanceFromAnchor)}}return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}},qe.prototype.addSymbols=function(a,s,c,m,_,S,A,P,F,j,X,ee){for(var fe=a.indexArray,xe=a.layoutVertexArray,je=a.segments.prepareSegment(4*s.length,xe,fe,this.canOverlap?S.sortKey:void 0),He=this.glyphOffsetArray.length,pt=je.vertexLength,nt=this.allowVerticalPlacement&&A===ln.vertical?Math.PI/2:0,kt=S.text&&S.text.sections,Gt=0;Gt<s.length;Gt++){var sr=s[Gt],vr=sr.tl,fr=sr.tr,Hr=sr.bl,dn=sr.br,Kn=sr.tex,kn=sr.pixelOffsetTL,ai=sr.pixelOffsetBR,In=sr.minFontScaleX,zi=sr.minFontScaleY,di=sr.glyphOffset,Xn=sr.isSDF,Wi=sr.sectionIndex,xi=je.vertexLength,qi=di[1];be(xe,P.x,P.y,vr.x,qi+vr.y,Kn.x,Kn.y,c,Xn,kn.x,kn.y,In,zi),be(xe,P.x,P.y,fr.x,qi+fr.y,Kn.x+Kn.w,Kn.y,c,Xn,ai.x,kn.y,In,zi),be(xe,P.x,P.y,Hr.x,qi+Hr.y,Kn.x,Kn.y+Kn.h,c,Xn,kn.x,ai.y,In,zi),be(xe,P.x,P.y,dn.x,qi+dn.y,Kn.x+Kn.w,Kn.y+Kn.h,c,Xn,ai.x,ai.y,In,zi),st(a.dynamicLayoutVertexArray,P,nt),fe.emplaceBack(xi,xi+1,xi+2),fe.emplaceBack(xi+1,xi+2,xi+3),je.vertexLength+=4,je.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(di[0]),Gt!==s.length-1&&Wi===s[Gt+1].sectionIndex||a.programConfigurations.populatePaintArrays(xe.length,S,S.index,{},ee,kt&&kt[Wi])}a.placedSymbolArray.emplaceBack(P.x,P.y,He,this.glyphOffsetArray.length-He,pt,F,j,P.segment,c?c[0]:0,c?c[1]:0,m[0],m[1],A,0,!1,0,X)},qe.prototype._addCollisionDebugVertex=function(a,s,c,m,_,S){return s.emplaceBack(0,0),a.emplaceBack(c.x,c.y,m,_,Math.round(S.x),Math.round(S.y))},qe.prototype.addCollisionDebugVertices=function(a,s,c,m,_,S,A){var P=_.segments.prepareSegment(4,_.layoutVertexArray,_.indexArray),F=P.vertexLength,j=_.layoutVertexArray,X=_.collisionVertexArray,ee=A.anchorX,fe=A.anchorY;this._addCollisionDebugVertex(j,X,S,ee,fe,new se(a,s)),this._addCollisionDebugVertex(j,X,S,ee,fe,new se(c,s)),this._addCollisionDebugVertex(j,X,S,ee,fe,new se(c,m)),this._addCollisionDebugVertex(j,X,S,ee,fe,new se(a,m)),P.vertexLength+=4;var xe=_.indexArray;xe.emplaceBack(F,F+1),xe.emplaceBack(F+1,F+2),xe.emplaceBack(F+2,F+3),xe.emplaceBack(F+3,F),P.primitiveLength+=4},qe.prototype.addDebugCollisionBoxes=function(a,s,c,m){for(var _=a;_<s;_++){var S=this.collisionBoxArray.get(_);this.addCollisionDebugVertices(S.x1,S.y1,S.x2,S.y2,m?this.textCollisionBox:this.iconCollisionBox,S.anchorPoint,c)}},qe.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new vt(Gc,Ns.members,Wc),this.iconCollisionBox=new vt(Gc,Ns.members,Wc);for(var a=0;a<this.symbolInstances.length;a++){var s=this.symbolInstances.get(a);this.addDebugCollisionBoxes(s.textBoxStartIndex,s.textBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.iconBoxStartIndex,s.iconBoxEndIndex,s,!1),this.addDebugCollisionBoxes(s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,!1)}},qe.prototype._deserializeCollisionBoxesForSymbol=function(a,s,c,m,_,S,A,P,F){for(var j={},X=s;X<c;X++){var ee=a.get(X);j.textBox={x1:ee.x1,y1:ee.y1,x2:ee.x2,y2:ee.y2,anchorPointX:ee.anchorPointX,anchorPointY:ee.anchorPointY},j.textFeatureIndex=ee.featureIndex;break}for(var fe=m;fe<_;fe++){var xe=a.get(fe);j.verticalTextBox={x1:xe.x1,y1:xe.y1,x2:xe.x2,y2:xe.y2,anchorPointX:xe.anchorPointX,anchorPointY:xe.anchorPointY},j.verticalTextFeatureIndex=xe.featureIndex;break}for(var je=S;je<A;je++){var He=a.get(je);j.iconBox={x1:He.x1,y1:He.y1,x2:He.x2,y2:He.y2,anchorPointX:He.anchorPointX,anchorPointY:He.anchorPointY},j.iconFeatureIndex=He.featureIndex;break}for(var pt=P;pt<F;pt++){var nt=a.get(pt);j.verticalIconBox={x1:nt.x1,y1:nt.y1,x2:nt.x2,y2:nt.y2,anchorPointX:nt.anchorPointX,anchorPointY:nt.anchorPointY},j.verticalIconFeatureIndex=nt.featureIndex;break}return j},qe.prototype.deserializeCollisionBoxes=function(a){this.collisionArrays=[];for(var s=0;s<this.symbolInstances.length;s++){var c=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}},qe.prototype.hasTextData=function(){return this.text.segments.get().length>0},qe.prototype.hasIconData=function(){return this.icon.segments.get().length>0},qe.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},qe.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},qe.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},qe.prototype.addIndicesForPlacedSymbol=function(a,s){for(var c=a.placedSymbolArray.get(s),m=c.vertexStartIndex+4*c.numGlyphs,_=c.vertexStartIndex;_<m;_+=4)a.indexArray.emplaceBack(_,_+1,_+2),a.indexArray.emplaceBack(_+1,_+2,_+3)},qe.prototype.getSortedSymbolIndexes=function(a){if(this.sortedAngle===a&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var s=Math.sin(a),c=Math.cos(a),m=[],_=[],S=[],A=0;A<this.symbolInstances.length;++A){S.push(A);var P=this.symbolInstances.get(A);m.push(0|Math.round(s*P.anchorX+c*P.anchorY)),_.push(P.featureIndex)}return S.sort(function(F,j){return m[F]-m[j]||_[j]-_[F]}),S},qe.prototype.addToSortKeyRanges=function(a,s){var c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===s?c.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:a,symbolInstanceEnd:a+1})},qe.prototype.sortFeatures=function(a){var s=this;if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a),this.sortedAngle=a,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var c=0,m=this.symbolInstanceIndexes;c<m.length;c+=1){var _=this.symbolInstances.get(m[c]);this.featureSortOrder.push(_.featureIndex),[_.rightJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.leftJustifiedTextSymbolIndex].forEach(function(S,A,P){S>=0&&P.indexOf(S)===A&&s.addIndicesForPlacedSymbol(s.text,S)}),_.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,_.verticalPlacedTextSymbolIndex),_.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,_.placedIconSymbolIndex),_.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,_.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Fn("SymbolBucket",qe,{omit:["layers","collisionBoxArray","features","compareText"]}),qe.MAX_GLYPHS=65535,qe.addDynamicAttributes=st;var Et=new Fo({"symbol-placement":new Yn(Ce.layout_symbol["symbol-placement"]),"symbol-spacing":new Yn(Ce.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Yn(Ce.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Gn(Ce.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Yn(Ce.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Yn(Ce.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Yn(Ce.layout_symbol["icon-ignore-placement"]),"icon-optional":new Yn(Ce.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Yn(Ce.layout_symbol["icon-rotation-alignment"]),"icon-size":new Gn(Ce.layout_symbol["icon-size"]),"icon-text-fit":new Yn(Ce.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Yn(Ce.layout_symbol["icon-text-fit-padding"]),"icon-image":new Gn(Ce.layout_symbol["icon-image"]),"icon-rotate":new Gn(Ce.layout_symbol["icon-rotate"]),"icon-padding":new Yn(Ce.layout_symbol["icon-padding"]),"icon-keep-upright":new Yn(Ce.layout_symbol["icon-keep-upright"]),"icon-offset":new Gn(Ce.layout_symbol["icon-offset"]),"icon-anchor":new Gn(Ce.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Yn(Ce.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Yn(Ce.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Yn(Ce.layout_symbol["text-rotation-alignment"]),"text-field":new Gn(Ce.layout_symbol["text-field"]),"text-font":new Gn(Ce.layout_symbol["text-font"]),"text-size":new Gn(Ce.layout_symbol["text-size"]),"text-max-width":new Gn(Ce.layout_symbol["text-max-width"]),"text-line-height":new Yn(Ce.layout_symbol["text-line-height"]),"text-letter-spacing":new Gn(Ce.layout_symbol["text-letter-spacing"]),"text-justify":new Gn(Ce.layout_symbol["text-justify"]),"text-radial-offset":new Gn(Ce.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Yn(Ce.layout_symbol["text-variable-anchor"]),"text-anchor":new Gn(Ce.layout_symbol["text-anchor"]),"text-max-angle":new Yn(Ce.layout_symbol["text-max-angle"]),"text-writing-mode":new Yn(Ce.layout_symbol["text-writing-mode"]),"text-rotate":new Gn(Ce.layout_symbol["text-rotate"]),"text-padding":new Yn(Ce.layout_symbol["text-padding"]),"text-keep-upright":new Yn(Ce.layout_symbol["text-keep-upright"]),"text-transform":new Gn(Ce.layout_symbol["text-transform"]),"text-offset":new Gn(Ce.layout_symbol["text-offset"]),"text-allow-overlap":new Yn(Ce.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Yn(Ce.layout_symbol["text-ignore-placement"]),"text-optional":new Yn(Ce.layout_symbol["text-optional"])}),Ie={paint:new Fo({"icon-opacity":new Gn(Ce.paint_symbol["icon-opacity"]),"icon-color":new Gn(Ce.paint_symbol["icon-color"]),"icon-halo-color":new Gn(Ce.paint_symbol["icon-halo-color"]),"icon-halo-width":new Gn(Ce.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Gn(Ce.paint_symbol["icon-halo-blur"]),"icon-translate":new Yn(Ce.paint_symbol["icon-translate"]),"icon-translate-anchor":new Yn(Ce.paint_symbol["icon-translate-anchor"]),"text-opacity":new Gn(Ce.paint_symbol["text-opacity"]),"text-color":new Gn(Ce.paint_symbol["text-color"],{runtimeType:St,getOverride:function(a){return a.textColor},hasOverride:function(a){return!!a.textColor}}),"text-halo-color":new Gn(Ce.paint_symbol["text-halo-color"]),"text-halo-width":new Gn(Ce.paint_symbol["text-halo-width"]),"text-halo-blur":new Gn(Ce.paint_symbol["text-halo-blur"]),"text-translate":new Yn(Ce.paint_symbol["text-translate"]),"text-translate-anchor":new Yn(Ce.paint_symbol["text-translate-anchor"])}),layout:Et},it=function(a){this.type=a.property.overrides?a.property.overrides.runtimeType:Mn,this.defaultValue=a};it.prototype.evaluate=function(a){if(a.formattedSection){var s=this.defaultValue.property.overrides;if(s&&s.hasOverride(a.formattedSection))return s.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default},it.prototype.eachChild=function(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)},it.prototype.outputDefined=function(){return!1},it.prototype.serialize=function(){return null},Fn("FormatSectionOverride",it,{omit:["defaultValue"]});var Be=function(a){function s(c){a.call(this,c,Ie)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.recalculate=function(c,m){if(a.prototype.recalculate.call(this,c,m),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var _=this.layout.get("text-writing-mode");if(_){for(var S=[],A=0,P=_;A<P.length;A+=1){var F=P[A];S.indexOf(F)<0&&S.push(F)}this.layout._values["text-writing-mode"]=S}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},s.prototype.getValueAndResolveTokens=function(c,m,_,S){var A=this.layout.get(c).evaluate(m,{},_,S),P=this._unevaluatedLayout._values[c];return P.isDataDriven()||ac(P.value)||!A?A:function(F,j){return j.replace(/{([^{}]+)}/g,function(X,ee){return ee in F?String(F[ee]):""})}(m.properties,A)},s.prototype.createBucket=function(c){return new qe(c)},s.prototype.queryRadius=function(){return 0},s.prototype.queryIntersectsFeature=function(){return!1},s.prototype._setPaintOverrides=function(){for(var c=0,m=Ie.paint.overridableProperties;c<m.length;c+=1){var _=m[c];if(s.hasPaintOverride(this.layout,_)){var S,A=this.paint.get(_),P=new it(A),F=new Bc(P,A.property.specification);S=A.value.kind==="constant"||A.value.kind==="source"?new Ll("source",F):new ul("composite",F,A.value.zoomStops,A.value._interpolationType),this.paint._values[_]=new Ds(A.property,S,A.parameters)}}},s.prototype._handleOverridablePaintPropertyUpdate=function(c,m,_){return!(!this.layout||m.isDataDriven()||_.isDataDriven())&&s.hasPaintOverride(this.layout,c)},s.hasPaintOverride=function(c,m){var _=c.get("text-field"),S=Ie.paint.properties[m],A=!1,P=function(X){for(var ee=0,fe=X;ee<fe.length;ee+=1)if(S.overrides&&S.overrides.hasOverride(fe[ee]))return void(A=!0)};if(_.value.kind==="constant"&&_.value.value instanceof Aa)P(_.value.value.sections);else if(_.value.kind==="source"){var F=function(X){A||(X instanceof no&&ia(X.value)===ua?P(X.value.sections):X instanceof Ho?P(X.sections):X.eachChild(F))},j=_.value;j._styleExpression&&F(j._styleExpression.expression)}return A},s}(nu),Dt={paint:new Fo({"background-color":new Yn(Ce.paint_background["background-color"]),"background-pattern":new gs(Ce.paint_background["background-pattern"]),"background-opacity":new Yn(Ce.paint_background["background-opacity"])})},Wt=function(a){function s(c){a.call(this,c,Dt)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s}(nu),kr={paint:new Fo({"raster-opacity":new Yn(Ce.paint_raster["raster-opacity"]),"raster-hue-rotate":new Yn(Ce.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Yn(Ce.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Yn(Ce.paint_raster["raster-brightness-max"]),"raster-saturation":new Yn(Ce.paint_raster["raster-saturation"]),"raster-contrast":new Yn(Ce.paint_raster["raster-contrast"]),"raster-resampling":new Yn(Ce.paint_raster["raster-resampling"]),"raster-fade-duration":new Yn(Ce.paint_raster["raster-fade-duration"])})},sn=function(a){function s(c){a.call(this,c,kr)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s}(nu),un=function(a){function s(c){a.call(this,c,{}),this.implementation=c}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},s.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},s.prototype.recalculate=function(){},s.prototype.updateTransitions=function(){},s.prototype.hasTransition=function(){},s.prototype.serialize=function(){},s.prototype.onAdd=function(c){this.implementation.onAdd&&this.implementation.onAdd(c,c.painter.context.gl)},s.prototype.onRemove=function(c){this.implementation.onRemove&&this.implementation.onRemove(c,c.painter.context.gl)},s}(nu),bn={circle:wf,heatmap:Oh,hillshade:qp,fill:ah,"fill-extrusion":Eu,line:zd,symbol:Be,background:Wt,raster:sn},an=_e.HTMLImageElement,Un=_e.HTMLCanvasElement,Sn=_e.HTMLVideoElement,zn=_e.ImageData,Bn=_e.ImageBitmap,On=function(a,s,c,m){this.context=a,this.format=c,this.texture=a.gl.createTexture(),this.update(s,m)};On.prototype.update=function(a,s,c){var m=a.width,_=a.height,S=!(this.size&&this.size[0]===m&&this.size[1]===_||c),A=this.context,P=A.gl;if(this.useMipmap=Boolean(s&&s.useMipmap),P.bindTexture(P.TEXTURE_2D,this.texture),A.pixelStoreUnpackFlipY.set(!1),A.pixelStoreUnpack.set(1),A.pixelStoreUnpackPremultiplyAlpha.set(this.format===P.RGBA&&(!s||s.premultiply!==!1)),S)this.size=[m,_],a instanceof an||a instanceof Un||a instanceof Sn||a instanceof zn||Bn&&a instanceof Bn?P.texImage2D(P.TEXTURE_2D,0,this.format,this.format,P.UNSIGNED_BYTE,a):P.texImage2D(P.TEXTURE_2D,0,this.format,m,_,0,this.format,P.UNSIGNED_BYTE,a.data);else{var F=c||{x:0,y:0},j=F.x,X=F.y;a instanceof an||a instanceof Un||a instanceof Sn||a instanceof zn||Bn&&a instanceof Bn?P.texSubImage2D(P.TEXTURE_2D,0,j,X,P.RGBA,P.UNSIGNED_BYTE,a):P.texSubImage2D(P.TEXTURE_2D,0,j,X,m,_,P.RGBA,P.UNSIGNED_BYTE,a.data)}this.useMipmap&&this.isSizePowerOfTwo()&&P.generateMipmap(P.TEXTURE_2D)},On.prototype.bind=function(a,s,c){var m=this.context.gl;m.bindTexture(m.TEXTURE_2D,this.texture),c!==m.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(c=m.LINEAR),a!==this.filter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,a),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,c||a),this.filter=a),s!==this.wrap&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,s),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,s),this.wrap=s)},On.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},On.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var hi=function(a){var s=this;this._callback=a,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){s._triggered=!1,s._callback()})};hi.prototype.trigger=function(){var a=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){a._triggered=!1,a._callback()},0))},hi.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Ma=function(a,s,c){this.target=a,this.parent=s,this.mapId=c,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},ar(["receive","process"],this),this.invoker=new hi(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=re()?a:_e};function Za(a,s,c){var m=2*Math.PI*6378137/256/Math.pow(2,c);return[a*m-2*Math.PI*6378137/2,s*m-2*Math.PI*6378137/2]}Ma.prototype.send=function(a,s,c,m,_){var S=this;_===void 0&&(_=!1);var A=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(this.callbacks[A]=c);var P=z(this.globalScope)?void 0:[];return this.target.postMessage({id:A,type:a,hasCallback:!!c,targetMapId:m,mustQueue:_,sourceMapId:this.mapId,data:tu(s,P)},P),{cancel:function(){c&&delete S.callbacks[A],S.target.postMessage({id:A,type:"<cancel>",targetMapId:m,sourceMapId:S.mapId})}}},Ma.prototype.receive=function(a){var s=a.data,c=s.id;if(c&&(!s.targetMapId||this.mapId===s.targetMapId))if(s.type==="<cancel>"){delete this.tasks[c];var m=this.cancelCallbacks[c];delete this.cancelCallbacks[c],m&&m()}else re()||s.mustQueue?(this.tasks[c]=s,this.taskQueue.push(c),this.invoker.trigger()):this.processTask(c,s)},Ma.prototype.process=function(){if(this.taskQueue.length){var a=this.taskQueue.shift(),s=this.tasks[a];delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),s&&this.processTask(a,s)}},Ma.prototype.processTask=function(a,s){var c=this;if(s.type==="<response>"){var m=this.callbacks[a];delete this.callbacks[a],m&&(s.error?m(Gs(s.error)):m(null,Gs(s.data)))}else{var _=!1,S=z(this.globalScope)?void 0:[],A=s.hasCallback?function(X,ee){_=!0,delete c.cancelCallbacks[a],c.target.postMessage({id:a,type:"<response>",sourceMapId:c.mapId,error:X?tu(X):null,data:tu(ee,S)},S)}:function(X){_=!0},P=null,F=Gs(s.data);if(this.parent[s.type])P=this.parent[s.type](s.sourceMapId,F,A);else if(this.parent.getWorkerSource){var j=s.type.split(".");P=this.parent.getWorkerSource(s.sourceMapId,j[0],F.source)[j[1]](F,A)}else A(new Error("Could not find function "+s.type));!_&&P&&P.cancel&&(this.cancelCallbacks[a]=P.cancel)}},Ma.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Ga=function(a,s){a&&(s?this.setSouthWest(a).setNorthEast(s):a.length===4?this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]]):this.setSouthWest(a[0]).setNorthEast(a[1]))};Ga.prototype.setNorthEast=function(a){return this._ne=a instanceof xa?new xa(a.lng,a.lat):xa.convert(a),this},Ga.prototype.setSouthWest=function(a){return this._sw=a instanceof xa?new xa(a.lng,a.lat):xa.convert(a),this},Ga.prototype.extend=function(a){var s,c,m=this._sw,_=this._ne;if(a instanceof xa)s=a,c=a;else{if(!(a instanceof Ga))return Array.isArray(a)?a.length===4||a.every(Array.isArray)?this.extend(Ga.convert(a)):this.extend(xa.convert(a)):this;if(c=a._ne,!(s=a._sw)||!c)return this}return m||_?(m.lng=Math.min(s.lng,m.lng),m.lat=Math.min(s.lat,m.lat),_.lng=Math.max(c.lng,_.lng),_.lat=Math.max(c.lat,_.lat)):(this._sw=new xa(s.lng,s.lat),this._ne=new xa(c.lng,c.lat)),this},Ga.prototype.getCenter=function(){return new xa((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Ga.prototype.getSouthWest=function(){return this._sw},Ga.prototype.getNorthEast=function(){return this._ne},Ga.prototype.getNorthWest=function(){return new xa(this.getWest(),this.getNorth())},Ga.prototype.getSouthEast=function(){return new xa(this.getEast(),this.getSouth())},Ga.prototype.getWest=function(){return this._sw.lng},Ga.prototype.getSouth=function(){return this._sw.lat},Ga.prototype.getEast=function(){return this._ne.lng},Ga.prototype.getNorth=function(){return this._ne.lat},Ga.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Ga.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Ga.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Ga.prototype.contains=function(a){var s=xa.convert(a),c=s.lng,m=s.lat,_=this._sw.lng<=c&&c<=this._ne.lng;return this._sw.lng>this._ne.lng&&(_=this._sw.lng>=c&&c>=this._ne.lng),this._sw.lat<=m&&m<=this._ne.lat&&_},Ga.convert=function(a){return!a||a instanceof Ga?a:new Ga(a)};var xa=function(a,s){if(isNaN(a)||isNaN(s))throw new Error("Invalid LngLat object: ("+a+", "+s+")");if(this.lng=+a,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};xa.prototype.wrap=function(){return new xa(ur(this.lng,-180,180),this.lat)},xa.prototype.toArray=function(){return[this.lng,this.lat]},xa.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},xa.prototype.distanceTo=function(a){var s=Math.PI/180,c=this.lat*s,m=a.lat*s,_=Math.sin(c)*Math.sin(m)+Math.cos(c)*Math.cos(m)*Math.cos((a.lng-this.lng)*s);return 63710088e-1*Math.acos(Math.min(_,1))},xa.prototype.toBounds=function(a){a===void 0&&(a=0);var s=360*a/40075017,c=s/Math.cos(Math.PI/180*this.lat);return new Ga(new xa(this.lng-c,this.lat-s),new xa(this.lng+c,this.lat+s))},xa.convert=function(a){if(a instanceof xa)return a;if(Array.isArray(a)&&(a.length===2||a.length===3))return new xa(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&typeof a=="object"&&a!==null)return new xa(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var ql=2*Math.PI*63710088e-1;function Qr(a){return ql*Math.cos(a*Math.PI/180)}function rl(a){return(180+a)/360}function Yt(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function gp(a,s){return a/Qr(s)}function Lu(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}var Kl=function(a,s,c){c===void 0&&(c=0),this.x=+a,this.y=+s,this.z=+c};Kl.fromLngLat=function(a,s){s===void 0&&(s=0);var c=xa.convert(a);return new Kl(rl(c.lng),Yt(c.lat),gp(s,c.lat))},Kl.prototype.toLngLat=function(){return new xa(360*this.x-180,Lu(this.y))},Kl.prototype.toAltitude=function(){return this.z*Qr(Lu(this.y))},Kl.prototype.meterInMercatorCoordinateUnits=function(){return 1/ql*(a=Lu(this.y),1/Math.cos(a*Math.PI/180));var a};var hh=function(a,s,c){this.z=a,this.x=s,this.y=c,this.key=yp(0,a,a,s,c)};hh.prototype.equals=function(a){return this.z===a.z&&this.x===a.x&&this.y===a.y},hh.prototype.url=function(a,s){var c,m,_,S,A,P=(m=this.y,_=this.z,S=Za(256*(c=this.x),256*(m=Math.pow(2,_)-m-1),_),A=Za(256*(c+1),256*(m+1),_),S[0]+","+S[1]+","+A[0]+","+A[1]),F=function(j,X,ee){for(var fe,xe="",je=j;je>0;je--)xe+=(X&(fe=1<<je-1)?1:0)+(ee&fe?2:0);return xe}(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",F).replace("{bbox-epsg-3857}",P)},hh.prototype.getTilePoint=function(a){var s=Math.pow(2,this.z);return new se(8192*(a.x*s-this.x),8192*(a.y*s-this.y))},hh.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Gd=function(a,s){this.wrap=a,this.canonical=s,this.key=yp(a,s.z,s.z,s.x,s.y)},Co=function(a,s,c,m,_){this.overscaledZ=a,this.wrap=s,this.canonical=new hh(c,+m,+_),this.key=yp(s,a,c,m,_)};function yp(a,s,c,m,_){(a*=2)<0&&(a=-1*a-1);var S=1<<c;return(S*S*a+S*_+m).toString(36)+c.toString(36)+s.toString(36)}Co.prototype.equals=function(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)},Co.prototype.scaledTo=function(a){var s=this.canonical.z-a;return a>this.canonical.z?new Co(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Co(a,this.wrap,a,this.canonical.x>>s,this.canonical.y>>s)},Co.prototype.calculateScaledKey=function(a,s){var c=this.canonical.z-a;return a>this.canonical.z?yp(this.wrap*+s,a,this.canonical.z,this.canonical.x,this.canonical.y):yp(this.wrap*+s,a,a,this.canonical.x>>c,this.canonical.y>>c)},Co.prototype.isChildOf=function(a){if(a.wrap!==this.wrap)return!1;var s=this.canonical.z-a.canonical.z;return a.overscaledZ===0||a.overscaledZ<this.overscaledZ&&a.canonical.x===this.canonical.x>>s&&a.canonical.y===this.canonical.y>>s},Co.prototype.children=function(a){if(this.overscaledZ>=a)return[new Co(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var s=this.canonical.z+1,c=2*this.canonical.x,m=2*this.canonical.y;return[new Co(s,this.wrap,s,c,m),new Co(s,this.wrap,s,c+1,m),new Co(s,this.wrap,s,c,m+1),new Co(s,this.wrap,s,c+1,m+1)]},Co.prototype.isLessThan=function(a){return this.wrap<a.wrap||!(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ||!(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x||!(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))},Co.prototype.wrapped=function(){return new Co(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Co.prototype.unwrapTo=function(a){return new Co(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)},Co.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Co.prototype.toUnwrapped=function(){return new Gd(this.wrap,this.canonical)},Co.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Co.prototype.getTilePoint=function(a){return this.canonical.getTilePoint(new Kl(a.x-this.wrap,a.y))},Fn("CanonicalTileID",hh),Fn("OverscaledTileID",Co,{omit:["posMatrix"]});var nf=function(a,s,c){if(this.uid=a,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(c&&c!=="mapbox"&&c!=="terrarium")return dt('"'+c+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=s.height;var m=this.dim=s.height-2;this.data=new Uint32Array(s.data.buffer),this.encoding=c||"mapbox";for(var _=0;_<m;_++)this.data[this._idx(-1,_)]=this.data[this._idx(0,_)],this.data[this._idx(m,_)]=this.data[this._idx(m-1,_)],this.data[this._idx(_,-1)]=this.data[this._idx(_,0)],this.data[this._idx(_,m)]=this.data[this._idx(_,m-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(m,-1)]=this.data[this._idx(m-1,0)],this.data[this._idx(-1,m)]=this.data[this._idx(0,m-1)],this.data[this._idx(m,m)]=this.data[this._idx(m-1,m-1)]};nf.prototype.get=function(a,s){var c=new Uint8Array(this.data.buffer),m=4*this._idx(a,s);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(c[m],c[m+1],c[m+2])},nf.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},nf.prototype._idx=function(a,s){if(a<-1||a>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(a+1)},nf.prototype._unpackMapbox=function(a,s,c){return(256*a*256+256*s+c)/10-1e4},nf.prototype._unpackTerrarium=function(a,s,c){return 256*a+s+c/256-32768},nf.prototype.getPixels=function(){return new Ro({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},nf.prototype.backfillBorder=function(a,s,c){if(this.dim!==a.dim)throw new Error("dem dimension mismatch");var m=s*this.dim,_=s*this.dim+this.dim,S=c*this.dim,A=c*this.dim+this.dim;switch(s){case-1:m=_-1;break;case 1:_=m+1}switch(c){case-1:S=A-1;break;case 1:A=S+1}for(var P=-s*this.dim,F=-c*this.dim,j=S;j<A;j++)for(var X=m;X<_;X++)this.data[this._idx(X,j)]=a.data[this._idx(X+P,j+F)]},Fn("DEMData",nf);var _p=function(a){this._stringToNumber={},this._numberToString=[];for(var s=0;s<a.length;s++){var c=a[s];this._stringToNumber[c]=s,this._numberToString[s]=c}};_p.prototype.encode=function(a){return this._stringToNumber[a]},_p.prototype.decode=function(a){return this._numberToString[a]};var xp=function(a,s,c,m,_){this.type="Feature",this._vectorTileFeature=a,a._z=s,a._x=c,a._y=m,this.properties=a.properties,this.id=_},ad={geometry:{configurable:!0}};ad.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},ad.geometry.set=function(a){this._geometry=a},xp.prototype.toJSON=function(){var a={geometry:this.geometry};for(var s in this)s!=="_geometry"&&s!=="_vectorTileFeature"&&(a[s]=this[s]);return a},Object.defineProperties(xp.prototype,ad);var ph=function(){this.state={},this.stateChanges={},this.deletedStates={}};ph.prototype.updateState=function(a,s,c){var m=String(s);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][m]=this.stateChanges[a][m]||{},Mt(this.stateChanges[a][m],c),this.deletedStates[a]===null)for(var _ in this.deletedStates[a]={},this.state[a])_!==m&&(this.deletedStates[a][_]=null);else if(this.deletedStates[a]&&this.deletedStates[a][m]===null)for(var S in this.deletedStates[a][m]={},this.state[a][m])c[S]||(this.deletedStates[a][m][S]=null);else for(var A in c)this.deletedStates[a]&&this.deletedStates[a][m]&&this.deletedStates[a][m][A]===null&&delete this.deletedStates[a][m][A]},ph.prototype.removeFeatureState=function(a,s,c){if(this.deletedStates[a]!==null){var m=String(s);if(this.deletedStates[a]=this.deletedStates[a]||{},c&&s!==void 0)this.deletedStates[a][m]!==null&&(this.deletedStates[a][m]=this.deletedStates[a][m]||{},this.deletedStates[a][m][c]=null);else if(s!==void 0)if(this.stateChanges[a]&&this.stateChanges[a][m])for(c in this.deletedStates[a][m]={},this.stateChanges[a][m])this.deletedStates[a][m][c]=null;else this.deletedStates[a][m]=null;else this.deletedStates[a]=null}},ph.prototype.getState=function(a,s){var c=String(s),m=Mt({},(this.state[a]||{})[c],(this.stateChanges[a]||{})[c]);if(this.deletedStates[a]===null)return{};if(this.deletedStates[a]){var _=this.deletedStates[a][s];if(_===null)return{};for(var S in _)delete m[S]}return m},ph.prototype.initializeTileState=function(a,s){a.setFeatureState(this.state,s)},ph.prototype.coalesceChanges=function(a,s){var c={};for(var m in this.stateChanges){this.state[m]=this.state[m]||{};var _={};for(var S in this.stateChanges[m])this.state[m][S]||(this.state[m][S]={}),Mt(this.state[m][S],this.stateChanges[m][S]),_[S]=this.state[m][S];c[m]=_}for(var A in this.deletedStates){this.state[A]=this.state[A]||{};var P={};if(this.deletedStates[A]===null)for(var F in this.state[A])P[F]={},this.state[A][F]={};else for(var j in this.deletedStates[A]){if(this.deletedStates[A][j]===null)this.state[A][j]={};else for(var X=0,ee=Object.keys(this.deletedStates[A][j]);X<ee.length;X+=1)delete this.state[A][j][ee[X]];P[j]=this.state[A][j]}c[A]=c[A]||{},Mt(c[A],P)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(var fe in a)a[fe].setFeatureState(c,s)};var Sc=function(a,s){this.tileID=a,this.x=a.canonical.x,this.y=a.canonical.y,this.z=a.canonical.z,this.grid=new Au(8192,16,0),this.grid3D=new Au(8192,16,0),this.featureIndexArray=new te,this.promoteId=s};function Ov(a,s,c,m,_){return Qt(a,function(S,A){var P=s instanceof Hs?s.get(A):null;return P&&P.evaluate?P.evaluate(c,m,_):P})}function Hd(a){for(var s=1/0,c=1/0,m=-1/0,_=-1/0,S=0,A=a;S<A.length;S+=1){var P=A[S];s=Math.min(s,P.x),c=Math.min(c,P.y),m=Math.max(m,P.x),_=Math.max(_,P.y)}return{minX:s,minY:c,maxX:m,maxY:_}}function U0(a,s){return s-a}Sc.prototype.insert=function(a,s,c,m,_,S){var A=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,m,_);for(var P=S?this.grid3D:this.grid,F=0;F<s.length;F++){for(var j=s[F],X=[1/0,1/0,-1/0,-1/0],ee=0;ee<j.length;ee++){var fe=j[ee];X[0]=Math.min(X[0],fe.x),X[1]=Math.min(X[1],fe.y),X[2]=Math.max(X[2],fe.x),X[3]=Math.max(X[3],fe.y)}X[0]<8192&&X[1]<8192&&X[2]>=0&&X[3]>=0&&P.insert(A,X[0],X[1],X[2],X[3])}},Sc.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new bu.VectorTile(new fh(this.rawTileData)).layers,this.sourceLayerCoder=new _p(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Sc.prototype.query=function(a,s,c,m){var _=this;this.loadVTLayers();for(var S=a.params||{},A=8192/a.tileSize/a.scale,P=gf(S.filter),F=a.queryGeometry,j=a.queryPadding*A,X=Hd(F),ee=this.grid.query(X.minX-j,X.minY-j,X.maxX+j,X.maxY+j),fe=Hd(a.cameraQueryGeometry),xe=this.grid3D.query(fe.minX-j,fe.minY-j,fe.maxX+j,fe.maxY+j,function(sr,vr,fr,Hr){return function(dn,Kn,kn,ai,In){for(var zi=0,di=dn;zi<di.length;zi+=1){var Xn=di[zi];if(Kn<=Xn.x&&kn<=Xn.y&&ai>=Xn.x&&In>=Xn.y)return!0}var Wi=[new se(Kn,kn),new se(Kn,In),new se(ai,In),new se(ai,kn)];if(dn.length>2){for(var xi=0,qi=Wi;xi<qi.length;xi+=1)if(gu(dn,qi[xi]))return!0}for(var Qn=0;Qn<dn.length-1;Qn++)if(mc(dn[Qn],dn[Qn+1],Wi))return!0;return!1}(a.cameraQueryGeometry,sr-j,vr-j,fr+j,Hr+j)}),je=0,He=xe;je<He.length;je+=1)ee.push(He[je]);ee.sort(U0);for(var pt,nt={},kt=function(sr){var vr=ee[sr];if(vr!==pt){pt=vr;var fr=_.featureIndexArray.get(vr),Hr=null;_.loadMatchingFeature(nt,fr.bucketIndex,fr.sourceLayerIndex,fr.featureIndex,P,S.layers,S.availableImages,s,c,m,function(dn,Kn,kn){return Hr||(Hr=Ja(dn)),Kn.queryIntersectsFeature(F,dn,kn,Hr,_.z,a.transform,A,a.pixelPosMatrix)})}},Gt=0;Gt<ee.length;Gt++)kt(Gt);return nt},Sc.prototype.loadMatchingFeature=function(a,s,c,m,_,S,A,P,F,j,X){var ee=this.bucketLayerIDs[s];if(!S||function(dn,Kn){for(var kn=0;kn<dn.length;kn++)if(Kn.indexOf(dn[kn])>=0)return!0;return!1}(S,ee)){var fe=this.sourceLayerCoder.decode(c),xe=this.vtLayers[fe].feature(m);if(_.needGeometry){var je=yo(xe,!0);if(!_.filter(new Li(this.tileID.overscaledZ),je,this.tileID.canonical))return}else if(!_.filter(new Li(this.tileID.overscaledZ),xe))return;for(var He=this.getId(xe,fe),pt=0;pt<ee.length;pt++){var nt=ee[pt];if(!(S&&S.indexOf(nt)<0)){var kt=P[nt];if(kt){var Gt={};He!==void 0&&j&&(Gt=j.getState(kt.sourceLayer||"_geojsonTileLayer",He));var sr=Mt({},F[nt]);sr.paint=Ov(sr.paint,kt.paint,xe,Gt,A),sr.layout=Ov(sr.layout,kt.layout,xe,Gt,A);var vr=!X||X(xe,kt,Gt);if(vr){var fr=new xp(xe,this.z,this.x,this.y,He);fr.layer=sr;var Hr=a[nt];Hr===void 0&&(Hr=a[nt]=[]),Hr.push({featureIndex:m,feature:fr,intersectionZ:vr})}}}}}},Sc.prototype.lookupSymbolFeatures=function(a,s,c,m,_,S,A,P){var F={};this.loadVTLayers();for(var j=gf(_),X=0,ee=a;X<ee.length;X+=1)this.loadMatchingFeature(F,c,m,ee[X],j,S,A,P,s);return F},Sc.prototype.hasLayer=function(a){for(var s=0,c=this.bucketLayerIDs;s<c.length;s+=1)for(var m=0,_=c[s];m<_.length;m+=1)if(a===_[m])return!0;return!1},Sc.prototype.getId=function(a,s){var c=a.id;return this.promoteId&&typeof(c=a.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]])=="boolean"&&(c=Number(c)),c},Fn("FeatureIndex",Sc,{omit:["rawTileData","sourceLayerCoder"]});var bs=function(a,s){this.tileID=a,this.uid=zt(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};bs.prototype.registerFadeDuration=function(a){var s=a+this.timeAdded;s<Pn.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)},bs.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},bs.prototype.loadVectorData=function(a,s,c){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",a){for(var m in a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=function(j,X){var ee={};if(!X)return ee;for(var fe=function(){var He=je[xe],pt=He.layerIds.map(function(Gt){return X.getLayer(Gt)}).filter(Boolean);if(pt.length!==0){He.layers=pt,He.stateDependentLayerIds&&(He.stateDependentLayers=He.stateDependentLayerIds.map(function(Gt){return pt.filter(function(sr){return sr.id===Gt})[0]}));for(var nt=0,kt=pt;nt<kt.length;nt+=1)ee[kt[nt].id]=He}},xe=0,je=j;xe<je.length;xe+=1)fe();return ee}(a.buckets,s.style),this.hasSymbolBuckets=!1,this.buckets){var _=this.buckets[m];if(_ instanceof qe){if(this.hasSymbolBuckets=!0,!c)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var S in this.buckets){var A=this.buckets[S];if(A instanceof qe&&A.hasRTLText){this.hasRTLText=!0,ms.isLoading()||ms.isLoaded()||Hf()!=="deferred"||ru();break}}for(var P in this.queryPadding=0,this.buckets){var F=this.buckets[P];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(P).queryRadius(F))}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage)}else this.collisionBoxArray=new d},bs.prototype.unloadVectorData=function(){for(var a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},bs.prototype.getBucket=function(a){return this.buckets[a.id]},bs.prototype.upload=function(a){for(var s in this.buckets){var c=this.buckets[s];c.uploadPending()&&c.upload(a)}var m=a.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new On(a,this.imageAtlas.image,m.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new On(a,this.glyphAtlasImage,m.ALPHA),this.glyphAtlasImage=null)},bs.prototype.prepare=function(a){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture)},bs.prototype.queryRenderedFeatures=function(a,s,c,m,_,S,A,P,F,j){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:_,scale:S,tileSize:this.tileSize,pixelPosMatrix:j,transform:P,params:A,queryPadding:this.queryPadding*F},a,s,c):{}},bs.prototype.querySourceFeatures=function(a,s){var c=this.latestFeatureIndex;if(c&&c.rawTileData){var m=c.loadVTLayers(),_=s?s.sourceLayer:"",S=m._geojsonTileLayer||m[_];if(S)for(var A=gf(s&&s.filter),P=this.tileID.canonical,F=P.z,j=P.x,X=P.y,ee={z:F,x:j,y:X},fe=0;fe<S.length;fe++){var xe=S.feature(fe);if(A.needGeometry){var je=yo(xe,!0);if(!A.filter(new Li(this.tileID.overscaledZ),je,this.tileID.canonical))continue}else if(!A.filter(new Li(this.tileID.overscaledZ),xe))continue;var He=c.getId(xe,_),pt=new xp(xe,F,j,X,He);pt.tile=ee,a.push(pt)}}},bs.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},bs.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},bs.prototype.setExpiryData=function(a){var s=this.expirationTime;if(a.cacheControl){var c=Fe(a.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){var m=Date.now(),_=!1;if(this.expirationTime>m)_=!1;else if(s)if(this.expirationTime<s)_=!0;else{var S=this.expirationTime-s;S?this.expirationTime=m+Math.max(S,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},bs.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},bs.prototype.setFeatureState=function(a,s){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(a).length!==0){var c=this.latestFeatureIndex.loadVTLayers();for(var m in this.buckets)if(s.style.hasLayer(m)){var _=this.buckets[m],S=_.layers[0].sourceLayer||"_geojsonTileLayer",A=c[S],P=a[S];if(A&&P&&Object.keys(P).length!==0){_.update(P,A,this.imageAtlas&&this.imageAtlas.patternPositions||{});var F=s&&s.style&&s.style.getLayer(m);F&&(this.queryPadding=Math.max(this.queryPadding,F.queryRadius(_)))}}}},bs.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},bs.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Pn.now()},bs.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},bs.prototype.setHoldDuration=function(a){this.symbolFadeHoldUntil=Pn.now()+a},bs.prototype.setDependencies=function(a,s){for(var c={},m=0,_=s;m<_.length;m+=1)c[_[m]]=!0;this.dependencies[a]=c},bs.prototype.hasDependency=function(a,s){for(var c=0,m=a;c<m.length;c+=1){var _=this.dependencies[m[c]];if(_){for(var S=0,A=s;S<A.length;S+=1)if(_[A[S]])return!0}}return!1};var Pf=_e.performance,Lv=function(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},Pf.mark(this._marks.start)};Lv.prototype.finish=function(){Pf.mark(this._marks.end);var a=Pf.getEntriesByName(this._marks.measure);return a.length===0&&(Pf.measure(this._marks.measure,this._marks.start,this._marks.end),a=Pf.getEntriesByName(this._marks.measure),Pf.clearMarks(this._marks.start),Pf.clearMarks(this._marks.end),Pf.clearMeasures(this._marks.measure)),a},y.Actor=Ma,y.AlphaImage=_u,y.CanonicalTileID=hh,y.CollisionBoxArray=d,y.Color=gr,y.DEMData=nf,y.DataConstantProperty=Yn,y.DictionaryCoder=_p,y.EXTENT=8192,y.ErrorEvent=at,y.EvaluationParameters=Li,y.Event=Ve,y.Evented=_t,y.FeatureIndex=Sc,y.FillBucket=ou,y.FillExtrusionBucket=tl,y.ImageAtlas=jr,y.ImagePosition=Pt,y.LineBucket=ya,y.LngLat=xa,y.LngLatBounds=Ga,y.MercatorCoordinate=Kl,y.ONE_EM=24,y.OverscaledTileID=Co,y.Point=se,y.Point$1=se,y.Properties=Fo,y.Protobuf=fh,y.RGBAImage=Ro,y.RequestManager=bi,y.RequestPerformance=Lv,y.ResourceType=rn,y.SegmentVector=Se,y.SourceFeatureState=ph,y.StructArrayLayout1ui2=Sf,y.StructArrayLayout2f1f2i16=dc,y.StructArrayLayout2i4=vl,y.StructArrayLayout3ui6=Vl,y.StructArrayLayout4i8=ju,y.SymbolBucket=qe,y.Texture=On,y.Tile=bs,y.Transitionable=ns,y.Uniform1f=on,y.Uniform1i=Fr,y.Uniform2f=nn,y.Uniform3f=Tn,y.Uniform4f=ri,y.UniformColor=Jn,y.UniformMatrix4f=Ui,y.UnwrappedTileID=Gd,y.ValidationError=$e,y.WritingMode=ln,y.ZoomHistory=xf,y.add=function(a,s,c){return a[0]=s[0]+c[0],a[1]=s[1]+c[1],a[2]=s[2]+c[2],a},y.addDynamicAttributes=st,y.asyncAll=function(a,s,c){if(!a.length)return c(null,[]);var m=a.length,_=new Array(a.length),S=null;a.forEach(function(A,P){s(A,function(F,j){F&&(S=F),_[P]=j,--m==0&&c(S,_)})})},y.bezier=lt,y.bindAll=ar,y.browser=Pn,y.cacheEntryPossiblyAdded=function(a){++$n>mr&&(a.getActor().send("enforceCacheSizeLimit",It),$n=0)},y.clamp=gt,y.clearTileCache=function(a){var s=_e.caches.delete("mapbox-tiles");a&&s.catch(a).then(function(){return a()})},y.clipLine=_o,y.clone=function(a){var s=new da(16);return s[0]=a[0],s[1]=a[1],s[2]=a[2],s[3]=a[3],s[4]=a[4],s[5]=a[5],s[6]=a[6],s[7]=a[7],s[8]=a[8],s[9]=a[9],s[10]=a[10],s[11]=a[11],s[12]=a[12],s[13]=a[13],s[14]=a[14],s[15]=a[15],s},y.clone$1=ft,y.clone$2=function(a){var s=new da(3);return s[0]=a[0],s[1]=a[1],s[2]=a[2],s},y.collisionCircleLayout=dp,y.config=Nr,y.create=function(){var a=new da(16);return da!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},y.create$1=function(){var a=new da(9);return da!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a},y.create$2=function(){var a=new da(4);return da!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a},y.createCommonjsModule=Te,y.createExpression=Ol,y.createLayout=ja,y.createStyleLayer=function(a){return a.type==="custom"?new un(a):new bn[a.type](a)},y.cross=function(a,s,c){var m=s[0],_=s[1],S=s[2],A=c[0],P=c[1],F=c[2];return a[0]=_*F-S*P,a[1]=S*A-m*F,a[2]=m*P-_*A,a},y.deepEqual=function a(s,c){if(Array.isArray(s)){if(!Array.isArray(c)||s.length!==c.length)return!1;for(var m=0;m<s.length;m++)if(!a(s[m],c[m]))return!1;return!0}if(typeof s=="object"&&s!==null&&c!==null){if(typeof c!="object"||Object.keys(s).length!==Object.keys(c).length)return!1;for(var _ in s)if(!a(s[_],c[_]))return!1;return!0}return s===c},y.dot=function(a,s){return a[0]*s[0]+a[1]*s[1]+a[2]*s[2]},y.dot$1=function(a,s){return a[0]*s[0]+a[1]*s[1]+a[2]*s[2]+a[3]*s[3]},y.ease=bt,y.emitValidationErrors=uc,y.endsWith=J,y.enforceCacheSizeLimit=function(a){Ir(),ue&&ue.then(function(s){s.keys().then(function(c){for(var m=0;m<c.length-a;m++)s.delete(c[m])})})},y.evaluateSizeForFeature=fi,y.evaluateSizeForZoom=Ci,y.evaluateVariableOffset=Ou,y.evented=Ef,y.extend=Mt,y.featureFilter=gf,y.filterObject=Ct,y.fromRotation=function(a,s){var c=Math.sin(s),m=Math.cos(s);return a[0]=m,a[1]=c,a[2]=0,a[3]=-c,a[4]=m,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},y.getAnchorAlignment=yn,y.getAnchorJustification=Ue,y.getArrayBuffer=ga,y.getImage=ae,y.getJSON=function(a,s){return Na(Mt(a,{type:"json"}),s)},y.getRTLTextPluginStatus=Hf,y.getReferrer=ni,y.getVideo=function(a,s){var c,m,_=_e.document.createElement("video");_.muted=!0,_.onloadstart=function(){s(null,_)};for(var S=0;S<a.length;S++){var A=_e.document.createElement("source");c=a[S],m=void 0,(m=_e.document.createElement("a")).href=c,(m.protocol!==_e.document.location.protocol||m.host!==_e.document.location.host)&&(_.crossOrigin="Anonymous"),A.src=a[S],_.appendChild(A)}return{cancel:function(){}}},y.identity=Xs,y.invert=function(a,s){var c=s[0],m=s[1],_=s[2],S=s[3],A=s[4],P=s[5],F=s[6],j=s[7],X=s[8],ee=s[9],fe=s[10],xe=s[11],je=s[12],He=s[13],pt=s[14],nt=s[15],kt=c*P-m*A,Gt=c*F-_*A,sr=c*j-S*A,vr=m*F-_*P,fr=m*j-S*P,Hr=_*j-S*F,dn=X*He-ee*je,Kn=X*pt-fe*je,kn=X*nt-xe*je,ai=ee*pt-fe*He,In=ee*nt-xe*He,zi=fe*nt-xe*pt,di=kt*zi-Gt*In+sr*ai+vr*kn-fr*Kn+Hr*dn;return di?(a[0]=(P*zi-F*In+j*ai)*(di=1/di),a[1]=(_*In-m*zi-S*ai)*di,a[2]=(He*Hr-pt*fr+nt*vr)*di,a[3]=(fe*fr-ee*Hr-xe*vr)*di,a[4]=(F*kn-A*zi-j*Kn)*di,a[5]=(c*zi-_*kn+S*Kn)*di,a[6]=(pt*sr-je*Hr-nt*Gt)*di,a[7]=(X*Hr-fe*sr+xe*Gt)*di,a[8]=(A*In-P*kn+j*dn)*di,a[9]=(m*kn-c*In-S*dn)*di,a[10]=(je*fr-He*sr+nt*kt)*di,a[11]=(ee*sr-X*fr-xe*kt)*di,a[12]=(P*Kn-A*ai-F*dn)*di,a[13]=(c*ai-m*Kn+_*dn)*di,a[14]=(He*Gt-je*vr-pt*kt)*di,a[15]=(X*vr-ee*Gt+fe*kt)*di,a):null},y.isChar=vn,y.isMapboxURL=li,y.keysDifference=function(a,s){var c=[];for(var m in a)m in s||c.push(m);return c},y.makeRequest=Na,y.mapObject=Qt,y.mercatorXfromLng=rl,y.mercatorYfromLat=Yt,y.mercatorZfromAltitude=gp,y.mul=Yc,y.multiply=_s,y.mvt=bu,y.nextPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},y.normalize=function(a,s){var c=s[0],m=s[1],_=s[2],S=c*c+m*m+_*_;return S>0&&(S=1/Math.sqrt(S)),a[0]=s[0]*S,a[1]=s[1]*S,a[2]=s[2]*S,a},y.number=Zi,y.offscreenCanvasSupported=Vn,y.ortho=function(a,s,c,m,_,S,A){var P=1/(s-c),F=1/(m-_),j=1/(S-A);return a[0]=-2*P,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*F,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*j,a[11]=0,a[12]=(s+c)*P,a[13]=(_+m)*F,a[14]=(A+S)*j,a[15]=1,a},y.parseGlyphPBF=function(a){return new fh(a).readFields(Kr,[])},y.pbf=fh,y.performSymbolLayout=function(a,s,c,m,_,S,A){a.createArrays(),a.tilePixelRatio=8192/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;var P=a.layers[0].layout,F=a.layers[0]._unevaluatedLayout._values,j={};if(a.textSizeData.kind==="composite"){var X=a.textSizeData,ee=X.maxZoom;j.compositeTextSizes=[F["text-size"].possiblyEvaluate(new Li(X.minZoom),A),F["text-size"].possiblyEvaluate(new Li(ee),A)]}if(a.iconSizeData.kind==="composite"){var fe=a.iconSizeData,xe=fe.maxZoom;j.compositeIconSizes=[F["icon-size"].possiblyEvaluate(new Li(fe.minZoom),A),F["icon-size"].possiblyEvaluate(new Li(xe),A)]}j.layoutTextSize=F["text-size"].possiblyEvaluate(new Li(a.zoom+1),A),j.layoutIconSize=F["icon-size"].possiblyEvaluate(new Li(a.zoom+1),A),j.textMaxSize=F["text-size"].possiblyEvaluate(new Li(18));for(var je=24*P.get("text-line-height"),He=P.get("text-rotation-alignment")==="map"&&P.get("symbol-placement")!=="point",pt=P.get("text-keep-upright"),nt=P.get("text-size"),kt=function(){var vr=sr[Gt],fr=P.get("text-font").evaluate(vr,{},A).join(","),Hr=nt.evaluate(vr,{},A),dn=j.layoutTextSize.evaluate(vr,{},A),Kn=j.layoutIconSize.evaluate(vr,{},A),kn={horizontal:{},vertical:void 0},ai=vr.text,In=[0,0];if(ai){var zi=ai.toString(),di=24*P.get("text-letter-spacing").evaluate(vr,{},A),Xn=function(Ki){for(var Ha=0,Fa=Ki;Ha<Fa.length;Ha+=1)if(ma=Fa[Ha].charCodeAt(0),vn.Arabic(ma)||vn["Arabic Supplement"](ma)||vn["Arabic Extended-A"](ma)||vn["Arabic Presentation Forms-A"](ma)||vn["Arabic Presentation Forms-B"](ma))return!1;var ma;return!0}(zi)?di:0,Wi=P.get("text-anchor").evaluate(vr,{},A),xi=P.get("text-variable-anchor");if(!xi){var qi=P.get("text-radial-offset").evaluate(vr,{},A);In=qi?Ou(Wi,[24*qi,Oo]):P.get("text-offset").evaluate(vr,{},A).map(function(Ki){return 24*Ki})}var Qn=He?"center":P.get("text-justify").evaluate(vr,{},A),ba=P.get("symbol-placement"),$a=ba==="point"?24*P.get("text-max-width").evaluate(vr,{},A):0,xo=function(){a.allowVerticalPlacement&&cc(zi)&&(kn.vertical=gn(ai,s,c,_,fr,$a,je,Wi,"left",Xn,In,ln.vertical,!0,ba,dn,Hr))};if(!He&&xi){for(var vo=Qn==="auto"?xi.map(function(Ki){return Ue(Ki)}):[Qn],so=!1,Lo=0;Lo<vo.length;Lo++){var cs=vo[Lo];if(!kn.horizontal[cs])if(so)kn.horizontal[cs]=kn.horizontal[0];else{var fs=gn(ai,s,c,_,fr,$a,je,"center",cs,Xn,In,ln.horizontal,!1,ba,dn,Hr);fs&&(kn.horizontal[cs]=fs,so=fs.positionedLines.length===1)}}xo()}else{Qn==="auto"&&(Qn=Ue(Wi));var $s=gn(ai,s,c,_,fr,$a,je,Wi,Qn,Xn,In,ln.horizontal,!1,ba,dn,Hr);$s&&(kn.horizontal[Qn]=$s),xo(),cc(zi)&&He&&pt&&(kn.vertical=gn(ai,s,c,_,fr,$a,je,Wi,Qn,Xn,In,ln.vertical,!1,ba,dn,Hr))}}var Es=void 0,zs=!1;if(vr.icon&&vr.icon.name){var Vo=m[vr.icon.name];Vo&&(Es=function(Ki,Ha,Fa){var ma=yn(Fa),uu=Ha[0]-Ki.displaySize[0]*ma.horizontalAlign,Zs=Ha[1]-Ki.displaySize[1]*ma.verticalAlign;return{image:Ki,top:Zs,bottom:Zs+Ki.displaySize[1],left:uu,right:uu+Ki.displaySize[0]}}(_[vr.icon.name],P.get("icon-offset").evaluate(vr,{},A),P.get("icon-anchor").evaluate(vr,{},A)),zs=Vo.sdf,a.sdfIcons===void 0?a.sdfIcons=Vo.sdf:a.sdfIcons!==Vo.sdf&&dt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Vo.pixelRatio!==a.pixelRatio||P.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0))}var Ss=Ht(kn.horizontal)||kn.vertical;a.iconsInText=!!Ss&&Ss.iconsInText,(Ss||Es)&&function(Ki,Ha,Fa,ma,uu,Zs,eo,jo,Us,Ea,Ql){var Hu=Zs.textMaxSize.evaluate(Ha,{});Hu===void 0&&(Hu=eo);var wc,Go=Ki.layers[0].layout,Cc=Go.get("icon-offset").evaluate(Ha,{},Ql),Al=Ht(Fa.horizontal),Vh=eo/24,dh=Ki.tilePixelRatio*Vh,vh=Ki.tilePixelRatio*Hu/24,af=Ki.tilePixelRatio*jo,jh=Ki.tilePixelRatio*Go.get("symbol-spacing"),od=Go.get("text-padding")*Ki.tilePixelRatio,Rf=Go.get("icon-padding")*Ki.tilePixelRatio,bp=Go.get("text-max-angle")/180*Math.PI,sd=Go.get("text-rotation-alignment")==="map"&&Go.get("symbol-placement")!=="point",Ep=Go.get("icon-rotation-alignment")==="map"&&Go.get("symbol-placement")!=="point",Ac=Go.get("symbol-placement"),Sp=jh/2,Wu=Go.get("icon-text-fit");ma&&Wu!=="none"&&(Ki.allowVerticalPlacement&&Fa.vertical&&(wc=Si(ma,Fa.vertical,Wu,Go.get("icon-text-fit-padding"),Cc,Vh)),Al&&(ma=Si(ma,Al,Wu,Go.get("icon-text-fit-padding"),Cc,Vh)));var of=function(yg,Mp){Mp.x<0||Mp.x>=8192||Mp.y<0||Mp.y>=8192||function(qo,Tc,_g,yh,Fv,V0,Xd,sf,$d,pd,Yd,dd,Bv,j0,vd,G0,H0,W0,X0,$0,nl,qd,Y0,uf,Kd){var q0,qh,kp,Ip,Pp,Rp=qo.addToLineVertexArray(Tc,_g),K0=0,Q0=0,J0=0,em=0,Nv=-1,zv=-1,Lf={},md=Ze(""),Qd=0,gd=0;if(sf._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Qd=(q0=sf.layout.get("text-offset").evaluate(nl,{},uf).map(function(Lp){return 24*Lp}))[0],gd=q0[1]):(Qd=24*sf.layout.get("text-radial-offset").evaluate(nl,{},uf),gd=Oo),qo.allowVerticalPlacement&&yh.vertical){var Jd=sf.layout.get("text-rotate").evaluate(nl,{},uf)+90;Ip=new Uo($d,Tc,pd,Yd,dd,yh.vertical,Bv,j0,vd,Jd),Xd&&(Pp=new Uo($d,Tc,pd,Yd,dd,Xd,H0,W0,vd,Jd))}if(Fv){var Mc=sf.layout.get("icon-rotate").evaluate(nl,{}),Df=sf.layout.get("icon-text-fit")!=="none",ev=as(Fv,Mc,Y0,Df),yd=Xd?as(Xd,Mc,Y0,Df):void 0;kp=new Uo($d,Tc,pd,Yd,dd,Fv,H0,W0,!1,Mc),K0=4*ev.length;var tv=qo.iconSizeData,_h=null;tv.kind==="source"?(_h=[128*sf.layout.get("icon-size").evaluate(nl,{})])[0]>32640&&dt(qo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):tv.kind==="composite"&&((_h=[128*qd.compositeIconSizes[0].evaluate(nl,{},uf),128*qd.compositeIconSizes[1].evaluate(nl,{},uf)])[0]>32640||_h[1]>32640)&&dt(qo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),qo.addSymbols(qo.icon,ev,_h,$0,X0,nl,!1,Tc,Rp.lineStartIndex,Rp.lineLength,-1,uf),Nv=qo.icon.placedSymbolArray.length-1,yd&&(Q0=4*yd.length,qo.addSymbols(qo.icon,yd,_h,$0,X0,nl,ln.vertical,Tc,Rp.lineStartIndex,Rp.lineLength,-1,uf),zv=qo.icon.placedSymbolArray.length-1)}for(var rv in yh.horizontal){var _d=yh.horizontal[rv];if(!qh){md=Ze(_d.text);var tm=sf.layout.get("text-rotate").evaluate(nl,{},uf);qh=new Uo($d,Tc,pd,Yd,dd,_d,Bv,j0,vd,tm)}var Zv=_d.positionedLines.length===1;if(J0+=cr(qo,Tc,_d,V0,sf,vd,nl,G0,Rp,yh.vertical?ln.horizontal:ln.horizontalOnly,Zv?Object.keys(yh.horizontal):[rv],Lf,Nv,qd,uf),Zv)break}yh.vertical&&(em+=cr(qo,Tc,yh.vertical,V0,sf,vd,nl,G0,Rp,ln.vertical,["vertical"],Lf,zv,qd,uf));var Op=qh?qh.boxStartIndex:qo.collisionBoxArray.length,lu=qh?qh.boxEndIndex:qo.collisionBoxArray.length,Uv=Ip?Ip.boxStartIndex:qo.collisionBoxArray.length,Vv=Ip?Ip.boxEndIndex:qo.collisionBoxArray.length,jv=kp?kp.boxStartIndex:qo.collisionBoxArray.length,nv=kp?kp.boxEndIndex:qo.collisionBoxArray.length,Gv=Pp?Pp.boxStartIndex:qo.collisionBoxArray.length,rm=Pp?Pp.boxEndIndex:qo.collisionBoxArray.length,kc=-1,xd=function(Lp,Wv){return Lp&&Lp.circleDiameter?Math.max(Lp.circleDiameter,Wv):Wv};kc=xd(qh,kc),kc=xd(Ip,kc),kc=xd(kp,kc);var Hv=(kc=xd(Pp,kc))>-1?1:0;Hv&&(kc*=Kd/24),qo.glyphOffsetArray.length>=qe.MAX_GLYPHS&&dt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),nl.sortKey!==void 0&&qo.addToSortKeyRanges(qo.symbolInstances.length,nl.sortKey),qo.symbolInstances.emplaceBack(Tc.x,Tc.y,Lf.right>=0?Lf.right:-1,Lf.center>=0?Lf.center:-1,Lf.left>=0?Lf.left:-1,Lf.vertical||-1,Nv,zv,md,Op,lu,Uv,Vv,jv,nv,Gv,rm,pd,J0,em,K0,Q0,Hv,0,Bv,Qd,gd,kc)}(Ki,Mp,yg,Fa,ma,uu,wc,Ki.layers[0],Ki.collisionBoxArray,Ha.index,Ha.sourceLayerIndex,Ki.index,dh,od,sd,Us,af,Rf,Ep,Cc,Ha,Zs,Ea,Ql,eo)};if(Ac==="line")for(var mh=0,ud=_o(Ha.geometry,0,0,8192,8192);mh<ud.length;mh+=1)for(var ld=ud[mh],Gh=0,wp=Zo(ld,jh,bp,Fa.vertical||Al,ma,24,vh,Ki.overscaling,8192);Gh<wp.length;Gh+=1){var cd=wp[Gh];Al&&Rn(Ki,Al.text,Sp,cd)||of(ld,cd)}else if(Ac==="line-center")for(var Hh=0,Wh=Ha.geometry;Hh<Wh.length;Hh+=1){var Cp=Wh[Hh];if(Cp.length>1){var Ap=Xa(Cp,bp,Fa.vertical||Al,ma,24,vh);Ap&&of(Cp,Ap)}}else if(Ha.type==="Polygon")for(var gh=0,fd=rh(Ha.geometry,0);gh<fd.length;gh+=1){var Xh=fd[gh],Tp=_i(Xh,16);of(Xh[0],new fn(Tp.x,Tp.y,0))}else if(Ha.type==="LineString")for(var Of=0,$h=Ha.geometry;Of<$h.length;Of+=1){var Yh=$h[Of];of(Yh,new fn(Yh[0].x,Yh[0].y,0))}else if(Ha.type==="Point")for(var Wd=0,Dv=Ha.geometry;Wd<Dv.length;Wd+=1)for(var ra=0,na=Dv[Wd];ra<na.length;ra+=1){var hd=na[ra];of([hd],new fn(hd.x,hd.y,0))}}(a,vr,kn,Es,m,j,dn,Kn,In,zs,A)},Gt=0,sr=a.features;Gt<sr.length;Gt+=1)kt();S&&a.generateCollisionDebugBuffers()},y.perspective=function(a,s,c,m,_){var S,A=1/Math.tan(s/2);return a[0]=A/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=A,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,_!=null&&_!==1/0?(a[10]=(_+m)*(S=1/(m-_)),a[14]=2*_*m*S):(a[10]=-1,a[14]=-2*m),a},y.pick=function(a,s){for(var c={},m=0;m<s.length;m++){var _=s[m];_ in a&&(c[_]=a[_])}return c},y.plugin=ms,y.polygonIntersectsPolygon=Iu,y.postMapLoadEvent=tt,y.postTurnstileEvent=Xt,y.potpack=Xr,y.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],y.register=Fn,y.registerForPluginStateChange=function(a){return a({pluginStatus:Ls,pluginURL:hu}),Ef.on("pluginStateChange",a),a},y.renderColorRamp=Yf,y.rotate=function(a,s,c){var m=s[0],_=s[1],S=s[2],A=s[3],P=Math.sin(c),F=Math.cos(c);return a[0]=m*F+S*P,a[1]=_*F+A*P,a[2]=m*-P+S*F,a[3]=_*-P+A*F,a},y.rotateX=function(a,s,c){var m=Math.sin(c),_=Math.cos(c),S=s[4],A=s[5],P=s[6],F=s[7],j=s[8],X=s[9],ee=s[10],fe=s[11];return s!==a&&(a[0]=s[0],a[1]=s[1],a[2]=s[2],a[3]=s[3],a[12]=s[12],a[13]=s[13],a[14]=s[14],a[15]=s[15]),a[4]=S*_+j*m,a[5]=A*_+X*m,a[6]=P*_+ee*m,a[7]=F*_+fe*m,a[8]=j*_-S*m,a[9]=X*_-A*m,a[10]=ee*_-P*m,a[11]=fe*_-F*m,a},y.rotateZ=function(a,s,c){var m=Math.sin(c),_=Math.cos(c),S=s[0],A=s[1],P=s[2],F=s[3],j=s[4],X=s[5],ee=s[6],fe=s[7];return s!==a&&(a[8]=s[8],a[9]=s[9],a[10]=s[10],a[11]=s[11],a[12]=s[12],a[13]=s[13],a[14]=s[14],a[15]=s[15]),a[0]=S*_+j*m,a[1]=A*_+X*m,a[2]=P*_+ee*m,a[3]=F*_+fe*m,a[4]=j*_-S*m,a[5]=X*_-A*m,a[6]=ee*_-P*m,a[7]=fe*_-F*m,a},y.scale=function(a,s,c){var m=c[0],_=c[1],S=c[2];return a[0]=s[0]*m,a[1]=s[1]*m,a[2]=s[2]*m,a[3]=s[3]*m,a[4]=s[4]*_,a[5]=s[5]*_,a[6]=s[6]*_,a[7]=s[7]*_,a[8]=s[8]*S,a[9]=s[9]*S,a[10]=s[10]*S,a[11]=s[11]*S,a[12]=s[12],a[13]=s[13],a[14]=s[14],a[15]=s[15],a},y.scale$1=function(a,s,c){return a[0]=s[0]*c,a[1]=s[1]*c,a[2]=s[2]*c,a[3]=s[3]*c,a},y.scale$2=function(a,s,c){return a[0]=s[0]*c,a[1]=s[1]*c,a[2]=s[2]*c,a},y.setCacheLimits=function(a,s){It=a,mr=s},y.setRTLTextPlugin=function(a,s,c){if(c===void 0&&(c=!1),Ls==="deferred"||Ls==="loading"||Ls==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");hu=Pn.resolveURL(a),Ls="deferred",Vu=s,Uc(),c||ru()},y.sphericalToCartesian=function(a){var s=a[0],c=a[1],m=a[2];return c+=90,c*=Math.PI/180,m*=Math.PI/180,{x:s*Math.cos(c)*Math.sin(m),y:s*Math.sin(c)*Math.sin(m),z:s*Math.cos(m)}},y.sqrLen=function(a){var s=a[0],c=a[1];return s*s+c*c},y.styleSpec=Ce,y.sub=function(a,s,c){return a[0]=s[0]-c[0],a[1]=s[1]-c[1],a[2]=s[2]-c[2],a},y.symbolSize=Vi,y.transformMat3=function(a,s,c){var m=s[0],_=s[1],S=s[2];return a[0]=m*c[0]+_*c[3]+S*c[6],a[1]=m*c[1]+_*c[4]+S*c[7],a[2]=m*c[2]+_*c[5]+S*c[8],a},y.transformMat4=qc,y.translate=function(a,s,c){var m,_,S,A,P,F,j,X,ee,fe,xe,je,He=c[0],pt=c[1],nt=c[2];return s===a?(a[12]=s[0]*He+s[4]*pt+s[8]*nt+s[12],a[13]=s[1]*He+s[5]*pt+s[9]*nt+s[13],a[14]=s[2]*He+s[6]*pt+s[10]*nt+s[14],a[15]=s[3]*He+s[7]*pt+s[11]*nt+s[15]):(_=s[1],S=s[2],A=s[3],P=s[4],F=s[5],j=s[6],X=s[7],ee=s[8],fe=s[9],xe=s[10],je=s[11],a[0]=m=s[0],a[1]=_,a[2]=S,a[3]=A,a[4]=P,a[5]=F,a[6]=j,a[7]=X,a[8]=ee,a[9]=fe,a[10]=xe,a[11]=je,a[12]=m*He+P*pt+ee*nt+s[12],a[13]=_*He+F*pt+fe*nt+s[13],a[14]=S*He+j*pt+xe*nt+s[14],a[15]=A*He+X*pt+je*nt+s[15]),a},y.triggerPluginCompletionEvent=bf,y.uniqueId=zt,y.validateCustomStyleLayer=function(a){var s=[],c=a.id;return c===void 0&&s.push({message:"layers."+c+': missing required property "id"'}),a.render===void 0&&s.push({message:"layers."+c+': missing required method "render"'}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&s.push({message:"layers."+c+': property "renderingMode" must be either "2d" or "3d"'}),s},y.validateLight=Cu,y.validateStyle=ks,y.values=function(a){var s=[];for(var c in a)s.push(a[c]);return s},y.vectorTile=bu,y.version="1.13.2",y.warnOnce=dt,y.webpSupported=wn,y.window=_e,y.wrap=ur}),ne(["./shared"],function(y){"use strict";function Te(Q){var ae=typeof Q;if(ae==="number"||ae==="boolean"||ae==="string"||Q==null)return JSON.stringify(Q);if(Array.isArray(Q)){for(var me="[",Me=0,Ve=Q;Me<Ve.length;Me+=1)me+=Te(Ve[Me])+",";return me+"]"}for(var at=Object.keys(Q).sort(),_t="{",Ce=0;Ce<at.length;Ce++)_t+=JSON.stringify(at[Ce])+":"+Te(Q[at[Ce]])+",";return _t+"}"}function W(Q){for(var ae="",me=0,Me=y.refProperties;me<Me.length;me+=1)ae+="/"+Te(Q[Me[me]]);return ae}var ye=function(Q){this.keyCache={},Q&&this.replace(Q)};ye.prototype.replace=function(Q){this._layerConfigs={},this._layers={},this.update(Q,[])},ye.prototype.update=function(Q,ae){for(var me=this,Me=0,Ve=Q;Me<Ve.length;Me+=1){var at=Ve[Me];this._layerConfigs[at.id]=at;var _t=this._layers[at.id]=y.createStyleLayer(at);_t._featureFilter=y.featureFilter(_t.filter),this.keyCache[at.id]&&delete this.keyCache[at.id]}for(var Ce=0,$e=ae;Ce<$e.length;Ce+=1){var Zt=$e[Ce];delete this.keyCache[Zt],delete this._layerConfigs[Zt],delete this._layers[Zt]}this.familiesBySource={};for(var Rr=0,nr=function(hr,St){for(var Ei={},mn=0;mn<hr.length;mn++){var Oi=St&&St[hr[mn].id]||W(hr[mn]);St&&(St[hr[mn].id]=Oi);var ua=Ei[Oi];ua||(ua=Ei[Oi]=[]),ua.push(hr[mn])}var xt=[];for(var wt in Ei)xt.push(Ei[wt]);return xt}(y.values(this._layerConfigs),this.keyCache);Rr<nr.length;Rr+=1){var lr=nr[Rr].map(function(hr){return me._layers[hr.id]}),Lr=lr[0];if(Lr.visibility!=="none"){var Dn=Lr.source||"",Mn=this.familiesBySource[Dn];Mn||(Mn=this.familiesBySource[Dn]={});var $t=Lr.sourceLayer||"_geojsonTileLayer",Cn=Mn[$t];Cn||(Cn=Mn[$t]=[]),Cn.push(lr)}}};var se=function(Q){var ae={},me=[];for(var Me in Q){var Ve=Q[Me],at=ae[Me]={};for(var _t in Ve){var Ce=Ve[+_t];if(Ce&&Ce.bitmap.width!==0&&Ce.bitmap.height!==0){var $e={x:0,y:0,w:Ce.bitmap.width+2,h:Ce.bitmap.height+2};me.push($e),at[_t]={rect:$e,metrics:Ce.metrics}}}}var Zt=y.potpack(me),Rr=new y.AlphaImage({width:Zt.w||1,height:Zt.h||1});for(var nr in Q){var lr=Q[nr];for(var Lr in lr){var Dn=lr[+Lr];if(Dn&&Dn.bitmap.width!==0&&Dn.bitmap.height!==0){var Mn=ae[nr][Lr].rect;y.AlphaImage.copy(Dn.bitmap,Rr,{x:0,y:0},{x:Mn.x+1,y:Mn.y+1},Dn.bitmap)}}}this.image=Rr,this.positions=ae};y.register("GlyphAtlas",se);var Ye=function(Q){this.tileID=new y.OverscaledTileID(Q.tileID.overscaledZ,Q.tileID.wrap,Q.tileID.canonical.z,Q.tileID.canonical.x,Q.tileID.canonical.y),this.uid=Q.uid,this.zoom=Q.zoom,this.pixelRatio=Q.pixelRatio,this.tileSize=Q.tileSize,this.source=Q.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Q.showCollisionBoxes,this.collectResourceTiming=!!Q.collectResourceTiming,this.returnDependencies=!!Q.returnDependencies,this.promoteId=Q.promoteId};function _e(Q,ae,me){for(var Me=new y.EvaluationParameters(ae),Ve=0,at=Q;Ve<at.length;Ve+=1)at[Ve].recalculate(Me,me)}function Qe(Q,ae){var me=y.getArrayBuffer(Q.request,function(Me,Ve,at,_t){Me?ae(Me):Ve&&ae(null,{vectorTile:new y.vectorTile.VectorTile(new y.pbf(Ve)),rawData:Ve,cacheControl:at,expires:_t})});return function(){me.cancel(),ae()}}Ye.prototype.parse=function(Q,ae,me,Me,Ve){var at=this;this.status="parsing",this.data=Q,this.collisionBoxArray=new y.CollisionBoxArray;var _t=new y.DictionaryCoder(Object.keys(Q.layers).sort()),Ce=new y.FeatureIndex(this.tileID,this.promoteId);Ce.bucketLayerIDs=[];var $e,Zt,Rr,nr,lr={},Lr={featureIndex:Ce,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:me},Dn=ae.familiesBySource[this.source];for(var Mn in Dn){var $t=Q.layers[Mn];if($t){$t.version===1&&y.warnOnce('Vector tile source "'+this.source+'" layer "'+Mn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var Cn=_t.encode(Mn),hr=[],St=0;St<$t.length;St++){var Ei=$t.feature(St),mn=Ce.getId(Ei,Mn);hr.push({feature:Ei,id:mn,index:St,sourceLayerIndex:Cn})}for(var Oi=0,ua=Dn[Mn];Oi<ua.length;Oi+=1){var xt=ua[Oi],wt=xt[0];wt.minzoom&&this.zoom<Math.floor(wt.minzoom)||wt.maxzoom&&this.zoom>=wt.maxzoom||wt.visibility!=="none"&&(_e(xt,this.zoom,me),(lr[wt.id]=wt.createBucket({index:Ce.bucketLayerIDs.length,layers:xt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Cn,sourceID:this.source})).populate(hr,Lr,this.tileID.canonical),Ce.bucketLayerIDs.push(xt.map(function(la){return la.id})))}}}var Ri=y.mapObject(Lr.glyphDependencies,function(la){return Object.keys(la).map(Number)});Object.keys(Ri).length?Me.send("getGlyphs",{uid:this.uid,stacks:Ri},function(la,Di){$e||($e=la,Zt=Di,ea.call(at))}):Zt={};var pi=Object.keys(Lr.iconDependencies);pi.length?Me.send("getImages",{icons:pi,source:this.source,tileID:this.tileID,type:"icons"},function(la,Di){$e||($e=la,Rr=Di,ea.call(at))}):Rr={};var Ji=Object.keys(Lr.patternDependencies);function ea(){if($e)return Ve($e);if(Zt&&Rr&&nr){var la=new se(Zt),Di=new y.ImageAtlas(Rr,nr);for(var gr in lr){var Cr=lr[gr];Cr instanceof y.SymbolBucket?(_e(Cr.layers,this.zoom,me),y.performSymbolLayout(Cr,Zt,la.positions,Rr,Di.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Cr.hasPattern&&(Cr instanceof y.LineBucket||Cr instanceof y.FillBucket||Cr instanceof y.FillExtrusionBucket)&&(_e(Cr.layers,this.zoom,me),Cr.addFeatures(Lr,this.tileID.canonical,Di.patternPositions))}this.status="done",Ve(null,{buckets:y.values(lr).filter(function(rt){return!rt.isEmpty()}),featureIndex:Ce,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:la.image,imageAtlas:Di,glyphMap:this.returnDependencies?Zt:null,iconMap:this.returnDependencies?Rr:null,glyphPositions:this.returnDependencies?la.positions:null})}}Ji.length?Me.send("getImages",{icons:Ji,source:this.source,tileID:this.tileID,type:"patterns"},function(la,Di){$e||($e=la,nr=Di,ea.call(at))}):nr={},ea.call(this)};var lt=function(Q,ae,me,Me){this.actor=Q,this.layerIndex=ae,this.availableImages=me,this.loadVectorData=Me||Qe,this.loading={},this.loaded={}};lt.prototype.loadTile=function(Q,ae){var me=this,Me=Q.uid;this.loading||(this.loading={});var Ve=!!(Q&&Q.request&&Q.request.collectResourceTiming)&&new y.RequestPerformance(Q.request),at=this.loading[Me]=new Ye(Q);at.abort=this.loadVectorData(Q,function(_t,Ce){if(delete me.loading[Me],_t||!Ce)return at.status="done",me.loaded[Me]=at,ae(_t);var $e=Ce.rawData,Zt={};Ce.expires&&(Zt.expires=Ce.expires),Ce.cacheControl&&(Zt.cacheControl=Ce.cacheControl);var Rr={};if(Ve){var nr=Ve.finish();nr&&(Rr.resourceTiming=JSON.parse(JSON.stringify(nr)))}at.vectorTile=Ce.vectorTile,at.parse(Ce.vectorTile,me.layerIndex,me.availableImages,me.actor,function(lr,Lr){if(lr||!Lr)return ae(lr);ae(null,y.extend({rawTileData:$e.slice(0)},Lr,Zt,Rr))}),me.loaded=me.loaded||{},me.loaded[Me]=at})},lt.prototype.reloadTile=function(Q,ae){var me=this,Me=this.loaded,Ve=Q.uid,at=this;if(Me&&Me[Ve]){var _t=Me[Ve];_t.showCollisionBoxes=Q.showCollisionBoxes;var Ce=function($e,Zt){var Rr=_t.reloadCallback;Rr&&(delete _t.reloadCallback,_t.parse(_t.vectorTile,at.layerIndex,me.availableImages,at.actor,Rr)),ae($e,Zt)};_t.status==="parsing"?_t.reloadCallback=Ce:_t.status==="done"&&(_t.vectorTile?_t.parse(_t.vectorTile,this.layerIndex,this.availableImages,this.actor,Ce):Ce())}},lt.prototype.abortTile=function(Q,ae){var me=this.loading,Me=Q.uid;me&&me[Me]&&me[Me].abort&&(me[Me].abort(),delete me[Me]),ae()},lt.prototype.removeTile=function(Q,ae){var me=this.loaded,Me=Q.uid;me&&me[Me]&&delete me[Me],ae()};var bt=y.window.ImageBitmap,gt=function(){this.loaded={}};function ur(Q,ae){if(Q.length!==0){Mt(Q[0],ae);for(var me=1;me<Q.length;me++)Mt(Q[me],!ae)}}function Mt(Q,ae){for(var me=0,Me=0,Ve=Q.length,at=Ve-1;Me<Ve;at=Me++)me+=(Q[Me][0]-Q[at][0])*(Q[at][1]+Q[Me][1]);me>=0!=!!ae&&Q.reverse()}gt.prototype.loadTile=function(Q,ae){var me=Q.uid,Me=Q.encoding,Ve=Q.rawImageData,at=bt&&Ve instanceof bt?this.getImageData(Ve):Ve,_t=new y.DEMData(me,at,Me);this.loaded=this.loaded||{},this.loaded[me]=_t,ae(null,_t)},gt.prototype.getImageData=function(Q){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Q.width,Q.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=Q.width,this.offscreenCanvas.height=Q.height,this.offscreenCanvasContext.drawImage(Q,0,0,Q.width,Q.height);var ae=this.offscreenCanvasContext.getImageData(-1,-1,Q.width+2,Q.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new y.RGBAImage({width:ae.width,height:ae.height},ae.data)},gt.prototype.removeTile=function(Q){var ae=this.loaded,me=Q.uid;ae&&ae[me]&&delete ae[me]};var qt=y.vectorTile.VectorTileFeature.prototype.toGeoJSON,zt=function(Q){this._feature=Q,this.extent=y.EXTENT,this.type=Q.type,this.properties=Q.tags,"id"in Q&&!isNaN(Q.id)&&(this.id=parseInt(Q.id,10))};zt.prototype.loadGeometry=function(){if(this._feature.type===1){for(var Q=[],ae=0,me=this._feature.geometry;ae<me.length;ae+=1){var Me=me[ae];Q.push([new y.Point$1(Me[0],Me[1])])}return Q}for(var Ve=[],at=0,_t=this._feature.geometry;at<_t.length;at+=1){for(var Ce=[],$e=0,Zt=_t[at];$e<Zt.length;$e+=1){var Rr=Zt[$e];Ce.push(new y.Point$1(Rr[0],Rr[1]))}Ve.push(Ce)}return Ve},zt.prototype.toGeoJSON=function(Q,ae,me){return qt.call(this,Q,ae,me)};var yt=function(Q){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=y.EXTENT,this.length=Q.length,this._features=Q};yt.prototype.feature=function(Q){return new zt(this._features[Q])};var At=y.vectorTile.VectorTileFeature,ar=J;function J(Q,ae){this.options=ae||{},this.features=Q,this.length=Q.length}function Qt(Q,ae){this.id=typeof Q.id=="number"?Q.id:void 0,this.type=Q.type,this.rawGeometry=Q.type===1?[Q.geometry]:Q.geometry,this.properties=Q.tags,this.extent=ae||4096}J.prototype.feature=function(Q){return new Qt(this.features[Q],this.options.extent)},Qt.prototype.loadGeometry=function(){var Q=this.rawGeometry;this.geometry=[];for(var ae=0;ae<Q.length;ae++){for(var me=Q[ae],Me=[],Ve=0;Ve<me.length;Ve++)Me.push(new y.Point$1(me[Ve][0],me[Ve][1]));this.geometry.push(Me)}return this.geometry},Qt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Q=this.geometry,ae=1/0,me=-1/0,Me=1/0,Ve=-1/0,at=0;at<Q.length;at++)for(var _t=Q[at],Ce=0;Ce<_t.length;Ce++){var $e=_t[Ce];ae=Math.min(ae,$e.x),me=Math.max(me,$e.x),Me=Math.min(Me,$e.y),Ve=Math.max(Ve,$e.y)}return[ae,Me,me,Ve]},Qt.prototype.toGeoJSON=At.prototype.toGeoJSON;var Ct=Ut,ft=ar;function Ut(Q){var ae=new y.pbf;return function(me,Me){for(var Ve in me.layers)Me.writeMessage(3,dt,me.layers[Ve])}(Q,ae),ae.finish()}function dt(Q,ae){var me;ae.writeVarintField(15,Q.version||1),ae.writeStringField(1,Q.name||""),ae.writeVarintField(5,Q.extent||4096);var Me={keys:[],values:[],keycache:{},valuecache:{}};for(me=0;me<Q.length;me++)Me.feature=Q.feature(me),ae.writeMessage(2,rr,Me);var Ve=Me.keys;for(me=0;me<Ve.length;me++)ae.writeStringField(3,Ve[me]);var at=Me.values;for(me=0;me<at.length;me++)ae.writeMessage(4,z,at[me])}function rr(Q,ae){var me=Q.feature;me.id!==void 0&&ae.writeVarintField(1,me.id),ae.writeMessage(2,wr,Q),ae.writeVarintField(3,me.type),ae.writeMessage(4,N,me)}function wr(Q,ae){var me=Q.feature,Me=Q.keys,Ve=Q.values,at=Q.keycache,_t=Q.valuecache;for(var Ce in me.properties){var $e=at[Ce];$e===void 0&&(Me.push(Ce),at[Ce]=$e=Me.length-1),ae.writeVarint($e);var Zt=me.properties[Ce],Rr=typeof Zt;Rr!=="string"&&Rr!=="boolean"&&Rr!=="number"&&(Zt=JSON.stringify(Zt));var nr=Rr+":"+Zt,lr=_t[nr];lr===void 0&&(Ve.push(Zt),_t[nr]=lr=Ve.length-1),ae.writeVarint(lr)}}function re(Q,ae){return(ae<<3)+(7&Q)}function Fe(Q){return Q<<1^Q>>31}function N(Q,ae){for(var me=Q.loadGeometry(),Me=Q.type,Ve=0,at=0,_t=me.length,Ce=0;Ce<_t;Ce++){var $e=me[Ce],Zt=1;Me===1&&(Zt=$e.length),ae.writeVarint(re(1,Zt));for(var Rr=Me===3?$e.length-1:$e.length,nr=0;nr<Rr;nr++){nr===1&&Me!==1&&ae.writeVarint(re(2,Rr-1));var lr=$e[nr].x-Ve,Lr=$e[nr].y-at;ae.writeVarint(Fe(lr)),ae.writeVarint(Fe(Lr)),Ve+=lr,at+=Lr}Me===3&&ae.writeVarint(re(7,1))}}function z(Q,ae){var me=typeof Q;me==="string"?ae.writeStringField(1,Q):me==="boolean"?ae.writeBooleanField(7,Q):me==="number"&&(Q%1!=0?ae.writeDoubleField(3,Q):Q<0?ae.writeSVarintField(6,Q):ae.writeVarintField(5,Q))}function ce(Q,ae,me,Me){ze(Q,me,Me),ze(ae,2*me,2*Me),ze(ae,2*me+1,2*Me+1)}function ze(Q,ae,me){var Me=Q[ae];Q[ae]=Q[me],Q[me]=Me}function et(Q,ae,me,Me){var Ve=Q-me,at=ae-Me;return Ve*Ve+at*at}Ct.fromVectorTileJs=Ut,Ct.fromGeojsonVt=function(Q,ae){ae=ae||{};var me={};for(var Me in Q)me[Me]=new ar(Q[Me].features,ae),me[Me].name=Me,me[Me].version=ae.version,me[Me].extent=ae.extent;return Ut({layers:me})},Ct.GeoJSONWrapper=ft;var ht=function(Q){return Q[0]},Rt=function(Q){return Q[1]},Jt=function(Q,ae,me,Me,Ve){ae===void 0&&(ae=ht),me===void 0&&(me=Rt),Me===void 0&&(Me=64),Ve===void 0&&(Ve=Float64Array),this.nodeSize=Me,this.points=Q;for(var at=Q.length<65536?Uint16Array:Uint32Array,_t=this.ids=new at(Q.length),Ce=this.coords=new Ve(2*Q.length),$e=0;$e<Q.length;$e++)_t[$e]=$e,Ce[2*$e]=ae(Q[$e]),Ce[2*$e+1]=me(Q[$e]);(function Zt(Rr,nr,lr,Lr,Dn,Mn){if(!(Dn-Lr<=lr)){var $t=Lr+Dn>>1;(function Cn(hr,St,Ei,mn,Oi,ua){for(;Oi>mn;){if(Oi-mn>600){var xt=Oi-mn+1,wt=Ei-mn+1,Ri=Math.log(xt),pi=.5*Math.exp(2*Ri/3),Ji=.5*Math.sqrt(Ri*pi*(xt-pi)/xt)*(wt-xt/2<0?-1:1);Cn(hr,St,Ei,Math.max(mn,Math.floor(Ei-wt*pi/xt+Ji)),Math.min(Oi,Math.floor(Ei+(xt-wt)*pi/xt+Ji)),ua)}var ea=St[2*Ei+ua],la=mn,Di=Oi;for(ce(hr,St,mn,Ei),St[2*Oi+ua]>ea&&ce(hr,St,mn,Oi);la<Di;){for(ce(hr,St,la,Di),la++,Di--;St[2*la+ua]<ea;)la++;for(;St[2*Di+ua]>ea;)Di--}St[2*mn+ua]===ea?ce(hr,St,mn,Di):ce(hr,St,++Di,Oi),Di<=Ei&&(mn=Di+1),Ei<=Di&&(Oi=Di-1)}})(Rr,nr,$t,Lr,Dn,Mn%2),Zt(Rr,nr,lr,Lr,$t-1,Mn+1),Zt(Rr,nr,lr,$t+1,Dn,Mn+1)}})(_t,Ce,Me,0,_t.length-1,0)};Jt.prototype.range=function(Q,ae,me,Me){return function(Ve,at,_t,Ce,$e,Zt,Rr){for(var nr,lr,Lr=[0,Ve.length-1,0],Dn=[];Lr.length;){var Mn=Lr.pop(),$t=Lr.pop(),Cn=Lr.pop();if($t-Cn<=Rr)for(var hr=Cn;hr<=$t;hr++)lr=at[2*hr+1],(nr=at[2*hr])>=_t&&nr<=$e&&lr>=Ce&&lr<=Zt&&Dn.push(Ve[hr]);else{var St=Math.floor((Cn+$t)/2);lr=at[2*St+1],(nr=at[2*St])>=_t&&nr<=$e&&lr>=Ce&&lr<=Zt&&Dn.push(Ve[St]);var Ei=(Mn+1)%2;(Mn===0?_t<=nr:Ce<=lr)&&(Lr.push(Cn),Lr.push(St-1),Lr.push(Ei)),(Mn===0?$e>=nr:Zt>=lr)&&(Lr.push(St+1),Lr.push($t),Lr.push(Ei))}}return Dn}(this.ids,this.coords,Q,ae,me,Me,this.nodeSize)},Jt.prototype.within=function(Q,ae,me){return function(Me,Ve,at,_t,Ce,$e){for(var Zt=[0,Me.length-1,0],Rr=[],nr=Ce*Ce;Zt.length;){var lr=Zt.pop(),Lr=Zt.pop(),Dn=Zt.pop();if(Lr-Dn<=$e)for(var Mn=Dn;Mn<=Lr;Mn++)et(Ve[2*Mn],Ve[2*Mn+1],at,_t)<=nr&&Rr.push(Me[Mn]);else{var $t=Math.floor((Dn+Lr)/2),Cn=Ve[2*$t],hr=Ve[2*$t+1];et(Cn,hr,at,_t)<=nr&&Rr.push(Me[$t]);var St=(lr+1)%2;(lr===0?at-Ce<=Cn:_t-Ce<=hr)&&(Zt.push(Dn),Zt.push($t-1),Zt.push(St)),(lr===0?at+Ce>=Cn:_t+Ce>=hr)&&(Zt.push($t+1),Zt.push(Lr),Zt.push(St))}}return Rr}(this.ids,this.coords,Q,ae,me,this.nodeSize)};var Or={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(Q){return Q}},Tr=function(Q){this.options=ki(Object.create(Or),Q),this.trees=new Array(this.options.maxZoom+1)};function Pn(Q,ae,me,Me,Ve){return{x:Q,y:ae,zoom:1/0,id:me,parentId:-1,numPoints:Me,properties:Ve}}function Nr(Q,ae){var me=Q.geometry.coordinates,Me=me[1];return{x:mi(me[0]),y:si(Me),zoom:1/0,index:ae,parentId:-1}}function wn(Q){return{type:"Feature",id:Q.id,properties:Xi(Q),geometry:{type:"Point",coordinates:[(Me=Q.x,360*(Me-.5)),(ae=Q.y,me=(180-360*ae)*Math.PI/180,360*Math.atan(Math.exp(me))/Math.PI-90)]}};var ae,me,Me}function Xi(Q){var ae=Q.numPoints,me=ae>=1e4?Math.round(ae/1e3)+"k":ae>=1e3?Math.round(ae/100)/10+"k":ae;return ki(ki({},Q.properties),{cluster:!0,cluster_id:Q.id,point_count:ae,point_count_abbreviated:me})}function mi(Q){return Q/360+.5}function si(Q){var ae=Math.sin(Q*Math.PI/180),me=.5-.25*Math.log((1+ae)/(1-ae))/Math.PI;return me<0?0:me>1?1:me}function ki(Q,ae){for(var me in ae)Q[me]=ae[me];return Q}function bi(Q){return Q.x}function li(Q){return Q.y}function Zn(Q,ae,me,Me,Ve,at){var _t=Ve-me,Ce=at-Me;if(_t!==0||Ce!==0){var $e=((Q-me)*_t+(ae-Me)*Ce)/(_t*_t+Ce*Ce);$e>1?(me=Ve,Me=at):$e>0&&(me+=_t*$e,Me+=Ce*$e)}return(_t=Q-me)*_t+(Ce=ae-Me)*Ce}function qn(Q,ae,me,Me){var Ve={id:Q===void 0?null:Q,type:ae,geometry:me,tags:Me,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(at){var _t=at.geometry,Ce=at.type;if(Ce==="Point"||Ce==="MultiPoint"||Ce==="LineString")ro(at,_t);else if(Ce==="Polygon"||Ce==="MultiLineString")for(var $e=0;$e<_t.length;$e++)ro(at,_t[$e]);else if(Ce==="MultiPolygon")for($e=0;$e<_t.length;$e++)for(var Zt=0;Zt<_t[$e].length;Zt++)ro(at,_t[$e][Zt])}(Ve),Ve}function ro(Q,ae){for(var me=0;me<ae.length;me+=3)Q.minX=Math.min(Q.minX,ae[me]),Q.minY=Math.min(Q.minY,ae[me+1]),Q.maxX=Math.max(Q.maxX,ae[me]),Q.maxY=Math.max(Q.maxY,ae[me+1])}function ka(Q,ae,me,Me){if(ae.geometry){var Ve=ae.geometry.coordinates,at=ae.geometry.type,_t=Math.pow(me.tolerance/((1<<me.maxZoom)*me.extent),2),Ce=[],$e=ae.id;if(me.promoteId?$e=ae.properties[me.promoteId]:me.generateId&&($e=Me||0),at==="Point")oa(Ve,Ce);else if(at==="MultiPoint")for(var Zt=0;Zt<Ve.length;Zt++)oa(Ve[Zt],Ce);else if(at==="LineString")Tt(Ve,Ce,_t,!1);else if(at==="MultiLineString"){if(me.lineMetrics){for(Zt=0;Zt<Ve.length;Zt++)Tt(Ve[Zt],Ce=[],_t,!1),Q.push(qn($e,"LineString",Ce,ae.properties));return}ge(Ve,Ce,_t,!1)}else if(at==="Polygon")ge(Ve,Ce,_t,!0);else{if(at!=="MultiPolygon"){if(at==="GeometryCollection"){for(Zt=0;Zt<ae.geometry.geometries.length;Zt++)ka(Q,{id:$e,geometry:ae.geometry.geometries[Zt],properties:ae.properties},me,Me);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Zt=0;Zt<Ve.length;Zt++){var Rr=[];ge(Ve[Zt],Rr,_t,!0),Ce.push(Rr)}}Q.push(qn($e,at,Ce,ae.properties))}}function oa(Q,ae){ae.push(ue(Q[0])),ae.push(we(Q[1])),ae.push(0)}function Tt(Q,ae,me,Me){for(var Ve,at,_t=0,Ce=0;Ce<Q.length;Ce++){var $e=ue(Q[Ce][0]),Zt=we(Q[Ce][1]);ae.push($e),ae.push(Zt),ae.push(0),Ce>0&&(_t+=Me?(Ve*Zt-$e*at)/2:Math.sqrt(Math.pow($e-Ve,2)+Math.pow(Zt-at,2))),Ve=$e,at=Zt}var Rr=ae.length-3;ae[2]=1,function nr(lr,Lr,Dn,Mn){for(var $t,Cn=Mn,hr=Dn-Lr>>1,St=Dn-Lr,Ei=lr[Lr],mn=lr[Lr+1],Oi=lr[Dn],ua=lr[Dn+1],xt=Lr+3;xt<Dn;xt+=3){var wt=Zn(lr[xt],lr[xt+1],Ei,mn,Oi,ua);if(wt>Cn)$t=xt,Cn=wt;else if(wt===Cn){var Ri=Math.abs(xt-hr);Ri<St&&($t=xt,St=Ri)}}Cn>Mn&&($t-Lr>3&&nr(lr,Lr,$t,Mn),lr[$t+2]=Cn,Dn-$t>3&&nr(lr,$t,Dn,Mn))}(ae,0,Rr,me),ae[Rr+2]=1,ae.size=Math.abs(_t),ae.start=0,ae.end=ae.size}function ge(Q,ae,me,Me){for(var Ve=0;Ve<Q.length;Ve++){var at=[];Tt(Q[Ve],at,me,Me),ae.push(at)}}function ue(Q){return Q/360+.5}function we(Q){var ae=Math.sin(Q*Math.PI/180),me=.5-.25*Math.log((1+ae)/(1-ae))/Math.PI;return me<0?0:me>1?1:me}function Z(Q,ae,me,Me,Ve,at,_t,Ce){if(Me/=ae,at>=(me/=ae)&&_t<Me)return Q;if(_t<me||at>=Me)return null;for(var $e=[],Zt=0;Zt<Q.length;Zt++){var Rr=Q[Zt],nr=Rr.geometry,lr=Rr.type,Lr=Ve===0?Rr.minX:Rr.minY,Dn=Ve===0?Rr.maxX:Rr.maxY;if(Lr>=me&&Dn<Me)$e.push(Rr);else if(!(Dn<me||Lr>=Me)){var Mn=[];if(lr==="Point"||lr==="MultiPoint")Je(nr,Mn,me,Me,Ve);else if(lr==="LineString")Xt(nr,Mn,me,Me,Ve,!1,Ce.lineMetrics);else if(lr==="MultiLineString")tt(nr,Mn,me,Me,Ve,!1);else if(lr==="Polygon")tt(nr,Mn,me,Me,Ve,!0);else if(lr==="MultiPolygon")for(var $t=0;$t<nr.length;$t++){var Cn=[];tt(nr[$t],Cn,me,Me,Ve,!0),Cn.length&&Mn.push(Cn)}if(Mn.length){if(Ce.lineMetrics&&lr==="LineString"){for($t=0;$t<Mn.length;$t++)$e.push(qn(Rr.id,lr,Mn[$t],Rr.tags));continue}lr!=="LineString"&&lr!=="MultiLineString"||(Mn.length===1?(lr="LineString",Mn=Mn[0]):lr="MultiLineString"),lr!=="Point"&&lr!=="MultiPoint"||(lr=Mn.length===3?"Point":"MultiPoint"),$e.push(qn(Rr.id,lr,Mn,Rr.tags))}}}return $e.length?$e:null}function Je(Q,ae,me,Me,Ve){for(var at=0;at<Q.length;at+=3){var _t=Q[at+Ve];_t>=me&&_t<=Me&&(ae.push(Q[at]),ae.push(Q[at+1]),ae.push(Q[at+2]))}}function Xt(Q,ae,me,Me,Ve,at,_t){for(var Ce,$e,Zt=Dr(Q),Rr=Ve===0?mr:Ir,nr=Q.start,lr=0;lr<Q.length-3;lr+=3){var Lr=Q[lr],Dn=Q[lr+1],Mn=Q[lr+2],$t=Q[lr+3],Cn=Q[lr+4],hr=Ve===0?Lr:Dn,St=Ve===0?$t:Cn,Ei=!1;_t&&(Ce=Math.sqrt(Math.pow(Lr-$t,2)+Math.pow(Dn-Cn,2))),hr<me?St>me&&($e=Rr(Zt,Lr,Dn,$t,Cn,me),_t&&(Zt.start=nr+Ce*$e)):hr>Me?St<Me&&($e=Rr(Zt,Lr,Dn,$t,Cn,Me),_t&&(Zt.start=nr+Ce*$e)):It(Zt,Lr,Dn,Mn),St<me&&hr>=me&&($e=Rr(Zt,Lr,Dn,$t,Cn,me),Ei=!0),St>Me&&hr<=Me&&($e=Rr(Zt,Lr,Dn,$t,Cn,Me),Ei=!0),!at&&Ei&&(_t&&(Zt.end=nr+Ce*$e),ae.push(Zt),Zt=Dr(Q)),_t&&(nr+=Ce)}var mn=Q.length-3;Lr=Q[mn],Dn=Q[mn+1],Mn=Q[mn+2],(hr=Ve===0?Lr:Dn)>=me&&hr<=Me&&It(Zt,Lr,Dn,Mn),mn=Zt.length-3,at&&mn>=3&&(Zt[mn]!==Zt[0]||Zt[mn+1]!==Zt[1])&&It(Zt,Zt[0],Zt[1],Zt[2]),Zt.length&&ae.push(Zt)}function Dr(Q){var ae=[];return ae.size=Q.size,ae.start=Q.start,ae.end=Q.end,ae}function tt(Q,ae,me,Me,Ve,at){for(var _t=0;_t<Q.length;_t++)Xt(Q[_t],ae,me,Me,Ve,at,!1)}function It(Q,ae,me,Me){Q.push(ae),Q.push(me),Q.push(Me)}function mr(Q,ae,me,Me,Ve,at){var _t=(at-ae)/(Me-ae);return Q.push(at),Q.push(me+(Ve-me)*_t),Q.push(1),_t}function Ir(Q,ae,me,Me,Ve,at){var _t=(at-me)/(Ve-me);return Q.push(ae+(Me-ae)*_t),Q.push(at),Q.push(1),_t}function $r(Q,ae){for(var me=[],Me=0;Me<Q.length;Me++){var Ve,at=Q[Me],_t=at.type;if(_t==="Point"||_t==="MultiPoint"||_t==="LineString")Ve=tn(at.geometry,ae);else if(_t==="MultiLineString"||_t==="Polygon"){Ve=[];for(var Ce=0;Ce<at.geometry.length;Ce++)Ve.push(tn(at.geometry[Ce],ae))}else if(_t==="MultiPolygon")for(Ve=[],Ce=0;Ce<at.geometry.length;Ce++){for(var $e=[],Zt=0;Zt<at.geometry[Ce].length;Zt++)$e.push(tn(at.geometry[Ce][Zt],ae));Ve.push($e)}me.push(qn(at.id,_t,Ve,at.tags))}return me}function tn(Q,ae){var me=[];me.size=Q.size,Q.start!==void 0&&(me.start=Q.start,me.end=Q.end);for(var Me=0;Me<Q.length;Me+=3)me.push(Q[Me]+ae,Q[Me+1],Q[Me+2]);return me}function $n(Q,ae){if(Q.transformed)return Q;var me,Me,Ve,at=1<<Q.z,_t=Q.x,Ce=Q.y;for(me=0;me<Q.features.length;me++){var $e=Q.features[me],Zt=$e.geometry,Rr=$e.type;if($e.geometry=[],Rr===1)for(Me=0;Me<Zt.length;Me+=2)$e.geometry.push(Vn(Zt[Me],Zt[Me+1],ae,at,_t,Ce));else for(Me=0;Me<Zt.length;Me++){var nr=[];for(Ve=0;Ve<Zt[Me].length;Ve+=2)nr.push(Vn(Zt[Me][Ve],Zt[Me][Ve+1],ae,at,_t,Ce));$e.geometry.push(nr)}}return Q.transformed=!0,Q}function Vn(Q,ae,me,Me,Ve,at){return[Math.round(me*(Q*Me-Ve)),Math.round(me*(ae*Me-at))]}function rn(Q,ae,me,Me,Ve){for(var at=ae===Ve.maxZoom?0:Ve.tolerance/((1<<ae)*Ve.extent),_t={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:me,y:Me,z:ae,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ce=0;Ce<Q.length;Ce++){_t.numFeatures++,vi(_t,Q[Ce],at,Ve);var $e=Q[Ce].minX,Zt=Q[Ce].minY,Rr=Q[Ce].maxX,nr=Q[Ce].maxY;$e<_t.minX&&(_t.minX=$e),Zt<_t.minY&&(_t.minY=Zt),Rr>_t.maxX&&(_t.maxX=Rr),nr>_t.maxY&&(_t.maxY=nr)}return _t}function vi(Q,ae,me,Me){var Ve=ae.geometry,at=ae.type,_t=[];if(at==="Point"||at==="MultiPoint")for(var Ce=0;Ce<Ve.length;Ce+=3)_t.push(Ve[Ce]),_t.push(Ve[Ce+1]),Q.numPoints++,Q.numSimplified++;else if(at==="LineString")ni(_t,Ve,Q,me,!1,!1);else if(at==="MultiLineString"||at==="Polygon")for(Ce=0;Ce<Ve.length;Ce++)ni(_t,Ve[Ce],Q,me,at==="Polygon",Ce===0);else if(at==="MultiPolygon")for(var $e=0;$e<Ve.length;$e++){var Zt=Ve[$e];for(Ce=0;Ce<Zt.length;Ce++)ni(_t,Zt[Ce],Q,me,!0,Ce===0)}if(_t.length){var Rr=ae.tags||null;if(at==="LineString"&&Me.lineMetrics){for(var nr in Rr={},ae.tags)Rr[nr]=ae.tags[nr];Rr.mapbox_clip_start=Ve.start/Ve.size,Rr.mapbox_clip_end=Ve.end/Ve.size}var lr={geometry:_t,type:at==="Polygon"||at==="MultiPolygon"?3:at==="LineString"||at==="MultiLineString"?2:1,tags:Rr};ae.id!==null&&(lr.id=ae.id),Q.features.push(lr)}}function ni(Q,ae,me,Me,Ve,at){var _t=Me*Me;if(Me>0&&ae.size<(Ve?_t:Me))me.numPoints+=ae.length/3;else{for(var Ce=[],$e=0;$e<ae.length;$e+=3)(Me===0||ae[$e+2]>_t)&&(me.numSimplified++,Ce.push(ae[$e]),Ce.push(ae[$e+1])),me.numPoints++;Ve&&function(Zt,Rr){for(var nr=0,lr=0,Lr=Zt.length,Dn=Lr-2;lr<Lr;Dn=lr,lr+=2)nr+=(Zt[lr]-Zt[Dn])*(Zt[lr+1]+Zt[Dn+1]);if(nr>0===Rr)for(lr=0,Lr=Zt.length;lr<Lr/2;lr+=2){var Mn=Zt[lr],$t=Zt[lr+1];Zt[lr]=Zt[Lr-2-lr],Zt[lr+1]=Zt[Lr-1-lr],Zt[Lr-2-lr]=Mn,Zt[Lr-1-lr]=$t}}(Ce,at),Q.push(Ce)}}function sa(Q,ae){var me=(ae=this.options=function(Ve,at){for(var _t in at)Ve[_t]=at[_t];return Ve}(Object.create(this.options),ae)).debug;if(me&&console.time("preprocess data"),ae.maxZoom<0||ae.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ae.promoteId&&ae.generateId)throw new Error("promoteId and generateId cannot be used together.");var Me=function(Ve,at){var _t=[];if(Ve.type==="FeatureCollection")for(var Ce=0;Ce<Ve.features.length;Ce++)ka(_t,Ve.features[Ce],at,Ce);else ka(_t,Ve.type==="Feature"?Ve:{geometry:Ve},at);return _t}(Q,ae);this.tiles={},this.tileCoords=[],me&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ae.indexMaxZoom,ae.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Me=function(Ve,at){var _t=at.buffer/at.extent,Ce=Ve,$e=Z(Ve,1,-1-_t,_t,0,-1,2,at),Zt=Z(Ve,1,1-_t,2+_t,0,-1,2,at);return($e||Zt)&&(Ce=Z(Ve,1,-_t,1+_t,0,-1,2,at)||[],$e&&(Ce=$r($e,1).concat(Ce)),Zt&&(Ce=Ce.concat($r(Zt,-1)))),Ce}(Me,ae)).length&&this.splitTile(Me,0,0,0),me&&(Me.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Sa(Q,ae,me){return 32*((1<<Q)*me+ae)+Q}function Na(Q,ae){var me=Q.tileID.canonical;if(!this._geoJSONIndex)return ae(null,null);var Me=this._geoJSONIndex.getTile(me.z,me.x,me.y);if(!Me)return ae(null,null);var Ve=new yt(Me.features),at=Ct(Ve);at.byteOffset===0&&at.byteLength===at.buffer.byteLength||(at=new Uint8Array(at)),ae(null,{vectorTile:Ve,rawData:at.buffer})}Tr.prototype.load=function(Q){var ae=this.options,me=ae.log,Me=ae.minZoom,Ve=ae.maxZoom,at=ae.nodeSize;me&&console.time("total time");var _t="prepare "+Q.length+" points";me&&console.time(_t),this.points=Q;for(var Ce=[],$e=0;$e<Q.length;$e++)Q[$e].geometry&&Ce.push(Nr(Q[$e],$e));this.trees[Ve+1]=new Jt(Ce,bi,li,at,Float32Array),me&&console.timeEnd(_t);for(var Zt=Ve;Zt>=Me;Zt--){var Rr=+Date.now();Ce=this._cluster(Ce,Zt),this.trees[Zt]=new Jt(Ce,bi,li,at,Float32Array),me&&console.log("z%d: %d clusters in %dms",Zt,Ce.length,+Date.now()-Rr)}return me&&console.timeEnd("total time"),this},Tr.prototype.getClusters=function(Q,ae){var me=((Q[0]+180)%360+360)%360-180,Me=Math.max(-90,Math.min(90,Q[1])),Ve=Q[2]===180?180:((Q[2]+180)%360+360)%360-180,at=Math.max(-90,Math.min(90,Q[3]));if(Q[2]-Q[0]>=360)me=-180,Ve=180;else if(me>Ve){var _t=this.getClusters([me,Me,180,at],ae),Ce=this.getClusters([-180,Me,Ve,at],ae);return _t.concat(Ce)}for(var $e=this.trees[this._limitZoom(ae)],Zt=[],Rr=0,nr=$e.range(mi(me),si(at),mi(Ve),si(Me));Rr<nr.length;Rr+=1){var lr=$e.points[nr[Rr]];Zt.push(lr.numPoints?wn(lr):this.points[lr.index])}return Zt},Tr.prototype.getChildren=function(Q){var ae=this._getOriginId(Q),me=this._getOriginZoom(Q),Me="No cluster with the specified id.",Ve=this.trees[me];if(!Ve)throw new Error(Me);var at=Ve.points[ae];if(!at)throw new Error(Me);for(var _t=this.options.radius/(this.options.extent*Math.pow(2,me-1)),Ce=[],$e=0,Zt=Ve.within(at.x,at.y,_t);$e<Zt.length;$e+=1){var Rr=Ve.points[Zt[$e]];Rr.parentId===Q&&Ce.push(Rr.numPoints?wn(Rr):this.points[Rr.index])}if(Ce.length===0)throw new Error(Me);return Ce},Tr.prototype.getLeaves=function(Q,ae,me){var Me=[];return this._appendLeaves(Me,Q,ae=ae||10,me=me||0,0),Me},Tr.prototype.getTile=function(Q,ae,me){var Me=this.trees[this._limitZoom(Q)],Ve=Math.pow(2,Q),at=this.options,_t=at.radius/at.extent,Ce=(me-_t)/Ve,$e=(me+1+_t)/Ve,Zt={features:[]};return this._addTileFeatures(Me.range((ae-_t)/Ve,Ce,(ae+1+_t)/Ve,$e),Me.points,ae,me,Ve,Zt),ae===0&&this._addTileFeatures(Me.range(1-_t/Ve,Ce,1,$e),Me.points,Ve,me,Ve,Zt),ae===Ve-1&&this._addTileFeatures(Me.range(0,Ce,_t/Ve,$e),Me.points,-1,me,Ve,Zt),Zt.features.length?Zt:null},Tr.prototype.getClusterExpansionZoom=function(Q){for(var ae=this._getOriginZoom(Q)-1;ae<=this.options.maxZoom;){var me=this.getChildren(Q);if(ae++,me.length!==1)break;Q=me[0].properties.cluster_id}return ae},Tr.prototype._appendLeaves=function(Q,ae,me,Me,Ve){for(var at=0,_t=this.getChildren(ae);at<_t.length;at+=1){var Ce=_t[at],$e=Ce.properties;if($e&&$e.cluster?Ve+$e.point_count<=Me?Ve+=$e.point_count:Ve=this._appendLeaves(Q,$e.cluster_id,me,Me,Ve):Ve<Me?Ve++:Q.push(Ce),Q.length===me)break}return Ve},Tr.prototype._addTileFeatures=function(Q,ae,me,Me,Ve,at){for(var _t=0,Ce=Q;_t<Ce.length;_t+=1){var $e=ae[Ce[_t]],Zt=$e.numPoints,Rr={type:1,geometry:[[Math.round(this.options.extent*($e.x*Ve-me)),Math.round(this.options.extent*($e.y*Ve-Me))]],tags:Zt?Xi($e):this.points[$e.index].properties},nr=void 0;Zt?nr=$e.id:this.options.generateId?nr=$e.index:this.points[$e.index].id&&(nr=this.points[$e.index].id),nr!==void 0&&(Rr.id=nr),at.features.push(Rr)}},Tr.prototype._limitZoom=function(Q){return Math.max(this.options.minZoom,Math.min(+Q,this.options.maxZoom+1))},Tr.prototype._cluster=function(Q,ae){for(var me=[],Me=this.options,Ve=Me.reduce,at=Me.minPoints,_t=Me.radius/(Me.extent*Math.pow(2,ae)),Ce=0;Ce<Q.length;Ce++){var $e=Q[Ce];if(!($e.zoom<=ae)){$e.zoom=ae;for(var Zt=this.trees[ae+1],Rr=Zt.within($e.x,$e.y,_t),nr=$e.numPoints||1,lr=nr,Lr=0,Dn=Rr;Lr<Dn.length;Lr+=1){var Mn=Zt.points[Dn[Lr]];Mn.zoom>ae&&(lr+=Mn.numPoints||1)}if(lr>=at){for(var $t=$e.x*nr,Cn=$e.y*nr,hr=Ve&&nr>1?this._map($e,!0):null,St=(Ce<<5)+(ae+1)+this.points.length,Ei=0,mn=Rr;Ei<mn.length;Ei+=1){var Oi=Zt.points[mn[Ei]];if(!(Oi.zoom<=ae)){Oi.zoom=ae;var ua=Oi.numPoints||1;$t+=Oi.x*ua,Cn+=Oi.y*ua,Oi.parentId=St,Ve&&(hr||(hr=this._map($e,!0)),Ve(hr,this._map(Oi)))}}$e.parentId=St,me.push(Pn($t/lr,Cn/lr,St,lr,hr))}else if(me.push($e),lr>1)for(var xt=0,wt=Rr;xt<wt.length;xt+=1){var Ri=Zt.points[wt[xt]];Ri.zoom<=ae||(Ri.zoom=ae,me.push(Ri))}}}return me},Tr.prototype._getOriginId=function(Q){return Q-this.points.length>>5},Tr.prototype._getOriginZoom=function(Q){return(Q-this.points.length)%32},Tr.prototype._map=function(Q,ae){if(Q.numPoints)return ae?ki({},Q.properties):Q.properties;var me=this.points[Q.index].properties,Me=this.options.map(me);return ae&&Me===me?ki({},Me):Me},sa.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},sa.prototype.splitTile=function(Q,ae,me,Me,Ve,at,_t){for(var Ce=[Q,ae,me,Me],$e=this.options,Zt=$e.debug;Ce.length;){Me=Ce.pop(),me=Ce.pop(),ae=Ce.pop(),Q=Ce.pop();var Rr=1<<ae,nr=Sa(ae,me,Me),lr=this.tiles[nr];if(!lr&&(Zt>1&&console.time("creation"),lr=this.tiles[nr]=rn(Q,ae,me,Me,$e),this.tileCoords.push({z:ae,x:me,y:Me}),Zt)){Zt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ae,me,Me,lr.numFeatures,lr.numPoints,lr.numSimplified),console.timeEnd("creation"));var Lr="z"+ae;this.stats[Lr]=(this.stats[Lr]||0)+1,this.total++}if(lr.source=Q,Ve){if(ae===$e.maxZoom||ae===Ve)continue;var Dn=1<<Ve-ae;if(me!==Math.floor(at/Dn)||Me!==Math.floor(_t/Dn))continue}else if(ae===$e.indexMaxZoom||lr.numPoints<=$e.indexMaxPoints)continue;if(lr.source=null,Q.length!==0){Zt>1&&console.time("clipping");var Mn,$t,Cn,hr,St,Ei,mn=.5*$e.buffer/$e.extent,Oi=.5-mn,ua=.5+mn,xt=1+mn;Mn=$t=Cn=hr=null,St=Z(Q,Rr,me-mn,me+ua,0,lr.minX,lr.maxX,$e),Ei=Z(Q,Rr,me+Oi,me+xt,0,lr.minX,lr.maxX,$e),Q=null,St&&(Mn=Z(St,Rr,Me-mn,Me+ua,1,lr.minY,lr.maxY,$e),$t=Z(St,Rr,Me+Oi,Me+xt,1,lr.minY,lr.maxY,$e),St=null),Ei&&(Cn=Z(Ei,Rr,Me-mn,Me+ua,1,lr.minY,lr.maxY,$e),hr=Z(Ei,Rr,Me+Oi,Me+xt,1,lr.minY,lr.maxY,$e),Ei=null),Zt>1&&console.timeEnd("clipping"),Ce.push(Mn||[],ae+1,2*me,2*Me),Ce.push($t||[],ae+1,2*me,2*Me+1),Ce.push(Cn||[],ae+1,2*me+1,2*Me),Ce.push(hr||[],ae+1,2*me+1,2*Me+1)}}},sa.prototype.getTile=function(Q,ae,me){var Me=this.options,Ve=Me.extent,at=Me.debug;if(Q<0||Q>24)return null;var _t=1<<Q,Ce=Sa(Q,ae=(ae%_t+_t)%_t,me);if(this.tiles[Ce])return $n(this.tiles[Ce],Ve);at>1&&console.log("drilling down to z%d-%d-%d",Q,ae,me);for(var $e,Zt=Q,Rr=ae,nr=me;!$e&&Zt>0;)Zt--,Rr=Math.floor(Rr/2),nr=Math.floor(nr/2),$e=this.tiles[Sa(Zt,Rr,nr)];return $e&&$e.source?(at>1&&console.log("found parent tile z%d-%d-%d",Zt,Rr,nr),at>1&&console.time("drilling down"),this.splitTile($e.source,Zt,Rr,nr,Q,ae,me),at>1&&console.timeEnd("drilling down"),this.tiles[Ce]?$n(this.tiles[Ce],Ve):null):null};var ga=function(Q){function ae(me,Me,Ve,at){Q.call(this,me,Me,Ve,Na),at&&(this.loadGeoJSON=at)}return Q&&(ae.__proto__=Q),(ae.prototype=Object.create(Q&&Q.prototype)).constructor=ae,ae.prototype.loadData=function(me,Me){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=Me,this._pendingLoadDataParams=me,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},ae.prototype._loadData=function(){var me=this;if(this._pendingCallback&&this._pendingLoadDataParams){var Me=this._pendingCallback,Ve=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var at=!!(Ve&&Ve.request&&Ve.request.collectResourceTiming)&&new y.RequestPerformance(Ve.request);this.loadGeoJSON(Ve,function(_t,Ce){if(_t||!Ce)return Me(_t);if(typeof Ce!="object")return Me(new Error("Input data given to '"+Ve.source+"' is not a valid GeoJSON object."));(function lr(Lr,Dn){var Mn,$t=Lr&&Lr.type;if($t==="FeatureCollection")for(Mn=0;Mn<Lr.features.length;Mn++)lr(Lr.features[Mn],Dn);else if($t==="GeometryCollection")for(Mn=0;Mn<Lr.geometries.length;Mn++)lr(Lr.geometries[Mn],Dn);else if($t==="Feature")lr(Lr.geometry,Dn);else if($t==="Polygon")ur(Lr.coordinates,Dn);else if($t==="MultiPolygon")for(Mn=0;Mn<Lr.coordinates.length;Mn++)ur(Lr.coordinates[Mn],Dn);return Lr})(Ce,!0);try{if(Ve.filter){var $e=y.createExpression(Ve.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if($e.result==="error")throw new Error($e.value.map(function(lr){return lr.key+": "+lr.message}).join(", "));var Zt=Ce.features.filter(function(lr){return $e.value.evaluate({zoom:0},lr)});Ce={type:"FeatureCollection",features:Zt}}me._geoJSONIndex=Ve.cluster?new Tr(function(lr){var Lr=lr.superclusterOptions,Dn=lr.clusterProperties;if(!Dn||!Lr)return Lr;for(var Mn={},$t={},Cn={accumulated:null,zoom:0},hr={properties:null},St=Object.keys(Dn),Ei=0,mn=St;Ei<mn.length;Ei+=1){var Oi=mn[Ei],ua=Dn[Oi],xt=ua[0],wt=y.createExpression(ua[1]),Ri=y.createExpression(typeof xt=="string"?[xt,["accumulated"],["get",Oi]]:xt);Mn[Oi]=wt.value,$t[Oi]=Ri.value}return Lr.map=function(pi){hr.properties=pi;for(var Ji={},ea=0,la=St;ea<la.length;ea+=1){var Di=la[ea];Ji[Di]=Mn[Di].evaluate(Cn,hr)}return Ji},Lr.reduce=function(pi,Ji){hr.properties=Ji;for(var ea=0,la=St;ea<la.length;ea+=1){var Di=la[ea];Cn.accumulated=pi[Di],pi[Di]=$t[Di].evaluate(Cn,hr)}},Lr}(Ve)).load(Ce.features):function(lr,Lr){return new sa(lr,Lr)}(Ce,Ve.geojsonVtOptions)}catch(lr){return Me(lr)}me.loaded={};var Rr={};if(at){var nr=at.finish();nr&&(Rr.resourceTiming={},Rr.resourceTiming[Ve.source]=JSON.parse(JSON.stringify(nr)))}Me(null,Rr)})}},ae.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},ae.prototype.reloadTile=function(me,Me){var Ve=this.loaded;return Ve&&Ve[me.uid]?Q.prototype.reloadTile.call(this,me,Me):this.loadTile(me,Me)},ae.prototype.loadGeoJSON=function(me,Me){if(me.request)y.getJSON(me.request,Me);else{if(typeof me.data!="string")return Me(new Error("Input data given to '"+me.source+"' is not a valid GeoJSON object."));try{return Me(null,JSON.parse(me.data))}catch(Ve){return Me(new Error("Input data given to '"+me.source+"' is not a valid GeoJSON object."))}}},ae.prototype.removeSource=function(me,Me){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),Me()},ae.prototype.getClusterExpansionZoom=function(me,Me){try{Me(null,this._geoJSONIndex.getClusterExpansionZoom(me.clusterId))}catch(Ve){Me(Ve)}},ae.prototype.getClusterChildren=function(me,Me){try{Me(null,this._geoJSONIndex.getChildren(me.clusterId))}catch(Ve){Me(Ve)}},ae.prototype.getClusterLeaves=function(me,Me){try{Me(null,this._geoJSONIndex.getLeaves(me.clusterId,me.limit,me.offset))}catch(Ve){Me(Ve)}},ae}(lt),ta=function(Q){var ae=this;this.self=Q,this.actor=new y.Actor(Q,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:lt,geojson:ga},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(me,Me){if(ae.workerSourceTypes[me])throw new Error('Worker source with name "'+me+'" already registered.');ae.workerSourceTypes[me]=Me},this.self.registerRTLTextPlugin=function(me){if(y.plugin.isParsed())throw new Error("RTL text plugin already registered.");y.plugin.applyArabicShaping=me.applyArabicShaping,y.plugin.processBidirectionalText=me.processBidirectionalText,y.plugin.processStyledBidirectionalText=me.processStyledBidirectionalText}};return ta.prototype.setReferrer=function(Q,ae){this.referrer=ae},ta.prototype.setImages=function(Q,ae,me){for(var Me in this.availableImages[Q]=ae,this.workerSources[Q]){var Ve=this.workerSources[Q][Me];for(var at in Ve)Ve[at].availableImages=ae}me()},ta.prototype.setLayers=function(Q,ae,me){this.getLayerIndex(Q).replace(ae),me()},ta.prototype.updateLayers=function(Q,ae,me){this.getLayerIndex(Q).update(ae.layers,ae.removedIds),me()},ta.prototype.loadTile=function(Q,ae,me){this.getWorkerSource(Q,ae.type,ae.source).loadTile(ae,me)},ta.prototype.loadDEMTile=function(Q,ae,me){this.getDEMWorkerSource(Q,ae.source).loadTile(ae,me)},ta.prototype.reloadTile=function(Q,ae,me){this.getWorkerSource(Q,ae.type,ae.source).reloadTile(ae,me)},ta.prototype.abortTile=function(Q,ae,me){this.getWorkerSource(Q,ae.type,ae.source).abortTile(ae,me)},ta.prototype.removeTile=function(Q,ae,me){this.getWorkerSource(Q,ae.type,ae.source).removeTile(ae,me)},ta.prototype.removeDEMTile=function(Q,ae){this.getDEMWorkerSource(Q,ae.source).removeTile(ae)},ta.prototype.removeSource=function(Q,ae,me){if(this.workerSources[Q]&&this.workerSources[Q][ae.type]&&this.workerSources[Q][ae.type][ae.source]){var Me=this.workerSources[Q][ae.type][ae.source];delete this.workerSources[Q][ae.type][ae.source],Me.removeSource!==void 0?Me.removeSource(ae,me):me()}},ta.prototype.loadWorkerSource=function(Q,ae,me){try{this.self.importScripts(ae.url),me()}catch(Me){me(Me.toString())}},ta.prototype.syncRTLPluginState=function(Q,ae,me){try{y.plugin.setState(ae);var Me=y.plugin.getPluginURL();if(y.plugin.isLoaded()&&!y.plugin.isParsed()&&Me!=null){this.self.importScripts(Me);var Ve=y.plugin.isParsed();me(Ve?void 0:new Error("RTL Text Plugin failed to import scripts from "+Me),Ve)}}catch(at){me(at.toString())}},ta.prototype.getAvailableImages=function(Q){var ae=this.availableImages[Q];return ae||(ae=[]),ae},ta.prototype.getLayerIndex=function(Q){var ae=this.layerIndexes[Q];return ae||(ae=this.layerIndexes[Q]=new ye),ae},ta.prototype.getWorkerSource=function(Q,ae,me){var Me=this;return this.workerSources[Q]||(this.workerSources[Q]={}),this.workerSources[Q][ae]||(this.workerSources[Q][ae]={}),this.workerSources[Q][ae][me]||(this.workerSources[Q][ae][me]=new this.workerSourceTypes[ae]({send:function(Ve,at,_t){Me.actor.send(Ve,at,_t,Q)}},this.getLayerIndex(Q),this.getAvailableImages(Q))),this.workerSources[Q][ae][me]},ta.prototype.getDEMWorkerSource=function(Q,ae){return this.demWorkerSources[Q]||(this.demWorkerSources[Q]={}),this.demWorkerSources[Q][ae]||(this.demWorkerSources[Q][ae]=new gt),this.demWorkerSources[Q][ae]},ta.prototype.enforceCacheSizeLimit=function(Q,ae){y.enforceCacheSizeLimit(ae)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new ta(self)),ta}),ne(["./shared"],function(y){"use strict";var Te=y.createCommonjsModule(function(f){function d(w){return!h(w)}function h(w){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var I,D,G=new Blob([""],{type:"text/javascript"}),te=URL.createObjectURL(G);try{D=new Worker(te),I=!0}catch(he){I=!1}return D&&D.terminate(),URL.revokeObjectURL(te),I}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var I=document.createElement("canvas");I.width=I.height=1;var D=I.getContext("2d");if(!D)return!1;var G=D.getImageData(0,0,1,1);return G&&G.width===I.width}()?(g[M=w&&w.failIfMajorPerformanceCaveat]===void 0&&(g[M]=function(I){var D=function(te){var he=document.createElement("canvas"),Se=Object.create(d.webGLContextAttributes);return Se.failIfMajorPerformanceCaveat=te,he.probablySupportsContext?he.probablySupportsContext("webgl",Se)||he.probablySupportsContext("experimental-webgl",Se):he.supportsContext?he.supportsContext("webgl",Se)||he.supportsContext("experimental-webgl",Se):he.getContext("webgl",Se)||he.getContext("experimental-webgl",Se)}(I);if(!D)return!1;var G=D.createShader(D.VERTEX_SHADER);return!(!G||D.isContextLost())&&(D.shaderSource(G,"void main() {}"),D.compileShader(G),D.getShaderParameter(G,D.COMPILE_STATUS)===!0)}(M)),g[M]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var M}f.exports?f.exports=d:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=d,window.mapboxgl.notSupportedReason=h);var g={};d.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),W={create:function(f,d,h){var g=y.window.document.createElement(f);return d!==void 0&&(g.className=d),h&&h.appendChild(g),g},createNS:function(f,d){return y.window.document.createElementNS(f,d)}},ye=y.window.document&&y.window.document.documentElement.style;function se(f){if(!ye)return f[0];for(var d=0;d<f.length;d++)if(f[d]in ye)return f[d];return f[0]}var Ye,_e=se(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);W.disableDrag=function(){ye&&_e&&(Ye=ye[_e],ye[_e]="none")},W.enableDrag=function(){ye&&_e&&(ye[_e]=Ye)};var Qe=se(["transform","WebkitTransform"]);W.setTransform=function(f,d){f.style[Qe]=d};var lt=!1;try{var bt=Object.defineProperty({},"passive",{get:function(){lt=!0}});y.window.addEventListener("test",bt,bt),y.window.removeEventListener("test",bt,bt)}catch(f){lt=!1}W.addEventListener=function(f,d,h,g){g===void 0&&(g={}),f.addEventListener(d,h,"passive"in g&&lt?g:g.capture)},W.removeEventListener=function(f,d,h,g){g===void 0&&(g={}),f.removeEventListener(d,h,"passive"in g&&lt?g:g.capture)};var gt=function(f){f.preventDefault(),f.stopPropagation(),y.window.removeEventListener("click",gt,!0)};function ur(f){var d=f.userImage;return!!(d&&d.render&&d.render())&&(f.data.replace(new Uint8Array(d.data.buffer)),!0)}W.suppressClick=function(){y.window.addEventListener("click",gt,!0),y.window.setTimeout(function(){y.window.removeEventListener("click",gt,!0)},0)},W.mousePos=function(f,d){var h=f.getBoundingClientRect();return new y.Point(d.clientX-h.left-f.clientLeft,d.clientY-h.top-f.clientTop)},W.touchPos=function(f,d){for(var h=f.getBoundingClientRect(),g=[],w=0;w<d.length;w++)g.push(new y.Point(d[w].clientX-h.left-f.clientLeft,d[w].clientY-h.top-f.clientTop));return g},W.mouseButton=function(f){return y.window.InstallTrigger!==void 0&&f.button===2&&f.ctrlKey&&y.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:f.button},W.remove=function(f){f.parentNode&&f.parentNode.removeChild(f)};var Mt=function(f){function d(){f.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new y.RGBAImage({width:1,height:1}),this.dirty=!0}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.isLoaded=function(){return this.loaded},d.prototype.setLoaded=function(h){if(this.loaded!==h&&(this.loaded=h,h)){for(var g=0,w=this.requestors;g<w.length;g+=1){var M=w[g];this._notify(M.ids,M.callback)}this.requestors=[]}},d.prototype.getImage=function(h){return this.images[h]},d.prototype.addImage=function(h,g){this._validate(h,g)&&(this.images[h]=g)},d.prototype._validate=function(h,g){var w=!0;return this._validateStretch(g.stretchX,g.data&&g.data.width)||(this.fire(new y.ErrorEvent(new Error('Image "'+h+'" has invalid "stretchX" value'))),w=!1),this._validateStretch(g.stretchY,g.data&&g.data.height)||(this.fire(new y.ErrorEvent(new Error('Image "'+h+'" has invalid "stretchY" value'))),w=!1),this._validateContent(g.content,g)||(this.fire(new y.ErrorEvent(new Error('Image "'+h+'" has invalid "content" value'))),w=!1),w},d.prototype._validateStretch=function(h,g){if(!h)return!0;for(var w=0,M=0,I=h;M<I.length;M+=1){var D=I[M];if(D[0]<w||D[1]<D[0]||g<D[1])return!1;w=D[1]}return!0},d.prototype._validateContent=function(h,g){return!(h&&(h.length!==4||h[0]<0||g.data.width<h[0]||h[1]<0||g.data.height<h[1]||h[2]<0||g.data.width<h[2]||h[3]<0||g.data.height<h[3]||h[2]<h[0]||h[3]<h[1]))},d.prototype.updateImage=function(h,g){g.version=this.images[h].version+1,this.images[h]=g,this.updatedImages[h]=!0},d.prototype.removeImage=function(h){var g=this.images[h];delete this.images[h],delete this.patterns[h],g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()},d.prototype.listImages=function(){return Object.keys(this.images)},d.prototype.getImages=function(h,g){var w=!0;if(!this.isLoaded())for(var M=0,I=h;M<I.length;M+=1)this.images[I[M]]||(w=!1);this.isLoaded()||w?this._notify(h,g):this.requestors.push({ids:h,callback:g})},d.prototype._notify=function(h,g){for(var w={},M=0,I=h;M<I.length;M+=1){var D=I[M];this.images[D]||this.fire(new y.Event("styleimagemissing",{id:D}));var G=this.images[D];G?w[D]={data:G.data.clone(),pixelRatio:G.pixelRatio,sdf:G.sdf,version:G.version,stretchX:G.stretchX,stretchY:G.stretchY,content:G.content,hasRenderCallback:Boolean(G.userImage&&G.userImage.render)}:y.warnOnce('Image "'+D+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}g(null,w)},d.prototype.getPixelSize=function(){var h=this.atlasImage;return{width:h.width,height:h.height}},d.prototype.getPattern=function(h){var g=this.patterns[h],w=this.getImage(h);if(!w)return null;if(g&&g.position.version===w.version)return g.position;if(g)g.position.version=w.version;else{var M={w:w.data.width+2,h:w.data.height+2,x:0,y:0},I=new y.ImagePosition(M,w);this.patterns[h]={bin:M,position:I}}return this._updatePatternAtlas(),this.patterns[h].position},d.prototype.bind=function(h){var g=h.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new y.Texture(h,this.atlasImage,g.RGBA),this.atlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE)},d.prototype._updatePatternAtlas=function(){var h=[];for(var g in this.patterns)h.push(this.patterns[g].bin);var w=y.potpack(h),M=w.w,I=w.h,D=this.atlasImage;for(var G in D.resize({width:M||1,height:I||1}),this.patterns){var te=this.patterns[G].bin,he=te.x+1,Se=te.y+1,Ae=this.images[G].data,We=Ae.width,Ge=Ae.height;y.RGBAImage.copy(Ae,D,{x:0,y:0},{x:he,y:Se},{width:We,height:Ge}),y.RGBAImage.copy(Ae,D,{x:0,y:Ge-1},{x:he,y:Se-1},{width:We,height:1}),y.RGBAImage.copy(Ae,D,{x:0,y:0},{x:he,y:Se+Ge},{width:We,height:1}),y.RGBAImage.copy(Ae,D,{x:We-1,y:0},{x:he-1,y:Se},{width:1,height:Ge}),y.RGBAImage.copy(Ae,D,{x:0,y:0},{x:he+We,y:Se},{width:1,height:Ge})}this.dirty=!0},d.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},d.prototype.dispatchRenderCallbacks=function(h){for(var g=0,w=h;g<w.length;g+=1){var M=w[g];if(!this.callbackDispatchedThisFrame[M]){this.callbackDispatchedThisFrame[M]=!0;var I=this.images[M];ur(I)&&this.updateImage(M,I)}}},d}(y.Evented),qt=At,zt=At,yt=1e20;function At(f,d,h,g,w,M){this.fontSize=f||24,this.buffer=d===void 0?3:d,this.cutoff=g||.25,this.fontFamily=w||"sans-serif",this.fontWeight=M||"normal",this.radius=h||8;var I=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=I,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(I*I),this.gridInner=new Float64Array(I*I),this.f=new Float64Array(I),this.d=new Float64Array(I),this.z=new Float64Array(I+1),this.v=new Int16Array(I),this.middle=Math.round(I/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function ar(f,d,h,g,w,M,I){for(var D=0;D<d;D++){for(var G=0;G<h;G++)g[G]=f[G*d+D];for(J(g,w,M,I,h),G=0;G<h;G++)f[G*d+D]=w[G]}for(G=0;G<h;G++){for(D=0;D<d;D++)g[D]=f[G*d+D];for(J(g,w,M,I,d),D=0;D<d;D++)f[G*d+D]=Math.sqrt(w[D])}}function J(f,d,h,g,w){h[0]=0,g[0]=-yt,g[1]=+yt;for(var M=1,I=0;M<w;M++){for(var D=(f[M]+M*M-(f[h[I]]+h[I]*h[I]))/(2*M-2*h[I]);D<=g[I];)I--,D=(f[M]+M*M-(f[h[I]]+h[I]*h[I]))/(2*M-2*h[I]);h[++I]=M,g[I]=D,g[I+1]=+yt}for(M=0,I=0;M<w;M++){for(;g[I+1]<M;)I++;d[M]=(M-h[I])*(M-h[I])+f[h[I]]}}At.prototype.draw=function(f){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(f,this.buffer,this.middle);for(var d=this.ctx.getImageData(0,0,this.size,this.size),h=new Uint8ClampedArray(this.size*this.size),g=0;g<this.size*this.size;g++){var w=d.data[4*g+3]/255;this.gridOuter[g]=w===1?0:w===0?yt:Math.pow(Math.max(0,.5-w),2),this.gridInner[g]=w===1?yt:w===0?0:Math.pow(Math.max(0,w-.5),2)}for(ar(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),ar(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),g=0;g<this.size*this.size;g++)h[g]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[g]-this.gridInner[g])/this.radius+this.cutoff))));return h},qt.default=zt;var Qt=function(f,d){this.requestManager=f,this.localIdeographFontFamily=d,this.entries={}};Qt.prototype.setURL=function(f){this.url=f},Qt.prototype.getGlyphs=function(f,d){var h=this,g=[];for(var w in f)for(var M=0,I=f[w];M<I.length;M+=1)g.push({stack:w,id:I[M]});y.asyncAll(g,function(D,G){var te=D.stack,he=D.id,Se=h.entries[te];Se||(Se=h.entries[te]={glyphs:{},requests:{},ranges:{}});var Ae=Se.glyphs[he];if(Ae===void 0){if(Ae=h._tinySDF(Se,te,he))return Se.glyphs[he]=Ae,void G(null,{stack:te,id:he,glyph:Ae});var We=Math.floor(he/256);if(256*We>65535)G(new Error("glyphs > 65535 not supported"));else if(Se.ranges[We])G(null,{stack:te,id:he,glyph:Ae});else{var Ge=Se.requests[We];Ge||(Ge=Se.requests[We]=[],Qt.loadGlyphRange(te,We,h.url,h.requestManager,function(ot,Ze){if(Ze){for(var Xe in Ze)h._doesCharSupportLocalGlyph(+Xe)||(Se.glyphs[+Xe]=Ze[+Xe]);Se.ranges[We]=!0}for(var de=0,Vt=Ge;de<Vt.length;de+=1)(0,Vt[de])(ot,Ze);delete Se.requests[We]})),Ge.push(function(ot,Ze){ot?G(ot):Ze&&G(null,{stack:te,id:he,glyph:Ze[he]||null})})}}else G(null,{stack:te,id:he,glyph:Ae})},function(D,G){if(D)d(D);else if(G){for(var te={},he=0,Se=G;he<Se.length;he+=1){var Ae=Se[he],We=Ae.stack,Ge=Ae.id,ot=Ae.glyph;(te[We]||(te[We]={}))[Ge]=ot&&{id:ot.id,bitmap:ot.bitmap.clone(),metrics:ot.metrics}}d(null,te)}})},Qt.prototype._doesCharSupportLocalGlyph=function(f){return!!this.localIdeographFontFamily&&(y.isChar["CJK Unified Ideographs"](f)||y.isChar["Hangul Syllables"](f)||y.isChar.Hiragana(f)||y.isChar.Katakana(f))},Qt.prototype._tinySDF=function(f,d,h){var g=this.localIdeographFontFamily;if(g&&this._doesCharSupportLocalGlyph(h)){var w=f.tinySDF;if(!w){var M="400";/bold/i.test(d)?M="900":/medium/i.test(d)?M="500":/light/i.test(d)&&(M="200"),w=f.tinySDF=new Qt.TinySDF(24,3,8,.25,g,M)}return{id:h,bitmap:new y.AlphaImage({width:30,height:30},w.draw(String.fromCharCode(h))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},Qt.loadGlyphRange=function(f,d,h,g,w){var M=256*d,I=M+255,D=g.transformRequest(g.normalizeGlyphsURL(h).replace("{fontstack}",f).replace("{range}",M+"-"+I),y.ResourceType.Glyphs);y.getArrayBuffer(D,function(G,te){if(G)w(G);else if(te){for(var he={},Se=0,Ae=y.parseGlyphPBF(te);Se<Ae.length;Se+=1){var We=Ae[Se];he[We.id]=We}w(null,he)}})},Qt.TinySDF=qt;var Ct=function(){this.specification=y.styleSpec.light.position};Ct.prototype.possiblyEvaluate=function(f,d){return y.sphericalToCartesian(f.expression.evaluate(d))},Ct.prototype.interpolate=function(f,d,h){return{x:y.number(f.x,d.x,h),y:y.number(f.y,d.y,h),z:y.number(f.z,d.z,h)}};var ft=new y.Properties({anchor:new y.DataConstantProperty(y.styleSpec.light.anchor),position:new Ct,color:new y.DataConstantProperty(y.styleSpec.light.color),intensity:new y.DataConstantProperty(y.styleSpec.light.intensity)}),Ut=function(f){function d(h){f.call(this),this._transitionable=new y.Transitionable(ft),this.setLight(h),this._transitioning=this._transitionable.untransitioned()}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getLight=function(){return this._transitionable.serialize()},d.prototype.setLight=function(h,g){if(g===void 0&&(g={}),!this._validate(y.validateLight,h,g))for(var w in h){var M=h[w];y.endsWith(w,"-transition")?this._transitionable.setTransition(w.slice(0,-"-transition".length),M):this._transitionable.setValue(w,M)}},d.prototype.updateTransitions=function(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)},d.prototype.hasTransition=function(){return this._transitioning.hasTransition()},d.prototype.recalculate=function(h){this.properties=this._transitioning.possiblyEvaluate(h)},d.prototype._validate=function(h,g,w){return(!w||w.validate!==!1)&&y.emitValidationErrors(this,h.call(y.validateStyle,y.extend({value:g,style:{glyphs:!0,sprite:!0},styleSpec:y.styleSpec})))},d}(y.Evented),dt=function(f,d){this.width=f,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};dt.prototype.getDash=function(f,d){var h=f.join(",")+String(d);return this.dashEntry[h]||(this.dashEntry[h]=this.addDash(f,d)),this.dashEntry[h]},dt.prototype.getDashRanges=function(f,d,h){var g=[],w=f.length%2==1?-f[f.length-1]*h:0,M=f[0]*h,I=!0;g.push({left:w,right:M,isDash:I,zeroLength:f[0]===0});for(var D=f[0],G=1;G<f.length;G++){var te=f[G];g.push({left:w=D*h,right:M=(D+=te)*h,isDash:I=!I,zeroLength:te===0})}return g},dt.prototype.addRoundDash=function(f,d,h){for(var g=d/2,w=-h;w<=h;w++)for(var M=this.width*(this.nextRow+h+w),I=0,D=f[I],G=0;G<this.width;G++){G/D.right>1&&(D=f[++I]);var te=Math.abs(G-D.left),he=Math.abs(G-D.right),Se=Math.min(te,he),Ae=void 0,We=w/h*(g+1);if(D.isDash){var Ge=g-Math.abs(We);Ae=Math.sqrt(Se*Se+Ge*Ge)}else Ae=g-Math.sqrt(Se*Se+We*We);this.data[M+G]=Math.max(0,Math.min(255,Ae+128))}},dt.prototype.addRegularDash=function(f){for(var d=f.length-1;d>=0;--d){var h=f[d],g=f[d+1];h.zeroLength?f.splice(d,1):g&&g.isDash===h.isDash&&(g.left=h.left,f.splice(d,1))}var w=f[0],M=f[f.length-1];w.isDash===M.isDash&&(w.left=M.left-this.width,M.right=w.right+this.width);for(var I=this.width*this.nextRow,D=0,G=f[D],te=0;te<this.width;te++){te/G.right>1&&(G=f[++D]);var he=Math.abs(te-G.left),Se=Math.abs(te-G.right),Ae=Math.min(he,Se);this.data[I+te]=Math.max(0,Math.min(255,(G.isDash?Ae:-Ae)+128))}},dt.prototype.addDash=function(f,d){var h=d?7:0,g=2*h+1;if(this.nextRow+g>this.height)return y.warnOnce("LineAtlas out of space"),null;for(var w=0,M=0;M<f.length;M++)w+=f[M];if(w!==0){var I=this.width/w,D=this.getDashRanges(f,this.width,I);d?this.addRoundDash(D,I,h):this.addRegularDash(D)}var G={y:(this.nextRow+h+.5)/this.height,height:2*h/this.height,width:w};return this.nextRow+=g,this.dirty=!0,G},dt.prototype.bind=function(f){var d=f.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))};var rr=function f(d,h){this.workerPool=d,this.actors=[],this.currentActor=0,this.id=y.uniqueId();for(var g=this.workerPool.acquire(this.id),w=0;w<g.length;w++){var M=new f.Actor(g[w],h,this.id);M.name="Worker "+w,this.actors.push(M)}};function wr(f,d,h){var g=function(w,M){if(w)return h(w);if(M){var I=y.pick(y.extend(M,f),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);M.vector_layers&&(I.vectorLayers=M.vector_layers,I.vectorLayerIds=I.vectorLayers.map(function(D){return D.id})),I.tiles=d.canonicalizeTileset(I,f.url),h(null,I)}};return f.url?y.getJSON(d.transformRequest(d.normalizeSourceURL(f.url),y.ResourceType.Source),g):y.browser.frame(function(){return g(null,f)})}rr.prototype.broadcast=function(f,d,h){y.asyncAll(this.actors,function(g,w){g.send(f,d,w)},h=h||function(){})},rr.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},rr.prototype.remove=function(){this.actors.forEach(function(f){f.remove()}),this.actors=[],this.workerPool.release(this.id)},rr.Actor=y.Actor;var re=function(f,d,h){this.bounds=y.LngLatBounds.convert(this.validateBounds(f)),this.minzoom=d||0,this.maxzoom=h||24};re.prototype.validateBounds=function(f){return Array.isArray(f)&&f.length===4?[Math.max(-180,f[0]),Math.max(-90,f[1]),Math.min(180,f[2]),Math.min(90,f[3])]:[-180,-90,180,90]},re.prototype.contains=function(f){var d=Math.pow(2,f.z),h=Math.floor(y.mercatorXfromLng(this.bounds.getWest())*d),g=Math.floor(y.mercatorYfromLat(this.bounds.getNorth())*d),w=Math.ceil(y.mercatorXfromLng(this.bounds.getEast())*d),M=Math.ceil(y.mercatorYfromLat(this.bounds.getSouth())*d);return f.x>=h&&f.x<w&&f.y>=g&&f.y<M};var Fe=function(f){function d(h,g,w,M){if(f.call(this),this.id=h,this.dispatcher=w,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,y.extend(this,y.pick(g,["url","scheme","tileSize","promoteId"])),this._options=y.extend({type:"vector"},g),this._collectResourceTiming=g.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(M)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(){var h=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=wr(this._options,this.map._requestManager,function(g,w){h._tileJSONRequest=null,h._loaded=!0,g?h.fire(new y.ErrorEvent(g)):w&&(y.extend(h,w),w.bounds&&(h.tileBounds=new re(w.bounds,h.minzoom,h.maxzoom)),y.postTurnstileEvent(w.tiles,h.map._requestManager._customAccessToken),y.postMapLoadEvent(w.tiles,h.map._getMapId(),h.map._requestManager._skuToken,h.map._requestManager._customAccessToken),h.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})),h.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})))})},d.prototype.loaded=function(){return this._loaded},d.prototype.hasTile=function(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.setSourceProperty=function(h){this._tileJSONRequest&&this._tileJSONRequest.cancel(),h(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},d.prototype.setTiles=function(h){var g=this;return this.setSourceProperty(function(){g._options.tiles=h}),this},d.prototype.setUrl=function(h){var g=this;return this.setSourceProperty(function(){g.url=h,g._options.url=h}),this},d.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},d.prototype.serialize=function(){return y.extend({},this._options)},d.prototype.loadTile=function(h,g){var w=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),M={request:this.map._requestManager.transformRequest(w,y.ResourceType.Tile),uid:h.uid,tileID:h.tileID,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:y.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function I(D,G){return delete h.request,h.aborted?g(null):D&&D.status!==404?g(D):(G&&G.resourceTiming&&(h.resourceTiming=G.resourceTiming),this.map._refreshExpiredTiles&&G&&h.setExpiryData(G),h.loadVectorData(G,this.map.painter),y.cacheEntryPossiblyAdded(this.dispatcher),g(null),void(h.reloadCallback&&(this.loadTile(h,h.reloadCallback),h.reloadCallback=null)))}M.request.collectResourceTiming=this._collectResourceTiming,h.actor&&h.state!=="expired"?h.state==="loading"?h.reloadCallback=g:h.request=h.actor.send("reloadTile",M,I.bind(this)):(h.actor=this.dispatcher.getActor(),h.request=h.actor.send("loadTile",M,I.bind(this)))},d.prototype.abortTile=function(h){h.request&&(h.request.cancel(),delete h.request),h.actor&&h.actor.send("abortTile",{uid:h.uid,type:this.type,source:this.id},void 0)},d.prototype.unloadTile=function(h){h.unloadVectorData(),h.actor&&h.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id},void 0)},d.prototype.hasTransition=function(){return!1},d}(y.Evented),N=function(f){function d(h,g,w,M){f.call(this),this.id=h,this.dispatcher=w,this.setEventedParent(M),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=y.extend({type:"raster"},g),y.extend(this,y.pick(g,["url","scheme","tileSize"]))}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(){var h=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=wr(this._options,this.map._requestManager,function(g,w){h._tileJSONRequest=null,h._loaded=!0,g?h.fire(new y.ErrorEvent(g)):w&&(y.extend(h,w),w.bounds&&(h.tileBounds=new re(w.bounds,h.minzoom,h.maxzoom)),y.postTurnstileEvent(w.tiles),y.postMapLoadEvent(w.tiles,h.map._getMapId(),h.map._requestManager._skuToken),h.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})),h.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})))})},d.prototype.loaded=function(){return this._loaded},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},d.prototype.serialize=function(){return y.extend({},this._options)},d.prototype.hasTile=function(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)},d.prototype.loadTile=function(h,g){var w=this,M=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);h.request=y.getImage(this.map._requestManager.transformRequest(M,y.ResourceType.Tile),function(I,D){if(delete h.request,h.aborted)h.state="unloaded",g(null);else if(I)h.state="errored",g(I);else if(D){w.map._refreshExpiredTiles&&h.setExpiryData(D),delete D.cacheControl,delete D.expires;var G=w.map.painter.context,te=G.gl;h.texture=w.map.painter.getTileTexture(D.width),h.texture?h.texture.update(D,{useMipmap:!0}):(h.texture=new y.Texture(G,D,te.RGBA,{useMipmap:!0}),h.texture.bind(te.LINEAR,te.CLAMP_TO_EDGE,te.LINEAR_MIPMAP_NEAREST),G.extTextureFilterAnisotropic&&te.texParameterf(te.TEXTURE_2D,G.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,G.extTextureFilterAnisotropicMax)),h.state="loaded",y.cacheEntryPossiblyAdded(w.dispatcher),g(null)}})},d.prototype.abortTile=function(h,g){h.request&&(h.request.cancel(),delete h.request),g()},d.prototype.unloadTile=function(h,g){h.texture&&this.map.painter.saveTileTexture(h.texture),g()},d.prototype.hasTransition=function(){return!1},d}(y.Evented),z=function(f){function d(h,g,w,M){f.call(this,h,g,w,M),this.type="raster-dem",this.maxzoom=22,this._options=y.extend({type:"raster-dem"},g),this.encoding=g.encoding||"mapbox"}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},d.prototype.loadTile=function(h,g){var w=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function M(I,D){I&&(h.state="errored",g(I)),D&&(h.dem=D,h.needsHillshadePrepare=!0,h.state="loaded",g(null))}h.request=y.getImage(this.map._requestManager.transformRequest(w,y.ResourceType.Tile),function(I,D){if(delete h.request,h.aborted)h.state="unloaded",g(null);else if(I)h.state="errored",g(I);else if(D){this.map._refreshExpiredTiles&&h.setExpiryData(D),delete D.cacheControl,delete D.expires;var G=y.window.ImageBitmap&&D instanceof y.window.ImageBitmap&&y.offscreenCanvasSupported()?D:y.browser.getImageData(D,1),te={uid:h.uid,coord:h.tileID,source:this.id,rawImageData:G,encoding:this.encoding};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",te,M.bind(this)))}}.bind(this)),h.neighboringTiles=this._getNeighboringTiles(h.tileID)},d.prototype._getNeighboringTiles=function(h){var g=h.canonical,w=Math.pow(2,g.z),M=(g.x-1+w)%w,I=g.x===0?h.wrap-1:h.wrap,D=(g.x+1+w)%w,G=g.x+1===w?h.wrap+1:h.wrap,te={};return te[new y.OverscaledTileID(h.overscaledZ,I,g.z,M,g.y).key]={backfilled:!1},te[new y.OverscaledTileID(h.overscaledZ,G,g.z,D,g.y).key]={backfilled:!1},g.y>0&&(te[new y.OverscaledTileID(h.overscaledZ,I,g.z,M,g.y-1).key]={backfilled:!1},te[new y.OverscaledTileID(h.overscaledZ,h.wrap,g.z,g.x,g.y-1).key]={backfilled:!1},te[new y.OverscaledTileID(h.overscaledZ,G,g.z,D,g.y-1).key]={backfilled:!1}),g.y+1<w&&(te[new y.OverscaledTileID(h.overscaledZ,I,g.z,M,g.y+1).key]={backfilled:!1},te[new y.OverscaledTileID(h.overscaledZ,h.wrap,g.z,g.x,g.y+1).key]={backfilled:!1},te[new y.OverscaledTileID(h.overscaledZ,G,g.z,D,g.y+1).key]={backfilled:!1}),te},d.prototype.unloadTile=function(h){h.demTexture&&this.map.painter.saveTileTexture(h.demTexture),h.fbo&&(h.fbo.destroy(),delete h.fbo),h.dem&&delete h.dem,delete h.neighboringTiles,h.state="unloaded",h.actor&&h.actor.send("removeDEMTile",{uid:h.uid,source:this.id})},d}(N),ce=function(f){function d(h,g,w,M){f.call(this),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=w.getActor(),this.setEventedParent(M),this._data=g.data,this._options=y.extend({},g),this._collectResourceTiming=g.collectResourceTiming,this._resourceTiming=[],g.maxzoom!==void 0&&(this.maxzoom=g.maxzoom),g.type&&(this.type=g.type),g.attribution&&(this.attribution=g.attribution),this.promoteId=g.promoteId;var I=y.EXTENT/this.tileSize;this.workerOptions=y.extend({source:this.id,cluster:g.cluster||!1,geojsonVtOptions:{buffer:(g.buffer!==void 0?g.buffer:128)*I,tolerance:(g.tolerance!==void 0?g.tolerance:.375)*I,extent:y.EXTENT,maxZoom:this.maxzoom,lineMetrics:g.lineMetrics||!1,generateId:g.generateId||!1},superclusterOptions:{maxZoom:g.clusterMaxZoom!==void 0?Math.min(g.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,g.clusterMinPoints||2),extent:y.EXTENT,radius:(g.clusterRadius||50)*I,log:!1,generateId:g.generateId||!1},clusterProperties:g.clusterProperties,filter:g.filter},g.workerOptions)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(){var h=this;this.fire(new y.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(g){if(g)h.fire(new y.ErrorEvent(g));else{var w={dataType:"source",sourceDataType:"metadata"};h._collectResourceTiming&&h._resourceTiming&&h._resourceTiming.length>0&&(w.resourceTiming=h._resourceTiming,h._resourceTiming=[]),h.fire(new y.Event("data",w))}})},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.setData=function(h){var g=this;return this._data=h,this.fire(new y.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(w){if(w)g.fire(new y.ErrorEvent(w));else{var M={dataType:"source",sourceDataType:"content"};g._collectResourceTiming&&g._resourceTiming&&g._resourceTiming.length>0&&(M.resourceTiming=g._resourceTiming,g._resourceTiming=[]),g.fire(new y.Event("data",M))}}),this},d.prototype.getClusterExpansionZoom=function(h,g){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id},g),this},d.prototype.getClusterChildren=function(h,g){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id},g),this},d.prototype.getClusterLeaves=function(h,g,w,M){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:h,limit:g,offset:w},M),this},d.prototype._updateWorkerData=function(h){var g=this;this._loaded=!1;var w=y.extend({},this.workerOptions),M=this._data;typeof M=="string"?(w.request=this.map._requestManager.transformRequest(y.browser.resolveURL(M),y.ResourceType.Source),w.request.collectResourceTiming=this._collectResourceTiming):w.data=JSON.stringify(M),this.actor.send(this.type+".loadData",w,function(I,D){g._removed||D&&D.abandoned||(g._loaded=!0,D&&D.resourceTiming&&D.resourceTiming[g.id]&&(g._resourceTiming=D.resourceTiming[g.id].slice(0)),g.actor.send(g.type+".coalesce",{source:w.source},null),h(I))})},d.prototype.loaded=function(){return this._loaded},d.prototype.loadTile=function(h,g){var w=this,M=h.actor?"reloadTile":"loadTile";h.actor=this.actor,h.request=this.actor.send(M,{type:this.type,uid:h.uid,tileID:h.tileID,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:y.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(I,D){return delete h.request,h.unloadVectorData(),h.aborted?g(null):I?g(I):(h.loadVectorData(D,w.map.painter,M==="reloadTile"),g(null))})},d.prototype.abortTile=function(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0},d.prototype.unloadTile=function(h){h.unloadVectorData(),this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})},d.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},d.prototype.serialize=function(){return y.extend({},this._options,{type:this.type,data:this._data})},d.prototype.hasTransition=function(){return!1},d}(y.Evented),ze=y.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),et=function(f){function d(h,g,w,M){f.call(this),this.id=h,this.dispatcher=w,this.coordinates=g.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(M),this.options=g}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(h,g){var w=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this.url=this.options.url,y.getImage(this.map._requestManager.transformRequest(this.url,y.ResourceType.Image),function(M,I){w._loaded=!0,M?w.fire(new y.ErrorEvent(M)):I&&(w.image=I,h&&(w.coordinates=h),g&&g(),w._finishLoading())})},d.prototype.loaded=function(){return this._loaded},d.prototype.updateImage=function(h){var g=this;return this.image&&h.url?(this.options.url=h.url,this.load(h.coordinates,function(){g.texture=null}),this):this},d.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})))},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.setCoordinates=function(h){var g=this;this.coordinates=h;var w=h.map(y.MercatorCoordinate.fromLngLat);this.tileID=function(I){for(var D=1/0,G=1/0,te=-1/0,he=-1/0,Se=0,Ae=I;Se<Ae.length;Se+=1){var We=Ae[Se];D=Math.min(D,We.x),G=Math.min(G,We.y),te=Math.max(te,We.x),he=Math.max(he,We.y)}var Ge=Math.max(te-D,he-G),ot=Math.max(0,Math.floor(-Math.log(Ge)/Math.LN2)),Ze=Math.pow(2,ot);return new y.CanonicalTileID(ot,Math.floor((D+te)/2*Ze),Math.floor((G+he)/2*Ze))}(w),this.minzoom=this.maxzoom=this.tileID.z;var M=w.map(function(I){return g.tileID.getTilePoint(I)._round()});return this._boundsArray=new y.StructArrayLayout4i8,this._boundsArray.emplaceBack(M[0].x,M[0].y,0,0),this._boundsArray.emplaceBack(M[1].x,M[1].y,y.EXTENT,0),this._boundsArray.emplaceBack(M[3].x,M[3].y,0,y.EXTENT),this._boundsArray.emplaceBack(M[2].x,M[2].y,y.EXTENT,y.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})),this},d.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var h=this.map.painter.context,g=h.gl;for(var w in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,ze.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new y.Texture(h,this.image,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE)),this.tiles){var M=this.tiles[w];M.state!=="loaded"&&(M.state="loaded",M.texture=this.texture)}}},d.prototype.loadTile=function(h,g){this.tileID&&this.tileID.equals(h.tileID.canonical)?(this.tiles[String(h.tileID.wrap)]=h,h.buckets={},g(null)):(h.state="errored",g(null))},d.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},d.prototype.hasTransition=function(){return!1},d}(y.Evented),ht=function(f){function d(h,g,w,M){f.call(this,h,g,w,M),this.roundZoom=!0,this.type="video",this.options=g}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(){var h=this;this._loaded=!1;var g=this.options;this.urls=[];for(var w=0,M=g.urls;w<M.length;w+=1)this.urls.push(this.map._requestManager.transformRequest(M[w],y.ResourceType.Source).url);y.getVideo(this.urls,function(I,D){h._loaded=!0,I?h.fire(new y.ErrorEvent(I)):D&&(h.video=D,h.video.loop=!0,h.video.addEventListener("playing",function(){h.map.triggerRepaint()}),h.map&&h.video.play(),h._finishLoading())})},d.prototype.pause=function(){this.video&&this.video.pause()},d.prototype.play=function(){this.video&&this.video.play()},d.prototype.seek=function(h){if(this.video){var g=this.video.seekable;h<g.start(0)||h>g.end(0)?this.fire(new y.ErrorEvent(new y.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+g.start(0)+" and "+g.end(0)+"-second mark."))):this.video.currentTime=h}},d.prototype.getVideo=function(){return this.video},d.prototype.onAdd=function(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},d.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var h=this.map.painter.context,g=h.gl;for(var w in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,ze.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE),g.texSubImage2D(g.TEXTURE_2D,0,0,0,g.RGBA,g.UNSIGNED_BYTE,this.video)):(this.texture=new y.Texture(h,this.video,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE)),this.tiles){var M=this.tiles[w];M.state!=="loaded"&&(M.state="loaded",M.texture=this.texture)}}},d.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},d.prototype.hasTransition=function(){return this.video&&!this.video.paused},d}(et),Rt=function(f){function d(h,g,w,M){f.call(this,h,g,w,M),g.coordinates?Array.isArray(g.coordinates)&&g.coordinates.length===4&&!g.coordinates.some(function(I){return!Array.isArray(I)||I.length!==2||I.some(function(D){return typeof D!="number"})})||this.fire(new y.ErrorEvent(new y.ValidationError("sources."+h,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new y.ErrorEvent(new y.ValidationError("sources."+h,null,'missing required property "coordinates"'))),g.animate&&typeof g.animate!="boolean"&&this.fire(new y.ErrorEvent(new y.ValidationError("sources."+h,null,'optional "animate" property must be a boolean value'))),g.canvas?typeof g.canvas=="string"||g.canvas instanceof y.window.HTMLCanvasElement||this.fire(new y.ErrorEvent(new y.ValidationError("sources."+h,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new y.ErrorEvent(new y.ValidationError("sources."+h,null,'missing required property "canvas"'))),this.options=g,this.animate=g.animate===void 0||g.animate}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof y.window.HTMLCanvasElement?this.options.canvas:y.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new y.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},d.prototype.getCanvas=function(){return this.canvas},d.prototype.onAdd=function(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()},d.prototype.onRemove=function(){this.pause()},d.prototype.prepare=function(){var h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var g=this.map.painter.context,w=g.gl;for(var M in this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,ze.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(h||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new y.Texture(g,this.canvas,w.RGBA,{premultiply:!0}),this.tiles){var I=this.tiles[M];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture)}}},d.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},d.prototype.hasTransition=function(){return this._playing},d.prototype._hasInvalidDimensions=function(){for(var h=0,g=[this.canvas.width,this.canvas.height];h<g.length;h+=1){var w=g[h];if(isNaN(w)||w<=0)return!0}return!1},d}(et),Jt={vector:Fe,raster:N,"raster-dem":z,geojson:ce,video:ht,image:et,canvas:Rt};function Or(f,d){var h=y.identity([]);return y.translate(h,h,[1,1,0]),y.scale(h,h,[.5*f.width,.5*f.height,1]),y.multiply(h,h,f.calculatePosMatrix(d.toUnwrapped()))}function Tr(f,d,h,g,w,M){var I=function(ot,Ze,Xe){if(ot)for(var de=0,Vt=ot;de<Vt.length;de+=1){var q=Ze[Vt[de]];if(q&&q.source===Xe&&q.type==="fill-extrusion")return!0}else for(var or in Ze){var dr=Ze[or];if(dr.source===Xe&&dr.type==="fill-extrusion")return!0}return!1}(w&&w.layers,d,f.id),D=M.maxPitchScaleFactor(),G=f.tilesIn(g,D,I);G.sort(Pn);for(var te=[],he=0,Se=G;he<Se.length;he+=1){var Ae=Se[he];te.push({wrappedTileID:Ae.tileID.wrapped().key,queryResults:Ae.tile.queryRenderedFeatures(d,h,f._state,Ae.queryGeometry,Ae.cameraQueryGeometry,Ae.scale,w,M,D,Or(f.transform,Ae.tileID))})}var We=function(ot){for(var Ze={},Xe={},de=0,Vt=ot;de<Vt.length;de+=1){var q=Vt[de],or=q.queryResults,dr=q.wrappedTileID,Fr=Xe[dr]=Xe[dr]||{};for(var on in or)for(var nn=or[on],Tn=Fr[on]=Fr[on]||{},ri=Ze[on]=Ze[on]||[],Jn=0,ii=nn;Jn<ii.length;Jn+=1){var Ui=ii[Jn];Tn[Ui.featureIndex]||(Tn[Ui.featureIndex]=!0,ri.push(Ui))}}return Ze}(te);for(var Ge in We)We[Ge].forEach(function(ot){var Ze=ot.feature,Xe=f.getFeatureState(Ze.layer["source-layer"],Ze.id);Ze.source=Ze.layer.source,Ze.layer["source-layer"]&&(Ze.sourceLayer=Ze.layer["source-layer"]),Ze.state=Xe});return We}function Pn(f,d){var h=f.tileID,g=d.tileID;return h.overscaledZ-g.overscaledZ||h.canonical.y-g.canonical.y||h.wrap-g.wrap||h.canonical.x-g.canonical.x}var Nr=function(f,d){this.max=f,this.onRemove=d,this.reset()};Nr.prototype.reset=function(){for(var f in this.data)for(var d=0,h=this.data[f];d<h.length;d+=1){var g=h[d];g.timeout&&clearTimeout(g.timeout),this.onRemove(g.value)}return this.data={},this.order=[],this},Nr.prototype.add=function(f,d,h){var g=this,w=f.wrapped().key;this.data[w]===void 0&&(this.data[w]=[]);var M={value:d,timeout:void 0};if(h!==void 0&&(M.timeout=setTimeout(function(){g.remove(f,M)},h)),this.data[w].push(M),this.order.push(w),this.order.length>this.max){var I=this._getAndRemoveByKey(this.order[0]);I&&this.onRemove(I)}return this},Nr.prototype.has=function(f){return f.wrapped().key in this.data},Nr.prototype.getAndRemove=function(f){return this.has(f)?this._getAndRemoveByKey(f.wrapped().key):null},Nr.prototype._getAndRemoveByKey=function(f){var d=this.data[f].shift();return d.timeout&&clearTimeout(d.timeout),this.data[f].length===0&&delete this.data[f],this.order.splice(this.order.indexOf(f),1),d.value},Nr.prototype.getByKey=function(f){var d=this.data[f];return d?d[0].value:null},Nr.prototype.get=function(f){return this.has(f)?this.data[f.wrapped().key][0].value:null},Nr.prototype.remove=function(f,d){if(!this.has(f))return this;var h=f.wrapped().key,g=d===void 0?0:this.data[h].indexOf(d),w=this.data[h][g];return this.data[h].splice(g,1),w.timeout&&clearTimeout(w.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(w.value),this.order.splice(this.order.indexOf(h),1),this},Nr.prototype.setMaxSize=function(f){for(this.max=f;this.order.length>this.max;){var d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this},Nr.prototype.filter=function(f){var d=[];for(var h in this.data)for(var g=0,w=this.data[h];g<w.length;g+=1){var M=w[g];f(M.value)||d.push(M)}for(var I=0,D=d;I<D.length;I+=1){var G=D[I];this.remove(G.value.tileID,G)}};var wn=function(f,d,h){this.context=f;var g=f.gl;this.buffer=g.createBuffer(),this.dynamicDraw=Boolean(h),this.context.unbindVAO(),f.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer};wn.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},wn.prototype.updateData=function(f){var d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,f.arrayBuffer)},wn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Xi={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},mi=function(f,d,h,g){this.length=d.length,this.attributes=h,this.itemSize=d.bytesPerElement,this.dynamicDraw=g,this.context=f;var w=f.gl;this.buffer=w.createBuffer(),f.bindVertexBuffer.set(this.buffer),w.bufferData(w.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer};mi.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},mi.prototype.updateData=function(f){var d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,f.arrayBuffer)},mi.prototype.enableAttributes=function(f,d){for(var h=0;h<this.attributes.length;h++){var g=d.attributes[this.attributes[h].name];g!==void 0&&f.enableVertexAttribArray(g)}},mi.prototype.setVertexAttribPointers=function(f,d,h){for(var g=0;g<this.attributes.length;g++){var w=this.attributes[g],M=d.attributes[w.name];M!==void 0&&f.vertexAttribPointer(M,w.components,f[Xi[w.type]],!1,this.itemSize,w.offset+this.itemSize*(h||0))}},mi.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var si=function(f){this.gl=f.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};si.prototype.get=function(){return this.current},si.prototype.set=function(f){},si.prototype.getDefault=function(){return this.default},si.prototype.setDefault=function(){this.set(this.default)};var ki=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return y.Color.transparent},d.prototype.set=function(h){var g=this.current;(h.r!==g.r||h.g!==g.g||h.b!==g.b||h.a!==g.a||this.dirty)&&(this.gl.clearColor(h.r,h.g,h.b,h.a),this.current=h,this.dirty=!1)},d}(si),bi=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return 1},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.clearDepth(h),this.current=h,this.dirty=!1)},d}(si),li=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return 0},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.clearStencil(h),this.current=h,this.dirty=!1)},d}(si),Zn=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return[!0,!0,!0,!0]},d.prototype.set=function(h){var g=this.current;(h[0]!==g[0]||h[1]!==g[1]||h[2]!==g[2]||h[3]!==g[3]||this.dirty)&&(this.gl.colorMask(h[0],h[1],h[2],h[3]),this.current=h,this.dirty=!1)},d}(si),qn=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!0},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.depthMask(h),this.current=h,this.dirty=!1)},d}(si),ro=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return 255},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.stencilMask(h),this.current=h,this.dirty=!1)},d}(si),ka=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},d.prototype.set=function(h){var g=this.current;(h.func!==g.func||h.ref!==g.ref||h.mask!==g.mask||this.dirty)&&(this.gl.stencilFunc(h.func,h.ref,h.mask),this.current=h,this.dirty=!1)},d}(si),oa=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){var h=this.gl;return[h.KEEP,h.KEEP,h.KEEP]},d.prototype.set=function(h){var g=this.current;(h[0]!==g[0]||h[1]!==g[1]||h[2]!==g[2]||this.dirty)&&(this.gl.stencilOp(h[0],h[1],h[2]),this.current=h,this.dirty=!1)},d}(si),Tt=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;h?g.enable(g.STENCIL_TEST):g.disable(g.STENCIL_TEST),this.current=h,this.dirty=!1}},d}(si),ge=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return[0,1]},d.prototype.set=function(h){var g=this.current;(h[0]!==g[0]||h[1]!==g[1]||this.dirty)&&(this.gl.depthRange(h[0],h[1]),this.current=h,this.dirty=!1)},d}(si),ue=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;h?g.enable(g.DEPTH_TEST):g.disable(g.DEPTH_TEST),this.current=h,this.dirty=!1}},d}(si),we=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.LESS},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.depthFunc(h),this.current=h,this.dirty=!1)},d}(si),Z=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;h?g.enable(g.BLEND):g.disable(g.BLEND),this.current=h,this.dirty=!1}},d}(si),Je=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){var h=this.gl;return[h.ONE,h.ZERO]},d.prototype.set=function(h){var g=this.current;(h[0]!==g[0]||h[1]!==g[1]||this.dirty)&&(this.gl.blendFunc(h[0],h[1]),this.current=h,this.dirty=!1)},d}(si),Xt=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return y.Color.transparent},d.prototype.set=function(h){var g=this.current;(h.r!==g.r||h.g!==g.g||h.b!==g.b||h.a!==g.a||this.dirty)&&(this.gl.blendColor(h.r,h.g,h.b,h.a),this.current=h,this.dirty=!1)},d}(si),Dr=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.FUNC_ADD},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.blendEquation(h),this.current=h,this.dirty=!1)},d}(si),tt=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;h?g.enable(g.CULL_FACE):g.disable(g.CULL_FACE),this.current=h,this.dirty=!1}},d}(si),It=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.BACK},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.cullFace(h),this.current=h,this.dirty=!1)},d}(si),mr=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.CCW},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.frontFace(h),this.current=h,this.dirty=!1)},d}(si),Ir=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)},d}(si),$r=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.TEXTURE0},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.activeTexture(h),this.current=h,this.dirty=!1)},d}(si),tn=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){var h=this.gl;return[0,0,h.drawingBufferWidth,h.drawingBufferHeight]},d.prototype.set=function(h){var g=this.current;(h[0]!==g[0]||h[1]!==g[1]||h[2]!==g[2]||h[3]!==g[3]||this.dirty)&&(this.gl.viewport(h[0],h[1],h[2],h[3]),this.current=h,this.dirty=!1)},d}(si),$n=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.bindFramebuffer(g.FRAMEBUFFER,h),this.current=h,this.dirty=!1}},d}(si),Vn=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.bindRenderbuffer(g.RENDERBUFFER,h),this.current=h,this.dirty=!1}},d}(si),rn=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.bindTexture(g.TEXTURE_2D,h),this.current=h,this.dirty=!1}},d}(si),vi=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.bindBuffer(g.ARRAY_BUFFER,h),this.current=h,this.dirty=!1}},d}(si),ni=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){var g=this.gl;g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,h),this.current=h,this.dirty=!1},d}(si),sa=function(f){function d(h){f.call(this,h),this.vao=h.extVertexArrayObject}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){this.vao&&(h!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(h),this.current=h,this.dirty=!1)},d}(si),Sa=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return 4},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_ALIGNMENT,h),this.current=h,this.dirty=!1}},d}(si),Na=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,h),this.current=h,this.dirty=!1}},d}(si),ga=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,h),this.current=h,this.dirty=!1}},d}(si),ta=function(f){function d(h,g){f.call(this,h),this.context=h,this.parent=g}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d}(si),Q=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.setDirty=function(){this.dirty=!0},d.prototype.set=function(h){if(h!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var g=this.gl;g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,h,0),this.current=h,this.dirty=!1}},d}(ta),ae=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.set=function(h){if(h!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var g=this.gl;g.framebufferRenderbuffer(g.FRAMEBUFFER,g.DEPTH_ATTACHMENT,g.RENDERBUFFER,h),this.current=h,this.dirty=!1}},d}(ta),me=function(f,d,h,g){this.context=f,this.width=d,this.height=h;var w=this.framebuffer=f.gl.createFramebuffer();this.colorAttachment=new Q(f,w),g&&(this.depthAttachment=new ae(f,w))};me.prototype.destroy=function(){var f=this.context.gl,d=this.colorAttachment.get();if(d&&f.deleteTexture(d),this.depthAttachment){var h=this.depthAttachment.get();h&&f.deleteRenderbuffer(h)}f.deleteFramebuffer(this.framebuffer)};var Me=function(f,d,h){this.func=f,this.mask=d,this.range=h};Me.ReadOnly=!1,Me.ReadWrite=!0,Me.disabled=new Me(519,Me.ReadOnly,[0,1]);var Ve=function(f,d,h,g,w,M){this.test=f,this.ref=d,this.mask=h,this.fail=g,this.depthFail=w,this.pass=M};Ve.disabled=new Ve({func:519,mask:0},0,0,7680,7680,7680);var at=function(f,d,h){this.blendFunction=f,this.blendColor=d,this.mask=h};at.disabled=new at(at.Replace=[1,0],y.Color.transparent,[!1,!1,!1,!1]),at.unblended=new at(at.Replace,y.Color.transparent,[!0,!0,!0,!0]),at.alphaBlended=new at([1,771],y.Color.transparent,[!0,!0,!0,!0]);var _t=function(f,d,h){this.enable=f,this.mode=d,this.frontFace=h};_t.disabled=new _t(!1,1029,2305),_t.backCCW=new _t(!0,1029,2305);var Ce=function(f){this.gl=f,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new ki(this),this.clearDepth=new bi(this),this.clearStencil=new li(this),this.colorMask=new Zn(this),this.depthMask=new qn(this),this.stencilMask=new ro(this),this.stencilFunc=new ka(this),this.stencilOp=new oa(this),this.stencilTest=new Tt(this),this.depthRange=new ge(this),this.depthTest=new ue(this),this.depthFunc=new we(this),this.blend=new Z(this),this.blendFunc=new Je(this),this.blendColor=new Xt(this),this.blendEquation=new Dr(this),this.cullFace=new tt(this),this.cullFaceSide=new It(this),this.frontFace=new mr(this),this.program=new Ir(this),this.activeTexture=new $r(this),this.viewport=new tn(this),this.bindFramebuffer=new $n(this),this.bindRenderbuffer=new Vn(this),this.bindTexture=new rn(this),this.bindVertexBuffer=new vi(this),this.bindElementBuffer=new ni(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new sa(this),this.pixelStoreUnpack=new Sa(this),this.pixelStoreUnpackPremultiplyAlpha=new Na(this),this.pixelStoreUnpackFlipY=new ga(this),this.extTextureFilterAnisotropic=f.getExtension("EXT_texture_filter_anisotropic")||f.getExtension("MOZ_EXT_texture_filter_anisotropic")||f.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=f.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=f.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(f.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=f.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=f.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=f.getParameter(f.MAX_TEXTURE_SIZE)};Ce.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},Ce.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},Ce.prototype.createIndexBuffer=function(f,d){return new wn(this,f,d)},Ce.prototype.createVertexBuffer=function(f,d,h){return new mi(this,f,d,h)},Ce.prototype.createRenderbuffer=function(f,d,h){var g=this.gl,w=g.createRenderbuffer();return this.bindRenderbuffer.set(w),g.renderbufferStorage(g.RENDERBUFFER,f,d,h),this.bindRenderbuffer.set(null),w},Ce.prototype.createFramebuffer=function(f,d,h){return new me(this,f,d,h)},Ce.prototype.clear=function(f){var d=f.color,h=f.depth,g=this.gl,w=0;d&&(w|=g.COLOR_BUFFER_BIT,this.clearColor.set(d),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(w|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),g.clear(w)},Ce.prototype.setCullFace=function(f){f.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(f.mode),this.frontFace.set(f.frontFace))},Ce.prototype.setDepthMode=function(f){f.func!==this.gl.ALWAYS||f.mask?(this.depthTest.set(!0),this.depthFunc.set(f.func),this.depthMask.set(f.mask),this.depthRange.set(f.range)):this.depthTest.set(!1)},Ce.prototype.setStencilMode=function(f){f.test.func!==this.gl.ALWAYS||f.mask?(this.stencilTest.set(!0),this.stencilMask.set(f.mask),this.stencilOp.set([f.fail,f.depthFail,f.pass]),this.stencilFunc.set({func:f.test.func,ref:f.ref,mask:f.test.mask})):this.stencilTest.set(!1)},Ce.prototype.setColorMode=function(f){y.deepEqual(f.blendFunction,at.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(f.blendFunction),this.blendColor.set(f.blendColor)),this.colorMask.set(f.mask)},Ce.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var $e=function(f){function d(h,g,w){var M=this;f.call(this),this.id=h,this.dispatcher=w,this.on("data",function(I){I.dataType==="source"&&I.sourceDataType==="metadata"&&(M._sourceLoaded=!0),M._sourceLoaded&&!M._paused&&I.dataType==="source"&&I.sourceDataType==="content"&&(M.reload(),M.transform&&M.update(M.transform))}),this.on("error",function(){M._sourceErrored=!0}),this._source=function(I,D,G,te){var he=new Jt[D.type](I,D,G,te);if(he.id!==I)throw new Error("Expected Source id to be "+I+" instead of "+he.id);return y.bindAll(["load","abort","unload","serialize","prepare"],he),he}(h,g,w,this),this._tiles={},this._cache=new Nr(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new y.SourceFeatureState}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.onAdd=function(h){this.map=h,this._maxTileCacheSize=h?h._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(h)},d.prototype.onRemove=function(h){this._source&&this._source.onRemove&&this._source.onRemove(h)},d.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var h in this._tiles){var g=this._tiles[h];if(g.state!=="loaded"&&g.state!=="errored")return!1}return!0},d.prototype.getSource=function(){return this._source},d.prototype.pause=function(){this._paused=!0},d.prototype.resume=function(){if(this._paused){var h=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,h&&this.reload(),this.transform&&this.update(this.transform)}},d.prototype._loadTile=function(h,g){return this._source.loadTile(h,g)},d.prototype._unloadTile=function(h){if(this._source.unloadTile)return this._source.unloadTile(h,function(){})},d.prototype._abortTile=function(h){if(this._source.abortTile)return this._source.abortTile(h,function(){})},d.prototype.serialize=function(){return this._source.serialize()},d.prototype.prepare=function(h){for(var g in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var w=this._tiles[g];w.upload(h),w.prepare(this.map.style.imageManager)}},d.prototype.getIds=function(){return y.values(this._tiles).map(function(h){return h.tileID}).sort(Zt).map(function(h){return h.key})},d.prototype.getRenderableIds=function(h){var g=this,w=[];for(var M in this._tiles)this._isIdRenderable(M,h)&&w.push(this._tiles[M]);return h?w.sort(function(I,D){var G=I.tileID,te=D.tileID,he=new y.Point(G.canonical.x,G.canonical.y)._rotate(g.transform.angle),Se=new y.Point(te.canonical.x,te.canonical.y)._rotate(g.transform.angle);return G.overscaledZ-te.overscaledZ||Se.y-he.y||Se.x-he.x}).map(function(I){return I.tileID.key}):w.map(function(I){return I.tileID}).sort(Zt).map(function(I){return I.key})},d.prototype.hasRenderableParent=function(h){var g=this.findLoadedParent(h,0);return!!g&&this._isIdRenderable(g.tileID.key)},d.prototype._isIdRenderable=function(h,g){return this._tiles[h]&&this._tiles[h].hasData()&&!this._coveredTiles[h]&&(g||!this._tiles[h].holdingForFade())},d.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var h in this._cache.reset(),this._tiles)this._tiles[h].state!=="errored"&&this._reloadTile(h,"reloading")},d.prototype._reloadTile=function(h,g){var w=this._tiles[h];w&&(w.state!=="loading"&&(w.state=g),this._loadTile(w,this._tileLoaded.bind(this,w,h,g)))},d.prototype._tileLoaded=function(h,g,w,M){if(M)return h.state="errored",void(M.status!==404?this._source.fire(new y.ErrorEvent(M,{tile:h})):this.update(this.transform));h.timeAdded=y.browser.now(),w==="expired"&&(h.refreshedUponExpiration=!0),this._setTileReloadTimer(g,h),this.getSource().type==="raster-dem"&&h.dem&&this._backfillDEM(h),this._state.initializeTileState(h,this.map?this.map.painter:null),this._source.fire(new y.Event("data",{dataType:"source",tile:h,coord:h.tileID}))},d.prototype._backfillDEM=function(h){for(var g=this.getRenderableIds(),w=0;w<g.length;w++){var M=g[w];if(h.neighboringTiles&&h.neighboringTiles[M]){var I=this.getTileByID(M);D(h,I),D(I,h)}}function D(G,te){G.needsHillshadePrepare=!0;var he=te.tileID.canonical.x-G.tileID.canonical.x,Se=te.tileID.canonical.y-G.tileID.canonical.y,Ae=Math.pow(2,G.tileID.canonical.z),We=te.tileID.key;he===0&&Se===0||Math.abs(Se)>1||(Math.abs(he)>1&&(Math.abs(he+Ae)===1?he+=Ae:Math.abs(he-Ae)===1&&(he-=Ae)),te.dem&&G.dem&&(G.dem.backfillBorder(te.dem,he,Se),G.neighboringTiles&&G.neighboringTiles[We]&&(G.neighboringTiles[We].backfilled=!0)))}},d.prototype.getTile=function(h){return this.getTileByID(h.key)},d.prototype.getTileByID=function(h){return this._tiles[h]},d.prototype._retainLoadedChildren=function(h,g,w,M){for(var I in this._tiles){var D=this._tiles[I];if(!(M[I]||!D.hasData()||D.tileID.overscaledZ<=g||D.tileID.overscaledZ>w)){for(var G=D.tileID;D&&D.tileID.overscaledZ>g+1;){var te=D.tileID.scaledTo(D.tileID.overscaledZ-1);(D=this._tiles[te.key])&&D.hasData()&&(G=te)}for(var he=G;he.overscaledZ>g;)if(h[(he=he.scaledTo(he.overscaledZ-1)).key]){M[G.key]=G;break}}}},d.prototype.findLoadedParent=function(h,g){if(h.key in this._loadedParentTiles){var w=this._loadedParentTiles[h.key];return w&&w.tileID.overscaledZ>=g?w:null}for(var M=h.overscaledZ-1;M>=g;M--){var I=h.scaledTo(M),D=this._getLoadedTile(I);if(D)return D}},d.prototype._getLoadedTile=function(h){var g=this._tiles[h.key];return g&&g.hasData()?g:this._cache.getByKey(h.wrapped().key)},d.prototype.updateCacheSize=function(h){var g=Math.ceil(h.width/this._source.tileSize)+1,w=Math.ceil(h.height/this._source.tileSize)+1,M=Math.floor(g*w*5),I=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,M):M;this._cache.setMaxSize(I)},d.prototype.handleWrapJump=function(h){var g=Math.round((h-(this._prevLng===void 0?h:this._prevLng))/360);if(this._prevLng=h,g){var w={};for(var M in this._tiles){var I=this._tiles[M];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+g),w[I.tileID.key]=I}for(var D in this._tiles=w,this._timers)clearTimeout(this._timers[D]),delete this._timers[D];for(var G in this._tiles)this._setTileReloadTimer(G,this._tiles[G])}},d.prototype.update=function(h){var g=this;if(this.transform=h,this._sourceLoaded&&!this._paused){var w;this.updateCacheSize(h),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?w=h.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(Fr){return new y.OverscaledTileID(Fr.canonical.z,Fr.wrap,Fr.canonical.z,Fr.canonical.x,Fr.canonical.y)}):(w=h.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(w=w.filter(function(Fr){return g._source.hasTile(Fr)}))):w=[];var M=h.coveringZoomLevel(this._source),I=Math.max(M-d.maxOverzooming,this._source.minzoom),D=Math.max(M+d.maxUnderzooming,this._source.minzoom),G=this._updateRetainedTiles(w,M);if(Rr(this._source.type)){for(var te={},he={},Se=0,Ae=Object.keys(G);Se<Ae.length;Se+=1){var We=Ae[Se],Ge=G[We],ot=this._tiles[We];if(ot&&!(ot.fadeEndTime&&ot.fadeEndTime<=y.browser.now())){var Ze=this.findLoadedParent(Ge,I);Ze&&(this._addTile(Ze.tileID),te[Ze.tileID.key]=Ze.tileID),he[We]=Ge}}for(var Xe in this._retainLoadedChildren(he,M,D,G),te)G[Xe]||(this._coveredTiles[Xe]=!0,G[Xe]=te[Xe])}for(var de in G)this._tiles[de].clearFadeHold();for(var Vt=0,q=y.keysDifference(this._tiles,G);Vt<q.length;Vt+=1){var or=q[Vt],dr=this._tiles[or];dr.hasSymbolBuckets&&!dr.holdingForFade()?dr.setHoldDuration(this.map._fadeDuration):dr.hasSymbolBuckets&&!dr.symbolFadeFinished()||this._removeTile(or)}this._updateLoadedParentTileCache()}},d.prototype.releaseSymbolFadeTiles=function(){for(var h in this._tiles)this._tiles[h].holdingForFade()&&this._removeTile(h)},d.prototype._updateRetainedTiles=function(h,g){for(var w={},M={},I=Math.max(g-d.maxOverzooming,this._source.minzoom),D=Math.max(g+d.maxUnderzooming,this._source.minzoom),G={},te=0,he=h;te<he.length;te+=1){var Se=he[te],Ae=this._addTile(Se);w[Se.key]=Se,Ae.hasData()||g<this._source.maxzoom&&(G[Se.key]=Se)}this._retainLoadedChildren(G,g,D,w);for(var We=0,Ge=h;We<Ge.length;We+=1){var ot=Ge[We],Ze=this._tiles[ot.key];if(!Ze.hasData()){if(g+1>this._source.maxzoom){var Xe=ot.children(this._source.maxzoom)[0],de=this.getTile(Xe);if(de&&de.hasData()){w[Xe.key]=Xe;continue}}else{var Vt=ot.children(this._source.maxzoom);if(w[Vt[0].key]&&w[Vt[1].key]&&w[Vt[2].key]&&w[Vt[3].key])continue}for(var q=Ze.wasRequested(),or=ot.overscaledZ-1;or>=I;--or){var dr=ot.scaledTo(or);if(M[dr.key]||(M[dr.key]=!0,!(Ze=this.getTile(dr))&&q&&(Ze=this._addTile(dr)),Ze&&(w[dr.key]=dr,q=Ze.wasRequested(),Ze.hasData())))break}}}return w},d.prototype._updateLoadedParentTileCache=function(){for(var h in this._loadedParentTiles={},this._tiles){for(var g=[],w=void 0,M=this._tiles[h].tileID;M.overscaledZ>0;){if(M.key in this._loadedParentTiles){w=this._loadedParentTiles[M.key];break}g.push(M.key);var I=M.scaledTo(M.overscaledZ-1);if(w=this._getLoadedTile(I))break;M=I}for(var D=0,G=g;D<G.length;D+=1)this._loadedParentTiles[G[D]]=w}},d.prototype._addTile=function(h){var g=this._tiles[h.key];if(g)return g;(g=this._cache.getAndRemove(h))&&(this._setTileReloadTimer(h.key,g),g.tileID=h,this._state.initializeTileState(g,this.map?this.map.painter:null),this._cacheTimers[h.key]&&(clearTimeout(this._cacheTimers[h.key]),delete this._cacheTimers[h.key],this._setTileReloadTimer(h.key,g)));var w=Boolean(g);return w||(g=new y.Tile(h,this._source.tileSize*h.overscaleFactor()),this._loadTile(g,this._tileLoaded.bind(this,g,h.key,g.state))),g?(g.uses++,this._tiles[h.key]=g,w||this._source.fire(new y.Event("dataloading",{tile:g,coord:g.tileID,dataType:"source"})),g):null},d.prototype._setTileReloadTimer=function(h,g){var w=this;h in this._timers&&(clearTimeout(this._timers[h]),delete this._timers[h]);var M=g.getExpiryTimeout();M&&(this._timers[h]=setTimeout(function(){w._reloadTile(h,"expired"),delete w._timers[h]},M))},d.prototype._removeTile=function(h){var g=this._tiles[h];g&&(g.uses--,delete this._tiles[h],this._timers[h]&&(clearTimeout(this._timers[h]),delete this._timers[h]),g.uses>0||(g.hasData()&&g.state!=="reloading"?this._cache.add(g.tileID,g,g.getExpiryTimeout()):(g.aborted=!0,this._abortTile(g),this._unloadTile(g))))},d.prototype.clearTiles=function(){for(var h in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(h);this._cache.reset()},d.prototype.tilesIn=function(h,g,w){var M=this,I=[],D=this.transform;if(!D)return I;for(var G=w?D.getCameraQueryGeometry(h):h,te=h.map(function(or){return D.pointCoordinate(or)}),he=G.map(function(or){return D.pointCoordinate(or)}),Se=this.getIds(),Ae=1/0,We=1/0,Ge=-1/0,ot=-1/0,Ze=0,Xe=he;Ze<Xe.length;Ze+=1){var de=Xe[Ze];Ae=Math.min(Ae,de.x),We=Math.min(We,de.y),Ge=Math.max(Ge,de.x),ot=Math.max(ot,de.y)}for(var Vt=function(or){var dr=M._tiles[Se[or]];if(!dr.holdingForFade()){var Fr=dr.tileID,on=Math.pow(2,D.zoom-dr.tileID.overscaledZ),nn=g*dr.queryPadding*y.EXTENT/dr.tileSize/on,Tn=[Fr.getTilePoint(new y.MercatorCoordinate(Ae,We)),Fr.getTilePoint(new y.MercatorCoordinate(Ge,ot))];if(Tn[0].x-nn<y.EXTENT&&Tn[0].y-nn<y.EXTENT&&Tn[1].x+nn>=0&&Tn[1].y+nn>=0){var ri=te.map(function(ii){return Fr.getTilePoint(ii)}),Jn=he.map(function(ii){return Fr.getTilePoint(ii)});I.push({tile:dr,tileID:Fr,queryGeometry:ri,cameraQueryGeometry:Jn,scale:on})}}},q=0;q<Se.length;q++)Vt(q);return I},d.prototype.getVisibleCoordinates=function(h){for(var g=this,w=this.getRenderableIds(h).map(function(G){return g._tiles[G].tileID}),M=0,I=w;M<I.length;M+=1){var D=I[M];D.posMatrix=this.transform.calculatePosMatrix(D.toUnwrapped())}return w},d.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Rr(this._source.type))for(var h in this._tiles){var g=this._tiles[h];if(g.fadeEndTime!==void 0&&g.fadeEndTime>=y.browser.now())return!0}return!1},d.prototype.setFeatureState=function(h,g,w){this._state.updateState(h=h||"_geojsonTileLayer",g,w)},d.prototype.removeFeatureState=function(h,g,w){this._state.removeFeatureState(h=h||"_geojsonTileLayer",g,w)},d.prototype.getFeatureState=function(h,g){return this._state.getState(h=h||"_geojsonTileLayer",g)},d.prototype.setDependencies=function(h,g,w){var M=this._tiles[h];M&&M.setDependencies(g,w)},d.prototype.reloadTilesForDependencies=function(h,g){for(var w in this._tiles)this._tiles[w].hasDependency(h,g)&&this._reloadTile(w,"reloading");this._cache.filter(function(M){return!M.hasDependency(h,g)})},d}(y.Evented);function Zt(f,d){var h=Math.abs(2*f.wrap)-+(f.wrap<0),g=Math.abs(2*d.wrap)-+(d.wrap<0);return f.overscaledZ-d.overscaledZ||g-h||d.canonical.y-f.canonical.y||d.canonical.x-f.canonical.x}function Rr(f){return f==="raster"||f==="image"||f==="video"}function nr(){return new y.window.Worker(Xc.workerUrl)}$e.maxOverzooming=10,$e.maxUnderzooming=3;var lr="mapboxgl_preloaded_worker_pool",Lr=function(){this.active={}};Lr.prototype.acquire=function(f){if(!this.workers)for(this.workers=[];this.workers.length<Lr.workerCount;)this.workers.push(new nr);return this.active[f]=!0,this.workers.slice()},Lr.prototype.release=function(f){delete this.active[f],this.numActive()===0&&(this.workers.forEach(function(d){d.terminate()}),this.workers=null)},Lr.prototype.isPreloaded=function(){return!!this.active[lr]},Lr.prototype.numActive=function(){return Object.keys(this.active).length};var Dn,Mn=Math.floor(y.browser.hardwareConcurrency/2);function $t(){return Dn||(Dn=new Lr),Dn}function Cn(f,d){var h={};for(var g in f)g!=="ref"&&(h[g]=f[g]);return y.refProperties.forEach(function(w){w in d&&(h[w]=d[w])}),h}function hr(f){f=f.slice();for(var d=Object.create(null),h=0;h<f.length;h++)d[f[h].id]=f[h];for(var g=0;g<f.length;g++)"ref"in f[g]&&(f[g]=Cn(f[g],d[f[g].ref]));return f}Lr.workerCount=Math.max(Math.min(Mn,6),1);var St={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Ei(f,d,h){h.push({command:St.addSource,args:[f,d[f]]})}function mn(f,d,h){d.push({command:St.removeSource,args:[f]}),h[f]=!0}function Oi(f,d,h,g){mn(f,h,g),Ei(f,d,h)}function ua(f,d,h){var g;for(g in f[h])if(f[h].hasOwnProperty(g)&&g!=="data"&&!y.deepEqual(f[h][g],d[h][g]))return!1;for(g in d[h])if(d[h].hasOwnProperty(g)&&g!=="data"&&!y.deepEqual(f[h][g],d[h][g]))return!1;return!0}function xt(f,d,h,g,w,M){var I;for(I in d=d||{},f=f||{})f.hasOwnProperty(I)&&(y.deepEqual(f[I],d[I])||h.push({command:M,args:[g,I,d[I],w]}));for(I in d)d.hasOwnProperty(I)&&!f.hasOwnProperty(I)&&(y.deepEqual(f[I],d[I])||h.push({command:M,args:[g,I,d[I],w]}))}function wt(f){return f.id}function Ri(f,d){return f[d.id]=d,f}var pi=function(f,d){this.reset(f,d)};pi.prototype.reset=function(f,d){this.points=f||[],this._distances=[0];for(var h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding},pi.prototype.lerp=function(f){if(this.points.length===1)return this.points[0];f=y.clamp(f,0,1);for(var d=1,h=this._distances[d],g=f*this.paddedLength+this.padding;h<g&&d<this._distances.length;)h=this._distances[++d];var w=d-1,M=this._distances[w],I=h-M,D=I>0?(g-M)/I:0;return this.points[w].mult(1-D).add(this.points[d].mult(D))};var Ji=function(f,d,h){var g=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(f/h),this.yCellCount=Math.ceil(d/h);for(var M=0;M<this.xCellCount*this.yCellCount;M++)g.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=f,this.height=d,this.xScale=this.xCellCount/f,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0};function ea(f,d,h,g,w){var M=y.create();return d?(y.scale(M,M,[1/w,1/w,1]),h||y.rotateZ(M,M,g.angle)):y.multiply(M,g.labelPlaneMatrix,f),M}function la(f,d,h,g,w){if(d){var M=y.clone(f);return y.scale(M,M,[w,w,1]),h||y.rotateZ(M,M,-g.angle),M}return g.glCoordMatrix}function Di(f,d){var h=[f.x,f.y,0,1];Wa(h,h,d);var g=h[3];return{point:new y.Point(h[0]/g,h[1]/g),signedDistanceFromCamera:g}}function gr(f,d){return .5+f/d*.5}function Cr(f,d){var h=f[0]/f[3],g=f[1]/f[3];return h>=-d[0]&&h<=d[0]&&g>=-d[1]&&g<=d[1]}function rt(f,d,h,g,w,M,I,D){var G=g?f.textSizeData:f.iconSizeData,te=y.evaluateSizeForZoom(G,h.transform.zoom),he=[256/h.width*2+1,256/h.height*2+1],Se=g?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;Se.clear();for(var Ae=f.lineVertexArray,We=g?f.text.placedSymbolArray:f.icon.placedSymbolArray,Ge=h.transform.width/h.transform.height,ot=!1,Ze=0;Ze<We.length;Ze++){var Xe=We.get(Ze);if(Xe.hidden||Xe.writingMode===y.WritingMode.vertical&&!ot)no(Xe.numGlyphs,Se);else{ot=!1;var de=[Xe.anchorX,Xe.anchorY,0,1];if(y.transformMat4(de,de,d),Cr(de,he)){var Vt=gr(h.transform.cameraToCenterDistance,de[3]),q=y.evaluateSizeForFeature(G,te,Xe),or=I?q/Vt:q*Vt,dr=new y.Point(Xe.anchorX,Xe.anchorY),Fr=Di(dr,w).point,on={},nn=ws(Xe,or,!1,D,d,w,M,f.glyphOffsetArray,Ae,Se,Fr,dr,on,Ge);ot=nn.useVertical,(nn.notEnoughRoom||ot||nn.needsFlipping&&ws(Xe,or,!0,D,d,w,M,f.glyphOffsetArray,Ae,Se,Fr,dr,on,Ge).notEnoughRoom)&&no(Xe.numGlyphs,Se)}else no(Xe.numGlyphs,Se)}}g?f.text.dynamicLayoutVertexBuffer.updateData(Se):f.icon.dynamicLayoutVertexBuffer.updateData(Se)}function Aa(f,d,h,g,w,M,I,D,G,te,he){var Se=D.glyphStartIndex+D.numGlyphs,Ae=D.lineStartIndex,We=D.lineStartIndex+D.lineLength,Ge=d.getoffsetX(D.glyphStartIndex),ot=d.getoffsetX(Se-1),Ze=ia(f*Ge,h,g,w,M,I,D.segment,Ae,We,G,te,he);if(!Ze)return null;var Xe=ia(f*ot,h,g,w,M,I,D.segment,Ae,We,G,te,he);return Xe?{first:Ze,last:Xe}:null}function De(f,d,h,g){return f===y.WritingMode.horizontal&&Math.abs(h.y-d.y)>Math.abs(h.x-d.x)*g?{useVertical:!0}:(f===y.WritingMode.vertical?d.y<h.y:d.x>h.x)?{needsFlipping:!0}:null}function ws(f,d,h,g,w,M,I,D,G,te,he,Se,Ae,We){var Ge,ot=d/24,Ze=f.lineOffsetX*ot,Xe=f.lineOffsetY*ot;if(f.numGlyphs>1){var de=f.glyphStartIndex+f.numGlyphs,Vt=f.lineStartIndex,q=f.lineStartIndex+f.lineLength,or=Aa(ot,D,Ze,Xe,h,he,Se,f,G,M,Ae);if(!or)return{notEnoughRoom:!0};var dr=Di(or.first.point,I).point,Fr=Di(or.last.point,I).point;if(g&&!h){var on=De(f.writingMode,dr,Fr,We);if(on)return on}Ge=[or.first];for(var nn=f.glyphStartIndex+1;nn<de-1;nn++)Ge.push(ia(ot*D.getoffsetX(nn),Ze,Xe,h,he,Se,f.segment,Vt,q,G,M,Ae));Ge.push(or.last)}else{if(g&&!h){var Tn=Di(Se,w).point,ri=f.lineStartIndex+f.segment+1,Jn=new y.Point(G.getx(ri),G.gety(ri)),ii=Di(Jn,w),Ui=ii.signedDistanceFromCamera>0?ii.point:os(Se,Jn,Tn,1,w),En=De(f.writingMode,Tn,Ui,We);if(En)return En}var wi=ia(ot*D.getoffsetX(f.glyphStartIndex),Ze,Xe,h,he,Se,f.segment,f.lineStartIndex,f.lineStartIndex+f.lineLength,G,M,Ae);if(!wi)return{notEnoughRoom:!0};Ge=[wi]}for(var Ti=0,yi=Ge;Ti<yi.length;Ti+=1){var ui=yi[Ti];y.addDynamicAttributes(te,ui.point,ui.angle)}return{}}function os(f,d,h,g,w){var M=Di(f.add(f.sub(d)._unit()),w).point,I=h.sub(M);return h.add(I._mult(g/I.mag()))}function ia(f,d,h,g,w,M,I,D,G,te,he,Se){var Ae=g?f-d:f+d,We=Ae>0?1:-1,Ge=0;g&&(We*=-1,Ge=Math.PI),We<0&&(Ge+=Math.PI);for(var ot=We>0?D+I:D+I+1,Ze=w,Xe=w,de=0,Vt=0,q=Math.abs(Ae),or=[];de+Vt<=q;){if((ot+=We)<D||ot>=G)return null;if(Xe=Ze,or.push(Ze),(Ze=Se[ot])===void 0){var dr=new y.Point(te.getx(ot),te.gety(ot)),Fr=Di(dr,he);if(Fr.signedDistanceFromCamera>0)Ze=Se[ot]=Fr.point;else{var on=ot-We;Ze=os(de===0?M:new y.Point(te.getx(on),te.gety(on)),dr,Xe,q-de+1,he)}}de+=Vt,Vt=Xe.dist(Ze)}var nn=(q-de)/Vt,Tn=Ze.sub(Xe),ri=Tn.mult(nn)._add(Xe);ri._add(Tn._unit()._perp()._mult(h*We));var Jn=Ge+Math.atan2(Ze.y-Xe.y,Ze.x-Xe.x);return or.push(ri),{point:ri,angle:Jn,path:or}}Ji.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Ji.prototype.insert=function(f,d,h,g,w){this._forEachCell(d,h,g,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(f),this.bboxes.push(d),this.bboxes.push(h),this.bboxes.push(g),this.bboxes.push(w)},Ji.prototype.insertCircle=function(f,d,h,g){this._forEachCell(d-g,h-g,d+g,h+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(f),this.circles.push(d),this.circles.push(h),this.circles.push(g)},Ji.prototype._insertBoxCell=function(f,d,h,g,w,M){this.boxCells[w].push(M)},Ji.prototype._insertCircleCell=function(f,d,h,g,w,M){this.circleCells[w].push(M)},Ji.prototype._query=function(f,d,h,g,w,M){if(h<0||f>this.width||g<0||d>this.height)return!w&&[];var I=[];if(f<=0&&d<=0&&this.width<=h&&this.height<=g){if(w)return!0;for(var D=0;D<this.boxKeys.length;D++)I.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(var G=0;G<this.circleKeys.length;G++){var te=this.circles[3*G],he=this.circles[3*G+1],Se=this.circles[3*G+2];I.push({key:this.circleKeys[G],x1:te-Se,y1:he-Se,x2:te+Se,y2:he+Se})}return M?I.filter(M):I}return this._forEachCell(f,d,h,g,this._queryCell,I,{hitTest:w,seenUids:{box:{},circle:{}}},M),w?I.length>0:I},Ji.prototype._queryCircle=function(f,d,h,g,w){var M=f-h,I=f+h,D=d-h,G=d+h;if(I<0||M>this.width||G<0||D>this.height)return!g&&[];var te=[];return this._forEachCell(M,D,I,G,this._queryCellCircle,te,{hitTest:g,circle:{x:f,y:d,radius:h},seenUids:{box:{},circle:{}}},w),g?te.length>0:te},Ji.prototype.query=function(f,d,h,g,w){return this._query(f,d,h,g,!1,w)},Ji.prototype.hitTest=function(f,d,h,g,w){return this._query(f,d,h,g,!0,w)},Ji.prototype.hitTestCircle=function(f,d,h,g){return this._queryCircle(f,d,h,!0,g)},Ji.prototype._queryCell=function(f,d,h,g,w,M,I,D){var G=I.seenUids,te=this.boxCells[w];if(te!==null)for(var he=this.bboxes,Se=0,Ae=te;Se<Ae.length;Se+=1){var We=Ae[Se];if(!G.box[We]){G.box[We]=!0;var Ge=4*We;if(f<=he[Ge+2]&&d<=he[Ge+3]&&h>=he[Ge+0]&&g>=he[Ge+1]&&(!D||D(this.boxKeys[We]))){if(I.hitTest)return M.push(!0),!0;M.push({key:this.boxKeys[We],x1:he[Ge],y1:he[Ge+1],x2:he[Ge+2],y2:he[Ge+3]})}}}var ot=this.circleCells[w];if(ot!==null)for(var Ze=this.circles,Xe=0,de=ot;Xe<de.length;Xe+=1){var Vt=de[Xe];if(!G.circle[Vt]){G.circle[Vt]=!0;var q=3*Vt;if(this._circleAndRectCollide(Ze[q],Ze[q+1],Ze[q+2],f,d,h,g)&&(!D||D(this.circleKeys[Vt]))){if(I.hitTest)return M.push(!0),!0;var or=Ze[q],dr=Ze[q+1],Fr=Ze[q+2];M.push({key:this.circleKeys[Vt],x1:or-Fr,y1:dr-Fr,x2:or+Fr,y2:dr+Fr})}}}},Ji.prototype._queryCellCircle=function(f,d,h,g,w,M,I,D){var G=I.circle,te=I.seenUids,he=this.boxCells[w];if(he!==null)for(var Se=this.bboxes,Ae=0,We=he;Ae<We.length;Ae+=1){var Ge=We[Ae];if(!te.box[Ge]){te.box[Ge]=!0;var ot=4*Ge;if(this._circleAndRectCollide(G.x,G.y,G.radius,Se[ot+0],Se[ot+1],Se[ot+2],Se[ot+3])&&(!D||D(this.boxKeys[Ge])))return M.push(!0),!0}}var Ze=this.circleCells[w];if(Ze!==null)for(var Xe=this.circles,de=0,Vt=Ze;de<Vt.length;de+=1){var q=Vt[de];if(!te.circle[q]){te.circle[q]=!0;var or=3*q;if(this._circlesCollide(Xe[or],Xe[or+1],Xe[or+2],G.x,G.y,G.radius)&&(!D||D(this.circleKeys[q])))return M.push(!0),!0}}},Ji.prototype._forEachCell=function(f,d,h,g,w,M,I,D){for(var G=this._convertToXCellCoord(f),te=this._convertToYCellCoord(d),he=this._convertToXCellCoord(h),Se=this._convertToYCellCoord(g),Ae=G;Ae<=he;Ae++)for(var We=te;We<=Se;We++)if(w.call(this,f,d,h,g,this.xCellCount*We+Ae,M,I,D))return},Ji.prototype._convertToXCellCoord=function(f){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(f*this.xScale)))},Ji.prototype._convertToYCellCoord=function(f){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(f*this.yScale)))},Ji.prototype._circlesCollide=function(f,d,h,g,w,M){var I=g-f,D=w-d,G=h+M;return G*G>I*I+D*D},Ji.prototype._circleAndRectCollide=function(f,d,h,g,w,M,I){var D=(M-g)/2,G=Math.abs(f-(g+D));if(G>D+h)return!1;var te=(I-w)/2,he=Math.abs(d-(w+te));if(he>te+h)return!1;if(G<=D||he<=te)return!0;var Se=G-D,Ae=he-te;return Se*Se+Ae*Ae<=h*h};var Vs=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function no(f,d){for(var h=0;h<f;h++){var g=d.length;d.resize(g+4),d.float32.set(Vs,3*g)}}function Wa(f,d,h){var g=d[0],w=d[1];return f[0]=h[0]*g+h[4]*w+h[12],f[1]=h[1]*g+h[5]*w+h[13],f[3]=h[3]*g+h[7]*w+h[15],f}var io=function(f,d,h){d===void 0&&(d=new Ji(f.width+200,f.height+200,25)),h===void 0&&(h=new Ji(f.width+200,f.height+200,25)),this.transform=f,this.grid=d,this.ignoredGrid=h,this.pitchfactor=Math.cos(f._pitch)*f.cameraToCenterDistance,this.screenRightBoundary=f.width+100,this.screenBottomBoundary=f.height+100,this.gridRightBoundary=f.width+200,this.gridBottomBoundary=f.height+200};function ca(f,d,h){return d*(y.EXTENT/(f.tileSize*Math.pow(2,h-f.tileID.overscaledZ)))}io.prototype.placeCollisionBox=function(f,d,h,g,w){var M=this.projectAndGetPerspectiveRatio(g,f.anchorPointX,f.anchorPointY),I=h*M.perspectiveRatio,D=f.x1*I+M.point.x,G=f.y1*I+M.point.y,te=f.x2*I+M.point.x,he=f.y2*I+M.point.y;return!this.isInsideGrid(D,G,te,he)||!d&&this.grid.hitTest(D,G,te,he,w)?{box:[],offscreen:!1}:{box:[D,G,te,he],offscreen:this.isOffscreen(D,G,te,he)}},io.prototype.placeCollisionCircles=function(f,d,h,g,w,M,I,D,G,te,he,Se,Ae){var We=[],Ge=new y.Point(d.anchorX,d.anchorY),ot=Di(Ge,M),Ze=gr(this.transform.cameraToCenterDistance,ot.signedDistanceFromCamera),Xe=(te?w/Ze:w*Ze)/y.ONE_EM,de=Di(Ge,I).point,Vt=Aa(Xe,g,d.lineOffsetX*Xe,d.lineOffsetY*Xe,!1,de,Ge,d,h,I,{}),q=!1,or=!1,dr=!0;if(Vt){for(var Fr=.5*Se*Ze+Ae,on=new y.Point(-100,-100),nn=new y.Point(this.screenRightBoundary,this.screenBottomBoundary),Tn=new pi,ri=Vt.first,Jn=Vt.last,ii=[],Ui=ri.path.length-1;Ui>=1;Ui--)ii.push(ri.path[Ui]);for(var En=1;En<Jn.path.length;En++)ii.push(Jn.path[En]);var wi=2.5*Fr;if(D){var Ti=ii.map(function(au){return Di(au,D)});ii=Ti.some(function(au){return au.signedDistanceFromCamera<=0})?[]:Ti.map(function(au){return au.point})}var yi=[];if(ii.length>0){for(var ui=ii[0].clone(),Mi=ii[0].clone(),ci=1;ci<ii.length;ci++)ui.x=Math.min(ui.x,ii[ci].x),ui.y=Math.min(ui.y,ii[ci].y),Mi.x=Math.max(Mi.x,ii[ci].x),Mi.y=Math.max(Mi.y,ii[ci].y);yi=ui.x>=on.x&&Mi.x<=nn.x&&ui.y>=on.y&&Mi.y<=nn.y?[ii]:Mi.x<on.x||ui.x>nn.x||Mi.y<on.y||ui.y>nn.y?[]:y.clipLine([ii],on.x,on.y,nn.x,nn.y)}for(var oi=0,Po=yi;oi<Po.length;oi+=1){var Qa;Tn.reset(Po[oi],.25*Fr),Qa=Tn.length<=.5*Fr?1:Math.ceil(Tn.paddedLength/wi)+1;for(var So=0;So<Qa;So++){var Bo=So/Math.max(Qa-1,1),Ja=Tn.lerp(Bo),yo=Ja.x+100,Fs=Ja.y+100;We.push(yo,Fs,Fr,0);var No=yo-Fr,Iu=Fs-Fr,ys=yo+Fr,mu=Fs+Fr;if(dr=dr&&this.isOffscreen(No,Iu,ys,mu),or=or||this.isInsideGrid(No,Iu,ys,mu),!f&&this.grid.hitTestCircle(yo,Fs,Fr,he)&&(q=!0,!G))return{circles:[],offscreen:!1,collisionDetected:q}}}}return{circles:!G&&q||!or?[]:We,offscreen:dr,collisionDetected:q}},io.prototype.queryRenderedSymbols=function(f){if(f.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var d=[],h=1/0,g=1/0,w=-1/0,M=-1/0,I=0,D=f;I<D.length;I+=1){var G=D[I],te=new y.Point(G.x+100,G.y+100);h=Math.min(h,te.x),g=Math.min(g,te.y),w=Math.max(w,te.x),M=Math.max(M,te.y),d.push(te)}for(var he={},Se={},Ae=0,We=this.grid.query(h,g,w,M).concat(this.ignoredGrid.query(h,g,w,M));Ae<We.length;Ae+=1){var Ge=We[Ae],ot=Ge.key;if(he[ot.bucketInstanceId]===void 0&&(he[ot.bucketInstanceId]={}),!he[ot.bucketInstanceId][ot.featureIndex]){var Ze=[new y.Point(Ge.x1,Ge.y1),new y.Point(Ge.x2,Ge.y1),new y.Point(Ge.x2,Ge.y2),new y.Point(Ge.x1,Ge.y2)];y.polygonIntersectsPolygon(d,Ze)&&(he[ot.bucketInstanceId][ot.featureIndex]=!0,Se[ot.bucketInstanceId]===void 0&&(Se[ot.bucketInstanceId]=[]),Se[ot.bucketInstanceId].push(ot.featureIndex))}}return Se},io.prototype.insertCollisionBox=function(f,d,h,g,w){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:g,collisionGroupID:w},f[0],f[1],f[2],f[3])},io.prototype.insertCollisionCircles=function(f,d,h,g,w){for(var M=d?this.ignoredGrid:this.grid,I={bucketInstanceId:h,featureIndex:g,collisionGroupID:w},D=0;D<f.length;D+=4)M.insertCircle(I,f[D],f[D+1],f[D+2])},io.prototype.projectAndGetPerspectiveRatio=function(f,d,h){var g=[d,h,0,1];return Wa(g,g,f),{point:new y.Point((g[0]/g[3]+1)/2*this.transform.width+100,(-g[1]/g[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/g[3]*.5}},io.prototype.isOffscreen=function(f,d,h,g){return h<100||f>=this.screenRightBoundary||g<100||d>this.screenBottomBoundary},io.prototype.isInsideGrid=function(f,d,h,g){return h>=0&&f<this.gridRightBoundary&&g>=0&&d<this.gridBottomBoundary},io.prototype.getViewportMatrix=function(){var f=y.identity([]);return y.translate(f,f,[-100,-100,0]),f};var Ho=function(f,d,h,g){this.opacity=f?Math.max(0,Math.min(1,f.opacity+(f.placed?d:-d))):g&&h?1:0,this.placed=h};Ho.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Jo=function(f,d,h,g,w){this.text=new Ho(f?f.text:null,d,h,w),this.icon=new Ho(f?f.icon:null,d,g,w)};Jo.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var wu=function(f,d,h){this.text=f,this.icon=d,this.skipFade=h},To=function(){this.invProjMatrix=y.create(),this.viewportMatrix=y.create(),this.circles=[]},Mo=function(f,d,h,g,w){this.bucketInstanceId=f,this.featureIndex=d,this.sourceLayerIndex=h,this.bucketIndex=g,this.tileID=w},ha=function(f){this.crossSourceCollisions=f,this.maxGroupID=0,this.collisionGroups={}};function ao(f,d,h,g,w){var M=y.getAnchorAlignment(f),I=-(M.horizontalAlign-.5)*d,D=-(M.verticalAlign-.5)*h,G=y.evaluateVariableOffset(f,g);return new y.Point(I+G[0]*w,D+G[1]*w)}function Wo(f,d,h,g,w,M){var I=f.x1,D=f.x2,G=f.y1,te=f.y2,he=f.anchorPointX,Se=f.anchorPointY,Ae=new y.Point(d,h);return g&&Ae._rotate(w?M:-M),{x1:I+Ae.x,y1:G+Ae.y,x2:D+Ae.x,y2:te+Ae.y,anchorPointX:he,anchorPointY:Se}}ha.prototype.get=function(f){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[f]){var d=++this.maxGroupID;this.collisionGroups[f]={ID:d,predicate:function(h){return h.collisionGroupID===d}}}return this.collisionGroups[f]};var Ya=function(f,d,h,g){this.transform=f.clone(),this.collisionIndex=new io(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new ha(h),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}};function qs(f,d,h,g,w){f.emplaceBack(d?1:0,h?1:0,g||0,w||0),f.emplaceBack(d?1:0,h?1:0,g||0,w||0),f.emplaceBack(d?1:0,h?1:0,g||0,w||0),f.emplaceBack(d?1:0,h?1:0,g||0,w||0)}Ya.prototype.getBucketParts=function(f,d,h,g){var w=h.getBucket(d),M=h.latestFeatureIndex;if(w&&M&&d.id===w.layerIds[0]){var I=h.collisionBoxArray,D=w.layers[0].layout,G=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),te=h.tileSize/y.EXTENT,he=this.transform.calculatePosMatrix(h.tileID.toUnwrapped()),Se=D.get("text-pitch-alignment")==="map",Ae=D.get("text-rotation-alignment")==="map",We=ca(h,1,this.transform.zoom),Ge=ea(he,Se,Ae,this.transform,We),ot=null;if(Se){var Ze=la(he,Se,Ae,this.transform,We);ot=y.multiply([],this.transform.labelPlaneMatrix,Ze)}this.retainedQueryData[w.bucketInstanceId]=new Mo(w.bucketInstanceId,M,w.sourceLayerIndex,w.index,h.tileID);var Xe={bucket:w,layout:D,posMatrix:he,textLabelPlaneMatrix:Ge,labelToScreenMatrix:ot,scale:G,textPixelRatio:te,holdingForFade:h.holdingForFade(),collisionBoxArray:I,partiallyEvaluatedTextSize:y.evaluateSizeForZoom(w.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(w.sourceID)};if(g)for(var de=0,Vt=w.sortKeyRanges;de<Vt.length;de+=1){var q=Vt[de];f.push({sortKey:q.sortKey,symbolInstanceStart:q.symbolInstanceStart,symbolInstanceEnd:q.symbolInstanceEnd,parameters:Xe})}else f.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:Xe})}},Ya.prototype.attemptAnchorPlacement=function(f,d,h,g,w,M,I,D,G,te,he,Se,Ae,We,Ge){var ot,Ze=[Se.textOffset0,Se.textOffset1],Xe=ao(f,h,g,Ze,w),de=this.collisionIndex.placeCollisionBox(Wo(d,Xe.x,Xe.y,M,I,this.transform.angle),he,D,G,te.predicate);if(!Ge||this.collisionIndex.placeCollisionBox(Wo(Ge,Xe.x,Xe.y,M,I,this.transform.angle),he,D,G,te.predicate).box.length!==0)return de.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[Se.crossTileID]&&this.prevPlacement.placements[Se.crossTileID]&&this.prevPlacement.placements[Se.crossTileID].text&&(ot=this.prevPlacement.variableOffsets[Se.crossTileID].anchor),this.variableOffsets[Se.crossTileID]={textOffset:Ze,width:h,height:g,anchor:f,textBoxScale:w,prevAnchor:ot},this.markUsedJustification(Ae,f,Se,We),Ae.allowVerticalPlacement&&(this.markUsedOrientation(Ae,We,Se),this.placedOrientations[Se.crossTileID]=We),{shift:Xe,placedGlyphBoxes:de}):void 0},Ya.prototype.placeLayerBucketPart=function(f,d,h){var g=this,w=f.parameters,M=w.bucket,I=w.layout,D=w.posMatrix,G=w.textLabelPlaneMatrix,te=w.labelToScreenMatrix,he=w.textPixelRatio,Se=w.holdingForFade,Ae=w.collisionBoxArray,We=w.partiallyEvaluatedTextSize,Ge=w.collisionGroup,ot=I.get("text-optional"),Ze=I.get("icon-optional"),Xe=I.get("text-allow-overlap"),de=I.get("icon-allow-overlap"),Vt=I.get("text-rotation-alignment")==="map",q=I.get("text-pitch-alignment")==="map",or=I.get("icon-text-fit")!=="none",dr=I.get("symbol-z-order")==="viewport-y",Fr=Xe&&(de||!M.hasIconData()||Ze),on=de&&(Xe||!M.hasTextData()||ot);!M.collisionArrays&&Ae&&M.deserializeCollisionBoxes(Ae);var nn=function(En,wi){if(!d[En.crossTileID])if(Se)g.placements[En.crossTileID]=new wu(!1,!1,!1);else{var Ti,yi=!1,ui=!1,Mi=!0,ci=null,oi={box:null,offscreen:null},Po={box:null,offscreen:null},Qa=null,So=null,Bo=0,Ja=0,yo=0;wi.textFeatureIndex?Bo=wi.textFeatureIndex:En.useRuntimeCollisionCircles&&(Bo=En.featureIndex),wi.verticalTextFeatureIndex&&(Ja=wi.verticalTextFeatureIndex);var Fs=wi.textBox;if(Fs){var No=function(da){var Xs=y.WritingMode.horizontal;if(M.allowVerticalPlacement&&!da&&g.prevPlacement){var _s=g.prevPlacement.placedOrientations[En.crossTileID];_s&&(g.placedOrientations[En.crossTileID]=_s,g.markUsedOrientation(M,Xs=_s,En))}return Xs},Iu=function(da,Xs){if(M.allowVerticalPlacement&&En.numVerticalGlyphVertices>0&&wi.verticalTextBox)for(var _s=0,Ju=M.writingModes;_s<Ju.length&&(Ju[_s]===y.WritingMode.vertical?(oi=Xs(),Po=oi):oi=da(),!(oi&&oi.box&&oi.box.length));_s+=1);else oi=da()};if(I.get("text-variable-anchor")){var ys=I.get("text-variable-anchor");if(g.prevPlacement&&g.prevPlacement.variableOffsets[En.crossTileID]){var mu=g.prevPlacement.variableOffsets[En.crossTileID];ys.indexOf(mu.anchor)>0&&(ys=ys.filter(function(da){return da!==mu.anchor})).unshift(mu.anchor)}var au=function(da,Xs,_s){for(var Ju=da.x2-da.x1,Yc=da.y2-da.y1,qc=En.textBoxScale,wf=or&&!de?Xs:null,Ps={box:[],offscreen:!1},Gl=Xe?2*ys.length:ys.length,yu=0;yu<Gl;++yu){var bl=g.attemptAnchorPlacement(ys[yu%ys.length],da,Ju,Yc,qc,Vt,q,he,D,Ge,yu>=ys.length,En,M,_s,wf);if(bl&&(Ps=bl.placedGlyphBoxes)&&Ps.box&&Ps.box.length){yi=!0,ci=bl.shift;break}}return Ps};Iu(function(){return au(Fs,wi.iconBox,y.WritingMode.horizontal)},function(){var da=wi.verticalTextBox;return M.allowVerticalPlacement&&!(oi&&oi.box&&oi.box.length)&&En.numVerticalGlyphVertices>0&&da?au(da,wi.verticalIconBox,y.WritingMode.vertical):{box:null,offscreen:null}}),oi&&(yi=oi.box,Mi=oi.offscreen);var gl=No(oi&&oi.box);if(!yi&&g.prevPlacement){var jl=g.prevPlacement.variableOffsets[En.crossTileID];jl&&(g.variableOffsets[En.crossTileID]=jl,g.markUsedJustification(M,jl.anchor,En,gl))}}else{var ss=function(da,Xs){var _s=g.collisionIndex.placeCollisionBox(da,Xe,he,D,Ge.predicate);return _s&&_s.box&&_s.box.length&&(g.markUsedOrientation(M,Xs,En),g.placedOrientations[En.crossTileID]=Xs),_s};Iu(function(){return ss(Fs,y.WritingMode.horizontal)},function(){var da=wi.verticalTextBox;return M.allowVerticalPlacement&&En.numVerticalGlyphVertices>0&&da?ss(da,y.WritingMode.vertical):{box:null,offscreen:null}}),No(oi&&oi.box&&oi.box.length)}}if(yi=(Ti=oi)&&Ti.box&&Ti.box.length>0,Mi=Ti&&Ti.offscreen,En.useRuntimeCollisionCircles){var yl=M.text.placedSymbolArray.get(En.centerJustifiedTextSymbolIndex),$c=y.evaluateSizeForFeature(M.textSizeData,We,yl),gu=I.get("text-padding");Qa=g.collisionIndex.placeCollisionCircles(Xe,yl,M.lineVertexArray,M.glyphOffsetArray,$c,D,G,te,h,q,Ge.predicate,En.collisionCircleDiameter,gu),yi=Xe||Qa.circles.length>0&&!Qa.collisionDetected,Mi=Mi&&Qa.offscreen}if(wi.iconFeatureIndex&&(yo=wi.iconFeatureIndex),wi.iconBox){var mc=function(da){var Xs=or&&ci?Wo(da,ci.x,ci.y,Vt,q,g.transform.angle):da;return g.collisionIndex.placeCollisionBox(Xs,de,he,D,Ge.predicate)};ui=Po&&Po.box&&Po.box.length&&wi.verticalIconBox?(So=mc(wi.verticalIconBox)).box.length>0:(So=mc(wi.iconBox)).box.length>0,Mi=Mi&&So.offscreen}var Gu=ot||En.numHorizontalGlyphVertices===0&&En.numVerticalGlyphVertices===0,wo=Ze||En.numIconVertices===0;if(Gu||wo?wo?Gu||(ui=ui&&yi):yi=ui&&yi:ui=yi=ui&&yi,yi&&Ti&&Ti.box&&g.collisionIndex.insertCollisionBox(Ti.box,I.get("text-ignore-placement"),M.bucketInstanceId,Po&&Po.box&&Ja?Ja:Bo,Ge.ID),ui&&So&&g.collisionIndex.insertCollisionBox(So.box,I.get("icon-ignore-placement"),M.bucketInstanceId,yo,Ge.ID),Qa&&(yi&&g.collisionIndex.insertCollisionCircles(Qa.circles,I.get("text-ignore-placement"),M.bucketInstanceId,Bo,Ge.ID),h)){var Pu=M.bucketInstanceId,_l=g.collisionCircleArrays[Pu];_l===void 0&&(_l=g.collisionCircleArrays[Pu]=new To);for(var xl=0;xl<Qa.circles.length;xl+=4)_l.circles.push(Qa.circles[xl+0]),_l.circles.push(Qa.circles[xl+1]),_l.circles.push(Qa.circles[xl+2]),_l.circles.push(Qa.collisionDetected?1:0)}g.placements[En.crossTileID]=new wu(yi||Fr,ui||on,Mi||M.justReloaded),d[En.crossTileID]=!0}};if(dr)for(var Tn=M.getSortedSymbolIndexes(this.transform.angle),ri=Tn.length-1;ri>=0;--ri){var Jn=Tn[ri];nn(M.symbolInstances.get(Jn),M.collisionArrays[Jn])}else for(var ii=f.symbolInstanceStart;ii<f.symbolInstanceEnd;ii++)nn(M.symbolInstances.get(ii),M.collisionArrays[ii]);if(h&&M.bucketInstanceId in this.collisionCircleArrays){var Ui=this.collisionCircleArrays[M.bucketInstanceId];y.invert(Ui.invProjMatrix,D),Ui.viewportMatrix=this.collisionIndex.getViewportMatrix()}M.justReloaded=!1},Ya.prototype.markUsedJustification=function(f,d,h,g){var w;w=g===y.WritingMode.vertical?h.verticalPlacedTextSymbolIndex:{left:h.leftJustifiedTextSymbolIndex,center:h.centerJustifiedTextSymbolIndex,right:h.rightJustifiedTextSymbolIndex}[y.getAnchorJustification(d)];for(var M=0,I=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex,h.verticalPlacedTextSymbolIndex];M<I.length;M+=1){var D=I[M];D>=0&&(f.text.placedSymbolArray.get(D).crossTileID=w>=0&&D!==w?0:h.crossTileID)}},Ya.prototype.markUsedOrientation=function(f,d,h){for(var g=d===y.WritingMode.horizontal||d===y.WritingMode.horizontalOnly?d:0,w=d===y.WritingMode.vertical?d:0,M=0,I=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex];M<I.length;M+=1)f.text.placedSymbolArray.get(I[M]).placedOrientation=g;h.verticalPlacedTextSymbolIndex&&(f.text.placedSymbolArray.get(h.verticalPlacedTextSymbolIndex).placedOrientation=w)},Ya.prototype.commit=function(f){this.commitTime=f,this.zoomAtLastRecencyCheck=this.transform.zoom;var d=this.prevPlacement,h=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;var g=d?d.symbolFadeChange(f):1,w=d?d.opacities:{},M=d?d.variableOffsets:{},I=d?d.placedOrientations:{};for(var D in this.placements){var G=this.placements[D],te=w[D];te?(this.opacities[D]=new Jo(te,g,G.text,G.icon),h=h||G.text!==te.text.placed||G.icon!==te.icon.placed):(this.opacities[D]=new Jo(null,g,G.text,G.icon,G.skipFade),h=h||G.text||G.icon)}for(var he in w){var Se=w[he];if(!this.opacities[he]){var Ae=new Jo(Se,g,!1,!1);Ae.isHidden()||(this.opacities[he]=Ae,h=h||Se.text.placed||Se.icon.placed)}}for(var We in M)this.variableOffsets[We]||!this.opacities[We]||this.opacities[We].isHidden()||(this.variableOffsets[We]=M[We]);for(var Ge in I)this.placedOrientations[Ge]||!this.opacities[Ge]||this.opacities[Ge].isHidden()||(this.placedOrientations[Ge]=I[Ge]);h?this.lastPlacementChangeTime=f:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:f)},Ya.prototype.updateLayerOpacities=function(f,d){for(var h={},g=0,w=d;g<w.length;g+=1){var M=w[g],I=M.getBucket(f);I&&M.latestFeatureIndex&&f.id===I.layerIds[0]&&this.updateBucketOpacities(I,h,M.collisionBoxArray)}},Ya.prototype.updateBucketOpacities=function(f,d,h){var g=this;f.hasTextData()&&f.text.opacityVertexArray.clear(),f.hasIconData()&&f.icon.opacityVertexArray.clear(),f.hasIconCollisionBoxData()&&f.iconCollisionBox.collisionVertexArray.clear(),f.hasTextCollisionBoxData()&&f.textCollisionBox.collisionVertexArray.clear();var w=f.layers[0].layout,M=new Jo(null,0,!1,!1,!0),I=w.get("text-allow-overlap"),D=w.get("icon-allow-overlap"),G=w.get("text-variable-anchor"),te=w.get("text-rotation-alignment")==="map",he=w.get("text-pitch-alignment")==="map",Se=w.get("icon-text-fit")!=="none",Ae=new Jo(null,0,I&&(D||!f.hasIconData()||w.get("icon-optional")),D&&(I||!f.hasTextData()||w.get("text-optional")),!0);!f.collisionArrays&&h&&(f.hasIconCollisionBoxData()||f.hasTextCollisionBoxData())&&f.deserializeCollisionBoxes(h);for(var We=function(Xe,de,Vt){for(var q=0;q<de/4;q++)Xe.opacityVertexArray.emplaceBack(Vt)},Ge=function(Xe){var de=f.symbolInstances.get(Xe),Vt=de.numHorizontalGlyphVertices,q=de.numVerticalGlyphVertices,or=de.crossTileID,dr=g.opacities[or];d[or]?dr=M:dr||(g.opacities[or]=dr=Ae),d[or]=!0;var Fr=de.numIconVertices>0,on=g.placedOrientations[de.crossTileID],nn=on===y.WritingMode.vertical,Tn=on===y.WritingMode.horizontal||on===y.WritingMode.horizontalOnly;if(Vt>0||q>0){var ri=Hn(dr.text);We(f.text,Vt,nn?Fi:ri),We(f.text,q,Tn?Fi:ri);var Jn=dr.text.isHidden();[de.rightJustifiedTextSymbolIndex,de.centerJustifiedTextSymbolIndex,de.leftJustifiedTextSymbolIndex].forEach(function(oi){oi>=0&&(f.text.placedSymbolArray.get(oi).hidden=Jn||nn?1:0)}),de.verticalPlacedTextSymbolIndex>=0&&(f.text.placedSymbolArray.get(de.verticalPlacedTextSymbolIndex).hidden=Jn||Tn?1:0);var ii=g.variableOffsets[de.crossTileID];ii&&g.markUsedJustification(f,ii.anchor,de,on);var Ui=g.placedOrientations[de.crossTileID];Ui&&(g.markUsedJustification(f,"left",de,Ui),g.markUsedOrientation(f,Ui,de))}if(Fr){var En=Hn(dr.icon),wi=!(Se&&de.verticalPlacedIconSymbolIndex&&nn);de.placedIconSymbolIndex>=0&&(We(f.icon,de.numIconVertices,wi?En:Fi),f.icon.placedSymbolArray.get(de.placedIconSymbolIndex).hidden=dr.icon.isHidden()),de.verticalPlacedIconSymbolIndex>=0&&(We(f.icon,de.numVerticalIconVertices,wi?Fi:En),f.icon.placedSymbolArray.get(de.verticalPlacedIconSymbolIndex).hidden=dr.icon.isHidden())}if(f.hasIconCollisionBoxData()||f.hasTextCollisionBoxData()){var Ti=f.collisionArrays[Xe];if(Ti){var yi=new y.Point(0,0);if(Ti.textBox||Ti.verticalTextBox){var ui=!0;if(G){var Mi=g.variableOffsets[or];Mi?(yi=ao(Mi.anchor,Mi.width,Mi.height,Mi.textOffset,Mi.textBoxScale),te&&yi._rotate(he?g.transform.angle:-g.transform.angle)):ui=!1}Ti.textBox&&qs(f.textCollisionBox.collisionVertexArray,dr.text.placed,!ui||nn,yi.x,yi.y),Ti.verticalTextBox&&qs(f.textCollisionBox.collisionVertexArray,dr.text.placed,!ui||Tn,yi.x,yi.y)}var ci=Boolean(!Tn&&Ti.verticalIconBox);Ti.iconBox&&qs(f.iconCollisionBox.collisionVertexArray,dr.icon.placed,ci,Se?yi.x:0,Se?yi.y:0),Ti.verticalIconBox&&qs(f.iconCollisionBox.collisionVertexArray,dr.icon.placed,!ci,Se?yi.x:0,Se?yi.y:0)}}},ot=0;ot<f.symbolInstances.length;ot++)Ge(ot);if(f.sortFeatures(this.transform.angle),this.retainedQueryData[f.bucketInstanceId]&&(this.retainedQueryData[f.bucketInstanceId].featureSortOrder=f.featureSortOrder),f.hasTextData()&&f.text.opacityVertexBuffer&&f.text.opacityVertexBuffer.updateData(f.text.opacityVertexArray),f.hasIconData()&&f.icon.opacityVertexBuffer&&f.icon.opacityVertexBuffer.updateData(f.icon.opacityVertexArray),f.hasIconCollisionBoxData()&&f.iconCollisionBox.collisionVertexBuffer&&f.iconCollisionBox.collisionVertexBuffer.updateData(f.iconCollisionBox.collisionVertexArray),f.hasTextCollisionBoxData()&&f.textCollisionBox.collisionVertexBuffer&&f.textCollisionBox.collisionVertexBuffer.updateData(f.textCollisionBox.collisionVertexArray),f.bucketInstanceId in this.collisionCircleArrays){var Ze=this.collisionCircleArrays[f.bucketInstanceId];f.placementInvProjMatrix=Ze.invProjMatrix,f.placementViewportMatrix=Ze.viewportMatrix,f.collisionCircleArray=Ze.circles,delete this.collisionCircleArrays[f.bucketInstanceId]}},Ya.prototype.symbolFadeChange=function(f){return this.fadeDuration===0?1:(f-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Ya.prototype.zoomAdjustment=function(f){return Math.max(0,(this.transform.zoom-f)/1.5)},Ya.prototype.hasTransitions=function(f){return this.stale||f-this.lastPlacementChangeTime<this.fadeDuration},Ya.prototype.stillRecent=function(f,d){var h=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*h>f},Ya.prototype.setStale=function(){this.stale=!0};var Il=Math.pow(2,25),es=Math.pow(2,24),ve=Math.pow(2,17),Oe=Math.pow(2,16),mt=Math.pow(2,9),er=Math.pow(2,8),en=Math.pow(2,1);function Hn(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;var d=f.placed?1:0,h=Math.floor(127*f.opacity);return h*Il+d*es+h*ve+d*Oe+h*mt+d*er+h*en+d}var Fi=0,fo=function(f){this._sortAcrossTiles=f.layout.get("symbol-z-order")!=="viewport-y"&&f.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};fo.prototype.continuePlacement=function(f,d,h,g,w){for(var M=this._bucketParts;this._currentTileIndex<f.length;)if(d.getBucketParts(M,g,f[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,M.sort(function(I,D){return I.sortKey-D.sortKey}));this._currentPartIndex<M.length;)if(d.placeLayerBucketPart(M[this._currentPartIndex],this._seenCrossTileIDs,h),this._currentPartIndex++,w())return!0;return!1};var za=function(f,d,h,g,w,M,I){this.placement=new Ya(f,w,M,I),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=g,this._done=!1};za.prototype.isDone=function(){return this._done},za.prototype.continuePlacement=function(f,d,h){for(var g=this,w=y.browser.now(),M=function(){var G=y.browser.now()-w;return!g._forceFullPlacement&&G>2};this._currentPlacementIndex>=0;){var I=d[f[this._currentPlacementIndex]],D=this.placement.collisionIndex.transform.zoom;if(I.type==="symbol"&&(!I.minzoom||I.minzoom<=D)&&(!I.maxzoom||I.maxzoom>D)){if(this._inProgressLayer||(this._inProgressLayer=new fo(I)),this._inProgressLayer.continuePlacement(h[I.source],this.placement,this._showCollisionBoxes,I,M))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},za.prototype.commit=function(f){return this.placement.commit(f),this.placement};var qa=512/y.EXTENT/2,ts=function(f,d,h){this.tileID=f,this.indexedSymbolInstances={},this.bucketInstanceId=h;for(var g=0;g<d.length;g++){var w=d.get(g),M=w.key;this.indexedSymbolInstances[M]||(this.indexedSymbolInstances[M]=[]),this.indexedSymbolInstances[M].push({crossTileID:w.crossTileID,coord:this.getScaledCoordinates(w,f)})}};ts.prototype.getScaledCoordinates=function(f,d){var h=qa/Math.pow(2,d.canonical.z-this.tileID.canonical.z);return{x:Math.floor((d.canonical.x*y.EXTENT+f.anchorX)*h),y:Math.floor((d.canonical.y*y.EXTENT+f.anchorY)*h)}},ts.prototype.findMatches=function(f,d,h){for(var g=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z),w=0;w<f.length;w++){var M=f.get(w);if(!M.crossTileID){var I=this.indexedSymbolInstances[M.key];if(I)for(var D=this.getScaledCoordinates(M,d),G=0,te=I;G<te.length;G+=1){var he=te[G];if(Math.abs(he.coord.x-D.x)<=g&&Math.abs(he.coord.y-D.y)<=g&&!h[he.crossTileID]){h[he.crossTileID]=!0,M.crossTileID=he.crossTileID;break}}}}};var Do=function(){this.maxCrossTileID=0};Do.prototype.generate=function(){return++this.maxCrossTileID};var mo=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};mo.prototype.handleWrapJump=function(f){var d=Math.round((f-this.lng)/360);if(d!==0)for(var h in this.indexes){var g=this.indexes[h],w={};for(var M in g){var I=g[M];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+d),w[I.tileID.key]=I}this.indexes[h]=w}this.lng=f},mo.prototype.addBucket=function(f,d,h){if(this.indexes[f.overscaledZ]&&this.indexes[f.overscaledZ][f.key]){if(this.indexes[f.overscaledZ][f.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(f.overscaledZ,this.indexes[f.overscaledZ][f.key])}for(var g=0;g<d.symbolInstances.length;g++)d.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[f.overscaledZ]||(this.usedCrossTileIDs[f.overscaledZ]={});var w=this.usedCrossTileIDs[f.overscaledZ];for(var M in this.indexes){var I=this.indexes[M];if(Number(M)>f.overscaledZ)for(var D in I){var G=I[D];G.tileID.isChildOf(f)&&G.findMatches(d.symbolInstances,f,w)}else{var te=I[f.scaledTo(Number(M)).key];te&&te.findMatches(d.symbolInstances,f,w)}}for(var he=0;he<d.symbolInstances.length;he++){var Se=d.symbolInstances.get(he);Se.crossTileID||(Se.crossTileID=h.generate(),w[Se.crossTileID]=!0)}return this.indexes[f.overscaledZ]===void 0&&(this.indexes[f.overscaledZ]={}),this.indexes[f.overscaledZ][f.key]=new ts(f,d.symbolInstances,d.bucketInstanceId),!0},mo.prototype.removeBucketCrossTileIDs=function(f,d){for(var h in d.indexedSymbolInstances)for(var g=0,w=d.indexedSymbolInstances[h];g<w.length;g+=1)delete this.usedCrossTileIDs[f][w[g].crossTileID]},mo.prototype.removeStaleBuckets=function(f){var d=!1;for(var h in this.indexes){var g=this.indexes[h];for(var w in g)f[g[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,g[w]),delete g[w],d=!0)}return d};var Cs=function(){this.layerIndexes={},this.crossTileIDs=new Do,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Cs.prototype.addLayer=function(f,d,h){var g=this.layerIndexes[f.id];g===void 0&&(g=this.layerIndexes[f.id]=new mo);var w=!1,M={};g.handleWrapJump(h);for(var I=0,D=d;I<D.length;I+=1){var G=D[I],te=G.getBucket(f);te&&f.id===te.layerIds[0]&&(te.bucketInstanceId||(te.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(G.tileID,te,this.crossTileIDs)&&(w=!0),M[te.bucketInstanceId]=!0)}return g.removeStaleBuckets(M)&&(w=!0),w},Cs.prototype.pruneUnusedLayers=function(f){var d={};for(var h in f.forEach(function(g){d[g]=!0}),this.layerIndexes)d[h]||delete this.layerIndexes[h]};var As=function(f,d){return y.emitValidationErrors(f,d&&d.filter(function(h){return h.identifier!=="source.canvas"}))},Ts=y.pick(St,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Ks=y.pick(St,["setCenter","setZoom","setBearing","setPitch"]),cu=function(){var f={},d=y.styleSpec.$version;for(var h in y.styleSpec.$root){var g,w=y.styleSpec.$root[h];w.required&&(g=h==="version"?d:w.type==="array"?[]:{})!=null&&(f[h]=g)}return f}(),ps=function(f){function d(h,g){var w=this;g===void 0&&(g={}),f.call(this),this.map=h,this.dispatcher=new rr($t(),this),this.imageManager=new Mt,this.imageManager.setEventedParent(this),this.glyphManager=new Qt(h._requestManager,g.localIdeographFontFamily),this.lineAtlas=new dt(256,512),this.crossTileSymbolIndex=new Cs,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new y.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",y.getReferrer());var M=this;this._rtlTextPluginCallback=d.registerForPluginStateChange(function(I){M.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:I.pluginStatus,pluginURL:I.pluginURL},function(D,G){if(y.triggerPluginCompletionEvent(D),G&&G.every(function(he){return he}))for(var te in M.sourceCaches)M.sourceCaches[te].reload()})}),this.on("data",function(I){if(I.dataType==="source"&&I.sourceDataType==="metadata"){var D=w.sourceCaches[I.sourceId];if(D){var G=D.getSource();if(G&&G.vectorLayerIds)for(var te in w._layers){var he=w._layers[te];he.source===G.id&&w._validateLayer(he)}}}})}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.loadURL=function(h,g){var w=this;g===void 0&&(g={}),this.fire(new y.Event("dataloading",{dataType:"style"}));var M=typeof g.validate=="boolean"?g.validate:!y.isMapboxURL(h);h=this.map._requestManager.normalizeStyleURL(h,g.accessToken);var I=this.map._requestManager.transformRequest(h,y.ResourceType.Style);this._request=y.getJSON(I,function(D,G){w._request=null,D?w.fire(new y.ErrorEvent(D)):G&&w._load(G,M)})},d.prototype.loadJSON=function(h,g){var w=this;g===void 0&&(g={}),this.fire(new y.Event("dataloading",{dataType:"style"})),this._request=y.browser.frame(function(){w._request=null,w._load(h,g.validate!==!1)})},d.prototype.loadEmpty=function(){this.fire(new y.Event("dataloading",{dataType:"style"})),this._load(cu,!1)},d.prototype._load=function(h,g){if(!g||!As(this,y.validateStyle(h))){for(var w in this._loaded=!0,this.stylesheet=h,h.sources)this.addSource(w,h.sources[w],{validate:!1});h.sprite?this._loadSprite(h.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(h.glyphs);var M=hr(this.stylesheet.layers);this._order=M.map(function(te){return te.id}),this._layers={},this._serializedLayers={};for(var I=0,D=M;I<D.length;I+=1){var G=D[I];(G=y.createStyleLayer(G)).setEventedParent(this,{layer:{id:G.id}}),this._layers[G.id]=G,this._serializedLayers[G.id]=G.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ut(this.stylesheet.light),this.fire(new y.Event("data",{dataType:"style"})),this.fire(new y.Event("style.load"))}},d.prototype._loadSprite=function(h){var g=this;this._spriteRequest=function(w,M,I){var D,G,te,he=y.browser.devicePixelRatio>1?"@2x":"",Se=y.getJSON(M.transformRequest(M.normalizeSpriteURL(w,he,".json"),y.ResourceType.SpriteJSON),function(Ge,ot){Se=null,te||(te=Ge,D=ot,We())}),Ae=y.getImage(M.transformRequest(M.normalizeSpriteURL(w,he,".png"),y.ResourceType.SpriteImage),function(Ge,ot){Ae=null,te||(te=Ge,G=ot,We())});function We(){if(te)I(te);else if(D&&G){var Ge=y.browser.getImageData(G),ot={};for(var Ze in D){var Xe=D[Ze],de=Xe.width,Vt=Xe.height,q=Xe.x,or=Xe.y,dr=Xe.sdf,Fr=Xe.pixelRatio,on=Xe.stretchX,nn=Xe.stretchY,Tn=Xe.content,ri=new y.RGBAImage({width:de,height:Vt});y.RGBAImage.copy(Ge,ri,{x:q,y:or},{x:0,y:0},{width:de,height:Vt}),ot[Ze]={data:ri,pixelRatio:Fr,sdf:dr,stretchX:on,stretchY:nn,content:Tn}}I(null,ot)}}return{cancel:function(){Se&&(Se.cancel(),Se=null),Ae&&(Ae.cancel(),Ae=null)}}}(h,this.map._requestManager,function(w,M){if(g._spriteRequest=null,w)g.fire(new y.ErrorEvent(w));else if(M)for(var I in M)g.imageManager.addImage(I,M[I]);g.imageManager.setLoaded(!0),g._availableImages=g.imageManager.listImages(),g.dispatcher.broadcast("setImages",g._availableImages),g.fire(new y.Event("data",{dataType:"style"}))})},d.prototype._validateLayer=function(h){var g=this.sourceCaches[h.source];if(g){var w=h.sourceLayer;if(w){var M=g.getSource();(M.type==="geojson"||M.vectorLayerIds&&M.vectorLayerIds.indexOf(w)===-1)&&this.fire(new y.ErrorEvent(new Error('Source layer "'+w+'" does not exist on source "'+M.id+'" as specified by style layer "'+h.id+'"')))}}},d.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var h in this.sourceCaches)if(!this.sourceCaches[h].loaded())return!1;return!!this.imageManager.isLoaded()},d.prototype._serializeLayers=function(h){for(var g=[],w=0,M=h;w<M.length;w+=1){var I=this._layers[M[w]];I.type!=="custom"&&g.push(I.serialize())}return g},d.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var h in this.sourceCaches)if(this.sourceCaches[h].hasTransition())return!0;for(var g in this._layers)if(this._layers[g].hasTransition())return!0;return!1},d.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},d.prototype.update=function(h){if(this._loaded){var g=this._changed;if(this._changed){var w=Object.keys(this._updatedLayers),M=Object.keys(this._removedLayers);for(var I in(w.length||M.length)&&this._updateWorkerLayers(w,M),this._updatedSources){var D=this._updatedSources[I];D==="reload"?this._reloadSource(I):D==="clear"&&this._clearSource(I)}for(var G in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[G].updateTransitions(h);this.light.updateTransitions(h),this._resetUpdates()}var te={};for(var he in this.sourceCaches){var Se=this.sourceCaches[he];te[he]=Se.used,Se.used=!1}for(var Ae=0,We=this._order;Ae<We.length;Ae+=1){var Ge=this._layers[We[Ae]];Ge.recalculate(h,this._availableImages),!Ge.isHidden(h.zoom)&&Ge.source&&(this.sourceCaches[Ge.source].used=!0)}for(var ot in te){var Ze=this.sourceCaches[ot];te[ot]!==Ze.used&&Ze.fire(new y.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:ot}))}this.light.recalculate(h),this.z=h.zoom,g&&this.fire(new y.Event("data",{dataType:"style"}))}},d.prototype._updateTilesForChangedImages=function(){var h=Object.keys(this._changedImages);if(h.length){for(var g in this.sourceCaches)this.sourceCaches[g].reloadTilesForDependencies(["icons","patterns"],h);this._changedImages={}}},d.prototype._updateWorkerLayers=function(h,g){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(h),removedIds:g})},d.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},d.prototype.setState=function(h){var g=this;if(this._checkLoaded(),As(this,y.validateStyle(h)))return!1;(h=y.clone$1(h)).layers=hr(h.layers);var w=function(I,D){if(!I)return[{command:St.setStyle,args:[D]}];var G=[];try{if(!y.deepEqual(I.version,D.version))return[{command:St.setStyle,args:[D]}];y.deepEqual(I.center,D.center)||G.push({command:St.setCenter,args:[D.center]}),y.deepEqual(I.zoom,D.zoom)||G.push({command:St.setZoom,args:[D.zoom]}),y.deepEqual(I.bearing,D.bearing)||G.push({command:St.setBearing,args:[D.bearing]}),y.deepEqual(I.pitch,D.pitch)||G.push({command:St.setPitch,args:[D.pitch]}),y.deepEqual(I.sprite,D.sprite)||G.push({command:St.setSprite,args:[D.sprite]}),y.deepEqual(I.glyphs,D.glyphs)||G.push({command:St.setGlyphs,args:[D.glyphs]}),y.deepEqual(I.transition,D.transition)||G.push({command:St.setTransition,args:[D.transition]}),y.deepEqual(I.light,D.light)||G.push({command:St.setLight,args:[D.light]});var te={},he=[];(function(Ae,We,Ge,ot){var Ze;for(Ze in We=We||{},Ae=Ae||{})Ae.hasOwnProperty(Ze)&&(We.hasOwnProperty(Ze)||mn(Ze,Ge,ot));for(Ze in We)We.hasOwnProperty(Ze)&&(Ae.hasOwnProperty(Ze)?y.deepEqual(Ae[Ze],We[Ze])||(Ae[Ze].type==="geojson"&&We[Ze].type==="geojson"&&ua(Ae,We,Ze)?Ge.push({command:St.setGeoJSONSourceData,args:[Ze,We[Ze].data]}):Oi(Ze,We,Ge,ot)):Ei(Ze,We,Ge))})(I.sources,D.sources,he,te);var Se=[];I.layers&&I.layers.forEach(function(Ae){te[Ae.source]?G.push({command:St.removeLayer,args:[Ae.id]}):Se.push(Ae)}),G=G.concat(he),function(Ae,We,Ge){We=We||[];var ot,Ze,Xe,de,Vt,q,or,dr=(Ae=Ae||[]).map(wt),Fr=We.map(wt),on=Ae.reduce(Ri,{}),nn=We.reduce(Ri,{}),Tn=dr.slice(),ri=Object.create(null);for(ot=0,Ze=0;ot<dr.length;ot++)nn.hasOwnProperty(Xe=dr[ot])?Ze++:(Ge.push({command:St.removeLayer,args:[Xe]}),Tn.splice(Tn.indexOf(Xe,Ze),1));for(ot=0,Ze=0;ot<Fr.length;ot++)Tn[Tn.length-1-ot]!==(Xe=Fr[Fr.length-1-ot])&&(on.hasOwnProperty(Xe)?(Ge.push({command:St.removeLayer,args:[Xe]}),Tn.splice(Tn.lastIndexOf(Xe,Tn.length-Ze),1)):Ze++,Ge.push({command:St.addLayer,args:[nn[Xe],q=Tn[Tn.length-ot]]}),Tn.splice(Tn.length-ot,0,Xe),ri[Xe]=!0);for(ot=0;ot<Fr.length;ot++)if(de=on[Xe=Fr[ot]],Vt=nn[Xe],!ri[Xe]&&!y.deepEqual(de,Vt))if(y.deepEqual(de.source,Vt.source)&&y.deepEqual(de["source-layer"],Vt["source-layer"])&&y.deepEqual(de.type,Vt.type)){for(or in xt(de.layout,Vt.layout,Ge,Xe,null,St.setLayoutProperty),xt(de.paint,Vt.paint,Ge,Xe,null,St.setPaintProperty),y.deepEqual(de.filter,Vt.filter)||Ge.push({command:St.setFilter,args:[Xe,Vt.filter]}),y.deepEqual(de.minzoom,Vt.minzoom)&&y.deepEqual(de.maxzoom,Vt.maxzoom)||Ge.push({command:St.setLayerZoomRange,args:[Xe,Vt.minzoom,Vt.maxzoom]}),de)de.hasOwnProperty(or)&&or!=="layout"&&or!=="paint"&&or!=="filter"&&or!=="metadata"&&or!=="minzoom"&&or!=="maxzoom"&&(or.indexOf("paint.")===0?xt(de[or],Vt[or],Ge,Xe,or.slice(6),St.setPaintProperty):y.deepEqual(de[or],Vt[or])||Ge.push({command:St.setLayerProperty,args:[Xe,or,Vt[or]]}));for(or in Vt)Vt.hasOwnProperty(or)&&!de.hasOwnProperty(or)&&or!=="layout"&&or!=="paint"&&or!=="filter"&&or!=="metadata"&&or!=="minzoom"&&or!=="maxzoom"&&(or.indexOf("paint.")===0?xt(de[or],Vt[or],Ge,Xe,or.slice(6),St.setPaintProperty):y.deepEqual(de[or],Vt[or])||Ge.push({command:St.setLayerProperty,args:[Xe,or,Vt[or]]}))}else Ge.push({command:St.removeLayer,args:[Xe]}),q=Tn[Tn.lastIndexOf(Xe)+1],Ge.push({command:St.addLayer,args:[Vt,q]})}(Se,D.layers,G)}catch(Ae){console.warn("Unable to compute style diff:",Ae),G=[{command:St.setStyle,args:[D]}]}return G}(this.serialize(),h).filter(function(I){return!(I.command in Ks)});if(w.length===0)return!1;var M=w.filter(function(I){return!(I.command in Ts)});if(M.length>0)throw new Error("Unimplemented: "+M.map(function(I){return I.command}).join(", ")+".");return w.forEach(function(I){I.command!=="setTransition"&&g[I.command].apply(g,I.args)}),this.stylesheet=h,!0},d.prototype.addImage=function(h,g){if(this.getImage(h))return this.fire(new y.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(h,g),this._afterImageUpdated(h)},d.prototype.updateImage=function(h,g){this.imageManager.updateImage(h,g)},d.prototype.getImage=function(h){return this.imageManager.getImage(h)},d.prototype.removeImage=function(h){if(!this.getImage(h))return this.fire(new y.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(h),this._afterImageUpdated(h)},d.prototype._afterImageUpdated=function(h){this._availableImages=this.imageManager.listImages(),this._changedImages[h]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new y.Event("data",{dataType:"style"}))},d.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},d.prototype.addSource=function(h,g,w){var M=this;if(w===void 0&&(w={}),this._checkLoaded(),this.sourceCaches[h]!==void 0)throw new Error("There is already a source with this ID");if(!g.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(g).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(g.type)>=0&&this._validate(y.validateStyle.source,"sources."+h,g,null,w))){this.map&&this.map._collectResourceTiming&&(g.collectResourceTiming=!0);var I=this.sourceCaches[h]=new $e(h,g,this.dispatcher);I.style=this,I.setEventedParent(this,function(){return{isSourceLoaded:M.loaded(),source:I.serialize(),sourceId:h}}),I.onAdd(this.map),this._changed=!0}},d.prototype.removeSource=function(h){if(this._checkLoaded(),this.sourceCaches[h]===void 0)throw new Error("There is no source with this ID");for(var g in this._layers)if(this._layers[g].source===h)return this.fire(new y.ErrorEvent(new Error('Source "'+h+'" cannot be removed while layer "'+g+'" is using it.')));var w=this.sourceCaches[h];delete this.sourceCaches[h],delete this._updatedSources[h],w.fire(new y.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:h})),w.setEventedParent(null),w.clearTiles(),w.onRemove&&w.onRemove(this.map),this._changed=!0},d.prototype.setGeoJSONSourceData=function(h,g){this._checkLoaded(),this.sourceCaches[h].getSource().setData(g),this._changed=!0},d.prototype.getSource=function(h){return this.sourceCaches[h]&&this.sourceCaches[h].getSource()},d.prototype.addLayer=function(h,g,w){w===void 0&&(w={}),this._checkLoaded();var M=h.id;if(this.getLayer(M))this.fire(new y.ErrorEvent(new Error('Layer with id "'+M+'" already exists on this map')));else{var I;if(h.type==="custom"){if(As(this,y.validateCustomStyleLayer(h)))return;I=y.createStyleLayer(h)}else{if(typeof h.source=="object"&&(this.addSource(M,h.source),h=y.clone$1(h),h=y.extend(h,{source:M})),this._validate(y.validateStyle.layer,"layers."+M,h,{arrayIndex:-1},w))return;I=y.createStyleLayer(h),this._validateLayer(I),I.setEventedParent(this,{layer:{id:M}}),this._serializedLayers[I.id]=I.serialize()}var D=g?this._order.indexOf(g):this._order.length;if(g&&D===-1)this.fire(new y.ErrorEvent(new Error('Layer with id "'+g+'" does not exist on this map.')));else{if(this._order.splice(D,0,M),this._layerOrderChanged=!0,this._layers[M]=I,this._removedLayers[M]&&I.source&&I.type!=="custom"){var G=this._removedLayers[M];delete this._removedLayers[M],G.type!==I.type?this._updatedSources[I.source]="clear":(this._updatedSources[I.source]="reload",this.sourceCaches[I.source].pause())}this._updateLayer(I),I.onAdd&&I.onAdd(this.map)}}},d.prototype.moveLayer=function(h,g){if(this._checkLoaded(),this._changed=!0,this._layers[h]){if(h!==g){var w=this._order.indexOf(h);this._order.splice(w,1);var M=g?this._order.indexOf(g):this._order.length;g&&M===-1?this.fire(new y.ErrorEvent(new Error('Layer with id "'+g+'" does not exist on this map.'))):(this._order.splice(M,0,h),this._layerOrderChanged=!0)}}else this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be moved.")))},d.prototype.removeLayer=function(h){this._checkLoaded();var g=this._layers[h];if(g){g.setEventedParent(null);var w=this._order.indexOf(h);this._order.splice(w,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[h]=g,delete this._layers[h],delete this._serializedLayers[h],delete this._updatedLayers[h],delete this._updatedPaintProps[h],g.onRemove&&g.onRemove(this.map)}else this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be removed.")))},d.prototype.getLayer=function(h){return this._layers[h]},d.prototype.hasLayer=function(h){return h in this._layers},d.prototype.setLayerZoomRange=function(h,g,w){this._checkLoaded();var M=this.getLayer(h);M?M.minzoom===g&&M.maxzoom===w||(g!=null&&(M.minzoom=g),w!=null&&(M.maxzoom=w),this._updateLayer(M)):this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot have zoom extent.")))},d.prototype.setFilter=function(h,g,w){w===void 0&&(w={}),this._checkLoaded();var M=this.getLayer(h);if(M){if(!y.deepEqual(M.filter,g))return g==null?(M.filter=void 0,void this._updateLayer(M)):void(this._validate(y.validateStyle.filter,"layers."+M.id+".filter",g,null,w)||(M.filter=y.clone$1(g),this._updateLayer(M)))}else this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be filtered.")))},d.prototype.getFilter=function(h){return y.clone$1(this.getLayer(h).filter)},d.prototype.setLayoutProperty=function(h,g,w,M){M===void 0&&(M={}),this._checkLoaded();var I=this.getLayer(h);I?y.deepEqual(I.getLayoutProperty(g),w)||(I.setLayoutProperty(g,w,M),this._updateLayer(I)):this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be styled.")))},d.prototype.getLayoutProperty=function(h,g){var w=this.getLayer(h);if(w)return w.getLayoutProperty(g);this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style.")))},d.prototype.setPaintProperty=function(h,g,w,M){M===void 0&&(M={}),this._checkLoaded();var I=this.getLayer(h);I?y.deepEqual(I.getPaintProperty(g),w)||(I.setPaintProperty(g,w,M)&&this._updateLayer(I),this._changed=!0,this._updatedPaintProps[h]=!0):this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be styled.")))},d.prototype.getPaintProperty=function(h,g){return this.getLayer(h).getPaintProperty(g)},d.prototype.setFeatureState=function(h,g){this._checkLoaded();var w=h.source,M=h.sourceLayer,I=this.sourceCaches[w];if(I!==void 0){var D=I.getSource().type;D==="geojson"&&M?this.fire(new y.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):D!=="vector"||M?(h.id===void 0&&this.fire(new y.ErrorEvent(new Error("The feature id parameter must be provided."))),I.setFeatureState(M,h.id,g)):this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+w+"' does not exist in the map's style.")))},d.prototype.removeFeatureState=function(h,g){this._checkLoaded();var w=h.source,M=this.sourceCaches[w];if(M!==void 0){var I=M.getSource().type,D=I==="vector"?h.sourceLayer:void 0;I!=="vector"||D?g&&typeof h.id!="string"&&typeof h.id!="number"?this.fire(new y.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):M.removeFeatureState(D,h.id,g):this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+w+"' does not exist in the map's style.")))},d.prototype.getFeatureState=function(h){this._checkLoaded();var g=h.source,w=h.sourceLayer,M=this.sourceCaches[g];if(M!==void 0){if(M.getSource().type!=="vector"||w)return h.id===void 0&&this.fire(new y.ErrorEvent(new Error("The feature id parameter must be provided."))),M.getFeatureState(w,h.id);this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+g+"' does not exist in the map's style.")))},d.prototype.getTransition=function(){return y.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},d.prototype.serialize=function(){return y.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:y.mapObject(this.sourceCaches,function(h){return h.serialize()}),layers:this._serializeLayers(this._order)},function(h){return h!==void 0})},d.prototype._updateLayer=function(h){this._updatedLayers[h.id]=!0,h.source&&!this._updatedSources[h.source]&&this.sourceCaches[h.source].getSource().type!=="raster"&&(this._updatedSources[h.source]="reload",this.sourceCaches[h.source].pause()),this._changed=!0},d.prototype._flattenAndSortRenderedFeatures=function(h){for(var g=this,w=function(on){return g._layers[on].type==="fill-extrusion"},M={},I=[],D=this._order.length-1;D>=0;D--){var G=this._order[D];if(w(G)){M[G]=D;for(var te=0,he=h;te<he.length;te+=1){var Se=he[te][G];if(Se)for(var Ae=0,We=Se;Ae<We.length;Ae+=1)I.push(We[Ae])}}}I.sort(function(on,nn){return nn.intersectionZ-on.intersectionZ});for(var Ge=[],ot=this._order.length-1;ot>=0;ot--){var Ze=this._order[ot];if(w(Ze))for(var Xe=I.length-1;Xe>=0;Xe--){var de=I[Xe].feature;if(M[de.layer.id]<ot)break;Ge.push(de),I.pop()}else for(var Vt=0,q=h;Vt<q.length;Vt+=1){var or=q[Vt][Ze];if(or)for(var dr=0,Fr=or;dr<Fr.length;dr+=1)Ge.push(Fr[dr].feature)}}return Ge},d.prototype.queryRenderedFeatures=function(h,g,w){g&&g.filter&&this._validate(y.validateStyle.filter,"queryRenderedFeatures.filter",g.filter,null,g);var M={};if(g&&g.layers){if(!Array.isArray(g.layers))return this.fire(new y.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var I=0,D=g.layers;I<D.length;I+=1){var G=D[I],te=this._layers[G];if(!te)return this.fire(new y.ErrorEvent(new Error("The layer '"+G+"' does not exist in the map's style and cannot be queried for features."))),[];M[te.source]=!0}}var he=[];for(var Se in g.availableImages=this._availableImages,this.sourceCaches)g.layers&&!M[Se]||he.push(Tr(this.sourceCaches[Se],this._layers,this._serializedLayers,h,g,w));return this.placement&&he.push(function(Ae,We,Ge,ot,Ze,Xe,de){for(var Vt={},q=Xe.queryRenderedSymbols(ot),or=[],dr=0,Fr=Object.keys(q).map(Number);dr<Fr.length;dr+=1)or.push(de[Fr[dr]]);or.sort(Pn);for(var on=function(){var ii=Tn[nn],Ui=ii.featureIndex.lookupSymbolFeatures(q[ii.bucketInstanceId],We,ii.bucketIndex,ii.sourceLayerIndex,Ze.filter,Ze.layers,Ze.availableImages,Ae);for(var En in Ui){var wi=Vt[En]=Vt[En]||[],Ti=Ui[En];Ti.sort(function(Mi,ci){var oi=ii.featureSortOrder;if(oi){var Po=oi.indexOf(Mi.featureIndex);return oi.indexOf(ci.featureIndex)-Po}return ci.featureIndex-Mi.featureIndex});for(var yi=0,ui=Ti;yi<ui.length;yi+=1)wi.push(ui[yi])}},nn=0,Tn=or;nn<Tn.length;nn+=1)on();var ri=function(ii){Vt[ii].forEach(function(Ui){var En=Ui.feature,wi=Ge[Ae[ii].source].getFeatureState(En.layer["source-layer"],En.id);En.source=En.layer.source,En.layer["source-layer"]&&(En.sourceLayer=En.layer["source-layer"]),En.state=wi})};for(var Jn in Vt)ri(Jn);return Vt}(this._layers,this._serializedLayers,this.sourceCaches,h,g,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(he)},d.prototype.querySourceFeatures=function(h,g){g&&g.filter&&this._validate(y.validateStyle.filter,"querySourceFeatures.filter",g.filter,null,g);var w=this.sourceCaches[h];return w?function(M,I){for(var D=M.getRenderableIds().map(function(We){return M.getTileByID(We)}),G=[],te={},he=0;he<D.length;he++){var Se=D[he],Ae=Se.tileID.canonical.key;te[Ae]||(te[Ae]=!0,Se.querySourceFeatures(G,I))}return G}(w,g):[]},d.prototype.addSourceType=function(h,g,w){return d.getSourceType(h)?w(new Error('A source type called "'+h+'" already exists.')):(d.setSourceType(h,g),g.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:h,url:g.workerSourceURL},w):w(null,null))},d.prototype.getLight=function(){return this.light.getLight()},d.prototype.setLight=function(h,g){g===void 0&&(g={}),this._checkLoaded();var w=this.light.getLight(),M=!1;for(var I in h)if(!y.deepEqual(h[I],w[I])){M=!0;break}if(M){var D={now:y.browser.now(),transition:y.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(h,g),this.light.updateTransitions(D)}},d.prototype._validate=function(h,g,w,M,I){return I===void 0&&(I={}),(!I||I.validate!==!1)&&As(this,h.call(y.validateStyle,y.extend({key:g,style:this.serialize(),value:w,styleSpec:y.styleSpec},M)))},d.prototype._remove=function(){for(var h in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),y.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[h].setEventedParent(null);for(var g in this.sourceCaches)this.sourceCaches[g].clearTiles(),this.sourceCaches[g].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},d.prototype._clearSource=function(h){this.sourceCaches[h].clearTiles()},d.prototype._reloadSource=function(h){this.sourceCaches[h].resume(),this.sourceCaches[h].reload()},d.prototype._updateSources=function(h){for(var g in this.sourceCaches)this.sourceCaches[g].update(h)},d.prototype._generateCollisionBoxes=function(){for(var h in this.sourceCaches)this._reloadSource(h)},d.prototype._updatePlacement=function(h,g,w,M,I){I===void 0&&(I=!1);for(var D=!1,G=!1,te={},he=0,Se=this._order;he<Se.length;he+=1){var Ae=this._layers[Se[he]];if(Ae.type==="symbol"){if(!te[Ae.source]){var We=this.sourceCaches[Ae.source];te[Ae.source]=We.getRenderableIds(!0).map(function(de){return We.getTileByID(de)}).sort(function(de,Vt){return Vt.tileID.overscaledZ-de.tileID.overscaledZ||(de.tileID.isLessThan(Vt.tileID)?-1:1)})}var Ge=this.crossTileSymbolIndex.addLayer(Ae,te[Ae.source],h.center.lng);D=D||Ge}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((I=I||this._layerOrderChanged||w===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(y.browser.now(),h.zoom))&&(this.pauseablePlacement=new za(h,this._order,I,g,w,M,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,te),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(y.browser.now()),G=!0),D&&this.pauseablePlacement.placement.setStale()),G||D)for(var ot=0,Ze=this._order;ot<Ze.length;ot+=1){var Xe=this._layers[Ze[ot]];Xe.type==="symbol"&&this.placement.updateLayerOpacities(Xe,te[Xe.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(y.browser.now())},d.prototype._releaseSymbolFadeTiles=function(){for(var h in this.sourceCaches)this.sourceCaches[h].releaseSymbolFadeTiles()},d.prototype.getImages=function(h,g,w){this.imageManager.getImages(g.icons,w),this._updateTilesForChangedImages();var M=this.sourceCaches[g.source];M&&M.setDependencies(g.tileID.key,g.type,g.icons)},d.prototype.getGlyphs=function(h,g,w){this.glyphManager.getGlyphs(g.stacks,w)},d.prototype.getResource=function(h,g,w){return y.makeRequest(g,w)},d}(y.Evented);ps.getSourceType=function(f){return Jt[f]},ps.setSourceType=function(f,d){Jt[f]=d},ps.registerForPluginStateChange=y.registerForPluginStateChange;var Zi=y.createLayout([{name:"a_pos",type:"Int16",components:2}]),Ia=Yi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Oc=Yi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),ff=Yi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Ms=Yi(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),hf=Yi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),al=Yi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),$u=Yi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Qs=Yi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Pl=Yi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),b=Yi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),k=Yi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),U=Yi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),R=Yi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),ie=Yi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),Pe=Yi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),ct=Yi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Ft=Yi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Bt=Yi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),Er=Yi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Zr=Yi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Wn=Yi(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),ti=Yi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),gi=Yi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),$i=Yi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),wa=Yi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),Oa=Yi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Yi(f,d){var h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,g=d.match(/attribute ([\w]+) ([\w]+)/g),w=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),M=d.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),I=M?M.concat(w):w,D={};return{fragmentSource:f=f.replace(h,function(G,te,he,Se,Ae){return D[Ae]=!0,te==="define"?`
#ifndef HAS_UNIFORM_u_`+Ae+`
varying `+he+" "+Se+" "+Ae+`;
#else
uniform `+he+" "+Se+" u_"+Ae+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+Ae+`
    `+he+" "+Se+" "+Ae+" = u_"+Ae+`;
#endif
`}),vertexSource:d=d.replace(h,function(G,te,he,Se,Ae){var We=Se==="float"?"vec2":"vec4",Ge=Ae.match(/color/)?"color":We;return D[Ae]?te==="define"?`
#ifndef HAS_UNIFORM_u_`+Ae+`
uniform lowp float u_`+Ae+`_t;
attribute `+he+" "+We+" a_"+Ae+`;
varying `+he+" "+Se+" "+Ae+`;
#else
uniform `+he+" "+Se+" u_"+Ae+`;
#endif
`:Ge==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Ae+`
    `+Ae+" = a_"+Ae+`;
#else
    `+he+" "+Se+" "+Ae+" = u_"+Ae+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Ae+`
    `+Ae+" = unpack_mix_"+Ge+"(a_"+Ae+", u_"+Ae+`_t);
#else
    `+he+" "+Se+" "+Ae+" = u_"+Ae+`;
#endif
`:te==="define"?`
#ifndef HAS_UNIFORM_u_`+Ae+`
uniform lowp float u_`+Ae+`_t;
attribute `+he+" "+We+" a_"+Ae+`;
#else
uniform `+he+" "+Se+" u_"+Ae+`;
#endif
`:Ge==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Ae+`
    `+he+" "+Se+" "+Ae+" = a_"+Ae+`;
#else
    `+he+" "+Se+" "+Ae+" = u_"+Ae+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Ae+`
    `+he+" "+Se+" "+Ae+" = unpack_mix_"+Ge+"(a_"+Ae+", u_"+Ae+`_t);
#else
    `+he+" "+Se+" "+Ae+" = u_"+Ae+`;
#endif
`}),staticAttributes:g,staticUniforms:I}}var ds=Object.freeze({__proto__:null,prelude:Ia,background:Oc,backgroundPattern:ff,circle:Ms,clippingMask:hf,heatmap:al,heatmapTexture:$u,collisionBox:Qs,collisionCircle:Pl,debug:b,fill:k,fillOutline:U,fillOutlinePattern:R,fillPattern:ie,fillExtrusion:Pe,fillExtrusionPattern:ct,hillshadePrepare:Ft,hillshade:Bt,line:Er,lineGradient:Zr,linePattern:Wn,lineSDF:ti,raster:gi,symbolIcon:$i,symbolSDF:wa,symbolTextAndIcon:Oa}),fu=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function ol(f){for(var d=[],h=0;h<f.length;h++)if(f[h]!==null){var g=f[h].split(" ");d.push(g.pop())}return d}fu.prototype.bind=function(f,d,h,g,w,M,I,D){this.context=f;for(var G=this.boundPaintVertexBuffers.length!==g.length,te=0;!G&&te<g.length;te++)this.boundPaintVertexBuffers[te]!==g[te]&&(G=!0);f.extVertexArrayObject&&this.vao&&this.boundProgram===d&&this.boundLayoutVertexBuffer===h&&!G&&this.boundIndexBuffer===w&&this.boundVertexOffset===M&&this.boundDynamicVertexBuffer===I&&this.boundDynamicVertexBuffer2===D?(f.bindVertexArrayOES.set(this.vao),I&&I.bind(),w&&w.dynamicDraw&&w.bind(),D&&D.bind()):this.freshBind(d,h,g,w,M,I,D)},fu.prototype.freshBind=function(f,d,h,g,w,M,I){var D,G=f.numAttributes,te=this.context,he=te.gl;if(te.extVertexArrayObject)this.vao&&this.destroy(),this.vao=te.extVertexArrayObject.createVertexArrayOES(),te.bindVertexArrayOES.set(this.vao),D=0,this.boundProgram=f,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=g,this.boundVertexOffset=w,this.boundDynamicVertexBuffer=M,this.boundDynamicVertexBuffer2=I;else{D=te.currentNumAttributes||0;for(var Se=G;Se<D;Se++)he.disableVertexAttribArray(Se)}d.enableAttributes(he,f);for(var Ae=0,We=h;Ae<We.length;Ae+=1)We[Ae].enableAttributes(he,f);M&&M.enableAttributes(he,f),I&&I.enableAttributes(he,f),d.bind(),d.setVertexAttribPointers(he,f,w);for(var Ge=0,ot=h;Ge<ot.length;Ge+=1){var Ze=ot[Ge];Ze.bind(),Ze.setVertexAttribPointers(he,f,w)}M&&(M.bind(),M.setVertexAttribPointers(he,f,w)),g&&g.bind(),I&&(I.bind(),I.setVertexAttribPointers(he,f,w)),te.currentNumAttributes=G},fu.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var pf=function(f,d,h,g,w,M){var I=f.gl;this.program=I.createProgram();for(var D=ol(h.staticAttributes),G=g?g.getBinderAttributes():[],te=D.concat(G),he=h.staticUniforms?ol(h.staticUniforms):[],Se=g?g.getBinderUniforms():[],Ae=[],We=0,Ge=he.concat(Se);We<Ge.length;We+=1){var ot=Ge[We];Ae.indexOf(ot)<0&&Ae.push(ot)}var Ze=g?g.defines():[];M&&Ze.push("#define OVERDRAW_INSPECTOR;");var Xe=Ze.concat(Ia.fragmentSource,h.fragmentSource).join(`
`),de=Ze.concat(Ia.vertexSource,h.vertexSource).join(`
`),Vt=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())this.failedToCreate=!0;else{I.shaderSource(Vt,Xe),I.compileShader(Vt),I.attachShader(this.program,Vt);var q=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())this.failedToCreate=!0;else{I.shaderSource(q,de),I.compileShader(q),I.attachShader(this.program,q),this.attributes={};var or={};this.numAttributes=te.length;for(var dr=0;dr<this.numAttributes;dr++)te[dr]&&(I.bindAttribLocation(this.program,dr,te[dr]),this.attributes[te[dr]]=dr);I.linkProgram(this.program),I.deleteShader(q),I.deleteShader(Vt);for(var Fr=0;Fr<Ae.length;Fr++){var on=Ae[Fr];if(on&&!or[on]){var nn=I.getUniformLocation(this.program,on);nn&&(or[on]=nn)}}this.fixedUniforms=w(f,or),this.binderUniforms=g?g.getUniforms(f,or):[]}}};function sl(f,d,h){var g=1/ca(h,1,d.transform.tileZoom),w=Math.pow(2,h.tileID.overscaledZ),M=h.tileSize*Math.pow(2,d.transform.tileZoom)/w,I=M*(h.tileID.canonical.x+h.tileID.wrap*w),D=M*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[g,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[I>>16,D>>16],u_pixel_coord_lower:[65535&I,65535&D]}}pf.prototype.draw=function(f,d,h,g,w,M,I,D,G,te,he,Se,Ae,We,Ge,ot){var Ze,Xe=f.gl;if(!this.failedToCreate){for(var de in f.program.set(this.program),f.setDepthMode(h),f.setStencilMode(g),f.setColorMode(w),f.setCullFace(M),this.fixedUniforms)this.fixedUniforms[de].set(I[de]);We&&We.setUniforms(f,this.binderUniforms,Se,{zoom:Ae});for(var Vt=(Ze={},Ze[Xe.LINES]=2,Ze[Xe.TRIANGLES]=3,Ze[Xe.LINE_STRIP]=1,Ze)[d],q=0,or=he.get();q<or.length;q+=1){var dr=or[q],Fr=dr.vaos||(dr.vaos={});(Fr[D]||(Fr[D]=new fu)).bind(f,this,G,We?We.getPaintVertexBuffers():[],te,dr.vertexOffset,Ge,ot),Xe.drawElements(d,dr.primitiveLength*Vt,Xe.UNSIGNED_SHORT,dr.primitiveOffset*Vt*2)}}};var Lc=function(f,d,h,g){var w=d.style.light,M=w.properties.get("position"),I=[M.x,M.y,M.z],D=y.create$1();w.properties.get("anchor")==="viewport"&&y.fromRotation(D,-d.transform.angle),y.transformMat3(I,I,D);var G=w.properties.get("color");return{u_matrix:f,u_lightpos:I,u_lightintensity:w.properties.get("intensity"),u_lightcolor:[G.r,G.g,G.b],u_vertical_gradient:+h,u_opacity:g}},Bu=function(f,d,h,g,w,M,I){return y.extend(Lc(f,d,h,g),sl(M,d,I),{u_height_factor:-Math.pow(2,w.overscaledZ)/I.tileSize/8})},Nu=function(f){return{u_matrix:f}},zu=function(f,d,h,g){return y.extend(Nu(f),sl(h,d,g))},go=function(f,d){return{u_matrix:f,u_world:d}},Uf=function(f,d,h,g,w){return y.extend(zu(f,d,h,g),{u_world:w})},Dc=function(f,d,h,g){var w,M,I=f.transform;if(g.paint.get("circle-pitch-alignment")==="map"){var D=ca(h,1,I.zoom);w=!0,M=[D,D]}else w=!1,M=I.pixelsToGLUnits;return{u_camera_to_center_distance:I.cameraToCenterDistance,u_scale_with_map:+(g.paint.get("circle-pitch-scale")==="map"),u_matrix:f.translatePosMatrix(d.posMatrix,h,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_pitch_with_map:+w,u_device_pixel_ratio:y.browser.devicePixelRatio,u_extrude_scale:M}},vs=function(f,d,h){var g=ca(h,1,d.zoom),w=Math.pow(2,d.zoom-h.tileID.overscaledZ),M=h.tileID.overscaleFactor();return{u_matrix:f,u_camera_to_center_distance:d.cameraToCenterDistance,u_pixels_to_tile_units:g,u_extrude_scale:[d.pixelsToGLUnits[0]/(g*w),d.pixelsToGLUnits[1]/(g*w)],u_overscale_factor:M}},df=function(f,d,h){return{u_matrix:f,u_inv_matrix:d,u_camera_to_center_distance:h.cameraToCenterDistance,u_viewport_size:[h.width,h.height]}},Yu=function(f,d,h){return h===void 0&&(h=1),{u_matrix:f,u_color:d,u_overlay:0,u_overlay_scale:h}},Js=function(f){return{u_matrix:f}},Vf=function(f,d,h,g){return{u_matrix:f,u_extrude_scale:ca(d,1,h),u_intensity:g}},js=function(f,d,h){var g=f.transform;return{u_matrix:Fc(f,d,h),u_ratio:1/ca(d,1,g.zoom),u_device_pixel_ratio:y.browser.devicePixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},Ta=function(f,d,h,g){return y.extend(js(f,d,h),{u_image:0,u_image_height:g})},Rl=function(f,d,h,g){var w=f.transform,M=Zu(d,w);return{u_matrix:Fc(f,d,h),u_texsize:d.imageAtlasTexture.size,u_ratio:1/ca(d,1,w.zoom),u_device_pixel_ratio:y.browser.devicePixelRatio,u_image:0,u_scale:[M,g.fromScale,g.toScale],u_fade:g.t,u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]]}},Mh=function(f,d,h,g,w){var M=f.lineAtlas,I=Zu(d,f.transform),D=h.layout.get("line-cap")==="round",G=M.getDash(g.from,D),te=M.getDash(g.to,D),he=G.width*w.fromScale,Se=te.width*w.toScale;return y.extend(js(f,d,h),{u_patternscale_a:[I/he,-G.height/2],u_patternscale_b:[I/Se,-te.height/2],u_sdfgamma:M.width/(256*Math.min(he,Se)*y.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:G.y,u_tex_y_b:te.y,u_mix:w.t})};function Zu(f,d){return 1/ca(f,1,d.tileZoom)}function Fc(f,d,h){return f.translatePosMatrix(d.tileID.posMatrix,d,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}var op=function(f,d,h,g,w){return{u_matrix:f,u_tl_parent:d,u_scale_parent:h,u_buffer_scale:1,u_fade_t:g.mix,u_opacity:g.opacity*w.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:w.paint.get("raster-brightness-min"),u_brightness_high:w.paint.get("raster-brightness-max"),u_saturation_factor:(I=w.paint.get("raster-saturation"),I>0?1-1/(1.001-I):-I),u_contrast_factor:(M=w.paint.get("raster-contrast"),M>0?1/(1-M):1+M),u_spin_weights:sp(w.paint.get("raster-hue-rotate"))};var M,I};function sp(f){f*=Math.PI/180;var d=Math.sin(f),h=Math.cos(f);return[(2*h+1)/3,(-Math.sqrt(3)*d-h+1)/3,(Math.sqrt(3)*d-h+1)/3]}var jf,Bc=function(f,d,h,g,w,M,I,D,G,te){var he=w.transform;return{u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:d?d.uSizeT:0,u_size:d?d.uSize:0,u_camera_to_center_distance:he.cameraToCenterDistance,u_pitch:he.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:he.width/he.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_matrix:M,u_label_plane_matrix:I,u_coord_matrix:D,u_is_text:+G,u_pitch_with_map:+g,u_texsize:te,u_texture:0}},ac=function(f,d,h,g,w,M,I,D,G,te,he){var Se=w.transform;return y.extend(Bc(f,d,h,g,w,M,I,D,G,te),{u_gamma_scale:g?Math.cos(Se._pitch)*Se.cameraToCenterDistance:1,u_device_pixel_ratio:y.browser.devicePixelRatio,u_is_halo:+he})},Ol=function(f,d,h,g,w,M,I,D,G,te){return y.extend(ac(f,d,h,g,w,M,I,D,!0,G,!0),{u_texsize_icon:te,u_texture_icon:1})},Ll=function(f,d,h){return{u_matrix:f,u_opacity:d,u_color:h}},ul=function(f,d,h,g,w,M){return y.extend(function(I,D,G,te){var he=G.imageManager.getPattern(I.from.toString()),Se=G.imageManager.getPattern(I.to.toString()),Ae=G.imageManager.getPixelSize(),We=Ae.width,Ge=Ae.height,ot=Math.pow(2,te.tileID.overscaledZ),Ze=te.tileSize*Math.pow(2,G.transform.tileZoom)/ot,Xe=Ze*(te.tileID.canonical.x+te.tileID.wrap*ot),de=Ze*te.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:he.tl,u_pattern_br_a:he.br,u_pattern_tl_b:Se.tl,u_pattern_br_b:Se.br,u_texsize:[We,Ge],u_mix:D.t,u_pattern_size_a:he.displaySize,u_pattern_size_b:Se.displaySize,u_scale_a:D.fromScale,u_scale_b:D.toScale,u_tile_units_to_pixels:1/ca(te,1,G.transform.tileZoom),u_pixel_coord_upper:[Xe>>16,de>>16],u_pixel_coord_lower:[65535&Xe,65535&de]}}(g,M,h,w),{u_matrix:f,u_opacity:d})},ll={fillExtrusion:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_lightpos:new y.Uniform3f(f,d.u_lightpos),u_lightintensity:new y.Uniform1f(f,d.u_lightintensity),u_lightcolor:new y.Uniform3f(f,d.u_lightcolor),u_vertical_gradient:new y.Uniform1f(f,d.u_vertical_gradient),u_opacity:new y.Uniform1f(f,d.u_opacity)}},fillExtrusionPattern:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_lightpos:new y.Uniform3f(f,d.u_lightpos),u_lightintensity:new y.Uniform1f(f,d.u_lightintensity),u_lightcolor:new y.Uniform3f(f,d.u_lightcolor),u_vertical_gradient:new y.Uniform1f(f,d.u_vertical_gradient),u_height_factor:new y.Uniform1f(f,d.u_height_factor),u_image:new y.Uniform1i(f,d.u_image),u_texsize:new y.Uniform2f(f,d.u_texsize),u_pixel_coord_upper:new y.Uniform2f(f,d.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(f,d.u_pixel_coord_lower),u_scale:new y.Uniform3f(f,d.u_scale),u_fade:new y.Uniform1f(f,d.u_fade),u_opacity:new y.Uniform1f(f,d.u_opacity)}},fill:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix)}},fillPattern:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_image:new y.Uniform1i(f,d.u_image),u_texsize:new y.Uniform2f(f,d.u_texsize),u_pixel_coord_upper:new y.Uniform2f(f,d.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(f,d.u_pixel_coord_lower),u_scale:new y.Uniform3f(f,d.u_scale),u_fade:new y.Uniform1f(f,d.u_fade)}},fillOutline:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_world:new y.Uniform2f(f,d.u_world)}},fillOutlinePattern:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_world:new y.Uniform2f(f,d.u_world),u_image:new y.Uniform1i(f,d.u_image),u_texsize:new y.Uniform2f(f,d.u_texsize),u_pixel_coord_upper:new y.Uniform2f(f,d.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(f,d.u_pixel_coord_lower),u_scale:new y.Uniform3f(f,d.u_scale),u_fade:new y.Uniform1f(f,d.u_fade)}},circle:function(f,d){return{u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_scale_with_map:new y.Uniform1i(f,d.u_scale_with_map),u_pitch_with_map:new y.Uniform1i(f,d.u_pitch_with_map),u_extrude_scale:new y.Uniform2f(f,d.u_extrude_scale),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_matrix:new y.UniformMatrix4f(f,d.u_matrix)}},collisionBox:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_pixels_to_tile_units:new y.Uniform1f(f,d.u_pixels_to_tile_units),u_extrude_scale:new y.Uniform2f(f,d.u_extrude_scale),u_overscale_factor:new y.Uniform1f(f,d.u_overscale_factor)}},collisionCircle:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_inv_matrix:new y.UniformMatrix4f(f,d.u_inv_matrix),u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_viewport_size:new y.Uniform2f(f,d.u_viewport_size)}},debug:function(f,d){return{u_color:new y.UniformColor(f,d.u_color),u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_overlay:new y.Uniform1i(f,d.u_overlay),u_overlay_scale:new y.Uniform1f(f,d.u_overlay_scale)}},clippingMask:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix)}},heatmap:function(f,d){return{u_extrude_scale:new y.Uniform1f(f,d.u_extrude_scale),u_intensity:new y.Uniform1f(f,d.u_intensity),u_matrix:new y.UniformMatrix4f(f,d.u_matrix)}},heatmapTexture:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_world:new y.Uniform2f(f,d.u_world),u_image:new y.Uniform1i(f,d.u_image),u_color_ramp:new y.Uniform1i(f,d.u_color_ramp),u_opacity:new y.Uniform1f(f,d.u_opacity)}},hillshade:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_image:new y.Uniform1i(f,d.u_image),u_latrange:new y.Uniform2f(f,d.u_latrange),u_light:new y.Uniform2f(f,d.u_light),u_shadow:new y.UniformColor(f,d.u_shadow),u_highlight:new y.UniformColor(f,d.u_highlight),u_accent:new y.UniformColor(f,d.u_accent)}},hillshadePrepare:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_image:new y.Uniform1i(f,d.u_image),u_dimension:new y.Uniform2f(f,d.u_dimension),u_zoom:new y.Uniform1f(f,d.u_zoom),u_unpack:new y.Uniform4f(f,d.u_unpack)}},line:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_ratio:new y.Uniform1f(f,d.u_ratio),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(f,d.u_units_to_pixels)}},lineGradient:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_ratio:new y.Uniform1f(f,d.u_ratio),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(f,d.u_units_to_pixels),u_image:new y.Uniform1i(f,d.u_image),u_image_height:new y.Uniform1f(f,d.u_image_height)}},linePattern:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_texsize:new y.Uniform2f(f,d.u_texsize),u_ratio:new y.Uniform1f(f,d.u_ratio),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_image:new y.Uniform1i(f,d.u_image),u_units_to_pixels:new y.Uniform2f(f,d.u_units_to_pixels),u_scale:new y.Uniform3f(f,d.u_scale),u_fade:new y.Uniform1f(f,d.u_fade)}},lineSDF:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_ratio:new y.Uniform1f(f,d.u_ratio),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(f,d.u_units_to_pixels),u_patternscale_a:new y.Uniform2f(f,d.u_patternscale_a),u_patternscale_b:new y.Uniform2f(f,d.u_patternscale_b),u_sdfgamma:new y.Uniform1f(f,d.u_sdfgamma),u_image:new y.Uniform1i(f,d.u_image),u_tex_y_a:new y.Uniform1f(f,d.u_tex_y_a),u_tex_y_b:new y.Uniform1f(f,d.u_tex_y_b),u_mix:new y.Uniform1f(f,d.u_mix)}},raster:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_tl_parent:new y.Uniform2f(f,d.u_tl_parent),u_scale_parent:new y.Uniform1f(f,d.u_scale_parent),u_buffer_scale:new y.Uniform1f(f,d.u_buffer_scale),u_fade_t:new y.Uniform1f(f,d.u_fade_t),u_opacity:new y.Uniform1f(f,d.u_opacity),u_image0:new y.Uniform1i(f,d.u_image0),u_image1:new y.Uniform1i(f,d.u_image1),u_brightness_low:new y.Uniform1f(f,d.u_brightness_low),u_brightness_high:new y.Uniform1f(f,d.u_brightness_high),u_saturation_factor:new y.Uniform1f(f,d.u_saturation_factor),u_contrast_factor:new y.Uniform1f(f,d.u_contrast_factor),u_spin_weights:new y.Uniform3f(f,d.u_spin_weights)}},symbolIcon:function(f,d){return{u_is_size_zoom_constant:new y.Uniform1i(f,d.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(f,d.u_is_size_feature_constant),u_size_t:new y.Uniform1f(f,d.u_size_t),u_size:new y.Uniform1f(f,d.u_size),u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_pitch:new y.Uniform1f(f,d.u_pitch),u_rotate_symbol:new y.Uniform1i(f,d.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(f,d.u_aspect_ratio),u_fade_change:new y.Uniform1f(f,d.u_fade_change),u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(f,d.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(f,d.u_coord_matrix),u_is_text:new y.Uniform1i(f,d.u_is_text),u_pitch_with_map:new y.Uniform1i(f,d.u_pitch_with_map),u_texsize:new y.Uniform2f(f,d.u_texsize),u_texture:new y.Uniform1i(f,d.u_texture)}},symbolSDF:function(f,d){return{u_is_size_zoom_constant:new y.Uniform1i(f,d.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(f,d.u_is_size_feature_constant),u_size_t:new y.Uniform1f(f,d.u_size_t),u_size:new y.Uniform1f(f,d.u_size),u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_pitch:new y.Uniform1f(f,d.u_pitch),u_rotate_symbol:new y.Uniform1i(f,d.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(f,d.u_aspect_ratio),u_fade_change:new y.Uniform1f(f,d.u_fade_change),u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(f,d.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(f,d.u_coord_matrix),u_is_text:new y.Uniform1i(f,d.u_is_text),u_pitch_with_map:new y.Uniform1i(f,d.u_pitch_with_map),u_texsize:new y.Uniform2f(f,d.u_texsize),u_texture:new y.Uniform1i(f,d.u_texture),u_gamma_scale:new y.Uniform1f(f,d.u_gamma_scale),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_is_halo:new y.Uniform1i(f,d.u_is_halo)}},symbolTextAndIcon:function(f,d){return{u_is_size_zoom_constant:new y.Uniform1i(f,d.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(f,d.u_is_size_feature_constant),u_size_t:new y.Uniform1f(f,d.u_size_t),u_size:new y.Uniform1f(f,d.u_size),u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_pitch:new y.Uniform1f(f,d.u_pitch),u_rotate_symbol:new y.Uniform1i(f,d.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(f,d.u_aspect_ratio),u_fade_change:new y.Uniform1f(f,d.u_fade_change),u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(f,d.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(f,d.u_coord_matrix),u_is_text:new y.Uniform1i(f,d.u_is_text),u_pitch_with_map:new y.Uniform1i(f,d.u_pitch_with_map),u_texsize:new y.Uniform2f(f,d.u_texsize),u_texsize_icon:new y.Uniform2f(f,d.u_texsize_icon),u_texture:new y.Uniform1i(f,d.u_texture),u_texture_icon:new y.Uniform1i(f,d.u_texture_icon),u_gamma_scale:new y.Uniform1f(f,d.u_gamma_scale),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_is_halo:new y.Uniform1i(f,d.u_is_halo)}},background:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_opacity:new y.Uniform1f(f,d.u_opacity),u_color:new y.UniformColor(f,d.u_color)}},backgroundPattern:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_opacity:new y.Uniform1f(f,d.u_opacity),u_image:new y.Uniform1i(f,d.u_image),u_pattern_tl_a:new y.Uniform2f(f,d.u_pattern_tl_a),u_pattern_br_a:new y.Uniform2f(f,d.u_pattern_br_a),u_pattern_tl_b:new y.Uniform2f(f,d.u_pattern_tl_b),u_pattern_br_b:new y.Uniform2f(f,d.u_pattern_br_b),u_texsize:new y.Uniform2f(f,d.u_texsize),u_mix:new y.Uniform1f(f,d.u_mix),u_pattern_size_a:new y.Uniform2f(f,d.u_pattern_size_a),u_pattern_size_b:new y.Uniform2f(f,d.u_pattern_size_b),u_scale_a:new y.Uniform1f(f,d.u_scale_a),u_scale_b:new y.Uniform1f(f,d.u_scale_b),u_pixel_coord_upper:new y.Uniform2f(f,d.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(f,d.u_pixel_coord_lower),u_tile_units_to_pixels:new y.Uniform1f(f,d.u_tile_units_to_pixels)}}};function cl(f,d,h,g,w,M,I){for(var D=f.context,G=D.gl,te=f.useProgram("collisionBox"),he=[],Se=0,Ae=0,We=0;We<g.length;We++){var Ge=g[We],ot=d.getTile(Ge),Ze=ot.getBucket(h);if(Ze){var Xe=Ge.posMatrix;w[0]===0&&w[1]===0||(Xe=f.translatePosMatrix(Ge.posMatrix,ot,w,M));var de=I?Ze.textCollisionBox:Ze.iconCollisionBox,Vt=Ze.collisionCircleArray;if(Vt.length>0){var q=y.create(),or=Xe;y.mul(q,Ze.placementInvProjMatrix,f.transform.glCoordMatrix),y.mul(q,q,Ze.placementViewportMatrix),he.push({circleArray:Vt,circleOffset:Ae,transform:or,invTransform:q}),Ae=Se+=Vt.length/4}de&&te.draw(D,G.LINES,Me.disabled,Ve.disabled,f.colorModeForRenderPass(),_t.disabled,vs(Xe,f.transform,ot),h.id,de.layoutVertexBuffer,de.indexBuffer,de.segments,null,f.transform.zoom,null,null,de.collisionVertexBuffer)}}if(I&&he.length){var dr=f.useProgram("collisionCircle"),Fr=new y.StructArrayLayout2f1f2i16;Fr.resize(4*Se),Fr._trim();for(var on=0,nn=0,Tn=he;nn<Tn.length;nn+=1)for(var ri=Tn[nn],Jn=0;Jn<ri.circleArray.length/4;Jn++){var ii=4*Jn,Ui=ri.circleArray[ii+0],En=ri.circleArray[ii+1],wi=ri.circleArray[ii+2],Ti=ri.circleArray[ii+3];Fr.emplace(on++,Ui,En,wi,Ti,0),Fr.emplace(on++,Ui,En,wi,Ti,1),Fr.emplace(on++,Ui,En,wi,Ti,2),Fr.emplace(on++,Ui,En,wi,Ti,3)}(!jf||jf.length<2*Se)&&(jf=function(Qa){var So=2*Qa,Bo=new y.StructArrayLayout3ui6;Bo.resize(So),Bo._trim();for(var Ja=0;Ja<So;Ja++){var yo=6*Ja;Bo.uint16[yo+0]=4*Ja+0,Bo.uint16[yo+1]=4*Ja+1,Bo.uint16[yo+2]=4*Ja+2,Bo.uint16[yo+3]=4*Ja+2,Bo.uint16[yo+4]=4*Ja+3,Bo.uint16[yo+5]=4*Ja+0}return Bo}(Se));for(var yi=D.createIndexBuffer(jf,!0),ui=D.createVertexBuffer(Fr,y.collisionCircleLayout.members,!0),Mi=0,ci=he;Mi<ci.length;Mi+=1){var oi=ci[Mi],Po=df(oi.transform,oi.invTransform,f.transform);dr.draw(D,G.TRIANGLES,Me.disabled,Ve.disabled,f.colorModeForRenderPass(),_t.disabled,Po,h.id,ui,yi,y.SegmentVector.simpleSegment(0,2*oi.circleOffset,oi.circleArray.length,oi.circleArray.length/2),null,f.transform.zoom,null,null,null)}ui.destroy(),yi.destroy()}}var eu=y.identity(new Float32Array(16));function vf(f,d,h,g,w,M){var I=y.getAnchorAlignment(f),D=-(I.horizontalAlign-.5)*d,G=-(I.verticalAlign-.5)*h,te=y.evaluateVariableOffset(f,g);return new y.Point((D/w+te[0])*M,(G/w+te[1])*M)}function mf(f,d,h,g,w,M,I,D,G,te,he){var Se=f.text.placedSymbolArray,Ae=f.text.dynamicLayoutVertexArray,We=f.icon.dynamicLayoutVertexArray,Ge={};Ae.clear();for(var ot=0;ot<Se.length;ot++){var Ze=Se.get(ot),Xe=Ze.hidden||!Ze.crossTileID||f.allowVerticalPlacement&&!Ze.placedOrientation?null:g[Ze.crossTileID];if(Xe){var de=new y.Point(Ze.anchorX,Ze.anchorY),Vt=Di(de,h?D:I),q=gr(M.cameraToCenterDistance,Vt.signedDistanceFromCamera),or=w.evaluateSizeForFeature(f.textSizeData,te,Ze)*q/y.ONE_EM;h&&(or*=f.tilePixelRatio/G);for(var dr=vf(Xe.anchor,Xe.width,Xe.height,Xe.textOffset,Xe.textBoxScale,or),Fr=h?Di(de.add(dr),I).point:Vt.point.add(d?dr.rotate(-M.angle):dr),on=f.allowVerticalPlacement&&Ze.placedOrientation===y.WritingMode.vertical?Math.PI/2:0,nn=0;nn<Ze.numGlyphs;nn++)y.addDynamicAttributes(Ae,Fr,on);he&&Ze.associatedIconIndex>=0&&(Ge[Ze.associatedIconIndex]={shiftedAnchor:Fr,angle:on})}else no(Ze.numGlyphs,Ae)}if(he){We.clear();for(var Tn=f.icon.placedSymbolArray,ri=0;ri<Tn.length;ri++){var Jn=Tn.get(ri);if(Jn.hidden)no(Jn.numGlyphs,We);else{var ii=Ge[ri];if(ii)for(var Ui=0;Ui<Jn.numGlyphs;Ui++)y.addDynamicAttributes(We,ii.shiftedAnchor,ii.angle);else no(Jn.numGlyphs,We)}}f.icon.dynamicLayoutVertexBuffer.updateData(We)}f.text.dynamicLayoutVertexBuffer.updateData(Ae)}function Dl(f,d,h){return h.iconsInText&&d?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function fl(f,d,h,g,w,M,I,D,G,te,he,Se){for(var Ae=f.context,We=Ae.gl,Ge=f.transform,ot=D==="map",Ze=G==="map",Xe=ot&&h.layout.get("symbol-placement")!=="point",de=ot&&!Ze&&!Xe,Vt=h.layout.get("symbol-sort-key").constantOr(1)!==void 0,q=!1,or=f.depthModeForSublayer(0,Me.ReadOnly),dr=h.layout.get("text-variable-anchor"),Fr=[],on=0,nn=g;on<nn.length;on+=1){var Tn=nn[on],ri=d.getTile(Tn),Jn=ri.getBucket(h);if(Jn){var ii=w?Jn.text:Jn.icon;if(ii&&ii.segments.get().length){var Ui=ii.programConfigurations.get(h.id),En=w||Jn.sdfIcons,wi=w?Jn.textSizeData:Jn.iconSizeData,Ti=Ze||Ge.pitch!==0,yi=f.useProgram(Dl(En,w,Jn),Ui),ui=y.evaluateSizeForZoom(wi,Ge.zoom),Mi=void 0,ci=[0,0],oi=void 0,Po=void 0,Qa=null,So=void 0;if(w)oi=ri.glyphAtlasTexture,Po=We.LINEAR,Mi=ri.glyphAtlasTexture.size,Jn.iconsInText&&(ci=ri.imageAtlasTexture.size,Qa=ri.imageAtlasTexture,So=Ti||f.options.rotating||f.options.zooming||wi.kind==="composite"||wi.kind==="camera"?We.LINEAR:We.NEAREST);else{var Bo=h.layout.get("icon-size").constantOr(0)!==1||Jn.iconsNeedLinear;oi=ri.imageAtlasTexture,Po=En||f.options.rotating||f.options.zooming||Bo||Ti?We.LINEAR:We.NEAREST,Mi=ri.imageAtlasTexture.size}var Ja=ca(ri,1,f.transform.zoom),yo=ea(Tn.posMatrix,Ze,ot,f.transform,Ja),Fs=la(Tn.posMatrix,Ze,ot,f.transform,Ja),No=dr&&Jn.hasTextData(),Iu=h.layout.get("icon-text-fit")!=="none"&&No&&Jn.hasIconData();Xe&&rt(Jn,Tn.posMatrix,f,w,yo,Fs,Ze,te);var ys=f.translatePosMatrix(Tn.posMatrix,ri,M,I),mu=Xe||w&&dr||Iu?eu:yo,au=f.translatePosMatrix(Fs,ri,M,I,!0),gl=En&&h.paint.get(w?"text-halo-width":"icon-halo-width").constantOr(1)!==0,jl={program:yi,buffers:ii,uniformValues:En?Jn.iconsInText?Ol(wi.kind,ui,de,Ze,f,ys,mu,au,Mi,ci):ac(wi.kind,ui,de,Ze,f,ys,mu,au,w,Mi,!0):Bc(wi.kind,ui,de,Ze,f,ys,mu,au,w,Mi),atlasTexture:oi,atlasTextureIcon:Qa,atlasInterpolation:Po,atlasInterpolationIcon:So,isSDF:En,hasHalo:gl};if(Vt&&Jn.canOverlap){q=!0;for(var ss=0,yl=ii.segments.get();ss<yl.length;ss+=1){var $c=yl[ss];Fr.push({segments:new y.SegmentVector([$c]),sortKey:$c.sortKey,state:jl})}}else Fr.push({segments:ii.segments,sortKey:0,state:jl})}}}q&&Fr.sort(function(_l,xl){return _l.sortKey-xl.sortKey});for(var gu=0,mc=Fr;gu<mc.length;gu+=1){var Gu=mc[gu],wo=Gu.state;if(Ae.activeTexture.set(We.TEXTURE0),wo.atlasTexture.bind(wo.atlasInterpolation,We.CLAMP_TO_EDGE),wo.atlasTextureIcon&&(Ae.activeTexture.set(We.TEXTURE1),wo.atlasTextureIcon&&wo.atlasTextureIcon.bind(wo.atlasInterpolationIcon,We.CLAMP_TO_EDGE)),wo.isSDF){var Pu=wo.uniformValues;wo.hasHalo&&(Pu.u_is_halo=1,oc(wo.buffers,Gu.segments,h,f,wo.program,or,he,Se,Pu)),Pu.u_is_halo=0}oc(wo.buffers,Gu.segments,h,f,wo.program,or,he,Se,wo.uniformValues)}}function oc(f,d,h,g,w,M,I,D,G){var te=g.context;w.draw(te,te.gl.TRIANGLES,M,I,D,_t.disabled,G,h.id,f.layoutVertexBuffer,f.indexBuffer,d,h.paint,g.transform.zoom,f.programConfigurations.get(h.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer)}function Nc(f,d,h,g,w,M,I){var D,G,te,he,Se,Ae=f.context.gl,We=h.paint.get("fill-pattern"),Ge=We&&We.constantOr(1),ot=h.getCrossfadeParameters();I?(G=Ge&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",D=Ae.LINES):(G=Ge?"fillPattern":"fill",D=Ae.TRIANGLES);for(var Ze=0,Xe=g;Ze<Xe.length;Ze+=1){var de=Xe[Ze],Vt=d.getTile(de);if(!Ge||Vt.patternsLoaded()){var q=Vt.getBucket(h);if(q){var or=q.programConfigurations.get(h.id),dr=f.useProgram(G,or);Ge&&(f.context.activeTexture.set(Ae.TEXTURE0),Vt.imageAtlasTexture.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE),or.updatePaintBuffers(ot));var Fr=We.constantOr(null);if(Fr&&Vt.imageAtlas){var on=Vt.imageAtlas,nn=on.patternPositions[Fr.to.toString()],Tn=on.patternPositions[Fr.from.toString()];nn&&Tn&&or.setConstantPatternPositions(nn,Tn)}var ri=f.translatePosMatrix(de.posMatrix,Vt,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(I){he=q.indexBuffer2,Se=q.segments2;var Jn=[Ae.drawingBufferWidth,Ae.drawingBufferHeight];te=G==="fillOutlinePattern"&&Ge?Uf(ri,f,ot,Vt,Jn):go(ri,Jn)}else he=q.indexBuffer,Se=q.segments,te=Ge?zu(ri,f,ot,Vt):Nu(ri);dr.draw(f.context,D,w,f.stencilModeForClipping(de),M,_t.disabled,te,h.id,q.layoutVertexBuffer,he,Se,h.paint,f.transform.zoom,or)}}}}function sc(f,d,h,g,w,M,I){for(var D=f.context,G=D.gl,te=h.paint.get("fill-extrusion-pattern"),he=te.constantOr(1),Se=h.getCrossfadeParameters(),Ae=h.paint.get("fill-extrusion-opacity"),We=0,Ge=g;We<Ge.length;We+=1){var ot=Ge[We],Ze=d.getTile(ot),Xe=Ze.getBucket(h);if(Xe){var de=Xe.programConfigurations.get(h.id),Vt=f.useProgram(he?"fillExtrusionPattern":"fillExtrusion",de);he&&(f.context.activeTexture.set(G.TEXTURE0),Ze.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),de.updatePaintBuffers(Se));var q=te.constantOr(null);if(q&&Ze.imageAtlas){var or=Ze.imageAtlas,dr=or.patternPositions[q.to.toString()],Fr=or.patternPositions[q.from.toString()];dr&&Fr&&de.setConstantPatternPositions(dr,Fr)}var on=f.translatePosMatrix(ot.posMatrix,Ze,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),nn=h.paint.get("fill-extrusion-vertical-gradient"),Tn=he?Bu(on,f,nn,Ae,ot,Se,Ze):Lc(on,f,nn,Ae);Vt.draw(D,D.gl.TRIANGLES,w,M,I,_t.backCCW,Tn,h.id,Xe.layoutVertexBuffer,Xe.indexBuffer,Xe.segments,h.paint,f.transform.zoom,de)}}}function gf(f,d,h,g,w,M){var I=f.context,D=I.gl,G=d.fbo;if(G){var te=f.useProgram("hillshade");I.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,G.colorAttachment.get());var he=function(Se,Ae,We){var Ge=We.paint.get("hillshade-shadow-color"),ot=We.paint.get("hillshade-highlight-color"),Ze=We.paint.get("hillshade-accent-color"),Xe=We.paint.get("hillshade-illumination-direction")*(Math.PI/180);We.paint.get("hillshade-illumination-anchor")==="viewport"&&(Xe-=Se.transform.angle);var de,Vt,q,or=!Se.options.moving;return{u_matrix:Se.transform.calculatePosMatrix(Ae.tileID.toUnwrapped(),or),u_image:0,u_latrange:(de=Ae.tileID,Vt=Math.pow(2,de.canonical.z),q=de.canonical.y,[new y.MercatorCoordinate(0,q/Vt).toLngLat().lat,new y.MercatorCoordinate(0,(q+1)/Vt).toLngLat().lat]),u_light:[We.paint.get("hillshade-exaggeration"),Xe],u_shadow:Ge,u_highlight:ot,u_accent:Ze}}(f,d,h);te.draw(I,D.TRIANGLES,g,w,M,_t.disabled,he,h.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}}function up(f,d,h,g,w,M){var I=f.context,D=I.gl,G=d.dem;if(G&&G.data){var te=G.dim,he=G.stride,Se=G.getPixels();if(I.activeTexture.set(D.TEXTURE1),I.pixelStoreUnpackPremultiplyAlpha.set(!1),d.demTexture=d.demTexture||f.getTileTexture(he),d.demTexture){var Ae=d.demTexture;Ae.update(Se,{premultiply:!1}),Ae.bind(D.NEAREST,D.CLAMP_TO_EDGE)}else d.demTexture=new y.Texture(I,Se,D.RGBA,{premultiply:!1}),d.demTexture.bind(D.NEAREST,D.CLAMP_TO_EDGE);I.activeTexture.set(D.TEXTURE0);var We=d.fbo;if(!We){var Ge=new y.Texture(I,{width:te,height:te,data:null},D.RGBA);Ge.bind(D.LINEAR,D.CLAMP_TO_EDGE),(We=d.fbo=I.createFramebuffer(te,te,!0)).colorAttachment.set(Ge.texture)}I.bindFramebuffer.set(We.framebuffer),I.viewport.set([0,0,te,te]),f.useProgram("hillshadePrepare").draw(I,D.TRIANGLES,g,w,M,_t.disabled,function(ot,Ze){var Xe=Ze.stride,de=y.create();return y.ortho(de,0,y.EXTENT,-y.EXTENT,0,0,1),y.translate(de,de,[0,-y.EXTENT,0]),{u_matrix:de,u_image:1,u_dimension:[Xe,Xe],u_zoom:ot.overscaledZ,u_unpack:Ze.getUnpackVector()}}(d.tileID,G),h.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments),d.needsHillshadePrepare=!1}}function yf(f,d,h,g,w){var M=g.paint.get("raster-fade-duration");if(M>0){var I=y.browser.now(),D=(I-f.timeAdded)/M,G=d?(I-d.timeAdded)/M:-1,te=h.getSource(),he=w.coveringZoomLevel({tileSize:te.tileSize,roundZoom:te.roundZoom}),Se=!d||Math.abs(d.tileID.overscaledZ-he)>Math.abs(f.tileID.overscaledZ-he),Ae=Se&&f.refreshedUponExpiration?1:y.clamp(Se?D:1-G,0,1);return f.refreshedUponExpiration&&D>=1&&(f.refreshedUponExpiration=!1),d?{opacity:1,mix:1-Ae}:{opacity:Ae,mix:0}}return{opacity:1,mix:0}}var hl=new y.Color(1,0,0,1),_f=new y.Color(0,1,0,1),Gf=new y.Color(0,0,1,1),Uu=new y.Color(1,0,1,1),kh=new y.Color(0,1,1,1);function Ih(f,d,h,g){Fl(f,0,d+h/2,f.transform.width,h,g)}function Ph(f,d,h,g){Fl(f,d-h/2,0,h,f.transform.height,g)}function Fl(f,d,h,g,w,M){var I=f.context,D=I.gl;D.enable(D.SCISSOR_TEST),D.scissor(d*y.browser.devicePixelRatio,h*y.browser.devicePixelRatio,g*y.browser.devicePixelRatio,w*y.browser.devicePixelRatio),I.clear({color:M}),D.disable(D.SCISSOR_TEST)}function Rh(f,d,h){var g=f.context,w=g.gl,M=h.posMatrix,I=f.useProgram("debug"),D=Me.disabled,G=Ve.disabled,te=f.colorModeForRenderPass();g.activeTexture.set(w.TEXTURE0),f.emptyTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),I.draw(g,w.LINE_STRIP,D,G,te,_t.disabled,Yu(M,y.Color.red),"$debug",f.debugBuffer,f.tileBorderIndexBuffer,f.debugSegments);var he=d.getTileByID(h.key).latestRawTileData,Se=Math.floor((he&&he.byteLength||0)/1024),Ae=d.getTile(h).tileSize,We=512/Math.min(Ae,512)*(h.overscaledZ/f.transform.zoom)*.5,Ge=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(Ge+=" => "+h.overscaledZ),function(ot,Ze){ot.initDebugOverlayCanvas();var Xe=ot.debugOverlayCanvas,de=ot.context.gl,Vt=ot.debugOverlayCanvas.getContext("2d");Vt.clearRect(0,0,Xe.width,Xe.height),Vt.shadowColor="white",Vt.shadowBlur=2,Vt.lineWidth=1.5,Vt.strokeStyle="white",Vt.textBaseline="top",Vt.font="bold 36px Open Sans, sans-serif",Vt.fillText(Ze,5,5),Vt.strokeText(Ze,5,5),ot.debugOverlayTexture.update(Xe),ot.debugOverlayTexture.bind(de.LINEAR,de.CLAMP_TO_EDGE)}(f,Ge+" "+Se+"kb"),I.draw(g,w.TRIANGLES,D,G,at.alphaBlended,_t.disabled,Yu(M,y.Color.transparent,We),"$debug",f.debugBuffer,f.quadTriangleIndexBuffer,f.debugSegments)}var rs={symbol:function(f,d,h,g,w){if(f.renderPass==="translucent"){var M=Ve.disabled,I=f.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(D,G,te,he,Se,Ae,We){for(var Ge=G.transform,ot=Se==="map",Ze=Ae==="map",Xe=0,de=D;Xe<de.length;Xe+=1){var Vt=de[Xe],q=he.getTile(Vt),or=q.getBucket(te);if(or&&or.text&&or.text.segments.get().length){var dr=y.evaluateSizeForZoom(or.textSizeData,Ge.zoom),Fr=ca(q,1,G.transform.zoom),on=ea(Vt.posMatrix,Ze,ot,G.transform,Fr),nn=te.layout.get("icon-text-fit")!=="none"&&or.hasIconData();if(dr){var Tn=Math.pow(2,Ge.zoom-q.tileID.overscaledZ);mf(or,ot,Ze,We,y.symbolSize,Ge,on,Vt.posMatrix,Tn,dr,nn)}}}}(g,f,h,d,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),w),h.paint.get("icon-opacity").constantOr(1)!==0&&fl(f,d,h,g,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),M,I),h.paint.get("text-opacity").constantOr(1)!==0&&fl(f,d,h,g,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),M,I),d.map.showCollisionBoxes&&(cl(f,d,h,g,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),cl(f,d,h,g,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))}},circle:function(f,d,h,g){if(f.renderPass==="translucent"){var w=h.paint.get("circle-opacity"),M=h.paint.get("circle-stroke-width"),I=h.paint.get("circle-stroke-opacity"),D=h.layout.get("circle-sort-key").constantOr(1)!==void 0;if(w.constantOr(1)!==0||M.constantOr(1)!==0&&I.constantOr(1)!==0){for(var G=f.context,te=G.gl,he=f.depthModeForSublayer(0,Me.ReadOnly),Se=Ve.disabled,Ae=f.colorModeForRenderPass(),We=[],Ge=0;Ge<g.length;Ge++){var ot=g[Ge],Ze=d.getTile(ot),Xe=Ze.getBucket(h);if(Xe){var de=Xe.programConfigurations.get(h.id),Vt={programConfiguration:de,program:f.useProgram("circle",de),layoutVertexBuffer:Xe.layoutVertexBuffer,indexBuffer:Xe.indexBuffer,uniformValues:Dc(f,ot,Ze,h)};if(D)for(var q=0,or=Xe.segments.get();q<or.length;q+=1){var dr=or[q];We.push({segments:new y.SegmentVector([dr]),sortKey:dr.sortKey,state:Vt})}else We.push({segments:Xe.segments,sortKey:0,state:Vt})}}D&&We.sort(function(ri,Jn){return ri.sortKey-Jn.sortKey});for(var Fr=0,on=We;Fr<on.length;Fr+=1){var nn=on[Fr],Tn=nn.state;Tn.program.draw(G,te.TRIANGLES,he,Se,Ae,_t.disabled,Tn.uniformValues,h.id,Tn.layoutVertexBuffer,Tn.indexBuffer,nn.segments,h.paint,f.transform.zoom,Tn.programConfiguration)}}}},heatmap:function(f,d,h,g){if(h.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){var w=f.context,M=w.gl,I=Ve.disabled,D=new at([M.ONE,M.ONE],y.Color.transparent,[!0,!0,!0,!0]);(function(We,Ge,ot){var Ze=We.gl;We.activeTexture.set(Ze.TEXTURE1),We.viewport.set([0,0,Ge.width/4,Ge.height/4]);var Xe=ot.heatmapFbo;if(Xe)Ze.bindTexture(Ze.TEXTURE_2D,Xe.colorAttachment.get()),We.bindFramebuffer.set(Xe.framebuffer);else{var de=Ze.createTexture();Ze.bindTexture(Ze.TEXTURE_2D,de),Ze.texParameteri(Ze.TEXTURE_2D,Ze.TEXTURE_WRAP_S,Ze.CLAMP_TO_EDGE),Ze.texParameteri(Ze.TEXTURE_2D,Ze.TEXTURE_WRAP_T,Ze.CLAMP_TO_EDGE),Ze.texParameteri(Ze.TEXTURE_2D,Ze.TEXTURE_MIN_FILTER,Ze.LINEAR),Ze.texParameteri(Ze.TEXTURE_2D,Ze.TEXTURE_MAG_FILTER,Ze.LINEAR),Xe=ot.heatmapFbo=We.createFramebuffer(Ge.width/4,Ge.height/4,!1),function(Vt,q,or,dr){var Fr=Vt.gl;Fr.texImage2D(Fr.TEXTURE_2D,0,Fr.RGBA,q.width/4,q.height/4,0,Fr.RGBA,Vt.extRenderToTextureHalfFloat?Vt.extTextureHalfFloat.HALF_FLOAT_OES:Fr.UNSIGNED_BYTE,null),dr.colorAttachment.set(or)}(We,Ge,de,Xe)}})(w,f,h),w.clear({color:y.Color.transparent});for(var G=0;G<g.length;G++){var te=g[G];if(!d.hasRenderableParent(te)){var he=d.getTile(te),Se=he.getBucket(h);if(Se){var Ae=Se.programConfigurations.get(h.id);f.useProgram("heatmap",Ae).draw(w,M.TRIANGLES,Me.disabled,I,D,_t.disabled,Vf(te.posMatrix,he,f.transform.zoom,h.paint.get("heatmap-intensity")),h.id,Se.layoutVertexBuffer,Se.indexBuffer,Se.segments,h.paint,f.transform.zoom,Ae)}}}w.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(We,Ge){var ot=We.context,Ze=ot.gl,Xe=Ge.heatmapFbo;if(Xe){ot.activeTexture.set(Ze.TEXTURE0),Ze.bindTexture(Ze.TEXTURE_2D,Xe.colorAttachment.get()),ot.activeTexture.set(Ze.TEXTURE1);var de=Ge.colorRampTexture;de||(de=Ge.colorRampTexture=new y.Texture(ot,Ge.colorRamp,Ze.RGBA)),de.bind(Ze.LINEAR,Ze.CLAMP_TO_EDGE),We.useProgram("heatmapTexture").draw(ot,Ze.TRIANGLES,Me.disabled,Ve.disabled,We.colorModeForRenderPass(),_t.disabled,function(Vt,q,or,dr){var Fr=y.create();y.ortho(Fr,0,Vt.width,Vt.height,0,0,1);var on=Vt.context.gl;return{u_matrix:Fr,u_world:[on.drawingBufferWidth,on.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:q.paint.get("heatmap-opacity")}}(We,Ge),Ge.id,We.viewportBuffer,We.quadTriangleIndexBuffer,We.viewportSegments,Ge.paint,We.transform.zoom)}}(f,h))},line:function(f,d,h,g){if(f.renderPass==="translucent"){var w=h.paint.get("line-opacity"),M=h.paint.get("line-width");if(w.constantOr(1)!==0&&M.constantOr(1)!==0)for(var I=f.depthModeForSublayer(0,Me.ReadOnly),D=f.colorModeForRenderPass(),G=h.paint.get("line-dasharray"),te=h.paint.get("line-pattern"),he=te.constantOr(1),Se=h.paint.get("line-gradient"),Ae=h.getCrossfadeParameters(),We=he?"linePattern":G?"lineSDF":Se?"lineGradient":"line",Ge=f.context,ot=Ge.gl,Ze=!0,Xe=0,de=g;Xe<de.length;Xe+=1){var Vt=de[Xe],q=d.getTile(Vt);if(!he||q.patternsLoaded()){var or=q.getBucket(h);if(or){var dr=or.programConfigurations.get(h.id),Fr=f.context.program.get(),on=f.useProgram(We,dr),nn=Ze||on.program!==Fr,Tn=te.constantOr(null);if(Tn&&q.imageAtlas){var ri=q.imageAtlas,Jn=ri.patternPositions[Tn.to.toString()],ii=ri.patternPositions[Tn.from.toString()];Jn&&ii&&dr.setConstantPatternPositions(Jn,ii)}var Ui=he?Rl(f,q,h,Ae):G?Mh(f,q,h,G,Ae):Se?Ta(f,q,h,or.lineClipsArray.length):js(f,q,h);if(he)Ge.activeTexture.set(ot.TEXTURE0),q.imageAtlasTexture.bind(ot.LINEAR,ot.CLAMP_TO_EDGE),dr.updatePaintBuffers(Ae);else if(G&&(nn||f.lineAtlas.dirty))Ge.activeTexture.set(ot.TEXTURE0),f.lineAtlas.bind(Ge);else if(Se){var En=or.gradients[h.id],wi=En.texture;if(h.gradientVersion!==En.version){var Ti=256;if(h.stepInterpolant){var yi=d.getSource().maxzoom,ui=Vt.canonical.z===yi?Math.ceil(1<<f.transform.maxZoom-Vt.canonical.z):1;Ti=y.clamp(y.nextPowerOfTwo(or.maxLineLength/y.EXTENT*1024*ui),256,Ge.maxTextureSize)}En.gradient=y.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:Ti,image:En.gradient||void 0,clips:or.lineClipsArray}),En.texture?En.texture.update(En.gradient):En.texture=new y.Texture(Ge,En.gradient,ot.RGBA),En.version=h.gradientVersion,wi=En.texture}Ge.activeTexture.set(ot.TEXTURE0),wi.bind(h.stepInterpolant?ot.NEAREST:ot.LINEAR,ot.CLAMP_TO_EDGE)}on.draw(Ge,ot.TRIANGLES,I,f.stencilModeForClipping(Vt),D,_t.disabled,Ui,h.id,or.layoutVertexBuffer,or.indexBuffer,or.segments,h.paint,f.transform.zoom,dr,or.layoutVertexBuffer2),Ze=!1}}}}},fill:function(f,d,h,g){var w=h.paint.get("fill-color"),M=h.paint.get("fill-opacity");if(M.constantOr(1)!==0){var I=f.colorModeForRenderPass(),D=h.paint.get("fill-pattern"),G=f.opaquePassEnabledForLayer()&&!D.constantOr(1)&&w.constantOr(y.Color.transparent).a===1&&M.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===G){var te=f.depthModeForSublayer(1,f.renderPass==="opaque"?Me.ReadWrite:Me.ReadOnly);Nc(f,d,h,g,te,I,!1)}if(f.renderPass==="translucent"&&h.paint.get("fill-antialias")){var he=f.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,Me.ReadOnly);Nc(f,d,h,g,he,I,!0)}}},"fill-extrusion":function(f,d,h,g){var w=h.paint.get("fill-extrusion-opacity");if(w!==0&&f.renderPass==="translucent"){var M=new Me(f.context.gl.LEQUAL,Me.ReadWrite,f.depthRangeFor3D);if(w!==1||h.paint.get("fill-extrusion-pattern").constantOr(1))sc(f,d,h,g,M,Ve.disabled,at.disabled),sc(f,d,h,g,M,f.stencilModeFor3D(),f.colorModeForRenderPass());else{var I=f.colorModeForRenderPass();sc(f,d,h,g,M,Ve.disabled,I)}}},hillshade:function(f,d,h,g){if(f.renderPass==="offscreen"||f.renderPass==="translucent"){for(var w=f.context,M=f.depthModeForSublayer(0,Me.ReadOnly),I=f.colorModeForRenderPass(),D=f.renderPass==="translucent"?f.stencilConfigForOverlap(g):[{},g],G=D[0],te=0,he=D[1];te<he.length;te+=1){var Se=he[te],Ae=d.getTile(Se);Ae.needsHillshadePrepare&&f.renderPass==="offscreen"?up(f,Ae,h,M,Ve.disabled,I):f.renderPass==="translucent"&&gf(f,Ae,h,M,G[Se.overscaledZ],I)}w.viewport.set([0,0,f.width,f.height])}},raster:function(f,d,h,g){if(f.renderPass==="translucent"&&h.paint.get("raster-opacity")!==0&&g.length)for(var w=f.context,M=w.gl,I=d.getSource(),D=f.useProgram("raster"),G=f.colorModeForRenderPass(),te=I instanceof et?[{},g]:f.stencilConfigForOverlap(g),he=te[0],Se=te[1],Ae=Se[Se.length-1].overscaledZ,We=!f.options.moving,Ge=0,ot=Se;Ge<ot.length;Ge+=1){var Ze=ot[Ge],Xe=f.depthModeForSublayer(Ze.overscaledZ-Ae,h.paint.get("raster-opacity")===1?Me.ReadWrite:Me.ReadOnly,M.LESS),de=d.getTile(Ze),Vt=f.transform.calculatePosMatrix(Ze.toUnwrapped(),We);de.registerFadeDuration(h.paint.get("raster-fade-duration"));var q=d.findLoadedParent(Ze,0),or=yf(de,q,d,h,f.transform),dr=void 0,Fr=void 0,on=h.paint.get("raster-resampling")==="nearest"?M.NEAREST:M.LINEAR;w.activeTexture.set(M.TEXTURE0),de.texture.bind(on,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),w.activeTexture.set(M.TEXTURE1),q?(q.texture.bind(on,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),dr=Math.pow(2,q.tileID.overscaledZ-de.tileID.overscaledZ),Fr=[de.tileID.canonical.x*dr%1,de.tileID.canonical.y*dr%1]):de.texture.bind(on,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST);var nn=op(Vt,Fr||[0,0],dr||1,or,h);I instanceof et?D.draw(w,M.TRIANGLES,Xe,Ve.disabled,G,_t.disabled,nn,h.id,I.boundsBuffer,f.quadTriangleIndexBuffer,I.boundsSegments):D.draw(w,M.TRIANGLES,Xe,he[Ze.overscaledZ],G,_t.disabled,nn,h.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}},background:function(f,d,h){var g=h.paint.get("background-color"),w=h.paint.get("background-opacity");if(w!==0){var M=f.context,I=M.gl,D=f.transform,G=D.tileSize,te=h.paint.get("background-pattern");if(!f.isPatternMissing(te)){var he=!te&&g.a===1&&w===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass===he){var Se=Ve.disabled,Ae=f.depthModeForSublayer(0,he==="opaque"?Me.ReadWrite:Me.ReadOnly),We=f.colorModeForRenderPass(),Ge=f.useProgram(te?"backgroundPattern":"background"),ot=D.coveringTiles({tileSize:G});te&&(M.activeTexture.set(I.TEXTURE0),f.imageManager.bind(f.context));for(var Ze=h.getCrossfadeParameters(),Xe=0,de=ot;Xe<de.length;Xe+=1){var Vt=de[Xe],q=f.transform.calculatePosMatrix(Vt.toUnwrapped()),or=te?ul(q,w,f,te,{tileID:Vt,tileSize:G},Ze):Ll(q,w,g);Ge.draw(M,I.TRIANGLES,Ae,Se,We,_t.disabled,or,h.id,f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}}}}},debug:function(f,d,h){for(var g=0;g<h.length;g++)Rh(f,d,h[g])},custom:function(f,d,h){var g=f.context,w=h.implementation;if(f.renderPass==="offscreen"){var M=w.prerender;M&&(f.setCustomLayerDefaults(),g.setColorMode(f.colorModeForRenderPass()),M.call(w,g.gl,f.transform.customLayerMatrix()),g.setDirty(),f.setBaseState())}else if(f.renderPass==="translucent"){f.setCustomLayerDefaults(),g.setColorMode(f.colorModeForRenderPass()),g.setStencilMode(Ve.disabled);var I=w.renderingMode==="3d"?new Me(f.context.gl.LEQUAL,Me.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,Me.ReadOnly);g.setDepthMode(I),w.render(g.gl,f.transform.customLayerMatrix()),g.setDirty(),f.setBaseState(),g.bindFramebuffer.set(null)}}},Ka=function(f,d){this.context=new Ce(f),this.transform=d,this._tileTextures={},this.setup(),this.numSublayers=$e.maxUnderzooming+$e.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Cs,this.gpuTimers={}};Ka.prototype.resize=function(f,d){if(this.width=f*y.browser.devicePixelRatio,this.height=d*y.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var h=0,g=this.style._order;h<g.length;h+=1)this.style._layers[g[h]].resize()},Ka.prototype.setup=function(){var f=this.context,d=new y.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(y.EXTENT,0),d.emplaceBack(0,y.EXTENT),d.emplaceBack(y.EXTENT,y.EXTENT),this.tileExtentBuffer=f.createVertexBuffer(d,Zi.members),this.tileExtentSegments=y.SegmentVector.simpleSegment(0,0,4,2);var h=new y.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(y.EXTENT,0),h.emplaceBack(0,y.EXTENT),h.emplaceBack(y.EXTENT,y.EXTENT),this.debugBuffer=f.createVertexBuffer(h,Zi.members),this.debugSegments=y.SegmentVector.simpleSegment(0,0,4,5);var g=new y.StructArrayLayout4i8;g.emplaceBack(0,0,0,0),g.emplaceBack(y.EXTENT,0,y.EXTENT,0),g.emplaceBack(0,y.EXTENT,0,y.EXTENT),g.emplaceBack(y.EXTENT,y.EXTENT,y.EXTENT,y.EXTENT),this.rasterBoundsBuffer=f.createVertexBuffer(g,ze.members),this.rasterBoundsSegments=y.SegmentVector.simpleSegment(0,0,4,2);var w=new y.StructArrayLayout2i4;w.emplaceBack(0,0),w.emplaceBack(1,0),w.emplaceBack(0,1),w.emplaceBack(1,1),this.viewportBuffer=f.createVertexBuffer(w,Zi.members),this.viewportSegments=y.SegmentVector.simpleSegment(0,0,4,2);var M=new y.StructArrayLayout1ui2;M.emplaceBack(0),M.emplaceBack(1),M.emplaceBack(3),M.emplaceBack(2),M.emplaceBack(0),this.tileBorderIndexBuffer=f.createIndexBuffer(M);var I=new y.StructArrayLayout3ui6;I.emplaceBack(0,1,2),I.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=f.createIndexBuffer(I),this.emptyTexture=new y.Texture(f,{width:1,height:1,data:new Uint8Array([0,0,0,0])},f.gl.RGBA);var D=this.context.gl;this.stencilClearMode=new Ve({func:D.ALWAYS,mask:0},0,255,D.ZERO,D.ZERO,D.ZERO)},Ka.prototype.clearStencil=function(){var f=this.context,d=f.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var h=y.create();y.ortho(h,0,this.width,this.height,0,0,1),y.scale(h,h,[d.drawingBufferWidth,d.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(f,d.TRIANGLES,Me.disabled,this.stencilClearMode,at.disabled,_t.disabled,Js(h),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Ka.prototype._renderTileClippingMasks=function(f,d){if(this.currentStencilSource!==f.source&&f.isTileClipped()&&d&&d.length){this.currentStencilSource=f.source;var h=this.context,g=h.gl;this.nextStencilID+d.length>256&&this.clearStencil(),h.setColorMode(at.disabled),h.setDepthMode(Me.disabled);var w=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var M=0,I=d;M<I.length;M+=1){var D=I[M],G=this._tileClippingMaskIDs[D.key]=this.nextStencilID++;w.draw(h,g.TRIANGLES,Me.disabled,new Ve({func:g.ALWAYS,mask:0},G,255,g.KEEP,g.KEEP,g.REPLACE),at.disabled,_t.disabled,Js(D.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Ka.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var f=this.nextStencilID++,d=this.context.gl;return new Ve({func:d.NOTEQUAL,mask:255},f,255,d.KEEP,d.KEEP,d.REPLACE)},Ka.prototype.stencilModeForClipping=function(f){var d=this.context.gl;return new Ve({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[f.key],0,d.KEEP,d.KEEP,d.REPLACE)},Ka.prototype.stencilConfigForOverlap=function(f){var d,h=this.context.gl,g=f.sort(function(G,te){return te.overscaledZ-G.overscaledZ}),w=g[g.length-1].overscaledZ,M=g[0].overscaledZ-w+1;if(M>1){this.currentStencilSource=void 0,this.nextStencilID+M>256&&this.clearStencil();for(var I={},D=0;D<M;D++)I[D+w]=new Ve({func:h.GEQUAL,mask:255},D+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=M,[I,g]}return[(d={},d[w]=Ve.disabled,d),g]},Ka.prototype.colorModeForRenderPass=function(){var f=this.context.gl;return this._showOverdrawInspector?new at([f.CONSTANT_COLOR,f.ONE],new y.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?at.unblended:at.alphaBlended},Ka.prototype.depthModeForSublayer=function(f,d,h){if(!this.opaquePassEnabledForLayer())return Me.disabled;var g=1-((1+this.currentLayer)*this.numSublayers+f)*this.depthEpsilon;return new Me(h||this.context.gl.LEQUAL,d,[g,g])},Ka.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Ka.prototype.render=function(f,d){var h=this;this.style=f,this.options=d,this.lineAtlas=f.lineAtlas,this.imageManager=f.imageManager,this.glyphManager=f.glyphManager,this.symbolFadeChange=f.placement.symbolFadeChange(y.browser.now()),this.imageManager.beginFrame();var g=this.style._order,w=this.style.sourceCaches;for(var M in w){var I=w[M];I.used&&I.prepare(this.context)}var D,G,te={},he={},Se={};for(var Ae in w){var We=w[Ae];te[Ae]=We.getVisibleCoordinates(),he[Ae]=te[Ae].slice().reverse(),Se[Ae]=We.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Ge=0;Ge<g.length;Ge++)if(this.style._layers[g[Ge]].is3D()){this.opaquePassCutoff=Ge;break}this.renderPass="offscreen";for(var ot=0,Ze=g;ot<Ze.length;ot+=1){var Xe=this.style._layers[Ze[ot]];if(Xe.hasOffscreenPass()&&!Xe.isHidden(this.transform.zoom)){var de=he[Xe.source];(Xe.type==="custom"||de.length)&&this.renderLayer(this,w[Xe.source],Xe,de)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?y.Color.black:y.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(f._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){var Vt=this.style._layers[g[this.currentLayer]],q=w[Vt.source],or=te[Vt.source];this._renderTileClippingMasks(Vt,or),this.renderLayer(this,q,Vt,or)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){var dr=this.style._layers[g[this.currentLayer]],Fr=w[dr.source],on=(dr.type==="symbol"?Se:he)[dr.source];this._renderTileClippingMasks(dr,te[dr.source]),this.renderLayer(this,Fr,dr,on)}this.options.showTileBoundaries&&(y.values(this.style._layers).forEach(function(nn){nn.source&&!nn.isHidden(h.transform.zoom)&&(nn.source!==(G&&G.id)&&(G=h.style.sourceCaches[nn.source]),(!D||D.getSource().maxzoom<G.getSource().maxzoom)&&(D=G))}),D&&rs.debug(this,D,D.getVisibleCoordinates())),this.options.showPadding&&function(nn){var Tn=nn.transform.padding;Ih(nn,nn.transform.height-(Tn.top||0),3,hl),Ih(nn,Tn.bottom||0,3,_f),Ph(nn,Tn.left||0,3,Gf),Ph(nn,nn.transform.width-(Tn.right||0),3,Uu);var ri=nn.transform.centerPoint;(function(Jn,ii,Ui,En){Fl(Jn,ii-1,Ui-10,2,20,En),Fl(Jn,ii-10,Ui-1,20,2,En)})(nn,ri.x,nn.transform.height-ri.y,kh)}(this),this.context.setDefault()},Ka.prototype.renderLayer=function(f,d,h,g){h.isHidden(this.transform.zoom)||(h.type==="background"||h.type==="custom"||g.length)&&(this.id=h.id,this.gpuTimingStart(h),rs[h.type](f,d,h,g,this.style.placement.variableOffsets),this.gpuTimingEnd())},Ka.prototype.gpuTimingStart=function(f){if(this.options.gpuTiming){var d=this.context.extTimerQuery,h=this.gpuTimers[f.id];h||(h=this.gpuTimers[f.id]={calls:0,cpuTime:0,query:d.createQueryEXT()}),h.calls++,d.beginQueryEXT(d.TIME_ELAPSED_EXT,h.query)}},Ka.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var f=this.context.extTimerQuery;f.endQueryEXT(f.TIME_ELAPSED_EXT)}},Ka.prototype.collectGpuTimers=function(){var f=this.gpuTimers;return this.gpuTimers={},f},Ka.prototype.queryGpuTimers=function(f){var d={};for(var h in f){var g=f[h],w=this.context.extTimerQuery,M=w.getQueryObjectEXT(g.query,w.QUERY_RESULT_EXT)/1e6;w.deleteQueryEXT(g.query),d[h]=M}return d},Ka.prototype.translatePosMatrix=function(f,d,h,g,w){if(!h[0]&&!h[1])return f;var M=w?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(M){var I=Math.sin(M),D=Math.cos(M);h=[h[0]*D-h[1]*I,h[0]*I+h[1]*D]}var G=[w?h[0]:ca(d,h[0],this.transform.zoom),w?h[1]:ca(d,h[1],this.transform.zoom),0],te=new Float32Array(16);return y.translate(te,f,G),te},Ka.prototype.saveTileTexture=function(f){var d=this._tileTextures[f.size[0]];d?d.push(f):this._tileTextures[f.size[0]]=[f]},Ka.prototype.getTileTexture=function(f){var d=this._tileTextures[f];return d&&d.length>0?d.pop():null},Ka.prototype.isPatternMissing=function(f){if(!f)return!1;if(!f.from||!f.to)return!0;var d=this.imageManager.getPattern(f.from.toString()),h=this.imageManager.getPattern(f.to.toString());return!d||!h},Ka.prototype.useProgram=function(f,d){this.cache=this.cache||{};var h=""+f+(d?d.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[h]||(this.cache[h]=new pf(this.context,f,ds[f],d,ll[f],this._showOverdrawInspector)),this.cache[h]},Ka.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Ka.prototype.setBaseState=function(){var f=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(f.FUNC_ADD)},Ka.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=y.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new y.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Ka.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var pa=function(f,d){this.points=f,this.planes=d};pa.fromInvProjectionMatrix=function(f,d,h){var g=Math.pow(2,h),w=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(I){return y.transformMat4([],I,f)}).map(function(I){return y.scale$1([],I,1/I[3]/d*g)}),M=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(I){var D=y.sub([],w[I[0]],w[I[1]]),G=y.sub([],w[I[2]],w[I[1]]),te=y.normalize([],y.cross([],D,G)),he=-y.dot(te,w[I[1]]);return te.concat(he)});return new pa(w,M)};var Bl=function(f,d){this.min=f,this.max=d,this.center=y.scale$2([],y.add([],this.min,this.max),.5)};Bl.prototype.quadrant=function(f){for(var d=[f%2==0,f<2],h=y.clone$2(this.min),g=y.clone$2(this.max),w=0;w<d.length;w++)h[w]=d[w]?this.min[w]:this.center[w],g[w]=d[w]?this.center[w]:this.max[w];return g[2]=this.max[2],new Bl(h,g)},Bl.prototype.distanceX=function(f){return Math.max(Math.min(this.max[0],f[0]),this.min[0])-f[0]},Bl.prototype.distanceY=function(f){return Math.max(Math.min(this.max[1],f[1]),this.min[1])-f[1]},Bl.prototype.intersects=function(f){for(var d=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],h=!0,g=0;g<f.planes.length;g++){for(var w=f.planes[g],M=0,I=0;I<d.length;I++)M+=y.dot$1(w,d[I])>=0;if(M===0)return 0;M!==d.length&&(h=!1)}if(h)return 2;for(var D=0;D<3;D++){for(var G=Number.MAX_VALUE,te=-Number.MAX_VALUE,he=0;he<f.points.length;he++){var Se=f.points[he][D]-this.min[D];G=Math.min(G,Se),te=Math.max(te,Se)}if(te<0||G>this.max[D]-this.min[D])return 0}return 1};var qu=function(f,d,h,g){if(f===void 0&&(f=0),d===void 0&&(d=0),h===void 0&&(h=0),g===void 0&&(g=0),isNaN(f)||f<0||isNaN(d)||d<0||isNaN(h)||h<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=f,this.bottom=d,this.left=h,this.right=g};qu.prototype.interpolate=function(f,d,h){return d.top!=null&&f.top!=null&&(this.top=y.number(f.top,d.top,h)),d.bottom!=null&&f.bottom!=null&&(this.bottom=y.number(f.bottom,d.bottom,h)),d.left!=null&&f.left!=null&&(this.left=y.number(f.left,d.left,h)),d.right!=null&&f.right!=null&&(this.right=y.number(f.right,d.right,h)),this},qu.prototype.getCenter=function(f,d){var h=y.clamp((this.left+f-this.right)/2,0,f),g=y.clamp((this.top+d-this.bottom)/2,0,d);return new y.Point(h,g)},qu.prototype.equals=function(f){return this.top===f.top&&this.bottom===f.bottom&&this.left===f.left&&this.right===f.right},qu.prototype.clone=function(){return new qu(this.top,this.bottom,this.left,this.right)},qu.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Gi=function(f,d,h,g,w){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=w===void 0||w,this._minZoom=f||0,this._maxZoom=d||22,this._minPitch=h==null?0:h,this._maxPitch=g==null?60:g,this.setMaxBounds(),this.width=0,this.height=0,this._center=new y.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new qu,this._posMatrixCache={},this._alignedPosMatrixCache={}},La={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Gi.prototype.clone=function(){var f=new Gi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return f.tileSize=this.tileSize,f.latRange=this.latRange,f.width=this.width,f.height=this.height,f._center=this._center,f.zoom=this.zoom,f.angle=this.angle,f._fov=this._fov,f._pitch=this._pitch,f._unmodified=this._unmodified,f._edgeInsets=this._edgeInsets.clone(),f._calcMatrices(),f},La.minZoom.get=function(){return this._minZoom},La.minZoom.set=function(f){this._minZoom!==f&&(this._minZoom=f,this.zoom=Math.max(this.zoom,f))},La.maxZoom.get=function(){return this._maxZoom},La.maxZoom.set=function(f){this._maxZoom!==f&&(this._maxZoom=f,this.zoom=Math.min(this.zoom,f))},La.minPitch.get=function(){return this._minPitch},La.minPitch.set=function(f){this._minPitch!==f&&(this._minPitch=f,this.pitch=Math.max(this.pitch,f))},La.maxPitch.get=function(){return this._maxPitch},La.maxPitch.set=function(f){this._maxPitch!==f&&(this._maxPitch=f,this.pitch=Math.min(this.pitch,f))},La.renderWorldCopies.get=function(){return this._renderWorldCopies},La.renderWorldCopies.set=function(f){f===void 0?f=!0:f===null&&(f=!1),this._renderWorldCopies=f},La.worldSize.get=function(){return this.tileSize*this.scale},La.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},La.size.get=function(){return new y.Point(this.width,this.height)},La.bearing.get=function(){return-this.angle/Math.PI*180},La.bearing.set=function(f){var d=-y.wrap(f,-180,180)*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=y.create$2(),y.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},La.pitch.get=function(){return this._pitch/Math.PI*180},La.pitch.set=function(f){var d=y.clamp(f,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())},La.fov.get=function(){return this._fov/Math.PI*180},La.fov.set=function(f){f=Math.max(.01,Math.min(60,f)),this._fov!==f&&(this._unmodified=!1,this._fov=f/180*Math.PI,this._calcMatrices())},La.zoom.get=function(){return this._zoom},La.zoom.set=function(f){var d=Math.min(Math.max(f,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this.scale=this.zoomScale(d),this.tileZoom=Math.floor(d),this.zoomFraction=d-this.tileZoom,this._constrain(),this._calcMatrices())},La.center.get=function(){return this._center},La.center.set=function(f){f.lat===this._center.lat&&f.lng===this._center.lng||(this._unmodified=!1,this._center=f,this._constrain(),this._calcMatrices())},La.padding.get=function(){return this._edgeInsets.toJSON()},La.padding.set=function(f){this._edgeInsets.equals(f)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,f,1),this._calcMatrices())},La.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Gi.prototype.isPaddingEqual=function(f){return this._edgeInsets.equals(f)},Gi.prototype.interpolatePadding=function(f,d,h){this._unmodified=!1,this._edgeInsets.interpolate(f,d,h),this._constrain(),this._calcMatrices()},Gi.prototype.coveringZoomLevel=function(f){var d=(f.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/f.tileSize));return Math.max(0,d)},Gi.prototype.getVisibleUnwrappedCoordinates=function(f){var d=[new y.UnwrappedTileID(0,f)];if(this._renderWorldCopies)for(var h=this.pointCoordinate(new y.Point(0,0)),g=this.pointCoordinate(new y.Point(this.width,0)),w=this.pointCoordinate(new y.Point(this.width,this.height)),M=this.pointCoordinate(new y.Point(0,this.height)),I=Math.floor(Math.min(h.x,g.x,w.x,M.x)),D=Math.floor(Math.max(h.x,g.x,w.x,M.x)),G=I-1;G<=D+1;G++)G!==0&&d.push(new y.UnwrappedTileID(G,f));return d},Gi.prototype.coveringTiles=function(f){var d=this.coveringZoomLevel(f),h=d;if(f.minzoom!==void 0&&d<f.minzoom)return[];f.maxzoom!==void 0&&d>f.maxzoom&&(d=f.maxzoom);var g=y.MercatorCoordinate.fromLngLat(this.center),w=Math.pow(2,d),M=[w*g.x,w*g.y,0],I=pa.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d),D=f.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(D=d);var G=function(nn){return{aabb:new Bl([nn*w,0,0],[(nn+1)*w,w,0]),zoom:0,x:0,y:0,wrap:nn,fullyVisible:!1}},te=[],he=[],Se=d,Ae=f.reparseOverscaled?h:d;if(this._renderWorldCopies)for(var We=1;We<=3;We++)te.push(G(-We)),te.push(G(We));for(te.push(G(0));te.length>0;){var Ge=te.pop(),ot=Ge.x,Ze=Ge.y,Xe=Ge.fullyVisible;if(!Xe){var de=Ge.aabb.intersects(I);if(de===0)continue;Xe=de===2}var Vt=Ge.aabb.distanceX(M),q=Ge.aabb.distanceY(M),or=Math.max(Math.abs(Vt),Math.abs(q));if(Ge.zoom===Se||or>3+(1<<Se-Ge.zoom)-2&&Ge.zoom>=D)he.push({tileID:new y.OverscaledTileID(Ge.zoom===Se?Ae:Ge.zoom,Ge.wrap,Ge.zoom,ot,Ze),distanceSq:y.sqrLen([M[0]-.5-ot,M[1]-.5-Ze])});else for(var dr=0;dr<4;dr++){var Fr=(ot<<1)+dr%2,on=(Ze<<1)+(dr>>1);te.push({aabb:Ge.aabb.quadrant(dr),zoom:Ge.zoom+1,x:Fr,y:on,wrap:Ge.wrap,fullyVisible:Xe})}}return he.sort(function(nn,Tn){return nn.distanceSq-Tn.distanceSq}).map(function(nn){return nn.tileID})},Gi.prototype.resize=function(f,d){this.width=f,this.height=d,this.pixelsToGLUnits=[2/f,-2/d],this._constrain(),this._calcMatrices()},La.unmodified.get=function(){return this._unmodified},Gi.prototype.zoomScale=function(f){return Math.pow(2,f)},Gi.prototype.scaleZoom=function(f){return Math.log(f)/Math.LN2},Gi.prototype.project=function(f){var d=y.clamp(f.lat,-this.maxValidLatitude,this.maxValidLatitude);return new y.Point(y.mercatorXfromLng(f.lng)*this.worldSize,y.mercatorYfromLat(d)*this.worldSize)},Gi.prototype.unproject=function(f){return new y.MercatorCoordinate(f.x/this.worldSize,f.y/this.worldSize).toLngLat()},La.point.get=function(){return this.project(this.center)},Gi.prototype.setLocationAtPoint=function(f,d){var h=this.pointCoordinate(d),g=this.pointCoordinate(this.centerPoint),w=this.locationCoordinate(f),M=new y.MercatorCoordinate(w.x-(h.x-g.x),w.y-(h.y-g.y));this.center=this.coordinateLocation(M),this._renderWorldCopies&&(this.center=this.center.wrap())},Gi.prototype.locationPoint=function(f){return this.coordinatePoint(this.locationCoordinate(f))},Gi.prototype.pointLocation=function(f){return this.coordinateLocation(this.pointCoordinate(f))},Gi.prototype.locationCoordinate=function(f){return y.MercatorCoordinate.fromLngLat(f)},Gi.prototype.coordinateLocation=function(f){return f.toLngLat()},Gi.prototype.pointCoordinate=function(f){var d=[f.x,f.y,0,1],h=[f.x,f.y,1,1];y.transformMat4(d,d,this.pixelMatrixInverse),y.transformMat4(h,h,this.pixelMatrixInverse);var g=d[3],w=h[3],M=d[1]/g,I=h[1]/w,D=d[2]/g,G=h[2]/w,te=D===G?0:(0-D)/(G-D);return new y.MercatorCoordinate(y.number(d[0]/g,h[0]/w,te)/this.worldSize,y.number(M,I,te)/this.worldSize)},Gi.prototype.coordinatePoint=function(f){var d=[f.x*this.worldSize,f.y*this.worldSize,0,1];return y.transformMat4(d,d,this.pixelMatrix),new y.Point(d[0]/d[3],d[1]/d[3])},Gi.prototype.getBounds=function(){return new y.LngLatBounds().extend(this.pointLocation(new y.Point(0,0))).extend(this.pointLocation(new y.Point(this.width,0))).extend(this.pointLocation(new y.Point(this.width,this.height))).extend(this.pointLocation(new y.Point(0,this.height)))},Gi.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new y.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Gi.prototype.setMaxBounds=function(f){f?(this.lngRange=[f.getWest(),f.getEast()],this.latRange=[f.getSouth(),f.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Gi.prototype.calculatePosMatrix=function(f,d){d===void 0&&(d=!1);var h=f.key,g=d?this._alignedPosMatrixCache:this._posMatrixCache;if(g[h])return g[h];var w=f.canonical,M=this.worldSize/this.zoomScale(w.z),I=w.x+Math.pow(2,w.z)*f.wrap,D=y.identity(new Float64Array(16));return y.translate(D,D,[I*M,w.y*M,0]),y.scale(D,D,[M/y.EXTENT,M/y.EXTENT,1]),y.multiply(D,d?this.alignedProjMatrix:this.projMatrix,D),g[h]=new Float32Array(D),g[h]},Gi.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Gi.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var f,d,h,g,w=-90,M=90,I=-180,D=180,G=this.size,te=this._unmodified;if(this.latRange){var he=this.latRange;w=y.mercatorYfromLat(he[1])*this.worldSize,f=(M=y.mercatorYfromLat(he[0])*this.worldSize)-w<G.y?G.y/(M-w):0}if(this.lngRange){var Se=this.lngRange;I=y.mercatorXfromLng(Se[0])*this.worldSize,d=(D=y.mercatorXfromLng(Se[1])*this.worldSize)-I<G.x?G.x/(D-I):0}var Ae=this.point,We=Math.max(d||0,f||0);if(We)return this.center=this.unproject(new y.Point(d?(D+I)/2:Ae.x,f?(M+w)/2:Ae.y)),this.zoom+=this.scaleZoom(We),this._unmodified=te,void(this._constraining=!1);if(this.latRange){var Ge=Ae.y,ot=G.y/2;Ge-ot<w&&(g=w+ot),Ge+ot>M&&(g=M-ot)}if(this.lngRange){var Ze=Ae.x,Xe=G.x/2;Ze-Xe<I&&(h=I+Xe),Ze+Xe>D&&(h=D-Xe)}h===void 0&&g===void 0||(this.center=this.unproject(new y.Point(h!==void 0?h:Ae.x,g!==void 0?g:Ae.y))),this._unmodified=te,this._constraining=!1}},Gi.prototype._calcMatrices=function(){if(this.height){var f=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var d=Math.PI/2+this._pitch,h=this._fov*(.5+f.y/this.height),g=Math.sin(h)*this.cameraToCenterDistance/Math.sin(y.clamp(Math.PI-d-h,.01,Math.PI-.01)),w=this.point,M=w.x,I=w.y,D=1.01*(Math.cos(Math.PI/2-this._pitch)*g+this.cameraToCenterDistance),G=this.height/50,te=new Float64Array(16);y.perspective(te,this._fov,this.width/this.height,G,D),te[8]=2*-f.x/this.width,te[9]=2*f.y/this.height,y.scale(te,te,[1,-1,1]),y.translate(te,te,[0,0,-this.cameraToCenterDistance]),y.rotateX(te,te,this._pitch),y.rotateZ(te,te,this.angle),y.translate(te,te,[-M,-I,0]),this.mercatorMatrix=y.scale([],te,[this.worldSize,this.worldSize,this.worldSize]),y.scale(te,te,[1,1,y.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=te,this.invProjMatrix=y.invert([],this.projMatrix);var he=this.width%2/2,Se=this.height%2/2,Ae=Math.cos(this.angle),We=Math.sin(this.angle),Ge=M-Math.round(M)+Ae*he+We*Se,ot=I-Math.round(I)+Ae*Se+We*he,Ze=new Float64Array(te);if(y.translate(Ze,Ze,[Ge>.5?Ge-1:Ge,ot>.5?ot-1:ot,0]),this.alignedProjMatrix=Ze,te=y.create(),y.scale(te,te,[this.width/2,-this.height/2,1]),y.translate(te,te,[1,-1,0]),this.labelPlaneMatrix=te,te=y.create(),y.scale(te,te,[1,-1,1]),y.translate(te,te,[-1,-1,0]),y.scale(te,te,[2/this.width,2/this.height,1]),this.glCoordMatrix=te,this.pixelMatrix=y.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(te=y.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=te,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Gi.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var f=this.pointCoordinate(new y.Point(0,0)),d=[f.x*this.worldSize,f.y*this.worldSize,0,1];return y.transformMat4(d,d,this.pixelMatrix)[3]/this.cameraToCenterDistance},Gi.prototype.getCameraPoint=function(){var f=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new y.Point(0,f))},Gi.prototype.getCameraQueryGeometry=function(f){var d=this.getCameraPoint();if(f.length===1)return[f[0],d];for(var h=d.x,g=d.y,w=d.x,M=d.y,I=0,D=f;I<D.length;I+=1){var G=D[I];h=Math.min(h,G.x),g=Math.min(g,G.y),w=Math.max(w,G.x),M=Math.max(M,G.y)}return[new y.Point(h,g),new y.Point(w,g),new y.Point(w,M),new y.Point(h,M),new y.Point(h,g)]},Object.defineProperties(Gi.prototype,La);var Rs=function(f){var d,h,g,w;this._hashName=f&&encodeURIComponent(f),y.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(d=this._updateHashUnthrottled.bind(this),h=!1,g=null,w=function(){g=null,h&&(d(),g=setTimeout(w,300),h=!1)},function(){return h=!0,g||w(),g})};Rs.prototype.addTo=function(f){return this._map=f,y.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Rs.prototype.remove=function(){return y.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Rs.prototype.getHashString=function(f){var d=this._map.getCenter(),h=Math.round(100*this._map.getZoom())/100,g=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,g),M=Math.round(d.lng*w)/w,I=Math.round(d.lat*w)/w,D=this._map.getBearing(),G=this._map.getPitch(),te="";if(te+=f?"/"+M+"/"+I+"/"+h:h+"/"+I+"/"+M,(D||G)&&(te+="/"+Math.round(10*D)/10),G&&(te+="/"+Math.round(G)),this._hashName){var he=this._hashName,Se=!1,Ae=y.window.location.hash.slice(1).split("&").map(function(We){var Ge=We.split("=")[0];return Ge===he?(Se=!0,Ge+"="+te):We}).filter(function(We){return We});return Se||Ae.push(he+"="+te),"#"+Ae.join("&")}return"#"+te},Rs.prototype._getCurrentHash=function(){var f,d=this,h=y.window.location.hash.replace("#","");return this._hashName?(h.split("&").map(function(g){return g.split("=")}).forEach(function(g){g[0]===d._hashName&&(f=g)}),(f&&f[1]||"").split("/")):h.split("/")},Rs.prototype._onHashChange=function(){var f=this._getCurrentHash();if(f.length>=3&&!f.some(function(h){return isNaN(h)})){var d=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(f[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:d,pitch:+(f[4]||0)}),!0}return!1},Rs.prototype._updateHashUnthrottled=function(){var f=y.window.location.href.replace(/(#.+)?$/,this.getHashString());try{y.window.history.replaceState(y.window.history.state,null,f)}catch(d){}};var zc={linearity:.3,easing:y.bezier(0,0,.3,1)},Bi=y.extend({deceleration:2500,maxSpeed:1400},zc),ks=y.extend({deceleration:20,maxSpeed:1400},zc),Cu=y.extend({deceleration:1e3,maxSpeed:360},zc),Nl=y.extend({deceleration:1e3,maxSpeed:90},zc),Zc=function(f){this._map=f,this.clear()};function uc(f,d){(!f.duration||f.duration<d.duration)&&(f.duration=d.duration,f.easing=d.easing)}function Au(f,d,h){var g=h.maxSpeed,w=h.linearity,M=h.deceleration,I=y.clamp(f*w/(d/1e3),-g,g),D=Math.abs(I)/(M*w);return{easing:h.easing,duration:1e3*D,amount:I*(D/2)}}Zc.prototype.clear=function(){this._inertiaBuffer=[]},Zc.prototype.record=function(f){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:y.browser.now(),settings:f})},Zc.prototype._drainInertiaBuffer=function(){for(var f=this._inertiaBuffer,d=y.browser.now();f.length>0&&d-f[0].time>160;)f.shift()},Zc.prototype._onMoveEnd=function(f){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var d={zoom:0,bearing:0,pitch:0,pan:new y.Point(0,0),pinchAround:void 0,around:void 0},h=0,g=this._inertiaBuffer;h<g.length;h+=1){var w=g[h].settings;d.zoom+=w.zoomDelta||0,d.bearing+=w.bearingDelta||0,d.pitch+=w.pitchDelta||0,w.panDelta&&d.pan._add(w.panDelta),w.around&&(d.around=w.around),w.pinchAround&&(d.pinchAround=w.pinchAround)}var M=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,I={};if(d.pan.mag()){var D=Au(d.pan.mag(),M,y.extend({},Bi,f||{}));I.offset=d.pan.mult(D.amount/d.pan.mag()),I.center=this._map.transform.center,uc(I,D)}if(d.zoom){var G=Au(d.zoom,M,ks);I.zoom=this._map.transform.zoom+G.amount,uc(I,G)}if(d.bearing){var te=Au(d.bearing,M,Cu);I.bearing=this._map.transform.bearing+y.clamp(te.amount,-179,179),uc(I,te)}if(d.pitch){var he=Au(d.pitch,M,Nl);I.pitch=this._map.transform.pitch+he.amount,uc(I,he)}if(I.zoom||I.bearing){var Se=d.pinchAround===void 0?d.around:d.pinchAround;I.around=Se?this._map.unproject(Se):this._map.getCenter()}return this.clear(),y.extend(I,{noMoveStart:!0})}};var Xo=function(f){function d(g,w,M,I){I===void 0&&(I={});var D=W.mousePos(w.getCanvasContainer(),M),G=w.unproject(D);f.call(this,g,y.extend({point:D,lngLat:G,originalEvent:M},I)),this._defaultPrevented=!1,this.target=w}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var h={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},h.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,h),d}(y.Event),lc=function(f){function d(g,w,M){var I=g==="touchend"?M.changedTouches:M.touches,D=W.touchPos(w.getCanvasContainer(),I),G=D.map(function(Se){return w.unproject(Se)}),te=D.reduce(function(Se,Ae,We,Ge){return Se.add(Ae.div(Ge.length))},new y.Point(0,0)),he=w.unproject(te);f.call(this,g,{points:D,point:te,lngLats:G,lngLat:he,originalEvent:M}),this._defaultPrevented=!1}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var h={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},h.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,h),d}(y.Event),zl=function(f){function d(g,w,M){f.call(this,g,{originalEvent:M}),this._defaultPrevented=!1}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var h={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},h.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,h),d}(y.Event),ko=function(f,d){this._map=f,this._clickTolerance=d.clickTolerance};ko.prototype.reset=function(){delete this._mousedownPos},ko.prototype.wheel=function(f){return this._firePreventable(new zl(f.type,this._map,f))},ko.prototype.mousedown=function(f,d){return this._mousedownPos=d,this._firePreventable(new Xo(f.type,this._map,f))},ko.prototype.mouseup=function(f){this._map.fire(new Xo(f.type,this._map,f))},ko.prototype.click=function(f,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new Xo(f.type,this._map,f))},ko.prototype.dblclick=function(f){return this._firePreventable(new Xo(f.type,this._map,f))},ko.prototype.mouseover=function(f){this._map.fire(new Xo(f.type,this._map,f))},ko.prototype.mouseout=function(f){this._map.fire(new Xo(f.type,this._map,f))},ko.prototype.touchstart=function(f){return this._firePreventable(new lc(f.type,this._map,f))},ko.prototype.touchmove=function(f){this._map.fire(new lc(f.type,this._map,f))},ko.prototype.touchend=function(f){this._map.fire(new lc(f.type,this._map,f))},ko.prototype.touchcancel=function(f){this._map.fire(new lc(f.type,this._map,f))},ko.prototype._firePreventable=function(f){if(this._map.fire(f),f.defaultPrevented)return{}},ko.prototype.isEnabled=function(){return!0},ko.prototype.isActive=function(){return!1},ko.prototype.enable=function(){},ko.prototype.disable=function(){};var Fn=function(f){this._map=f};Fn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Fn.prototype.mousemove=function(f){this._map.fire(new Xo(f.type,this._map,f))},Fn.prototype.mousedown=function(){this._delayContextMenu=!0},Fn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Xo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Fn.prototype.contextmenu=function(f){this._delayContextMenu?this._contextMenuEvent=f:this._map.fire(new Xo(f.type,this._map,f)),this._map.listens("contextmenu")&&f.preventDefault()},Fn.prototype.isEnabled=function(){return!0},Fn.prototype.isActive=function(){return!1},Fn.prototype.enable=function(){},Fn.prototype.disable=function(){};var ho=function(f,d){this._map=f,this._el=f.getCanvasContainer(),this._container=f.getContainer(),this._clickTolerance=d.clickTolerance||1};function Da(f,d){for(var h={},g=0;g<f.length;g++)h[f[g].identifier]=d[g];return h}ho.prototype.isEnabled=function(){return!!this._enabled},ho.prototype.isActive=function(){return!!this._active},ho.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},ho.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},ho.prototype.mousedown=function(f,d){this.isEnabled()&&f.shiftKey&&f.button===0&&(W.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)},ho.prototype.mousemoveWindow=function(f,d){if(this._active){var h=d;if(!(this._lastPos.equals(h)||!this._box&&h.dist(this._startPos)<this._clickTolerance)){var g=this._startPos;this._lastPos=h,this._box||(this._box=W.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",f));var w=Math.min(g.x,h.x),M=Math.max(g.x,h.x),I=Math.min(g.y,h.y),D=Math.max(g.y,h.y);W.setTransform(this._box,"translate("+w+"px,"+I+"px)"),this._box.style.width=M-w+"px",this._box.style.height=D-I+"px"}}},ho.prototype.mouseupWindow=function(f,d){var h=this;if(this._active&&f.button===0){var g=this._startPos,w=d;if(this.reset(),W.suppressClick(),g.x!==w.x||g.y!==w.y)return this._map.fire(new y.Event("boxzoomend",{originalEvent:f})),{cameraAnimation:function(M){return M.fitScreenCoordinates(g,w,h._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",f)}},ho.prototype.keydown=function(f){this._active&&f.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",f))},ho.prototype.blur=function(){this.reset()},ho.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(W.remove(this._box),this._box=null),W.enableDrag(),delete this._startPos,delete this._lastPos},ho.prototype._fireEvent=function(f,d){return this._map.fire(new y.Event(f,{originalEvent:d}))};var pl=function(f){this.reset(),this.numTouches=f.numTouches};pl.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},pl.prototype.touchstart=function(f,d,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=f.timeStamp),h.length===this.numTouches&&(this.centroid=function(g){for(var w=new y.Point(0,0),M=0,I=g;M<I.length;M+=1)w._add(I[M]);return w.div(g.length)}(d),this.touches=Da(h,d)))},pl.prototype.touchmove=function(f,d,h){if(!this.aborted&&this.centroid){var g=Da(h,d);for(var w in this.touches){var M=g[w];(!M||M.dist(this.touches[w])>30)&&(this.aborted=!0)}}},pl.prototype.touchend=function(f,d,h){if((!this.centroid||f.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){var g=!this.aborted&&this.centroid;if(this.reset(),g)return g}};var tu=function(f){this.singleTap=new pl(f),this.numTaps=f.numTaps,this.reset()};tu.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},tu.prototype.touchstart=function(f,d,h){this.singleTap.touchstart(f,d,h)},tu.prototype.touchmove=function(f,d,h){this.singleTap.touchmove(f,d,h)},tu.prototype.touchend=function(f,d,h){var g=this.singleTap.touchend(f,d,h);if(g){var w=f.timeStamp-this.lastTime<500,M=!this.lastTap||this.lastTap.dist(g)<30;if(w&&M||this.reset(),this.count++,this.lastTime=f.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}};var Gs=function(){this._zoomIn=new tu({numTouches:1,numTaps:2}),this._zoomOut=new tu({numTouches:2,numTaps:1}),this.reset()};Gs.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Gs.prototype.touchstart=function(f,d,h){this._zoomIn.touchstart(f,d,h),this._zoomOut.touchstart(f,d,h)},Gs.prototype.touchmove=function(f,d,h){this._zoomIn.touchmove(f,d,h),this._zoomOut.touchmove(f,d,h)},Gs.prototype.touchend=function(f,d,h){var g=this,w=this._zoomIn.touchend(f,d,h),M=this._zoomOut.touchend(f,d,h);return w?(this._active=!0,f.preventDefault(),setTimeout(function(){return g.reset()},0),{cameraAnimation:function(I){return I.easeTo({duration:300,zoom:I.getZoom()+1,around:I.unproject(w)},{originalEvent:f})}}):M?(this._active=!0,f.preventDefault(),setTimeout(function(){return g.reset()},0),{cameraAnimation:function(I){return I.easeTo({duration:300,zoom:I.getZoom()-1,around:I.unproject(M)},{originalEvent:f})}}):void 0},Gs.prototype.touchcancel=function(){this.reset()},Gs.prototype.enable=function(){this._enabled=!0},Gs.prototype.disable=function(){this._enabled=!1,this.reset()},Gs.prototype.isEnabled=function(){return this._enabled},Gs.prototype.isActive=function(){return this._active};var xf={0:1,2:2},vn=function(f){this.reset(),this._clickTolerance=f.clickTolerance||1};vn.prototype.blur=function(){this.reset()},vn.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},vn.prototype._correctButton=function(f,d){return!1},vn.prototype._move=function(f,d){return{}},vn.prototype.mousedown=function(f,d){if(!this._lastPoint){var h=W.mouseButton(f);this._correctButton(f,h)&&(this._lastPoint=d,this._eventButton=h)}},vn.prototype.mousemoveWindow=function(f,d){var h=this._lastPoint;if(h){if(f.preventDefault(),function(g,w){var M=xf[w];return g.buttons===void 0||(g.buttons&M)!==M}(f,this._eventButton))this.reset();else if(this._moved||!(d.dist(h)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(h,d)}},vn.prototype.mouseupWindow=function(f){this._lastPoint&&W.mouseButton(f)===this._eventButton&&(this._moved&&W.suppressClick(),this.reset())},vn.prototype.enable=function(){this._enabled=!0},vn.prototype.disable=function(){this._enabled=!1,this.reset()},vn.prototype.isEnabled=function(){return this._enabled},vn.prototype.isActive=function(){return this._active};var cc=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.mousedown=function(h,g){f.prototype.mousedown.call(this,h,g),this._lastPoint&&(this._active=!0)},d.prototype._correctButton=function(h,g){return g===0&&!h.ctrlKey},d.prototype._move=function(h,g){return{around:g,panDelta:g.sub(h)}},d}(vn),Zl=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype._correctButton=function(h,g){return g===0&&h.ctrlKey||g===2},d.prototype._move=function(h,g){var w=.8*(g.x-h.x);if(w)return this._active=!0,{bearingDelta:w}},d.prototype.contextmenu=function(h){h.preventDefault()},d}(vn),Ku=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype._correctButton=function(h,g){return g===0&&h.ctrlKey||g===2},d.prototype._move=function(h,g){var w=-.5*(g.y-h.y);if(w)return this._active=!0,{pitchDelta:w}},d.prototype.contextmenu=function(h){h.preventDefault()},d}(vn),Va=function(f){this._minTouches=1,this._clickTolerance=f.clickTolerance||1,this.reset()};Va.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new y.Point(0,0)},Va.prototype.touchstart=function(f,d,h){return this._calculateTransform(f,d,h)},Va.prototype.touchmove=function(f,d,h){if(this._active&&!(h.length<this._minTouches))return f.preventDefault(),this._calculateTransform(f,d,h)},Va.prototype.touchend=function(f,d,h){this._calculateTransform(f,d,h),this._active&&h.length<this._minTouches&&this.reset()},Va.prototype.touchcancel=function(){this.reset()},Va.prototype._calculateTransform=function(f,d,h){h.length>0&&(this._active=!0);var g=Da(h,d),w=new y.Point(0,0),M=new y.Point(0,0),I=0;for(var D in g){var G=g[D],te=this._touches[D];te&&(w._add(G),M._add(G.sub(te)),I++,g[D]=G)}if(this._touches=g,!(I<this._minTouches)&&M.mag()){var he=M.div(I);if(this._sum._add(he),!(this._sum.mag()<this._clickTolerance))return{around:w.div(I),panDelta:he}}},Va.prototype.enable=function(){this._enabled=!0},Va.prototype.disable=function(){this._enabled=!1,this.reset()},Va.prototype.isEnabled=function(){return this._enabled},Va.prototype.isActive=function(){return this._active};var Os=function(){this.reset()};function fc(f,d,h){for(var g=0;g<f.length;g++)if(f[g].identifier===h)return d[g]}function Vu(f,d){return Math.log(f/d)/Math.LN2}Os.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Os.prototype._start=function(f){},Os.prototype._move=function(f,d,h){return{}},Os.prototype.touchstart=function(f,d,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([d[0],d[1]]))},Os.prototype.touchmove=function(f,d,h){if(this._firstTwoTouches){f.preventDefault();var g=this._firstTwoTouches,w=g[1],M=fc(h,d,g[0]),I=fc(h,d,w);if(M&&I){var D=this._aroundCenter?null:M.add(I).div(2);return this._move([M,I],D,f)}}},Os.prototype.touchend=function(f,d,h){if(this._firstTwoTouches){var g=this._firstTwoTouches,w=g[1],M=fc(h,d,g[0]),I=fc(h,d,w);M&&I||(this._active&&W.suppressClick(),this.reset())}},Os.prototype.touchcancel=function(){this.reset()},Os.prototype.enable=function(f){this._enabled=!0,this._aroundCenter=!!f&&f.around==="center"},Os.prototype.disable=function(){this._enabled=!1,this.reset()},Os.prototype.isEnabled=function(){return this._enabled},Os.prototype.isActive=function(){return this._active};var Ls=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.reset=function(){f.prototype.reset.call(this),delete this._distance,delete this._startDistance},d.prototype._start=function(h){this._startDistance=this._distance=h[0].dist(h[1])},d.prototype._move=function(h,g){var w=this._distance;if(this._distance=h[0].dist(h[1]),this._active||!(Math.abs(Vu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Vu(this._distance,w),pinchAround:g}},d}(Os);function hu(f,d){return 180*f.angleWith(d)/Math.PI}var bf=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.reset=function(){f.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},d.prototype._start=function(h){this._startVector=this._vector=h[0].sub(h[1]),this._minDiameter=h[0].dist(h[1])},d.prototype._move=function(h,g){var w=this._vector;if(this._vector=h[0].sub(h[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:hu(this._vector,w),pinchAround:g}},d.prototype._isBelowThreshold=function(h){this._minDiameter=Math.min(this._minDiameter,h.mag());var g=25/(Math.PI*this._minDiameter)*360,w=hu(h,this._startVector);return Math.abs(w)<g},d}(Os);function Uc(f){return Math.abs(f.y)>Math.abs(f.x)}var Ef=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.reset=function(){f.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},d.prototype._start=function(h){this._lastPoints=h,Uc(h[0].sub(h[1]))&&(this._valid=!1)},d.prototype._move=function(h,g,w){var M=h[0].sub(this._lastPoints[0]),I=h[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(M,I,w.timeStamp),this._valid)return this._lastPoints=h,this._active=!0,{pitchDelta:(M.y+I.y)/2*-.5}},d.prototype.gestureBeginsVertically=function(h,g,w){if(this._valid!==void 0)return this._valid;var M=h.mag()>=2,I=g.mag()>=2;if(M||I){if(!M||!I)return this._firstMove===void 0&&(this._firstMove=w),w-this._firstMove<100&&void 0;var D=h.y>0==g.y>0;return Uc(h)&&Uc(g)&&D}},d}(Os),Hf={panStep:100,bearingStep:15,pitchStep:10},ru=function(){var f=Hf;this._panStep=f.panStep,this._bearingStep=f.bearingStep,this._pitchStep=f.pitchStep,this._rotationDisabled=!1};function ms(f){return f*(2-f)}ru.prototype.blur=function(){this.reset()},ru.prototype.reset=function(){this._active=!1},ru.prototype.keydown=function(f){var d=this;if(!(f.altKey||f.ctrlKey||f.metaKey)){var h=0,g=0,w=0,M=0,I=0;switch(f.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:f.shiftKey?g=-1:(f.preventDefault(),M=-1);break;case 39:f.shiftKey?g=1:(f.preventDefault(),M=1);break;case 38:f.shiftKey?w=1:(f.preventDefault(),I=-1);break;case 40:f.shiftKey?w=-1:(f.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(g=0,w=0),{cameraAnimation:function(D){var G=D.getZoom();D.easeTo({duration:300,easeId:"keyboardHandler",easing:ms,zoom:h?Math.round(G)+h*(f.shiftKey?2:1):G,bearing:D.getBearing()+g*d._bearingStep,pitch:D.getPitch()+w*d._pitchStep,offset:[-M*d._panStep,-I*d._panStep],center:D.getCenter()},{originalEvent:f})}}}},ru.prototype.enable=function(){this._enabled=!0},ru.prototype.disable=function(){this._enabled=!1,this.reset()},ru.prototype.isEnabled=function(){return this._enabled},ru.prototype.isActive=function(){return this._active},ru.prototype.disableRotation=function(){this._rotationDisabled=!0},ru.prototype.enableRotation=function(){this._rotationDisabled=!1};var Li=function(f,d){this._map=f,this._el=f.getCanvasContainer(),this._handler=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,y.bindAll(["_onTimeout"],this)};Li.prototype.setZoomRate=function(f){this._defaultZoomRate=f},Li.prototype.setWheelZoomRate=function(f){this._wheelZoomRate=f},Li.prototype.isEnabled=function(){return!!this._enabled},Li.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Li.prototype.isZooming=function(){return!!this._zooming},Li.prototype.enable=function(f){this.isEnabled()||(this._enabled=!0,this._aroundCenter=f&&f.around==="center")},Li.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Li.prototype.wheel=function(f){if(this.isEnabled()){var d=f.deltaMode===y.window.WheelEvent.DOM_DELTA_LINE?40*f.deltaY:f.deltaY,h=y.browser.now(),g=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,d!==0&&d%4.000244140625==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,f)):this._type||(this._type=Math.abs(g*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),f.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=f,this._delta-=d,this._active||this._start(f)),f.preventDefault()}},Li.prototype._onTimeout=function(f){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(f)},Li.prototype._start=function(f){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var d=W.mousePos(this._el,f);this._around=y.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(d)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Li.prototype.renderFrame=function(){var f=this;if(this._frameId&&(this._frameId=null,this.isActive())){var d=this._map.transform;if(this._delta!==0){var h=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,g=2/(1+Math.exp(-Math.abs(this._delta*h)));this._delta<0&&g!==0&&(g=1/g);var w=typeof this._targetZoom=="number"?d.zoomScale(this._targetZoom):d.scale;this._targetZoom=Math.min(d.maxZoom,Math.max(d.minZoom,d.scaleZoom(w*g))),this._type==="wheel"&&(this._startZoom=d.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var M,I=typeof this._targetZoom=="number"?this._targetZoom:d.zoom,D=this._startZoom,G=this._easing,te=!1;if(this._type==="wheel"&&D&&G){var he=Math.min((y.browser.now()-this._lastWheelEventTime)/200,1),Se=G(he);M=y.number(D,I,Se),he<1?this._frameId||(this._frameId=!0):te=!0}else M=I,te=!0;return this._active=!0,te&&(this._active=!1,this._finishTimeout=setTimeout(function(){f._zooming=!1,f._handler._triggerRenderFrame(),delete f._targetZoom,delete f._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!te,zoomDelta:M-d.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Li.prototype._smoothOutEasing=function(f){var d=y.ease;if(this._prevEase){var h=this._prevEase,g=(y.browser.now()-h.start)/h.duration,w=h.easing(g+.01)-h.easing(g),M=.27/Math.sqrt(w*w+1e-4)*.01,I=Math.sqrt(.0729-M*M);d=y.bezier(M,I,.25,1)}return this._prevEase={start:y.browser.now(),duration:f,easing:d},d},Li.prototype.blur=function(){this.reset()},Li.prototype.reset=function(){this._active=!1};var Tu=function(f,d){this._clickZoom=f,this._tapZoom=d};Tu.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Tu.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Tu.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Tu.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var pu=function(){this.reset()};pu.prototype.reset=function(){this._active=!1},pu.prototype.blur=function(){this.reset()},pu.prototype.dblclick=function(f,d){return f.preventDefault(),{cameraAnimation:function(h){h.easeTo({duration:300,zoom:h.getZoom()+(f.shiftKey?-1:1),around:h.unproject(d)},{originalEvent:f})}}},pu.prototype.enable=function(){this._enabled=!0},pu.prototype.disable=function(){this._enabled=!1,this.reset()},pu.prototype.isEnabled=function(){return this._enabled},pu.prototype.isActive=function(){return this._active};var ns=function(){this._tap=new tu({numTouches:1,numTaps:1}),this.reset()};ns.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},ns.prototype.touchstart=function(f,d,h){this._swipePoint||(this._tapTime&&f.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?h.length>0&&(this._swipePoint=d[0],this._swipeTouch=h[0].identifier):this._tap.touchstart(f,d,h))},ns.prototype.touchmove=function(f,d,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;var g=d[0],w=g.y-this._swipePoint.y;return this._swipePoint=g,f.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(f,d,h)},ns.prototype.touchend=function(f,d,h){this._tapTime?this._swipePoint&&h.length===0&&this.reset():this._tap.touchend(f,d,h)&&(this._tapTime=f.timeStamp)},ns.prototype.touchcancel=function(){this.reset()},ns.prototype.enable=function(){this._enabled=!0},ns.prototype.disable=function(){this._enabled=!1,this.reset()},ns.prototype.isEnabled=function(){return this._enabled},ns.prototype.isActive=function(){return this._active};var Qu=function(f,d,h){this._el=f,this._mousePan=d,this._touchPan=h};Qu.prototype.enable=function(f){this._inertiaOptions=f||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},Qu.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},Qu.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},Qu.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var dl=function(f,d,h){this._pitchWithRotate=f.pitchWithRotate,this._mouseRotate=d,this._mousePitch=h};dl.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},dl.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},dl.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},dl.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var Is=function(f,d,h,g){this._el=f,this._touchZoom=d,this._touchRotate=h,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0};Is.prototype.enable=function(f){this._touchZoom.enable(f),this._rotationDisabled||this._touchRotate.enable(f),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},Is.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},Is.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},Is.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},Is.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},Is.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var Ds=function(f){return f.zoom||f.drag||f.pitch||f.rotate},Hs=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d}(y.Event);function Yn(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}var Gn=function(f,d){this._map=f,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Zc(f),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d),y.bindAll(["handleEvent","handleWindowEvent"],this);var h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[y.window.document,"mousemove",{capture:!0}],[y.window.document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[y.window,"blur",void 0]];for(var g=0,w=this._listeners;g<w.length;g+=1){var M=w[g],I=M[0];W.addEventListener(I,M[1],I===y.window.document?this.handleWindowEvent:this.handleEvent,M[2])}};Gn.prototype.destroy=function(){for(var f=0,d=this._listeners;f<d.length;f+=1){var h=d[f],g=h[0];W.removeEventListener(g,h[1],g===y.window.document?this.handleWindowEvent:this.handleEvent,h[2])}},Gn.prototype._addDefaultHandlers=function(f){var d=this._map,h=d.getCanvasContainer();this._add("mapEvent",new ko(d,f));var g=d.boxZoom=new ho(d,f);this._add("boxZoom",g);var w=new Gs,M=new pu;d.doubleClickZoom=new Tu(M,w),this._add("tapZoom",w),this._add("clickZoom",M);var I=new ns;this._add("tapDragZoom",I);var D=d.touchPitch=new Ef;this._add("touchPitch",D);var G=new Zl(f),te=new Ku(f);d.dragRotate=new dl(f,G,te),this._add("mouseRotate",G,["mousePitch"]),this._add("mousePitch",te,["mouseRotate"]);var he=new cc(f),Se=new Va(f);d.dragPan=new Qu(h,he,Se),this._add("mousePan",he),this._add("touchPan",Se,["touchZoom","touchRotate"]);var Ae=new bf,We=new Ls;d.touchZoomRotate=new Is(h,We,Ae,I),this._add("touchRotate",Ae,["touchPan","touchZoom"]),this._add("touchZoom",We,["touchPan","touchRotate"]);var Ge=d.scrollZoom=new Li(d,this);this._add("scrollZoom",Ge,["mousePan"]);var ot=d.keyboard=new ru;this._add("keyboard",ot),this._add("blockableMapEvent",new Fn(d));for(var Ze=0,Xe=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Ze<Xe.length;Ze+=1){var de=Xe[Ze];f.interactive&&f[de]&&d[de].enable(f[de])}},Gn.prototype._add=function(f,d,h){this._handlers.push({handlerName:f,handler:d,allowed:h}),this._handlersById[f]=d},Gn.prototype.stop=function(f){if(!this._updatingCamera){for(var d=0,h=this._handlers;d<h.length;d+=1)h[d].handler.reset();this._inertia.clear(),this._fireEvents({},{},f),this._changes=[]}},Gn.prototype.isActive=function(){for(var f=0,d=this._handlers;f<d.length;f+=1)if(d[f].handler.isActive())return!0;return!1},Gn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},Gn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},Gn.prototype.isMoving=function(){return Boolean(Ds(this._eventsInProgress))||this.isZooming()},Gn.prototype._blockedByActive=function(f,d,h){for(var g in f)if(g!==h&&(!d||d.indexOf(g)<0))return!0;return!1},Gn.prototype.handleWindowEvent=function(f){this.handleEvent(f,f.type+"Window")},Gn.prototype._getMapTouches=function(f){for(var d=[],h=0,g=f;h<g.length;h+=1){var w=g[h];this._el.contains(w.target)&&d.push(w)}return d},Gn.prototype.handleEvent=function(f,d){this._updatingCamera=!0;for(var h=f.type==="renderFrame"?void 0:f,g={needsRenderFrame:!1},w={},M={},I=f.touches?this._getMapTouches(f.touches):void 0,D=I?W.touchPos(this._el,I):W.mousePos(this._el,f),G=0,te=this._handlers;G<te.length;G+=1){var he=te[G],Se=he.handlerName,Ae=he.handler,We=he.allowed;if(Ae.isEnabled()){var Ge=void 0;this._blockedByActive(M,We,Se)?Ae.reset():Ae[d||f.type]&&(Ge=Ae[d||f.type](f,D,I),this.mergeHandlerResult(g,w,Ge,Se,h),Ge&&Ge.needsRenderFrame&&this._triggerRenderFrame()),(Ge||Ae.isActive())&&(M[Se]=Ae)}}var ot={};for(var Ze in this._previousActiveHandlers)M[Ze]||(ot[Ze]=h);this._previousActiveHandlers=M,(Object.keys(ot).length||Yn(g))&&(this._changes.push([g,w,ot]),this._triggerRenderFrame()),(Object.keys(M).length||Yn(g))&&this._map._stop(!0),this._updatingCamera=!1;var Xe=g.cameraAnimation;Xe&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Xe(this._map))},Gn.prototype.mergeHandlerResult=function(f,d,h,g,w){if(h){y.extend(f,h);var M={handlerName:g,originalEvent:h.originalEvent||w};h.zoomDelta!==void 0&&(d.zoom=M),h.panDelta!==void 0&&(d.drag=M),h.pitchDelta!==void 0&&(d.pitch=M),h.bearingDelta!==void 0&&(d.rotate=M)}},Gn.prototype._applyChanges=function(){for(var f={},d={},h={},g=0,w=this._changes;g<w.length;g+=1){var M=w[g],I=M[0],D=M[1],G=M[2];I.panDelta&&(f.panDelta=(f.panDelta||new y.Point(0,0))._add(I.panDelta)),I.zoomDelta&&(f.zoomDelta=(f.zoomDelta||0)+I.zoomDelta),I.bearingDelta&&(f.bearingDelta=(f.bearingDelta||0)+I.bearingDelta),I.pitchDelta&&(f.pitchDelta=(f.pitchDelta||0)+I.pitchDelta),I.around!==void 0&&(f.around=I.around),I.pinchAround!==void 0&&(f.pinchAround=I.pinchAround),I.noInertia&&(f.noInertia=I.noInertia),y.extend(d,D),y.extend(h,G)}this._updateMapTransform(f,d,h),this._changes=[]},Gn.prototype._updateMapTransform=function(f,d,h){var g=this._map,w=g.transform;if(!Yn(f))return this._fireEvents(d,h,!0);var M=f.panDelta,I=f.zoomDelta,D=f.bearingDelta,G=f.pitchDelta,te=f.around,he=f.pinchAround;he!==void 0&&(te=he),g._stop(!0),te=te||g.transform.centerPoint;var Se=w.pointLocation(M?te.sub(M):te);D&&(w.bearing+=D),G&&(w.pitch+=G),I&&(w.zoom+=I),w.setLocationAtPoint(Se,te),this._map._update(),f.noInertia||this._inertia.record(f),this._fireEvents(d,h,!0)},Gn.prototype._fireEvents=function(f,d,h){var g=this,w=Ds(this._eventsInProgress),M=Ds(f),I={};for(var D in f)this._eventsInProgress[D]||(I[D+"start"]=f[D].originalEvent),this._eventsInProgress[D]=f[D];for(var G in!w&&M&&this._fireEvent("movestart",M.originalEvent),I)this._fireEvent(G,I[G]);for(var te in M&&this._fireEvent("move",M.originalEvent),f)this._fireEvent(te,f[te].originalEvent);var he,Se={};for(var Ae in this._eventsInProgress){var We=this._eventsInProgress[Ae],Ge=We.handlerName,ot=We.originalEvent;this._handlersById[Ge].isActive()||(delete this._eventsInProgress[Ae],Se[Ae+"end"]=he=d[Ge]||ot)}for(var Ze in Se)this._fireEvent(Ze,Se[Ze]);var Xe=Ds(this._eventsInProgress);if(h&&(w||M)&&!Xe){this._updatingCamera=!0;var de=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Vt=function(q){return q!==0&&-g._bearingSnap<q&&q<g._bearingSnap};de?(Vt(de.bearing||this._map.getBearing())&&(de.bearing=0),this._map.easeTo(de,{originalEvent:he})):(this._map.fire(new y.Event("moveend",{originalEvent:he})),Vt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},Gn.prototype._fireEvent=function(f,d){this._map.fire(new y.Event(f,d?{originalEvent:d}:{}))},Gn.prototype._requestFrame=function(){var f=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(d){delete f._frameId,f.handleEvent(new Hs("renderFrame",{timeStamp:d})),f._applyChanges()})},Gn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var hc=function(f){function d(h,g){f.call(this),this._moving=!1,this._zooming=!1,this.transform=h,this._bearingSnap=g.bearingSnap,y.bindAll(["_renderFrameCallback"],this)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getCenter=function(){return new y.LngLat(this.transform.center.lng,this.transform.center.lat)},d.prototype.setCenter=function(h,g){return this.jumpTo({center:h},g)},d.prototype.panBy=function(h,g,w){return h=y.Point.convert(h).mult(-1),this.panTo(this.transform.center,y.extend({offset:h},g),w)},d.prototype.panTo=function(h,g,w){return this.easeTo(y.extend({center:h},g),w)},d.prototype.getZoom=function(){return this.transform.zoom},d.prototype.setZoom=function(h,g){return this.jumpTo({zoom:h},g),this},d.prototype.zoomTo=function(h,g,w){return this.easeTo(y.extend({zoom:h},g),w)},d.prototype.zoomIn=function(h,g){return this.zoomTo(this.getZoom()+1,h,g),this},d.prototype.zoomOut=function(h,g){return this.zoomTo(this.getZoom()-1,h,g),this},d.prototype.getBearing=function(){return this.transform.bearing},d.prototype.setBearing=function(h,g){return this.jumpTo({bearing:h},g),this},d.prototype.getPadding=function(){return this.transform.padding},d.prototype.setPadding=function(h,g){return this.jumpTo({padding:h},g),this},d.prototype.rotateTo=function(h,g,w){return this.easeTo(y.extend({bearing:h},g),w)},d.prototype.resetNorth=function(h,g){return this.rotateTo(0,y.extend({duration:1e3},h),g),this},d.prototype.resetNorthPitch=function(h,g){return this.easeTo(y.extend({bearing:0,pitch:0,duration:1e3},h),g),this},d.prototype.snapToNorth=function(h,g){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(h,g):this},d.prototype.getPitch=function(){return this.transform.pitch},d.prototype.setPitch=function(h,g){return this.jumpTo({pitch:h},g),this},d.prototype.cameraForBounds=function(h,g){h=y.LngLatBounds.convert(h);var w=g&&g.bearing||0;return this._cameraForBoxAndBearing(h.getNorthWest(),h.getSouthEast(),w,g)},d.prototype._cameraForBoxAndBearing=function(h,g,w,M){var I={top:0,bottom:0,right:0,left:0};if(typeof(M=y.extend({padding:I,offset:[0,0],maxZoom:this.transform.maxZoom},M)).padding=="number"){var D=M.padding;M.padding={top:D,bottom:D,right:D,left:D}}M.padding=y.extend(I,M.padding);var G=this.transform,te=G.padding,he=G.project(y.LngLat.convert(h)),Se=G.project(y.LngLat.convert(g)),Ae=he.rotate(-w*Math.PI/180),We=Se.rotate(-w*Math.PI/180),Ge=new y.Point(Math.max(Ae.x,We.x),Math.max(Ae.y,We.y)),ot=new y.Point(Math.min(Ae.x,We.x),Math.min(Ae.y,We.y)),Ze=Ge.sub(ot),Xe=(G.width-(te.left+te.right+M.padding.left+M.padding.right))/Ze.x,de=(G.height-(te.top+te.bottom+M.padding.top+M.padding.bottom))/Ze.y;if(!(de<0||Xe<0)){var Vt=Math.min(G.scaleZoom(G.scale*Math.min(Xe,de)),M.maxZoom),q=typeof M.offset.x=="number"?new y.Point(M.offset.x,M.offset.y):y.Point.convert(M.offset),or=new y.Point((M.padding.left-M.padding.right)/2,(M.padding.top-M.padding.bottom)/2).rotate(w*Math.PI/180),dr=q.add(or).mult(G.scale/G.zoomScale(Vt));return{center:G.unproject(he.add(Se).div(2).sub(dr)),zoom:Vt,bearing:w}}y.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},d.prototype.fitBounds=function(h,g,w){return this._fitInternal(this.cameraForBounds(h,g),g,w)},d.prototype.fitScreenCoordinates=function(h,g,w,M,I){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(y.Point.convert(h)),this.transform.pointLocation(y.Point.convert(g)),w,M),M,I)},d.prototype._fitInternal=function(h,g,w){return h?(delete(g=y.extend(h,g)).padding,g.linear?this.easeTo(g,w):this.flyTo(g,w)):this},d.prototype.jumpTo=function(h,g){this.stop();var w=this.transform,M=!1,I=!1,D=!1;return"zoom"in h&&w.zoom!==+h.zoom&&(M=!0,w.zoom=+h.zoom),h.center!==void 0&&(w.center=y.LngLat.convert(h.center)),"bearing"in h&&w.bearing!==+h.bearing&&(I=!0,w.bearing=+h.bearing),"pitch"in h&&w.pitch!==+h.pitch&&(D=!0,w.pitch=+h.pitch),h.padding==null||w.isPaddingEqual(h.padding)||(w.padding=h.padding),this.fire(new y.Event("movestart",g)).fire(new y.Event("move",g)),M&&this.fire(new y.Event("zoomstart",g)).fire(new y.Event("zoom",g)).fire(new y.Event("zoomend",g)),I&&this.fire(new y.Event("rotatestart",g)).fire(new y.Event("rotate",g)).fire(new y.Event("rotateend",g)),D&&this.fire(new y.Event("pitchstart",g)).fire(new y.Event("pitch",g)).fire(new y.Event("pitchend",g)),this.fire(new y.Event("moveend",g))},d.prototype.easeTo=function(h,g){var w=this;this._stop(!1,h.easeId),((h=y.extend({offset:[0,0],duration:500,easing:y.ease},h)).animate===!1||!h.essential&&y.browser.prefersReducedMotion)&&(h.duration=0);var M=this.transform,I=this.getZoom(),D=this.getBearing(),G=this.getPitch(),te=this.getPadding(),he="zoom"in h?+h.zoom:I,Se="bearing"in h?this._normalizeBearing(h.bearing,D):D,Ae="pitch"in h?+h.pitch:G,We="padding"in h?h.padding:M.padding,Ge=y.Point.convert(h.offset),ot=M.centerPoint.add(Ge),Ze=M.pointLocation(ot),Xe=y.LngLat.convert(h.center||Ze);this._normalizeCenter(Xe);var de,Vt,q=M.project(Ze),or=M.project(Xe).sub(q),dr=M.zoomScale(he-I);h.around&&(de=y.LngLat.convert(h.around),Vt=M.locationPoint(de));var Fr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||he!==I,this._rotating=this._rotating||D!==Se,this._pitching=this._pitching||Ae!==G,this._padding=!M.isPaddingEqual(We),this._easeId=h.easeId,this._prepareEase(g,h.noMoveStart,Fr),this._ease(function(on){if(w._zooming&&(M.zoom=y.number(I,he,on)),w._rotating&&(M.bearing=y.number(D,Se,on)),w._pitching&&(M.pitch=y.number(G,Ae,on)),w._padding&&(M.interpolatePadding(te,We,on),ot=M.centerPoint.add(Ge)),de)M.setLocationAtPoint(de,Vt);else{var nn=M.zoomScale(M.zoom-I),Tn=he>I?Math.min(2,dr):Math.max(.5,dr),ri=Math.pow(Tn,1-on),Jn=M.unproject(q.add(or.mult(on*ri)).mult(nn));M.setLocationAtPoint(M.renderWorldCopies?Jn.wrap():Jn,ot)}w._fireMoveEvents(g)},function(on){w._afterEase(g,on)},h),this},d.prototype._prepareEase=function(h,g,w){w===void 0&&(w={}),this._moving=!0,g||w.moving||this.fire(new y.Event("movestart",h)),this._zooming&&!w.zooming&&this.fire(new y.Event("zoomstart",h)),this._rotating&&!w.rotating&&this.fire(new y.Event("rotatestart",h)),this._pitching&&!w.pitching&&this.fire(new y.Event("pitchstart",h))},d.prototype._fireMoveEvents=function(h){this.fire(new y.Event("move",h)),this._zooming&&this.fire(new y.Event("zoom",h)),this._rotating&&this.fire(new y.Event("rotate",h)),this._pitching&&this.fire(new y.Event("pitch",h))},d.prototype._afterEase=function(h,g){if(!this._easeId||!g||this._easeId!==g){delete this._easeId;var w=this._zooming,M=this._rotating,I=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,w&&this.fire(new y.Event("zoomend",h)),M&&this.fire(new y.Event("rotateend",h)),I&&this.fire(new y.Event("pitchend",h)),this.fire(new y.Event("moveend",h))}},d.prototype.flyTo=function(h,g){var w=this;if(!h.essential&&y.browser.prefersReducedMotion){var M=y.pick(h,["center","zoom","bearing","pitch","around"]);return this.jumpTo(M,g)}this.stop(),h=y.extend({offset:[0,0],speed:1.2,curve:1.42,easing:y.ease},h);var I=this.transform,D=this.getZoom(),G=this.getBearing(),te=this.getPitch(),he=this.getPadding(),Se="zoom"in h?y.clamp(+h.zoom,I.minZoom,I.maxZoom):D,Ae="bearing"in h?this._normalizeBearing(h.bearing,G):G,We="pitch"in h?+h.pitch:te,Ge="padding"in h?h.padding:I.padding,ot=I.zoomScale(Se-D),Ze=y.Point.convert(h.offset),Xe=I.centerPoint.add(Ze),de=I.pointLocation(Xe),Vt=y.LngLat.convert(h.center||de);this._normalizeCenter(Vt);var q=I.project(de),or=I.project(Vt).sub(q),dr=h.curve,Fr=Math.max(I.width,I.height),on=Fr/ot,nn=or.mag();if("minZoom"in h){var Tn=y.clamp(Math.min(h.minZoom,D,Se),I.minZoom,I.maxZoom),ri=Fr/I.zoomScale(Tn-D);dr=Math.sqrt(ri/nn*2)}var Jn=dr*dr;function ii(ci){var oi=(on*on-Fr*Fr+(ci?-1:1)*Jn*Jn*nn*nn)/(2*(ci?on:Fr)*Jn*nn);return Math.log(Math.sqrt(oi*oi+1)-oi)}function Ui(ci){return(Math.exp(ci)-Math.exp(-ci))/2}function En(ci){return(Math.exp(ci)+Math.exp(-ci))/2}var wi=ii(0),Ti=function(ci){return En(wi)/En(wi+dr*ci)},yi=function(ci){return Fr*((En(wi)*(Ui(oi=wi+dr*ci)/En(oi))-Ui(wi))/Jn)/nn;var oi},ui=(ii(1)-wi)/dr;if(Math.abs(nn)<1e-6||!isFinite(ui)){if(Math.abs(Fr-on)<1e-6)return this.easeTo(h,g);var Mi=on<Fr?-1:1;ui=Math.abs(Math.log(on/Fr))/dr,yi=function(){return 0},Ti=function(ci){return Math.exp(Mi*dr*ci)}}return h.duration="duration"in h?+h.duration:1e3*ui/("screenSpeed"in h?+h.screenSpeed/dr:+h.speed),h.maxDuration&&h.duration>h.maxDuration&&(h.duration=0),this._zooming=!0,this._rotating=G!==Ae,this._pitching=We!==te,this._padding=!I.isPaddingEqual(Ge),this._prepareEase(g,!1),this._ease(function(ci){var oi=ci*ui,Po=1/Ti(oi);I.zoom=ci===1?Se:D+I.scaleZoom(Po),w._rotating&&(I.bearing=y.number(G,Ae,ci)),w._pitching&&(I.pitch=y.number(te,We,ci)),w._padding&&(I.interpolatePadding(he,Ge,ci),Xe=I.centerPoint.add(Ze));var Qa=ci===1?Vt:I.unproject(q.add(or.mult(yi(oi))).mult(Po));I.setLocationAtPoint(I.renderWorldCopies?Qa.wrap():Qa,Xe),w._fireMoveEvents(g)},function(){return w._afterEase(g)},h),this},d.prototype.isEasing=function(){return!!this._easeFrameId},d.prototype.stop=function(){return this._stop()},d.prototype._stop=function(h,g){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var w=this._onEaseEnd;delete this._onEaseEnd,w.call(this,g)}if(!h){var M=this.handlers;M&&M.stop(!1)}return this},d.prototype._ease=function(h,g,w){w.animate===!1||w.duration===0?(h(1),g()):(this._easeStart=y.browser.now(),this._easeOptions=w,this._onEaseFrame=h,this._onEaseEnd=g,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},d.prototype._renderFrameCallback=function(){var h=Math.min((y.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(h)),h<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},d.prototype._normalizeBearing=function(h,g){h=y.wrap(h,-180,180);var w=Math.abs(h-g);return Math.abs(h-360-g)<w&&(h-=360),Math.abs(h+360-g)<w&&(h+=360),h},d.prototype._normalizeCenter=function(h){var g=this.transform;if(g.renderWorldCopies&&!g.lngRange){var w=h.lng-g.center.lng;h.lng+=w>180?-360:w<-180?360:0}},d}(y.Evented),gs=function(f){f===void 0&&(f={}),this.options=f,y.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};gs.prototype.getDefaultPosition=function(){return"bottom-right"},gs.prototype.onAdd=function(f){var d=this.options&&this.options.compact;return this._map=f,this._container=W.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=W.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=W.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),d===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},gs.prototype.onRemove=function(){W.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},gs.prototype._setElementTitle=function(f,d){var h=this._map._getUIString("AttributionControl."+d);f.title=h,f.setAttribute("aria-label",h)},gs.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},gs.prototype._updateEditLink=function(){var f=this._editLink;f||(f=this._editLink=this._container.querySelector(".mapbox-improve-map"));var d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||y.config.ACCESS_TOKEN}];if(f){var h=d.reduce(function(g,w,M){return w.value&&(g+=w.key+"="+w.value+(M<d.length-1?"&":"")),g},"?");f.href=y.config.FEEDBACK_URL+"/"+h+(this._map._hash?this._map._hash.getHashString(!0):""),f.rel="noopener nofollow",this._setElementTitle(f,"MapFeedback")}},gs.prototype._updateData=function(f){!f||f.sourceDataType!=="metadata"&&f.sourceDataType!=="visibility"&&f.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},gs.prototype._updateAttributions=function(){if(this._map.style){var f=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?f=f.concat(this.options.customAttribution.map(function(D){return typeof D!="string"?"":D})):typeof this.options.customAttribution=="string"&&f.push(this.options.customAttribution)),this._map.style.stylesheet){var d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}var h=this._map.style.sourceCaches;for(var g in h){var w=h[g];if(w.used){var M=w.getSource();M.attribution&&f.indexOf(M.attribution)<0&&f.push(M.attribution)}}f.sort(function(D,G){return D.length-G.length});var I=(f=f.filter(function(D,G){for(var te=G+1;te<f.length;te++)if(f[te].indexOf(D)>=0)return!1;return!0})).join(" | ");I!==this._attribHTML&&(this._attribHTML=I,f.length?(this._innerContainer.innerHTML=I,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},gs.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var du=function(){y.bindAll(["_updateLogo"],this),y.bindAll(["_updateCompact"],this)};du.prototype.onAdd=function(f){this._map=f,this._container=W.create("div","mapboxgl-ctrl");var d=W.create("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},du.prototype.onRemove=function(){W.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},du.prototype.getDefaultPosition=function(){return"bottom-left"},du.prototype._updateLogo=function(f){f&&f.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},du.prototype._logoRequired=function(){if(this._map.style){var f=this._map.style.sourceCaches;for(var d in f)if(f[d].getSource().mapbox_logo)return!0;return!1}},du.prototype._updateCompact=function(){var f=this._container.children;if(f.length){var d=f[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}};var Fo=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Fo.prototype.add=function(f){var d=++this._id;return this._queue.push({callback:f,id:d,cancelled:!1}),d},Fo.prototype.remove=function(f){for(var d=this._currentlyRunning,h=0,g=d?this._queue.concat(d):this._queue;h<g.length;h+=1){var w=g[h];if(w.id===f)return void(w.cancelled=!0)}},Fo.prototype.run=function(f){f===void 0&&(f=0);var d=this._currentlyRunning=this._queue;this._queue=[];for(var h=0,g=d;h<g.length;h+=1){var w=g[h];if(!w.cancelled&&(w.callback(f),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Fo.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var nu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},pc=y.window.HTMLImageElement,Vc=y.window.HTMLElement,fa=y.window.ImageBitmap,ja={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Wf=function(f){function d(g){var w=this;if((g=y.extend({},ja,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var M=new Gi(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies);if(f.call(this,M,g),this._interactive=g.interactive,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._crossSourceCollisions=g.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=g.collectResourceTiming,this._renderTaskQueue=new Fo,this._controls=[],this._mapId=y.uniqueId(),this._locale=y.extend({},nu,g.locale),this._clickTolerance=g.clickTolerance,this._requestManager=new y.RequestManager(g.transformRequest,g.accessToken),typeof g.container=="string"){if(this._container=y.window.document.getElementById(g.container),!this._container)throw new Error("Container '"+g.container+"' not found.")}else{if(!(g.container instanceof Vc))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(g.maxBounds&&this.setMaxBounds(g.maxBounds),y.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return w._update(!1)}),this.on("moveend",function(){return w._update(!1)}),this.on("zoom",function(){return w._update(!0)}),y.window!==void 0&&(y.window.addEventListener("online",this._onWindowOnline,!1),y.window.addEventListener("resize",this._onWindowResize,!1),y.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Gn(this,g),this._hash=g.hash&&new Rs(typeof g.hash=="string"&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,y.extend({},g.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=g.localIdeographFontFamily,g.style&&this.setStyle(g.style,{localIdeographFontFamily:g.localIdeographFontFamily}),g.attributionControl&&this.addControl(new gs({customAttribution:g.customAttribution})),this.addControl(new du,g.logoPosition),this.on("style.load",function(){w.transform.unmodified&&w.jumpTo(w.style.stylesheet)}),this.on("data",function(I){w._update(I.dataType==="style"),w.fire(new y.Event(I.dataType+"data",I))}),this.on("dataloading",function(I){w.fire(new y.Event(I.dataType+"dataloading",I))})}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var h={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return d.prototype._getMapId=function(){return this._mapId},d.prototype.addControl=function(g,w){if(w===void 0&&(w=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new y.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var M=g.onAdd(this);this._controls.push(g);var I=this._controlPositions[w];return w.indexOf("bottom")!==-1?I.insertBefore(M,I.firstChild):I.appendChild(M),this},d.prototype.removeControl=function(g){if(!g||!g.onRemove)return this.fire(new y.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var w=this._controls.indexOf(g);return w>-1&&this._controls.splice(w,1),g.onRemove(this),this},d.prototype.hasControl=function(g){return this._controls.indexOf(g)>-1},d.prototype.resize=function(g){var w=this._containerDimensions(),M=w[0],I=w[1];if(M===this.transform.width&&I===this.transform.height)return this;this._resizeCanvas(M,I),this.transform.resize(M,I),this.painter.resize(M,I);var D=!this._moving;return D&&this.fire(new y.Event("movestart",g)).fire(new y.Event("move",g)),this.fire(new y.Event("resize",g)),D&&this.fire(new y.Event("moveend",g)),this},d.prototype.getBounds=function(){return this.transform.getBounds()},d.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},d.prototype.setMaxBounds=function(g){return this.transform.setMaxBounds(y.LngLatBounds.convert(g)),this._update()},d.prototype.setMinZoom=function(g){if((g=g==null?-2:g)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g&&this.setZoom(g),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},d.prototype.getMinZoom=function(){return this.transform.minZoom},d.prototype.setMaxZoom=function(g){if((g=g==null?22:g)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g&&this.setZoom(g),this;throw new Error("maxZoom must be greater than the current minZoom")},d.prototype.getMaxZoom=function(){return this.transform.maxZoom},d.prototype.setMinPitch=function(g){if((g=g==null?0:g)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},d.prototype.getMinPitch=function(){return this.transform.minPitch},d.prototype.setMaxPitch=function(g){if((g=g==null?60:g)>60)throw new Error("maxPitch must be less than or equal to 60");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")},d.prototype.getMaxPitch=function(){return this.transform.maxPitch},d.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},d.prototype.setRenderWorldCopies=function(g){return this.transform.renderWorldCopies=g,this._update()},d.prototype.project=function(g){return this.transform.locationPoint(y.LngLat.convert(g))},d.prototype.unproject=function(g){return this.transform.pointLocation(y.Point.convert(g))},d.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},d.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},d.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},d.prototype._createDelegatedListener=function(g,w,M){var I,D=this;if(g==="mouseenter"||g==="mouseover"){var G=!1;return{layer:w,listener:M,delegates:{mousemove:function(he){var Se=D.getLayer(w)?D.queryRenderedFeatures(he.point,{layers:[w]}):[];Se.length?G||(G=!0,M.call(D,new Xo(g,D,he.originalEvent,{features:Se}))):G=!1},mouseout:function(){G=!1}}}}if(g==="mouseleave"||g==="mouseout"){var te=!1;return{layer:w,listener:M,delegates:{mousemove:function(he){(D.getLayer(w)?D.queryRenderedFeatures(he.point,{layers:[w]}):[]).length?te=!0:te&&(te=!1,M.call(D,new Xo(g,D,he.originalEvent)))},mouseout:function(he){te&&(te=!1,M.call(D,new Xo(g,D,he.originalEvent)))}}}}return{layer:w,listener:M,delegates:(I={},I[g]=function(he){var Se=D.getLayer(w)?D.queryRenderedFeatures(he.point,{layers:[w]}):[];Se.length&&(he.features=Se,M.call(D,he),delete he.features)},I)}},d.prototype.on=function(g,w,M){if(M===void 0)return f.prototype.on.call(this,g,w);var I=this._createDelegatedListener(g,w,M);for(var D in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(I),I.delegates)this.on(D,I.delegates[D]);return this},d.prototype.once=function(g,w,M){if(M===void 0)return f.prototype.once.call(this,g,w);var I=this._createDelegatedListener(g,w,M);for(var D in I.delegates)this.once(D,I.delegates[D]);return this},d.prototype.off=function(g,w,M){var I=this;return M===void 0?f.prototype.off.call(this,g,w):(this._delegatedListeners&&this._delegatedListeners[g]&&function(D){for(var G=D[g],te=0;te<G.length;te++){var he=G[te];if(he.layer===w&&he.listener===M){for(var Se in he.delegates)I.off(Se,he.delegates[Se]);return G.splice(te,1),I}}}(this._delegatedListeners),this)},d.prototype.queryRenderedFeatures=function(g,w){if(!this.style)return[];var M;if(w!==void 0||g===void 0||g instanceof y.Point||Array.isArray(g)||(w=g,g=void 0),w=w||{},(g=g||[[0,0],[this.transform.width,this.transform.height]])instanceof y.Point||typeof g[0]=="number")M=[y.Point.convert(g)];else{var I=y.Point.convert(g[0]),D=y.Point.convert(g[1]);M=[I,new y.Point(D.x,I.y),D,new y.Point(I.x,D.y),I]}return this.style.queryRenderedFeatures(M,w,this.transform)},d.prototype.querySourceFeatures=function(g,w){return this.style.querySourceFeatures(g,w)},d.prototype.setStyle=function(g,w){return(w=y.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},w)).diff!==!1&&w.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&g?(this._diffStyle(g,w),this):(this._localIdeographFontFamily=w.localIdeographFontFamily,this._updateStyle(g,w))},d.prototype._getUIString=function(g){var w=this._locale[g];if(w==null)throw new Error("Missing UI string '"+g+"'");return w},d.prototype._updateStyle=function(g,w){return this.style&&(this.style.setEventedParent(null),this.style._remove()),g?(this.style=new ps(this,w||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g):this.style.loadJSON(g),this):(delete this.style,this)},d.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new ps(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},d.prototype._diffStyle=function(g,w){var M=this;if(typeof g=="string"){var I=this._requestManager.normalizeStyleURL(g),D=this._requestManager.transformRequest(I,y.ResourceType.Style);y.getJSON(D,function(G,te){G?M.fire(new y.ErrorEvent(G)):te&&M._updateDiff(te,w)})}else typeof g=="object"&&this._updateDiff(g,w)},d.prototype._updateDiff=function(g,w){try{this.style.setState(g)&&this._update(!0)}catch(M){y.warnOnce("Unable to perform style diff: "+(M.message||M.error||M)+".  Rebuilding the style from scratch."),this._updateStyle(g,w)}},d.prototype.getStyle=function(){if(this.style)return this.style.serialize()},d.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():y.warnOnce("There is no style added to the map.")},d.prototype.addSource=function(g,w){return this._lazyInitEmptyStyle(),this.style.addSource(g,w),this._update(!0)},d.prototype.isSourceLoaded=function(g){var w=this.style&&this.style.sourceCaches[g];if(w!==void 0)return w.loaded();this.fire(new y.ErrorEvent(new Error("There is no source with ID '"+g+"'")))},d.prototype.areTilesLoaded=function(){var g=this.style&&this.style.sourceCaches;for(var w in g){var M=g[w]._tiles;for(var I in M){var D=M[I];if(D.state!=="loaded"&&D.state!=="errored")return!1}}return!0},d.prototype.addSourceType=function(g,w,M){return this._lazyInitEmptyStyle(),this.style.addSourceType(g,w,M)},d.prototype.removeSource=function(g){return this.style.removeSource(g),this._update(!0)},d.prototype.getSource=function(g){return this.style.getSource(g)},d.prototype.addImage=function(g,w,M){M===void 0&&(M={});var I=M.pixelRatio;I===void 0&&(I=1);var D=M.sdf;D===void 0&&(D=!1);var G=M.stretchX,te=M.stretchY,he=M.content;if(this._lazyInitEmptyStyle(),w instanceof pc||fa&&w instanceof fa){var Se=y.browser.getImageData(w);this.style.addImage(g,{data:new y.RGBAImage({width:Se.width,height:Se.height},Se.data),pixelRatio:I,stretchX:G,stretchY:te,content:he,sdf:D,version:0})}else{if(w.width===void 0||w.height===void 0)return this.fire(new y.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var Ae=w;this.style.addImage(g,{data:new y.RGBAImage({width:w.width,height:w.height},new Uint8Array(w.data)),pixelRatio:I,stretchX:G,stretchY:te,content:he,sdf:D,version:0,userImage:Ae}),Ae.onAdd&&Ae.onAdd(this,g)}},d.prototype.updateImage=function(g,w){var M=this.style.getImage(g);if(!M)return this.fire(new y.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var I=w instanceof pc||fa&&w instanceof fa?y.browser.getImageData(w):w,D=I.width,G=I.height,te=I.data;return D===void 0||G===void 0?this.fire(new y.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):D!==M.data.width||G!==M.data.height?this.fire(new y.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(M.data.replace(te,!(w instanceof pc||fa&&w instanceof fa)),void this.style.updateImage(g,M))},d.prototype.hasImage=function(g){return g?!!this.style.getImage(g):(this.fire(new y.ErrorEvent(new Error("Missing required image id"))),!1)},d.prototype.removeImage=function(g){this.style.removeImage(g)},d.prototype.loadImage=function(g,w){y.getImage(this._requestManager.transformRequest(g,y.ResourceType.Image),w)},d.prototype.listImages=function(){return this.style.listImages()},d.prototype.addLayer=function(g,w){return this._lazyInitEmptyStyle(),this.style.addLayer(g,w),this._update(!0)},d.prototype.moveLayer=function(g,w){return this.style.moveLayer(g,w),this._update(!0)},d.prototype.removeLayer=function(g){return this.style.removeLayer(g),this._update(!0)},d.prototype.getLayer=function(g){return this.style.getLayer(g)},d.prototype.setLayerZoomRange=function(g,w,M){return this.style.setLayerZoomRange(g,w,M),this._update(!0)},d.prototype.setFilter=function(g,w,M){return M===void 0&&(M={}),this.style.setFilter(g,w,M),this._update(!0)},d.prototype.getFilter=function(g){return this.style.getFilter(g)},d.prototype.setPaintProperty=function(g,w,M,I){return I===void 0&&(I={}),this.style.setPaintProperty(g,w,M,I),this._update(!0)},d.prototype.getPaintProperty=function(g,w){return this.style.getPaintProperty(g,w)},d.prototype.setLayoutProperty=function(g,w,M,I){return I===void 0&&(I={}),this.style.setLayoutProperty(g,w,M,I),this._update(!0)},d.prototype.getLayoutProperty=function(g,w){return this.style.getLayoutProperty(g,w)},d.prototype.setLight=function(g,w){return w===void 0&&(w={}),this._lazyInitEmptyStyle(),this.style.setLight(g,w),this._update(!0)},d.prototype.getLight=function(){return this.style.getLight()},d.prototype.setFeatureState=function(g,w){return this.style.setFeatureState(g,w),this._update()},d.prototype.removeFeatureState=function(g,w){return this.style.removeFeatureState(g,w),this._update()},d.prototype.getFeatureState=function(g){return this.style.getFeatureState(g)},d.prototype.getContainer=function(){return this._container},d.prototype.getCanvasContainer=function(){return this._canvasContainer},d.prototype.getCanvas=function(){return this._canvas},d.prototype._containerDimensions=function(){var g=0,w=0;return this._container&&(g=this._container.clientWidth||400,w=this._container.clientHeight||300),[g,w]},d.prototype._detectMissingCSS=function(){y.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&y.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},d.prototype._setupContainer=function(){var g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=W.create("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();var w=this._canvasContainer=W.create("div","mapboxgl-canvas-container",g);this._interactive&&w.classList.add("mapboxgl-interactive"),this._canvas=W.create("canvas","mapboxgl-canvas",w),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var M=this._containerDimensions();this._resizeCanvas(M[0],M[1]);var I=this._controlContainer=W.create("div","mapboxgl-control-container",g),D=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(G){D[G]=W.create("div","mapboxgl-ctrl-"+G,I)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},d.prototype._resizeCanvas=function(g,w){var M=y.browser.devicePixelRatio||1;this._canvas.width=M*g,this._canvas.height=M*w,this._canvas.style.width=g+"px",this._canvas.style.height=w+"px"},d.prototype._setupPainter=function(){var g=y.extend({},Te.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),w=this._canvas.getContext("webgl",g)||this._canvas.getContext("experimental-webgl",g);w?(this.painter=new Ka(w,this.transform),y.webpSupported.testSupport(w)):this.fire(new y.ErrorEvent(new Error("Failed to initialize WebGL")))},d.prototype._contextLost=function(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new y.Event("webglcontextlost",{originalEvent:g}))},d.prototype._contextRestored=function(g){this._setupPainter(),this.resize(),this._update(),this.fire(new y.Event("webglcontextrestored",{originalEvent:g}))},d.prototype._onMapScroll=function(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},d.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},d.prototype._update=function(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this},d.prototype._requestRenderFrame=function(g){return this._update(),this._renderTaskQueue.add(g)},d.prototype._cancelRenderFrame=function(g){this._renderTaskQueue.remove(g)},d.prototype._render=function(g){var w,M=this,I=0,D=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(w=D.createQueryEXT(),D.beginQueryEXT(D.TIME_ELAPSED_EXT,w),I=y.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),!this._removed){var G=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var te=this.transform.zoom,he=y.browser.now();this.style.zoomHistory.update(te,he);var Se=new y.EvaluationParameters(te,{now:he,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Ae=Se.crossFadingFactor();Ae===1&&Ae===this._crossFadingFactor||(G=!0,this._crossFadingFactor=Ae),this.style.update(Se)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new y.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new y.Event("load"))),this.style&&(this.style.hasTransitions()||G)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var We=y.browser.now()-I;D.endQueryEXT(D.TIME_ELAPSED_EXT,w),setTimeout(function(){var Ze=D.getQueryObjectEXT(w,D.QUERY_RESULT_EXT)/1e6;D.deleteQueryEXT(w),M.fire(new y.Event("gpu-timing-frame",{cpuTime:We,gpuTime:Ze}))},50)}if(this.listens("gpu-timing-layer")){var Ge=this.painter.collectGpuTimers();setTimeout(function(){var Ze=M.painter.queryGpuTimers(Ge);M.fire(new y.Event("gpu-timing-layer",{layerTimes:Ze}))},50)}var ot=this._sourcesDirty||this._styleDirty||this._placementDirty;return ot||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new y.Event("idle")),!this._loaded||this._fullyLoaded||ot||(this._fullyLoaded=!0),this}},d.prototype.remove=function(){this._hash&&this._hash.remove();for(var g=0,w=this._controls;g<w.length;g+=1)w[g].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),y.window!==void 0&&(y.window.removeEventListener("resize",this._onWindowResize,!1),y.window.removeEventListener("orientationchange",this._onWindowResize,!1),y.window.removeEventListener("online",this._onWindowOnline,!1));var M=this.painter.context.gl.getExtension("WEBGL_lose_context");M&&M.loseContext(),vl(this._canvasContainer),vl(this._controlContainer),vl(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new y.Event("remove"))},d.prototype.triggerRepaint=function(){var g=this;this.style&&!this._frame&&(this._frame=y.browser.frame(function(w){g._frame=null,g._render(w)}))},d.prototype._onWindowOnline=function(){this._update()},d.prototype._onWindowResize=function(g){this._trackResize&&this.resize({originalEvent:g})._update()},h.showTileBoundaries.get=function(){return!!this._showTileBoundaries},h.showTileBoundaries.set=function(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())},h.showPadding.get=function(){return!!this._showPadding},h.showPadding.set=function(g){this._showPadding!==g&&(this._showPadding=g,this._update())},h.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},h.showCollisionBoxes.set=function(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())},h.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},h.showOverdrawInspector.set=function(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())},h.repaint.get=function(){return!!this._repaint},h.repaint.set=function(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())},h.vertices.get=function(){return!!this._vertices},h.vertices.set=function(g){this._vertices=g,this._update()},d.prototype._setCacheLimits=function(g,w){y.setCacheLimits(g,w)},h.version.get=function(){return y.version},Object.defineProperties(d.prototype,h),d}(hc);function vl(f){f.parentNode&&f.parentNode.removeChild(f)}var ju={showCompass:!0,showZoom:!0,visualizePitch:!1},vu=function(f){var d=this;this.options=y.extend({},ju,f),this._container=W.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(h){return h.preventDefault()}),this.options.showZoom&&(y.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(h){return d._map.zoomIn({},{originalEvent:h})}),W.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(h){return d._map.zoomOut({},{originalEvent:h})}),W.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(y.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(h){d.options.visualizePitch?d._map.resetNorthPitch({},{originalEvent:h}):d._map.resetNorth({},{originalEvent:h})}),this._compassIcon=W.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};vu.prototype._updateZoomButtons=function(){var f=this._map.getZoom(),d=f===this._map.getMaxZoom(),h=f===this._map.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())},vu.prototype._rotateCompassArrow=function(){var f=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=f},vu.prototype.onAdd=function(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Io(this._map,this._compass,this.options.visualizePitch)),this._container},vu.prototype.onRemove=function(){W.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},vu.prototype._createButton=function(f,d){var h=W.create("button",f,this._container);return h.type="button",h.addEventListener("click",d),h},vu.prototype._setButtonTitle=function(f,d){var h=this._map._getUIString("NavigationControl."+d);f.title=h,f.setAttribute("aria-label",h)};var Io=function(f,d,h){h===void 0&&(h=!1),this._clickTolerance=10,this.element=d,this.mouseRotate=new Zl({clickTolerance:f.dragRotate._mouseRotate._clickTolerance}),this.map=f,h&&(this.mousePitch=new Ku({clickTolerance:f.dragRotate._mousePitch._clickTolerance})),y.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),W.addEventListener(d,"mousedown",this.mousedown),W.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),W.addEventListener(d,"touchmove",this.touchmove),W.addEventListener(d,"touchend",this.touchend),W.addEventListener(d,"touchcancel",this.reset)};function ml(f,d,h){if(f=new y.LngLat(f.lng,f.lat),d){var g=new y.LngLat(f.lng-360,f.lat),w=new y.LngLat(f.lng+360,f.lat),M=h.locationPoint(f).distSqr(d);h.locationPoint(g).distSqr(d)<M?f=g:h.locationPoint(w).distSqr(d)<M&&(f=w)}for(;Math.abs(f.lng-h.center.lng)>180;){var I=h.locationPoint(f);if(I.x>=0&&I.y>=0&&I.x<=h.width&&I.y<=h.height)break;f.lng>h.center.lng?f.lng-=360:f.lng+=360}return f}Io.prototype.down=function(f,d){this.mouseRotate.mousedown(f,d),this.mousePitch&&this.mousePitch.mousedown(f,d),W.disableDrag()},Io.prototype.move=function(f,d){var h=this.map,g=this.mouseRotate.mousemoveWindow(f,d);if(g&&g.bearingDelta&&h.setBearing(h.getBearing()+g.bearingDelta),this.mousePitch){var w=this.mousePitch.mousemoveWindow(f,d);w&&w.pitchDelta&&h.setPitch(h.getPitch()+w.pitchDelta)}},Io.prototype.off=function(){var f=this.element;W.removeEventListener(f,"mousedown",this.mousedown),W.removeEventListener(f,"touchstart",this.touchstart,{passive:!1}),W.removeEventListener(f,"touchmove",this.touchmove),W.removeEventListener(f,"touchend",this.touchend),W.removeEventListener(f,"touchcancel",this.reset),this.offTemp()},Io.prototype.offTemp=function(){W.enableDrag(),W.removeEventListener(y.window,"mousemove",this.mousemove),W.removeEventListener(y.window,"mouseup",this.mouseup)},Io.prototype.mousedown=function(f){this.down(y.extend({},f,{ctrlKey:!0,preventDefault:function(){return f.preventDefault()}}),W.mousePos(this.element,f)),W.addEventListener(y.window,"mousemove",this.mousemove),W.addEventListener(y.window,"mouseup",this.mouseup)},Io.prototype.mousemove=function(f){this.move(f,W.mousePos(this.element,f))},Io.prototype.mouseup=function(f){this.mouseRotate.mouseupWindow(f),this.mousePitch&&this.mousePitch.mouseupWindow(f),this.offTemp()},Io.prototype.touchstart=function(f){f.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=W.touchPos(this.element,f.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return f.preventDefault()}},this._startPos))},Io.prototype.touchmove=function(f){f.targetTouches.length!==1?this.reset():(this._lastPos=W.touchPos(this.element,f.targetTouches)[0],this.move({preventDefault:function(){return f.preventDefault()}},this._lastPos))},Io.prototype.touchend=function(f){f.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Io.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Mu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function jc(f,d,h){var g=f.classList;for(var w in Mu)g.remove("mapboxgl-"+h+"-anchor-"+w);g.add("mapboxgl-"+h+"-anchor-"+d)}var Ul,Eo=function(f){function d(h,g){if(f.call(this),(h instanceof y.window.HTMLElement||g)&&(h=y.extend({element:h},g)),y.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=h&&h.anchor||"center",this._color=h&&h.color||"#3FB1CE",this._scale=h&&h.scale||1,this._draggable=h&&h.draggable||!1,this._clickTolerance=h&&h.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=h&&h.rotation||0,this._rotationAlignment=h&&h.rotationAlignment||"auto",this._pitchAlignment=h&&h.pitchAlignment&&h.pitchAlignment!=="auto"?h.pitchAlignment:this._rotationAlignment,h&&h.element)this._element=h.element,this._offset=y.Point.convert(h&&h.offset||[0,0]);else{this._defaultMarker=!0,this._element=W.create("div"),this._element.setAttribute("aria-label","Map marker");var w=W.createNS("http://www.w3.org/2000/svg","svg");w.setAttributeNS(null,"display","block"),w.setAttributeNS(null,"height","41px"),w.setAttributeNS(null,"width","27px"),w.setAttributeNS(null,"viewBox","0 0 27 41");var M=W.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"stroke","none"),M.setAttributeNS(null,"stroke-width","1"),M.setAttributeNS(null,"fill","none"),M.setAttributeNS(null,"fill-rule","evenodd");var I=W.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"fill-rule","nonzero");var D=W.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"transform","translate(3.0, 29.0)"),D.setAttributeNS(null,"fill","#000000");for(var G=0,te=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];G<te.length;G+=1){var he=te[G],Se=W.createNS("http://www.w3.org/2000/svg","ellipse");Se.setAttributeNS(null,"opacity","0.04"),Se.setAttributeNS(null,"cx","10.5"),Se.setAttributeNS(null,"cy","5.80029008"),Se.setAttributeNS(null,"rx",he.rx),Se.setAttributeNS(null,"ry",he.ry),D.appendChild(Se)}var Ae=W.createNS("http://www.w3.org/2000/svg","g");Ae.setAttributeNS(null,"fill",this._color);var We=W.createNS("http://www.w3.org/2000/svg","path");We.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Ae.appendChild(We);var Ge=W.createNS("http://www.w3.org/2000/svg","g");Ge.setAttributeNS(null,"opacity","0.25"),Ge.setAttributeNS(null,"fill","#000000");var ot=W.createNS("http://www.w3.org/2000/svg","path");ot.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Ge.appendChild(ot);var Ze=W.createNS("http://www.w3.org/2000/svg","g");Ze.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Ze.setAttributeNS(null,"fill","#FFFFFF");var Xe=W.createNS("http://www.w3.org/2000/svg","g");Xe.setAttributeNS(null,"transform","translate(8.0, 8.0)");var de=W.createNS("http://www.w3.org/2000/svg","circle");de.setAttributeNS(null,"fill","#000000"),de.setAttributeNS(null,"opacity","0.25"),de.setAttributeNS(null,"cx","5.5"),de.setAttributeNS(null,"cy","5.5"),de.setAttributeNS(null,"r","5.4999962");var Vt=W.createNS("http://www.w3.org/2000/svg","circle");Vt.setAttributeNS(null,"fill","#FFFFFF"),Vt.setAttributeNS(null,"cx","5.5"),Vt.setAttributeNS(null,"cy","5.5"),Vt.setAttributeNS(null,"r","5.4999962"),Xe.appendChild(de),Xe.appendChild(Vt),I.appendChild(D),I.appendChild(Ae),I.appendChild(Ge),I.appendChild(Ze),I.appendChild(Xe),w.appendChild(I),w.setAttributeNS(null,"height",41*this._scale+"px"),w.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(w),this._offset=y.Point.convert(h&&h.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(q){q.preventDefault()}),this._element.addEventListener("mousedown",function(q){q.preventDefault()}),jc(this._element,this._anchor,"marker"),this._popup=null}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.addTo=function(h){return this.remove(),this._map=h,h.getCanvasContainer().appendChild(this._element),h.on("move",this._update),h.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},d.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),W.remove(this._element),this._popup&&this._popup.remove(),this},d.prototype.getLngLat=function(){return this._lngLat},d.prototype.setLngLat=function(h){return this._lngLat=y.LngLat.convert(h),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},d.prototype.getElement=function(){return this._element},d.prototype.setPopup=function(h){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),h){if(!("offset"in h.options)){var g=Math.sqrt(Math.pow(13.5,2)/2);h.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(24.6+g)],"bottom-right":[-g,-1*(24.6+g)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=h,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},d.prototype._onKeyPress=function(h){var g=h.code,w=h.charCode||h.keyCode;g!=="Space"&&g!=="Enter"&&w!==32&&w!==13||this.togglePopup()},d.prototype._onMapClick=function(h){var g=h.originalEvent.target,w=this._element;this._popup&&(g===w||w.contains(g))&&this.togglePopup()},d.prototype.getPopup=function(){return this._popup},d.prototype.togglePopup=function(){var h=this._popup;return h?(h.isOpen()?h.remove():h.addTo(this._map),this):this},d.prototype._update=function(h){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=ml(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var g="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?g="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(g="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var w="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?w="rotateX(0deg)":this._pitchAlignment==="map"&&(w="rotateX("+this._map.getPitch()+"deg)"),h&&h.type!=="moveend"||(this._pos=this._pos.round()),W.setTransform(this._element,Mu[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+w+" "+g)}},d.prototype.getOffset=function(){return this._offset},d.prototype.setOffset=function(h){return this._offset=y.Point.convert(h),this._update(),this},d.prototype._onMove=function(h){if(!this._isDragging){var g=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=g}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new y.Event("dragstart"))),this.fire(new y.Event("drag")))},d.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new y.Event("dragend")),this._state="inactive"},d.prototype._addDragHandler=function(h){this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},d.prototype.setDraggable=function(h){return this._draggable=!!h,this._map&&(h?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},d.prototype.isDraggable=function(){return this._draggable},d.prototype.setRotation=function(h){return this._rotation=h||0,this._update(),this},d.prototype.getRotation=function(){return this._rotation},d.prototype.setRotationAlignment=function(h){return this._rotationAlignment=h||"auto",this._update(),this},d.prototype.getRotationAlignment=function(){return this._rotationAlignment},d.prototype.setPitchAlignment=function(h){return this._pitchAlignment=h&&h!=="auto"?h:this._rotationAlignment,this._update(),this},d.prototype.getPitchAlignment=function(){return this._pitchAlignment},d}(y.Evented),Xf={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Gc=0,dc=!1,$f=function(f){function d(h){f.call(this),this.options=y.extend({},Xf,h),y.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.onAdd=function(h){var g;return this._map=h,this._container=W.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),g=this._setupUI,Ul!==void 0?g(Ul):y.window.navigator.permissions!==void 0?y.window.navigator.permissions.query({name:"geolocation"}).then(function(w){g(Ul=w.state!=="denied")}):g(Ul=!!y.window.navigator.geolocation),this._container},d.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(y.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),W.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Gc=0,dc=!1},d.prototype._isOutOfMapMaxBounds=function(h){var g=this._map.getMaxBounds(),w=h.coords;return g&&(w.longitude<g.getWest()||w.longitude>g.getEast()||w.latitude<g.getSouth()||w.latitude>g.getNorth())},d.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},d.prototype._onSuccess=function(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new y.Event("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new y.Event("geolocate",h)),this._finish()}},d.prototype._updateCamera=function(h){var g=new y.LngLat(h.coords.longitude,h.coords.latitude),w=h.coords.accuracy,M=this._map.getBearing(),I=y.extend({bearing:M},this.options.fitBoundsOptions);this._map.fitBounds(g.toBounds(w),I,{geolocateSource:!0})},d.prototype._updateMarker=function(h){if(h){var g=new y.LngLat(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(g).addTo(this._map),this._userLocationDotMarker.setLngLat(g).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},d.prototype._updateCircleRadius=function(){var h=this._map._container.clientHeight/2,g=this._map.unproject([0,h]),w=this._map.unproject([1,h]),M=g.distanceTo(w),I=Math.ceil(2*this._accuracy/M);this._circleElement.style.width=I+"px",this._circleElement.style.height=I+"px"},d.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},d.prototype._onError=function(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var g=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&dc)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new y.Event("error",h)),this._finish()}},d.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},d.prototype._setupUI=function(h){var g=this;if(this._container.addEventListener("contextmenu",function(I){return I.preventDefault()}),this._geolocateButton=W.create("button","mapboxgl-ctrl-geolocate",this._container),W.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",h===!1){y.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var w=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=w,this._geolocateButton.setAttribute("aria-label",w)}else{var M=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=M,this._geolocateButton.setAttribute("aria-label",M)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=W.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Eo(this._dotElement),this._circleElement=W.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Eo({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(I){I.geolocateSource||g._watchState!=="ACTIVE_LOCK"||I.originalEvent&&I.originalEvent.type==="resize"||(g._watchState="BACKGROUND",g._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),g._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),g.fire(new y.Event("trackuserlocationend")))})},d.prototype.trigger=function(){if(!this._setup)return y.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new y.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Gc--,dc=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new y.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new y.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++Gc>1?(h={maximumAge:6e5,timeout:0},dc=!0):(h=this.options.positionOptions,dc=!1),this._geolocationWatchID=y.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,h)}}else y.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},d.prototype._clearWatch=function(){y.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},d}(y.Evented),Vl={maxWidth:100,unit:"metric"},iu=function(f){this.options=y.extend({},Vl,f),y.bindAll(["_onMove","setUnit"],this)};function vc(f,d,h){var g=h&&h.maxWidth||100,w=f._container.clientHeight/2,M=f.unproject([0,w]),I=f.unproject([g,w]),D=M.distanceTo(I);if(h&&h.unit==="imperial"){var G=3.2808*D;G>5280?ku(d,g,G/5280,f._getUIString("ScaleControl.Miles")):ku(d,g,G,f._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?ku(d,g,D/1852,f._getUIString("ScaleControl.NauticalMiles")):D>=1e3?ku(d,g,D/1e3,f._getUIString("ScaleControl.Kilometers")):ku(d,g,D,f._getUIString("ScaleControl.Meters"))}function ku(f,d,h,g){var w,M,I,D=(w=h,(M=Math.pow(10,(""+Math.floor(w)).length-1))*(I=(I=w/M)>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(G){var te=Math.pow(10,Math.ceil(-Math.log(G)/Math.LN10));return Math.round(G*te)/te}(I)));f.style.width=d*(D/h)+"px",f.innerHTML=D+"&nbsp;"+g}iu.prototype.getDefaultPosition=function(){return"bottom-left"},iu.prototype._onMove=function(){vc(this._map,this._container,this.options)},iu.prototype.onAdd=function(f){return this._map=f,this._container=W.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},iu.prototype.onRemove=function(){W.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},iu.prototype.setUnit=function(f){this.options.unit=f,vc(this._map,this._container,this.options)};var Ws=function(f){this._fullscreen=!1,f&&f.container&&(f.container instanceof y.window.HTMLElement?this._container=f.container:y.warnOnce("Full screen control 'container' must be a DOM element.")),y.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in y.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in y.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in y.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in y.window.document&&(this._fullscreenchange="MSFullscreenChange")};Ws.prototype.onAdd=function(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=W.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",y.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Ws.prototype.onRemove=function(){W.remove(this._controlContainer),this._map=null,y.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Ws.prototype._checkFullscreenSupport=function(){return!!(y.window.document.fullscreenEnabled||y.window.document.mozFullScreenEnabled||y.window.document.msFullscreenEnabled||y.window.document.webkitFullscreenEnabled)},Ws.prototype._setupUI=function(){var f=this._fullscreenButton=W.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);W.create("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden",!0),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),y.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Ws.prototype._updateTitle=function(){var f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.title=f},Ws.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Ws.prototype._isFullscreen=function(){return this._fullscreen},Ws.prototype._changeIcon=function(){(y.window.document.fullscreenElement||y.window.document.mozFullScreenElement||y.window.document.webkitFullscreenElement||y.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Ws.prototype._onClickFullscreen=function(){this._isFullscreen()?y.window.document.exitFullscreen?y.window.document.exitFullscreen():y.window.document.mozCancelFullScreen?y.window.document.mozCancelFullScreen():y.window.document.msExitFullscreen?y.window.document.msExitFullscreen():y.window.document.webkitCancelFullScreen&&y.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var Hc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Wc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Sf=function(f){function d(h){f.call(this),this.options=y.extend(Object.create(Hc),h),y.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.addTo=function(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new y.Event("open")),this},d.prototype.isOpen=function(){return!!this._map},d.prototype.remove=function(){return this._content&&W.remove(this._content),this._container&&(W.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new y.Event("close")),this},d.prototype.getLngLat=function(){return this._lngLat},d.prototype.setLngLat=function(h){return this._lngLat=y.LngLat.convert(h),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},d.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},d.prototype.getElement=function(){return this._container},d.prototype.setText=function(h){return this.setDOMContent(y.window.document.createTextNode(h))},d.prototype.setHTML=function(h){var g,w=y.window.document.createDocumentFragment(),M=y.window.document.createElement("body");for(M.innerHTML=h;g=M.firstChild;)w.appendChild(g);return this.setDOMContent(w)},d.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},d.prototype.setMaxWidth=function(h){return this.options.maxWidth=h,this._update(),this},d.prototype.setDOMContent=function(h){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=W.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(h),this._createCloseButton(),this._update(),this._focusFirstElement(),this},d.prototype.addClassName=function(h){this._container&&this._container.classList.add(h)},d.prototype.removeClassName=function(h){this._container&&this._container.classList.remove(h)},d.prototype.setOffset=function(h){return this.options.offset=h,this._update(),this},d.prototype.toggleClassName=function(h){if(this._container)return this._container.classList.toggle(h)},d.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=W.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},d.prototype._onMouseUp=function(h){this._update(h.point)},d.prototype._onMouseMove=function(h){this._update(h.point)},d.prototype._onDrag=function(h){this._update(h.point)},d.prototype._update=function(h){var g=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=W.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=W.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(Se){return g._container.classList.add(Se)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ml(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||h)){var w=this._pos=this._trackPointer&&h?h:this._map.project(this._lngLat),M=this.options.anchor,I=function Se(Ae){if(Ae){if(typeof Ae=="number"){var We=Math.round(Math.sqrt(.5*Math.pow(Ae,2)));return{center:new y.Point(0,0),top:new y.Point(0,Ae),"top-left":new y.Point(We,We),"top-right":new y.Point(-We,We),bottom:new y.Point(0,-Ae),"bottom-left":new y.Point(We,-We),"bottom-right":new y.Point(-We,-We),left:new y.Point(Ae,0),right:new y.Point(-Ae,0)}}if(Ae instanceof y.Point||Array.isArray(Ae)){var Ge=y.Point.convert(Ae);return{center:Ge,top:Ge,"top-left":Ge,"top-right":Ge,bottom:Ge,"bottom-left":Ge,"bottom-right":Ge,left:Ge,right:Ge}}return{center:y.Point.convert(Ae.center||[0,0]),top:y.Point.convert(Ae.top||[0,0]),"top-left":y.Point.convert(Ae["top-left"]||[0,0]),"top-right":y.Point.convert(Ae["top-right"]||[0,0]),bottom:y.Point.convert(Ae.bottom||[0,0]),"bottom-left":y.Point.convert(Ae["bottom-left"]||[0,0]),"bottom-right":y.Point.convert(Ae["bottom-right"]||[0,0]),left:y.Point.convert(Ae.left||[0,0]),right:y.Point.convert(Ae.right||[0,0])}}return Se(new y.Point(0,0))}(this.options.offset);if(!M){var D,G=this._container.offsetWidth,te=this._container.offsetHeight;D=w.y+I.bottom.y<te?["top"]:w.y>this._map.transform.height-te?["bottom"]:[],w.x<G/2?D.push("left"):w.x>this._map.transform.width-G/2&&D.push("right"),M=D.length===0?"bottom":D.join("-")}var he=w.add(I[M]).round();W.setTransform(this._container,Mu[M]+" translate("+he.x+"px,"+he.y+"px)"),jc(this._container,M,"popup")}},d.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var h=this._container.querySelector(Wc);h&&h.focus()}},d.prototype._onClose=function(){this.remove()},d}(y.Evented),Xc={version:y.version,supported:Te,setRTLTextPlugin:y.setRTLTextPlugin,getRTLTextPluginStatus:y.getRTLTextPluginStatus,Map:Wf,NavigationControl:vu,GeolocateControl:$f,AttributionControl:gs,ScaleControl:iu,FullscreenControl:Ws,Popup:Sf,Marker:Eo,Style:ps,LngLat:y.LngLat,LngLatBounds:y.LngLatBounds,Point:y.Point,MercatorCoordinate:y.MercatorCoordinate,Evented:y.Evented,config:y.config,prewarm:function(){$t().acquire(lr)},clearPrewarmedResources:function(){var f=Dn;f&&(f.isPreloaded()&&f.numActive()===1?(f.release(lr),Dn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return y.config.ACCESS_TOKEN},set accessToken(f){y.config.ACCESS_TOKEN=f},get baseApiUrl(){return y.config.API_URL},set baseApiUrl(f){y.config.API_URL=f},get workerCount(){return Lr.workerCount},set workerCount(f){Lr.workerCount=f},get maxParallelImageRequests(){return y.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){y.config.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage:function(f){y.clearTileCache(f)},workerUrl:""};return Xc}),Ee})},3614:function(Br,pe,K){"use strict";Br.exports=ne;var Ee=K(80645);function ne(re){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(re)?re:new Uint8Array(re||0),this.pos=0,this.type=0,this.length=this.buf.length}ne.Varint=0,ne.Fixed64=1,ne.Bytes=2,ne.Fixed32=5;var y=(1<<16)*(1<<16),Te=1/y,W=12,ye=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");ne.prototype={destroy:function(){this.buf=null},readFields:function(re,Fe,N){for(N=N||this.length;this.pos<N;){var z=this.readVarint(),ce=z>>3,ze=this.pos;this.type=z&7,re(ce,Fe,this),this.pos===ze&&this.skip(z)}return Fe},readMessage:function(re,Fe){return this.readFields(re,Fe,this.readVarint()+this.pos)},readFixed32:function(){var re=Ct(this.buf,this.pos);return this.pos+=4,re},readSFixed32:function(){var re=Ut(this.buf,this.pos);return this.pos+=4,re},readFixed64:function(){var re=Ct(this.buf,this.pos)+Ct(this.buf,this.pos+4)*y;return this.pos+=8,re},readSFixed64:function(){var re=Ct(this.buf,this.pos)+Ut(this.buf,this.pos+4)*y;return this.pos+=8,re},readFloat:function(){var re=Ee.read(this.buf,this.pos,!0,23,4);return this.pos+=4,re},readDouble:function(){var re=Ee.read(this.buf,this.pos,!0,52,8);return this.pos+=8,re},readVarint:function(re){var Fe=this.buf,N,z;return z=Fe[this.pos++],N=z&127,z<128||(z=Fe[this.pos++],N|=(z&127)<<7,z<128)||(z=Fe[this.pos++],N|=(z&127)<<14,z<128)||(z=Fe[this.pos++],N|=(z&127)<<21,z<128)?N:(z=Fe[this.pos],N|=(z&15)<<28,se(N,re,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var re=this.readVarint();return re%2==1?(re+1)/-2:re/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var re=this.readVarint()+this.pos,Fe=this.pos;return this.pos=re,re-Fe>=W&&ye?rr(this.buf,Fe,re):dt(this.buf,Fe,re)},readBytes:function(){var re=this.readVarint()+this.pos,Fe=this.buf.subarray(this.pos,re);return this.pos=re,Fe},readPackedVarint:function(re,Fe){if(this.type!==ne.Bytes)return re.push(this.readVarint(Fe));var N=Ye(this);for(re=re||[];this.pos<N;)re.push(this.readVarint(Fe));return re},readPackedSVarint:function(re){if(this.type!==ne.Bytes)return re.push(this.readSVarint());var Fe=Ye(this);for(re=re||[];this.pos<Fe;)re.push(this.readSVarint());return re},readPackedBoolean:function(re){if(this.type!==ne.Bytes)return re.push(this.readBoolean());var Fe=Ye(this);for(re=re||[];this.pos<Fe;)re.push(this.readBoolean());return re},readPackedFloat:function(re){if(this.type!==ne.Bytes)return re.push(this.readFloat());var Fe=Ye(this);for(re=re||[];this.pos<Fe;)re.push(this.readFloat());return re},readPackedDouble:function(re){if(this.type!==ne.Bytes)return re.push(this.readDouble());var Fe=Ye(this);for(re=re||[];this.pos<Fe;)re.push(this.readDouble());return re},readPackedFixed32:function(re){if(this.type!==ne.Bytes)return re.push(this.readFixed32());var Fe=Ye(this);for(re=re||[];this.pos<Fe;)re.push(this.readFixed32());return re},readPackedSFixed32:function(re){if(this.type!==ne.Bytes)return re.push(this.readSFixed32());var Fe=Ye(this);for(re=re||[];this.pos<Fe;)re.push(this.readSFixed32());return re},readPackedFixed64:function(re){if(this.type!==ne.Bytes)return re.push(this.readFixed64());var Fe=Ye(this);for(re=re||[];this.pos<Fe;)re.push(this.readFixed64());return re},readPackedSFixed64:function(re){if(this.type!==ne.Bytes)return re.push(this.readSFixed64());var Fe=Ye(this);for(re=re||[];this.pos<Fe;)re.push(this.readSFixed64());return re},skip:function(re){var Fe=re&7;if(Fe===ne.Varint)for(;this.buf[this.pos++]>127;);else if(Fe===ne.Bytes)this.pos=this.readVarint()+this.pos;else if(Fe===ne.Fixed32)this.pos+=4;else if(Fe===ne.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+Fe)},writeTag:function(re,Fe){this.writeVarint(re<<3|Fe)},realloc:function(re){for(var Fe=this.length||16;Fe<this.pos+re;)Fe*=2;if(Fe!==this.length){var N=new Uint8Array(Fe);N.set(this.buf),this.buf=N,this.length=Fe}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(re){this.realloc(4),ft(this.buf,re,this.pos),this.pos+=4},writeSFixed32:function(re){this.realloc(4),ft(this.buf,re,this.pos),this.pos+=4},writeFixed64:function(re){this.realloc(8),ft(this.buf,re&-1,this.pos),ft(this.buf,Math.floor(re*Te),this.pos+4),this.pos+=8},writeSFixed64:function(re){this.realloc(8),ft(this.buf,re&-1,this.pos),ft(this.buf,Math.floor(re*Te),this.pos+4),this.pos+=8},writeVarint:function(re){if(re=+re||0,re>268435455||re<0){Qe(re,this);return}this.realloc(4),this.buf[this.pos++]=re&127|(re>127?128:0),!(re<=127)&&(this.buf[this.pos++]=(re>>>=7)&127|(re>127?128:0),!(re<=127)&&(this.buf[this.pos++]=(re>>>=7)&127|(re>127?128:0),!(re<=127)&&(this.buf[this.pos++]=re>>>7&127)))},writeSVarint:function(re){this.writeVarint(re<0?-re*2-1:re*2)},writeBoolean:function(re){this.writeVarint(Boolean(re))},writeString:function(re){re=String(re),this.realloc(re.length*4),this.pos++;var Fe=this.pos;this.pos=wr(this.buf,re,this.pos);var N=this.pos-Fe;N>=128&&gt(Fe,N,this),this.pos=Fe-1,this.writeVarint(N),this.pos+=N},writeFloat:function(re){this.realloc(4),Ee.write(this.buf,re,this.pos,!0,23,4),this.pos+=4},writeDouble:function(re){this.realloc(8),Ee.write(this.buf,re,this.pos,!0,52,8),this.pos+=8},writeBytes:function(re){var Fe=re.length;this.writeVarint(Fe),this.realloc(Fe);for(var N=0;N<Fe;N++)this.buf[this.pos++]=re[N]},writeRawMessage:function(re,Fe){this.pos++;var N=this.pos;re(Fe,this);var z=this.pos-N;z>=128&&gt(N,z,this),this.pos=N-1,this.writeVarint(z),this.pos+=z},writeMessage:function(re,Fe,N){this.writeTag(re,ne.Bytes),this.writeRawMessage(Fe,N)},writePackedVarint:function(re,Fe){Fe.length&&this.writeMessage(re,ur,Fe)},writePackedSVarint:function(re,Fe){Fe.length&&this.writeMessage(re,Mt,Fe)},writePackedBoolean:function(re,Fe){Fe.length&&this.writeMessage(re,yt,Fe)},writePackedFloat:function(re,Fe){Fe.length&&this.writeMessage(re,qt,Fe)},writePackedDouble:function(re,Fe){Fe.length&&this.writeMessage(re,zt,Fe)},writePackedFixed32:function(re,Fe){Fe.length&&this.writeMessage(re,At,Fe)},writePackedSFixed32:function(re,Fe){Fe.length&&this.writeMessage(re,ar,Fe)},writePackedFixed64:function(re,Fe){Fe.length&&this.writeMessage(re,J,Fe)},writePackedSFixed64:function(re,Fe){Fe.length&&this.writeMessage(re,Qt,Fe)},writeBytesField:function(re,Fe){this.writeTag(re,ne.Bytes),this.writeBytes(Fe)},writeFixed32Field:function(re,Fe){this.writeTag(re,ne.Fixed32),this.writeFixed32(Fe)},writeSFixed32Field:function(re,Fe){this.writeTag(re,ne.Fixed32),this.writeSFixed32(Fe)},writeFixed64Field:function(re,Fe){this.writeTag(re,ne.Fixed64),this.writeFixed64(Fe)},writeSFixed64Field:function(re,Fe){this.writeTag(re,ne.Fixed64),this.writeSFixed64(Fe)},writeVarintField:function(re,Fe){this.writeTag(re,ne.Varint),this.writeVarint(Fe)},writeSVarintField:function(re,Fe){this.writeTag(re,ne.Varint),this.writeSVarint(Fe)},writeStringField:function(re,Fe){this.writeTag(re,ne.Bytes),this.writeString(Fe)},writeFloatField:function(re,Fe){this.writeTag(re,ne.Fixed32),this.writeFloat(Fe)},writeDoubleField:function(re,Fe){this.writeTag(re,ne.Fixed64),this.writeDouble(Fe)},writeBooleanField:function(re,Fe){this.writeVarintField(re,Boolean(Fe))}};function se(re,Fe,N){var z=N.buf,ce,ze;if(ze=z[N.pos++],ce=(ze&112)>>4,ze<128||(ze=z[N.pos++],ce|=(ze&127)<<3,ze<128)||(ze=z[N.pos++],ce|=(ze&127)<<10,ze<128)||(ze=z[N.pos++],ce|=(ze&127)<<17,ze<128)||(ze=z[N.pos++],ce|=(ze&127)<<24,ze<128)||(ze=z[N.pos++],ce|=(ze&1)<<31,ze<128))return _e(re,ce,Fe);throw new Error("Expected varint not more than 10 bytes")}function Ye(re){return re.type===ne.Bytes?re.readVarint()+re.pos:re.pos+1}function _e(re,Fe,N){return N?Fe*4294967296+(re>>>0):(Fe>>>0)*4294967296+(re>>>0)}function Qe(re,Fe){var N,z;if(re>=0?(N=re%4294967296|0,z=re/4294967296|0):(N=~(-re%4294967296),z=~(-re/4294967296),N^4294967295?N=N+1|0:(N=0,z=z+1|0)),re>=18446744073709552e3||re<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");Fe.realloc(10),lt(N,z,Fe),bt(z,Fe)}function lt(re,Fe,N){N.buf[N.pos++]=re&127|128,re>>>=7,N.buf[N.pos++]=re&127|128,re>>>=7,N.buf[N.pos++]=re&127|128,re>>>=7,N.buf[N.pos++]=re&127|128,re>>>=7,N.buf[N.pos]=re&127}function bt(re,Fe){var N=(re&7)<<4;Fe.buf[Fe.pos++]|=N|((re>>>=3)?128:0),!!re&&(Fe.buf[Fe.pos++]=re&127|((re>>>=7)?128:0),!!re&&(Fe.buf[Fe.pos++]=re&127|((re>>>=7)?128:0),!!re&&(Fe.buf[Fe.pos++]=re&127|((re>>>=7)?128:0),!!re&&(Fe.buf[Fe.pos++]=re&127|((re>>>=7)?128:0),!!re&&(Fe.buf[Fe.pos++]=re&127)))))}function gt(re,Fe,N){var z=Fe<=16383?1:Fe<=2097151?2:Fe<=268435455?3:Math.floor(Math.log(Fe)/(Math.LN2*7));N.realloc(z);for(var ce=N.pos-1;ce>=re;ce--)N.buf[ce+z]=N.buf[ce]}function ur(re,Fe){for(var N=0;N<re.length;N++)Fe.writeVarint(re[N])}function Mt(re,Fe){for(var N=0;N<re.length;N++)Fe.writeSVarint(re[N])}function qt(re,Fe){for(var N=0;N<re.length;N++)Fe.writeFloat(re[N])}function zt(re,Fe){for(var N=0;N<re.length;N++)Fe.writeDouble(re[N])}function yt(re,Fe){for(var N=0;N<re.length;N++)Fe.writeBoolean(re[N])}function At(re,Fe){for(var N=0;N<re.length;N++)Fe.writeFixed32(re[N])}function ar(re,Fe){for(var N=0;N<re.length;N++)Fe.writeSFixed32(re[N])}function J(re,Fe){for(var N=0;N<re.length;N++)Fe.writeFixed64(re[N])}function Qt(re,Fe){for(var N=0;N<re.length;N++)Fe.writeSFixed64(re[N])}function Ct(re,Fe){return(re[Fe]|re[Fe+1]<<8|re[Fe+2]<<16)+re[Fe+3]*16777216}function ft(re,Fe,N){re[N]=Fe,re[N+1]=Fe>>>8,re[N+2]=Fe>>>16,re[N+3]=Fe>>>24}function Ut(re,Fe){return(re[Fe]|re[Fe+1]<<8|re[Fe+2]<<16)+(re[Fe+3]<<24)}function dt(re,Fe,N){for(var z="",ce=Fe;ce<N;){var ze=re[ce],et=null,ht=ze>239?4:ze>223?3:ze>191?2:1;if(ce+ht>N)break;var Rt,Jt,Or;ht===1?ze<128&&(et=ze):ht===2?(Rt=re[ce+1],(Rt&192)==128&&(et=(ze&31)<<6|Rt&63,et<=127&&(et=null))):ht===3?(Rt=re[ce+1],Jt=re[ce+2],(Rt&192)==128&&(Jt&192)==128&&(et=(ze&15)<<12|(Rt&63)<<6|Jt&63,(et<=2047||et>=55296&&et<=57343)&&(et=null))):ht===4&&(Rt=re[ce+1],Jt=re[ce+2],Or=re[ce+3],(Rt&192)==128&&(Jt&192)==128&&(Or&192)==128&&(et=(ze&15)<<18|(Rt&63)<<12|(Jt&63)<<6|Or&63,(et<=65535||et>=1114112)&&(et=null))),et===null?(et=65533,ht=1):et>65535&&(et-=65536,z+=String.fromCharCode(et>>>10&1023|55296),et=56320|et&1023),z+=String.fromCharCode(et),ce+=ht}return z}function rr(re,Fe,N){return ye.decode(re.subarray(Fe,N))}function wr(re,Fe,N){for(var z=0,ce,ze;z<Fe.length;z++){if(ce=Fe.charCodeAt(z),ce>55295&&ce<57344)if(ze)if(ce<56320){re[N++]=239,re[N++]=191,re[N++]=189,ze=ce;continue}else ce=ze-55296<<10|ce-56320|65536,ze=null;else{ce>56319||z+1===Fe.length?(re[N++]=239,re[N++]=191,re[N++]=189):ze=ce;continue}else ze&&(re[N++]=239,re[N++]=191,re[N++]=189,ze=null);ce<128?re[N++]=ce:(ce<2048?re[N++]=ce>>6|192:(ce<65536?re[N++]=ce>>12|224:(re[N++]=ce>>18|240,re[N++]=ce>>12&63|128),re[N++]=ce>>6&63|128),re[N++]=ce&63|128)}return N}},32676:function(Br,pe,K){var Ee=K(34155);(function(ne,y){Br.exports=y()})(this,function(){"use strict";function ne(Tt,ge){if(!(Tt instanceof ge))throw new TypeError("Cannot call a class as a function")}function y(Tt,ge){for(var ue=0;ue<ge.length;ue++){var we=ge[ue];we.enumerable=we.enumerable||!1,we.configurable=!0,"value"in we&&(we.writable=!0),Object.defineProperty(Tt,we.key,we)}}function Te(Tt,ge,ue){return ge&&y(Tt.prototype,ge),ue&&y(Tt,ue),Tt}/**
 * splaytree v3.1.0
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */var W=function(){function Tt(ge,ue){this.next=null,this.key=ge,this.data=ue,this.left=null,this.right=null}return Tt}();function ye(Tt,ge){return Tt>ge?1:Tt<ge?-1:0}function se(Tt,ge,ue){for(var we=new W(null,null),Z=we,Je=we;;){var Xt=ue(Tt,ge.key);if(Xt<0){if(ge.left===null)break;if(ue(Tt,ge.left.key)<0){var Dr=ge.left;if(ge.left=Dr.right,Dr.right=ge,ge=Dr,ge.left===null)break}Je.left=ge,Je=ge,ge=ge.left}else if(Xt>0){if(ge.right===null)break;if(ue(Tt,ge.right.key)>0){var Dr=ge.right;if(ge.right=Dr.left,Dr.left=ge,ge=Dr,ge.right===null)break}Z.right=ge,Z=ge,ge=ge.right}else break}return Z.right=ge.left,Je.left=ge.right,ge.left=we.right,ge.right=we.left,ge}function Ye(Tt,ge,ue,we){var Z=new W(Tt,ge);if(ue===null)return Z.left=Z.right=null,Z;ue=se(Tt,ue,we);var Je=we(Tt,ue.key);return Je<0?(Z.left=ue.left,Z.right=ue,ue.left=null):Je>=0&&(Z.right=ue.right,Z.left=ue,ue.right=null),Z}function _e(Tt,ge,ue){var we=null,Z=null;if(ge){ge=se(Tt,ge,ue);var Je=ue(ge.key,Tt);Je===0?(we=ge.left,Z=ge.right):Je<0?(Z=ge.right,ge.right=null,we=ge):(we=ge.left,ge.left=null,Z=ge)}return{left:we,right:Z}}function Qe(Tt,ge,ue){return ge===null?Tt:(Tt===null||(ge=se(Tt.key,ge,ue),ge.left=Tt),ge)}function lt(Tt,ge,ue,we,Z){if(Tt){we(""+ge+(ue?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 ")+Z(Tt)+`
`);var Je=ge+(ue?"    ":"\u2502   ");Tt.left&&lt(Tt.left,Je,!1,we,Z),Tt.right&&lt(Tt.right,Je,!0,we,Z)}}var bt=function(){function Tt(ge){ge===void 0&&(ge=ye),this._root=null,this._size=0,this._comparator=ge}return Tt.prototype.insert=function(ge,ue){return this._size++,this._root=Ye(ge,ue,this._root,this._comparator)},Tt.prototype.add=function(ge,ue){var we=new W(ge,ue);this._root===null&&(we.left=we.right=null,this._size++,this._root=we);var Z=this._comparator,Je=se(ge,this._root,Z),Xt=Z(ge,Je.key);return Xt===0?this._root=Je:(Xt<0?(we.left=Je.left,we.right=Je,Je.left=null):Xt>0&&(we.right=Je.right,we.left=Je,Je.right=null),this._size++,this._root=we),this._root},Tt.prototype.remove=function(ge){this._root=this._remove(ge,this._root,this._comparator)},Tt.prototype._remove=function(ge,ue,we){var Z;if(ue===null)return null;ue=se(ge,ue,we);var Je=we(ge,ue.key);return Je===0?(ue.left===null?Z=ue.right:(Z=se(ge,ue.left,we),Z.right=ue.right),this._size--,Z):ue},Tt.prototype.pop=function(){var ge=this._root;if(ge){for(;ge.left;)ge=ge.left;return this._root=se(ge.key,this._root,this._comparator),this._root=this._remove(ge.key,this._root,this._comparator),{key:ge.key,data:ge.data}}return null},Tt.prototype.findStatic=function(ge){for(var ue=this._root,we=this._comparator;ue;){var Z=we(ge,ue.key);if(Z===0)return ue;Z<0?ue=ue.left:ue=ue.right}return null},Tt.prototype.find=function(ge){return this._root&&(this._root=se(ge,this._root,this._comparator),this._comparator(ge,this._root.key)!==0)?null:this._root},Tt.prototype.contains=function(ge){for(var ue=this._root,we=this._comparator;ue;){var Z=we(ge,ue.key);if(Z===0)return!0;Z<0?ue=ue.left:ue=ue.right}return!1},Tt.prototype.forEach=function(ge,ue){for(var we=this._root,Z=[],Je=!1;!Je;)we!==null?(Z.push(we),we=we.left):Z.length!==0?(we=Z.pop(),ge.call(ue,we),we=we.right):Je=!0;return this},Tt.prototype.range=function(ge,ue,we,Z){for(var Je=[],Xt=this._comparator,Dr=this._root,tt;Je.length!==0||Dr;)if(Dr)Je.push(Dr),Dr=Dr.left;else{if(Dr=Je.pop(),tt=Xt(Dr.key,ue),tt>0)break;if(Xt(Dr.key,ge)>=0&&we.call(Z,Dr))return this;Dr=Dr.right}return this},Tt.prototype.keys=function(){var ge=[];return this.forEach(function(ue){var we=ue.key;return ge.push(we)}),ge},Tt.prototype.values=function(){var ge=[];return this.forEach(function(ue){var we=ue.data;return ge.push(we)}),ge},Tt.prototype.min=function(){return this._root?this.minNode(this._root).key:null},Tt.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},Tt.prototype.minNode=function(ge){if(ge===void 0&&(ge=this._root),ge)for(;ge.left;)ge=ge.left;return ge},Tt.prototype.maxNode=function(ge){if(ge===void 0&&(ge=this._root),ge)for(;ge.right;)ge=ge.right;return ge},Tt.prototype.at=function(ge){for(var ue=this._root,we=!1,Z=0,Je=[];!we;)if(ue)Je.push(ue),ue=ue.left;else if(Je.length>0){if(ue=Je.pop(),Z===ge)return ue;Z++,ue=ue.right}else we=!0;return null},Tt.prototype.next=function(ge){var ue=this._root,we=null;if(ge.right){for(we=ge.right;we.left;)we=we.left;return we}for(var Z=this._comparator;ue;){var Je=Z(ge.key,ue.key);if(Je===0)break;Je<0?(we=ue,ue=ue.left):ue=ue.right}return we},Tt.prototype.prev=function(ge){var ue=this._root,we=null;if(ge.left!==null){for(we=ge.left;we.right;)we=we.right;return we}for(var Z=this._comparator;ue;){var Je=Z(ge.key,ue.key);if(Je===0)break;Je<0?ue=ue.left:(we=ue,ue=ue.right)}return we},Tt.prototype.clear=function(){return this._root=null,this._size=0,this},Tt.prototype.toList=function(){return Mt(this._root)},Tt.prototype.load=function(ge,ue,we){ue===void 0&&(ue=[]),we===void 0&&(we=!1);var Z=ge.length,Je=this._comparator;if(we&&yt(ge,ue,0,Z-1,Je),this._root===null)this._root=gt(ge,ue,0,Z),this._size=Z;else{var Xt=zt(this.toList(),ur(ge,ue),Je);Z=this._size+Z,this._root=qt({head:Xt},0,Z)}return this},Tt.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(Tt.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(Tt.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),Tt.prototype.toString=function(ge){ge===void 0&&(ge=function(Z){return String(Z.key)});var ue=[];return lt(this._root,"",!0,function(we){return ue.push(we)},ge),ue.join("")},Tt.prototype.update=function(ge,ue,we){var Z=this._comparator,Je=_e(ge,this._root,Z),Xt=Je.left,Dr=Je.right;Z(ge,ue)<0?Dr=Ye(ue,we,Dr,Z):Xt=Ye(ue,we,Xt,Z),this._root=Qe(Xt,Dr,Z)},Tt.prototype.split=function(ge){return _e(ge,this._root,this._comparator)},Tt}();function gt(Tt,ge,ue,we){var Z=we-ue;if(Z>0){var Je=ue+Math.floor(Z/2),Xt=Tt[Je],Dr=ge[Je],tt=new W(Xt,Dr);return tt.left=gt(Tt,ge,ue,Je),tt.right=gt(Tt,ge,Je+1,we),tt}return null}function ur(Tt,ge){for(var ue=new W(null,null),we=ue,Z=0;Z<Tt.length;Z++)we=we.next=new W(Tt[Z],ge[Z]);return we.next=null,ue.next}function Mt(Tt){for(var ge=Tt,ue=[],we=!1,Z=new W(null,null),Je=Z;!we;)ge?(ue.push(ge),ge=ge.left):ue.length>0?(ge=Je=Je.next=ue.pop(),ge=ge.right):we=!0;return Je.next=null,Z.next}function qt(Tt,ge,ue){var we=ue-ge;if(we>0){var Z=ge+Math.floor(we/2),Je=qt(Tt,ge,Z),Xt=Tt.head;return Xt.left=Je,Tt.head=Tt.head.next,Xt.right=qt(Tt,Z+1,ue),Xt}return null}function zt(Tt,ge,ue){for(var we=new W(null,null),Z=we,Je=Tt,Xt=ge;Je!==null&&Xt!==null;)ue(Je.key,Xt.key)<0?(Z.next=Je,Je=Je.next):(Z.next=Xt,Xt=Xt.next),Z=Z.next;return Je!==null?Z.next=Je:Xt!==null&&(Z.next=Xt),we.next}function yt(Tt,ge,ue,we,Z){if(!(ue>=we)){for(var Je=Tt[ue+we>>1],Xt=ue-1,Dr=we+1;;){do Xt++;while(Z(Tt[Xt],Je)<0);do Dr--;while(Z(Tt[Dr],Je)>0);if(Xt>=Dr)break;var tt=Tt[Xt];Tt[Xt]=Tt[Dr],Tt[Dr]=tt,tt=ge[Xt],ge[Xt]=ge[Dr],ge[Dr]=tt}yt(Tt,ge,ue,Dr,Z),yt(Tt,ge,Dr+1,we,Z)}}var At=function(ge,ue){return ge.ll.x<=ue.x&&ue.x<=ge.ur.x&&ge.ll.y<=ue.y&&ue.y<=ge.ur.y},ar=function(ge,ue){if(ue.ur.x<ge.ll.x||ge.ur.x<ue.ll.x||ue.ur.y<ge.ll.y||ge.ur.y<ue.ll.y)return null;var we=ge.ll.x<ue.ll.x?ue.ll.x:ge.ll.x,Z=ge.ur.x<ue.ur.x?ge.ur.x:ue.ur.x,Je=ge.ll.y<ue.ll.y?ue.ll.y:ge.ll.y,Xt=ge.ur.y<ue.ur.y?ge.ur.y:ue.ur.y;return{ll:{x:we,y:Je},ur:{x:Z,y:Xt}}},J=Number.EPSILON;J===void 0&&(J=Math.pow(2,-52));var Qt=J*J,Ct=function(ge,ue){if(-J<ge&&ge<J&&-J<ue&&ue<J)return 0;var we=ge-ue;return we*we<Qt*ge*ue?0:ge<ue?-1:1},ft=function(){function Tt(){ne(this,Tt),this.reset()}return Te(Tt,[{key:"reset",value:function(){this.xRounder=new Ut,this.yRounder=new Ut}},{key:"round",value:function(ue,we){return{x:this.xRounder.round(ue),y:this.yRounder.round(we)}}}]),Tt}(),Ut=function(){function Tt(){ne(this,Tt),this.tree=new bt,this.round(0)}return Te(Tt,[{key:"round",value:function(ue){var we=this.tree.add(ue),Z=this.tree.prev(we);if(Z!==null&&Ct(we.key,Z.key)===0)return this.tree.remove(ue),Z.key;var Je=this.tree.next(we);return Je!==null&&Ct(we.key,Je.key)===0?(this.tree.remove(ue),Je.key):ue}}]),Tt}(),dt=new ft,rr=function(ge,ue){return ge.x*ue.y-ge.y*ue.x},wr=function(ge,ue){return ge.x*ue.x+ge.y*ue.y},re=function(ge,ue,we){var Z={x:ue.x-ge.x,y:ue.y-ge.y},Je={x:we.x-ge.x,y:we.y-ge.y},Xt=rr(Z,Je);return Ct(Xt,0)},Fe=function(ge){return Math.sqrt(wr(ge,ge))},N=function(ge,ue,we){var Z={x:ue.x-ge.x,y:ue.y-ge.y},Je={x:we.x-ge.x,y:we.y-ge.y};return rr(Je,Z)/Fe(Je)/Fe(Z)},z=function(ge,ue,we){var Z={x:ue.x-ge.x,y:ue.y-ge.y},Je={x:we.x-ge.x,y:we.y-ge.y};return wr(Je,Z)/Fe(Je)/Fe(Z)},ce=function(ge,ue,we){return ue.y===0?null:{x:ge.x+ue.x/ue.y*(we-ge.y),y:we}},ze=function(ge,ue,we){return ue.x===0?null:{x:we,y:ge.y+ue.y/ue.x*(we-ge.x)}},et=function(ge,ue,we,Z){if(ue.x===0)return ze(we,Z,ge.x);if(Z.x===0)return ze(ge,ue,we.x);if(ue.y===0)return ce(we,Z,ge.y);if(Z.y===0)return ce(ge,ue,we.y);var Je=rr(ue,Z);if(Je==0)return null;var Xt={x:we.x-ge.x,y:we.y-ge.y},Dr=rr(Xt,ue)/Je,tt=rr(Xt,Z)/Je,It=ge.x+tt*ue.x,mr=we.x+Dr*Z.x,Ir=ge.y+tt*ue.y,$r=we.y+Dr*Z.y,tn=(It+mr)/2,$n=(Ir+$r)/2;return{x:tn,y:$n}},ht=function(){Te(Tt,null,[{key:"compare",value:function(ue,we){var Z=Tt.comparePoints(ue.point,we.point);return Z!==0?Z:(ue.point!==we.point&&ue.link(we),ue.isLeft!==we.isLeft?ue.isLeft?1:-1:Jt.compare(ue.segment,we.segment))}},{key:"comparePoints",value:function(ue,we){return ue.x<we.x?-1:ue.x>we.x?1:ue.y<we.y?-1:ue.y>we.y?1:0}}]);function Tt(ge,ue){ne(this,Tt),ge.events===void 0?ge.events=[this]:ge.events.push(this),this.point=ge,this.isLeft=ue}return Te(Tt,[{key:"link",value:function(ue){if(ue.point===this.point)throw new Error("Tried to link already linked events");for(var we=ue.point.events,Z=0,Je=we.length;Z<Je;Z++){var Xt=we[Z];this.point.events.push(Xt),Xt.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var ue=this.point.events.length,we=0;we<ue;we++){var Z=this.point.events[we];if(Z.segment.consumedBy===void 0)for(var Je=we+1;Je<ue;Je++){var Xt=this.point.events[Je];Xt.consumedBy===void 0&&Z.otherSE.point.events===Xt.otherSE.point.events&&Z.segment.consume(Xt.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var ue=[],we=0,Z=this.point.events.length;we<Z;we++){var Je=this.point.events[we];Je!==this&&!Je.segment.ringOut&&Je.segment.isInResult()&&ue.push(Je)}return ue}},{key:"getLeftmostComparator",value:function(ue){var we=this,Z=new Map,Je=function(Dr){var tt=Dr.otherSE;Z.set(Dr,{sine:N(we.point,ue.point,tt.point),cosine:z(we.point,ue.point,tt.point)})};return function(Xt,Dr){Z.has(Xt)||Je(Xt),Z.has(Dr)||Je(Dr);var tt=Z.get(Xt),It=tt.sine,mr=tt.cosine,Ir=Z.get(Dr),$r=Ir.sine,tn=Ir.cosine;return It>=0&&$r>=0?mr<tn?1:mr>tn?-1:0:It<0&&$r<0?mr<tn?-1:mr>tn?1:0:$r<It?-1:$r>It?1:0}}}]),Tt}(),Rt=0,Jt=function(){Te(Tt,null,[{key:"compare",value:function(ue,we){var Z=ue.leftSE.point.x,Je=we.leftSE.point.x,Xt=ue.rightSE.point.x,Dr=we.rightSE.point.x;if(Dr<Z)return 1;if(Xt<Je)return-1;var tt=ue.leftSE.point.y,It=we.leftSE.point.y,mr=ue.rightSE.point.y,Ir=we.rightSE.point.y;if(Z<Je){if(It<tt&&It<mr)return 1;if(It>tt&&It>mr)return-1;var $r=ue.comparePoint(we.leftSE.point);if($r<0)return 1;if($r>0)return-1;var tn=we.comparePoint(ue.rightSE.point);return tn!==0?tn:-1}if(Z>Je){if(tt<It&&tt<Ir)return-1;if(tt>It&&tt>Ir)return 1;var $n=we.comparePoint(ue.leftSE.point);if($n!==0)return $n;var Vn=ue.comparePoint(we.rightSE.point);return Vn<0?1:Vn>0?-1:1}if(tt<It)return-1;if(tt>It)return 1;if(Xt<Dr){var rn=we.comparePoint(ue.rightSE.point);if(rn!==0)return rn}if(Xt>Dr){var vi=ue.comparePoint(we.rightSE.point);if(vi<0)return 1;if(vi>0)return-1}if(Xt!==Dr){var ni=mr-tt,sa=Xt-Z,Sa=Ir-It,Na=Dr-Je;if(ni>sa&&Sa<Na)return 1;if(ni<sa&&Sa>Na)return-1}return Xt>Dr?1:Xt<Dr||mr<Ir?-1:mr>Ir?1:ue.id<we.id?-1:ue.id>we.id?1:0}}]);function Tt(ge,ue,we,Z){ne(this,Tt),this.id=++Rt,this.leftSE=ge,ge.segment=this,ge.otherSE=ue,this.rightSE=ue,ue.segment=this,ue.otherSE=ge,this.rings=we,this.windings=Z}return Te(Tt,[{key:"replaceRightSE",value:function(ue){this.rightSE=ue,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var ue=this.leftSE.point.y,we=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:ue<we?ue:we},ur:{x:this.rightSE.point.x,y:ue>we?ue:we}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(ue){return ue.x===this.leftSE.point.x&&ue.y===this.leftSE.point.y||ue.x===this.rightSE.point.x&&ue.y===this.rightSE.point.y}},{key:"comparePoint",value:function(ue){if(this.isAnEndpoint(ue))return 0;var we=this.leftSE.point,Z=this.rightSE.point,Je=this.vector();if(we.x===Z.x)return ue.x===we.x?0:ue.x<we.x?1:-1;var Xt=(ue.y-we.y)/Je.y,Dr=we.x+Xt*Je.x;if(ue.x===Dr)return 0;var tt=(ue.x-we.x)/Je.x,It=we.y+tt*Je.y;return ue.y===It?0:ue.y<It?-1:1}},{key:"getIntersection",value:function(ue){var we=this.bbox(),Z=ue.bbox(),Je=ar(we,Z);if(Je===null)return null;var Xt=this.leftSE.point,Dr=this.rightSE.point,tt=ue.leftSE.point,It=ue.rightSE.point,mr=At(we,tt)&&this.comparePoint(tt)===0,Ir=At(Z,Xt)&&ue.comparePoint(Xt)===0,$r=At(we,It)&&this.comparePoint(It)===0,tn=At(Z,Dr)&&ue.comparePoint(Dr)===0;if(Ir&&mr)return tn&&!$r?Dr:!tn&&$r?It:null;if(Ir)return $r&&Xt.x===It.x&&Xt.y===It.y?null:Xt;if(mr)return tn&&Dr.x===tt.x&&Dr.y===tt.y?null:tt;if(tn&&$r)return null;if(tn)return Dr;if($r)return It;var $n=et(Xt,this.vector(),tt,ue.vector());return $n===null||!At(Je,$n)?null:dt.round($n.x,$n.y)}},{key:"split",value:function(ue){var we=[],Z=ue.events!==void 0,Je=new ht(ue,!0),Xt=new ht(ue,!1),Dr=this.rightSE;this.replaceRightSE(Xt),we.push(Xt),we.push(Je);var tt=new Tt(Je,Dr,this.rings.slice(),this.windings.slice());return ht.comparePoints(tt.leftSE.point,tt.rightSE.point)>0&&tt.swapEvents(),ht.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),Z&&(Je.checkForConsuming(),Xt.checkForConsuming()),we}},{key:"swapEvents",value:function(){var ue=this.rightSE;this.rightSE=this.leftSE,this.leftSE=ue,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var we=0,Z=this.windings.length;we<Z;we++)this.windings[we]*=-1}},{key:"consume",value:function(ue){for(var we=this,Z=ue;we.consumedBy;)we=we.consumedBy;for(;Z.consumedBy;)Z=Z.consumedBy;var Je=Tt.compare(we,Z);if(Je!==0){if(Je>0){var Xt=we;we=Z,Z=Xt}if(we.prev===Z){var Dr=we;we=Z,Z=Dr}for(var tt=0,It=Z.rings.length;tt<It;tt++){var mr=Z.rings[tt],Ir=Z.windings[tt],$r=we.rings.indexOf(mr);$r===-1?(we.rings.push(mr),we.windings.push(Ir)):we.windings[$r]+=Ir}Z.rings=null,Z.windings=null,Z.consumedBy=we,Z.leftSE.consumedBy=we.leftSE,Z.rightSE.consumedBy=we.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var ue=this.prev.consumedBy||this.prev;this._beforeState=ue.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var ue=this.beforeState();this._afterState={rings:ue.rings.slice(0),windings:ue.windings.slice(0),multiPolys:[]};for(var we=this._afterState.rings,Z=this._afterState.windings,Je=this._afterState.multiPolys,Xt=0,Dr=this.rings.length;Xt<Dr;Xt++){var tt=this.rings[Xt],It=this.windings[Xt],mr=we.indexOf(tt);mr===-1?(we.push(tt),Z.push(It)):Z[mr]+=It}for(var Ir=[],$r=[],tn=0,$n=we.length;tn<$n;tn++)if(Z[tn]!==0){var Vn=we[tn],rn=Vn.poly;if($r.indexOf(rn)===-1)if(Vn.isExterior)Ir.push(rn);else{$r.indexOf(rn)===-1&&$r.push(rn);var vi=Ir.indexOf(Vn.poly);vi!==-1&&Ir.splice(vi,1)}}for(var ni=0,sa=Ir.length;ni<sa;ni++){var Sa=Ir[ni].multiPoly;Je.indexOf(Sa)===-1&&Je.push(Sa)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var ue=this.beforeState().multiPolys,we=this.afterState().multiPolys;switch(li.type){case"union":{var Z=ue.length===0,Je=we.length===0;this._isInResult=Z!==Je;break}case"intersection":{var Xt,Dr;ue.length<we.length?(Xt=ue.length,Dr=we.length):(Xt=we.length,Dr=ue.length),this._isInResult=Dr===li.numMultiPolys&&Xt<Dr;break}case"xor":{var tt=Math.abs(ue.length-we.length);this._isInResult=tt%2==1;break}case"difference":{var It=function(Ir){return Ir.length===1&&Ir[0].isSubject};this._isInResult=It(ue)!==It(we);break}default:throw new Error("Unrecognized operation type found ".concat(li.type))}return this._isInResult}}],[{key:"fromRing",value:function(ue,we,Z){var Je,Xt,Dr,tt=ht.comparePoints(ue,we);if(tt<0)Je=ue,Xt=we,Dr=1;else if(tt>0)Je=we,Xt=ue,Dr=-1;else throw new Error("Tried to create degenerate segment at [".concat(ue.x,", ").concat(ue.y,"]"));var It=new ht(Je,!0),mr=new ht(Xt,!1);return new Tt(It,mr,[Z],[Dr])}}]),Tt}(),Or=function(){function Tt(ge,ue,we){if(ne(this,Tt),!Array.isArray(ge)||ge.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=ue,this.isExterior=we,this.segments=[],typeof ge[0][0]!="number"||typeof ge[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var Z=dt.round(ge[0][0],ge[0][1]);this.bbox={ll:{x:Z.x,y:Z.y},ur:{x:Z.x,y:Z.y}};for(var Je=Z,Xt=1,Dr=ge.length;Xt<Dr;Xt++){if(typeof ge[Xt][0]!="number"||typeof ge[Xt][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var tt=dt.round(ge[Xt][0],ge[Xt][1]);tt.x===Je.x&&tt.y===Je.y||(this.segments.push(Jt.fromRing(Je,tt,this)),tt.x<this.bbox.ll.x&&(this.bbox.ll.x=tt.x),tt.y<this.bbox.ll.y&&(this.bbox.ll.y=tt.y),tt.x>this.bbox.ur.x&&(this.bbox.ur.x=tt.x),tt.y>this.bbox.ur.y&&(this.bbox.ur.y=tt.y),Je=tt)}(Z.x!==Je.x||Z.y!==Je.y)&&this.segments.push(Jt.fromRing(Je,Z,this))}return Te(Tt,[{key:"getSweepEvents",value:function(){for(var ue=[],we=0,Z=this.segments.length;we<Z;we++){var Je=this.segments[we];ue.push(Je.leftSE),ue.push(Je.rightSE)}return ue}}]),Tt}(),Tr=function(){function Tt(ge,ue){if(ne(this,Tt),!Array.isArray(ge))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Or(ge[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var we=1,Z=ge.length;we<Z;we++){var Je=new Or(ge[we],this,!1);Je.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=Je.bbox.ll.x),Je.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=Je.bbox.ll.y),Je.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=Je.bbox.ur.x),Je.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=Je.bbox.ur.y),this.interiorRings.push(Je)}this.multiPoly=ue}return Te(Tt,[{key:"getSweepEvents",value:function(){for(var ue=this.exteriorRing.getSweepEvents(),we=0,Z=this.interiorRings.length;we<Z;we++)for(var Je=this.interiorRings[we].getSweepEvents(),Xt=0,Dr=Je.length;Xt<Dr;Xt++)ue.push(Je[Xt]);return ue}}]),Tt}(),Pn=function(){function Tt(ge,ue){if(ne(this,Tt),!Array.isArray(ge))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof ge[0][0][0]=="number"&&(ge=[ge])}catch(Xt){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var we=0,Z=ge.length;we<Z;we++){var Je=new Tr(ge[we],this);Je.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=Je.bbox.ll.x),Je.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=Je.bbox.ll.y),Je.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=Je.bbox.ur.x),Je.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=Je.bbox.ur.y),this.polys.push(Je)}this.isSubject=ue}return Te(Tt,[{key:"getSweepEvents",value:function(){for(var ue=[],we=0,Z=this.polys.length;we<Z;we++)for(var Je=this.polys[we].getSweepEvents(),Xt=0,Dr=Je.length;Xt<Dr;Xt++)ue.push(Je[Xt]);return ue}}]),Tt}(),Nr=function(){Te(Tt,null,[{key:"factory",value:function(ue){for(var we=[],Z=0,Je=ue.length;Z<Je;Z++){var Xt=ue[Z];if(!(!Xt.isInResult()||Xt.ringOut)){for(var Dr=null,tt=Xt.leftSE,It=Xt.rightSE,mr=[tt],Ir=tt.point,$r=[];Dr=tt,tt=It,mr.push(tt),tt.point!==Ir;)for(;;){var tn=tt.getAvailableLinkedEvents();if(tn.length===0){var $n=mr[0].point,Vn=mr[mr.length-1].point;throw new Error("Unable to complete output ring starting at [".concat($n.x,",")+" ".concat($n.y,"]. Last matching segment found ends at")+" [".concat(Vn.x,", ").concat(Vn.y,"]."))}if(tn.length===1){It=tn[0].otherSE;break}for(var rn=null,vi=0,ni=$r.length;vi<ni;vi++)if($r[vi].point===tt.point){rn=vi;break}if(rn!==null){var sa=$r.splice(rn)[0],Sa=mr.splice(sa.index);Sa.unshift(Sa[0].otherSE),we.push(new Tt(Sa.reverse()));continue}$r.push({index:mr.length,point:tt.point});var Na=tt.getLeftmostComparator(Dr);It=tn.sort(Na)[0].otherSE;break}we.push(new Tt(mr))}}return we}}]);function Tt(ge){ne(this,Tt),this.events=ge;for(var ue=0,we=ge.length;ue<we;ue++)ge[ue].segment.ringOut=this;this.poly=null}return Te(Tt,[{key:"getGeom",value:function(){for(var ue=this.events[0].point,we=[ue],Z=1,Je=this.events.length-1;Z<Je;Z++){var Xt=this.events[Z].point,Dr=this.events[Z+1].point;re(Xt,ue,Dr)!==0&&(we.push(Xt),ue=Xt)}if(we.length===1)return null;var tt=we[0],It=we[1];re(tt,ue,It)===0&&we.shift(),we.push(we[0]);for(var mr=this.isExteriorRing()?1:-1,Ir=this.isExteriorRing()?0:we.length-1,$r=this.isExteriorRing()?we.length:-1,tn=[],$n=Ir;$n!=$r;$n+=mr)tn.push([we[$n].x,we[$n].y]);return tn}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var ue=this.enclosingRing();this._isExteriorRing=ue?!ue.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var ue=this.events[0],we=1,Z=this.events.length;we<Z;we++){var Je=this.events[we];ht.compare(ue,Je)>0&&(ue=Je)}for(var Xt=ue.segment.prevInResult(),Dr=Xt?Xt.prevInResult():null;;){if(!Xt)return null;if(!Dr)return Xt.ringOut;if(Dr.ringOut!==Xt.ringOut)return Dr.ringOut.enclosingRing()!==Xt.ringOut?Xt.ringOut:Xt.ringOut.enclosingRing();Xt=Dr.prevInResult(),Dr=Xt?Xt.prevInResult():null}}}]),Tt}(),wn=function(){function Tt(ge){ne(this,Tt),this.exteriorRing=ge,ge.poly=this,this.interiorRings=[]}return Te(Tt,[{key:"addInterior",value:function(ue){this.interiorRings.push(ue),ue.poly=this}},{key:"getGeom",value:function(){var ue=[this.exteriorRing.getGeom()];if(ue[0]===null)return null;for(var we=0,Z=this.interiorRings.length;we<Z;we++){var Je=this.interiorRings[we].getGeom();Je!==null&&ue.push(Je)}return ue}}]),Tt}(),Xi=function(){function Tt(ge){ne(this,Tt),this.rings=ge,this.polys=this._composePolys(ge)}return Te(Tt,[{key:"getGeom",value:function(){for(var ue=[],we=0,Z=this.polys.length;we<Z;we++){var Je=this.polys[we].getGeom();Je!==null&&ue.push(Je)}return ue}},{key:"_composePolys",value:function(ue){for(var we=[],Z=0,Je=ue.length;Z<Je;Z++){var Xt=ue[Z];if(!Xt.poly)if(Xt.isExteriorRing())we.push(new wn(Xt));else{var Dr=Xt.enclosingRing();Dr.poly||we.push(new wn(Dr)),Dr.poly.addInterior(Xt)}}return we}}]),Tt}(),mi=function(){function Tt(ge){var ue=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Jt.compare;ne(this,Tt),this.queue=ge,this.tree=new bt(ue),this.segments=[]}return Te(Tt,[{key:"process",value:function(ue){var we=ue.segment,Z=[];if(ue.consumedBy)return ue.isLeft?this.queue.remove(ue.otherSE):this.tree.remove(we),Z;var Je=ue.isLeft?this.tree.insert(we):this.tree.find(we);if(!Je)throw new Error("Unable to find segment #".concat(we.id," ")+"[".concat(we.leftSE.point.x,", ").concat(we.leftSE.point.y,"] -> ")+"[".concat(we.rightSE.point.x,", ").concat(we.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var Xt=Je,Dr=Je,tt=void 0,It=void 0;tt===void 0;)Xt=this.tree.prev(Xt),Xt===null?tt=null:Xt.key.consumedBy===void 0&&(tt=Xt.key);for(;It===void 0;)Dr=this.tree.next(Dr),Dr===null?It=null:Dr.key.consumedBy===void 0&&(It=Dr.key);if(ue.isLeft){var mr=null;if(tt){var Ir=tt.getIntersection(we);if(Ir!==null&&(we.isAnEndpoint(Ir)||(mr=Ir),!tt.isAnEndpoint(Ir)))for(var $r=this._splitSafely(tt,Ir),tn=0,$n=$r.length;tn<$n;tn++)Z.push($r[tn])}var Vn=null;if(It){var rn=It.getIntersection(we);if(rn!==null&&(we.isAnEndpoint(rn)||(Vn=rn),!It.isAnEndpoint(rn)))for(var vi=this._splitSafely(It,rn),ni=0,sa=vi.length;ni<sa;ni++)Z.push(vi[ni])}if(mr!==null||Vn!==null){var Sa=null;if(mr===null)Sa=Vn;else if(Vn===null)Sa=mr;else{var Na=ht.comparePoints(mr,Vn);Sa=Na<=0?mr:Vn}this.queue.remove(we.rightSE),Z.push(we.rightSE);for(var ga=we.split(Sa),ta=0,Q=ga.length;ta<Q;ta++)Z.push(ga[ta])}Z.length>0?(this.tree.remove(we),Z.push(ue)):(this.segments.push(we),we.prev=tt)}else{if(tt&&It){var ae=tt.getIntersection(It);if(ae!==null){if(!tt.isAnEndpoint(ae))for(var me=this._splitSafely(tt,ae),Me=0,Ve=me.length;Me<Ve;Me++)Z.push(me[Me]);if(!It.isAnEndpoint(ae))for(var at=this._splitSafely(It,ae),_t=0,Ce=at.length;_t<Ce;_t++)Z.push(at[_t])}}this.tree.remove(we)}return Z}},{key:"_splitSafely",value:function(ue,we){this.tree.remove(ue);var Z=ue.rightSE;this.queue.remove(Z);var Je=ue.split(we);return Je.push(Z),ue.consumedBy===void 0&&this.tree.insert(ue),Je}}]),Tt}(),si=typeof Ee!="undefined"&&{NODE_ENV:"production"}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,ki=typeof Ee!="undefined"&&{NODE_ENV:"production"}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,bi=function(){function Tt(){ne(this,Tt)}return Te(Tt,[{key:"run",value:function(ue,we,Z){li.type=ue,dt.reset();for(var Je=[new Pn(we,!0)],Xt=0,Dr=Z.length;Xt<Dr;Xt++)Je.push(new Pn(Z[Xt],!1));if(li.numMultiPolys=Je.length,li.type==="difference")for(var tt=Je[0],It=1;It<Je.length;)ar(Je[It].bbox,tt.bbox)!==null?It++:Je.splice(It,1);if(li.type==="intersection"){for(var mr=0,Ir=Je.length;mr<Ir;mr++)for(var $r=Je[mr],tn=mr+1,$n=Je.length;tn<$n;tn++)if(ar($r.bbox,Je[tn].bbox)===null)return[]}for(var Vn=new bt(ht.compare),rn=0,vi=Je.length;rn<vi;rn++)for(var ni=Je[rn].getSweepEvents(),sa=0,Sa=ni.length;sa<Sa;sa++)if(Vn.insert(ni[sa]),Vn.size>si)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var Na=new mi(Vn),ga=Vn.size,ta=Vn.pop();ta;){var Q=ta.key;if(Vn.size===ga){var ae=Q.segment;throw new Error("Unable to pop() ".concat(Q.isLeft?"left":"right"," SweepEvent ")+"[".concat(Q.point.x,", ").concat(Q.point.y,"] from segment #").concat(ae.id," ")+"[".concat(ae.leftSE.point.x,", ").concat(ae.leftSE.point.y,"] -> ")+"[".concat(ae.rightSE.point.x,", ").concat(ae.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(Vn.size>si)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(Na.segments.length>ki)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var me=Na.process(Q),Me=0,Ve=me.length;Me<Ve;Me++){var at=me[Me];at.consumedBy===void 0&&Vn.insert(at)}ga=Vn.size,ta=Vn.pop()}dt.reset();var _t=Nr.factory(Na.segments),Ce=new Xi(_t);return Ce.getGeom()}}]),Tt}(),li=new bi,Zn=function(ge){for(var ue=arguments.length,we=new Array(ue>1?ue-1:0),Z=1;Z<ue;Z++)we[Z-1]=arguments[Z];return li.run("union",ge,we)},qn=function(ge){for(var ue=arguments.length,we=new Array(ue>1?ue-1:0),Z=1;Z<ue;Z++)we[Z-1]=arguments[Z];return li.run("intersection",ge,we)},ro=function(ge){for(var ue=arguments.length,we=new Array(ue>1?ue-1:0),Z=1;Z<ue;Z++)we[Z-1]=arguments[Z];return li.run("xor",ge,we)},ka=function(ge){for(var ue=arguments.length,we=new Array(ue>1?ue-1:0),Z=1;Z<ue;Z++)we[Z-1]=arguments[Z];return li.run("difference",ge,we)},oa={union:Zn,intersection:qn,xor:ro,difference:ka};return oa})},28660:function(Br,pe,K){var Ee=K(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var ne;(function(y){(function(Te){var W=typeof K.g=="object"?K.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),ye=se(y);typeof W.Reflect=="undefined"?W.Reflect=y:ye=se(W.Reflect,ye),Te(ye);function se(Ye,_e){return function(Qe,lt){typeof Ye[Qe]!="function"&&Object.defineProperty(Ye,Qe,{configurable:!0,writable:!0,value:lt}),_e&&_e(Qe,lt)}}})(function(Te){var W=Object.prototype.hasOwnProperty,ye=typeof Symbol=="function",se=ye&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",Ye=ye&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",_e=typeof Object.create=="function",Qe={__proto__:[]}instanceof Array,lt=!_e&&!Qe,bt={create:_e?function(){return Dr(Object.create(null))}:Qe?function(){return Dr({__proto__:null})}:function(){return Dr({})},has:lt?function(tt,It){return W.call(tt,It)}:function(tt,It){return It in tt},get:lt?function(tt,It){return W.call(tt,It)?tt[It]:void 0}:function(tt,It){return tt[It]}},gt=Object.getPrototypeOf(Function),ur=typeof Ee=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",Mt=!ur&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Z(),qt=!ur&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Je(),zt=!ur&&typeof WeakMap=="function"?WeakMap:Xt(),yt=new zt;function At(tt,It,mr,Ir){if(Tr(mr)){if(!li(tt))throw new TypeError;if(!qn(It))throw new TypeError;return re(tt,It)}else{if(!li(tt))throw new TypeError;if(!wn(It))throw new TypeError;if(!wn(Ir)&&!Tr(Ir)&&!Pn(Ir))throw new TypeError;return Pn(Ir)&&(Ir=void 0),mr=bi(mr),Fe(tt,It,mr,Ir)}}Te("decorate",At);function ar(tt,It){function mr(Ir,$r){if(!wn(Ir))throw new TypeError;if(!Tr($r)&&!ro($r))throw new TypeError;ht(tt,It,Ir,$r)}return mr}Te("metadata",ar);function J(tt,It,mr,Ir){if(!wn(mr))throw new TypeError;return Tr(Ir)||(Ir=bi(Ir)),ht(tt,It,mr,Ir)}Te("defineMetadata",J);function Qt(tt,It,mr){if(!wn(It))throw new TypeError;return Tr(mr)||(mr=bi(mr)),z(tt,It,mr)}Te("hasMetadata",Qt);function Ct(tt,It,mr){if(!wn(It))throw new TypeError;return Tr(mr)||(mr=bi(mr)),ce(tt,It,mr)}Te("hasOwnMetadata",Ct);function ft(tt,It,mr){if(!wn(It))throw new TypeError;return Tr(mr)||(mr=bi(mr)),ze(tt,It,mr)}Te("getMetadata",ft);function Ut(tt,It,mr){if(!wn(It))throw new TypeError;return Tr(mr)||(mr=bi(mr)),et(tt,It,mr)}Te("getOwnMetadata",Ut);function dt(tt,It){if(!wn(tt))throw new TypeError;return Tr(It)||(It=bi(It)),Rt(tt,It)}Te("getMetadataKeys",dt);function rr(tt,It){if(!wn(tt))throw new TypeError;return Tr(It)||(It=bi(It)),Jt(tt,It)}Te("getOwnMetadataKeys",rr);function wr(tt,It,mr){if(!wn(It))throw new TypeError;Tr(mr)||(mr=bi(mr));var Ir=N(It,mr,!1);if(Tr(Ir)||!Ir.delete(tt))return!1;if(Ir.size>0)return!0;var $r=yt.get(It);return $r.delete(mr),$r.size>0||yt.delete(It),!0}Te("deleteMetadata",wr);function re(tt,It){for(var mr=tt.length-1;mr>=0;--mr){var Ir=tt[mr],$r=Ir(It);if(!Tr($r)&&!Pn($r)){if(!qn($r))throw new TypeError;It=$r}}return It}function Fe(tt,It,mr,Ir){for(var $r=tt.length-1;$r>=0;--$r){var tn=tt[$r],$n=tn(It,mr,Ir);if(!Tr($n)&&!Pn($n)){if(!wn($n))throw new TypeError;Ir=$n}}return Ir}function N(tt,It,mr){var Ir=yt.get(tt);if(Tr(Ir)){if(!mr)return;Ir=new Mt,yt.set(tt,Ir)}var $r=Ir.get(It);if(Tr($r)){if(!mr)return;$r=new Mt,Ir.set(It,$r)}return $r}function z(tt,It,mr){var Ir=ce(tt,It,mr);if(Ir)return!0;var $r=we(It);return Pn($r)?!1:z(tt,$r,mr)}function ce(tt,It,mr){var Ir=N(It,mr,!1);return Tr(Ir)?!1:si(Ir.has(tt))}function ze(tt,It,mr){var Ir=ce(tt,It,mr);if(Ir)return et(tt,It,mr);var $r=we(It);if(!Pn($r))return ze(tt,$r,mr)}function et(tt,It,mr){var Ir=N(It,mr,!1);if(!Tr(Ir))return Ir.get(tt)}function ht(tt,It,mr,Ir){var $r=N(mr,Ir,!0);$r.set(tt,It)}function Rt(tt,It){var mr=Jt(tt,It),Ir=we(tt);if(Ir===null)return mr;var $r=Rt(Ir,It);if($r.length<=0)return mr;if(mr.length<=0)return $r;for(var tn=new qt,$n=[],Vn=0,rn=mr;Vn<rn.length;Vn++){var vi=rn[Vn],ni=tn.has(vi);ni||(tn.add(vi),$n.push(vi))}for(var sa=0,Sa=$r;sa<Sa.length;sa++){var vi=Sa[sa],ni=tn.has(vi);ni||(tn.add(vi),$n.push(vi))}return $n}function Jt(tt,It){var mr=[],Ir=N(tt,It,!1);if(Tr(Ir))return mr;for(var $r=Ir.keys(),tn=oa($r),$n=0;;){var Vn=ge(tn);if(!Vn)return mr.length=$n,mr;var rn=Tt(Vn);try{mr[$n]=rn}catch(vi){try{ue(tn)}finally{throw vi}}$n++}}function Or(tt){if(tt===null)return 1;switch(typeof tt){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return tt===null?1:6;default:return 6}}function Tr(tt){return tt===void 0}function Pn(tt){return tt===null}function Nr(tt){return typeof tt=="symbol"}function wn(tt){return typeof tt=="object"?tt!==null:typeof tt=="function"}function Xi(tt,It){switch(Or(tt)){case 0:return tt;case 1:return tt;case 2:return tt;case 3:return tt;case 4:return tt;case 5:return tt}var mr=It===3?"string":It===5?"number":"default",Ir=ka(tt,se);if(Ir!==void 0){var $r=Ir.call(tt,mr);if(wn($r))throw new TypeError;return $r}return mi(tt,mr==="default"?"number":mr)}function mi(tt,It){if(It==="string"){var mr=tt.toString;if(Zn(mr)){var Ir=mr.call(tt);if(!wn(Ir))return Ir}var $r=tt.valueOf;if(Zn($r)){var Ir=$r.call(tt);if(!wn(Ir))return Ir}}else{var $r=tt.valueOf;if(Zn($r)){var Ir=$r.call(tt);if(!wn(Ir))return Ir}var tn=tt.toString;if(Zn(tn)){var Ir=tn.call(tt);if(!wn(Ir))return Ir}}throw new TypeError}function si(tt){return!!tt}function ki(tt){return""+tt}function bi(tt){var It=Xi(tt,3);return Nr(It)?It:ki(It)}function li(tt){return Array.isArray?Array.isArray(tt):tt instanceof Object?tt instanceof Array:Object.prototype.toString.call(tt)==="[object Array]"}function Zn(tt){return typeof tt=="function"}function qn(tt){return typeof tt=="function"}function ro(tt){switch(Or(tt)){case 3:return!0;case 4:return!0;default:return!1}}function ka(tt,It){var mr=tt[It];if(mr!=null){if(!Zn(mr))throw new TypeError;return mr}}function oa(tt){var It=ka(tt,Ye);if(!Zn(It))throw new TypeError;var mr=It.call(tt);if(!wn(mr))throw new TypeError;return mr}function Tt(tt){return tt.value}function ge(tt){var It=tt.next();return It.done?!1:It}function ue(tt){var It=tt.return;It&&It.call(tt)}function we(tt){var It=Object.getPrototypeOf(tt);if(typeof tt!="function"||tt===gt||It!==gt)return It;var mr=tt.prototype,Ir=mr&&Object.getPrototypeOf(mr);if(Ir==null||Ir===Object.prototype)return It;var $r=Ir.constructor;return typeof $r!="function"||$r===tt?It:$r}function Z(){var tt={},It=[],mr=function(){function $n(Vn,rn,vi){this._index=0,this._keys=Vn,this._values=rn,this._selector=vi}return $n.prototype["@@iterator"]=function(){return this},$n.prototype[Ye]=function(){return this},$n.prototype.next=function(){var Vn=this._index;if(Vn>=0&&Vn<this._keys.length){var rn=this._selector(this._keys[Vn],this._values[Vn]);return Vn+1>=this._keys.length?(this._index=-1,this._keys=It,this._values=It):this._index++,{value:rn,done:!1}}return{value:void 0,done:!0}},$n.prototype.throw=function(Vn){throw this._index>=0&&(this._index=-1,this._keys=It,this._values=It),Vn},$n.prototype.return=function(Vn){return this._index>=0&&(this._index=-1,this._keys=It,this._values=It),{value:Vn,done:!0}},$n}();return function(){function $n(){this._keys=[],this._values=[],this._cacheKey=tt,this._cacheIndex=-2}return Object.defineProperty($n.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),$n.prototype.has=function(Vn){return this._find(Vn,!1)>=0},$n.prototype.get=function(Vn){var rn=this._find(Vn,!1);return rn>=0?this._values[rn]:void 0},$n.prototype.set=function(Vn,rn){var vi=this._find(Vn,!0);return this._values[vi]=rn,this},$n.prototype.delete=function(Vn){var rn=this._find(Vn,!1);if(rn>=0){for(var vi=this._keys.length,ni=rn+1;ni<vi;ni++)this._keys[ni-1]=this._keys[ni],this._values[ni-1]=this._values[ni];return this._keys.length--,this._values.length--,Vn===this._cacheKey&&(this._cacheKey=tt,this._cacheIndex=-2),!0}return!1},$n.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=tt,this._cacheIndex=-2},$n.prototype.keys=function(){return new mr(this._keys,this._values,Ir)},$n.prototype.values=function(){return new mr(this._keys,this._values,$r)},$n.prototype.entries=function(){return new mr(this._keys,this._values,tn)},$n.prototype["@@iterator"]=function(){return this.entries()},$n.prototype[Ye]=function(){return this.entries()},$n.prototype._find=function(Vn,rn){return this._cacheKey!==Vn&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=Vn)),this._cacheIndex<0&&rn&&(this._cacheIndex=this._keys.length,this._keys.push(Vn),this._values.push(void 0)),this._cacheIndex},$n}();function Ir($n,Vn){return $n}function $r($n,Vn){return Vn}function tn($n,Vn){return[$n,Vn]}}function Je(){return function(){function tt(){this._map=new Mt}return Object.defineProperty(tt.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),tt.prototype.has=function(It){return this._map.has(It)},tt.prototype.add=function(It){return this._map.set(It,It),this},tt.prototype.delete=function(It){return this._map.delete(It)},tt.prototype.clear=function(){this._map.clear()},tt.prototype.keys=function(){return this._map.keys()},tt.prototype.values=function(){return this._map.values()},tt.prototype.entries=function(){return this._map.entries()},tt.prototype["@@iterator"]=function(){return this.keys()},tt.prototype[Ye]=function(){return this.keys()},tt}()}function Xt(){var tt=16,It=bt.create(),mr=Ir();return function(){function rn(){this._key=Ir()}return rn.prototype.has=function(vi){var ni=$r(vi,!1);return ni!==void 0?bt.has(ni,this._key):!1},rn.prototype.get=function(vi){var ni=$r(vi,!1);return ni!==void 0?bt.get(ni,this._key):void 0},rn.prototype.set=function(vi,ni){var sa=$r(vi,!0);return sa[this._key]=ni,this},rn.prototype.delete=function(vi){var ni=$r(vi,!1);return ni!==void 0?delete ni[this._key]:!1},rn.prototype.clear=function(){this._key=Ir()},rn}();function Ir(){var rn;do rn="@@WeakMap@@"+Vn();while(bt.has(It,rn));return It[rn]=!0,rn}function $r(rn,vi){if(!W.call(rn,mr)){if(!vi)return;Object.defineProperty(rn,mr,{value:bt.create()})}return rn[mr]}function tn(rn,vi){for(var ni=0;ni<vi;++ni)rn[ni]=Math.random()*255|0;return rn}function $n(rn){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(rn)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(rn)):tn(new Uint8Array(rn),rn):tn(new Array(rn),rn)}function Vn(){var rn=$n(tt);rn[6]=rn[6]&79|64,rn[8]=rn[8]&191|128;for(var vi="",ni=0;ni<tt;++ni){var sa=rn[ni];(ni===4||ni===6||ni===8)&&(vi+="-"),sa<16&&(vi+="0"),vi+=sa.toString(16).toLowerCase()}return vi}}function Dr(tt){return tt.__=void 0,delete tt.__,tt}})})(ne||(ne={}))},69848:function(Br){(function(pe,K){Br.exports=K()})(this,function(){"use strict";function pe(Ct,ft,Ut,dt,rr,wr){if(!(rr-dt<=Ut)){var re=dt+rr>>1;K(Ct,ft,re,dt,rr,wr%2),pe(Ct,ft,Ut,dt,re-1,wr+1),pe(Ct,ft,Ut,re+1,rr,wr+1)}}function K(Ct,ft,Ut,dt,rr,wr){for(;rr>dt;){if(rr-dt>600){var re=rr-dt+1,Fe=Ut-dt+1,N=Math.log(re),z=.5*Math.exp(2*N/3),ce=.5*Math.sqrt(N*z*(re-z)/re)*(Fe-re/2<0?-1:1),ze=Math.max(dt,Math.floor(Ut-Fe*z/re+ce)),et=Math.min(rr,Math.floor(Ut+(re-Fe)*z/re+ce));K(Ct,ft,Ut,ze,et,wr)}var ht=ft[2*Ut+wr],Rt=dt,Jt=rr;for(Ee(Ct,ft,dt,Ut),ft[2*rr+wr]>ht&&Ee(Ct,ft,dt,rr);Rt<Jt;){for(Ee(Ct,ft,Rt,Jt),Rt++,Jt--;ft[2*Rt+wr]<ht;)Rt++;for(;ft[2*Jt+wr]>ht;)Jt--}ft[2*dt+wr]===ht?Ee(Ct,ft,dt,Jt):(Jt++,Ee(Ct,ft,Jt,rr)),Jt<=Ut&&(dt=Jt+1),Ut<=Jt&&(rr=Jt-1)}}function Ee(Ct,ft,Ut,dt){ne(Ct,Ut,dt),ne(ft,2*Ut,2*dt),ne(ft,2*Ut+1,2*dt+1)}function ne(Ct,ft,Ut){var dt=Ct[ft];Ct[ft]=Ct[Ut],Ct[Ut]=dt}function y(Ct,ft,Ut,dt,rr,wr,re){for(var Fe=[0,Ct.length-1,0],N=[],z,ce;Fe.length;){var ze=Fe.pop(),et=Fe.pop(),ht=Fe.pop();if(et-ht<=re){for(var Rt=ht;Rt<=et;Rt++)z=ft[2*Rt],ce=ft[2*Rt+1],z>=Ut&&z<=rr&&ce>=dt&&ce<=wr&&N.push(Ct[Rt]);continue}var Jt=Math.floor((ht+et)/2);z=ft[2*Jt],ce=ft[2*Jt+1],z>=Ut&&z<=rr&&ce>=dt&&ce<=wr&&N.push(Ct[Jt]);var Or=(ze+1)%2;(ze===0?Ut<=z:dt<=ce)&&(Fe.push(ht),Fe.push(Jt-1),Fe.push(Or)),(ze===0?rr>=z:wr>=ce)&&(Fe.push(Jt+1),Fe.push(et),Fe.push(Or))}return N}function Te(Ct,ft,Ut,dt,rr,wr){for(var re=[0,Ct.length-1,0],Fe=[],N=rr*rr;re.length;){var z=re.pop(),ce=re.pop(),ze=re.pop();if(ce-ze<=wr){for(var et=ze;et<=ce;et++)W(ft[2*et],ft[2*et+1],Ut,dt)<=N&&Fe.push(Ct[et]);continue}var ht=Math.floor((ze+ce)/2),Rt=ft[2*ht],Jt=ft[2*ht+1];W(Rt,Jt,Ut,dt)<=N&&Fe.push(Ct[ht]);var Or=(z+1)%2;(z===0?Ut-rr<=Rt:dt-rr<=Jt)&&(re.push(ze),re.push(ht-1),re.push(Or)),(z===0?Ut+rr>=Rt:dt+rr>=Jt)&&(re.push(ht+1),re.push(ce),re.push(Or))}return Fe}function W(Ct,ft,Ut,dt){var rr=Ct-Ut,wr=ft-dt;return rr*rr+wr*wr}var ye=function(Ct){return Ct[0]},se=function(Ct){return Ct[1]},Ye=function(ft,Ut,dt,rr,wr){Ut===void 0&&(Ut=ye),dt===void 0&&(dt=se),rr===void 0&&(rr=64),wr===void 0&&(wr=Float64Array),this.nodeSize=rr,this.points=ft;for(var re=ft.length<65536?Uint16Array:Uint32Array,Fe=this.ids=new re(ft.length),N=this.coords=new wr(ft.length*2),z=0;z<ft.length;z++)Fe[z]=z,N[2*z]=Ut(ft[z]),N[2*z+1]=dt(ft[z]);pe(Fe,N,rr,0,Fe.length-1,0)};Ye.prototype.range=function(ft,Ut,dt,rr){return y(this.ids,this.coords,ft,Ut,dt,rr,this.nodeSize)},Ye.prototype.within=function(ft,Ut,dt){return Te(this.ids,this.coords,ft,Ut,dt,this.nodeSize)};var _e={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(Ct){return Ct}},Qe=Math.fround||function(Ct){return function(ft){return Ct[0]=+ft,Ct[0]}}(new Float32Array(1)),lt=function(ft){this.options=ar(Object.create(_e),ft),this.trees=new Array(this.options.maxZoom+1)};lt.prototype.load=function(ft){var Ut=this.options,dt=Ut.log,rr=Ut.minZoom,wr=Ut.maxZoom,re=Ut.nodeSize;dt&&console.time("total time");var Fe="prepare "+ft.length+" points";dt&&console.time(Fe),this.points=ft;for(var N=[],z=0;z<ft.length;z++)!ft[z].geometry||N.push(gt(ft[z],z));this.trees[wr+1]=new Ye(N,J,Qt,re,Float32Array),dt&&console.timeEnd(Fe);for(var ce=wr;ce>=rr;ce--){var ze=+Date.now();N=this._cluster(N,ce),this.trees[ce]=new Ye(N,J,Qt,re,Float32Array),dt&&console.log("z%d: %d clusters in %dms",ce,N.length,+Date.now()-ze)}return dt&&console.timeEnd("total time"),this},lt.prototype.getClusters=function(ft,Ut){var dt=((ft[0]+180)%360+360)%360-180,rr=Math.max(-90,Math.min(90,ft[1])),wr=ft[2]===180?180:((ft[2]+180)%360+360)%360-180,re=Math.max(-90,Math.min(90,ft[3]));if(ft[2]-ft[0]>=360)dt=-180,wr=180;else if(dt>wr){var Fe=this.getClusters([dt,rr,180,re],Ut),N=this.getClusters([-180,rr,wr,re],Ut);return Fe.concat(N)}for(var z=this.trees[this._limitZoom(Ut)],ce=z.range(qt(dt),zt(re),qt(wr),zt(rr)),ze=[],et=0,ht=ce;et<ht.length;et+=1){var Rt=ht[et],Jt=z.points[Rt];ze.push(Jt.numPoints?ur(Jt):this.points[Jt.index])}return ze},lt.prototype.getChildren=function(ft){var Ut=this._getOriginId(ft),dt=this._getOriginZoom(ft),rr="No cluster with the specified id.",wr=this.trees[dt];if(!wr)throw new Error(rr);var re=wr.points[Ut];if(!re)throw new Error(rr);for(var Fe=this.options.radius/(this.options.extent*Math.pow(2,dt-1)),N=wr.within(re.x,re.y,Fe),z=[],ce=0,ze=N;ce<ze.length;ce+=1){var et=ze[ce],ht=wr.points[et];ht.parentId===ft&&z.push(ht.numPoints?ur(ht):this.points[ht.index])}if(z.length===0)throw new Error(rr);return z},lt.prototype.getLeaves=function(ft,Ut,dt){Ut=Ut||10,dt=dt||0;var rr=[];return this._appendLeaves(rr,ft,Ut,dt,0),rr},lt.prototype.getTile=function(ft,Ut,dt){var rr=this.trees[this._limitZoom(ft)],wr=Math.pow(2,ft),re=this.options,Fe=re.extent,N=re.radius,z=N/Fe,ce=(dt-z)/wr,ze=(dt+1+z)/wr,et={features:[]};return this._addTileFeatures(rr.range((Ut-z)/wr,ce,(Ut+1+z)/wr,ze),rr.points,Ut,dt,wr,et),Ut===0&&this._addTileFeatures(rr.range(1-z/wr,ce,1,ze),rr.points,wr,dt,wr,et),Ut===wr-1&&this._addTileFeatures(rr.range(0,ce,z/wr,ze),rr.points,-1,dt,wr,et),et.features.length?et:null},lt.prototype.getClusterExpansionZoom=function(ft){for(var Ut=this._getOriginZoom(ft)-1;Ut<=this.options.maxZoom;){var dt=this.getChildren(ft);if(Ut++,dt.length!==1)break;ft=dt[0].properties.cluster_id}return Ut},lt.prototype._appendLeaves=function(ft,Ut,dt,rr,wr){for(var re=this.getChildren(Ut),Fe=0,N=re;Fe<N.length;Fe+=1){var z=N[Fe],ce=z.properties;if(ce&&ce.cluster?wr+ce.point_count<=rr?wr+=ce.point_count:wr=this._appendLeaves(ft,ce.cluster_id,dt,rr,wr):wr<rr?wr++:ft.push(z),ft.length===dt)break}return wr},lt.prototype._addTileFeatures=function(ft,Ut,dt,rr,wr,re){for(var Fe=0,N=ft;Fe<N.length;Fe+=1){var z=N[Fe],ce=Ut[z],ze=ce.numPoints,et=void 0,ht=void 0,Rt=void 0;if(ze)et=Mt(ce),ht=ce.x,Rt=ce.y;else{var Jt=this.points[ce.index];et=Jt.properties,ht=qt(Jt.geometry.coordinates[0]),Rt=zt(Jt.geometry.coordinates[1])}var Or={type:1,geometry:[[Math.round(this.options.extent*(ht*wr-dt)),Math.round(this.options.extent*(Rt*wr-rr))]],tags:et},Tr=void 0;ze?Tr=ce.id:this.options.generateId?Tr=ce.index:this.points[ce.index].id&&(Tr=this.points[ce.index].id),Tr!==void 0&&(Or.id=Tr),re.features.push(Or)}},lt.prototype._limitZoom=function(ft){return Math.max(this.options.minZoom,Math.min(Math.floor(+ft),this.options.maxZoom+1))},lt.prototype._cluster=function(ft,Ut){for(var dt=[],rr=this.options,wr=rr.radius,re=rr.extent,Fe=rr.reduce,N=rr.minPoints,z=wr/(re*Math.pow(2,Ut)),ce=0;ce<ft.length;ce++){var ze=ft[ce];if(!(ze.zoom<=Ut)){ze.zoom=Ut;for(var et=this.trees[Ut+1],ht=et.within(ze.x,ze.y,z),Rt=ze.numPoints||1,Jt=Rt,Or=0,Tr=ht;Or<Tr.length;Or+=1){var Pn=Tr[Or],Nr=et.points[Pn];Nr.zoom>Ut&&(Jt+=Nr.numPoints||1)}if(Jt>Rt&&Jt>=N){for(var wn=ze.x*Rt,Xi=ze.y*Rt,mi=Fe&&Rt>1?this._map(ze,!0):null,si=(ce<<5)+(Ut+1)+this.points.length,ki=0,bi=ht;ki<bi.length;ki+=1){var li=bi[ki],Zn=et.points[li];if(!(Zn.zoom<=Ut)){Zn.zoom=Ut;var qn=Zn.numPoints||1;wn+=Zn.x*qn,Xi+=Zn.y*qn,Zn.parentId=si,Fe&&(mi||(mi=this._map(ze,!0)),Fe(mi,this._map(Zn)))}}ze.parentId=si,dt.push(bt(wn/Jt,Xi/Jt,si,Jt,mi))}else if(dt.push(ze),Jt>1)for(var ro=0,ka=ht;ro<ka.length;ro+=1){var oa=ka[ro],Tt=et.points[oa];Tt.zoom<=Ut||(Tt.zoom=Ut,dt.push(Tt))}}}return dt},lt.prototype._getOriginId=function(ft){return ft-this.points.length>>5},lt.prototype._getOriginZoom=function(ft){return(ft-this.points.length)%32},lt.prototype._map=function(ft,Ut){if(ft.numPoints)return Ut?ar({},ft.properties):ft.properties;var dt=this.points[ft.index].properties,rr=this.options.map(dt);return Ut&&rr===dt?ar({},rr):rr};function bt(Ct,ft,Ut,dt,rr){return{x:Qe(Ct),y:Qe(ft),zoom:Infinity,id:Ut,parentId:-1,numPoints:dt,properties:rr}}function gt(Ct,ft){var Ut=Ct.geometry.coordinates,dt=Ut[0],rr=Ut[1];return{x:Qe(qt(dt)),y:Qe(zt(rr)),zoom:Infinity,index:ft,parentId:-1}}function ur(Ct){return{type:"Feature",id:Ct.id,properties:Mt(Ct),geometry:{type:"Point",coordinates:[yt(Ct.x),At(Ct.y)]}}}function Mt(Ct){var ft=Ct.numPoints,Ut=ft>=1e4?Math.round(ft/1e3)+"k":ft>=1e3?Math.round(ft/100)/10+"k":ft;return ar(ar({},Ct.properties),{cluster:!0,cluster_id:Ct.id,point_count:ft,point_count_abbreviated:Ut})}function qt(Ct){return Ct/360+.5}function zt(Ct){var ft=Math.sin(Ct*Math.PI/180),Ut=.5-.25*Math.log((1+ft)/(1-ft))/Math.PI;return Ut<0?0:Ut>1?1:Ut}function yt(Ct){return(Ct-.5)*360}function At(Ct){var ft=(180-Ct*360)*Math.PI/180;return 360*Math.atan(Math.exp(ft))/Math.PI-90}function ar(Ct,ft){for(var Ut in ft)Ct[Ut]=ft[Ut];return Ct}function J(Ct){return Ct.x}function Qt(Ct){return Ct.y}return lt})}}]);
