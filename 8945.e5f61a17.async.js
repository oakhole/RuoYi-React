(self.webpackChunkruoyi_react=self.webpackChunkruoyi_react||[]).push([[8945],{65309:function(Er,ne,Q){"use strict";Q.d(ne,{zP:function(){return VP},JE:function(){return eP},ns:function(){return jP}});var Ce={};Q.r(Ce),Q.d(Ce,{add:function(){return $r},adjoint:function(){return Dd},clone:function(){return bc},copy:function(){return Po},create:function(){return qi},determinant:function(){return yp},equals:function(){return Vr},exactEquals:function(){return xn},frob:function(){return Ir},fromQuat:function(){return dr},fromQuat2:function(){return Be},fromRotation:function(){return Ff},fromRotationTranslation:function(){return ce},fromRotationTranslationScale:function(){return Qt},fromRotationTranslationScaleOrigin:function(){return lr},fromScaling:function(){return $l},fromTranslation:function(){return Gh},fromValues:function(){return js},fromXRotation:function(){return _p},fromYRotation:function(){return Fd},fromZRotation:function(){return N},frustum:function(){return xr},getRotation:function(){return Rt},getScaling:function(){return rr},getTranslation:function(){return Dt},identity:function(){return gp},invert:function(){return Vh},lookAt:function(){return br},mul:function(){return Sr},multiply:function(){return Al},multiplyScalar:function(){return Jt},multiplyScalarAndAdd:function(){return tr},ortho:function(){return nt},orthoNO:function(){return Cr},orthoZO:function(){return Vt},perspective:function(){return Tr},perspectiveFromFieldOfView:function(){return gr},perspectiveNO:function(){return wr},perspectiveZO:function(){return jr},rotate:function(){return id},rotateX:function(){return fh},rotateY:function(){return sf},rotateZ:function(){return Ea},scale:function(){return Kl},set:function(){return nd},str:function(){return ur},sub:function(){return qr},subtract:function(){return Bn},targetTo:function(){return Nr},translate:function(){return ch},transpose:function(){return Ld}});var me=Q(67294),g=(0,me.createContext)({});function Re(){return(0,me.useContext)(g)}var W={},he={},de=function(i){return he[i]},ze=function(i,r){he[i]=r},_e=function(i){return W[i]},tt=function(i,r){W[i]=r},mt={},wt={},Nt=34,or=10,Tt=13;function Kt(e){return new Function("d","return {"+e.map(function(i,r){return JSON.stringify(i)+": d["+r+'] || ""'}).join(",")+"}")}function _t(e,i){var r=Kt(e);return function(n,a){return i(r(n),a,e)}}function ct(e){var i=Object.create(null),r=[];return e.forEach(function(n){for(var a in n)a in i||r.push(i[a]=a)}),r}function it(e,i){var r=e+"",n=r.length;return n<i?new Array(i-n+1).join(0)+r:r}function $t(e){return e<0?"-"+it(-e,6):e>9999?"+"+it(e,6):it(e,4)}function Y(e){var i=e.getUTCHours(),r=e.getUTCMinutes(),n=e.getUTCSeconds(),a=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":$t(e.getUTCFullYear(),4)+"-"+it(e.getUTCMonth()+1,2)+"-"+it(e.getUTCDate(),2)+(a?"T"+it(i,2)+":"+it(r,2)+":"+it(n,2)+"."+it(a,3)+"Z":n?"T"+it(i,2)+":"+it(r,2)+":"+it(n,2)+"Z":r||i?"T"+it(i,2)+":"+it(r,2)+"Z":"")}function Xt(e){var i=new RegExp('["'+e+`
\r]`),r=e.charCodeAt(0);function n(T,I){var F,j,X=a(T,function(ee,be){if(F)return F(ee,be-1);j=ee,F=I?_t(ee,I):Kt(ee)});return X.columns=j||[],X}function a(T,I){var F=[],j=T.length,X=0,ee=0,be,Fe=j<=0,We=!1;T.charCodeAt(j-1)===or&&--j,T.charCodeAt(j-1)===Tt&&--j;function et(){if(Fe)return wt;if(We)return We=!1,mt;var Ct,Yt=X,ar;if(T.charCodeAt(Yt)===Nt){for(;X++<j&&T.charCodeAt(X)!==Nt||T.charCodeAt(++X)===Nt;);return(Ct=X)>=j?Fe=!0:(ar=T.charCodeAt(X++))===or?We=!0:ar===Tt&&(We=!0,T.charCodeAt(X)===or&&++X),T.slice(Yt+1,Ct-1).replace(/""/g,'"')}for(;X<j;){if((ar=T.charCodeAt(Ct=X++))===or)We=!0;else if(ar===Tt)We=!0,T.charCodeAt(X)===or&&++X;else if(ar!==r)continue;return T.slice(Yt,Ct)}return Fe=!0,T.slice(Yt,j)}for(;(be=et())!==wt;){for(var xt=[];be!==mt&&be!==wt;)xt.push(be),be=et();I&&(xt=I(xt,ee++))==null||F.push(xt)}return F}function s(T,I){return T.map(function(F){return I.map(function(j){return A(F[j])}).join(e)})}function f(T,I){return I==null&&(I=ct(T)),[I.map(A).join(e)].concat(s(T,I)).join(`
`)}function v(T,I){return I==null&&(I=ct(T)),s(T,I).join(`
`)}function m(T){return T.map(x).join(`
`)}function x(T){return T.map(A).join(e)}function A(T){return T==null?"":T instanceof Date?Y(T):i.test(T+="")?'"'+T.replace(/"/g,'""')+'"':T}return{parse:n,parseRows:a,format:f,formatBody:v,formatRows:m,formatRow:x,formatValue:A}}var at=Xt(","),qe=at.parse,Et=at.parseRows,$e=at.format,Ht=at.formatBody,mr=at.formatRows,Fr=at.formatRow,Yr=at.formatValue,S=Q(96156),Se=Q(85061),ke=Q(38163),ut=Q.n(ke);function ft(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function kt(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ft(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ft(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Ft(e,i){var r=i.x,n=i.y,a=i.x1,s=i.y1,f=i.coordinates,v=[];return Array.isArray(e)?(e.forEach(function(m,x){var A=[];if(r&&n&&(A=[parseFloat(m[r]),parseFloat(m[n])]),r&&n&&a&&s){var T=[parseFloat(m[r]),parseFloat(m[n])],I=[parseFloat(m[a]),parseFloat(m[s])];A=[T,I]}if(f){var F="Polygon";Array.isArray(f[0])||(F="Point"),Array.isArray(f[0])&&!Array.isArray(f[0][0])&&(F="LineString");var j={type:F,coordinates:(0,Se.Z)(m[f])};ut()(j,!0),A=j.coordinates}var X=kt(kt({},m),{},{_id:x,coordinates:A});v.push(X)}),{dataArray:v}):{dataArray:[]}}var yr=[{lng1:100,lat1:30,lng2:130,lat2:30}],Yn={parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}};function Gr(e,i){var r=qe(e);return Ft(r,i)}var Nn=63710088e-1,yn={centimeters:Nn*100,centimetres:Nn*100,degrees:Nn/111325,feet:Nn*3.28084,inches:Nn*39.37,kilometers:Nn/1e3,kilometres:Nn/1e3,meters:Nn,metres:Nn,miles:Nn/1609.344,millimeters:Nn*1e3,millimetres:Nn*1e3,nauticalmiles:Nn/1852,radians:1,yards:Nn*1.0936},zn={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Nn,yards:1.0936133},si={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Gn(e,i,r){r===void 0&&(r={});var n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=i||{},n.geometry=e,n}function fi(e,i,r){switch(r===void 0&&(r={}),e){case"Point":return na(i).geometry;case"LineString":return ia(i).geometry;case"Polygon":return Ii(i).geometry;case"MultiPoint":return Li(i).geometry;case"MultiLineString":return oa(i).geometry;case"MultiPolygon":return Ki(i).geometry;default:throw new Error(e+" is invalid")}}function na(e,i,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Mn(e[0])||!Mn(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return Gn(n,i,r)}function Ui(e,i,r){return r===void 0&&(r={}),aa(e.map(function(n){return na(n,i)}),r)}function Ii(e,i,r){r===void 0&&(r={});for(var n=0,a=e;n<a.length;n++){var s=a[n];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var f=0;f<s[s.length-1].length;f++)if(s[s.length-1][f]!==s[0][f])throw new Error("First and last Position are not equivalent.")}var v={type:"Polygon",coordinates:e};return Gn(v,i,r)}function $i(e,i,r){return r===void 0&&(r={}),aa(e.map(function(n){return Ii(n,i)}),r)}function ia(e,i,r){if(r===void 0&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return Gn(n,i,r)}function qa(e,i,r){return r===void 0&&(r={}),aa(e.map(function(n){return ia(n,i)}),r)}function aa(e,i){i===void 0&&(i={});var r={type:"FeatureCollection"};return i.id&&(r.id=i.id),i.bbox&&(r.bbox=i.bbox),r.features=e,r}function oa(e,i,r){r===void 0&&(r={});var n={type:"MultiLineString",coordinates:e};return Gn(n,i,r)}function Li(e,i,r){r===void 0&&(r={});var n={type:"MultiPoint",coordinates:e};return Gn(n,i,r)}function Ki(e,i,r){r===void 0&&(r={});var n={type:"MultiPolygon",coordinates:e};return Gn(n,i,r)}function Hi(e,i,r){r===void 0&&(r={});var n={type:"GeometryCollection",geometries:e};return Gn(n,i,r)}function Ts(e,i){if(i===void 0&&(i=0),i&&!(i>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,i||0);return Math.round(e*r)/r}function fe(e,i){i===void 0&&(i="kilometers");var r=yn[i];if(!r)throw new Error(i+" units is invalid");return e*r}function ui(e,i){i===void 0&&(i="kilometers");var r=yn[i];if(!r)throw new Error(i+" units is invalid");return e/r}function bo(e,i){return Zt(ui(e,i))}function cu(e){var i=e%360;return i<0&&(i+=360),i}function Zt(e){var i=e%(2*Math.PI);return i*180/Math.PI}function er(e){var i=e%360;return i*Math.PI/180}function Rr(e,i,r){if(i===void 0&&(i="kilometers"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("length must be a positive number");return fe(ui(e,i),r)}function an(e,i,r){if(i===void 0&&(i="meters"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=si[i];if(!n)throw new Error("invalid original units");var a=si[r];if(!a)throw new Error("invalid final units");return e/n*a}function Mn(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Un(e){return!!e&&e.constructor===Object}function bi(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(i){if(!Mn(i))throw new Error("bbox must only contain numbers")})}function vi(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function Sn(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Di(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Ri(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return Ri(e[0]);throw new Error("coordinates must only contain numbers")}function ao(e,i,r){if(!i||!r)throw new Error("type and name required");if(!e||e.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.type)}function gs(e,i,r){if(!e)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!e.geometry||e.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.geometry.type)}function Zo(e,i,r){if(!e)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(var n=0,a=e.features;n<a.length;n++){var s=a[n];if(!s||s.type!=="Feature"||!s.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!s.geometry||s.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+s.geometry.type)}}function Na(e){return e.type==="Feature"?e.geometry:e}function ba(e,i){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function V(e,i,r){if(e!==null)for(var n,a,s,f,v,m,x,A=0,T=0,I,F=e.type,j=F==="FeatureCollection",X=F==="Feature",ee=j?e.features.length:1,be=0;be<ee;be++){x=j?e.features[be].geometry:X?e.geometry:e,I=x?x.type==="GeometryCollection":!1,v=I?x.geometries.length:1;for(var Fe=0;Fe<v;Fe++){var We=0,et=0;if(f=I?x.geometries[Fe]:x,f!==null){m=f.coordinates;var xt=f.type;switch(A=r&&(xt==="Polygon"||xt==="MultiPolygon")?1:0,xt){case null:break;case"Point":if(i(m,T,be,We,et)===!1)return!1;T++,We++;break;case"LineString":case"MultiPoint":for(n=0;n<m.length;n++){if(i(m[n],T,be,We,et)===!1)return!1;T++,xt==="MultiPoint"&&We++}xt==="LineString"&&We++;break;case"Polygon":case"MultiLineString":for(n=0;n<m.length;n++){for(a=0;a<m[n].length-A;a++){if(i(m[n][a],T,be,We,et)===!1)return!1;T++}xt==="MultiLineString"&&We++,xt==="Polygon"&&et++}xt==="Polygon"&&We++;break;case"MultiPolygon":for(n=0;n<m.length;n++){for(et=0,a=0;a<m[n].length;a++){for(s=0;s<m[n][a].length-A;s++){if(i(m[n][a][s],T,be,We,et)===!1)return!1;T++}et++}We++}break;case"GeometryCollection":for(n=0;n<f.geometries.length;n++)if(V(f.geometries[n],i,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function $(e,i,r,n){var a=r;return V(e,function(s,f,v,m,x){f===0&&r===void 0?a=s:a=i(a,s,f,v,m,x)},n),a}function re(e,i){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length&&i(e.features[r].properties,r)!==!1;r++);break;case"Feature":i(e.properties,0);break}}function pe(e,i,r){var n=r;return re(e,function(a,s){s===0&&r===void 0?n=a:n=i(n,a,s)}),n}function Me(e,i){if(e.type==="Feature")i(e,0);else if(e.type==="FeatureCollection")for(var r=0;r<e.features.length&&i(e.features[r],r)!==!1;r++);}function Ge(e,i,r){var n=r;return Me(e,function(a,s){s===0&&r===void 0?n=a:n=i(n,a,s)}),n}function Qe(e){var i=[];return V(e,function(r){i.push(r)}),i}function se(e,i){var r,n,a,s,f,v,m,x,A,T,I=0,F=e.type==="FeatureCollection",j=e.type==="Feature",X=F?e.features.length:1;for(r=0;r<X;r++){for(v=F?e.features[r].geometry:j?e.geometry:e,x=F?e.features[r].properties:j?e.properties:{},A=F?e.features[r].bbox:j?e.bbox:void 0,T=F?e.features[r].id:j?e.id:void 0,m=v?v.type==="GeometryCollection":!1,f=m?v.geometries.length:1,a=0;a<f;a++){if(s=m?v.geometries[a]:v,s===null){if(i(null,I,x,A,T)===!1)return!1;continue}switch(s.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(i(s,I,x,A,T)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<s.geometries.length;n++)if(i(s.geometries[n],I,x,A,T)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}I++}}function Le(e,i,r){var n=r;return se(e,function(a,s,f,v,m){s===0&&r===void 0?n=a:n=i(n,a,s,f,v,m)}),n}function dt(e,i){se(e,function(r,n,a,s,f){var v=r===null?null:r.type;switch(v){case null:case"Point":case"LineString":case"Polygon":return i(Gn(r,a,{bbox:s,id:f}),n,0)===!1?!1:void 0}var m;switch(v){case"MultiPoint":m="Point";break;case"MultiLineString":m="LineString";break;case"MultiPolygon":m="Polygon";break}for(var x=0;x<r.coordinates.length;x++){var A=r.coordinates[x],T={type:m,coordinates:A};if(i(Gn(T,a),n,x)===!1)return!1}})}function fr(e,i,r){var n=r;return dt(e,function(a,s,f){s===0&&f===0&&r===void 0?n=a:n=i(n,a,s,f)}),n}function Lt(e,i){dt(e,function(r,n,a){var s=0;if(!!r.geometry){var f=r.geometry.type;if(!(f==="Point"||f==="MultiPoint")){var v,m=0,x=0,A=0;if(V(r,function(T,I,F,j,X){if(v===void 0||n>m||j>x||X>A){v=T,m=n,x=j,A=X,s=0;return}var ee=lineString([v,T],r.properties);if(i(ee,n,a,X,s)===!1)return!1;s++,v=T})===!1)return!1}}})}function Bt(e,i,r){var n=r,a=!1;return Lt(e,function(s,f,v,m,x){a===!1&&r===void 0?n=s:n=i(n,s,f,v,m,x),a=!0}),n}function hr(e,i){if(!e)throw new Error("geojson is required");dt(e,function(r,n,a){if(r.geometry!==null){var s=r.geometry.type,f=r.geometry.coordinates;switch(s){case"LineString":if(i(r,n,a,0,0)===!1)return!1;break;case"Polygon":for(var v=0;v<f.length;v++)if(i(lineString(f[v],r.properties),n,a,v)===!1)return!1;break}}})}function _n(e,i,r){var n=r;return hr(e,function(a,s,f,v){s===0&&r===void 0?n=a:n=i(n,a,s,f,v)}),n}function fn(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,a=i.geometryIndex||0,s=i.segmentIndex||0,f=i.properties,v;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),f=f||e.features[r].properties,v=e.features[r].geometry;break;case"Feature":f=f||e.properties,v=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":v=e;break;default:throw new Error("geojson is invalid")}if(v===null)return null;var m=v.coordinates;switch(v.type){case"Point":case"MultiPoint":return null;case"LineString":return s<0&&(s=m.length+s-1),lineString([m[s],m[s+1]],f,i);case"Polygon":return a<0&&(a=m.length+a),s<0&&(s=m[a].length+s-1),lineString([m[a][s],m[a][s+1]],f,i);case"MultiLineString":return n<0&&(n=m.length+n),s<0&&(s=m[n].length+s-1),lineString([m[n][s],m[n][s+1]],f,i);case"MultiPolygon":return n<0&&(n=m.length+n),a<0&&(a=m[n].length+a),s<0&&(s=m[n][a].length-s-1),lineString([m[n][a][s],m[n][a][s+1]],f,i)}throw new Error("geojson is invalid")}function Mt(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,a=i.geometryIndex||0,s=i.coordIndex||0,f=i.properties,v;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),f=f||e.features[r].properties,v=e.features[r].geometry;break;case"Feature":f=f||e.properties,v=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":v=e;break;default:throw new Error("geojson is invalid")}if(v===null)return null;var m=v.coordinates;switch(v.type){case"Point":return point(m,f,i);case"MultiPoint":return n<0&&(n=m.length+n),point(m[n],f,i);case"LineString":return s<0&&(s=m.length+s),point(m[s],f,i);case"Polygon":return a<0&&(a=m.length+a),s<0&&(s=m[a].length+s),point(m[a][s],f,i);case"MultiLineString":return n<0&&(n=m.length+n),s<0&&(s=m[n].length+s),point(m[n][s],f,i);case"MultiPolygon":return n<0&&(n=m.length+n),a<0&&(a=m[n].length+a),s<0&&(s=m[n][a].length-s),point(m[n][a][s],f,i)}throw new Error("geojson is invalid")}function Jr(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Br(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Jr(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Jr(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Wr(e,i){var r=[],n={};if(!e.features)return e.features=[],{dataArray:[]};if(e.features=e.features.filter(function(s){var f=s.geometry;return s!=null&&f&&f.type&&f.coordinates&&f.coordinates.length>0}),ut()(e,!0),e.features.length===0)return{dataArray:[],featureKeys:n};var a=0;return dt(e,function(s,f){var v=Di(s),m=f,x=Br(Br({},s.properties),{},{coordinates:v,_id:m});r.push(x)}),{dataArray:r,featureKeys:n}}function mi(e){var i=131,r=137,n=0;e+="x";for(var a=Math.floor(9007199254740991/r),s=0;s<e.length;s++)n>a&&(n=Math.floor(n/r)),n=n*i+e.charCodeAt(s);return n}function en(e){e=e.toString();for(var i=5381,r=e.length;r;)i=i*33^e.charCodeAt(--r);return i>>>0}var dn=Q(28481),Wi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function hi(e){this.message=e}hi.prototype=new Error,hi.prototype.name="InvalidCharacterError";function wi(e){var i=String(e).replace(/=+$/,"");if(i.length%4==1)throw new hi("'atob' failed: The string to be decoded is not correctly encoded.");for(var r="",n=0,a,s,f=0;s=i.charAt(f++);~s&&(a=n%4?a*64+s:s,n++%4)?r+=String.fromCharCode(255&a>>(-2*n&6)):0)s=Wi.indexOf(s);return r}function _i(e){e=String(e);for(var i,r,n,a,s="",f=0,v=e.length%3;f<e.length;){if((r=e.charCodeAt(f++))>255||(n=e.charCodeAt(f++))>255||(a=e.charCodeAt(f++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");i=r<<16|n<<8|a,s+=Wi.charAt(i>>18&63)+Wi.charAt(i>>12&63)+Wi.charAt(i>>6&63)+Wi.charAt(i&63)}return v?s.slice(0,v-3)+"===".substring(v):s}var ht=Q(6610),Pt=Q(5991),Ta=function(){function e(i,r){(0,ht.Z)(this,e),this.buffers=i,this.type=r}return(0,Pt.Z)(e,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(r,n,a){throw new Error("not implemented")}}]),e}(),Ei;typeof window=="undefined"?Ei={devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(i){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(i){return!0},Event:function(i,r){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:Ei=window;var Ti=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Zi=Ti?my.getSystemInfoSync().pixelRatio:Ei.devicePixelRatio,Pr=Q(10379),on=Q(46070),gt=Q(77608),sa=(0,Pt.Z)(function e(i,r){(0,ht.Z)(this,e),(0,S.Z)(this,"cancelBubble",void 0),(0,S.Z)(this,"cancelable",void 0),(0,S.Z)(this,"target",void 0),(0,S.Z)(this,"currentTarget",void 0),(0,S.Z)(this,"preventDefault",void 0),(0,S.Z)(this,"stopPropagation",void 0),(0,S.Z)(this,"type",void 0),(0,S.Z)(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=i,this.timeStamp=Date.now()}),J=Q(63349);function Ko(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=ta(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function ta(e,i){if(!!e){if(typeof e=="string")return bu(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return bu(e,i)}}function bu(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var za=new WeakMap,Ma=function(){function e(){(0,ht.Z)(this,e),za.set(this,{})}return(0,Pt.Z)(e,[{key:"addEventListener",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=za.get(this);s||(s={}),s[r]||(s[r]=[]),s[r].push(n),za.set(this,s),a.capture,a.once,a.passive}},{key:"removeEventListener",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=za.get(this);if(s){var f=s[r];if(f&&f.length>0){for(var v=f.length;v--;v>0)if(f[v]===n){f.splice(v,1);break}}}}},{key:"dispatchEvent",value:function(r){var n=za.get(this)[r.type];if(n){var a=Ko(n),s;try{for(a.s();!(s=a.n()).done;){var f=s.value;f(r)}}catch(v){a.e(v)}finally{a.f()}}}}]),e}();function Ka(e){var i=ua();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function ua(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ao=function(e){(0,Pr.Z)(r,e);var i=Ka(r);function r(){var n;return(0,ht.Z)(this,r),n=i.call(this),(0,S.Z)((0,J.Z)(n),"childNodes",void 0),n.childNodes=[],n}return(0,Pt.Z)(r,[{key:"appendChild",value:function(a){this.childNodes.push(a)}},{key:"cloneNode",value:function(){var a=Object.create(this);return Object.assign(a,this),a}},{key:"removeChild",value:function(a){var s=this.childNodes.findIndex(function(f){return f===a});return s>-1?this.childNodes.splice(s,1):null}}]),r}(Ma);function jo(e){var i=wu();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function wu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vo=function(e){(0,Pr.Z)(r,e);var i=jo(r);function r(){var n;return(0,ht.Z)(this,r),n=i.call(this),(0,S.Z)((0,J.Z)(n),"className",void 0),(0,S.Z)((0,J.Z)(n),"children",void 0),n.className="",n.children=[],n}return(0,Pt.Z)(r,[{key:"setAttribute",value:function(a,s){this[a]=s}},{key:"getAttribute",value:function(a){return this[a]}},{key:"setAttributeNS",value:function(a,s){this[a]=s}},{key:"getAttributeNS",value:function(a){return this[a]}}]),r}(Ao),Do=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,la,$a,Fo,Qa;if(Do){var Ms=my.getSystemInfoSync();la=Ms.screenWidth,$a=Ms.screenHeight,Fo=Ms.windowWidth,Qa=Ms.windowHeight}else{var Ol=Ei.innerWidth,ys=Ei.innerHeight;la=Ol,$a=ys,Fo=Ol,Qa=ys}var te={width:la,height:$a,availWidth:Fo,availHeight:Qa,availLeft:0,availTop:0},ye=te.availWidth,Xe=te.availHeight,It={style:[]};function Or(e,i){if(!("parentNode"in e)){var r;i===0?r=function(){return null}:i===1?r=function(){return It}:r=function(){return null},Object.defineProperty(e,"parentNode",{enumerable:!0,get:r})}if(!("parentElement"in e)){var n;i===0?n=function(){return null}:i===1?n=function(){return It}:n=function(){return null},Object.defineProperty(e,"parentElement",{enumerable:!0,get:n})}}function On(e){e.style=e.style||{},Object.assign(e.style,{top:"0px",left:"0px",width:ye+"px",height:Xe+"px",margin:"0px",padding:"0px"})}function Mi(e){"clientLeft"in e||(e.clientLeft=0,e.clientTop=0),"clientWidth"in e||(e.clientWidth=ye,e.clientHeight=Xe),"getBoundingClientRect"in e||(e.getBoundingClientRect=function(){var i={x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight};return i})}function oo(e){"offsetLeft"in e||(e.offsetLeft=0,e.offsetTop=0),"offsetWidth"in e||(e.offsetWidth=ye,e.offsetHeight=Xe)}function Ra(e){"scrollLeft"in e||(e.scrollLeft=0,e.scrollTop=0),"scrollWidth"in e||(e.scrollWidth=ye,e.scrollHeight=Xe)}function Ua(e){var i=function(){return!0};e.classList=[],e.classList.add=i,e.classList.remove=i,e.classList.contains=i,e.classList.toggle=i}function Vo(e){var i=_s();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function _s(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function lo(){}var wo=function(e){(0,Pr.Z)(r,e);var i=Vo(r);function r(){var n,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",s=arguments.length>1?arguments[1]:void 0;return(0,ht.Z)(this,r),n=i.call(this),(0,S.Z)((0,J.Z)(n),"className",void 0),(0,S.Z)((0,J.Z)(n),"children",void 0),(0,S.Z)((0,J.Z)(n),"focus",void 0),(0,S.Z)((0,J.Z)(n),"blur",void 0),(0,S.Z)((0,J.Z)(n),"insertBefore",void 0),(0,S.Z)((0,J.Z)(n),"appendChild",void 0),(0,S.Z)((0,J.Z)(n),"removeChild",void 0),(0,S.Z)((0,J.Z)(n),"remove",void 0),(0,S.Z)((0,J.Z)(n),"innerHTML",void 0),(0,S.Z)((0,J.Z)(n),"tagName",void 0),n.className="",n.children=[],n.focus=lo,n.blur=lo,n.insertBefore=lo,n.appendChild=lo,n.removeChild=lo,n.remove=lo,n.innerHTML="",n.tagName=a.toUpperCase(),Or((0,J.Z)(n),s),On((0,J.Z)(n)),Ua((0,J.Z)(n)),Mi((0,J.Z)(n)),oo((0,J.Z)(n)),Ra((0,J.Z)(n)),n}return(0,Pt.Z)(r)}(vo);function xs(e){var i=Ps();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function Ps(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Fs=function(e){(0,Pr.Z)(r,e);var i=xs(r);function r(n){return(0,ht.Z)(this,r),i.call(this,n)}return(0,Pt.Z)(r,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),r}(wo);function fu(e){var i=bs();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function bs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ga=function(e){(0,Pr.Z)(r,e);var i=fu(r);function r(){return(0,ht.Z)(this,r),i.call(this,"video")}return(0,Pt.Z)(r)}(Fs),xa={},is={};function mf(e,i){xa=e,xa.id=i,"tagName"in xa||(xa.tagName="CANVAS"),xa.type="canvas",Mixin.parentNode(xa),Mixin.style(xa),Mixin.classList(xa),Mixin.clientRegion(xa),Mixin.offsetRegion(xa),xa.focus=function(){},xa.blur=function(){}}function Il(e,i){var r=1024,n=1024;is={width:r,height:n,clientWidth:r/devicePixelRatio,clientHeight:n/devicePixelRatio,id:i,type:"canvas"},"tagName"in is||(is.tagName="CANVAS"),Mixin.parentNode(is),Mixin.style(is),Mixin.classList(is),Mixin.clientRegion(is),Mixin.offsetRegion(is),is.getContext=function(a){if(a==="2d")return e},is.focus=function(){},is.blur=function(){}}function qs(){return xa}function ac(){return is}var Yu=(0,Pt.Z)(function e(){(0,ht.Z)(this,e);var i=qs(),r=i.createImage&&i.createImage()||{};return"tagName"in r||(r.tagName="IMG",r.__proto__=e.prototype),Or(r),Ua(r),Object.assign(r,{addEventListener:function(a,s){r["on".concat(a)]=s.bind(r)},removeEventListener:function(a){r["on".concat(a)]=null}}),r}),Ks={href:"",protocol:"",host:""};function ul(e){var i=_();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function _(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var M=function(e){(0,Pr.Z)(r,e);var i=ul(r);function r(){return(0,ht.Z)(this,r),i.call(this,"body",0)}return(0,Pt.Z)(r,[{key:"addEventListener",value:function(a,s){var f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(a,s,f){}},{key:"dispatchEvent",value:function(a){}}]),r}(wo),B=function(e){(0,Pr.Z)(r,e);var i=ul(r);function r(){return(0,ht.Z)(this,r),i.call(this,"html",0)}return(0,Pt.Z)(r,[{key:"addEventListener",value:function(a,s){var f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(a,s){}},{key:"dispatchEvent",value:function(a){}}]),r}(wo),R={},K={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:Ks,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(i){return i=i.toLowerCase(),i==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):i==="img"?new Yu:i==="video"?new ga:new wo(i)},createElementNS:function(i,r){return this.createElement(r)},createTextNode:function(i){return i},getElementById:function(i){return null},getElementsByTagName:function(i){return i=i.toLowerCase(),[]},getElementsByTagNameNS:function(i,r){return this.getElementsByTagName(r)},getElementsByName:function(i){return[]},querySelector:function(i){return null},querySelectorAll:function(i){return[]},addEventListener:function(i,r,n){R[i]||(R[i]=[]),R[i].push(r)},removeEventListener:function(i,r){var n=R[i];if(n&&n.length>0){for(var a=n.length;a--;a>0)if(n[a]===r){n.splice(a,1);break}}},dispatchEvent:function(i){var r=i.type,n=R[r];if(n)for(var a=0;a<n.length;a++)n[a](i);i.target&&typeof i.target["on"+r]=="function"&&i.target["on"+r](i)},createEvent:function(i){return new sa(i)}};K.documentElement=new B,K.head=new wo("head"),K.body=new M;var ge=Object,He=Q(90484),lt=function(){function e(){(0,ht.Z)(this,e),(0,S.Z)(this,"_w",void 0),(0,S.Z)(this,"_h",void 0),(0,S.Z)(this,"_data",void 0);var i=arguments.length;if(i===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){this._w=arguments[0],this._h=arguments[1],this._data=new Uint8ClampedArray(this._w*this._h*4);return}}else i===3&&(0,He.Z)(arguments[0])==="object"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number"&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return(0,Pt.Z)(e,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),e}(),pt=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,nr,sr,Pn;if(pt){var ni=my.getSystemInfoSync();nr=ni.system,sr=ni.platform,Pn=ni.language}else{var Rn={versions:function(){var e=Ei.navigator.userAgent;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")===-1,mobile:!!e.match(/AppleWebKit.*Mobile.*/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:e.indexOf("Safari")===-1,weixin:e.indexOf("MicroMessenger")>-1,qq:e.match(/\sQQ/i)===" qq"}}(),language:(Ei.navigator.browserLanguage||Ei.navigator.language).toLowerCase()};Rn.versions.android?sr="android":Rn.versions.trident?sr="IE":Rn.versions.presto?sr="Opera":Rn.versions.webKit?sr="webKit":Rn.versions.gecko?sr="Firefox":Rn.versions.mobile?sr="mobile":Rn.versions.ios?sr="ios":Rn.versions.iPhone?sr="iPhone":Rn.versions.iPad?sr="ipad":Rn.versions.webApp?sr="webApp":Rn.versions.weixin?sr="weixin":Rn.versions.qq&&(sr="qq"),nr=Ei.navigator.userAgent,Pn=Rn.language}var Xi=nr.toLowerCase().indexOf("android")!==-1,va=Xi?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",Ca="Mozilla/5.0 (".concat(va,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(Pn),Vi={platform:sr,language:Pn,appVersion:"5.0 (".concat(va,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:Ca},Es={mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){}},hu=0,qu=0;function gf(e){var i=Date.now(),r=Math.max(hu+23,i);return qu=setTimeout(function(){e(hu=r)},r-i),qu}function ll(e){var i=qs();return i.requestAnimationFrame?i.requestAnimationFrame(e):gf(e)}function Bc(e){var i=qs();return i.cancelAnimationFrame?i.cancelAnimationFrame(e):clearTimeout(e)}var Tu=function(){function e(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if((0,ht.Z)(this,e),(0,S.Z)(this,"href",void 0),i.indexOf("http://")==0||i.indexOf("https://")==0){this.href=i;return}this.href=r+i}return(0,Pt.Z)(e,null,[{key:"createObjectURL",value:function(r){var n=r.buffers[0],a=r.type,s=Mu(n),f="data:".concat(a,";base64, ");return f+s}}]),e}();function Mu(e){for(var i="",r=new Uint8Array(e),n=r.byteLength,a=0;a<n;a++)i+=String.fromCharCode(r[a]);return _i(i)}var Pu={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:18446744073709552e3,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},co={};function Gf(e){var i=Hf();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function Hf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $o=new Map,Nc=new Map,Ou=new Map,pu={json:"application/json",text:"application/text",arraybuffer:"application/octet-stream"};function yf(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{target:this};typeof this["on".concat(e)]=="function"&&this["on".concat(e)].call(this,i)}function Rl(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{readyState:e};this.readyState=e,yf.call(this,"readystatechange",i)}var Bi=function(e){(0,Pr.Z)(r,e);var i=Gf(r);function r(){var n;return(0,ht.Z)(this,r),n=i.call(this),(0,S.Z)((0,J.Z)(n),"onabort",void 0),(0,S.Z)((0,J.Z)(n),"onerror",void 0),(0,S.Z)((0,J.Z)(n),"onload",void 0),(0,S.Z)((0,J.Z)(n),"onloadstart",void 0),(0,S.Z)((0,J.Z)(n),"onprogress",void 0),(0,S.Z)((0,J.Z)(n),"ontimeout",void 0),(0,S.Z)((0,J.Z)(n),"onloadend",void 0),(0,S.Z)((0,J.Z)(n),"onreadystatechange",void 0),(0,S.Z)((0,J.Z)(n),"readyState",void 0),(0,S.Z)((0,J.Z)(n),"response",void 0),(0,S.Z)((0,J.Z)(n),"responseText",void 0),(0,S.Z)((0,J.Z)(n),"_responseType",void 0),(0,S.Z)((0,J.Z)(n),"responseXML",void 0),(0,S.Z)((0,J.Z)(n),"status",void 0),(0,S.Z)((0,J.Z)(n),"statusText",void 0),(0,S.Z)((0,J.Z)(n),"upload",void 0),(0,S.Z)((0,J.Z)(n),"withCredentials",void 0),(0,S.Z)((0,J.Z)(n),"timeout",void 0),(0,S.Z)((0,J.Z)(n),"_url",void 0),(0,S.Z)((0,J.Z)(n),"_method",void 0),n.onabort=null,n.onerror=null,n.onload=null,n.onloadstart=null,n.onprogress=null,n.ontimeout=null,n.onloadend=null,n.onreadystatechange=null,n.readyState=0,n.response=null,n.responseText=null,n._responseType="text",n.responseXML=null,n.status=0,n.statusText="",n.upload={},n.withCredentials=!1,$o.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),n}return(0,Pt.Z)(r,[{key:"responseType",set:function(a){this._responseType=a}},{key:"abort",value:function(){var a=Ou.get("requestTask");a&&a.abort()}},{key:"getAllResponseHeaders",value:function(){var a=Nc.get("responseHeader");return Object.keys(a).map(function(s){return"".concat(s,": ").concat(a[s])}).join(`
`)}},{key:"getResponseHeader",value:function(a){return Nc.get("responseHeader")[a]}},{key:"open",value:function(a,s,f){this._method=a,this._url=s}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:""}},{key:"setRequestHeader",value:function(a,s){var f=$o.get("requestHeader");f[a]=s,$o.set("requestHeader",f)}},{key:"addEventListener",value:function(a,s){var f=this;typeof s=="function"&&(this["on"+a]=function(){var v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};v.target=v.target||f,s.call(f,v)})}},{key:"removeEventListener",value:function(a,s){this["on"+a]===s&&(this["on"+a]=null)}}]),r}(Ma);(0,S.Z)(Bi,"UNSEND",void 0),(0,S.Z)(Bi,"OPENED",void 0),(0,S.Z)(Bi,"HEADERS_RECEIVED",void 0),(0,S.Z)(Bi,"LOADING",void 0),(0,S.Z)(Bi,"DONE",void 0),Bi.UNSEND=0,Bi.OPENED=1,Bi.HEADERS_RECEIVED=2,Bi.LOADING=3,Bi.DONE=4;function kl(e){var i=Mh();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function Mh(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cl=function(e){(0,Pr.Z)(r,e);var i=kl(r);function r(n){var a;return(0,ht.Z)(this,r),a=i.call(this,n),(0,S.Z)((0,J.Z)(a),"touches",void 0),(0,S.Z)((0,J.Z)(a),"targetTouches",void 0),(0,S.Z)((0,J.Z)(a),"changedTouches",void 0),a.touches=[],a.targetTouches=[],a.changedTouches=[],a.target=qs(),a.currentTarget=qs(),a}return(0,Pt.Z)(r)}(sa);function zc(e){var i=e||{},r=i.x,n=r===void 0?0:r,a=i.y,s=a===void 0?0:a,f=i.clientX,v=f===void 0?0:f,m=i.clientY,x=m===void 0?0:m;Object.keys(e).indexOf("x")!==-1?(e.pageX=e.clientX=n,e.pageY=e.clientY=s):(e.x=v,e.y=x)}function Wf(e){return function(i){var r=new cl(e);r.changedTouches=i.changedTouches,r.touches=i.touches,r.targetTouches=Array.prototype.slice.call(i.touches),r.timeStamp=i.timeStamp,r.changedTouches.forEach(function(n){return zc(n)}),r.touches.forEach(function(n){return zc(n)}),r.targetTouches.forEach(function(n){return zc(n)}),K.dispatchEvent(r)}}function Ph(e){return function(i){i.type=e,K.dispatchEvent(i)}}var Xf=Wf("touchstart"),Uc=Wf("touchmove"),oc=Wf("touchend"),sc=Ph("mapCameaParams");function Ll(e){var i=fl();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function fl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Dl=function(e){(0,Pr.Z)(r,e);var i=Ll(r);function r(n){var a;return(0,ht.Z)(this,r),a=i.call(this,n),(0,S.Z)((0,J.Z)(a),"buttons",void 0),(0,S.Z)((0,J.Z)(a),"which",void 0),(0,S.Z)((0,J.Z)(a),"pointerId",void 0),(0,S.Z)((0,J.Z)(a),"bubbles",void 0),(0,S.Z)((0,J.Z)(a),"button",void 0),(0,S.Z)((0,J.Z)(a),"width",void 0),(0,S.Z)((0,J.Z)(a),"height",void 0),(0,S.Z)((0,J.Z)(a),"pressure",void 0),(0,S.Z)((0,J.Z)(a),"isPrimary",void 0),(0,S.Z)((0,J.Z)(a),"pointerType",void 0),(0,S.Z)((0,J.Z)(a),"altKey",void 0),(0,S.Z)((0,J.Z)(a),"ctrlKey",void 0),(0,S.Z)((0,J.Z)(a),"metaKey",void 0),(0,S.Z)((0,J.Z)(a),"shiftKey",void 0),a.target=qs(),a.currentTarget=qs(),a}return(0,Pt.Z)(r)}(sa),Ku=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],$s=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0],_f="touch";function xf(e,i,r){for(var n=new Dl(e),a=0;a<Ku.length;a++){var s=Ku[a];n[s]=i[s]||$s[a]}return n.type=e,n.target=qs(),n.currentTarget=qs(),n.buttons=Yf(e),n.which=n.buttons,n.pointerId=(i.identifier||0)+2,n.bubbles=!0,n.cancelable=!0,n.button=0,n.width=(i.radiusX||.5)*2,n.height=(i.radiusY||.5)*2,n.pressure=i.force||.5,n.isPrimary=uc(i),n.pointerType=_f,n.altKey=r.altKey,n.ctrlKey=r.ctrlKey,n.metaKey=r.metaKey,n.shiftKey=r.shiftKey,r.preventDefault&&(n.preventDefault=function(){r.preventDefault()}),n}function Yf(e){var i=0;return(e==="touchstart"||e==="touchmove"||e==="pointerdown"||e==="pointermove")&&(i=1),i}var du=null;function uc(e){return du===e.identifier}function Zc(e){du===null&&(du=e.identifier)}function bf(e){du===e.identifier&&(du=null)}function Fl(e){return function(i){for(var r=i.changedTouches,n=0;n<r.length;n++){var a=r[n];n===0&&e==="pointerdown"?Zc(a):(e==="pointerup"||e==="pointercancel")&&bf(a);var s=xf(e,a,i);K.dispatchEvent(s)}}}var hp=Fl("pointerdown"),Ef=Fl("pointermove"),Bl=Fl("pointerup");function Sf(e){var i=Cf();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function Cf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Nl=function(e){(0,Pr.Z)(r,e);var i=Sf(r);function r(n){return(0,ht.Z)(this,r),i.call(this,n)}return(0,Pt.Z)(r)}(sa);function jc(e){return function(i){i.type=e,K.dispatchEvent(i)}}var Oh=jc("mousedown"),Ih=jc("mousemove"),lc=jc("mouseup"),Rh=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,zl=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),Qi=Rh||zl,cc={atob:wi,btoa:_i,devicePixelRatio:Zi,Blob:Ta,document:K,Element:vo,Event:sa,EventTarget:Ma,HTMLCanvasElement:ge,HTMLElement:wo,HTMLMediaElement:Fs,HTMLVideoElement:ga,Image:Yu,ImageData:lt,navigator:Vi,Node:Ao,requestAnimationFrame:ll,cancelAnimationFrame:Bc,screen:te,XMLHttpRequest:Bi,performance:Es,URL:Tu,WebGLRenderingContext:Pu,WebGL2RenderingContext:co,addEventListener:function(i,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};K.addEventListener(i,r,n)},removeEventListener:function(i,r,n){K.removeEventListener(i,r)},dispatchEvent:function(i){K.dispatchEvent(i)},innerWidth:te.availWidth,innerHeight:te.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},ha=Qi?cc:Ei,Iu=Qi?Bi:Ei.XMLHttpRequest,Yi=Qi?Ks:Ei.location;function Pa(e){var i=e;return typeof e=="string"&&(i=ha.document.getElementById(e)),i}function Ss(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Vc(e){return Ss(e).split(/\s+/)}function $u(e){var i,r,n=ha==null||(i=ha.document)===null||i===void 0||(r=i.documentElement)===null||r===void 0?void 0:r.style;if(!n)return e[0];for(var a in e)if(e[a]&&e[a]in n)return e[a];return e[0]}function Za(e,i,r){var n=ha.document.createElement(e);return n.className=i||"",r&&r.appendChild(n),n}function fc(e){var i=e.parentNode;i&&i.removeChild(e)}function Ul(e,i){if(e.classList!==void 0)for(var r=Vc(i),n=0,a=r.length;n<a;n++)e.classList.add(r[n]);else if(!Gc(e,i)){var s=mo(e);Ru(e,(s?s+" ":"")+i)}}function Qu(e,i){e.classList!==void 0?e.classList.remove(i):Ru(e,Ss((" "+mo(e)+" ").replace(" "+i+" "," ")))}function Gc(e,i){if(e.classList!==void 0)return e.classList.contains(i);var r=mo(e);return r.length>0&&new RegExp("(^|\\s)"+i+"(\\s|$)").test(r)}function Ru(e,i){e instanceof HTMLElement?e.className=i:e.className.baseVal=i}function mo(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function Zl(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var hc=$u(["transform","WebkitTransform"]);function go(e,i){e.style[hc]=i}function vn(){if(typeof Event=="function")ha.dispatchEvent(new Event("resize"));else{var e=ha.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,ha,0),ha.dispatchEvent(e)}}function fo(e){var i=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,i.join(""))}function Ju(){var e,i=ha.document.querySelector('meta[name="viewport"]');if(!i)return 1;var r=(e=i.content)===null||e===void 0?void 0:e.split(","),n=r.find(function(a){var s=a.split("="),f=(0,dn.Z)(s,2),v=f[0],m=f[1];return v==="initial-scale"});return n?n.split("=")[1]*1:1}var ka=Ju()<1?1:ha.devicePixelRatio,Qs=Q(14665);function Os(e){return Function.toString.call(e).indexOf("[native code]")!==-1}var Af=Q(51814);function Zr(e,i,r){return(0,Af.Z)()?Zr=Reflect.construct:Zr=function(a,s,f){var v=[null];v.push.apply(v,s);var m=Function.bind.apply(a,v),x=new m;return f&&(0,Qs.Z)(x,f.prototype),x},Zr.apply(null,arguments)}function pc(e){var i=typeof Map=="function"?new Map:void 0;return pc=function(n){if(n===null||!Os(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof i!="undefined"){if(i.has(n))return i.get(n);i.set(n,a)}function a(){return Zr(n,arguments,(0,gt.Z)(this).constructor)}return a.prototype=Object.create(n.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),(0,Qs.Z)(a,n)},pc(e)}function wf(e){var i=hl();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function hl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Aa=function(e){(0,Pr.Z)(r,e);var i=wf(r);function r(n,a,s){var f;return(0,ht.Z)(this,r),f=i.call(this,n),(0,S.Z)((0,J.Z)(f),"status",void 0),(0,S.Z)((0,J.Z)(f),"url",void 0),f.status=a,f.url=s,f.name=f.constructor.name,f.message=n,f}return(0,Pt.Z)(r,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),r}(pc(Error));function Cs(e){var i=new Iu;i.open("GET",e.url,!0);for(var r in e.headers)e.headers.hasOwnProperty(r)&&i.setRequestHeader(r,e.headers[r]);return i.withCredentials=e.credentials==="include",i}var Tf=function(i,r){var n=Cs(i);return n.setRequestHeader("Accept","application/json"),n.onerror=function(){r(new Error(n.statusText))},n.onload=function(){if(n.status>=200&&n.status<300&&n.response){var a;try{a=JSON.parse(n.response)}catch(s){return r(s)}r(null,a)}else n.status===401?r(new Aa("".concat(n.statusText),n.status,i.url)):r(new Aa(n.statusText,n.status,i.url))},n.send(),n},ku=function(i,r){var n=Cs(i);return n.responseType="arraybuffer",n.onerror=function(){r(new Error(n.statusText))},n.onload=function(){var a=n.response;if(a.byteLength===0&&n.status===200)return r(new Error("http status 200 returned without content."));n.status>=200&&n.status<300&&n.response?r(null,{data:a,cacheControl:n.getResponseHeader("Cache-Control"),expires:n.getResponseHeader("Expires")}):r(new Aa(n.statusText,n.status,i.url))},n.send(),n};function Bs(e){var i=$window.document.createElement("a");return i.href=e,i.protocol===$window.document.location.protocol&&i.host===$window.document.location.host}var Lu="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",qf=function(i,r){return ku(i,function(n,a){if(n)r(n);else if(a){var s=new ha.Image;s.crossOrigin="anonymous";var f=ha.URL||ha.webkitURL;s.onload=function(){r(null,s),f.revokeObjectURL(s.src)};var v=new ha.Blob([new Uint8Array(a.data)],{type:"image/png"});s.src=a.data.byteLength?f.createObjectURL(v):Lu}})},pl=2*Math.PI*6378137/2;function Kf(e){var i=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(r){var n=r.coordinates;Mf(i,n)}),i}function Mf(e,i){return Array.isArray(i[0])?i.forEach(function(r){Mf(e,r)}):(e[0]>i[0]&&(e[0]=i[0]),e[1]>i[1]&&(e[1]=i[1]),e[2]<i[0]&&(e[2]=i[0]),e[3]<i[1]&&(e[3]=i[1])),e}function vu(e,i){return Is(e,i)}function Is(e,i){return Array.isArray(e[0])?e.map(function(r){return Is(r,i)}):i(e)}function Ai(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=dl(e,i);var n=e[0],a=e[1],s=n*pl/180,f=Math.log(Math.tan((90+a)*Math.PI/360))/(Math.PI/180);return f=f*pl/180,r.enable&&(s=Number(s.toFixed(r.decimal)),f=Number(f.toFixed(r.decimal))),e.length===3?[s,f,e[2]]:[s,f]}function Du(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,r=e[0],n=e[1],a=r/pl*180,s=n/pl*180;return s=180/Math.PI*(2*Math.atan(Math.exp(s*Math.PI/180))-Math.PI/2),i!=null&&(a=Number(a.toFixed(i)),s=Number(s.toFixed(i))),e.length===3?[a,s,e[2]]:[a,s]}function mu(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function Go(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function dl(e,i){if(i===!1)return e;var r=mu(e[0]),n=Go(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[r,n,e[2]]:[r,n]}function as(e){var i=85.0511287798,r=Math.max(Math.min(i,e[1]),-i),n=256<<20,a=Math.PI/180,s=e[0]*a,f=r*a;f=Math.log(Math.tan(Math.PI/4+f/2));var v=.5/Math.PI,m=.5,x=-.5/Math.PI;return a=.5,s=n*(v*s+m),f=n*(x*f+a),[Math.floor(s),Math.floor(f)]}function Js(e){var i=.5/Math.PI,r=.5,n=-.5/Math.PI,a=.5,s=256<<20,f=_slicedToArray(e,2),v=f[0],m=f[1];v=(v/s-r)/i,m=(m/s-a)/n,m=(Math.atan(Math.pow(Math.E,m))-Math.PI/4)*2,a=Math.PI/180;var x=m/a,A=v/a;return[A,x]}function As(e,i,r){var n=er(i[1]-e[1]),a=er(i[0]-e[0]),s=er(e[1]),f=er(i[1]),v=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(s)*Math.cos(f);return fe(2*Math.atan2(Math.sqrt(v),Math.sqrt(1-v)),r="meters")}function Eu(e){var i=Math.PI/180,r=85.0511287798,n=6378137,a=Math.max(Math.min(r,e[1]),-r),s=Math.sin(a*i),f=n*e[0]*i,v=n*Math.log((1+s)/(1-s))/2;return[f,v]}function In(e,i){var r=Math.abs(e[1][1]-e[0][1])*i,n=Math.abs(e[1][0]-e[0][0])*i;return[[e[0][0]-n,e[0][1]-r],[e[1][0]+n,e[1][1]+r]]}function Cn(e,i){return e[0][0]<=i[0][0]&&e[0][1]<=i[0][1]&&e[1][0]>=i[1][0]&&e[1][1]>=i[1][1]}function Hc(e){return[[e[0],e[1]],[e[2],e[3]]]}function Qo(e){var i=eu(e,[0,0]);return[e[0]/i,e[1]/i]}function eu(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))}function Ho(e,i){return e[0]*i[0]+e[1]*i[1]}function gu(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function $f(e,i){return Math.acos(Ho(e,i)/(gu(e)*gu(i)))*180/Math.PI}function Wc(e,i){return i[0]>0?i[1]>0?90-Math.atan(i[1]/i[0])*180/Math.PI:90+Math.atan(-i[1]/i[0])*180/Math.PI:i[1]<0?180+(90-Math.atan(i[1]/i[0])*180/Math.PI):270+Math.atan(i[1]/-i[0])*180/Math.PI}function ya(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!e||e.length<2)){for(var r=[0,1],n=0,a=[],s=0;s<e.length-1;s++){var f=e[s],v=e[s+1],m=eu(f,v);n+=m;var x=[f[0]-v[0],f[1]-v[1]],A=Wc(r,x);if(s>0){var T=a[s-1].rotation;T-A>360-T+A&&(A=A+360)}a.push({start:f,end:v,dis:m,rotation:A,duration:0})}return a.map(function(I){I.duration=i*(I.dis/n)}),a}}var La=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,r=arguments.length>1?arguments[1]:void 0;(0,ht.Z)(this,e),(0,S.Z)(this,"limit",void 0),(0,S.Z)(this,"cache",void 0),(0,S.Z)(this,"destroy",void 0),(0,S.Z)(this,"order",void 0),this.limit=i,this.destroy=r||this.defaultDestroy,this.order=[],this.clear()}return(0,Pt.Z)(e,[{key:"clear",value:function(){var r=this;this.order.forEach(function(n){r.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(r){var n=this.cache[r];return n&&(this.deleteOrder(r),this.appendOrder(r)),n}},{key:"set",value:function(r,n){this.cache[r]?(this.delete(r),this.cache[r]=n,this.appendOrder(r)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[r]=n,this.appendOrder(r))}},{key:"delete",value:function(r){var n=this.cache[r];n&&(this.deleteCache(r),this.deleteOrder(r),this.destroy(n,r))}},{key:"deleteCache",value:function(r){delete this.cache[r]}},{key:"deleteOrder",value:function(r){var n=this.order.findIndex(function(a){return a===r});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(r){this.order.push(r)}},{key:"defaultDestroy",value:function(r,n){return null}}]),e}();function vl(e,i){e.forEach(function(r){!i[r]||(i[r]=i[r].bind(i))})}var dc=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16;(0,ht.Z)(this,e),(0,S.Z)(this,"duration",16),(0,S.Z)(this,"timestamp",new Date().getTime()),this.duration=i}return(0,Pt.Z)(e,[{key:"run",value:function(r){var n=new Date().getTime(),a=n-this.timestamp;this.timestamp=n,a>=this.duration&&r()}}]),e}(),Ns=Q(2650);function yu(e){return typeof e=="string"?!!Ns.ZP(e):!1}function pi(e){var i=Ns.ZP(e),r=[0,0,0,0];return i!=null&&(r[0]=i.r/255,r[1]=i.g/255,r[2]=i.b/255,r[3]=i.opacity),r}function zs(e){var i=e&&e[0],r=e&&e[1],n=e&&e[2],a=i+r*256+n*65536-1;return a}function os(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function jl(e){var i=ha.document.createElement("canvas"),r=i.getContext("2d");i.width=256,i.height=1;for(var n=r.createLinearGradient(0,0,256,1),a=null,s=e.positions[0],f=e.positions[e.positions.length-1],v=0;v<e.colors.length;++v){var m=(e.positions[v]-s)/(f-s);n.addColorStop(m,e.colors[v])}if(r.fillStyle=n,r.fillRect(0,0,256,1),Qi)return a=new Uint8ClampedArray(r.getImageData(0,0,256,1).data),{data:a,width:256,height:1};a=r.getImageData(0,0,256,1).data;for(var x=r.createImageData(256,1),A=0;A<x.data.length;A+=4)x.data[A+0]=a[A+0],x.data[A+1]=a[A+1],x.data[A+2]=a[A+2],x.data[A+3]=a[A+3];return x}var Fu;(function(e){e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e.LEFT="left",e.RIGHT="right"})(Fu||(Fu={}));var el={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Xc(e,i,r){var n=e.classList;for(var a in el)el.hasOwnProperty(a)&&n.remove("l7-".concat(r,"-anchor-").concat(a));n.add("l7-".concat(r,"-anchor-").concat(i))}function Da(e,i){return{enable:e,mask:255,func:{cmp:514,ref:i?1:0,mask:255}}}var tu={BACK:1029,FRONT:1028};function Vl(e){switch(e){case"GAODE1.x":return tu.BACK;case"GAODE2.x":return tu.BACK;case"MAPBOX":return tu.FRONT;case"SIMPLE":return tu.FRONT;case"GLOBEL":return tu.BACK;case"L7MAP":return tu.FRONT;default:return tu.FRONT}}function ml(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i*1}function gl(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i*1}function Yc(e){if(e.length===0)return 0;for(var i=e[0]*1,r=1;r<e.length;r++)i+=e[r]*1;return i}function yl(e){if(e.length===0)throw new Error("mean requires at least one data point");return Yc(e)/e.length}function ru(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var i=e[0],r=NaN,n=0,a=1,s=1;s<e.length+1;s++)e[s]!==i?(a>n&&(n=a,r=i),a=1,i=e[s]):a++;return r*1}var vc={min:gl,max:ml,mean:yl,sum:Yc,mode:ru};function Gl(e,i){return e.map(function(r){return r[i]})}function Qf(e,i){return vc[e](i)}function Hl(e,i){var r=i.extent,n=r===void 0?[121.168,30.2828,121.384,30.4219]:r,a=new Promise(function(f){l(e,function(v){f(v)})}),s={originData:e,images:a,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return s}function l(e,i){var r=e,n=[];if(typeof r=="string")qf({url:r},function(f,v){n.push(v),i(n)});else{var a=r.length,s=0;r.forEach(function(f){qf({url:f},function(v,m){s++,n.push(m),s===a&&i(n)})})}return Hl}function h(e,i){var r=i.extent,n=i.width,a=i.height,s=i.min,f=i.max,v={_id:1,dataArray:[{_id:1,data:Array.from(e),width:n,height:a,min:s,max:f,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]};return v}var c=Q(30236),d=Q.n(c),E=Q(47037),w=Q.n(E),P=Q(23560),L=Q.n(P),U=Q(50361),H=Q.n(U),oe=Q(34155);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function ue(e,i,r,n){function a(s){return s instanceof r?s:new r(function(f){f(s)})}return new(r||(r=Promise))(function(s,f){function v(A){try{x(n.next(A))}catch(T){f(T)}}function m(A){try{x(n.throw(A))}catch(T){f(T)}}function x(A){A.done?s(A.value):a(A.value).then(v,m)}x((n=n.apply(e,i||[])).next())})}function le(e,i){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,a,s,f;return f={next:v(0),throw:v(1),return:v(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function v(x){return function(A){return m([x,A])}}function m(x){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(s=x[0]&2?a.return:x[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,x[1])).done)return s;switch(a=0,s&&(x=[x[0]&2,s.value]),x[0]){case 0:case 1:s=x;break;case 4:return r.label++,{value:x[1],done:!1};case 5:r.label++,a=x[1],x=[0];continue;case 7:x=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(x[0]===6||x[0]===2)){r=0;continue}if(x[0]===3&&(!s||x[1]>s[0]&&x[1]<s[3])){r.label=x[1];break}if(x[0]===6&&r.label<s[1]){r.label=s[1],s=x;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(x);break}s[2]&&r.ops.pop(),r.trys.pop();continue}x=i.call(e,r)}catch(A){x=[6,A],a=0}finally{n=s=0}if(x[0]&5)throw x[1];return{value:x[0]?x[1]:void 0,done:!0}}}function Ie(e,i){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),a,s=[],f;try{for(;(i===void 0||i-- >0)&&!(a=n.next()).done;)s.push(a.value)}catch(v){f={error:v}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(f)throw f.error}}return s}function Pe(){for(var e=[],i=0;i<arguments.length;i++)e=e.concat(Ie(arguments[i]));return e}function Ne(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function xe(e,i){return i={exports:{}},e(i,i.exports),i.exports}var je=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return n&&typeof n.length=="number"&&n.length>=0&&n.length%1==0}e.exports=i.default});Ne(je);var Ke=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return function(){for(var n=[],a=arguments.length;a--;)n[a]=arguments[a];var s=n.pop();return r.call(this,n,s)}},e.exports=i.default});Ne(Ke);var vt=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.fallback=a,i.wrap=s;var r=i.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,n=i.hasNextTick=typeof oe=="object"&&typeof oe.nextTick=="function";function a(v){setTimeout(v,0)}function s(v){return function(m){for(var x=[],A=arguments.length-1;A-- >0;)x[A]=arguments[A+1];return v(function(){return m.apply(void 0,x)})}}var f;r?f=setImmediate:n?f=oe.nextTick:f=a,i.default=s(f)});Ne(vt);var Wt=vt.fallback,jt=vt.wrap,qt=vt.hasSetImmediate,pr=vt.hasNextTick,kr=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(Ke),n=a(vt);function a(m){return m&&m.__esModule?m:{default:m}}function s(m){return(0,_r.isAsync)(m)?function(){for(var x=[],A=arguments.length;A--;)x[A]=arguments[A];var T=x.pop(),I=m.apply(this,x);return f(I,T)}:(0,r.default)(function(x,A){var T;try{T=m.apply(this,x)}catch(I){return A(I)}if(T&&typeof T.then=="function")return f(T,A);A(null,T)})}function f(m,x){return m.then(function(A){v(x,null,A)},function(A){v(x,A&&A.message?A:new Error(A))})}function v(m,x,A){try{m(x,A)}catch(T){(0,n.default)(function(I){throw I},T)}}e.exports=i.default});Ne(kr);var _r=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.isAsyncIterable=i.isAsyncGenerator=i.isAsync=void 0;var r=n(kr);function n(m){return m&&m.__esModule?m:{default:m}}function a(m){return m[Symbol.toStringTag]==="AsyncFunction"}function s(m){return m[Symbol.toStringTag]==="AsyncGenerator"}function f(m){return typeof m[Symbol.asyncIterator]=="function"}function v(m){if(typeof m!="function")throw new Error("expected a function");return a(m)?(0,r.default)(m):m}i.default=v,i.isAsync=a,i.isAsyncGenerator=s,i.isAsyncIterable=f});Ne(_r);var sn=_r.isAsyncIterable,Zn=_r.isAsyncGenerator,jn=_r.isAsync,kn=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n,a){if(a===void 0&&(a=n.length),!a)throw new Error("arity is undefined");function s(){for(var f=this,v=[],m=arguments.length;m--;)v[m]=arguments[m];return typeof v[a-1]=="function"?n.apply(this,v):new Promise(function(x,A){v[a-1]=function(T){for(var I=[],F=arguments.length-1;F-- >0;)I[F]=arguments[F+1];if(T)return A(T);x(I.length>1?I:I[0])},n.apply(f,v)})}return Object.defineProperty(s,"name",{configurable:!0,value:"awaitable("+n.name+")"}),s}e.exports=i.default});Ne(kn);var ki=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=s(je),n=s(_r),a=s(kn);function s(f){return f&&f.__esModule?f:{default:f}}i.default=(0,a.default)(function(f,v,m){var x=(0,r.default)(v)?[]:{};f(v,function(A,T,I){(0,n.default)(A)(function(F){for(var j,X=[],ee=arguments.length-1;ee-- >0;)X[ee]=arguments[ee+1];X.length<2&&(j=X,X=j[0]),x[T]=X,I(F)})},function(A){return m(A,x)})},3),e.exports=i.default});Ne(ki);var tn=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){function a(){for(var s=[],f=arguments.length;f--;)s[f]=arguments[f];if(n!==null){var v=n;n=null,v.apply(this,s)}}return Object.assign(a,n),a}e.exports=i.default});Ne(tn);var ii=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return r[Symbol.iterator]&&r[Symbol.iterator]()},e.exports=i.default});Ne(ii);var li=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=m;var r=a(je),n=a(ii);function a(x){return x&&x.__esModule?x:{default:x}}function s(x){var A=-1,T=x.length;return function(){return++A<T?{value:x[A],key:A}:null}}function f(x){var A=-1;return function(){var I=x.next();return I.done?null:(A++,{value:I.value,key:A})}}function v(x){var A=x?Object.keys(x):[],T=-1,I=A.length;return function(){var j=A[++T];return T<I?{value:x[j],key:j}:null}}function m(x){if((0,r.default)(x))return s(x);var A=(0,n.default)(x);return A?f(A):v(x)}e.exports=i.default});Ne(li);var $n=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];if(n===null)throw new Error("Callback was already called.");var f=n;n=null,f.apply(this,a)}}e.exports=i.default});Ne($n);var Hn=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r={};i.default=r,e.exports=i.default});Ne(Hn);var di=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=a;var r=n(Hn);function n(s){return s&&s.__esModule?s:{default:s}}function a(s,f,v,m){var x=!1,A=!1,T=!1,I=0,F=0;function j(){I>=f||T||x||(T=!0,s.next().then(function(be){var Fe=be.value,We=be.done;if(!(A||x)){if(T=!1,We){x=!0,I<=0&&m(null);return}I++,v(Fe,F,X),F++,j()}}).catch(ee))}function X(be,Fe){if(I-=1,!A){if(be)return ee(be);if(be===!1){x=!0,A=!0;return}if(Fe===r.default||x&&I<=0)return x=!0,m(null);j()}}function ee(be){A||(T=!1,x=!0,m(be))}j()}e.exports=i.default});Ne(di);var Kn=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=v(tn),n=v(li),a=v($n),s=v(di),f=v(Hn);function v(m){return m&&m.__esModule?m:{default:m}}i.default=function(m){return function(x,A,T){if(T=(0,r.default)(T),m<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!x)return T(null);if((0,_r.isAsyncGenerator)(x))return(0,s.default)(x,m,A,T);if((0,_r.isAsyncIterable)(x))return(0,s.default)(x[Symbol.asyncIterator](),m,A,T);var I=(0,n.default)(x),F=!1,j=!1,X=0,ee=!1;function be(We,et){if(!j)if(X-=1,We)F=!0,T(We);else if(We===!1)F=!0,j=!0;else{if(et===f.default||F&&X<=0)return F=!0,T(null);ee||Fe()}}function Fe(){for(ee=!0;X<m&&!F;){var We=I();if(We===null){F=!0,X<=0&&T(null);return}X+=1,A(We.value,We.key,(0,a.default)(be))}ee=!1}Fe()}},e.exports=i.default});Ne(Kn);var Xn=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=s(Kn),n=s(_r),a=s(kn);function s(v){return v&&v.__esModule?v:{default:v}}function f(v,m,x,A){return(0,r.default)(m)(v,(0,n.default)(x),A)}i.default=(0,a.default)(f,4),e.exports=i.default});Ne(Xn);var yo=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=a(Xn),n=a(kn);function a(f){return f&&f.__esModule?f:{default:f}}function s(f,v,m){return(0,r.default)(f,1,v,m)}i.default=(0,n.default)(s,3),e.exports=i.default});Ne(yo);var Ja=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(ki),n=a(yo);function a(f){return f&&f.__esModule?f:{default:f}}function s(f,v){return(0,r.default)(n.default,f,v)}e.exports=i.default}),To=Ne(Ja),ra=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return this.args=r,To(this.tasks)},e.prototype.tap=function(i,r){var n=this;this.tasks.push(function(a){r.apply(void 0,Pe(n.args)),a(null,i)})},e}(),Ha=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=x(je),n=x(Hn),a=x(Xn),s=x(tn),f=x($n),v=x(_r),m=x(kn);function x(F){return F&&F.__esModule?F:{default:F}}function A(F,j,X){X=(0,s.default)(X);var ee=0,be=0,Fe=F.length,We=!1;Fe===0&&X(null);function et(xt,Ct){xt===!1&&(We=!0),We!==!0&&(xt?X(xt):(++be===Fe||Ct===n.default)&&X(null))}for(;ee<Fe;ee++)j(F[ee],ee,(0,f.default)(et))}function T(F,j,X){return(0,a.default)(F,Infinity,j,X)}function I(F,j,X){var ee=(0,r.default)(F)?A:T;return ee(F,(0,v.default)(j),X)}i.default=(0,m.default)(I,3),e.exports=i.default});Ne(Ha);var ho=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(Ha),n=a(ki);function a(f){return f&&f.__esModule?f:{default:f}}function s(f,v){return(0,n.default)(r.default,f,v)}e.exports=i.default}),Rs=Ne(ho),ss=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.promise=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return Rs(this.tasks)},e.prototype.tapPromise=function(i,r){var n=this;this.tasks.push(function(a){return ue(n,void 0,void 0,function(){return le(this,function(s){switch(s.label){case 0:return[4,r()];case 1:return s.sent(),a(null,i),[2]}})})})},e}(),Bu=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=f(tn),n=f($n),a=f(_r),s=f(kn);function f(m){return m&&m.__esModule?m:{default:m}}function v(m,x){if(x=(0,r.default)(x),!Array.isArray(m))return x(new Error("First argument to waterfall must be an array of functions"));if(!m.length)return x();var A=0;function T(F){var j=(0,a.default)(m[A++]);j.apply(void 0,F.concat([(0,n.default)(I)]))}function I(F){for(var j=[],X=arguments.length-1;X-- >0;)j[X]=arguments[X+1];if(F!==!1){if(F||A===m.length)return x.apply(void 0,[F].concat(j));T(j)}}T([])}i.default=(0,s.default)(v),e.exports=i.default}),us=Ne(Bu),nu=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return us(this.tasks)},e.prototype.tap=function(i,r){this.tasks.length===0?this.tasks.push(function(n){var a=r();n(a?null:!1,a)}):this.tasks.push(function(n,a){var s=r();a(s?null:!1,i)})},e}(),Jo=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return To(this.tasks)},e.prototype.tap=function(i,r){this.tasks.push(function(n){var a=r();n(a,i)})},e}(),ls=Q(26729),Wl=Q.n(ls),Nu=Q(69848),_l=Q.n(Nu);function Xl(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function iu(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Xl(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Xl(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function xl(e,i){var r=i.radius,n=r===void 0?40:r,a=i.maxZoom,s=a===void 0?18:a,f=i.minZoom,v=f===void 0?0:f,m=i.zoom,x=m===void 0?2:m;if(e.pointIndex){var A=e.pointIndex.getClusters(e.extent,Math.floor(x));return e.dataArray=Su(A),e}var T=new(_l())({radius:n,minZoom:v,maxZoom:s}),I={type:"FeatureCollection",features:[]};return I.features=e.dataArray.map(function(F){return{type:"Feature",geometry:{type:"Point",coordinates:F.coordinates},properties:iu({},F)}}),T.load(I.features),T}function Su(e){return e.map(function(i,r){return iu({coordinates:i.geometry.coordinates,_id:r+1},i.properties)})}function Eo(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i}function zu(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i}function Uu(e){if(e.length===0)return 0;for(var i=e[0],r=0,n,a=1;a<e.length;a++)n=i+e[a]*1,Math.abs(i)>=Math.abs(e[a])?r+=i-n+e[a]:r+=e[a]-n+i,i=n;return i+r*1}function tl(e){if(e.length===0)throw new Error("mean requires at least one data point");return Uu(e)/e.length}var ca={min:zu,max:Eo,mean:tl,sum:Uu};function Us(e,i){return e.map(function(r){return r[i]*1})}function es(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function _u(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?es(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):es(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function qc(e){var i=Kc();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function Kc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Pf(e,i){if(Array.isArray(i))return i}var au=function(e){(0,Pr.Z)(r,e);var i=qc(r);function r(n,a){var s;return(0,ht.Z)(this,r),s=i.call(this),(0,S.Z)((0,J.Z)(s),"data",void 0),(0,S.Z)((0,J.Z)(s),"extent",void 0),(0,S.Z)((0,J.Z)(s),"hooks",{init:new ra}),(0,S.Z)((0,J.Z)(s),"parser",{type:"geojson"}),(0,S.Z)((0,J.Z)(s),"transforms",[]),(0,S.Z)((0,J.Z)(s),"cluster",!1),(0,S.Z)((0,J.Z)(s),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,S.Z)((0,J.Z)(s),"mapService",void 0),(0,S.Z)((0,J.Z)(s),"invalidExtent",!1),(0,S.Z)((0,J.Z)(s),"dataArrayChanged",!1),(0,S.Z)((0,J.Z)(s),"originData",void 0),(0,S.Z)((0,J.Z)(s),"rawData",void 0),(0,S.Z)((0,J.Z)(s),"cfg",{}),(0,S.Z)((0,J.Z)(s),"clusterIndex",void 0),s.originData=n,s.initCfg(a),s.hooks.init.tap("parser",function(){s.excuteParser()}),s.hooks.init.tap("cluster",function(){s.initCluster()}),s.hooks.init.tap("transform",function(){s.executeTrans()}),s.init(),s}return(0,Pt.Z)(r,[{key:"setData",value:function(a,s){this.originData=a,this.dataArrayChanged=!1,this.initCfg(s),this.init(),this.emit("update")}},{key:"getClusters",value:function(a){return this.clusterIndex.getClusters(this.caculClusterExtent(2),a)}},{key:"getClustersLeaves",value:function(a){return this.clusterIndex.getLeaves(a,Infinity)}},{key:"updateClusterData",value:function(a){var s=this,f=this.clusterOptions,v=f.method,m=v===void 0?"sum":v,x=f.field,A=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(a));this.clusterOptions.zoom=a,A.forEach(function(T){T.id||(T.properties.point_count=1)}),(x||L()(m))&&(A=A.map(function(T){var I=T.id;if(I){var F=s.clusterIndex.getLeaves(I,Infinity),j=F.map(function(be){return be.properties}),X;if(w()(m)&&x){var ee=Us(j,x);X=ca[m](ee)}L()(m)&&(X=m(j)),T.properties.stat=X}else T.properties.point_count=1;return T})),this.data=de("geojson")({type:"FeatureCollection",features:A}),this.executeTrans()}},{key:"getFeatureById",value:function(a){var s=this.parser.type,f=s===void 0?"geojson":s;if(f==="geojson"&&!this.cluster){var v=a<this.originData.features.length?this.originData.features[a]:"null",m=H()(v);if(this.transforms.length!==0||this.dataArrayChanged){var x=this.data.dataArray.find(function(A){return A._id===a});m.properties=x}return m}else return a<this.data.dataArray.length?this.data.dataArray[a]:"null"}},{key:"updateFeaturePropertiesById",value:function(a,s){this.data.dataArray=this.data.dataArray.map(function(f){return f._id===a?_u(_u({},f),s):f}),this.dataArrayChanged=!0,this.emit("update")}},{key:"getFeatureId",value:function(a,s){var f=this.data.dataArray.find(function(v){return v[a]===s});return f==null?void 0:f._id}},{key:"destroy",value:function(){this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null}},{key:"caculClusterExtent",value:function(a){var s=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(s=In(Hc(this.extent),a)),s[0].concat(s[1])}},{key:"initCfg",value:function(a){this.cfg=d()(this.cfg,a,Pf);var s=this.cfg;s&&(s.parser&&(this.parser=s.parser),s.transforms&&(this.transforms=s.transforms),this.cluster=s.cluster||!1,s.clusterOptions&&(this.cluster=!0,this.clusterOptions=_u(_u({},this.clusterOptions),s.clusterOptions)))}},{key:"excuteParser",value:function(){var a=this.parser,s=a.type||"geojson";if(s==="imagetile"){this.data={tileurl:this.originData,dataArray:[]};return}var f=de(s);this.data=f(this.originData,a),this.extent=Kf(this.data.dataArray),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3]}},{key:"executeTrans",value:function(){var a=this,s=this.transforms;s.forEach(function(f){var v=f.type,m=_e(v)(a.data,f);Object.assign(a.data,m)})}},{key:"initCluster",value:function(){if(!!this.cluster){var a=this.clusterOptions||{};this.clusterIndex=xl(this.data,a)}}},{key:"init",value:function(){this.hooks.init.call(this)}}]),r}(ls.EventEmitter);function mc(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.filter(r)),e}function ou(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=bl(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function bl(e,i){if(!!e){if(typeof e=="string")return gc(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return gc(e,i)}}function gc(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var su=6378e3;function Bo(e,i){var r=e.dataArray,n=i.size,a=n===void 0?10:n,s=a/(2*Math.PI*su)*(256<<20)/2,f=$c(r,a),v=f.gridHash,m=f.gridOffset,x=pp(v,m,i);return{yOffset:s,xOffset:s,radius:s,type:"grid",dataArray:x}}function $c(e,i){var r=Infinity,n=-Infinity,a,s=ou(e),f;try{for(s.s();!(f=s.n()).done;){var v=f.value;a=v.coordinates[1],Number.isFinite(a)&&(r=a<r?a:r,n=a>n?a:n)}}catch(We){s.e(We)}finally{s.f()}var m=(r+n)/2,x=Jf(i,m);if(x.xOffset<=0||x.yOffset<=0)return{gridHash:{},gridOffset:x};var A={},T=ou(e),I;try{for(T.s();!(I=T.n()).done;){var F=I.value,j=F.coordinates[1],X=F.coordinates[0];if(Number.isFinite(j)&&Number.isFinite(X)){var ee=Math.floor((j+90)/x.yOffset),be=Math.floor((X+180)/x.xOffset),Fe="".concat(ee,"-").concat(be);A[Fe]=A[Fe]||{count:0,points:[]},A[Fe].count+=1,A[Fe].points.push(F)}}}catch(We){T.e(We)}finally{T.f()}return{gridHash:A,gridOffset:x}}function Jf(e,i){var r=kh(e),n=eh(i,e);return{yOffset:r,xOffset:n}}function kh(e){return e/su*(180/Math.PI)}function eh(e,i){return i/su*(180/Math.PI)/Math.cos(e*Math.PI/180)}function pp(e,i,r){return Object.keys(e).reduce(function(n,a,s){var f=a.split("-"),v=parseInt(f[0],10),m=parseInt(f[1],10),x={};if(r.field&&r.method){var A=Gl(e[a].points,r.field);x[r.method]=vc[r.method](A)}return Object.assign(x,{_id:s,coordinates:as([-180+i.xOffset*(m+.5),-90+i.yOffset*(v+.5)]),rawData:e[a].points,count:e[a].count}),n.push(x),n},[])}var yc=Math.PI/3,_c=[0,yc,2*yc,3*yc,4*yc,5*yc];function Of(e){return e[0]}function Lh(e){return e[1]}function qp(){var e=0,i=0,r=1,n=1,a=Of,s=Lh,f,v,m;function x(T){var I={},F=[],j,X=T.length;for(j=0;j<X;++j)if(!(isNaN(be=+a.call(null,ee=T[j],j,T))||isNaN(Fe=+s.call(null,ee,j,T)))){var ee,be,Fe,We=Math.round(Fe=Fe/m),et=Math.round(be=be/v-(We&1)/2),xt=Fe-We;if(Math.abs(xt)*3>1){var Ct=be-et,Yt=et+(be<et?-1:1)/2,ar=We+(Fe<We?-1:1),Ar=be-Yt,Qr=Fe-ar;Ct*Ct+xt*xt>Ar*Ar+Qr*Qr&&(et=Yt+(We&1?1:-1)/2,We=ar)}var vr=et+"-"+We,pn=I[vr];pn?pn.push(ee):(F.push(pn=I[vr]=[ee]),pn.x=(et+(We&1)/2)*v,pn.y=We*m)}return F}function A(T){var I=0,F=0;return _c.map(function(j){var X=Math.sin(j)*T,ee=-Math.cos(j)*T,be=X-I,Fe=ee-F;return I=X,F=ee,[be,Fe]})}return x.hexagon=function(T){return"m"+A(T==null?f:+T).join("l")+"z"},x.centers=function(){for(var T=[],I=Math.round(i/m),F=Math.round(e/v),j=I*m;j<n+f;j+=m,++I)for(var X=F*v+(I&1)*v/2;X<r+v/2;X+=v)T.push([X,j]);return T},x.mesh=function(){var T=A(f).slice(0,4).join("l");return x.centers().map(function(I){return"M"+I+"m"+T}).join("")},x.x=function(T){return arguments.length?(a=T,x):a},x.y=function(T){return arguments.length?(s=T,x):s},x.radius=function(T){return arguments.length?(f=+T,v=f*2*Math.sin(yc),m=f*1.5,x):f},x.size=function(T){return arguments.length?(e=i=0,r=+T[0],n=+T[1],x):[r-e,n-i]},x.extent=function(T){return arguments.length?(e=+T[0][0],i=+T[0][1],r=+T[1][0],n=+T[1][1],x):[[e,i],[r,n]]},x.radius(1)}function El(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Qc(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?El(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):El(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Kp=6378e3;function Pd(e,i){var r=e.dataArray,n=i.size,a=n===void 0?10:n,s=i.method,f=s===void 0?"sum":s,v=a/(2*Math.PI*Kp)*(256<<20)/2,m=r.map(function(I){var F=as(I.coordinates),j=(0,dn.Z)(F,2),X=j[0],ee=j[1];return Qc(Qc({},I),{},{coordinates:[X,ee]})}),x=qp().radius(v).x(function(I){return I.coordinates[0]}).y(function(I){return I.coordinates[1]}),A=x(m),T={dataArray:A.map(function(I,F){var j;if(i.field&&f){var X=Gl(I,i.field);I[f]=vc[f](X)}return j={},(0,S.Z)(j,i.method,I[f]),(0,S.Z)(j,"count",I.length),(0,S.Z)(j,"rawData",I),(0,S.Z)(j,"coordinates",[I.x,I.y]),(0,S.Z)(j,"_id",F),j}),radius:v,xOffset:v,yOffset:v,type:"hexagon"};return T}function Jc(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Dh(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Jc(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Jc(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Od(e,i){var r=i.sourceField,n=i.targetField,a=i.data,s={};return a.forEach(function(f){s[f[r]]=f}),e.dataArray=e.dataArray.map(function(f){var v=f[n];return Dh(Dh({},f),s[v])}),e}function Id(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.map(r)),e}ze("geojson",Wr),ze("image",Hl),ze("csv",Gr),ze("json",Ft),ze("raster",h),tt("cluster",xl),tt("filter",mc),tt("join",Od),tt("map",Id),tt("grid",Bo),tt("hexagon",Pd);var $p=yr,dp=Yn,Fh=au,th=Q(28660),Xr=Q(86700),Mo=Q(84879),yt={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},Qp=Q(31745),Bh=Q.n(Qp);function rh(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function If(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?rh(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rh(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function nh(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=ih(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function ih(e,i){if(!!e){if(typeof e=="string")return Yl(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Yl(e,i)}}function Yl(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Sl=30;function ah(e){var i=e.characterSet,r=e.getFontWidth,n=e.fontHeight,a=e.buffer,s=e.maxCanvasWidth,f=e.mapping,v=f===void 0?{}:f,m=e.xOffset,x=m===void 0?0:m,A=e.yOffset,T=A===void 0?0:A,I=0,F=x;Array.from(i).forEach(function(X,ee){if(!v[X]){var be=r(X,ee);F+Sl>s&&(F=0,I++),v[X]={x:F,y:T+I*Sl,width:Sl,height:Sl,advance:be},F+=Sl}});var j=n+a*2;return{mapping:v,xOffset:F,yOffset:T+I*j,canvasHeight:oh(T+(I+1)*j)}}function Nh(e,i,r){var n=0,a=0,s=0,f=[],v={},m=nh(e),x;try{for(m.s();!(x=m.n()).done;){var A=x.value;if(!v[A.id]){var T=A.size;n+T+i>r&&(ql(v,f,a),n=0,a=s+a+i,s=0,f=[]),f.push({icon:A,xOffset:n}),n=n+T+i,s=Math.max(s,T)}}}catch(F){m.e(F)}finally{m.f()}f.length>0&&ql(v,f,a);var I=oh(s+a+i);return{mapping:v,canvasHeight:I}}function ql(e,i,r){var n=nh(i),a;try{for(n.s();!(a=n.n()).done;){var s=a.value,f=s.icon,v=s.xOffset;e[f.id]=If(If({},f),{},{x:v,y:r,image:f.image,width:f.width,height:f.height})}}catch(m){n.e(m)}finally{n.f()}}function oh(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var Rf,sh;function ef(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=kf(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function kf(e,i){if(!!e){if(typeof e=="string")return Zs(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Zs(e,i)}}function Zs(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Lf(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function tf(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Lf(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Lf(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var uh=Zh(),lh="sans-serif",zh="normal",Cl=24,rf=3,Jp=.25,Uh=8,vp=1024,Rd=1,ed=1,Cu=3,kd=null;function Zh(){for(var e=[],i=32;i<128;i++)e.push(String.fromCharCode(i));return e}function nf(e,i,r,n){e.font="".concat(n," ").concat(r,"px ").concat(i),e.fillStyle="black",e.textBaseline="middle"}function Zu(e,i){for(var r=0;r<e.length;r++)i.data[4*r+3]=e[r]}var td=(Rf=(0,Xr.b2)(),Rf(sh=function(){function e(){(0,ht.Z)(this,e),(0,S.Z)(this,"fontAtlas",void 0),(0,S.Z)(this,"iconFontMap",void 0),(0,S.Z)(this,"iconFontGlyphs",{}),(0,S.Z)(this,"fontOptions",void 0),(0,S.Z)(this,"key",void 0),(0,S.Z)(this,"cache",new La(Cu))}return(0,Pt.Z)(e,[{key:"scale",get:function(){return ed}},{key:"canvas",get:function(){var r=this.cache.get(this.key);return r&&r.data}},{key:"mapping",get:function(){var r=this.cache.get(this.key);return r&&r.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:lh,fontWeight:zh,characterSet:uh,fontSize:Cl,buffer:rf,sdf:!0,cutoff:Jp,radius:Uh,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(r){var n=this;r.forEach(function(a){n.iconFontGlyphs[a.name]=a.unicode})}},{key:"addIconFont",value:function(r,n){this.iconFontMap.set(r,n)}},{key:"getIconFontKey",value:function(r){return this.iconFontMap.get(r)||r}},{key:"getGlyph",value:function(r){return this.iconFontGlyphs[r]?String.fromCharCode(parseInt(this.iconFontGlyphs[r],16)):""}},{key:"setFontOptions",value:function(r){this.fontOptions=tf(tf({},this.fontOptions),r),this.key=this.getKey();var n=this.getNewChars(this.key,this.fontOptions.characterSet),a=this.cache.get(this.key);if(!(a&&n.length===0)){var s=this.generateFontAtlas(this.key,n,a);this.fontAtlas=s,this.cache.set(this.key,s)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(r,n,a){var s=this.fontOptions,f=s.fontFamily,v=s.fontWeight,m=s.fontSize,x=s.buffer,A=s.sdf,T=s.radius,I=s.cutoff,F=s.iconfont,j=a&&a.data;j||(j=ha.document.createElement("canvas"),j.width=vp);var X=j.getContext("2d");nf(X,f,m,v);var ee=ah(tf({getFontWidth:function(Ls){return X.measureText(Ls).width},fontHeight:m*ed,buffer:x,characterSet:n,maxCanvasWidth:vp},a&&{mapping:a.mapping,xOffset:a.xOffset,yOffset:a.yOffset})),be=ee.mapping,Fe=ee.canvasHeight,We=ee.xOffset,et=ee.yOffset,xt=X.getImageData(0,0,j.width,j.height);if(j.height=Fe,X.putImageData(xt,0,0),nf(X,f,m,v),A){var Ct=new(Bh())(m,x,T,I,f,v),Yt=X.getImageData(0,0,Ct.size,Ct.size),ar=ef(n),Ar;try{for(ar.s();!(Ar=ar.n()).done;){var Qr=Ar.value;if(F){var vr=String.fromCharCode(parseInt(Qr.replace("&#x","").replace(";",""),16)),pn=Ct.draw(vr);Zu(pn,Yt)}else Zu(Ct.draw(Qr),Yt);X.putImageData(Yt,be[Qr].x,be[Qr].y)}}catch(qo){ar.e(qo)}finally{ar.f()}}else{var Tn=ef(n),qn;try{for(Tn.s();!(qn=Tn.n()).done;){var Ba=qn.value;X.fillText(Ba,be[Ba].x,be[Ba].y+m*Rd)}}catch(qo){Tn.e(qo)}finally{Tn.f()}}return{xOffset:We,yOffset:et,mapping:be,data:j,width:j.width,height:j.height}}},{key:"getKey",value:function(){return"key";var r,n,a,s,f,v,m,x}},{key:"getNewChars",value:function(r,n){var a=this.cache.get(r);if(!a)return n;var s=[],f=a.mapping,v=new Set(Object.keys(f)),m=new Set(n);return m.forEach(function(x){v.has(x)||s.push(x)}),s}}]),e}())||sh),rd,rl;function Df(e){var i=af();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function af(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xc=3,mp=1024,of=64,jh=(rd=(0,Xr.b2)(),rd(rl=function(e){(0,Pr.Z)(r,e);var i=Df(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"canvasHeight",128),(0,S.Z)((0,J.Z)(n),"texture",void 0),(0,S.Z)((0,J.Z)(n),"canvas",void 0),(0,S.Z)((0,J.Z)(n),"iconData",void 0),(0,S.Z)((0,J.Z)(n),"iconMap",void 0),(0,S.Z)((0,J.Z)(n),"ctx",void 0),(0,S.Z)((0,J.Z)(n),"loadingImageCount",0),n}return(0,Pt.Z)(r,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=ha.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(a,s){var f=this,v=new Image;if(this.loadingImageCount++,this.hasImage(a))throw new Error("Image Id already exists");this.iconData.push({id:a,size:of}),this.updateIconMap(),this.loadImage(s).then(function(m){v=m;var x=f.iconData.find(function(A){return A.id===a});x&&(x.image=v,x.width=v.width,x.height=v.height),f.update()})}},{key:"addImageMini",value:function(a,s,f){var v=this,m=f.getSceneConfig().canvas,x=m.createImage();if(this.loadingImageCount++,this.hasImage(a))throw new Error("Image Id already exists");this.iconData.push({id:a,size:of}),this.updateIconMap(),this.loadImageMini(s,m).then(function(A){x=A;var T=v.iconData.find(function(I){return I.id===a});T&&(T.image=x,T.width=x.width,T.height=x.height),v.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(a){return this.iconMap.hasOwnProperty(a)}},{key:"removeImage",value:function(a){this.hasImage(a)&&(this.iconData=this.iconData.filter(function(s){return s.id!==a}),delete this.iconMap[a],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(a){return new Promise(function(s,f){if(a instanceof HTMLImageElement){s(a);return}var v=new Image;v.crossOrigin="anonymous",v.onload=function(){s(v)},v.onerror=function(){f(new Error("Could not load image at "+a))},v.src=a instanceof File?URL.createObjectURL(a):a})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var a=this;this.canvas.width=mp,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(s){var f=a.iconMap[s],v=f.x,m=f.y,x=f.image,A=f.width,T=A===void 0?64:A,I=f.height,F=I===void 0?64:I,j=Math.max(T,F),X=j/of,ee=F/X,be=T/X;x&&a.ctx.drawImage(x,v+(of-be)/2,m+(of-ee)/2,be,ee)})}},{key:"updateIconMap",value:function(){var a=Nh(this.iconData,xc,mp),s=a.mapping,f=a.canvasHeight;this.iconMap=s,this.canvasHeight=f}},{key:"loadImageMini",value:function(a,s){return new Promise(function(f,v){var m=s.createImage();m.crossOrigin="anonymous",m.onload=function(){f(m)},m.onerror=function(){v(new Error("Could not load image at "+a))},m.src=a})}}]),r}(ls.EventEmitter))||rl),Oa=Q(49685);function qi(){var e=new Oa.WT(16);return Oa.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function bc(e){var i=new Oa.WT(16);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function Po(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function js(e,i,r,n,a,s,f,v,m,x,A,T,I,F,j,X){var ee=new Oa.WT(16);return ee[0]=e,ee[1]=i,ee[2]=r,ee[3]=n,ee[4]=a,ee[5]=s,ee[6]=f,ee[7]=v,ee[8]=m,ee[9]=x,ee[10]=A,ee[11]=T,ee[12]=I,ee[13]=F,ee[14]=j,ee[15]=X,ee}function nd(e,i,r,n,a,s,f,v,m,x,A,T,I,F,j,X,ee){return e[0]=i,e[1]=r,e[2]=n,e[3]=a,e[4]=s,e[5]=f,e[6]=v,e[7]=m,e[8]=x,e[9]=A,e[10]=T,e[11]=I,e[12]=F,e[13]=j,e[14]=X,e[15]=ee,e}function gp(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ld(e,i){if(e===i){var r=i[1],n=i[2],a=i[3],s=i[6],f=i[7],v=i[11];e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=r,e[6]=i[9],e[7]=i[13],e[8]=n,e[9]=s,e[11]=i[14],e[12]=a,e[13]=f,e[14]=v}else e[0]=i[0],e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=i[1],e[5]=i[5],e[6]=i[9],e[7]=i[13],e[8]=i[2],e[9]=i[6],e[10]=i[10],e[11]=i[14],e[12]=i[3],e[13]=i[7],e[14]=i[11],e[15]=i[15];return e}function Vh(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],f=i[4],v=i[5],m=i[6],x=i[7],A=i[8],T=i[9],I=i[10],F=i[11],j=i[12],X=i[13],ee=i[14],be=i[15],Fe=r*v-n*f,We=r*m-a*f,et=r*x-s*f,xt=n*m-a*v,Ct=n*x-s*v,Yt=a*x-s*m,ar=A*X-T*j,Ar=A*ee-I*j,Qr=A*be-F*j,vr=T*ee-I*X,pn=T*be-F*X,Tn=I*be-F*ee,qn=Fe*Tn-We*pn+et*vr+xt*Qr-Ct*Ar+Yt*ar;return qn?(qn=1/qn,e[0]=(v*Tn-m*pn+x*vr)*qn,e[1]=(a*pn-n*Tn-s*vr)*qn,e[2]=(X*Yt-ee*Ct+be*xt)*qn,e[3]=(I*Ct-T*Yt-F*xt)*qn,e[4]=(m*Qr-f*Tn-x*Ar)*qn,e[5]=(r*Tn-a*Qr+s*Ar)*qn,e[6]=(ee*et-j*Yt-be*We)*qn,e[7]=(A*Yt-I*et+F*We)*qn,e[8]=(f*pn-v*Qr+x*ar)*qn,e[9]=(n*Qr-r*pn-s*ar)*qn,e[10]=(j*Ct-X*et+be*Fe)*qn,e[11]=(T*et-A*Ct-F*Fe)*qn,e[12]=(v*Ar-f*vr-m*ar)*qn,e[13]=(r*vr-n*Ar+a*ar)*qn,e[14]=(X*We-j*xt-ee*Fe)*qn,e[15]=(A*xt-T*We+I*Fe)*qn,e):null}function Dd(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],f=i[4],v=i[5],m=i[6],x=i[7],A=i[8],T=i[9],I=i[10],F=i[11],j=i[12],X=i[13],ee=i[14],be=i[15];return e[0]=v*(I*be-F*ee)-T*(m*be-x*ee)+X*(m*F-x*I),e[1]=-(n*(I*be-F*ee)-T*(a*be-s*ee)+X*(a*F-s*I)),e[2]=n*(m*be-x*ee)-v*(a*be-s*ee)+X*(a*x-s*m),e[3]=-(n*(m*F-x*I)-v*(a*F-s*I)+T*(a*x-s*m)),e[4]=-(f*(I*be-F*ee)-A*(m*be-x*ee)+j*(m*F-x*I)),e[5]=r*(I*be-F*ee)-A*(a*be-s*ee)+j*(a*F-s*I),e[6]=-(r*(m*be-x*ee)-f*(a*be-s*ee)+j*(a*x-s*m)),e[7]=r*(m*F-x*I)-f*(a*F-s*I)+A*(a*x-s*m),e[8]=f*(T*be-F*X)-A*(v*be-x*X)+j*(v*F-x*T),e[9]=-(r*(T*be-F*X)-A*(n*be-s*X)+j*(n*F-s*T)),e[10]=r*(v*be-x*X)-f*(n*be-s*X)+j*(n*x-s*v),e[11]=-(r*(v*F-x*T)-f*(n*F-s*T)+A*(n*x-s*v)),e[12]=-(f*(T*ee-I*X)-A*(v*ee-m*X)+j*(v*I-m*T)),e[13]=r*(T*ee-I*X)-A*(n*ee-a*X)+j*(n*I-a*T),e[14]=-(r*(v*ee-m*X)-f*(n*ee-a*X)+j*(n*m-a*v)),e[15]=r*(v*I-m*T)-f*(n*I-a*T)+A*(n*m-a*v),e}function yp(e){var i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],f=e[5],v=e[6],m=e[7],x=e[8],A=e[9],T=e[10],I=e[11],F=e[12],j=e[13],X=e[14],ee=e[15],be=i*f-r*s,Fe=i*v-n*s,We=i*m-a*s,et=r*v-n*f,xt=r*m-a*f,Ct=n*m-a*v,Yt=x*j-A*F,ar=x*X-T*F,Ar=x*ee-I*F,Qr=A*X-T*j,vr=A*ee-I*j,pn=T*ee-I*X;return be*pn-Fe*vr+We*Qr+et*Ar-xt*ar+Ct*Yt}function Al(e,i,r){var n=i[0],a=i[1],s=i[2],f=i[3],v=i[4],m=i[5],x=i[6],A=i[7],T=i[8],I=i[9],F=i[10],j=i[11],X=i[12],ee=i[13],be=i[14],Fe=i[15],We=r[0],et=r[1],xt=r[2],Ct=r[3];return e[0]=We*n+et*v+xt*T+Ct*X,e[1]=We*a+et*m+xt*I+Ct*ee,e[2]=We*s+et*x+xt*F+Ct*be,e[3]=We*f+et*A+xt*j+Ct*Fe,We=r[4],et=r[5],xt=r[6],Ct=r[7],e[4]=We*n+et*v+xt*T+Ct*X,e[5]=We*a+et*m+xt*I+Ct*ee,e[6]=We*s+et*x+xt*F+Ct*be,e[7]=We*f+et*A+xt*j+Ct*Fe,We=r[8],et=r[9],xt=r[10],Ct=r[11],e[8]=We*n+et*v+xt*T+Ct*X,e[9]=We*a+et*m+xt*I+Ct*ee,e[10]=We*s+et*x+xt*F+Ct*be,e[11]=We*f+et*A+xt*j+Ct*Fe,We=r[12],et=r[13],xt=r[14],Ct=r[15],e[12]=We*n+et*v+xt*T+Ct*X,e[13]=We*a+et*m+xt*I+Ct*ee,e[14]=We*s+et*x+xt*F+Ct*be,e[15]=We*f+et*A+xt*j+Ct*Fe,e}function ch(e,i,r){var n=r[0],a=r[1],s=r[2],f,v,m,x,A,T,I,F,j,X,ee,be;return i===e?(e[12]=i[0]*n+i[4]*a+i[8]*s+i[12],e[13]=i[1]*n+i[5]*a+i[9]*s+i[13],e[14]=i[2]*n+i[6]*a+i[10]*s+i[14],e[15]=i[3]*n+i[7]*a+i[11]*s+i[15]):(f=i[0],v=i[1],m=i[2],x=i[3],A=i[4],T=i[5],I=i[6],F=i[7],j=i[8],X=i[9],ee=i[10],be=i[11],e[0]=f,e[1]=v,e[2]=m,e[3]=x,e[4]=A,e[5]=T,e[6]=I,e[7]=F,e[8]=j,e[9]=X,e[10]=ee,e[11]=be,e[12]=f*n+A*a+j*s+i[12],e[13]=v*n+T*a+X*s+i[13],e[14]=m*n+I*a+ee*s+i[14],e[15]=x*n+F*a+be*s+i[15]),e}function Kl(e,i,r){var n=r[0],a=r[1],s=r[2];return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=i[3]*n,e[4]=i[4]*a,e[5]=i[5]*a,e[6]=i[6]*a,e[7]=i[7]*a,e[8]=i[8]*s,e[9]=i[9]*s,e[10]=i[10]*s,e[11]=i[11]*s,e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function id(e,i,r,n){var a=n[0],s=n[1],f=n[2],v=Math.hypot(a,s,f),m,x,A,T,I,F,j,X,ee,be,Fe,We,et,xt,Ct,Yt,ar,Ar,Qr,vr,pn,Tn,qn,Ba;return v<Oa.Ib?null:(v=1/v,a*=v,s*=v,f*=v,m=Math.sin(r),x=Math.cos(r),A=1-x,T=i[0],I=i[1],F=i[2],j=i[3],X=i[4],ee=i[5],be=i[6],Fe=i[7],We=i[8],et=i[9],xt=i[10],Ct=i[11],Yt=a*a*A+x,ar=s*a*A+f*m,Ar=f*a*A-s*m,Qr=a*s*A-f*m,vr=s*s*A+x,pn=f*s*A+a*m,Tn=a*f*A+s*m,qn=s*f*A-a*m,Ba=f*f*A+x,e[0]=T*Yt+X*ar+We*Ar,e[1]=I*Yt+ee*ar+et*Ar,e[2]=F*Yt+be*ar+xt*Ar,e[3]=j*Yt+Fe*ar+Ct*Ar,e[4]=T*Qr+X*vr+We*pn,e[5]=I*Qr+ee*vr+et*pn,e[6]=F*Qr+be*vr+xt*pn,e[7]=j*Qr+Fe*vr+Ct*pn,e[8]=T*Tn+X*qn+We*Ba,e[9]=I*Tn+ee*qn+et*Ba,e[10]=F*Tn+be*qn+xt*Ba,e[11]=j*Tn+Fe*qn+Ct*Ba,i!==e&&(e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e)}function fh(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[4],f=i[5],v=i[6],m=i[7],x=i[8],A=i[9],T=i[10],I=i[11];return i!==e&&(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[4]=s*a+x*n,e[5]=f*a+A*n,e[6]=v*a+T*n,e[7]=m*a+I*n,e[8]=x*a-s*n,e[9]=A*a-f*n,e[10]=T*a-v*n,e[11]=I*a-m*n,e}function sf(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[0],f=i[1],v=i[2],m=i[3],x=i[8],A=i[9],T=i[10],I=i[11];return i!==e&&(e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=s*a-x*n,e[1]=f*a-A*n,e[2]=v*a-T*n,e[3]=m*a-I*n,e[8]=s*n+x*a,e[9]=f*n+A*a,e[10]=v*n+T*a,e[11]=m*n+I*a,e}function Ea(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[0],f=i[1],v=i[2],m=i[3],x=i[4],A=i[5],T=i[6],I=i[7];return i!==e&&(e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=s*a+x*n,e[1]=f*a+A*n,e[2]=v*a+T*n,e[3]=m*a+I*n,e[4]=x*a-s*n,e[5]=A*a-f*n,e[6]=T*a-v*n,e[7]=I*a-m*n,e}function Gh(e,i){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function $l(e,i){return e[0]=i[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=i[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ff(e,i,r){var n=r[0],a=r[1],s=r[2],f=Math.hypot(n,a,s),v,m,x;return f<Oa.Ib?null:(f=1/f,n*=f,a*=f,s*=f,v=Math.sin(i),m=Math.cos(i),x=1-m,e[0]=n*n*x+m,e[1]=a*n*x+s*v,e[2]=s*n*x-a*v,e[3]=0,e[4]=n*a*x-s*v,e[5]=a*a*x+m,e[6]=s*a*x+n*v,e[7]=0,e[8]=n*s*x+a*v,e[9]=a*s*x-n*v,e[10]=s*s*x+m,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function _p(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Fd(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function N(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ce(e,i,r){var n=i[0],a=i[1],s=i[2],f=i[3],v=n+n,m=a+a,x=s+s,A=n*v,T=n*m,I=n*x,F=a*m,j=a*x,X=s*x,ee=f*v,be=f*m,Fe=f*x;return e[0]=1-(F+X),e[1]=T+Fe,e[2]=I-be,e[3]=0,e[4]=T-Fe,e[5]=1-(A+X),e[6]=j+ee,e[7]=0,e[8]=I+be,e[9]=j-ee,e[10]=1-(A+F),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Be(e,i){var r=new Oa.WT(3),n=-i[0],a=-i[1],s=-i[2],f=i[3],v=i[4],m=i[5],x=i[6],A=i[7],T=n*n+a*a+s*s+f*f;return T>0?(r[0]=(v*f+A*n+m*s-x*a)*2/T,r[1]=(m*f+A*a+x*n-v*s)*2/T,r[2]=(x*f+A*s+v*a-m*n)*2/T):(r[0]=(v*f+A*n+m*s-x*a)*2,r[1]=(m*f+A*a+x*n-v*s)*2,r[2]=(x*f+A*s+v*a-m*n)*2),ce(e,i,r),e}function Dt(e,i){return e[0]=i[12],e[1]=i[13],e[2]=i[14],e}function rr(e,i){var r=i[0],n=i[1],a=i[2],s=i[4],f=i[5],v=i[6],m=i[8],x=i[9],A=i[10];return e[0]=Math.hypot(r,n,a),e[1]=Math.hypot(s,f,v),e[2]=Math.hypot(m,x,A),e}function Rt(e,i){var r=new Oa.WT(3);rr(r,i);var n=1/r[0],a=1/r[1],s=1/r[2],f=i[0]*n,v=i[1]*a,m=i[2]*s,x=i[4]*n,A=i[5]*a,T=i[6]*s,I=i[8]*n,F=i[9]*a,j=i[10]*s,X=f+A+j,ee=0;return X>0?(ee=Math.sqrt(X+1)*2,e[3]=.25*ee,e[0]=(T-F)/ee,e[1]=(I-m)/ee,e[2]=(v-x)/ee):f>A&&f>j?(ee=Math.sqrt(1+f-A-j)*2,e[3]=(T-F)/ee,e[0]=.25*ee,e[1]=(v+x)/ee,e[2]=(I+m)/ee):A>j?(ee=Math.sqrt(1+A-f-j)*2,e[3]=(I-m)/ee,e[0]=(v+x)/ee,e[1]=.25*ee,e[2]=(T+F)/ee):(ee=Math.sqrt(1+j-f-A)*2,e[3]=(v-x)/ee,e[0]=(I+m)/ee,e[1]=(T+F)/ee,e[2]=.25*ee),e}function Qt(e,i,r,n){var a=i[0],s=i[1],f=i[2],v=i[3],m=a+a,x=s+s,A=f+f,T=a*m,I=a*x,F=a*A,j=s*x,X=s*A,ee=f*A,be=v*m,Fe=v*x,We=v*A,et=n[0],xt=n[1],Ct=n[2];return e[0]=(1-(j+ee))*et,e[1]=(I+We)*et,e[2]=(F-Fe)*et,e[3]=0,e[4]=(I-We)*xt,e[5]=(1-(T+ee))*xt,e[6]=(X+be)*xt,e[7]=0,e[8]=(F+Fe)*Ct,e[9]=(X-be)*Ct,e[10]=(1-(T+j))*Ct,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function lr(e,i,r,n,a){var s=i[0],f=i[1],v=i[2],m=i[3],x=s+s,A=f+f,T=v+v,I=s*x,F=s*A,j=s*T,X=f*A,ee=f*T,be=v*T,Fe=m*x,We=m*A,et=m*T,xt=n[0],Ct=n[1],Yt=n[2],ar=a[0],Ar=a[1],Qr=a[2],vr=(1-(X+be))*xt,pn=(F+et)*xt,Tn=(j-We)*xt,qn=(F-et)*Ct,Ba=(1-(I+be))*Ct,qo=(ee+Fe)*Ct,Ls=(j+We)*Yt,Ds=(ee-Fe)*Yt,Ys=(1-(I+X))*Yt;return e[0]=vr,e[1]=pn,e[2]=Tn,e[3]=0,e[4]=qn,e[5]=Ba,e[6]=qo,e[7]=0,e[8]=Ls,e[9]=Ds,e[10]=Ys,e[11]=0,e[12]=r[0]+ar-(vr*ar+qn*Ar+Ls*Qr),e[13]=r[1]+Ar-(pn*ar+Ba*Ar+Ds*Qr),e[14]=r[2]+Qr-(Tn*ar+qo*Ar+Ys*Qr),e[15]=1,e}function dr(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],f=r+r,v=n+n,m=a+a,x=r*f,A=n*f,T=n*v,I=a*f,F=a*v,j=a*m,X=s*f,ee=s*v,be=s*m;return e[0]=1-T-j,e[1]=A+be,e[2]=I-ee,e[3]=0,e[4]=A-be,e[5]=1-x-j,e[6]=F+X,e[7]=0,e[8]=I+ee,e[9]=F-X,e[10]=1-x-T,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function xr(e,i,r,n,a,s,f){var v=1/(r-i),m=1/(a-n),x=1/(s-f);return e[0]=s*2*v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s*2*m,e[6]=0,e[7]=0,e[8]=(r+i)*v,e[9]=(a+n)*m,e[10]=(f+s)*x,e[11]=-1,e[12]=0,e[13]=0,e[14]=f*s*2*x,e[15]=0,e}function wr(e,i,r,n,a){var s=1/Math.tan(i/2),f;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==Infinity?(f=1/(n-a),e[10]=(a+n)*f,e[14]=2*a*n*f):(e[10]=-1,e[14]=-2*n),e}var Tr=wr;function jr(e,i,r,n,a){var s=1/Math.tan(i/2),f;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==Infinity?(f=1/(n-a),e[10]=a*f,e[14]=a*n*f):(e[10]=-1,e[14]=-n),e}function gr(e,i,r,n){var a=Math.tan(i.upDegrees*Math.PI/180),s=Math.tan(i.downDegrees*Math.PI/180),f=Math.tan(i.leftDegrees*Math.PI/180),v=Math.tan(i.rightDegrees*Math.PI/180),m=2/(f+v),x=2/(a+s);return e[0]=m,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=x,e[6]=0,e[7]=0,e[8]=-((f-v)*m*.5),e[9]=(a-s)*x*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function Cr(e,i,r,n,a,s,f){var v=1/(i-r),m=1/(n-a),x=1/(s-f);return e[0]=-2*v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*m,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*x,e[11]=0,e[12]=(i+r)*v,e[13]=(a+n)*m,e[14]=(f+s)*x,e[15]=1,e}var nt=Cr;function Vt(e,i,r,n,a,s,f){var v=1/(i-r),m=1/(n-a),x=1/(s-f);return e[0]=-2*v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*m,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=x,e[11]=0,e[12]=(i+r)*v,e[13]=(a+n)*m,e[14]=s*x,e[15]=1,e}function br(e,i,r,n){var a,s,f,v,m,x,A,T,I,F,j=i[0],X=i[1],ee=i[2],be=n[0],Fe=n[1],We=n[2],et=r[0],xt=r[1],Ct=r[2];return Math.abs(j-et)<Oa.Ib&&Math.abs(X-xt)<Oa.Ib&&Math.abs(ee-Ct)<Oa.Ib?gp(e):(A=j-et,T=X-xt,I=ee-Ct,F=1/Math.hypot(A,T,I),A*=F,T*=F,I*=F,a=Fe*I-We*T,s=We*A-be*I,f=be*T-Fe*A,F=Math.hypot(a,s,f),F?(F=1/F,a*=F,s*=F,f*=F):(a=0,s=0,f=0),v=T*f-I*s,m=I*a-A*f,x=A*s-T*a,F=Math.hypot(v,m,x),F?(F=1/F,v*=F,m*=F,x*=F):(v=0,m=0,x=0),e[0]=a,e[1]=v,e[2]=A,e[3]=0,e[4]=s,e[5]=m,e[6]=T,e[7]=0,e[8]=f,e[9]=x,e[10]=I,e[11]=0,e[12]=-(a*j+s*X+f*ee),e[13]=-(v*j+m*X+x*ee),e[14]=-(A*j+T*X+I*ee),e[15]=1,e)}function Nr(e,i,r,n){var a=i[0],s=i[1],f=i[2],v=n[0],m=n[1],x=n[2],A=a-r[0],T=s-r[1],I=f-r[2],F=A*A+T*T+I*I;F>0&&(F=1/Math.sqrt(F),A*=F,T*=F,I*=F);var j=m*I-x*T,X=x*A-v*I,ee=v*T-m*A;return F=j*j+X*X+ee*ee,F>0&&(F=1/Math.sqrt(F),j*=F,X*=F,ee*=F),e[0]=j,e[1]=X,e[2]=ee,e[3]=0,e[4]=T*ee-I*X,e[5]=I*j-A*ee,e[6]=A*X-T*j,e[7]=0,e[8]=A,e[9]=T,e[10]=I,e[11]=0,e[12]=a,e[13]=s,e[14]=f,e[15]=1,e}function ur(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Ir(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function $r(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e[4]=i[4]+r[4],e[5]=i[5]+r[5],e[6]=i[6]+r[6],e[7]=i[7]+r[7],e[8]=i[8]+r[8],e[9]=i[9]+r[9],e[10]=i[10]+r[10],e[11]=i[11]+r[11],e[12]=i[12]+r[12],e[13]=i[13]+r[13],e[14]=i[14]+r[14],e[15]=i[15]+r[15],e}function Bn(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e[4]=i[4]-r[4],e[5]=i[5]-r[5],e[6]=i[6]-r[6],e[7]=i[7]-r[7],e[8]=i[8]-r[8],e[9]=i[9]-r[9],e[10]=i[10]-r[10],e[11]=i[11]-r[11],e[12]=i[12]-r[12],e[13]=i[13]-r[13],e[14]=i[14]-r[14],e[15]=i[15]-r[15],e}function Jt(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=i[7]*r,e[8]=i[8]*r,e[9]=i[9]*r,e[10]=i[10]*r,e[11]=i[11]*r,e[12]=i[12]*r,e[13]=i[13]*r,e[14]=i[14]*r,e[15]=i[15]*r,e}function tr(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e[4]=i[4]+r[4]*n,e[5]=i[5]+r[5]*n,e[6]=i[6]+r[6]*n,e[7]=i[7]+r[7]*n,e[8]=i[8]+r[8]*n,e[9]=i[9]+r[9]*n,e[10]=i[10]+r[10]*n,e[11]=i[11]+r[11]*n,e[12]=i[12]+r[12]*n,e[13]=i[13]+r[13]*n,e[14]=i[14]+r[14]*n,e[15]=i[15]+r[15]*n,e}function xn(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]&&e[4]===i[4]&&e[5]===i[5]&&e[6]===i[6]&&e[7]===i[7]&&e[8]===i[8]&&e[9]===i[9]&&e[10]===i[10]&&e[11]===i[11]&&e[12]===i[12]&&e[13]===i[13]&&e[14]===i[14]&&e[15]===i[15]}function Vr(e,i){var r=e[0],n=e[1],a=e[2],s=e[3],f=e[4],v=e[5],m=e[6],x=e[7],A=e[8],T=e[9],I=e[10],F=e[11],j=e[12],X=e[13],ee=e[14],be=e[15],Fe=i[0],We=i[1],et=i[2],xt=i[3],Ct=i[4],Yt=i[5],ar=i[6],Ar=i[7],Qr=i[8],vr=i[9],pn=i[10],Tn=i[11],qn=i[12],Ba=i[13],qo=i[14],Ls=i[15];return Math.abs(r-Fe)<=Oa.Ib*Math.max(1,Math.abs(r),Math.abs(Fe))&&Math.abs(n-We)<=Oa.Ib*Math.max(1,Math.abs(n),Math.abs(We))&&Math.abs(a-et)<=Oa.Ib*Math.max(1,Math.abs(a),Math.abs(et))&&Math.abs(s-xt)<=Oa.Ib*Math.max(1,Math.abs(s),Math.abs(xt))&&Math.abs(f-Ct)<=Oa.Ib*Math.max(1,Math.abs(f),Math.abs(Ct))&&Math.abs(v-Yt)<=Oa.Ib*Math.max(1,Math.abs(v),Math.abs(Yt))&&Math.abs(m-ar)<=Oa.Ib*Math.max(1,Math.abs(m),Math.abs(ar))&&Math.abs(x-Ar)<=Oa.Ib*Math.max(1,Math.abs(x),Math.abs(Ar))&&Math.abs(A-Qr)<=Oa.Ib*Math.max(1,Math.abs(A),Math.abs(Qr))&&Math.abs(T-vr)<=Oa.Ib*Math.max(1,Math.abs(T),Math.abs(vr))&&Math.abs(I-pn)<=Oa.Ib*Math.max(1,Math.abs(I),Math.abs(pn))&&Math.abs(F-Tn)<=Oa.Ib*Math.max(1,Math.abs(F),Math.abs(Tn))&&Math.abs(j-qn)<=Oa.Ib*Math.max(1,Math.abs(j),Math.abs(qn))&&Math.abs(X-Ba)<=Oa.Ib*Math.max(1,Math.abs(X),Math.abs(Ba))&&Math.abs(ee-qo)<=Oa.Ib*Math.max(1,Math.abs(ee),Math.abs(qo))&&Math.abs(be-Ls)<=Oa.Ib*Math.max(1,Math.abs(be),Math.abs(Ls))}var Sr=Al,qr=Bn,Kr,gi,ai=(Kr=(0,Xr.b2)(),Kr(gi=function(){function e(){(0,ht.Z)(this,e),(0,S.Z)(this,"viewport",void 0),(0,S.Z)(this,"overridedViewProjectionMatrix",void 0),(0,S.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,S.Z)(this,"jitteredProjectionMatrix",void 0),(0,S.Z)(this,"viewMatrixInverse",void 0),(0,S.Z)(this,"cameraPosition",void 0)}return(0,Pt.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(r){this.viewport=r,this.viewMatrixInverse=qi(),Vh(this.viewMatrixInverse,r.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var r=this.viewport.getCenter(),n=(0,dn.Z)(r,2),a=n[0],s=n[1];return[a,s]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}},{key:"setViewProjectionMatrix",value:function(r){this.overridedViewProjectionMatrix=r}},{key:"jitterProjectionMatrix",value:function(r,n){var a=Gh(qi(),[r,n,0]);this.jitteredProjectionMatrix=Al(qi(),a,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=Al(qi(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||gi),Hr,rn;function Qn(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=ci(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function ci(e,i){if(!!e){if(typeof e=="string")return Ni(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ni(e,i)}}function Ni(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var so=(Hr=(0,Xr.b2)(),Hr(rn=function(){function e(){(0,ht.Z)(this,e),(0,S.Z)(this,"container",void 0),(0,S.Z)(this,"controlCorners",void 0),(0,S.Z)(this,"controlContainer",void 0),(0,S.Z)(this,"scene",void 0),(0,S.Z)(this,"mapsService",void 0),(0,S.Z)(this,"controls",[]),(0,S.Z)(this,"unAddControls",[])}return(0,Pt.Z)(e,[{key:"init",value:function(r,n){this.container=r.container,this.scene=n,this.mapsService=n.get(yt.IMapService),this.initControlPos()}},{key:"addControl",value:function(r,n){var a=n.get(yt.IMapService);a.map?(r.addTo(this.scene),this.controls.push(r)):this.unAddControls.push(r)}},{key:"getControlByName",value:function(r){return this.controls.find(function(n){return n.controlOption.name===r})}},{key:"removeControl",value:function(r){var n=this.controls.indexOf(r);return n>-1&&this.controls.splice(n,1),r.remove(),this}},{key:"addControls",value:function(){var r=this;this.unAddControls.forEach(function(n){n.addTo(r.scene),r.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var r=Qn(this.controls),n;try{for(r.s();!(n=r.n()).done;){var a=n.value;a.remove()}}catch(s){r.e(s)}finally{r.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var r=this.controlCorners={},n="l7-",a=this.controlContainer=Za("div",n+"control-container",this.container);function s(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],v=f.map(function(m){return n+m}).join(" ");r[f.join("")]=Za("div",v,a)}s(["top","left"]),s(["top","right"]),s(["bottom","left"]),s(["bottom","right"]),s(["top","center"]),s(["right","center"]),s(["left","center"]),s(["bottom","center"])}},{key:"clearControlPos",value:function(){for(var r in this.controlCorners)this.controlCorners[r]&&fc(this.controlCorners[r]);this.controlContainer&&fc(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),e}())||rn),uo,Fi,ts=(uo=(0,Xr.b2)(),uo(Fi=function(){function e(){(0,ht.Z)(this,e),(0,S.Z)(this,"container",void 0),(0,S.Z)(this,"scene",void 0),(0,S.Z)(this,"mapsService",void 0),(0,S.Z)(this,"markers",[]),(0,S.Z)(this,"markerLayers",[]),(0,S.Z)(this,"unAddMarkers",[]),(0,S.Z)(this,"unAddMarkerLayers",[])}return(0,Pt.Z)(e,[{key:"addMarkerLayer",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(r),r.addTo(this.scene)):this.unAddMarkerLayers.push(r)}},{key:"removeMarkerLayer",value:function(r){r.destroy(),this.markerLayers.indexOf(r);var n=this.markerLayers.indexOf(r);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(r),r.addTo(this.scene)):this.unAddMarkers.push(r)}},{key:"addMarkers",value:function(){var r=this;this.unAddMarkers.forEach(function(n){n.addTo(r.scene),r.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var r=this;this.unAddMarkerLayers.forEach(function(n){r.markerLayers.push(n),n.addTo(r.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(r){r.remove(),this.markers.indexOf(r);var n=this.markers.indexOf(r);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(yt.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(r){r.remove()}),this.markers=[],this.markerLayers.forEach(function(r){r.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(r){r.destroy()}}]),e}())||Fi),ja,No,So=(ja=(0,Xr.b2)(),ja(No=function(){function e(){(0,ht.Z)(this,e),(0,S.Z)(this,"scene",void 0),(0,S.Z)(this,"popup",void 0),(0,S.Z)(this,"mapsService",void 0),(0,S.Z)(this,"unAddPopup",void 0)}return(0,Pt.Z)(e,[{key:"removePopup",value:function(r){r.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(r){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(r.addTo(this.scene),this.popup=r):this.unAddPopup=r}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(yt.IMapService)}}]),e}())||No),Wo=Q(82492),Oo=Q.n(Wo),cs={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},po=cs,yi,Io;function Ji(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function zo(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Ji(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ji(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var ti={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},zi={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},ma=(yi=(0,Xr.b2)(),yi(Io=function(){function e(){(0,ht.Z)(this,e),(0,S.Z)(this,"sceneConfigCache",{}),(0,S.Z)(this,"layerConfigCache",{})}return(0,Pt.Z)(e,[{key:"getSceneConfig",value:function(r){return this.sceneConfigCache[r]}},{key:"getSceneWarninfo",value:function(r){return po[r]}},{key:"setSceneConfig",value:function(r,n){this.sceneConfigCache[r]=zo(zo({},ti),n)}},{key:"getLayerConfig",value:function(r){return this.layerConfigCache[r]}},{key:"setLayerConfig",value:function(r,n,a){this.layerConfigCache[n]=zo({},Oo()({},this.sceneConfigCache[r],zi,a))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||Io);function Ln(e,i,r,n){!r||Object.defineProperty(e,i,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}function ri(e,i,r,n,a){var s={};return Object.keys(n).forEach(function(f){s[f]=n[f]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=r.slice().reverse().reduce(function(f,v){return v(e,i,f)||f},s),a&&s.initializer!==void 0&&(s.value=s.initializer?s.initializer.call(a):void 0,s.initializer=void 0),s.initializer===void 0&&(Object.defineProperty(e,i,s),s=null),s}function we(){var e=new Oa.WT(4);return Oa.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function zt(e){var i=new glMatrix.ARRAY_TYPE(4);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i}function St(e,i,r,n){var a=new Oa.WT(4);return a[0]=e,a[1]=i,a[2]=r,a[3]=n,a}function mn(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e}function Gi(e,i,r,n,a){return e[0]=i,e[1]=r,e[2]=n,e[3]=a,e}function Ee(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e}function ae(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e}function Ve(e,i,r){return e[0]=i[0]*r[0],e[1]=i[1]*r[1],e[2]=i[2]*r[2],e[3]=i[3]*r[3],e}function ot(e,i,r){return e[0]=i[0]/r[0],e[1]=i[1]/r[1],e[2]=i[2]/r[2],e[3]=i[3]/r[3],e}function Ot(e,i){return e[0]=Math.ceil(i[0]),e[1]=Math.ceil(i[1]),e[2]=Math.ceil(i[2]),e[3]=Math.ceil(i[3]),e}function Ye(e,i){return e[0]=Math.floor(i[0]),e[1]=Math.floor(i[1]),e[2]=Math.floor(i[2]),e[3]=Math.floor(i[3]),e}function De(e,i,r){return e[0]=Math.min(i[0],r[0]),e[1]=Math.min(i[1],r[1]),e[2]=Math.min(i[2],r[2]),e[3]=Math.min(i[3],r[3]),e}function Je(e,i,r){return e[0]=Math.max(i[0],r[0]),e[1]=Math.max(i[1],r[1]),e[2]=Math.max(i[2],r[2]),e[3]=Math.max(i[3],r[3]),e}function ve(e,i){return e[0]=Math.round(i[0]),e[1]=Math.round(i[1]),e[2]=Math.round(i[2]),e[3]=Math.round(i[3]),e}function Ze(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e}function Ae(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e}function st(e,i){var r=i[0]-e[0],n=i[1]-e[1],a=i[2]-e[2],s=i[3]-e[3];return Math.hypot(r,n,a,s)}function At(e,i){var r=i[0]-e[0],n=i[1]-e[1],a=i[2]-e[2],s=i[3]-e[3];return r*r+n*n+a*a+s*s}function cr(e){var i=e[0],r=e[1],n=e[2],a=e[3];return Math.hypot(i,r,n,a)}function zr(e){var i=e[0],r=e[1],n=e[2],a=e[3];return i*i+r*r+n*n+a*a}function Ur(e,i){return e[0]=-i[0],e[1]=-i[1],e[2]=-i[2],e[3]=-i[3],e}function nn(e,i){return e[0]=1/i[0],e[1]=1/i[1],e[2]=1/i[2],e[3]=1/i[3],e}function Lr(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],f=r*r+n*n+a*a+s*s;return f>0&&(f=1/Math.sqrt(f)),e[0]=r*f,e[1]=n*f,e[2]=a*f,e[3]=s*f,e}function An(e,i){return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]+e[3]*i[3]}function un(e,i,r,n){var a=r[0]*n[1]-r[1]*n[0],s=r[0]*n[2]-r[2]*n[0],f=r[0]*n[3]-r[3]*n[0],v=r[1]*n[2]-r[2]*n[1],m=r[1]*n[3]-r[3]*n[1],x=r[2]*n[3]-r[3]*n[2],A=i[0],T=i[1],I=i[2],F=i[3];return e[0]=T*x-I*m+F*v,e[1]=-(A*x)+I*f-F*s,e[2]=A*m-T*f+F*a,e[3]=-(A*v)+T*s-I*a,e}function En(e,i,r,n){var a=i[0],s=i[1],f=i[2],v=i[3];return e[0]=a+n*(r[0]-a),e[1]=s+n*(r[1]-s),e[2]=f+n*(r[2]-f),e[3]=v+n*(r[3]-v),e}function bn(e,i){i=i||1;var r,n,a,s,f,v;do r=glMatrix.RANDOM()*2-1,n=glMatrix.RANDOM()*2-1,f=r*r+n*n;while(f>=1);do a=glMatrix.RANDOM()*2-1,s=glMatrix.RANDOM()*2-1,v=a*a+s*s;while(v>=1);var m=Math.sqrt((1-f)/v);return e[0]=i*r,e[1]=i*n,e[2]=i*a*m,e[3]=i*s*m,e}function ln(e,i,r){var n=i[0],a=i[1],s=i[2],f=i[3];return e[0]=r[0]*n+r[4]*a+r[8]*s+r[12]*f,e[1]=r[1]*n+r[5]*a+r[9]*s+r[13]*f,e[2]=r[2]*n+r[6]*a+r[10]*s+r[14]*f,e[3]=r[3]*n+r[7]*a+r[11]*s+r[15]*f,e}function Jn(e,i,r){var n=i[0],a=i[1],s=i[2],f=r[0],v=r[1],m=r[2],x=r[3],A=x*n+v*s-m*a,T=x*a+m*n-f*s,I=x*s+f*a-v*n,F=-f*n-v*a-m*s;return e[0]=A*x+F*-f+T*-m-I*-v,e[1]=T*x+F*-v+I*-f-A*-m,e[2]=I*x+F*-m+A*-v-T*-f,e[3]=i[3],e}function Sa(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function fs(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Va(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]}function _a(e,i){var r=e[0],n=e[1],a=e[2],s=e[3],f=i[0],v=i[1],m=i[2],x=i[3];return Math.abs(r-f)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(n-v)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(a-m)<=glMatrix.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(s-x)<=glMatrix.EPSILON*Math.max(1,Math.abs(s),Math.abs(x))}var Ql=null,Vs=null,wl=null,ju=null,ad=null,Vu=null,uf=null,Hh=function(){var e=we();return function(i,r,n,a,s,f){var v,m;for(r||(r=4),n||(n=0),a?m=Math.min(a*r+n,i.length):m=i.length,v=n;v<m;v+=r)e[0]=i[v],e[1]=i[v+1],e[2]=i[v+2],e[3]=i[v+3],s(e,e,f),i[v]=e[0],i[v+1]=e[1],i[v+2]=e[2],i[v+3]=e[3];return i}}(),od=Math.PI/180,Xo=512,Wh=4003e4;function Ec(e){var i=e.latitude,r=i===void 0?0:i,n=e.zoom,a=n===void 0?0:n,s=e.scale,f=e.highPrecision,v=f===void 0?!1:f,m=e.flipY,x=m===void 0?!1:m;s=s!==void 0?s:Math.pow(2,a);var A={},T=Xo*s,I=Math.cos(r*od),F=T/360,j=F/I,X=T/Wh/I;if(A.pixelsPerMeter=[X,-X,X],A.metersPerPixel=[1/X,-1/X,1/X],A.pixelsPerDegree=[F,-j,X],A.degreesPerPixel=[1/F,-1/j,1/X],v){var ee=od*Math.tan(r*od)/I,be=F*ee/2,Fe=T/Wh*ee,We=Fe/j*X;A.pixelsPerDegree2=[0,-be,Fe],A.pixelsPerMeter2=[We,0,We],x&&(A.pixelsPerDegree2[1]=-A.pixelsPerDegree2[1],A.pixelsPerMeter2[1]=-A.pixelsPerMeter2[1])}return x&&(A.pixelsPerMeter[1]=-A.pixelsPerMeter[1],A.metersPerPixel[1]=-A.metersPerPixel[1],A.pixelsPerDegree[1]=-A.pixelsPerDegree[1],A.degreesPerPixel[1]=-A.degreesPerPixel[1]),A}var Jl;(function(e){e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2"})(Jl||(Jl={}));var Sc={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},sd,hh,Cc,ud,Bd,S0=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],hs=(sd=(0,Xr.b2)(),hh=(0,Xr.f3)(yt.ICameraService),sd(Cc=(ud=function(){function e(){(0,ht.Z)(this,e),(0,S.Z)(this,"needRefresh",!0),Ln(this,"cameraService",Bd,this),(0,S.Z)(this,"coordinateSystem",void 0),(0,S.Z)(this,"viewportCenter",void 0),(0,S.Z)(this,"viewportCenterProjection",void 0),(0,S.Z)(this,"pixelsPerDegree",void 0),(0,S.Z)(this,"pixelsPerDegree2",void 0),(0,S.Z)(this,"pixelsPerMeter",void 0)}return(0,Pt.Z)(e,[{key:"refresh",value:function(){var r=this.cameraService.getZoom(),n=this.cameraService.getZoomScale(),a=this.cameraService.getCenter(),s=Ec({latitude:a[1],zoom:r}),f=s.pixelsPerMeter,v=s.pixelsPerDegree;this.viewportCenter=a,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=f,this.pixelsPerDegree=v,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Jl.LNGLAT||this.coordinateSystem===Jl.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Jl.LNGLAT_OFFSET?this.calculateLnglatOffset(a,r):this.coordinateSystem===Jl.P20_OFFSET&&this.calculateLnglatOffset(a,r,n,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(r){this.coordinateSystem=r}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(r,n,a,s){var f=Ec({latitude:r[1],zoom:n,scale:a,flipY:s,highPrecision:!0}),v=f.pixelsPerMeter,m=f.pixelsPerDegree,x=f.pixelsPerDegree2,A=this.cameraService.getViewMatrix(),T=this.cameraService.getProjectionMatrix(),I=Al([],T,A),F=this.cameraService.projectFlat([Math.fround(r[0]),Math.fround(r[1])],Math.pow(2,n));this.viewportCenterProjection=ln([],[F[0],F[1],0,1],I),A=this.cameraService.getViewMatrixUncentered()||A,I=Al([],T,A),I=Al([],I,S0),this.cameraService.setViewProjectionMatrix(I),this.pixelsPerMeter=v,this.pixelsPerDegree=m,this.pixelsPerDegree2=x}}]),e}(),Bd=ri(ud.prototype,"cameraService",[hh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ud))||Cc),Bf=Q(20396),Xh=Q.n(Bf),t;(function(e){e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag"})(t||(t={}));var o,u,p,y,b;function C(e){var i=O();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function O(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var D={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},z=(o=(0,Xr.b2)(),u=(0,Xr.f3)(yt.IMapService),o(p=(y=function(e){(0,Pr.Z)(r,e);var i=C(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"indragging",!1),Ln((0,J.Z)(n),"mapService",b,(0,J.Z)(n)),(0,S.Z)((0,J.Z)(n),"hammertime",void 0),(0,S.Z)((0,J.Z)(n),"lastClickTime",0),(0,S.Z)((0,J.Z)(n),"lastClickXY",[-1,-1]),(0,S.Z)((0,J.Z)(n),"clickTimer",void 0),(0,S.Z)((0,J.Z)(n),"$containter",void 0),(0,S.Z)((0,J.Z)(n),"onDrag",function(v){var m=n.interactionEvent(v);m.type=D[m.type],m.type==="dragging"?n.indragging=!0:n.indragging=!1,n.emit(t.Drag,m)}),(0,S.Z)((0,J.Z)(n),"onHammer",function(v){v.srcEvent.stopPropagation();var m=n.interactionEvent(v);n.emit(t.Hover,m)}),(0,S.Z)((0,J.Z)(n),"onTouch",function(v){var m=v.touches[0];n.onHover({x:m.pageX,y:m.pageY,type:"touch"})}),(0,S.Z)((0,J.Z)(n),"onHover",function(v){var m=v.clientX,x=v.clientY,A=m,T=x,I=v.type,F=n.mapService.getMapContainer();if(F)if(Qi)A=A-F.left-0,T=T-F.top-0;else{var j=F.getBoundingClientRect(),X=j.top,ee=j.left;A=A-ee-F.clientLeft,T=T-X-F.clientTop}var be=n.mapService.containerToLngLat([A,T]);if(I==="click"){if(!Qi&&"ontouchstart"in document.documentElement)return;n.isDoubleTap(A,T,be);return}if(I==="touch"){n.isDoubleTap(A,T,be);return}I!=="click"&&I!=="dblclick"&&n.emit(t.Hover,{x:A,y:T,lngLat:be,type:I,target:v})}),n}return(0,Pt.Z)(r,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(t.Hover)}},{key:"triggerHover",value:function(a){var s=a.x,f=a.y;this.emit(t.Hover,{x:s,y:f})}},{key:"triggerSelect",value:function(a){this.emit(t.Select,{featureId:a})}},{key:"triggerActive",value:function(a){this.emit(t.Active,{featureId:a})}},{key:"handleMiniEvent",value:function(a){this.onHover({clientX:a.touches[0].pageX,clientY:a.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var a=this.mapService.getMapContainer();if(a)if(Qi)ha.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var s=new(Xh()).Manager(a);s.add(new(Xh()).Tap({event:"dblclick",taps:2})),s.add(new(Xh()).Tap({event:"click"})),s.add(new(Xh()).Pan({threshold:0,pointers:0})),s.add(new(Xh()).Press({})),s.on("dblclick click",this.onHammer),s.on("panstart panmove panend pancancel",this.onDrag),a.addEventListener("mousemove",this.onHover),a.addEventListener("mousedown",this.onHover,!0),a.addEventListener("mouseup",this.onHover),a.addEventListener("contextmenu",this.onHover),this.hammertime=s}}},{key:"removeEventListenerOnMap",value:function(){if(Qi)ha.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var a=this.mapService.getMapContainer();a&&(a.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),a.removeEventListener("mousedown",this.onHover),a.removeEventListener("mouseup",this.onHover),a.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(a){var s=a.type,f=a.pointerType,v,m;f==="touch"?(m=Math.floor(a.pointers[0].clientY),v=Math.floor(a.pointers[0].clientX)):(m=Math.floor(a.srcEvent.y),v=Math.floor(a.srcEvent.x));var x=this.mapService.getMapContainer();if(x){var A=x.getBoundingClientRect(),T=A.top,I=A.left;v-=I,m-=T}var F=this.mapService.containerToLngLat([v,m]);return{x:v,y:m,lngLat:F,type:s,target:a.srcEvent}}},{key:"isDoubleTap",value:function(a,s,f){var v=this,m=new Date().getTime(),x="click";m-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-a)<10&&Math.abs(this.lastClickXY[1]-s)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),x="dblclick",this.emit(t.Hover,{x:a,y:s,lngLat:f,type:x})):(this.lastClickTime=m,this.lastClickXY=[a,s],this.clickTimer=setTimeout(function(){x="click",v.emit(t.Hover,{x:a,y:s,lngLat:f,type:x})},400))}}]),r}(Wl()),b=ri(y.prototype,"mapService",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y))||p),Z=Q(92137),G=Q(87757),q=Q.n(G),ie=0;function Te(e){if(Qi)return null;var i=e;if(typeof e=="string"&&(i=document.getElementById(e)),i){var r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,r.id="l7-scene-".concat(ie++),r.classList.add("l7-scene"),i.appendChild(r),r}return null}function Oe(e){var i,r,n=!0;return e==null||(i=e.target)===null||i===void 0||(r=i.path)===null||r===void 0||r.map(function(a){if(a!=null&&a.classList){var s;a==null||(s=a.classList)===null||s===void 0||s.forEach(function(f){(f==="l7-marker"||f==="l7-popup")&&(n=!1)})}}),n}var k;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(k||(k={}));var Ue,rt,bt,Ut,Gt,ir,Mr,Dr,Dn,cn,Vn,hn,Pi;function ei(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function wn(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ei(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ei(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var ji=(Ue=(0,Xr.b2)(),rt=(0,Xr.f3)(yt.IMapService),bt=(0,Xr.f3)(yt.IRendererService),Ut=(0,Xr.f3)(yt.IGlobalConfigService),Gt=(0,Xr.f3)(yt.IInteractionService),ir=(0,Xr.f3)(yt.ILayerService),Ue(Mr=(Dr=function(){function e(){var i=this;(0,ht.Z)(this,e),Ln(this,"mapService",Dn,this),Ln(this,"rendererService",cn,this),Ln(this,"configService",Vn,this),Ln(this,"interactionService",hn,this),Ln(this,"layerService",Pi,this),(0,S.Z)(this,"pickingFBO",void 0),(0,S.Z)(this,"width",0),(0,S.Z)(this,"height",0),(0,S.Z)(this,"alreadyInPicking",!1),(0,S.Z)(this,"pickBufferScale",1),(0,S.Z)(this,"lastPickTime",new Date().getTime()),(0,S.Z)(this,"pickFromPickingFBO",function(r,n){var a,s=n.x,f=n.y,v=n.lngLat,m=n.type,x=n.target,A=!1,T=i.rendererService,I=T.getViewportSize,F=T.readPixels,j=T.getContainer,X=i.getContainerSize(j()),ee=X.width,be=X.height;ee*=ka,be*=ka;var Fe=r.getLayerConfig(),We=Fe.enableHighlight,et=Fe.enableSelect,xt=s*ka,Ct=f*ka;if(xt>ee-1*ka||xt<0||Ct>be-1*ka||Ct<0)return!1;var Yt;if(Yt=F({x:Math.floor(xt/i.pickBufferScale),y:Math.floor((be-(f+1)*ka)/i.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:i.pickingFBO}),Yt[0]!==0||Yt[1]!==0||Yt[2]!==0){var ar=zs(Yt),Ar=r.getSource().getFeatureById(ar);ar!==r.getCurrentPickId()&&m==="mousemove"&&(m="mouseenter");var Qr={x:s,y:f,type:m,lngLat:v,featureId:ar,feature:Ar,target:x};Ar&&(A=!0,r.setCurrentPickId(ar),i.triggerHoverOnLayer(r,Qr))}else{var vr={x:s,y:f,lngLat:v,type:r.getCurrentPickId()!==null&&m==="mousemove"?"mouseout":"un"+m,featureId:null,target:x,feature:null};i.triggerHoverOnLayer(r,wn(wn({},vr),{},{type:"unpick"})),i.triggerHoverOnLayer(r,vr),r.setCurrentPickId(null)}if(We&&i.highlightPickedFeature(r,Yt),et&&m==="click"&&((a=Yt)===null||a===void 0?void 0:a.toString())!==[0,0,0,0].toString()){var pn=zs(Yt);r.getCurrentSelectedId()===null||pn!==r.getCurrentSelectedId()?(i.selectFeature(r,Yt),r.setCurrentSelectedId(pn)):(i.selectFeature(r,new Uint8Array([0,0,0,0])),r.setCurrentSelectedId(null))}return A})}return(0,Pt.Z)(e,[{key:"init",value:function(r){var n=this.rendererService,a=n.createTexture2D,s=n.createFramebuffer,f=n.getViewportSize,v=n.getContainer,m=this.getContainerSize(v()),x=m.width,A=m.height;x*=ka,A*=ka,this.pickBufferScale=this.configService.getSceneConfig(r).pickBufferScale||1,this.pickingFBO=s({color:a({width:Math.round(x/this.pickBufferScale),height:Math.round(A/this.pickBufferScale),wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE})}),this.interactionService.on(t.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var i=(0,Z.Z)(q().mark(function n(a,s,f){var v=this,m,x,A,T;return q().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:m=this.rendererService,x=m.useFramebuffer,A=m.clear,T=m.getContainer,this.resizePickingFBO(),x(this.pickingFBO,function(){A({framebuffer:v.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),a.hooks.beforePickingEncode.call(),a.renderModels(),a.hooks.afterPickingEncode.call();var j=v.pickBox(a,s);f(j)});case 3:case"end":return F.stop()}},n,this)}));function r(n,a,s){return i.apply(this,arguments)}return r}()},{key:"pickBox",value:function(r,n){var a=this,s=n.map(function(vr){var pn=vr<0?0:vr;return Math.floor(pn*ka/a.pickBufferScale)}),f=(0,dn.Z)(s,4),v=f[0],m=f[1],x=f[2],A=f[3],T=this.rendererService,I=T.getViewportSize,F=T.readPixels,j=T.getContainer,X=this.getContainerSize(j()),ee=X.width,be=X.height;if(ee*=ka,be*=ka,v>(ee-1)*ka/this.pickBufferScale||x<0||m>(be-1)*ka/this.pickBufferScale||A<0)return[];var Fe,We=Math.min(ee/this.pickBufferScale,x)-v,et=Math.min(be/this.pickBufferScale,A)-m;Fe=F({x:v,y:Math.floor(be/this.pickBufferScale-(A+1)),width:We,height:et,data:new Uint8Array(We*et*4),framebuffer:this.pickingFBO});for(var xt=[],Ct={},Yt=0;Yt<Fe.length/4;Yt=Yt+1){var ar=Fe.slice(Yt*4,Yt*4+4),Ar=zs(ar);if(Ar!==-1&&!Ct[Ar]){var Qr=r.getSource().getFeatureById(Ar);xt.push(wn(wn({},Qr),{},{pickedFeatureIdx:Ar})),Ct[Ar]=!0}}return xt}},{key:"handleCursor",value:function(r,n){var a=r.getLayerConfig(),s=a.cursor,f=s===void 0?"":s,v=a.cursorEnabled;if(v){var m=this.mapService.version,x=m==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),A=x==null?void 0:x.style.getPropertyValue("cursor");n==="unmousemove"&&A!==""?x==null||x.style.setProperty("cursor",""):n==="mousemove"&&(x==null||x.style.setProperty("cursor",f))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(r){return r.getContext?{width:r.width/ka,height:r.height/ka}:r.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var i=(0,Z.Z)(q().mark(function n(a){var s;return q().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())){v.next=2;break}return v.abrupt("return");case 2:if(this.alreadyInPicking=!0,s=new Date().getTime(),!(s-this.lastPickTime>10||a.type==="contextmenu"||a.type==="click")){v.next=7;break}return v.next=7,this.pickingLayers(a);case 7:this.lastPickTime=s,this.layerService.renderLayers(),this.alreadyInPicking=!1;case 10:case"end":return v.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resizePickingFBO",value:function(){var r=this.rendererService.getContainer,n=this.getContainerSize(r()),a=n.width,s=n.height;a*=ka,s*=ka,(this.width!==a||this.height!==s)&&(this.pickingFBO.resize({width:Math.round(a/this.pickBufferScale),height:Math.round(s/this.pickBufferScale)}),this.width=a,this.height=s)}},{key:"pickingLayers",value:function(){var i=(0,Z.Z)(q().mark(function n(a){var s=this,f,v,m,x,A;return q().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:f=this.rendererService,v=f.getViewportSize,m=f.useFramebuffer,x=f.clear,A=f.getContainer,this.resizePickingFBO(),m(this.pickingFBO,function(){var F=s.layerService.getRenderList();F.filter(function(j){return j.needPick(a.type)}).reverse().some(function(j){x({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),j.hooks.beforePickingEncode.call(),j.masks.length>0&&j.masks.map(function(ee){ee.hooks.beforeRenderData.call(),ee.hooks.beforeRender.call(),ee.render(),ee.hooks.afterRender.call()}),j.renderModels(!0),j.hooks.afterPickingEncode.call();var X=s.pickFromPickingFBO(j,a);return s.layerService.pickedLayerId=X?+j.id:-1,X&&!j.getLayerConfig().enablePropagation})});case 3:case"end":return I.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"triggerHoverOnLayer",value:function(r,n){Oe(n)&&(this.handleCursor(r,n.type),r.emit(n.type,n))}},{key:"highlightPickedFeature",value:function(r,n){var a=(0,dn.Z)(n,3),s=a[0],f=a[1],v=a[2];r.hooks.beforeHighlight.call([s,f,v])}},{key:"selectFeature",value:function(r,n){var a=(0,dn.Z)(n,3),s=a[0],f=a[1],v=a[2];r.hooks.beforeSelect.call([s,f,v])}}]),e}(),Dn=ri(Dr.prototype,"mapService",[rt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cn=ri(Dr.prototype,"rendererService",[bt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vn=ri(Dr.prototype,"configService",[Ut],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hn=ri(Dr.prototype,"interactionService",[Gt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pi=ri(Dr.prototype,"layerService",[ir],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dr))||Mr),Si=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,ht.Z)(this,e),(0,S.Z)(this,"autoStart",void 0),(0,S.Z)(this,"startTime",0),(0,S.Z)(this,"oldTime",0),(0,S.Z)(this,"running",!1),(0,S.Z)(this,"elapsedTime",0),this.autoStart=i}return(0,Pt.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var r=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance=="undefined"?Date:performance).now();r=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=r}return r}}]),e}(),ea,Wn,pa,eo,_o,Wa,to,xo,Yo;function rs(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Gs(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function Gs(e,i){if(!!e){if(typeof e=="string")return ns(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ns(e,i)}}function ns(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Hs=(ea=(0,Xr.b2)(),Wn=(0,Xr.f3)(yt.IRendererService),pa=(0,Xr.f3)(yt.IMapService),eo=(0,Xr.f3)(yt.IGlobalConfigService),ea(_o=(Wa=function(){function e(){(0,ht.Z)(this,e),(0,S.Z)(this,"pickedLayerId",-1),(0,S.Z)(this,"clock",new Si),(0,S.Z)(this,"alreadyInRendering",!1),(0,S.Z)(this,"layers",[]),(0,S.Z)(this,"layerList",[]),(0,S.Z)(this,"layerRenderID",void 0),(0,S.Z)(this,"sceneInited",!1),(0,S.Z)(this,"animateInstanceCount",0),(0,S.Z)(this,"shaderPicking",!0),(0,S.Z)(this,"enableRender",!0),Ln(this,"renderService",to,this),Ln(this,"mapService",xo,this),Ln(this,"configService",Yo,this)}return(0,Pt.Z)(e,[{key:"add",value:function(r){this.sceneInited&&r.init(),this.layers.push(r),this.updateLayerRenderList()}},{key:"addMask",value:function(r){this.sceneInited&&r.init()}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(r){r.inited||r.init()}),this.updateLayerRenderList()}},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(r){return this.layers.find(function(n){return n.id===r})}},{key:"getLayerByName",value:function(r){return this.layers.find(function(n){return n.name===r})}},{key:"cleanRemove",value:function(r,n){if(n){var a=n.layerChildren.indexOf(r);a>-1&&n.layerChildren.splice(a,1)}else{var s=this.layers.indexOf(r);s>-1&&this.layers.splice(s,1)}this.updateLayerRenderList(),this.renderLayers()}},{key:"remove",value:function(r,n){if(n){var a=n.layerChildren.indexOf(r);a>-1&&n.layerChildren.splice(a,1)}else{var s=this.layers.indexOf(r);s>-1&&this.layers.splice(s,1)}this.updateLayerRenderList(),r.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"setEnableRender",value:function(r){this.enableRender=r}},{key:"renderLayers",value:function(){var i=(0,Z.Z)(q().mark(function n(){var a,s,f;return q().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){m.next=2;break}return m.abrupt("return");case 2:this.alreadyInRendering=!0,this.clear(),a=rs(this.layerList),m.prev=5,a.s();case 7:if((s=a.n()).done){m.next=21;break}if(f=s.value,f.hooks.beforeRenderData.call(),f.hooks.beforeRender.call(),!f.isLayerGroup&&f.masks.length>0&&(this.renderService.clear({stencil:0,depth:1,framebuffer:null}),f.masks.map(function(x){x.hooks.beforeRenderData.call(),x.hooks.beforeRender.call(),x.render(),x.hooks.afterRender.call()})),!f.getLayerConfig().enableMultiPassRenderer){m.next=17;break}return m.next=15,f.renderMultiPass();case 15:m.next=18;break;case 17:f.render();case 18:f.hooks.afterRender.call();case 19:m.next=7;break;case 21:m.next=26;break;case 23:m.prev=23,m.t0=m.catch(5),a.e(m.t0);case 26:return m.prev=26,a.f(),m.finish(26);case 29:this.alreadyInRendering=!1;case 30:case"end":return m.stop()}},n,this,[[5,23,26,29]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"updateLayerRenderList",value:function(){var r=this;this.layerList=[],this.layers.filter(function(n){return n.inited}).filter(function(n){return n.isVisible()}).sort(function(n,a){return n.zIndex-a.zIndex}).forEach(function(n){n.isLayerGroup?n.layerChildren.filter(function(a){return a.inited}).filter(function(a){return a.isVisible()}).sort(function(a,s){return a.zIndex-s.zIndex}).forEach(function(a){r.layerList.push(a)}):r.layerList.push(n)})}},{key:"destroy",value:function(){this.layers.forEach(function(r){r.destroy()}),this.layers=[],this.layerList=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var r=pi(this.mapService.bgColor);this.renderService.clear({color:r,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=ha.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){ha.cancelAnimationFrame(this.layerRenderID)}}]),e}(),to=ri(Wa.prototype,"renderService",[Wn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xo=ri(Wa.prototype,"mapService",[pa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yo=ri(Wa.prototype,"configService",[eo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wa))||_o),Ga=Q(81253),ps=Q(14293),Ci=Q.n(ps),Fa=function(){function e(i){var r=this;(0,ht.Z)(this,e),(0,S.Z)(this,"name",void 0),(0,S.Z)(this,"type",void 0),(0,S.Z)(this,"scale",void 0),(0,S.Z)(this,"descriptor",void 0),(0,S.Z)(this,"featureBufferLayout",[]),(0,S.Z)(this,"needRescale",!1),(0,S.Z)(this,"needRemapping",!1),(0,S.Z)(this,"needRegenerateVertices",!1),(0,S.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,S.Z)(this,"vertexAttribute",void 0),(0,S.Z)(this,"defaultCallback",function(n){if(n.length===0){var a;return((a=r.scale)===null||a===void 0?void 0:a.defaultValues)||[]}return n.map(function(s,f){var v,m=(v=r.scale)===null||v===void 0?void 0:v.scalers[f].func,x=m(s);return x})}),this.setProps(i)}return(0,Pt.Z)(e,[{key:"setProps",value:function(r){Object.assign(this,r)}},{key:"mapping",value:function(r){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var a,s=(a=this.scale)===null||a===void 0?void 0:a.callback.apply(a,(0,Se.Z)(r));if(!Ci()(s))return[s]}return this.defaultCallback(r)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),wa=["buffer","update","name"],fa=["buffer","update","name"],ds,ws,Xa,Ro,vs,da;function ec(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function uu(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ec(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ec(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function lf(e){return new Promise(function(i){return setTimeout(i,e)})}var ko=(ds={},(0,S.Z)(ds,k.FLOAT,4),(0,S.Z)(ds,k.UNSIGNED_BYTE,1),(0,S.Z)(ds,k.UNSIGNED_SHORT,2),ds),Ac=(ws=(0,Xr.b2)(),Xa=(0,Xr.f3)(yt.IRendererService),ws(Ro=(vs=function(){function e(){(0,ht.Z)(this,e),(0,S.Z)(this,"attributesAndIndices",void 0),Ln(this,"rendererService",da,this),(0,S.Z)(this,"attributes",[]),(0,S.Z)(this,"triangulation",void 0),(0,S.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,Pt.Z)(e,[{key:"registerStyleAttribute",value:function(r){var n=this.getLayerStyleAttribute(r.name||"");return n?n.setProps(r):(n=new Fa(r),this.attributes.push(n)),n}},{key:"updateStyleAttribute",value:function(r,n,a){var s=this.getLayerStyleAttribute(r);s||(s=this.registerStyleAttribute(uu(uu({},n),{},{name:r})));var f=n.scale;f&&s&&(s.scale=f,s.needRescale=!0,s.needRemapping=!0,s.needRegenerateVertices=!0,a&&a.featureRange&&(s.featureRange=a.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(r){return this.attributes.find(function(n){return n.name===r})}},{key:"getLayerAttributeScale",value:function(r){var n,a=this.getLayerStyleAttribute(r),s=a==null||(n=a.scale)===null||n===void 0?void 0:n.scalers;return s&&s[0]?s[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3?arguments[3]:void 0,f=this.attributes.find(function(et){return et.name===r});if(f&&f.descriptor){var v=f.descriptor,m=v.update,x=v.buffer,A=v.size,T=A===void 0?0:A,I=ko[x.type||k.FLOAT];if(m){var F=this.featureLayout,j=F.elements,X=F.sizePerElement,ee=j.slice(a,s);if(!ee.length)return;var be=ee[0].offset,Fe=be*T*I,We=ee.map(function(et,xt){for(var Ct=et.featureIdx,Yt=et.vertices,ar=et.normals,Ar=Yt.length/X,Qr=[],vr=0;vr<Ar;vr++){var pn=ar?ar.slice(vr*3,vr*3+3):[];Qr.push.apply(Qr,(0,Se.Z)(m(n[Ct],Ct,Yt.slice(vr*X,vr*X+X),xt,pn)))}return Qr}).reduce(function(et,xt){return et.push.apply(et,(0,Se.Z)(xt)),et},[]);f.vertexAttribute.updateBuffer({data:We,offset:Fe})}}}},{key:"createAttributesAndIndices",value:function(r,n,a){var s=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var f=this.attributes.map(function(Fe){return Fe.resetDescriptor(),Fe.descriptor}),v=0,m=[],x=[],A=[],T=3;r.forEach(function(Fe,We){var et=s.triangulation(Fe,a),xt=et.indices,Ct=et.vertices,Yt=et.normals,ar=et.size,Ar=et.indexes;xt.forEach(function(Tn){x.push(Tn+v)}),T=ar;var Qr=Ct.length/ar;s.featureLayout.sizePerElement=T,s.featureLayout.elements.push({featureIdx:We,vertices:Ct,normals:Yt,offset:v}),v+=Qr;for(var vr=function(qn){var Ba=(Yt==null?void 0:Yt.slice(qn*3,qn*3+3))||[],qo=Ct.slice(qn*ar,qn*ar+ar),Ls=0;Ar&&Ar[qn]!==void 0&&(Ls=Ar[qn]),f.forEach(function(Ds,Ys){if(Ds&&Ds.update){var vf;(vf=Ds.buffer.data).push.apply(vf,(0,Se.Z)(Ds.update(Fe,We,qo,qn,Ba,Ls)))}})},pn=0;pn<Qr;pn++)vr(pn)});var I=this.rendererService,F=I.createAttribute,j=I.createBuffer,X=I.createElements,ee={};f.forEach(function(Fe,We){if(Fe){var et=Fe.buffer,xt=Fe.update,Ct=Fe.name,Yt=(0,Ga.Z)(Fe,wa),ar=F(uu({buffer:j(et)},Yt));ee[Fe.name||""]=ar,s.attributes[We].vertexAttribute=ar}});var be=X({data:x,type:k.UNSIGNED_INT,count:x.length});return this.attributesAndIndices={attributes:ee,elements:be},this.attributesAndIndices}},{key:"createAttributes",value:function(r,n){var a=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var s=this.attributes.map(function(F){return F.resetDescriptor(),F.descriptor}),f=0,v=[],m=3;r.forEach(function(F,j){var X=a.triangulation(F),ee=X.indices,be=X.vertices,Fe=X.normals,We=X.size,et=X.indexes;ee.forEach(function(ar){v.push(ar+f)}),m=We;var xt=be.length/We;a.featureLayout.sizePerElement=m,a.featureLayout.elements.push({featureIdx:j,vertices:be,normals:Fe,offset:f}),f+=xt;for(var Ct=function(Ar){var Qr=(Fe==null?void 0:Fe.slice(Ar*3,Ar*3+3))||[],vr=be.slice(Ar*We,Ar*We+We),pn=0;et&&et[Ar]!==void 0&&(pn=et[Ar]),s.forEach(function(Tn,qn){if(Tn&&Tn.update){var Ba;(Ba=Tn.buffer.data).push.apply(Ba,(0,Se.Z)(Tn.update(F,j,vr,Ar,Qr,pn)))}})},Yt=0;Yt<xt;Yt++)Ct(Yt)});var x=this.rendererService,A=x.createAttribute,T=x.createBuffer,I={};return s.forEach(function(F,j){if(F){var X=F.buffer,ee=F.update,be=F.name,Fe=(0,Ga.Z)(F,fa),We=A(uu({buffer:T(X)},Fe));I[F.name||""]=We,a.attributes[j].vertexAttribute=We}}),{attributes:I}}},{key:"clearAllAttributes",value:function(){var r;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(r=this.attributesAndIndices)===null||r===void 0||r.elements.destroy(),this.attributes=[]}}]),e}(),da=ri(vs.prototype,"rendererService",[Xa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vs))||Ro),nl=Q(67709),Yh=Q.n(nl),Nf,ph,wc,dh,xp,vh,qh,bp,Ep,Tc,Kh,mh,cf,gh,Sp,Cp,$h,ms,Ap,Qh,Jh,ep,wp,yh,Tp,_h,tp,zf,rp,xh,ld,Nd,cd;function xv(e){var i=zd();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function zd(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var C0=(Nf=(0,Xr.b2)(),ph=(0,Xr.f3)(yt.SceneID),wc=(0,Xr.f3)(yt.IIconService),dh=(0,Xr.f3)(yt.IFontService),xp=(0,Xr.f3)(yt.IControlService),vh=(0,Xr.f3)(yt.IGlobalConfigService),qh=(0,Xr.f3)(yt.IMapService),bp=(0,Xr.f3)(yt.ICoordinateSystemService),Ep=(0,Xr.f3)(yt.IRendererService),Tc=(0,Xr.f3)(yt.ILayerService),Kh=(0,Xr.f3)(yt.ICameraService),mh=(0,Xr.f3)(yt.IInteractionService),cf=(0,Xr.f3)(yt.IPickingService),gh=(0,Xr.f3)(yt.IShaderModuleService),Sp=(0,Xr.f3)(yt.IMarkerService),Cp=(0,Xr.f3)(yt.IPopupService),Nf($h=(ms=function(e){(0,Pr.Z)(r,e);var i=xv(r);function r(){var n;return(0,ht.Z)(this,r),n=i.call(this),(0,S.Z)((0,J.Z)(n),"destroyed",!1),(0,S.Z)((0,J.Z)(n),"loaded",!1),(0,S.Z)((0,J.Z)(n),"loadFont",!1),(0,S.Z)((0,J.Z)(n),"fontFamily",""),Ln((0,J.Z)(n),"id",Ap,(0,J.Z)(n)),Ln((0,J.Z)(n),"iconService",Qh,(0,J.Z)(n)),Ln((0,J.Z)(n),"fontService",Jh,(0,J.Z)(n)),Ln((0,J.Z)(n),"controlService",ep,(0,J.Z)(n)),Ln((0,J.Z)(n),"configService",wp,(0,J.Z)(n)),Ln((0,J.Z)(n),"map",yh,(0,J.Z)(n)),Ln((0,J.Z)(n),"coordinateSystemService",Tp,(0,J.Z)(n)),Ln((0,J.Z)(n),"rendererService",_h,(0,J.Z)(n)),Ln((0,J.Z)(n),"layerService",tp,(0,J.Z)(n)),Ln((0,J.Z)(n),"cameraService",zf,(0,J.Z)(n)),Ln((0,J.Z)(n),"interactionService",rp,(0,J.Z)(n)),Ln((0,J.Z)(n),"pickingService",xh,(0,J.Z)(n)),Ln((0,J.Z)(n),"shaderModuleService",ld,(0,J.Z)(n)),Ln((0,J.Z)(n),"markerService",Nd,(0,J.Z)(n)),Ln((0,J.Z)(n),"popupService",cd,(0,J.Z)(n)),(0,S.Z)((0,J.Z)(n),"inited",!1),(0,S.Z)((0,J.Z)(n),"initPromise",void 0),(0,S.Z)((0,J.Z)(n),"rendering",!1),(0,S.Z)((0,J.Z)(n),"$container",void 0),(0,S.Z)((0,J.Z)(n),"canvas",void 0),(0,S.Z)((0,J.Z)(n),"markerContainer",void 0),(0,S.Z)((0,J.Z)(n),"hooks",void 0),(0,S.Z)((0,J.Z)(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),vn(),n.coordinateSystemService.needRefresh=!0,n.render())}),(0,S.Z)((0,J.Z)(n),"handleMapCameraChanged",function(a){n.cameraService.update(a),n.render()}),n.hooks={init:new ss},n}return(0,Pt.Z)(r,[{key:"init",value:function(a){var s=this;this.configService.setSceneConfig(this.id,a),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return s.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Z.Z)(q().mark(function f(){return q().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,new Promise(function(x){s.map.onCameraChanged(function(A){s.cameraService.init(),s.cameraService.update(A),s.map.version!=="GAODE2.x"&&x()}),s.map.version!=="GAODE2.x"?s.map.init():x()});case 2:if(!(s.map.version==="GAODE2.x"&&s.map.initViewPort)){m.next=6;break}return m.next=5,s.map.init();case 5:s.map.initViewPort();case 6:s.map.onCameraChanged(s.handleMapCameraChanged),s.map.addMarkerContainer(),s.markerService.addMarkers(),s.markerService.addMarkerLayers(),s.popupService.initPopup(),s.interactionService.init(),s.interactionService.on(t.Drag,s.addSceneEvent.bind(s));case 13:case"end":return m.stop()}},f)}))),this.hooks.init.tapPromise("initRenderer",(0,Z.Z)(q().mark(function f(){var v,m;return q().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(v=Te(s.configService.getSceneConfig(s.id).id||""),s.$container=v,!v){A.next=11;break}return s.canvas=Za("canvas","",v),s.setCanvas(),A.next=7,s.rendererService.init(s.canvas,s.configService.getSceneConfig(s.id));case 7:Yh()(s.$container,s.handleWindowResized),ha.matchMedia&&((m=ha.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||m===void 0||m.addListener(s.handleWindowResized)),A.next=12;break;case 11:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:s.pickingService.init(s.id);case 13:case"end":return A.stop()}},f)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"initMiniScene",value:function(a){var s=this;this.configService.setSceneConfig(this.id,a),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return s.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Z.Z)(q().mark(function f(){return q().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,new Promise(function(x){s.map.onCameraChanged(function(A){s.cameraService.init(),s.cameraService.update(A),s.map.version!=="GAODE2.x"&&x()}),s.map.initMiniMap()});case 2:s.map.onCameraChanged(s.handleMapCameraChanged),s.interactionService.init(),s.interactionService.on(t.Drag,s.addSceneEvent.bind(s));case 5:case"end":return m.stop()}},f)}))),this.hooks.init.tapPromise("initRenderer",(0,Z.Z)(q().mark(function f(){var v;return q().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(v=a.canvas,s.$container=v||null,!s.$container){x.next=7;break}return x.next=5,s.rendererService.init(a.canvas,s.configService.getSceneConfig(s.id));case 5:x.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:s.pickingService.init(s.id);case 9:case"end":return x.stop()}},f)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(a){this.layerService.sceneService=this,this.layerService.add(a),this.render()}},{key:"addMask",value:function(a){this.layerService.sceneService=this,this.layerService.addMask(a),this.render()}},{key:"render",value:function(){var n=(0,Z.Z)(q().mark(function s(){return q().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!(this.rendering||this.destroyed)){v.next=2;break}return v.abrupt("return");case 2:if(this.rendering=!0,this.inited){v.next=23;break}return v.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){v.next=18;break}return v.prev=8,v.next=11,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 11:v.next=18;break;case 13:v.prev=13,v.t0=v.catch(8),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(v.t0);case 18:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 23:this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this.rendering=!1;case 26:case"end":return v.stop()}},s,this,[[8,13]])}));function a(){return n.apply(this,arguments)}return a}()},{key:"addFontFace",value:function(a,s){this.fontFamily=a;var f=document.createElement("style");f.type="text/css",f.innerText=`
        @font-face{
            font-family: '`.concat(a,`';
            src: url('`).concat(s,`') format('woff2'),
            url('`).concat(s,`') format('woff'),
            url('`).concat(s,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(f),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(a){var s,f=(s=this.$container)===null||s===void 0?void 0:s.getElementsByTagName("canvas")[0];this.render();var v=a==="jpg"?f==null?void 0:f.toDataURL("image/jpeg"):f==null?void 0:f.toDataURL("image/png");return v}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var a=this.$container.parentElement;a!==null&&(this.markerContainer=Za("div","l7-marker-container",a))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var a=this,s,f;if(!this.inited){this.destroyed=!0;return}if(this.emit("destroy"),this.pickingService.destroy(),this.layerService.destroy(),setTimeout(function(){var m;(m=a.$container)===null||m===void 0||m.removeChild(a.canvas),a.canvas=null,a.rendererService.destroy()}),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),(s=this.$container)===null||s===void 0||(f=s.parentNode)===null||f===void 0||f.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,(0,nl.unbind)(this.$container,this.handleWindowResized),ha.matchMedia){var v;(v=ha.matchMedia("screen and (min-resolution: 2dppx)"))===null||v===void 0||v.removeListener(this.handleWindowResized)}}},{key:"initContainer",value:function(){var a,s,f=ka,v=((a=this.$container)===null||a===void 0?void 0:a.clientWidth)||400,m=((s=this.$container)===null||s===void 0?void 0:s.clientHeight)||300,x=this.canvas;x&&(x.width=v*f,x.height=m*f),this.rendererService.viewport({x:0,y:0,width:f*v,height:f*m})}},{key:"setCanvas",value:function(){var a,s,f=ka,v=((a=this.$container)===null||a===void 0?void 0:a.clientWidth)||400,m=((s=this.$container)===null||s===void 0?void 0:s.clientHeight)||300,x=this.canvas;x.width=v*f,x.height=m*f,x.style.width="100%",x.style.height="100%"}},{key:"addSceneEvent",value:function(a){this.emit(a.type,a)}}]),r}(ls.EventEmitter),Ap=ri(ms.prototype,"id",[ph],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qh=ri(ms.prototype,"iconService",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jh=ri(ms.prototype,"fontService",[dh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ep=ri(ms.prototype,"controlService",[xp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wp=ri(ms.prototype,"configService",[vh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yh=ri(ms.prototype,"map",[qh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tp=ri(ms.prototype,"coordinateSystemService",[bp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_h=ri(ms.prototype,"rendererService",[Ep],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tp=ri(ms.prototype,"layerService",[Tc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zf=ri(ms.prototype,"cameraService",[Kh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rp=ri(ms.prototype,"interactionService",[mh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xh=ri(ms.prototype,"pickingService",[cf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ld=ri(ms.prototype,"shaderModuleService",[gh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nd=ri(ms.prototype,"markerService",[Sp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cd=ri(ms.prototype,"popupService",[Cp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ms))||$h),Mp=Q(44908),Co=Q.n(Mp);function tc(e){var i=0;switch(e){case"vec2":case"ivec2":i=2;break;case"vec3":case"ivec3":i=3;break;case"vec4":case"ivec4":case"mat2":i=4;break;case"mat3":i=9;break;case"mat4":i=16;break;default:}return i}var A0=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function ff(e){var i={};return e=e.replace(A0,function(r,n,a){var s=a.split(":"),f=s[0].trim(),v="";switch(s.length>1&&(v=s[1].trim()),n){case"bool":v=v==="true";break;case"float":case"int":v=Number(v);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":v?v=v.replace("[","").replace("]","").split(",").reduce(function(m,x){return m.push(Number(x.trim())),m},[]):v=new Array(tc(n)).fill(0);break;default:}return i[f]=v,"uniform ".concat(n," ").concat(f,`;
`)}),{content:e,uniforms:i}}var fd,Ud;function Pp(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Gu(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Pp(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Pp(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Op="#define PI 3.14159265359",Ip=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,hd=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,pd=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,Zd=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

uniform float u_activeMix: 0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,bv=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec3 u_CurrentSelectedId : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;
uniform float u_EnableSelect: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {
  //   // \u9009\u4E2D\u6001
  //   v_PickingResult.a = SELECT;
  // } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {
  //   // \u9AD8\u4EAE\u6001
  //   v_PickingResult.a = HIGHLIGHT;
  // } else {
  //   v_PickingResult.a = NORMAL;
  // }

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,Rp=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,Ev=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom));
  }
  return pixel * 2.0;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,Sv=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,Cv=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasThetaOffset() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 thetaOffset \u7684\u6570\u636E
  return u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 1.0, 0.0, 0.0, // offsets thetaOffset
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0 +  // offsets
          u_cellTypeLayout[2][1];         // thetaOffset
}`,Av=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,wv=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,Hu=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,dd=`
// \u8BA1\u7B97 thetaOffset \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasThetaOffset()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 thetaOffset \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_thetaOffset, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureThetaOffset, textureOffset + 1.0);
  }
}
`,Tv=/precision\s+(high|low|medium)p\s+float/,Mc=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,w0=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,Mv=(fd=(0,Xr.b2)(),fd(Ud=function(){function e(){(0,ht.Z)(this,e),(0,S.Z)(this,"moduleCache",{}),(0,S.Z)(this,"rawContentCache",{})}return(0,Pt.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:Op,fs:Op}),this.registerModule("decode",{vs:Ip,fs:""}),this.registerModule("projection",{vs:Ev,fs:""}),this.registerModule("project",{vs:Rp,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:Sv}),this.registerModule("lighting",{vs:pd,fs:""}),this.registerModule("light",{vs:hd,fs:""}),this.registerModule("picking",{vs:bv,fs:Zd}),this.registerModule("styleMapping",{vs:Cv,fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:dd,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:Av,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:wv,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:Hu,fs:""})}},{key:"registerModule",value:function(r,n){if(!this.rawContentCache[r]){var a=n.vs,s=n.fs,f=n.uniforms,v=ff(a),m=v.content,x=v.uniforms,A=ff(s),T=A.content,I=A.uniforms;this.rawContentCache[r]={fs:T,uniforms:Gu(Gu(Gu({},x),I),f),vs:m}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(r){var n=this;if(this.moduleCache[r])return this.moduleCache[r];var a=this.rawContentCache[r].vs,s=this.rawContentCache[r].fs,f=this.processModule(a,[],"vs"),v=f.content,m=f.includeList,x=this.processModule(s,[],"fs"),A=x.content,T=x.includeList,I=A,F=Co()(m.concat(T).concat(r)).reduce(function(j,X){return Gu(Gu({},j),n.rawContentCache[X].uniforms)},{});return Tv.test(A)||(I=Mc+A),this.moduleCache[r]={fs:I.trim(),uniforms:F,vs:v.trim()},this.moduleCache[r]}},{key:"processModule",value:function(r,n,a){var s=this,f=r.replace(w0,function(v,m){var x=m.split(" "),A=x[0].replace(/"/g,"");if(n.indexOf(A)>-1)return"";var T=s.rawContentCache[A][a];n.push(A);var I=s.processModule(T,n,a),F=I.content;return F});return{content:f,includeList:n}}}]),e}())||Ud);function bh(e,i){for(;!Object.prototype.hasOwnProperty.call(e,i)&&(e=(0,gt.Z)(e),e!==null););return e}function Tl(){return typeof Reflect!="undefined"&&Reflect.get?Tl=Reflect.get:Tl=function(i,r,n){var a=bh(i,r);if(!!a){var s=Object.getOwnPropertyDescriptor(a,r);return s.get?s.get.call(arguments.length<3?i:n):s.value}},Tl.apply(this,arguments)}var il;(function(e){e.Normal="normal",e.PostProcessing="post-processing"})(il||(il={}));var Eh,Sh,kp=(Eh=(0,Xr.b2)(),Eh(Sh=function(){function e(){(0,ht.Z)(this,e),(0,S.Z)(this,"shaderModuleService",void 0),(0,S.Z)(this,"rendererService",void 0),(0,S.Z)(this,"cameraService",void 0),(0,S.Z)(this,"mapService",void 0),(0,S.Z)(this,"interactionService",void 0),(0,S.Z)(this,"layerService",void 0),(0,S.Z)(this,"config",void 0)}return(0,Pt.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return il.Normal}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(yt.IRendererService),this.cameraService=r.getContainer().get(yt.ICameraService),this.mapService=r.getContainer().get(yt.IMapService),this.interactionService=r.getContainer().get(yt.IInteractionService),this.layerService=r.getContainer().get(yt.ILayerService),this.shaderModuleService=r.getContainer().get(yt.IShaderModuleService)}},{key:"render",value:function(r){}}]),e}())||Sh),jd,Vd;function Pv(e){var i=Gd();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function Gd(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Hd=(jd=(0,Xr.b2)(),jd(Vd=function(e){(0,Pr.Z)(r,e);var i=Pv(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(a,s){Tl((0,gt.Z)(r.prototype),"init",this).call(this,a,s)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),r}(kp))||Vd),Pc,Wd,vd,Lp,Xd;function Yd(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Ov(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function Ov(e,i){if(!!e){if(typeof e=="string")return qd(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return qd(e,i)}}function qd(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Kd=(Pc=(0,Xr.b2)(),Wd=(0,Xr.f3)(yt.IPostProcessor),Pc(vd=(Lp=function(){function e(){(0,ht.Z)(this,e),(0,S.Z)(this,"passes",[]),Ln(this,"postProcessor",Xd,this),(0,S.Z)(this,"layer",void 0),(0,S.Z)(this,"renderFlag",void 0),(0,S.Z)(this,"width",0),(0,S.Z)(this,"height",0)}return(0,Pt.Z)(e,[{key:"setLayer",value:function(r){this.layer=r}},{key:"setRenderFlag",value:function(r){this.renderFlag=r}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var i=(0,Z.Z)(q().mark(function n(){var a,s,f;return q().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:a=Yd(this.passes),m.prev=1,a.s();case 3:if((s=a.n()).done){m.next=9;break}return f=s.value,m.next=7,f.render(this.layer);case 7:m.next=3;break;case 9:m.next=14;break;case 11:m.prev=11,m.t0=m.catch(1),a.e(m.t0);case 14:return m.prev=14,a.f(),m.finish(14);case 17:return m.next=19,this.postProcessor.render(this.layer);case 19:case"end":return m.stop()}},n,this,[[1,11,14,17]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){(this.width!==r||this.height!==n)&&(this.postProcessor.resize(r,n),this.width=r,this.height=n)}},{key:"add",value:function(r,n){r.getType()===il.PostProcessing?this.postProcessor.add(r,this.layer,n):(r.init(this.layer,n),this.passes.push(r))}},{key:"insert",value:function(r,n,a){r.init(this.layer,n),this.passes.splice(a,0,r)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),Xd=ri(Lp.prototype,"postProcessor",[Wd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lp))||vd),$d,np;function Qd(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Dp(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Qd(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Qd(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function T0(e){var i=Iv();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function Iv(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var M0=($d=(0,Xr.b2)(),$d(np=function(e){(0,Pr.Z)(r,e);var i=T0(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"pickingFBO",void 0),(0,S.Z)((0,J.Z)(n),"layer",void 0),(0,S.Z)((0,J.Z)(n),"width",0),(0,S.Z)((0,J.Z)(n),"height",0),(0,S.Z)((0,J.Z)(n),"alreadyInRendering",!1),(0,S.Z)((0,J.Z)(n),"pickFromPickingFBO",function(v){var m=v.x,x=v.y,A=v.lngLat,T=v.type;if(!(!n.layer.isVisible()||!n.layer.needPick(T))){var I=n.rendererService,F=I.getViewportSize,j=I.readPixels,X=I.useFramebuffer,ee=F(),be=ee.width,Fe=ee.height,We=n.layer.getLayerConfig(),et=We.enableHighlight,xt=We.enableSelect,Ct=m*ka,Yt=x*ka;if(!(Ct>be||Ct<0||Yt>Fe||Yt<0)){var ar;X(n.pickingFBO,function(){var Ar;if(ar=j({x:Math.round(Ct),y:Math.round(Fe-(x+1)*ka),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),ar[0]!==0||ar[1]!==0||ar[2]!==0){var Qr=zs(ar),vr=n.layer.getSource().getFeatureById(Qr),pn={x:m,y:x,type:T,lngLat:A,featureId:Qr,feature:vr};vr&&(n.layer.setCurrentPickId(Qr),n.triggerHoverOnLayer(pn))}else{var Tn={x:m,y:x,lngLat:A,type:n.layer.getCurrentPickId()===null?"un"+T:"mouseout",featureId:null,feature:null};n.triggerHoverOnLayer(Dp(Dp({},Tn),{},{type:"unpick"})),n.triggerHoverOnLayer(Tn),n.layer.setCurrentPickId(null)}et&&n.highlightPickedFeature(ar),xt&&T==="click"&&((Ar=ar)===null||Ar===void 0?void 0:Ar.toString())!==[0,0,0,0].toString()&&n.selectFeature(ar)})}}}),n}return(0,Pt.Z)(r,[{key:"getType",value:function(){return il.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(a,s){Tl((0,gt.Z)(r.prototype),"init",this).call(this,a,s),this.layer=a;var f=this.rendererService,v=f.createTexture2D,m=f.createFramebuffer,x=f.getViewportSize,A=x(),T=A.width,I=A.height;this.pickingFBO=m({color:v({width:T,height:I,wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE})}),this.interactionService.on(t.Hover,this.pickFromPickingFBO),this.interactionService.on(t.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(t.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(a){var s=this;if(!this.alreadyInRendering){var f=this.rendererService,v=f.getViewportSize,m=f.useFramebuffer,x=f.clear,A=v(),T=A.width,I=A.height;this.alreadyInRendering=!0,(this.width!==T||this.height!==I)&&(this.pickingFBO.resize({width:T,height:I}),this.width=T,this.height=I),m(this.pickingFBO,function(){x({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var F=s.layer.multiPassRenderer.getRenderFlag();s.layer.multiPassRenderer.setRenderFlag(!1),a.hooks.beforePickingEncode.call(),a.render(),a.hooks.afterPickingEncode.call(),s.layer.multiPassRenderer.setRenderFlag(F),s.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(a){this.layer.emit(a.type,a)}},{key:"highlightPickedFeature",value:function(a){var s=(0,dn.Z)(a,3),f=s[0],v=s[1],m=s[2];this.layer.hooks.beforeHighlight.call([f,v,m]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(a){var s=(0,dn.Z)(a,3),f=s[0],v=s[1],m=s[2];this.layer.hooks.beforeSelect.call([f,v,m]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(a){var s=a.featureId,f=os(s);this.selectFeature(new Uint8Array(f))}},{key:"highlightFeatureHandle",value:function(a){var s=a.featureId,f=os(s);this.highlightPickedFeature(new Uint8Array(f))}}]),r}(kp))||np),P0=Q(11700),O0=Q.n(P0),I0=Q(68929),R0=Q.n(I0),Rv,kv,Lv,Ml,Fp;function Jd(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function hf(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Jd(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Jd(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Dv=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ch=(Rv=(0,Xr.b2)(),kv=(0,Xr.f3)(yt.IShaderModuleService),Rv(Lv=(Ml=function(){function e(){(0,ht.Z)(this,e),Ln(this,"shaderModuleService",Fp,this),(0,S.Z)(this,"rendererService",void 0),(0,S.Z)(this,"config",void 0),(0,S.Z)(this,"quad",Dv),(0,S.Z)(this,"enabled",!0),(0,S.Z)(this,"renderToScreen",!1),(0,S.Z)(this,"model",void 0),(0,S.Z)(this,"name",void 0),(0,S.Z)(this,"optionsToUpdate",{})}return(0,Pt.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(r){this.name=r}},{key:"getType",value:function(){return il.PostProcessing}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(yt.IRendererService),this.shaderModuleService=r.getContainer().get(yt.IShaderModuleService);var a=this.rendererService,s=a.createAttribute,f=a.createBuffer,v=a.createModel,m=this.setupShaders(),x=m.vs,A=m.fs,T=m.uniforms;this.model=v({vs:x,fs:A,attributes:{a_Position:s({buffer:f({data:[-4,-4,4,-4,0,4],type:k.FLOAT}),size:2})},uniforms:hf(hf({u_Texture:null},T),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(r,n){var a=this,s=r.multiPassRenderer.getPostProcessor(),f=this.rendererService,v=f.useFramebuffer,m=f.getViewportSize,x=f.clear,A=m(),T=A.width,I=A.height;v(this.renderToScreen?null:s.getWriteFBO(),function(){x({framebuffer:s.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var F=hf({u_BloomFinal:0,u_Texture:s.getReadFBO(),u_ViewportSize:[T,I]},a.convertOptionsToUniforms(a.optionsToUpdate));n&&(F.u_BloomFinal=1,F.u_Texture2=n),a.model.draw({uniforms:F})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(r){this.enabled=r}},{key:"setRenderToScreen",value:function(r){this.renderToScreen=r}},{key:"updateOptions",value:function(r){this.optionsToUpdate=hf(hf({},this.optionsToUpdate),r)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(r){var n={};return Object.keys(r).forEach(function(a){Ci()(r[a])||(n["u_".concat(O0()(R0()(a)))]=r[a])}),n}}]),e}(),Fp=ri(Ml.prototype,"shaderModuleService",[kv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ml))||Lv),_m,xm;function bm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Em(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?bm(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):bm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function qx(e){var i=Kx();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function Kx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $x=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,Qx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Jx=(_m=(0,Xr.b2)(),_m(xm=function(e){(0,Pr.Z)(r,e);var i=qx(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Qx,fs:$x});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,f=a.fs,v=a.uniforms,m=this.rendererService.getViewportSize(),x=m.width,A=m.height;return{vs:s,fs:f,uniforms:Em(Em({},v),{},{u_ViewportSize:[x,A]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return Ci()(a.bloomRadius)||(s.u_radius=a.bloomRadius),Ci()(a.bloomIntensity)||(s.u_intensity=a.bloomIntensity),Ci()(a.bloomBaseRadio)||(s.u_baseRadio=a.bloomBaseRadio),s}}]),r}(Ch))||xm),Sm,Cm;function Am(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function wm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Am(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Am(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function eb(e){var i=tb();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function tb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rb=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,nb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ib=(Sm=(0,Xr.b2)(),Sm(Cm=function(e){(0,Pr.Z)(r,e);var i=eb(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:nb,fs:rb});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,f=a.fs,v=a.uniforms,m=this.rendererService.getViewportSize(),x=m.width,A=m.height;return{vs:s,fs:f,uniforms:wm(wm({},v),{},{u_ViewportSize:[x,A]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return Ci()(a.blurRadius)||(s.u_BlurDir=[a.blurRadius,0]),s}}]),r}(Ch))||Cm),Tm,Mm;function Pm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Om(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Pm(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Pm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ab(e){var i=ob();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function ob(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sb=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,ub=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,lb=(Tm=(0,Xr.b2)(),Tm(Mm=function(e){(0,Pr.Z)(r,e);var i=ab(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:ub,fs:sb});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,f=a.fs,v=a.uniforms,m=this.rendererService.getViewportSize(),x=m.width,A=m.height;return{vs:s,fs:f,uniforms:Om(Om({},v),{},{u_ViewportSize:[x,A]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return Ci()(a.blurRadius)||(s.u_BlurDir=[0,a.blurRadius]),s}}]),r}(Ch))||Mm),Im,Rm;function km(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Lm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?km(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):km(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function cb(e){var i=fb();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function fb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hb=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,pb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,db=(Im=(0,Xr.b2)(),Im(Rm=function(e){(0,Pr.Z)(r,e);var i=cb(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:pb,fs:hb});var a=this.shaderModuleService.getModule("colorhalftone-pass"),s=a.vs,f=a.fs,v=a.uniforms,m=this.rendererService.getViewportSize(),x=m.width,A=m.height;return{vs:s,fs:f,uniforms:Lm(Lm({},v),{},{u_ViewportSize:[x,A]})}}}]),r}(Ch))||Rm),Dm,Fm;function vb(e){var i=mb();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function mb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gb=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,yb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,_b=(Dm=(0,Xr.b2)(),Dm(Fm=function(e){(0,Pr.Z)(r,e);var i=vb(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:yb,fs:gb}),this.shaderModuleService.getModule("copy-pass")}}]),r}(Ch))||Fm),Bm,Nm;function zm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Um(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?zm(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):zm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function xb(e){var i=bb();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function bb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Eb=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Sb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Cb=(Bm=(0,Xr.b2)(),Bm(Nm=function(e){(0,Pr.Z)(r,e);var i=xb(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:Sb,fs:Eb});var a=this.shaderModuleService.getModule("hexagonalpixelate-pass"),s=a.vs,f=a.fs,v=a.uniforms,m=this.rendererService.getViewportSize(),x=m.width,A=m.height;return{vs:s,fs:f,uniforms:Um(Um({},v),{},{u_ViewportSize:[x,A]})}}}]),r}(Ch))||Nm),Zm,jm;function Vm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Gm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Vm(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Vm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Ab(e){var i=wb();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function wb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Tb=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Mb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Pb=(Zm=(0,Xr.b2)(),Zm(jm=function(e){(0,Pr.Z)(r,e);var i=Ab(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:Mb,fs:Tb});var a=this.shaderModuleService.getModule("ink-pass"),s=a.vs,f=a.fs,v=a.uniforms,m=this.rendererService.getViewportSize(),x=m.width,A=m.height;return{vs:s,fs:f,uniforms:Gm(Gm({},v),{},{u_ViewportSize:[x,A]})}}}]),r}(Ch))||jm),Hm,Wm;function Ob(e){var i=Ib();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function Ib(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Rb=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,kb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Lb=(Hm=(0,Xr.b2)(),Hm(Wm=function(e){(0,Pr.Z)(r,e);var i=Ob(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:kb,fs:Rb}),this.shaderModuleService.getModule("noise-pass")}}]),r}(Ch))||Wm),Xm,Ym;function Db(e){var i=Fb();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function Fb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Bb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Nb=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,zb=(Xm=(0,Xr.b2)(),Xm(Ym=function(e){(0,Pr.Z)(r,e);var i=Db(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:Bb,fs:Nb}),this.shaderModuleService.getModule("sepia-pass")}}]),r}(Ch))||Ym),qm,Km,$m,Qm,md,Jm,Ub=(qm=(0,Xr.b2)(),Km=(0,Xr.f3)(yt.IRendererService),$m=(0,Xr.zY)(),qm(Qm=(md=function(){function e(){(0,ht.Z)(this,e),Ln(this,"rendererService",Jm,this),(0,S.Z)(this,"passes",[]),(0,S.Z)(this,"readFBO",void 0),(0,S.Z)(this,"writeFBO",void 0)}return(0,Pt.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var r=this.rendererService,n=r.getViewportSize,a=r.createTexture2D,s=n(),f=s.width,v=s.height;return a({x:0,y:0,width:f,height:v,copy:!0})}},{key:"getReadFBOTex",value:function(){var r=this,n=this.rendererService.useFramebuffer;return new Promise(function(a,s){n(r.readFBO,(0,Z.Z)(q().mark(function f(){return q().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:a(r.getCurrentFBOTex());case 1:case"end":return m.stop()}},f)})))})}},{key:"renderBloomPass",value:function(){var i=(0,Z.Z)(q().mark(function n(a,s){var f,v;return q().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,this.getReadFBOTex();case 2:f=x.sent,v=0;case 4:if(!(v<4)){x.next=11;break}return x.next=7,s.render(a,f);case 7:this.swap(),v++,x.next=4;break;case 11:case"end":return x.stop()}},n,this)}));function r(n,a){return i.apply(this,arguments)}return r}()},{key:"render",value:function(){var i=(0,Z.Z)(q().mark(function n(a){var s,f;return q().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:s=0;case 1:if(!(s<this.passes.length)){m.next=15;break}if(f=this.passes[s],f.setRenderToScreen(this.isLastEnabledPass(s)),f.getName()!=="bloom"){m.next=9;break}return m.next=7,this.renderBloomPass(a,f);case 7:m.next=12;break;case 9:return m.next=11,f.render(a);case 11:s!==this.passes.length-1&&this.swap();case 12:s++,m.next=1;break;case 15:case"end":return m.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){this.readFBO.resize({width:r,height:n}),this.writeFBO.resize({width:r,height:n})}},{key:"add",value:function(r,n,a){r.init(n,a),this.passes.push(r)}},{key:"insert",value:function(r,n,a,s){r.init(a,s),this.passes.splice(n,0,r)}},{key:"getPostProcessingPassByName",value:function(r){return this.passes.find(function(n){return n.getName()===r})}},{key:"init",value:function(){var r=this.rendererService,n=r.createFramebuffer,a=r.createTexture2D;this.readFBO=n({color:a({width:1,height:1,wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE})}),this.writeFBO=n({color:a({width:1,height:1,wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(r){for(var n=r+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var r=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=r}}]),e}(),Jm=ri(md.prototype,"rendererService",[Km],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ri(md.prototype,"init",[$m],Object.getOwnPropertyDescriptor(md.prototype,"init"),md.prototype),md))||Qm),eg,tg;function Zb(e){var i=jb();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function jb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Vb=(eg=(0,Xr.b2)(),eg(tg=function(e){(0,Pr.Z)(r,e);var i=Zb(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"getType",value:function(){return il.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(a,s){Tl((0,gt.Z)(r.prototype),"init",this).call(this,a,s)}},{key:"render",value:function(a){var s=this.rendererService,f=s.useFramebuffer,v=s.clear,m=a.multiPassRenderer.getPostProcessor().getReadFBO();f(m,function(){v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:m}),a.multiPassRenderer.setRenderFlag(!1),a.models.forEach(function(x){x.draw({uniforms:a.layerModel.getUninforms()})}),a.multiPassRenderer.setRenderFlag(!0)})}}]),r}(kp))||tg),rg,ng,ig,k0,ag;function og(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function sg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?og(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):og(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Gb(e){var i=Hb();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function Hb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Wb=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,ug=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,Xb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function lg(e,i){for(var r=0,n=1/i,a=e;a>0;)r=r+n*(a%i),a=Math.floor(a/i),n=n/i;return r}var Yb=1,qb=(rg=(0,Xr.b2)(),ng=(0,Xr.f3)(yt.IShaderModuleService),rg(ig=(k0=function(e){(0,Pr.Z)(r,e);var i=Gb(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),Ln((0,J.Z)(n),"shaderModuleService",ag,(0,J.Z)(n)),(0,S.Z)((0,J.Z)(n),"haltonSequence",[]),(0,S.Z)((0,J.Z)(n),"accumulatingId",0),(0,S.Z)((0,J.Z)(n),"frame",0),(0,S.Z)((0,J.Z)(n),"timer",void 0),(0,S.Z)((0,J.Z)(n),"sampleRenderTarget",void 0),(0,S.Z)((0,J.Z)(n),"prevRenderTarget",void 0),(0,S.Z)((0,J.Z)(n),"outputRenderTarget",void 0),(0,S.Z)((0,J.Z)(n),"copyRenderTarget",void 0),(0,S.Z)((0,J.Z)(n),"blendModel",void 0),(0,S.Z)((0,J.Z)(n),"outputModel",void 0),(0,S.Z)((0,J.Z)(n),"copyModel",void 0),n}return(0,Pt.Z)(r,[{key:"getType",value:function(){return il.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(a,s){Tl((0,gt.Z)(r.prototype),"init",this).call(this,a,s);var f=this.rendererService,v=f.createFramebuffer,m=f.createTexture2D;this.sampleRenderTarget=v({color:m({width:1,height:1,wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE})}),this.prevRenderTarget=v({color:m({width:1,height:1,wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE})}),this.outputRenderTarget=v({color:m({width:1,height:1,wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE})}),this.copyRenderTarget=v({color:m({width:1,height:1,wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE})});for(var x=0;x<30;x++)this.haltonSequence.push([lg(x,2),lg(x,3)]);this.blendModel=this.createTriangleModel("blend-pass",Wb),this.outputModel=this.createTriangleModel("copy-pass",ug,{blend:{enable:!0,func:{srcRGB:k.ONE,dstRGB:k.ONE_MINUS_SRC_ALPHA,srcAlpha:k.ONE,dstAlpha:k.ONE_MINUS_SRC_ALPHA},equation:{rgb:k.FUNC_ADD,alpha:k.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",ug)}},{key:"render",value:function(a){var s=this,f=this.rendererService,v=f.clear,m=f.getViewportSize,x=f.useFramebuffer,A=m(),T=A.width,I=A.height;this.sampleRenderTarget.resize({width:T,height:I}),this.prevRenderTarget.resize({width:T,height:I}),this.outputRenderTarget.resize({width:T,height:I}),this.copyRenderTarget.resize({width:T,height:I}),this.resetFrame(),this.stopAccumulating();var F=a.multiPassRenderer.getPostProcessor().getReadFBO();x(F,function(){v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:F}),a.multiPassRenderer.setRenderFlag(!1),a.render(),a.multiPassRenderer.setRenderFlag(!0)});var j=function X(ee){!s.accumulatingId||ee!==s.accumulatingId||s.isFinished()||(s.doRender(a),ha.requestAnimationFrame(function(){X(ee)}))};this.accumulatingId=Yb++,this.timer=ha.setTimeout(function(){j(s.accumulatingId)},50)}},{key:"doRender",value:function(a){var s=this,f=this.rendererService,v=f.clear,m=f.getViewportSize,x=f.useFramebuffer,A=m(),T=A.width,I=A.height,F=a.getLayerConfig(),j=F.jitterScale,X=j===void 0?1:j,ee=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((ee[0]*2-1)/T*X,(ee[1]*2-1)/I*X),a.multiPassRenderer.setRenderFlag(!1),a.hooks.beforeRender.call(),x(this.sampleRenderTarget,function(){v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:s.sampleRenderTarget}),a.render()}),a.hooks.afterRender.call(),a.multiPassRenderer.setRenderFlag(!0);var be=a.getLayerConfig();x(this.outputRenderTarget,function(){s.blendModel.draw({uniforms:{u_opacity:be.opacity||1,u_MixRatio:s.frame===0?1:.9,u_Diffuse1:s.sampleRenderTarget,u_Diffuse2:s.frame===0?a.multiPassRenderer.getPostProcessor().getReadFBO():s.prevRenderTarget}})}),this.frame===0&&v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(x(this.copyRenderTarget,function(){s.outputModel.draw({uniforms:{u_Texture:s.outputRenderTarget}})}),x(a.multiPassRenderer.getPostProcessor().getReadFBO(),function(){s.copyModel.draw({uniforms:{u_Texture:s.copyRenderTarget}})}),a.multiPassRenderer.getPostProcessor().render(a));var Fe=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=Fe,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,ha.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(a,s,f){this.shaderModuleService.registerModule(a,{vs:Xb,fs:s});var v=this.shaderModuleService.getModule(a),m=v.vs,x=v.fs,A=v.uniforms,T=this.rendererService,I=T.createAttribute,F=T.createBuffer,j=T.createModel;return j(sg({vs:m,fs:x,attributes:{a_Position:I({buffer:F({data:[-4,-4,4,-4,0,4],type:k.FLOAT}),size:2})},uniforms:sg({},A),depth:{enable:!1},count:3},f))}}]),r}(kp),ag=ri(k0.prototype,"shaderModuleService",[ng],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k0))||ig),ev=new Xr.W2;ev.bind(yt.IGlobalConfigService).to(ma).inSingletonScope(),(0,Xr.GW)((0,Xr.b2)(),ls.EventEmitter),ev.bind(yt.IEventEmitter).to(ls.EventEmitter);var cg=(0,Mo.Z)(ev,!1),tv=function(i){var r=cg.lazyInject(i);return function(n,a,s){r.call(this,n,a),s&&(s.initializer=function(){return n[a]})}},h3=function(i){var r=cg.lazyMultiInject(i);return function(n,a,s){r.call(this,n,a),s&&(s.initializer=function(){return n[a]})}},rc=ev,Kb=0;function $b(){var e=new Xr.W2;return e.parent=ev,e.bind(yt.SceneID).toConstantValue("".concat(Kb++)),e.bind(yt.IShaderModuleService).to(Mv).inSingletonScope(),e.bind(yt.ILayerService).to(Hs).inSingletonScope(),e.bind(yt.ISceneService).to(C0).inSingletonScope(),e.bind(yt.ICameraService).to(ai).inSingletonScope(),e.bind(yt.ICoordinateSystemService).to(hs).inSingletonScope(),e.bind(yt.IInteractionService).to(z).inSingletonScope(),e.bind(yt.IPickingService).to(ji).inSingletonScope(),e.bind(yt.IControlService).to(so).inSingletonScope(),e.bind(yt.IMarkerService).to(ts).inSingletonScope(),e.bind(yt.IIconService).to(jh).inSingletonScope(),e.bind(yt.IFontService).to(td).inSingletonScope(),e.bind(yt.IPopupService).to(So).inSingletonScope(),e.bind(yt.INormalPass).to(Hd).whenTargetNamed("clear"),e.bind(yt.INormalPass).to(M0).whenTargetNamed("pixelPicking"),e.bind(yt.INormalPass).to(Vb).whenTargetNamed("render"),e.bind(yt.INormalPass).to(qb).whenTargetNamed("taa"),e.bind(yt.IFactoryNormalPass).toFactory(function(i){return function(r){return i.container.getNamed(yt.INormalPass,r)}}),e.bind(yt.IPostProcessingPass).to(_b).whenTargetNamed("copy"),e.bind(yt.IPostProcessingPass).to(Jx).whenTargetNamed("bloom"),e.bind(yt.IPostProcessingPass).to(ib).whenTargetNamed("blurH"),e.bind(yt.IPostProcessingPass).to(lb).whenTargetNamed("blurV"),e.bind(yt.IPostProcessingPass).to(Lb).whenTargetNamed("noise"),e.bind(yt.IPostProcessingPass).to(zb).whenTargetNamed("sepia"),e.bind(yt.IPostProcessingPass).to(db).whenTargetNamed("colorHalftone"),e.bind(yt.IPostProcessingPass).to(Cb).whenTargetNamed("hexagonalPixelate"),e.bind(yt.IPostProcessingPass).to(Pb).whenTargetNamed("ink"),e.bind(yt.IFactoryPostProcessingPass).toFactory(function(i){return function(r){var n=i.container.getNamed(yt.IPostProcessingPass,r);return n.setName(r),n}}),e}function fg(e){var i=new Xr.W2;return i.parent=e,i.bind(yt.IStyleAttributeService).to(Ac).inSingletonScope(),i.bind(yt.IMultiPassRenderer).to(Kd).inSingletonScope(),i.bind(yt.IPostProcessor).to(Ub).inSingletonScope(),i}var p3=Q(74691),Qb=null;function d3(e){return Qb.indexOf(e)}var Jb=2,v3=4,e2=64,m3=128,t2=256,r2=512,g3=8192,y3=16384,_3=32768,n2=null,hg=131072,x3=262144,i2=524288,b3=1048576,a2=2097152,E3=4194304,o2=8388608,s2=16777216,u2=null;function Fv(e,i){return e=_clamp(Math.floor(e),0,255),i=_clamp(Math.floor(i),0,255),256*e+i}function S3(e){var i=e.color,r=e.radius,n=e.tileX,a=e.tileY,s=e.shape,f=e.opacity,v=e.stroke,m=e.strokeWidth,x=e.strokeOpacity,A=[],T=[],I=[],F=[Fv(i[0],i[1]),Fv(i[2],i[3])],j=[Fv(v[0],v[1]),Fv(v[2],v[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(X){var ee=_slicedToArray(X,2),be=ee[0],Fe=ee[1];A.push([].concat(F,[(be+1)*o2+(Fe+1)*a2+getShapeIndex(s)*hg+r,(n+512)*i2+(a+512)*e2])),T.push([].concat(j,[m,x])),I.push([f,0,0,0])}),{packedBuffer:A,packedBuffer2:T,packedBuffer3:I}}function C3(e,i){if(e===0&&!i)return 0;if(e===1&&i)return 4294967295;var r=i?1:0,n=Math.floor(e*127);return n*u2+r*s2+n*hg+r*n2+n*r2+r*t2+n*Jb+r}var Ws;(function(e){e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none"})(Ws||(Ws={}));var lu;(function(e){e.LINEAR="linear",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat"})(lu||(lu={}));var ip;(function(e){e.CONSTANT="constant",e.VARIABLE="variable"})(ip||(ip={}));var Fn;(function(e){e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform"})(Fn||(Fn={}));var l2=["mapload","mapchange","mapAfterFrameChange"],Bp={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},L0=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],ap;(function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter"})(ap||(ap={}));function pg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function dg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?pg(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function c2(e){var i=f2();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function f2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var h2=0,Bv=function(e){(0,Pr.Z)(r,e);var i=c2(r);function r(n){var a;return(0,ht.Z)(this,r),a=i.call(this),(0,S.Z)((0,J.Z)(a),"controlOption",void 0),(0,S.Z)((0,J.Z)(a),"container",void 0),(0,S.Z)((0,J.Z)(a),"sceneContainer",void 0),(0,S.Z)((0,J.Z)(a),"mapsService",void 0),(0,S.Z)((0,J.Z)(a),"renderService",void 0),(0,S.Z)((0,J.Z)(a),"layerService",void 0),(0,S.Z)((0,J.Z)(a),"controlService",void 0),(0,S.Z)((0,J.Z)(a),"isShow",void 0),a.controlOption=dg(dg({},a.getDefault()),n||{}),a}return(0,Pt.Z)(r,[{key:"getDefault",value:function(){return{position:ap.TOPRIGHT,name:"".concat(h2++)}}},{key:"setPosition",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ap.BOTTOMRIGHT,s=this.controlService;return s&&s.removeControl(this),this.controlOption.position=a,s&&s.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(a){this.mapsService=a.get(yt.IMapService),this.renderService=a.get(yt.IRendererService),this.layerService=a.get(yt.ILayerService),this.controlService=a.get(yt.IControlService),this.sceneContainer=a,this.isShow=!0,this.container=this.onAdd();var s=this.container,f=this.controlOption.position,v=this.controlService.controlCorners[f];return Ul(s,"l7-control"),f.indexOf("bottom")!==-1?v.insertBefore(s,v.firstChild):v.appendChild(s),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var a=this.container;Ul(a,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var a=this.container;Qu(a,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;fc(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(a){if(this.mapsService&&a&&a.screenX>0&&a.screenY>0){var s=this.mapsService.getContainer();s!==null&&s.focus()}}}]),r}(ls.EventEmitter);function p2(e){var i=d2();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function d2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var A3=function(e){(0,Pr.Z)(r,e);var i=p2(r);function r(n){var a;return(0,ht.Z)(this,r),a=i.call(this,n),(0,S.Z)((0,J.Z)(a),"layerControlInputs",void 0),(0,S.Z)((0,J.Z)(a),"layers",void 0),(0,S.Z)((0,J.Z)(a),"lastZIndex",void 0),(0,S.Z)((0,J.Z)(a),"handlingClick",void 0),(0,S.Z)((0,J.Z)(a),"layersLink",void 0),(0,S.Z)((0,J.Z)(a),"baseLayersList",void 0),(0,S.Z)((0,J.Z)(a),"separator",void 0),(0,S.Z)((0,J.Z)(a),"overlaysList",void 0),(0,S.Z)((0,J.Z)(a),"form",void 0),a.layerControlInputs=[],a.layers=[],a.lastZIndex=0,a.handlingClick=!1,a.initLayers(),vl(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,J.Z)(a)),a}return(0,Pt.Z)(r,[{key:"getDefault",value:function(){return{collapsed:!0,position:ap.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var a=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(s){s.layer.on("remove",a.onLayerChange),s.layer.on("add",a.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(a,s){return this.addLayer(a,s,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var a=this.renderService.getViewportSize(),s=a.height;Ul(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var f=s-(this.container.offsetTop+50);return f<this.form.clientHeight?(Ul(this.form,"l7-control-layers-scrollbar"),this.form.style.height=f+"px"):Qu(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return Qu(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var a=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(s){s.layer.off("remove",a.onLayerChange),s.layer.off("add",a.onLayerChange)}))}},{key:"initLayout",value:function(){var a="l7-control-layers",s=this.container=Za("div",a),f=this.controlOption.collapsed;s.setAttribute("aria-haspopup","true");var v=this.form=Za("form",a+"-list");f&&(this.mapsService.on("click",this.collapse),s.addEventListener("mouseenter",this.expand),s.addEventListener("mouseleave",this.collapse)),this.layersLink=Za("a",a+"-toggle",s);var m=this.layersLink;m.title="Layers",f||this.expand(),this.baseLayersList=Za("div",a+"-base",v),this.separator=Za("div",a+"-separator",v),this.overlaysList=Za("div",a+"-overlays",v),s.appendChild(v)}},{key:"initLayers",value:function(){var a=this,s=this.controlOption,f=s.baseLayers,v=f===void 0?{}:f,m=s.overlayers,x=m===void 0?{}:m;Object.keys(v).forEach(function(A,T){a.addLayer(v[A],A,!1)}),Object.keys(x).forEach(function(A,T){a.addLayer(x[A],A,!0)})}},{key:"update",value:function(){if(!this.container)return this;Zl(this.baseLayersList),Zl(this.overlaysList),this.layerControlInputs=[];var a,s,f,v,m=0;for(f=0;f<this.layers.length;f++)v=this.layers[f],this.addItem(v),s=s||v.overlay,a=a||!v.overlay,m+=v.overlay?0:1;return this.controlOption.hideSingleBase&&(a=a&&m>1,this.baseLayersList.style.display=a?"":"none"),this.separator.style.display=s&&a?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var a=this.layerControlInputs,s,f,v=this.mapsService.getZoom(),m=a.length-1;m>=0;m--)if(s=a[m],f=this.layerService.getLayer(s.layerId),f&&f.inited){var x=f.getMinZoom(),A=f.getMaxZoom();s.disabled=v<x||v>A}}},{key:"addLayer",value:function(a,s,f){this.mapsService&&(a.on("add",this.onLayerChange),a.on("remove",this.onLayerChange)),this.layers.push({layer:a,name:s,overlay:f});var v=this.controlOption,m=v.sortLayers,x=v.sortFunction,A=v.autoZIndex;m&&this.layers.sort(function(T,I){return x(T.layer,I.layer,T.name,I.name)}),A&&a.setZIndex&&(this.lastZIndex++,a.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(a){this.handlingClick||this.update();var s=this.layerService.getLayer(a.target.layerId),f=s!=null&&s.overlay?a.type==="add"?"overlayadd":"overlayremove":a.type==="add"?"baselayerchange":null;f&&this.emit(f,s)}},{key:"createRadioElement",value:function(a,s){var f='<input type="radio" class="l7-control-layers-selector" name="'+a+'"'+(s?' checked="checked"':"")+"/>",v=document.createElement("div");return v.innerHTML=f,v.firstChild}},{key:"addItem",value:function(a){var s=document.createElement("label"),f=this.layerService.getLayer(a.layer.id),v=f&&f.inited&&a.layer.isVisible(),m;a.overlay?(m=document.createElement("input"),m.type="checkbox",m.className="l7-control-layers-selector",m.defaultChecked=v):m=this.createRadioElement("l7-base-layers",v),this.layerControlInputs.push(m),m.layerId=a.layer.id,m.addEventListener("click",this.onInputClick);var x=document.createElement("span");x.innerHTML=" "+a.name;var A=document.createElement("div");s.appendChild(A),A.appendChild(m),A.appendChild(x);var T=a.overlay?this.overlaysList:this.baseLayersList;return T.appendChild(s),this.checkDisabledLayers(),s}},{key:"onInputClick",value:function(){var a=this.layerControlInputs,s,f,v=[],m=[];this.handlingClick=!0;for(var x=a.length-1;x>=0;x--)s=a[x],f=this.layerService.getLayer(s.layerId),s.checked?v.push(f):s.checked||m.push(f);m.forEach(function(A){A.hide()}),v.forEach(function(A){A.show()}),this.handlingClick=!1}}]),r}(Bv);function v2(e){var i=m2();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function m2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var g2=function(e){(0,Pr.Z)(r,e);var i=v2(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"getDefault",value:function(){return{position:ap.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var a="l7-control-logo",s=Za("div",a),f=Za("a","l7-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://antv.alipay.com/l7",f.setAttribute("aria-label","AntV logo"),f.setAttribute("rel","noopener nofollow"),s.appendChild(f),s}},{key:"onRemove",value:function(){return null}}]),r}(Bv);function y2(e){var i=_2();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function _2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var w3=function(e){(0,Pr.Z)(r,e);var i=y2(r);function r(n){var a;return(0,ht.Z)(this,r),a=i.call(this,n),(0,S.Z)((0,J.Z)(a),"mScale",void 0),(0,S.Z)((0,J.Z)(a),"iScale",void 0),vl(["update"],(0,J.Z)(a)),a}return(0,Pt.Z)(r,[{key:"getDefault",value:function(){return{position:ap.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var a="l7-control-scale",s=Za("div",a);this.addScales(a+"-line",s);var f=this.controlOption.updateWhenIdle;return this.mapsService.on(f?"moveend":"mapmove",this.update),this.mapsService.on(f?"zoomend":"zoomchange",this.update),this.update(),s}},{key:"onRemove",value:function(){var a=this.controlOption.updateWhenIdle;this.mapsService.off(a?"zoomend":"zoomchange",this.update),this.mapsService.off(a?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var a=this.mapsService,s=this.controlOption.maxWidth,f=a.getSize()[1]/2,v=a.containerToLngLat([0,f]),m=a.containerToLngLat([s,f]),x=As([v.lng,v.lat],[m.lng,m.lat]);this.updateScales(x)}},{key:"updateScales",value:function(a){var s=this.controlOption,f=s.metric,v=s.imperial;f&&a&&this.updateMetric(a),v&&a&&this.updateImperial(a)}},{key:"updateMetric",value:function(a){var s=this.getRoundNum(a),f=s<1e3?s+" m":s/1e3+" km";this.updateScale(this.mScale,f,s/a)}},{key:"updateImperial",value:function(a){var s=a*3.2808399,f,v,m;s>5280?(f=s/5280,v=this.getRoundNum(f),this.updateScale(this.iScale,v+" mi",v/f)):(m=this.getRoundNum(s),this.updateScale(this.iScale,m+" ft",m/s))}},{key:"updateScale",value:function(a,s,f){var v=this.controlOption.maxWidth;a.style.width=Math.round(v*f)+"px",a.innerHTML=s}},{key:"getRoundNum",value:function(a){var s=Math.pow(10,(Math.floor(a)+"").length-1),f=a/s;return f=f>=10?10:f>=5?5:f>=3?3:f>=2?2:1,s*f}},{key:"addScales",value:function(a,s){var f=this.controlOption,v=f.metric,m=f.imperial;v&&(this.mScale=Za("div",a,s)),m&&(this.iScale=Za("div",a,s))}}]),r}(Bv);function x2(e){var i=b2();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function b2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var T3=function(e){(0,Pr.Z)(r,e);var i=x2(r);function r(n){var a;return(0,ht.Z)(this,r),a=i.call(this,n),(0,S.Z)((0,J.Z)(a),"disabled",void 0),(0,S.Z)((0,J.Z)(a),"zoomInButton",void 0),(0,S.Z)((0,J.Z)(a),"zoomOutButton",void 0),vl(["updateDisabled","zoomIn","zoomOut"],(0,J.Z)(a)),a}return(0,Pt.Z)(r,[{key:"getDefault",value:function(){return{position:ap.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var a="l7-control-zoom",s=Za("div",a+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,a+"-in",s,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,a+"-out",s,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),s}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(a,s,f,v,m){var x=Za("a",f,v);return x.innerHTML=a,x.title=s,x.href="javascript:void(0)",x.addEventListener("click",m),x}},{key:"updateDisabled",value:function(){var a=this.mapsService,s="l7-disabled";Qu(this.zoomInButton,s),Qu(this.zoomOutButton,s),(this.disabled||a.getZoom()<=a.getMinZoom())&&Ul(this.zoomOutButton,s),(this.disabled||a.getZoom()>=a.getMaxZoom())&&Ul(this.zoomInButton,s)}}]),r}(Bv);function vg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function mg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?vg(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):vg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function E2(e){var i=S2();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function S2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gg=function(e){(0,Pr.Z)(r,e);var i=E2(r);function r(n){var a;return(0,ht.Z)(this,r),a=i.call(this),(0,S.Z)((0,J.Z)(a),"markerOption",void 0),(0,S.Z)((0,J.Z)(a),"defaultMarker",void 0),(0,S.Z)((0,J.Z)(a),"popup",void 0),(0,S.Z)((0,J.Z)(a),"mapsService",void 0),(0,S.Z)((0,J.Z)(a),"sceneSerive",void 0),(0,S.Z)((0,J.Z)(a),"lngLat",void 0),(0,S.Z)((0,J.Z)(a),"scene",void 0),(0,S.Z)((0,J.Z)(a),"added",!1),(0,S.Z)((0,J.Z)(a),"eventHandle",function(s){a.emit(s.type,{target:s,data:a.markerOption.extData,lngLat:a.lngLat})}),a.markerOption=mg(mg({},a.getDefault()),n),vl(["update","onMove","onUp","addDragHandler","onMapClick"],(0,J.Z)(a)),a.init(),a}return(0,Pt.Z)(r,[{key:"getDefault",value:function(){return{element:void 0,anchor:Fu.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(a){this.scene=a,this.mapsService=a.get(yt.IMapService),this.sceneSerive=a.get(yt.ISceneService);var s=this.markerOption,f=s.element,v=s.draggable;return this.mapsService.getMarkerContainer().appendChild(f),this.registerMarkerEvent(f),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var a=this.markerOption.element;return a&&fc(a),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(a){return this.lngLat=a,Array.isArray(a)&&(this.lngLat={lng:a[0],lat:a[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(a){var s=this;if(!this.added)return this.once("added",function(){s.setElement(a)}),this;var f=this.markerOption.element;return f&&fc(f),this.markerOption.element=a,this.init(),this.mapsService.getMarkerContainer().appendChild(a),this.registerMarkerEvent(a),this.update(),this}},{key:"openPopup",value:function(){var a=this;if(!this.added)return this.once("added",function(){a.openPopup()}),this;var s=this.popup;return s?(s.isOpen()||s.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var a=this;this.added||this.once("added",function(){a.closePopup()});var s=this.popup;return s&&s.remove(),this}},{key:"setPopup",value:function(a){return this.popup=a,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var a=this.popup;if(a)a.isOpen()?a.remove():a.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(a){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(a){this.markerOption.extData=a}},{key:"update",value:function(){if(!!this.mapsService){var a=this.markerOption,s=a.element,f=a.anchor;this.updatePosition(),go(s,"".concat(el[f]))}}},{key:"onMapClick",value:function(a){var s=this.markerOption.element;this.popup&&s&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var a=this.markerOption,s=a.element,f=a.offsets,v=this.lngLat,m=v.lng,x=v.lat,A=this.mapsService.getBounds(),T=this.mapsService.lngLatToContainer([m,x]);if(s){s.style.display="block",s.style.whiteSpace="nowrap";var I=this.mapsService.getContainer(),F=0,j=0;if(I&&(F=I.scrollWidth,j=I.scrollHeight),Math.abs(A[0][0])>180||Math.abs(A[1][0])>180){if(T.x>F){var X=this.mapsService.lngLatToContainer([m-360,x]);T.x=X.x}if(T.x<0){var ee=this.mapsService.lngLatToContainer([m+360,x]);T.x=ee.x}}(T.x>F||T.x<0||T.y>j||T.y<0)&&(s.style.display="none"),s.style.left=T.x+f[0]+"px",s.style.top=T.y-f[1]+"px"}}}},{key:"init",value:function(){var a=this,s=this.markerOption.element,f=this.markerOption,v=f.color,m=f.anchor;if(!s){this.defaultMarker=!0,s=Za("div"),this.markerOption.element=s;var x=document.createElementNS("http://www.w3.org/2000/svg","svg");x.setAttributeNS(null,"display","block"),x.setAttributeNS(null,"height","48px"),x.setAttributeNS(null,"width","48px"),x.setAttributeNS(null,"viewBox","0 0 1024 1024");var A=document.createElementNS("http://www.w3.org/2000/svg","path");A.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),A.setAttributeNS(null,"fill",v),x.appendChild(A),s.appendChild(x)}Ul(s,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(T){var I,F,j=((I=a.markerOption)===null||I===void 0?void 0:I.style)&&((F=a.markerOption)===null||F===void 0?void 0:F.style[T]);s&&(s.style[T]=j)}),s.addEventListener("click",function(T){a.onMapClick(T)}),s.addEventListener("click",this.eventHandle),Xc(s,m,"marker")}},{key:"registerMarkerEvent",value:function(a){a.addEventListener("mousemove",this.eventHandle),a.addEventListener("click",this.eventHandle),a.addEventListener("mousedown",this.eventHandle),a.addEventListener("mouseup",this.eventHandle),a.addEventListener("dblclick",this.eventHandle),a.addEventListener("contextmenu",this.eventHandle),a.addEventListener("mouseover",this.eventHandle),a.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var a=this.getElement();a.removeEventListener("mousemove",this.eventHandle),a.removeEventListener("click",this.eventHandle),a.removeEventListener("mousedown",this.eventHandle),a.removeEventListener("mouseup",this.eventHandle),a.removeEventListener("dblclick",this.eventHandle),a.removeEventListener("contextmenu",this.eventHandle),a.removeEventListener("mouseover",this.eventHandle),a.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(a){throw new Error("Method not implemented.")}},{key:"onUp",value:function(a){throw new Error("Method not implemented.")}}]),r}(ls.EventEmitter);function yg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function _g(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?yg(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function C2(e){var i=A2();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function A2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var M3=function(e){(0,Pr.Z)(r,e);var i=C2(r);function r(n){var a,s;return(0,ht.Z)(this,r),s=i.call(this),(0,S.Z)((0,J.Z)(s),"markers",[]),(0,S.Z)((0,J.Z)(s),"markerLayerOption",void 0),(0,S.Z)((0,J.Z)(s),"clusterIndex",void 0),(0,S.Z)((0,J.Z)(s),"points",[]),(0,S.Z)((0,J.Z)(s),"clusterMarkers",[]),(0,S.Z)((0,J.Z)(s),"mapsService",void 0),(0,S.Z)((0,J.Z)(s),"scene",void 0),(0,S.Z)((0,J.Z)(s),"zoom",void 0),(0,S.Z)((0,J.Z)(s),"bbox",void 0),s.markerLayerOption=Oo()(s.getDefault(),n),vl(["update"],(0,J.Z)(s)),s.zoom=((a=s.markerLayerOption.clusterOption)===null||a===void 0?void 0:a.zoom)||-99,s}return(0,Pt.Z)(r,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(a){return this.scene=a,this.mapsService=a.get(yt.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(a){var s=this.markerLayerOption.cluster;if(s&&(this.addPoint(a,this.markers.length),this.mapsService)){var f=this.mapsService.getZoom(),v=this.mapsService.getBounds();this.bbox=In(v,.5),this.zoom=Math.floor(f),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(a)}},{key:"removeMarker",value:function(a){this.markers.indexOf(a);var s=this.markers.indexOf(a);s>-1&&this.markers.splice(s,1)}},{key:"hide",value:function(){this.markers.map(function(a){a.getElement().style.opacity="0"}),this.clusterMarkers.map(function(a){a.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(a){a.getElement().style.opacity="1"}),this.clusterMarkers.map(function(a){a.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var a=this.markerLayerOption.cluster;return a?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var a=this;this.getMarkers().forEach(function(s){s.addTo(a.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(a){a.remove()}),this.clusterMarkers.forEach(function(a){a.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(a,s){var f=a.getLnglat(),v=f.lng,m=f.lat,x={geometry:{type:"Point",coordinates:[v,m]},properties:_g(_g({},a.getExtData()),{},{marker_id:s})};this.points.push(x),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var a=this.markerLayerOption.clusterOption,s=a.radius,f=a.minZoom,v=f===void 0?0:f,m=a.maxZoom;this.clusterIndex=new(_l())({radius:s,minZoom:v,maxZoom:m}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(a,s){var f=this,v=a[0].concat(a[1]),m=this.clusterIndex.getClusters(v,s);this.clusterMarkers.forEach(function(x){x.remove()}),this.clusterMarkers=[],m.forEach(function(x){var A,T=f.markerLayerOption.clusterOption,I=T.field,F=T.method;if(x.properties&&(A=x.properties)!==null&&A!==void 0&&A.cluster_id){var j,X=f.getLeaves((j=x.properties)===null||j===void 0?void 0:j.cluster_id);if(x.properties.clusterData=X,I&&F){var ee=X==null?void 0:X.map(function(xt){var Ct=(0,S.Z)({},I,xt.properties[I]);return Ct}),be=Gl(ee,I),Fe=Qf(F,be),We="point_"+F;x.properties[We]=Fe.toFixed(2)}}var et=f.clusterMarker(x);f.clusterMarkers.push(et),et.addTo(f.scene)})}},{key:"getLeaves",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return a?this.clusterIndex.getLeaves(a,s,f):null}},{key:"clusterMarker",value:function(a){var s=this.markerLayerOption.clusterOption,f=s,v=f.element,m=v===void 0?this.generateElement.bind(this):v,x=new gg({element:m(a)}).setLnglat({lng:a.geometry.coordinates[0],lat:a.geometry.coordinates[1]});return x}},{key:"normalMarker",value:function(a){var s=a.properties.marker_id;return this.markers[s]}},{key:"update",value:function(){if(!!this.mapsService){var a=this.mapsService.getZoom(),s=this.mapsService.getBounds();(!this.bbox||Math.abs(a-this.zoom)>=1||!Cn(this.bbox,s))&&(this.bbox=In(s,.5),this.zoom=Math.floor(a),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(a){var s=Za("div","l7-marker-cluster"),f=Za("div","",s),v=Za("span","",f),m=this.markerLayerOption.clusterOption,x=m.field,A=m.method;a.properties.point_count=a.properties.point_count||1;var T=x&&A?a.properties["point_"+A]||a.properties[x]:a.properties.point_count;return v.textContent=T,s}}]),r}(ls.EventEmitter);function xg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function bg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?xg(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function w2(e){var i=T2();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function T2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Eg=function(e){(0,Pr.Z)(r,e);var i=w2(r);function r(n){var a;return(0,ht.Z)(this,r),a=i.call(this),(0,S.Z)((0,J.Z)(a),"popupOption",void 0),(0,S.Z)((0,J.Z)(a),"mapsService",void 0),(0,S.Z)((0,J.Z)(a),"sceneSerive",void 0),(0,S.Z)((0,J.Z)(a),"lngLat",void 0),(0,S.Z)((0,J.Z)(a),"content",void 0),(0,S.Z)((0,J.Z)(a),"closeButton",void 0),(0,S.Z)((0,J.Z)(a),"timeoutInstance",void 0),(0,S.Z)((0,J.Z)(a),"container",void 0),(0,S.Z)((0,J.Z)(a),"tip",void 0),(0,S.Z)((0,J.Z)(a),"scene",void 0),a.popupOption=bg(bg({},a.getdefault()),n),vl(["update","onClickClose","remove"],(0,J.Z)(a)),a}return(0,Pt.Z)(r,[{key:"addTo",value:function(a){var s=this;return this.mapsService=a.get(yt.IMapService),this.sceneSerive=a.get(yt.ISceneService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=a,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){s.mapsService.on("click",s.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(a){var s=window.document.createDocumentFragment(),f=window.document.createElement("body"),v;for(f.innerHTML=a;v=f.firstChild,!!v;)s.appendChild(v);return this.setDOMContent(s)}},{key:"setLnglat",value:function(a){return this.lngLat=a,Array.isArray(a)&&(this.lngLat={lng:a[0],lat:a[1]}),this.mapsService&&(this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(a){return this.setDOMContent(window.document.createTextNode(a))}},{key:"setMaxWidth",value:function(a){return this.popupOption.maxWidth=a,this.update(),this}},{key:"setDOMContent",value:function(a){return this.createContent(),this.content.appendChild(a),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&fc(this.content),this.content=Za("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=Za("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(a,s,f){var v=window.document.createElement(a);return s!==void 0&&(v.className=s),f&&f.appendChild(v),v}},{key:"removeDom",value:function(a){a.parentNode&&a.parentNode.removeChild(a)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:Fu.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(a){a.stopPropagation&&a.stopPropagation(),this.remove()}},{key:"update",value:function(){var a=this,s=this.lngLat,f=this.popupOption,v=f.className,m=f.maxWidth,x=f.anchor;if(!(!this.mapsService||!s||!this.content)){var A=this.mapsService.getMarkerContainer();if(!this.container&&A){this.container=this.creatDom("div","l7-popup",A),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),v&&v.split(" ").forEach(function(I){return a.container.classList.add(I)});var T=this.popupOption.stopPropagation;T&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(I){a.container.addEventListener(I,function(F){F.stopPropagation()})}),this.container.style.whiteSpace="nowrap"}m&&this.container.style.maxWidth!==m&&(this.container.style.maxWidth=m),this.updatePosition(),go(this.container,"".concat(el[x])),Xc(this.container,x,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var a=this.lngLat,s=a.lng,f=a.lat,v=this.popupOption.offsets,m=this.mapsService.lngLatToContainer([s,f]);this.container.style.left=m.x+v[0]+"px",this.container.style.top=m.y-v[1]+"px"}}}]),r}(ls.EventEmitter);function M2(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var f=i.createElement("style");return f.type="text/css",f.styleSheet?f.styleSheet.cssText=e:f.appendChild(i.createTextNode(e)),a.appendChild(f),f}}M2(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
}

.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 5px;
}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}

.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-left: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-bottom: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-bottom: none;
  border-left: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-bottom: none;
  border-right: none;
  border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-left: none;
  border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  padding: 0;
  font-size: 25px;
  line-height: 20px;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
  display: none;
}

.l7-popup-track-pointer * {
  pointer-events: none;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}

.l7-map:active .l7-popup-track-pointer {
  display: none;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
  border-radius: 4px;
}
.l7-bar a,
.l7-bar a:hover {
  background-color: #fff;
  width: 30px;
  height: 30px;
  font-size: 20px;
  display: block;
  text-align: center;
  text-decoration: none;
  color: #8e9dab;
}
.l7-bar a,
.l7-control-layers-toggle {
  background-position: 50% 50%;
  background-repeat: no-repeat;
  display: block;
}
.l7-bar a:hover {
  background-color: #f4f4f4;
}
.l7-bar a:first-child {
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}
.l7-bar a:last-child {
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 2px;
  border-bottom: none;
}
.l7-bar a.l7-disabled {
  cursor: default;
  background-color: #f4f4f4;
  color: #bbb;
}

/* control positioning */

.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-hide {
  display: none;
}
.l7-control {
  position: relative;
  z-index: 800;
  pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control {
  float: left;
  clear: both;
}
.l7-top,
.l7-bottom {
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-top {
  top: 0;
}
.l7-right {
  right: 0;
}
.l7-bottom {
  bottom: 0;
}
.l7-left {
  left: 0;
}
.l7-center {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-bottom.l7-center,
.l7-top.l7-center {
  width: 100%;
}
.l7-right.l7-center,
.l7-left.l7-center {
  height: 100%;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-top.l7-center,
.l7-left.l7-center {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}

.l7-bottom.l7-center,
.l7-right.l7-center {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}

.l7-center .l7-control {
  margin-right: 10px;
  margin-bottom: 10px;
}

.l7-control {
  float: left;
  clear: both;
}
.l7-right .l7-control {
  float: right;
}
.l7-top .l7-control {
  margin-top: 10px;
}
.l7-bottom .l7-control {
  margin-bottom: 10px;
}
.l7-left .l7-control {
  margin-left: 10px;
}
.l7-right .l7-control {
  margin-right: 10px;
}

/* attribution and scale controls */

.l7-control-container .l7-control-attribution {
  background: #fff;
  background: rgba(59, 58, 58, 0.7);
  margin: 0;
}
.l7-control-attribution,
.l7-control-scale-line {
  padding: 0 5px;
  color: #333;
}
.l7-control-attribution a {
  text-decoration: none;
}
.l7-control-attribution a:hover {
  text-decoration: underline;
}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
}
.l7-left .l7-control-scale {
  margin-left: 5px;
}
.l7-bottom .l7-control-scale {
  margin-bottom: 5px;
}
.l7-control-scale-line {
  border: 2px solid #000;
  border-top: none;
  color: #000;
  line-height: 1.1;
  padding: 2px 5px 1px;
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;

  background: #fff;
}
.l7-control-scale-line:not(:first-child) {
  border-top: 2px solid #777;
  border-bottom: none;
  margin-top: -2px;
}
.l7-control-scale-line:not(:first-child):not(:last-child) {
  border-bottom: 2px solid #777;
}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  border: 2px solid rgba(0, 0, 0, 0.2);
  background-clip: padding-box;
}
/*logo */

.l7-ctrl-logo {
  background-size: 100% 100%;
  width: 89px;
  height: 16px;
  margin: 0 0 -3px -3px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  background-repeat: no-repeat;
  cursor: pointer;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 2px;
}
.l7-control-layers-toggle {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
  width: 30px;
  height: 30px;
  background-size: 20px 20px;
}

.l7-touch .l7-control-layers-toggle {
  width: 44px;
  height: 44px;
}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
  display: none;
}
.l7-control-layers-expanded .l7-control-layers-list {
  display: block;
  position: relative;
}
.l7-control-layers-expanded {
  padding: 6px 10px 6px 6px;
  color: #59626b;
  background: #fff;
}
.l7-control-layers-scrollbar {
  overflow-y: scroll;
  overflow-x: hidden;
  padding-right: 5px;
}
.l7-control-layers-selector {
  margin-top: 2px;
  position: relative;
  top: 1px;
}
.l7-control-layers label {
  display: block;
  padding: 8px;
}
.l7-control-layers label input[type='radio'],
.l7-control-layers label input[type='checkbox'] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
  height: 0;
  border-top: 1px solid #d8d8d8;
  margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
}
.amap-logo {
  display: none !important;
}
`);var P2=Q(52353),Sg=Q.n(P2),O2=Q(13218),ro=Q.n(O2),op,Cg=(op={},(0,S.Z)(op,Ws.additive,{enable:!0,func:{srcRGB:k.ONE,dstRGB:k.ONE,srcAlpha:1,dstAlpha:1}}),(0,S.Z)(op,Ws.none,{enable:!1}),(0,S.Z)(op,Ws.normal,{enable:!0,func:{srcRGB:k.SRC_ALPHA,dstRGB:k.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,S.Z)(op,Ws.subtractive,{enable:!0,func:{srcRGB:k.ONE,dstRGB:k.ONE,srcAlpha:k.ZERO,dstAlpha:k.ONE_MINUS_SRC_COLOR},equation:{rgb:k.FUNC_SUBTRACT,alpha:k.FUNC_SUBTRACT}}),(0,S.Z)(op,Ws.max,{enable:!0,func:{srcRGB:k.ONE,dstRGB:k.ONE},equation:{rgb:k.MAX_EXT}}),(0,S.Z)(op,Ws.min,{enable:!0,func:{srcRGB:k.ONE,dstRGB:k.ONE},equation:{rgb:k.MIN_EXT}}),op),I2=Q(81763),Oi=Q.n(I2),P3=1024;function al(e,i,r,n,a){i.updateStyleAttribute(e,r,n,a)}function R2(e,i){e.opacity&&Nv("opacity",i,e.opacity),e.strokeWidth&&Nv("strokeWidth",i,e.strokeWidth),e.strokeOpacity&&Nv("strokeOpacity",i,e.strokeOpacity),e.stroke&&k2("stroke",i,e.stroke),e.offsets&&Ag("offsets",i,e.offsets),e.textOffset&&Ag("textOffset",i,e.textOffset),e.thetaOffset&&Nv("thetaOffset",i,e.thetaOffset)}function Nv(e,i,r){w()(r)?al(e,i,r,function(n){return n}):Oi()(r)?al(e,i,[r],void 0):Array.isArray(r)&&r.length===2?w()(r[0])&&L()(r[1])||w()(r[0])&&Array.isArray(r[1])&&Oi()(r[1][0])&&Oi()(r[1][1])?al(e,i,r[0],r[1]):al(e,i,[1],void 0):al(e,i,[1],void 0)}function Ag(e,i,r){w()(r)?al(e,i,r,function(n){return n}):Array.isArray(r)&&r.length===2&&w()(r[0])&&L()(r[1])?al(e,i,r[0],r[1]):Array.isArray(r)&&r.length===2&&Oi()(r[0])&&Oi()(r[1])?al(e,i,r,void 0):al(e,i,[0,0],void 0)}function k2(e,i,r){w()(r)?al(e,i,r,void 0):Array.isArray(r)&&r.length===2&&(w()(r[0])&&L()(r[1])||w()(r[0])&&Array.isArray(r[1])&&r[1].length>0)?al(e,i,r[0],r[1]):al(e,i,"#fff",void 0)}var ks;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL"})(ks||(ks={}));function L2(e,i){var r=[i[0]-e[0],i[1]-e[1]],n=Qo(r),a=[e[0]+n[0]*1e-4,e[1]+n[1]*1e-4];return a}function D2(e,i){var r=this;e.length>0&&i.version===ks["GAODE2.x"]&&(typeof e[0].coordinates[0]=="number"?e.filter(function(n){return!n.originCoordinates}).map(function(n){n.version=ks["GAODE2.x"],n.originCoordinates=cloneDeep(n.coordinates),n.coordinates=r.mapService.lngLatToCoord(n.coordinates)}):e.filter(function(n){return!n.originCoordinates}).map(function(n){n.version=ks["GAODE2.x"],n.originCoordinates=cloneDeep(n.coordinates),n.coordinates=r.mapService.lngLatToCoords(n.coordinates)}))}function F2(e,i){e.length>0&&i.version===ks.SIMPLE&&e.map(function(r){r.simpleCoordinate||(r.coordinates=B2(r.coordinates,i),r.simpleCoordinate=!0)})}function B2(e,i){if(typeof e[0]=="number")return i.simpleMapCoord.unproject(e);if(e[0]&&e[0][0]instanceof Array){var r=[];return e.map(function(a){var s=[];a.map(function(f){s.push(i.simpleMapCoord.unproject(f))}),r.push(s)}),r}else{var n=[];return e.map(function(a){n.push(i.simpleMapCoord.unproject(a))}),n}}function N2(e,i,r){var n;if(!e.scale)return[];var a=(e==null||(n=e.scale)===null||n===void 0?void 0:n.scalers)||[],s=[];a.forEach(function(v){var m,x=v.field;(i.hasOwnProperty(x)||((m=e.scale)===null||m===void 0?void 0:m.type)==="variable")&&s.push(i[x])});var f=e.mapping?e.mapping(s):[];return e.name==="color"&&!yu(f[0])?[r]:f}function z2(e,i,r,n,a,s){var f=s==null?void 0:s.getLayerConfig(),v=f.arrow,m=v===void 0?{enable:!1}:v,x=i.map(function(A){var T={id:A._id,coordinates:A.coordinates};if(e.filter(function(j){return j.scale!==void 0}).forEach(function(j){var X=N2(j,A,a);j.needRemapping=!1,j.name==="color"&&(X=X.map(function(ee){return pi(ee)})),T[j.name]=Array.isArray(X)&&X.length===1?X[0]:X,j.name==="shape"&&(T.shape=r.getIconFontKey(T[j.name]))}),T.shape==="line"&&m.enable){var I=T.coordinates,F=L2(I[0],I[1]);T.coordinates.splice(1,0,F,F)}return T});return D2(x,n),F2(x,n),x}function U2(e,i,r,n,a,s){var f=new Fh(a,s),v=e.getBottomColor(),m=n.getLayerStyleAttributes()||[],x=f.data.dataArray,A=x,T=z2(m,A,i,r,v,e);return f.destroy(),T}function wg(e){return e.map(function(i){return typeof i=="string"&&(i=[i,{}]),i})}function Z2(e,i,r,n){var a=e.multiPassRenderer,s=e.getLayerConfig(),f=s.enablePicking,v=s.enableTAA;return v?a.add(n("taa")):a.add(n("render")),wg(i).forEach(function(m){var x=(0,dn.Z)(m,2),A=x[0],T=x[1];a.add(r(A),T)}),a.add(r("copy")),a}var j2=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]];function V2(e,i,r){if(typeof i=="string"&&typeof r=="string"&&i!==r){if(e.type==="PointLayer"){e.dataState.dataSourceNeedUpdate=!0;return}j2.map(function(n){if(n.includes(i)&&n.includes(r)){e.dataState.dataSourceNeedUpdate=!0;return}})}}var G2=["passes"],H2=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber"],Tg,D0,Mg;function W2(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=X2(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function X2(e,i){if(!!e){if(typeof e=="string")return Pg(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Pg(e,i)}}function Pg(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Og(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Wu(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Og(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Og(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Y2(e){var i=q2();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function q2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ig=0,K2=(Tg=tv(yt.IGlobalConfigService),D0=function(e){(0,Pr.Z)(r,e);var i=Y2(r);function r(){var n,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,ht.Z)(this,r),n=i.call(this),(0,S.Z)((0,J.Z)(n),"id","".concat(Ig++)),(0,S.Z)((0,J.Z)(n),"name","".concat(Ig)),(0,S.Z)((0,J.Z)(n),"type",void 0),(0,S.Z)((0,J.Z)(n),"visible",!0),(0,S.Z)((0,J.Z)(n),"zIndex",0),(0,S.Z)((0,J.Z)(n),"minZoom",void 0),(0,S.Z)((0,J.Z)(n),"maxZoom",void 0),(0,S.Z)((0,J.Z)(n),"inited",!1),(0,S.Z)((0,J.Z)(n),"layerModelNeedUpdate",!1),(0,S.Z)((0,J.Z)(n),"pickedFeatureID",null),(0,S.Z)((0,J.Z)(n),"selectedFeatureID",null),(0,S.Z)((0,J.Z)(n),"styleNeedUpdate",!1),(0,S.Z)((0,J.Z)(n),"rendering",void 0),(0,S.Z)((0,J.Z)(n),"clusterZoom",0),(0,S.Z)((0,J.Z)(n),"layerType",void 0),(0,S.Z)((0,J.Z)(n),"isLayerGroup",!1),(0,S.Z)((0,J.Z)(n),"triangulation",void 0),(0,S.Z)((0,J.Z)(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,S.Z)((0,J.Z)(n),"hooks",{init:new Jo,afterInit:new Jo,beforeRender:new Jo,beforeRenderData:new nu,afterRender:new ra,beforePickingEncode:new ra,afterPickingEncode:new ra,beforeHighlight:new ra(["pickedColor"]),afterHighlight:new ra,beforeSelect:new ra(["pickedColor"]),afterSelect:new ra,beforeDestroy:new ra,afterDestroy:new ra}),(0,S.Z)((0,J.Z)(n),"models",[]),(0,S.Z)((0,J.Z)(n),"multiPassRenderer",void 0),(0,S.Z)((0,J.Z)(n),"plugins",void 0),(0,S.Z)((0,J.Z)(n),"sourceOption",void 0),(0,S.Z)((0,J.Z)(n),"layerModel",void 0),(0,S.Z)((0,J.Z)(n),"shapeOption",void 0),(0,S.Z)((0,J.Z)(n),"sceneContainer",void 0),(0,S.Z)((0,J.Z)(n),"layerChildren",[]),(0,S.Z)((0,J.Z)(n),"masks",[]),Ln((0,J.Z)(n),"configService",Mg,(0,J.Z)(n)),(0,S.Z)((0,J.Z)(n),"shaderModuleService",void 0),(0,S.Z)((0,J.Z)(n),"cameraService",void 0),(0,S.Z)((0,J.Z)(n),"coordinateService",void 0),(0,S.Z)((0,J.Z)(n),"iconService",void 0),(0,S.Z)((0,J.Z)(n),"fontService",void 0),(0,S.Z)((0,J.Z)(n),"pickingService",void 0),(0,S.Z)((0,J.Z)(n),"rendererService",void 0),(0,S.Z)((0,J.Z)(n),"layerService",void 0),(0,S.Z)((0,J.Z)(n),"interactionService",void 0),(0,S.Z)((0,J.Z)(n),"mapService",void 0),(0,S.Z)((0,J.Z)(n),"styleAttributeService",void 0),(0,S.Z)((0,J.Z)(n),"layerSource",void 0),(0,S.Z)((0,J.Z)(n),"postProcessingPassFactory",void 0),(0,S.Z)((0,J.Z)(n),"normalPassFactory",void 0),(0,S.Z)((0,J.Z)(n),"animateOptions",{enable:!1}),(0,S.Z)((0,J.Z)(n),"container",void 0),(0,S.Z)((0,J.Z)(n),"encodedData",void 0),(0,S.Z)((0,J.Z)(n),"configSchema",void 0),(0,S.Z)((0,J.Z)(n),"currentPickId",null),(0,S.Z)((0,J.Z)(n),"rawConfig",void 0),(0,S.Z)((0,J.Z)(n),"needUpdateConfig",void 0),(0,S.Z)((0,J.Z)(n),"pendingStyleAttributes",[]),(0,S.Z)((0,J.Z)(n),"scaleOptions",{}),(0,S.Z)((0,J.Z)(n),"animateStartTime",void 0),(0,S.Z)((0,J.Z)(n),"aniamateStatus",!1),(0,S.Z)((0,J.Z)(n),"bottomColor","rgba(0, 0, 0, 0)"),(0,S.Z)((0,J.Z)(n),"isDestroied",!1),(0,S.Z)((0,J.Z)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var s=n.getLayerConfig(),f=s.autoFit,v=s.fitBoundsOptions;f&&n.fitBounds(v),n.reRender()}),n.name=a.name||n.id,n.zIndex=a.zIndex||0,n.rawConfig=a,n}return(0,Pt.Z)(r,[{key:"addMaskLayer",value:function(a){this.masks.push(a)}},{key:"removeMaskLayer",value:function(a){var s=this.masks.indexOf(a);s>-1&&this.masks.splice(s,1),a.destroy()}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(a){if(!this.inited)this.needUpdateConfig=Wu(Wu({},this.needUpdateConfig),a);else{var s=this.container.get(yt.SceneID);R2(a,this),this.configService.setLayerConfig(s,this.id,Wu(Wu(Wu({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),a)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(a,s){this.container=a,this.sceneContainer=s}},{key:"getContainer",value:function(){return this.container}},{key:"setBottomColor",value:function(a){this.bottomColor=a}},{key:"getBottomColor",value:function(){return this.bottomColor}},{key:"addPlugin",value:function(a){return this.plugins.push(a),this}},{key:"init",value:function(){var a=this,s=this.container.get(yt.SceneID);this.configService.setLayerConfig(s,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(yt.IIconService),this.fontService=this.container.get(yt.IFontService),this.rendererService=this.container.get(yt.IRendererService),this.layerService=this.container.get(yt.ILayerService),this.interactionService=this.container.get(yt.IInteractionService),this.pickingService=this.container.get(yt.IPickingService),this.mapService=this.container.get(yt.IMapService);var f=this.getLayerConfig(),v=f.enableMultiPassRenderer,m=f.passes;v&&m!==null&&m!==void 0&&m.length&&m.length>0&&this.mapService.on("mapAfterFrameChange",function(){a.renderLayers()}),this.cameraService=this.container.get(yt.ICameraService),this.coordinateService=this.container.get(yt.ICoordinateSystemService),this.shaderModuleService=this.container.get(yt.IShaderModuleService),this.postProcessingPassFactory=this.container.get(yt.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(yt.IFactoryNormalPass),this.styleAttributeService=this.container.get(yt.IStyleAttributeService),this.multiPassRenderer=this.container.get(yt.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(I){var F=I.attributeName,j=I.attributeField,X=I.attributeValues,ee=I.updateOptions;a.styleAttributeService.updateStyleAttribute(F,{scale:Wu({field:j},a.splitValuesAndCallbackInAttribute(X,a.getLayerConfig()[F]))},ee)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(yt.ILayerPlugin);var x=W2(this.plugins),A;try{for(x.s();!(A=x.n()).done;){var T=A.value;T.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(I){x.e(I)}finally{x.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"updateModelData",value:function(a){a.attributes&&a.elements?this.models.map(function(s){s.updateAttributesAndElements(a.attributes,a.elements)}):console.warn("data error")}},{key:"createModelData",value:function(a,s){if(this.layerModel.createModelData)return this.layerModel.createModelData(s);var f=this.calculateEncodeData(a,s),v=this.triangulation;return f&&v?this.styleAttributeService.createAttributesAndIndices(f,v):{attributes:void 0,elements:void 0}}},{key:"calculateEncodeData",value:function(a,s){return this.inited?U2(this,this.fontService,this.mapService,this.styleAttributeService,a,s):(console.warn("layer not inited!"),null)}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(Wu(Wu({},this.getDefaultConfig()),this.rawConfig));var a=this.getLayerConfig(),s=a.animateOption;s!=null&&s.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(a,s,f){return this.updateStyleAttribute("color",a,s,f),this}},{key:"texture",value:function(a,s,f){return this.updateStyleAttribute("texture",a,s,f),this}},{key:"rotate",value:function(a,s,f){return this.updateStyleAttribute("rotate",a,s,f),this}},{key:"size",value:function(a,s,f){return this.updateStyleAttribute("size",a,s,f),this}},{key:"filter",value:function(a,s,f){return this.updateStyleAttribute("filter",a,s,f),this}},{key:"shape",value:function(a,s,f){var v,m,x,A=(v=this.styleAttributeService)===null||v===void 0||(m=v.getLayerStyleAttribute("shape"))===null||m===void 0||(x=m.scale)===null||x===void 0?void 0:x.field,T=a;return this.shapeOption={field:a,values:s},this.updateStyleAttribute("shape",a,s,f),V2(this,A,T),this}},{key:"label",value:function(a,s,f){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:a,attributeValues:s,updateOptions:f}),this}},{key:"animate",value:function(a){var s={};return ro()(a)?(s.enable=!0,s=Wu(Wu({},s),a)):s.enable=a,this.updateLayerConfig({animateOption:s}),this}},{key:"source",value:function(a,s){return a!=null&&a.data?(this.setSource(a),this):(this.sourceOption={data:a,options:s},this.clusterZoom=0,this)}},{key:"setData",value:function(a,s){var f=this;return this.inited?this.layerSource.setData(a,s):this.on("inited",function(){var v=f.getSource();v?f.layerSource.setData(a,s):(f.source(new Fh(a,s)),f.sourceEvent())}),this}},{key:"style",value:function(a){var s=this,f=this.getLayerConfig(),v=a.passes,m=(0,Ga.Z)(a,G2);return v&&wg(v).forEach(function(x){var A=s.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(x[0]);A&&A.updateOptions(x[1])}),this.rawConfig=Wu(Wu({},this.rawConfig),m),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),f&&f.mask===!0&&a.mask===!1&&(this.clearModels(),this.models=this.layerModel.buildModels()),this}},{key:"scale",value:function(a,s){return ro()(a)?this.scaleOptions=Wu(Wu({},this.scaleOptions),a):this.scaleOptions[a]=s,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.getEncodedData().length!==0&&this.renderModels(),this}},{key:"renderMultiPass",value:function(){var n=(0,Z.Z)(q().mark(function s(){return q().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(this.getEncodedData().length===0){v.next=7;break}if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){v.next=6;break}return v.next=4,this.multiPassRenderer.render();case 4:v.next=7;break;case 6:this.multiPassRenderer?this.renderModels():this.renderModels();case 7:case"end":return v.stop()}},s,this)}));function a(){return n.apply(this,arguments)}return a}()},{key:"active",value:function(a){var s={};return s.enableHighlight=ro()(a)?!0:a,ro()(a)?(s.enableHighlight=!0,a.color&&(s.highlightColor=a.color),a.mix&&(s.activeMix=a.mix)):s.enableHighlight=!!a,this.updateLayerConfig(s),this}},{key:"setActive",value:function(a,s){var f=this;if(ro()(a)){var v=a.x,m=v===void 0?0:v,x=a.y,A=x===void 0?0:x;this.updateLayerConfig({highlightColor:ro()(s)?s.color:this.getLayerConfig().highlightColor,activeMix:ro()(s)?s.mix:this.getLayerConfig().activeMix}),this.pick({x:m,y:A})}else this.updateLayerConfig({pickedFeatureID:a,highlightColor:ro()(s)?s.color:this.getLayerConfig().highlightColor,activeMix:ro()(s)?s.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call(os(a)).then(function(){setTimeout(function(){f.reRender()},1)})}},{key:"select",value:function(a){var s={};return s.enableSelect=ro()(a)?!0:a,ro()(a)?(s.enableSelect=!0,a.color&&(s.selectColor=a.color),a.mix&&(s.selectMix=a.mix)):s.enableSelect=!!a,this.updateLayerConfig(s),this}},{key:"setSelect",value:function(a,s){var f=this;if(ro()(a)){var v=a.x,m=v===void 0?0:v,x=a.y,A=x===void 0?0:x;this.updateLayerConfig({selectColor:ro()(s)?s.color:this.getLayerConfig().selectColor,selectMix:ro()(s)?s.mix:this.getLayerConfig().selectMix}),this.pick({x:m,y:A})}else this.updateLayerConfig({pickedFeatureID:a,selectColor:ro()(s)?s.color:this.getLayerConfig().selectColor,selectMix:ro()(s)?s.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(os(a)).then(function(){setTimeout(function(){f.reRender()},1)})}},{key:"setBlend",value:function(a){return this.updateLayerConfig({blend:a}),this.layerModelNeedUpdate=!0,this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.type==="CanvasLayer"&&this.layerModel.clearCanvas&&this.layerModel.clearCanvas(),this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(a){return this.zIndex=a,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(a){this.currentPickId=a}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(a){this.selectedFeatureID=a}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var a=this.mapService.getZoom(),s=this.getLayerConfig(),f=s.visible,v=s.minZoom,m=v===void 0?-Infinity:v,x=s.maxZoom,A=x===void 0?Infinity:x;return!!f&&a>=m&&a<=A}},{key:"setMultiPass",value:function(a,s){if(this.updateLayerConfig({enableMultiPassRenderer:a}),s&&this.updateLayerConfig({passes:s}),a){var f=this.getLayerConfig(),v=f.passes,m=v===void 0?[]:v;this.multiPassRenderer=Z2(this,m,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var x=this.rendererService.getViewportSize(),A=x.width,T=x.height;this.multiPassRenderer.resize(A,T)}return this}},{key:"setMinZoom",value:function(a){return this.updateLayerConfig({minZoom:a}),this}},{key:"getMinZoom",value:function(){var a=this.getLayerConfig(),s=a.minZoom;return s}},{key:"getMaxZoom",value:function(){var a=this.getLayerConfig(),s=a.maxZoom;return s}},{key:"get",value:function(a){var s=this.getLayerConfig();return s[a]}},{key:"setMaxZoom",value:function(a){return this.updateLayerConfig({maxZoom:a}),this}},{key:"setAutoFit",value:function(a){return this.updateLayerConfig({autoFit:a}),this}},{key:"fitBounds",value:function(a){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var s=this.getSource(),f=s.extent,v=f.some(function(m){return Math.abs(m)===Infinity});return v?this:(this.mapService.fitBounds([[f[0],f[1]],[f[2],f[3]]],a),this)}},{key:"destroy",value:function(){var a;this.isDestroied||(this.layerChildren.map(function(s){return s.destroy()}),this.layerChildren=[],this.masks.map(function(s){return s.destroy()}),this.masks=[],this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(a=this.layerModel)===null||a===void 0||a.clearModels(),this.models=[],this.layerService.cleanRemove(this),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroied=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(a){return a.destroy()}),this.layerModel.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(a){return a.needRescale||a.needRemapping||a.needRegenerateVertices}).length}},{key:"setSource",value:function(a){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=a,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var s=this.mapService.getZoom();this.layerSource.updateClusterData(s)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(a){this.encodedData=a}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(a){return this.styleAttributeService.getLayerAttributeScale(a)}},{key:"getLegendItems",value:function(a){var s=this.styleAttributeService.getLayerAttributeScale(a);if(!s)return[];if(s.invertExtent){var f=s.range().map(function(x){return(0,S.Z)({value:s.invertExtent(x)},a,x)});return f}else if(s.ticks){var v=s.ticks().map(function(x){return(0,S.Z)({value:x},a,s(x))});return v}else if(s!=null&&s.domain){var m=s.domain().filter(function(x){return!Sg()(x)}).map(function(x){return(0,S.Z)({value:x},a,s(x))});return m}return[]}},{key:"pick",value:function(a){var s=a.x,f=a.y;this.interactionService.triggerHover({x:s,y:f})}},{key:"boxSelect",value:function(a,s){this.pickingService.boxPickLayer(this,a,s)}},{key:"buildLayerModel",value:function(a){var s=a.moduleName,f=a.vertexShader,v=a.fragmentShader,m=a.triangulation,x=a.segmentNumber,A=(0,Ga.Z)(a,H2);this.shaderModuleService.registerModule(s,{vs:f,fs:v});var T=this.shaderModuleService.getModule(s),I=T.vs,F=T.fs,j=T.uniforms,X=this.rendererService.createModel,ee=this.styleAttributeService.createAttributesAndIndices(this.encodedData,m,x),be=ee.attributes,Fe=ee.elements;return X(Wu({attributes:be,uniforms:j,fs:F,vs:I,elements:Fe,blend:Cg[Ws.normal]},A))}},{key:"createAttrubutes",value:function(a){var s=a.triangulation,f=this.styleAttributeService.createAttributes(this.encodedData,s),v=f.attributes;return v}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(a){var s=this.getLayerConfig(),f=s.enableHighlight,v=f===void 0?!0:f,m=s.enableSelect,x=m===void 0?!0:m,A=this.eventNames().indexOf(a)!==-1||this.eventNames().indexOf("un"+a)!==-1;return(a==="click"||a==="dblclick")&&x&&(A=!0),a==="mousemove"&&(v||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(A=!0),this.isVisible()&&A}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderMulPass",value:function(){var n=(0,Z.Z)(q().mark(function s(f){return q().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,f.render();case 2:case"end":return m.stop()}},s)}));function a(s){return n.apply(this,arguments)}return a}()},{key:"renderModels",value:function(a){var s=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.layerModel.renderUpdate&&this.layerModel.renderUpdate(),this.models.forEach(function(f){f.draw({uniforms:s.layerModel.getUninforms()},a)})),this}},{key:"updateStyleAttribute",value:function(a,s,f,v){this.inited?this.styleAttributeService.updateStyleAttribute(a,{scale:Wu({field:s},this.splitValuesAndCallbackInAttribute(f,this.getLayerConfig()[s]))},v):this.pendingStyleAttributes.push({attributeName:a,attributeField:s,attributeValues:f,updateOptions:v})}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(a){console.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&(this.layerService.updateLayerRenderList(),this.layerService.renderLayers())}},{key:"splitValuesAndCallbackInAttribute",value:function(a,s){return{values:L()(a)?void 0:a||s,callback:L()(a)?a:void 0}}}]),r}(ls.EventEmitter),Mg=ri(D0.prototype,"configService",[Tg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D0),$2=Q(18446),Oc=Q.n($2),Rg,F0,kg;function Q2(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=J2(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function J2(e,i){if(!!e){if(typeof e=="string")return Lg(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Lg(e,i)}}function Lg(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var eE=(Rg=tv(yt.IGlobalConfigService),F0=function(){function e(i){(0,ht.Z)(this,e),(0,S.Z)(this,"triangulation",void 0),(0,S.Z)(this,"createTexture2D",void 0),(0,S.Z)(this,"layer",void 0),(0,S.Z)(this,"dataTexture",void 0),(0,S.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,S.Z)(this,"rowCount",void 0),(0,S.Z)(this,"cacheStyleProperties",void 0),(0,S.Z)(this,"cellLength",void 0),(0,S.Z)(this,"cellProperties",void 0),(0,S.Z)(this,"cellTypeLayout",void 0),(0,S.Z)(this,"stylePropertyesExist",void 0),(0,S.Z)(this,"dataTextureTest",void 0),Ln(this,"configService",kg,this),(0,S.Z)(this,"shaderModuleService",void 0),(0,S.Z)(this,"rendererService",void 0),(0,S.Z)(this,"iconService",void 0),(0,S.Z)(this,"fontService",void 0),(0,S.Z)(this,"styleAttributeService",void 0),(0,S.Z)(this,"mapService",void 0),(0,S.Z)(this,"cameraService",void 0),(0,S.Z)(this,"layerService",void 0),this.layer=i,this.rendererService=i.getContainer().get(yt.IRendererService),this.shaderModuleService=i.getContainer().get(yt.IShaderModuleService),this.styleAttributeService=i.getContainer().get(yt.IStyleAttributeService),this.mapService=i.getContainer().get(yt.IMapService),this.iconService=i.getContainer().get(yt.IIconService),this.fontService=i.getContainer().get(yt.IFontService),this.cameraService=i.getContainer().get(yt.ICameraService),this.layerService=i.getContainer().get(yt.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var r=this.rendererService.createTexture2D;this.createTexture2D=r,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8Array(4),mag:k.NEAREST,min:k.NEAREST,width:1,height:1}))}return(0,Pt.Z)(e,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,this.stylePropertyesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(r){var n=!1;return Oc()(r.thetaOffset,this.cacheStyleProperties.thetaOffset)||(n=!0,this.cacheStyleProperties.thetaOffset=r.thetaOffset),Oc()(r.opacity,this.cacheStyleProperties.opacity)||(n=!0,this.cacheStyleProperties.opacity=r.opacity),Oc()(r.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(n=!0,this.cacheStyleProperties.strokeOpacity=r.strokeOpacity),Oc()(r.strokeWidth,this.cacheStyleProperties.strokeWidth)||(n=!0,this.cacheStyleProperties.strokeWidth=r.strokeWidth),Oc()(r.stroke,this.cacheStyleProperties.stroke)||(n=!0,this.cacheStyleProperties.stroke=r.stroke),Oc()(r.offsets,this.cacheStyleProperties.offsets)||(n=!0,this.cacheStyleProperties.offsets=r.offsets),this.dataTexture===void 0&&(n=!0),n}},{key:"judgeStyleAttributes",value:function(r){this.clearLastCalRes(),r.opacity!==void 0&&!Oi()(r.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),r.strokeOpacity!==void 0&&!Oi()(r.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),r.strokeWidth!==void 0&&!Oi()(r.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),r.stroke!==void 0&&!this.isStaticColor(r.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),r.offsets!==void 0&&!this.isOffsetStatic(r.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2),r.thetaOffset!==void 0&&!Oi()(r.thetaOffset)&&(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertyesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(r){return w()(r)?!!(0,Ns.ZP)(r):!1}},{key:"getStrokeColor",value:function(r){if(this.isStaticColor(r)){var n=pi(r);return n[0]=n[0]?n[0]:0,n[1]=n[1]?n[1]:0,n[2]=n[2]?n[2]:0,n[3]=n[3]?n[3]:0,n}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(r){return!!(Array.isArray(r)&&r.length===2&&Oi()(r[0])&&Oi()(r[1]))}},{key:"patchMod",value:function(r,n){for(var a=0;a<n;a++)r.push(-1)}},{key:"patchData",value:function(r,n,a){var s=Q2(a),f;try{for(s.s();!(f=s.n()).done;){var v=f.value,m=v.attr,x=v.count,A=n[m];A!==void 0?m==="stroke"?r.push.apply(r,(0,Se.Z)(pi(A))):m==="offsets"?this.isOffsetStatic(A)?r.push(-A[0],A[1]):r.push(0,0):r.push(Oi()(A)?A:1):this.patchMod(r,x)}}catch(T){s.e(T)}finally{s.f()}}},{key:"calDataFrame",value:function(r,n,a){for(var s=n.length,f=Math.ceil(s*r/this.DATA_TEXTURE_WIDTH),v=f*this.DATA_TEXTURE_WIDTH,m=[],x=0;x<s;x++){var A=n[x];this.patchData(m,A,a)}for(var T=m.length;T<v;T++)m.push(-1);return{data:m,width:this.DATA_TEXTURE_WIDTH,height:f}}},{key:"getBlend",value:function(){var r=this.layer.getLayerConfig(),n=r.blend,a=n===void 0?"normal":n;return Cg[Ws[a]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.duration||4,r.interval||.2,r.trailLength||.1]}},{key:"startModelAnimate",value:function(){var r=this.layer.getLayerConfig(),n=r.animateOption;n.enable&&this.layer.setAnimateStartTime()}}]),e}(),kg=ri(F0.prototype,"configService",[Rg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F0),tE=Q(9187),Ic=Q.n(tE),zv={};function O3(e){var i=calculateCentroid(e.coordinates);return{vertices:[].concat(_toConsumableArray(i),_toConsumableArray(i),_toConsumableArray(i),_toConsumableArray(i)),indices:[0,1,2,2,3,0],size:i.length}}function I3(e){var i=calculateCentroid(e.coordinates),r=lglt2xyz(i);return{vertices:[].concat(_toConsumableArray(r),_toConsumableArray(r),_toConsumableArray(r),_toConsumableArray(r)),indices:[0,1,2,2,3,0],size:r.length}}function R3(e){var i=e.shape,r=iE(i,!1),n=r.positions,a=r.index,s=r.normals;return{vertices:n,indices:a,normals:s,size:5}}function k3(e){var i=calculateCentroid(e.coordinates);return{vertices:_toConsumableArray(i),indices:[0],size:i.length}}function L3(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,a=new ExtrudePolyline({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var s=i;Array.isArray(s[0][0])||(s=[i]);var f=r;Array.isArray(f[0][0])||(f=[r]);for(var v=0;v<s.length;v++){var m=s[v],x=f[v];a.extrude_gaode2(m,x)}}else{var A=i;A[0]&&!Array.isArray(A[0][0])&&(A=[i]),A.forEach(function(I){a.extrude(I)})}var T=a.complex;return{vertices:T.positions,indices:T.indices,normals:T.normals,indexes:T.indexes,size:6}}function D3(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,a=new ExtrudePolyline({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var s=i;Array.isArray(s[0][0])||(s=[i]);var f=r;Array.isArray(f[0][0])||(f=[r]);for(var v=0;v<s.length;v++){var m=s[v],x=f[v];a.simpleExtrude_gaode2(m,x)}}else{var A=i;A[0]&&!Array.isArray(A[0][0])&&(A=[i]),A.forEach(function(I){a.simpleExtrude(I)})}var T=a.complex;return{vertices:T.positions,indices:T.indices,normals:T.normals,size:6}}function rE(e){var i=e.coordinates,r=Ic().flatten(i),n=r.vertices,a=r.dimensions,s=r.holes;return{indices:Ic()(n,s,a),vertices:n,size:a}}function F3(e){var i=e.coordinates,r=earcut.flatten(i),n=r.vertices,a=r.dimensions,s=r.holes;return{indices:earcut(n,s,a),vertices:nE(n),size:a+4}}function nE(e){for(var i=[],r=calculatePointsCenterAndRadius(e),n=r.center,a=r.radius,s=0;s<e.length;s+=2){var f=e[s],v=e[s+1];i.push.apply(i,[f,v,0].concat(_toConsumableArray(n),[a]))}return i}function B3(e){var i=e.coordinates,r=extrude_PolygonNormal(i,!0),n=r.positions,a=r.index,s=r.normals;return{vertices:n,indices:a,normals:s,size:5}}function N3(e){var i=e.shape,r=oE(i),n=r.positions,a=r.index;return{vertices:n,indices:a,size:3}}function z3(e){var i=e.coordinates,r=[].concat(_toConsumableArray(i[0]),[0,0,1,i[1][0],i[0][1],0,1,1],_toConsumableArray(i[1]),[0,1,0],_toConsumableArray(i[0]),[0,0,1],_toConsumableArray(i[1]),[0,1,0,i[0][0],i[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:r,indices:n,size:5}}function U3(e,i){for(var r=i||30,n=e.coordinates,a=[],s=[],f=function(x){a.push(x,1,x,n[0][0],n[0][1],n[1][0],n[1][1],x,-1,x,n[0][0],n[0][1],n[1][0],n[1][1]),x!==r-1&&s.push.apply(s,_toConsumableArray([0,1,2,1,3,2].map(function(A){return x*2+A})))},v=0;v<r;v++)f(v);return{vertices:a,indices:s,size:7}}function Z3(e){var i=e.coordinates;i.length===2&&i.push(0);var r=e.size,n=Uv(-1,1),a=Uv(1,1),s=Uv(-1,-1),f=Uv(1,-1),v=[].concat(_toConsumableArray(i),_toConsumableArray(n),_toConsumableArray(i),_toConsumableArray(s),_toConsumableArray(i),_toConsumableArray(f),_toConsumableArray(i),_toConsumableArray(a)),m=[0,1,2,3,0,2];return{vertices:v,indices:m,size:5}}function iE(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(zv&&zv[e])return zv[e];var r=geometryShape[e]?geometryShape[e]():geometryShape.cylinder(),n=extrude_PolygonNormal([r],i);return zv[e]=n,n}function j3(e,i){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,a=new Float32Array(e.length/r*3),s,f,v,m=vec3.create(),x=vec3.create(),A=vec3.create(),T=0,I=i.length;T<I;T+=3){s=i[T+0]*3,f=i[T+1]*3,v=i[T+2]*3;var F=[e[s],e[s+1]],j=[e[f],e[f+1]],X=[e[v],e[v+1]];n&&(F=lngLatToMeters(F),j=lngLatToMeters(j),X=lngLatToMeters(X));var ee=F,be=_slicedToArray(ee,2),Fe=be[0],We=be[1],et=vec3.fromValues(Fe,We,e[s+2]),xt=j,Ct=_slicedToArray(xt,2),Yt=Ct[0],ar=Ct[1],Ar=vec3.fromValues(Yt,ar,e[f+2]),Qr=X,vr=_slicedToArray(Qr,2),pn=vr[0],Tn=vr[1],qn=vec3.fromValues(pn,Tn,e[v+2]);vec3.sub(m,qn,Ar),vec3.sub(x,et,Ar),vec3.cross(A,m,x),a[s]+=m[0],a[s+1]+=m[1],a[s+2]+=m[2],a[f]+=m[0],a[f+1]+=m[1],a[f+2]+=m[2],a[v]+=m[0],a[v+1]+=m[1],a[v+2]+=m[2]}return aE(a),a}function aE(e){for(var i=0,r=e.length;i<r;i+=3){var n=vec3.fromValues(e[i],e[i+1],e[i+2]),a=vec3.create();vec3.normalize(a,n),e.set(a,i)}}function V3(e){var i=e[0][0],r=e[0][e[0].length-1];return i[0]===r[0]&&i[1]===r[1]}function oE(e){var i=["cylinder","triangleColumn","hexagonColumn","squareColumn"],r=geometryShape[e]?geometryShape[e]():geometryShape.circle(),n=i.indexOf(e)===-1?fillPolygon([r]):extrudePolygon([r]);return n}function Uv(e,i){var r=(e+1)/2,n=(i+1)/2;return[r,n]}function G3(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function H3(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function sE(e){var i=uE();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function uE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lE=`uniform float u_opacity;
varying vec4 v_Color;

void main() {
  gl_FragColor = v_Color;
  gl_FragColor.a *= u_opacity;
}
`,cE=`attribute vec4 a_Color;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;

#pragma include "projection"

void main() {

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,fE=function(e){(0,Pr.Z)(r,e);var i=sE(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?0:s;return{u_opacity:Oi()(f)?f:0}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"mask",vertexShader:cE,fragmentShader:lE,triangulation:rE,blend:this.getBlend(),depth:{enable:!1},stencil:{enable:!0,mask:255,func:{cmp:k.ALWAYS,ref:1,mask:255},opFront:{fail:k.REPLACE,zfail:k.REPLACE,zpass:k.REPLACE}}})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy(),this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),r}(eE),hE={fill:fE},pE=hE;function dE(e){var i=vE();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function vE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mE=function(e){(0,Pr.Z)(r,e);var i=dE(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"type","MaskLayer"),n}return(0,Pt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new pE[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"fill"}}]),r}(K2),gE=Q(88307),yE=Q.n(gE),_E=function(){function e(i,r){(0,ht.Z)(this,e),(0,S.Z)(this,"attribute",void 0),(0,S.Z)(this,"buffer",void 0);var n=r.buffer,a=r.offset,s=r.stride,f=r.normalized,v=r.size,m=r.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:a||0,stride:s||0,normalized:f||!1,divisor:m||0},v&&(this.attribute.size=v)}return(0,Pt.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),Ah,rv,wh,Rc,nv,sp,iv,Zv,Uf,Np,Au,Zf,jf,jv,xE=(Ah={},(0,S.Z)(Ah,k.POINTS,"points"),(0,S.Z)(Ah,k.LINES,"lines"),(0,S.Z)(Ah,k.LINE_LOOP,"line loop"),(0,S.Z)(Ah,k.LINE_STRIP,"line strip"),(0,S.Z)(Ah,k.TRIANGLES,"triangles"),(0,S.Z)(Ah,k.TRIANGLE_FAN,"triangle fan"),(0,S.Z)(Ah,k.TRIANGLE_STRIP,"triangle strip"),Ah),Dg=(rv={},(0,S.Z)(rv,k.STATIC_DRAW,"static"),(0,S.Z)(rv,k.DYNAMIC_DRAW,"dynamic"),(0,S.Z)(rv,k.STREAM_DRAW,"stream"),rv),B0=(wh={},(0,S.Z)(wh,k.BYTE,"int8"),(0,S.Z)(wh,k.UNSIGNED_INT,"int16"),(0,S.Z)(wh,k.INT,"int32"),(0,S.Z)(wh,k.UNSIGNED_BYTE,"uint8"),(0,S.Z)(wh,k.UNSIGNED_SHORT,"uint16"),(0,S.Z)(wh,k.UNSIGNED_INT,"uint32"),(0,S.Z)(wh,k.FLOAT,"float"),wh),bE=(Rc={},(0,S.Z)(Rc,k.ALPHA,"alpha"),(0,S.Z)(Rc,k.LUMINANCE,"luminance"),(0,S.Z)(Rc,k.LUMINANCE_ALPHA,"luminance alpha"),(0,S.Z)(Rc,k.RGB,"rgb"),(0,S.Z)(Rc,k.RGBA,"rgba"),(0,S.Z)(Rc,k.RGBA4,"rgba4"),(0,S.Z)(Rc,k.RGB5_A1,"rgb5 a1"),(0,S.Z)(Rc,k.RGB565,"rgb565"),(0,S.Z)(Rc,k.DEPTH_COMPONENT,"depth"),(0,S.Z)(Rc,k.DEPTH_STENCIL,"depth stencil"),Rc),EE=(nv={},(0,S.Z)(nv,k.DONT_CARE,"dont care"),(0,S.Z)(nv,k.NICEST,"nice"),(0,S.Z)(nv,k.FASTEST,"fast"),nv),Fg=(sp={},(0,S.Z)(sp,k.NEAREST,"nearest"),(0,S.Z)(sp,k.LINEAR,"linear"),(0,S.Z)(sp,k.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,S.Z)(sp,k.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,S.Z)(sp,k.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,S.Z)(sp,k.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),sp),Bg=(iv={},(0,S.Z)(iv,k.REPEAT,"repeat"),(0,S.Z)(iv,k.CLAMP_TO_EDGE,"clamp"),(0,S.Z)(iv,k.MIRRORED_REPEAT,"mirror"),iv),SE=(Zv={},(0,S.Z)(Zv,k.NONE,"none"),(0,S.Z)(Zv,k.BROWSER_DEFAULT_WEBGL,"browser"),Zv),CE=(Uf={},(0,S.Z)(Uf,k.NEVER,"never"),(0,S.Z)(Uf,k.ALWAYS,"always"),(0,S.Z)(Uf,k.LESS,"less"),(0,S.Z)(Uf,k.LEQUAL,"lequal"),(0,S.Z)(Uf,k.GREATER,"greater"),(0,S.Z)(Uf,k.GEQUAL,"gequal"),(0,S.Z)(Uf,k.EQUAL,"equal"),(0,S.Z)(Uf,k.NOTEQUAL,"notequal"),Uf),Ng=(Np={},(0,S.Z)(Np,k.FUNC_ADD,"add"),(0,S.Z)(Np,k.MIN_EXT,"min"),(0,S.Z)(Np,k.MAX_EXT,"max"),(0,S.Z)(Np,k.FUNC_SUBTRACT,"subtract"),(0,S.Z)(Np,k.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Np),Vv=(Au={},(0,S.Z)(Au,k.ZERO,"zero"),(0,S.Z)(Au,k.ONE,"one"),(0,S.Z)(Au,k.SRC_COLOR,"src color"),(0,S.Z)(Au,k.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,S.Z)(Au,k.SRC_ALPHA,"src alpha"),(0,S.Z)(Au,k.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,S.Z)(Au,k.DST_COLOR,"dst color"),(0,S.Z)(Au,k.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,S.Z)(Au,k.DST_ALPHA,"dst alpha"),(0,S.Z)(Au,k.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,S.Z)(Au,k.CONSTANT_COLOR,"constant color"),(0,S.Z)(Au,k.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,S.Z)(Au,k.CONSTANT_ALPHA,"constant alpha"),(0,S.Z)(Au,k.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,S.Z)(Au,k.SRC_ALPHA_SATURATE,"src alpha saturate"),Au),AE=(Zf={},(0,S.Z)(Zf,k.NEVER,"never"),(0,S.Z)(Zf,k.ALWAYS,"always"),(0,S.Z)(Zf,k.LESS,"less"),(0,S.Z)(Zf,k.LEQUAL,"lequal"),(0,S.Z)(Zf,k.GREATER,"greater"),(0,S.Z)(Zf,k.GEQUAL,"gequal"),(0,S.Z)(Zf,k.EQUAL,"equal"),(0,S.Z)(Zf,k.NOTEQUAL,"notequal"),Zf),gd=(jf={},(0,S.Z)(jf,k.ZERO,"zero"),(0,S.Z)(jf,k.KEEP,"keep"),(0,S.Z)(jf,k.REPLACE,"replace"),(0,S.Z)(jf,k.INVERT,"invert"),(0,S.Z)(jf,k.INCR,"increment"),(0,S.Z)(jf,k.DECR,"decrement"),(0,S.Z)(jf,k.INCR_WRAP,"increment wrap"),(0,S.Z)(jf,k.DECR_WRAP,"decrement wrap"),jf),wE=(jv={},(0,S.Z)(jv,k.FRONT,"front"),(0,S.Z)(jv,k.BACK,"back"),jv),TE=function(){function e(i,r){(0,ht.Z)(this,e),(0,S.Z)(this,"buffer",void 0);var n=r.data,a=r.usage,s=r.type;this.buffer=i.buffer({data:n,usage:Dg[a||k.STATIC_DRAW],type:B0[s||k.UNSIGNED_BYTE]})}return(0,Pt.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(r){var n=r.data,a=r.offset;this.buffer.subdata(n,a)}}]),e}(),ME=function(){function e(i,r){(0,ht.Z)(this,e),(0,S.Z)(this,"elements",void 0);var n=r.data,a=r.usage,s=r.type,f=r.count;this.elements=i.elements({data:n,usage:Dg[a||k.STATIC_DRAW],type:B0[s||k.UNSIGNED_BYTE],count:f})}return(0,Pt.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(r){var n=r.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),e}(),PE=function(){function e(i,r){(0,ht.Z)(this,e),(0,S.Z)(this,"framebuffer",void 0);var n=r.width,a=r.height,s=r.color,f=r.colors,v=r.depth,m=r.stencil,x={width:n,height:a};Array.isArray(f)&&(x.colors=f.map(function(A){return A.get()})),s&&typeof s!="boolean"&&(x.color=s.get()),this.framebuffer=i.framebuffer(x)}return(0,Pt.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(r){var n=r.width,a=r.height;this.framebuffer.resize(n,a)}}]),e}(),OE=Q(36719),IE=Q.n(OE),RE=Q(68630),kE=Q.n(RE);function zg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function kc(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?zg(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):zg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var LE=function(){function e(i,r){(0,ht.Z)(this,e),(0,S.Z)(this,"reGl",void 0),(0,S.Z)(this,"destroyed",!1),(0,S.Z)(this,"drawCommand",void 0),(0,S.Z)(this,"drawPickCommand",void 0),(0,S.Z)(this,"drawParams",void 0),(0,S.Z)(this,"options",void 0),(0,S.Z)(this,"uniforms",{}),this.reGl=i;var n=r.vs,a=r.fs,s=r.attributes,f=r.uniforms,v=r.primitive,m=r.count,x=r.elements,A=r.depth,T=r.blend,I=r.stencil,F=r.cull,j=r.instances,X={};this.options=r,f&&(this.uniforms=this.extractUniforms(f),Object.keys(f).forEach(function(We){X[We]=i.prop(We)}));var ee={};Object.keys(s).forEach(function(We){ee[We]=s[We].get()});var be={attributes:ee,frag:a,uniforms:X,vert:n,blend:{},primitive:xE[v===void 0?k.TRIANGLES:v]};j&&(be.instances=j),m&&(be.count=m),x&&(be.elements=x.get()),this.initDepthDrawParams({depth:A},be),this.initBlendDrawParams({blend:T},be),this.initStencilDrawParams({stencil:I},be),this.initCullDrawParams({cull:F},be),this.drawCommand=i(be);var Fe=H()(be);Fe.blend=kc(kc({},Fe.blend),{},{enable:!1}),this.drawPickCommand=i(Fe),this.drawParams=be}return(0,Pt.Z)(e,[{key:"updateAttributesAndElements",value:function(r,n){var a={};Object.keys(r).forEach(function(f){a[f]=r[f].get()}),this.drawParams.attributes=a,this.drawParams.elements=n.get(),this.drawCommand=this.reGl(this.drawParams);var s=H()(this.drawParams);s.blend=kc(kc({},s.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(s)}},{key:"updateAttributes",value:function(r){var n={};Object.keys(r).forEach(function(s){n[s]=r[s].get()}),this.drawParams.attributes=n,this.drawCommand=this.reGl(this.drawParams);var a=H()(this.drawParams);a.blend=kc(kc({},a.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(a)}},{key:"addUniforms",value:function(r){this.uniforms=kc(kc({},this.uniforms),this.extractUniforms(r))}},{key:"draw",value:function(r,n){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var a=kc(kc({},this.uniforms),this.extractUniforms(r.uniforms||{})),s={};Object.keys(a).forEach(function(f){var v=(0,He.Z)(a[f]);v==="boolean"||v==="number"||Array.isArray(a[f])||a[f].BYTES_PER_ELEMENT?s[f]=a[f]:s[f]=a[f].get()}),n?this.drawPickCommand(s):this.drawCommand(s)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(r){r.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(r,n){var a=r.depth;a&&(n.depth={enable:a.enable===void 0?!0:!!a.enable,mask:a.mask===void 0?!0:!!a.mask,func:CE[a.func||k.LESS],range:a.range||[0,1]})}},{key:"initBlendDrawParams",value:function(r,n){var a=r.blend;if(a){var s=a.enable,f=a.func,v=a.equation,m=a.color,x=m===void 0?[0,0,0,0]:m;n.blend={enable:!!s,func:{srcRGB:Vv[f&&f.srcRGB||k.SRC_ALPHA],srcAlpha:Vv[f&&f.srcAlpha||k.SRC_ALPHA],dstRGB:Vv[f&&f.dstRGB||k.ONE_MINUS_SRC_ALPHA],dstAlpha:Vv[f&&f.dstAlpha||k.ONE_MINUS_SRC_ALPHA]},equation:{rgb:Ng[v&&v.rgb||k.FUNC_ADD],alpha:Ng[v&&v.alpha||k.FUNC_ADD]},color:x}}}},{key:"initStencilDrawParams",value:function(r,n){var a=r.stencil;if(a){var s=a.enable,f=a.mask,v=f===void 0?-1:f,m=a.func,x=m===void 0?{cmp:k.ALWAYS,ref:0,mask:-1}:m,A=a.opFront,T=A===void 0?{fail:k.KEEP,zfail:k.KEEP,zpass:k.KEEP}:A,I=a.opBack,F=I===void 0?{fail:k.KEEP,zfail:k.KEEP,zpass:k.KEEP}:I;n.stencil={enable:!!s,mask:v,func:kc(kc({},x),{},{cmp:AE[x.cmp]}),opFront:{fail:gd[T.fail],zfail:gd[T.zfail],zpass:gd[T.zpass]},opBack:{fail:gd[F.fail],zfail:gd[F.zfail],zpass:gd[F.zpass]}}}}},{key:"initCullDrawParams",value:function(r,n){var a=r.cull;if(a){var s=a.enable,f=a.face,v=f===void 0?k.BACK:f;n.cull={enable:!!s,face:wE[v]}}}},{key:"extractUniforms",value:function(r){var n=this,a={};return Object.keys(r).forEach(function(s){n.extractUniformsRecursively(s,r[s],a,"")}),a}},{key:"extractUniformsRecursively",value:function(r,n,a,s){var f=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||IE()(n)||n===""||"resize"in n){a["".concat(s&&s+".").concat(r)]=n;return}kE()(n)&&Object.keys(n).forEach(function(v){f.extractUniformsRecursively(v,n[v],a,"".concat(s&&s+".").concat(r))}),Array.isArray(n)&&n.forEach(function(v,m){Object.keys(v).forEach(function(x){f.extractUniformsRecursively(x,v[x],a,"".concat(s&&s+".").concat(r,"[").concat(m,"]"))})})}}]),e}(),DE=function(){function e(i,r){(0,ht.Z)(this,e),(0,S.Z)(this,"texture",void 0),(0,S.Z)(this,"width",void 0),(0,S.Z)(this,"height",void 0),(0,S.Z)(this,"isDistroy",!1);var n=r.data,a=r.type,s=a===void 0?k.UNSIGNED_BYTE:a,f=r.width,v=r.height,m=r.flipY,x=m===void 0?!1:m,A=r.format,T=A===void 0?k.RGBA:A,I=r.mipmap,F=I===void 0?!1:I,j=r.wrapS,X=j===void 0?k.CLAMP_TO_EDGE:j,ee=r.wrapT,be=ee===void 0?k.CLAMP_TO_EDGE:ee,Fe=r.aniso,We=Fe===void 0?0:Fe,et=r.alignment,xt=et===void 0?1:et,Ct=r.premultiplyAlpha,Yt=Ct===void 0?!1:Ct,ar=r.mag,Ar=ar===void 0?k.NEAREST:ar,Qr=r.min,vr=Qr===void 0?k.NEAREST:Qr,pn=r.colorSpace,Tn=pn===void 0?k.BROWSER_DEFAULT_WEBGL:pn,qn=r.x,Ba=qn===void 0?0:qn,qo=r.y,Ls=qo===void 0?0:qo,Ds=r.copy,Ys=Ds===void 0?!1:Ds;this.width=f,this.height=v;var vf={width:f,height:v,type:B0[s],format:bE[T],wrapS:Bg[X],wrapT:Bg[be],mag:Fg[Ar],min:Fg[vr],alignment:xt,flipY:x,colorSpace:SE[Tn],premultiplyAlpha:Yt,aniso:We,x:Ba,y:Ls,copy:Ys};n&&(vf.data=n),typeof F=="number"?vf.mipmap=EE[F]:typeof F=="boolean"&&(vf.mipmap=F),this.texture=i.texture(vf)}return(0,Pt.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(r)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(r){var n=r.width,a=r.height;this.texture.resize(n,a),this.width=n,this.height=a}},{key:"destroy",value:function(){if(!this.isDistroy){var r;(r=this.texture)===null||r===void 0||r.destroy()}this.isDistroy=!0}}]),e}(),Ug,Zg,FE=(Ug=(0,Xr.b2)(),Ug(Zg=function(){function e(){var i=this;(0,ht.Z)(this,e),(0,S.Z)(this,"extensionObject",void 0),(0,S.Z)(this,"gl",void 0),(0,S.Z)(this,"$container",void 0),(0,S.Z)(this,"canvas",void 0),(0,S.Z)(this,"width",void 0),(0,S.Z)(this,"height",void 0),(0,S.Z)(this,"isDirty",void 0),(0,S.Z)(this,"createModel",function(r){return new LE(i.gl,r)}),(0,S.Z)(this,"createAttribute",function(r){return new _E(i.gl,r)}),(0,S.Z)(this,"createBuffer",function(r){return new TE(i.gl,r)}),(0,S.Z)(this,"createElements",function(r){return new ME(i.gl,r)}),(0,S.Z)(this,"createTexture2D",function(r){return new DE(i.gl,r)}),(0,S.Z)(this,"createFramebuffer",function(r){return new PE(i.gl,r)}),(0,S.Z)(this,"useFramebuffer",function(r,n){i.gl({framebuffer:r?r.get():null})(n)}),(0,S.Z)(this,"clear",function(r){var n=r.color,a=r.depth,s=r.stencil,f=r.framebuffer,v=f===void 0?null:f,m={color:n,depth:a,stencil:s};m.framebuffer=v===null?v:v.get(),i.gl.clear(m)}),(0,S.Z)(this,"viewport",function(r){var n=r.x,a=r.y,s=r.width,f=r.height;i.gl._gl.viewport(n,a,s,f),i.width=s,i.height=f,i.gl._refresh()}),(0,S.Z)(this,"readPixels",function(r){var n=r.framebuffer,a=r.x,s=r.y,f=r.width,v=r.height,m={x:a,y:s,width:f,height:v};return n&&(m.framebuffer=n.get()),i.gl.read(m)}),(0,S.Z)(this,"getViewportSize",function(){return{width:i.gl._gl.drawingBufferWidth,height:i.gl._gl.drawingBufferHeight}}),(0,S.Z)(this,"getContainer",function(){if(Qi)return i.canvas;var r;return(r=i.canvas)===null||r===void 0?void 0:r.parentElement}),(0,S.Z)(this,"getCanvas",function(){return i.canvas}),(0,S.Z)(this,"getGLContext",function(){return i.gl._gl}),(0,S.Z)(this,"destroy",function(){i.canvas=null,i.gl.destroy(),i.gl=null})}return(0,Pt.Z)(e,[{key:"init",value:function(){var i=(0,Z.Z)(q().mark(function n(a,s){var f=this;return q().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return this.canvas=a,m.next=3,new Promise(function(x,A){yE()({canvas:f.canvas,attributes:{alpha:!0,antialias:s.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:s.preserveDrawingBuffer,stencil:s.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(I,F){(I||!F)&&A(I),x(F)}})});case 3:this.gl=m.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return m.stop()}},n,this)}));function r(n,a){return i.apply(this,arguments)}return r}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(r){return!!this.getGLContext().getExtension(r)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var r=this.getGLContext();r.disable(r.CULL_FACE)}},{key:"setDirty",value:function(r){this.isDirty=r}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||Zg);function jg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Vg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?jg(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):jg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var BE=function(){function e(i){(0,ht.Z)(this,e),(0,S.Z)(this,"sceneService",void 0),(0,S.Z)(this,"mapService",void 0),(0,S.Z)(this,"controlService",void 0),(0,S.Z)(this,"layerService",void 0),(0,S.Z)(this,"iconService",void 0),(0,S.Z)(this,"markerService",void 0),(0,S.Z)(this,"popupService",void 0),(0,S.Z)(this,"fontService",void 0),(0,S.Z)(this,"interactionService",void 0),(0,S.Z)(this,"container",void 0);var r=i.id,n=i.map,a=i.canvas,s=i.hasBaseMap,f=$b();this.container=f,n.setContainer(f,r,a,s),f.bind(yt.IRendererService).to(FE).inSingletonScope(),this.sceneService=f.get(yt.ISceneService),this.mapService=f.get(yt.IMapService),this.iconService=f.get(yt.IIconService),this.fontService=f.get(yt.IFontService),this.controlService=f.get(yt.IControlService),this.layerService=f.get(yt.ILayerService),this.markerService=f.get(yt.IMarkerService),this.interactionService=f.get(yt.IInteractionService),this.popupService=f.get(yt.IPopupService),Qi?this.sceneService.initMiniScene(i):(this.initComponent(r),this.sceneService.init(i),this.initControl())}return(0,Pt.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(r){return this.sceneService.exportPng(r)}},{key:"exportMap",value:function(r){return this.sceneService.exportPng(r)}},{key:"registerRenderService",value:function(r){var n=this;if(this.sceneService.loaded){var a=new r(this);a.init()}else this.on("loaded",function(){var s=new r(n);s.init()})}},{key:"setBgColor",value:function(r){this.mapService.setBgColor(r)}},{key:"addLayer",value:function(r){var n=fg(this.container);r.setContainer(n,this.container),this.sceneService.addLayer(r);var a=r.getLayerConfig();if(a){var s=a.mask,f=a.maskfence,v=a.maskColor,m=v===void 0?"#000":v,x=a.maskOpacity,A=x===void 0?0:x;if(s&&f){var T=new mE().source(f).shape("fill").color(m).style({opacity:A});this.addMask(T,r.id)}}else console.warn("addLayer should run after scene loaded!")}},{key:"addMask",value:function(r,n){var a=this.getLayer(n);if(a){var s=fg(this.container);r.setContainer(s,this.container),a.addMaskLayer(r),this.sceneService.addLayer(r)}else console.warn("parent layer not find!")}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(r){return this.layerService.getLayer(r)}},{key:"getLayerByName",value:function(r){return this.layerService.getLayerByName(r)}},{key:"removeLayer",value:function(r,n){this.layerService.remove(r,n)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(r){this.layerService.setEnableRender(r)}},{key:"addIconFont",value:function(r,n){this.fontService.addIconFont(r,n)}},{key:"addIconFonts",value:function(r){var n=this;r.forEach(function(a){var s=(0,dn.Z)(a,2),f=s[0],v=s[1];n.fontService.addIconFont(f,v)})}},{key:"addFontFace",value:function(r,n){this.sceneService.addFontFace(r,n)}},{key:"addImage",value:function(r,n){Qi?this.iconService.addImageMini(r,n,this.sceneService):this.iconService.addImage(r,n)}},{key:"hasImage",value:function(r){return this.iconService.hasImage(r)}},{key:"removeImage",value:function(r){this.iconService.removeImage(r)}},{key:"addIconFontGlyphs",value:function(r,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(r){this.controlService.addControl(r,this.container)}},{key:"removeControl",value:function(r){this.controlService.removeControl(r)}},{key:"getControlByName",value:function(r){return this.controlService.getControlByName(r)}},{key:"addMarker",value:function(r){this.markerService.addMarker(r)}},{key:"addMarkerLayer",value:function(r){this.markerService.addMarkerLayer(r)}},{key:"removeMarkerLayer",value:function(r){this.markerService.removeMarkerLayer(r)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(r){this.popupService.addPopup(r)}},{key:"on",value:function(r,n){L0.indexOf(r)===-1?this.mapService.on(r,n):this.sceneService.on(r,n)}},{key:"once",value:function(r,n){L0.indexOf(r)===-1?this.mapService.once(r,n):this.sceneService.once(r,n)}},{key:"off",value:function(r,n){L0.indexOf(r)===-1?this.mapService.off(r,n):this.sceneService.off(r,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(r){return this.mapService.getCenter(r)}},{key:"setCenter",value:function(r,n){return this.mapService.setCenter(r,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(r){return this.mapService.setPitch(r)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(r){this.mapService.setRotation(r)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(r){this.mapService.panTo(r)}},{key:"panBy",value:function(r,n){this.mapService.panBy(r,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(r){this.mapService.setZoom(r)}},{key:"fitBounds",value:function(r,n){var a=this.sceneService.getSceneConfig(),s=a.fitBoundsOptions,f=a.animate;this.mapService.fitBounds(r,n||Vg(Vg({},s),{},{animate:f}))}},{key:"setZoomAndCenter",value:function(r,n){this.mapService.setZoomAndCenter(r,n)}},{key:"setMapStyle",value:function(r){this.mapService.setMapStyle(r)}},{key:"setMapStatus",value:function(r){this.mapService.setMapStatus(r)}},{key:"pixelToLngLat",value:function(r){return this.mapService.pixelToLngLat(r)}},{key:"lngLatToPixel",value:function(r){return this.mapService.lngLatToPixel(r)}},{key:"containerToLngLat",value:function(r){return this.mapService.containerToLngLat(r)}},{key:"lngLatToContainer",value:function(r){return this.mapService.lngLatToContainer(r)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(r,n){this.container.bind(yt.IPostProcessingPass).to(r).whenTargetNamed(n)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(r){this.controlService.init({container:Pa(r)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var r=this.sceneService.getSceneConfig(),n=r.logoVisible,a=r.logoPosition;n&&this.addControl(new g2({position:a}))}}]),e}(),up,Gg=(up={},(0,S.Z)(up,Ws.additive,{enable:!0,func:{srcRGB:k.ONE,dstRGB:k.ONE,srcAlpha:1,dstAlpha:1}}),(0,S.Z)(up,Ws.none,{enable:!1}),(0,S.Z)(up,Ws.normal,{enable:!0,func:{srcRGB:k.SRC_ALPHA,dstRGB:k.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,S.Z)(up,Ws.subtractive,{enable:!0,func:{srcRGB:k.ONE,dstRGB:k.ONE,srcAlpha:k.ZERO,dstAlpha:k.ONE_MINUS_SRC_COLOR},equation:{rgb:k.FUNC_SUBTRACT,alpha:k.FUNC_SUBTRACT}}),(0,S.Z)(up,Ws.max,{enable:!0,func:{srcRGB:k.ONE,dstRGB:k.ONE},equation:{rgb:k.MAX_EXT}}),(0,S.Z)(up,Ws.min,{enable:!0,func:{srcRGB:k.ONE,dstRGB:k.ONE},equation:{rgb:k.MIN_EXT}}),up),W3=1024;function ol(e,i,r,n,a){i.updateStyleAttribute(e,r,n,a)}function NE(e,i){e.opacity&&Gv("opacity",i,e.opacity),e.strokeWidth&&Gv("strokeWidth",i,e.strokeWidth),e.strokeOpacity&&Gv("strokeOpacity",i,e.strokeOpacity),e.stroke&&zE("stroke",i,e.stroke),e.offsets&&Hg("offsets",i,e.offsets),e.textOffset&&Hg("textOffset",i,e.textOffset),e.thetaOffset&&Gv("thetaOffset",i,e.thetaOffset)}function Gv(e,i,r){w()(r)?ol(e,i,r,function(n){return n}):Oi()(r)?ol(e,i,[r],void 0):Array.isArray(r)&&r.length===2?w()(r[0])&&L()(r[1])||w()(r[0])&&Array.isArray(r[1])&&Oi()(r[1][0])&&Oi()(r[1][1])?ol(e,i,r[0],r[1]):ol(e,i,[1],void 0):ol(e,i,[1],void 0)}function Hg(e,i,r){w()(r)?ol(e,i,r,function(n){return n}):Array.isArray(r)&&r.length===2&&w()(r[0])&&L()(r[1])?ol(e,i,r[0],r[1]):Array.isArray(r)&&r.length===2&&Oi()(r[0])&&Oi()(r[1])?ol(e,i,r,void 0):ol(e,i,[0,0],void 0)}function zE(e,i,r){w()(r)?ol(e,i,r,void 0):Array.isArray(r)&&r.length===2&&(w()(r[0])&&L()(r[1])||w()(r[0])&&Array.isArray(r[1])&&r[1].length>0)?ol(e,i,r[0],r[1]):ol(e,i,"#fff",void 0)}function Wg(e){return e.map(function(i){return typeof i=="string"&&(i=[i,{}]),i})}function Xg(e,i,r,n){var a=e.multiPassRenderer,s=e.getLayerConfig(),f=s.enablePicking,v=s.enableTAA;return v?a.add(n("taa")):a.add(n("render")),Wg(i).forEach(function(m){var x=(0,dn.Z)(m,2),A=x[0],T=x[1];a.add(r(A),T)}),a.add(r("copy")),a}var UE=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]];function ZE(e,i,r){if(typeof i=="string"&&typeof r=="string"&&i!==r){if(e.type==="PointLayer"){e.dataState.dataSourceNeedUpdate=!0;return}UE.map(function(n){if(n.includes(i)&&n.includes(r)){e.dataState.dataSourceNeedUpdate=!0;return}})}}var jE=["passes"],VE=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber"],Yg,N0,qg;function GE(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=HE(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function HE(e,i){if(!!e){if(typeof e=="string")return Kg(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Kg(e,i)}}function Kg(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function $g(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Xu(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?$g(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$g(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function WE(e){var i=XE();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function XE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Qg=0,zp=(Yg=tv(yt.IGlobalConfigService),N0=function(e){(0,Pr.Z)(r,e);var i=WE(r);function r(){var n,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,ht.Z)(this,r),n=i.call(this),(0,S.Z)((0,J.Z)(n),"id","".concat(Qg++)),(0,S.Z)((0,J.Z)(n),"name","".concat(Qg)),(0,S.Z)((0,J.Z)(n),"type",void 0),(0,S.Z)((0,J.Z)(n),"visible",!0),(0,S.Z)((0,J.Z)(n),"zIndex",0),(0,S.Z)((0,J.Z)(n),"minZoom",void 0),(0,S.Z)((0,J.Z)(n),"maxZoom",void 0),(0,S.Z)((0,J.Z)(n),"inited",!1),(0,S.Z)((0,J.Z)(n),"layerModelNeedUpdate",!1),(0,S.Z)((0,J.Z)(n),"pickedFeatureID",null),(0,S.Z)((0,J.Z)(n),"selectedFeatureID",null),(0,S.Z)((0,J.Z)(n),"styleNeedUpdate",!1),(0,S.Z)((0,J.Z)(n),"rendering",void 0),(0,S.Z)((0,J.Z)(n),"clusterZoom",0),(0,S.Z)((0,J.Z)(n),"layerType",void 0),(0,S.Z)((0,J.Z)(n),"isLayerGroup",!1),(0,S.Z)((0,J.Z)(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,S.Z)((0,J.Z)(n),"hooks",{init:new Jo,afterInit:new Jo,beforeRender:new Jo,beforeRenderData:new nu,afterRender:new ra,beforePickingEncode:new ra,afterPickingEncode:new ra,beforeHighlight:new ra(["pickedColor"]),afterHighlight:new ra,beforeSelect:new ra(["pickedColor"]),afterSelect:new ra,beforeDestroy:new ra,afterDestroy:new ra}),(0,S.Z)((0,J.Z)(n),"models",[]),(0,S.Z)((0,J.Z)(n),"multiPassRenderer",void 0),(0,S.Z)((0,J.Z)(n),"plugins",void 0),(0,S.Z)((0,J.Z)(n),"sourceOption",void 0),(0,S.Z)((0,J.Z)(n),"layerModel",void 0),(0,S.Z)((0,J.Z)(n),"shapeOption",void 0),(0,S.Z)((0,J.Z)(n),"sceneContainer",void 0),(0,S.Z)((0,J.Z)(n),"layerChildren",[]),(0,S.Z)((0,J.Z)(n),"masks",[]),Ln((0,J.Z)(n),"configService",qg,(0,J.Z)(n)),(0,S.Z)((0,J.Z)(n),"shaderModuleService",void 0),(0,S.Z)((0,J.Z)(n),"cameraService",void 0),(0,S.Z)((0,J.Z)(n),"coordinateService",void 0),(0,S.Z)((0,J.Z)(n),"iconService",void 0),(0,S.Z)((0,J.Z)(n),"fontService",void 0),(0,S.Z)((0,J.Z)(n),"pickingService",void 0),(0,S.Z)((0,J.Z)(n),"rendererService",void 0),(0,S.Z)((0,J.Z)(n),"layerService",void 0),(0,S.Z)((0,J.Z)(n),"interactionService",void 0),(0,S.Z)((0,J.Z)(n),"mapService",void 0),(0,S.Z)((0,J.Z)(n),"styleAttributeService",void 0),(0,S.Z)((0,J.Z)(n),"layerSource",void 0),(0,S.Z)((0,J.Z)(n),"postProcessingPassFactory",void 0),(0,S.Z)((0,J.Z)(n),"normalPassFactory",void 0),(0,S.Z)((0,J.Z)(n),"animateOptions",{enable:!1}),(0,S.Z)((0,J.Z)(n),"container",void 0),(0,S.Z)((0,J.Z)(n),"encodedData",void 0),(0,S.Z)((0,J.Z)(n),"configSchema",void 0),(0,S.Z)((0,J.Z)(n),"currentPickId",null),(0,S.Z)((0,J.Z)(n),"rawConfig",void 0),(0,S.Z)((0,J.Z)(n),"needUpdateConfig",void 0),(0,S.Z)((0,J.Z)(n),"pendingStyleAttributes",[]),(0,S.Z)((0,J.Z)(n),"scaleOptions",{}),(0,S.Z)((0,J.Z)(n),"animateStartTime",void 0),(0,S.Z)((0,J.Z)(n),"aniamateStatus",!1),(0,S.Z)((0,J.Z)(n),"bottomColor","rgba(0, 0, 0, 0)"),(0,S.Z)((0,J.Z)(n),"isDestroied",!1),(0,S.Z)((0,J.Z)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var s=n.getLayerConfig(),f=s.autoFit,v=s.fitBoundsOptions;f&&n.fitBounds(v),n.reRender()}),n.name=a.name||n.id,n.zIndex=a.zIndex||0,n.rawConfig=a,n}return(0,Pt.Z)(r,[{key:"addMaskLayer",value:function(a){this.masks.push(a)}},{key:"removeMaskLayer",value:function(a){var s=this.masks.indexOf(a);s>-1&&this.masks.splice(s,1),a.destroy()}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(a){if(!this.inited)this.needUpdateConfig=Xu(Xu({},this.needUpdateConfig),a);else{var s=this.container.get(yt.SceneID);NE(a,this),this.configService.setLayerConfig(s,this.id,Xu(Xu(Xu({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),a)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(a,s){this.container=a,this.sceneContainer=s}},{key:"getContainer",value:function(){return this.container}},{key:"setBottomColor",value:function(a){this.bottomColor=a}},{key:"getBottomColor",value:function(){return this.bottomColor}},{key:"addPlugin",value:function(a){return this.plugins.push(a),this}},{key:"init",value:function(){var a=this,s=this.container.get(yt.SceneID);this.configService.setLayerConfig(s,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(yt.IIconService),this.fontService=this.container.get(yt.IFontService),this.rendererService=this.container.get(yt.IRendererService),this.layerService=this.container.get(yt.ILayerService),this.interactionService=this.container.get(yt.IInteractionService),this.pickingService=this.container.get(yt.IPickingService),this.mapService=this.container.get(yt.IMapService);var f=this.getLayerConfig(),v=f.enableMultiPassRenderer,m=f.passes;v&&m!==null&&m!==void 0&&m.length&&m.length>0&&this.mapService.on("mapAfterFrameChange",function(){a.renderLayers()}),this.cameraService=this.container.get(yt.ICameraService),this.coordinateService=this.container.get(yt.ICoordinateSystemService),this.shaderModuleService=this.container.get(yt.IShaderModuleService),this.postProcessingPassFactory=this.container.get(yt.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(yt.IFactoryNormalPass),this.styleAttributeService=this.container.get(yt.IStyleAttributeService),this.multiPassRenderer=this.container.get(yt.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(I){var F=I.attributeName,j=I.attributeField,X=I.attributeValues,ee=I.updateOptions;a.styleAttributeService.updateStyleAttribute(F,{scale:Xu({field:j},a.splitValuesAndCallbackInAttribute(X,a.getLayerConfig()[F]))},ee)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(yt.ILayerPlugin);var x=GE(this.plugins),A;try{for(x.s();!(A=x.n()).done;){var T=A.value;T.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(I){x.e(I)}finally{x.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(Xu(Xu({},this.getDefaultConfig()),this.rawConfig));var a=this.getLayerConfig(),s=a.animateOption;s!=null&&s.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(a,s,f){return this.updateStyleAttribute("color",a,s,f),this}},{key:"texture",value:function(a,s,f){return this.updateStyleAttribute("texture",a,s,f),this}},{key:"rotate",value:function(a,s,f){return this.updateStyleAttribute("rotate",a,s,f),this}},{key:"size",value:function(a,s,f){return this.updateStyleAttribute("size",a,s,f),this}},{key:"filter",value:function(a,s,f){return this.updateStyleAttribute("filter",a,s,f),this}},{key:"shape",value:function(a,s,f){var v,m,x,A=(v=this.styleAttributeService)===null||v===void 0||(m=v.getLayerStyleAttribute("shape"))===null||m===void 0||(x=m.scale)===null||x===void 0?void 0:x.field,T=a;return this.shapeOption={field:a,values:s},this.updateStyleAttribute("shape",a,s,f),ZE(this,A,T),this}},{key:"label",value:function(a,s,f){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:a,attributeValues:s,updateOptions:f}),this}},{key:"animate",value:function(a){var s={};return ro()(a)?(s.enable=!0,s=Xu(Xu({},s),a)):s.enable=a,this.updateLayerConfig({animateOption:s}),this}},{key:"source",value:function(a,s){return a!=null&&a.data?(this.setSource(a),this):(this.sourceOption={data:a,options:s},this.clusterZoom=0,this)}},{key:"setData",value:function(a,s){var f=this;return this.inited?this.layerSource.setData(a,s):this.on("inited",function(){var v=f.getSource();v?f.layerSource.setData(a,s):(f.source(new Fh(a,s)),f.sourceEvent())}),this}},{key:"style",value:function(a){var s=this,f=this.getLayerConfig(),v=a.passes,m=(0,Ga.Z)(a,jE);return v&&Wg(v).forEach(function(x){var A=s.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(x[0]);A&&A.updateOptions(x[1])}),this.rawConfig=Xu(Xu({},this.rawConfig),m),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),f&&f.mask===!0&&a.mask===!1&&(this.clearModels(),this.models=this.layerModel.buildModels()),this}},{key:"scale",value:function(a,s){return ro()(a)?this.scaleOptions=Xu(Xu({},this.scaleOptions),a):this.scaleOptions[a]=s,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.getEncodedData().length!==0&&this.renderModels(),this}},{key:"renderMultiPass",value:function(){var n=(0,Z.Z)(q().mark(function s(){return q().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(this.getEncodedData().length===0){v.next=7;break}if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){v.next=6;break}return v.next=4,this.multiPassRenderer.render();case 4:v.next=7;break;case 6:this.multiPassRenderer?this.renderModels():this.renderModels();case 7:case"end":return v.stop()}},s,this)}));function a(){return n.apply(this,arguments)}return a}()},{key:"active",value:function(a){var s={};return s.enableHighlight=ro()(a)?!0:a,ro()(a)?(s.enableHighlight=!0,a.color&&(s.highlightColor=a.color),a.mix&&(s.activeMix=a.mix)):s.enableHighlight=!!a,this.updateLayerConfig(s),this}},{key:"setActive",value:function(a,s){var f=this;if(ro()(a)){var v=a.x,m=v===void 0?0:v,x=a.y,A=x===void 0?0:x;this.updateLayerConfig({highlightColor:ro()(s)?s.color:this.getLayerConfig().highlightColor,activeMix:ro()(s)?s.mix:this.getLayerConfig().activeMix}),this.pick({x:m,y:A})}else this.updateLayerConfig({pickedFeatureID:a,highlightColor:ro()(s)?s.color:this.getLayerConfig().highlightColor,activeMix:ro()(s)?s.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call(os(a)).then(function(){setTimeout(function(){f.reRender()},1)})}},{key:"select",value:function(a){var s={};return s.enableSelect=ro()(a)?!0:a,ro()(a)?(s.enableSelect=!0,a.color&&(s.selectColor=a.color),a.mix&&(s.selectMix=a.mix)):s.enableSelect=!!a,this.updateLayerConfig(s),this}},{key:"setSelect",value:function(a,s){var f=this;if(ro()(a)){var v=a.x,m=v===void 0?0:v,x=a.y,A=x===void 0?0:x;this.updateLayerConfig({selectColor:ro()(s)?s.color:this.getLayerConfig().selectColor,selectMix:ro()(s)?s.mix:this.getLayerConfig().selectMix}),this.pick({x:m,y:A})}else this.updateLayerConfig({pickedFeatureID:a,selectColor:ro()(s)?s.color:this.getLayerConfig().selectColor,selectMix:ro()(s)?s.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(os(a)).then(function(){setTimeout(function(){f.reRender()},1)})}},{key:"setBlend",value:function(a){return this.updateLayerConfig({blend:a}),this.layerModelNeedUpdate=!0,this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(a){return this.zIndex=a,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(a){this.currentPickId=a}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(a){this.selectedFeatureID=a}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var a=this.mapService.getZoom(),s=this.getLayerConfig(),f=s.visible,v=s.minZoom,m=v===void 0?-Infinity:v,x=s.maxZoom,A=x===void 0?Infinity:x;return!!f&&a>=m&&a<=A}},{key:"setMultiPass",value:function(a,s){if(this.updateLayerConfig({enableMultiPassRenderer:a}),s&&this.updateLayerConfig({passes:s}),a){var f=this.getLayerConfig(),v=f.passes,m=v===void 0?[]:v;this.multiPassRenderer=Xg(this,m,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var x=this.rendererService.getViewportSize(),A=x.width,T=x.height;this.multiPassRenderer.resize(A,T)}return this}},{key:"setMinZoom",value:function(a){return this.updateLayerConfig({minZoom:a}),this}},{key:"getMinZoom",value:function(){var a=this.getLayerConfig(),s=a.minZoom;return s}},{key:"getMaxZoom",value:function(){var a=this.getLayerConfig(),s=a.maxZoom;return s}},{key:"get",value:function(a){var s=this.getLayerConfig();return s[a]}},{key:"setMaxZoom",value:function(a){return this.updateLayerConfig({maxZoom:a}),this}},{key:"setAutoFit",value:function(a){return this.updateLayerConfig({autoFit:a}),this}},{key:"fitBounds",value:function(a){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var s=this.getSource(),f=s.extent,v=f.some(function(m){return Math.abs(m)===Infinity});return v?this:(this.mapService.fitBounds([[f[0],f[1]],[f[2],f[3]]],a),this)}},{key:"destroy",value:function(){var a;this.isDestroied||(this.layerChildren.map(function(s){return s.destroy()}),this.layerChildren=[],this.masks.map(function(s){return s.destroy()}),this.masks=[],this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(a=this.layerModel)===null||a===void 0||a.clearModels(),this.models=[],this.layerService.cleanRemove(this),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroied=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(a){return a.destroy()}),this.layerModel.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(a){return a.needRescale||a.needRemapping||a.needRegenerateVertices}).length}},{key:"setSource",value:function(a){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=a,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var s=this.mapService.getZoom();this.layerSource.updateClusterData(s)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(a){this.encodedData=a}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(a){return this.styleAttributeService.getLayerAttributeScale(a)}},{key:"getLegendItems",value:function(a){var s=this.styleAttributeService.getLayerAttributeScale(a);if(!s)return[];if(s.invertExtent){var f=s.range().map(function(x){return(0,S.Z)({value:s.invertExtent(x)},a,x)});return f}else if(s.ticks){var v=s.ticks().map(function(x){return(0,S.Z)({value:x},a,s(x))});return v}else if(s!=null&&s.domain){var m=s.domain().filter(function(x){return!Sg()(x)}).map(function(x){return(0,S.Z)({value:x},a,s(x))});return m}return[]}},{key:"pick",value:function(a){var s=a.x,f=a.y;this.interactionService.triggerHover({x:s,y:f})}},{key:"boxSelect",value:function(a,s){this.pickingService.boxPickLayer(this,a,s)}},{key:"buildLayerModel",value:function(a){var s=a.moduleName,f=a.vertexShader,v=a.fragmentShader,m=a.triangulation,x=a.segmentNumber,A=(0,Ga.Z)(a,VE);this.shaderModuleService.registerModule(s,{vs:f,fs:v});var T=this.shaderModuleService.getModule(s),I=T.vs,F=T.fs,j=T.uniforms,X=this.rendererService.createModel,ee=this.styleAttributeService.createAttributesAndIndices(this.encodedData,m,x),be=ee.attributes,Fe=ee.elements;return X(Xu({attributes:be,uniforms:j,fs:F,vs:I,elements:Fe,blend:Gg[Ws.normal]},A))}},{key:"createAttrubutes",value:function(a){var s=a.triangulation,f=this.styleAttributeService.createAttributes(this.encodedData,s),v=f.attributes;return v}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(a){var s=this.getLayerConfig(),f=s.enableHighlight,v=f===void 0?!0:f,m=s.enableSelect,x=m===void 0?!0:m,A=this.eventNames().indexOf(a)!==-1||this.eventNames().indexOf("un"+a)!==-1;return(a==="click"||a==="dblclick")&&x&&(A=!0),a==="mousemove"&&(v||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(A=!0),this.isVisible()&&A}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderMulPass",value:function(){var n=(0,Z.Z)(q().mark(function s(f){return q().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,f.render();case 2:case"end":return m.stop()}},s)}));function a(s){return n.apply(this,arguments)}return a}()},{key:"renderModels",value:function(a){var s=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.layerModel.renderUpdate&&this.layerModel.renderUpdate(),this.models.forEach(function(f){f.draw({uniforms:s.layerModel.getUninforms()},a)})),this}},{key:"updateStyleAttribute",value:function(a,s,f,v){this.inited?this.styleAttributeService.updateStyleAttribute(a,{scale:Xu({field:s},this.splitValuesAndCallbackInAttribute(f,this.getLayerConfig()[s]))},v):this.pendingStyleAttributes.push({attributeName:a,attributeField:s,attributeValues:f,updateOptions:v})}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(a){console.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&(this.layerService.updateLayerRenderList(),this.layerService.renderLayers())}},{key:"splitValuesAndCallbackInAttribute",value:function(a,s){return{values:L()(a)?void 0:a||s,callback:L()(a)?a:void 0}}}]),r}(ls.EventEmitter),qg=ri(N0.prototype,"configService",[Yg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N0),Jg,z0,ey;function YE(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=qE(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function qE(e,i){if(!!e){if(typeof e=="string")return ty(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ty(e,i)}}function ty(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Lo=(Jg=tv(yt.IGlobalConfigService),z0=function(){function e(i){(0,ht.Z)(this,e),(0,S.Z)(this,"triangulation",void 0),(0,S.Z)(this,"createTexture2D",void 0),(0,S.Z)(this,"layer",void 0),(0,S.Z)(this,"dataTexture",void 0),(0,S.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,S.Z)(this,"rowCount",void 0),(0,S.Z)(this,"cacheStyleProperties",void 0),(0,S.Z)(this,"cellLength",void 0),(0,S.Z)(this,"cellProperties",void 0),(0,S.Z)(this,"cellTypeLayout",void 0),(0,S.Z)(this,"stylePropertyesExist",void 0),(0,S.Z)(this,"dataTextureTest",void 0),Ln(this,"configService",ey,this),(0,S.Z)(this,"shaderModuleService",void 0),(0,S.Z)(this,"rendererService",void 0),(0,S.Z)(this,"iconService",void 0),(0,S.Z)(this,"fontService",void 0),(0,S.Z)(this,"styleAttributeService",void 0),(0,S.Z)(this,"mapService",void 0),(0,S.Z)(this,"cameraService",void 0),(0,S.Z)(this,"layerService",void 0),this.layer=i,this.rendererService=i.getContainer().get(yt.IRendererService),this.shaderModuleService=i.getContainer().get(yt.IShaderModuleService),this.styleAttributeService=i.getContainer().get(yt.IStyleAttributeService),this.mapService=i.getContainer().get(yt.IMapService),this.iconService=i.getContainer().get(yt.IIconService),this.fontService=i.getContainer().get(yt.IFontService),this.cameraService=i.getContainer().get(yt.ICameraService),this.layerService=i.getContainer().get(yt.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var r=this.rendererService.createTexture2D;this.createTexture2D=r,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8Array(4),mag:k.NEAREST,min:k.NEAREST,width:1,height:1}))}return(0,Pt.Z)(e,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,this.stylePropertyesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(r){var n=!1;return Oc()(r.thetaOffset,this.cacheStyleProperties.thetaOffset)||(n=!0,this.cacheStyleProperties.thetaOffset=r.thetaOffset),Oc()(r.opacity,this.cacheStyleProperties.opacity)||(n=!0,this.cacheStyleProperties.opacity=r.opacity),Oc()(r.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(n=!0,this.cacheStyleProperties.strokeOpacity=r.strokeOpacity),Oc()(r.strokeWidth,this.cacheStyleProperties.strokeWidth)||(n=!0,this.cacheStyleProperties.strokeWidth=r.strokeWidth),Oc()(r.stroke,this.cacheStyleProperties.stroke)||(n=!0,this.cacheStyleProperties.stroke=r.stroke),Oc()(r.offsets,this.cacheStyleProperties.offsets)||(n=!0,this.cacheStyleProperties.offsets=r.offsets),this.dataTexture===void 0&&(n=!0),n}},{key:"judgeStyleAttributes",value:function(r){this.clearLastCalRes(),r.opacity!==void 0&&!Oi()(r.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),r.strokeOpacity!==void 0&&!Oi()(r.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),r.strokeWidth!==void 0&&!Oi()(r.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),r.stroke!==void 0&&!this.isStaticColor(r.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),r.offsets!==void 0&&!this.isOffsetStatic(r.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2),r.thetaOffset!==void 0&&!Oi()(r.thetaOffset)&&(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertyesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(r){return w()(r)?!!(0,Ns.ZP)(r):!1}},{key:"getStrokeColor",value:function(r){if(this.isStaticColor(r)){var n=pi(r);return n[0]=n[0]?n[0]:0,n[1]=n[1]?n[1]:0,n[2]=n[2]?n[2]:0,n[3]=n[3]?n[3]:0,n}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(r){return!!(Array.isArray(r)&&r.length===2&&Oi()(r[0])&&Oi()(r[1]))}},{key:"patchMod",value:function(r,n){for(var a=0;a<n;a++)r.push(-1)}},{key:"patchData",value:function(r,n,a){var s=YE(a),f;try{for(s.s();!(f=s.n()).done;){var v=f.value,m=v.attr,x=v.count,A=n[m];A!==void 0?m==="stroke"?r.push.apply(r,(0,Se.Z)(pi(A))):m==="offsets"?this.isOffsetStatic(A)?r.push(-A[0],A[1]):r.push(0,0):r.push(Oi()(A)?A:1):this.patchMod(r,x)}}catch(T){s.e(T)}finally{s.f()}}},{key:"calDataFrame",value:function(r,n,a){for(var s=n.length,f=Math.ceil(s*r/this.DATA_TEXTURE_WIDTH),v=f*this.DATA_TEXTURE_WIDTH,m=[],x=0;x<s;x++){var A=n[x];this.patchData(m,A,a)}for(var T=m.length;T<v;T++)m.push(-1);return{data:m,width:this.DATA_TEXTURE_WIDTH,height:f}}},{key:"getBlend",value:function(){var r=this.layer.getLayerConfig(),n=r.blend,a=n===void 0?"normal":n;return Gg[Ws[a]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.duration||4,r.interval||.2,r.trailLength||.1]}},{key:"startModelAnimate",value:function(){var r=this.layer.getLayerConfig(),n=r.animateOption;n.enable&&this.layer.setAnimateStartTime()}}]),e}(),ey=ri(z0.prototype,"configService",[Jg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z0),ry=100,X3=36,Y3=40;function ny(e){return e/180*Math.acos(-1)}function iy(e){var i=ny(e[0])+Math.PI/2,r=ny(e[1]),n=ry+Math.random()*.4,a=n*Math.cos(r)*Math.cos(i),s=n*Math.cos(r)*Math.sin(i),f=n*Math.sin(r);return[s,f,a]}function q3(e,i){var r=mat4.create(),n=mat4.create(),a=vec3.fromValues(0,1,0),s=vec3.fromValues(0,0,0);i=i||{},e=typeof e!="undefined"?e:1;for(var f=typeof i.segments!="undefined"?i.segments:32,v=2+f,m=2*v,x=[],A=[],T=[],I=[],F=[],j=[],X=0;X<=v;X++){for(var ee=X/v,be=ee*Math.PI,Fe=0;Fe<=m;Fe++){var We=Fe/m,et=We*Math.PI*2;mat4.identity(n),mat4.rotateZ(n,n,-be),mat4.identity(r),mat4.rotateY(r,r,et),vec3.transformMat4(s,a,n),vec3.transformMat4(s,s,r),vec3.scale(s,s,-e),T.push(s.slice()),I.push.apply(I,_toConsumableArray(s.slice())),vec3.normalize(s,s),F.push.apply(F,_toConsumableArray(s.slice())),j.push([We,1-ee]),I.push(We,1-ee)}if(X>0)for(var xt=T.length,Ct=xt-2*(m+1);Ct+m+2<xt;Ct++)x.push([Ct,Ct+1,Ct+m+1]),A.push(Ct,Ct+1,Ct+m+1),x.push([Ct+m+1,Ct+1,Ct+m+2]),A.push(Ct+m+1,Ct+1,Ct+m+2)}return{cells:x,positions:T,uvs:j,positionsArr:I,indicesArr:A,normalArr:F}}var xi=Q(31437),Hv=xi.create(),K3=xi.create(),Xs=xi.create(),lp=xi.create(),yd=xi.create();function U0(e,i,r,n,a){xi.add(e,r,n),xi.normalize(e,e),i=xi.fromValues(-e[1],e[0]);var s=xi.fromValues(-r[1],r[0]);return[a/xi.dot(i,s),i]}function cp(e,i){return xi.set(e,-i[1],i[0])}function _d(e,i,r){return xi.sub(e,i,r),xi.normalize(e,e),e}function Z0(e,i){return e[0]===i[0]&&e[1]===i[1]}function $3(e){for(var i=new Map,r=0;r<e.length;r++){var n=e[0].toString()+"-"+e[1].toString();i.get(n)?(e.splice(r,1),r++):i.set(n,n)}return e}var ay=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,ht.Z)(this,e),(0,S.Z)(this,"complex",void 0),(0,S.Z)(this,"join",void 0),(0,S.Z)(this,"cap",void 0),(0,S.Z)(this,"miterLimit",void 0),(0,S.Z)(this,"thickness",void 0),(0,S.Z)(this,"normal",void 0),(0,S.Z)(this,"lastFlip",-1),(0,S.Z)(this,"miter",xi.fromValues(0,0)),(0,S.Z)(this,"started",!1),(0,S.Z)(this,"dash",!1),(0,S.Z)(this,"totalDistance",0),(0,S.Z)(this,"currentIndex",0),this.join=i.join||"miter",this.cap=i.cap||"butt",this.miterLimit=i.miterLimit||10,this.thickness=i.thickness||1,this.dash=i.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,Pt.Z)(e,[{key:"extrude_gaode2",value:function(r,n){var a=this.complex;if(r.length<=1)return a;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var s=r.length,f=a.startIndex,v=1;v<s;v++){var m,x,A,T=r[v-1];T.push((m=n[v-1][2])!==null&&m!==void 0?m:0);var I=n[v-1],F=r[v];F.push((x=n[v][2])!==null&&x!==void 0?x:0);var j=n[v],X=v<r.length-1?[].concat((0,Se.Z)(r[v+1]),[(A=n[v+1][2])!==null&&A!==void 0?A:0]):null,ee=v<n.length-1?n[v+1]:null,be=this.segment_gaode2(a,f,T,F,X,I,j,ee);f+=be}if(this.dash)for(var Fe=0;Fe<a.positions.length/6;Fe++)a.positions[Fe*6+5]=this.totalDistance;return a.startIndex=a.positions.length/6,a}},{key:"simpleExtrude_gaode2",value:function(r,n){var a=this.complex;if(r.length<=1)return a;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var s=r.length,f=a.startIndex,v=1;v<s;v++){var m,x,A,T=r[v-1];T.push((m=n[v-1][2])!==null&&m!==void 0?m:0);var I=n[v-1],F=r[v];F.push((x=n[v][2])!==null&&x!==void 0?x:0);var j=n[v],X=v<r.length-1?[].concat((0,Se.Z)(r[v+1]),[(A=n[v+1][2])!==null&&A!==void 0?A:0]):null,ee=v<n.length-1?n[v+1]:null,be=this.simpleSegment(a,f,T,F,X,I,j,ee);f+=be}if(this.dash)for(var Fe=0;Fe<a.positions.length/6;Fe++)a.positions[Fe*6+5]=this.totalDistance;return a.startIndex=a.positions.length/6,a}},{key:"extrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=r.length,s=n.startIndex,f=1;f<a;f++){var v=r[f-1],m=r[f],x=f<r.length-1?r[f+1]:null,A=this.segment(n,s,v,m,x);s+=A}if(this.dash)for(var T=0;T<n.positions.length/6;T++)n.positions[T*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=r.length,s=n.startIndex,f=1;f<a;f++){var v=r[f-1],m=r[f],x=f<r.length-1?r[f+1]:null,A=this.simpleSegment(n,s,v,m,x);s+=A}if(this.dash)for(var T=0;T<n.positions.length/6;T++)n.positions[T*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(r,n,a,s,f,v,m,x){var A=0,T=r.indices,I=r.positions,F=r.normals,j=this.cap==="square",X=this.join==="bevel",ee=as([m[0],m[1]]),be=as([v[0],v[1]]);_d(Xs,s,a);var Fe=0;if(this.dash&&(Fe=this.lineSegmentDistance(ee,be),this.totalDistance+=Fe),this.normal||(this.normal=xi.create(),cp(this.normal,Xs)),!this.started)if(this.started=!0,j){var We=xi.create(),et=xi.create();xi.add(We,this.normal,Xs),xi.add(et,this.normal,Xs),F.push(et[0],et[1],0),F.push(We[0],We[1],0),I.push(a[0],a[1],a[2]|0,this.totalDistance-Fe,-this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),I.push(a[0],a[1],a[2]|0,this.totalDistance-Fe,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(I,F,a,this.normal,this.thickness,this.totalDistance-Fe);if(T.push(n+0,n+1,n+2),f){Z0(s,f)&&xi.add(f,s,xi.normalize(f,xi.subtract(f,s,a))),_d(lp,f,s);var Yt=U0(yd,xi.create(),Xs,lp,this.thickness),ar=(0,dn.Z)(Yt,2),Ar=ar[0],Qr=ar[1],vr=xi.dot(yd,this.normal)<0?-1:1,pn=X;if(!pn&&this.join==="miter"){var Tn=Ar;Tn>this.miterLimit&&(pn=!0)}pn?(F.push(this.normal[0],this.normal[1],0),F.push(Qr[0],Qr[1],0),I.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*vr,s[2]|0),this.complex.indexes.push(this.currentIndex),I.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness*vr,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,T.push.apply(T,(0,Se.Z)(this.lastFlip!==-vr?[n,n+2,n+3]:[n+2,n+1,n+3])),T.push(n+2,n+3,n+4),cp(Hv,lp),xi.copy(this.normal,Hv),F.push(this.normal[0],this.normal[1],0),I.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*vr,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,A+=3):(this.extrusions(I,F,s,Qr,Ar,this.totalDistance),T.push.apply(T,(0,Se.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),vr=-1,xi.copy(this.normal,Qr),A+=2),this.lastFlip=vr}else{if(cp(this.normal,Xs),j){var xt=xi.create(),Ct=xi.create();xi.sub(Ct,Xs,this.normal),xi.add(xt,Xs,this.normal),F.push(Ct[0],Ct[1],0),F.push(xt[0],xt[1],0),I.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),I.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(I,F,s,this.normal,this.thickness,this.totalDistance);T.push.apply(T,(0,Se.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),A+=2}return A}},{key:"simpleSegment",value:function(r,n,a,s,f){var v=0,m=r.indices,x=r.positions,A=r.normals,T=as([s[0],s[1]]),I=as([a[0],a[1]]);_d(Xs,T,I);var F=0;if(this.dash&&(F=this.lineSegmentDistance(T,I),this.totalDistance+=F),this.normal||(this.normal=xi.create(),cp(this.normal,Xs)),this.started||(this.started=!0,this.extrusions(x,A,a,this.normal,this.thickness,this.totalDistance-F)),m.push(n+0,n+1,n+2),!f)cp(this.normal,Xs),this.extrusions(x,A,s,this.normal,this.thickness,this.totalDistance),m.push.apply(m,(0,Se.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),v+=2;else{var j=as([f[0],f[1]]);Z0(T,j)&&xi.add(j,T,xi.normalize(j,xi.subtract(j,T,I))),_d(lp,j,T);var X=U0(yd,xi.create(),Xs,lp,this.thickness),ee=(0,dn.Z)(X,2),be=ee[0],Fe=ee[1],We=xi.dot(yd,this.normal)<0?-1:1;this.extrusions(x,A,s,Fe,be,this.totalDistance),m.push.apply(m,(0,Se.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),We=-1,xi.copy(this.normal,Fe),v+=2,this.lastFlip=We}return v}},{key:"segment",value:function(r,n,a,s,f){var v=0,m=r.indices,x=r.positions,A=r.normals,T=this.cap==="square",I=this.join==="bevel",F=as([s[0],s[1]]),j=as([a[0],a[1]]);_d(Xs,F,j);var X=0;if(this.dash&&(X=this.lineSegmentDistance(F,j),this.totalDistance+=X),this.normal||(this.normal=xi.create(),cp(this.normal,Xs)),!this.started)if(this.started=!0,T){var ee=xi.create(),be=xi.create();xi.add(ee,this.normal,Xs),xi.add(be,this.normal,Xs),A.push(be[0],be[1],0),A.push(ee[0],ee[1],0),x.push(a[0],a[1],a[2]|0,this.totalDistance-X,-this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),x.push(a[0],a[1],a[2]|0,this.totalDistance-X,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(x,A,a,this.normal,this.thickness,this.totalDistance-X);if(m.push(n+0,n+1,n+2),f){var et=as([f[0],f[1]]);Z0(F,et)&&xi.add(et,F,xi.normalize(et,xi.subtract(et,F,j))),_d(lp,et,F);var xt=U0(yd,xi.create(),Xs,lp,this.thickness),Ct=(0,dn.Z)(xt,2),Yt=Ct[0],ar=Ct[1],Ar=xi.dot(yd,this.normal)<0?-1:1,Qr=I;if(!Qr&&this.join==="miter"){var vr=Yt;vr>this.miterLimit&&(Qr=!0)}Qr?(A.push(this.normal[0],this.normal[1],0),A.push(ar[0],ar[1],0),x.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*Ar,s[2]|0),this.complex.indexes.push(this.currentIndex),x.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness*Ar,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,m.push.apply(m,(0,Se.Z)(this.lastFlip!==-Ar?[n,n+2,n+3]:[n+2,n+1,n+3])),m.push(n+2,n+3,n+4),cp(Hv,lp),xi.copy(this.normal,Hv),A.push(this.normal[0],this.normal[1],0),x.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*Ar,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,v+=3):(this.extrusions(x,A,s,ar,Yt,this.totalDistance),m.push.apply(m,(0,Se.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Ar=-1,xi.copy(this.normal,ar),v+=2),this.lastFlip=Ar}else{if(cp(this.normal,Xs),T){var Fe=xi.create(),We=xi.create();xi.sub(We,Xs,this.normal),xi.add(Fe,Xs,this.normal),A.push(We[0],We[1],0),A.push(Fe[0],Fe[1],0),x.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),x.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(x,A,s,this.normal,this.thickness,this.totalDistance);m.push.apply(m,(0,Se.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),v+=2}return v}},{key:"extrusions",value:function(r,n,a,s,f,v){n.push(s[0],s[1],0),n.push(s[0],s[1],0),r.push(a[0],a[1],a[2]|0,v,-f,a[2]|0),this.complex.indexes.push(this.currentIndex),r.push(a[0],a[1],a[2]|0,v,f,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(r,n){var a=n[0]-r[0],s=n[1]-r[1];return Math.sqrt(a*a+s*s)}}]),e}();function Up(e){if(Oi()(e[0]))return e;if(Oi()(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(Oi()(e[0][0][0])){var i=e,r=0,n=0,a=0;return i.forEach(function(s){s.forEach(function(f){r+=f[0],n+=f[1],a++})}),[r/a,n/a,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function KE(e){for(var i=e[0],r=e[1],n=e[0],a=e[1],s=0,f=0,v=0,m=0;m<e.length;m+=2){var x=e[m],A=e[m+1];x&&A&&(i=Math.max(x,i),r=Math.max(A,r),n=Math.min(x,n),a=Math.min(A,a),s+=x,f+=A,v++)}return{center:[s/v,f/v],radius:Math.sqrt(Math.pow(i-n,2)+Math.pow(r-a,2))/2}}var Ya=Q(77160);function $E(e){var i=e[0][0],r=e[0][e[0].length-1];i[0]===r[0]&&i[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var n=e[0].length,a=Ic().flatten(e),s=a.vertices,f=a.dimensions,v=[],m=[],x=0;x<s.length/f;x++)f===2?v.push(s[x*2],s[x*2+1],1):v.push(s[x*3],s[x*3+1],1);var A=Ic()(a.vertices,a.holes,a.dimensions);m.push.apply(m,(0,Se.Z)(A));for(var T=function(j){var X=a.vertices.slice(j*f,(j+1)*f),ee=a.vertices.slice((j+1)*f,(j+2)*f);ee.length===0&&(ee=a.vertices.slice(0,f));var be=v.length/3;v.push(X[0],X[1],1,ee[0],ee[1],1,X[0],X[1],0,ee[0],ee[1],0),m.push.apply(m,(0,Se.Z)([0,2,1,2,3,1].map(function(Fe){return Fe+be})))},I=0;I<n;I++)T(I);return{positions:v,index:m}}function QE(e){var i=Ic().flatten(e),r=Ic()(i.vertices,i.holes,i.dimensions);return{positions:i.vertices,index:r}}function oy(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=e[0][0],n=e[0][e[0].length-1];r[0]===n[0]&&r[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var a=e[0].length,s=Ic().flatten(e),f=s.vertices,v=s.dimensions,m=[],x=[],A=[],T=0;T<f.length/v;T++)v===2?m.push(f[T*2],f[T*2+1],1,-1,-1):m.push(f[T*3],f[T*3+1],1,-1,-1),A.push(0,0,1);var I=Ic()(s.vertices,s.holes,s.dimensions);x.push.apply(x,(0,Se.Z)(I));for(var F=function(ee){var be=s.vertices.slice(ee*v,(ee+1)*v),Fe=s.vertices.slice((ee+1)*v,(ee+2)*v);Fe.length===0&&(Fe=s.vertices.slice(0,v));var We=m.length/5;m.push(be[0],be[1],1,0,0,Fe[0],Fe[1],1,.1,0,be[0],be[1],0,0,.8,Fe[0],Fe[1],0,.1,.8);var et=JE([Fe[0],Fe[1],1],[be[0],be[1],0],[be[0],be[1],1],i);A.push.apply(A,(0,Se.Z)(et).concat((0,Se.Z)(et),(0,Se.Z)(et),(0,Se.Z)(et))),x.push.apply(x,(0,Se.Z)([1,2,0,3,2,1].map(function(xt){return xt+We})))},j=0;j<a;j++)F(j);return{positions:m,index:x,normals:A}}function JE(e,i,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,a=Ya.create(),s=Ya.create(),f=Ya.create();n&&(e=Ai(e),i=Ai(i),r=Ai(r));var v=Ya.fromValues.apply(Ya,(0,Se.Z)(e)),m=Ya.fromValues.apply(Ya,(0,Se.Z)(i)),x=Ya.fromValues.apply(Ya,(0,Se.Z)(r));Ya.sub(a,x,m),Ya.sub(s,v,m),Ya.cross(f,a,s);var A=Ya.create();return Ya.normalize(A,f),A}var Lc,Zp;(function(e){e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn"})(Zp||(Zp={}));var jp;(function(e){e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon"})(jp||(jp={}));function av(e){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=Math.PI*2/e,n=[],a=0;a<e;a++)n.push(r*a+i*Math.PI/12);var s=n.map(function(f){var v=Math.sin(f+Math.PI/4),m=Math.cos(f+Math.PI/4);return[v,m,0]});return s}function sy(){return av(30)}function uy(){return av(4)}function ly(){return av(3)}function cy(){return av(6,1)}function fy(){return av(5)}var xd=(Lc={},(0,S.Z)(Lc,jp.CIRCLE,sy),(0,S.Z)(Lc,jp.HEXAGON,cy),(0,S.Z)(Lc,jp.TRIANGLE,ly),(0,S.Z)(Lc,jp.SQUARE,uy),(0,S.Z)(Lc,jp.PENTAGON,fy),(0,S.Z)(Lc,Zp.CYLINDER,sy),(0,S.Z)(Lc,Zp.HEXAGONCOLUMN,cy),(0,S.Z)(Lc,Zp.TRIANGLECOLUMN,ly),(0,S.Z)(Lc,Zp.SQUARECOLUMN,uy),(0,S.Z)(Lc,Zp.PENTAGONCOLUMN,fy),Lc),Wv={};function bd(e){var i=Up(e.coordinates);return{vertices:[].concat((0,Se.Z)(i),(0,Se.Z)(i),(0,Se.Z)(i),(0,Se.Z)(i)),indices:[0,1,2,2,3,0],size:i.length}}function eS(e){var i=Up(e.coordinates),r=iy(i);return{vertices:[].concat((0,Se.Z)(r),(0,Se.Z)(r),(0,Se.Z)(r),(0,Se.Z)(r)),indices:[0,1,2,2,3,0],size:r.length}}function hy(e){var i=e.shape,r=aS(i,!1),n=r.positions,a=r.index,s=r.normals;return{vertices:n,indices:a,normals:s,size:5}}function py(e){var i=Up(e.coordinates);return{vertices:(0,Se.Z)(i),indices:[0],size:i.length}}function dy(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,a=new ay({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var s=i;Array.isArray(s[0][0])||(s=[i]);var f=r;Array.isArray(f[0][0])||(f=[r]);for(var v=0;v<s.length;v++){var m=s[v],x=f[v];a.extrude_gaode2(m,x)}}else{var A=i;A[0]&&!Array.isArray(A[0][0])&&(A=[i]),A.forEach(function(I){a.extrude(I)})}var T=a.complex;return{vertices:T.positions,indices:T.indices,normals:T.normals,indexes:T.indexes,size:6}}function tS(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,a=new ay({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var s=i;Array.isArray(s[0][0])||(s=[i]);var f=r;Array.isArray(f[0][0])||(f=[r]);for(var v=0;v<s.length;v++){var m=s[v],x=f[v];a.simpleExtrude_gaode2(m,x)}}else{var A=i;A[0]&&!Array.isArray(A[0][0])&&(A=[i]),A.forEach(function(I){a.simpleExtrude(I)})}var T=a.complex;return{vertices:T.positions,indices:T.indices,normals:T.normals,size:6}}function j0(e){var i=e.coordinates,r=Ic().flatten(i),n=r.vertices,a=r.dimensions,s=r.holes;return{indices:Ic()(n,s,a),vertices:n,size:a}}function rS(e){var i=e.coordinates,r=Ic().flatten(i),n=r.vertices,a=r.dimensions,s=r.holes;return{indices:Ic()(n,s,a),vertices:nS(n),size:a+4}}function nS(e){for(var i=[],r=KE(e),n=r.center,a=r.radius,s=0;s<e.length;s+=2){var f=e[s],v=e[s+1];i.push.apply(i,[f,v,0].concat((0,Se.Z)(n),[a]))}return i}function vy(e){var i=e.coordinates,r=oy(i,!0),n=r.positions,a=r.index,s=r.normals;return{vertices:n,indices:a,normals:s,size:5}}function gy(e){var i=e.shape,r=sS(i),n=r.positions,a=r.index;return{vertices:n,indices:a,size:3}}function yy(e){var i=e.coordinates,r=[].concat((0,Se.Z)(i[0]),[0,0,1,i[1][0],i[0][1],0,1,1],(0,Se.Z)(i[1]),[0,1,0],(0,Se.Z)(i[0]),[0,0,1],(0,Se.Z)(i[1]),[0,1,0,i[0][0],i[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:r,indices:n,size:5}}function Xv(e,i){for(var r=i||30,n=e.coordinates,a=[],s=[],f=function(x){a.push(x,1,x,n[0][0],n[0][1],n[1][0],n[1][1],x,-1,x,n[0][0],n[0][1],n[1][0],n[1][1]),x!==r-1&&s.push.apply(s,(0,Se.Z)([0,1,2,1,3,2].map(function(A){return x*2+A})))},v=0;v<r;v++)f(v);return{vertices:a,indices:s,size:7}}function iS(e){var i=e.coordinates;i.length===2&&i.push(0);var r=e.size,n=Yv(-1,1),a=Yv(1,1),s=Yv(-1,-1),f=Yv(1,-1),v=[].concat((0,Se.Z)(i),(0,Se.Z)(n),(0,Se.Z)(i),(0,Se.Z)(s),(0,Se.Z)(i),(0,Se.Z)(f),(0,Se.Z)(i),(0,Se.Z)(a)),m=[0,1,2,3,0,2];return{vertices:v,indices:m,size:5}}function aS(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(Wv&&Wv[e])return Wv[e];var r=xd[e]?xd[e]():xd.cylinder(),n=oy([r],i);return Wv[e]=n,n}function Q3(e,i){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,a=new Float32Array(e.length/r*3),s,f,v,m=vec3.create(),x=vec3.create(),A=vec3.create(),T=0,I=i.length;T<I;T+=3){s=i[T+0]*3,f=i[T+1]*3,v=i[T+2]*3;var F=[e[s],e[s+1]],j=[e[f],e[f+1]],X=[e[v],e[v+1]];n&&(F=lngLatToMeters(F),j=lngLatToMeters(j),X=lngLatToMeters(X));var ee=F,be=_slicedToArray(ee,2),Fe=be[0],We=be[1],et=vec3.fromValues(Fe,We,e[s+2]),xt=j,Ct=_slicedToArray(xt,2),Yt=Ct[0],ar=Ct[1],Ar=vec3.fromValues(Yt,ar,e[f+2]),Qr=X,vr=_slicedToArray(Qr,2),pn=vr[0],Tn=vr[1],qn=vec3.fromValues(pn,Tn,e[v+2]);vec3.sub(m,qn,Ar),vec3.sub(x,et,Ar),vec3.cross(A,m,x),a[s]+=m[0],a[s+1]+=m[1],a[s+2]+=m[2],a[f]+=m[0],a[f+1]+=m[1],a[f+2]+=m[2],a[v]+=m[0],a[v+1]+=m[1],a[v+2]+=m[2]}return oS(a),a}function oS(e){for(var i=0,r=e.length;i<r;i+=3){var n=vec3.fromValues(e[i],e[i+1],e[i+2]),a=vec3.create();vec3.normalize(a,n),e.set(a,i)}}function J3(e){var i=e[0][0],r=e[0][e[0].length-1];return i[0]===r[0]&&i[1]===r[1]}function sS(e){var i=["cylinder","triangleColumn","hexagonColumn","squareColumn"],r=xd[e]?xd[e]():xd.circle(),n=i.indexOf(e)===-1?QE([r]):$E([r]);return n}function Yv(e,i){var r=(e+1)/2,n=(i+1)/2;return[r,n]}function eO(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function tO(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function uS(e){var i=lS();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function lS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cS=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

uniform float u_circleSweep;
uniform float u_cityMinSize;
uniform vec3 u_circleSweepColor;
uniform float u_circleSweepSpeed;

varying float v_worldDis;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    gl_FragColor.rgb += r * r * u_circleSweepColor;
  }
   
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,fS=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

uniform float u_circleSweep;
uniform vec2 u_cityCenter;

varying float v_worldDis;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,hS=function(e){(0,Pr.Z)(r,e);var i=uS(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"cityCenter",void 0),(0,S.Z)((0,J.Z)(n),"cityMinSize",void 0),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.baseColor,m=v===void 0?"rgb(16,16,16)":v,x=a.brightColor,A=x===void 0?"rgb(255,176,38)":x,T=a.windowColor,I=T===void 0?"rgb(30,60,89)":T,F=a.time,j=F===void 0?0:F,X=a.sweep,ee=X===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:X;return{u_cityCenter:ee.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*ee.sweepRadius,u_circleSweep:ee.enable?1:0,u_circleSweepColor:pi(ee.sweepColor).slice(0,3),u_circleSweepSpeed:ee.sweepSpeed,u_opacity:f,u_baseColor:pi(m),u_brightColor:pi(A),u_windowColor:pi(I),u_time:this.layer.getLayerAnimateTime()||j}}},{key:"calCityGeo",value:function(){var a=(0,dn.Z)(this.layer.getSource().extent,4),s=a[0],f=a[1],v=a[2],m=a[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(v+s)/2,(m+f)/2]);var x=this.mapService.lngLatToCoord([v,m]),A=this.mapService.lngLatToCoord([s,f]);this.cityMinSize=Math.sqrt(Math.pow(x[0]-A[0],2)+Math.pow(x[1]-A[1],2))/4}else{var T=v-s,I=m-f;this.cityCenter=[(v+s)/2,(m+f)/2],this.cityMinSize=Math.sqrt(Math.pow(T,2)+Math.pow(I,2))/4}}},{key:"initModels",value:function(){return this.calCityGeo(),this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:fS,fragmentShader:cS,triangulation:vy,cull:{enable:!0,face:k.BACK}})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:Fn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(s,f,v,m,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,f,v,m){var x=s.size,A=x===void 0?10:x;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Fn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(s,f,v,m){var x=s.size;return[v[3],v[4]]}}})}}]),r}(Lo);function pS(e){var i=dS();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function dS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vS=function(e){(0,Pr.Z)(r,e);var i=pS(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"type","PolygonLayer"),n}return(0,Pt.Z)(r,[{key:"buildModels",value:function(){this.layerModel=new hS(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(a){this.updateLayerConfig({time:a})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),r}(zp);function mS(e){var i=gS();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function gS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yS=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,_S=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,xS=function(e){(0,Pr.Z)(r,e);var i=mS(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=a.coverage,v=a.angle;return{u_opacity:s||1,u_coverage:f||.9,u_angle:v||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:yS,fragmentShader:_S,triangulation:gy,depth:{enable:!1},primitive:k.TRIANGLES,blend:this.getBlend(),stencil:Da(f,m)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Fn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(s,f){var v=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[v[0],v[1],0]}}})}}]),r}(Lo);function bS(e){var i=ES();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function ES(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var SS=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,CS=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,AS=function(e){(0,Pr.Z)(r,e);var i=bS(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=a.coverage,v=a.angle;return{u_opacity:s||1,u_coverage:f||1,u_angle:v||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:SS,fragmentShader:CS,triangulation:hy,depth:{enable:!0},blend:this.getBlend(),stencil:Da(f,m)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,f,v,m){var x=s.size;return Array.isArray(x)?[x[0]]:[x]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Fn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(s,f,v,m,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Fn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(s,f){var v=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[v[0],v[1],0]}}})}}]),r}(Lo);function wS(e,i){for(var r=[],n=[],a=[],s=e+1,f=i+1,v=e/2,m=i/2,x=0;x<f;x++)for(var A=x-m,T=0;T<s;T++){var I=T-v;n.push(I/v,-A/m,0),a.push(T/e),a.push(1-x/i)}for(var F=0;F<i;F++)for(var j=0;j<e;j++){var X=j+s*F,ee=j+s*(F+1),be=j+1+s*(F+1),Fe=j+1+s*F;r.push(X,ee,Fe),r.push(ee,be,Fe)}return{vertices:n,indices:r,uvs:a}}var _y,xy;function by(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Ey(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?by(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):by(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function TS(e){var i=MS();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function MS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var PS=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,OS=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,IS=`uniform sampler2D u_texture;        // \u70ED\u529B\u5F3A\u5EA6\u56FE
uniform sampler2D u_colorTexture;   // \u6839\u636E\u5F3A\u5EA6\u5206\u5E03\u7684\u8272\u5E26
uniform float u_opacity;
varying vec2 v_texCoord;

float getBlurIndusty() {
    float h = 2.0/512.0;
    vec2 vUv = v_texCoord;
    float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y + 1.0 * h) ).r;
    float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * h, vUv.y + 1.0 * h) ).r;
    float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y + 1.0 * h) ).r;

    float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y) ).r;
    float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;
    float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y) ).r;

    float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y-1.0*h) ).r;
    float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * h, vUv.y-1.0*h) ).r;
    float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y-1.0*h) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture2D(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));

    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,RS=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;

void main() {
  v_texCoord = a_Uv;

  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,kS=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,LS=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,Sy=(_y=(0,Xr.b2)(),_y(xy=function(e){(0,Pr.Z)(r,e);var i=TS(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"texture",void 0),(0,S.Z)((0,J.Z)(n),"colorTexture",void 0),(0,S.Z)((0,J.Z)(n),"heatmapFramerBuffer",void 0),(0,S.Z)((0,J.Z)(n),"intensityModel",void 0),(0,S.Z)((0,J.Z)(n),"colorModel",void 0),(0,S.Z)((0,J.Z)(n),"shapeType",void 0),n}return(0,Pt.Z)(r,[{key:"render",value:function(){var a=this,s=this.rendererService,f=s.clear,v=s.useFramebuffer;v(this.heatmapFramerBuffer,function(){f({color:[0,0,0,0],depth:1,stencil:0,framebuffer:a.heatmapFramerBuffer}),a.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var a,s=this.rendererService,f=s.createFramebuffer,v=s.clear,m=s.getViewportSize,x=s.createTexture2D,A=s.useFramebuffer,T=this.styleAttributeService.getLayerStyleAttribute("shape"),I=(T==null||(a=T.scale)===null||a===void 0?void 0:a.field)||"heatmap";this.shapeType=I,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=I==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var F=m(),j=F.width,X=F.height;return this.heatmapFramerBuffer=f({color:x({width:Math.floor(j/4),height:Math.floor(X/4),wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE,min:k.LINEAR,mag:k.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:Fn.Attribute,descriptor:{name:"a_Dir",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(s,f,v,m){return[v[3],v[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,f,v,m){var x=s.size,A=x===void 0?1:x;return[A]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:LS,fragmentShader:kS,triangulation:iS,depth:{enable:!1},cull:{enable:!0,face:Vl(this.mapService.version)},blend:{enable:!0,func:{srcRGB:k.ONE,srcAlpha:1,dstRGB:k.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v;this.shaderModuleService.registerModule("heatmapColor",{vs:RS,fs:IS});var x=this.shaderModuleService.getModule("heatmapColor"),A=x.vs,T=x.fs,I=x.uniforms,F=this.rendererService,j=F.createAttribute,X=F.createElements,ee=F.createBuffer,be=F.createModel;return be({vs:A,fs:T,attributes:{a_Position:j({buffer:ee({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:k.FLOAT}),size:3}),a_Uv:j({buffer:ee({data:[0,1,1,1,0,0,1,0],type:k.FLOAT}),size:2})},uniforms:Ey({},I),depth:{enable:!1},blend:this.getBlend(),count:6,elements:X({data:[0,2,1,2,3,1],type:k.UNSIGNED_INT,count:6}),stencil:Da(f,m)})}},{key:"drawIntensityMode",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=a.intensity,v=f===void 0?10:f,m=a.radius,x=m===void 0?5:m;this.intensityModel.draw({uniforms:{u_opacity:s||1,u_radius:x,u_intensity:v}})}},{key:"drawColorMode",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;this.colorModel.draw({uniforms:{u_opacity:s||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=qi();Vh(f,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:s||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,Se.Z)(f)}})}},{key:"build3dHeatMap",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v,x=this.rendererService.getViewportSize,A=x(),T=A.width,I=A.height,F=wS(T/4,I/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:OS,fs:PS});var j=this.shaderModuleService.getModule("heatmap3dColor"),X=j.vs,ee=j.fs,be=j.uniforms,Fe=this.rendererService,We=Fe.createAttribute,et=Fe.createElements,xt=Fe.createBuffer,Ct=Fe.createModel;return Ct({vs:X,fs:ee,attributes:{a_Position:We({buffer:xt({data:F.vertices,type:k.FLOAT}),size:3}),a_Uv:We({buffer:xt({data:F.uvs,type:k.FLOAT}),size:2})},primitive:k.TRIANGLES,uniforms:Ey({},be),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:k.SRC_ALPHA,srcAlpha:1,dstRGB:k.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:et({data:F.indices,type:k.UNSIGNED_INT,count:F.indices.length}),stencil:Da(f,m)})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var a=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var s=this.layer.getLayerConfig(),f=s.rampColors,v=jl(f);this.colorTexture=a({data:new Uint8Array(v.data),width:v.width,height:v.height,wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE,min:k.NEAREST,mag:k.NEAREST,flipY:!1})}}]),r}(Lo))||xy);function DS(e){var i=FS();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function FS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BS=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,NS=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,zS=function(e){(0,Pr.Z)(r,e);var i=DS(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=a.coverage,v=a.angle;return{u_opacity:s||1,u_coverage:f||.9,u_angle:v||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:NS,fragmentShader:BS,triangulation:gy,depth:{enable:!1},primitive:k.TRIANGLES,blend:this.getBlend(),stencil:Da(f,m)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Fn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(s,f){var v=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[v[0],v[1],0]}}})}}]),r}(Lo),US={heatmap:Sy,heatmap3d:Sy,grid:xS,grid3d:AS,hexagon:zS},ZS=US;function jS(e){var i=VS();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function VS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var GS=function(e){(0,Pr.Z)(r,e);var i=jS(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"type","HeatMapLayer"),n}return(0,Pt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new ZS[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var a=this,s=this.getModelType();return s==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(f){return f.draw({uniforms:a.layerModel.getUninforms()})}),this)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),f=this.getLayerConfig(),v=f.shape3d,m=this.getSource(),x=m.data.type,A=(s==null||(a=s.scale)===null||a===void 0?void 0:a.field)||"heatmap";return A==="heatmap"||A==="heatmap3d"?"heatmap":x==="hexagon"?(v==null?void 0:v.indexOf(A))===-1?"hexagon":"grid3d":x==="grid"?(v==null?void 0:v.indexOf(A))===-1?"grid":"grid3d":"heatmap"}}]),r}(zp);function HS(e){var i=WS();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function WS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var XS=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,YS=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,qS=function(e){(0,Pr.Z)(r,e);var i=HS(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"texture",void 0),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;return{u_opacity:s||1,u_texture:this.texture}}},{key:"initModels",value:function(){var a=this,s=this.layer.getLayerConfig(),f=s.mask,v=f===void 0?!1:f,m=s.maskInside,x=m===void 0?!0:m,A=this.layer.getSource(),T=this.rendererService.createTexture2D;if(this.texture=T({height:0,width:0}),Qi){var I=this.layerService.sceneService.getSceneConfig().canvas,F=I.createImage();F.crossOrigin="anonymous",F.src=A.data.originData,F.onload=function(){a.texture=T({data:F,width:F.width,height:F.height}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}else A.data.images.then(function(j){a.texture=T({data:j[0],width:j[0].width,height:j[0].height}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()});return[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:YS,fragmentShader:XS,triangulation:yy,primitive:k.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:Da(v,x)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Fn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(s,f,v,m){return[v[3],v[4]]}}})}}]),r}(Lo),KS={image:qS},$S=KS;function QS(e){var i=JS();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function JS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var eC=function(e){(0,Pr.Z)(r,e);var i=QS(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"type","ImageLayer"),n}return(0,Pt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new $S[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={image:{}};return s[a]}},{key:"getModelType",value:function(){return"image"}}]),r}(zp);function tC(e){var i=rC();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function rC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nC=`
uniform float u_opacity;

varying vec4 v_dash_array;
varying vec4 v_color;

uniform float segmentNumber;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity;

  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  }
  gl_FragColor.a *=flag;
  
  gl_FragColor = filterColor(gl_FragColor);
}`,iC=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;


uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  vec2 s = source;
  vec2 t = target;
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  

   styleMappingMat[3].b = segmentIndex / segmentNumber;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,aC=`
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  
  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = styleMappingMat[3].g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = styleMappingMat[3].a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);
}`,oC=`#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
     styleMappingMat[3].g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,sC=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}`,uC=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,lC={solid:0,dash:1},cC=function(e){(0,Pr.Z)(r,e);var i=tC(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"texture",void 0),(0,S.Z)((0,J.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:k.NEAREST,min:k.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=a.sourceColor,v=a.targetColor,m=a.textureBlend,x=m===void 0?"normal":m,A=a.lineType,T=A===void 0?"solid":A,I=a.dashArray,F=I===void 0?[10,5]:I,j=a.forward,X=j===void 0?!0:j,ee=a.lineTexture,be=ee===void 0?!1:ee,Fe=a.iconStep,We=Fe===void 0?100:Fe,et=a.segmentNumber,xt=et===void 0?30:et,Ct=a.thetaOffset,Yt=Ct===void 0?.314:Ct;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s,thetaOffset:Yt})){this.judgeStyleAttributes({opacity:s,thetaOffset:Yt});var ar=this.layer.getEncodedData(),Ar=this.calDataFrame(this.cellLength,ar,this.cellProperties),Qr=Ar.data,vr=Ar.width,pn=Ar.height;this.rowCount=pn,this.dataTexture=this.cellLength>0&&Qr.length>0?this.createTexture2D({flipY:!0,data:Qr,format:k.LUMINANCE,type:k.FLOAT,width:vr,height:pn}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}F.length===2&&F.push(0,0);var Tn=0,qn=[0,0,0,0],Ba=[0,0,0,0];return f&&v&&(qn=pi(f),Ba=pi(v),Tn=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:Oi()(Yt)?Yt:0,u_opacity:Oi()(s)?s:1,u_textureBlend:x==="normal"?0:1,segmentNumber:xt,u_line_type:lC[T||"solid"],u_dash_array:F,u_blur:.9,u_lineDir:X?1:-1,u_texture:this.texture,u_line_texture:be?1:0,u_icon_step:We,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Tn,u_sourceColor:qn,u_targetColor:Ba}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,f=a.targetColor,v=a.lineType;return v==="dash"?{frag:nC,vert:iC,type:"dash"}:s&&f?{frag:sC,vert:uC,type:"linear"}:{frag:aC,vert:oC,type:"normal"}}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,f=s===void 0?30:s,v=a.mask,m=v===void 0?!1:v,x=a.maskInside,A=x===void 0?!0:x,T=this.getShaders(),I=T.frag,F=T.vert,j=T.type;return[this.layer.buildLayerModel({moduleName:"arc2dline"+j,vertexShader:F,fragmentShader:I,triangulation:Xv,depth:{enable:!1},blend:this.getBlend(),segmentNumber:f,stencil:Da(m,A)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(f,v,m,x){var A=f.size,T=A===void 0?1:A;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Fn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:4,update:function(f,v,m,x){return[m[3],m[4],m[5],m[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Fn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(f,v,m,x){var A=a.iconService.getIconMap(),T=f.texture,I=A[T]||{x:0,y:0},F=I.x,j=I.y;return[F,j]}}})}}]),r}(Lo);function fC(e){var i=hC();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function hC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,dC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,vC=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;


uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,mC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,gC={solid:0,dash:1},yC=function(e){(0,Pr.Z)(r,e);var i=fC(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"texture",void 0),(0,S.Z)((0,J.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:k.NEAREST,min:k.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=a.sourceColor,v=a.targetColor,m=a.textureBlend,x=m===void 0?"normal":m,A=a.lineType,T=A===void 0?"solid":A,I=a.dashArray,F=I===void 0?[10,5]:I,j=a.lineTexture,X=j===void 0?!1:j,ee=a.iconStep,be=ee===void 0?100:ee,Fe=a.segmentNumber,We=Fe===void 0?30:Fe,et=a.globalArcHeight,xt=et===void 0?10:et;F.length===2&&F.push(0,0);var Ct=0,Yt=[0,0,0,0],ar=[0,0,0,0];if(f&&v&&(Yt=pi(f),ar=pi(v),Ct=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var Ar=this.layer.getEncodedData(),Qr=this.calDataFrame(this.cellLength,Ar,this.cellProperties),vr=Qr.data,pn=Qr.width,Tn=Qr.height;this.rowCount=Tn,this.dataTexture=this.cellLength>0&&vr.length>0?this.createTexture2D({flipY:!0,data:vr,format:k.LUMINANCE,type:k.FLOAT,width:pn,height:Tn}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:ry,u_global_height:xt,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Oi()(s)?s:1,u_textureBlend:x==="normal"?0:1,segmentNumber:We,u_line_type:gC[T]||0,u_dash_array:F,u_texture:this.texture,u_line_texture:X?1:0,u_icon_step:be,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Ct,u_sourceColor:Yt,u_targetColor:ar}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,f=a.targetColor,v=a.lineType;return s&&f?{frag:vC,vert:mC,type:"linear"}:{frag:pC,vert:dC,type:"normal"}}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,f=s===void 0?30:s,v=a.mask,m=v===void 0?!1:v,x=a.maskInside,A=x===void 0?!0:x,T=this.getShaders(),I=T.frag,F=T.vert,j=T.type;return[this.layer.buildLayerModel({moduleName:"arc3Dline"+j,vertexShader:F,fragmentShader:I,triangulation:Xv,blend:this.getBlend(),segmentNumber:f,stencil:Da(m,A)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(f,v,m,x){var A=f.size,T=A===void 0?1:A;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Fn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:4,update:function(f,v,m,x){return[m[3],m[4],m[5],m[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Fn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(f,v,m,x){var A=a.iconService.getIconMap(),T=f.texture,I=A[T]||{x:0,y:0},F=I.x,j=I.y;return[F,j]}}})}}]),r}(Lo);function _C(e){var i=xC();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function xC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bC=`#define LineTypeSolid 0.0
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
// varying vec2 v_normal;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float segmentNumber;
varying float v_distance_ratio;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
 
  gl_FragColor.a *= u_opacity;

  if(u_aimate.x == Animate) {
      float animateSpeed = u_time / u_aimate.y; // \u8FD0\u52A8\u901F\u5EA6
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }
}`,EC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

uniform float u_lineDir: 1.0;

// \u504F\u79FB\u91CF
uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = u_thetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  v_distance_ratio = segmentIndex / segmentNumber;
  
  if(u_aimate.x == Animate && u_lineDir != 1.0) {
      v_distance_ratio = 1.0 - v_distance_ratio;
  }

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
}
`,SC=function(e){(0,Pr.Z)(r,e);var i=_C(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=a.sourceColor,v=a.targetColor,m=a.forward,x=m===void 0?!0:m,A=a.segmentNumber,T=A===void 0?30:A,I=a.thetaOffset,F=I===void 0?.314:I,j=0,X=[0,0,0,0],ee=[0,0,0,0];return f&&v&&(X=pi(f),ee=pi(v),j=1),{u_thetaOffset:F,u_opacity:Oi()(s)?s:1,segmentNumber:T,u_blur:.9,u_lineDir:x?1:-1,u_linearColor:j,u_sourceColor:X,u_targetColor:ee}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,f=s===void 0?30:s;return[this.layer.buildLayerModel({moduleName:"arc2dminiline",vertexShader:EC,fragmentShader:bC,triangulation:Xv,depth:{enable:!1},blend:this.getBlend(),segmentNumber:f})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,f,v,m){var x=s.size,A=x===void 0?1:x;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Fn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:4,update:function(s,f,v,m){return[v[3],v[4],v[5],v[6]]}}})}}]),r}(Lo);function CC(e){var i=AC();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function AC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = styleMappingMat[3].g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,TC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  styleMappingMat[3].g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,MC={solid:0,dash:1},PC=function(e){(0,Pr.Z)(r,e);var i=CC(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"texture",void 0),(0,S.Z)((0,J.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:k.NEAREST,min:k.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=a.sourceColor,v=a.targetColor,m=a.textureBlend,x=m===void 0?"normal":m,A=a.lineType,T=A===void 0?"solid":A,I=a.dashArray,F=I===void 0?[10,5]:I,j=a.lineTexture,X=j===void 0?!1:j,ee=a.iconStep,be=ee===void 0?100:ee,Fe=a.segmentNumber,We=Fe===void 0?30:Fe;F.length===2&&F.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var et=0,xt=[0,0,0,0],Ct=[0,0,0,0];if(f&&v&&(xt=pi(f),Ct=pi(v),et=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var Yt=this.layer.getEncodedData(),ar=this.calDataFrame(this.cellLength,Yt,this.cellProperties),Ar=ar.data,Qr=ar.width,vr=ar.height;this.rowCount=vr,this.dataTexture=this.cellLength>0&&Ar.length>0?this.createTexture2D({flipY:!0,data:Ar,format:k.LUMINANCE,type:k.FLOAT,width:Qr,height:vr}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Oi()(s)?s:1,u_textureBlend:x==="normal"?0:1,segmentNumber:We,u_line_type:MC[T]||0,u_dash_array:F,u_texture:this.texture,u_line_texture:X?1:0,u_icon_step:be,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:et,u_sourceColor:xt,u_targetColor:Ct}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"greatcircleline",vertexShader:TC,fragmentShader:wC,triangulation:Xv,depth:{enable:!1},blend:this.getBlend(),stencil:Da(f,m)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(f,v,m,x){var A=f.size,T=A===void 0?1:A;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Fn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:4,update:function(f,v,m,x){return[m[3],m[4],m[5],m[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Fn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(f,v,m,x){var A=a.iconService.getIconMap(),T=f.texture,I=A[T]||{x:0,y:0},F=I.x,j=I.y;return[F,j]}}})}}]),r}(Lo);function OC(e){var i=IC();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function IC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var RC=`#define LineTypeSolid 0.0
uniform float u_opacity : 1.0;

varying vec4 v_color;

// dash
varying vec4 v_dash_array;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
 // dash line
 
  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  }
  gl_FragColor.a *=flag;

  gl_FragColor = filterColor(gl_FragColor);
}
`,kC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  vec2 offset = project_pixel(size.xy);

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = a_DistanceAndIndex.x / a_Total_Distance; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_DistanceAndIndex.x;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));
  } else {
    float lineHeight = a_Size.y;
 
    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,LC=`#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = styleMappingMat[3].a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth/2.0;

    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) {
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,Cy=`
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,DC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;

varying vec4 v_color;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"


varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,FC={solid:0,dash:1},Ay=function(e){(0,Pr.Z)(r,e);var i=OC(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"texture",void 0),(0,S.Z)((0,J.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:k.NEAREST,min:k.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=a.sourceColor,v=a.targetColor,m=a.textureBlend,x=m===void 0?"normal":m,A=a.lineType,T=A===void 0?"solid":A,I=a.dashArray,F=I===void 0?[10,5,0,0]:I,j=a.lineTexture,X=j===void 0?!1:j,ee=a.iconStep,be=ee===void 0?100:ee,Fe=a.vertexHeightScale,We=Fe===void 0?20:Fe,et=a.borderWidth,xt=et===void 0?0:et,Ct=a.borderColor,Yt=Ct===void 0?"#ccc":Ct,ar=a.raisingHeight,Ar=ar===void 0?0:ar,Qr=a.heightfixed,vr=Qr===void 0?!1:Qr,pn=a.arrow,Tn=pn===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:pn;F.length===2&&F.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var qn=0,Ba=[0,0,0,0],qo=[0,0,0,0];if(f&&v&&(Ba=pi(f),qo=pi(v),qn=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var Ls=this.layer.getEncodedData(),Ds=this.calDataFrame(this.cellLength,Ls,this.cellProperties),Ys=Ds.data,vf=Ds.width,E0=Ds.height;this.rowCount=E0,this.dataTexture=this.cellLength>0&&Ys.length>0?this.createTexture2D({flipY:!0,data:Ys,format:k.LUMINANCE,type:k.FLOAT,width:vf,height:E0}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Oi()(s)?s:1,u_textureBlend:x==="normal"?0:1,u_line_type:FC[T],u_dash_array:F,u_texture:this.texture,u_line_texture:X?1:0,u_icon_step:be,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:xt,u_borderColor:pi(Yt),u_linearColor:qn,u_sourceColor:Ba,u_targetColor:qo,u_heightfixed:Number(vr),u_vertexScale:We,u_raisingHeight:Number(Ar),u_arrow:Number(Tn.enable),u_arrowHeight:Tn.arrowHeight||3,u_arrowWidth:Tn.arrowWidth||2,u_tailWidth:Tn.tailWidth===void 0?1:Tn.tailWidth}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v,x=a.depth,A=x===void 0?!1:x,T=this.getShaders(),I=T.frag,F=T.vert,j=T.type;return[this.layer.buildLayerModel({moduleName:"line_"+j,vertexShader:F,fragmentShader:I,triangulation:dy,primitive:k.TRIANGLES,blend:this.getBlend(),depth:{enable:A},stencil:Da(f,m)})]}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,f=a.targetColor,v=a.lineType;return v==="dash"?{frag:RC,vert:kC,type:"dash"}:s&&f?{frag:DC,vert:Cy,type:"linear"}:{frag:LC,vert:Cy,type:"normal"}}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:Fn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(f,v,m,x,A,T){return T===void 0?[m[3],10]:[m[3],T]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Fn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(f,v,m,x){return[m[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(f,v,m,x){var A=f.size,T=A===void 0?1:A;return Array.isArray(T)?[T[0],T[1]]:[T,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Fn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(f,v,m,x,A){return A}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Fn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(f,v,m,x){return[m[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Fn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(f,v,m,x){var A=a.iconService.getIconMap(),T=f.texture,I=A[T]||{x:0,y:0},F=I.x,j=I.y;return[F,j]}}})}}]),r}(Lo);function BC(e){var i=NC();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function NC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zC=`

uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,UC=`
varying vec4 v_color;
varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,wy=`
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Position;


// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_vertexScale: 1.0;

#pragma include "projection"

varying vec4 v_color;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_color = a_Color;  

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
  }
}
`,ZC=function(e){(0,Pr.Z)(r,e);var i=BC(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=a.sourceColor,v=a.targetColor,m=a.vertexHeightScale,x=m===void 0?20:m,A=0,T=[0,0,0,0],I=[0,0,0,0];if(f&&v&&(T=pi(f),I=pi(v),A=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var F=this.layer.getEncodedData(),j=this.calDataFrame(this.cellLength,F,this.cellProperties),X=j.data,ee=j.width,be=j.height;this.rowCount=be,this.dataTexture=this.cellLength>0&&X.length>0?this.createTexture2D({flipY:!0,data:X,format:k.LUMINANCE,type:k.FLOAT,width:ee,height:be}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Oi()(s)?s:1,u_linearColor:A,u_sourceColor:T,u_targetColor:I,u_vertexScale:x}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,f=a.targetColor;return s&&f?{frag:zC,vert:wy,type:"linear"}:{frag:UC,vert:wy,type:"normal"}}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v,x=this.getShaders(),A=x.frag,T=x.vert,I=x.type;return[this.layer.buildLayerModel({moduleName:"simpleline"+I,vertexShader:T,fragmentShader:A,triangulation:tS,primitive:k.LINES,blend:this.getBlend(),depth:{enable:!1},stencil:Da(f,m)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:Fn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,f,v,m){return[v[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Fn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,f,v,m){return[v[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(s,f,v,m){var x=s.size,A=x===void 0?1:x;return Array.isArray(A)?[A[0],A[1]]:[A,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Fn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(s,f,v,m,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Fn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,f,v,m){return[v[4]]}}})}}]),r}(Lo);function jC(e){var i=VC();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function VC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var GC=`#define LineTypeSolid 0.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity : 1.0;
uniform float u_textureBlend;
uniform float u_iconStepCount;

varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

// dash
uniform float u_dash_offset : 0.0;
uniform float u_dash_ratio : 0.1;

varying vec2 v_iconMapUV;
varying float v_blur;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = styleMappingMat[3].a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);

    
  
  
}
`,HC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

varying vec4 v_color;
varying float v_blur;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "light"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    originSize = project_float_pixel(a_Size.x);
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);

  // v_lightWeight = lightWeight;
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);
  // v_color = a_Color;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,WC=function(e){(0,Pr.Z)(r,e);var i=jC(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"texture",void 0),(0,S.Z)((0,J.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:k.NEAREST,min:k.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=a.sourceColor,v=a.targetColor,m=a.textureBlend,x=m===void 0?"normal":m,A=a.heightfixed,T=A===void 0?!1:A,I=a.lineTexture,F=I===void 0?!1:I,j=a.iconStep,X=j===void 0?100:j,ee=a.iconStepCount,be=ee===void 0?1:ee;this.rendererService.getDirty()&&this.texture.bind();var Fe=0,We=[0,0,0,0],et=[0,0,0,0];if(f&&v&&(We=pi(f),et=pi(v),Fe=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var xt=this.layer.getEncodedData(),Ct=this.calDataFrame(this.cellLength,xt,this.cellProperties),Yt=Ct.data,ar=Ct.width,Ar=Ct.height;this.rowCount=Ar,this.dataTexture=this.cellLength>0&&Yt.length>0?this.createTexture2D({flipY:!0,data:Yt,format:k.LUMINANCE,type:k.FLOAT,width:ar,height:Ar}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_heightfixed:Number(T),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Oi()(s)?s:1,u_textureBlend:x==="normal"?0:1,u_texture:this.texture,u_line_texture:F?1:0,u_iconStepCount:be,u_icon_step:X,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Fe,u_sourceColor:We,u_targetColor:et}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"linewall",vertexShader:HC,fragmentShader:GC,triangulation:dy,primitive:k.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:Fn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(f,v,m,x){return[m[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Fn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(f,v,m,x){return[m[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(f,v,m,x){var A=f.size,T=A===void 0?1:A;return Array.isArray(T)?[T[0],T[1]]:[T,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Fn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(f,v,m,x,A){return A}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Fn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(f,v,m,x){return[m[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Fn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(f,v,m,x){var A=a.iconService.getIconMap(),T=f.texture,I=A[T]||{x:0,y:0},F=I.x,j=I.y;return[F,j]}}})}}]),r}(Lo),XC={arc:cC,arcmini:SC,arc3d:yC,greatcircle:PC,wall:WC,line:Ay,simple:ZC},YC=XC;function qC(e){var i=KC();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function KC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $C=function(e){(0,Pr.Z)(r,e);var i=qC(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"type","LineLayer"),n}return(0,Pt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new YC[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={line:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},arcmini:{blend:"additive"},greatcircle:{blend:"additive"}};return s[a]}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),f=s==null||(a=s.scale)===null||a===void 0?void 0:a.field;return f||"line"}}]),r}(zp);function QC(e){var i=JC();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function JC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var eA=`varying vec4 v_color;
uniform float u_opacity: 1.0;

varying float v_z;
varying float v_lightWeight;
uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_z);
    gl_FragColor.rgb *= v_lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_z): v_z;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, v_lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,tA=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

varying float v_z;
varying float v_lightWeight;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  v_z = a_Position.z;

 

  // vec2 offset = project_pixel(size.xy);
  // vec2 offset = (size.xy);

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    // offset = project_pixel(offset);
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // vec4 pos = vec4(project_pos.xy + offset, project_pixel(size.z) * u_r, 1.0);
  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  // float lightWeight = u_lightEnable > 0.0 ? calc_lighting(pos): 1.0;
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  v_lightWeight = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  
  if(u_globel > 0.0) {
    // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
    //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
    float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
    float xRadian = getXRadian(a_Pos.y, r);
    float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 mx = mat4(
      1,0,0,0,  
      0,xcos,-xsin,0,  
      0,xsin,xcos,0,  
      0,0,0,1);

    //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
    float yRadian = getYRadian(a_Pos.x, a_Pos.z);
    float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 my = mat4(
      ycos,0,-ysin,0,  
      0,1,0,0,  
      ysin,0,ycos,0,  
      0,0,0,1);

    gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  }

  setPickingColor(a_PickingColor);
}
`,Ty=function(e){(0,Pr.Z)(r,e);var i=QC(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"raiseCount",0),(0,S.Z)((0,J.Z)(n),"raiserepeat",0),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,f=s===void 0?{enable:!1,speed:.01,repeat:!1}:s,v=a.opacity,m=v===void 0?1:v,x=a.sourceColor,A=a.targetColor,T=a.pickLight,I=T===void 0?!1:T,F=a.heightfixed,j=F===void 0?!1:F,X=a.opacityLinear,ee=X===void 0?{enable:!1,dir:"up"}:X,be=a.lightEnable,Fe=be===void 0?!0:be;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:m})){this.judgeStyleAttributes({opacity:m});var We=this.layer.getEncodedData(),et=this.calDataFrame(this.cellLength,We,this.cellProperties),xt=et.data,Ct=et.width,Yt=et.height;this.rowCount=Yt,this.dataTexture=this.cellLength>0&&xt.length>0?this.createTexture2D({flipY:!0,data:xt,format:k.LUMINANCE,type:k.FLOAT,width:Ct,height:Yt}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}var ar=0,Ar=[0,0,0,0],Qr=[0,0,0,0];if(x&&A&&(Ar=pi(x),Qr=pi(A),ar=1),this.raiseCount<1&&this.raiserepeat>0&&f.enable){var vr=f.speed,pn=vr===void 0?.01:vr,Tn=f.repeat,qn=Tn===void 0?!1:Tn;this.raiseCount+=pn,this.raiseCount>=1&&(this.raiserepeat>1?(this.raiseCount=0,this.raiserepeat--):this.raiseCount=1)}return{u_pickLight:Number(I),u_heightfixed:Number(j),u_r:f.enable&&this.raiserepeat>0?this.raiseCount:1,u_globel:this.mapService.version==="GLOBEL"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Oi()(m)?m:1,u_linearColor:ar,u_sourceColor:Ar,u_targetColor:Qr,u_opacitylinear:Number(ee.enable),u_opacitylinear_dir:ee.dir==="up"?1:0,u_lightEnable:Number(Fe)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.depth,f=s===void 0?!0:s,v=a.animateOption.repeat,m=v===void 0?1:v;return this.raiserepeat=m,[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:tA,fragmentShader:eA,triangulation:hy,blend:this.getBlend(),cull:{enable:!0,face:Vl(this.mapService.version)},depth:{enable:f}})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(f,v,m,x){var A=f.size;if(A){var T=[];return Array.isArray(A)&&(T=A.length===2?[A[0],A[0],A[1]]:A),Array.isArray(A)||(T=[A,A,A]),T}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Fn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(f,v,m,x,A){return A}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Fn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(f,v){var m=Up(f.coordinates);return a?iy([m[0],m[1]]):[m[0],m[1],0]}}})}}]),r}(Lo);function rA(e){var i=nA();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function nA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var My=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  
  outer_df = sdCircle(v_data.xy, 1.0);
  inner_df = sdCircle(v_data.xy, r);


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

 gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  float d = length(v_data.xy);
  if(d > 0.5) {
    discard;
  }
  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
  
  // TODO: \u6839\u636E\u53E0\u52A0\u6A21\u5F0F\u9009\u62E9\u6548\u679C
  if(u_additive > 0.0) {
    gl_FragColor *= intensity;
    // TODO: \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,iA=`
uniform float u_globel;
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(u_globel > 0.0) {
    // TODO: \u5730\u7403\u6A21\u5F0F\u4E0B\u907F\u514D\u591A\u4F59\u7247\u5143\u7ED8\u5236\uFF0C\u540C\u65F6\u4E5F\u80FD\u907F\u514D\u6709\u7528\u7247\u5143\u5728\u900F\u660E\u4E14\u91CD\u53E0\u7684\u60C5\u51B5\u4E0B\u65E0\u6CD5\u5199\u5165
    // \u4ED8\u51FA\u7684\u4EE3\u4EF7\u662F\u8FB9\u7F18\u4F1A\u6709\u4E00\u4E9B\u952F\u9F7F
    if(outer_df > antialiasblur + 0.018) discard;
  }
  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,V0=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;
uniform float u_raisingHeight: 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raiseHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, u_raisingHeight, 1.0));
  }

  if(u_globel > 0.0) {
    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,Py=function(e){(0,Pr.Z)(r,e);var i=rA(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"meter2coord",1),(0,S.Z)((0,J.Z)(n),"isMeter",!1),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.strokeOpacity,m=v===void 0?1:v,x=a.strokeWidth,A=x===void 0?0:x,T=a.stroke,I=T===void 0?"rgba(0,0,0,0)":T,F=a.offsets,j=F===void 0?[0,0]:F,X=a.blend,ee=a.blur,be=ee===void 0?0:ee,Fe=a.raisingHeight,We=Fe===void 0?0:Fe;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,strokeOpacity:m,strokeWidth:A,stroke:I,offsets:j})){this.judgeStyleAttributes({opacity:f,strokeOpacity:m,strokeWidth:A,stroke:I,offsets:j});var et=this.layer.getEncodedData(),xt=this.calDataFrame(this.cellLength,et,this.cellProperties),Ct=xt.data,Yt=xt.width,ar=xt.height;this.rowCount=ar,this.dataTexture=this.cellLength>0&&Ct.length>0?this.createTexture2D({flipY:!0,data:Ct,format:k.LUMINANCE,type:k.FLOAT,width:Yt,height:ar}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(We),u_isMeter:Number(this.isMeter),u_blur:be,u_additive:X==="additive"?1:0,u_globel:this.mapService.version===ks.GLOBEL?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Oi()(f)?f:1,u_stroke_opacity:Oi()(m)?m:1,u_stroke_width:Oi()(A)?A:0,u_stroke_color:this.getStrokeColor(I),u_offsets:this.isOffsetStatic(j)?j:[0,0]}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,f=s===void 0?{enable:!1}:s;return{u_aimate:this.animateOption2Array(f),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),bd)}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.unit,f=s===void 0?"l7size":s,v=this.mapService.version;return f==="meter"&&v!==ks.L7MAP&&v!==ks.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,dn.Z)(this.layer.getSource().extent,4),s=a[0],f=a[1],v=a[2],m=a[3],x=[(s+v)/2,(f+m)/2],A=this.mapService.version;if(A===ks.MAPBOX&&window.mapboxgl.MercatorCoordinate){var T=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:x[0],lat:x[1]},0),I=1,F=I*T.meterInMercatorCoordinateUnits(),j=new window.mapboxgl.MercatorCoordinate(T.x-F,T.y,T.z),X=j.toLngLat();this.meter2coord=x[0]-X.lng;return}var ee=this.mapService.meterToCoord(x,[s,f]),be=this.mapService.meterToCoord(x,[v===s?v+.1:v,m===f?f+.1:m]);this.meter2coord=(ee+be)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v,x=a.animateOption,A=x===void 0?{enable:!1}:x,T=this.getShaders(A),I=T.frag,F=T.vert,j=T.type,X=this.mapService.version==="GLOBEL";return[this.layer.buildLayerModel({moduleName:"pointfill_"+j,vertexShader:F,fragmentShader:I,triangulation:X?eS:bd,depth:{enable:X},blend:this.getBlend(),stencil:Da(f,m),cull:{enable:!0,face:Vl(this.mapService.version)}})]}},{key:"getShaders",value:function(a){if(a.enable)switch(a.type){case"wave":return{frag:My,vert:V0,type:"wave"};default:return{frag:My,vert:V0,type:"wave"}}else return{frag:iA,vert:V0,type:"normal"}}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"animateOption2Array",value:function(a){return[a.enable?0:1,a.speed||1,a.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var a=this,s=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Fn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(v,m,x,A){var T;if(s){var I=(0,dn.Z)(x,3),F=I[0],j=I[1],X=I[2],ee=Ya.fromValues(0,0,1),be=Ya.fromValues(F,0,X),Fe=F>=0?Ya.angle(ee,be):Math.PI*2-Ya.angle(ee,be),We=Math.PI*2-Math.asin(j/100),et=qi();sf(et,et,Fe),fh(et,et,We);var xt=Ya.fromValues(1,1,0);Ya.transformMat4(xt,xt,et),Ya.normalize(xt,xt);var Ct=Ya.fromValues(-1,1,0);Ya.transformMat4(Ct,Ct,et),Ya.normalize(Ct,Ct);var Yt=Ya.fromValues(-1,-1,0);Ya.transformMat4(Yt,Yt,et),Ya.normalize(Yt,Yt);var ar=Ya.fromValues(1,-1,0);Ya.transformMat4(ar,ar,et),Ya.normalize(ar,ar),T=[].concat((0,Se.Z)(xt),(0,Se.Z)(Ct),(0,Se.Z)(Yt),(0,Se.Z)(ar))}else T=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var Ar=A%4*3;return[T[Ar],T[Ar+1],T[Ar+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(v,m,x,A){var T=v.size,I=T===void 0?5:T;return Array.isArray(I)?[I[0]*a.meter2coord]:[I*a.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Fn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(v,m,x,A){var T=v.shape,I=T===void 0?2:T,F=a.layer.getLayerConfig().shape2d,j=F.indexOf(I);return[j]}}})}}]),r}(Lo);function aA(e){var i=oA();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function oA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sA=`uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv;

void main() {

  float opacity = styleMappingMat[0][0];

  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  gl_FragColor = texture2D(u_texture, pos);
  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,uA=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute vec2 a_Uv;
attribute float a_Rotate;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform mat2 u_RotateMatrix;
uniform float u_isMeter;

varying float v_radius;
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv; // icon \u8D34\u56FE\u7684 uv \u5750\u6807

uniform float u_opacity : 1;
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;

  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // radius(16-bit)
  v_radius = a_Size;

  // TODO: billboard
  // anti-alias
  

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);

  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (rotation_matrix * u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,lA=function(e){(0,Pr.Z)(r,e);var i=aA(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"meter2coord",1),(0,S.Z)((0,J.Z)(n),"texture",void 0),(0,S.Z)((0,J.Z)(n),"isMeter",!1),(0,S.Z)((0,J.Z)(n),"radian",0),(0,S.Z)((0,J.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layer.renderLayers();return}n.texture=v({data:n.iconService.getCanvas(),mag:k.LINEAR,min:k.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.strokeOpacity,m=v===void 0?1:v,x=a.strokeWidth,A=x===void 0?0:x,T=a.stroke,I=T===void 0?"rgba(0,0,0,0)":T,F=a.offsets,j=F===void 0?[0,0]:F,X=a.blend,ee=a.rotation;this.rendererService.getDirty()&&this.texture.bind();var be=1;if((this.mapService.version==="GAODE2.x"||this.mapService.version==="GAODE1.x")&&(be=-1),this.radian=ee!==void 0?be*Math.PI*ee/180:be*Math.PI*(this.mapService.getRotation()%360)/180,this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,strokeOpacity:m,strokeWidth:A,stroke:I,offsets:j})){this.judgeStyleAttributes({opacity:f,strokeOpacity:m,strokeWidth:A,stroke:I,offsets:j});var Fe=this.layer.getEncodedData(),We=this.calDataFrame(this.cellLength,Fe,this.cellProperties),et=We.data,xt=We.width,Ct=We.height;this.rowCount=Ct,this.dataTexture=this.cellLength>0&&et.length>0?this.createTexture2D({flipY:!0,data:et,format:k.LUMINANCE,type:k.FLOAT,width:xt,height:Ct}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_additive:X==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:Oi()(f)?f:1,u_offsets:this.isOffsetStatic(j)?j:[0,0]}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),bd)}},{key:"initModels",value:function(){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture);var a=this.layer.getLayerConfig(),s=a.unit,f=s===void 0?"l7size":s,v=this.mapService.version;return f==="meter"&&v!==ks.L7MAP&&v!==ks.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,dn.Z)(this.layer.getSource().extent,4),s=a[0],f=a[1],v=a[2],m=a[3],x=[(s+v)/2,(f+m)/2],A=this.mapService.version;if(A===ks.MAPBOX&&window.mapboxgl.MercatorCoordinate){var T=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:x[0],lat:x[1]},0),I=1,F=I*T.meterInMercatorCoordinateUnits(),j=new window.mapboxgl.MercatorCoordinate(T.x-F,T.y,T.z),X=j.toLngLat();this.meter2coord=x[0]-X.lng;return}var ee=this.mapService.meterToCoord(x,[s,f]),be=this.mapService.meterToCoord(x,[v===s?v+.1:v,m===f?f+.1:m]);this.meter2coord=(ee+be)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v,x=this.getShaders(),A=x.frag,T=x.vert,I=x.type;return[this.layer.buildLayerModel({moduleName:"pointfill_"+I,vertexShader:T,fragmentShader:A,triangulation:bd,depth:{enable:!1},blend:this.getBlend(),stencil:Da(f,m),cull:{enable:!0,face:Vl(this.mapService.version)}})]}},{key:"getShaders",value:function(){return{frag:sA,vert:uA,type:"normal"}}},{key:"clearModels",value:function(){var a,s;this.iconService.off("imageUpdate",this.updateTexture),(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"rotate",type:Fn.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(f,v,m,x){var A=f.rotate,T=A===void 0?0:A;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Fn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(f,v,m,x){var A=a.iconService.getIconMap(),T=f.shape,I=A[T]||{x:0,y:0},F=I.x,j=I.y;return[F,j]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Fn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(f,v,m,x){var A=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],T=x%4*3;return[A[T],A[T+1],A[T+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(f,v,m,x){var A=f.size,T=A===void 0?5:A;return Array.isArray(T)?[T[0]*a.meter2coord]:[T*a.meter2coord]}}})}}]),r}(Lo);function cA(e){var i=fA();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function fA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hA=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,pA=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,dA=function(e){(0,Pr.Z)(r,e);var i=cA(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"texture",void 0),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;return{u_opacity:s||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var a=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){a.updateTexture(),a.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:pA,fragmentShader:hA,triangulation:py,primitive:k.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(f,v,m,x){var A=f.size;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Fn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(f,v,m,x){var A=a.fontService.mapping,T=f.shape,I=a.fontService.getGlyph(T),F=A[I],j=F.x,X=F.y;return[j,X]}}})}},{key:"updateTexture",value:function(){var a=this.rendererService.createTexture2D,s=this.fontService.canvas;this.texture=a({data:s,mag:k.LINEAR,min:k.LINEAR,width:s.width,height:s.height})}},{key:"initIconFontGlyphs",value:function(){var a=this,s=this.layer.getLayerConfig(),f=s.fontWeight,v=f===void 0?"normal":f,m=s.fontFamily,x=m===void 0?"sans-serif":m,A=this.layer.getEncodedData(),T=[];A.forEach(function(I){var F=I.shape,j=F===void 0?"":F;j=j.toString();var X=a.fontService.getGlyph(j);T.indexOf(X)===-1&&T.push(X)}),this.fontService.setFontOptions({characterSet:T,fontWeight:v,fontFamily:x,fontSize:48})}}]),r}(Lo);function vA(e){var i=mA();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function mA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gA=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,yA=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,Oy=function(e){(0,Pr.Z)(r,e);var i=vA(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"texture",void 0),(0,S.Z)((0,J.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layer.renderLayers();return}n.texture=v({data:n.iconService.getCanvas(),mag:k.LINEAR,min:k.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=a.offsets,v=f===void 0?[0,0]:f;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s,offsets:v})){this.judgeStyleAttributes({opacity:s,offsets:v});var m=this.layer.getEncodedData(),x=this.calDataFrame(this.cellLength,m,this.cellProperties),A=x.data,T=x.width,I=x.height;this.rowCount=I,this.dataTexture=this.cellLength>0&&A.length>0?this.createTexture2D({flipY:!0,data:A,format:k.LUMINANCE,type:k.FLOAT,width:T,height:I}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:Oi()(s)?s:1,u_offsets:this.isOffsetStatic(v)?v:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:yA,fragmentShader:gA,triangulation:py,primitive:k.POINTS,depth:{enable:!1},blend:this.getBlend(),stencil:Da(f,m)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(f,v,m,x){var A=f.size,T=A===void 0?5:A;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Fn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(f,v,m,x){var A=a.iconService.getIconMap(),T=f.shape,I=A[T]||{x:0,y:0},F=I.x,j=I.y;return[F,j]}}})}}]),r}(Lo);function _A(e){var i=xA();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function xA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bA=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,EA=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function SA(e){var i=e.coordinates;return{vertices:(0,Se.Z)(i),indices:[0],size:i.length}}var Iy=function(e){(0,Pr.Z)(r,e);var i=_A(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.offsets,m=v===void 0?[0,0]:v;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,offsets:m})){this.judgeStyleAttributes({opacity:f,offsets:m});var x=this.layer.getEncodedData(),A=this.calDataFrame(this.cellLength,x,this.cellProperties),T=A.data,I=A.width,F=A.height;this.rowCount=F,this.dataTexture=this.cellLength>0&&T.length>0?this.createTexture2D({flipY:!0,data:T,format:k.LUMINANCE,type:k.FLOAT,width:I,height:F}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Oi()(f)?f:1,u_offsets:this.isOffsetStatic(m)?m:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:EA,fragmentShader:bA,triangulation:SA,depth:{enable:!1},primitive:k.POINTS,blend:this.getBlend(),stencil:Da(f,m)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,f,v,m){var x=s.size,A=x===void 0?1:x;return Array.isArray(A)?[A[0]]:[A]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:Ws.additive}}}]),r}(Lo);function CA(e){var i=AA();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function AA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wA=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }

  vec2 extrude =  styleMappingMat[2].ba;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  // full circle
  // float rades = dot(dir, baseDir);
  // float flag = sign(dir.y);
  // float radar_v = (flag - 1.0) * -0.5 + flag * acos(rades)/pi/2.0;
  
  // half circle
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }



  gl_FragColor.a *= radar_v;
}
`,TA=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;
uniform float u_speed: 1.0;
uniform float u_time;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - a_Extrude.x - a_Extrude.y
    0.0, 0.0, 0.0, 0.0  // 
  );

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  styleMappingMat[2].ba = rotateMatrix * a_Extrude.xy;

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> empty -> empty ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;


  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  v_data = vec4(extrude.x, extrude.y, antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  if(u_globel > 0.0) {
    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);
  }

  setPickingColor(a_PickingColor);
}
`,MA=function(e){(0,Pr.Z)(r,e);var i=CA(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"meter2coord",1),(0,S.Z)((0,J.Z)(n),"isMeter",!1),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.strokeOpacity,m=v===void 0?1:v,x=a.strokeWidth,A=x===void 0?0:x,T=a.stroke,I=T===void 0?"rgba(0,0,0,0)":T,F=a.offsets,j=F===void 0?[0,0]:F,X=a.blend,ee=a.speed,be=ee===void 0?1:ee;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,strokeOpacity:m,strokeWidth:A,stroke:I,offsets:j})){this.judgeStyleAttributes({opacity:f,strokeOpacity:m,strokeWidth:A,stroke:I,offsets:j});var Fe=this.layer.getEncodedData(),We=this.calDataFrame(this.cellLength,Fe,this.cellProperties),et=We.data,xt=We.width,Ct=We.height;this.rowCount=Ct,this.dataTexture=this.cellLength>0&&et.length>0?this.createTexture2D({flipY:!0,data:et,format:k.LUMINANCE,type:k.FLOAT,width:xt,height:Ct}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_speed:be,u_additive:X==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Oi()(f)?f:1,u_offsets:this.isOffsetStatic(j)?j:[0,0]}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,f=s===void 0?{enable:!1}:s;return{u_aimate:this.animateOption2Array(f),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),bd)}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.unit,f=s===void 0?"l7size":s,v=this.mapService.version;return f==="meter"&&v!==ks.L7MAP&&v!==ks.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,dn.Z)(this.layer.getSource().extent,4),s=a[0],f=a[1],v=a[2],m=a[3],x=[(s+v)/2,(f+m)/2],A=this.mapService.version;if(A===ks.MAPBOX&&window.mapboxgl.MercatorCoordinate){var T=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:x[0],lat:x[1]},0),I=1,F=I*T.meterInMercatorCoordinateUnits(),j=new window.mapboxgl.MercatorCoordinate(T.x-F,T.y,T.z),X=j.toLngLat();this.meter2coord=x[0]-X.lng;return}var ee=this.mapService.meterToCoord(x,[s,f]),be=this.mapService.meterToCoord(x,[v===s?v+.1:v,m===f?f+.1:m]);this.meter2coord=(ee+be)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v,x=this.getShaders(),A=x.frag,T=x.vert,I=x.type;return[this.layer.buildLayerModel({moduleName:"pointfill_"+I,vertexShader:T,fragmentShader:A,triangulation:bd,depth:{enable:!1},blend:this.getBlend(),stencil:Da(f,m),cull:{enable:!0,face:Vl(this.mapService.version)}})]}},{key:"getShaders",value:function(){return{frag:wA,vert:TA,type:"radar"}}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"animateOption2Array",value:function(a){return[a.enable?0:1,a.speed||1,a.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Fn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(f,v,m,x){var A;A=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var T=x%4*3;return[A[T],A[T+1],A[T+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(f,v,m,x){var A=f.size,T=A===void 0?5:A;return Array.isArray(T)?[T[0]*a.meter2coord]:[T*a.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Fn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(f,v,m,x){var A=f.shape,T=A===void 0?2:A,I=a.layer.getLayerConfig().shape2d,F=I.indexOf(T);return[F]}}})}}]),r}(Lo);function PA(e){var i=OA();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function OA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var IA=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_additive;

uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  float opacity = styleMappingMat[0][0];
  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);

  

  
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,RA=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143
varying float v_blur;
varying float v_innerRadius;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function kA(e){var i=e.coordinates;return{vertices:(0,Se.Z)(i),indices:[0],size:i.length}}var LA=function(e){(0,Pr.Z)(r,e);var i=PA(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.offsets,m=v===void 0?[0,0]:v,x=a.blend,A=a.strokeOpacity,T=A===void 0?1:A,I=a.strokeWidth,F=I===void 0?0:I,j=a.stroke,X=j===void 0?"#fff":j;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,offsets:m})){this.judgeStyleAttributes({opacity:f,offsets:m});var ee=this.layer.getEncodedData(),be=this.calDataFrame(this.cellLength,ee,this.cellProperties),Fe=be.data,We=be.width,et=be.height;this.rowCount=et,this.dataTexture=this.cellLength>0&&Fe.length>0?this.createTexture2D({flipY:!0,data:Fe,format:k.LUMINANCE,type:k.FLOAT,width:We,height:et}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_additive:x==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Oi()(f)?f:1,u_offsets:this.isOffsetStatic(m)?m:[0,0],u_stroke_opacity:Oi()(T)?T:1,u_stroke_width:Oi()(F)?F:0,u_stroke_color:this.getStrokeColor(X)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"simplepoint",vertexShader:RA,fragmentShader:IA,triangulation:kA,depth:{enable:!1},primitive:k.POINTS,blend:this.getBlend(),stencil:Da(f,m)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,f,v,m){var x=s.size,A=x===void 0?1:x;return Array.isArray(A)?[A[0]]:[A]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:Ws.additive}}}]),r}(Lo);function DA(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=FA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function FA(e,i){if(!!e){if(typeof e=="string")return Ry(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ry(e,i)}}function Ry(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var BA=function(){function e(i,r,n){(0,ht.Z)(this,e),(0,S.Z)(this,"boxCells",[]),(0,S.Z)(this,"xCellCount",void 0),(0,S.Z)(this,"yCellCount",void 0),(0,S.Z)(this,"boxKeys",void 0),(0,S.Z)(this,"bboxes",void 0),(0,S.Z)(this,"width",void 0),(0,S.Z)(this,"height",void 0),(0,S.Z)(this,"xScale",void 0),(0,S.Z)(this,"yScale",void 0),(0,S.Z)(this,"boxUid",void 0);var a=this.boxCells;this.xCellCount=Math.ceil(i/n),this.yCellCount=Math.ceil(r/n);for(var s=0;s<this.xCellCount*this.yCellCount;s++)a.push([]);this.boxKeys=[],this.bboxes=[],this.width=i,this.height=r,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/r,this.boxUid=0}return(0,Pt.Z)(e,[{key:"insert",value:function(r,n,a,s,f){this.forEachCell(n,a,s,f,this.insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(s),this.bboxes.push(f)}},{key:"query",value:function(r,n,a,s,f){return this.queryHitTest(r,n,a,s,!1,f)}},{key:"hitTest",value:function(r,n,a,s,f){return this.queryHitTest(r,n,a,s,!0,f)}},{key:"insertBoxCell",value:function(r,n,a,s,f,v){this.boxCells[f].push(v)}},{key:"queryHitTest",value:function(r,n,a,s,f,v){if(a<0||r>this.width||s<0||n>this.height)return f?!1:[];var m=[];if(r<=0&&n<=0&&this.width<=a&&this.height<=s){if(f)return!0;for(var x=0;x<this.boxKeys.length;x++)m.push({key:this.boxKeys[x],x1:this.bboxes[x*4],y1:this.bboxes[x*4+1],x2:this.bboxes[x*4+2],y2:this.bboxes[x*4+3]});return v?m.filter(v):m}var A={hitTest:f,seenUids:{box:{},circle:{}}};return this.forEachCell(r,n,a,s,this.queryCell,m,A,v),f?m.length>0:m}},{key:"queryCell",value:function(r,n,a,s,f,v,m,x){var A=m.seenUids,T=this.boxCells[f];if(T!==null){var I=this.bboxes,F=DA(T),j;try{for(F.s();!(j=F.n()).done;){var X=j.value;if(!A.box[X]){A.box[X]=!0;var ee=X*4;if(r<=I[ee+2]&&n<=I[ee+3]&&a>=I[ee+0]&&s>=I[ee+1]&&(!x||x(this.boxKeys[X]))){if(m.hitTest)return v.push(!0),!0;v.push({key:this.boxKeys[X],x1:I[ee],y1:I[ee+1],x2:I[ee+2],y2:I[ee+3]})}}}}catch(be){F.e(be)}finally{F.f()}}return!1}},{key:"forEachCell",value:function(r,n,a,s,f,v,m,x){for(var A=this.convertToXCellCoord(r),T=this.convertToYCellCoord(n),I=this.convertToXCellCoord(a),F=this.convertToYCellCoord(s),j=A;j<=I;j++)for(var X=T;X<=F;X++){var ee=this.xCellCount*X+j;if(f.call(this,r,n,a,s,ee,v,m,x))return}}},{key:"convertToXCellCoord",value:function(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}},{key:"convertToYCellCoord",value:function(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}}]),e}(),NA=BA,zA=function(){function e(i,r){(0,ht.Z)(this,e),(0,S.Z)(this,"width",void 0),(0,S.Z)(this,"height",void 0),(0,S.Z)(this,"grid",void 0),(0,S.Z)(this,"viewportPadding",100),(0,S.Z)(this,"screenRightBoundary",void 0),(0,S.Z)(this,"screenBottomBoundary",void 0),(0,S.Z)(this,"gridRightBoundary",void 0),(0,S.Z)(this,"gridBottomBoundary",void 0),this.width=i,this.height=r,this.viewportPadding=Math.max(i,r),this.grid=new NA(i+this.viewportPadding,r+this.viewportPadding,25),this.screenRightBoundary=i+this.viewportPadding,this.screenBottomBoundary=r+this.viewportPadding,this.gridRightBoundary=i+2*this.viewportPadding,this.gridBottomBoundary=r+2*this.viewportPadding}return(0,Pt.Z)(e,[{key:"placeCollisionBox",value:function(r){var n=r.x1+r.anchorPointX+this.viewportPadding,a=r.y1+r.anchorPointY+this.viewportPadding,s=r.x2+r.anchorPointX+this.viewportPadding,f=r.y2+r.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,a,s,f)||this.grid.hitTest(n,a,s,f)?{box:[]}:{box:[n,a,s,f]}}},{key:"insertCollisionBox",value:function(r,n){var a={featureIndex:n};this.grid.insert(a,r[0],r[1],r[2],r[3])}},{key:"project",value:function(r,n,a){var s=St(n,a,0,1),f=we(),v=js.apply(Ce,(0,Se.Z)(r));return ln(f,s,v),{x:(f[0]/f[3]+1)/2*this.width+this.viewportPadding,y:(-f[1]/f[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(r,n,a,s){return a>=0&&r<this.gridRightBoundary&&s>=0&&n<this.gridBottomBoundary}}]),e}();function ky(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=UA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function UA(e,i){if(!!e){if(typeof e=="string")return Ly(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ly(e,i)}}function Ly(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Dy(e){var i=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0;break;default:i=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0;break;default:r=.5}return{horizontalAlign:i,verticalAlign:r}}function Fy(e,i,r,n,a){if(!!a){var s=e[n],f=s.glyph;if(f)for(var v=i[f].advance*s.scale,m=(e[n].x+v)*a,x=r;x<=n;x++)e[x].x-=m}}function By(e,i,r,n,a,s,f){var v=(i-r)*a,m=(-n*f+.5)*s,x=ky(e),A;try{for(x.s();!(A=x.n()).done;){var T=A.value;T.x+=v,T.y+=m}}catch(I){x.e(I)}finally{x.f()}}function ZA(e,i,r,n,a,s,f){var v=-8,m=0,x=v,A=0,T=e.positionedGlyphs,I=s==="right"?1:s==="left"?0:.5,F=T.length;r.forEach(function(Fe){if(Fe.split("").forEach(function(et){var xt=i[et],Ct=0;xt&&(T.push({glyph:et,x:m,y:x+Ct,vertical:!1,scale:1,metrics:xt}),m+=xt.advance+f)}),T.length!==F){var We=m-f;A=Math.max(We,A),Fy(T,i,F,T.length-1,I)}m=0,x-=n+5});var j=Dy(a),X=j.horizontalAlign,ee=j.verticalAlign;By(T,I,X,ee,A,n,r.length);var be=x-v;e.top+=-ee*be,e.bottom=e.top-be,e.left+=-X*A,e.right=e.left+A}function jA(e,i,r,n,a,s,f){var v=-8,m=0,x=v,A=0,T=e.positionedGlyphs,I=s==="right"?1:s==="left"?0:.5,F=T.length;r.forEach(function(Fe){var We=i[Fe],et=0;if(We&&(T.push({glyph:Fe,x:We.advance/2,y:x+et,vertical:!1,scale:1,metrics:We}),m+=We.advance+f),T.length!==F){var xt=m-f;A=Math.max(xt,A),Fy(T,i,F,T.length-1,I)}m=0,x-=n+5});var j=Dy(a),X=j.horizontalAlign,ee=j.verticalAlign;By(T,I,X,ee,A,n,r.length);var be=x-v;e.top+=-ee*be,e.bottom=e.top-be,e.left+=-X*A,e.right=e.left+A}function VA(e,i,r,n,a,s){var f=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],v=arguments.length>7?arguments[7]:void 0,m=e.split(`
`),x=[],A={positionedGlyphs:x,top:f[1],bottom:f[1],left:f[0],right:f[0],lineCount:m.length,text:e};return v?jA(A,i,m,r,n,a,s):ZA(A,i,m,r,n,a,s),x.length?A:!1}function GA(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,n=e.positionedGlyphs,a=n===void 0?[]:n,s=[],f=ky(a),v;try{for(f.s();!(v=f.n()).done;){var m=v.value,x=m.metrics,A=4,T=x.advance*m.scale/2,I=r?[m.x+T,m.y]:[0,0],F=r?[0,0]:[m.x+T+i[0],m.y+i[1]],j=(0-A)*m.scale-T+F[0],X=(0-A)*m.scale+F[1],ee=j+x.width*m.scale,be=X+x.height*m.scale,Fe={x:j,y:X},We={x:ee,y:X},et={x:j,y:be},xt={x:ee,y:be};s.push({tl:Fe,tr:We,bl:et,br:xt,tex:x,glyphOffset:I})}}catch(Ct){f.e(Ct)}finally{f.f()}return s}function HA(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=WA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function WA(e,i){if(!!e){if(typeof e=="string")return Ny(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ny(e,i)}}function Ny(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function XA(e){var i=YA();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function YA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zy=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Uy=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_raisingHeight: 0.0;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function Zy(e){var i=this,r=e.id,n=[],a=[];if(!i.glyphInfoMap||!i.glyphInfoMap[r])return{vertices:[],indices:[],size:7};var s=i.glyphInfoMap[r].centroid,f=s.length===2?[s[0],s[1],0]:s;return i.glyphInfoMap[r].glyphQuads.forEach(function(v,m){n.push.apply(n,(0,Se.Z)(f).concat([v.tex.x,v.tex.y+v.tex.height,v.tl.x,v.tl.y],(0,Se.Z)(f),[v.tex.x+v.tex.width,v.tex.y+v.tex.height,v.tr.x,v.tr.y],(0,Se.Z)(f),[v.tex.x+v.tex.width,v.tex.y,v.br.x,v.br.y],(0,Se.Z)(f),[v.tex.x,v.tex.y,v.bl.x,v.bl.y])),a.push(0+m*4,1+m*4,2+m*4,2+m*4,3+m*4,0+m*4)}),{vertices:n,indices:a,size:7}}var jy=function(e){(0,Pr.Z)(r,e);var i=XA(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"glyphInfo",void 0),(0,S.Z)((0,J.Z)(n),"glyphInfoMap",{}),(0,S.Z)((0,J.Z)(n),"texture",void 0),(0,S.Z)((0,J.Z)(n),"currentZoom",-1),(0,S.Z)((0,J.Z)(n),"extent",void 0),(0,S.Z)((0,J.Z)(n),"textureHeight",0),(0,S.Z)((0,J.Z)(n),"textCount",0),(0,S.Z)((0,J.Z)(n),"preTextStyle",{}),(0,S.Z)((0,J.Z)(n),"buildModels",function(){var v=n.layer.getLayerConfig(),m=v.mask,x=m===void 0?!1:m,A=v.maskInside,T=A===void 0?!0:A;return n.initGlyph(),n.updateTexture(),n.filterGlyphs(),n.reBuildModel(),[n.layer.buildLayerModel({moduleName:"pointText",vertexShader:Uy,fragmentShader:zy,triangulation:Zy.bind((0,J.Z)(n)),depth:{enable:!1},blend:n.getBlend(),stencil:Da(x,T)})]}),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.stroke,m=v===void 0?"#fff":v,x=a.strokeWidth,A=x===void 0?0:x,T=a.textAnchor,I=T===void 0?"center":T,F=a.textAllowOverlap,j=F===void 0?!1:F,X=a.halo,ee=X===void 0?.5:X,be=a.gamma,Fe=be===void 0?2:be,We=a.raisingHeight,et=We===void 0?0:We,xt=this.fontService,Ct=xt.canvas,Yt=xt.mapping;if(Object.keys(Yt).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(Yt).length),this.preTextStyle={textAnchor:I,textAllowOverlap:j},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,strokeWidth:A,stroke:m})){this.judgeStyleAttributes({opacity:f,strokeWidth:A,stroke:m});var ar=this.layer.getEncodedData(),Ar=this.calDataFrame(this.cellLength,ar,this.cellProperties),Qr=Ar.data,vr=Ar.width,pn=Ar.height;this.rowCount=pn,this.dataTexture=this.cellLength>0&&Qr.length>0?this.createTexture2D({flipY:!0,data:Qr,format:k.LUMINANCE,type:k.FLOAT,width:vr,height:pn}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(et),u_opacity:Oi()(f)?f:1,u_stroke_width:Oi()(A)?A:0,u_stroke_color:this.getStrokeColor(m),u_sdf_map:this.texture,u_halo_blur:ee,u_gamma_scale:Fe,u_sdf_map_size:[Ct.width,Ct.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var a=this.layer.getLayerConfig(),s=a.textAnchor,f=s===void 0?"center":s,v=a.textAllowOverlap,m=v===void 0?!0:v;return this.preTextStyle={textAnchor:f,textAllowOverlap:m},this.buildModels()}},{key:"needUpdate",value:function(){var a=this.layer.getLayerConfig(),s=a.textAllowOverlap,f=s===void 0?!1:s,v=this.mapService.getZoom(),m=this.mapService.getBounds(),x=Cn(this.extent,m);return!f&&(Math.abs(this.currentZoom-v)>1||!x)||f!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:Fn.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,f,v,m){var x=s.rotate,A=x===void 0?0:x;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:Fn.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(s,f,v,m){return[v[5],v[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,f,v,m){var x=s.size,A=x===void 0?12:x;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:Fn.Attribute,descriptor:{name:"a_tex",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(s,f,v,m){return[v[3],v[4]]}}})}},{key:"textExtent",value:function(){var a=this.mapService.getBounds();return In(a,.5)}},{key:"initTextFont",value:function(){var a=this.layer.getLayerConfig(),s=a.fontWeight,f=s===void 0?"400":s,v=a.fontFamily,m=v===void 0?"sans-serif":v,x=this.layer.getEncodedData(),A=[];x.forEach(function(T){var I=T.shape,F=I===void 0?"":I;F=F.toString();var j=HA(F),X;try{for(j.s();!(X=j.n()).done;){var ee=X.value;A.indexOf(ee)===-1&&A.push(ee)}}catch(be){j.e(be)}finally{j.f()}}),this.fontService.setFontOptions({characterSet:A,fontWeight:f,fontFamily:m,iconfont:!1})}},{key:"initIconFontTex",value:function(){var a=this.layer.getLayerConfig(),s=a.fontWeight,f=s===void 0?"400":s,v=a.fontFamily,m=v===void 0?"sans-serif":v,x=this.layer.getEncodedData(),A=[];x.forEach(function(T){var I=T.shape,F=I===void 0?"":I;F="".concat(F),A.indexOf(F)===-1&&A.push(F)}),this.fontService.setFontOptions({characterSet:A,fontWeight:f,fontFamily:m,iconfont:!0})}},{key:"generateGlyphLayout",value:function(a){var s=this,f=this.fontService.mapping,v=this.layer.getLayerConfig(),m=v.spacing,x=m===void 0?2:m,A=v.textAnchor,T=A===void 0?"center":A,I=this.layer.getEncodedData();this.glyphInfo=I.map(function(F){var j=F.shape,X=j===void 0?"":j,ee=F.id,be=F.size,Fe=be===void 0?1:be,We=F.textOffset,et=We===void 0?[0,0]:We,xt=VA(X.toString(),f,Fe,T,"left",x,et,a),Ct=GA(xt,et,!1);return F.shaping=xt,F.glyphQuads=Ct,F.centroid=Up(F.coordinates),F.originCentroid=F.version==="GAODE2.x"?Up(F.originCoordinates):F.originCentroid=F.centroid,s.glyphInfoMap[ee]={shaping:xt,glyphQuads:Ct,centroid:Up(F.coordinates)},F})}},{key:"filterGlyphs",value:function(){var a=this,s=this.layer.getLayerConfig(),f=s.padding,v=f===void 0?[4,4]:f,m=s.textAllowOverlap,x=m===void 0?!1:m;if(!x){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var A=this.rendererService.getViewportSize(),T=A.width,I=A.height,F=new zA(T,I),j=this.glyphInfo.filter(function(X){var ee=X.shaping,be=X.id,Fe=be===void 0?0:be,We=X.version==="GAODE2.x"?X.originCentroid:X.centroid,et=X.size,xt=et/24,Ct=a.mapService.lngLatToContainer(We),Yt=F.placeCollisionBox({x1:ee.left*xt-v[0],x2:ee.right*xt+v[0],y1:ee.top*xt-v[1],y2:ee.bottom*xt+v[1],anchorPointX:Ct.x,anchorPointY:Ct.y}),ar=Yt.box;return ar&&ar.length?(F.insertCollisionBox(ar,Fe),!0):!1});j.forEach(function(X){a.glyphInfoMap[X.id]=X})}}},{key:"initGlyph",value:function(){var a=this.layer.getLayerConfig(),s=a.iconfont,f=s===void 0?!1:s;f?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(f)}},{key:"updateTexture",value:function(){var a=this.rendererService.createTexture2D,s=this.fontService.canvas;this.textureHeight=s.height,this.texture&&this.texture.destroy(),this.texture=a({data:s,mag:k.LINEAR,min:k.LINEAR,width:s.width,height:s.height})}},{key:"reBuildModel",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v;this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:Uy,fragmentShader:zy,triangulation:Zy.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:Da(f,m)})]}}]),r}(Lo),qA={fillImage:lA,fill:Py,radar:MA,image:Oy,normal:Iy,simplePoint:LA,extrude:Ty,text:jy,icon:dA},KA=qA;function $A(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=QA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function QA(e,i){if(!!e){if(typeof e=="string")return Vy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Vy(e,i)}}function Vy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function JA(e){var i=ew();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function ew(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tw=function(e){(0,Pr.Z)(r,e);var i=JA(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"type","PointLayer"),n}return(0,Pt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new KA[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var a=this.shapeOption,s=a.field,f=a.values,v=this.getLayerConfig(),m=v.shape2d,x=v.shape3d,A=this.iconService.getIconMap();if(s&&(m==null?void 0:m.indexOf(s))!==-1)return"fill";if(f&&f instanceof Array){var T=$A(f),I;try{for(T.s();!(I=T.n()).done;){var F=I.value;if(typeof F=="string"&&A.hasOwnProperty(F))return"image"}}catch(j){T.e(j)}finally{T.f()}}}return"normal"}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}};return s[a]}},{key:"getModelType",value:function(){var a=["fillImage","fill","radar","image","normal","simplePoint","extrude","text","icon"];if(this.layerType&&a.includes(this.layerType))return this.layerType;var s=this.getEncodedData(),f=this.getLayerConfig(),v=f.shape2d,m=f.shape3d,x=this.iconService.getIconMap(),A=s.find(function(I){return I.hasOwnProperty("shape")});if(A){var T=A.shape;return T==="dot"?"normal":T==="simple"?"simplePoint":T==="radar"?"radar":T==="fillImage"?"fillImage":(v==null?void 0:v.indexOf(T))!==-1?"fill":(m==null?void 0:m.indexOf(T))!==-1?"extrude":x.hasOwnProperty(T)?"image":this.fontService.getGlyph(T)!==""?"icon":"text"}else return this.getModelTypeWillEmptyData()}}]),r}(zp);function rw(e){var i=nw();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function nw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var iw=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];  
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }

  } else {
     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,aw=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  if(styleMappingMat[0][3] < 1.0 ) {
    // side
    styleMappingMat[0][0] = 0.0;
  } else {

  }

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,ow=`uniform sampler2D u_texture;
uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float lightWeight = styleMappingMat[3][1];
  float topU = styleMappingMat[2][2];
  float topV = styleMappingMat[2][3];

  float sidey = styleMappingMat[3][0];
  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }
  } else {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = texture2D(u_texture, vec2(topU, topV));
  }
  

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,sw=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  v_Color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - a_Position.z(judge side by a_Position.z)
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - u - v
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[2][2] = a_uvs[0];
  styleMappingMat[2][3] = 1.0 - a_uvs[1];
  styleMappingMat[3][0] = a_uvs[2];


  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,uw=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      // side notuse linear
       gl_FragColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
}
`,lw=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,cw=function(e){(0,Pr.Z)(r,e);var i=rw(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"texture",void 0),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.heightfixed,m=v===void 0?!1:v,x=a.raisingHeight,A=x===void 0?0:x,T=a.topsurface,I=T===void 0?!0:T,F=a.sidesurface,j=F===void 0?!0:F,X=a.sourceColor,ee=a.targetColor;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var be=this.layer.getEncodedData(),Fe=this.calDataFrame(this.cellLength,be,this.cellProperties),We=Fe.data,et=Fe.width,xt=Fe.height;this.rowCount=xt,this.dataTexture=this.cellLength>0&&We.length>0?this.createTexture2D({flipY:!0,data:We,format:k.LUMINANCE,type:k.FLOAT,width:et,height:xt}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}var Ct=0,Yt=[1,1,1,1],ar=[1,1,1,1];return X&&ee&&(Yt=pi(X),ar=pi(ee),Ct=1),{u_topsurface:Number(I),u_sidesurface:Number(j),u_heightfixed:Number(m),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(A),u_opacity:Oi()(f)?f:1,u_linearColor:Ct,u_sourceColor:Yt,u_targetColor:ar,u_texture:this.texture}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v,x=this.getShaders(),A=x.frag,T=x.vert,I=x.type;return[this.layer.buildLayerModel({moduleName:I,vertexShader:T,fragmentShader:A,triangulation:vy,stencil:Da(f,m),cull:{enable:!0,face:k.BACK}})]}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.pickLight,f=a.mapTexture;return f?{frag:ow,vert:sw,type:"polygonExtrudeTexture"}:s?{frag:uw,vert:lw,type:"polygonExtrude"}:{frag:iw,vert:aw,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var a,s;(a=this.dataTexture)===null||a===void 0||a.destroy(),(s=this.texture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getSource().extent,s=(0,dn.Z)(a,4),f=s[0],v=s[1],m=s[2],x=s[3],A=m-f,T=x-v;this.styleAttributeService.registerStyleAttribute({name:"uvs",type:Fn.Attribute,descriptor:{name:"a_uvs",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(F,j,X,ee,be){var Fe=X[0],We=X[1];return[(Fe-f)/A,(We-v)/T,X[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Fn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(F,j,X,ee,be){return be}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(F,j,X,ee){var be=F.size,Fe=be===void 0?10:be;return Array.isArray(Fe)?[Fe[0]]:[Fe]}}})}},{key:"loadTexture",value:function(){var a=this,s=this.layer.getLayerConfig(),f=s.mapTexture,v=this.rendererService.createTexture2D;if(this.texture=v({height:0,width:0}),f){var m=new Image;m.crossOrigin="",m.src=f,m.onload=function(){a.texture=v({data:m,width:m.width,height:m.height,wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE,min:k.LINEAR,mag:k.LINEAR}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}}}]),r}(Lo);function fw(e){var i=hw();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function hw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pw=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,dw=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;


void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,vw=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}`,mw=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,gw=function(e){(0,Pr.Z)(r,e);var i=fw(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.raisingHeight,f=s===void 0?0:s,v=a.opacity,m=v===void 0?1:v,x=a.opacityLinear,A=x===void 0?{enable:!1,dir:"in"}:x;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:m})){this.judgeStyleAttributes({opacity:m});var T=this.layer.getEncodedData(),I=this.calDataFrame(this.cellLength,T,this.cellProperties),F=I.data,j=I.width,X=I.height;this.rowCount=X,this.dataTexture=this.cellLength>0&&F.length>0?this.createTexture2D({flipY:!0,data:F,format:k.LUMINANCE,type:k.FLOAT,width:j,height:X}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(f),u_opacity:Oi()(m)?m:1,u_opacitylinear:Number(A.enable),u_dir:A.dir==="in"?1:0}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.opacityLinear,f=s===void 0?{enable:!1,dir:"in"}:s,v=a.mask,m=v===void 0?!1:v,x=a.maskInside,A=x===void 0?!0:x;return[this.layer.buildLayerModel({moduleName:"polygon",vertexShader:f.enable?vw:mw,fragmentShader:f.enable?dw:pw,triangulation:f.enable?rS:j0,blend:this.getBlend(),depth:{enable:!1},cull:{enable:!0,face:k.BACK},stencil:Da(m,A)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getLayerConfig(),s=a.opacityLinear,f=s===void 0?{enable:!1,dir:"in"}:s;f.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:Fn.Attribute,descriptor:{name:"a_linear",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(m,x,A,T,I){return[A[3],A[4],A[5]]}}})}}]),r}(Lo);function yw(e){var i=_w();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function _w(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xw=`
uniform float u_time;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;
// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)
// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)
uniform vec4 u_watercolor;
uniform vec4 u_watercolor2;
vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture2D(u_texture2,p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture2D(u_texture1,fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    

  float opacity = styleMappingMat[0][0];
  gl_FragColor = vec4(col, opacity);

  // gl_FragColor = v_Color;
  
}
`,bw=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,Ew=function(e){(0,Pr.Z)(r,e);var i=yw(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"texture1",void 0),(0,S.Z)((0,J.Z)(n),"texture2",void 0),(0,S.Z)((0,J.Z)(n),"texture3",void 0),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.watercolor,m=v===void 0?"#6D99A8":v,x=a.watercolor2,A=x===void 0?"#0F121C":x;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var T=this.layer.getEncodedData(),I=this.calDataFrame(this.cellLength,T,this.cellProperties),F=I.data,j=I.width,X=I.height;this.rowCount=X,this.dataTexture=this.cellLength>0&&F.length>0?this.createTexture2D({flipY:!0,data:F,format:k.LUMINANCE,type:k.FLOAT,width:j,height:X}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:pi(m),u_watercolor2:pi(A),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Oi()(f)?f:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"polygon_ocean",vertexShader:bw,fragmentShader:xw,triangulation:j0,depth:{enable:!1},stencil:Da(f,m)})]}},{key:"clearModels",value:function(){var a,s,f,v;(a=this.texture1)===null||a===void 0||a.destroy(),(s=this.texture2)===null||s===void 0||s.destroy(),(f=this.texture3)===null||f===void 0||f.destroy(),(v=this.dataTexture)===null||v===void 0||v.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getSource().extent,s=(0,dn.Z)(a,4),f=s[0],v=s[1],m=s[2],x=s[3],A=m-f,T=x-v;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:Fn.Attribute,descriptor:{name:"a_uv",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(F,j,X,ee,be){var Fe=(0,dn.Z)(X,2),We=Fe[0],et=Fe[1];return[(We-f)/A,(et-v)/T]}}})}},{key:"loadTexture",value:function(){var a=this,s=this.rendererService.createTexture2D,f={height:0,width:0};this.texture1=s(f),this.texture2=s(f),this.texture3=s(f),v(function(x){a.texture1=m(x[0]),a.texture2=m(x[1]),a.texture3=m(x[2]),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()});function v(x){var A=0,T=[],I=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];I.map(function(F){var j=new Image;j.crossOrigin="",j.src=F,T.push(j),j.onload=function(){A++,A===3&&x(T)}})}function m(x){return s({data:x,width:x.width,height:x.height,wrapS:k.MIRRORED_REPEAT,wrapT:k.MIRRORED_REPEAT,min:k.LINEAR,mag:k.LINEAR})}}}]),r}(Lo);function Sw(e){var i=Cw();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function Cw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Aw=`
uniform sampler2D u_texture;
uniform float u_time;
uniform float u_speed: 1.0;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

  float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

  float water(vec3 p) {
    float t = u_time * u_speed;
    p.z += t * 2.; p.x += t * 2.;
    vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;
    p.z += t * 3.; p.x += t * 0.52;
    vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;
    p.z += t * 4.; p.x += t * 0.8;
    vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;
    c1 += c2 - c3;
    float z = (c1.x + c1.y + c1.z) / 3.;
    return p.y + z / 4.;
  }

  float map(vec3 p) {
    float d = 100.0;
    d = water(p);
    return d;
  }

  float intersect(vec3 ro, vec3 rd) {
    float d = 0.0;
    for (int i = 0; i <= 100; i++) {
      float h = map(ro + rd * d);
      if (h < 0.1) return  d;
      d += h;
    }
    return 0.0;
  }
  
  vec3 norm(vec3 p) {
    float eps = .1;
    return normalize(vec3(
      map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
      map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
      map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
    ));
  } 

  float calSpc() {
    vec3 l1 = normalize(vec3(1, 1, 1));
    vec3 ro = vec3(-3, 20, -8);
    vec3 rc = vec3(0, 0, 0);
    vec3 ww = normalize(rc - ro);
    vec3 uu = normalize(cross(vec3(0,1,0), ww));
    vec3 vv = normalize(cross(rc - ro, uu));
    vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
    float d = intersect(ro, rd);
    vec3 p = ro + rd * d;
    vec3 n = norm(p);
    float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
    return spc;
  }

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;

  float spc = calSpc();
  gl_FragColor += spc * 0.4;
}
`,ww=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,Tw=function(e){(0,Pr.Z)(r,e);var i=Sw(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"texture",void 0),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.speed,m=v===void 0?.5:v;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var x=this.layer.getEncodedData(),A=this.calDataFrame(this.cellLength,x,this.cellProperties),T=A.data,I=A.width,F=A.height;this.rowCount=F,this.dataTexture=this.cellLength>0&&T.length>0?this.createTexture2D({flipY:!0,data:T,format:k.LUMINANCE,type:k.FLOAT,width:I,height:F}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_texture:this.texture,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_speed:m,u_opacity:Oi()(f)?f:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"polygon_water",vertexShader:ww,fragmentShader:Aw,triangulation:j0,depth:{enable:!1},stencil:Da(f,m)})]}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getSource().extent,s=(0,dn.Z)(a,4),f=s[0],v=s[1],m=s[2],x=s[3],A=m-f,T=x-v;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:Fn.Attribute,descriptor:{name:"a_uv",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(F,j,X,ee,be){var Fe=(0,dn.Z)(X,2),We=Fe[0],et=Fe[1];return[(We-f)/A,(et-v)/T]}}})}},{key:"loadTexture",value:function(){var a=this,s=this.layer.getLayerConfig(),f=s.waterTexture,v=this.rendererService.createTexture2D;this.texture=v({height:0,width:0});var m=new Image;m.crossOrigin="",f?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),m.src=f):m.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",m.onload=function(){a.texture=v({data:m,width:m.width,height:m.height,wrapS:k.MIRRORED_REPEAT,wrapT:k.MIRRORED_REPEAT,min:k.LINEAR,mag:k.LINEAR}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}}]),r}(Lo),Mw={fill:gw,line:Ay,extrude:cw,text:jy,point_fill:Py,point_image:Oy,point_normal:Iy,point_extrude:Ty,water:Tw,ocean:Ew},Pw=Mw;function Ow(e){var i=Iw();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function Iw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Gy=function(e){(0,Pr.Z)(r,e);var i=Ow(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"type","PolygonLayer"),n}return(0,Pt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new Pw[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),f=s==null||(a=s.scale)===null||a===void 0?void 0:a.field;return f==="fill"?"fill":f==="extrude"?"extrude":f==="water"?"water":f==="ocean"?"ocean":f==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var a=this.getEncodedData(),s=this.getLayerConfig(),f=s.shape2d,v=s.shape3d,m=this.iconService.getIconMap(),x=a.find(function(T){return T.hasOwnProperty("shape")});if(x){var A=x.shape;return A==="dot"?"point_normal":(f==null?void 0:f.indexOf(A))!==-1?"point_fill":(v==null?void 0:v.indexOf(A))!==-1?"point_extrude":m.hasOwnProperty(A)?"point_image":"text"}else return"fill"}}]),r}(zp);function Rw(e){var i=kw();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function kw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Lw=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,Dw=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,Hy=function(e){(0,Pr.Z)(r,e);var i=Rw(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"texture",void 0),(0,S.Z)((0,J.Z)(n),"colorTexture",void 0),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.clampLow,m=v===void 0?!0:v,x=a.clampHigh,A=x===void 0?!0:x,T=a.noDataValue,I=T===void 0?-9999999:T,F=a.domain,j=F===void 0?[0,1]:F;return this.updateColorTexure(),{u_opacity:f||1,u_texture:this.texture,u_domain:j,u_clampLow:m,u_clampHigh:typeof A!="undefined"?A:m,u_noDataValue:I,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v,x=this.layer.getSource(),A=this.rendererService.createTexture2D,T=x.data.dataArray[0];this.texture=A({data:T.data,width:T.width,height:T.height,format:k.LUMINANCE,type:k.FLOAT});var I=this.layer.getLayerConfig(),F=I.rampColors,j=jl(F);return this.colorTexture=A({data:j.data,width:j.width,height:j.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:Dw,fragmentShader:Lw,triangulation:yy,primitive:k.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:Da(f,m)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Fn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(s,f,v,m){return[v[3],v[4]]}}})}},{key:"updateColorTexure",value:function(){var a=this.rendererService.createTexture2D,s=this.layer.getLayerConfig(),f=s.rampColors,v=jl(f);this.colorTexture=a({data:v.data,width:v.width,height:v.height,flipY:!1})}}]),r}(Lo),Fw={raster:Hy,raster3d:Hy},Bw=Fw;function Nw(e){var i=zw();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function zw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Uw=function(e){(0,Pr.Z)(r,e);var i=Nw(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,S.Z)((0,J.Z)(n),"type","RasterLayer"),n}return(0,Pt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new Bw[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={raster:{},raster3d:{}};return s[a]}},{key:"getModelType",value:function(){return"raster"}}]),r}(zp),Wy,Xy,Yy,qy,Ky,ov,$y,Qy,Jy;function e_(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Zw(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?e_(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):e_(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var jw=(Wy=(0,Xr.b2)(),Xy=(0,Xr.f3)(yt.IGlobalConfigService),Yy=(0,Xr.f3)(yt.IMapService),qy=(0,Xr.f3)(yt.IFontService),Wy(Ky=(ov=function(){function e(){(0,ht.Z)(this,e),Ln(this,"configService",$y,this),Ln(this,"mapService",Qy,this),Ln(this,"fontService",Jy,this)}return(0,Pt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("DataMappingPlugin",function(){a.generateMaping(r,{styleAttributeService:s})}),r.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return r.dataState.dataMappingNeedUpdate=!1,a.generateMaping(r,{styleAttributeService:s}),!0}),r.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!r.layerModelNeedUpdate){var f=r.getBottomColor(),v=s.getLayerStyleAttributes()||[],m=s.getLayerStyleAttribute("filter"),x=r.getSource().data.dataArray,A=v.filter(function(I){return I.needRemapping}),T=x;m!=null&&m.needRemapping&&m!==null&&m!==void 0&&m.scale&&(T=x.filter(function(I){return a.applyAttributeMapping(m,I,f)[0]})),A.length&&(m!=null&&m.needRemapping?(r.setEncodedData(a.mapping(v,T,void 0,f,r)),m.needRemapping=!1):r.setEncodedData(a.mapping(A,T,r.getEncodedData(),f,r)),r.emit("remapping",null))}})}},{key:"generateMaping",value:function(r,n){var a=this,s=n.styleAttributeService,f=r.getBottomColor(),v=s.getLayerStyleAttributes()||[],m=s.getLayerStyleAttribute("filter"),x=r.getSource().data.dataArray,A=x;m!=null&&m.scale&&(A=x.filter(function(T){return a.applyAttributeMapping(m,T,f)[0]})),r.setEncodedData(this.mapping(v,A,void 0,f,r)),r.emit("dataUpdate",null)}},{key:"getArrowPoints",value:function(r,n){var a=[n[0]-r[0],n[1]-r[1]],s=Qo(a),f=[r[0]+s[0]*1e-4,r[1]+s[1]*1e-4];return f}},{key:"mapping",value:function(r,n,a,s,f){var v=this,m=f==null?void 0:f.getLayerConfig(),x=m.arrow,A=x===void 0?{enable:!1}:x,T=n.map(function(I,F){var j=a?a[F]:{},X=Zw({id:I._id,coordinates:I.coordinates},j);if(r.filter(function(Fe){return Fe.scale!==void 0}).forEach(function(Fe){var We=v.applyAttributeMapping(Fe,I,s);Fe.needRemapping=!1,Fe.name==="color"&&(We=We.map(function(et){return pi(et)})),X[Fe.name]=Array.isArray(We)&&We.length===1?We[0]:We,Fe.name==="shape"&&(X.shape=v.fontService.getIconFontKey(X[Fe.name]))}),X.shape==="line"&&A.enable){var ee=X.coordinates,be=v.getArrowPoints(ee[0],ee[1]);X.coordinates.splice(1,0,be,be)}return X});return this.adjustData2Amap2Coordinates(T),this.adjustData2SimpleCoordinates(T),T}},{key:"adjustData2Amap2Coordinates",value:function(r){var n=this;r.length>0&&this.mapService.version===ks["GAODE2.x"]&&(typeof r[0].coordinates[0]=="number"?r.filter(function(a){return!a.originCoordinates}).map(function(a){a.version=ks["GAODE2.x"],a.originCoordinates=H()(a.coordinates),a.coordinates=n.mapService.lngLatToCoord(a.coordinates)}):r.filter(function(a){return!a.originCoordinates}).map(function(a){a.version=ks["GAODE2.x"],a.originCoordinates=H()(a.coordinates),a.coordinates=n.mapService.lngLatToCoords(a.coordinates)}))}},{key:"adjustData2SimpleCoordinates",value:function(r){var n=this;r.length>0&&this.mapService.version===ks.SIMPLE&&r.map(function(a){a.simpleCoordinate||(a.coordinates=n.unProjectCoordinates(a.coordinates),a.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(r){var n=this;if(typeof r[0]=="number")return this.mapService.simpleMapCoord.unproject(r);if(r[0]&&r[0][0]instanceof Array){var a=[];return r.map(function(f){var v=[];f.map(function(m){v.push(n.mapService.simpleMapCoord.unproject(m))}),a.push(v)}),a}else{var s=[];return r.map(function(f){s.push(n.mapService.simpleMapCoord.unproject(f))}),s}}},{key:"applyAttributeMapping",value:function(r,n,a){var s;if(!r.scale)return[];var f=(r==null||(s=r.scale)===null||s===void 0?void 0:s.scalers)||[],v=[];f.forEach(function(x){var A,T=x.field;(n.hasOwnProperty(T)||((A=r.scale)===null||A===void 0?void 0:A.type)==="variable")&&v.push(n[T])});var m=r.mapping?r.mapping(v):[];return r.name==="color"&&!yu(m[0])?[a]:m}}]),e}(),$y=ri(ov.prototype,"configService",[Xy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qy=ri(ov.prototype,"mapService",[Yy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jy=ri(ov.prototype,"fontService",[qy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ov))||Ky),t_,r_,Vw=(t_=(0,Xr.b2)(),t_(r_=function(){function e(){(0,ht.Z)(this,e),(0,S.Z)(this,"mapService",void 0)}return(0,Pt.Z)(e,[{key:"apply",value:function(r){var n=this;this.mapService=r.getContainer().get(yt.IMapService),r.hooks.init.tap("DataSourcePlugin",function(){var a=r.getSource();if(!a){var s=r.sourceOption||{data:$p,options:dp},f=s.data,v=s.options;r.setSource(new Fh(f,v))}n.updateClusterData(r)}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var a=n.updateClusterData(r),s=r.dataState.dataSourceNeedUpdate;return r.dataState.dataSourceNeedUpdate=!1,a||s})}},{key:"updateClusterData",value:function(r){var n=r.getSource(),a=n.cluster,s=n.clusterOptions,f=s.zoom,v=f===void 0?0:f,m=s.maxZoom,x=m===void 0?16:m,A=this.mapService.getZoom()-1,T=r.dataState.dataSourceNeedUpdate;return a&&(T||Math.abs(r.clusterZoom-A)>=1)?(v!==Math.floor(A)&&n.updateClusterData(Math.floor(A)),r.clusterZoom=A,!0):!1}}]),e}())||r_);function G0(e,i){return e<i?-1:e>i?1:e>=i?0:NaN}function n_(e){return e.length===1&&(e=Gw(e)),{left:function(i,r,n,a){for(n==null&&(n=0),a==null&&(a=i.length);n<a;){var s=n+a>>>1;e(i[s],r)<0?n=s+1:a=s}return n},right:function(i,r,n,a){for(n==null&&(n=0),a==null&&(a=i.length);n<a;){var s=n+a>>>1;e(i[s],r)>0?a=s:n=s+1}return n}}}function Gw(e){return function(i,r){return G0(e(i),r)}}var i_=n_(G0),Hw=i_.right,rO=i_.left,qv=Hw;function Ww(e,i){var r=e.length,n=-1,a,s,f;if(i==null){for(;++n<r;)if((a=e[n])!=null&&a>=a)for(s=f=a;++n<r;)(a=e[n])!=null&&(s>a&&(s=a),f<a&&(f=a))}else for(;++n<r;)if((a=i(e[n],n,e))!=null&&a>=a)for(s=f=a;++n<r;)(a=i(e[n],n,e))!=null&&(s>a&&(s=a),f<a&&(f=a));return[s,f]}var a_=Array.prototype,nO=a_.slice,iO=a_.map,H0=Math.sqrt(50),W0=Math.sqrt(10),X0=Math.sqrt(2);function o_(e,i,r){var n,a=-1,s,f,v;if(i=+i,e=+e,r=+r,e===i&&r>0)return[e];if((n=i<e)&&(s=e,e=i,i=s),(v=Kv(e,i,r))===0||!isFinite(v))return[];if(v>0)for(e=Math.ceil(e/v),i=Math.floor(i/v),f=new Array(s=Math.ceil(i-e+1));++a<s;)f[a]=(e+a)*v;else for(e=Math.floor(e*v),i=Math.ceil(i*v),f=new Array(s=Math.ceil(e-i+1));++a<s;)f[a]=(e-a)/v;return n&&f.reverse(),f}function Kv(e,i,r){var n=(i-e)/Math.max(0,r),a=Math.floor(Math.log(n)/Math.LN10),s=n/Math.pow(10,a);return a>=0?(s>=H0?10:s>=W0?5:s>=X0?2:1)*Math.pow(10,a):-Math.pow(10,-a)/(s>=H0?10:s>=W0?5:s>=X0?2:1)}function Y0(e,i,r){var n=Math.abs(i-e)/Math.max(0,r),a=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),s=n/a;return s>=H0?a*=10:s>=W0?a*=5:s>=X0&&(a*=2),i<e?-a:a}function aO(){var e=identity,i=extent,r=sturges;function n(a){var s,f=a.length,v,m=new Array(f);for(s=0;s<f;++s)m[s]=e(a[s],s,a);var x=i(m),A=x[0],T=x[1],I=r(m,A,T);Array.isArray(I)||(I=tickStep(A,T,I),I=range(Math.ceil(A/I)*I,T,I));for(var F=I.length;I[0]<=A;)I.shift(),--F;for(;I[F-1]>T;)I.pop(),--F;var j=new Array(F+1),X;for(s=0;s<=F;++s)X=j[s]=[],X.x0=s>0?I[s-1]:A,X.x1=s<F?I[s]:T;for(s=0;s<f;++s)v=m[s],A<=v&&v<=T&&j[bisect(I,v,0,F)].push(a[s]);return j}return n.value=function(a){return arguments.length?(e=typeof a=="function"?a:constant(a),n):e},n.domain=function(a){return arguments.length?(i=typeof a=="function"?a:constant([a[0],a[1]]),n):i},n.thresholds=function(a){return arguments.length?(r=typeof a=="function"?a:Array.isArray(a)?constant(slice.call(a)):constant(a),n):r},n}function oO(e,i,r){return e=map.call(e,number).sort(ascending),Math.ceil((r-i)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function Xw(e){return e===null?NaN:+e}function Yw(e,i,r){if(r==null&&(r=Xw),!!(n=e.length)){if((i=+i)<=0||n<2)return+r(e[0],0,e);if(i>=1)return+r(e[n-1],n-1,e);var n,a=(n-1)*i,s=Math.floor(a),f=+r(e[s],s,e),v=+r(e[s+1],s+1,e);return f+(v-f)*(a-s)}}var Dc="$";function $v(){}$v.prototype=s_.prototype={constructor:$v,has:function(e){return Dc+e in this},get:function(e){return this[Dc+e]},set:function(e,i){return this[Dc+e]=i,this},remove:function(e){var i=Dc+e;return i in this&&delete this[i]},clear:function(){for(var e in this)e[0]===Dc&&delete this[e]},keys:function(){var e=[];for(var i in this)i[0]===Dc&&e.push(i.slice(1));return e},values:function(){var e=[];for(var i in this)i[0]===Dc&&e.push(this[i]);return e},entries:function(){var e=[];for(var i in this)i[0]===Dc&&e.push({key:i.slice(1),value:this[i]});return e},size:function(){var e=0;for(var i in this)i[0]===Dc&&++e;return e},empty:function(){for(var e in this)if(e[0]===Dc)return!1;return!0},each:function(e){for(var i in this)i[0]===Dc&&e(this[i],i.slice(1),this)}};function s_(e,i){var r=new $v;if(e instanceof $v)e.each(function(v,m){r.set(m,v)});else if(Array.isArray(e)){var n=-1,a=e.length,s;if(i==null)for(;++n<a;)r.set(n,e[n]);else for(;++n<a;)r.set(i(s=e[n],n,e),s)}else if(e)for(var f in e)r.set(f,e[f]);return r}var q0=s_;function sO(){var e=[],i=[],r,n,a;function s(v,m,x,A){if(m>=e.length)return r!=null&&v.sort(r),n!=null?n(v):v;for(var T=-1,I=v.length,F=e[m++],j,X,ee=map(),be,Fe=x();++T<I;)(be=ee.get(j=F(X=v[T])+""))?be.push(X):ee.set(j,[X]);return ee.each(function(We,et){A(Fe,et,s(We,m,x,A))}),Fe}function f(v,m){if(++m>e.length)return v;var x,A=i[m-1];return n!=null&&m>=e.length?x=v.entries():(x=[],v.each(function(T,I){x.push({key:I,values:f(T,m)})})),A!=null?x.sort(function(T,I){return A(T.key,I.key)}):x}return a={object:function(v){return s(v,0,qw,Kw)},map:function(v){return s(v,0,u_,l_)},entries:function(v){return f(s(v,0,u_,l_),0)},key:function(v){return e.push(v),a},sortKeys:function(v){return i[e.length-1]=v,a},sortValues:function(v){return r=v,a},rollup:function(v){return n=v,a}}}function qw(){return{}}function Kw(e,i,r){e[i]=r}function u_(){return map()}function l_(e,i,r){e.set(i,r)}function Qv(){}var Vp=q0.prototype;Qv.prototype=$w.prototype={constructor:Qv,has:Vp.has,add:function(e){return e+="",this[Dc+e]=e,this},remove:Vp.remove,clear:Vp.clear,values:Vp.keys,size:Vp.size,empty:Vp.empty,each:Vp.each};function $w(e,i){var r=new Qv;if(e instanceof Qv)e.each(function(s){r.add(s)});else if(e){var n=-1,a=e.length;if(i==null)for(;++n<a;)r.add(e[n]);else for(;++n<a;)r.add(i(e[n],n,e))}return r}var uO=null,c_=Array.prototype,Jv=c_.map,Gp=c_.slice;function fp(e,i){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(i).domain(e);break}return this}function lO(e,i){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(i).domain(e);break}return this}var f_={name:"implicit"};function e0(){var e=q0(),i=[],r=[],n=f_;function a(s){var f=s+"",v=e.get(f);if(!v){if(n!==f_)return n;e.set(f,v=i.push(s))}return r[(v-1)%r.length]}return a.domain=function(s){if(!arguments.length)return i.slice();i=[],e=q0();for(var f=-1,v=s.length,m,x;++f<v;)e.has(x=(m=s[f])+"")||e.set(x,i.push(m));return a},a.range=function(s){return arguments.length?(r=Gp.call(s),a):r.slice()},a.unknown=function(s){return arguments.length?(n=s,a):n},a.copy=function(){return e0(i,r).unknown(n)},fp.apply(a,arguments),a}function h_(){var e=ordinal().unknown(void 0),i=e.domain,r=e.range,n=[0,1],a,s,f=!1,v=0,m=0,x=.5;delete e.unknown;function A(){var T=i().length,I=n[1]<n[0],F=n[I-0],j=n[1-I];a=(j-F)/Math.max(1,T-v+m*2),f&&(a=Math.floor(a)),F+=(j-F-a*(T-v))*x,s=a*(1-v),f&&(F=Math.round(F),s=Math.round(s));var X=sequence(T).map(function(ee){return F+a*ee});return r(I?X.reverse():X)}return e.domain=function(T){return arguments.length?(i(T),A()):i()},e.range=function(T){return arguments.length?(n=[+T[0],+T[1]],A()):n.slice()},e.rangeRound=function(T){return n=[+T[0],+T[1]],f=!0,A()},e.bandwidth=function(){return s},e.step=function(){return a},e.round=function(T){return arguments.length?(f=!!T,A()):f},e.padding=function(T){return arguments.length?(v=Math.min(1,m=+T),A()):v},e.paddingInner=function(T){return arguments.length?(v=Math.min(1,T),A()):v},e.paddingOuter=function(T){return arguments.length?(m=+T,A()):m},e.align=function(T){return arguments.length?(x=Math.max(0,Math.min(1,T)),A()):x},e.copy=function(){return h_(i(),n).round(f).paddingInner(v).paddingOuter(m).align(x)},initRange.apply(A(),arguments)}function p_(e){var i=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return p_(i())},e}function cO(){return p_(h_.apply(null,arguments).paddingInner(1))}var Qw=Q(26257),Jw=Q(73626);function eT(e,i){return e=+e,i=+i,function(r){return Math.round(e*(1-r)+i*r)}}function tT(e){return function(){return e}}function K0(e){return+e}var d_=[0,1];function Fc(e){return e}function $0(e,i){return(i-=e=+e)?function(r){return(r-e)/i}:tT(isNaN(i)?NaN:.5)}function v_(e){var i=e[0],r=e[e.length-1],n;return i>r&&(n=i,i=r,r=n),function(a){return Math.max(i,Math.min(r,a))}}function rT(e,i,r){var n=e[0],a=e[1],s=i[0],f=i[1];return a<n?(n=$0(a,n),s=r(f,s)):(n=$0(n,a),s=r(s,f)),function(v){return s(n(v))}}function nT(e,i,r){var n=Math.min(e.length,i.length)-1,a=new Array(n),s=new Array(n),f=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),i=i.slice().reverse());++f<n;)a[f]=$0(e[f],e[f+1]),s[f]=r(i[f],i[f+1]);return function(v){var m=qv(e,v,1,n)-1;return s[m](a[m](v))}}function t0(e,i){return i.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Q0(){var e=d_,i=d_,r=Qw.Z,n,a,s,f=Fc,v,m,x;function A(){return v=Math.min(e.length,i.length)>2?nT:rT,m=x=null,T}function T(I){return isNaN(I=+I)?s:(m||(m=v(e.map(n),i,r)))(n(f(I)))}return T.invert=function(I){return f(a((x||(x=v(i,e.map(n),Jw.Z)))(I)))},T.domain=function(I){return arguments.length?(e=Jv.call(I,K0),f===Fc||(f=v_(e)),A()):e.slice()},T.range=function(I){return arguments.length?(i=Gp.call(I),A()):i.slice()},T.rangeRound=function(I){return i=Gp.call(I),r=eT,A()},T.clamp=function(I){return arguments.length?(f=I?v_(e):Fc,T):f!==Fc},T.interpolate=function(I){return arguments.length?(r=I,A()):r},T.unknown=function(I){return arguments.length?(s=I,T):s},function(I,F){return n=I,a=F,A()}}function m_(e,i){return Q0()(e,i)}var iT=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function r0(e){if(!(i=iT.exec(e)))throw new Error("invalid format: "+e);var i;return new J0({fill:i[1],align:i[2],sign:i[3],symbol:i[4],zero:i[5],width:i[6],comma:i[7],precision:i[8]&&i[8].slice(1),trim:i[9],type:i[10]})}r0.prototype=J0.prototype;function J0(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}J0.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function aT(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function n0(e,i){if((r=(e=i?e.toExponential(i-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function Ed(e){return e=n0(Math.abs(e)),e?e[1]:NaN}function oT(e,i){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Ed(i)/3)))*3-Ed(Math.abs(e)))}function sT(e,i){return function(r,n){for(var a=r.length,s=[],f=0,v=e[0],m=0;a>0&&v>0&&(m+v+1>n&&(v=Math.max(1,n-m)),s.push(r.substring(a-=v,a+v)),!((m+=v+1)>n));)v=e[f=(f+1)%e.length];return s.reverse().join(i)}}function uT(e){return function(i){return i.replace(/[0-9]/g,function(r){return e[+r]})}}function lT(e){e:for(var i=e.length,r=1,n=-1,a;r<i;++r)switch(e[r]){case".":n=a=r;break;case"0":n===0&&(n=r),a=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(a+1):e}var g_;function cT(e,i){var r=n0(e,i);if(!r)return e+"";var n=r[0],a=r[1],s=a-(g_=Math.max(-8,Math.min(8,Math.floor(a/3)))*3)+1,f=n.length;return s===f?n:s>f?n+new Array(s-f+1).join("0"):s>0?n.slice(0,s)+"."+n.slice(s):"0."+new Array(1-s).join("0")+n0(e,Math.max(0,i+s-1))[0]}function y_(e,i){var r=n0(e,i);if(!r)return e+"";var n=r[0],a=r[1];return a<0?"0."+new Array(-a).join("0")+n:n.length>a+1?n.slice(0,a+1)+"."+n.slice(a+1):n+new Array(a-n.length+2).join("0")}var __={"%":function(e,i){return(e*100).toFixed(i)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:aT,e:function(e,i){return e.toExponential(i)},f:function(e,i){return e.toFixed(i)},g:function(e,i){return e.toPrecision(i)},o:function(e){return Math.round(e).toString(8)},p:function(e,i){return y_(e*100,i)},r:y_,s:cT,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function x_(e){return e}var b_=Array.prototype.map,E_=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function fT(e){var i=e.grouping===void 0||e.thousands===void 0?x_:sT(b_.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",a=e.decimal===void 0?".":e.decimal+"",s=e.numerals===void 0?x_:uT(b_.call(e.numerals,String)),f=e.percent===void 0?"%":e.percent+"",v=e.minus===void 0?"-":e.minus+"",m=e.nan===void 0?"NaN":e.nan+"";function x(T){T=r0(T);var I=T.fill,F=T.align,j=T.sign,X=T.symbol,ee=T.zero,be=T.width,Fe=T.comma,We=T.precision,et=T.trim,xt=T.type;xt==="n"?(Fe=!0,xt="g"):__[xt]||(We===void 0&&(We=12),et=!0,xt="g"),(ee||I==="0"&&F==="=")&&(ee=!0,I="0",F="=");var Ct=X==="$"?r:X==="#"&&/[boxX]/.test(xt)?"0"+xt.toLowerCase():"",Yt=X==="$"?n:/[%p]/.test(xt)?f:"",ar=__[xt],Ar=/[defgprs%]/.test(xt);We=We===void 0?6:/[gprs]/.test(xt)?Math.max(1,Math.min(21,We)):Math.max(0,Math.min(20,We));function Qr(vr){var pn=Ct,Tn=Yt,qn,Ba,qo;if(xt==="c")Tn=ar(vr)+Tn,vr="";else{vr=+vr;var Ls=vr<0||1/vr<0;if(vr=isNaN(vr)?m:ar(Math.abs(vr),We),et&&(vr=lT(vr)),Ls&&+vr==0&&j!=="+"&&(Ls=!1),pn=(Ls?j==="("?j:v:j==="-"||j==="("?"":j)+pn,Tn=(xt==="s"?E_[8+g_/3]:"")+Tn+(Ls&&j==="("?")":""),Ar){for(qn=-1,Ba=vr.length;++qn<Ba;)if(qo=vr.charCodeAt(qn),48>qo||qo>57){Tn=(qo===46?a+vr.slice(qn+1):vr.slice(qn))+Tn,vr=vr.slice(0,qn);break}}}Fe&&!ee&&(vr=i(vr,Infinity));var Ds=pn.length+vr.length+Tn.length,Ys=Ds<be?new Array(be-Ds+1).join(I):"";switch(Fe&&ee&&(vr=i(Ys+vr,Ys.length?be-Tn.length:Infinity),Ys=""),F){case"<":vr=pn+vr+Tn+Ys;break;case"=":vr=pn+Ys+vr+Tn;break;case"^":vr=Ys.slice(0,Ds=Ys.length>>1)+pn+vr+Tn+Ys.slice(Ds);break;default:vr=Ys+pn+vr+Tn;break}return s(vr)}return Qr.toString=function(){return T+""},Qr}function A(T,I){var F=x((T=r0(T),T.type="f",T)),j=Math.max(-8,Math.min(8,Math.floor(Ed(I)/3)))*3,X=Math.pow(10,-j),ee=E_[8+j/3];return function(be){return F(X*be)+ee}}return{format:x,formatPrefix:A}}var i0,em,S_;hT({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function hT(e){return i0=fT(e),em=i0.format,S_=i0.formatPrefix,i0}function pT(e,i){return e=Math.abs(e),i=Math.abs(i)-e,Math.max(0,Ed(i)-Ed(e))+1}function dT(e){return Math.max(0,-Ed(Math.abs(e)))}function vT(e,i,r,n){var a=Y0(e,i,r),s;switch(n=r0(n==null?",f":n),n.type){case"s":{var f=Math.max(Math.abs(e),Math.abs(i));return n.precision==null&&!isNaN(s=oT(a,f))&&(n.precision=s),S_(n,f)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(s=pT(a,Math.max(Math.abs(e),Math.abs(i))))&&(n.precision=s-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(s=dT(a))&&(n.precision=s-(n.type==="%")*2);break}}return em(n)}function a0(e){var i=e.domain;return e.ticks=function(r){var n=i();return o_(n[0],n[n.length-1],r==null?10:r)},e.tickFormat=function(r,n){var a=i();return vT(a[0],a[a.length-1],r==null?10:r,n)},e.nice=function(r){r==null&&(r=10);var n=i(),a=0,s=n.length-1,f=n[a],v=n[s],m;return v<f&&(m=f,f=v,v=m,m=a,a=s,s=m),m=Kv(f,v,r),m>0?(f=Math.floor(f/m)*m,v=Math.ceil(v/m)*m,m=Kv(f,v,r)):m<0&&(f=Math.ceil(f*m)/m,v=Math.floor(v*m)/m,m=Kv(f,v,r)),m>0?(n[a]=Math.floor(f/m)*m,n[s]=Math.ceil(v/m)*m,i(n)):m<0&&(n[a]=Math.ceil(f*m)/m,n[s]=Math.floor(v*m)/m,i(n)),e},e}function C_(){var e=m_(Fc,Fc);return e.copy=function(){return t0(e,C_())},fp.apply(e,arguments),a0(e)}function A_(e){var i;function r(n){return isNaN(n=+n)?i:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=Jv.call(n,K0),r):e.slice()},r.unknown=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return A_(e).unknown(i)},e=arguments.length?Jv.call(e,K0):[0,1],a0(r)}function w_(e,i){e=e.slice();var r=0,n=e.length-1,a=e[r],s=e[n],f;return s<a&&(f=r,r=n,n=f,f=a,a=s,s=f),e[r]=i.floor(a),e[n]=i.ceil(s),e}function T_(e){return Math.log(e)}function M_(e){return Math.exp(e)}function mT(e){return-Math.log(-e)}function gT(e){return-Math.exp(-e)}function yT(e){return isFinite(e)?+("1e"+e):e<0?0:e}function _T(e){return e===10?yT:e===Math.E?Math.exp:function(i){return Math.pow(e,i)}}function xT(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(i){return Math.log(i)/e})}function P_(e){return function(i){return-e(-i)}}function bT(e){var i=e(T_,M_),r=i.domain,n=10,a,s;function f(){return a=xT(n),s=_T(n),r()[0]<0?(a=P_(a),s=P_(s),e(mT,gT)):e(T_,M_),i}return i.base=function(v){return arguments.length?(n=+v,f()):n},i.domain=function(v){return arguments.length?(r(v),f()):r()},i.ticks=function(v){var m=r(),x=m[0],A=m[m.length-1],T;(T=A<x)&&(I=x,x=A,A=I);var I=a(x),F=a(A),j,X,ee,be=v==null?10:+v,Fe=[];if(!(n%1)&&F-I<be){if(I=Math.round(I)-1,F=Math.round(F)+1,x>0){for(;I<F;++I)for(X=1,j=s(I);X<n;++X)if(ee=j*X,!(ee<x)){if(ee>A)break;Fe.push(ee)}}else for(;I<F;++I)for(X=n-1,j=s(I);X>=1;--X)if(ee=j*X,!(ee<x)){if(ee>A)break;Fe.push(ee)}}else Fe=o_(I,F,Math.min(F-I,be)).map(s);return T?Fe.reverse():Fe},i.tickFormat=function(v,m){if(m==null&&(m=n===10?".0e":","),typeof m!="function"&&(m=em(m)),v===Infinity)return m;v==null&&(v=10);var x=Math.max(1,n*v/i.ticks().length);return function(A){var T=A/s(Math.round(a(A)));return T*n<n-.5&&(T*=n),T<=x?m(A):""}},i.nice=function(){return r(w_(r(),{floor:function(v){return s(Math.floor(a(v)))},ceil:function(v){return s(Math.ceil(a(v)))}}))},i}function O_(){var e=bT(Q0()).domain([1,10]);return e.copy=function(){return t0(e,O_()).base(e.base())},fp.apply(e,arguments),e}function I_(e){return function(i){return Math.sign(i)*Math.log1p(Math.abs(i/e))}}function R_(e){return function(i){return Math.sign(i)*Math.expm1(Math.abs(i))*e}}function ET(e){var i=1,r=e(I_(i),R_(i));return r.constant=function(n){return arguments.length?e(I_(i=+n),R_(i)):i},linearish(r)}function ST(){var e=ET(transformer());return e.copy=function(){return copy(e,ST()).constant(e.constant())},initRange.apply(e,arguments)}function k_(e){return function(i){return i<0?-Math.pow(-i,e):Math.pow(i,e)}}function CT(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function AT(e){return e<0?-e*e:e*e}function wT(e){var i=e(Fc,Fc),r=1;function n(){return r===1?e(Fc,Fc):r===.5?e(CT,AT):e(k_(r),k_(1/r))}return i.exponent=function(a){return arguments.length?(r=+a,n()):r},a0(i)}function tm(){var e=wT(Q0());return e.copy=function(){return t0(e,tm()).exponent(e.exponent())},fp.apply(e,arguments),e}function fO(){return tm.apply(null,arguments).exponent(.5)}function L_(){var e=[],i=[],r=[],n;function a(){var f=0,v=Math.max(1,i.length);for(r=new Array(v-1);++f<v;)r[f-1]=Yw(e,f/v);return s}function s(f){return isNaN(f=+f)?n:i[qv(r,f)]}return s.invertExtent=function(f){var v=i.indexOf(f);return v<0?[NaN,NaN]:[v>0?r[v-1]:e[0],v<r.length?r[v]:e[e.length-1]]},s.domain=function(f){if(!arguments.length)return e.slice();e=[];for(var v=0,m=f.length,x;v<m;++v)x=f[v],x!=null&&!isNaN(x=+x)&&e.push(x);return e.sort(G0),a()},s.range=function(f){return arguments.length?(i=Gp.call(f),a()):i.slice()},s.unknown=function(f){return arguments.length?(n=f,s):n},s.quantiles=function(){return r.slice()},s.copy=function(){return L_().domain(e).range(i).unknown(n)},fp.apply(s,arguments)}function D_(){var e=0,i=1,r=1,n=[.5],a=[0,1],s;function f(m){return m<=m?a[qv(n,m,0,r)]:s}function v(){var m=-1;for(n=new Array(r);++m<r;)n[m]=((m+1)*i-(m-r)*e)/(r+1);return f}return f.domain=function(m){return arguments.length?(e=+m[0],i=+m[1],v()):[e,i]},f.range=function(m){return arguments.length?(r=(a=Gp.call(m)).length-1,v()):a.slice()},f.invertExtent=function(m){var x=a.indexOf(m);return x<0?[NaN,NaN]:x<1?[e,n[0]]:x>=r?[n[r-1],i]:[n[x-1],n[x]]},f.unknown=function(m){return arguments.length&&(s=m),f},f.thresholds=function(){return n.slice()},f.copy=function(){return D_().domain([e,i]).range(a).unknown(s)},fp.apply(a0(f),arguments)}function F_(){var e=[.5],i=[0,1],r,n=1;function a(s){return s<=s?i[qv(e,s,0,n)]:r}return a.domain=function(s){return arguments.length?(e=Gp.call(s),n=Math.min(e.length,i.length-1),a):e.slice()},a.range=function(s){return arguments.length?(i=Gp.call(s),n=Math.min(e.length,i.length-1),a):i.slice()},a.invertExtent=function(s){var f=i.indexOf(s);return[e[f-1],e[f]]},a.unknown=function(s){return arguments.length?(r=s,a):r},a.copy=function(){return F_().domain(e).range(i).unknown(r)},fp.apply(a,arguments)}var rm=new Date,nm=new Date;function sl(e,i,r,n){function a(s){return e(s=arguments.length===0?new Date:new Date(+s)),s}return a.floor=function(s){return e(s=new Date(+s)),s},a.ceil=function(s){return e(s=new Date(s-1)),i(s,1),e(s),s},a.round=function(s){var f=a(s),v=a.ceil(s);return s-f<v-s?f:v},a.offset=function(s,f){return i(s=new Date(+s),f==null?1:Math.floor(f)),s},a.range=function(s,f,v){var m=[],x;if(s=a.ceil(s),v=v==null?1:Math.floor(v),!(s<f)||!(v>0))return m;do m.push(x=new Date(+s)),i(s,v),e(s);while(x<s&&s<f);return m},a.filter=function(s){return sl(function(f){if(f>=f)for(;e(f),!s(f);)f.setTime(f-1)},function(f,v){if(f>=f)if(v<0)for(;++v<=0;)for(;i(f,-1),!s(f););else for(;--v>=0;)for(;i(f,1),!s(f););})},r&&(a.count=function(s,f){return rm.setTime(+s),nm.setTime(+f),e(rm),e(nm),Math.floor(r(rm,nm))},a.every=function(s){return s=Math.floor(s),!isFinite(s)||!(s>0)?null:s>1?a.filter(n?function(f){return n(f)%s==0}:function(f){return a.count(0,f)%s==0}):a}),a}var im=sl(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,i){e.setFullYear(e.getFullYear()+i)},function(e,i){return i.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});im.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:sl(function(i){i.setFullYear(Math.floor(i.getFullYear()/e)*e),i.setMonth(0,1),i.setHours(0,0,0,0)},function(i,r){i.setFullYear(i.getFullYear()+r*e)})};var Sd=im,hO=im.range,B_=sl(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,i){e.setMonth(e.getMonth()+i)},function(e,i){return i.getMonth()-e.getMonth()+(i.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),TT=B_,pO=B_.range,o0=1e3,sv=6e4,N_=36e5,z_=864e5,U_=6048e5;function Hp(e){return sl(function(i){i.setDate(i.getDate()-(i.getDay()+7-e)%7),i.setHours(0,0,0,0)},function(i,r){i.setDate(i.getDate()+r*7)},function(i,r){return(r-i-(r.getTimezoneOffset()-i.getTimezoneOffset())*sv)/U_})}var am=Hp(0),s0=Hp(1),MT=Hp(2),PT=Hp(3),Cd=Hp(4),OT=Hp(5),IT=Hp(6),dO=am.range,vO=s0.range,mO=MT.range,gO=PT.range,yO=Cd.range,_O=OT.range,xO=IT.range,Z_=sl(function(e){e.setHours(0,0,0,0)},function(e,i){e.setDate(e.getDate()+i)},function(e,i){return(i-e-(i.getTimezoneOffset()-e.getTimezoneOffset())*sv)/z_},function(e){return e.getDate()-1}),om=Z_,bO=Z_.range,j_=sl(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*o0-e.getMinutes()*sv)},function(e,i){e.setTime(+e+i*N_)},function(e,i){return(i-e)/N_},function(e){return e.getHours()}),RT=j_,EO=j_.range,V_=sl(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*o0)},function(e,i){e.setTime(+e+i*sv)},function(e,i){return(i-e)/sv},function(e){return e.getMinutes()}),kT=V_,SO=V_.range,G_=sl(function(e){e.setTime(e-e.getMilliseconds())},function(e,i){e.setTime(+e+i*o0)},function(e,i){return(i-e)/o0},function(e){return e.getUTCSeconds()}),LT=G_,CO=G_.range,u0=sl(function(){},function(e,i){e.setTime(+e+i)},function(e,i){return i-e});u0.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?sl(function(i){i.setTime(Math.floor(i/e)*e)},function(i,r){i.setTime(+i+r*e)},function(i,r){return(r-i)/e}):u0};var DT=u0,AO=u0.range;function Wp(e){return sl(function(i){i.setUTCDate(i.getUTCDate()-(i.getUTCDay()+7-e)%7),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCDate(i.getUTCDate()+r*7)},function(i,r){return(r-i)/U_})}var H_=Wp(0),l0=Wp(1),FT=Wp(2),BT=Wp(3),Ad=Wp(4),NT=Wp(5),zT=Wp(6),wO=H_.range,TO=l0.range,MO=FT.range,PO=BT.range,OO=Ad.range,IO=NT.range,RO=zT.range,W_=sl(function(e){e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCDate(e.getUTCDate()+i)},function(e,i){return(i-e)/z_},function(e){return e.getUTCDate()-1}),X_=W_,kO=W_.range,sm=sl(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCFullYear(e.getUTCFullYear()+i)},function(e,i){return i.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});sm.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:sl(function(i){i.setUTCFullYear(Math.floor(i.getUTCFullYear()/e)*e),i.setUTCMonth(0,1),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCFullYear(i.getUTCFullYear()+r*e)})};var uv=sm,LO=sm.range;function um(e){if(0<=e.y&&e.y<100){var i=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return i.setFullYear(e.y),i}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function lm(e){if(0<=e.y&&e.y<100){var i=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return i.setUTCFullYear(e.y),i}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function lv(e,i,r){return{y:e,m:i,d:r,H:0,M:0,S:0,L:0}}function UT(e){var i=e.dateTime,r=e.date,n=e.time,a=e.periods,s=e.days,f=e.shortDays,v=e.months,m=e.shortMonths,x=cv(a),A=fv(a),T=cv(s),I=fv(s),F=cv(f),j=fv(f),X=cv(v),ee=fv(v),be=cv(m),Fe=fv(m),We={a:Ls,A:Ds,b:Ys,B:vf,c:null,d:J_,e:J_,f:lM,g:_M,G:bM,H:oM,I:sM,j:uM,L:e1,m:cM,M:fM,p:E0,q:a3,Q:o1,s:s1,S:hM,u:pM,U:dM,V:vM,w:mM,W:gM,x:null,X:null,y:yM,Y:xM,Z:EM,"%":a1},et={a:o3,A:s3,b:u3,B:l3,c:null,d:r1,e:r1,f:wM,g:FM,G:NM,H:SM,I:CM,j:AM,L:n1,m:TM,M:MM,p:c3,q:f3,Q:o1,s:s1,S:PM,u:OM,U:IM,V:RM,w:kM,W:LM,x:null,X:null,y:DM,Y:BM,Z:zM,"%":a1},xt={a:Qr,A:vr,b:pn,B:Tn,c:qn,d:$_,e:$_,f:rM,g:K_,G:q_,H:Q_,I:Q_,j:QT,L:tM,m:$T,M:JT,p:Ar,q:KT,Q:iM,s:aM,S:eM,u:HT,U:WT,V:XT,w:GT,W:YT,x:Ba,X:qo,y:K_,Y:q_,Z:qT,"%":nM};We.x=Ct(r,We),We.X=Ct(n,We),We.c=Ct(i,We),et.x=Ct(r,et),et.X=Ct(n,et),et.c=Ct(i,et);function Ct(oi,Ia){return function(io){var gn=[],Pl=-1,Uo=0,nc=oi.length,ic,Yp,Yx;for(io instanceof Date||(io=new Date(+io));++Pl<nc;)oi.charCodeAt(Pl)===37&&(gn.push(oi.slice(Uo,Pl)),(Yp=Y_[ic=oi.charAt(++Pl)])!=null?ic=oi.charAt(++Pl):Yp=ic==="e"?" ":"0",(Yx=Ia[ic])&&(ic=Yx(io,Yp)),gn.push(ic),Uo=Pl+1);return gn.push(oi.slice(Uo,Pl)),gn.join("")}}function Yt(oi,Ia){return function(io){var gn=lv(1900,void 0,1),Pl=ar(gn,oi,io+="",0),Uo,nc;if(Pl!=io.length)return null;if("Q"in gn)return new Date(gn.Q);if("s"in gn)return new Date(gn.s*1e3+("L"in gn?gn.L:0));if(Ia&&!("Z"in gn)&&(gn.Z=0),"p"in gn&&(gn.H=gn.H%12+gn.p*12),gn.m===void 0&&(gn.m="q"in gn?gn.q:0),"V"in gn){if(gn.V<1||gn.V>53)return null;"w"in gn||(gn.w=1),"Z"in gn?(Uo=lm(lv(gn.y,0,1)),nc=Uo.getUTCDay(),Uo=nc>4||nc===0?l0.ceil(Uo):l0(Uo),Uo=X_.offset(Uo,(gn.V-1)*7),gn.y=Uo.getUTCFullYear(),gn.m=Uo.getUTCMonth(),gn.d=Uo.getUTCDate()+(gn.w+6)%7):(Uo=um(lv(gn.y,0,1)),nc=Uo.getDay(),Uo=nc>4||nc===0?s0.ceil(Uo):s0(Uo),Uo=om.offset(Uo,(gn.V-1)*7),gn.y=Uo.getFullYear(),gn.m=Uo.getMonth(),gn.d=Uo.getDate()+(gn.w+6)%7)}else("W"in gn||"U"in gn)&&("w"in gn||(gn.w="u"in gn?gn.u%7:"W"in gn?1:0),nc="Z"in gn?lm(lv(gn.y,0,1)).getUTCDay():um(lv(gn.y,0,1)).getDay(),gn.m=0,gn.d="W"in gn?(gn.w+6)%7+gn.W*7-(nc+5)%7:gn.w+gn.U*7-(nc+6)%7);return"Z"in gn?(gn.H+=gn.Z/100|0,gn.M+=gn.Z%100,lm(gn)):um(gn)}}function ar(oi,Ia,io,gn){for(var Pl=0,Uo=Ia.length,nc=io.length,ic,Yp;Pl<Uo;){if(gn>=nc)return-1;if(ic=Ia.charCodeAt(Pl++),ic===37){if(ic=Ia.charAt(Pl++),Yp=xt[ic in Y_?Ia.charAt(Pl++):ic],!Yp||(gn=Yp(oi,io,gn))<0)return-1}else if(ic!=io.charCodeAt(gn++))return-1}return gn}function Ar(oi,Ia,io){var gn=x.exec(Ia.slice(io));return gn?(oi.p=A[gn[0].toLowerCase()],io+gn[0].length):-1}function Qr(oi,Ia,io){var gn=F.exec(Ia.slice(io));return gn?(oi.w=j[gn[0].toLowerCase()],io+gn[0].length):-1}function vr(oi,Ia,io){var gn=T.exec(Ia.slice(io));return gn?(oi.w=I[gn[0].toLowerCase()],io+gn[0].length):-1}function pn(oi,Ia,io){var gn=be.exec(Ia.slice(io));return gn?(oi.m=Fe[gn[0].toLowerCase()],io+gn[0].length):-1}function Tn(oi,Ia,io){var gn=X.exec(Ia.slice(io));return gn?(oi.m=ee[gn[0].toLowerCase()],io+gn[0].length):-1}function qn(oi,Ia,io){return ar(oi,i,Ia,io)}function Ba(oi,Ia,io){return ar(oi,r,Ia,io)}function qo(oi,Ia,io){return ar(oi,n,Ia,io)}function Ls(oi){return f[oi.getDay()]}function Ds(oi){return s[oi.getDay()]}function Ys(oi){return m[oi.getMonth()]}function vf(oi){return v[oi.getMonth()]}function E0(oi){return a[+(oi.getHours()>=12)]}function a3(oi){return 1+~~(oi.getMonth()/3)}function o3(oi){return f[oi.getUTCDay()]}function s3(oi){return s[oi.getUTCDay()]}function u3(oi){return m[oi.getUTCMonth()]}function l3(oi){return v[oi.getUTCMonth()]}function c3(oi){return a[+(oi.getUTCHours()>=12)]}function f3(oi){return 1+~~(oi.getUTCMonth()/3)}return{format:function(oi){var Ia=Ct(oi+="",We);return Ia.toString=function(){return oi},Ia},parse:function(oi){var Ia=Yt(oi+="",!1);return Ia.toString=function(){return oi},Ia},utcFormat:function(oi){var Ia=Ct(oi+="",et);return Ia.toString=function(){return oi},Ia},utcParse:function(oi){var Ia=Yt(oi+="",!0);return Ia.toString=function(){return oi},Ia}}}var Y_={"-":"",_:" ","0":"0"},xu=/^\s*\d+/,ZT=/^%/,jT=/[\\^$*+?|[\]().{}]/g;function no(e,i,r){var n=e<0?"-":"",a=(n?-e:e)+"",s=a.length;return n+(s<r?new Array(r-s+1).join(i)+a:a)}function VT(e){return e.replace(jT,"\\$&")}function cv(e){return new RegExp("^(?:"+e.map(VT).join("|")+")","i")}function fv(e){for(var i={},r=-1,n=e.length;++r<n;)i[e[r].toLowerCase()]=r;return i}function GT(e,i,r){var n=xu.exec(i.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function HT(e,i,r){var n=xu.exec(i.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function WT(e,i,r){var n=xu.exec(i.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function XT(e,i,r){var n=xu.exec(i.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function YT(e,i,r){var n=xu.exec(i.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function q_(e,i,r){var n=xu.exec(i.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function K_(e,i,r){var n=xu.exec(i.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function qT(e,i,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(i.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function KT(e,i,r){var n=xu.exec(i.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function $T(e,i,r){var n=xu.exec(i.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function $_(e,i,r){var n=xu.exec(i.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function QT(e,i,r){var n=xu.exec(i.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function Q_(e,i,r){var n=xu.exec(i.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function JT(e,i,r){var n=xu.exec(i.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function eM(e,i,r){var n=xu.exec(i.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function tM(e,i,r){var n=xu.exec(i.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function rM(e,i,r){var n=xu.exec(i.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function nM(e,i,r){var n=ZT.exec(i.slice(r,r+1));return n?r+n[0].length:-1}function iM(e,i,r){var n=xu.exec(i.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function aM(e,i,r){var n=xu.exec(i.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function J_(e,i){return no(e.getDate(),i,2)}function oM(e,i){return no(e.getHours(),i,2)}function sM(e,i){return no(e.getHours()%12||12,i,2)}function uM(e,i){return no(1+om.count(Sd(e),e),i,3)}function e1(e,i){return no(e.getMilliseconds(),i,3)}function lM(e,i){return e1(e,i)+"000"}function cM(e,i){return no(e.getMonth()+1,i,2)}function fM(e,i){return no(e.getMinutes(),i,2)}function hM(e,i){return no(e.getSeconds(),i,2)}function pM(e){var i=e.getDay();return i===0?7:i}function dM(e,i){return no(am.count(Sd(e)-1,e),i,2)}function t1(e){var i=e.getDay();return i>=4||i===0?Cd(e):Cd.ceil(e)}function vM(e,i){return e=t1(e),no(Cd.count(Sd(e),e)+(Sd(e).getDay()===4),i,2)}function mM(e){return e.getDay()}function gM(e,i){return no(s0.count(Sd(e)-1,e),i,2)}function yM(e,i){return no(e.getFullYear()%100,i,2)}function _M(e,i){return e=t1(e),no(e.getFullYear()%100,i,2)}function xM(e,i){return no(e.getFullYear()%1e4,i,4)}function bM(e,i){var r=e.getDay();return e=r>=4||r===0?Cd(e):Cd.ceil(e),no(e.getFullYear()%1e4,i,4)}function EM(e){var i=e.getTimezoneOffset();return(i>0?"-":(i*=-1,"+"))+no(i/60|0,"0",2)+no(i%60,"0",2)}function r1(e,i){return no(e.getUTCDate(),i,2)}function SM(e,i){return no(e.getUTCHours(),i,2)}function CM(e,i){return no(e.getUTCHours()%12||12,i,2)}function AM(e,i){return no(1+X_.count(uv(e),e),i,3)}function n1(e,i){return no(e.getUTCMilliseconds(),i,3)}function wM(e,i){return n1(e,i)+"000"}function TM(e,i){return no(e.getUTCMonth()+1,i,2)}function MM(e,i){return no(e.getUTCMinutes(),i,2)}function PM(e,i){return no(e.getUTCSeconds(),i,2)}function OM(e){var i=e.getUTCDay();return i===0?7:i}function IM(e,i){return no(H_.count(uv(e)-1,e),i,2)}function i1(e){var i=e.getUTCDay();return i>=4||i===0?Ad(e):Ad.ceil(e)}function RM(e,i){return e=i1(e),no(Ad.count(uv(e),e)+(uv(e).getUTCDay()===4),i,2)}function kM(e){return e.getUTCDay()}function LM(e,i){return no(l0.count(uv(e)-1,e),i,2)}function DM(e,i){return no(e.getUTCFullYear()%100,i,2)}function FM(e,i){return e=i1(e),no(e.getUTCFullYear()%100,i,2)}function BM(e,i){return no(e.getUTCFullYear()%1e4,i,4)}function NM(e,i){var r=e.getUTCDay();return e=r>=4||r===0?Ad(e):Ad.ceil(e),no(e.getUTCFullYear()%1e4,i,4)}function zM(){return"+0000"}function a1(){return"%"}function o1(e){return+e}function s1(e){return Math.floor(+e/1e3)}var wd,u1,UM,ZM,jM;VM({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function VM(e){return wd=UT(e),u1=wd.format,UM=wd.parse,ZM=wd.utcFormat,jM=wd.utcParse,wd}var hv=1e3,pv=hv*60,dv=pv*60,vv=dv*24,GM=vv*7,l1=vv*30,cm=vv*365;function HM(e){return new Date(e)}function WM(e){return e instanceof Date?+e:+new Date(+e)}function c1(e,i,r,n,a,s,f,v,m){var x=m_(Fc,Fc),A=x.invert,T=x.domain,I=m(".%L"),F=m(":%S"),j=m("%I:%M"),X=m("%I %p"),ee=m("%a %d"),be=m("%b %d"),Fe=m("%B"),We=m("%Y"),et=[[f,1,hv],[f,5,5*hv],[f,15,15*hv],[f,30,30*hv],[s,1,pv],[s,5,5*pv],[s,15,15*pv],[s,30,30*pv],[a,1,dv],[a,3,3*dv],[a,6,6*dv],[a,12,12*dv],[n,1,vv],[n,2,2*vv],[r,1,GM],[i,1,l1],[i,3,3*l1],[e,1,cm]];function xt(Yt){return(f(Yt)<Yt?I:s(Yt)<Yt?F:a(Yt)<Yt?j:n(Yt)<Yt?X:i(Yt)<Yt?r(Yt)<Yt?ee:be:e(Yt)<Yt?Fe:We)(Yt)}function Ct(Yt,ar,Ar,Qr){if(Yt==null&&(Yt=10),typeof Yt=="number"){var vr=Math.abs(Ar-ar)/Yt,pn=n_(function(Tn){return Tn[2]}).right(et,vr);pn===et.length?(Qr=Y0(ar/cm,Ar/cm,Yt),Yt=e):pn?(pn=et[vr/et[pn-1][2]<et[pn][2]/vr?pn-1:pn],Qr=pn[1],Yt=pn[0]):(Qr=Math.max(Y0(ar,Ar,Yt),1),Yt=v)}return Qr==null?Yt:Yt.every(Qr)}return x.invert=function(Yt){return new Date(A(Yt))},x.domain=function(Yt){return arguments.length?T(Jv.call(Yt,WM)):T().map(HM)},x.ticks=function(Yt,ar){var Ar=T(),Qr=Ar[0],vr=Ar[Ar.length-1],pn=vr<Qr,Tn;return pn&&(Tn=Qr,Qr=vr,vr=Tn),Tn=Ct(Yt,Qr,vr,ar),Tn=Tn?Tn.range(Qr,vr+1):[],pn?Tn.reverse():Tn},x.tickFormat=function(Yt,ar){return ar==null?xt:m(ar)},x.nice=function(Yt,ar){var Ar=T();return(Yt=Ct(Yt,Ar[0],Ar[Ar.length-1],ar))?T(w_(Ar,Yt)):x},x.copy=function(){return t0(x,c1(e,i,r,n,a,s,f,v,m))},x}function XM(){return fp.apply(c1(Sd,TT,am,om,RT,kT,LT,DT,u1).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function DO(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function c0(){var e=0,i=1,r,n,a,s,f=identity,v=!1,m;function x(A){return isNaN(A=+A)?m:f(a===0?.5:(A=(s(A)-r)*a,v?Math.max(0,Math.min(1,A)):A))}return x.domain=function(A){return arguments.length?(r=s(e=+A[0]),n=s(i=+A[1]),a=r===n?0:1/(n-r),x):[e,i]},x.clamp=function(A){return arguments.length?(v=!!A,x):v},x.interpolator=function(A){return arguments.length?(f=A,x):f},x.unknown=function(A){return arguments.length?(m=A,x):m},function(A){return s=A,r=A(e),n=A(i),a=r===n?0:1/(n-r),x}}function f0(e,i){return i.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function YM(){var e=linearish(c0()(identity));return e.copy=function(){return f0(e,YM())},initInterpolator.apply(e,arguments)}function qM(){var e=loggish(c0()).domain([1,10]);return e.copy=function(){return f0(e,qM()).base(e.base())},initInterpolator.apply(e,arguments)}function KM(){var e=symlogish(c0());return e.copy=function(){return f0(e,KM()).constant(e.constant())},initInterpolator.apply(e,arguments)}function f1(){var e=powish(c0());return e.copy=function(){return f0(e,f1()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function FO(){return f1.apply(null,arguments).exponent(.5)}function $M(){var e=[],i=identity;function r(n){if(!isNaN(n=+n))return i((bisect(e,n)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(var a=0,s=n.length,f;a<s;++a)f=n[a],f!=null&&!isNaN(f=+f)&&e.push(f);return e.sort(ascending),r},r.interpolator=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return $M(i).domain(e)},initInterpolator.apply(r,arguments)}function h0(){var e=0,i=.5,r=1,n,a,s,f,v,m=identity,x,A=!1,T;function I(F){return isNaN(F=+F)?T:(F=.5+((F=+x(F))-a)*(F<a?f:v),m(A?Math.max(0,Math.min(1,F)):F))}return I.domain=function(F){return arguments.length?(n=x(e=+F[0]),a=x(i=+F[1]),s=x(r=+F[2]),f=n===a?0:.5/(a-n),v=a===s?0:.5/(s-a),I):[e,i,r]},I.clamp=function(F){return arguments.length?(A=!!F,I):A},I.interpolator=function(F){return arguments.length?(m=F,I):m},I.unknown=function(F){return arguments.length?(T=F,I):T},function(F){return x=F,n=F(e),a=F(i),s=F(r),f=n===a?0:.5/(a-n),v=a===s?0:.5/(s-a),I}}function QM(){var e=linearish(h0()(identity));return e.copy=function(){return copy(e,QM())},initInterpolator.apply(e,arguments)}function JM(){var e=loggish(h0()).domain([.1,1,10]);return e.copy=function(){return copy(e,JM()).base(e.base())},initInterpolator.apply(e,arguments)}function e5(){var e=symlogish(h0());return e.copy=function(){return copy(e,e5()).constant(e.constant())},initInterpolator.apply(e,arguments)}function h1(){var e=powish(h0());return e.copy=function(){return copy(e,h1()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function BO(){return h1.apply(null,arguments).exponent(.5)}var pf,p1,d1,v1,fm,m1,t5=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,r5=(pf={},(0,S.Z)(pf,lu.LINEAR,C_),(0,S.Z)(pf,lu.POWER,tm),(0,S.Z)(pf,lu.LOG,O_),(0,S.Z)(pf,lu.IDENTITY,A_),(0,S.Z)(pf,lu.TIME,XM),(0,S.Z)(pf,lu.QUANTILE,L_),(0,S.Z)(pf,lu.QUANTIZE,D_),(0,S.Z)(pf,lu.THRESHOLD,F_),(0,S.Z)(pf,lu.CAT,e0),pf),n5=(p1=(0,Xr.b2)(),d1=(0,Xr.f3)(yt.IGlobalConfigService),p1(v1=(fm=function(){function e(){(0,ht.Z)(this,e),Ln(this,"configService",m1,this),(0,S.Z)(this,"scaleCache",{}),(0,S.Z)(this,"scaleOptions",{})}return(0,Pt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("FeatureScalePlugin",function(){a.scaleOptions=r.getScaleOptions();var f=s.getLayerStyleAttributes(),v=r.getSource().data.dataArray;v.length!==0&&a.caculateScalesForAttributes(f||[],v)}),r.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){a.scaleOptions=r.getScaleOptions();var f=s.getLayerStyleAttributes(),v=r.getSource().data.dataArray;return a.caculateScalesForAttributes(f||[],v),r.layerModelNeedUpdate=!0,!0}),r.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!r.layerModelNeedUpdate){a.scaleOptions=r.getScaleOptions();var f=s.getLayerStyleAttributes();if(f){var v=r.getSource().data.dataArray;if(v.length===0)return;var m=f.filter(function(x){return x.needRescale});m.length&&a.caculateScalesForAttributes(m,v)}}})}},{key:"isNumber",value:function(r){return!isNaN(parseFloat(r))&&isFinite(r)}},{key:"caculateScalesForAttributes",value:function(r,n){var a=this;this.scaleCache={},r.forEach(function(s){if(s.scale){var f=s.scale,v=s.name;f.names=a.parseFields(s.scale.field||[]);var m=[];f.names.forEach(function(x){m.push(a.getOrCreateScale(x,s,n))}),m.some(function(x){return x.type===ip.VARIABLE})?(f.type=ip.VARIABLE,m.forEach(function(x){if(!f.callback){var A;if(f.values&&f.values!=="text"){var T;if(((T=x.option)===null||T===void 0?void 0:T.type)==="linear"&&f.values.length>2){var I=x.scale.ticks(f.values.length);v==="color"&&x.scale.domain(I)}x.scale.range(f.values)}else((A=x.option)===null||A===void 0?void 0:A.type)==="cat"&&x.scale.range(x.option.domain)}})):(f.type=ip.CONSTANT,f.defaultValues=m.map(function(x,A){return x.scale(f.names[A])})),f.scalers=m.map(function(x){return{field:x.field,func:x.scale,option:x.option}}),s.needRescale=!1}})}},{key:"getOrCreateScale",value:function(r,n,a){var s,f=[r,n.name].join("_"),v=(s=n.scale)===null||s===void 0?void 0:s.values,m=this.createScale(r,n.name,v,a);return m}},{key:"parseFields",value:function(r){return Array.isArray(r)?r:w()(r)?r.split("*"):[r]}},{key:"createScale",value:function(r,n,a,s){var f,v,m=this.scaleOptions[n]&&((f=this.scaleOptions[n])===null||f===void 0?void 0:f.field)===r?this.scaleOptions[n]:this.scaleOptions[r],x={field:r,scale:void 0,type:ip.VARIABLE,option:m};if(!s||!s.length)return m&&m.type?x.scale=this.createDefaultScale(m):(x.scale=e0([r]),x.type=ip.CONSTANT),x;var A=(v=s.find(function(F){return!Ci()(F[r])}))===null||v===void 0?void 0:v[r];if(this.isNumber(r)||Ci()(A)&&!m)x.scale=e0([r]),x.type=ip.CONSTANT;else{var T=m&&m.type||this.getDefaultType(A);a==="text"&&(T=lu.CAT);var I=this.createDefaultScaleConfig(T,r,s);Object.assign(I,m),x.scale=this.createDefaultScale(I),x.option=I}return x}},{key:"getDefaultType",value:function(r){var n=lu.LINEAR;return typeof r=="string"&&(n=t5.test(r)?lu.TIME:lu.CAT),n}},{key:"createDefaultScaleConfig",value:function(r,n,a){var s={type:r},f=(a==null?void 0:a.map(function(v){return v[n]}))||[];return r!==lu.CAT&&r!==lu.QUANTILE?s.domain=Ww(f):r===lu.CAT?s.domain=Co()(f):r===lu.QUANTILE&&(s.domain=f),s}},{key:"createDefaultScale",value:function(r){var n=r.type,a=r.domain,s=r5[n]();return a&&s.domain(a),s}}]),e}(),m1=ri(fm.prototype,"configService",[d1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fm))||v1),g1,y1,_1,x1,p0,b1,E1;function S1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function i5(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?S1(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):S1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var a5=(g1=(0,Xr.b2)(),y1=(0,Xr.f3)(yt.ICameraService),_1=(0,Xr.f3)(yt.IRendererService),g1(x1=(p0=function(){function e(){(0,ht.Z)(this,e),Ln(this,"cameraService",b1,this),Ln(this,"rendererService",E1,this)}return(0,Pt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){r.models.forEach(function(n){n.addUniforms(i5({},r.layerModel.getAnimateUniforms()))})})}}]),e}(),b1=ri(p0.prototype,"cameraService",[y1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E1=ri(p0.prototype,"rendererService",[_1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),p0))||x1),C1,A1,o5=(C1=(0,Xr.b2)(),C1(A1=function(){function e(){(0,ht.Z)(this,e)}return(0,Pt.Z)(e,[{key:"apply",value:function(r){r.hooks.init.tap("LayerModelPlugin",function(){r.prepareBuildModel(),r.buildModels(),r.styleNeedUpdate=!1}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return r.prepareBuildModel(),r.clearModels(),r.buildModels(),r.layerModelNeedUpdate=!1,!1})}}]),e}())||A1),w1,T1,s5=(w1=(0,Xr.b2)(),w1(T1=function(){function e(){(0,ht.Z)(this,e)}return(0,Pt.Z)(e,[{key:"apply",value:function(r){r.hooks.afterInit.tap("LayerStylePlugin",function(){r.updateLayerConfig({});var n=r.getLayerConfig(),a=n.autoFit,s=n.fitBoundsOptions;a&&setTimeout(function(){r.fitBounds(s)},100)})}}]),e}())||T1),M1,P1,u5=["type"];function O1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function mv(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?O1(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var I1={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},l5={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},c5={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},f5={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},NO=null;function h5(e){var i={u_DirectionalLights:new Array(3).fill(mv({},c5)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(mv({},f5)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[l5]),e.forEach(function(r,n){var a=r.type,s=a===void 0?"directional":a,f=(0,Ga.Z)(r,u5),v=I1[s].lights,m=I1[s].num,x=i[m];i[v][x]=mv(mv({},i[v][x]),f),i[m]++}),i}var p5=(M1=(0,Xr.b2)(),M1(P1=function(){function e(){(0,ht.Z)(this,e)}return(0,Pt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LightingPlugin",function(){var n=r.getLayerConfig(),a=n.enableLighting;a&&r.models.forEach(function(s){return s.addUniforms(mv({},h5()))})})}}]),e}())||P1),R1,k1,L1,hm,D1,d5=(R1=(0,Xr.b2)(),k1=(0,Xr.f3)(yt.IGlobalConfigService),R1(L1=(hm=function(){function e(){(0,ht.Z)(this,e),Ln(this,"configService",D1,this),(0,S.Z)(this,"enabled",void 0)}return(0,Pt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.rendererService,f=n.postProcessingPassFactory,v=n.normalPassFactory;r.hooks.init.tap("MultiPassRendererPlugin",function(){var m=r.getLayerConfig(),x=m.enableMultiPassRenderer,A=m.passes,T=A===void 0?[]:A;a.enabled=!!x&&r.getLayerConfig().enableMultiPassRenderer!==!1,a.enabled&&(r.multiPassRenderer=Xg(r,T,f,v),r.multiPassRenderer.setRenderFlag(!0))}),r.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(a.enabled){var m=s.getViewportSize(),x=m.width,A=m.height;r.multiPassRenderer.resize(x,A)}})}}]),e}(),D1=ri(hm.prototype,"configService",[k1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hm))||L1),F1,B1,d0={NONE:0,ENCODE:1,HIGHLIGHT:2},v5=(F1=(0,Xr.b2)(),F1(B1=function(){function e(){(0,ht.Z)(this,e)}return(0,Pt.Z)(e,[{key:"apply",value:function(r,n){var a=n.rendererService,s=n.styleAttributeService;r.hooks.init.tap("PixelPickingPlugin",function(){var f=!0;s.registerStyleAttribute({name:"pickingColor",type:Fn.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:k.FLOAT},size:3,update:function(m,x){var A=m.id;return f?os(A):[0,0,0]}}})}),r.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var f=r.getLayerConfig(),v=f.enablePicking;v&&r.isVisible()&&r.models.forEach(function(m){return m.addUniforms({u_PickingStage:d0.ENCODE})})}),r.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var f=r.getLayerConfig(),v=f.enablePicking;v&&r.isVisible()&&r.models.forEach(function(m){return m.addUniforms({u_PickingStage:d0.HIGHLIGHT})})}),r.hooks.beforeHighlight.tap("PixelPickingPlugin",function(f){var v=r.getLayerConfig(),m=v.highlightColor,x=v.activeMix,A=x===void 0?0:x,T=typeof m=="string"?pi(m):m||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:zs(new Uint8Array(f))}),r.models.forEach(function(I){return I.addUniforms({u_PickingStage:d0.HIGHLIGHT,u_PickingColor:f,u_HighlightColor:T.map(function(F){return F*255}),u_activeMix:A})})}),r.hooks.beforeSelect.tap("PixelPickingPlugin",function(f){var v=r.getLayerConfig(),m=v.selectColor,x=v.selectMix,A=x===void 0?0:x,T=typeof m=="string"?pi(m):m||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:zs(new Uint8Array(f))}),r.models.forEach(function(I){return I.addUniforms({u_PickingStage:d0.HIGHLIGHT,u_PickingColor:f,u_HighlightColor:T.map(function(F){return F*255}),u_activeMix:A,u_CurrentSelectedId:f,u_SelectColor:T.map(function(F){return F*255}),u_EnableSelect:1})})})}}]),e}())||B1),N1,z1,m5=(N1=(0,Xr.b2)(),N1(z1=function(){function e(){(0,ht.Z)(this,e)}return(0,Pt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("RegisterStyleAttributePlugin",function(){a.registerBuiltinAttributes(s)})}},{key:"registerBuiltinAttributes",value:function(r){r.registerStyleAttribute({name:"position",type:Fn.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:k.FLOAT},size:3,update:function(a,s,f){return f.length===2?[f[0],f[1],0]:[f[0],f[1],f[2]]}}}),r.registerStyleAttribute({name:"filter",type:Fn.Attribute,descriptor:{name:"filter",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(a,s){var f=a.filter;return f?[1]:[0]}}}),r.registerStyleAttribute({name:"color",type:Fn.Attribute,descriptor:{name:"a_Color",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:4,update:function(a,s){var f=a.color;return!f||!f.length?[1,1,1,1]:f}}}),r.registerStyleAttribute({name:"vertexId",type:Fn.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(a,s,f,v){return[s]}}})}}]),e}())||z1),U1,Z1,j1,V1,G1,H1,Td,W1,X1,Y1,q1,g5=(U1=(0,Xr.b2)(),Z1=(0,Xr.f3)(yt.ICameraService),j1=(0,Xr.f3)(yt.ICoordinateSystemService),V1=(0,Xr.f3)(yt.IRendererService),G1=(0,Xr.f3)(yt.IMapService),U1(H1=(Td=function(){function e(){(0,ht.Z)(this,e),Ln(this,"cameraService",W1,this),Ln(this,"coordinateSystemService",X1,this),Ln(this,"rendererService",Y1,this),Ln(this,"mapService",q1,this)}return(0,Pt.Z)(e,[{key:"apply",value:function(r){var n=this,a=this.mapService.version,s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],f=[0,0];r.hooks.beforeRender.tap("ShaderUniformPlugin",function(){n.coordinateSystemService.refresh(),a==="GAODE2.x"&&(s=n.mapService.map.customCoords.getMVPMatrix(),f=n.mapService.getCustomCoordCenter());var v=n.rendererService.getViewportSize(),m=v.width,x=v.height;r.models.forEach(function(A){var T;A.addUniforms((T={},(0,S.Z)(T,Bp.ProjectionMatrix,n.cameraService.getProjectionMatrix()),(0,S.Z)(T,Bp.ViewMatrix,n.cameraService.getViewMatrix()),(0,S.Z)(T,Bp.ViewProjectionMatrix,n.cameraService.getViewProjectionMatrix()),(0,S.Z)(T,Bp.Zoom,n.cameraService.getZoom()),(0,S.Z)(T,Bp.ZoomScale,n.cameraService.getZoomScale()),(0,S.Z)(T,Bp.FocalDistance,n.cameraService.getFocalDistance()),(0,S.Z)(T,Bp.CameraPosition,n.cameraService.getCameraPosition()),(0,S.Z)(T,Sc.CoordinateSystem,n.coordinateSystemService.getCoordinateSystem()),(0,S.Z)(T,Sc.ViewportCenter,n.coordinateSystemService.getViewportCenter()),(0,S.Z)(T,Sc.ViewportCenterProjection,n.coordinateSystemService.getViewportCenterProjection()),(0,S.Z)(T,Sc.PixelsPerDegree,n.coordinateSystemService.getPixelsPerDegree()),(0,S.Z)(T,Sc.PixelsPerDegree2,n.coordinateSystemService.getPixelsPerDegree2()),(0,S.Z)(T,Sc.PixelsPerMeter,n.coordinateSystemService.getPixelsPerMeter()),(0,S.Z)(T,Sc.Mvp,s),(0,S.Z)(T,"u_SceneCenterMKT",f),(0,S.Z)(T,"u_ViewportSize",[m,x]),(0,S.Z)(T,"u_ModelMatrix",n.cameraService.getModelMatrix()),(0,S.Z)(T,"u_DevicePixelRatio",ha.devicePixelRatio),(0,S.Z)(T,"u_PickingBuffer",r.getLayerConfig().pickingBuffer||0),(0,S.Z)(T,"u_shaderPick",Number(r.getShaderPickStat())),T))})})}}]),e}(),W1=ri(Td.prototype,"cameraService",[Z1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),X1=ri(Td.prototype,"coordinateSystemService",[j1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Y1=ri(Td.prototype,"rendererService",[V1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q1=ri(Td.prototype,"mapService",[G1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Td))||H1),K1,$1,y5=(K1=(0,Xr.b2)(),K1($1=function(){function e(){(0,ht.Z)(this,e)}return(0,Pt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("UpdateModelPlugin",function(){r.layerModel&&r.layerModel.needUpdate()})}}]),e}())||$1),Q1,J1,_5=(Q1=(0,Xr.b2)(),Q1(J1=function(){function e(){(0,ht.Z)(this,e)}return(0,Pt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("UpdateStyleAttributePlugin",function(){a.initStyleAttribute(r,{styleAttributeService:s})}),r.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){r.layerModelNeedUpdate||a.updateStyleAtrribute(r,{styleAttributeService:s})})}},{key:"updateStyleAtrribute",value:function(r,n){var a=n.styleAttributeService,s=a.getLayerStyleAttributes()||[],f=a.getLayerStyleAttribute("filter"),v=a.getLayerStyleAttribute("shape");if(f&&f.needRegenerateVertices){r.layerModelNeedUpdate=!0,s.forEach(function(m){return m.needRegenerateVertices=!1});return}s.filter(function(m){return m.needRegenerateVertices}).forEach(function(m){a.updateAttributeByFeatureRange(m.name,r.getEncodedData(),m.featureRange.startIndex,m.featureRange.endIndex),m.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(r,n){var a=n.styleAttributeService,s=a.getLayerStyleAttributes()||[];s.filter(function(f){return f.needRegenerateVertices}).forEach(function(f){a.updateAttributeByFeatureRange(f.name,r.getEncodedData(),f.featureRange.startIndex,f.featureRange.endIndex),f.needRegenerateVertices=!1})}}]),e}())||J1);rc.bind(yt.ILayerPlugin).to(Vw).inRequestScope(),rc.bind(yt.ILayerPlugin).to(m5).inRequestScope(),rc.bind(yt.ILayerPlugin).to(n5).inRequestScope(),rc.bind(yt.ILayerPlugin).to(jw).inRequestScope(),rc.bind(yt.ILayerPlugin).to(s5).inRequestScope(),rc.bind(yt.ILayerPlugin).to(_5).inRequestScope(),rc.bind(yt.ILayerPlugin).to(y5).inRequestScope(),rc.bind(yt.ILayerPlugin).to(d5).inRequestScope(),rc.bind(yt.ILayerPlugin).to(g5).inRequestScope(),rc.bind(yt.ILayerPlugin).to(a5).inRequestScope(),rc.bind(yt.ILayerPlugin).to(p5).inRequestScope(),rc.bind(yt.ILayerPlugin).to(v5).inRequestScope(),rc.bind(yt.ILayerPlugin).to(o5).inRequestScope();var zO="2.8.32";function ex(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function UO(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ex(Object(r),!0).forEach(function(n){x5(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ex(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function x5(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function ZO(e,i){return C5(e)||S5(e,i)||E5(e,i)||b5()}function b5(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function E5(e,i){if(!!e){if(typeof e=="string")return tx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return tx(e,i)}}function tx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function S5(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(m){s=!0,v=m}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function C5(e){if(Array.isArray(e))return e}var jO=null,VO=null,rx,pm,nx;function ix(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ax(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ix(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ix(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var A5=(rx=tv(yt.IGlobalConfigService),pm=function(){function e(i){(0,ht.Z)(this,e),Ln(this,"configService",nx,this),(0,S.Z)(this,"config",void 0),this.config=i}return(0,Pt.Z)(e,[{key:"setContainer",value:function(r,n,a,s){r.bind(yt.MapConfig).toConstantValue(ax(ax({},this.config),{},{id:n,canvas:a,hasBaseMap:s})),r.bind(yt.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),nx=ri(pm.prototype,"configService",[rx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pm),w5=Q(6158),gv=Q.n(w5);function yv(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function v0(e,i){var r=ln([],i,e);return Ze(r,r,1/r[3]),r}function GO(e,i){var r=e%i;return r<0?i+r:r}function HO(e,i,r){return r*i+(1-r)*e}function Xp(e,i){if(!e)throw new Error(i||"viewport-mercator-project: assertion failed.")}var df=Math.PI,ox=df/4,Th=df/180,sx=180/df,dm=512,vm=4003e4,T5=1.5;function ux(e){return Math.pow(2,e)}function M5(e){return Math.log2(e)}function m0(e,i){var r=(0,dn.Z)(e,2),n=r[0],a=r[1];Xp(Number.isFinite(n)&&Number.isFinite(i)),Xp(Number.isFinite(a)&&a>=-90&&a<=90,"invalid latitude"),i*=dm;var s=n*Th,f=a*Th,v=i*(s+df)/(2*df),m=i*(df-Math.log(Math.tan(ox+f*.5)))/(2*df);return[v,m]}function mm(e,i){var r=(0,dn.Z)(e,2),n=r[0],a=r[1];i*=dm;var s=n/i*(2*df)-df,f=2*(Math.atan(Math.exp(df-a/i*(2*df)))-ox);return[s*sx,f*sx]}function WO(e){var i=e.latitude;assert(Number.isFinite(i));var r=Math.cos(i*Th);return M5(vm*r)-9}function lx(e){var i=e.latitude,r=e.longitude,n=e.zoom,a=e.scale,s=e.highPrecision,f=s===void 0?!1:s;a=a!==void 0?a:ux(n),Xp(Number.isFinite(i)&&Number.isFinite(r)&&Number.isFinite(a));var v={},m=dm*a,x=Math.cos(i*Th),A=m/360,T=A/x,I=m/vm/x;if(v.pixelsPerMeter=[I,-I,I],v.metersPerPixel=[1/I,-1/I,1/I],v.pixelsPerDegree=[A,-T,I],v.degreesPerPixel=[1/A,-1/T,1/I],f){var F=Th*Math.tan(i*Th)/x,j=A*F/2,X=m/vm*F,ee=X/T*I;v.pixelsPerDegree2=[0,-j,X],v.pixelsPerMeter2=[ee,0,ee]}return v}function XO(e,i){var r=_slicedToArray(e,3),n=r[0],a=r[1],s=r[2],f=_slicedToArray(i,3),v=f[0],m=f[1],x=f[2],A=1,T=lx({longitude:n,latitude:a,scale:A,highPrecision:!0}),I=T.pixelsPerMeter,F=T.pixelsPerMeter2,j=m0(e,A);j[0]+=v*(I[0]+F[0]*m),j[1]+=m*(I[1]+F[1]*m);var X=mm(j,A),ee=(s||0)+(x||0);return Number.isFinite(s)||Number.isFinite(x)?[X[0],X[1],ee]:X}function P5(e){var i=e.height,r=e.pitch,n=e.bearing,a=e.altitude,s=e.center,f=s===void 0?null:s,v=e.flipY,m=v===void 0?!1:v,x=yv();return ch(x,x,[0,0,-a]),Kl(x,x,[1,1,1/i]),fh(x,x,-r*Th),Ea(x,x,n*Th),m&&Kl(x,x,[1,-1,1]),f&&ch(x,x,Ya.negate([],f)),x}function O5(e){var i=e.width,r=e.height,n=e.altitude,a=n===void 0?T5:n,s=e.pitch,f=s===void 0?0:s,v=e.nearZMultiplier,m=v===void 0?1:v,x=e.farZMultiplier,A=x===void 0?1:x,T=f*Th,I=Math.atan(.5/a),F=Math.sin(I)*a/Math.sin(Math.PI/2-T-I),j=Math.cos(Math.PI/2-T)*F+a;return{fov:2*Math.atan(r/2/a),aspect:i/r,focalDistance:a,near:m,far:j*A}}function I5(e){var i=e.width,r=e.height,n=e.pitch,a=e.altitude,s=e.nearZMultiplier,f=e.farZMultiplier,v=O5({width:i,height:r,altitude:a,pitch:n,nearZMultiplier:s,farZMultiplier:f}),m=v.fov,x=v.aspect,A=v.near,T=v.far,I=Tr([],m,x,A,T);return I}function R5(e,i){var r=(0,dn.Z)(e,3),n=r[0],a=r[1],s=r[2],f=s===void 0?0:s;return Xp(Number.isFinite(n)&&Number.isFinite(a)&&Number.isFinite(f)),v0(i,[n,a,f,1])}function cx(e,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=(0,dn.Z)(e,3),a=n[0],s=n[1],f=n[2];if(Xp(Number.isFinite(a)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(f)){var v=v0(i,[a,s,f,1]);return v}var m=v0(i,[a,s,0,1]),x=v0(i,[a,s,1,1]),A=m[2],T=x[2],I=A===T?0:((r||0)-A)/(T-A);return xi.lerp([],m,x,I)}var fx=yv(),k5=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=i.width,n=i.height,a=i.viewMatrix,s=a===void 0?fx:a,f=i.projectionMatrix,v=f===void 0?fx:f;(0,ht.Z)(this,e),this.width=r||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=s,this.projectionMatrix=v;var m=yv();Al(m,m,this.projectionMatrix),Al(m,m,this.viewMatrix),this.viewProjectionMatrix=m;var x=yv();Kl(x,x,[this.width/2,-this.height/2,1]),ch(x,x,[1,-1,0]),Al(x,x,this.viewProjectionMatrix);var A=Vh(yv(),x);if(!A)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=x,this.pixelUnprojectionMatrix=A,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,Pt.Z)(e,[{key:"equals",value:function(r){return r instanceof e?r.width===this.width&&r.height===this.height&&Vr(r.projectionMatrix,this.projectionMatrix)&&Vr(r.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=n.topLeft,s=a===void 0?!0:a,f=this.projectPosition(r),v=R5(f,this.pixelProjectionMatrix),m=(0,dn.Z)(v,2),x=m[0],A=m[1],T=s?A:this.height-A;return r.length===2?[x,T]:[x,T,v[2]]}},{key:"unproject",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=n.topLeft,s=a===void 0?!0:a,f=n.targetZ,v=(0,dn.Z)(r,3),m=v[0],x=v[1],A=v[2],T=s?x:this.height-x,I=f&&f*this.pixelsPerMeter,F=cx([m,T,A],this.pixelUnprojectionMatrix,I),j=this.unprojectPosition(F),X=(0,dn.Z)(j,3),ee=X[0],be=X[1],Fe=X[2];return Number.isFinite(A)?[ee,be,Fe]:Number.isFinite(f)?[ee,be,f]:[ee,be]}},{key:"projectPosition",value:function(r){var n=this.projectFlat(r),a=(0,dn.Z)(n,2),s=a[0],f=a[1],v=(r[2]||0)*this.pixelsPerMeter;return[s,f,v]}},{key:"unprojectPosition",value:function(r){var n=this.unprojectFlat(r),a=(0,dn.Z)(n,2),s=a[0],f=a[1],v=(r[2]||0)/this.pixelsPerMeter;return[s,f,v]}},{key:"projectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}},{key:"unprojectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}}]),e}();function L5(e){var i=e.width,r=e.height,n=e.bounds,a=e.minExtent,s=a===void 0?0:a,f=e.maxZoom,v=f===void 0?24:f,m=e.padding,x=m===void 0?0:m,A=e.offset,T=A===void 0?[0,0]:A,I=(0,dn.Z)(n,2),F=(0,dn.Z)(I[0],2),j=F[0],X=F[1],ee=(0,dn.Z)(I[1],2),be=ee[0],Fe=ee[1];if(Number.isFinite(x)){var We=x;x={top:We,bottom:We,left:We,right:We}}else Xp(Number.isFinite(x.top)&&Number.isFinite(x.bottom)&&Number.isFinite(x.left)&&Number.isFinite(x.right));var et=new hx({width:i,height:r,longitude:0,latitude:0,zoom:0}),xt=et.project([j,Fe]),Ct=et.project([be,X]),Yt=[Math.max(Math.abs(Ct[0]-xt[0]),s),Math.max(Math.abs(Ct[1]-xt[1]),s)],ar=[i-x.left-x.right-Math.abs(T[0])*2,r-x.top-x.bottom-Math.abs(T[1])*2];Xp(ar[0]>0&&ar[1]>0);var Ar=ar[0]/Yt[0],Qr=ar[1]/Yt[1],vr=(x.right-x.left)/2/Ar,pn=(x.bottom-x.top)/2/Qr,Tn=[(Ct[0]+xt[0])/2+vr,(Ct[1]+xt[1])/2+pn],qn=et.unproject(Tn),Ba=et.zoom+Math.log2(Math.abs(Math.min(Ar,Qr)));return{longitude:qn[0],latitude:qn[1],zoom:Math.min(Ba,v)}}var hx=function(e){(0,Pr.Z)(i,e);function i(){var r,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=n.width,s=n.height,f=n.latitude,v=f===void 0?0:f,m=n.longitude,x=m===void 0?0:m,A=n.zoom,T=A===void 0?0:A,I=n.pitch,F=I===void 0?0:I,j=n.bearing,X=j===void 0?0:j,ee=n.altitude,be=ee===void 0?1.5:ee,Fe=n.nearZMultiplier,We=n.farZMultiplier;(0,ht.Z)(this,i),a=a||1,s=s||1;var et=ux(T);be=Math.max(.75,be);var xt=m0([x,v],et);xt[2]=0;var Ct=I5({width:a,height:s,pitch:F,bearing:X,altitude:be,nearZMultiplier:Fe||1/s,farZMultiplier:We||1.01}),Yt=P5({height:s,center:xt,pitch:F,bearing:X,altitude:be,flipY:!0});return r=(0,on.Z)(this,(0,gt.Z)(i).call(this,{width:a,height:s,viewMatrix:Yt,projectionMatrix:Ct})),r.latitude=v,r.longitude=x,r.zoom=T,r.pitch=F,r.bearing=X,r.altitude=be,r.scale=et,r.center=xt,r.pixelsPerMeter=lx((0,J.Z)((0,J.Z)(r))).pixelsPerMeter[2],Object.freeze((0,J.Z)((0,J.Z)(r))),r}return(0,Pt.Z)(i,[{key:"projectFlat",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return m0(n,a)}},{key:"unprojectFlat",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return mm(n,a)}},{key:"getMapCenterByLngLatPosition",value:function(n){var a=n.lngLat,s=n.pos,f=cx(s,this.pixelUnprojectionMatrix),v=m0(a,this.scale),m=xi.add([],v,xi.negate([],f)),x=xi.add([],this.center,m);return mm(x,this.scale)}},{key:"getLocationAtPoint",value:function(n){var a=n.lngLat,s=n.pos;return this.getMapCenterByLngLatPosition({lngLat:a,pos:s})}},{key:"fitBounds",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=this.width,f=this.height,v=L5(Object.assign({width:s,height:f,bounds:n},a)),m=v.longitude,x=v.latitude,A=v.zoom;return new i({width:s,height:f,longitude:m,latitude:x,zoom:A})}}]),i}(k5),D5=function(){function e(){(0,ht.Z)(this,e),(0,S.Z)(this,"viewport",void 0)}return(0,Pt.Z)(e,[{key:"syncWithMapCamera",value:function(r){var n=r.center,a=r.zoom,s=r.pitch,f=r.bearing,v=r.viewportHeight,m=r.viewportWidth;this.viewport=new hx({width:m,height:v,longitude:n&&n[0],latitude:n&&n[1],zoom:a,pitch:s,bearing:f})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}}]),e}(),F5=function(){function e(i){(0,ht.Z)(this,e),(0,S.Z)(this,"size",1e4),this.size=i||1e4}return(0,Pt.Z)(e,[{key:"setSize",value:function(r){this.size=r}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(r){return(180+r)/360*this.size}},{key:"mercatorYfromLat",value:function(r){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(r){return r/this.size*360-180}},{key:"latFromMercatorY",value:function(r){var n=180-(1-r/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90}},{key:"project",value:function(r){var n=this.mercatorXfromLng(r[0]),a=this.mercatorYfromLat(r[1]);return[n,a]}},{key:"unproject",value:function(r){var n=this.lngFromMercatorX(r[0]),a=this.latFromMercatorY(r[1]);return[n,a]}}]),e}(),px={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},B5=["id","attributionControl","style","token","rotation","mapInstance"],dx,vx,mx,gx,yx,_x,Md,xx,bx,Ex,Sx;function Cx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function N5(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Cx(Object(r),!0).forEach(function(n){(0,S.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Cx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function z5(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var f=i.createElement("style");return f.type="text/css",f.styleSheet?f.styleSheet.cssText=e:f.appendChild(i.createTextNode(e)),a.appendChild(f),f}}z5(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=gv();var Ax={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},U5=0,Z5=12,Tx="pk.eyJ1IjoibHp4dWUiLCJhIjoiY2tvaWZuM2s4MWZuYjJ1dHI5ZGduYTlrdiJ9.DQCfMRbZzx0VSwecQ69McA",j5=(dx=(0,Xr.b2)(),vx=(0,Xr.f3)(yt.MapConfig),mx=(0,Xr.f3)(yt.IGlobalConfigService),gx=(0,Xr.f3)(yt.ICoordinateSystemService),yx=(0,Xr.f3)(yt.IEventEmitter),dx(_x=(Md=function(){function e(){var i=this;(0,ht.Z)(this,e),(0,S.Z)(this,"version",ks.MAPBOX),(0,S.Z)(this,"map",void 0),(0,S.Z)(this,"simpleMapCoord",new F5),(0,S.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),Ln(this,"config",xx,this),Ln(this,"configService",bx,this),Ln(this,"coordinateSystemService",Ex,this),Ln(this,"eventEmitter",Sx,this),(0,S.Z)(this,"viewport",void 0),(0,S.Z)(this,"markerContainer",void 0),(0,S.Z)(this,"cameraChangedCallback",void 0),(0,S.Z)(this,"$mapContainer",void 0),(0,S.Z)(this,"handleCameraChanged",function(){var r=i.map.getCenter().wrap(),n=r.lat,a=r.lng;i.emit("mapchange"),i.viewport.syncWithMapCamera({bearing:i.map.getBearing(),center:[a,n],viewportHeight:i.map.transform.height,pitch:i.map.getPitch(),viewportWidth:i.map.transform.width,zoom:i.map.getZoom(),cameraHeight:0});var s=i.config.offsetZoom,f=s===void 0?Z5:s;i.viewport.getZoom()>f?i.coordinateSystemService.setCoordinateSystem(Jl.LNGLAT_OFFSET):i.coordinateSystemService.setCoordinateSystem(Jl.LNGLAT),i.cameraChangedCallback(i.viewport)})}return(0,Pt.Z)(e,[{key:"setBgColor",value:function(r){this.bgColor=r}},{key:"addMarkerContainer",value:function(){var r=this.map.getCanvasContainer();this.markerContainer=Za("div","l7-marker-container",r),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(r,n){l2.indexOf(r)!==-1?this.eventEmitter.on(r,n):this.map.on(Ax[r]||r,n)}},{key:"off",value:function(r,n){this.map.off(Ax[r]||r,n),this.eventEmitter.off(r,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var r=this.map.transform;return[r.width,r.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(r){return this.map.setZoom(r)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(r){this.map.setCenter(r)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(r){this.map.setBearing(r)}},{key:"zoomIn",value:function(r,n){this.map.zoomIn(r,n)}},{key:"zoomOut",value:function(r,n){this.map.zoomOut(r,n)}},{key:"setPitch",value:function(r){return this.map.setPitch(r)}},{key:"panTo",value:function(r){this.map.panTo(r)}},{key:"panBy",value:function(r,n){this.panTo([r,n])}},{key:"fitBounds",value:function(r,n){this.map.fitBounds(r,n)}},{key:"setMaxZoom",value:function(r){this.map.setMaxZoom(r)}},{key:"setMinZoom",value:function(r){this.map.setMinZoom(r)}},{key:"setMapStatus",value:function(r){r.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),r.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),r.dragEnable===!1&&this.map.dragPan.disable(),r.dragEnable===!0&&this.map.dragPan.enable(),r.rotateEnable===!1&&this.map.dragRotate.disable(),r.rotateEnable===!0&&this.map.dragRotate.enable(),r.keyboardEnable===!1&&this.map.keyboard.disable(),r.keyboardEnable===!0&&this.map.keyboard.enable(),r.zoomEnable===!1&&this.map.scrollZoom.disable(),r.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(r,n){this.map.flyTo({zoom:r,center:n})}},{key:"setMapStyle",value:function(r){this.map.setStyle(this.getMapStyle(r))}},{key:"pixelToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToPixel",value:function(r){return this.map.project(r)}},{key:"containerToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToContainer",value:function(r){return this.map.project(r)}},{key:"lngLatToCoord",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},a=this.lngLatToMercator(r,0),s=a.x,f=a.y;return[s-n.x,f-n.y]}},{key:"lngLatToMercator",value:function(r,n){var a=window.mapboxgl.MercatorCoordinate.fromLngLat(r,n),s=a.x,f=s===void 0?0:s,v=a.y,m=v===void 0?0:v,x=a.z,A=x===void 0?0:x;return{x:f,y:m,z:A}}},{key:"getModelMatrix",value:function(r,n,a){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],f=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},v=window.mapboxgl.MercatorCoordinate.fromLngLat(r,n),m=v.meterInMercatorCoordinateUnits(),x=qi();return ch(x,x,Ya.fromValues(v.x-f.x,v.y-f.y,v.z||0-f.z)),Kl(x,x,Ya.fromValues(m*s[0],-m*s[1],m*s[2])),fh(x,x,a[0]),sf(x,x,a[1]),Ea(x,x,a[2]),x}},{key:"init",value:function(){var i=(0,Z.Z)(q().mark(function n(){var a,s,f,v,m,x,A,T,I,F,j,X,ee;return q().wrap(function(Fe){for(;;)switch(Fe.prev=Fe.next){case 0:a=this.config,s=a.id,f=s===void 0?"map":s,v=a.attributionControl,m=v===void 0?!1:v,x=a.style,A=x===void 0?"light":x,T=a.token,I=T===void 0?Tx:T,F=a.rotation,j=F===void 0?0:F,X=a.mapInstance,ee=(0,Ga.Z)(a,B5),this.viewport=new D5,!X&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),I===Tx&&A!=="blank"&&!window.mapboxgl.accessToken&&!X&&console.warn(this.configService.getSceneWarninfo("MapToken")),!X&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=I),X?(this.map=X,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(f),this.map=new window.mapboxgl.Map(N5({container:this.$mapContainer,style:this.getMapStyle(A),attributionControl:m,bearing:j},ee))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return Fe.stop()}},n,this)}));function r(){return i.apply(this,arguments)}return r}()},{key:"destroy",value:function(){var r,n;(r=this.$mapContainer)===null||r===void 0||(n=r.parentNode)===null||n===void 0||n.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(r){for(var n,a=arguments.length,s=new Array(a>1?a-1:0),f=1;f<a;f++)s[f-1]=arguments[f];(n=this.eventEmitter).emit.apply(n,[r].concat(s))}},{key:"once",value:function(r){for(var n,a=arguments.length,s=new Array(a>1?a-1:0),f=1;f<a;f++)s[f-1]=arguments[f];(n=this.eventEmitter).once.apply(n,[r].concat(s))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(r,n){var a=new(gv()).LngLat(r[0],r[1]),s=new(gv()).LngLat(n[0],n[1]),f=a.distanceTo(s),v=gv().MercatorCoordinate.fromLngLat({lng:r[0],lat:r[1]}),m=gv().MercatorCoordinate.fromLngLat({lng:n[0],lat:n[1]}),x=v.x,A=v.y,T=m.x,I=m.y,F=Math.sqrt(Math.pow(x-T,2)+Math.pow(A-I,2))*4194304*2;return F/f}},{key:"exportMap",value:function(r){var n=this.map.getCanvas(),a=r==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return a}},{key:"onCameraChanged",value:function(r){this.cameraChangedCallback=r}},{key:"creatAmapContainer",value:function(r){var n=r;typeof r=="string"&&(n=document.getElementById(r));var a=document.createElement("div");return a.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,a.id="l7_mapbox_div"+U5++,n.appendChild(a),a}},{key:"getMapStyle",value:function(r){return typeof r!="string"?r:px[r]?px[r]:r}}]),e}(),xx=ri(Md.prototype,"config",[vx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bx=ri(Md.prototype,"configService",[mx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ex=ri(Md.prototype,"coordinateSystemService",[gx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sx=ri(Md.prototype,"eventEmitter",[yx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Md))||_x);function V5(e){var i=G5();return function(){var n=(0,gt.Z)(e),a;if(i){var s=(0,gt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function G5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function H5(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var f=i.createElement("style");return f.type="text/css",f.styleSheet?f.styleSheet.cssText=e:f.appendChild(i.createTextNode(e)),a.appendChild(f),f}}H5(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var W5=function(e){(0,Pr.Z)(r,e);var i=V5(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"getServiceConstructor",value:function(){return j5}}]),r}(A5);function Mx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Px(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Mx(Object(r),!0).forEach(function(n){X5(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Mx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function X5(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function Y5(e,i){return Q5(e)||$5(e,i)||K5(e,i)||q5()}function q5(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function K5(e,i){if(!!e){if(typeof e=="string")return Ox(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ox(e,i)}}function Ox(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function $5(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(m){s=!0,v=m}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function Q5(e){if(Array.isArray(e))return e}var J5=me.memo(function(e){var i=e.style,r=e.className,n=e.map,a=e.option,s=e.onSceneLoaded,f=(0,me.createRef)(),v=(0,me.useState)(),m=Y5(v,2),x=m[0],A=m[1];return(0,me.useEffect)(function(){var T=new BE(Px(Px({id:f.current},a),{},{map:new W5(n)}));return T.on("loaded",function(){A(T),s&&s(T)}),function(){T.destroy()}},[]),(0,me.useEffect)(function(){x&&n.style&&x.setMapStyle(n.style)},[JSON.stringify(n.style)]),(0,me.useEffect)(function(){x&&n.zoom&&x.setZoom(n.zoom)},[n.zoom]),(0,me.useEffect)(function(){x&&n.center&&x.setCenter(n.center)},[JSON.stringify(n.center)]),(0,me.useEffect)(function(){x&&n.pitch!==void 0&&x.setPitch(n.pitch||0)},[n.pitch]),(0,me.useEffect)(function(){x&&n.rotation&&x.setRotation(n.rotation)},[n.rotation]),me.createElement(g.Provider,{value:x},(0,me.createElement)("div",{ref:f,style:i,className:r},x&&e.children))}),eP=J5;function Ix(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function YO(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Ix(Object(r),!0).forEach(function(n){tP(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ix(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function tP(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function qO(e,i){return aP(e)||iP(e,i)||nP(e,i)||rP()}function rP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function nP(e,i){if(!!e){if(typeof e=="string")return Rx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Rx(e,i)}}function Rx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function iP(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(m){s=!0,v=m}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function aP(e){if(Array.isArray(e))return e}var KO=null,$O=null;function kx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function QO(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?kx(Object(r),!0).forEach(function(n){oP(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):kx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function oP(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function JO(e,i){return cP(e)||lP(e,i)||uP(e,i)||sP()}function sP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function uP(e,i){if(!!e){if(typeof e=="string")return Lx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Lx(e,i)}}function Lx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function lP(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(m){s=!0,v=m}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function cP(e){if(Array.isArray(e))return e}var eI=null,tI=null;function rI(e,i){return dP(e)||pP(e,i)||hP(e,i)||fP()}function fP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function hP(e,i){if(!!e){if(typeof e=="string")return Dx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Dx(e,i)}}function Dx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function pP(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(m){s=!0,v=m}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function dP(e){if(Array.isArray(e))return e}var nI=null,iI=null;function Fx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function aI(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Fx(Object(r),!0).forEach(function(n){vP(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Fx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function vP(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function oI(e,i){if(e==null)return{};var r=mP(e,i),n,a;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function mP(e,i){if(e==null)return{};var r={},n=Object.keys(e),a,s;for(s=0;s<n.length;s++)a=n[s],!(i.indexOf(a)>=0)&&(r[a]=e[a]);return r}var sI=null,Bx=Q(73935);function Nx(e,i){return xP(e)||_P(e,i)||yP(e,i)||gP()}function gP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function yP(e,i){if(!!e){if(typeof e=="string")return zx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return zx(e,i)}}function zx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function _P(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(m){s=!0,v=m}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function xP(e){if(Array.isArray(e))return e}var Ux=me.useEffect,Zx=me.useState,bP=/\B([A-Z])/g,EP=function(i){return i.replace(bP,"-$1").toLowerCase()};function uI(e){var i=e.className,r=e.style,n=e.children,a=e.position,s=Zx(),f=Nx(s,2),v=f[0],m=f[1],x=useSceneValue(),A=Zx(function(){return document.createElement("div")}),T=Nx(A,1),I=T[0];return Ux(function(){var F=new Control({position:a});return F.onAdd=function(){if(i&&(I.className=i),r){var j=Object.keys(r).map(function(X){return"".concat(EP(X),":").concat(r[X])}).join(";");I.style.cssText=j}return I},F.onRemove=function(){},m(F),x.addControl(F),function(){x.removeControl(F)}},[]),Ux(function(){v&&v.setPosition(a||"bottomleft")},[a]),createPortal(n,I)}var jx=(0,me.createContext)({});function lI(){return useContext(jx)}var Vf=Q(96486),cI=me.useEffect,SP=me.memo(function(i){var r=i.layer,n=i.active;return r.active(n.option),null},Vf.isEqual),fI=me.useEffect,CP=me.memo(function(i){var r=i.layer,n=i.animate;return r.animate(n),null},Vf.isEqual),hI=me.useEffect,AP=me.memo(function(i){var r=i.layer,n=i.color;return n.field?r.color(n.field,n.values):r.color(n.values),null},Vf.isEqual),wP=me.memo(function(i){var r=i.layer,n=i.filter;return n.field&&r.filter(n.field,n.values),null},Vf.isEqual),TP=me.memo(function(i){var r=i.layer,n=i.scale;return r.scale(n.values),null},Vf.isEqual),pI=me.useEffect,MP=me.memo(function(i){var r=i.layer,n=i.select;return r.select(n.option),null},Vf.isEqual),PP=me.memo(function(i){var r=i.layer,n=i.shape;return n.field?r.shape(n.field,n.values):r.shape(n.values),null},Vf.isEqual),OP=me.memo(function(i){var r=i.layer,n=i.size;return n.field?r.size(n.field,n.values):r.size(n.values),null},Vf.isEqual),IP=["data"];function RP(e,i){if(e==null)return{};var r=kP(e,i),n,a;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function kP(e,i){if(e==null)return{};var r={},n=Object.keys(e),a,s;for(s=0;s<n.length;s++)a=n[s],!(i.indexOf(a)>=0)&&(r[a]=e[a]);return r}var LP=me.memo(function(i){var r=i.layer,n=i.source,a=n.data,s=RP(n,IP);return r.inited?r.setData(a,s):r.source(a,s),s.autoFit&&r.fitBounds(s&&s.fitBoundsOptions),null},Vf.isEqual),dI=me.useEffect,DP=me.memo(function(i){var r=i.layer,n=i.style;return r.style(n),null},Vf.isEqual);function FP(e,i){return UP(e)||zP(e,i)||NP(e,i)||BP()}function BP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function NP(e,i){if(!!e){if(typeof e=="string")return Vx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Vx(e,i)}}function Vx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function zP(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(m){s=!0,v=m}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function UP(e){if(Array.isArray(e))return e}var _v=me.useEffect,ZP=me.useState;function Gx(e,i){var r=i.source,n=i.color,a=i.shape,s=i.style,f=i.size,v=i.scale,m=i.active,x=i.select,A=i.filter,T=i.animate,I=i.options,F=i.onLayerLoaded,j=Re(),X=ZP(function(){var Fe;switch(e){case"polygonLayer":Fe=new Gy(I);break;case"lineLayer":Fe=new $C(I);break;case"pointLayer":Fe=new tw(I);break;case"heatmapLayer":Fe=new GS(I);break;case"rasterLayer":Fe=new Uw(I);break;case"imageLayer":Fe=new eC(I);break;case"citybuildingLayer":Fe=new vS(I);break;default:Fe=new Gy(I)}return Fe.on("inited",function(){F&&F(Fe,j)}),Fe}),ee=FP(X,1),be=ee[0];return _v(function(){return j.addLayer(be),function(){j.removeLayer(be)}},[]),_v(function(){be.inited&&I&&be.updateLayerConfig(I)},[I==null?void 0:I.minZoom,I==null?void 0:I.maxZoom,I==null?void 0:I.visible]),_v(function(){be.inited&&(I==null?void 0:I.zIndex)&&be.setIndex(I.zIndex)},[I==null?void 0:I.zIndex]),_v(function(){be.inited&&(I==null?void 0:I.blend)&&be.setBlend(I.blend)},[I==null?void 0:I.blend]),_v(function(){j.render()}),me.createElement(jx.Provider,{value:be},me.createElement(LP,{layer:be,source:r}),v&&me.createElement(TP,{layer:be,scale:v}),n&&me.createElement(AP,{layer:be,color:n}),f&&me.createElement(OP,{layer:be,size:f}),a&&me.createElement(PP,{layer:be,shape:a}),s&&me.createElement(DP,{layer:be,style:s}),m&&me.createElement(SP,{layer:be,active:m}),x&&me.createElement(MP,{layer:be,select:x}),A&&me.createElement(wP,{layer:be,filter:A}),T&&me.createElement(CP,{layer:be,animate:T}),i.children)}var vI=null,mI=null,jP=me.memo(function(i){return Gx("pointLayer",i)}),VP=me.memo(function(i){return Gx("heatmapLayer",i)}),gI=null,yI=null,_I=null,xI=me.useEffect,bI=null,EI=null;function g0(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?g0=function(r){return typeof r}:g0=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},g0(e)}function Hx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function y0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Hx(Object(r),!0).forEach(function(n){GP(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Hx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function GP(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function HP(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function Wx(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function WP(e,i,r){return i&&Wx(e.prototype,i),r&&Wx(e,r),e}function XP(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&gm(e,i)}function gm(e,i){return gm=Object.setPrototypeOf||function(n,a){return n.__proto__=a,n},gm(e,i)}function YP(e){var i=$P();return function(){var n=_0(e),a;if(i){var s=_0(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return qP(this,a)}}function qP(e,i){if(i&&(g0(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return KP(e)}function KP(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function $P(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function _0(e){return _0=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},_0(e)}var SI=function(e){XP(r,e);var i=YP(r);function r(n){var a;return HP(this,r),a=i.call(this,n),a.el=void 0,a.scene=void 0,a.popup=void 0,a.el=document.createElement("div"),a}return WP(r,[{key:"componentDidMount",value:function(){var a,s=this.props,f=s.lnglat,v=s.children,m=s.option,x=s.lngLat,A=new Eg(y0(y0({},m),{},{stopPropagation:(a=this.props.option)===null||a===void 0?void 0:a.stopPropagation}));f&&A.setLnglat(f),x&&A.setLnglat(x),v&&A.setDOMContent(this.el),this.popup=A,this.scene.addPopup(A)}},{key:"componentDidUpdate",value:function(a){var s,f,v,m,x,A,T=Array.isArray(a.lnglat)?a.lnglat:[a==null||(s=a.lnglat)===null||s===void 0?void 0:s.lng,a==null||(f=a.lnglat)===null||f===void 0?void 0:f.lat],I=Array.isArray(this.props.lnglat)?this.props.lnglat:[(v=this.props)===null||v===void 0||(m=v.lnglat)===null||m===void 0?void 0:m.lng,(x=this.props)===null||x===void 0||(A=x.lnglat)===null||A===void 0?void 0:A.lat],F=T.toString()!==I.toString();if(F){var j;this.popup.remove(),this.popup=new Eg(y0(y0({},this.props.option),{},{stopPropagation:(j=this.props.option)===null||j===void 0?void 0:j.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var a=this;return me.createElement(g.Consumer,{},function(s){return s&&(a.scene=s),(0,Bx.createPortal)(a.props.children,a.el)})}}]),r}(me.PureComponent);function x0(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?x0=function(r){return typeof r}:x0=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},x0(e)}function QP(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function Xx(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function JP(e,i,r){return i&&Xx(e.prototype,i),r&&Xx(e,r),e}function e3(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&ym(e,i)}function ym(e,i){return ym=Object.setPrototypeOf||function(n,a){return n.__proto__=a,n},ym(e,i)}function t3(e){var i=i3();return function(){var n=b0(e),a;if(i){var s=b0(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return r3(this,a)}}function r3(e,i){if(i&&(x0(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return n3(e)}function n3(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function i3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function b0(e){return b0=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},b0(e)}var CI=function(e){e3(r,e);var i=t3(r);function r(n){var a;return QP(this,r),a=i.call(this,n),a.el=void 0,a.scene=void 0,a.marker=void 0,a.el=document.createElement("div"),a}return JP(r,[{key:"componentDidMount",value:function(){var a=this.props,s=a.lnglat,f=a.children,v=a.option,m=a.onMarkerLoaded,x=new gg(v);s&&x.setLnglat(s),f&&x.setElement(this.el),this.marker=x,m&&m(x),this.scene.addMarker(x)}},{key:"componentDidUpdate",value:function(a){var s,f=(a==null?void 0:a.lnglat.toString())!==((s=this.props)===null||s===void 0?void 0:s.lnglat.toString());f&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var a=this;return me.createElement(g.Consumer,{},function(s){return s&&(a.scene=s),(0,Bx.createPortal)(a.props.children,a.el)})}}]),r}(me.PureComponent),AI=me.useEffect,wI=null,TI=null,MI=me.useEffect,PI=null},31795:function(Er,ne,Q){var Ce=Q(75752);Er.exports.geometry=me,Er.exports.ring=Re;function me(he){var de=0,ze;switch(he.type){case"Polygon":return g(he.coordinates);case"MultiPolygon":for(ze=0;ze<he.coordinates.length;ze++)de+=g(he.coordinates[ze]);return de;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(ze=0;ze<he.geometries.length;ze++)de+=me(he.geometries[ze]);return de}}function g(he){var de=0;if(he&&he.length>0){de+=Math.abs(Re(he[0]));for(var ze=1;ze<he.length;ze++)de-=Math.abs(Re(he[ze]))}return de}function Re(he){var de,ze,_e,tt,mt,wt,Nt,or=0,Tt=he.length;if(Tt>2){for(Nt=0;Nt<Tt;Nt++)Nt===Tt-2?(tt=Tt-2,mt=Tt-1,wt=0):Nt===Tt-1?(tt=Tt-1,mt=0,wt=1):(tt=Nt,mt=Nt+1,wt=Nt+2),de=he[tt],ze=he[mt],_e=he[wt],or+=(W(_e[0])-W(de[0]))*Math.sin(W(ze[1]));or=or*Ce.RADIUS*Ce.RADIUS/2}return or}function W(he){return he*Math.PI/180}},38163:function(Er,ne,Q){var Ce=Q(31795);Er.exports=me;function me(ze,_e){switch(ze&&ze.type||null){case"FeatureCollection":return ze.features=ze.features.map(g(me,_e)),ze;case"GeometryCollection":return ze.geometries=ze.geometries.map(g(me,_e)),ze;case"Feature":return ze.geometry=me(ze.geometry,_e),ze;case"Polygon":case"MultiPolygon":return Re(ze,_e);default:return ze}}function g(ze,_e){return function(tt){return ze(tt,_e)}}function Re(ze,_e){return ze.type==="Polygon"?ze.coordinates=W(ze.coordinates,_e):ze.type==="MultiPolygon"&&(ze.coordinates=ze.coordinates.map(g(W,_e))),ze}function W(ze,_e){_e=!!_e,ze[0]=he(ze[0],_e);for(var tt=1;tt<ze.length;tt++)ze[tt]=he(ze[tt],!_e);return ze}function he(ze,_e){return de(ze)===_e?ze:ze.reverse()}function de(ze){return Ce.ring(ze)>=0}},80638:function(){},15746:function(Er,ne,Q){"use strict";var Ce=Q(21584);ne.Z=Ce.Z},89032:function(Er,ne,Q){"use strict";var Ce=Q(38663),me=Q.n(Ce),g=Q(6999)},99134:function(Er,ne,Q){"use strict";var Ce=Q(67294),me=(0,Ce.createContext)({});ne.Z=me},21584:function(Er,ne,Q){"use strict";var Ce=Q(96156),me=Q(22122),g=Q(90484),Re=Q(67294),W=Q(94184),he=Q.n(W),de=Q(99134),ze=Q(65632),_e=function(Nt,or){var Tt={};for(var Kt in Nt)Object.prototype.hasOwnProperty.call(Nt,Kt)&&or.indexOf(Kt)<0&&(Tt[Kt]=Nt[Kt]);if(Nt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var _t=0,Kt=Object.getOwnPropertySymbols(Nt);_t<Kt.length;_t++)or.indexOf(Kt[_t])<0&&Object.prototype.propertyIsEnumerable.call(Nt,Kt[_t])&&(Tt[Kt[_t]]=Nt[Kt[_t]]);return Tt};function tt(Nt){return typeof Nt=="number"?"".concat(Nt," ").concat(Nt," auto"):/^\d+(\.\d+)?(px|em|rem|%)$/.test(Nt)?"0 0 ".concat(Nt):Nt}var mt=["xs","sm","md","lg","xl","xxl"],wt=Re.forwardRef(function(Nt,or){var Tt,Kt=Re.useContext(ze.E_),_t=Kt.getPrefixCls,ct=Kt.direction,it=Re.useContext(de.Z),$t=it.gutter,Y=it.wrap,Xt=it.supportFlexGap,at=Nt.prefixCls,qe=Nt.span,Et=Nt.order,$e=Nt.offset,Ht=Nt.push,mr=Nt.pull,Fr=Nt.className,Yr=Nt.children,S=Nt.flex,Se=Nt.style,ke=_e(Nt,["prefixCls","span","order","offset","push","pull","className","children","flex","style"]),ut=_t("col",at),ft={};mt.forEach(function(Gr){var Nn,yn={},zn=Nt[Gr];typeof zn=="number"?yn.span=zn:(0,g.Z)(zn)==="object"&&(yn=zn||{}),delete ke[Gr],ft=(0,me.Z)((0,me.Z)({},ft),(Nn={},(0,Ce.Z)(Nn,"".concat(ut,"-").concat(Gr,"-").concat(yn.span),yn.span!==void 0),(0,Ce.Z)(Nn,"".concat(ut,"-").concat(Gr,"-order-").concat(yn.order),yn.order||yn.order===0),(0,Ce.Z)(Nn,"".concat(ut,"-").concat(Gr,"-offset-").concat(yn.offset),yn.offset||yn.offset===0),(0,Ce.Z)(Nn,"".concat(ut,"-").concat(Gr,"-push-").concat(yn.push),yn.push||yn.push===0),(0,Ce.Z)(Nn,"".concat(ut,"-").concat(Gr,"-pull-").concat(yn.pull),yn.pull||yn.pull===0),(0,Ce.Z)(Nn,"".concat(ut,"-rtl"),ct==="rtl"),Nn))});var kt=he()(ut,(Tt={},(0,Ce.Z)(Tt,"".concat(ut,"-").concat(qe),qe!==void 0),(0,Ce.Z)(Tt,"".concat(ut,"-order-").concat(Et),Et),(0,Ce.Z)(Tt,"".concat(ut,"-offset-").concat($e),$e),(0,Ce.Z)(Tt,"".concat(ut,"-push-").concat(Ht),Ht),(0,Ce.Z)(Tt,"".concat(ut,"-pull-").concat(mr),mr),Tt),Fr,ft),Ft={};if($t&&$t[0]>0){var yr=$t[0]/2;Ft.paddingLeft=yr,Ft.paddingRight=yr}if($t&&$t[1]>0&&!Xt){var Yn=$t[1]/2;Ft.paddingTop=Yn,Ft.paddingBottom=Yn}return S&&(Ft.flex=tt(S),Y===!1&&!Ft.minWidth&&(Ft.minWidth=0)),Re.createElement("div",(0,me.Z)({},ke,{style:(0,me.Z)((0,me.Z)({},Ft),Se),className:kt,ref:or}),Yr)});wt.displayName="Col",ne.Z=wt},92820:function(Er,ne,Q){"use strict";var Ce=Q(22122),me=Q(96156),g=Q(90484),Re=Q(28481),W=Q(67294),he=Q(94184),de=Q.n(he),ze=Q(65632),_e=Q(99134),tt=Q(93355),mt=Q(24308),wt=Q(98082),Nt=function(_t,ct){var it={};for(var $t in _t)Object.prototype.hasOwnProperty.call(_t,$t)&&ct.indexOf($t)<0&&(it[$t]=_t[$t]);if(_t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Y=0,$t=Object.getOwnPropertySymbols(_t);Y<$t.length;Y++)ct.indexOf($t[Y])<0&&Object.prototype.propertyIsEnumerable.call(_t,$t[Y])&&(it[$t[Y]]=_t[$t[Y]]);return it},or=(0,tt.b)("top","middle","bottom","stretch"),Tt=(0,tt.b)("start","end","center","space-around","space-between","space-evenly"),Kt=W.forwardRef(function(_t,ct){var it,$t=_t.prefixCls,Y=_t.justify,Xt=_t.align,at=_t.className,qe=_t.style,Et=_t.children,$e=_t.gutter,Ht=$e===void 0?0:$e,mr=_t.wrap,Fr=Nt(_t,["prefixCls","justify","align","className","style","children","gutter","wrap"]),Yr=W.useContext(ze.E_),S=Yr.getPrefixCls,Se=Yr.direction,ke=W.useState({xs:!0,sm:!0,md:!0,lg:!0,xl:!0,xxl:!0}),ut=(0,Re.Z)(ke,2),ft=ut[0],kt=ut[1],Ft=(0,wt.Z)(),yr=W.useRef(Ht);W.useEffect(function(){var ia=mt.ZP.subscribe(function(qa){var aa=yr.current||0;(!Array.isArray(aa)&&(0,g.Z)(aa)==="object"||Array.isArray(aa)&&((0,g.Z)(aa[0])==="object"||(0,g.Z)(aa[1])==="object"))&&kt(qa)});return function(){return mt.ZP.unsubscribe(ia)}},[]);var Yn=function(){var qa=[0,0],aa=Array.isArray(Ht)?Ht:[Ht,0];return aa.forEach(function(oa,Li){if((0,g.Z)(oa)==="object")for(var Ki=0;Ki<mt.c4.length;Ki++){var Hi=mt.c4[Ki];if(ft[Hi]&&oa[Hi]!==void 0){qa[Li]=oa[Hi];break}}else qa[Li]=oa||0}),qa},Gr=S("row",$t),Nn=Yn(),yn=de()(Gr,(it={},(0,me.Z)(it,"".concat(Gr,"-no-wrap"),mr===!1),(0,me.Z)(it,"".concat(Gr,"-").concat(Y),Y),(0,me.Z)(it,"".concat(Gr,"-").concat(Xt),Xt),(0,me.Z)(it,"".concat(Gr,"-rtl"),Se==="rtl"),it),at),zn={},si=Nn[0]>0?Nn[0]/-2:void 0,Gn=Nn[1]>0?Nn[1]/-2:void 0;if(si&&(zn.marginLeft=si,zn.marginRight=si),Ft){var fi=(0,Re.Z)(Nn,2);zn.rowGap=fi[1]}else Gn&&(zn.marginTop=Gn,zn.marginBottom=Gn);var na=(0,Re.Z)(Nn,2),Ui=na[0],Ii=na[1],$i=W.useMemo(function(){return{gutter:[Ui,Ii],wrap:mr,supportFlexGap:Ft}},[Ui,Ii,mr,Ft]);return W.createElement(_e.Z.Provider,{value:$i},W.createElement("div",(0,Ce.Z)({},Fr,{className:yn,style:(0,Ce.Z)((0,Ce.Z)({},zn),qe),ref:ct}),Et))});Kt.displayName="Row",ne.Z=Kt},6999:function(Er,ne,Q){"use strict";var Ce=Q(38663),me=Q.n(Ce),g=Q(80638),Re=Q.n(g)},71230:function(Er,ne,Q){"use strict";var Ce=Q(92820);ne.Z=Ce.Z},13062:function(Er,ne,Q){"use strict";var Ce=Q(38663),me=Q.n(Ce),g=Q(6999)},9187:function(Er){"use strict";Er.exports=ne,Er.exports.default=ne;function ne(S,Se,ke){ke=ke||2;var ut=Se&&Se.length,ft=ut?Se[0]*ke:S.length,kt=Q(S,0,ft,ke,!0),Ft=[];if(!kt||kt.next===kt.prev)return Ft;var yr,Yn,Gr,Nn,yn,zn,si;if(ut&&(kt=de(S,Se,kt,ke)),S.length>80*ke){yr=Gr=S[0],Yn=Nn=S[1];for(var Gn=ke;Gn<ft;Gn+=ke)yn=S[Gn],zn=S[Gn+1],yn<yr&&(yr=yn),zn<Yn&&(Yn=zn),yn>Gr&&(Gr=yn),zn>Nn&&(Nn=zn);si=Math.max(Gr-yr,Nn-Yn),si=si!==0?1/si:0}return me(kt,Ft,ke,yr,Yn,si),Ft}function Q(S,Se,ke,ut,ft){var kt,Ft;if(ft===Yr(S,Se,ke,ut)>0)for(kt=Se;kt<ke;kt+=ut)Ft=Ht(kt,S[kt],S[kt+1],Ft);else for(kt=ke-ut;kt>=Se;kt-=ut)Ft=Ht(kt,S[kt],S[kt+1],Ft);return Ft&&it(Ft,Ft.next)&&(mr(Ft),Ft=Ft.next),Ft}function Ce(S,Se){if(!S)return S;Se||(Se=S);var ke=S,ut;do if(ut=!1,!ke.steiner&&(it(ke,ke.next)||ct(ke.prev,ke,ke.next)===0)){if(mr(ke),ke=Se=ke.prev,ke===ke.next)break;ut=!0}else ke=ke.next;while(ut||ke!==Se);return Se}function me(S,Se,ke,ut,ft,kt,Ft){if(!!S){!Ft&&kt&&wt(S,ut,ft,kt);for(var yr=S,Yn,Gr;S.prev!==S.next;){if(Yn=S.prev,Gr=S.next,kt?Re(S,ut,ft,kt):g(S)){Se.push(Yn.i/ke),Se.push(S.i/ke),Se.push(Gr.i/ke),mr(S),S=Gr.next,yr=Gr.next;continue}if(S=Gr,S===yr){Ft?Ft===1?(S=W(Ce(S),Se,ke),me(S,Se,ke,ut,ft,kt,2)):Ft===2&&he(S,Se,ke,ut,ft,kt):me(Ce(S),Se,ke,ut,ft,kt,1);break}}}}function g(S){var Se=S.prev,ke=S,ut=S.next;if(ct(Se,ke,ut)>=0)return!1;for(var ft=S.next.next;ft!==S.prev;){if(Kt(Se.x,Se.y,ke.x,ke.y,ut.x,ut.y,ft.x,ft.y)&&ct(ft.prev,ft,ft.next)>=0)return!1;ft=ft.next}return!0}function Re(S,Se,ke,ut){var ft=S.prev,kt=S,Ft=S.next;if(ct(ft,kt,Ft)>=0)return!1;for(var yr=ft.x<kt.x?ft.x<Ft.x?ft.x:Ft.x:kt.x<Ft.x?kt.x:Ft.x,Yn=ft.y<kt.y?ft.y<Ft.y?ft.y:Ft.y:kt.y<Ft.y?kt.y:Ft.y,Gr=ft.x>kt.x?ft.x>Ft.x?ft.x:Ft.x:kt.x>Ft.x?kt.x:Ft.x,Nn=ft.y>kt.y?ft.y>Ft.y?ft.y:Ft.y:kt.y>Ft.y?kt.y:Ft.y,yn=or(yr,Yn,Se,ke,ut),zn=or(Gr,Nn,Se,ke,ut),si=S.prevZ,Gn=S.nextZ;si&&si.z>=yn&&Gn&&Gn.z<=zn;){if(si!==S.prev&&si!==S.next&&Kt(ft.x,ft.y,kt.x,kt.y,Ft.x,Ft.y,si.x,si.y)&&ct(si.prev,si,si.next)>=0||(si=si.prevZ,Gn!==S.prev&&Gn!==S.next&&Kt(ft.x,ft.y,kt.x,kt.y,Ft.x,Ft.y,Gn.x,Gn.y)&&ct(Gn.prev,Gn,Gn.next)>=0))return!1;Gn=Gn.nextZ}for(;si&&si.z>=yn;){if(si!==S.prev&&si!==S.next&&Kt(ft.x,ft.y,kt.x,kt.y,Ft.x,Ft.y,si.x,si.y)&&ct(si.prev,si,si.next)>=0)return!1;si=si.prevZ}for(;Gn&&Gn.z<=zn;){if(Gn!==S.prev&&Gn!==S.next&&Kt(ft.x,ft.y,kt.x,kt.y,Ft.x,Ft.y,Gn.x,Gn.y)&&ct(Gn.prev,Gn,Gn.next)>=0)return!1;Gn=Gn.nextZ}return!0}function W(S,Se,ke){var ut=S;do{var ft=ut.prev,kt=ut.next.next;!it(ft,kt)&&$t(ft,ut,ut.next,kt)&&qe(ft,kt)&&qe(kt,ft)&&(Se.push(ft.i/ke),Se.push(ut.i/ke),Se.push(kt.i/ke),mr(ut),mr(ut.next),ut=S=kt),ut=ut.next}while(ut!==S);return Ce(ut)}function he(S,Se,ke,ut,ft,kt){var Ft=S;do{for(var yr=Ft.next.next;yr!==Ft.prev;){if(Ft.i!==yr.i&&_t(Ft,yr)){var Yn=$e(Ft,yr);Ft=Ce(Ft,Ft.next),Yn=Ce(Yn,Yn.next),me(Ft,Se,ke,ut,ft,kt),me(Yn,Se,ke,ut,ft,kt);return}yr=yr.next}Ft=Ft.next}while(Ft!==S)}function de(S,Se,ke,ut){var ft=[],kt,Ft,yr,Yn,Gr;for(kt=0,Ft=Se.length;kt<Ft;kt++)yr=Se[kt]*ut,Yn=kt<Ft-1?Se[kt+1]*ut:S.length,Gr=Q(S,yr,Yn,ut,!1),Gr===Gr.next&&(Gr.steiner=!0),ft.push(Tt(Gr));for(ft.sort(ze),kt=0;kt<ft.length;kt++)ke=_e(ft[kt],ke),ke=Ce(ke,ke.next);return ke}function ze(S,Se){return S.x-Se.x}function _e(S,Se){var ke=tt(S,Se);if(!ke)return Se;var ut=$e(ke,S),ft=Ce(ke,ke.next);return Ce(ut,ut.next),Se===ke?ft:Se}function tt(S,Se){var ke=Se,ut=S.x,ft=S.y,kt=-Infinity,Ft;do{if(ft<=ke.y&&ft>=ke.next.y&&ke.next.y!==ke.y){var yr=ke.x+(ft-ke.y)*(ke.next.x-ke.x)/(ke.next.y-ke.y);if(yr<=ut&&yr>kt){if(kt=yr,yr===ut){if(ft===ke.y)return ke;if(ft===ke.next.y)return ke.next}Ft=ke.x<ke.next.x?ke:ke.next}}ke=ke.next}while(ke!==Se);if(!Ft)return null;if(ut===kt)return Ft;var Yn=Ft,Gr=Ft.x,Nn=Ft.y,yn=Infinity,zn;ke=Ft;do ut>=ke.x&&ke.x>=Gr&&ut!==ke.x&&Kt(ft<Nn?ut:kt,ft,Gr,Nn,ft<Nn?kt:ut,ft,ke.x,ke.y)&&(zn=Math.abs(ft-ke.y)/(ut-ke.x),qe(ke,S)&&(zn<yn||zn===yn&&(ke.x>Ft.x||ke.x===Ft.x&&mt(Ft,ke)))&&(Ft=ke,yn=zn)),ke=ke.next;while(ke!==Yn);return Ft}function mt(S,Se){return ct(S.prev,S,Se.prev)<0&&ct(Se.next,S,S.next)<0}function wt(S,Se,ke,ut){var ft=S;do ft.z===null&&(ft.z=or(ft.x,ft.y,Se,ke,ut)),ft.prevZ=ft.prev,ft.nextZ=ft.next,ft=ft.next;while(ft!==S);ft.prevZ.nextZ=null,ft.prevZ=null,Nt(ft)}function Nt(S){var Se,ke,ut,ft,kt,Ft,yr,Yn,Gr=1;do{for(ke=S,S=null,kt=null,Ft=0;ke;){for(Ft++,ut=ke,yr=0,Se=0;Se<Gr&&(yr++,ut=ut.nextZ,!!ut);Se++);for(Yn=Gr;yr>0||Yn>0&&ut;)yr!==0&&(Yn===0||!ut||ke.z<=ut.z)?(ft=ke,ke=ke.nextZ,yr--):(ft=ut,ut=ut.nextZ,Yn--),kt?kt.nextZ=ft:S=ft,ft.prevZ=kt,kt=ft;ke=ut}kt.nextZ=null,Gr*=2}while(Ft>1);return S}function or(S,Se,ke,ut,ft){return S=32767*(S-ke)*ft,Se=32767*(Se-ut)*ft,S=(S|S<<8)&16711935,S=(S|S<<4)&252645135,S=(S|S<<2)&858993459,S=(S|S<<1)&1431655765,Se=(Se|Se<<8)&16711935,Se=(Se|Se<<4)&252645135,Se=(Se|Se<<2)&858993459,Se=(Se|Se<<1)&1431655765,S|Se<<1}function Tt(S){var Se=S,ke=S;do(Se.x<ke.x||Se.x===ke.x&&Se.y<ke.y)&&(ke=Se),Se=Se.next;while(Se!==S);return ke}function Kt(S,Se,ke,ut,ft,kt,Ft,yr){return(ft-Ft)*(Se-yr)-(S-Ft)*(kt-yr)>=0&&(S-Ft)*(ut-yr)-(ke-Ft)*(Se-yr)>=0&&(ke-Ft)*(kt-yr)-(ft-Ft)*(ut-yr)>=0}function _t(S,Se){return S.next.i!==Se.i&&S.prev.i!==Se.i&&!at(S,Se)&&(qe(S,Se)&&qe(Se,S)&&Et(S,Se)&&(ct(S.prev,S,Se.prev)||ct(S,Se.prev,Se))||it(S,Se)&&ct(S.prev,S,S.next)>0&&ct(Se.prev,Se,Se.next)>0)}function ct(S,Se,ke){return(Se.y-S.y)*(ke.x-Se.x)-(Se.x-S.x)*(ke.y-Se.y)}function it(S,Se){return S.x===Se.x&&S.y===Se.y}function $t(S,Se,ke,ut){var ft=Xt(ct(S,Se,ke)),kt=Xt(ct(S,Se,ut)),Ft=Xt(ct(ke,ut,S)),yr=Xt(ct(ke,ut,Se));return!!(ft!==kt&&Ft!==yr||ft===0&&Y(S,ke,Se)||kt===0&&Y(S,ut,Se)||Ft===0&&Y(ke,S,ut)||yr===0&&Y(ke,Se,ut))}function Y(S,Se,ke){return Se.x<=Math.max(S.x,ke.x)&&Se.x>=Math.min(S.x,ke.x)&&Se.y<=Math.max(S.y,ke.y)&&Se.y>=Math.min(S.y,ke.y)}function Xt(S){return S>0?1:S<0?-1:0}function at(S,Se){var ke=S;do{if(ke.i!==S.i&&ke.next.i!==S.i&&ke.i!==Se.i&&ke.next.i!==Se.i&&$t(ke,ke.next,S,Se))return!0;ke=ke.next}while(ke!==S);return!1}function qe(S,Se){return ct(S.prev,S,S.next)<0?ct(S,Se,S.next)>=0&&ct(S,S.prev,Se)>=0:ct(S,Se,S.prev)<0||ct(S,S.next,Se)<0}function Et(S,Se){var ke=S,ut=!1,ft=(S.x+Se.x)/2,kt=(S.y+Se.y)/2;do ke.y>kt!=ke.next.y>kt&&ke.next.y!==ke.y&&ft<(ke.next.x-ke.x)*(kt-ke.y)/(ke.next.y-ke.y)+ke.x&&(ut=!ut),ke=ke.next;while(ke!==S);return ut}function $e(S,Se){var ke=new Fr(S.i,S.x,S.y),ut=new Fr(Se.i,Se.x,Se.y),ft=S.next,kt=Se.prev;return S.next=Se,Se.prev=S,ke.next=ft,ft.prev=ke,ut.next=ke,ke.prev=ut,kt.next=ut,ut.prev=kt,ut}function Ht(S,Se,ke,ut){var ft=new Fr(S,Se,ke);return ut?(ft.next=ut.next,ft.prev=ut,ut.next.prev=ft,ut.next=ft):(ft.prev=ft,ft.next=ft),ft}function mr(S){S.next.prev=S.prev,S.prev.next=S.next,S.prevZ&&(S.prevZ.nextZ=S.nextZ),S.nextZ&&(S.nextZ.prevZ=S.prevZ)}function Fr(S,Se,ke){this.i=S,this.x=Se,this.y=ke,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}ne.deviation=function(S,Se,ke,ut){var ft=Se&&Se.length,kt=ft?Se[0]*ke:S.length,Ft=Math.abs(Yr(S,0,kt,ke));if(ft)for(var yr=0,Yn=Se.length;yr<Yn;yr++){var Gr=Se[yr]*ke,Nn=yr<Yn-1?Se[yr+1]*ke:S.length;Ft-=Math.abs(Yr(S,Gr,Nn,ke))}var yn=0;for(yr=0;yr<ut.length;yr+=3){var zn=ut[yr]*ke,si=ut[yr+1]*ke,Gn=ut[yr+2]*ke;yn+=Math.abs((S[zn]-S[Gn])*(S[si+1]-S[zn+1])-(S[zn]-S[si])*(S[Gn+1]-S[zn+1]))}return Ft===0&&yn===0?0:Math.abs((yn-Ft)/Ft)};function Yr(S,Se,ke,ut){for(var ft=0,kt=Se,Ft=ke-ut;kt<ke;kt+=ut)ft+=(S[Ft]-S[kt])*(S[kt+1]+S[Ft+1]),Ft=kt;return ft}ne.flatten=function(S){for(var Se=S[0][0].length,ke={vertices:[],holes:[],dimensions:Se},ut=0,ft=0;ft<S.length;ft++){for(var kt=0;kt<S[ft].length;kt++)for(var Ft=0;Ft<Se;Ft++)ke.vertices.push(S[ft][kt][Ft]);ft>0&&(ut+=S[ft-1].length,ke.holes.push(ut))}return ke}},67709:function(Er){function ne(Ce){var me=Ce.target||Ce.srcElement;me.__resizeRAF__&&cancelAnimationFrame(me.__resizeRAF__),me.__resizeRAF__=requestAnimationFrame(function(){var g=me.__resizeTrigger__,Re=g&&g.__resizeListeners__;Re&&Re.forEach(function(W){W.call(g,Ce)})})}var Q=function(me,g){var Re=this,W=Re.document,he,de=W.attachEvent;typeof navigator!="undefined"&&(he=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function ze(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",ne)}if(!me.__resizeListeners__)if(me.__resizeListeners__=[],de)me.__resizeTrigger__=me,me.attachEvent("onresize",ne);else{getComputedStyle(me).position==="static"&&(me.style.position="relative");var _e=me.__resizeTrigger__=W.createElement("object");_e.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),_e.setAttribute("class","resize-sensor"),_e.setAttribute("tabindex","-1"),_e.setAttribute("title",""),_e.__resizeElement__=me,_e.onload=ze,_e.type="text/html",he&&me.appendChild(_e),_e.data="about:blank",he||me.appendChild(_e)}me.__resizeListeners__.push(g)};Er.exports=typeof window=="undefined"?Q:Q.bind(window),Er.exports.unbind=function(Ce,me){var g=document.attachEvent,Re=Ce.__resizeListeners__||[];if(me){var W=Re.indexOf(me);W!==-1&&Re.splice(W,1)}else Re=Ce.__resizeListeners__=[];if(!Re.length){if(g)Ce.detachEvent("onresize",ne);else if(Ce.__resizeTrigger__){var he=Ce.__resizeTrigger__.contentDocument,de=he&&he.defaultView;de&&(de.removeEventListener("resize",ne),delete de.__resizeTrigger__),Ce.__resizeTrigger__=!Ce.removeChild(Ce.__resizeTrigger__)}delete Ce.__resizeListeners__}}},26729:function(Er){"use strict";var ne=Object.prototype.hasOwnProperty,Q="~";function Ce(){}Object.create&&(Ce.prototype=Object.create(null),new Ce().__proto__||(Q=!1));function me(he,de,ze){this.fn=he,this.context=de,this.once=ze||!1}function g(he,de,ze,_e,tt){if(typeof ze!="function")throw new TypeError("The listener must be a function");var mt=new me(ze,_e||he,tt),wt=Q?Q+de:de;return he._events[wt]?he._events[wt].fn?he._events[wt]=[he._events[wt],mt]:he._events[wt].push(mt):(he._events[wt]=mt,he._eventsCount++),he}function Re(he,de){--he._eventsCount==0?he._events=new Ce:delete he._events[de]}function W(){this._events=new Ce,this._eventsCount=0}W.prototype.eventNames=function(){var de=[],ze,_e;if(this._eventsCount===0)return de;for(_e in ze=this._events)ne.call(ze,_e)&&de.push(Q?_e.slice(1):_e);return Object.getOwnPropertySymbols?de.concat(Object.getOwnPropertySymbols(ze)):de},W.prototype.listeners=function(de){var ze=Q?Q+de:de,_e=this._events[ze];if(!_e)return[];if(_e.fn)return[_e.fn];for(var tt=0,mt=_e.length,wt=new Array(mt);tt<mt;tt++)wt[tt]=_e[tt].fn;return wt},W.prototype.listenerCount=function(de){var ze=Q?Q+de:de,_e=this._events[ze];return _e?_e.fn?1:_e.length:0},W.prototype.emit=function(de,ze,_e,tt,mt,wt){var Nt=Q?Q+de:de;if(!this._events[Nt])return!1;var or=this._events[Nt],Tt=arguments.length,Kt,_t;if(or.fn){switch(or.once&&this.removeListener(de,or.fn,void 0,!0),Tt){case 1:return or.fn.call(or.context),!0;case 2:return or.fn.call(or.context,ze),!0;case 3:return or.fn.call(or.context,ze,_e),!0;case 4:return or.fn.call(or.context,ze,_e,tt),!0;case 5:return or.fn.call(or.context,ze,_e,tt,mt),!0;case 6:return or.fn.call(or.context,ze,_e,tt,mt,wt),!0}for(_t=1,Kt=new Array(Tt-1);_t<Tt;_t++)Kt[_t-1]=arguments[_t];or.fn.apply(or.context,Kt)}else{var ct=or.length,it;for(_t=0;_t<ct;_t++)switch(or[_t].once&&this.removeListener(de,or[_t].fn,void 0,!0),Tt){case 1:or[_t].fn.call(or[_t].context);break;case 2:or[_t].fn.call(or[_t].context,ze);break;case 3:or[_t].fn.call(or[_t].context,ze,_e);break;case 4:or[_t].fn.call(or[_t].context,ze,_e,tt);break;default:if(!Kt)for(it=1,Kt=new Array(Tt-1);it<Tt;it++)Kt[it-1]=arguments[it];or[_t].fn.apply(or[_t].context,Kt)}}return!0},W.prototype.on=function(de,ze,_e){return g(this,de,ze,_e,!1)},W.prototype.once=function(de,ze,_e){return g(this,de,ze,_e,!0)},W.prototype.removeListener=function(de,ze,_e,tt){var mt=Q?Q+de:de;if(!this._events[mt])return this;if(!ze)return Re(this,mt),this;var wt=this._events[mt];if(wt.fn)wt.fn===ze&&(!tt||wt.once)&&(!_e||wt.context===_e)&&Re(this,mt);else{for(var Nt=0,or=[],Tt=wt.length;Nt<Tt;Nt++)(wt[Nt].fn!==ze||tt&&!wt[Nt].once||_e&&wt[Nt].context!==_e)&&or.push(wt[Nt]);or.length?this._events[mt]=or.length===1?or[0]:or:Re(this,mt)}return this},W.prototype.removeAllListeners=function(de){var ze;return de?(ze=Q?Q+de:de,this._events[ze]&&Re(this,ze)):(this._events=new Ce,this._eventsCount=0),this},W.prototype.off=W.prototype.removeListener,W.prototype.addListener=W.prototype.on,W.prefixed=Q,W.EventEmitter=W,Er.exports=W},7375:function(Er,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0});var Q=Symbol.for("INJECTION");function Ce(he,de,ze,_e){function tt(){return _e&&!Reflect.hasMetadata(Q,this,de)&&Reflect.defineMetadata(Q,ze(),this,de),Reflect.hasMetadata(Q,this,de)?Reflect.getMetadata(Q,this,de):ze()}function mt(wt){Reflect.defineMetadata(Q,wt,this,de)}Object.defineProperty(he,de,{configurable:!0,enumerable:!0,get:tt,set:mt})}function me(he,de){return function(ze){return function(_e,tt){var mt=function(){return he.get(ze)};Ce(_e,tt,mt,de)}}}ne.makePropertyInjectDecorator=me;function g(he,de){return function(ze,_e){return function(tt,mt){var wt=function(){return he.getNamed(ze,_e)};Ce(tt,mt,wt,de)}}}ne.makePropertyInjectNamedDecorator=g;function Re(he,de){return function(ze,_e,tt){return function(mt,wt){var Nt=function(){return he.getTagged(ze,_e,tt)};Ce(mt,wt,Nt,de)}}}ne.makePropertyInjectTaggedDecorator=Re;function W(he,de){return function(ze){return function(_e,tt){var mt=function(){return he.getAll(ze)};Ce(_e,tt,mt,de)}}}ne.makePropertyMultiInjectDecorator=W},84879:function(Er,ne,Q){"use strict";var Ce;Ce={value:!0};var me=Q(7375);function g(Re,W){W===void 0&&(W=!0);var he=me.makePropertyInjectDecorator(Re,W),de=me.makePropertyInjectNamedDecorator(Re,W),ze=me.makePropertyInjectTaggedDecorator(Re,W),_e=me.makePropertyMultiInjectDecorator(Re,W);return{lazyInject:he,lazyInjectNamed:de,lazyInjectTagged:ze,lazyMultiInject:_e}}ne.Z=g},99934:function(Er,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.tagProperty=ne.tagParameter=ne.decorate=void 0;var Ce=Q(16674),me=Q(6867);function g(_e,tt,mt,wt){var Nt=me.TAGGED;W(Nt,_e,tt,wt,mt)}ne.tagParameter=g;function Re(_e,tt,mt){var wt=me.TAGGED_PROP;W(wt,_e.constructor,tt,mt)}ne.tagProperty=Re;function W(_e,tt,mt,wt,Nt){var or={},Tt=typeof Nt=="number",Kt=Nt!==void 0&&Tt?Nt.toString():mt;if(Tt&&mt!==void 0)throw new Error(Ce.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(_e,tt)&&(or=Reflect.getMetadata(_e,tt));var _t=or[Kt];if(!Array.isArray(_t))_t=[];else for(var ct=0,it=_t;ct<it.length;ct++){var $t=it[ct];if($t.key===wt.key)throw new Error(Ce.DUPLICATED_METADATA+" "+$t.key.toString())}_t.push(wt),or[Kt]=_t,Reflect.defineMetadata(_e,or,tt)}function he(_e,tt){Reflect.decorate(_e,tt)}function de(_e,tt){return function(mt,wt){tt(mt,wt,_e)}}function ze(_e,tt,mt){typeof mt=="number"?he([de(mt,_e)],tt):typeof mt=="string"?Reflect.decorate([_e],tt,mt):he([_e],tt)}ne.decorate=ze},5744:function(Er,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.inject=ne.LazyServiceIdentifer=void 0;var Ce=Q(16674),me=Q(6867),g=Q(47738),Re=Q(99934),W=function(){function de(ze){this._cb=ze}return de.prototype.unwrap=function(){return this._cb()},de}();ne.LazyServiceIdentifer=W;function he(de){return function(ze,_e,tt){if(de===void 0)throw new Error(Ce.UNDEFINED_INJECT_ANNOTATION(ze.name));var mt=new g.Metadata(me.INJECT_TAG,de);typeof tt=="number"?Re.tagParameter(ze,_e,tt,mt):Re.tagProperty(ze,_e,mt)}}ne.inject=he},64315:function(Er,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.injectable=void 0;var Ce=Q(16674),me=Q(6867);function g(){return function(Re){if(Reflect.hasOwnMetadata(me.PARAM_TYPES,Re))throw new Error(Ce.DUPLICATED_INJECTABLE_DECORATOR);var W=Reflect.getMetadata(me.DESIGN_PARAM_TYPES,Re)||[];return Reflect.defineMetadata(me.PARAM_TYPES,W,Re),Re}}ne.injectable=g},71693:function(Er,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.multiInject=void 0;var Ce=Q(6867),me=Q(47738),g=Q(99934);function Re(W){return function(he,de,ze){var _e=new me.Metadata(Ce.MULTI_INJECT_TAG,W);typeof ze=="number"?g.tagParameter(he,de,ze,_e):g.tagProperty(he,de,_e)}}ne.multiInject=Re},38085:function(Er,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.named=void 0;var Ce=Q(6867),me=Q(47738),g=Q(99934);function Re(W){return function(he,de,ze){var _e=new me.Metadata(Ce.NAMED_TAG,W);typeof ze=="number"?g.tagParameter(he,de,ze,_e):g.tagProperty(he,de,_e)}}ne.named=Re},6515:function(Er,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.optional=void 0;var Ce=Q(6867),me=Q(47738),g=Q(99934);function Re(){return function(W,he,de){var ze=new me.Metadata(Ce.OPTIONAL_TAG,!0);typeof de=="number"?g.tagParameter(W,he,de,ze):g.tagProperty(W,he,ze)}}ne.optional=Re},7014:function(Er,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.postConstruct=void 0;var Ce=Q(16674),me=Q(6867),g=Q(47738);function Re(){return function(W,he,de){var ze=new g.Metadata(me.POST_CONSTRUCT,he);if(Reflect.hasOwnMetadata(me.POST_CONSTRUCT,W.constructor))throw new Error(Ce.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(me.POST_CONSTRUCT,ze,W.constructor)}}ne.postConstruct=Re},32052:function(Er,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.tagged=void 0;var Ce=Q(47738),me=Q(99934);function g(Re,W){return function(he,de,ze){var _e=new Ce.Metadata(Re,W);typeof ze=="number"?me.tagParameter(he,de,ze,_e):me.tagProperty(he,de,_e)}}ne.tagged=g},55638:function(Er,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.targetName=void 0;var Ce=Q(6867),me=Q(47738),g=Q(99934);function Re(W){return function(he,de,ze){var _e=new me.Metadata(Ce.NAME_TAG,W);g.tagParameter(he,de,ze,_e)}}ne.targetName=Re},86757:function(Er,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.unmanaged=void 0;var Ce=Q(6867),me=Q(47738),g=Q(99934);function Re(){return function(W,he,de){var ze=new me.Metadata(Ce.UNMANAGED_TAG,!0);g.tagParameter(W,he,de,ze)}}ne.unmanaged=Re},44290:function(Er,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.Binding=void 0;var Ce=Q(28421),me=Q(37791),g=function(){function Re(W,he){this.id=me.id(),this.activated=!1,this.serviceIdentifier=W,this.scope=he,this.type=Ce.BindingTypeEnum.Invalid,this.constraint=function(de){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return Re.prototype.clone=function(){var W=new Re(this.serviceIdentifier,this.scope);return W.activated=W.scope===Ce.BindingScopeEnum.Singleton?this.activated:!1,W.implementationType=this.implementationType,W.dynamicValue=this.dynamicValue,W.scope=this.scope,W.type=this.type,W.factory=this.factory,W.provider=this.provider,W.constraint=this.constraint,W.onActivation=this.onActivation,W.cache=this.cache,W},Re}();ne.Binding=g},23184:function(Er,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.BindingCount=void 0;var Q={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};ne.BindingCount=Q},16674:function(Er,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.STACK_OVERFLOW=ne.CIRCULAR_DEPENDENCY_IN_FACTORY=ne.POST_CONSTRUCT_ERROR=ne.MULTIPLE_POST_CONSTRUCT_METHODS=ne.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=ne.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=ne.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=ne.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=ne.ARGUMENTS_LENGTH_MISMATCH=ne.INVALID_DECORATOR_OPERATION=ne.INVALID_TO_SELF_VALUE=ne.INVALID_FUNCTION_BINDING=ne.INVALID_MIDDLEWARE_RETURN=ne.NO_MORE_SNAPSHOTS_AVAILABLE=ne.INVALID_BINDING_TYPE=ne.NOT_IMPLEMENTED=ne.CIRCULAR_DEPENDENCY=ne.UNDEFINED_INJECT_ANNOTATION=ne.MISSING_INJECT_ANNOTATION=ne.MISSING_INJECTABLE_ANNOTATION=ne.NOT_REGISTERED=ne.CANNOT_UNBIND=ne.AMBIGUOUS_MATCH=ne.KEY_NOT_FOUND=ne.NULL_ARGUMENT=ne.DUPLICATED_METADATA=ne.DUPLICATED_INJECTABLE_DECORATOR=void 0,ne.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",ne.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",ne.NULL_ARGUMENT="NULL argument",ne.KEY_NOT_FOUND="Key Not Found",ne.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",ne.CANNOT_UNBIND="Could not unbind serviceIdentifier:",ne.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",ne.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",ne.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var Q=function(Re){return"@inject called with undefined this could mean that the class "+Re+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};ne.UNDEFINED_INJECT_ANNOTATION=Q,ne.CIRCULAR_DEPENDENCY="Circular dependency found:",ne.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",ne.INVALID_BINDING_TYPE="Invalid binding type:",ne.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",ne.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",ne.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",ne.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",ne.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var Ce=function(){for(var Re=[],W=0;W<arguments.length;W++)Re[W]=arguments[W];return"The number of constructor arguments in the derived class "+(Re[0]+" must be >= than the number of constructor arguments of its base class.")};ne.ARGUMENTS_LENGTH_MISMATCH=Ce,ne.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",ne.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",ne.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",ne.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",ne.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var me=function(){for(var Re=[],W=0;W<arguments.length;W++)Re[W]=arguments[W];return"@postConstruct error in class "+Re[0]+": "+Re[1]};ne.POST_CONSTRUCT_ERROR=me;var g=function(){for(var Re=[],W=0;W<arguments.length;W++)Re[W]=arguments[W];return"It looks like there is a circular dependency "+("in one of the '"+Re[0]+"' bindings. Please investigate bindings with")+("service identifier '"+Re[1]+"'.")};ne.CIRCULAR_DEPENDENCY_IN_FACTORY=g,ne.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(Er,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.TargetTypeEnum=ne.BindingTypeEnum=ne.BindingScopeEnum=void 0;var Q={Request:"Request",Singleton:"Singleton",Transient:"Transient"};ne.BindingScopeEnum=Q;var Ce={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};ne.BindingTypeEnum=Ce;var me={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};ne.TargetTypeEnum=me},6867:function(Er,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.NON_CUSTOM_TAG_KEYS=ne.POST_CONSTRUCT=ne.DESIGN_PARAM_TYPES=ne.PARAM_TYPES=ne.TAGGED_PROP=ne.TAGGED=ne.MULTI_INJECT_TAG=ne.INJECT_TAG=ne.OPTIONAL_TAG=ne.UNMANAGED_TAG=ne.NAME_TAG=ne.NAMED_TAG=void 0,ne.NAMED_TAG="named",ne.NAME_TAG="name",ne.UNMANAGED_TAG="unmanaged",ne.OPTIONAL_TAG="optional",ne.INJECT_TAG="inject",ne.MULTI_INJECT_TAG="multi_inject",ne.TAGGED="inversify:tagged",ne.TAGGED_PROP="inversify:tagged_props",ne.PARAM_TYPES="inversify:paramtypes",ne.DESIGN_PARAM_TYPES="design:paramtypes",ne.POST_CONSTRUCT="post_construct";function Q(){return[ne.INJECT_TAG,ne.MULTI_INJECT_TAG,ne.NAME_TAG,ne.UNMANAGED_TAG,ne.NAMED_TAG,ne.OPTIONAL_TAG]}ne.NON_CUSTOM_TAG_KEYS=Q()},51389:function(Er,ne,Q){"use strict";var Ce=this&&this.__awaiter||function(_t,ct,it,$t){function Y(Xt){return Xt instanceof it?Xt:new it(function(at){at(Xt)})}return new(it||(it=Promise))(function(Xt,at){function qe(Ht){try{$e($t.next(Ht))}catch(mr){at(mr)}}function Et(Ht){try{$e($t.throw(Ht))}catch(mr){at(mr)}}function $e(Ht){Ht.done?Xt(Ht.value):Y(Ht.value).then(qe,Et)}$e(($t=$t.apply(_t,ct||[])).next())})},me=this&&this.__generator||function(_t,ct){var it={label:0,sent:function(){if(Xt[0]&1)throw Xt[1];return Xt[1]},trys:[],ops:[]},$t,Y,Xt,at;return at={next:qe(0),throw:qe(1),return:qe(2)},typeof Symbol=="function"&&(at[Symbol.iterator]=function(){return this}),at;function qe($e){return function(Ht){return Et([$e,Ht])}}function Et($e){if($t)throw new TypeError("Generator is already executing.");for(;it;)try{if($t=1,Y&&(Xt=$e[0]&2?Y.return:$e[0]?Y.throw||((Xt=Y.return)&&Xt.call(Y),0):Y.next)&&!(Xt=Xt.call(Y,$e[1])).done)return Xt;switch(Y=0,Xt&&($e=[$e[0]&2,Xt.value]),$e[0]){case 0:case 1:Xt=$e;break;case 4:return it.label++,{value:$e[1],done:!1};case 5:it.label++,Y=$e[1],$e=[0];continue;case 7:$e=it.ops.pop(),it.trys.pop();continue;default:if(Xt=it.trys,!(Xt=Xt.length>0&&Xt[Xt.length-1])&&($e[0]===6||$e[0]===2)){it=0;continue}if($e[0]===3&&(!Xt||$e[1]>Xt[0]&&$e[1]<Xt[3])){it.label=$e[1];break}if($e[0]===6&&it.label<Xt[1]){it.label=Xt[1],Xt=$e;break}if(Xt&&it.label<Xt[2]){it.label=Xt[2],it.ops.push($e);break}Xt[2]&&it.ops.pop(),it.trys.pop();continue}$e=ct.call(_t,it)}catch(Ht){$e=[6,Ht],Y=0}finally{$t=Xt=0}if($e[0]&5)throw $e[1];return{value:$e[0]?$e[1]:void 0,done:!0}}},g=this&&this.__spreadArray||function(_t,ct){for(var it=0,$t=ct.length,Y=_t.length;it<$t;it++,Y++)_t[Y]=ct[it];return _t};Object.defineProperty(ne,"__esModule",{value:!0}),ne.Container=void 0;var Re=Q(44290),W=Q(16674),he=Q(28421),de=Q(6867),ze=Q(51377),_e=Q(86311),tt=Q(31927),mt=Q(15451),wt=Q(37791),Nt=Q(55800),or=Q(85700),Tt=Q(80175),Kt=function(){function _t(ct){this._appliedMiddleware=[];var it=ct||{};if(typeof it!="object")throw new Error(""+W.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(it.defaultScope===void 0)it.defaultScope=he.BindingScopeEnum.Transient;else if(it.defaultScope!==he.BindingScopeEnum.Singleton&&it.defaultScope!==he.BindingScopeEnum.Transient&&it.defaultScope!==he.BindingScopeEnum.Request)throw new Error(""+W.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(it.autoBindInjectable===void 0)it.autoBindInjectable=!1;else if(typeof it.autoBindInjectable!="boolean")throw new Error(""+W.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(it.skipBaseClassChecks===void 0)it.skipBaseClassChecks=!1;else if(typeof it.skipBaseClassChecks!="boolean")throw new Error(""+W.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:it.autoBindInjectable,defaultScope:it.defaultScope,skipBaseClassChecks:it.skipBaseClassChecks},this.id=wt.id(),this._bindingDictionary=new Tt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new ze.MetadataReader}return _t.merge=function(ct,it){for(var $t=[],Y=2;Y<arguments.length;Y++)$t[Y-2]=arguments[Y];var Xt=new _t,at=g([ct,it],$t).map(function($e){return _e.getBindingDictionary($e)}),qe=_e.getBindingDictionary(Xt);function Et($e,Ht){$e.traverse(function(mr,Fr){Fr.forEach(function(Yr){Ht.add(Yr.serviceIdentifier,Yr.clone())})})}return at.forEach(function($e){Et($e,qe)}),Xt},_t.prototype.load=function(){for(var ct=[],it=0;it<arguments.length;it++)ct[it]=arguments[it];for(var $t=this._getContainerModuleHelpersFactory(),Y=0,Xt=ct;Y<Xt.length;Y++){var at=Xt[Y],qe=$t(at.id);at.registry(qe.bindFunction,qe.unbindFunction,qe.isboundFunction,qe.rebindFunction)}},_t.prototype.loadAsync=function(){for(var ct=[],it=0;it<arguments.length;it++)ct[it]=arguments[it];return Ce(this,void 0,void 0,function(){var $t,Y,Xt,at,qe;return me(this,function(Et){switch(Et.label){case 0:$t=this._getContainerModuleHelpersFactory(),Y=0,Xt=ct,Et.label=1;case 1:return Y<Xt.length?(at=Xt[Y],qe=$t(at.id),[4,at.registry(qe.bindFunction,qe.unbindFunction,qe.isboundFunction,qe.rebindFunction)]):[3,4];case 2:Et.sent(),Et.label=3;case 3:return Y++,[3,1];case 4:return[2]}})})},_t.prototype.unload=function(){for(var ct=this,it=[],$t=0;$t<arguments.length;$t++)it[$t]=arguments[$t];var Y=function(Xt){return function(at){return at.moduleId===Xt}};it.forEach(function(Xt){var at=Y(Xt.id);ct._bindingDictionary.removeByCondition(at)})},_t.prototype.bind=function(ct){var it=this.options.defaultScope||he.BindingScopeEnum.Transient,$t=new Re.Binding(ct,it);return this._bindingDictionary.add(ct,$t),new mt.BindingToSyntax($t)},_t.prototype.rebind=function(ct){return this.unbind(ct),this.bind(ct)},_t.prototype.unbind=function(ct){try{this._bindingDictionary.remove(ct)}catch(it){throw new Error(W.CANNOT_UNBIND+" "+Nt.getServiceIdentifierAsString(ct))}},_t.prototype.unbindAll=function(){this._bindingDictionary=new Tt.Lookup},_t.prototype.isBound=function(ct){var it=this._bindingDictionary.hasKey(ct);return!it&&this.parent&&(it=this.parent.isBound(ct)),it},_t.prototype.isBoundNamed=function(ct,it){return this.isBoundTagged(ct,de.NAMED_TAG,it)},_t.prototype.isBoundTagged=function(ct,it,$t){var Y=!1;if(this._bindingDictionary.hasKey(ct)){var Xt=this._bindingDictionary.get(ct),at=_e.createMockRequest(this,ct,it,$t);Y=Xt.some(function(qe){return qe.constraint(at)})}return!Y&&this.parent&&(Y=this.parent.isBoundTagged(ct,it,$t)),Y},_t.prototype.snapshot=function(){this._snapshots.push(or.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},_t.prototype.restore=function(){var ct=this._snapshots.pop();if(ct===void 0)throw new Error(W.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=ct.bindings,this._middleware=ct.middleware},_t.prototype.createChild=function(ct){var it=new _t(ct||this.options);return it.parent=this,it},_t.prototype.applyMiddleware=function(){for(var ct=[],it=0;it<arguments.length;it++)ct[it]=arguments[it];this._appliedMiddleware=this._appliedMiddleware.concat(ct);var $t=this._middleware?this._middleware:this._planAndResolve();this._middleware=ct.reduce(function(Y,Xt){return Xt(Y)},$t)},_t.prototype.applyCustomMetadataReader=function(ct){this._metadataReader=ct},_t.prototype.get=function(ct){return this._get(!1,!1,he.TargetTypeEnum.Variable,ct)},_t.prototype.getTagged=function(ct,it,$t){return this._get(!1,!1,he.TargetTypeEnum.Variable,ct,it,$t)},_t.prototype.getNamed=function(ct,it){return this.getTagged(ct,de.NAMED_TAG,it)},_t.prototype.getAll=function(ct){return this._get(!0,!0,he.TargetTypeEnum.Variable,ct)},_t.prototype.getAllTagged=function(ct,it,$t){return this._get(!1,!0,he.TargetTypeEnum.Variable,ct,it,$t)},_t.prototype.getAllNamed=function(ct,it){return this.getAllTagged(ct,de.NAMED_TAG,it)},_t.prototype.resolve=function(ct){var it=this.createChild();return it.bind(ct).toSelf(),this._appliedMiddleware.forEach(function($t){it.applyMiddleware($t)}),it.get(ct)},_t.prototype._getContainerModuleHelpersFactory=function(){var ct=this,it=function(qe,Et){qe._binding.moduleId=Et},$t=function(qe){return function(Et){var $e=ct.bind.bind(ct),Ht=$e(Et);return it(Ht,qe),Ht}},Y=function(qe){return function(Et){var $e=ct.unbind.bind(ct);$e(Et)}},Xt=function(qe){return function(Et){var $e=ct.isBound.bind(ct);return $e(Et)}},at=function(qe){return function(Et){var $e=ct.rebind.bind(ct),Ht=$e(Et);return it(Ht,qe),Ht}};return function(qe){return{bindFunction:$t(qe),isboundFunction:Xt(qe),rebindFunction:at(qe),unbindFunction:Y(qe)}}},_t.prototype._get=function(ct,it,$t,Y,Xt,at){var qe=null,Et={avoidConstraints:ct,contextInterceptor:function($e){return $e},isMultiInject:it,key:Xt,serviceIdentifier:Y,targetType:$t,value:at};if(this._middleware){if(qe=this._middleware(Et),qe==null)throw new Error(W.INVALID_MIDDLEWARE_RETURN)}else qe=this._planAndResolve()(Et);return qe},_t.prototype._planAndResolve=function(){var ct=this;return function(it){var $t=_e.plan(ct._metadataReader,ct,it.isMultiInject,it.targetType,it.serviceIdentifier,it.key,it.value,it.avoidConstraints);$t=it.contextInterceptor($t);var Y=tt.resolve($t);return Y}},_t}();ne.Container=Kt},33244:function(Er,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.AsyncContainerModule=ne.ContainerModule=void 0;var Ce=Q(37791),me=function(){function Re(W){this.id=Ce.id(),this.registry=W}return Re}();ne.ContainerModule=me;var g=function(){function Re(W){this.id=Ce.id(),this.registry=W}return Re}();ne.AsyncContainerModule=g},85700:function(Er,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.ContainerSnapshot=void 0;var Q=function(){function Ce(){}return Ce.of=function(me,g){var Re=new Ce;return Re.bindings=me,Re.middleware=g,Re},Ce}();ne.ContainerSnapshot=Q},80175:function(Er,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.Lookup=void 0;var Ce=Q(16674),me=function(){function g(){this._map=new Map}return g.prototype.getMap=function(){return this._map},g.prototype.add=function(Re,W){if(Re==null)throw new Error(Ce.NULL_ARGUMENT);if(W==null)throw new Error(Ce.NULL_ARGUMENT);var he=this._map.get(Re);he!==void 0?(he.push(W),this._map.set(Re,he)):this._map.set(Re,[W])},g.prototype.get=function(Re){if(Re==null)throw new Error(Ce.NULL_ARGUMENT);var W=this._map.get(Re);if(W!==void 0)return W;throw new Error(Ce.KEY_NOT_FOUND)},g.prototype.remove=function(Re){if(Re==null)throw new Error(Ce.NULL_ARGUMENT);if(!this._map.delete(Re))throw new Error(Ce.KEY_NOT_FOUND)},g.prototype.removeByCondition=function(Re){var W=this;this._map.forEach(function(he,de){var ze=he.filter(function(_e){return!Re(_e)});ze.length>0?W._map.set(de,ze):W._map.delete(de)})},g.prototype.hasKey=function(Re){if(Re==null)throw new Error(Ce.NULL_ARGUMENT);return this._map.has(Re)},g.prototype.clone=function(){var Re=new g;return this._map.forEach(function(W,he){W.forEach(function(de){return Re.add(he,de.clone())})}),Re},g.prototype.traverse=function(Re){this._map.forEach(function(W,he){Re(he,W)})},g}();ne.Lookup=me},86700:function(Er,ne,Q){"use strict";var Ce;Ce={value:!0},Ce=Ce=Ce=Ce=Ce=Ce=ne.GW=Ce=Ce=ne.zY=Ce=Ce=Ce=Ce=Ce=ne.f3=Ce=Ce=ne.b2=Ce=Ce=Ce=Ce=Ce=ne.W2=Ce=void 0;var me=Q(6867);Ce=me;var g=Q(51389);Object.defineProperty(ne,"W2",{enumerable:!0,get:function(){return g.Container}});var Re=Q(28421);Ce={enumerable:!0,get:function(){return Re.BindingScopeEnum}},Ce={enumerable:!0,get:function(){return Re.BindingTypeEnum}},Ce={enumerable:!0,get:function(){return Re.TargetTypeEnum}};var W=Q(33244);Ce={enumerable:!0,get:function(){return W.AsyncContainerModule}},Ce={enumerable:!0,get:function(){return W.ContainerModule}};var he=Q(64315);Object.defineProperty(ne,"b2",{enumerable:!0,get:function(){return he.injectable}});var de=Q(32052);Ce={enumerable:!0,get:function(){return de.tagged}};var ze=Q(38085);Ce={enumerable:!0,get:function(){return ze.named}};var _e=Q(5744);Object.defineProperty(ne,"f3",{enumerable:!0,get:function(){return _e.inject}}),Ce={enumerable:!0,get:function(){return _e.LazyServiceIdentifer}};var tt=Q(6515);Ce={enumerable:!0,get:function(){return tt.optional}};var mt=Q(86757);Ce={enumerable:!0,get:function(){return mt.unmanaged}};var wt=Q(71693);Ce={enumerable:!0,get:function(){return wt.multiInject}};var Nt=Q(55638);Ce={enumerable:!0,get:function(){return Nt.targetName}};var or=Q(7014);Object.defineProperty(ne,"zY",{enumerable:!0,get:function(){return or.postConstruct}});var Tt=Q(51377);Ce={enumerable:!0,get:function(){return Tt.MetadataReader}};var Kt=Q(37791);Ce={enumerable:!0,get:function(){return Kt.id}};var _t=Q(99934);Object.defineProperty(ne,"GW",{enumerable:!0,get:function(){return _t.decorate}});var ct=Q(80758);Ce={enumerable:!0,get:function(){return ct.traverseAncerstors}},Ce={enumerable:!0,get:function(){return ct.taggedConstraint}},Ce={enumerable:!0,get:function(){return ct.namedConstraint}},Ce={enumerable:!0,get:function(){return ct.typeConstraint}};var it=Q(55800);Ce={enumerable:!0,get:function(){return it.getServiceIdentifierAsString}};var $t=Q(70600);Ce={enumerable:!0,get:function(){return $t.multiBindToService}}},95228:function(Er,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.Context=void 0;var Ce=Q(37791),me=function(){function g(Re){this.id=Ce.id(),this.container=Re}return g.prototype.addPlan=function(Re){this.plan=Re},g.prototype.setCurrentRequest=function(Re){this.currentRequest=Re},g}();ne.Context=me},47738:function(Er,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.Metadata=void 0;var Ce=Q(6867),me=function(){function g(Re,W){this.key=Re,this.value=W}return g.prototype.toString=function(){return this.key===Ce.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},g}();ne.Metadata=me},51377:function(Er,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.MetadataReader=void 0;var Ce=Q(6867),me=function(){function g(){}return g.prototype.getConstructorMetadata=function(Re){var W=Reflect.getMetadata(Ce.PARAM_TYPES,Re),he=Reflect.getMetadata(Ce.TAGGED,Re);return{compilerGeneratedMetadata:W,userGeneratedMetadata:he||{}}},g.prototype.getPropertiesMetadata=function(Re){var W=Reflect.getMetadata(Ce.TAGGED_PROP,Re)||[];return W},g}();ne.MetadataReader=me},55314:function(Er,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.Plan=void 0;var Q=function(){function Ce(me,g){this.parentContext=me,this.rootRequest=g}return Ce}();ne.Plan=Q},86311:function(Er,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.getBindingDictionary=ne.createMockRequest=ne.plan=void 0;var Ce=Q(23184),me=Q(16674),g=Q(28421),Re=Q(6867),W=Q(85265),he=Q(55800),de=Q(95228),ze=Q(47738),_e=Q(55314),tt=Q(6e3),mt=Q(6748),wt=Q(18924);function Nt(Y){return Y._bindingDictionary}ne.getBindingDictionary=Nt;function or(Y,Xt,at,qe,Et,$e){var Ht=Y?Re.MULTI_INJECT_TAG:Re.INJECT_TAG,mr=new ze.Metadata(Ht,at),Fr=new wt.Target(Xt,qe,at,mr);if(Et!==void 0){var Yr=new ze.Metadata(Et,$e);Fr.metadata.push(Yr)}return Fr}function Tt(Y,Xt,at,qe,Et){var $e=ct(at.container,Et.serviceIdentifier),Ht=[];return $e.length===Ce.BindingCount.NoBindingsAvailable&&at.container.options.autoBindInjectable&&typeof Et.serviceIdentifier=="function"&&Y.getConstructorMetadata(Et.serviceIdentifier).compilerGeneratedMetadata&&(at.container.bind(Et.serviceIdentifier).toSelf(),$e=ct(at.container,Et.serviceIdentifier)),Xt?Ht=$e:Ht=$e.filter(function(mr){var Fr=new mt.Request(mr.serviceIdentifier,at,qe,mr,Et);return mr.constraint(Fr)}),Kt(Et.serviceIdentifier,Ht,Et,at.container),Ht}function Kt(Y,Xt,at,qe){switch(Xt.length){case Ce.BindingCount.NoBindingsAvailable:if(at.isOptional())return Xt;var Et=he.getServiceIdentifierAsString(Y),$e=me.NOT_REGISTERED;throw $e+=he.listMetadataForTarget(Et,at),$e+=he.listRegisteredBindingsForServiceIdentifier(qe,Et,ct),new Error($e);case Ce.BindingCount.OnlyOneBindingAvailable:if(!at.isArray())return Xt;case Ce.BindingCount.MultipleBindingsAvailable:default:if(at.isArray())return Xt;var Et=he.getServiceIdentifierAsString(Y),$e=me.AMBIGUOUS_MATCH+" "+Et;throw $e+=he.listRegisteredBindingsForServiceIdentifier(qe,Et,ct),new Error($e)}}function _t(Y,Xt,at,qe,Et,$e){var Ht,mr;if(Et===null){Ht=Tt(Y,Xt,qe,null,$e),mr=new mt.Request(at,qe,null,Ht,$e);var Fr=new _e.Plan(qe,mr);qe.addPlan(Fr)}else Ht=Tt(Y,Xt,qe,Et,$e),mr=Et.addChildRequest($e.serviceIdentifier,Ht,$e);Ht.forEach(function(Yr){var S=null;if($e.isArray())S=mr.addChildRequest(Yr.serviceIdentifier,Yr,$e);else{if(Yr.cache)return;S=mr}if(Yr.type===g.BindingTypeEnum.Instance&&Yr.implementationType!==null){var Se=tt.getDependencies(Y,Yr.implementationType);if(!qe.container.options.skipBaseClassChecks){var ke=tt.getBaseClassDependencyCount(Y,Yr.implementationType);if(Se.length<ke){var ut=me.ARGUMENTS_LENGTH_MISMATCH(tt.getFunctionName(Yr.implementationType));throw new Error(ut)}}Se.forEach(function(ft){_t(Y,!1,ft.serviceIdentifier,qe,S,ft)})}})}function ct(Y,Xt){var at=[],qe=Nt(Y);return qe.hasKey(Xt)?at=qe.get(Xt):Y.parent!==null&&(at=ct(Y.parent,Xt)),at}function it(Y,Xt,at,qe,Et,$e,Ht,mr){mr===void 0&&(mr=!1);var Fr=new de.Context(Xt),Yr=or(at,qe,Et,"",$e,Ht);try{return _t(Y,mr,Et,Fr,null,Yr),Fr}catch(S){throw W.isStackOverflowExeption(S)&&Fr.plan&&he.circularDependencyToException(Fr.plan.rootRequest),S}}ne.plan=it;function $t(Y,Xt,at,qe){var Et=new wt.Target(g.TargetTypeEnum.Variable,"",Xt,new ze.Metadata(at,qe)),$e=new de.Context(Y),Ht=new mt.Request(Xt,$e,null,[],Et);return Ht}ne.createMockRequest=$t},88460:function(Er,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.QueryableString=void 0;var Q=function(){function Ce(me){this.str=me}return Ce.prototype.startsWith=function(me){return this.str.indexOf(me)===0},Ce.prototype.endsWith=function(me){var g="",Re=me.split("").reverse().join("");return g=this.str.split("").reverse().join(""),this.startsWith.call({str:g},Re)},Ce.prototype.contains=function(me){return this.str.indexOf(me)!==-1},Ce.prototype.equals=function(me){return this.str===me},Ce.prototype.value=function(){return this.str},Ce}();ne.QueryableString=Q},6e3:function(Er,ne,Q){"use strict";var Ce=this&&this.__spreadArray||function(Tt,Kt){for(var _t=0,ct=Kt.length,it=Tt.length;_t<ct;_t++,it++)Tt[it]=Kt[_t];return Tt};Object.defineProperty(ne,"__esModule",{value:!0}),ne.getFunctionName=ne.getBaseClassDependencyCount=ne.getDependencies=void 0;var me=Q(5744),g=Q(16674),Re=Q(28421),W=Q(6867),he=Q(55800);Object.defineProperty(ne,"getFunctionName",{enumerable:!0,get:function(){return he.getFunctionName}});var de=Q(18924);function ze(Tt,Kt){var _t=he.getFunctionName(Kt),ct=_e(Tt,_t,Kt,!1);return ct}ne.getDependencies=ze;function _e(Tt,Kt,_t,ct){var it=Tt.getConstructorMetadata(_t),$t=it.compilerGeneratedMetadata;if($t===void 0){var Y=g.MISSING_INJECTABLE_ANNOTATION+" "+Kt+".";throw new Error(Y)}var Xt=it.userGeneratedMetadata,at=Object.keys(Xt),qe=_t.length===0&&at.length>0,Et=at.length>_t.length,$e=qe||Et?at.length:_t.length,Ht=mt(ct,Kt,$t,Xt,$e),mr=wt(Tt,_t),Fr=Ce(Ce([],Ht),mr);return Fr}function tt(Tt,Kt,_t,ct,it){var $t=it[Tt.toString()]||[],Y=or($t),Xt=Y.unmanaged!==!0,at=ct[Tt],qe=Y.inject||Y.multiInject;if(at=qe||at,at instanceof me.LazyServiceIdentifer&&(at=at.unwrap()),Xt){var Et=at===Object,$e=at===Function,Ht=at===void 0,mr=Et||$e||Ht;if(!Kt&&mr){var Fr=g.MISSING_INJECT_ANNOTATION+" argument "+Tt+" in class "+_t+".";throw new Error(Fr)}var Yr=new de.Target(Re.TargetTypeEnum.ConstructorArgument,Y.targetName,at);return Yr.metadata=$t,Yr}return null}function mt(Tt,Kt,_t,ct,it){for(var $t=[],Y=0;Y<it;Y++){var Xt=Y,at=tt(Xt,Tt,Kt,_t,ct);at!==null&&$t.push(at)}return $t}function wt(Tt,Kt){for(var _t=Tt.getPropertiesMetadata(Kt),ct=[],it=Object.keys(_t),$t=0,Y=it;$t<Y.length;$t++){var Xt=Y[$t],at=_t[Xt],qe=or(_t[Xt]),Et=qe.targetName||Xt,$e=qe.inject||qe.multiInject,Ht=new de.Target(Re.TargetTypeEnum.ClassProperty,Et,$e);Ht.metadata=at,ct.push(Ht)}var mr=Object.getPrototypeOf(Kt.prototype).constructor;if(mr!==Object){var Fr=wt(Tt,mr);ct=Ce(Ce([],ct),Fr)}return ct}function Nt(Tt,Kt){var _t=Object.getPrototypeOf(Kt.prototype).constructor;if(_t!==Object){var ct=he.getFunctionName(_t),it=_e(Tt,ct,_t,!0),$t=it.map(function(at){return at.metadata.filter(function(qe){return qe.key===W.UNMANAGED_TAG})}),Y=[].concat.apply([],$t).length,Xt=it.length-Y;return Xt>0?Xt:Nt(Tt,_t)}else return 0}ne.getBaseClassDependencyCount=Nt;function or(Tt){var Kt={};return Tt.forEach(function(_t){Kt[_t.key.toString()]=_t.value}),{inject:Kt[W.INJECT_TAG],multiInject:Kt[W.MULTI_INJECT_TAG],targetName:Kt[W.NAME_TAG],unmanaged:Kt[W.UNMANAGED_TAG]}}},6748:function(Er,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.Request=void 0;var Ce=Q(37791),me=function(){function g(Re,W,he,de,ze){this.id=Ce.id(),this.serviceIdentifier=Re,this.parentContext=W,this.parentRequest=he,this.target=ze,this.childRequests=[],this.bindings=Array.isArray(de)?de:[de],this.requestScope=he===null?new Map:null}return g.prototype.addChildRequest=function(Re,W,he){var de=new g(Re,this.parentContext,this,W,he);return this.childRequests.push(de),de},g}();ne.Request=me},18924:function(Er,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.Target=void 0;var Ce=Q(6867),me=Q(37791),g=Q(47738),Re=Q(88460),W=function(){function he(de,ze,_e,tt){this.id=me.id(),this.type=de,this.serviceIdentifier=_e,this.name=new Re.QueryableString(ze||""),this.metadata=new Array;var mt=null;typeof tt=="string"?mt=new g.Metadata(Ce.NAMED_TAG,tt):tt instanceof g.Metadata&&(mt=tt),mt!==null&&this.metadata.push(mt)}return he.prototype.hasTag=function(de){for(var ze=0,_e=this.metadata;ze<_e.length;ze++){var tt=_e[ze];if(tt.key===de)return!0}return!1},he.prototype.isArray=function(){return this.hasTag(Ce.MULTI_INJECT_TAG)},he.prototype.matchesArray=function(de){return this.matchesTag(Ce.MULTI_INJECT_TAG)(de)},he.prototype.isNamed=function(){return this.hasTag(Ce.NAMED_TAG)},he.prototype.isTagged=function(){return this.metadata.some(function(de){return Ce.NON_CUSTOM_TAG_KEYS.every(function(ze){return de.key!==ze})})},he.prototype.isOptional=function(){return this.matchesTag(Ce.OPTIONAL_TAG)(!0)},he.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(de){return de.key===Ce.NAMED_TAG})[0]:null},he.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(de){return Ce.NON_CUSTOM_TAG_KEYS.every(function(ze){return de.key!==ze})}):null},he.prototype.matchesNamedTag=function(de){return this.matchesTag(Ce.NAMED_TAG)(de)},he.prototype.matchesTag=function(de){var ze=this;return function(_e){for(var tt=0,mt=ze.metadata;tt<mt.length;tt++){var wt=mt[tt];if(wt.key===de&&wt.value===_e)return!0}return!1}},he}();ne.Target=W},52279:function(Er,ne,Q){"use strict";var Ce=this&&this.__spreadArray||function(_e,tt){for(var mt=0,wt=tt.length,Nt=_e.length;mt<wt;mt++,Nt++)_e[Nt]=tt[mt];return _e};Object.defineProperty(ne,"__esModule",{value:!0}),ne.resolveInstance=void 0;var me=Q(16674),g=Q(28421),Re=Q(6867);function W(_e,tt,mt){var wt=tt.filter(function(or){return or.target!==null&&or.target.type===g.TargetTypeEnum.ClassProperty}),Nt=wt.map(mt);return wt.forEach(function(or,Tt){var Kt="";Kt=or.target.name.value();var _t=Nt[Tt];_e[Kt]=_t}),_e}function he(_e,tt){return new(_e.bind.apply(_e,Ce([void 0],tt)))}function de(_e,tt){if(Reflect.hasMetadata(Re.POST_CONSTRUCT,_e)){var mt=Reflect.getMetadata(Re.POST_CONSTRUCT,_e);try{tt[mt.value]()}catch(wt){throw new Error(me.POST_CONSTRUCT_ERROR(_e.name,wt.message))}}}function ze(_e,tt,mt){var wt=null;if(tt.length>0){var Nt=tt.filter(function(Tt){return Tt.target!==null&&Tt.target.type===g.TargetTypeEnum.ConstructorArgument}),or=Nt.map(mt);wt=he(_e,or),wt=W(wt,tt,mt)}else wt=new _e;return de(_e,wt),wt}ne.resolveInstance=ze},31927:function(Er,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.resolve=void 0;var Ce=Q(16674),me=Q(28421),g=Q(85265),Re=Q(55800),W=Q(52279),he=function(_e,tt,mt){try{return mt()}catch(wt){throw g.isStackOverflowExeption(wt)?new Error(Ce.CIRCULAR_DEPENDENCY_IN_FACTORY(_e,tt.toString())):wt}},de=function(_e){return function(tt){tt.parentContext.setCurrentRequest(tt);var mt=tt.bindings,wt=tt.childRequests,Nt=tt.target&&tt.target.isArray(),or=!tt.parentRequest||!tt.parentRequest.target||!tt.target||!tt.parentRequest.target.matchesArray(tt.target.serviceIdentifier);if(Nt&&or)return wt.map(function($t){var Y=de(_e);return Y($t)});var Tt=null;if(tt.target.isOptional()&&mt.length===0)return;var Kt=mt[0],_t=Kt.scope===me.BindingScopeEnum.Singleton,ct=Kt.scope===me.BindingScopeEnum.Request;if(_t&&Kt.activated)return Kt.cache;if(ct&&_e!==null&&_e.has(Kt.id))return _e.get(Kt.id);if(Kt.type===me.BindingTypeEnum.ConstantValue)Tt=Kt.cache,Kt.activated=!0;else if(Kt.type===me.BindingTypeEnum.Function)Tt=Kt.cache,Kt.activated=!0;else if(Kt.type===me.BindingTypeEnum.Constructor)Tt=Kt.implementationType;else if(Kt.type===me.BindingTypeEnum.DynamicValue&&Kt.dynamicValue!==null)Tt=he("toDynamicValue",Kt.serviceIdentifier,function(){return Kt.dynamicValue(tt.parentContext)});else if(Kt.type===me.BindingTypeEnum.Factory&&Kt.factory!==null)Tt=he("toFactory",Kt.serviceIdentifier,function(){return Kt.factory(tt.parentContext)});else if(Kt.type===me.BindingTypeEnum.Provider&&Kt.provider!==null)Tt=he("toProvider",Kt.serviceIdentifier,function(){return Kt.provider(tt.parentContext)});else if(Kt.type===me.BindingTypeEnum.Instance&&Kt.implementationType!==null)Tt=W.resolveInstance(Kt.implementationType,wt,de(_e));else{var it=Re.getServiceIdentifierAsString(tt.serviceIdentifier);throw new Error(Ce.INVALID_BINDING_TYPE+" "+it)}return typeof Kt.onActivation=="function"&&(Tt=Kt.onActivation(tt.parentContext,Tt)),_t&&(Kt.cache=Tt,Kt.activated=!0),ct&&_e!==null&&!_e.has(Kt.id)&&_e.set(Kt.id,Tt),Tt}};function ze(_e){var tt=de(_e.plan.rootRequest.requestScope);return tt(_e.plan.rootRequest)}ne.resolve=ze},83366:function(Er,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.BindingInSyntax=void 0;var Ce=Q(28421),me=Q(71325),g=function(){function Re(W){this._binding=W}return Re.prototype.inRequestScope=function(){return this._binding.scope=Ce.BindingScopeEnum.Request,new me.BindingWhenOnSyntax(this._binding)},Re.prototype.inSingletonScope=function(){return this._binding.scope=Ce.BindingScopeEnum.Singleton,new me.BindingWhenOnSyntax(this._binding)},Re.prototype.inTransientScope=function(){return this._binding.scope=Ce.BindingScopeEnum.Transient,new me.BindingWhenOnSyntax(this._binding)},Re}();ne.BindingInSyntax=g},74889:function(Er,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.BindingInWhenOnSyntax=void 0;var Ce=Q(83366),me=Q(51811),g=Q(98370),Re=function(){function W(he){this._binding=he,this._bindingWhenSyntax=new g.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new me.BindingOnSyntax(this._binding),this._bindingInSyntax=new Ce.BindingInSyntax(he)}return W.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},W.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},W.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},W.prototype.when=function(he){return this._bindingWhenSyntax.when(he)},W.prototype.whenTargetNamed=function(he){return this._bindingWhenSyntax.whenTargetNamed(he)},W.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},W.prototype.whenTargetTagged=function(he,de){return this._bindingWhenSyntax.whenTargetTagged(he,de)},W.prototype.whenInjectedInto=function(he){return this._bindingWhenSyntax.whenInjectedInto(he)},W.prototype.whenParentNamed=function(he){return this._bindingWhenSyntax.whenParentNamed(he)},W.prototype.whenParentTagged=function(he,de){return this._bindingWhenSyntax.whenParentTagged(he,de)},W.prototype.whenAnyAncestorIs=function(he){return this._bindingWhenSyntax.whenAnyAncestorIs(he)},W.prototype.whenNoAncestorIs=function(he){return this._bindingWhenSyntax.whenNoAncestorIs(he)},W.prototype.whenAnyAncestorNamed=function(he){return this._bindingWhenSyntax.whenAnyAncestorNamed(he)},W.prototype.whenAnyAncestorTagged=function(he,de){return this._bindingWhenSyntax.whenAnyAncestorTagged(he,de)},W.prototype.whenNoAncestorNamed=function(he){return this._bindingWhenSyntax.whenNoAncestorNamed(he)},W.prototype.whenNoAncestorTagged=function(he,de){return this._bindingWhenSyntax.whenNoAncestorTagged(he,de)},W.prototype.whenAnyAncestorMatches=function(he){return this._bindingWhenSyntax.whenAnyAncestorMatches(he)},W.prototype.whenNoAncestorMatches=function(he){return this._bindingWhenSyntax.whenNoAncestorMatches(he)},W.prototype.onActivation=function(he){return this._bindingOnSyntax.onActivation(he)},W}();ne.BindingInWhenOnSyntax=Re},51811:function(Er,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.BindingOnSyntax=void 0;var Ce=Q(98370),me=function(){function g(Re){this._binding=Re}return g.prototype.onActivation=function(Re){return this._binding.onActivation=Re,new Ce.BindingWhenSyntax(this._binding)},g}();ne.BindingOnSyntax=me},15451:function(Er,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.BindingToSyntax=void 0;var Ce=Q(16674),me=Q(28421),g=Q(74889),Re=Q(71325),W=function(){function he(de){this._binding=de}return he.prototype.to=function(de){return this._binding.type=me.BindingTypeEnum.Instance,this._binding.implementationType=de,new g.BindingInWhenOnSyntax(this._binding)},he.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+Ce.INVALID_TO_SELF_VALUE);var de=this._binding.serviceIdentifier;return this.to(de)},he.prototype.toConstantValue=function(de){return this._binding.type=me.BindingTypeEnum.ConstantValue,this._binding.cache=de,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=me.BindingScopeEnum.Singleton,new Re.BindingWhenOnSyntax(this._binding)},he.prototype.toDynamicValue=function(de){return this._binding.type=me.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=de,this._binding.implementationType=null,new g.BindingInWhenOnSyntax(this._binding)},he.prototype.toConstructor=function(de){return this._binding.type=me.BindingTypeEnum.Constructor,this._binding.implementationType=de,this._binding.scope=me.BindingScopeEnum.Singleton,new Re.BindingWhenOnSyntax(this._binding)},he.prototype.toFactory=function(de){return this._binding.type=me.BindingTypeEnum.Factory,this._binding.factory=de,this._binding.scope=me.BindingScopeEnum.Singleton,new Re.BindingWhenOnSyntax(this._binding)},he.prototype.toFunction=function(de){if(typeof de!="function")throw new Error(Ce.INVALID_FUNCTION_BINDING);var ze=this.toConstantValue(de);return this._binding.type=me.BindingTypeEnum.Function,this._binding.scope=me.BindingScopeEnum.Singleton,ze},he.prototype.toAutoFactory=function(de){return this._binding.type=me.BindingTypeEnum.Factory,this._binding.factory=function(ze){var _e=function(){return ze.container.get(de)};return _e},this._binding.scope=me.BindingScopeEnum.Singleton,new Re.BindingWhenOnSyntax(this._binding)},he.prototype.toProvider=function(de){return this._binding.type=me.BindingTypeEnum.Provider,this._binding.provider=de,this._binding.scope=me.BindingScopeEnum.Singleton,new Re.BindingWhenOnSyntax(this._binding)},he.prototype.toService=function(de){this.toDynamicValue(function(ze){return ze.container.get(de)})},he}();ne.BindingToSyntax=W},71325:function(Er,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.BindingWhenOnSyntax=void 0;var Ce=Q(51811),me=Q(98370),g=function(){function Re(W){this._binding=W,this._bindingWhenSyntax=new me.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new Ce.BindingOnSyntax(this._binding)}return Re.prototype.when=function(W){return this._bindingWhenSyntax.when(W)},Re.prototype.whenTargetNamed=function(W){return this._bindingWhenSyntax.whenTargetNamed(W)},Re.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},Re.prototype.whenTargetTagged=function(W,he){return this._bindingWhenSyntax.whenTargetTagged(W,he)},Re.prototype.whenInjectedInto=function(W){return this._bindingWhenSyntax.whenInjectedInto(W)},Re.prototype.whenParentNamed=function(W){return this._bindingWhenSyntax.whenParentNamed(W)},Re.prototype.whenParentTagged=function(W,he){return this._bindingWhenSyntax.whenParentTagged(W,he)},Re.prototype.whenAnyAncestorIs=function(W){return this._bindingWhenSyntax.whenAnyAncestorIs(W)},Re.prototype.whenNoAncestorIs=function(W){return this._bindingWhenSyntax.whenNoAncestorIs(W)},Re.prototype.whenAnyAncestorNamed=function(W){return this._bindingWhenSyntax.whenAnyAncestorNamed(W)},Re.prototype.whenAnyAncestorTagged=function(W,he){return this._bindingWhenSyntax.whenAnyAncestorTagged(W,he)},Re.prototype.whenNoAncestorNamed=function(W){return this._bindingWhenSyntax.whenNoAncestorNamed(W)},Re.prototype.whenNoAncestorTagged=function(W,he){return this._bindingWhenSyntax.whenNoAncestorTagged(W,he)},Re.prototype.whenAnyAncestorMatches=function(W){return this._bindingWhenSyntax.whenAnyAncestorMatches(W)},Re.prototype.whenNoAncestorMatches=function(W){return this._bindingWhenSyntax.whenNoAncestorMatches(W)},Re.prototype.onActivation=function(W){return this._bindingOnSyntax.onActivation(W)},Re}();ne.BindingWhenOnSyntax=g},98370:function(Er,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.BindingWhenSyntax=void 0;var Ce=Q(51811),me=Q(80758),g=function(){function Re(W){this._binding=W}return Re.prototype.when=function(W){return this._binding.constraint=W,new Ce.BindingOnSyntax(this._binding)},Re.prototype.whenTargetNamed=function(W){return this._binding.constraint=me.namedConstraint(W),new Ce.BindingOnSyntax(this._binding)},Re.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(W){var he=W.target!==null&&!W.target.isNamed()&&!W.target.isTagged();return he},new Ce.BindingOnSyntax(this._binding)},Re.prototype.whenTargetTagged=function(W,he){return this._binding.constraint=me.taggedConstraint(W)(he),new Ce.BindingOnSyntax(this._binding)},Re.prototype.whenInjectedInto=function(W){return this._binding.constraint=function(he){return me.typeConstraint(W)(he.parentRequest)},new Ce.BindingOnSyntax(this._binding)},Re.prototype.whenParentNamed=function(W){return this._binding.constraint=function(he){return me.namedConstraint(W)(he.parentRequest)},new Ce.BindingOnSyntax(this._binding)},Re.prototype.whenParentTagged=function(W,he){return this._binding.constraint=function(de){return me.taggedConstraint(W)(he)(de.parentRequest)},new Ce.BindingOnSyntax(this._binding)},Re.prototype.whenAnyAncestorIs=function(W){return this._binding.constraint=function(he){return me.traverseAncerstors(he,me.typeConstraint(W))},new Ce.BindingOnSyntax(this._binding)},Re.prototype.whenNoAncestorIs=function(W){return this._binding.constraint=function(he){return!me.traverseAncerstors(he,me.typeConstraint(W))},new Ce.BindingOnSyntax(this._binding)},Re.prototype.whenAnyAncestorNamed=function(W){return this._binding.constraint=function(he){return me.traverseAncerstors(he,me.namedConstraint(W))},new Ce.BindingOnSyntax(this._binding)},Re.prototype.whenNoAncestorNamed=function(W){return this._binding.constraint=function(he){return!me.traverseAncerstors(he,me.namedConstraint(W))},new Ce.BindingOnSyntax(this._binding)},Re.prototype.whenAnyAncestorTagged=function(W,he){return this._binding.constraint=function(de){return me.traverseAncerstors(de,me.taggedConstraint(W)(he))},new Ce.BindingOnSyntax(this._binding)},Re.prototype.whenNoAncestorTagged=function(W,he){return this._binding.constraint=function(de){return!me.traverseAncerstors(de,me.taggedConstraint(W)(he))},new Ce.BindingOnSyntax(this._binding)},Re.prototype.whenAnyAncestorMatches=function(W){return this._binding.constraint=function(he){return me.traverseAncerstors(he,W)},new Ce.BindingOnSyntax(this._binding)},Re.prototype.whenNoAncestorMatches=function(W){return this._binding.constraint=function(he){return!me.traverseAncerstors(he,W)},new Ce.BindingOnSyntax(this._binding)},Re}();ne.BindingWhenSyntax=g},80758:function(Er,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.typeConstraint=ne.namedConstraint=ne.taggedConstraint=ne.traverseAncerstors=void 0;var Ce=Q(6867),me=Q(47738),g=function(de,ze){var _e=de.parentRequest;return _e!==null?ze(_e)?!0:g(_e,ze):!1};ne.traverseAncerstors=g;var Re=function(de){return function(ze){var _e=function(tt){return tt!==null&&tt.target!==null&&tt.target.matchesTag(de)(ze)};return _e.metaData=new me.Metadata(de,ze),_e}};ne.taggedConstraint=Re;var W=Re(Ce.NAMED_TAG);ne.namedConstraint=W;var he=function(de){return function(ze){var _e=null;if(ze!==null)if(_e=ze.bindings[0],typeof de=="string"){var tt=_e.serviceIdentifier;return tt===de}else{var mt=ze.bindings[0].implementationType;return de===mt}return!1}};ne.typeConstraint=he},70600:function(Er,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.multiBindToService=void 0;var Q=function(Ce){return function(me){return function(){for(var g=[],Re=0;Re<arguments.length;Re++)g[Re]=arguments[Re];return g.forEach(function(W){return Ce.bind(W).toService(me)})}}};ne.multiBindToService=Q},85265:function(Er,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.isStackOverflowExeption=void 0;var Ce=Q(16674);function me(g){return g instanceof RangeError||g.message===Ce.STACK_OVERFLOW}ne.isStackOverflowExeption=me},37791:function(Er,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.id=void 0;var Q=0;function Ce(){return Q++}ne.id=Ce},55800:function(Er,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.circularDependencyToException=ne.listMetadataForTarget=ne.listRegisteredBindingsForServiceIdentifier=ne.getServiceIdentifierAsString=ne.getFunctionName=void 0;var Ce=Q(16674);function me(_e){if(typeof _e=="function"){var tt=_e;return tt.name}else{if(typeof _e=="symbol")return _e.toString();var tt=_e;return tt}}ne.getServiceIdentifierAsString=me;function g(_e,tt,mt){var wt="",Nt=mt(_e,tt);return Nt.length!==0&&(wt=`
Registered bindings:`,Nt.forEach(function(or){var Tt="Object";or.implementationType!==null&&(Tt=ze(or.implementationType)),wt=wt+`
 `+Tt,or.constraint.metaData&&(wt=wt+" - "+or.constraint.metaData)})),wt}ne.listRegisteredBindingsForServiceIdentifier=g;function Re(_e,tt){return _e.parentRequest===null?!1:_e.parentRequest.serviceIdentifier===tt?!0:Re(_e.parentRequest,tt)}function W(_e){function tt(wt,Nt){Nt===void 0&&(Nt=[]);var or=me(wt.serviceIdentifier);return Nt.push(or),wt.parentRequest!==null?tt(wt.parentRequest,Nt):Nt}var mt=tt(_e);return mt.reverse().join(" --> ")}function he(_e){_e.childRequests.forEach(function(tt){if(Re(tt,tt.serviceIdentifier)){var mt=W(tt);throw new Error(Ce.CIRCULAR_DEPENDENCY+" "+mt)}else he(tt)})}ne.circularDependencyToException=he;function de(_e,tt){if(tt.isTagged()||tt.isNamed()){var mt="",wt=tt.getNamedTag(),Nt=tt.getCustomTags();return wt!==null&&(mt+=wt.toString()+`
`),Nt!==null&&Nt.forEach(function(or){mt+=or.toString()+`
`})," "+_e+`
 `+_e+" - "+mt}else return" "+_e}ne.listMetadataForTarget=de;function ze(_e){if(_e.name)return _e.name;var tt=_e.toString(),mt=tt.match(/^function\s*([^\s(]+)/);return mt?mt[1]:"Anonymous function: "+tt}ne.getFunctionName=ze},31745:function(Er){"use strict";Er.exports=Q,Er.exports.default=Q;var ne=1e20;function Q(W,he,de,ze,_e,tt){this.fontSize=W||24,this.buffer=he===void 0?3:he,this.cutoff=ze||.25,this.fontFamily=_e||"sans-serif",this.fontWeight=tt||"normal",this.radius=de||8;var mt=this.size=this.fontSize+this.buffer*2,wt=mt+this.buffer*2,Nt=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;Nt?this.canvas=my.createOffscreenCanvas(mt,mt,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=mt),this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(wt*wt),this.gridInner=new Float64Array(wt*wt),this.f=new Float64Array(wt),this.z=new Float64Array(wt+1),this.v=new Uint16Array(wt),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,Nt?this.middle=Math.round(mt/2*1):this.middle=Math.round(mt/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Ce(W,he,de,ze,_e,tt,mt){tt.fill(ne,0,he*de),mt.fill(0,0,he*de);for(var wt=(he-ze)/2,Nt=0;Nt<_e;Nt++)for(var or=0;or<ze;or++){var Tt=(Nt+wt)*he+or+wt,Kt=W.data[4*(Nt*ze+or)+3]/255;if(Kt===1)tt[Tt]=0,mt[Tt]=ne;else if(Kt===0)tt[Tt]=ne,mt[Tt]=0;else{var _t=Math.max(0,.5-Kt),ct=Math.max(0,Kt-.5);tt[Tt]=_t*_t,mt[Tt]=ct*ct}}}function me(W,he,de,ze,_e,tt,mt){for(var wt=0;wt<he*de;wt++){var Nt=Math.sqrt(ze[wt])-Math.sqrt(_e[wt]);W[wt]=Math.round(255-255*(Nt/tt+mt))}}Q.prototype._draw=function(W,he){var de=this.ctx.measureText(W),ze=de.width,_e=2*this.buffer,tt,mt,wt,Nt,or,Tt,Kt,_t;he&&this.useMetrics?(or=Math.floor(de.actualBoundingBoxAscent),_t=this.buffer+Math.ceil(de.actualBoundingBoxAscent),Tt=this.buffer,Kt=this.buffer,mt=Math.min(this.size,Math.ceil(de.actualBoundingBoxRight-de.actualBoundingBoxLeft)),Nt=Math.min(this.size-Tt,Math.ceil(de.actualBoundingBoxAscent+de.actualBoundingBoxDescent)),tt=mt+_e,wt=Nt+_e,this.ctx.textBaseline="alphabetic"):(tt=mt=this.size,wt=Nt=this.size,or=19*this.fontSize/24,Tt=Kt=0,_t=this.middle,this.ctx.textBaseline="middle");var ct;mt&&Nt&&(this.ctx.clearRect(Kt,Tt,mt,Nt),this.ctx.fillText(W,this.buffer,_t),ct=this.ctx.getImageData(Kt,Tt,mt,Nt));var it=new Uint8ClampedArray(tt*wt);return Ce(ct,tt,wt,mt,Nt,this.gridOuter,this.gridInner),g(this.gridOuter,tt,wt,this.f,this.v,this.z),g(this.gridInner,tt,wt,this.f,this.v,this.z),me(it,tt,wt,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:it,metrics:{width:mt,height:Nt,sdfWidth:tt,sdfHeight:wt,top:or,left:0,advance:ze}}},Q.prototype.draw=function(W){return this._draw(W,!1).data},Q.prototype.drawWithMetrics=function(W){return this._draw(W,!0)};function g(W,he,de,ze,_e,tt){for(var mt=0;mt<he;mt++)Re(W,mt,he,de,ze,_e,tt);for(var wt=0;wt<de;wt++)Re(W,wt*he,1,he,ze,_e,tt)}function Re(W,he,de,ze,_e,tt,mt){var wt,Nt,or,Tt;for(tt[0]=0,mt[0]=-ne,mt[1]=ne,wt=0;wt<ze;wt++)_e[wt]=W[he+wt*de];for(wt=1,Nt=0,or=0;wt<ze;wt++){do Tt=tt[Nt],or=(_e[wt]-_e[Tt]+wt*wt-Tt*Tt)/(wt-Tt)/2;while(or<=mt[Nt]&&--Nt>-1);Nt++,tt[Nt]=wt,mt[Nt]=or,mt[Nt+1]=ne}for(wt=0,Nt=0;wt<ze;wt++){for(;mt[Nt+1]<wt;)Nt++;Tt=tt[Nt],W[he+wt*de]=_e[Tt]+(wt-Tt)*(wt-Tt)}}},18857:function(Er,ne,Q){"use strict";Q.r(ne),Q.d(ne,{Function:function(){return Ks},Interpreter:function(){return xa},default:function(){return ul},evaluate:function(){return Yu},vm:function(){return Ce}});var Ce={};Q.r(Ce),Q.d(Ce,{Script:function(){return ac},compileFunction:function(){return mf},createContext:function(){return is},runInContext:function(){return Il},runInNewContext:function(){return qs}});var me={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},g="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",Re={5:g,"5module":g+" export import",6:g+" const class extends export import super"},W=/^in(stanceof)?$/,he="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",de="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",ze=new RegExp("["+he+"]"),_e=new RegExp("["+he+de+"]");he=de=null;var tt=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],mt=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function wt(_,M){for(var B=65536,R=0;R<M.length;R+=2){if(B+=M[R],B>_)return!1;if(B+=M[R+1],B>=_)return!0}}function Nt(_,M){return _<65?_===36:_<91?!0:_<97?_===95:_<123?!0:_<=65535?_>=170&&ze.test(String.fromCharCode(_)):M===!1?!1:wt(_,tt)}function or(_,M){return _<48?_===36:_<58?!0:_<65?!1:_<91?!0:_<97?_===95:_<123?!0:_<=65535?_>=170&&_e.test(String.fromCharCode(_)):M===!1?!1:wt(_,tt)||wt(_,mt)}var Tt=function(M,B){B===void 0&&(B={}),this.label=M,this.keyword=B.keyword,this.beforeExpr=!!B.beforeExpr,this.startsExpr=!!B.startsExpr,this.isLoop=!!B.isLoop,this.isAssign=!!B.isAssign,this.prefix=!!B.prefix,this.postfix=!!B.postfix,this.binop=B.binop||null,this.updateContext=null};function Kt(_,M){return new Tt(_,{beforeExpr:!0,binop:M})}var _t={beforeExpr:!0},ct={startsExpr:!0},it={};function $t(_,M){return M===void 0&&(M={}),M.keyword=_,it[_]=new Tt(_,M)}var Y={num:new Tt("num",ct),regexp:new Tt("regexp",ct),string:new Tt("string",ct),name:new Tt("name",ct),eof:new Tt("eof"),bracketL:new Tt("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new Tt("]"),braceL:new Tt("{",{beforeExpr:!0,startsExpr:!0}),braceR:new Tt("}"),parenL:new Tt("(",{beforeExpr:!0,startsExpr:!0}),parenR:new Tt(")"),comma:new Tt(",",_t),semi:new Tt(";",_t),colon:new Tt(":",_t),dot:new Tt("."),question:new Tt("?",_t),questionDot:new Tt("?."),arrow:new Tt("=>",_t),template:new Tt("template"),invalidTemplate:new Tt("invalidTemplate"),ellipsis:new Tt("...",_t),backQuote:new Tt("`",ct),dollarBraceL:new Tt("${",{beforeExpr:!0,startsExpr:!0}),eq:new Tt("=",{beforeExpr:!0,isAssign:!0}),assign:new Tt("_=",{beforeExpr:!0,isAssign:!0}),incDec:new Tt("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new Tt("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:Kt("||",1),logicalAND:Kt("&&",2),bitwiseOR:Kt("|",3),bitwiseXOR:Kt("^",4),bitwiseAND:Kt("&",5),equality:Kt("==/!=/===/!==",6),relational:Kt("</>/<=/>=",7),bitShift:Kt("<</>>/>>>",8),plusMin:new Tt("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:Kt("%",10),star:Kt("*",10),slash:Kt("/",10),starstar:new Tt("**",{beforeExpr:!0}),coalesce:Kt("??",1),_break:$t("break"),_case:$t("case",_t),_catch:$t("catch"),_continue:$t("continue"),_debugger:$t("debugger"),_default:$t("default",_t),_do:$t("do",{isLoop:!0,beforeExpr:!0}),_else:$t("else",_t),_finally:$t("finally"),_for:$t("for",{isLoop:!0}),_function:$t("function",ct),_if:$t("if"),_return:$t("return",_t),_switch:$t("switch"),_throw:$t("throw",_t),_try:$t("try"),_var:$t("var"),_const:$t("const"),_while:$t("while",{isLoop:!0}),_with:$t("with"),_new:$t("new",{beforeExpr:!0,startsExpr:!0}),_this:$t("this",ct),_super:$t("super",ct),_class:$t("class",ct),_extends:$t("extends",_t),_export:$t("export"),_import:$t("import",ct),_null:$t("null",ct),_true:$t("true",ct),_false:$t("false",ct),_in:$t("in",{beforeExpr:!0,binop:7}),_instanceof:$t("instanceof",{beforeExpr:!0,binop:7}),_typeof:$t("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:$t("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:$t("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},Xt=/\r\n?|\n|\u2028|\u2029/,at=new RegExp(Xt.source,"g");function qe(_,M){return _===10||_===13||!M&&(_===8232||_===8233)}var Et=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,$e=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,Ht=Object.prototype,mr=Ht.hasOwnProperty,Fr=Ht.toString;function Yr(_,M){return mr.call(_,M)}var S=Array.isArray||function(_){return Fr.call(_)==="[object Array]"};function Se(_){return new RegExp("^(?:"+_.replace(/ /g,"|")+")$")}var ke=function(M,B){this.line=M,this.column=B};ke.prototype.offset=function(M){return new ke(this.line,this.column+M)};var ut=function(M,B,R){this.start=B,this.end=R,M.sourceFile!==null&&(this.source=M.sourceFile)};function ft(_,M){for(var B=1,R=0;;){at.lastIndex=R;var K=at.exec(_);if(K&&K.index<M)++B,R=K.index+K[0].length;else return new ke(B,M-R)}}var kt={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function Ft(_){var M={};for(var B in kt)M[B]=_&&Yr(_,B)?_[B]:kt[B];if(M.ecmaVersion>=2015&&(M.ecmaVersion-=2009),M.allowReserved==null&&(M.allowReserved=M.ecmaVersion<5),S(M.onToken)){var R=M.onToken;M.onToken=function(K){return R.push(K)}}return S(M.onComment)&&(M.onComment=yr(M,M.onComment)),M}function yr(_,M){return function(B,R,K,ge,He,lt){var pt={type:B?"Block":"Line",value:R,start:K,end:ge};_.locations&&(pt.loc=new ut(this,He,lt)),_.ranges&&(pt.range=[K,ge]),M.push(pt)}}var Yn=1,Gr=2,Nn=Yn|Gr,yn=4,zn=8,si=16,Gn=32,fi=64,na=128;function Ui(_,M){return Gr|(_?yn:0)|(M?zn:0)}var Ii=0,$i=1,ia=2,qa=3,aa=4,oa=5,Li=function(M,B,R){this.options=M=Ft(M),this.sourceFile=M.sourceFile,this.keywords=Se(Re[M.ecmaVersion>=6?6:M.sourceType==="module"?"5module":5]);var K="";if(M.allowReserved!==!0){for(var ge=M.ecmaVersion;!(K=me[ge]);ge--);M.sourceType==="module"&&(K+=" await")}this.reservedWords=Se(K);var He=(K?K+" ":"")+me.strict;this.reservedWordsStrict=Se(He),this.reservedWordsStrictBind=Se(He+" "+me.strictBind),this.input=String(B),this.containsEsc=!1,R?(this.pos=R,this.lineStart=this.input.lastIndexOf(`
`,R-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(Xt).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=Y.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=M.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&M.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(Yn),this.regexpState=null},Ki={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};Li.prototype.parse=function(){var M=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(M)},Ki.inFunction.get=function(){return(this.currentVarScope().flags&Gr)>0},Ki.inGenerator.get=function(){return(this.currentVarScope().flags&zn)>0},Ki.inAsync.get=function(){return(this.currentVarScope().flags&yn)>0},Ki.allowSuper.get=function(){return(this.currentThisScope().flags&fi)>0},Ki.allowDirectSuper.get=function(){return(this.currentThisScope().flags&na)>0},Ki.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},Li.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&Gr)>0},Li.extend=function(){for(var M=[],B=arguments.length;B--;)M[B]=arguments[B];for(var R=this,K=0;K<M.length;K++)R=M[K](R);return R},Li.parse=function(M,B){return new this(B,M).parse()},Li.parseExpressionAt=function(M,B,R){var K=new this(R,M,B);return K.nextToken(),K.parseExpression()},Li.tokenizer=function(M,B){return new this(B,M)},Object.defineProperties(Li.prototype,Ki);var Hi=Li.prototype,Ts=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;Hi.strictDirective=function(_){for(;;){$e.lastIndex=_,_+=$e.exec(this.input)[0].length;var M=Ts.exec(this.input.slice(_));if(!M)return!1;if((M[1]||M[2])==="use strict"){$e.lastIndex=_+M[0].length;var B=$e.exec(this.input),R=B.index+B[0].length,K=this.input.charAt(R);return K===";"||K==="}"||Xt.test(B[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(K)||K==="!"&&this.input.charAt(R+1)==="=")}_+=M[0].length,$e.lastIndex=_,_+=$e.exec(this.input)[0].length,this.input[_]===";"&&_++}},Hi.eat=function(_){return this.type===_?(this.next(),!0):!1},Hi.isContextual=function(_){return this.type===Y.name&&this.value===_&&!this.containsEsc},Hi.eatContextual=function(_){return this.isContextual(_)?(this.next(),!0):!1},Hi.expectContextual=function(_){this.eatContextual(_)||this.unexpected()},Hi.canInsertSemicolon=function(){return this.type===Y.eof||this.type===Y.braceR||Xt.test(this.input.slice(this.lastTokEnd,this.start))},Hi.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},Hi.semicolon=function(){!this.eat(Y.semi)&&!this.insertSemicolon()&&this.unexpected()},Hi.afterTrailingComma=function(_,M){if(this.type===_)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),M||this.next(),!0},Hi.expect=function(_){this.eat(_)||this.unexpected()},Hi.unexpected=function(_){this.raise(_!=null?_:this.start,"Unexpected token")};function fe(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}Hi.checkPatternErrors=function(_,M){if(!!_){_.trailingComma>-1&&this.raiseRecoverable(_.trailingComma,"Comma is not permitted after the rest element");var B=M?_.parenthesizedAssign:_.parenthesizedBind;B>-1&&this.raiseRecoverable(B,"Parenthesized pattern")}},Hi.checkExpressionErrors=function(_,M){if(!_)return!1;var B=_.shorthandAssign,R=_.doubleProto;if(!M)return B>=0||R>=0;B>=0&&this.raise(B,"Shorthand property assignments are valid only in destructuring patterns"),R>=0&&this.raiseRecoverable(R,"Redefinition of __proto__ property")},Hi.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},Hi.isSimpleAssignTarget=function(_){return _.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(_.expression):_.type==="Identifier"||_.type==="MemberExpression"};var ui=Li.prototype;ui.parseTopLevel=function(_){var M={};for(_.body||(_.body=[]);this.type!==Y.eof;){var B=this.parseStatement(null,!0,M);_.body.push(B)}if(this.inModule)for(var R=0,K=Object.keys(this.undefinedExports);R<K.length;R+=1){var ge=K[R];this.raiseRecoverable(this.undefinedExports[ge].start,"Export '"+ge+"' is not defined")}return this.adaptDirectivePrologue(_.body),this.next(),_.sourceType=this.options.sourceType,this.finishNode(_,"Program")};var bo={kind:"loop"},cu={kind:"switch"};ui.isLet=function(_){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;$e.lastIndex=this.pos;var M=$e.exec(this.input),B=this.pos+M[0].length,R=this.input.charCodeAt(B);if(R===91)return!0;if(_)return!1;if(R===123)return!0;if(Nt(R,!0)){for(var K=B+1;or(this.input.charCodeAt(K),!0);)++K;var ge=this.input.slice(B,K);if(!W.test(ge))return!0}return!1},ui.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;$e.lastIndex=this.pos;var _=$e.exec(this.input),M=this.pos+_[0].length;return!Xt.test(this.input.slice(this.pos,M))&&this.input.slice(M,M+8)==="function"&&(M+8===this.input.length||!or(this.input.charAt(M+8)))},ui.parseStatement=function(_,M,B){var R=this.type,K=this.startNode(),ge;switch(this.isLet(_)&&(R=Y._var,ge="let"),R){case Y._break:case Y._continue:return this.parseBreakContinueStatement(K,R.keyword);case Y._debugger:return this.parseDebuggerStatement(K);case Y._do:return this.parseDoStatement(K);case Y._for:return this.parseForStatement(K);case Y._function:return _&&(this.strict||_!=="if"&&_!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(K,!1,!_);case Y._class:return _&&this.unexpected(),this.parseClass(K,!0);case Y._if:return this.parseIfStatement(K);case Y._return:return this.parseReturnStatement(K);case Y._switch:return this.parseSwitchStatement(K);case Y._throw:return this.parseThrowStatement(K);case Y._try:return this.parseTryStatement(K);case Y._const:case Y._var:return ge=ge||this.value,_&&ge!=="var"&&this.unexpected(),this.parseVarStatement(K,ge);case Y._while:return this.parseWhileStatement(K);case Y._with:return this.parseWithStatement(K);case Y.braceL:return this.parseBlock(!0,K);case Y.semi:return this.parseEmptyStatement(K);case Y._export:case Y._import:if(this.options.ecmaVersion>10&&R===Y._import){$e.lastIndex=this.pos;var He=$e.exec(this.input),lt=this.pos+He[0].length,pt=this.input.charCodeAt(lt);if(pt===40||pt===46)return this.parseExpressionStatement(K,this.parseExpression())}return this.options.allowImportExportEverywhere||(M||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),R===Y._import?this.parseImport(K):this.parseExport(K,B);default:if(this.isAsyncFunction())return _&&this.unexpected(),this.next(),this.parseFunctionStatement(K,!0,!_);var nr=this.value,sr=this.parseExpression();return R===Y.name&&sr.type==="Identifier"&&this.eat(Y.colon)?this.parseLabeledStatement(K,nr,sr,_):this.parseExpressionStatement(K,sr)}},ui.parseBreakContinueStatement=function(_,M){var B=M==="break";this.next(),this.eat(Y.semi)||this.insertSemicolon()?_.label=null:this.type!==Y.name?this.unexpected():(_.label=this.parseIdent(),this.semicolon());for(var R=0;R<this.labels.length;++R){var K=this.labels[R];if((_.label==null||K.name===_.label.name)&&(K.kind!=null&&(B||K.kind==="loop")||_.label&&B))break}return R===this.labels.length&&this.raise(_.start,"Unsyntactic "+M),this.finishNode(_,B?"BreakStatement":"ContinueStatement")},ui.parseDebuggerStatement=function(_){return this.next(),this.semicolon(),this.finishNode(_,"DebuggerStatement")},ui.parseDoStatement=function(_){return this.next(),this.labels.push(bo),_.body=this.parseStatement("do"),this.labels.pop(),this.expect(Y._while),_.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(Y.semi):this.semicolon(),this.finishNode(_,"DoWhileStatement")},ui.parseForStatement=function(_){this.next();var M=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(bo),this.enterScope(0),this.expect(Y.parenL),this.type===Y.semi)return M>-1&&this.unexpected(M),this.parseFor(_,null);var B=this.isLet();if(this.type===Y._var||this.type===Y._const||B){var R=this.startNode(),K=B?"let":this.value;return this.next(),this.parseVar(R,!0,K),this.finishNode(R,"VariableDeclaration"),(this.type===Y._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&R.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===Y._in?M>-1&&this.unexpected(M):_.await=M>-1),this.parseForIn(_,R)):(M>-1&&this.unexpected(M),this.parseFor(_,R))}var ge=new fe,He=this.parseExpression(!0,ge);return this.type===Y._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===Y._in?M>-1&&this.unexpected(M):_.await=M>-1),this.toAssignable(He,!1,ge),this.checkLVal(He),this.parseForIn(_,He)):(this.checkExpressionErrors(ge,!0),M>-1&&this.unexpected(M),this.parseFor(_,He))},ui.parseFunctionStatement=function(_,M,B){return this.next(),this.parseFunction(_,er|(B?0:Rr),!1,M)},ui.parseIfStatement=function(_){return this.next(),_.test=this.parseParenExpression(),_.consequent=this.parseStatement("if"),_.alternate=this.eat(Y._else)?this.parseStatement("if"):null,this.finishNode(_,"IfStatement")},ui.parseReturnStatement=function(_){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(Y.semi)||this.insertSemicolon()?_.argument=null:(_.argument=this.parseExpression(),this.semicolon()),this.finishNode(_,"ReturnStatement")},ui.parseSwitchStatement=function(_){this.next(),_.discriminant=this.parseParenExpression(),_.cases=[],this.expect(Y.braceL),this.labels.push(cu),this.enterScope(0);for(var M,B=!1;this.type!==Y.braceR;)if(this.type===Y._case||this.type===Y._default){var R=this.type===Y._case;M&&this.finishNode(M,"SwitchCase"),_.cases.push(M=this.startNode()),M.consequent=[],this.next(),R?M.test=this.parseExpression():(B&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),B=!0,M.test=null),this.expect(Y.colon)}else M||this.unexpected(),M.consequent.push(this.parseStatement(null));return this.exitScope(),M&&this.finishNode(M,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(_,"SwitchStatement")},ui.parseThrowStatement=function(_){return this.next(),Xt.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),_.argument=this.parseExpression(),this.semicolon(),this.finishNode(_,"ThrowStatement")};var Zt=[];ui.parseTryStatement=function(_){if(this.next(),_.block=this.parseBlock(),_.handler=null,this.type===Y._catch){var M=this.startNode();if(this.next(),this.eat(Y.parenL)){M.param=this.parseBindingAtom();var B=M.param.type==="Identifier";this.enterScope(B?Gn:0),this.checkLVal(M.param,B?aa:ia),this.expect(Y.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),M.param=null,this.enterScope(0);M.body=this.parseBlock(!1),this.exitScope(),_.handler=this.finishNode(M,"CatchClause")}return _.finalizer=this.eat(Y._finally)?this.parseBlock():null,!_.handler&&!_.finalizer&&this.raise(_.start,"Missing catch or finally clause"),this.finishNode(_,"TryStatement")},ui.parseVarStatement=function(_,M){return this.next(),this.parseVar(_,!1,M),this.semicolon(),this.finishNode(_,"VariableDeclaration")},ui.parseWhileStatement=function(_){return this.next(),_.test=this.parseParenExpression(),this.labels.push(bo),_.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(_,"WhileStatement")},ui.parseWithStatement=function(_){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),_.object=this.parseParenExpression(),_.body=this.parseStatement("with"),this.finishNode(_,"WithStatement")},ui.parseEmptyStatement=function(_){return this.next(),this.finishNode(_,"EmptyStatement")},ui.parseLabeledStatement=function(_,M,B,R){for(var K=0,ge=this.labels;K<ge.length;K+=1){var He=ge[K];He.name===M&&this.raise(B.start,"Label '"+M+"' is already declared")}for(var lt=this.type.isLoop?"loop":this.type===Y._switch?"switch":null,pt=this.labels.length-1;pt>=0;pt--){var nr=this.labels[pt];if(nr.statementStart===_.start)nr.statementStart=this.start,nr.kind=lt;else break}return this.labels.push({name:M,kind:lt,statementStart:this.start}),_.body=this.parseStatement(R?R.indexOf("label")===-1?R+"label":R:"label"),this.labels.pop(),_.label=B,this.finishNode(_,"LabeledStatement")},ui.parseExpressionStatement=function(_,M){return _.expression=M,this.semicolon(),this.finishNode(_,"ExpressionStatement")},ui.parseBlock=function(_,M,B){for(_===void 0&&(_=!0),M===void 0&&(M=this.startNode()),M.body=[],this.expect(Y.braceL),_&&this.enterScope(0);this.type!==Y.braceR;){var R=this.parseStatement(null);M.body.push(R)}return B&&(this.strict=!1),this.next(),_&&this.exitScope(),this.finishNode(M,"BlockStatement")},ui.parseFor=function(_,M){return _.init=M,this.expect(Y.semi),_.test=this.type===Y.semi?null:this.parseExpression(),this.expect(Y.semi),_.update=this.type===Y.parenR?null:this.parseExpression(),this.expect(Y.parenR),_.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(_,"ForStatement")},ui.parseForIn=function(_,M){var B=this.type===Y._in;return this.next(),M.type==="VariableDeclaration"&&M.declarations[0].init!=null&&(!B||this.options.ecmaVersion<8||this.strict||M.kind!=="var"||M.declarations[0].id.type!=="Identifier")?this.raise(M.start,(B?"for-in":"for-of")+" loop variable declaration may not have an initializer"):M.type==="AssignmentPattern"&&this.raise(M.start,"Invalid left-hand side in for-loop"),_.left=M,_.right=B?this.parseExpression():this.parseMaybeAssign(),this.expect(Y.parenR),_.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(_,B?"ForInStatement":"ForOfStatement")},ui.parseVar=function(_,M,B){for(_.declarations=[],_.kind=B;;){var R=this.startNode();if(this.parseVarId(R,B),this.eat(Y.eq)?R.init=this.parseMaybeAssign(M):B==="const"&&!(this.type===Y._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():R.id.type!=="Identifier"&&!(M&&(this.type===Y._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):R.init=null,_.declarations.push(this.finishNode(R,"VariableDeclarator")),!this.eat(Y.comma))break}return _},ui.parseVarId=function(_,M){_.id=this.parseBindingAtom(),this.checkLVal(_.id,M==="var"?$i:ia,!1)};var er=1,Rr=2,an=4;ui.parseFunction=function(_,M,B,R){this.initFunction(_),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!R)&&(this.type===Y.star&&M&Rr&&this.unexpected(),_.generator=this.eat(Y.star)),this.options.ecmaVersion>=8&&(_.async=!!R),M&er&&(_.id=M&an&&this.type!==Y.name?null:this.parseIdent(),_.id&&!(M&Rr)&&this.checkLVal(_.id,this.strict||_.generator||_.async?this.treatFunctionsAsVar?$i:ia:qa));var K=this.yieldPos,ge=this.awaitPos,He=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Ui(_.async,_.generator)),M&er||(_.id=this.type===Y.name?this.parseIdent():null),this.parseFunctionParams(_),this.parseFunctionBody(_,B,!1),this.yieldPos=K,this.awaitPos=ge,this.awaitIdentPos=He,this.finishNode(_,M&er?"FunctionDeclaration":"FunctionExpression")},ui.parseFunctionParams=function(_){this.expect(Y.parenL),_.params=this.parseBindingList(Y.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},ui.parseClass=function(_,M){this.next();var B=this.strict;this.strict=!0,this.parseClassId(_,M),this.parseClassSuper(_);var R=this.startNode(),K=!1;for(R.body=[],this.expect(Y.braceL);this.type!==Y.braceR;){var ge=this.parseClassElement(_.superClass!==null);ge&&(R.body.push(ge),ge.type==="MethodDefinition"&&ge.kind==="constructor"&&(K&&this.raise(ge.start,"Duplicate constructor in the same class"),K=!0))}return this.strict=B,this.next(),_.body=this.finishNode(R,"ClassBody"),this.finishNode(_,M?"ClassDeclaration":"ClassExpression")},ui.parseClassElement=function(_){var M=this;if(this.eat(Y.semi))return null;var B=this.startNode(),R=function(pt,nr){nr===void 0&&(nr=!1);var sr=M.start,Pn=M.startLoc;return M.eatContextual(pt)?M.type!==Y.parenL&&(!nr||!M.canInsertSemicolon())?!0:(B.key&&M.unexpected(),B.computed=!1,B.key=M.startNodeAt(sr,Pn),B.key.name=pt,M.finishNode(B.key,"Identifier"),!1):!1};B.kind="method",B.static=R("static");var K=this.eat(Y.star),ge=!1;K||(this.options.ecmaVersion>=8&&R("async",!0)?(ge=!0,K=this.options.ecmaVersion>=9&&this.eat(Y.star)):R("get")?B.kind="get":R("set")&&(B.kind="set")),B.key||this.parsePropertyName(B);var He=B.key,lt=!1;return!B.computed&&!B.static&&(He.type==="Identifier"&&He.name==="constructor"||He.type==="Literal"&&He.value==="constructor")?(B.kind!=="method"&&this.raise(He.start,"Constructor can't have get/set modifier"),K&&this.raise(He.start,"Constructor can't be a generator"),ge&&this.raise(He.start,"Constructor can't be an async method"),B.kind="constructor",lt=_):B.static&&He.type==="Identifier"&&He.name==="prototype"&&this.raise(He.start,"Classes may not have a static property named prototype"),this.parseClassMethod(B,K,ge,lt),B.kind==="get"&&B.value.params.length!==0&&this.raiseRecoverable(B.value.start,"getter should have no params"),B.kind==="set"&&B.value.params.length!==1&&this.raiseRecoverable(B.value.start,"setter should have exactly one param"),B.kind==="set"&&B.value.params[0].type==="RestElement"&&this.raiseRecoverable(B.value.params[0].start,"Setter cannot use rest params"),B},ui.parseClassMethod=function(_,M,B,R){return _.value=this.parseMethod(M,B,R),this.finishNode(_,"MethodDefinition")},ui.parseClassId=function(_,M){this.type===Y.name?(_.id=this.parseIdent(),M&&this.checkLVal(_.id,ia,!1)):(M===!0&&this.unexpected(),_.id=null)},ui.parseClassSuper=function(_){_.superClass=this.eat(Y._extends)?this.parseExprSubscripts():null},ui.parseExport=function(_,M){if(this.next(),this.eat(Y.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(_.exported=this.parseIdent(!0),this.checkExport(M,_.exported.name,this.lastTokStart)):_.exported=null),this.expectContextual("from"),this.type!==Y.string&&this.unexpected(),_.source=this.parseExprAtom(),this.semicolon(),this.finishNode(_,"ExportAllDeclaration");if(this.eat(Y._default)){this.checkExport(M,"default",this.lastTokStart);var B;if(this.type===Y._function||(B=this.isAsyncFunction())){var R=this.startNode();this.next(),B&&this.next(),_.declaration=this.parseFunction(R,er|an,!1,B)}else if(this.type===Y._class){var K=this.startNode();_.declaration=this.parseClass(K,"nullableID")}else _.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(_,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())_.declaration=this.parseStatement(null),_.declaration.type==="VariableDeclaration"?this.checkVariableExport(M,_.declaration.declarations):this.checkExport(M,_.declaration.id.name,_.declaration.id.start),_.specifiers=[],_.source=null;else{if(_.declaration=null,_.specifiers=this.parseExportSpecifiers(M),this.eatContextual("from"))this.type!==Y.string&&this.unexpected(),_.source=this.parseExprAtom();else{for(var ge=0,He=_.specifiers;ge<He.length;ge+=1){var lt=He[ge];this.checkUnreserved(lt.local),this.checkLocalExport(lt.local)}_.source=null}this.semicolon()}return this.finishNode(_,"ExportNamedDeclaration")},ui.checkExport=function(_,M,B){!_||(Yr(_,M)&&this.raiseRecoverable(B,"Duplicate export '"+M+"'"),_[M]=!0)},ui.checkPatternExport=function(_,M){var B=M.type;if(B==="Identifier")this.checkExport(_,M.name,M.start);else if(B==="ObjectPattern")for(var R=0,K=M.properties;R<K.length;R+=1){var ge=K[R];this.checkPatternExport(_,ge)}else if(B==="ArrayPattern")for(var He=0,lt=M.elements;He<lt.length;He+=1){var pt=lt[He];pt&&this.checkPatternExport(_,pt)}else B==="Property"?this.checkPatternExport(_,M.value):B==="AssignmentPattern"?this.checkPatternExport(_,M.left):B==="RestElement"?this.checkPatternExport(_,M.argument):B==="ParenthesizedExpression"&&this.checkPatternExport(_,M.expression)},ui.checkVariableExport=function(_,M){if(!!_)for(var B=0,R=M;B<R.length;B+=1){var K=R[B];this.checkPatternExport(_,K.id)}},ui.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},ui.parseExportSpecifiers=function(_){var M=[],B=!0;for(this.expect(Y.braceL);!this.eat(Y.braceR);){if(B)B=!1;else if(this.expect(Y.comma),this.afterTrailingComma(Y.braceR))break;var R=this.startNode();R.local=this.parseIdent(!0),R.exported=this.eatContextual("as")?this.parseIdent(!0):R.local,this.checkExport(_,R.exported.name,R.exported.start),M.push(this.finishNode(R,"ExportSpecifier"))}return M},ui.parseImport=function(_){return this.next(),this.type===Y.string?(_.specifiers=Zt,_.source=this.parseExprAtom()):(_.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),_.source=this.type===Y.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(_,"ImportDeclaration")},ui.parseImportSpecifiers=function(){var _=[],M=!0;if(this.type===Y.name){var B=this.startNode();if(B.local=this.parseIdent(),this.checkLVal(B.local,ia),_.push(this.finishNode(B,"ImportDefaultSpecifier")),!this.eat(Y.comma))return _}if(this.type===Y.star){var R=this.startNode();return this.next(),this.expectContextual("as"),R.local=this.parseIdent(),this.checkLVal(R.local,ia),_.push(this.finishNode(R,"ImportNamespaceSpecifier")),_}for(this.expect(Y.braceL);!this.eat(Y.braceR);){if(M)M=!1;else if(this.expect(Y.comma),this.afterTrailingComma(Y.braceR))break;var K=this.startNode();K.imported=this.parseIdent(!0),this.eatContextual("as")?K.local=this.parseIdent():(this.checkUnreserved(K.imported),K.local=K.imported),this.checkLVal(K.local,ia),_.push(this.finishNode(K,"ImportSpecifier"))}return _},ui.adaptDirectivePrologue=function(_){for(var M=0;M<_.length&&this.isDirectiveCandidate(_[M]);++M)_[M].directive=_[M].expression.raw.slice(1,-1)},ui.isDirectiveCandidate=function(_){return _.type==="ExpressionStatement"&&_.expression.type==="Literal"&&typeof _.expression.value=="string"&&(this.input[_.start]==='"'||this.input[_.start]==="'")};var Mn=Li.prototype;Mn.toAssignable=function(_,M,B){if(this.options.ecmaVersion>=6&&_)switch(_.type){case"Identifier":this.inAsync&&_.name==="await"&&this.raise(_.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":_.type="ObjectPattern",B&&this.checkPatternErrors(B,!0);for(var R=0,K=_.properties;R<K.length;R+=1){var ge=K[R];this.toAssignable(ge,M),ge.type==="RestElement"&&(ge.argument.type==="ArrayPattern"||ge.argument.type==="ObjectPattern")&&this.raise(ge.argument.start,"Unexpected token")}break;case"Property":_.kind!=="init"&&this.raise(_.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(_.value,M);break;case"ArrayExpression":_.type="ArrayPattern",B&&this.checkPatternErrors(B,!0),this.toAssignableList(_.elements,M);break;case"SpreadElement":_.type="RestElement",this.toAssignable(_.argument,M),_.argument.type==="AssignmentPattern"&&this.raise(_.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":_.operator!=="="&&this.raise(_.left.end,"Only '=' operator can be used for specifying default value."),_.type="AssignmentPattern",delete _.operator,this.toAssignable(_.left,M);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(_.expression,M,B);break;case"ChainExpression":this.raiseRecoverable(_.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!M)break;default:this.raise(_.start,"Assigning to rvalue")}else B&&this.checkPatternErrors(B,!0);return _},Mn.toAssignableList=function(_,M){for(var B=_.length,R=0;R<B;R++){var K=_[R];K&&this.toAssignable(K,M)}if(B){var ge=_[B-1];this.options.ecmaVersion===6&&M&&ge&&ge.type==="RestElement"&&ge.argument.type!=="Identifier"&&this.unexpected(ge.argument.start)}return _},Mn.parseSpread=function(_){var M=this.startNode();return this.next(),M.argument=this.parseMaybeAssign(!1,_),this.finishNode(M,"SpreadElement")},Mn.parseRestBinding=function(){var _=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==Y.name&&this.unexpected(),_.argument=this.parseBindingAtom(),this.finishNode(_,"RestElement")},Mn.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case Y.bracketL:var _=this.startNode();return this.next(),_.elements=this.parseBindingList(Y.bracketR,!0,!0),this.finishNode(_,"ArrayPattern");case Y.braceL:return this.parseObj(!0)}return this.parseIdent()},Mn.parseBindingList=function(_,M,B){for(var R=[],K=!0;!this.eat(_);)if(K?K=!1:this.expect(Y.comma),M&&this.type===Y.comma)R.push(null);else{if(B&&this.afterTrailingComma(_))break;if(this.type===Y.ellipsis){var ge=this.parseRestBinding();this.parseBindingListItem(ge),R.push(ge),this.type===Y.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(_);break}else{var He=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(He),R.push(He)}}return R},Mn.parseBindingListItem=function(_){return _},Mn.parseMaybeDefault=function(_,M,B){if(B=B||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(Y.eq))return B;var R=this.startNodeAt(_,M);return R.left=B,R.right=this.parseMaybeAssign(),this.finishNode(R,"AssignmentPattern")},Mn.checkLVal=function(_,M,B){switch(M===void 0&&(M=Ii),_.type){case"Identifier":M===ia&&_.name==="let"&&this.raiseRecoverable(_.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(_.name)&&this.raiseRecoverable(_.start,(M?"Binding ":"Assigning to ")+_.name+" in strict mode"),B&&(Yr(B,_.name)&&this.raiseRecoverable(_.start,"Argument name clash"),B[_.name]=!0),M!==Ii&&M!==oa&&this.declareName(_.name,M,_.start);break;case"ChainExpression":this.raiseRecoverable(_.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":M&&this.raiseRecoverable(_.start,"Binding member expression");break;case"ObjectPattern":for(var R=0,K=_.properties;R<K.length;R+=1){var ge=K[R];this.checkLVal(ge,M,B)}break;case"Property":this.checkLVal(_.value,M,B);break;case"ArrayPattern":for(var He=0,lt=_.elements;He<lt.length;He+=1){var pt=lt[He];pt&&this.checkLVal(pt,M,B)}break;case"AssignmentPattern":this.checkLVal(_.left,M,B);break;case"RestElement":this.checkLVal(_.argument,M,B);break;case"ParenthesizedExpression":this.checkLVal(_.expression,M,B);break;default:this.raise(_.start,(M?"Binding":"Assigning to")+" rvalue")}};var Un=Li.prototype;Un.checkPropClash=function(_,M,B){if(!(this.options.ecmaVersion>=9&&_.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(_.computed||_.method||_.shorthand))){var R=_.key,K;switch(R.type){case"Identifier":K=R.name;break;case"Literal":K=String(R.value);break;default:return}var ge=_.kind;if(this.options.ecmaVersion>=6){K==="__proto__"&&ge==="init"&&(M.proto&&(B?B.doubleProto<0&&(B.doubleProto=R.start):this.raiseRecoverable(R.start,"Redefinition of __proto__ property")),M.proto=!0);return}K="$"+K;var He=M[K];if(He){var lt;ge==="init"?lt=this.strict&&He.init||He.get||He.set:lt=He.init||He[ge],lt&&this.raiseRecoverable(R.start,"Redefinition of property")}else He=M[K]={init:!1,get:!1,set:!1};He[ge]=!0}},Un.parseExpression=function(_,M){var B=this.start,R=this.startLoc,K=this.parseMaybeAssign(_,M);if(this.type===Y.comma){var ge=this.startNodeAt(B,R);for(ge.expressions=[K];this.eat(Y.comma);)ge.expressions.push(this.parseMaybeAssign(_,M));return this.finishNode(ge,"SequenceExpression")}return K},Un.parseMaybeAssign=function(_,M,B){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(_);this.exprAllowed=!1}var R=!1,K=-1,ge=-1;M?(K=M.parenthesizedAssign,ge=M.trailingComma,M.parenthesizedAssign=M.trailingComma=-1):(M=new fe,R=!0);var He=this.start,lt=this.startLoc;(this.type===Y.parenL||this.type===Y.name)&&(this.potentialArrowAt=this.start);var pt=this.parseMaybeConditional(_,M);if(B&&(pt=B.call(this,pt,He,lt)),this.type.isAssign){var nr=this.startNodeAt(He,lt);return nr.operator=this.value,nr.left=this.type===Y.eq?this.toAssignable(pt,!1,M):pt,R||(M.parenthesizedAssign=M.trailingComma=M.doubleProto=-1),M.shorthandAssign>=nr.left.start&&(M.shorthandAssign=-1),this.checkLVal(pt),this.next(),nr.right=this.parseMaybeAssign(_),this.finishNode(nr,"AssignmentExpression")}else R&&this.checkExpressionErrors(M,!0);return K>-1&&(M.parenthesizedAssign=K),ge>-1&&(M.trailingComma=ge),pt},Un.parseMaybeConditional=function(_,M){var B=this.start,R=this.startLoc,K=this.parseExprOps(_,M);if(this.checkExpressionErrors(M))return K;if(this.eat(Y.question)){var ge=this.startNodeAt(B,R);return ge.test=K,ge.consequent=this.parseMaybeAssign(),this.expect(Y.colon),ge.alternate=this.parseMaybeAssign(_),this.finishNode(ge,"ConditionalExpression")}return K},Un.parseExprOps=function(_,M){var B=this.start,R=this.startLoc,K=this.parseMaybeUnary(M,!1);return this.checkExpressionErrors(M)||K.start===B&&K.type==="ArrowFunctionExpression"?K:this.parseExprOp(K,B,R,-1,_)},Un.parseExprOp=function(_,M,B,R,K){var ge=this.type.binop;if(ge!=null&&(!K||this.type!==Y._in)&&ge>R){var He=this.type===Y.logicalOR||this.type===Y.logicalAND,lt=this.type===Y.coalesce;lt&&(ge=Y.logicalAND.binop);var pt=this.value;this.next();var nr=this.start,sr=this.startLoc,Pn=this.parseExprOp(this.parseMaybeUnary(null,!1),nr,sr,ge,K),ni=this.buildBinary(M,B,_,Pn,pt,He||lt);return(He&&this.type===Y.coalesce||lt&&(this.type===Y.logicalOR||this.type===Y.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(ni,M,B,R,K)}return _},Un.buildBinary=function(_,M,B,R,K,ge){var He=this.startNodeAt(_,M);return He.left=B,He.operator=K,He.right=R,this.finishNode(He,ge?"LogicalExpression":"BinaryExpression")},Un.parseMaybeUnary=function(_,M){var B=this.start,R=this.startLoc,K;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))K=this.parseAwait(),M=!0;else if(this.type.prefix){var ge=this.startNode(),He=this.type===Y.incDec;ge.operator=this.value,ge.prefix=!0,this.next(),ge.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(_,!0),He?this.checkLVal(ge.argument):this.strict&&ge.operator==="delete"&&ge.argument.type==="Identifier"?this.raiseRecoverable(ge.start,"Deleting local variable in strict mode"):M=!0,K=this.finishNode(ge,He?"UpdateExpression":"UnaryExpression")}else{if(K=this.parseExprSubscripts(_),this.checkExpressionErrors(_))return K;for(;this.type.postfix&&!this.canInsertSemicolon();){var lt=this.startNodeAt(B,R);lt.operator=this.value,lt.prefix=!1,lt.argument=K,this.checkLVal(K),this.next(),K=this.finishNode(lt,"UpdateExpression")}}return!M&&this.eat(Y.starstar)?this.buildBinary(B,R,K,this.parseMaybeUnary(null,!1),"**",!1):K},Un.parseExprSubscripts=function(_){var M=this.start,B=this.startLoc,R=this.parseExprAtom(_);if(R.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return R;var K=this.parseSubscripts(R,M,B);return _&&K.type==="MemberExpression"&&(_.parenthesizedAssign>=K.start&&(_.parenthesizedAssign=-1),_.parenthesizedBind>=K.start&&(_.parenthesizedBind=-1)),K},Un.parseSubscripts=function(_,M,B,R){for(var K=this.options.ecmaVersion>=8&&_.type==="Identifier"&&_.name==="async"&&this.lastTokEnd===_.end&&!this.canInsertSemicolon()&&_.end-_.start==5&&this.potentialArrowAt===_.start,ge=!1;;){var He=this.parseSubscript(_,M,B,R,K,ge);if(He.optional&&(ge=!0),He===_||He.type==="ArrowFunctionExpression"){if(ge){var lt=this.startNodeAt(M,B);lt.expression=He,He=this.finishNode(lt,"ChainExpression")}return He}_=He}},Un.parseSubscript=function(_,M,B,R,K,ge){var He=this.options.ecmaVersion>=11,lt=He&&this.eat(Y.questionDot);R&&lt&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var pt=this.eat(Y.bracketL);if(pt||lt&&this.type!==Y.parenL&&this.type!==Y.backQuote||this.eat(Y.dot)){var nr=this.startNodeAt(M,B);nr.object=_,nr.property=pt?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),nr.computed=!!pt,pt&&this.expect(Y.bracketR),He&&(nr.optional=lt),_=this.finishNode(nr,"MemberExpression")}else if(!R&&this.eat(Y.parenL)){var sr=new fe,Pn=this.yieldPos,ni=this.awaitPos,Rn=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var Xi=this.parseExprList(Y.parenR,this.options.ecmaVersion>=8,!1,sr);if(K&&!lt&&!this.canInsertSemicolon()&&this.eat(Y.arrow))return this.checkPatternErrors(sr,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=Pn,this.awaitPos=ni,this.awaitIdentPos=Rn,this.parseArrowExpression(this.startNodeAt(M,B),Xi,!0);this.checkExpressionErrors(sr,!0),this.yieldPos=Pn||this.yieldPos,this.awaitPos=ni||this.awaitPos,this.awaitIdentPos=Rn||this.awaitIdentPos;var va=this.startNodeAt(M,B);va.callee=_,va.arguments=Xi,He&&(va.optional=lt),_=this.finishNode(va,"CallExpression")}else if(this.type===Y.backQuote){(lt||ge)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var Ca=this.startNodeAt(M,B);Ca.tag=_,Ca.quasi=this.parseTemplate({isTagged:!0}),_=this.finishNode(Ca,"TaggedTemplateExpression")}return _},Un.parseExprAtom=function(_){this.type===Y.slash&&this.readRegexp();var M,B=this.potentialArrowAt===this.start;switch(this.type){case Y._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),M=this.startNode(),this.next(),this.type===Y.parenL&&!this.allowDirectSuper&&this.raise(M.start,"super() call outside constructor of a subclass"),this.type!==Y.dot&&this.type!==Y.bracketL&&this.type!==Y.parenL&&this.unexpected(),this.finishNode(M,"Super");case Y._this:return M=this.startNode(),this.next(),this.finishNode(M,"ThisExpression");case Y.name:var R=this.start,K=this.startLoc,ge=this.containsEsc,He=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!ge&&He.name==="async"&&!this.canInsertSemicolon()&&this.eat(Y._function))return this.parseFunction(this.startNodeAt(R,K),0,!1,!0);if(B&&!this.canInsertSemicolon()){if(this.eat(Y.arrow))return this.parseArrowExpression(this.startNodeAt(R,K),[He],!1);if(this.options.ecmaVersion>=8&&He.name==="async"&&this.type===Y.name&&!ge)return He=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(Y.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(R,K),[He],!0)}return He;case Y.regexp:var lt=this.value;return M=this.parseLiteral(lt.value),M.regex={pattern:lt.pattern,flags:lt.flags},M;case Y.num:case Y.string:return this.parseLiteral(this.value);case Y._null:case Y._true:case Y._false:return M=this.startNode(),M.value=this.type===Y._null?null:this.type===Y._true,M.raw=this.type.keyword,this.next(),this.finishNode(M,"Literal");case Y.parenL:var pt=this.start,nr=this.parseParenAndDistinguishExpression(B);return _&&(_.parenthesizedAssign<0&&!this.isSimpleAssignTarget(nr)&&(_.parenthesizedAssign=pt),_.parenthesizedBind<0&&(_.parenthesizedBind=pt)),nr;case Y.bracketL:return M=this.startNode(),this.next(),M.elements=this.parseExprList(Y.bracketR,!0,!0,_),this.finishNode(M,"ArrayExpression");case Y.braceL:return this.parseObj(!1,_);case Y._function:return M=this.startNode(),this.next(),this.parseFunction(M,0);case Y._class:return this.parseClass(this.startNode(),!1);case Y._new:return this.parseNew();case Y.backQuote:return this.parseTemplate();case Y._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},Un.parseExprImport=function(){var _=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var M=this.parseIdent(!0);switch(this.type){case Y.parenL:return this.parseDynamicImport(_);case Y.dot:return _.meta=M,this.parseImportMeta(_);default:this.unexpected()}},Un.parseDynamicImport=function(_){if(this.next(),_.source=this.parseMaybeAssign(),!this.eat(Y.parenR)){var M=this.start;this.eat(Y.comma)&&this.eat(Y.parenR)?this.raiseRecoverable(M,"Trailing comma is not allowed in import()"):this.unexpected(M)}return this.finishNode(_,"ImportExpression")},Un.parseImportMeta=function(_){this.next();var M=this.containsEsc;return _.property=this.parseIdent(!0),_.property.name!=="meta"&&this.raiseRecoverable(_.property.start,"The only valid meta property for import is 'import.meta'"),M&&this.raiseRecoverable(_.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(_.start,"Cannot use 'import.meta' outside a module"),this.finishNode(_,"MetaProperty")},Un.parseLiteral=function(_){var M=this.startNode();return M.value=_,M.raw=this.input.slice(this.start,this.end),M.raw.charCodeAt(M.raw.length-1)===110&&(M.bigint=M.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(M,"Literal")},Un.parseParenExpression=function(){this.expect(Y.parenL);var _=this.parseExpression();return this.expect(Y.parenR),_},Un.parseParenAndDistinguishExpression=function(_){var M=this.start,B=this.startLoc,R,K=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var ge=this.start,He=this.startLoc,lt=[],pt=!0,nr=!1,sr=new fe,Pn=this.yieldPos,ni=this.awaitPos,Rn;for(this.yieldPos=0,this.awaitPos=0;this.type!==Y.parenR;)if(pt?pt=!1:this.expect(Y.comma),K&&this.afterTrailingComma(Y.parenR,!0)){nr=!0;break}else if(this.type===Y.ellipsis){Rn=this.start,lt.push(this.parseParenItem(this.parseRestBinding())),this.type===Y.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else lt.push(this.parseMaybeAssign(!1,sr,this.parseParenItem));var Xi=this.start,va=this.startLoc;if(this.expect(Y.parenR),_&&!this.canInsertSemicolon()&&this.eat(Y.arrow))return this.checkPatternErrors(sr,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=Pn,this.awaitPos=ni,this.parseParenArrowList(M,B,lt);(!lt.length||nr)&&this.unexpected(this.lastTokStart),Rn&&this.unexpected(Rn),this.checkExpressionErrors(sr,!0),this.yieldPos=Pn||this.yieldPos,this.awaitPos=ni||this.awaitPos,lt.length>1?(R=this.startNodeAt(ge,He),R.expressions=lt,this.finishNodeAt(R,"SequenceExpression",Xi,va)):R=lt[0]}else R=this.parseParenExpression();if(this.options.preserveParens){var Ca=this.startNodeAt(M,B);return Ca.expression=R,this.finishNode(Ca,"ParenthesizedExpression")}else return R},Un.parseParenItem=function(_){return _},Un.parseParenArrowList=function(_,M,B){return this.parseArrowExpression(this.startNodeAt(_,M),B)};var bi=[];Un.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var _=this.startNode(),M=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(Y.dot)){_.meta=M;var B=this.containsEsc;return _.property=this.parseIdent(!0),_.property.name!=="target"&&this.raiseRecoverable(_.property.start,"The only valid meta property for new is 'new.target'"),B&&this.raiseRecoverable(_.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(_.start,"'new.target' can only be used in functions"),this.finishNode(_,"MetaProperty")}var R=this.start,K=this.startLoc,ge=this.type===Y._import;return _.callee=this.parseSubscripts(this.parseExprAtom(),R,K,!0),ge&&_.callee.type==="ImportExpression"&&this.raise(R,"Cannot use new with import()"),this.eat(Y.parenL)?_.arguments=this.parseExprList(Y.parenR,this.options.ecmaVersion>=8,!1):_.arguments=bi,this.finishNode(_,"NewExpression")},Un.parseTemplateElement=function(_){var M=_.isTagged,B=this.startNode();return this.type===Y.invalidTemplate?(M||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),B.value={raw:this.value,cooked:null}):B.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),B.tail=this.type===Y.backQuote,this.finishNode(B,"TemplateElement")},Un.parseTemplate=function(_){_===void 0&&(_={});var M=_.isTagged;M===void 0&&(M=!1);var B=this.startNode();this.next(),B.expressions=[];var R=this.parseTemplateElement({isTagged:M});for(B.quasis=[R];!R.tail;)this.type===Y.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(Y.dollarBraceL),B.expressions.push(this.parseExpression()),this.expect(Y.braceR),B.quasis.push(R=this.parseTemplateElement({isTagged:M}));return this.next(),this.finishNode(B,"TemplateLiteral")},Un.isAsyncProp=function(_){return!_.computed&&_.key.type==="Identifier"&&_.key.name==="async"&&(this.type===Y.name||this.type===Y.num||this.type===Y.string||this.type===Y.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===Y.star)&&!Xt.test(this.input.slice(this.lastTokEnd,this.start))},Un.parseObj=function(_,M){var B=this.startNode(),R=!0,K={};for(B.properties=[],this.next();!this.eat(Y.braceR);){if(R)R=!1;else if(this.expect(Y.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(Y.braceR))break;var ge=this.parseProperty(_,M);_||this.checkPropClash(ge,K,M),B.properties.push(ge)}return this.finishNode(B,_?"ObjectPattern":"ObjectExpression")},Un.parseProperty=function(_,M){var B=this.startNode(),R,K,ge,He;if(this.options.ecmaVersion>=9&&this.eat(Y.ellipsis))return _?(B.argument=this.parseIdent(!1),this.type===Y.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(B,"RestElement")):(this.type===Y.parenL&&M&&(M.parenthesizedAssign<0&&(M.parenthesizedAssign=this.start),M.parenthesizedBind<0&&(M.parenthesizedBind=this.start)),B.argument=this.parseMaybeAssign(!1,M),this.type===Y.comma&&M&&M.trailingComma<0&&(M.trailingComma=this.start),this.finishNode(B,"SpreadElement"));this.options.ecmaVersion>=6&&(B.method=!1,B.shorthand=!1,(_||M)&&(ge=this.start,He=this.startLoc),_||(R=this.eat(Y.star)));var lt=this.containsEsc;return this.parsePropertyName(B),!_&&!lt&&this.options.ecmaVersion>=8&&!R&&this.isAsyncProp(B)?(K=!0,R=this.options.ecmaVersion>=9&&this.eat(Y.star),this.parsePropertyName(B,M)):K=!1,this.parsePropertyValue(B,_,R,K,ge,He,M,lt),this.finishNode(B,"Property")},Un.parsePropertyValue=function(_,M,B,R,K,ge,He,lt){if((B||R)&&this.type===Y.colon&&this.unexpected(),this.eat(Y.colon))_.value=M?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,He),_.kind="init";else if(this.options.ecmaVersion>=6&&this.type===Y.parenL)M&&this.unexpected(),_.kind="init",_.method=!0,_.value=this.parseMethod(B,R);else if(!M&&!lt&&this.options.ecmaVersion>=5&&!_.computed&&_.key.type==="Identifier"&&(_.key.name==="get"||_.key.name==="set")&&this.type!==Y.comma&&this.type!==Y.braceR&&this.type!==Y.eq){(B||R)&&this.unexpected(),_.kind=_.key.name,this.parsePropertyName(_),_.value=this.parseMethod(!1);var pt=_.kind==="get"?0:1;if(_.value.params.length!==pt){var nr=_.value.start;_.kind==="get"?this.raiseRecoverable(nr,"getter should have no params"):this.raiseRecoverable(nr,"setter should have exactly one param")}else _.kind==="set"&&_.value.params[0].type==="RestElement"&&this.raiseRecoverable(_.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!_.computed&&_.key.type==="Identifier"?((B||R)&&this.unexpected(),this.checkUnreserved(_.key),_.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=K),_.kind="init",M?_.value=this.parseMaybeDefault(K,ge,_.key):this.type===Y.eq&&He?(He.shorthandAssign<0&&(He.shorthandAssign=this.start),_.value=this.parseMaybeDefault(K,ge,_.key)):_.value=_.key,_.shorthand=!0):this.unexpected()},Un.parsePropertyName=function(_){if(this.options.ecmaVersion>=6){if(this.eat(Y.bracketL))return _.computed=!0,_.key=this.parseMaybeAssign(),this.expect(Y.bracketR),_.key;_.computed=!1}return _.key=this.type===Y.num||this.type===Y.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},Un.initFunction=function(_){_.id=null,this.options.ecmaVersion>=6&&(_.generator=_.expression=!1),this.options.ecmaVersion>=8&&(_.async=!1)},Un.parseMethod=function(_,M,B){var R=this.startNode(),K=this.yieldPos,ge=this.awaitPos,He=this.awaitIdentPos;return this.initFunction(R),this.options.ecmaVersion>=6&&(R.generator=_),this.options.ecmaVersion>=8&&(R.async=!!M),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Ui(M,R.generator)|fi|(B?na:0)),this.expect(Y.parenL),R.params=this.parseBindingList(Y.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(R,!1,!0),this.yieldPos=K,this.awaitPos=ge,this.awaitIdentPos=He,this.finishNode(R,"FunctionExpression")},Un.parseArrowExpression=function(_,M,B){var R=this.yieldPos,K=this.awaitPos,ge=this.awaitIdentPos;return this.enterScope(Ui(B,!1)|si),this.initFunction(_),this.options.ecmaVersion>=8&&(_.async=!!B),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,_.params=this.toAssignableList(M,!0),this.parseFunctionBody(_,!0,!1),this.yieldPos=R,this.awaitPos=K,this.awaitIdentPos=ge,this.finishNode(_,"ArrowFunctionExpression")},Un.parseFunctionBody=function(_,M,B){var R=M&&this.type!==Y.braceL,K=this.strict,ge=!1;if(R)_.body=this.parseMaybeAssign(),_.expression=!0,this.checkParams(_,!1);else{var He=this.options.ecmaVersion>=7&&!this.isSimpleParamList(_.params);(!K||He)&&(ge=this.strictDirective(this.end),ge&&He&&this.raiseRecoverable(_.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var lt=this.labels;this.labels=[],ge&&(this.strict=!0),this.checkParams(_,!K&&!ge&&!M&&!B&&this.isSimpleParamList(_.params)),this.strict&&_.id&&this.checkLVal(_.id,oa),_.body=this.parseBlock(!1,void 0,ge&&!K),_.expression=!1,this.adaptDirectivePrologue(_.body.body),this.labels=lt}this.exitScope()},Un.isSimpleParamList=function(_){for(var M=0,B=_;M<B.length;M+=1){var R=B[M];if(R.type!=="Identifier")return!1}return!0},Un.checkParams=function(_,M){for(var B={},R=0,K=_.params;R<K.length;R+=1){var ge=K[R];this.checkLVal(ge,$i,M?null:B)}},Un.parseExprList=function(_,M,B,R){for(var K=[],ge=!0;!this.eat(_);){if(ge)ge=!1;else if(this.expect(Y.comma),M&&this.afterTrailingComma(_))break;var He=void 0;B&&this.type===Y.comma?He=null:this.type===Y.ellipsis?(He=this.parseSpread(R),R&&this.type===Y.comma&&R.trailingComma<0&&(R.trailingComma=this.start)):He=this.parseMaybeAssign(!1,R),K.push(He)}return K},Un.checkUnreserved=function(_){var M=_.start,B=_.end,R=_.name;if(this.inGenerator&&R==="yield"&&this.raiseRecoverable(M,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&R==="await"&&this.raiseRecoverable(M,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(R)&&this.raise(M,"Unexpected keyword '"+R+"'"),!(this.options.ecmaVersion<6&&this.input.slice(M,B).indexOf("\\")!==-1)){var K=this.strict?this.reservedWordsStrict:this.reservedWords;K.test(R)&&(!this.inAsync&&R==="await"&&this.raiseRecoverable(M,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(M,"The keyword '"+R+"' is reserved"))}},Un.parseIdent=function(_,M){var B=this.startNode();return this.type===Y.name?B.name=this.value:this.type.keyword?(B.name=this.type.keyword,(B.name==="class"||B.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!_),this.finishNode(B,"Identifier"),_||(this.checkUnreserved(B),B.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=B.start)),B},Un.parseYield=function(_){this.yieldPos||(this.yieldPos=this.start);var M=this.startNode();return this.next(),this.type===Y.semi||this.canInsertSemicolon()||this.type!==Y.star&&!this.type.startsExpr?(M.delegate=!1,M.argument=null):(M.delegate=this.eat(Y.star),M.argument=this.parseMaybeAssign(_)),this.finishNode(M,"YieldExpression")},Un.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var _=this.startNode();return this.next(),_.argument=this.parseMaybeUnary(null,!1),this.finishNode(_,"AwaitExpression")};var vi=Li.prototype;vi.raise=function(_,M){var B=ft(this.input,_);M+=" ("+B.line+":"+B.column+")";var R=new SyntaxError(M);throw R.pos=_,R.loc=B,R.raisedAt=this.pos,R},vi.raiseRecoverable=vi.raise,vi.curPosition=function(){if(this.options.locations)return new ke(this.curLine,this.pos-this.lineStart)};var Sn=Li.prototype,Di=function(M){this.flags=M,this.var=[],this.lexical=[],this.functions=[]};Sn.enterScope=function(_){this.scopeStack.push(new Di(_))},Sn.exitScope=function(){this.scopeStack.pop()},Sn.treatFunctionsAsVarInScope=function(_){return _.flags&Gr||!this.inModule&&_.flags&Yn},Sn.declareName=function(_,M,B){var R=!1;if(M===ia){var K=this.currentScope();R=K.lexical.indexOf(_)>-1||K.functions.indexOf(_)>-1||K.var.indexOf(_)>-1,K.lexical.push(_),this.inModule&&K.flags&Yn&&delete this.undefinedExports[_]}else if(M===aa){var ge=this.currentScope();ge.lexical.push(_)}else if(M===qa){var He=this.currentScope();this.treatFunctionsAsVar?R=He.lexical.indexOf(_)>-1:R=He.lexical.indexOf(_)>-1||He.var.indexOf(_)>-1,He.functions.push(_)}else for(var lt=this.scopeStack.length-1;lt>=0;--lt){var pt=this.scopeStack[lt];if(pt.lexical.indexOf(_)>-1&&!(pt.flags&Gn&&pt.lexical[0]===_)||!this.treatFunctionsAsVarInScope(pt)&&pt.functions.indexOf(_)>-1){R=!0;break}if(pt.var.push(_),this.inModule&&pt.flags&Yn&&delete this.undefinedExports[_],pt.flags&Nn)break}R&&this.raiseRecoverable(B,"Identifier '"+_+"' has already been declared")},Sn.checkLocalExport=function(_){this.scopeStack[0].lexical.indexOf(_.name)===-1&&this.scopeStack[0].var.indexOf(_.name)===-1&&(this.undefinedExports[_.name]=_)},Sn.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},Sn.currentVarScope=function(){for(var _=this.scopeStack.length-1;;_--){var M=this.scopeStack[_];if(M.flags&Nn)return M}},Sn.currentThisScope=function(){for(var _=this.scopeStack.length-1;;_--){var M=this.scopeStack[_];if(M.flags&Nn&&!(M.flags&si))return M}};var Ri=function(M,B,R){this.type="",this.start=B,this.end=0,M.options.locations&&(this.loc=new ut(M,R)),M.options.directSourceFile&&(this.sourceFile=M.options.directSourceFile),M.options.ranges&&(this.range=[B,0])},ao=Li.prototype;ao.startNode=function(){return new Ri(this,this.start,this.startLoc)},ao.startNodeAt=function(_,M){return new Ri(this,_,M)};function gs(_,M,B,R){return _.type=M,_.end=B,this.options.locations&&(_.loc.end=R),this.options.ranges&&(_.range[1]=B),_}ao.finishNode=function(_,M){return gs.call(this,_,M,this.lastTokEnd,this.lastTokEndLoc)},ao.finishNodeAt=function(_,M,B,R){return gs.call(this,_,M,B,R)};var Zo=function(M,B,R,K,ge){this.token=M,this.isExpr=!!B,this.preserveSpace=!!R,this.override=K,this.generator=!!ge},Na={b_stat:new Zo("{",!1),b_expr:new Zo("{",!0),b_tmpl:new Zo("${",!1),p_stat:new Zo("(",!1),p_expr:new Zo("(",!0),q_tmpl:new Zo("`",!0,!0,function(_){return _.tryReadTemplateToken()}),f_stat:new Zo("function",!1),f_expr:new Zo("function",!0),f_expr_gen:new Zo("function",!0,!1,null,!0),f_gen:new Zo("function",!1,!1,null,!0)},ba=Li.prototype;ba.initialContext=function(){return[Na.b_stat]},ba.braceIsBlock=function(_){var M=this.curContext();return M===Na.f_expr||M===Na.f_stat?!0:_===Y.colon&&(M===Na.b_stat||M===Na.b_expr)?!M.isExpr:_===Y._return||_===Y.name&&this.exprAllowed?Xt.test(this.input.slice(this.lastTokEnd,this.start)):_===Y._else||_===Y.semi||_===Y.eof||_===Y.parenR||_===Y.arrow?!0:_===Y.braceL?M===Na.b_stat:_===Y._var||_===Y._const||_===Y.name?!1:!this.exprAllowed},ba.inGeneratorContext=function(){for(var _=this.context.length-1;_>=1;_--){var M=this.context[_];if(M.token==="function")return M.generator}return!1},ba.updateContext=function(_){var M,B=this.type;B.keyword&&_===Y.dot?this.exprAllowed=!1:(M=B.updateContext)?M.call(this,_):this.exprAllowed=B.beforeExpr},Y.parenR.updateContext=Y.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var _=this.context.pop();_===Na.b_stat&&this.curContext().token==="function"&&(_=this.context.pop()),this.exprAllowed=!_.isExpr},Y.braceL.updateContext=function(_){this.context.push(this.braceIsBlock(_)?Na.b_stat:Na.b_expr),this.exprAllowed=!0},Y.dollarBraceL.updateContext=function(){this.context.push(Na.b_tmpl),this.exprAllowed=!0},Y.parenL.updateContext=function(_){var M=_===Y._if||_===Y._for||_===Y._with||_===Y._while;this.context.push(M?Na.p_stat:Na.p_expr),this.exprAllowed=!0},Y.incDec.updateContext=function(){},Y._function.updateContext=Y._class.updateContext=function(_){_.beforeExpr&&_!==Y.semi&&_!==Y._else&&!(_===Y._return&&Xt.test(this.input.slice(this.lastTokEnd,this.start)))&&!((_===Y.colon||_===Y.braceL)&&this.curContext()===Na.b_stat)?this.context.push(Na.f_expr):this.context.push(Na.f_stat),this.exprAllowed=!1},Y.backQuote.updateContext=function(){this.curContext()===Na.q_tmpl?this.context.pop():this.context.push(Na.q_tmpl),this.exprAllowed=!1},Y.star.updateContext=function(_){if(_===Y._function){var M=this.context.length-1;this.context[M]===Na.f_expr?this.context[M]=Na.f_expr_gen:this.context[M]=Na.f_gen}this.exprAllowed=!0},Y.name.updateContext=function(_){var M=!1;this.options.ecmaVersion>=6&&_!==Y.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(M=!0),this.exprAllowed=M};var V="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",$=V+" Extended_Pictographic",re=$,pe={9:V,10:$,11:re},Me="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",Ge="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",Qe=Ge+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",se=Qe+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",Le={9:Ge,10:Qe,11:se},dt={};function fr(_){var M=dt[_]={binary:Se(pe[_]+" "+Me),nonBinary:{General_Category:Se(Me),Script:Se(Le[_])}};M.nonBinary.Script_Extensions=M.nonBinary.Script,M.nonBinary.gc=M.nonBinary.General_Category,M.nonBinary.sc=M.nonBinary.Script,M.nonBinary.scx=M.nonBinary.Script_Extensions}fr(9),fr(10),fr(11);var Lt=Li.prototype,Bt=function(M){this.parser=M,this.validFlags="gim"+(M.options.ecmaVersion>=6?"uy":"")+(M.options.ecmaVersion>=9?"s":""),this.unicodeProperties=dt[M.options.ecmaVersion>=11?11:M.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};Bt.prototype.reset=function(M,B,R){var K=R.indexOf("u")!==-1;this.start=M|0,this.source=B+"",this.flags=R,this.switchU=K&&this.parser.options.ecmaVersion>=6,this.switchN=K&&this.parser.options.ecmaVersion>=9},Bt.prototype.raise=function(M){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+M)},Bt.prototype.at=function(M,B){B===void 0&&(B=!1);var R=this.source,K=R.length;if(M>=K)return-1;var ge=R.charCodeAt(M);if(!(B||this.switchU)||ge<=55295||ge>=57344||M+1>=K)return ge;var He=R.charCodeAt(M+1);return He>=56320&&He<=57343?(ge<<10)+He-56613888:ge},Bt.prototype.nextIndex=function(M,B){B===void 0&&(B=!1);var R=this.source,K=R.length;if(M>=K)return K;var ge=R.charCodeAt(M),He;return!(B||this.switchU)||ge<=55295||ge>=57344||M+1>=K||(He=R.charCodeAt(M+1))<56320||He>57343?M+1:M+2},Bt.prototype.current=function(M){return M===void 0&&(M=!1),this.at(this.pos,M)},Bt.prototype.lookahead=function(M){return M===void 0&&(M=!1),this.at(this.nextIndex(this.pos,M),M)},Bt.prototype.advance=function(M){M===void 0&&(M=!1),this.pos=this.nextIndex(this.pos,M)},Bt.prototype.eat=function(M,B){return B===void 0&&(B=!1),this.current(B)===M?(this.advance(B),!0):!1};function hr(_){return _<=65535?String.fromCharCode(_):(_-=65536,String.fromCharCode((_>>10)+55296,(_&1023)+56320))}Lt.validateRegExpFlags=function(_){for(var M=_.validFlags,B=_.flags,R=0;R<B.length;R++){var K=B.charAt(R);M.indexOf(K)===-1&&this.raise(_.start,"Invalid regular expression flag"),B.indexOf(K,R+1)>-1&&this.raise(_.start,"Duplicate regular expression flag")}},Lt.validateRegExpPattern=function(_){this.regexp_pattern(_),!_.switchN&&this.options.ecmaVersion>=9&&_.groupNames.length>0&&(_.switchN=!0,this.regexp_pattern(_))},Lt.regexp_pattern=function(_){_.pos=0,_.lastIntValue=0,_.lastStringValue="",_.lastAssertionIsQuantifiable=!1,_.numCapturingParens=0,_.maxBackReference=0,_.groupNames.length=0,_.backReferenceNames.length=0,this.regexp_disjunction(_),_.pos!==_.source.length&&(_.eat(41)&&_.raise("Unmatched ')'"),(_.eat(93)||_.eat(125))&&_.raise("Lone quantifier brackets")),_.maxBackReference>_.numCapturingParens&&_.raise("Invalid escape");for(var M=0,B=_.backReferenceNames;M<B.length;M+=1){var R=B[M];_.groupNames.indexOf(R)===-1&&_.raise("Invalid named capture referenced")}},Lt.regexp_disjunction=function(_){for(this.regexp_alternative(_);_.eat(124);)this.regexp_alternative(_);this.regexp_eatQuantifier(_,!0)&&_.raise("Nothing to repeat"),_.eat(123)&&_.raise("Lone quantifier brackets")},Lt.regexp_alternative=function(_){for(;_.pos<_.source.length&&this.regexp_eatTerm(_););},Lt.regexp_eatTerm=function(_){return this.regexp_eatAssertion(_)?(_.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(_)&&_.switchU&&_.raise("Invalid quantifier"),!0):(_.switchU?this.regexp_eatAtom(_):this.regexp_eatExtendedAtom(_))?(this.regexp_eatQuantifier(_),!0):!1},Lt.regexp_eatAssertion=function(_){var M=_.pos;if(_.lastAssertionIsQuantifiable=!1,_.eat(94)||_.eat(36))return!0;if(_.eat(92)){if(_.eat(66)||_.eat(98))return!0;_.pos=M}if(_.eat(40)&&_.eat(63)){var B=!1;if(this.options.ecmaVersion>=9&&(B=_.eat(60)),_.eat(61)||_.eat(33))return this.regexp_disjunction(_),_.eat(41)||_.raise("Unterminated group"),_.lastAssertionIsQuantifiable=!B,!0}return _.pos=M,!1},Lt.regexp_eatQuantifier=function(_,M){return M===void 0&&(M=!1),this.regexp_eatQuantifierPrefix(_,M)?(_.eat(63),!0):!1},Lt.regexp_eatQuantifierPrefix=function(_,M){return _.eat(42)||_.eat(43)||_.eat(63)||this.regexp_eatBracedQuantifier(_,M)},Lt.regexp_eatBracedQuantifier=function(_,M){var B=_.pos;if(_.eat(123)){var R=0,K=-1;if(this.regexp_eatDecimalDigits(_)&&(R=_.lastIntValue,_.eat(44)&&this.regexp_eatDecimalDigits(_)&&(K=_.lastIntValue),_.eat(125)))return K!==-1&&K<R&&!M&&_.raise("numbers out of order in {} quantifier"),!0;_.switchU&&!M&&_.raise("Incomplete quantifier"),_.pos=B}return!1},Lt.regexp_eatAtom=function(_){return this.regexp_eatPatternCharacters(_)||_.eat(46)||this.regexp_eatReverseSolidusAtomEscape(_)||this.regexp_eatCharacterClass(_)||this.regexp_eatUncapturingGroup(_)||this.regexp_eatCapturingGroup(_)},Lt.regexp_eatReverseSolidusAtomEscape=function(_){var M=_.pos;if(_.eat(92)){if(this.regexp_eatAtomEscape(_))return!0;_.pos=M}return!1},Lt.regexp_eatUncapturingGroup=function(_){var M=_.pos;if(_.eat(40)){if(_.eat(63)&&_.eat(58)){if(this.regexp_disjunction(_),_.eat(41))return!0;_.raise("Unterminated group")}_.pos=M}return!1},Lt.regexp_eatCapturingGroup=function(_){if(_.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(_):_.current()===63&&_.raise("Invalid group"),this.regexp_disjunction(_),_.eat(41))return _.numCapturingParens+=1,!0;_.raise("Unterminated group")}return!1},Lt.regexp_eatExtendedAtom=function(_){return _.eat(46)||this.regexp_eatReverseSolidusAtomEscape(_)||this.regexp_eatCharacterClass(_)||this.regexp_eatUncapturingGroup(_)||this.regexp_eatCapturingGroup(_)||this.regexp_eatInvalidBracedQuantifier(_)||this.regexp_eatExtendedPatternCharacter(_)},Lt.regexp_eatInvalidBracedQuantifier=function(_){return this.regexp_eatBracedQuantifier(_,!0)&&_.raise("Nothing to repeat"),!1},Lt.regexp_eatSyntaxCharacter=function(_){var M=_.current();return _n(M)?(_.lastIntValue=M,_.advance(),!0):!1};function _n(_){return _===36||_>=40&&_<=43||_===46||_===63||_>=91&&_<=94||_>=123&&_<=125}Lt.regexp_eatPatternCharacters=function(_){for(var M=_.pos,B=0;(B=_.current())!==-1&&!_n(B);)_.advance();return _.pos!==M},Lt.regexp_eatExtendedPatternCharacter=function(_){var M=_.current();return M!==-1&&M!==36&&!(M>=40&&M<=43)&&M!==46&&M!==63&&M!==91&&M!==94&&M!==124?(_.advance(),!0):!1},Lt.regexp_groupSpecifier=function(_){if(_.eat(63)){if(this.regexp_eatGroupName(_)){_.groupNames.indexOf(_.lastStringValue)!==-1&&_.raise("Duplicate capture group name"),_.groupNames.push(_.lastStringValue);return}_.raise("Invalid group")}},Lt.regexp_eatGroupName=function(_){if(_.lastStringValue="",_.eat(60)){if(this.regexp_eatRegExpIdentifierName(_)&&_.eat(62))return!0;_.raise("Invalid capture group name")}return!1},Lt.regexp_eatRegExpIdentifierName=function(_){if(_.lastStringValue="",this.regexp_eatRegExpIdentifierStart(_)){for(_.lastStringValue+=hr(_.lastIntValue);this.regexp_eatRegExpIdentifierPart(_);)_.lastStringValue+=hr(_.lastIntValue);return!0}return!1},Lt.regexp_eatRegExpIdentifierStart=function(_){var M=_.pos,B=this.options.ecmaVersion>=11,R=_.current(B);return _.advance(B),R===92&&this.regexp_eatRegExpUnicodeEscapeSequence(_,B)&&(R=_.lastIntValue),fn(R)?(_.lastIntValue=R,!0):(_.pos=M,!1)};function fn(_){return Nt(_,!0)||_===36||_===95}Lt.regexp_eatRegExpIdentifierPart=function(_){var M=_.pos,B=this.options.ecmaVersion>=11,R=_.current(B);return _.advance(B),R===92&&this.regexp_eatRegExpUnicodeEscapeSequence(_,B)&&(R=_.lastIntValue),Mt(R)?(_.lastIntValue=R,!0):(_.pos=M,!1)};function Mt(_){return or(_,!0)||_===36||_===95||_===8204||_===8205}Lt.regexp_eatAtomEscape=function(_){return this.regexp_eatBackReference(_)||this.regexp_eatCharacterClassEscape(_)||this.regexp_eatCharacterEscape(_)||_.switchN&&this.regexp_eatKGroupName(_)?!0:(_.switchU&&(_.current()===99&&_.raise("Invalid unicode escape"),_.raise("Invalid escape")),!1)},Lt.regexp_eatBackReference=function(_){var M=_.pos;if(this.regexp_eatDecimalEscape(_)){var B=_.lastIntValue;if(_.switchU)return B>_.maxBackReference&&(_.maxBackReference=B),!0;if(B<=_.numCapturingParens)return!0;_.pos=M}return!1},Lt.regexp_eatKGroupName=function(_){if(_.eat(107)){if(this.regexp_eatGroupName(_))return _.backReferenceNames.push(_.lastStringValue),!0;_.raise("Invalid named reference")}return!1},Lt.regexp_eatCharacterEscape=function(_){return this.regexp_eatControlEscape(_)||this.regexp_eatCControlLetter(_)||this.regexp_eatZero(_)||this.regexp_eatHexEscapeSequence(_)||this.regexp_eatRegExpUnicodeEscapeSequence(_,!1)||!_.switchU&&this.regexp_eatLegacyOctalEscapeSequence(_)||this.regexp_eatIdentityEscape(_)},Lt.regexp_eatCControlLetter=function(_){var M=_.pos;if(_.eat(99)){if(this.regexp_eatControlLetter(_))return!0;_.pos=M}return!1},Lt.regexp_eatZero=function(_){return _.current()===48&&!dn(_.lookahead())?(_.lastIntValue=0,_.advance(),!0):!1},Lt.regexp_eatControlEscape=function(_){var M=_.current();return M===116?(_.lastIntValue=9,_.advance(),!0):M===110?(_.lastIntValue=10,_.advance(),!0):M===118?(_.lastIntValue=11,_.advance(),!0):M===102?(_.lastIntValue=12,_.advance(),!0):M===114?(_.lastIntValue=13,_.advance(),!0):!1},Lt.regexp_eatControlLetter=function(_){var M=_.current();return Jr(M)?(_.lastIntValue=M%32,_.advance(),!0):!1};function Jr(_){return _>=65&&_<=90||_>=97&&_<=122}Lt.regexp_eatRegExpUnicodeEscapeSequence=function(_,M){M===void 0&&(M=!1);var B=_.pos,R=M||_.switchU;if(_.eat(117)){if(this.regexp_eatFixedHexDigits(_,4)){var K=_.lastIntValue;if(R&&K>=55296&&K<=56319){var ge=_.pos;if(_.eat(92)&&_.eat(117)&&this.regexp_eatFixedHexDigits(_,4)){var He=_.lastIntValue;if(He>=56320&&He<=57343)return _.lastIntValue=(K-55296)*1024+(He-56320)+65536,!0}_.pos=ge,_.lastIntValue=K}return!0}if(R&&_.eat(123)&&this.regexp_eatHexDigits(_)&&_.eat(125)&&Br(_.lastIntValue))return!0;R&&_.raise("Invalid unicode escape"),_.pos=B}return!1};function Br(_){return _>=0&&_<=1114111}Lt.regexp_eatIdentityEscape=function(_){if(_.switchU)return this.regexp_eatSyntaxCharacter(_)?!0:_.eat(47)?(_.lastIntValue=47,!0):!1;var M=_.current();return M!==99&&(!_.switchN||M!==107)?(_.lastIntValue=M,_.advance(),!0):!1},Lt.regexp_eatDecimalEscape=function(_){_.lastIntValue=0;var M=_.current();if(M>=49&&M<=57){do _.lastIntValue=10*_.lastIntValue+(M-48),_.advance();while((M=_.current())>=48&&M<=57);return!0}return!1},Lt.regexp_eatCharacterClassEscape=function(_){var M=_.current();if(Wr(M))return _.lastIntValue=-1,_.advance(),!0;if(_.switchU&&this.options.ecmaVersion>=9&&(M===80||M===112)){if(_.lastIntValue=-1,_.advance(),_.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(_)&&_.eat(125))return!0;_.raise("Invalid property name")}return!1};function Wr(_){return _===100||_===68||_===115||_===83||_===119||_===87}Lt.regexp_eatUnicodePropertyValueExpression=function(_){var M=_.pos;if(this.regexp_eatUnicodePropertyName(_)&&_.eat(61)){var B=_.lastStringValue;if(this.regexp_eatUnicodePropertyValue(_)){var R=_.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(_,B,R),!0}}if(_.pos=M,this.regexp_eatLoneUnicodePropertyNameOrValue(_)){var K=_.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(_,K),!0}return!1},Lt.regexp_validateUnicodePropertyNameAndValue=function(_,M,B){Yr(_.unicodeProperties.nonBinary,M)||_.raise("Invalid property name"),_.unicodeProperties.nonBinary[M].test(B)||_.raise("Invalid property value")},Lt.regexp_validateUnicodePropertyNameOrValue=function(_,M){_.unicodeProperties.binary.test(M)||_.raise("Invalid property name")},Lt.regexp_eatUnicodePropertyName=function(_){var M=0;for(_.lastStringValue="";mi(M=_.current());)_.lastStringValue+=hr(M),_.advance();return _.lastStringValue!==""};function mi(_){return Jr(_)||_===95}Lt.regexp_eatUnicodePropertyValue=function(_){var M=0;for(_.lastStringValue="";en(M=_.current());)_.lastStringValue+=hr(M),_.advance();return _.lastStringValue!==""};function en(_){return mi(_)||dn(_)}Lt.regexp_eatLoneUnicodePropertyNameOrValue=function(_){return this.regexp_eatUnicodePropertyValue(_)},Lt.regexp_eatCharacterClass=function(_){if(_.eat(91)){if(_.eat(94),this.regexp_classRanges(_),_.eat(93))return!0;_.raise("Unterminated character class")}return!1},Lt.regexp_classRanges=function(_){for(;this.regexp_eatClassAtom(_);){var M=_.lastIntValue;if(_.eat(45)&&this.regexp_eatClassAtom(_)){var B=_.lastIntValue;_.switchU&&(M===-1||B===-1)&&_.raise("Invalid character class"),M!==-1&&B!==-1&&M>B&&_.raise("Range out of order in character class")}}},Lt.regexp_eatClassAtom=function(_){var M=_.pos;if(_.eat(92)){if(this.regexp_eatClassEscape(_))return!0;if(_.switchU){var B=_.current();(B===99||wi(B))&&_.raise("Invalid class escape"),_.raise("Invalid escape")}_.pos=M}var R=_.current();return R!==93?(_.lastIntValue=R,_.advance(),!0):!1},Lt.regexp_eatClassEscape=function(_){var M=_.pos;if(_.eat(98))return _.lastIntValue=8,!0;if(_.switchU&&_.eat(45))return _.lastIntValue=45,!0;if(!_.switchU&&_.eat(99)){if(this.regexp_eatClassControlLetter(_))return!0;_.pos=M}return this.regexp_eatCharacterClassEscape(_)||this.regexp_eatCharacterEscape(_)},Lt.regexp_eatClassControlLetter=function(_){var M=_.current();return dn(M)||M===95?(_.lastIntValue=M%32,_.advance(),!0):!1},Lt.regexp_eatHexEscapeSequence=function(_){var M=_.pos;if(_.eat(120)){if(this.regexp_eatFixedHexDigits(_,2))return!0;_.switchU&&_.raise("Invalid escape"),_.pos=M}return!1},Lt.regexp_eatDecimalDigits=function(_){var M=_.pos,B=0;for(_.lastIntValue=0;dn(B=_.current());)_.lastIntValue=10*_.lastIntValue+(B-48),_.advance();return _.pos!==M};function dn(_){return _>=48&&_<=57}Lt.regexp_eatHexDigits=function(_){var M=_.pos,B=0;for(_.lastIntValue=0;Wi(B=_.current());)_.lastIntValue=16*_.lastIntValue+hi(B),_.advance();return _.pos!==M};function Wi(_){return _>=48&&_<=57||_>=65&&_<=70||_>=97&&_<=102}function hi(_){return _>=65&&_<=70?10+(_-65):_>=97&&_<=102?10+(_-97):_-48}Lt.regexp_eatLegacyOctalEscapeSequence=function(_){if(this.regexp_eatOctalDigit(_)){var M=_.lastIntValue;if(this.regexp_eatOctalDigit(_)){var B=_.lastIntValue;M<=3&&this.regexp_eatOctalDigit(_)?_.lastIntValue=M*64+B*8+_.lastIntValue:_.lastIntValue=M*8+B}else _.lastIntValue=M;return!0}return!1},Lt.regexp_eatOctalDigit=function(_){var M=_.current();return wi(M)?(_.lastIntValue=M-48,_.advance(),!0):(_.lastIntValue=0,!1)};function wi(_){return _>=48&&_<=55}Lt.regexp_eatFixedHexDigits=function(_,M){var B=_.pos;_.lastIntValue=0;for(var R=0;R<M;++R){var K=_.current();if(!Wi(K))return _.pos=B,!1;_.lastIntValue=16*_.lastIntValue+hi(K),_.advance()}return!0};var _i=function(M){this.type=M.type,this.value=M.value,this.start=M.start,this.end=M.end,M.options.locations&&(this.loc=new ut(M,M.startLoc,M.endLoc)),M.options.ranges&&(this.range=[M.start,M.end])},ht=Li.prototype;ht.next=function(_){!_&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new _i(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},ht.getToken=function(){return this.next(),new _i(this)},typeof Symbol!="undefined"&&(ht[Symbol.iterator]=function(){var _=this;return{next:function(){var M=_.getToken();return{done:M.type===Y.eof,value:M}}}}),ht.curContext=function(){return this.context[this.context.length-1]},ht.nextToken=function(){var _=this.curContext();if((!_||!_.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(Y.eof);if(_.override)return _.override(this);this.readToken(this.fullCharCodeAtPos())},ht.readToken=function(_){return Nt(_,this.options.ecmaVersion>=6)||_===92?this.readWord():this.getTokenFromCode(_)},ht.fullCharCodeAtPos=function(){var _=this.input.charCodeAt(this.pos);if(_<=55295||_>=57344)return _;var M=this.input.charCodeAt(this.pos+1);return(_<<10)+M-56613888},ht.skipBlockComment=function(){var _=this.options.onComment&&this.curPosition(),M=this.pos,B=this.input.indexOf("*/",this.pos+=2);if(B===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=B+2,this.options.locations){at.lastIndex=M;for(var R;(R=at.exec(this.input))&&R.index<this.pos;)++this.curLine,this.lineStart=R.index+R[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(M+2,B),M,this.pos,_,this.curPosition())},ht.skipLineComment=function(_){for(var M=this.pos,B=this.options.onComment&&this.curPosition(),R=this.input.charCodeAt(this.pos+=_);this.pos<this.input.length&&!qe(R);)R=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(M+_,this.pos),M,this.pos,B,this.curPosition())},ht.skipSpace=function(){e:for(;this.pos<this.input.length;){var _=this.input.charCodeAt(this.pos);switch(_){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(_>8&&_<14||_>=5760&&Et.test(String.fromCharCode(_)))++this.pos;else break e}}},ht.finishToken=function(_,M){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var B=this.type;this.type=_,this.value=M,this.updateContext(B)},ht.readToken_dot=function(){var _=this.input.charCodeAt(this.pos+1);if(_>=48&&_<=57)return this.readNumber(!0);var M=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&_===46&&M===46?(this.pos+=3,this.finishToken(Y.ellipsis)):(++this.pos,this.finishToken(Y.dot))},ht.readToken_slash=function(){var _=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):_===61?this.finishOp(Y.assign,2):this.finishOp(Y.slash,1)},ht.readToken_mult_modulo_exp=function(_){var M=this.input.charCodeAt(this.pos+1),B=1,R=_===42?Y.star:Y.modulo;return this.options.ecmaVersion>=7&&_===42&&M===42&&(++B,R=Y.starstar,M=this.input.charCodeAt(this.pos+2)),M===61?this.finishOp(Y.assign,B+1):this.finishOp(R,B)},ht.readToken_pipe_amp=function(_){var M=this.input.charCodeAt(this.pos+1);if(M===_){if(this.options.ecmaVersion>=12){var B=this.input.charCodeAt(this.pos+2);if(B===61)return this.finishOp(Y.assign,3)}return this.finishOp(_===124?Y.logicalOR:Y.logicalAND,2)}return M===61?this.finishOp(Y.assign,2):this.finishOp(_===124?Y.bitwiseOR:Y.bitwiseAND,1)},ht.readToken_caret=function(){var _=this.input.charCodeAt(this.pos+1);return _===61?this.finishOp(Y.assign,2):this.finishOp(Y.bitwiseXOR,1)},ht.readToken_plus_min=function(_){var M=this.input.charCodeAt(this.pos+1);return M===_?M===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||Xt.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(Y.incDec,2):M===61?this.finishOp(Y.assign,2):this.finishOp(Y.plusMin,1)},ht.readToken_lt_gt=function(_){var M=this.input.charCodeAt(this.pos+1),B=1;return M===_?(B=_===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+B)===61?this.finishOp(Y.assign,B+1):this.finishOp(Y.bitShift,B)):M===33&&_===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(M===61&&(B=2),this.finishOp(Y.relational,B))},ht.readToken_eq_excl=function(_){var M=this.input.charCodeAt(this.pos+1);return M===61?this.finishOp(Y.equality,this.input.charCodeAt(this.pos+2)===61?3:2):_===61&&M===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(Y.arrow)):this.finishOp(_===61?Y.eq:Y.prefix,1)},ht.readToken_question=function(){var _=this.options.ecmaVersion;if(_>=11){var M=this.input.charCodeAt(this.pos+1);if(M===46){var B=this.input.charCodeAt(this.pos+2);if(B<48||B>57)return this.finishOp(Y.questionDot,2)}if(M===63){if(_>=12){var R=this.input.charCodeAt(this.pos+2);if(R===61)return this.finishOp(Y.assign,3)}return this.finishOp(Y.coalesce,2)}}return this.finishOp(Y.question,1)},ht.getTokenFromCode=function(_){switch(_){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(Y.parenL);case 41:return++this.pos,this.finishToken(Y.parenR);case 59:return++this.pos,this.finishToken(Y.semi);case 44:return++this.pos,this.finishToken(Y.comma);case 91:return++this.pos,this.finishToken(Y.bracketL);case 93:return++this.pos,this.finishToken(Y.bracketR);case 123:return++this.pos,this.finishToken(Y.braceL);case 125:return++this.pos,this.finishToken(Y.braceR);case 58:return++this.pos,this.finishToken(Y.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(Y.backQuote);case 48:var M=this.input.charCodeAt(this.pos+1);if(M===120||M===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(M===111||M===79)return this.readRadixNumber(8);if(M===98||M===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(_);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(_);case 124:case 38:return this.readToken_pipe_amp(_);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(_);case 60:case 62:return this.readToken_lt_gt(_);case 61:case 33:return this.readToken_eq_excl(_);case 63:return this.readToken_question();case 126:return this.finishOp(Y.prefix,1)}this.raise(this.pos,"Unexpected character '"+Ei(_)+"'")},ht.finishOp=function(_,M){var B=this.input.slice(this.pos,this.pos+M);return this.pos+=M,this.finishToken(_,B)},ht.readRegexp=function(){for(var _,M,B=this.pos;;){this.pos>=this.input.length&&this.raise(B,"Unterminated regular expression");var R=this.input.charAt(this.pos);if(Xt.test(R)&&this.raise(B,"Unterminated regular expression"),_)_=!1;else{if(R==="[")M=!0;else if(R==="]"&&M)M=!1;else if(R==="/"&&!M)break;_=R==="\\"}++this.pos}var K=this.input.slice(B,this.pos);++this.pos;var ge=this.pos,He=this.readWord1();this.containsEsc&&this.unexpected(ge);var lt=this.regexpState||(this.regexpState=new Bt(this));lt.reset(B,K,He),this.validateRegExpFlags(lt),this.validateRegExpPattern(lt);var pt=null;try{pt=new RegExp(K,He)}catch(nr){}return this.finishToken(Y.regexp,{pattern:K,flags:He,value:pt})},ht.readInt=function(_,M,B){for(var R=this.options.ecmaVersion>=12&&M===void 0,K=B&&this.input.charCodeAt(this.pos)===48,ge=this.pos,He=0,lt=0,pt=0,nr=M==null?Infinity:M;pt<nr;++pt,++this.pos){var sr=this.input.charCodeAt(this.pos),Pn=void 0;if(R&&sr===95){K&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),lt===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),pt===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),lt=sr;continue}if(sr>=97?Pn=sr-97+10:sr>=65?Pn=sr-65+10:sr>=48&&sr<=57?Pn=sr-48:Pn=Infinity,Pn>=_)break;lt=sr,He=He*_+Pn}return R&&lt===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===ge||M!=null&&this.pos-ge!==M?null:He};function Pt(_,M){return M?parseInt(_,8):parseFloat(_.replace(/_/g,""))}function Ta(_){return typeof BigInt!="function"?null:BigInt(_.replace(/_/g,""))}ht.readRadixNumber=function(_){var M=this.pos;this.pos+=2;var B=this.readInt(_);return B==null&&this.raise(this.start+2,"Expected number in radix "+_),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(B=Ta(this.input.slice(M,this.pos)),++this.pos):Nt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(Y.num,B)},ht.readNumber=function(_){var M=this.pos;!_&&this.readInt(10,void 0,!0)===null&&this.raise(M,"Invalid number");var B=this.pos-M>=2&&this.input.charCodeAt(M)===48;B&&this.strict&&this.raise(M,"Invalid number");var R=this.input.charCodeAt(this.pos);if(!B&&!_&&this.options.ecmaVersion>=11&&R===110){var K=Ta(this.input.slice(M,this.pos));return++this.pos,Nt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(Y.num,K)}B&&/[89]/.test(this.input.slice(M,this.pos))&&(B=!1),R===46&&!B&&(++this.pos,this.readInt(10),R=this.input.charCodeAt(this.pos)),(R===69||R===101)&&!B&&(R=this.input.charCodeAt(++this.pos),(R===43||R===45)&&++this.pos,this.readInt(10)===null&&this.raise(M,"Invalid number")),Nt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var ge=Pt(this.input.slice(M,this.pos),B);return this.finishToken(Y.num,ge)},ht.readCodePoint=function(){var _=this.input.charCodeAt(this.pos),M;if(_===123){this.options.ecmaVersion<6&&this.unexpected();var B=++this.pos;M=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,M>1114111&&this.invalidStringToken(B,"Code point out of bounds")}else M=this.readHexChar(4);return M};function Ei(_){return _<=65535?String.fromCharCode(_):(_-=65536,String.fromCharCode((_>>10)+55296,(_&1023)+56320))}ht.readString=function(_){for(var M="",B=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var R=this.input.charCodeAt(this.pos);if(R===_)break;R===92?(M+=this.input.slice(B,this.pos),M+=this.readEscapedChar(!1),B=this.pos):(qe(R,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return M+=this.input.slice(B,this.pos++),this.finishToken(Y.string,M)};var Ti={};ht.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(_){if(_===Ti)this.readInvalidTemplateToken();else throw _}this.inTemplateElement=!1},ht.invalidStringToken=function(_,M){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Ti;this.raise(_,M)},ht.readTmplToken=function(){for(var _="",M=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var B=this.input.charCodeAt(this.pos);if(B===96||B===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===Y.template||this.type===Y.invalidTemplate)?B===36?(this.pos+=2,this.finishToken(Y.dollarBraceL)):(++this.pos,this.finishToken(Y.backQuote)):(_+=this.input.slice(M,this.pos),this.finishToken(Y.template,_));if(B===92)_+=this.input.slice(M,this.pos),_+=this.readEscapedChar(!0),M=this.pos;else if(qe(B)){switch(_+=this.input.slice(M,this.pos),++this.pos,B){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:_+=`
`;break;default:_+=String.fromCharCode(B);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),M=this.pos}else++this.pos}},ht.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(Y.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},ht.readEscapedChar=function(_){var M=this.input.charCodeAt(++this.pos);switch(++this.pos,M){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return Ei(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(_){var B=this.pos-1;return this.invalidStringToken(B,"Invalid escape sequence in template string"),null}default:if(M>=48&&M<=55){var R=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],K=parseInt(R,8);return K>255&&(R=R.slice(0,-1),K=parseInt(R,8)),this.pos+=R.length-1,M=this.input.charCodeAt(this.pos),(R!=="0"||M===56||M===57)&&(this.strict||_)&&this.invalidStringToken(this.pos-1-R.length,_?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(K)}return qe(M)?"":String.fromCharCode(M)}},ht.readHexChar=function(_){var M=this.pos,B=this.readInt(16,_);return B===null&&this.invalidStringToken(M,"Bad character escape sequence"),B},ht.readWord1=function(){this.containsEsc=!1;for(var _="",M=!0,B=this.pos,R=this.options.ecmaVersion>=6;this.pos<this.input.length;){var K=this.fullCharCodeAtPos();if(or(K,R))this.pos+=K<=65535?1:2;else if(K===92){this.containsEsc=!0,_+=this.input.slice(B,this.pos);var ge=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var He=this.readCodePoint();(M?Nt:or)(He,R)||this.invalidStringToken(ge,"Invalid Unicode escape"),_+=Ei(He),B=this.pos}else break;M=!1}return _+this.input.slice(B,this.pos)},ht.readWord=function(){var _=this.readWord1(),M=Y.name;return this.keywords.test(_)&&(M=it[_]),this.finishToken(M,_)};var Zi="7.4.1";Li.acorn={Parser:Li,version:Zi,defaultOptions:kt,Position:ke,SourceLocation:ut,getLineInfo:ft,Node:Ri,TokenType:Tt,tokTypes:Y,keywordTypes:it,TokContext:Zo,tokContexts:Na,isIdentifierChar:or,isIdentifierStart:Nt,Token:_i,isNewLine:qe,lineBreak:Xt,lineBreakG:at,nonASCIIwhitespace:Et};function Pr(_,M){return Li.parse(_,M)}function on(_,M,B){return Li.parseExpressionAt(_,M,B)}function gt(_,M){return Li.tokenizer(_,M)}function sa(_,M){_.prototype=Object.create(M.prototype),_.prototype.constructor=_,_.__proto__=M}function J(_){var M=typeof Map=="function"?new Map:void 0;return J=function(R){if(R===null||!bu(R))return R;if(typeof R!="function")throw new TypeError("Super expression must either be null or a function");if(typeof M!="undefined"){if(M.has(R))return M.get(R);M.set(R,K)}function K(){return ta(R,arguments,Ma(this).constructor)}return K.prototype=Object.create(R.prototype,{constructor:{value:K,enumerable:!1,writable:!0,configurable:!0}}),za(K,R)},J(_)}function Ko(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(_){return!1}}function ta(_,M,B){return Ko()?ta=Reflect.construct:ta=function(K,ge,He){var lt=[null];lt.push.apply(lt,ge);var pt=Function.bind.apply(K,lt),nr=new pt;return He&&za(nr,He.prototype),nr},ta.apply(null,arguments)}function bu(_){return Function.toString.call(_).indexOf("[native code]")!==-1}function za(_,M){return za=Object.setPrototypeOf||function(R,K){return R.__proto__=K,R},za(_,M)}function Ma(_){return Ma=Object.setPrototypeOf?Object.getPrototypeOf:function(B){return B.__proto__||Object.getPrototypeOf(B)},Ma(_)}var Ka=function(_){sa(M,_);function M(){return _.apply(this,arguments)||this}return M}(J(Error)),ua=function(_){sa(M,_);function M(){return _.apply(this,arguments)||this}return M}(J(SyntaxError)),Ao=function(_){sa(M,_);function M(){return _.apply(this,arguments)||this}return M}(J(ReferenceError)),jo=function(_){sa(M,_);function M(){return _.apply(this,arguments)||this}return M}(J(TypeError)),wu=function(_){sa(M,_);function M(){return _.apply(this,arguments)||this}return M}(Ka),vo=function(_){sa(M,_);function M(){return _.apply(this,arguments)||this}return M}(ua),Do=function(_){sa(M,_);function M(){return _.apply(this,arguments)||this}return M}(Ao),la={UnknownError:[3001,"%0",wu],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",wu],NodeTypeSyntaxError:[1001,"Unknown node type: %0",Do],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",Do],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",Do],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",Do],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",Do],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",Do],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",Do],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",Do],ParamTypeSyntaxError:[1009,"Unknown param type: %0",Do],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",Do],FunctionUndefinedReferenceError:[2001,"%0 is not a function",Ao],VariableUndefinedReferenceError:[2002,"%0 is not defined",Ao],IsNotConstructor:[2003,"%0 is not a constructor",jo]};function $a(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(_){return!1}}function Fo(_,M,B){return $a()?Fo=Reflect.construct:Fo=function(K,ge,He){var lt=[null];lt.push.apply(lt,ge);var pt=Function.bind.apply(K,lt),nr=new pt;return He&&Qa(nr,He.prototype),nr},Fo.apply(null,arguments)}function Qa(_,M){return Qa=Object.setPrototypeOf||function(R,K){return R.__proto__=K,R},Qa(_,M)}var Ms="0.0.3";function Ol(_,M){Object.defineProperty(_,"name",{value:M,writable:!1,enumerable:!1,configurable:!0})}var ys=Object.prototype.hasOwnProperty,te=Symbol("Break"),ye=Symbol("Continue"),Xe=Symbol("DefaultCase"),It=Symbol("EmptyStatementReturn"),Or=Symbol("WithScopeName"),On=Symbol("SuperScopeName"),Mi=Symbol("RootScopeName"),oo=Symbol("GlobalScopeName");function Ra(_){return typeof _=="function"}var Ua=function(){function _(B){this.interpreter=B}var M=_.prototype;return M.generator=function(){var R=this.interpreter;function K(){return this.getCurrentScope()}function ge(){return this.getGlobalScope()}function He(){return this.getCurrentContext()}return{getOptions:R.getOptions.bind(R),getCurrentScope:K.bind(R),getGlobalScope:ge.bind(R),getCurrentContext:He.bind(R),getExecStartTime:R.getExecStartTime.bind(R)}},_}();function Vo(_,M,B){if(B===void 0&&(B=!0),!(_ instanceof Ua))throw new Error("Illegal call");if(typeof M!="string")return M;if(!!M){var R=_.generator(),K=R.getOptions(),ge={timeout:K.timeout,_initEnv:function(){B||this.setCurrentContext(R.getCurrentContext()),this.execStartTime=R.getExecStartTime(),this.execEndTime=this.execStartTime}},He=B?R.getGlobalScope():R.getCurrentScope(),lt=new xa(He,ge);return lt.evaluate(M)}}Object.defineProperty(Vo,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function _s(_){if(!(_ instanceof Ua))throw new Error("Illegal call");for(var M=_.generator(),B=arguments.length,R=new Array(B>1?B-1:0),K=1;K<B;K++)R[K-1]=arguments[K];var ge=R.pop(),He=new xa(M.getGlobalScope(),M.getOptions()),lt=`
		    (function anonymous(`+R.join(",")+`){
		        `+ge+`
		    });
		    `;return He.evaluate(lt)}Object.defineProperty(_s,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var lo=function(M){this.value=M},wo=function(M){this.value=M},xs=function(M){this.value=M},Ps=function(M,B,R){B===void 0&&(B=null),this.name=R,this.parent=B,this.data=M,this.labelStack=[]};function Fs(){}function fu(_,M){return _===void 0&&(_=null),new Ps(Object.create(null),_,M)}function bs(_){return Object.create(_)}var ga={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Float64Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:Vo,Function:_s};typeof JSON!="undefined"&&(ga.JSON=JSON),typeof Promise!="undefined"&&(ga.Promise=Promise),typeof Set!="undefined"&&(ga.Set=Set),typeof Map!="undefined"&&(ga.Map=Map),typeof Symbol!="undefined"&&(ga.Symbol=Symbol),typeof Proxy!="undefined"&&(ga.Proxy=Proxy),typeof WeakMap!="undefined"&&(ga.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(ga.WeakSet=WeakSet),typeof Reflect!="undefined"&&(ga.Reflect=Reflect);var xa=function(){function _(B,R){B===void 0&&(B=_.global),R===void 0&&(R={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:R.ecmaVersion||_.ecmaVersion,timeout:R.timeout||0,rootContext:R.rootContext,globalContextInFunction:R.globalContextInFunction===void 0?_.globalContextInFunction:R.globalContextInFunction,_initEnv:R._initEnv},this.context=B||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var M=_.prototype;return M.initEnvironment=function(R){var K;if(R instanceof Ps)K=R;else{var ge=null,He=this.createSuperScope(R);this.options.rootContext&&(ge=new Ps(bs(this.options.rootContext),He,Mi)),K=new Ps(R,ge||He,oo)}this.globalScope=K,this.currentScope=this.globalScope,this.globalContext=K.data,this.currentContext=K.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var lt=this.options._initEnv;lt&&lt.call(this)},M.getExecStartTime=function(){return this.execStartTime},M.getExecutionTime=function(){return this.execEndTime-this.execStartTime},M.setExecTimeout=function(R){R===void 0&&(R=0),this.options.timeout=R},M.getOptions=function(){return this.options},M.getGlobalScope=function(){return this.globalScope},M.getCurrentScope=function(){return this.currentScope},M.getCurrentContext=function(){return this.currentContext},M.isInterruptThrow=function(R){return R instanceof wu||R instanceof Do||R instanceof vo},M.createSuperScope=function(R){var K=Object.assign({},ga),ge=Object.keys(K);return ge.forEach(function(He){He in R&&delete K[He]}),new Ps(K,null,On)},M.setCurrentContext=function(R){this.currentContext=R},M.setCurrentScope=function(R){this.currentScope=R},M.evaluate=function(R){R===void 0&&(R="");var K;if(!!R)return K=Pr(R,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||_.ecmaVersion}),this.evaluateNode(K,R)},M.appendCode=function(R){return this.evaluate(R)},M.evaluateNode=function(R,K){var ge=this;K===void 0&&(K=""),this.value=void 0,this.source=K,this.sourceList.push(K),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var He=this.getCurrentScope(),lt=this.getCurrentContext(),pt=He.labelStack.concat([]),nr=this.callStack.concat([]),sr=function(){ge.setCurrentScope(He),ge.setCurrentContext(lt),He.labelStack=pt,ge.callStack=nr};try{var Pn=this.createClosure(R);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),Pn()}catch(ni){throw ni}finally{sr(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},M.createErrorMessage=function(R,K,ge){var He=R[1].replace("%0",String(K));return ge!==null&&(He+=this.getNodePosition(ge||this.lastExecNode)),He},M.createError=function(R,K){return new K(R)},M.createThrowError=function(R,K){return this.createError(R,K)},M.createInternalThrowError=function(R,K,ge){return this.createError(this.createErrorMessage(R,K,ge),R[2])},M.checkTimeout=function(){if(!this.isRunning)return!1;var R=this.options.timeout||0,K=Date.now();return K-this.execStartTime>R},M.getNodePosition=function(R){if(R){var K="";return R.loc?" ["+R.loc.start.line+":"+R.loc.start.column+"]"+K:""}return""},M.createClosure=function(R){var K=this,ge;switch(R.type){case"BinaryExpression":ge=this.binaryExpressionHandler(R);break;case"LogicalExpression":ge=this.logicalExpressionHandler(R);break;case"UnaryExpression":ge=this.unaryExpressionHandler(R);break;case"UpdateExpression":ge=this.updateExpressionHandler(R);break;case"ObjectExpression":ge=this.objectExpressionHandler(R);break;case"ArrayExpression":ge=this.arrayExpressionHandler(R);break;case"CallExpression":ge=this.callExpressionHandler(R);break;case"NewExpression":ge=this.newExpressionHandler(R);break;case"MemberExpression":ge=this.memberExpressionHandler(R);break;case"ThisExpression":ge=this.thisExpressionHandler(R);break;case"SequenceExpression":ge=this.sequenceExpressionHandler(R);break;case"Literal":ge=this.literalHandler(R);break;case"Identifier":ge=this.identifierHandler(R);break;case"AssignmentExpression":ge=this.assignmentExpressionHandler(R);break;case"FunctionDeclaration":ge=this.functionDeclarationHandler(R);break;case"VariableDeclaration":ge=this.variableDeclarationHandler(R);break;case"BlockStatement":case"Program":ge=this.programHandler(R);break;case"ExpressionStatement":ge=this.expressionStatementHandler(R);break;case"EmptyStatement":ge=this.emptyStatementHandler(R);break;case"ReturnStatement":ge=this.returnStatementHandler(R);break;case"FunctionExpression":ge=this.functionExpressionHandler(R);break;case"IfStatement":ge=this.ifStatementHandler(R);break;case"ConditionalExpression":ge=this.conditionalExpressionHandler(R);break;case"ForStatement":ge=this.forStatementHandler(R);break;case"WhileStatement":ge=this.whileStatementHandler(R);break;case"DoWhileStatement":ge=this.doWhileStatementHandler(R);break;case"ForInStatement":ge=this.forInStatementHandler(R);break;case"WithStatement":ge=this.withStatementHandler(R);break;case"ThrowStatement":ge=this.throwStatementHandler(R);break;case"TryStatement":ge=this.tryStatementHandler(R);break;case"ContinueStatement":ge=this.continueStatementHandler(R);break;case"BreakStatement":ge=this.breakStatementHandler(R);break;case"SwitchStatement":ge=this.switchStatementHandler(R);break;case"LabeledStatement":ge=this.labeledStatementHandler(R);break;case"DebuggerStatement":ge=this.debuggerStatementHandler(R);break;default:throw this.createInternalThrowError(la.NodeTypeSyntaxError,R.type,R)}return function(){var He=K.options.timeout;if(He&&He>0&&K.checkTimeout())throw K.createInternalThrowError(la.ExecutionTimeOutError,He,null);return K.lastExecNode=R,ge.apply(void 0,arguments)}},M.binaryExpressionHandler=function(R){var K=this,ge=this.createClosure(R.left),He=this.createClosure(R.right);return function(){var lt=ge(),pt=He();switch(R.operator){case"==":return lt==pt;case"!=":return lt!=pt;case"===":return lt===pt;case"!==":return lt!==pt;case"<":return lt<pt;case"<=":return lt<=pt;case">":return lt>pt;case">=":return lt>=pt;case"<<":return lt<<pt;case">>":return lt>>pt;case">>>":return lt>>>pt;case"+":return lt+pt;case"-":return lt-pt;case"*":return lt*pt;case"**":return Math.pow(lt,pt);case"/":return lt/pt;case"%":return lt%pt;case"|":return lt|pt;case"^":return lt^pt;case"&":return lt&pt;case"in":return lt in pt;case"instanceof":return lt instanceof pt;default:throw K.createInternalThrowError(la.BinaryOperatorSyntaxError,R.operator,R)}}},M.logicalExpressionHandler=function(R){var K=this,ge=this.createClosure(R.left),He=this.createClosure(R.right);return function(){switch(R.operator){case"||":return ge()||He();case"&&":return ge()&&He();default:throw K.createInternalThrowError(la.LogicalOperatorSyntaxError,R.operator,R)}}},M.unaryExpressionHandler=function(R){var K=this;switch(R.operator){case"delete":var ge=this.createObjectGetter(R.argument),He=this.createNameGetter(R.argument);return function(){var sr=ge(),Pn=He();return delete sr[Pn]};default:var lt;if(R.operator==="typeof"&&R.argument.type==="Identifier"){var pt=this.createObjectGetter(R.argument),nr=this.createNameGetter(R.argument);lt=function(){return pt()[nr()]}}else lt=this.createClosure(R.argument);return function(){var sr=lt();switch(R.operator){case"-":return-sr;case"+":return+sr;case"!":return!sr;case"~":return~sr;case"void":return;case"typeof":return typeof sr;default:throw K.createInternalThrowError(la.UnaryOperatorSyntaxError,R.operator,R)}}}},M.updateExpressionHandler=function(R){var K=this,ge=this.createObjectGetter(R.argument),He=this.createNameGetter(R.argument);return function(){var lt=ge(),pt=He();switch(K.assertVariable(lt,pt,R),R.operator){case"++":return R.prefix?++lt[pt]:lt[pt]++;case"--":return R.prefix?--lt[pt]:lt[pt]--;default:throw K.createInternalThrowError(la.UpdateOperatorSyntaxError,R.operator,R)}}},M.objectExpressionHandler=function(R){var K=this,ge=[];function He(pt){return pt.type==="Identifier"?pt.name:pt.type==="Literal"?pt.value:this.throwError(la.ObjectStructureSyntaxError,pt.type,pt)}var lt=Object.create(null);return R.properties.forEach(function(pt){var nr=pt.kind,sr=He(pt.key);(!lt[sr]||nr==="init")&&(lt[sr]={}),lt[sr][nr]=K.createClosure(pt.value),ge.push({key:sr,property:pt})}),function(){for(var pt={},nr=ge.length,sr=0;sr<nr;sr++){var Pn=ge[sr],ni=Pn.key,Rn=lt[ni],Xi=Rn.init?Rn.init():void 0,va=Rn.get?Rn.get():function(){},Ca=Rn.set?Rn.set():function(qu){};if("set"in Rn||"get"in Rn){var Vi={configurable:!0,enumerable:!0,get:va,set:Ca};Object.defineProperty(pt,ni,Vi)}else{var Es=Pn.property,hu=Es.kind;Es.key.type==="Identifier"&&Es.value.type==="FunctionExpression"&&hu==="init"&&!Es.value.id&&Ol(Xi,Es.key.name),pt[ni]=Xi}}return pt}},M.arrayExpressionHandler=function(R){var K=this,ge=R.elements.map(function(He){return He&&K.createClosure(He)});return function(){for(var He=ge.length,lt=Array(He),pt=0;pt<He;pt++){var nr=ge[pt];nr&&(lt[pt]=nr())}return lt}},M.safeObjectGet=function(R,K,ge){return R[K]},M.createCallFunctionGetter=function(R){var K=this;switch(R.type){case"MemberExpression":var ge=this.createClosure(R.object),He=this.createMemberKeyGetter(R),lt=this.source;return function(){var nr=ge(),sr=He(),Pn=K.safeObjectGet(nr,sr,R);if(!Pn||!Ra(Pn)){var ni=lt.slice(R.start,R.end);throw K.createInternalThrowError(la.FunctionUndefinedReferenceError,ni,R)}return Pn.__IS_EVAL_FUNC?function(Rn){return Pn(new Ua(K),Rn,!0)}:Pn.__IS_FUNCTION_FUNC?function(){for(var Rn=arguments.length,Xi=new Array(Rn),va=0;va<Rn;va++)Xi[va]=arguments[va];return Pn.apply(void 0,[new Ua(K)].concat(Xi))}:Pn.bind(nr)};default:var pt=this.createClosure(R);return function(){var nr="";R.type==="Identifier"&&(nr=R.name);var sr=pt();if(!sr||!Ra(sr))throw K.createInternalThrowError(la.FunctionUndefinedReferenceError,nr,R);if(R.type==="Identifier"&&sr.__IS_EVAL_FUNC&&nr==="eval")return function(Rn){var Xi=K.getScopeFromName(nr,K.getCurrentScope()),va=Xi.name===On||Xi.name===oo||Xi.name===Mi;return sr(new Ua(K),Rn,!va)};if(sr.__IS_EVAL_FUNC)return function(Rn){return sr(new Ua(K),Rn,!0)};if(sr.__IS_FUNCTION_FUNC)return function(){for(var Rn=arguments.length,Xi=new Array(Rn),va=0;va<Rn;va++)Xi[va]=arguments[va];return sr.apply(void 0,[new Ua(K)].concat(Xi))};var Pn=K.options.globalContextInFunction;if(R.type==="Identifier"){var ni=K.getIdentifierScope(R);ni.name===Or&&(Pn=ni.data)}return sr.bind(Pn)}}},M.callExpressionHandler=function(R){var K=this,ge=this.createCallFunctionGetter(R.callee),He=R.arguments.map(function(lt){return K.createClosure(lt)});return function(){return ge().apply(void 0,He.map(function(lt){return lt()}))}},M.functionExpressionHandler=function(R){var K=this,ge=this,He=this.source,lt=this.collectDeclVars,pt=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var nr=R.id?R.id.name:"",sr=R.params.length,Pn=R.params.map(function(va){return K.createParamNameGetter(va)}),ni=this.createClosure(R.body),Rn=this.collectDeclVars,Xi=this.collectDeclFuncs;return this.collectDeclVars=lt,this.collectDeclFuncs=pt,function(){var va=ge.getCurrentScope(),Ca=function Vi(){for(var Es=arguments.length,hu=new Array(Es),qu=0;qu<Es;qu++)hu[qu]=arguments[qu];ge.callStack.push(""+nr);var gf=ge.getCurrentScope(),ll=fu(va,"FunctionScope("+nr+")");ge.setCurrentScope(ll),ge.addDeclarationsToScope(Rn,Xi,ll),nr&&(ll.data[nr]=Vi),ll.data.arguments=arguments,Pn.forEach(function(Mu,Pu){ll.data[Mu()]=hu[Pu]});var Bc=ge.getCurrentContext();ge.setCurrentContext(this);var Tu=ni();if(ge.setCurrentContext(Bc),ge.setCurrentScope(gf),ge.callStack.pop(),Tu instanceof lo)return Tu.value};return Ol(Ca,nr),Object.defineProperty(Ca,"length",{value:sr,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(Ca,"toString",{value:function(){return He.slice(R.start,R.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(Ca,"valueOf",{value:function(){return He.slice(R.start,R.end)},writable:!0,configurable:!0,enumerable:!1}),Ca}},M.newExpressionHandler=function(R){var K=this,ge=this.source,He=this.createClosure(R.callee),lt=R.arguments.map(function(pt){return K.createClosure(pt)});return function(){var pt=He();if(!Ra(pt)||pt.__IS_EVAL_FUNC){var nr=R.callee,sr=ge.slice(nr.start,nr.end);throw K.createInternalThrowError(la.IsNotConstructor,sr,R)}return pt.__IS_FUNCTION_FUNC?pt.apply(void 0,[new Ua(K)].concat(lt.map(function(Pn){return Pn()}))):Fo(pt,lt.map(function(Pn){return Pn()}))}},M.memberExpressionHandler=function(R){var K=this.createClosure(R.object),ge=this.createMemberKeyGetter(R);return function(){var He=K(),lt=ge();return He[lt]}},M.thisExpressionHandler=function(R){var K=this;return function(){return K.getCurrentContext()}},M.sequenceExpressionHandler=function(R){var K=this,ge=R.expressions.map(function(He){return K.createClosure(He)});return function(){for(var He,lt=ge.length,pt=0;pt<lt;pt++){var nr=ge[pt];He=nr()}return He}},M.literalHandler=function(R){return function(){return R.regex?new RegExp(R.regex.pattern,R.regex.flags):R.value}},M.identifierHandler=function(R){var K=this;return function(){var ge=K.getCurrentScope(),He=K.getScopeDataFromName(R.name,ge);return K.assertVariable(He,R.name,R),He[R.name]}},M.getIdentifierScope=function(R){var K=this.getCurrentScope(),ge=this.getScopeFromName(R.name,K);return ge},M.assignmentExpressionHandler=function(R){var K=this;R.left.type==="Identifier"&&R.right.type==="FunctionExpression"&&!R.right.id&&(R.right.id={type:"Identifier",name:R.left.name});var ge=this.createObjectGetter(R.left),He=this.createNameGetter(R.left),lt=this.createClosure(R.right);return function(){var pt=ge(),nr=He(),sr=lt();switch(R.operator!=="="&&K.assertVariable(pt,nr,R),R.operator){case"=":return pt[nr]=sr;case"+=":return pt[nr]+=sr;case"-=":return pt[nr]-=sr;case"*=":return pt[nr]*=sr;case"**=":return pt[nr]=Math.pow(pt[nr],sr);case"/=":return pt[nr]/=sr;case"%=":return pt[nr]%=sr;case"<<=":return pt[nr]<<=sr;case">>=":return pt[nr]>>=sr;case">>>=":return pt[nr]>>>=sr;case"&=":return pt[nr]&=sr;case"^=":return pt[nr]^=sr;case"|=":return pt[nr]|=sr;default:throw K.createInternalThrowError(la.AssignmentExpressionSyntaxError,R.type,R)}}},M.functionDeclarationHandler=function(R){if(R.id){var K=this.functionExpressionHandler(R);Object.defineProperty(K,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(R.id.name,K)}return function(){return It}},M.getVariableName=function(R){if(R.type==="Identifier")return R.name;throw this.createInternalThrowError(la.VariableTypeSyntaxError,R.type,R)},M.variableDeclarationHandler=function(R){for(var K=this,ge,He=[],lt=0;lt<R.declarations.length;lt++){var pt=R.declarations[lt];this.varDeclaration(this.getVariableName(pt.id)),pt.init&&He.push({type:"AssignmentExpression",operator:"=",left:pt.id,right:pt.init})}return He.length&&(ge=this.createClosure({type:"BlockStatement",body:He})),function(){if(ge){var nr=K.isVarDeclMode;K.isVarDeclMode=!0,ge(),K.isVarDeclMode=nr}return It}},M.assertVariable=function(R,K,ge){if(R===this.globalScope.data&&!(K in R))throw this.createInternalThrowError(la.VariableUndefinedReferenceError,K,ge)},M.programHandler=function(R){var K=this,ge=R.body.map(function(He){return K.createClosure(He)});return function(){for(var He=It,lt=0;lt<ge.length;lt++){var pt=ge[lt],nr=K.setValue(pt());if(nr!==It&&(He=nr,He instanceof lo||He instanceof wo||He instanceof xs||He===te||He===ye))break}return He}},M.expressionStatementHandler=function(R){return this.createClosure(R.expression)},M.emptyStatementHandler=function(R){return function(){return It}},M.returnStatementHandler=function(R){var K=R.argument?this.createClosure(R.argument):Fs;return function(){return new lo(K())}},M.ifStatementHandler=function(R){var K=this.createClosure(R.test),ge=this.createClosure(R.consequent),He=R.alternate?this.createClosure(R.alternate):function(){return It};return function(){return K()?ge():He()}},M.conditionalExpressionHandler=function(R){return this.ifStatementHandler(R)},M.forStatementHandler=function(R){var K=this,ge=Fs,He=R.test?this.createClosure(R.test):function(){return!0},lt=Fs,pt=this.createClosure(R.body);return R.type==="ForStatement"&&(ge=R.init?this.createClosure(R.init):ge,lt=R.update?this.createClosure(R.update):Fs),function(nr){var sr,Pn=It,ni=R.type==="DoWhileStatement";for(nr&&nr.type==="LabeledStatement"&&(sr=nr.label.name),ge();ni||He();lt()){ni=!1;var Rn=K.setValue(pt());if(!(Rn===It||Rn===ye)){if(Rn===te)break;if(Pn=Rn,Pn instanceof xs&&Pn.value===sr){Pn=It;continue}if(Pn instanceof lo||Pn instanceof wo||Pn instanceof xs)break}}return Pn}},M.whileStatementHandler=function(R){return this.forStatementHandler(R)},M.doWhileStatementHandler=function(R){return this.forStatementHandler(R)},M.forInStatementHandler=function(R){var K=this,ge=R.left,He=this.createClosure(R.right),lt=this.createClosure(R.body);return R.left.type==="VariableDeclaration"&&(this.createClosure(R.left)(),ge=R.left.declarations[0].id),function(pt){var nr,sr=It,Pn;pt&&pt.type==="LabeledStatement"&&(nr=pt.label.name);var ni=He();for(Pn in ni){K.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:ge,right:{type:"Literal",value:Pn}})();var Rn=K.setValue(lt());if(!(Rn===It||Rn===ye)){if(Rn===te)break;if(sr=Rn,sr instanceof xs&&sr.value===nr){sr=It;continue}if(sr instanceof lo||sr instanceof wo||sr instanceof xs)break}}return sr}},M.withStatementHandler=function(R){var K=this,ge=this.createClosure(R.object),He=this.createClosure(R.body);return function(){var lt=ge(),pt=K.getCurrentScope(),nr=new Ps(lt,pt,Or);K.setCurrentScope(nr);var sr=K.setValue(He());return K.setCurrentScope(pt),sr}},M.throwStatementHandler=function(R){var K=this,ge=this.createClosure(R.argument);return function(){throw K.setValue(void 0),ge()}},M.tryStatementHandler=function(R){var K=this,ge=this.createClosure(R.block),He=R.handler?this.catchClauseHandler(R.handler):null,lt=R.finalizer?this.createClosure(R.finalizer):null;return function(){var pt=K.getCurrentScope(),nr=K.getCurrentContext(),sr=pt.labelStack.concat([]),Pn=K.callStack.concat([]),ni=It,Rn,Xi,va=function(){K.setCurrentScope(pt),K.setCurrentContext(nr),pt.labelStack=sr,K.callStack=Pn};try{ni=K.setValue(ge()),ni instanceof lo&&(Rn=ni)}catch(Ca){if(va(),K.isInterruptThrow(Ca))throw Ca;if(He)try{ni=K.setValue(He(Ca)),ni instanceof lo&&(Rn=ni)}catch(Vi){if(va(),K.isInterruptThrow(Vi))throw Vi;Xi=Vi}}if(lt)try{ni=lt(),ni instanceof lo&&(Rn=ni)}catch(Ca){if(va(),K.isInterruptThrow(Ca))throw Ca;Xi=Ca}if(Xi)throw Xi;return Rn||ni}},M.catchClauseHandler=function(R){var K=this,ge=this.createParamNameGetter(R.param),He=this.createClosure(R.body);return function(lt){var pt,nr=K.getCurrentScope(),sr=nr.data,Pn=ge(),ni=ys.call(sr,Pn),Rn=sr[Pn];return sr[Pn]=lt,pt=He(),ni?sr[Pn]=Rn:delete sr[Pn],pt}},M.continueStatementHandler=function(R){return function(){return R.label?new xs(R.label.name):ye}},M.breakStatementHandler=function(R){return function(){return R.label?new wo(R.label.name):te}},M.switchStatementHandler=function(R){var K=this,ge=this.createClosure(R.discriminant),He=R.cases.map(function(lt){return K.switchCaseHandler(lt)});return function(){for(var lt=ge(),pt=!1,nr,sr,Pn,ni=0;ni<He.length;ni++){var Rn=He[ni](),Xi=Rn.testClosure();if(Xi===Xe){Pn=Rn;continue}if(pt||Xi===lt){if(pt=!0,sr=K.setValue(Rn.bodyClosure()),sr===It)continue;if(sr===te||(nr=sr,nr instanceof lo||nr instanceof wo||nr instanceof xs||nr===ye))break}}if(!pt&&Pn){sr=K.setValue(Pn.bodyClosure());var va=sr===It||sr===te||sr===ye;va||(nr=sr)}return nr}},M.switchCaseHandler=function(R){var K=R.test?this.createClosure(R.test):function(){return Xe},ge=this.createClosure({type:"BlockStatement",body:R.consequent});return function(){return{testClosure:K,bodyClosure:ge}}},M.labeledStatementHandler=function(R){var K=this,ge=R.label.name,He=this.createClosure(R.body);return function(){var lt,pt=K.getCurrentScope();return pt.labelStack.push(ge),lt=He(R),lt instanceof wo&&lt.value===ge&&(lt=It),pt.labelStack.pop(),lt}},M.debuggerStatementHandler=function(R){return function(){debugger;return It}},M.createParamNameGetter=function(R){if(R.type==="Identifier")return function(){return R.name};throw this.createInternalThrowError(la.ParamTypeSyntaxError,R.type,R)},M.createObjectKeyGetter=function(R){var K;return R.type==="Identifier"?K=function(){return R.name}:K=this.createClosure(R),function(){return K()}},M.createMemberKeyGetter=function(R){return R.computed?this.createClosure(R.property):this.createObjectKeyGetter(R.property)},M.createObjectGetter=function(R){var K=this;switch(R.type){case"Identifier":return function(){return K.getScopeDataFromName(R.name,K.getCurrentScope())};case"MemberExpression":return this.createClosure(R.object);default:throw this.createInternalThrowError(la.AssignmentTypeSyntaxError,R.type,R)}},M.createNameGetter=function(R){switch(R.type){case"Identifier":return function(){return R.name};case"MemberExpression":return this.createMemberKeyGetter(R);default:throw this.createInternalThrowError(la.AssignmentTypeSyntaxError,R.type,R)}},M.varDeclaration=function(R){var K=this.collectDeclVars;K[R]=void 0},M.funcDeclaration=function(R,K){var ge=this.collectDeclFuncs;ge[R]=K},M.addDeclarationsToScope=function(R,K,ge){var He=ge.data;for(var lt in K){var pt=K[lt];He[lt]=pt&&pt()}for(var nr in R)nr in He||(He[nr]=void 0)},M.getScopeValue=function(R,K){var ge=this.getScopeFromName(R,K);return ge.data[R]},M.getScopeDataFromName=function(R,K){return this.getScopeFromName(R,K).data},M.getScopeFromName=function(R,K){var ge=K;do if(R in ge.data)return ge;while(ge=ge.parent);return this.globalScope},M.setValue=function(R){var K=this.callStack.length;return this.isVarDeclMode||K||R===It||R===te||R===ye||R instanceof wo||R instanceof xs||(this.value=R instanceof lo?R.value:R),R},M.getValue=function(){return this.value},_}();xa.version=Ms,xa.eval=Vo,xa.Function=_s,xa.ecmaVersion=5,xa.globalContextInFunction=void 0,xa.global=Object.create(null);function is(_){return _===void 0&&(_=Object.create(null)),_}function mf(_,M,B){M===void 0&&(M=[]),B===void 0&&(B={});var R=B.parsingContext,K=B.timeout===void 0?0:B.timeout,ge=`
    (function anonymous(`+M.join(",")+`){
         `+_+`
    });
    `,He=new xa(R,{ecmaVersion:B.ecmaVersion,timeout:K,rootContext:B.rootContext,globalContextInFunction:B.globalContextInFunction});return He.evaluate(ge)}function Il(_,M,B){var R=new xa(M,B);return R.evaluate(_)}var qs=Il,ac=function(){function _(B){this._code=B}var M=_.prototype;return M.runInContext=function(R){return Il(this._code,R)},M.runInNewContext=function(R){return Il(this._code,R)},_}(),Yu=function(_,M,B){return Il(_,M,B)};function Ks(){for(var _=arguments.length,M=new Array(_),B=0;B<_;B++)M[B]=arguments[B];var R=M.pop();return mf(R||"",M)}var ul=Yu},20396:function(Er,ne,Q){var Ce;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(me,g,Re,W){"use strict";var he=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,de=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),ze=he||de,_e=["","webkit","Moz","MS","ms","o"],tt=ze?"":g.createElement("div"),mt="function",wt=Math.round,Nt=Math.abs,or=Date.now;function Tt(te,ye,Xe){return setTimeout(at(te,Xe),ye)}function Kt(te,ye,Xe){return Array.isArray(te)?(_t(te,Xe[ye],Xe),!0):!1}function _t(te,ye,Xe){var It;if(!!te)if(te.forEach)te.forEach(ye,Xe);else if(te.length!==W)for(It=0;It<te.length;)ye.call(Xe,te[It],It,te),It++;else for(It in te)te.hasOwnProperty(It)&&ye.call(Xe,te[It],It,te)}function ct(te,ye,Xe){var It="DEPRECATED METHOD: "+ye+`
`+Xe+` AT 
`;return function(){var Or=new Error("get-stack-trace"),On=Or&&Or.stack?Or.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Mi=me.console&&(me.console.warn||me.console.log);return Mi&&Mi.call(me.console,It,On),te.apply(this,arguments)}}var it;typeof Object.assign!="function"?it=function(ye){if(ye===W||ye===null)throw new TypeError("Cannot convert undefined or null to object");for(var Xe=Object(ye),It=1;It<arguments.length;It++){var Or=arguments[It];if(Or!==W&&Or!==null)for(var On in Or)Or.hasOwnProperty(On)&&(Xe[On]=Or[On])}return Xe}:it=Object.assign;var $t=ct(function(ye,Xe,It){for(var Or=Object.keys(Xe),On=0;On<Or.length;)(!It||It&&ye[Or[On]]===W)&&(ye[Or[On]]=Xe[Or[On]]),On++;return ye},"extend","Use `assign`."),Y=ct(function(ye,Xe){return $t(ye,Xe,!0)},"merge","Use `assign`.");function Xt(te,ye,Xe){var It=ye.prototype,Or;Or=te.prototype=Object.create(It),Or.constructor=te,Or._super=It,Xe&&it(Or,Xe)}function at(te,ye){return function(){return te.apply(ye,arguments)}}function qe(te,ye){return typeof te==mt?te.apply(ye&&ye[0]||W,ye):te}function Et(te,ye){return te===W?ye:te}function $e(te,ye,Xe){_t(Yr(ye),function(It){te.addEventListener(It,Xe,!1)})}function Ht(te,ye,Xe){_t(Yr(ye),function(It){te.removeEventListener(It,Xe,!1)})}function mr(te,ye){for(;te;){if(te==ye)return!0;te=te.parentNode}return!1}function Fr(te,ye){return te.indexOf(ye)>-1}function Yr(te){return te.trim().split(/\s+/g)}function S(te,ye,Xe){if(te.indexOf&&!Xe)return te.indexOf(ye);for(var It=0;It<te.length;){if(Xe&&te[It][Xe]==ye||!Xe&&te[It]===ye)return It;It++}return-1}function Se(te){return Array.prototype.slice.call(te,0)}function ke(te,ye,Xe){for(var It=[],Or=[],On=0;On<te.length;){var Mi=ye?te[On][ye]:te[On];S(Or,Mi)<0&&It.push(te[On]),Or[On]=Mi,On++}return Xe&&(ye?It=It.sort(function(Ra,Ua){return Ra[ye]>Ua[ye]}):It=It.sort()),It}function ut(te,ye){for(var Xe,It,Or=ye[0].toUpperCase()+ye.slice(1),On=0;On<_e.length;){if(Xe=_e[On],It=Xe?Xe+Or:ye,It in te)return It;On++}return W}var ft=1;function kt(){return ft++}function Ft(te){var ye=te.ownerDocument||te;return ye.defaultView||ye.parentWindow||me}var yr=/mobile|tablet|ip(ad|hone|od)|android/i,Yn="ontouchstart"in me,Gr=ut(me,"PointerEvent")!==W,Nn=Yn&&yr.test(navigator.userAgent),yn="touch",zn="pen",si="mouse",Gn="kinect",fi=25,na=1,Ui=2,Ii=4,$i=8,ia=1,qa=2,aa=4,oa=8,Li=16,Ki=qa|aa,Hi=oa|Li,Ts=Ki|Hi,fe=["x","y"],ui=["clientX","clientY"];function bo(te,ye){var Xe=this;this.manager=te,this.callback=ye,this.element=te.element,this.target=te.options.inputTarget,this.domHandler=function(It){qe(te.options.enable,[te])&&Xe.handler(It)},this.init()}bo.prototype={handler:function(){},init:function(){this.evEl&&$e(this.element,this.evEl,this.domHandler),this.evTarget&&$e(this.target,this.evTarget,this.domHandler),this.evWin&&$e(Ft(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Ht(this.element,this.evEl,this.domHandler),this.evTarget&&Ht(this.target,this.evTarget,this.domHandler),this.evWin&&Ht(Ft(this.element),this.evWin,this.domHandler)}};function cu(te){var ye,Xe=te.options.inputClass;return Xe?ye=Xe:Gr?ye=Me:Nn?ye=Bt:Yn?ye=Mt:ye=ba,new ye(te,Zt)}function Zt(te,ye,Xe){var It=Xe.pointers.length,Or=Xe.changedPointers.length,On=ye&na&&It-Or==0,Mi=ye&(Ii|$i)&&It-Or==0;Xe.isFirst=!!On,Xe.isFinal=!!Mi,On&&(te.session={}),Xe.eventType=ye,er(te,Xe),te.emit("hammer.input",Xe),te.recognize(Xe),te.session.prevInput=Xe}function er(te,ye){var Xe=te.session,It=ye.pointers,Or=It.length;Xe.firstInput||(Xe.firstInput=Mn(ye)),Or>1&&!Xe.firstMultiple?Xe.firstMultiple=Mn(ye):Or===1&&(Xe.firstMultiple=!1);var On=Xe.firstInput,Mi=Xe.firstMultiple,oo=Mi?Mi.center:On.center,Ra=ye.center=Un(It);ye.timeStamp=or(),ye.deltaTime=ye.timeStamp-On.timeStamp,ye.angle=Di(oo,Ra),ye.distance=Sn(oo,Ra),Rr(Xe,ye),ye.offsetDirection=vi(ye.deltaX,ye.deltaY);var Ua=bi(ye.deltaTime,ye.deltaX,ye.deltaY);ye.overallVelocityX=Ua.x,ye.overallVelocityY=Ua.y,ye.overallVelocity=Nt(Ua.x)>Nt(Ua.y)?Ua.x:Ua.y,ye.scale=Mi?ao(Mi.pointers,It):1,ye.rotation=Mi?Ri(Mi.pointers,It):0,ye.maxPointers=Xe.prevInput?ye.pointers.length>Xe.prevInput.maxPointers?ye.pointers.length:Xe.prevInput.maxPointers:ye.pointers.length,an(Xe,ye);var Vo=te.element;mr(ye.srcEvent.target,Vo)&&(Vo=ye.srcEvent.target),ye.target=Vo}function Rr(te,ye){var Xe=ye.center,It=te.offsetDelta||{},Or=te.prevDelta||{},On=te.prevInput||{};(ye.eventType===na||On.eventType===Ii)&&(Or=te.prevDelta={x:On.deltaX||0,y:On.deltaY||0},It=te.offsetDelta={x:Xe.x,y:Xe.y}),ye.deltaX=Or.x+(Xe.x-It.x),ye.deltaY=Or.y+(Xe.y-It.y)}function an(te,ye){var Xe=te.lastInterval||ye,It=ye.timeStamp-Xe.timeStamp,Or,On,Mi,oo;if(ye.eventType!=$i&&(It>fi||Xe.velocity===W)){var Ra=ye.deltaX-Xe.deltaX,Ua=ye.deltaY-Xe.deltaY,Vo=bi(It,Ra,Ua);On=Vo.x,Mi=Vo.y,Or=Nt(Vo.x)>Nt(Vo.y)?Vo.x:Vo.y,oo=vi(Ra,Ua),te.lastInterval=ye}else Or=Xe.velocity,On=Xe.velocityX,Mi=Xe.velocityY,oo=Xe.direction;ye.velocity=Or,ye.velocityX=On,ye.velocityY=Mi,ye.direction=oo}function Mn(te){for(var ye=[],Xe=0;Xe<te.pointers.length;)ye[Xe]={clientX:wt(te.pointers[Xe].clientX),clientY:wt(te.pointers[Xe].clientY)},Xe++;return{timeStamp:or(),pointers:ye,center:Un(ye),deltaX:te.deltaX,deltaY:te.deltaY}}function Un(te){var ye=te.length;if(ye===1)return{x:wt(te[0].clientX),y:wt(te[0].clientY)};for(var Xe=0,It=0,Or=0;Or<ye;)Xe+=te[Or].clientX,It+=te[Or].clientY,Or++;return{x:wt(Xe/ye),y:wt(It/ye)}}function bi(te,ye,Xe){return{x:ye/te||0,y:Xe/te||0}}function vi(te,ye){return te===ye?ia:Nt(te)>=Nt(ye)?te<0?qa:aa:ye<0?oa:Li}function Sn(te,ye,Xe){Xe||(Xe=fe);var It=ye[Xe[0]]-te[Xe[0]],Or=ye[Xe[1]]-te[Xe[1]];return Math.sqrt(It*It+Or*Or)}function Di(te,ye,Xe){Xe||(Xe=fe);var It=ye[Xe[0]]-te[Xe[0]],Or=ye[Xe[1]]-te[Xe[1]];return Math.atan2(Or,It)*180/Math.PI}function Ri(te,ye){return Di(ye[1],ye[0],ui)+Di(te[1],te[0],ui)}function ao(te,ye){return Sn(ye[0],ye[1],ui)/Sn(te[0],te[1],ui)}var gs={mousedown:na,mousemove:Ui,mouseup:Ii},Zo="mousedown",Na="mousemove mouseup";function ba(){this.evEl=Zo,this.evWin=Na,this.pressed=!1,bo.apply(this,arguments)}Xt(ba,bo,{handler:function(ye){var Xe=gs[ye.type];Xe&na&&ye.button===0&&(this.pressed=!0),Xe&Ui&&ye.which!==1&&(Xe=Ii),!!this.pressed&&(Xe&Ii&&(this.pressed=!1),this.callback(this.manager,Xe,{pointers:[ye],changedPointers:[ye],pointerType:si,srcEvent:ye}))}});var V={pointerdown:na,pointermove:Ui,pointerup:Ii,pointercancel:$i,pointerout:$i},$={2:yn,3:zn,4:si,5:Gn},re="pointerdown",pe="pointermove pointerup pointercancel";!ze&&me.MSPointerEvent&&!me.PointerEvent&&(re="MSPointerDown",pe="MSPointerMove MSPointerUp MSPointerCancel");function Me(){this.evEl=re,this.evWin=pe,bo.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}Xt(Me,bo,{handler:function(ye){var Xe=this.store,It=!1,Or=ye.type.toLowerCase().replace("ms",""),On=V[Or],Mi=$[ye.pointerType]||ye.pointerType,oo=Mi==yn,Ra=S(Xe,ye.pointerId,"pointerId");On&na&&(ye.button===0||oo)?Ra<0&&(Xe.push(ye),Ra=Xe.length-1):On&(Ii|$i)&&(It=!0),!(Ra<0)&&(Xe[Ra]=ye,this.callback(this.manager,On,{pointers:Xe,changedPointers:[ye],pointerType:Mi,srcEvent:ye}),It&&Xe.splice(Ra,1))}});var Ge={touchstart:na,touchmove:Ui,touchend:Ii,touchcancel:$i},Qe="touchstart",se="touchstart touchmove touchend touchcancel";function Le(){this.evTarget=Qe,this.evWin=se,this.started=!1,bo.apply(this,arguments)}Xt(Le,bo,{handler:function(ye){var Xe=Ge[ye.type];if(Xe===na&&(this.started=!0),!!this.started){var It=dt.call(this,ye,Xe);Xe&(Ii|$i)&&It[0].length-It[1].length==0&&(this.started=!1),this.callback(this.manager,Xe,{pointers:It[0],changedPointers:It[1],pointerType:yn,srcEvent:ye})}}});function dt(te,ye){var Xe=Se(te.touches),It=Se(te.changedTouches);return ye&(Ii|$i)&&(Xe=ke(Xe.concat(It),"identifier",!0)),[Xe,It]}var fr={touchstart:na,touchmove:Ui,touchend:Ii,touchcancel:$i},Lt="touchstart touchmove touchend touchcancel";function Bt(){this.evTarget=Lt,this.targetIds={},bo.apply(this,arguments)}Xt(Bt,bo,{handler:function(ye){var Xe=fr[ye.type],It=hr.call(this,ye,Xe);!It||this.callback(this.manager,Xe,{pointers:It[0],changedPointers:It[1],pointerType:yn,srcEvent:ye})}});function hr(te,ye){var Xe=Se(te.touches),It=this.targetIds;if(ye&(na|Ui)&&Xe.length===1)return It[Xe[0].identifier]=!0,[Xe,Xe];var Or,On,Mi=Se(te.changedTouches),oo=[],Ra=this.target;if(On=Xe.filter(function(Ua){return mr(Ua.target,Ra)}),ye===na)for(Or=0;Or<On.length;)It[On[Or].identifier]=!0,Or++;for(Or=0;Or<Mi.length;)It[Mi[Or].identifier]&&oo.push(Mi[Or]),ye&(Ii|$i)&&delete It[Mi[Or].identifier],Or++;if(!!oo.length)return[ke(On.concat(oo),"identifier",!0),oo]}var _n=2500,fn=25;function Mt(){bo.apply(this,arguments);var te=at(this.handler,this);this.touch=new Bt(this.manager,te),this.mouse=new ba(this.manager,te),this.primaryTouch=null,this.lastTouches=[]}Xt(Mt,bo,{handler:function(ye,Xe,It){var Or=It.pointerType==yn,On=It.pointerType==si;if(!(On&&It.sourceCapabilities&&It.sourceCapabilities.firesTouchEvents)){if(Or)Jr.call(this,Xe,It);else if(On&&Wr.call(this,It))return;this.callback(ye,Xe,It)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Jr(te,ye){te&na?(this.primaryTouch=ye.changedPointers[0].identifier,Br.call(this,ye)):te&(Ii|$i)&&Br.call(this,ye)}function Br(te){var ye=te.changedPointers[0];if(ye.identifier===this.primaryTouch){var Xe={x:ye.clientX,y:ye.clientY};this.lastTouches.push(Xe);var It=this.lastTouches,Or=function(){var On=It.indexOf(Xe);On>-1&&It.splice(On,1)};setTimeout(Or,_n)}}function Wr(te){for(var ye=te.srcEvent.clientX,Xe=te.srcEvent.clientY,It=0;It<this.lastTouches.length;It++){var Or=this.lastTouches[It],On=Math.abs(ye-Or.x),Mi=Math.abs(Xe-Or.y);if(On<=fn&&Mi<=fn)return!0}return!1}var mi=ze?W:ut(tt.style,"touchAction"),en=mi!==W,dn="compute",Wi="auto",hi="manipulation",wi="none",_i="pan-x",ht="pan-y",Pt=Ti();function Ta(te,ye){this.manager=te,this.set(ye)}Ta.prototype={set:function(te){te==dn&&(te=this.compute()),en&&this.manager.element.style&&Pt[te]&&(this.manager.element.style[mi]=te),this.actions=te.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var te=[];return _t(this.manager.recognizers,function(ye){qe(ye.options.enable,[ye])&&(te=te.concat(ye.getTouchAction()))}),Ei(te.join(" "))},preventDefaults:function(te){var ye=te.srcEvent,Xe=te.offsetDirection;if(this.manager.session.prevented){ye.preventDefault();return}var It=this.actions,Or=Fr(It,wi)&&!Pt[wi],On=Fr(It,ht)&&!Pt[ht],Mi=Fr(It,_i)&&!Pt[_i];if(Or){var oo=te.pointers.length===1,Ra=te.distance<2,Ua=te.deltaTime<250;if(oo&&Ra&&Ua)return}if(!(Mi&&On)&&(Or||On&&Xe&Ki||Mi&&Xe&Hi))return this.preventSrc(ye)},preventSrc:function(te){this.manager.session.prevented=!0,te.preventDefault()}};function Ei(te){if(Fr(te,wi))return wi;var ye=Fr(te,_i),Xe=Fr(te,ht);return ye&&Xe?wi:ye||Xe?ye?_i:ht:Fr(te,hi)?hi:Wi}function Ti(){if(!en)return!1;var te={};if(ze)return te;var ye=me.CSS&&me.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(Xe){te[Xe]=ye?me.CSS.supports("touch-action",Xe):!0}),te}var Zi=1,Pr=2,on=4,gt=8,sa=gt,J=16,Ko=32;function ta(te){this.options=it({},this.defaults,te||{}),this.id=kt(),this.manager=null,this.options.enable=Et(this.options.enable,!0),this.state=Zi,this.simultaneous={},this.requireFail=[]}ta.prototype={defaults:{},set:function(te){return it(this.options,te),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(te){if(Kt(te,"recognizeWith",this))return this;var ye=this.simultaneous;return te=Ma(te,this),ye[te.id]||(ye[te.id]=te,te.recognizeWith(this)),this},dropRecognizeWith:function(te){return Kt(te,"dropRecognizeWith",this)?this:(te=Ma(te,this),delete this.simultaneous[te.id],this)},requireFailure:function(te){if(Kt(te,"requireFailure",this))return this;var ye=this.requireFail;return te=Ma(te,this),S(ye,te)===-1&&(ye.push(te),te.requireFailure(this)),this},dropRequireFailure:function(te){if(Kt(te,"dropRequireFailure",this))return this;te=Ma(te,this);var ye=S(this.requireFail,te);return ye>-1&&this.requireFail.splice(ye,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(te){return!!this.simultaneous[te.id]},emit:function(te){var ye=this,Xe=this.state;function It(Or){ye.manager.emit(Or,te)}Xe<gt&&It(ye.options.event+bu(Xe)),It(ye.options.event),te.additionalEvent&&It(te.additionalEvent),Xe>=gt&&It(ye.options.event+bu(Xe))},tryEmit:function(te){if(this.canEmit())return this.emit(te);this.state=Ko},canEmit:function(){for(var te=0;te<this.requireFail.length;){if(!(this.requireFail[te].state&(Ko|Zi)))return!1;te++}return!0},recognize:function(te){var ye=it({},te);if(!qe(this.options.enable,[this,ye])){this.reset(),this.state=Ko;return}this.state&(sa|J|Ko)&&(this.state=Zi),this.state=this.process(ye),this.state&(Pr|on|gt|J)&&this.tryEmit(ye)},process:function(te){},getTouchAction:function(){},reset:function(){}};function bu(te){return te&J?"cancel":te&gt?"end":te&on?"move":te&Pr?"start":""}function za(te){return te==Li?"down":te==oa?"up":te==qa?"left":te==aa?"right":""}function Ma(te,ye){var Xe=ye.manager;return Xe?Xe.get(te):te}function Ka(){ta.apply(this,arguments)}Xt(Ka,ta,{defaults:{pointers:1},attrTest:function(te){var ye=this.options.pointers;return ye===0||te.pointers.length===ye},process:function(te){var ye=this.state,Xe=te.eventType,It=ye&(Pr|on),Or=this.attrTest(te);return It&&(Xe&$i||!Or)?ye|J:It||Or?Xe&Ii?ye|gt:ye&Pr?ye|on:Pr:Ko}});function ua(){Ka.apply(this,arguments),this.pX=null,this.pY=null}Xt(ua,Ka,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ts},getTouchAction:function(){var te=this.options.direction,ye=[];return te&Ki&&ye.push(ht),te&Hi&&ye.push(_i),ye},directionTest:function(te){var ye=this.options,Xe=!0,It=te.distance,Or=te.direction,On=te.deltaX,Mi=te.deltaY;return Or&ye.direction||(ye.direction&Ki?(Or=On===0?ia:On<0?qa:aa,Xe=On!=this.pX,It=Math.abs(te.deltaX)):(Or=Mi===0?ia:Mi<0?oa:Li,Xe=Mi!=this.pY,It=Math.abs(te.deltaY))),te.direction=Or,Xe&&It>ye.threshold&&Or&ye.direction},attrTest:function(te){return Ka.prototype.attrTest.call(this,te)&&(this.state&Pr||!(this.state&Pr)&&this.directionTest(te))},emit:function(te){this.pX=te.deltaX,this.pY=te.deltaY;var ye=za(te.direction);ye&&(te.additionalEvent=this.options.event+ye),this._super.emit.call(this,te)}});function Ao(){Ka.apply(this,arguments)}Xt(Ao,Ka,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[wi]},attrTest:function(te){return this._super.attrTest.call(this,te)&&(Math.abs(te.scale-1)>this.options.threshold||this.state&Pr)},emit:function(te){if(te.scale!==1){var ye=te.scale<1?"in":"out";te.additionalEvent=this.options.event+ye}this._super.emit.call(this,te)}});function jo(){ta.apply(this,arguments),this._timer=null,this._input=null}Xt(jo,ta,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Wi]},process:function(te){var ye=this.options,Xe=te.pointers.length===ye.pointers,It=te.distance<ye.threshold,Or=te.deltaTime>ye.time;if(this._input=te,!It||!Xe||te.eventType&(Ii|$i)&&!Or)this.reset();else if(te.eventType&na)this.reset(),this._timer=Tt(function(){this.state=sa,this.tryEmit()},ye.time,this);else if(te.eventType&Ii)return sa;return Ko},reset:function(){clearTimeout(this._timer)},emit:function(te){this.state===sa&&(te&&te.eventType&Ii?this.manager.emit(this.options.event+"up",te):(this._input.timeStamp=or(),this.manager.emit(this.options.event,this._input)))}});function wu(){Ka.apply(this,arguments)}Xt(wu,Ka,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[wi]},attrTest:function(te){return this._super.attrTest.call(this,te)&&(Math.abs(te.rotation)>this.options.threshold||this.state&Pr)}});function vo(){Ka.apply(this,arguments)}Xt(vo,Ka,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Ki|Hi,pointers:1},getTouchAction:function(){return ua.prototype.getTouchAction.call(this)},attrTest:function(te){var ye=this.options.direction,Xe;return ye&(Ki|Hi)?Xe=te.overallVelocity:ye&Ki?Xe=te.overallVelocityX:ye&Hi&&(Xe=te.overallVelocityY),this._super.attrTest.call(this,te)&&ye&te.offsetDirection&&te.distance>this.options.threshold&&te.maxPointers==this.options.pointers&&Nt(Xe)>this.options.velocity&&te.eventType&Ii},emit:function(te){var ye=za(te.offsetDirection);ye&&this.manager.emit(this.options.event+ye,te),this.manager.emit(this.options.event,te)}});function Do(){ta.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}Xt(Do,ta,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[hi]},process:function(te){var ye=this.options,Xe=te.pointers.length===ye.pointers,It=te.distance<ye.threshold,Or=te.deltaTime<ye.time;if(this.reset(),te.eventType&na&&this.count===0)return this.failTimeout();if(It&&Or&&Xe){if(te.eventType!=Ii)return this.failTimeout();var On=this.pTime?te.timeStamp-this.pTime<ye.interval:!0,Mi=!this.pCenter||Sn(this.pCenter,te.center)<ye.posThreshold;this.pTime=te.timeStamp,this.pCenter=te.center,!Mi||!On?this.count=1:this.count+=1,this._input=te;var oo=this.count%ye.taps;if(oo===0)return this.hasRequireFailures()?(this._timer=Tt(function(){this.state=sa,this.tryEmit()},ye.interval,this),Pr):sa}return Ko},failTimeout:function(){return this._timer=Tt(function(){this.state=Ko},this.options.interval,this),Ko},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==sa&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function la(te,ye){return ye=ye||{},ye.recognizers=Et(ye.recognizers,la.defaults.preset),new Qa(te,ye)}la.VERSION="2.0.7",la.defaults={domEvents:!1,touchAction:dn,enable:!0,inputTarget:null,inputClass:null,preset:[[wu,{enable:!1}],[Ao,{enable:!1},["rotate"]],[vo,{direction:Ki}],[ua,{direction:Ki},["swipe"]],[Do],[Do,{event:"doubletap",taps:2},["tap"]],[jo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var $a=1,Fo=2;function Qa(te,ye){this.options=it({},la.defaults,ye||{}),this.options.inputTarget=this.options.inputTarget||te,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=te,this.input=cu(this),this.touchAction=new Ta(this,this.options.touchAction),Ms(this,!0),_t(this.options.recognizers,function(Xe){var It=this.add(new Xe[0](Xe[1]));Xe[2]&&It.recognizeWith(Xe[2]),Xe[3]&&It.requireFailure(Xe[3])},this)}Qa.prototype={set:function(te){return it(this.options,te),te.touchAction&&this.touchAction.update(),te.inputTarget&&(this.input.destroy(),this.input.target=te.inputTarget,this.input.init()),this},stop:function(te){this.session.stopped=te?Fo:$a},recognize:function(te){var ye=this.session;if(!ye.stopped){this.touchAction.preventDefaults(te);var Xe,It=this.recognizers,Or=ye.curRecognizer;(!Or||Or&&Or.state&sa)&&(Or=ye.curRecognizer=null);for(var On=0;On<It.length;)Xe=It[On],ye.stopped!==Fo&&(!Or||Xe==Or||Xe.canRecognizeWith(Or))?Xe.recognize(te):Xe.reset(),!Or&&Xe.state&(Pr|on|gt)&&(Or=ye.curRecognizer=Xe),On++}},get:function(te){if(te instanceof ta)return te;for(var ye=this.recognizers,Xe=0;Xe<ye.length;Xe++)if(ye[Xe].options.event==te)return ye[Xe];return null},add:function(te){if(Kt(te,"add",this))return this;var ye=this.get(te.options.event);return ye&&this.remove(ye),this.recognizers.push(te),te.manager=this,this.touchAction.update(),te},remove:function(te){if(Kt(te,"remove",this))return this;if(te=this.get(te),te){var ye=this.recognizers,Xe=S(ye,te);Xe!==-1&&(ye.splice(Xe,1),this.touchAction.update())}return this},on:function(te,ye){if(te!==W&&ye!==W){var Xe=this.handlers;return _t(Yr(te),function(It){Xe[It]=Xe[It]||[],Xe[It].push(ye)}),this}},off:function(te,ye){if(te!==W){var Xe=this.handlers;return _t(Yr(te),function(It){ye?Xe[It]&&Xe[It].splice(S(Xe[It],ye),1):delete Xe[It]}),this}},emit:function(te,ye){this.options.domEvents&&Ol(te,ye);var Xe=this.handlers[te]&&this.handlers[te].slice();if(!(!Xe||!Xe.length)){ye.type=te,ye.preventDefault=function(){ye.srcEvent.preventDefault()};for(var It=0;It<Xe.length;)Xe[It](ye),It++}},destroy:function(){this.element&&Ms(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Ms(te,ye){var Xe=te.element;if(!!Xe.style){var It;_t(te.options.cssProps,function(Or,On){It=ut(Xe.style,On),ye?(te.oldCssProps[It]=Xe.style[It],Xe.style[It]=Or):Xe.style[It]=te.oldCssProps[It]||""}),ye||(te.oldCssProps={})}}function Ol(te,ye){if(!ze){var Xe=g.createEvent("Event");Xe.initEvent(te,!0,!0),Xe.gesture=ye,ye.target.dispatchEvent(Xe)}}if(!ze){it(la,{INPUT_START:na,INPUT_MOVE:Ui,INPUT_END:Ii,INPUT_CANCEL:$i,STATE_POSSIBLE:Zi,STATE_BEGAN:Pr,STATE_CHANGED:on,STATE_ENDED:gt,STATE_RECOGNIZED:sa,STATE_CANCELLED:J,STATE_FAILED:Ko,DIRECTION_NONE:ia,DIRECTION_LEFT:qa,DIRECTION_RIGHT:aa,DIRECTION_UP:oa,DIRECTION_DOWN:Li,DIRECTION_HORIZONTAL:Ki,DIRECTION_VERTICAL:Hi,DIRECTION_ALL:Ts,Manager:Qa,Input:bo,TouchAction:Ta,TouchInput:Bt,MouseInput:ba,PointerEventInput:Me,TouchMouseInput:Mt,SingleTouchInput:Le,Recognizer:ta,AttrRecognizer:Ka,Tap:Do,Pan:ua,Swipe:vo,Pinch:Ao,Rotate:wu,Press:jo,on:$e,off:Ht,each:_t,merge:Y,extend:$t,assign:it,inherit:Xt,bindFn:at,prefixed:ut});var ys=typeof window!="undefined"?window:typeof self!="undefined"?self:{};ys.Hammer=la,Ce=function(){return la}.call(ne,Q,ne,Er),Ce!==W&&(Er.exports=Ce)}})(typeof window!="undefined"?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document,"Hammer")},88307:function(Er,ne,Q){(function(Ce,me){Er.exports=me(Q(18857))})(this,function(Ce){"use strict";var me=function(N){return N instanceof Uint8Array||N instanceof Uint16Array||N instanceof Uint32Array||N instanceof Int8Array||N instanceof Int16Array||N instanceof Int32Array||N instanceof Float32Array||N instanceof Float64Array||N instanceof Uint8ClampedArray},g=function(N,ce){for(var Be=Object.keys(ce),Dt=0;Dt<Be.length;++Dt)N[Be[Dt]]=ce[Be[Dt]];return N},Re=`
`;function W(N){return typeof atob!="undefined"?atob(N):"base64:"+N}function he(N){var ce=new Error("(regl) "+N);throw console.error(ce),ce}function de(N,ce){N||he(ce)}function ze(N){return N?": "+N:""}function _e(N,ce,Be){N in ce||he("unknown parameter ("+N+")"+ze(Be)+". possible values: "+Object.keys(ce).join())}function tt(N,ce){me(N)||he("invalid parameter type"+ze(ce)+". must be a typed array")}function mt(N,ce){switch(ce){case"number":return typeof N=="number";case"object":return typeof N=="object";case"string":return typeof N=="string";case"boolean":return typeof N=="boolean";case"function":return typeof N=="function";case"undefined":return typeof N=="undefined";case"symbol":return typeof N=="symbol"}}function wt(N,ce,Be){mt(N,ce)||he("invalid parameter type"+ze(Be)+". expected "+ce+", got "+typeof N)}function Nt(N,ce){N>=0&&(N|0)===N||he("invalid parameter type, ("+N+")"+ze(ce)+". must be a nonnegative integer")}function or(N,ce,Be){ce.indexOf(N)<0&&he("invalid value"+ze(Be)+". must be one of: "+ce)}var Tt=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Kt(N){Object.keys(N).forEach(function(ce){Tt.indexOf(ce)<0&&he('invalid regl constructor argument "'+ce+'". must be one of '+Tt)})}function _t(N,ce){for(N=N+"";N.length<ce;)N=" "+N;return N}function ct(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function it(N,ce){this.number=N,this.line=ce,this.errors=[]}function $t(N,ce,Be){this.file=N,this.line=ce,this.message=Be}function Y(){var N=new Error,ce=(N.stack||N).toString(),Be=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(ce);if(Be)return Be[1];var Dt=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(ce);return Dt?Dt[1]:"unknown"}function Xt(){var N=new Error,ce=(N.stack||N).toString(),Be=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(ce);if(Be)return Be[1];var Dt=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(ce);return Dt?Dt[1]:"unknown"}function at(N,ce){var Be=N.split(`
`),Dt=1,rr=0,Rt={unknown:new ct,0:new ct};Rt.unknown.name=Rt[0].name=ce||Y(),Rt.unknown.lines.push(new it(0,""));for(var Qt=0;Qt<Be.length;++Qt){var lr=Be[Qt],dr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(lr);if(dr)switch(dr[1]){case"line":var xr=/(\d+)(\s+\d+)?/.exec(dr[2]);xr&&(Dt=xr[1]|0,xr[2]&&(rr=xr[2]|0,rr in Rt||(Rt[rr]=new ct)));break;case"define":var wr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(dr[2]);wr&&(Rt[rr].name=wr[1]?W(wr[2]):wr[2]);break}Rt[rr].lines.push(new it(Dt++,lr))}return Object.keys(Rt).forEach(function(Tr){var jr=Rt[Tr];jr.lines.forEach(function(gr){jr.index[gr.number]=gr})}),Rt}function qe(N){var ce=[];return N.split(`
`).forEach(function(Be){if(!(Be.length<5)){var Dt=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(Be);Dt?ce.push(new $t(Dt[1]|0,Dt[2]|0,Dt[3].trim())):Be.length>0&&ce.push(new $t("unknown",0,Be))}}),ce}function Et(N,ce){ce.forEach(function(Be){var Dt=N[Be.file];if(Dt){var rr=Dt.index[Be.line];if(rr){rr.errors.push(Be),Dt.hasErrors=!0;return}}N.unknown.hasErrors=!0,N.unknown.lines[0].errors.push(Be)})}function $e(N,ce,Be,Dt,rr){if(!N.getShaderParameter(ce,N.COMPILE_STATUS)){var Rt=N.getShaderInfoLog(ce),Qt=Dt===N.FRAGMENT_SHADER?"fragment":"vertex";ke(Be,"string",Qt+" shader source must be a string",rr);var lr=at(Be,rr),dr=qe(Rt);Et(lr,dr),Object.keys(lr).forEach(function(xr){var wr=lr[xr];if(!wr.hasErrors)return;var Tr=[""],jr=[""];function gr(Cr,nt){Tr.push(Cr),jr.push(nt||"")}gr("file number "+xr+": "+wr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),wr.lines.forEach(function(Cr){if(Cr.errors.length>0){gr(_t(Cr.number,4)+"|  ","background-color:yellow; font-weight:bold"),gr(Cr.line+Re,"color:red; background-color:yellow; font-weight:bold");var nt=0;Cr.errors.forEach(function(Vt){var br=Vt.message,Nr=/^\s*'(.*)'\s*:\s*(.*)$/.exec(br);if(Nr){var ur=Nr[1];switch(br=Nr[2],ur){case"assign":ur="=";break}nt=Math.max(Cr.line.indexOf(ur,nt),0)}else nt=0;gr(_t("| ",6)),gr(_t("^^^",nt+3)+Re,"font-weight:bold"),gr(_t("| ",6)),gr(br+Re,"font-weight:bold")}),gr(_t("| ",6)+Re)}else gr(_t(Cr.number,4)+"|  "),gr(Cr.line+Re,"color:red")}),typeof document!="undefined"&&!window.chrome?(jr[0]=Tr.join("%c"),console.log.apply(console,jr)):console.log(Tr.join(""))}),de.raise("Error compiling "+Qt+" shader, "+lr[0].name)}}function Ht(N,ce,Be,Dt,rr){if(!N.getProgramParameter(ce,N.LINK_STATUS)){var Rt=N.getProgramInfoLog(ce),Qt=at(Be,rr),lr=at(Dt,rr),dr='Error linking program with vertex shader, "'+lr[0].name+'", and fragment shader "'+Qt[0].name+'"';typeof document!="undefined"?console.log("%c"+dr+Re+"%c"+Rt,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(dr+Re+Rt),de.raise(dr)}}function mr(N){N._commandRef=Y()}function Fr(N,ce,Be,Dt){mr(N);function rr(dr){return dr?Dt.id(dr):0}N._fragId=rr(N.static.frag),N._vertId=rr(N.static.vert);function Rt(dr,xr){Object.keys(xr).forEach(function(wr){dr[Dt.id(wr)]=!0})}var Qt=N._uniformSet={};Rt(Qt,ce.static),Rt(Qt,ce.dynamic);var lr=N._attributeSet={};Rt(lr,Be.static),Rt(lr,Be.dynamic),N._hasCount="count"in N.static||"count"in N.dynamic||"elements"in N.static||"elements"in N.dynamic}function Yr(N,ce){var Be=Xt();he(N+" in command "+(ce||Y())+(Be==="unknown"?"":" called from "+Be))}function S(N,ce,Be){N||Yr(ce,Be||Y())}function Se(N,ce,Be,Dt){N in ce||Yr("unknown parameter ("+N+")"+ze(Be)+". possible values: "+Object.keys(ce).join(),Dt||Y())}function ke(N,ce,Be,Dt){mt(N,ce)||Yr("invalid parameter type"+ze(Be)+". expected "+ce+", got "+typeof N,Dt||Y())}function ut(N){N()}function ft(N,ce,Be){N.texture?or(N.texture._texture.internalformat,ce,"unsupported texture format for attachment"):or(N.renderbuffer._renderbuffer.format,Be,"unsupported renderbuffer format for attachment")}var kt=33071,Ft=9728,yr=9984,Yn=9985,Gr=9986,Nn=9987,yn=5120,zn=5121,si=5122,Gn=5123,fi=5124,na=5125,Ui=5126,Ii=32819,$i=32820,ia=33635,qa=34042,aa=36193,oa={};oa[yn]=oa[zn]=1,oa[si]=oa[Gn]=oa[aa]=oa[ia]=oa[Ii]=oa[$i]=2,oa[fi]=oa[na]=oa[Ui]=oa[qa]=4;function Li(N,ce){return N===$i||N===Ii||N===ia?2:N===qa?4:oa[N]*ce}function Ki(N){return!(N&N-1)&&!!N}function Hi(N,ce,Be){var Dt,rr=ce.width,Rt=ce.height,Qt=ce.channels;de(rr>0&&rr<=Be.maxTextureSize&&Rt>0&&Rt<=Be.maxTextureSize,"invalid texture shape"),(N.wrapS!==kt||N.wrapT!==kt)&&de(Ki(rr)&&Ki(Rt),"incompatible wrap mode for texture, both width and height must be power of 2"),ce.mipmask===1?rr!==1&&Rt!==1&&de(N.minFilter!==yr&&N.minFilter!==Gr&&N.minFilter!==Yn&&N.minFilter!==Nn,"min filter requires mipmap"):(de(Ki(rr)&&Ki(Rt),"texture must be a square power of 2 to support mipmapping"),de(ce.mipmask===(rr<<1)-1,"missing or incomplete mipmap data")),ce.type===Ui&&(Be.extensions.indexOf("oes_texture_float_linear")<0&&de(N.minFilter===Ft&&N.magFilter===Ft,"filter not supported, must enable oes_texture_float_linear"),de(!N.genMipmaps,"mipmap generation not supported with float textures"));var lr=ce.images;for(Dt=0;Dt<16;++Dt)if(lr[Dt]){var dr=rr>>Dt,xr=Rt>>Dt;de(ce.mipmask&1<<Dt,"missing mipmap data");var wr=lr[Dt];if(de(wr.width===dr&&wr.height===xr,"invalid shape for mip images"),de(wr.format===ce.format&&wr.internalformat===ce.internalformat&&wr.type===ce.type,"incompatible type for mip image"),!wr.compressed)if(wr.data){var Tr=Math.ceil(Li(wr.type,Qt)*dr/wr.unpackAlignment)*wr.unpackAlignment;de(wr.data.byteLength===Tr*xr,"invalid data for image, buffer size is inconsistent with image format")}else wr.element||wr.copy}else N.genMipmaps||de((ce.mipmask&1<<Dt)==0,"extra mipmap data");ce.compressed&&de(!N.genMipmaps,"mipmap generation for compressed images not supported")}function Ts(N,ce,Be,Dt){var rr=N.width,Rt=N.height,Qt=N.channels;de(rr>0&&rr<=Dt.maxTextureSize&&Rt>0&&Rt<=Dt.maxTextureSize,"invalid texture shape"),de(rr===Rt,"cube map must be square"),de(ce.wrapS===kt&&ce.wrapT===kt,"wrap mode not supported by cube map");for(var lr=0;lr<Be.length;++lr){var dr=Be[lr];de(dr.width===rr&&dr.height===Rt,"inconsistent cube map face shape"),ce.genMipmaps&&(de(!dr.compressed,"can not generate mipmap for compressed textures"),de(dr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var xr=dr.images,wr=0;wr<16;++wr){var Tr=xr[wr];if(Tr){var jr=rr>>wr,gr=Rt>>wr;de(dr.mipmask&1<<wr,"missing mipmap data"),de(Tr.width===jr&&Tr.height===gr,"invalid shape for mip images"),de(Tr.format===N.format&&Tr.internalformat===N.internalformat&&Tr.type===N.type,"incompatible type for mip image"),Tr.compressed||(Tr.data?de(Tr.data.byteLength===jr*gr*Math.max(Li(Tr.type,Qt),Tr.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):Tr.element||Tr.copy)}}}}var fe=g(de,{optional:ut,raise:he,commandRaise:Yr,command:S,parameter:_e,commandParameter:Se,constructor:Kt,type:wt,commandType:ke,isTypedArray:tt,nni:Nt,oneOf:or,shaderError:$e,linkError:Ht,callSite:Xt,saveCommandRef:mr,saveDrawInfo:Fr,framebufferFormat:ft,guessCommand:Y,texture2D:Hi,textureCube:Ts}),ui=0,bo=0,cu=5,Zt=6;function er(N,ce){this.id=ui++,this.type=N,this.data=ce}function Rr(N){return N.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function an(N){if(N.length===0)return[];var ce=N.charAt(0),Be=N.charAt(N.length-1);if(N.length>1&&ce===Be&&(ce==='"'||ce==="'"))return['"'+Rr(N.substr(1,N.length-2))+'"'];var Dt=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(N);if(Dt)return an(N.substr(0,Dt.index)).concat(an(Dt[1])).concat(an(N.substr(Dt.index+Dt[0].length)));var rr=N.split(".");if(rr.length===1)return['"'+Rr(N)+'"'];for(var Rt=[],Qt=0;Qt<rr.length;++Qt)Rt=Rt.concat(an(rr[Qt]));return Rt}function Mn(N){return"["+an(N).join("][")+"]"}function Un(N,ce){return new er(N,Mn(ce+""))}function bi(N){return typeof N=="function"&&!N._reglType||N instanceof er}function vi(N,ce){if(typeof N=="function")return new er(bo,N);if(typeof N=="number"||typeof N=="boolean")return new er(cu,N);if(Array.isArray(N))return new er(Zt,N.map(function(Be,Dt){return vi(Be,ce+"["+Dt+"]")}));if(N instanceof er)return N;fe(!1,"invalid option type in uniform "+ce)}var Sn={DynamicVariable:er,define:Un,isDynamic:bi,unbox:vi,accessor:Mn},Di={next:typeof requestAnimationFrame=="function"?function(N){return requestAnimationFrame(N)}:function(N){return setTimeout(N,16)},cancel:typeof cancelAnimationFrame=="function"?function(N){return cancelAnimationFrame(N)}:clearTimeout},Ri=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,ao=Ri?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function gs(){var N={"":0},ce=[""];return{id:function(Be){var Dt=N[Be];return Dt||(Dt=N[Be]=ce.length,ce.push(Be),Dt)},str:function(Be){return ce[Be]}}}function Zo(N,ce,Be){var Dt=document.createElement("canvas");g(Dt.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),N.appendChild(Dt),N===document.body&&(Dt.style.position="absolute",g(N.style,{margin:0,padding:0}));function rr(){var lr=window.innerWidth,dr=window.innerHeight;if(N!==document.body){var xr=Dt.getBoundingClientRect();lr=xr.right-xr.left,dr=xr.bottom-xr.top}Dt.width=Be*lr,Dt.height=Be*dr}var Rt;N!==document.body&&typeof ResizeObserver=="function"?(Rt=new ResizeObserver(function(){setTimeout(rr)}),Rt.observe(N)):window.addEventListener("resize",rr,!1);function Qt(){Rt?Rt.disconnect():window.removeEventListener("resize",rr),N.removeChild(Dt)}return rr(),{canvas:Dt,onDestroy:Qt}}function Na(N,ce){function Be(Dt){try{return N.getContext(Dt,ce)}catch(rr){return null}}return Be("webgl")||Be("experimental-webgl")||Be("webgl-experimental")}function ba(N){return typeof N.nodeName=="string"&&typeof N.appendChild=="function"&&typeof N.getBoundingClientRect=="function"}function V(N){return typeof N.drawArrays=="function"||typeof N.drawElements=="function"}function $(N){return typeof N=="string"?N.split():(fe(Array.isArray(N),"invalid extension array"),N)}function re(N){return typeof N=="string"?(fe(typeof document!="undefined","not supported outside of DOM"),document.querySelector(N)):N}function pe(N){var ce=N||{},Be,Dt,rr,Rt,Qt={},lr=[],dr=[],xr=typeof window=="undefined"?1:window.devicePixelRatio,wr=!1,Tr=function(Cr){Cr&&fe.raise(Cr)},jr=function(){};if(typeof ce=="string"?(fe(typeof document!="undefined","selector queries only supported in DOM environments"),Be=document.querySelector(ce),fe(Be,"invalid query string for element")):typeof ce=="object"?ba(ce)?Be=ce:V(ce)?(Rt=ce,rr=Rt.canvas):(fe.constructor(ce),"gl"in ce?Rt=ce.gl:"canvas"in ce?rr=re(ce.canvas):"container"in ce&&(Dt=re(ce.container)),"attributes"in ce&&(Qt=ce.attributes,fe.type(Qt,"object","invalid context attributes")),"extensions"in ce&&(lr=$(ce.extensions)),"optionalExtensions"in ce&&(dr=$(ce.optionalExtensions)),"onDone"in ce&&(fe.type(ce.onDone,"function","invalid or missing onDone callback"),Tr=ce.onDone),"profile"in ce&&(wr=!!ce.profile),"pixelRatio"in ce&&(xr=+ce.pixelRatio,fe(xr>0,"invalid pixel ratio"))):fe.raise("invalid arguments to regl"),Be&&(Be.nodeName.toLowerCase()==="canvas"?rr=Be:Dt=Be),!Rt){if(!rr){fe(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var gr=Zo(Dt||document.body,Tr,xr);if(!gr)return null;rr=gr.canvas,jr=gr.onDestroy}Qt.premultipliedAlpha===void 0&&(Qt.premultipliedAlpha=!0),Rt=Na(rr,Qt)}return Rt?{gl:Rt,canvas:rr,container:Dt,extensions:lr,optionalExtensions:dr,pixelRatio:xr,profile:wr,onDone:Tr,onDestroy:jr}:(jr(),Tr("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Me(N,ce){var Be={};function Dt(lr){fe.type(lr,"string","extension name must be string");var dr=lr.toLowerCase(),xr;try{xr=Be[dr]=rr(lr)}catch(wr){}return!!xr}function rr(lr){return N.getExtension(lr)?N.getExtension(lr):N.getExtension(lr.toLowerCase())?N.getExtension(lr.toLowerCase()):null}for(var Rt=0;Rt<ce.extensions.length;++Rt){var Qt=ce.extensions[Rt];if(!Dt(Qt))return ce.onDestroy(),ce.onDone('"'+Qt+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return ce.optionalExtensions.forEach(Dt),{extensions:Be,restore:function(){Object.keys(Be).forEach(function(lr){if(Be[lr]&&!Dt(lr))throw new Error("(regl): error restoring extension "+lr)})}}}function Ge(N,ce){for(var Be=Array(N),Dt=0;Dt<N;++Dt)Be[Dt]=ce(Dt);return Be}var Qe=5120,se=5121,Le=5122,dt=5123,fr=5124,Lt=5125,Bt=5126;function hr(N){for(var ce=16;ce<=1<<28;ce*=16)if(N<=ce)return ce;return 0}function _n(N){var ce,Be;return ce=(N>65535)<<4,N>>>=ce,Be=(N>255)<<3,N>>>=Be,ce|=Be,Be=(N>15)<<2,N>>>=Be,ce|=Be,Be=(N>3)<<1,N>>>=Be,ce|=Be,ce|N>>1}function fn(){var N=Ge(8,function(){return[]});function ce(Rt){var Qt=hr(Rt),lr=N[_n(Qt)>>2];return lr.length>0?lr.pop():new ArrayBuffer(Qt)}function Be(Rt){N[_n(Rt.byteLength)>>2].push(Rt)}function Dt(Rt,Qt){var lr=null;switch(Rt){case Qe:lr=new Int8Array(ce(Qt),0,Qt);break;case se:lr=new Uint8Array(ce(Qt),0,Qt);break;case Le:lr=new Int16Array(ce(2*Qt),0,Qt);break;case dt:lr=new Uint16Array(ce(2*Qt),0,Qt);break;case fr:lr=new Int32Array(ce(4*Qt),0,Qt);break;case Lt:lr=new Uint32Array(ce(4*Qt),0,Qt);break;case Bt:lr=new Float32Array(ce(4*Qt),0,Qt);break;default:return null}return lr.length!==Qt?lr.subarray(0,Qt):lr}function rr(Rt){Be(Rt.buffer)}return{alloc:ce,free:Be,allocType:Dt,freeType:rr}}var Mt=fn();Mt.zero=fn();var Jr=3408,Br=3410,Wr=3411,mi=3412,en=3413,dn=3414,Wi=3415,hi=33901,wi=33902,_i=3379,ht=3386,Pt=34921,Ta=36347,Ei=36348,Ti=35661,Zi=35660,Pr=34930,on=36349,gt=34076,sa=34024,J=7936,Ko=7937,ta=7938,bu=35724,za=34047,Ma=36063,Ka=34852,ua=3553,Ao=34067,jo=34069,wu=33984,vo=6408,Do=5126,la=5121,$a=36160,Fo=36053,Qa=36064,Ms=16384,Ol=function(N,ce){var Be=1;ce.ext_texture_filter_anisotropic&&(Be=N.getParameter(za));var Dt=1,rr=1;ce.webgl_draw_buffers&&(Dt=N.getParameter(Ka),rr=N.getParameter(Ma));var Rt=!!ce.oes_texture_float;if(Rt){var Qt=N.createTexture();N.bindTexture(ua,Qt),N.texImage2D(ua,0,vo,1,1,0,vo,Do,null);var lr=N.createFramebuffer();if(N.bindFramebuffer($a,lr),N.framebufferTexture2D($a,Qa,ua,Qt,0),N.bindTexture(ua,null),N.checkFramebufferStatus($a)!==Fo)Rt=!1;else{N.viewport(0,0,1,1),N.clearColor(1,0,0,1),N.clear(Ms);var dr=Mt.allocType(Do,4);N.readPixels(0,0,1,1,vo,Do,dr),N.getError()?Rt=!1:(N.deleteFramebuffer(lr),N.deleteTexture(Qt),Rt=dr[0]===1),Mt.freeType(dr)}}var xr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),wr=!0;if(!xr){var Tr=N.createTexture(),jr=Mt.allocType(la,36);N.activeTexture(wu),N.bindTexture(Ao,Tr),N.texImage2D(jo,0,vo,3,3,0,vo,la,jr),Mt.freeType(jr),N.bindTexture(Ao,null),N.deleteTexture(Tr),wr=!N.getError()}return{colorBits:[N.getParameter(Br),N.getParameter(Wr),N.getParameter(mi),N.getParameter(en)],depthBits:N.getParameter(dn),stencilBits:N.getParameter(Wi),subpixelBits:N.getParameter(Jr),extensions:Object.keys(ce).filter(function(gr){return!!ce[gr]}),maxAnisotropic:Be,maxDrawbuffers:Dt,maxColorAttachments:rr,pointSizeDims:N.getParameter(hi),lineWidthDims:N.getParameter(wi),maxViewportDims:N.getParameter(ht),maxCombinedTextureUnits:N.getParameter(Ti),maxCubeMapSize:N.getParameter(gt),maxRenderbufferSize:N.getParameter(sa),maxTextureUnits:N.getParameter(Pr),maxTextureSize:N.getParameter(_i),maxAttributes:N.getParameter(Pt),maxVertexUniforms:N.getParameter(Ta),maxVertexTextureUnits:N.getParameter(Zi),maxVaryingVectors:N.getParameter(Ei),maxFragmentUniforms:N.getParameter(on),glsl:N.getParameter(bu),renderer:N.getParameter(Ko),vendor:N.getParameter(J),version:N.getParameter(ta),readFloat:Rt,npotTextureCube:wr}};function ys(N){return!!N&&typeof N=="object"&&Array.isArray(N.shape)&&Array.isArray(N.stride)&&typeof N.offset=="number"&&N.shape.length===N.stride.length&&(Array.isArray(N.data)||me(N.data))}var te=function(N){return Object.keys(N).map(function(ce){return N[ce]})},ye={shape:oo,flatten:Mi};function Xe(N,ce,Be){for(var Dt=0;Dt<ce;++Dt)Be[Dt]=N[Dt]}function It(N,ce,Be,Dt){for(var rr=0,Rt=0;Rt<ce;++Rt)for(var Qt=N[Rt],lr=0;lr<Be;++lr)Dt[rr++]=Qt[lr]}function Or(N,ce,Be,Dt,rr,Rt){for(var Qt=Rt,lr=0;lr<ce;++lr)for(var dr=N[lr],xr=0;xr<Be;++xr)for(var wr=dr[xr],Tr=0;Tr<Dt;++Tr)rr[Qt++]=wr[Tr]}function On(N,ce,Be,Dt,rr){for(var Rt=1,Qt=Be+1;Qt<ce.length;++Qt)Rt*=ce[Qt];var lr=ce[Be];if(ce.length-Be==4){var dr=ce[Be+1],xr=ce[Be+2],wr=ce[Be+3];for(Qt=0;Qt<lr;++Qt)Or(N[Qt],dr,xr,wr,Dt,rr),rr+=Rt}else for(Qt=0;Qt<lr;++Qt)On(N[Qt],ce,Be+1,Dt,rr),rr+=Rt}function Mi(N,ce,Be,Dt){var rr=1;if(ce.length)for(var Rt=0;Rt<ce.length;++Rt)rr*=ce[Rt];else rr=0;var Qt=Dt||Mt.allocType(Be,rr);switch(ce.length){case 0:break;case 1:Xe(N,ce[0],Qt);break;case 2:It(N,ce[0],ce[1],Qt);break;case 3:Or(N,ce[0],ce[1],ce[2],Qt,0);break;default:On(N,ce,0,Qt,0)}return Qt}function oo(N){for(var ce=[],Be=N;Be.length;Be=Be[0])ce.push(Be.length);return ce}var Ra={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Ua=5120,Vo=5122,_s=5124,lo=5121,wo=5123,xs=5125,Ps=5126,Fs=5126,fu={int8:Ua,int16:Vo,int32:_s,uint8:lo,uint16:wo,uint32:xs,float:Ps,float32:Fs},bs=35048,ga=35040,xa={dynamic:bs,stream:ga,static:35044},is=ye.flatten,mf=ye.shape,Il=35044,qs=35040,ac=5121,Yu=5126,Ks=[];Ks[5120]=1,Ks[5122]=2,Ks[5124]=4,Ks[5121]=1,Ks[5123]=2,Ks[5125]=4,Ks[5126]=4;function ul(N){return Ra[Object.prototype.toString.call(N)]|0}function _(N,ce){for(var Be=0;Be<ce.length;++Be)N[Be]=ce[Be]}function M(N,ce,Be,Dt,rr,Rt,Qt){for(var lr=0,dr=0;dr<Be;++dr)for(var xr=0;xr<Dt;++xr)N[lr++]=ce[rr*dr+Rt*xr+Qt]}function B(N,ce,Be,Dt){var rr=0,Rt={};function Qt(nt){this.id=rr++,this.buffer=N.createBuffer(),this.type=nt,this.usage=Il,this.byteLength=0,this.dimension=1,this.dtype=ac,this.persistentData=null,Be.profile&&(this.stats={size:0})}Qt.prototype.bind=function(){N.bindBuffer(this.type,this.buffer)},Qt.prototype.destroy=function(){jr(this)};var lr=[];function dr(nt,Vt){var br=lr.pop();return br||(br=new Qt(nt)),br.bind(),Tr(br,Vt,qs,0,1,!1),br}function xr(nt){lr.push(nt)}function wr(nt,Vt,br){nt.byteLength=Vt.byteLength,N.bufferData(nt.type,Vt,br)}function Tr(nt,Vt,br,Nr,ur,Ir){var $r;if(nt.usage=br,Array.isArray(Vt)){if(nt.dtype=Nr||Yu,Vt.length>0){var Bn;if(Array.isArray(Vt[0])){$r=mf(Vt);for(var Jt=1,tr=1;tr<$r.length;++tr)Jt*=$r[tr];nt.dimension=Jt,Bn=is(Vt,$r,nt.dtype),wr(nt,Bn,br),Ir?nt.persistentData=Bn:Mt.freeType(Bn)}else if(typeof Vt[0]=="number"){nt.dimension=ur;var xn=Mt.allocType(nt.dtype,Vt.length);_(xn,Vt),wr(nt,xn,br),Ir?nt.persistentData=xn:Mt.freeType(xn)}else me(Vt[0])?(nt.dimension=Vt[0].length,nt.dtype=Nr||ul(Vt[0])||Yu,Bn=is(Vt,[Vt.length,Vt[0].length],nt.dtype),wr(nt,Bn,br),Ir?nt.persistentData=Bn:Mt.freeType(Bn)):fe.raise("invalid buffer data")}}else if(me(Vt))nt.dtype=Nr||ul(Vt),nt.dimension=ur,wr(nt,Vt,br),Ir&&(nt.persistentData=new Uint8Array(new Uint8Array(Vt.buffer)));else if(ys(Vt)){$r=Vt.shape;var Vr=Vt.stride,Sr=Vt.offset,qr=0,Kr=0,gi=0,ai=0;$r.length===1?(qr=$r[0],Kr=1,gi=Vr[0],ai=0):$r.length===2?(qr=$r[0],Kr=$r[1],gi=Vr[0],ai=Vr[1]):fe.raise("invalid shape"),nt.dtype=Nr||ul(Vt.data)||Yu,nt.dimension=Kr;var Hr=Mt.allocType(nt.dtype,qr*Kr);M(Hr,Vt.data,qr,Kr,gi,ai,Sr),wr(nt,Hr,br),Ir?nt.persistentData=Hr:Mt.freeType(Hr)}else Vt instanceof ArrayBuffer?(nt.dtype=ac,nt.dimension=ur,wr(nt,Vt,br),Ir&&(nt.persistentData=new Uint8Array(new Uint8Array(Vt)))):fe.raise("invalid buffer data")}function jr(nt){ce.bufferCount--,Dt(nt);var Vt=nt.buffer;fe(Vt,"buffer must not be deleted already"),N.deleteBuffer(Vt),nt.buffer=null,delete Rt[nt.id]}function gr(nt,Vt,br,Nr){ce.bufferCount++;var ur=new Qt(Vt);Rt[ur.id]=ur;function Ir(Jt){var tr=Il,xn=null,Vr=0,Sr=0,qr=1;return Array.isArray(Jt)||me(Jt)||ys(Jt)||Jt instanceof ArrayBuffer?xn=Jt:typeof Jt=="number"?Vr=Jt|0:Jt&&(fe.type(Jt,"object","buffer arguments must be an object, a number or an array"),"data"in Jt&&(fe(xn===null||Array.isArray(xn)||me(xn)||ys(xn),"invalid data for buffer"),xn=Jt.data),"usage"in Jt&&(fe.parameter(Jt.usage,xa,"invalid buffer usage"),tr=xa[Jt.usage]),"type"in Jt&&(fe.parameter(Jt.type,fu,"invalid buffer type"),Sr=fu[Jt.type]),"dimension"in Jt&&(fe.type(Jt.dimension,"number","invalid dimension"),qr=Jt.dimension|0),"length"in Jt&&(fe.nni(Vr,"buffer length must be a nonnegative integer"),Vr=Jt.length|0)),ur.bind(),xn?Tr(ur,xn,tr,Sr,qr,Nr):(Vr&&N.bufferData(ur.type,Vr,tr),ur.dtype=Sr||ac,ur.usage=tr,ur.dimension=qr,ur.byteLength=Vr),Be.profile&&(ur.stats.size=ur.byteLength*Ks[ur.dtype]),Ir}function $r(Jt,tr){fe(tr+Jt.byteLength<=ur.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+Jt.byteLength+" starting from offset "+tr+" to a buffer of size "+ur.byteLength),N.bufferSubData(ur.type,tr,Jt)}function Bn(Jt,tr){var xn=(tr||0)|0,Vr;if(ur.bind(),me(Jt)||Jt instanceof ArrayBuffer)$r(Jt,xn);else if(Array.isArray(Jt)){if(Jt.length>0)if(typeof Jt[0]=="number"){var Sr=Mt.allocType(ur.dtype,Jt.length);_(Sr,Jt),$r(Sr,xn),Mt.freeType(Sr)}else if(Array.isArray(Jt[0])||me(Jt[0])){Vr=mf(Jt);var qr=is(Jt,Vr,ur.dtype);$r(qr,xn),Mt.freeType(qr)}else fe.raise("invalid buffer data")}else if(ys(Jt)){Vr=Jt.shape;var Kr=Jt.stride,gi=0,ai=0,Hr=0,rn=0;Vr.length===1?(gi=Vr[0],ai=1,Hr=Kr[0],rn=0):Vr.length===2?(gi=Vr[0],ai=Vr[1],Hr=Kr[0],rn=Kr[1]):fe.raise("invalid shape");var Qn=Array.isArray(Jt.data)?ur.dtype:ul(Jt.data),ci=Mt.allocType(Qn,gi*ai);M(ci,Jt.data,gi,ai,Hr,rn,Jt.offset),$r(ci,xn),Mt.freeType(ci)}else fe.raise("invalid data for buffer subdata");return Ir}return br||Ir(nt),Ir._reglType="buffer",Ir._buffer=ur,Ir.subdata=Bn,Be.profile&&(Ir.stats=ur.stats),Ir.destroy=function(){jr(ur)},Ir}function Cr(){te(Rt).forEach(function(nt){nt.buffer=N.createBuffer(),N.bindBuffer(nt.type,nt.buffer),N.bufferData(nt.type,nt.persistentData||nt.byteLength,nt.usage)})}return Be.profile&&(ce.getTotalBufferSize=function(){var nt=0;return Object.keys(Rt).forEach(function(Vt){nt+=Rt[Vt].stats.size}),nt}),{create:gr,createStream:dr,destroyStream:xr,clear:function(){te(Rt).forEach(jr),lr.forEach(jr)},getBuffer:function(nt){return nt&&nt._buffer instanceof Qt?nt._buffer:null},restore:Cr,_initBuffer:Tr}}var R=0,K=0,ge=1,He=1,lt=4,pt=4,nr={points:R,point:K,lines:ge,line:He,triangles:lt,triangle:pt,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},sr=0,Pn=1,ni=4,Rn=5120,Xi=5121,va=5122,Ca=5123,Vi=5124,Es=5125,hu=34963,qu=35040,gf=35044;function ll(N,ce,Be,Dt){var rr={},Rt=0,Qt={uint8:Xi,uint16:Ca};ce.oes_element_index_uint&&(Qt.uint32=Es);function lr(Cr){this.id=Rt++,rr[this.id]=this,this.buffer=Cr,this.primType=ni,this.vertCount=0,this.type=0}lr.prototype.bind=function(){this.buffer.bind()};var dr=[];function xr(Cr){var nt=dr.pop();return nt||(nt=new lr(Be.create(null,hu,!0,!1)._buffer)),Tr(nt,Cr,qu,-1,-1,0,0),nt}function wr(Cr){dr.push(Cr)}function Tr(Cr,nt,Vt,br,Nr,ur,Ir){Cr.buffer.bind();var $r;if(nt){var Bn=Ir;!Ir&&(!me(nt)||ys(nt)&&!me(nt.data))&&(Bn=ce.oes_element_index_uint?Es:Ca),Be._initBuffer(Cr.buffer,nt,Vt,Bn,3)}else N.bufferData(hu,ur,Vt),Cr.buffer.dtype=$r||Xi,Cr.buffer.usage=Vt,Cr.buffer.dimension=3,Cr.buffer.byteLength=ur;if($r=Ir,!Ir){switch(Cr.buffer.dtype){case Xi:case Rn:$r=Xi;break;case Ca:case va:$r=Ca;break;case Es:case Vi:$r=Es;break;default:fe.raise("unsupported type for element array")}Cr.buffer.dtype=$r}Cr.type=$r,fe($r!==Es||!!ce.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var Jt=Nr;Jt<0&&(Jt=Cr.buffer.byteLength,$r===Ca?Jt>>=1:$r===Es&&(Jt>>=2)),Cr.vertCount=Jt;var tr=br;if(br<0){tr=ni;var xn=Cr.buffer.dimension;xn===1&&(tr=sr),xn===2&&(tr=Pn),xn===3&&(tr=ni)}Cr.primType=tr}function jr(Cr){Dt.elementsCount--,fe(Cr.buffer!==null,"must not double destroy elements"),delete rr[Cr.id],Cr.buffer.destroy(),Cr.buffer=null}function gr(Cr,nt){var Vt=Be.create(null,hu,!0),br=new lr(Vt._buffer);Dt.elementsCount++;function Nr(ur){if(!ur)Vt(),br.primType=ni,br.vertCount=0,br.type=Xi;else if(typeof ur=="number")Vt(ur),br.primType=ni,br.vertCount=ur|0,br.type=Xi;else{var Ir=null,$r=gf,Bn=-1,Jt=-1,tr=0,xn=0;Array.isArray(ur)||me(ur)||ys(ur)?Ir=ur:(fe.type(ur,"object","invalid arguments for elements"),"data"in ur&&(Ir=ur.data,fe(Array.isArray(Ir)||me(Ir)||ys(Ir),"invalid data for element buffer")),"usage"in ur&&(fe.parameter(ur.usage,xa,"invalid element buffer usage"),$r=xa[ur.usage]),"primitive"in ur&&(fe.parameter(ur.primitive,nr,"invalid element buffer primitive"),Bn=nr[ur.primitive]),"count"in ur&&(fe(typeof ur.count=="number"&&ur.count>=0,"invalid vertex count for elements"),Jt=ur.count|0),"type"in ur&&(fe.parameter(ur.type,Qt,"invalid buffer type"),xn=Qt[ur.type]),"length"in ur?tr=ur.length|0:(tr=Jt,xn===Ca||xn===va?tr*=2:(xn===Es||xn===Vi)&&(tr*=4))),Tr(br,Ir,$r,Bn,Jt,tr,xn)}return Nr}return Nr(Cr),Nr._reglType="elements",Nr._elements=br,Nr.subdata=function(ur,Ir){return Vt.subdata(ur,Ir),Nr},Nr.destroy=function(){jr(br)},Nr}return{create:gr,createStream:xr,destroyStream:wr,getElements:function(Cr){return typeof Cr=="function"&&Cr._elements instanceof lr?Cr._elements:null},clear:function(){te(rr).forEach(jr)}}}var Bc=new Float32Array(1),Tu=new Uint32Array(Bc.buffer),Mu=5123;function Pu(N){for(var ce=Mt.allocType(Mu,N.length),Be=0;Be<N.length;++Be)if(isNaN(N[Be]))ce[Be]=65535;else if(N[Be]===Infinity)ce[Be]=31744;else if(N[Be]===-Infinity)ce[Be]=64512;else{Bc[0]=N[Be];var Dt=Tu[0],rr=Dt>>>31<<15,Rt=(Dt<<1>>>24)-127,Qt=Dt>>13&(1<<10)-1;if(Rt<-24)ce[Be]=rr;else if(Rt<-14){var lr=-14-Rt;ce[Be]=rr+(Qt+(1<<10)>>lr)}else Rt>15?ce[Be]=rr+31744:ce[Be]=rr+(Rt+15<<10)+Qt}return ce}function co(N){return Array.isArray(N)||me(N)}var Gf=function(N){return!(N&N-1)&&!!N},Hf=34467,$o=3553,Nc=34067,Ou=34069,pu=6408,yf=6406,Rl=6407,Bi=6409,kl=6410,Mh=32854,cl=32855,zc=36194,Wf=32819,Ph=32820,Xf=33635,Uc=34042,oc=6402,sc=34041,Ll=35904,fl=35906,Dl=36193,Ku=33776,$s=33777,_f=33778,xf=33779,Yf=35986,du=35987,uc=34798,Zc=35840,bf=35841,Fl=35842,hp=35843,Ef=36196,Bl=5121,Sf=5123,Cf=5125,Nl=5126,jc=10242,Oh=10243,Ih=10497,lc=33071,Rh=33648,zl=10240,Qi=10241,cc=9728,ha=9729,Iu=9984,Yi=9985,Pa=9986,Ss=9987,Vc=33170,$u=4352,Za=4353,fc=4354,Ul=34046,Qu=3317,Gc=37440,Ru=37441,mo=37443,Zl=37444,hc=33984,go=[Iu,Pa,Yi,Ss],vn=[0,Bi,kl,Rl,pu],fo={};fo[Bi]=fo[yf]=fo[oc]=1,fo[sc]=fo[kl]=2,fo[Rl]=fo[Ll]=3,fo[pu]=fo[fl]=4;function Ju(N){return"[object "+N+"]"}var ka=Ju("HTMLCanvasElement"),Qs=Ju("OffscreenCanvas"),Os=Ju("CanvasRenderingContext2D"),Af=Ju("ImageBitmap"),Zr=Ju("HTMLImageElement"),pc=Ju("HTMLVideoElement"),wf=Object.keys(Ra).concat([ka,Qs,Os,Af,Zr,pc]),hl=[];hl[Bl]=1,hl[Nl]=4,hl[Dl]=2,hl[Sf]=2,hl[Cf]=4;var Aa=[];Aa[Mh]=2,Aa[cl]=2,Aa[zc]=2,Aa[sc]=4,Aa[Ku]=.5,Aa[$s]=.5,Aa[_f]=1,Aa[xf]=1,Aa[Yf]=.5,Aa[du]=1,Aa[uc]=1,Aa[Zc]=.5,Aa[bf]=.25,Aa[Fl]=.5,Aa[hp]=.25,Aa[Ef]=.5;function Cs(N){return Array.isArray(N)&&(N.length===0||typeof N[0]=="number")}function Tf(N){if(!Array.isArray(N))return!1;var ce=N.length;return!(ce===0||!co(N[0]))}function ku(N){return Object.prototype.toString.call(N)}function Bs(N){return ku(N)===ka}function Lu(N){return ku(N)===Qs}function qf(N){return ku(N)===Os}function pl(N){return ku(N)===Af}function Kf(N){return ku(N)===Zr}function Mf(N){return ku(N)===pc}function vu(N){var ce=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(ce&&N&&N.getContext)}function Is(N){var ce=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(ce&&N&&"src"in N&&"crossOrigin"in N)}function Ai(N){if(!N)return!1;if(vu(N)||Is(N))return!0;var ce=ku(N);return wf.indexOf(ce)>=0?!0:Cs(N)||Tf(N)||ys(N)}function Du(N){return Ra[Object.prototype.toString.call(N)]|0}function mu(N,ce){var Be=ce.length;switch(N.type){case Bl:case Sf:case Cf:case Nl:var Dt=Mt.allocType(N.type,Be);Dt.set(ce),N.data=Dt;break;case Dl:N.data=Pu(ce);break;default:fe.raise("unsupported texture type, must specify a typed array")}}function Go(N,ce){return Mt.allocType(N.type===Dl?Nl:N.type,ce)}function dl(N,ce){N.type===Dl?(N.data=Pu(ce),Mt.freeType(ce)):N.data=ce}function as(N,ce,Be,Dt,rr,Rt){for(var Qt=N.width,lr=N.height,dr=N.channels,xr=Qt*lr*dr,wr=Go(N,xr),Tr=0,jr=0;jr<lr;++jr)for(var gr=0;gr<Qt;++gr)for(var Cr=0;Cr<dr;++Cr)wr[Tr++]=ce[Be*gr+Dt*jr+rr*Cr+Rt];dl(N,wr)}function Js(N,ce,Be,Dt,rr,Rt){var Qt;if(typeof Aa[N]!="undefined"?Qt=Aa[N]:Qt=fo[N]*hl[ce],Rt&&(Qt*=6),rr){for(var lr=0,dr=Be;dr>=1;)lr+=Qt*dr*dr,dr/=2;return lr}else return Qt*Be*Dt}function As(N,ce,Be,Dt,rr,Rt,Qt){var lr={"don't care":$u,"dont care":$u,nice:fc,fast:Za},dr={repeat:Ih,clamp:lc,mirror:Rh},xr={nearest:cc,linear:ha},wr=g({mipmap:Ss,"nearest mipmap nearest":Iu,"linear mipmap nearest":Yi,"nearest mipmap linear":Pa,"linear mipmap linear":Ss},xr),Tr={none:0,browser:Zl},jr={uint8:Bl,rgba4:Wf,rgb565:Xf,"rgb5 a1":Ph},gr={alpha:yf,luminance:Bi,"luminance alpha":kl,rgb:Rl,rgba:pu,rgba4:Mh,"rgb5 a1":cl,rgb565:zc},Cr={};ce.ext_srgb&&(gr.srgb=Ll,gr.srgba=fl),ce.oes_texture_float&&(jr.float32=jr.float=Nl),ce.oes_texture_half_float&&(jr.float16=jr["half float"]=Dl),ce.webgl_depth_texture&&(g(gr,{depth:oc,"depth stencil":sc}),g(jr,{uint16:Sf,uint32:Cf,"depth stencil":Uc})),ce.webgl_compressed_texture_s3tc&&g(Cr,{"rgb s3tc dxt1":Ku,"rgba s3tc dxt1":$s,"rgba s3tc dxt3":_f,"rgba s3tc dxt5":xf}),ce.webgl_compressed_texture_atc&&g(Cr,{"rgb atc":Yf,"rgba atc explicit alpha":du,"rgba atc interpolated alpha":uc}),ce.webgl_compressed_texture_pvrtc&&g(Cr,{"rgb pvrtc 4bppv1":Zc,"rgb pvrtc 2bppv1":bf,"rgba pvrtc 4bppv1":Fl,"rgba pvrtc 2bppv1":hp}),ce.webgl_compressed_texture_etc1&&(Cr["rgb etc1"]=Ef);var nt=Array.prototype.slice.call(N.getParameter(Hf)||new Uint32Array(0));Object.keys(Cr).forEach(function(we){var zt=Cr[we];nt.indexOf(zt)>=0&&(gr[we]=zt)});var Vt=Object.keys(gr);Be.textureFormats=Vt;var br=[];Object.keys(gr).forEach(function(we){var zt=gr[we];br[zt]=we});var Nr=[];Object.keys(jr).forEach(function(we){var zt=jr[we];Nr[zt]=we});var ur=[];Object.keys(xr).forEach(function(we){var zt=xr[we];ur[zt]=we});var Ir=[];Object.keys(wr).forEach(function(we){var zt=wr[we];Ir[zt]=we});var $r=[];Object.keys(dr).forEach(function(we){var zt=dr[we];$r[zt]=we});var Bn=Vt.reduce(function(we,zt){var St=gr[zt];return St===Bi||St===yf||St===Bi||St===kl||St===oc||St===sc||ce.ext_srgb&&(St===Ll||St===fl)?we[St]=St:St===cl||zt.indexOf("rgba")>=0?we[St]=pu:we[St]=Rl,we},{});function Jt(){this.internalformat=pu,this.format=pu,this.type=Bl,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Zl,this.width=0,this.height=0,this.channels=0}function tr(we,zt){we.internalformat=zt.internalformat,we.format=zt.format,we.type=zt.type,we.compressed=zt.compressed,we.premultiplyAlpha=zt.premultiplyAlpha,we.flipY=zt.flipY,we.unpackAlignment=zt.unpackAlignment,we.colorSpace=zt.colorSpace,we.width=zt.width,we.height=zt.height,we.channels=zt.channels}function xn(we,zt){if(!(typeof zt!="object"||!zt)){if("premultiplyAlpha"in zt&&(fe.type(zt.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),we.premultiplyAlpha=zt.premultiplyAlpha),"flipY"in zt&&(fe.type(zt.flipY,"boolean","invalid texture flip"),we.flipY=zt.flipY),"alignment"in zt&&(fe.oneOf(zt.alignment,[1,2,4,8],"invalid texture unpack alignment"),we.unpackAlignment=zt.alignment),"colorSpace"in zt&&(fe.parameter(zt.colorSpace,Tr,"invalid colorSpace"),we.colorSpace=Tr[zt.colorSpace]),"type"in zt){var St=zt.type;fe(ce.oes_texture_float||!(St==="float"||St==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),fe(ce.oes_texture_half_float||!(St==="half float"||St==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),fe(ce.webgl_depth_texture||!(St==="uint16"||St==="uint32"||St==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),fe.parameter(St,jr,"invalid texture type"),we.type=jr[St]}var mn=we.width,Gi=we.height,Ee=we.channels,ae=!1;"shape"in zt?(fe(Array.isArray(zt.shape)&&zt.shape.length>=2,"shape must be an array"),mn=zt.shape[0],Gi=zt.shape[1],zt.shape.length===3&&(Ee=zt.shape[2],fe(Ee>0&&Ee<=4,"invalid number of channels"),ae=!0),fe(mn>=0&&mn<=Be.maxTextureSize,"invalid width"),fe(Gi>=0&&Gi<=Be.maxTextureSize,"invalid height")):("radius"in zt&&(mn=Gi=zt.radius,fe(mn>=0&&mn<=Be.maxTextureSize,"invalid radius")),"width"in zt&&(mn=zt.width,fe(mn>=0&&mn<=Be.maxTextureSize,"invalid width")),"height"in zt&&(Gi=zt.height,fe(Gi>=0&&Gi<=Be.maxTextureSize,"invalid height")),"channels"in zt&&(Ee=zt.channels,fe(Ee>0&&Ee<=4,"invalid number of channels"),ae=!0)),we.width=mn|0,we.height=Gi|0,we.channels=Ee|0;var Ve=!1;if("format"in zt){var ot=zt.format;fe(ce.webgl_depth_texture||!(ot==="depth"||ot==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),fe.parameter(ot,gr,"invalid texture format");var Ot=we.internalformat=gr[ot];we.format=Bn[Ot],ot in jr&&("type"in zt||(we.type=jr[ot])),ot in Cr&&(we.compressed=!0),Ve=!0}!ae&&Ve?we.channels=fo[we.format]:ae&&!Ve?we.channels!==vn[we.format]&&(we.format=we.internalformat=vn[we.channels]):Ve&&ae&&fe(we.channels===fo[we.format],"number of channels inconsistent with specified format")}}function Vr(we){N.pixelStorei(Gc,we.flipY),N.pixelStorei(Ru,we.premultiplyAlpha),N.pixelStorei(mo,we.colorSpace),N.pixelStorei(Qu,we.unpackAlignment)}function Sr(){Jt.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function qr(we,zt){var St=null;if(Ai(zt)?St=zt:zt&&(fe.type(zt,"object","invalid pixel data type"),xn(we,zt),"x"in zt&&(we.xOffset=zt.x|0),"y"in zt&&(we.yOffset=zt.y|0),Ai(zt.data)&&(St=zt.data)),fe(!we.compressed||St instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),zt.copy){fe(!St,"can not specify copy and data field for the same texture");var mn=rr.viewportWidth,Gi=rr.viewportHeight;we.width=we.width||mn-we.xOffset,we.height=we.height||Gi-we.yOffset,we.needsCopy=!0,fe(we.xOffset>=0&&we.xOffset<mn&&we.yOffset>=0&&we.yOffset<Gi&&we.width>0&&we.width<=mn&&we.height>0&&we.height<=Gi,"copy texture read out of bounds")}else if(!St)we.width=we.width||1,we.height=we.height||1,we.channels=we.channels||4;else if(me(St))we.channels=we.channels||4,we.data=St,!("type"in zt)&&we.type===Bl&&(we.type=Du(St));else if(Cs(St))we.channels=we.channels||4,mu(we,St),we.alignment=1,we.needsFree=!0;else if(ys(St)){var Ee=St.data;!Array.isArray(Ee)&&we.type===Bl&&(we.type=Du(Ee));var ae=St.shape,Ve=St.stride,ot,Ot,Ye,De,Je,ve;ae.length===3?(Ye=ae[2],ve=Ve[2]):(fe(ae.length===2,"invalid ndarray pixel data, must be 2 or 3D"),Ye=1,ve=1),ot=ae[0],Ot=ae[1],De=Ve[0],Je=Ve[1],we.alignment=1,we.width=ot,we.height=Ot,we.channels=Ye,we.format=we.internalformat=vn[Ye],we.needsFree=!0,as(we,Ee,De,Je,ve,St.offset)}else if(vu(St)||Bs(St)||Lu(St)||qf(St))vu(St)||Bs(St)||Lu(St)?we.element=St:we.element=St.canvas,we.width=we.element.width,we.height=we.element.height,we.channels=4;else if(pl(St))we.element=St,we.width=St.width,we.height=St.height,we.channels=4;else if(Kf(St))we.element=St,we.width=St.naturalWidth,we.height=St.naturalHeight,we.channels=4;else if(Is(St))we.element=St,we.width=St.width,we.height=St.height,we.channels=4;else if(Mf(St))we.element=St,we.width=St.videoWidth,we.height=St.videoHeight,we.channels=4;else if(Tf(St)){var Ze=we.width||St[0].length,Ae=we.height||St.length,st=we.channels;co(St[0][0])?st=st||St[0][0].length:st=st||1;for(var At=ye.shape(St),cr=1,zr=0;zr<At.length;++zr)cr*=At[zr];var Ur=Go(we,cr);ye.flatten(St,At,"",Ur),dl(we,Ur),we.alignment=1,we.width=Ze,we.height=Ae,we.channels=st,we.format=we.internalformat=vn[st],we.needsFree=!0}we.type===Nl?fe(Be.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):we.type===Dl&&fe(Be.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Kr(we,zt,St){var mn=we.element,Gi=we.data,Ee=we.internalformat,ae=we.format,Ve=we.type,ot=we.width,Ot=we.height;Vr(we),mn?N.texImage2D(zt,St,ae,ae,Ve,mn):we.compressed?N.compressedTexImage2D(zt,St,Ee,ot,Ot,0,Gi):we.needsCopy?(Dt(),N.copyTexImage2D(zt,St,ae,we.xOffset,we.yOffset,ot,Ot,0)):N.texImage2D(zt,St,ae,ot,Ot,0,ae,Ve,Gi||null)}function gi(we,zt,St,mn,Gi){var Ee=we.element,ae=we.data,Ve=we.internalformat,ot=we.format,Ot=we.type,Ye=we.width,De=we.height;Vr(we),Ee?N.texSubImage2D(zt,Gi,St,mn,ot,Ot,Ee):we.compressed?N.compressedTexSubImage2D(zt,Gi,St,mn,Ve,Ye,De,ae):we.needsCopy?(Dt(),N.copyTexSubImage2D(zt,Gi,St,mn,we.xOffset,we.yOffset,Ye,De)):N.texSubImage2D(zt,Gi,St,mn,Ye,De,ot,Ot,ae)}var ai=[];function Hr(){return ai.pop()||new Sr}function rn(we){we.needsFree&&Mt.freeType(we.data),Sr.call(we),ai.push(we)}function Qn(){Jt.call(this),this.genMipmaps=!1,this.mipmapHint=$u,this.mipmask=0,this.images=Array(16)}function ci(we,zt,St){var mn=we.images[0]=Hr();we.mipmask=1,mn.width=we.width=zt,mn.height=we.height=St,mn.channels=we.channels=4}function Ni(we,zt){var St=null;if(Ai(zt))St=we.images[0]=Hr(),tr(St,we),qr(St,zt),we.mipmask=1;else if(xn(we,zt),Array.isArray(zt.mipmap))for(var mn=zt.mipmap,Gi=0;Gi<mn.length;++Gi)St=we.images[Gi]=Hr(),tr(St,we),St.width>>=Gi,St.height>>=Gi,qr(St,mn[Gi]),we.mipmask|=1<<Gi;else St=we.images[0]=Hr(),tr(St,we),qr(St,zt),we.mipmask=1;tr(we,we.images[0]),we.compressed&&(we.internalformat===Ku||we.internalformat===$s||we.internalformat===_f||we.internalformat===xf)&&fe(we.width%4==0&&we.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function so(we,zt){for(var St=we.images,mn=0;mn<St.length;++mn){if(!St[mn])return;Kr(St[mn],zt,mn)}}var uo=[];function Fi(){var we=uo.pop()||new Qn;Jt.call(we),we.mipmask=0;for(var zt=0;zt<16;++zt)we.images[zt]=null;return we}function ts(we){for(var zt=we.images,St=0;St<zt.length;++St)zt[St]&&rn(zt[St]),zt[St]=null;uo.push(we)}function ja(){this.minFilter=cc,this.magFilter=cc,this.wrapS=lc,this.wrapT=lc,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=$u}function No(we,zt){if("min"in zt){var St=zt.min;fe.parameter(St,wr),we.minFilter=wr[St],go.indexOf(we.minFilter)>=0&&!("faces"in zt)&&(we.genMipmaps=!0)}if("mag"in zt){var mn=zt.mag;fe.parameter(mn,xr),we.magFilter=xr[mn]}var Gi=we.wrapS,Ee=we.wrapT;if("wrap"in zt){var ae=zt.wrap;typeof ae=="string"?(fe.parameter(ae,dr),Gi=Ee=dr[ae]):Array.isArray(ae)&&(fe.parameter(ae[0],dr),fe.parameter(ae[1],dr),Gi=dr[ae[0]],Ee=dr[ae[1]])}else{if("wrapS"in zt){var Ve=zt.wrapS;fe.parameter(Ve,dr),Gi=dr[Ve]}if("wrapT"in zt){var ot=zt.wrapT;fe.parameter(ot,dr),Ee=dr[ot]}}if(we.wrapS=Gi,we.wrapT=Ee,"anisotropic"in zt){var Ot=zt.anisotropic;fe(typeof Ot=="number"&&Ot>=1&&Ot<=Be.maxAnisotropic,"aniso samples must be between 1 and "),we.anisotropic=zt.anisotropic}if("mipmap"in zt){var Ye=!1;switch(typeof zt.mipmap){case"string":fe.parameter(zt.mipmap,lr,"invalid mipmap hint"),we.mipmapHint=lr[zt.mipmap],we.genMipmaps=!0,Ye=!0;break;case"boolean":Ye=we.genMipmaps=zt.mipmap;break;case"object":fe(Array.isArray(zt.mipmap),"invalid mipmap type"),we.genMipmaps=!1,Ye=!0;break;default:fe.raise("invalid mipmap type")}Ye&&!("min"in zt)&&(we.minFilter=Iu)}}function So(we,zt){N.texParameteri(zt,Qi,we.minFilter),N.texParameteri(zt,zl,we.magFilter),N.texParameteri(zt,jc,we.wrapS),N.texParameteri(zt,Oh,we.wrapT),ce.ext_texture_filter_anisotropic&&N.texParameteri(zt,Ul,we.anisotropic),we.genMipmaps&&(N.hint(Vc,we.mipmapHint),N.generateMipmap(zt))}var Wo=0,Oo={},cs=Be.maxTextureUnits,po=Array(cs).map(function(){return null});function yi(we){Jt.call(this),this.mipmask=0,this.internalformat=pu,this.id=Wo++,this.refCount=1,this.target=we,this.texture=N.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new ja,Qt.profile&&(this.stats={size:0})}function Io(we){N.activeTexture(hc),N.bindTexture(we.target,we.texture)}function Ji(){var we=po[0];we?N.bindTexture(we.target,we.texture):N.bindTexture($o,null)}function zo(we){var zt=we.texture;fe(zt,"must not double destroy texture");var St=we.unit,mn=we.target;St>=0&&(N.activeTexture(hc+St),N.bindTexture(mn,null),po[St]=null),N.deleteTexture(zt),we.texture=null,we.params=null,we.pixels=null,we.refCount=0,delete Oo[we.id],Rt.textureCount--}g(yi.prototype,{bind:function(){var we=this;we.bindCount+=1;var zt=we.unit;if(zt<0){for(var St=0;St<cs;++St){var mn=po[St];if(mn){if(mn.bindCount>0)continue;mn.unit=-1}po[St]=we,zt=St;break}zt>=cs&&fe.raise("insufficient number of texture units"),Qt.profile&&Rt.maxTextureUnits<zt+1&&(Rt.maxTextureUnits=zt+1),we.unit=zt,N.activeTexture(hc+zt),N.bindTexture(we.target,we.texture)}return zt},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&zo(this)}});function ti(we,zt){var St=new yi($o);Oo[St.id]=St,Rt.textureCount++;function mn(ae,Ve){var ot=St.texInfo;ja.call(ot);var Ot=Fi();return typeof ae=="number"?typeof Ve=="number"?ci(Ot,ae|0,Ve|0):ci(Ot,ae|0,ae|0):ae?(fe.type(ae,"object","invalid arguments to regl.texture"),No(ot,ae),Ni(Ot,ae)):ci(Ot,1,1),ot.genMipmaps&&(Ot.mipmask=(Ot.width<<1)-1),St.mipmask=Ot.mipmask,tr(St,Ot),fe.texture2D(ot,Ot,Be),St.internalformat=Ot.internalformat,mn.width=Ot.width,mn.height=Ot.height,Io(St),so(Ot,$o),So(ot,$o),Ji(),ts(Ot),Qt.profile&&(St.stats.size=Js(St.internalformat,St.type,Ot.width,Ot.height,ot.genMipmaps,!1)),mn.format=br[St.internalformat],mn.type=Nr[St.type],mn.mag=ur[ot.magFilter],mn.min=Ir[ot.minFilter],mn.wrapS=$r[ot.wrapS],mn.wrapT=$r[ot.wrapT],mn}function Gi(ae,Ve,ot,Ot){fe(!!ae,"must specify image data");var Ye=Ve|0,De=ot|0,Je=Ot|0,ve=Hr();return tr(ve,St),ve.width=0,ve.height=0,qr(ve,ae),ve.width=ve.width||(St.width>>Je)-Ye,ve.height=ve.height||(St.height>>Je)-De,fe(St.type===ve.type&&St.format===ve.format&&St.internalformat===ve.internalformat,"incompatible format for texture.subimage"),fe(Ye>=0&&De>=0&&Ye+ve.width<=St.width&&De+ve.height<=St.height,"texture.subimage write out of bounds"),fe(St.mipmask&1<<Je,"missing mipmap data"),fe(ve.data||ve.element||ve.needsCopy,"missing image data"),Io(St),gi(ve,$o,Ye,De,Je),Ji(),rn(ve),mn}function Ee(ae,Ve){var ot=ae|0,Ot=Ve|0||ot;if(ot===St.width&&Ot===St.height)return mn;mn.width=St.width=ot,mn.height=St.height=Ot,Io(St);for(var Ye=0;St.mipmask>>Ye;++Ye){var De=ot>>Ye,Je=Ot>>Ye;if(!De||!Je)break;N.texImage2D($o,Ye,St.format,De,Je,0,St.format,St.type,null)}return Ji(),Qt.profile&&(St.stats.size=Js(St.internalformat,St.type,ot,Ot,!1,!1)),mn}return mn(we,zt),mn.subimage=Gi,mn.resize=Ee,mn._reglType="texture2d",mn._texture=St,Qt.profile&&(mn.stats=St.stats),mn.destroy=function(){St.decRef()},mn}function zi(we,zt,St,mn,Gi,Ee){var ae=new yi(Nc);Oo[ae.id]=ae,Rt.cubeCount++;var Ve=new Array(6);function ot(De,Je,ve,Ze,Ae,st){var At,cr=ae.texInfo;for(ja.call(cr),At=0;At<6;++At)Ve[At]=Fi();if(typeof De=="number"||!De){var zr=De|0||1;for(At=0;At<6;++At)ci(Ve[At],zr,zr)}else if(typeof De=="object")if(Je)Ni(Ve[0],De),Ni(Ve[1],Je),Ni(Ve[2],ve),Ni(Ve[3],Ze),Ni(Ve[4],Ae),Ni(Ve[5],st);else if(No(cr,De),xn(ae,De),"faces"in De){var Ur=De.faces;for(fe(Array.isArray(Ur)&&Ur.length===6,"cube faces must be a length 6 array"),At=0;At<6;++At)fe(typeof Ur[At]=="object"&&!!Ur[At],"invalid input for cube map face"),tr(Ve[At],ae),Ni(Ve[At],Ur[At])}else for(At=0;At<6;++At)Ni(Ve[At],De);else fe.raise("invalid arguments to cube map");for(tr(ae,Ve[0]),fe.optional(function(){Be.npotTextureCube||fe(Gf(ae.width)&&Gf(ae.height),"your browser does not support non power or two texture dimensions")}),cr.genMipmaps?ae.mipmask=(Ve[0].width<<1)-1:ae.mipmask=Ve[0].mipmask,fe.textureCube(ae,cr,Ve,Be),ae.internalformat=Ve[0].internalformat,ot.width=Ve[0].width,ot.height=Ve[0].height,Io(ae),At=0;At<6;++At)so(Ve[At],Ou+At);for(So(cr,Nc),Ji(),Qt.profile&&(ae.stats.size=Js(ae.internalformat,ae.type,ot.width,ot.height,cr.genMipmaps,!0)),ot.format=br[ae.internalformat],ot.type=Nr[ae.type],ot.mag=ur[cr.magFilter],ot.min=Ir[cr.minFilter],ot.wrapS=$r[cr.wrapS],ot.wrapT=$r[cr.wrapT],At=0;At<6;++At)ts(Ve[At]);return ot}function Ot(De,Je,ve,Ze,Ae){fe(!!Je,"must specify image data"),fe(typeof De=="number"&&De===(De|0)&&De>=0&&De<6,"invalid face");var st=ve|0,At=Ze|0,cr=Ae|0,zr=Hr();return tr(zr,ae),zr.width=0,zr.height=0,qr(zr,Je),zr.width=zr.width||(ae.width>>cr)-st,zr.height=zr.height||(ae.height>>cr)-At,fe(ae.type===zr.type&&ae.format===zr.format&&ae.internalformat===zr.internalformat,"incompatible format for texture.subimage"),fe(st>=0&&At>=0&&st+zr.width<=ae.width&&At+zr.height<=ae.height,"texture.subimage write out of bounds"),fe(ae.mipmask&1<<cr,"missing mipmap data"),fe(zr.data||zr.element||zr.needsCopy,"missing image data"),Io(ae),gi(zr,Ou+De,st,At,cr),Ji(),rn(zr),ot}function Ye(De){var Je=De|0;if(Je!==ae.width){ot.width=ae.width=Je,ot.height=ae.height=Je,Io(ae);for(var ve=0;ve<6;++ve)for(var Ze=0;ae.mipmask>>Ze;++Ze)N.texImage2D(Ou+ve,Ze,ae.format,Je>>Ze,Je>>Ze,0,ae.format,ae.type,null);return Ji(),Qt.profile&&(ae.stats.size=Js(ae.internalformat,ae.type,ot.width,ot.height,!1,!0)),ot}}return ot(we,zt,St,mn,Gi,Ee),ot.subimage=Ot,ot.resize=Ye,ot._reglType="textureCube",ot._texture=ae,Qt.profile&&(ot.stats=ae.stats),ot.destroy=function(){ae.decRef()},ot}function ma(){for(var we=0;we<cs;++we)N.activeTexture(hc+we),N.bindTexture($o,null),po[we]=null;te(Oo).forEach(zo),Rt.cubeCount=0,Rt.textureCount=0}Qt.profile&&(Rt.getTotalTextureSize=function(){var we=0;return Object.keys(Oo).forEach(function(zt){we+=Oo[zt].stats.size}),we});function Ln(){for(var we=0;we<cs;++we){var zt=po[we];zt&&(zt.bindCount=0,zt.unit=-1,po[we]=null)}te(Oo).forEach(function(St){St.texture=N.createTexture(),N.bindTexture(St.target,St.texture);for(var mn=0;mn<32;++mn)if((St.mipmask&1<<mn)!=0)if(St.target===$o)N.texImage2D($o,mn,St.internalformat,St.width>>mn,St.height>>mn,0,St.internalformat,St.type,null);else for(var Gi=0;Gi<6;++Gi)N.texImage2D(Ou+Gi,mn,St.internalformat,St.width>>mn,St.height>>mn,0,St.internalformat,St.type,null);So(St.texInfo,St.target)})}function ri(){for(var we=0;we<cs;++we){var zt=po[we];zt&&(zt.bindCount=0,zt.unit=-1,po[we]=null),N.activeTexture(hc+we),N.bindTexture($o,null),N.bindTexture(Nc,null)}}return{create2D:ti,createCube:zi,clear:ma,getTexture:function(we){return null},restore:Ln,refresh:ri}}var Eu=36161,In=32854,Cn=32855,Hc=36194,Qo=33189,eu=36168,Ho=34041,gu=35907,$f=34836,Wc=34842,ya=34843,La=[];La[In]=2,La[Cn]=2,La[Hc]=2,La[Qo]=2,La[eu]=1,La[Ho]=4,La[gu]=4,La[$f]=16,La[Wc]=8,La[ya]=6;function vl(N,ce,Be){return La[N]*ce*Be}var dc=function(N,ce,Be,Dt,rr){var Rt={rgba4:In,rgb565:Hc,"rgb5 a1":Cn,depth:Qo,stencil:eu,"depth stencil":Ho};ce.ext_srgb&&(Rt.srgba=gu),ce.ext_color_buffer_half_float&&(Rt.rgba16f=Wc,Rt.rgb16f=ya),ce.webgl_color_buffer_float&&(Rt.rgba32f=$f);var Qt=[];Object.keys(Rt).forEach(function(gr){var Cr=Rt[gr];Qt[Cr]=gr});var lr=0,dr={};function xr(gr){this.id=lr++,this.refCount=1,this.renderbuffer=gr,this.format=In,this.width=0,this.height=0,rr.profile&&(this.stats={size:0})}xr.prototype.decRef=function(){--this.refCount<=0&&wr(this)};function wr(gr){var Cr=gr.renderbuffer;fe(Cr,"must not double destroy renderbuffer"),N.bindRenderbuffer(Eu,null),N.deleteRenderbuffer(Cr),gr.renderbuffer=null,gr.refCount=0,delete dr[gr.id],Dt.renderbufferCount--}function Tr(gr,Cr){var nt=new xr(N.createRenderbuffer());dr[nt.id]=nt,Dt.renderbufferCount++;function Vt(Nr,ur){var Ir=0,$r=0,Bn=In;if(typeof Nr=="object"&&Nr){var Jt=Nr;if("shape"in Jt){var tr=Jt.shape;fe(Array.isArray(tr)&&tr.length>=2,"invalid renderbuffer shape"),Ir=tr[0]|0,$r=tr[1]|0}else"radius"in Jt&&(Ir=$r=Jt.radius|0),"width"in Jt&&(Ir=Jt.width|0),"height"in Jt&&($r=Jt.height|0);"format"in Jt&&(fe.parameter(Jt.format,Rt,"invalid renderbuffer format"),Bn=Rt[Jt.format])}else typeof Nr=="number"?(Ir=Nr|0,typeof ur=="number"?$r=ur|0:$r=Ir):Nr?fe.raise("invalid arguments to renderbuffer constructor"):Ir=$r=1;if(fe(Ir>0&&$r>0&&Ir<=Be.maxRenderbufferSize&&$r<=Be.maxRenderbufferSize,"invalid renderbuffer size"),!(Ir===nt.width&&$r===nt.height&&Bn===nt.format))return Vt.width=nt.width=Ir,Vt.height=nt.height=$r,nt.format=Bn,N.bindRenderbuffer(Eu,nt.renderbuffer),N.renderbufferStorage(Eu,Bn,Ir,$r),fe(N.getError()===0,"invalid render buffer format"),rr.profile&&(nt.stats.size=vl(nt.format,nt.width,nt.height)),Vt.format=Qt[nt.format],Vt}function br(Nr,ur){var Ir=Nr|0,$r=ur|0||Ir;return Ir===nt.width&&$r===nt.height||(fe(Ir>0&&$r>0&&Ir<=Be.maxRenderbufferSize&&$r<=Be.maxRenderbufferSize,"invalid renderbuffer size"),Vt.width=nt.width=Ir,Vt.height=nt.height=$r,N.bindRenderbuffer(Eu,nt.renderbuffer),N.renderbufferStorage(Eu,nt.format,Ir,$r),fe(N.getError()===0,"invalid render buffer format"),rr.profile&&(nt.stats.size=vl(nt.format,nt.width,nt.height))),Vt}return Vt(gr,Cr),Vt.resize=br,Vt._reglType="renderbuffer",Vt._renderbuffer=nt,rr.profile&&(Vt.stats=nt.stats),Vt.destroy=function(){nt.decRef()},Vt}rr.profile&&(Dt.getTotalRenderbufferSize=function(){var gr=0;return Object.keys(dr).forEach(function(Cr){gr+=dr[Cr].stats.size}),gr});function jr(){te(dr).forEach(function(gr){gr.renderbuffer=N.createRenderbuffer(),N.bindRenderbuffer(Eu,gr.renderbuffer),N.renderbufferStorage(Eu,gr.format,gr.width,gr.height)}),N.bindRenderbuffer(Eu,null)}return{create:Tr,clear:function(){te(dr).forEach(wr)},restore:jr}},Ns=36160,yu=36161,pi=3553,zs=34069,os=36064,jl=36096,Fu=36128,el=33306,Xc=36053,Da=36054,tu=36055,Vl=36057,ml=36061,gl=36193,Yc=5121,yl=5126,ru=6407,vc=6408,Gl=6402,Qf=[ru,vc],Hl=[];Hl[vc]=4,Hl[ru]=3;var l=[];l[Yc]=1,l[yl]=4,l[gl]=2;var h=32854,c=32855,d=36194,E=33189,w=36168,P=34041,L=35907,U=34836,H=34842,oe=34843,ue=[h,c,d,L,H,oe,U],le={};le[Xc]="complete",le[Da]="incomplete attachment",le[Vl]="incomplete dimensions",le[tu]="incomplete, missing attachment",le[ml]="unsupported";function Ie(N,ce,Be,Dt,rr,Rt){var Qt={cur:null,next:null,dirty:!1,setFBO:null},lr=["rgba"],dr=["rgba4","rgb565","rgb5 a1"];ce.ext_srgb&&dr.push("srgba"),ce.ext_color_buffer_half_float&&dr.push("rgba16f","rgb16f"),ce.webgl_color_buffer_float&&dr.push("rgba32f");var xr=["uint8"];ce.oes_texture_half_float&&xr.push("half float","float16"),ce.oes_texture_float&&xr.push("float","float32");function wr(Sr,qr,Kr){this.target=Sr,this.texture=qr,this.renderbuffer=Kr;var gi=0,ai=0;qr?(gi=qr.width,ai=qr.height):Kr&&(gi=Kr.width,ai=Kr.height),this.width=gi,this.height=ai}function Tr(Sr){Sr&&(Sr.texture&&Sr.texture._texture.decRef(),Sr.renderbuffer&&Sr.renderbuffer._renderbuffer.decRef())}function jr(Sr,qr,Kr){if(!!Sr)if(Sr.texture){var gi=Sr.texture._texture,ai=Math.max(1,gi.width),Hr=Math.max(1,gi.height);fe(ai===qr&&Hr===Kr,"inconsistent width/height for supplied texture"),gi.refCount+=1}else{var rn=Sr.renderbuffer._renderbuffer;fe(rn.width===qr&&rn.height===Kr,"inconsistent width/height for renderbuffer"),rn.refCount+=1}}function gr(Sr,qr){qr&&(qr.texture?N.framebufferTexture2D(Ns,Sr,qr.target,qr.texture._texture.texture,0):N.framebufferRenderbuffer(Ns,Sr,yu,qr.renderbuffer._renderbuffer.renderbuffer))}function Cr(Sr){var qr=pi,Kr=null,gi=null,ai=Sr;typeof Sr=="object"&&(ai=Sr.data,"target"in Sr&&(qr=Sr.target|0)),fe.type(ai,"function","invalid attachment data");var Hr=ai._reglType;return Hr==="texture2d"?(Kr=ai,fe(qr===pi)):Hr==="textureCube"?(Kr=ai,fe(qr>=zs&&qr<zs+6,"invalid cube map target")):Hr==="renderbuffer"?(gi=ai,qr=yu):fe.raise("invalid regl object for attachment"),new wr(qr,Kr,gi)}function nt(Sr,qr,Kr,gi,ai){if(Kr){var Hr=Dt.create2D({width:Sr,height:qr,format:gi,type:ai});return Hr._texture.refCount=0,new wr(pi,Hr,null)}else{var rn=rr.create({width:Sr,height:qr,format:gi});return rn._renderbuffer.refCount=0,new wr(yu,null,rn)}}function Vt(Sr){return Sr&&(Sr.texture||Sr.renderbuffer)}function br(Sr,qr,Kr){Sr&&(Sr.texture?Sr.texture.resize(qr,Kr):Sr.renderbuffer&&Sr.renderbuffer.resize(qr,Kr),Sr.width=qr,Sr.height=Kr)}var Nr=0,ur={};function Ir(){this.id=Nr++,ur[this.id]=this,this.framebuffer=N.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function $r(Sr){Sr.colorAttachments.forEach(Tr),Tr(Sr.depthAttachment),Tr(Sr.stencilAttachment),Tr(Sr.depthStencilAttachment)}function Bn(Sr){var qr=Sr.framebuffer;fe(qr,"must not double destroy framebuffer"),N.deleteFramebuffer(qr),Sr.framebuffer=null,Rt.framebufferCount--,delete ur[Sr.id]}function Jt(Sr){var qr;N.bindFramebuffer(Ns,Sr.framebuffer);var Kr=Sr.colorAttachments;for(qr=0;qr<Kr.length;++qr)gr(os+qr,Kr[qr]);for(qr=Kr.length;qr<Be.maxColorAttachments;++qr)N.framebufferTexture2D(Ns,os+qr,pi,null,0);N.framebufferTexture2D(Ns,el,pi,null,0),N.framebufferTexture2D(Ns,jl,pi,null,0),N.framebufferTexture2D(Ns,Fu,pi,null,0),gr(jl,Sr.depthAttachment),gr(Fu,Sr.stencilAttachment),gr(el,Sr.depthStencilAttachment);var gi=N.checkFramebufferStatus(Ns);!N.isContextLost()&&gi!==Xc&&fe.raise("framebuffer configuration not supported, status = "+le[gi]),N.bindFramebuffer(Ns,Qt.next?Qt.next.framebuffer:null),Qt.cur=Qt.next,N.getError()}function tr(Sr,qr){var Kr=new Ir;Rt.framebufferCount++;function gi(Hr,rn){var Qn;fe(Qt.next!==Kr,"can not update framebuffer which is currently in use");var ci=0,Ni=0,so=!0,uo=!0,Fi=null,ts=!0,ja="rgba",No="uint8",So=1,Wo=null,Oo=null,cs=null,po=!1;if(typeof Hr=="number")ci=Hr|0,Ni=rn|0||ci;else if(!Hr)ci=Ni=1;else{fe.type(Hr,"object","invalid arguments for framebuffer");var yi=Hr;if("shape"in yi){var Io=yi.shape;fe(Array.isArray(Io)&&Io.length>=2,"invalid shape for framebuffer"),ci=Io[0],Ni=Io[1]}else"radius"in yi&&(ci=Ni=yi.radius),"width"in yi&&(ci=yi.width),"height"in yi&&(Ni=yi.height);("color"in yi||"colors"in yi)&&(Fi=yi.color||yi.colors,Array.isArray(Fi)&&fe(Fi.length===1||ce.webgl_draw_buffers,"multiple render targets not supported")),Fi||("colorCount"in yi&&(So=yi.colorCount|0,fe(So>0,"invalid color buffer count")),"colorTexture"in yi&&(ts=!!yi.colorTexture,ja="rgba4"),"colorType"in yi&&(No=yi.colorType,ts?(fe(ce.oes_texture_float||!(No==="float"||No==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),fe(ce.oes_texture_half_float||!(No==="half float"||No==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):No==="half float"||No==="float16"?(fe(ce.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),ja="rgba16f"):(No==="float"||No==="float32")&&(fe(ce.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),ja="rgba32f"),fe.oneOf(No,xr,"invalid color type")),"colorFormat"in yi&&(ja=yi.colorFormat,lr.indexOf(ja)>=0?ts=!0:dr.indexOf(ja)>=0?ts=!1:fe.optional(function(){ts?fe.oneOf(yi.colorFormat,lr,"invalid color format for texture"):fe.oneOf(yi.colorFormat,dr,"invalid color format for renderbuffer")}))),("depthTexture"in yi||"depthStencilTexture"in yi)&&(po=!!(yi.depthTexture||yi.depthStencilTexture),fe(!po||ce.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in yi&&(typeof yi.depth=="boolean"?so=yi.depth:(Wo=yi.depth,uo=!1)),"stencil"in yi&&(typeof yi.stencil=="boolean"?uo=yi.stencil:(Oo=yi.stencil,so=!1)),"depthStencil"in yi&&(typeof yi.depthStencil=="boolean"?so=uo=yi.depthStencil:(cs=yi.depthStencil,so=!1,uo=!1))}var Ji=null,zo=null,ti=null,zi=null;if(Array.isArray(Fi))Ji=Fi.map(Cr);else if(Fi)Ji=[Cr(Fi)];else for(Ji=new Array(So),Qn=0;Qn<So;++Qn)Ji[Qn]=nt(ci,Ni,ts,ja,No);fe(ce.webgl_draw_buffers||Ji.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),fe(Ji.length<=Be.maxColorAttachments,"too many color attachments, not supported"),ci=ci||Ji[0].width,Ni=Ni||Ji[0].height,Wo?zo=Cr(Wo):so&&!uo&&(zo=nt(ci,Ni,po,"depth","uint32")),Oo?ti=Cr(Oo):uo&&!so&&(ti=nt(ci,Ni,!1,"stencil","uint8")),cs?zi=Cr(cs):!Wo&&!Oo&&uo&&so&&(zi=nt(ci,Ni,po,"depth stencil","depth stencil")),fe(!!Wo+!!Oo+!!cs<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var ma=null;for(Qn=0;Qn<Ji.length;++Qn)if(jr(Ji[Qn],ci,Ni),fe(!Ji[Qn]||Ji[Qn].texture&&Qf.indexOf(Ji[Qn].texture._texture.format)>=0||Ji[Qn].renderbuffer&&ue.indexOf(Ji[Qn].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Qn+" is invalid"),Ji[Qn]&&Ji[Qn].texture){var Ln=Hl[Ji[Qn].texture._texture.format]*l[Ji[Qn].texture._texture.type];ma===null?ma=Ln:fe(ma===Ln,"all color attachments much have the same number of bits per pixel.")}return jr(zo,ci,Ni),fe(!zo||zo.texture&&zo.texture._texture.format===Gl||zo.renderbuffer&&zo.renderbuffer._renderbuffer.format===E,"invalid depth attachment for framebuffer object"),jr(ti,ci,Ni),fe(!ti||ti.renderbuffer&&ti.renderbuffer._renderbuffer.format===w,"invalid stencil attachment for framebuffer object"),jr(zi,ci,Ni),fe(!zi||zi.texture&&zi.texture._texture.format===P||zi.renderbuffer&&zi.renderbuffer._renderbuffer.format===P,"invalid depth-stencil attachment for framebuffer object"),$r(Kr),Kr.width=ci,Kr.height=Ni,Kr.colorAttachments=Ji,Kr.depthAttachment=zo,Kr.stencilAttachment=ti,Kr.depthStencilAttachment=zi,gi.color=Ji.map(Vt),gi.depth=Vt(zo),gi.stencil=Vt(ti),gi.depthStencil=Vt(zi),gi.width=Kr.width,gi.height=Kr.height,Jt(Kr),gi}function ai(Hr,rn){fe(Qt.next!==Kr,"can not resize a framebuffer which is currently in use");var Qn=Math.max(Hr|0,1),ci=Math.max(rn|0||Qn,1);if(Qn===Kr.width&&ci===Kr.height)return gi;for(var Ni=Kr.colorAttachments,so=0;so<Ni.length;++so)br(Ni[so],Qn,ci);return br(Kr.depthAttachment,Qn,ci),br(Kr.stencilAttachment,Qn,ci),br(Kr.depthStencilAttachment,Qn,ci),Kr.width=gi.width=Qn,Kr.height=gi.height=ci,Jt(Kr),gi}return gi(Sr,qr),g(gi,{resize:ai,_reglType:"framebuffer",_framebuffer:Kr,destroy:function(){Bn(Kr),$r(Kr)},use:function(Hr){Qt.setFBO({framebuffer:gi},Hr)}})}function xn(Sr){var qr=Array(6);function Kr(ai){var Hr;fe(qr.indexOf(Qt.next)<0,"can not update framebuffer which is currently in use");var rn={color:null},Qn=0,ci=null,Ni="rgba",so="uint8",uo=1;if(typeof ai=="number")Qn=ai|0;else if(!ai)Qn=1;else{fe.type(ai,"object","invalid arguments for framebuffer");var Fi=ai;if("shape"in Fi){var ts=Fi.shape;fe(Array.isArray(ts)&&ts.length>=2,"invalid shape for framebuffer"),fe(ts[0]===ts[1],"cube framebuffer must be square"),Qn=ts[0]}else"radius"in Fi&&(Qn=Fi.radius|0),"width"in Fi?(Qn=Fi.width|0,"height"in Fi&&fe(Fi.height===Qn,"must be square")):"height"in Fi&&(Qn=Fi.height|0);("color"in Fi||"colors"in Fi)&&(ci=Fi.color||Fi.colors,Array.isArray(ci)&&fe(ci.length===1||ce.webgl_draw_buffers,"multiple render targets not supported")),ci||("colorCount"in Fi&&(uo=Fi.colorCount|0,fe(uo>0,"invalid color buffer count")),"colorType"in Fi&&(fe.oneOf(Fi.colorType,xr,"invalid color type"),so=Fi.colorType),"colorFormat"in Fi&&(Ni=Fi.colorFormat,fe.oneOf(Fi.colorFormat,lr,"invalid color format for texture"))),"depth"in Fi&&(rn.depth=Fi.depth),"stencil"in Fi&&(rn.stencil=Fi.stencil),"depthStencil"in Fi&&(rn.depthStencil=Fi.depthStencil)}var ja;if(ci)if(Array.isArray(ci))for(ja=[],Hr=0;Hr<ci.length;++Hr)ja[Hr]=ci[Hr];else ja=[ci];else{ja=Array(uo);var No={radius:Qn,format:Ni,type:so};for(Hr=0;Hr<uo;++Hr)ja[Hr]=Dt.createCube(No)}for(rn.color=Array(ja.length),Hr=0;Hr<ja.length;++Hr){var So=ja[Hr];fe(typeof So=="function"&&So._reglType==="textureCube","invalid cube map"),Qn=Qn||So.width,fe(So.width===Qn&&So.height===Qn,"invalid cube map shape"),rn.color[Hr]={target:zs,data:ja[Hr]}}for(Hr=0;Hr<6;++Hr){for(var Wo=0;Wo<ja.length;++Wo)rn.color[Wo].target=zs+Hr;Hr>0&&(rn.depth=qr[0].depth,rn.stencil=qr[0].stencil,rn.depthStencil=qr[0].depthStencil),qr[Hr]?qr[Hr](rn):qr[Hr]=tr(rn)}return g(Kr,{width:Qn,height:Qn,color:ja})}function gi(ai){var Hr,rn=ai|0;if(fe(rn>0&&rn<=Be.maxCubeMapSize,"invalid radius for cube fbo"),rn===Kr.width)return Kr;var Qn=Kr.color;for(Hr=0;Hr<Qn.length;++Hr)Qn[Hr].resize(rn);for(Hr=0;Hr<6;++Hr)qr[Hr].resize(rn);return Kr.width=Kr.height=rn,Kr}return Kr(Sr),g(Kr,{faces:qr,resize:gi,_reglType:"framebufferCube",destroy:function(){qr.forEach(function(ai){ai.destroy()})}})}function Vr(){Qt.cur=null,Qt.next=null,Qt.dirty=!0,te(ur).forEach(function(Sr){Sr.framebuffer=N.createFramebuffer(),Jt(Sr)})}return g(Qt,{getFramebuffer:function(Sr){if(typeof Sr=="function"&&Sr._reglType==="framebuffer"){var qr=Sr._framebuffer;if(qr instanceof Ir)return qr}return null},create:tr,createCube:xn,clear:function(){te(ur).forEach(Bn)},restore:Vr})}var Pe=5126,Ne=34962,xe=34963,je=["attributes","elements","offset","count","primitive","instances"];function Ke(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Pe,this.offset=0,this.stride=0,this.divisor=0}function vt(N,ce,Be,Dt,rr,Rt,Qt){for(var lr=Be.maxAttributes,dr=new Array(lr),xr=0;xr<lr;++xr)dr[xr]=new Ke;var wr=0,Tr={},jr={Record:Ke,scope:{},state:dr,currentVAO:null,targetVAO:null,restore:Cr()?$r:function(){},createVAO:Bn,getVAO:Vt,destroyBuffer:gr,setVAO:Cr()?br:Nr,clear:Cr()?ur:function(){}};function gr(Jt){for(var tr=0;tr<dr.length;++tr){var xn=dr[tr];xn.buffer===Jt&&(N.disableVertexAttribArray(tr),xn.buffer=null)}}function Cr(){return ce.oes_vertex_array_object}function nt(){return ce.angle_instanced_arrays}function Vt(Jt){return typeof Jt=="function"&&Jt._vao?Jt._vao:null}function br(Jt){if(Jt!==jr.currentVAO){var tr=Cr();Jt?tr.bindVertexArrayOES(Jt.vao):tr.bindVertexArrayOES(null),jr.currentVAO=Jt}}function Nr(Jt){if(Jt!==jr.currentVAO){if(Jt)Jt.bindAttrs();else{for(var tr=nt(),xn=0;xn<dr.length;++xn){var Vr=dr[xn];Vr.buffer?(N.enableVertexAttribArray(xn),Vr.buffer.bind(),N.vertexAttribPointer(xn,Vr.size,Vr.type,Vr.normalized,Vr.stride,Vr.offfset),tr&&Vr.divisor&&tr.vertexAttribDivisorANGLE(xn,Vr.divisor)):(N.disableVertexAttribArray(xn),N.vertexAttrib4f(xn,Vr.x,Vr.y,Vr.z,Vr.w))}Qt.elements?N.bindBuffer(xe,Qt.elements.buffer.buffer):N.bindBuffer(xe,null)}jr.currentVAO=Jt}}function ur(){te(Tr).forEach(function(Jt){Jt.destroy()})}function Ir(){this.id=++wr,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var Jt=Cr();Jt?this.vao=Jt.createVertexArrayOES():this.vao=null,Tr[this.id]=this,this.buffers=[]}Ir.prototype.bindAttrs=function(){for(var Jt=nt(),tr=this.attributes,xn=0;xn<tr.length;++xn){var Vr=tr[xn];Vr.buffer?(N.enableVertexAttribArray(xn),N.bindBuffer(Ne,Vr.buffer.buffer),N.vertexAttribPointer(xn,Vr.size,Vr.type,Vr.normalized,Vr.stride,Vr.offset),Jt&&Vr.divisor&&Jt.vertexAttribDivisorANGLE(xn,Vr.divisor)):(N.disableVertexAttribArray(xn),N.vertexAttrib4f(xn,Vr.x,Vr.y,Vr.z,Vr.w))}for(var Sr=tr.length;Sr<lr;++Sr)N.disableVertexAttribArray(Sr);var qr=Rt.getElements(this.elements);qr?N.bindBuffer(xe,qr.buffer.buffer):N.bindBuffer(xe,null)},Ir.prototype.refresh=function(){var Jt=Cr();Jt&&(Jt.bindVertexArrayOES(this.vao),this.bindAttrs(),jr.currentVAO=null,Jt.bindVertexArrayOES(null))},Ir.prototype.destroy=function(){if(this.vao){var Jt=Cr();this===jr.currentVAO&&(jr.currentVAO=null,Jt.bindVertexArrayOES(null)),Jt.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),Tr[this.id]&&(delete Tr[this.id],Dt.vaoCount-=1)};function $r(){var Jt=Cr();Jt&&te(Tr).forEach(function(tr){tr.refresh()})}function Bn(Jt){var tr=new Ir;Dt.vaoCount+=1;function xn(Vr){var Sr;if(Array.isArray(Vr))Sr=Vr,tr.elements&&tr.ownsElements&&tr.elements.destroy(),tr.elements=null,tr.ownsElements=!1,tr.offset=0,tr.count=0,tr.instances=-1,tr.primitive=4;else{if(fe(typeof Vr=="object","invalid arguments for create vao"),fe("attributes"in Vr,"must specify attributes for vao"),Vr.elements){var qr=Vr.elements;tr.ownsElements?typeof qr=="function"&&qr._reglType==="elements"?(tr.elements.destroy(),tr.ownsElements=!1):(tr.elements(qr),tr.ownsElements=!1):Rt.getElements(Vr.elements)?(tr.elements=Vr.elements,tr.ownsElements=!1):(tr.elements=Rt.create(Vr.elements),tr.ownsElements=!0)}else tr.elements=null,tr.ownsElements=!1;Sr=Vr.attributes,tr.offset=0,tr.count=-1,tr.instances=-1,tr.primitive=4,tr.elements&&(tr.count=tr.elements._elements.vertCount,tr.primitive=tr.elements._elements.primType),"offset"in Vr&&(tr.offset=Vr.offset|0),"count"in Vr&&(tr.count=Vr.count|0),"instances"in Vr&&(tr.instances=Vr.instances|0),"primitive"in Vr&&(fe(Vr.primitive in nr,"bad primitive type: "+Vr.primitive),tr.primitive=nr[Vr.primitive]),fe.optional(function(){for(var so=Object.keys(Vr),uo=0;uo<so.length;++uo)fe(je.indexOf(so[uo])>=0,'invalid option for vao: "'+so[uo]+'" valid options are '+je)}),fe(Array.isArray(Sr),"attributes must be an array")}fe(Sr.length<lr,"too many attributes"),fe(Sr.length>0,"must specify at least one attribute");var Kr={},gi=tr.attributes;gi.length=Sr.length;for(var ai=0;ai<Sr.length;++ai){var Hr=Sr[ai],rn=gi[ai]=new Ke,Qn=Hr.data||Hr;if(Array.isArray(Qn)||me(Qn)||ys(Qn)){var ci;tr.buffers[ai]&&(ci=tr.buffers[ai],me(Qn)&&ci._buffer.byteLength>=Qn.byteLength?ci.subdata(Qn):(ci.destroy(),tr.buffers[ai]=null)),tr.buffers[ai]||(ci=tr.buffers[ai]=rr.create(Hr,Ne,!1,!0)),rn.buffer=rr.getBuffer(ci),rn.size=rn.buffer.dimension|0,rn.normalized=!1,rn.type=rn.buffer.dtype,rn.offset=0,rn.stride=0,rn.divisor=0,rn.state=1,Kr[ai]=1}else rr.getBuffer(Hr)?(rn.buffer=rr.getBuffer(Hr),rn.size=rn.buffer.dimension|0,rn.normalized=!1,rn.type=rn.buffer.dtype,rn.offset=0,rn.stride=0,rn.divisor=0,rn.state=1):rr.getBuffer(Hr.buffer)?(rn.buffer=rr.getBuffer(Hr.buffer),rn.size=(+Hr.size||rn.buffer.dimension)|0,rn.normalized=!!Hr.normalized||!1,"type"in Hr?(fe.parameter(Hr.type,fu,"invalid buffer type"),rn.type=fu[Hr.type]):rn.type=rn.buffer.dtype,rn.offset=(Hr.offset||0)|0,rn.stride=(Hr.stride||0)|0,rn.divisor=(Hr.divisor||0)|0,rn.state=1,fe(rn.size>=1&&rn.size<=4,"size must be between 1 and 4"),fe(rn.offset>=0,"invalid offset"),fe(rn.stride>=0&&rn.stride<=255,"stride must be between 0 and 255"),fe(rn.divisor>=0,"divisor must be positive"),fe(!rn.divisor||!!ce.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Hr?(fe(ai>0,"first attribute must not be a constant"),rn.x=+Hr.x||0,rn.y=+Hr.y||0,rn.z=+Hr.z||0,rn.w=+Hr.w||0,rn.state=2):fe(!1,"invalid attribute spec for location "+ai)}for(var Ni=0;Ni<tr.buffers.length;++Ni)!Kr[Ni]&&tr.buffers[Ni]&&(tr.buffers[Ni].destroy(),tr.buffers[Ni]=null);return tr.refresh(),xn}return xn.destroy=function(){for(var Vr=0;Vr<tr.buffers.length;++Vr)tr.buffers[Vr]&&tr.buffers[Vr].destroy();tr.buffers.length=0,tr.ownsElements&&(tr.elements.destroy(),tr.elements=null,tr.ownsElements=!1),tr.destroy()},xn._vao=tr,xn._reglType="vao",xn(Jt)}return jr}var Wt=35632,jt=35633,qt=35718,pr=35721;function kr(N,ce,Be,Dt){var rr={},Rt={};function Qt(nt,Vt,br,Nr){this.name=nt,this.id=Vt,this.location=br,this.info=Nr}function lr(nt,Vt){for(var br=0;br<nt.length;++br)if(nt[br].id===Vt.id){nt[br].location=Vt.location;return}nt.push(Vt)}function dr(nt,Vt,br){var Nr=nt===Wt?rr:Rt,ur=Nr[Vt];if(!ur){var Ir=ce.str(Vt);ur=N.createShader(nt),N.shaderSource(ur,Ir),N.compileShader(ur),fe.shaderError(N,ur,Ir,nt,br),Nr[Vt]=ur}return ur}var xr={},wr=[],Tr=0;function jr(nt,Vt){this.id=Tr++,this.fragId=nt,this.vertId=Vt,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,Dt.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function gr(nt,Vt,br){var Nr,ur,Ir=dr(Wt,nt.fragId),$r=dr(jt,nt.vertId),Bn=nt.program=N.createProgram();if(N.attachShader(Bn,Ir),N.attachShader(Bn,$r),br)for(Nr=0;Nr<br.length;++Nr){var Jt=br[Nr];N.bindAttribLocation(Bn,Jt[0],Jt[1])}N.linkProgram(Bn),fe.linkError(N,Bn,ce.str(nt.fragId),ce.str(nt.vertId),Vt);var tr=N.getProgramParameter(Bn,qt);Dt.profile&&(nt.stats.uniformsCount=tr);var xn=nt.uniforms;for(Nr=0;Nr<tr;++Nr)if(ur=N.getActiveUniform(Bn,Nr),ur)if(ur.size>1)for(var Vr=0;Vr<ur.size;++Vr){var Sr=ur.name.replace("[0]","["+Vr+"]");lr(xn,new Qt(Sr,ce.id(Sr),N.getUniformLocation(Bn,Sr),ur))}else lr(xn,new Qt(ur.name,ce.id(ur.name),N.getUniformLocation(Bn,ur.name),ur));var qr=N.getProgramParameter(Bn,pr);Dt.profile&&(nt.stats.attributesCount=qr);var Kr=nt.attributes;for(Nr=0;Nr<qr;++Nr)ur=N.getActiveAttrib(Bn,Nr),ur&&lr(Kr,new Qt(ur.name,ce.id(ur.name),N.getAttribLocation(Bn,ur.name),ur))}Dt.profile&&(Be.getMaxUniformsCount=function(){var nt=0;return wr.forEach(function(Vt){Vt.stats.uniformsCount>nt&&(nt=Vt.stats.uniformsCount)}),nt},Be.getMaxAttributesCount=function(){var nt=0;return wr.forEach(function(Vt){Vt.stats.attributesCount>nt&&(nt=Vt.stats.attributesCount)}),nt});function Cr(){rr={},Rt={};for(var nt=0;nt<wr.length;++nt)gr(wr[nt],null,wr[nt].attributes.map(function(Vt){return[Vt.location,Vt.name]}))}return{clear:function(){var nt=N.deleteShader.bind(N);te(rr).forEach(nt),rr={},te(Rt).forEach(nt),Rt={},wr.forEach(function(Vt){N.deleteProgram(Vt.program)}),wr.length=0,xr={},Be.shaderCount=0},program:function(nt,Vt,br,Nr){fe.command(nt>=0,"missing vertex shader",br),fe.command(Vt>=0,"missing fragment shader",br);var ur=xr[Vt];ur||(ur=xr[Vt]={});var Ir=ur[nt];if(Ir&&(Ir.refCount++,!Nr))return Ir;var $r=new jr(Vt,nt);return Be.shaderCount++,gr($r,br,Nr),Ir||(ur[nt]=$r),wr.push($r),g($r,{destroy:function(){if($r.refCount--,$r.refCount<=0){N.deleteProgram($r.program);var Bn=wr.indexOf($r);wr.splice(Bn,1),Be.shaderCount--}ur[$r.vertId].refCount<=0&&(N.deleteShader(Rt[$r.vertId]),delete Rt[$r.vertId],delete xr[$r.fragId][$r.vertId]),Object.keys(xr[$r.fragId]).length||(N.deleteShader(rr[$r.fragId]),delete rr[$r.fragId],delete xr[$r.fragId])}})},restore:Cr,shader:dr,frag:-1,vert:-1}}var _r=6408,sn=5121,Zn=3333,jn=5126;function kn(N,ce,Be,Dt,rr,Rt,Qt){function lr(wr){var Tr;ce.next===null?(fe(rr.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),Tr=sn):(fe(ce.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),Tr=ce.next.colorAttachments[0].texture._texture.type,fe.optional(function(){Rt.oes_texture_float?(fe(Tr===sn||Tr===jn,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),Tr===jn&&fe(Qt.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):fe(Tr===sn,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var jr=0,gr=0,Cr=Dt.framebufferWidth,nt=Dt.framebufferHeight,Vt=null;me(wr)?Vt=wr:wr&&(fe.type(wr,"object","invalid arguments to regl.read()"),jr=wr.x|0,gr=wr.y|0,fe(jr>=0&&jr<Dt.framebufferWidth,"invalid x offset for regl.read"),fe(gr>=0&&gr<Dt.framebufferHeight,"invalid y offset for regl.read"),Cr=(wr.width||Dt.framebufferWidth-jr)|0,nt=(wr.height||Dt.framebufferHeight-gr)|0,Vt=wr.data||null),Vt&&(Tr===sn?fe(Vt instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):Tr===jn&&fe(Vt instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),fe(Cr>0&&Cr+jr<=Dt.framebufferWidth,"invalid width for read pixels"),fe(nt>0&&nt+gr<=Dt.framebufferHeight,"invalid height for read pixels"),Be();var br=Cr*nt*4;return Vt||(Tr===sn?Vt=new Uint8Array(br):Tr===jn&&(Vt=Vt||new Float32Array(br))),fe.isTypedArray(Vt,"data buffer for regl.read() must be a typedarray"),fe(Vt.byteLength>=br,"data buffer for regl.read() too small"),N.pixelStorei(Zn,4),N.readPixels(jr,gr,Cr,nt,_r,Tr,Vt),Vt}function dr(wr){var Tr;return ce.setFBO({framebuffer:wr.framebuffer},function(){Tr=lr(wr)}),Tr}function xr(wr){return!wr||!("framebuffer"in wr)?lr(wr):dr(wr)}return xr}function ki(N){return Array.prototype.slice.call(N)}function tn(N){return ki(N).join("")}function ii(){var N=0,ce=[],Be=[];function Dt(Tr){for(var jr=0;jr<Be.length;++jr)if(Be[jr]===Tr)return ce[jr];var gr="g"+N++;return ce.push(gr),Be.push(Tr),gr}function rr(){var Tr=[];function jr(){Tr.push.apply(Tr,ki(arguments))}var gr=[];function Cr(){var nt="v"+N++;return gr.push(nt),arguments.length>0&&(Tr.push(nt,"="),Tr.push.apply(Tr,ki(arguments)),Tr.push(";")),nt}return g(jr,{def:Cr,toString:function(){return tn([gr.length>0?"var "+gr.join(",")+";":"",tn(Tr)])}})}function Rt(){var Tr=rr(),jr=rr(),gr=Tr.toString,Cr=jr.toString;function nt(Vt,br){jr(Vt,br,"=",Tr.def(Vt,br),";")}return g(function(){Tr.apply(Tr,ki(arguments))},{def:Tr.def,entry:Tr,exit:jr,save:nt,set:function(Vt,br,Nr){nt(Vt,br),Tr(Vt,br,"=",Nr,";")},toString:function(){return gr()+Cr()}})}function Qt(){var Tr=tn(arguments),jr=Rt(),gr=Rt(),Cr=jr.toString,nt=gr.toString;return g(jr,{then:function(){return jr.apply(jr,ki(arguments)),this},else:function(){return gr.apply(gr,ki(arguments)),this},toString:function(){var Vt=nt();return Vt&&(Vt="else{"+Vt+"}"),tn(["if(",Tr,"){",Cr(),"}",Vt])}})}var lr=rr(),dr={};function xr(Tr,jr){var gr=[];function Cr(){var ur="a"+gr.length;return gr.push(ur),ur}jr=jr||0;for(var nt=0;nt<jr;++nt)Cr();var Vt=Rt(),br=Vt.toString,Nr=dr[Tr]=g(Vt,{arg:Cr,toString:function(){return tn(["function(",gr.join(),"){",br(),"}"])}});return Nr}function wr(){var Tr=['"use strict";',lr,"return {"];Object.keys(dr).forEach(function(nt){Tr.push('"',nt,'":',dr[nt].toString(),",")}),Tr.push("}");var jr=tn(Tr).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),gr=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Cr=gr?Ce.Function.apply(null,ce.concat(jr)):Function.apply(null,ce.concat(jr));return Cr.apply(null,Be)}return{global:lr,link:Dt,block:rr,proc:xr,scope:Rt,cond:Qt,compile:wr}}var li="xyzw".split(""),$n=5121,Hn=1,di=2,Kn=0,Xn=1,yo=2,Ja=3,To=4,ra=5,Ha=6,ho="dither",Rs="blend.enable",ss="blend.color",Bu="blend.equation",us="blend.func",nu="depth.enable",Jo="depth.func",ls="depth.range",Wl="depth.mask",Nu="colorMask",_l="cull.enable",Xl="cull.face",iu="frontFace",xl="lineWidth",Su="polygonOffset.enable",Eo="polygonOffset.offset",zu="sample.alpha",Uu="sample.enable",tl="sample.coverage",ca="stencil.enable",Us="stencil.mask",es="stencil.func",_u="stencil.opFront",qc="stencil.opBack",Kc="scissor.enable",Pf="scissor.box",au="viewport",mc="profile",ou="framebuffer",bl="vert",gc="frag",su="elements",Bo="primitive",$c="count",Jf="offset",kh="instances",eh="vao",pp="Width",yc="Height",_c=ou+pp,Of=ou+yc,Lh=au+pp,qp=au+yc,El="drawingBuffer",Qc=El+pp,Kp=El+yc,Pd=[us,Bu,es,_u,qc,tl,au,Pf,Eo],Jc=34962,Dh=34963,Od=35632,Id=35633,$p=3553,dp=34067,Fh=2884,th=3042,Xr=3024,Mo=2960,yt=2929,Qp=3089,Bh=32823,rh=32926,If=32928,nh=5126,ih=35664,Yl=35665,Sl=35666,ah=5124,Nh=35667,ql=35668,oh=35669,Rf=35670,sh=35671,ef=35672,kf=35673,Zs=35674,Lf=35675,tf=35676,uh=35678,lh=35680,zh=4,Cl=1028,rf=1029,Jp=2304,Uh=2305,vp=32775,Rd=32776,ed=519,Cu=7680,kd=0,Zh=1,nf=32774,Zu=513,td=36160,rd=36064,rl={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Df=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],af={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},xc={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},mp={frag:Od,vert:Id},of={cw:Jp,ccw:Uh};function jh(N){return Array.isArray(N)||me(N)||ys(N)}function Oa(N){return N.sort(function(ce,Be){return ce===au?-1:Be===au?1:ce<Be?-1:1})}function qi(N,ce,Be,Dt){this.thisDep=N,this.contextDep=ce,this.propDep=Be,this.append=Dt}function bc(N){return N&&!(N.thisDep||N.contextDep||N.propDep)}function Po(N){return new qi(!1,!1,!1,N)}function js(N,ce){var Be=N.type;if(Be===Kn){var Dt=N.data.length;return new qi(!0,Dt>=1,Dt>=2,ce)}else if(Be===To){var rr=N.data;return new qi(rr.thisDep,rr.contextDep,rr.propDep,ce)}else{if(Be===ra)return new qi(!1,!1,!1,ce);if(Be===Ha){for(var Rt=!1,Qt=!1,lr=!1,dr=0;dr<N.data.length;++dr){var xr=N.data[dr];if(xr.type===Xn)lr=!0;else if(xr.type===yo)Qt=!0;else if(xr.type===Ja)Rt=!0;else if(xr.type===Kn){Rt=!0;var wr=xr.data;wr>=1&&(Qt=!0),wr>=2&&(lr=!0)}else xr.type===To&&(Rt=Rt||xr.data.thisDep,Qt=Qt||xr.data.contextDep,lr=lr||xr.data.propDep)}return new qi(Rt,Qt,lr,ce)}else return new qi(Be===Ja,Be===yo,Be===Xn,ce)}}var nd=new qi(!1,!1,!1,function(){});function gp(N,ce,Be,Dt,rr,Rt,Qt,lr,dr,xr,wr,Tr,jr,gr,Cr){var nt=xr.Record,Vt={add:32774,subtract:32778,"reverse subtract":32779};Be.ext_blend_minmax&&(Vt.min=vp,Vt.max=Rd);var br=Be.angle_instanced_arrays,Nr=Be.webgl_draw_buffers,ur=Be.oes_vertex_array_object,Ir={dirty:!0,profile:Cr.profile},$r={},Bn=[],Jt={},tr={};function xn(Ee){return Ee.replace(".","_")}function Vr(Ee,ae,Ve){var ot=xn(Ee);Bn.push(Ee),$r[ot]=Ir[ot]=!!Ve,Jt[ot]=ae}function Sr(Ee,ae,Ve){var ot=xn(Ee);Bn.push(Ee),Array.isArray(Ve)?(Ir[ot]=Ve.slice(),$r[ot]=Ve.slice()):Ir[ot]=$r[ot]=Ve,tr[ot]=ae}Vr(ho,Xr),Vr(Rs,th),Sr(ss,"blendColor",[0,0,0,0]),Sr(Bu,"blendEquationSeparate",[nf,nf]),Sr(us,"blendFuncSeparate",[Zh,kd,Zh,kd]),Vr(nu,yt,!0),Sr(Jo,"depthFunc",Zu),Sr(ls,"depthRange",[0,1]),Sr(Wl,"depthMask",!0),Sr(Nu,Nu,[!0,!0,!0,!0]),Vr(_l,Fh),Sr(Xl,"cullFace",rf),Sr(iu,iu,Uh),Sr(xl,xl,1),Vr(Su,Bh),Sr(Eo,"polygonOffset",[0,0]),Vr(zu,rh),Vr(Uu,If),Sr(tl,"sampleCoverage",[1,!1]),Vr(ca,Mo),Sr(Us,"stencilMask",-1),Sr(es,"stencilFunc",[ed,0,-1]),Sr(_u,"stencilOpSeparate",[Cl,Cu,Cu,Cu]),Sr(qc,"stencilOpSeparate",[rf,Cu,Cu,Cu]),Vr(Kc,Qp),Sr(Pf,"scissor",[0,0,N.drawingBufferWidth,N.drawingBufferHeight]),Sr(au,au,[0,0,N.drawingBufferWidth,N.drawingBufferHeight]);var qr={gl:N,context:jr,strings:ce,next:$r,current:Ir,draw:Tr,elements:Rt,buffer:rr,shader:wr,attributes:xr.state,vao:xr,uniforms:dr,framebuffer:lr,extensions:Be,timer:gr,isBufferArgs:jh},Kr={primTypes:nr,compareFuncs:af,blendFuncs:rl,blendEquations:Vt,stencilOps:xc,glTypes:fu,orientationType:of};fe.optional(function(){qr.isArrayLike=co}),Nr&&(Kr.backBuffer=[rf],Kr.drawBuffer=Ge(Dt.maxDrawbuffers,function(Ee){return Ee===0?[0]:Ge(Ee,function(ae){return rd+ae})}));var gi=0;function ai(){var Ee=ii(),ae=Ee.link,Ve=Ee.global;Ee.id=gi++,Ee.batchId="0";var ot=ae(qr),Ot=Ee.shared={props:"a0"};Object.keys(qr).forEach(function(Ze){Ot[Ze]=Ve.def(ot,".",Ze)}),fe.optional(function(){Ee.CHECK=ae(fe),Ee.commandStr=fe.guessCommand(),Ee.command=ae(Ee.commandStr),Ee.assert=function(Ze,Ae,st){Ze("if(!(",Ae,"))",this.CHECK,".commandRaise(",ae(st),",",this.command,");")},Kr.invalidBlendCombinations=Df});var Ye=Ee.next={},De=Ee.current={};Object.keys(tr).forEach(function(Ze){Array.isArray(Ir[Ze])&&(Ye[Ze]=Ve.def(Ot.next,".",Ze),De[Ze]=Ve.def(Ot.current,".",Ze))});var Je=Ee.constants={};Object.keys(Kr).forEach(function(Ze){Je[Ze]=Ve.def(JSON.stringify(Kr[Ze]))}),Ee.invoke=function(Ze,Ae){switch(Ae.type){case Kn:var st=["this",Ot.context,Ot.props,Ee.batchId];return Ze.def(ae(Ae.data),".call(",st.slice(0,Math.max(Ae.data.length+1,4)),")");case Xn:return Ze.def(Ot.props,Ae.data);case yo:return Ze.def(Ot.context,Ae.data);case Ja:return Ze.def("this",Ae.data);case To:return Ae.data.append(Ee,Ze),Ae.data.ref;case ra:return Ae.data.toString();case Ha:return Ae.data.map(function(At){return Ee.invoke(Ze,At)})}},Ee.attribCache={};var ve={};return Ee.scopeAttrib=function(Ze){var Ae=ce.id(Ze);if(Ae in ve)return ve[Ae];var st=xr.scope[Ae];st||(st=xr.scope[Ae]=new nt);var At=ve[Ae]=ae(st);return At},Ee}function Hr(Ee){var ae=Ee.static,Ve=Ee.dynamic,ot;if(mc in ae){var Ot=!!ae[mc];ot=Po(function(De,Je){return Ot}),ot.enable=Ot}else if(mc in Ve){var Ye=Ve[mc];ot=js(Ye,function(De,Je){return De.invoke(Je,Ye)})}return ot}function rn(Ee,ae){var Ve=Ee.static,ot=Ee.dynamic;if(ou in Ve){var Ot=Ve[ou];return Ot?(Ot=lr.getFramebuffer(Ot),fe.command(Ot,"invalid framebuffer object"),Po(function(De,Je){var ve=De.link(Ot),Ze=De.shared;Je.set(Ze.framebuffer,".next",ve);var Ae=Ze.context;return Je.set(Ae,"."+_c,ve+".width"),Je.set(Ae,"."+Of,ve+".height"),ve})):Po(function(De,Je){var ve=De.shared;Je.set(ve.framebuffer,".next","null");var Ze=ve.context;return Je.set(Ze,"."+_c,Ze+"."+Qc),Je.set(Ze,"."+Of,Ze+"."+Kp),"null"})}else if(ou in ot){var Ye=ot[ou];return js(Ye,function(De,Je){var ve=De.invoke(Je,Ye),Ze=De.shared,Ae=Ze.framebuffer,st=Je.def(Ae,".getFramebuffer(",ve,")");fe.optional(function(){De.assert(Je,"!"+ve+"||"+st,"invalid framebuffer object")}),Je.set(Ae,".next",st);var At=Ze.context;return Je.set(At,"."+_c,st+"?"+st+".width:"+At+"."+Qc),Je.set(At,"."+Of,st+"?"+st+".height:"+At+"."+Kp),st})}else return null}function Qn(Ee,ae,Ve){var ot=Ee.static,Ot=Ee.dynamic;function Ye(ve){if(ve in ot){var Ze=ot[ve];fe.commandType(Ze,"object","invalid "+ve,Ve.commandStr);var Ae=!0,st=Ze.x|0,At=Ze.y|0,cr,zr;return"width"in Ze?(cr=Ze.width|0,fe.command(cr>=0,"invalid "+ve,Ve.commandStr)):Ae=!1,"height"in Ze?(zr=Ze.height|0,fe.command(zr>=0,"invalid "+ve,Ve.commandStr)):Ae=!1,new qi(!Ae&&ae&&ae.thisDep,!Ae&&ae&&ae.contextDep,!Ae&&ae&&ae.propDep,function(Lr,An){var un=Lr.shared.context,En=cr;"width"in Ze||(En=An.def(un,".",_c,"-",st));var bn=zr;return"height"in Ze||(bn=An.def(un,".",Of,"-",At)),[st,At,En,bn]})}else if(ve in Ot){var Ur=Ot[ve],nn=js(Ur,function(Lr,An){var un=Lr.invoke(An,Ur);fe.optional(function(){Lr.assert(An,un+"&&typeof "+un+'==="object"',"invalid "+ve)});var En=Lr.shared.context,bn=An.def(un,".x|0"),ln=An.def(un,".y|0"),Jn=An.def('"width" in ',un,"?",un,".width|0:","(",En,".",_c,"-",bn,")"),Sa=An.def('"height" in ',un,"?",un,".height|0:","(",En,".",Of,"-",ln,")");return fe.optional(function(){Lr.assert(An,Jn+">=0&&"+Sa+">=0","invalid "+ve)}),[bn,ln,Jn,Sa]});return ae&&(nn.thisDep=nn.thisDep||ae.thisDep,nn.contextDep=nn.contextDep||ae.contextDep,nn.propDep=nn.propDep||ae.propDep),nn}else return ae?new qi(ae.thisDep,ae.contextDep,ae.propDep,function(Lr,An){var un=Lr.shared.context;return[0,0,An.def(un,".",_c),An.def(un,".",Of)]}):null}var De=Ye(au);if(De){var Je=De;De=new qi(De.thisDep,De.contextDep,De.propDep,function(ve,Ze){var Ae=Je.append(ve,Ze),st=ve.shared.context;return Ze.set(st,"."+Lh,Ae[2]),Ze.set(st,"."+qp,Ae[3]),Ae})}return{viewport:De,scissor_box:Ye(Pf)}}function ci(Ee,ae){var Ve=Ee.static,ot=typeof Ve[gc]=="string"&&typeof Ve[bl]=="string";if(ot){if(Object.keys(ae.dynamic).length>0)return null;var Ot=ae.static,Ye=Object.keys(Ot);if(Ye.length>0&&typeof Ot[Ye[0]]=="number"){for(var De=[],Je=0;Je<Ye.length;++Je)fe(typeof Ot[Ye[Je]]=="number","must specify all vertex attribute locations when using vaos"),De.push([Ot[Ye[Je]]|0,Ye[Je]]);return De}}return null}function Ni(Ee,ae,Ve){var ot=Ee.static,Ot=Ee.dynamic;function Ye(Ae){if(Ae in ot){var st=ce.id(ot[Ae]);fe.optional(function(){wr.shader(mp[Ae],st,fe.guessCommand())});var At=Po(function(){return st});return At.id=st,At}else if(Ae in Ot){var cr=Ot[Ae];return js(cr,function(zr,Ur){var nn=zr.invoke(Ur,cr),Lr=Ur.def(zr.shared.strings,".id(",nn,")");return fe.optional(function(){Ur(zr.shared.shader,".shader(",mp[Ae],",",Lr,",",zr.command,");")}),Lr})}return null}var De=Ye(gc),Je=Ye(bl),ve=null,Ze;return bc(De)&&bc(Je)?(ve=wr.program(Je.id,De.id,null,Ve),Ze=Po(function(Ae,st){return Ae.link(ve)})):Ze=new qi(De&&De.thisDep||Je&&Je.thisDep,De&&De.contextDep||Je&&Je.contextDep,De&&De.propDep||Je&&Je.propDep,function(Ae,st){var At=Ae.shared.shader,cr;De?cr=De.append(Ae,st):cr=st.def(At,".",gc);var zr;Je?zr=Je.append(Ae,st):zr=st.def(At,".",bl);var Ur=At+".program("+zr+","+cr;return fe.optional(function(){Ur+=","+Ae.command}),st.def(Ur+")")}),{frag:De,vert:Je,progVar:Ze,program:ve}}function so(Ee,ae){var Ve=Ee.static,ot=Ee.dynamic,Ot={},Ye=!1;function De(){if(eh in Ve){var An=Ve[eh];return An!==null&&xr.getVAO(An)===null&&(An=xr.createVAO(An)),Ye=!0,Ot.vao=An,Po(function(En){var bn=xr.getVAO(An);return bn?En.link(bn):"null"})}else if(eh in ot){Ye=!0;var un=ot[eh];return js(un,function(En,bn){var ln=En.invoke(bn,un);return bn.def(En.shared.vao+".getVAO("+ln+")")})}return null}var Je=De(),ve=!1;function Ze(){if(su in Ve){var An=Ve[su];if(Ot.elements=An,jh(An)){var un=Ot.elements=Rt.create(An,!0);An=Rt.getElements(un),ve=!0}else An&&(An=Rt.getElements(An),ve=!0,fe.command(An,"invalid elements",ae.commandStr));var En=Po(function(ln,Jn){if(An){var Sa=ln.link(An);return ln.ELEMENTS=Sa,Sa}return ln.ELEMENTS=null,null});return En.value=An,En}else if(su in ot){ve=!0;var bn=ot[su];return js(bn,function(ln,Jn){var Sa=ln.shared,fs=Sa.isBufferArgs,Va=Sa.elements,_a=ln.invoke(Jn,bn),Ql=Jn.def("null"),Vs=Jn.def(fs,"(",_a,")"),wl=ln.cond(Vs).then(Ql,"=",Va,".createStream(",_a,");").else(Ql,"=",Va,".getElements(",_a,");");return fe.optional(function(){ln.assert(wl.else,"!"+_a+"||"+Ql,"invalid elements")}),Jn.entry(wl),Jn.exit(ln.cond(Vs).then(Va,".destroyStream(",Ql,");")),ln.ELEMENTS=Ql,Ql})}else if(Ye)return new qi(Je.thisDep,Je.contextDep,Je.propDep,function(ln,Jn){return Jn.def(ln.shared.vao+".currentVAO?"+ln.shared.elements+".getElements("+ln.shared.vao+".currentVAO.elements):null")});return null}var Ae=Ze();function st(){if(Bo in Ve){var An=Ve[Bo];return Ot.primitive=An,fe.commandParameter(An,nr,"invalid primitve",ae.commandStr),Po(function(En,bn){return nr[An]})}else if(Bo in ot){var un=ot[Bo];return js(un,function(En,bn){var ln=En.constants.primTypes,Jn=En.invoke(bn,un);return fe.optional(function(){En.assert(bn,Jn+" in "+ln,"invalid primitive, must be one of "+Object.keys(nr))}),bn.def(ln,"[",Jn,"]")})}else{if(ve)return bc(Ae)?Ae.value?Po(function(En,bn){return bn.def(En.ELEMENTS,".primType")}):Po(function(){return zh}):new qi(Ae.thisDep,Ae.contextDep,Ae.propDep,function(En,bn){var ln=En.ELEMENTS;return bn.def(ln,"?",ln,".primType:",zh)});if(Ye)return new qi(Je.thisDep,Je.contextDep,Je.propDep,function(En,bn){return bn.def(En.shared.vao+".currentVAO?"+En.shared.vao+".currentVAO.primitive:"+zh)})}return null}function At(An,un){if(An in Ve){var En=Ve[An]|0;return un?Ot.offset=En:Ot.instances=En,fe.command(!un||En>=0,"invalid "+An,ae.commandStr),Po(function(ln,Jn){return un&&(ln.OFFSET=En),En})}else if(An in ot){var bn=ot[An];return js(bn,function(ln,Jn){var Sa=ln.invoke(Jn,bn);return un&&(ln.OFFSET=Sa,fe.optional(function(){ln.assert(Jn,Sa+">=0","invalid "+An)})),Sa})}else if(un){if(ve)return Po(function(ln,Jn){return ln.OFFSET=0,0});if(Ye)return new qi(Je.thisDep,Je.contextDep,Je.propDep,function(ln,Jn){return Jn.def(ln.shared.vao+".currentVAO?"+ln.shared.vao+".currentVAO.offset:0")})}else if(Ye)return new qi(Je.thisDep,Je.contextDep,Je.propDep,function(ln,Jn){return Jn.def(ln.shared.vao+".currentVAO?"+ln.shared.vao+".currentVAO.instances:-1")});return null}var cr=At(Jf,!0);function zr(){if($c in Ve){var An=Ve[$c]|0;return Ot.count=An,fe.command(typeof An=="number"&&An>=0,"invalid vertex count",ae.commandStr),Po(function(){return An})}else if($c in ot){var un=ot[$c];return js(un,function(Jn,Sa){var fs=Jn.invoke(Sa,un);return fe.optional(function(){Jn.assert(Sa,"typeof "+fs+'==="number"&&'+fs+">=0&&"+fs+"===("+fs+"|0)","invalid vertex count")}),fs})}else if(ve)if(bc(Ae)){if(Ae)return cr?new qi(cr.thisDep,cr.contextDep,cr.propDep,function(Jn,Sa){var fs=Sa.def(Jn.ELEMENTS,".vertCount-",Jn.OFFSET);return fe.optional(function(){Jn.assert(Sa,fs+">=0","invalid vertex offset/element buffer too small")}),fs}):Po(function(Jn,Sa){return Sa.def(Jn.ELEMENTS,".vertCount")});var En=Po(function(){return-1});return fe.optional(function(){En.MISSING=!0}),En}else{var bn=new qi(Ae.thisDep||cr.thisDep,Ae.contextDep||cr.contextDep,Ae.propDep||cr.propDep,function(Jn,Sa){var fs=Jn.ELEMENTS;return Jn.OFFSET?Sa.def(fs,"?",fs,".vertCount-",Jn.OFFSET,":-1"):Sa.def(fs,"?",fs,".vertCount:-1")});return fe.optional(function(){bn.DYNAMIC=!0}),bn}else if(Ye){var ln=new qi(Je.thisDep,Je.contextDep,Je.propDep,function(Jn,Sa){return Sa.def(Jn.shared.vao,".currentVAO?",Jn.shared.vao,".currentVAO.count:-1")});return ln}return null}var Ur=st(),nn=zr(),Lr=At(kh,!1);return{elements:Ae,primitive:Ur,count:nn,instances:Lr,offset:cr,vao:Je,vaoActive:Ye,elementsActive:ve,static:Ot}}function uo(Ee,ae){var Ve=Ee.static,ot=Ee.dynamic,Ot={};return Bn.forEach(function(Ye){var De=xn(Ye);function Je(ve,Ze){if(Ye in Ve){var Ae=ve(Ve[Ye]);Ot[De]=Po(function(){return Ae})}else if(Ye in ot){var st=ot[Ye];Ot[De]=js(st,function(At,cr){return Ze(At,cr,At.invoke(cr,st))})}}switch(Ye){case _l:case Rs:case ho:case ca:case nu:case Kc:case Su:case zu:case Uu:case Wl:return Je(function(ve){return fe.commandType(ve,"boolean",Ye,ae.commandStr),ve},function(ve,Ze,Ae){return fe.optional(function(){ve.assert(Ze,"typeof "+Ae+'==="boolean"',"invalid flag "+Ye,ve.commandStr)}),Ae});case Jo:return Je(function(ve){return fe.commandParameter(ve,af,"invalid "+Ye,ae.commandStr),af[ve]},function(ve,Ze,Ae){var st=ve.constants.compareFuncs;return fe.optional(function(){ve.assert(Ze,Ae+" in "+st,"invalid "+Ye+", must be one of "+Object.keys(af))}),Ze.def(st,"[",Ae,"]")});case ls:return Je(function(ve){return fe.command(co(ve)&&ve.length===2&&typeof ve[0]=="number"&&typeof ve[1]=="number"&&ve[0]<=ve[1],"depth range is 2d array",ae.commandStr),ve},function(ve,Ze,Ae){fe.optional(function(){ve.assert(Ze,ve.shared.isArrayLike+"("+Ae+")&&"+Ae+".length===2&&typeof "+Ae+'[0]==="number"&&typeof '+Ae+'[1]==="number"&&'+Ae+"[0]<="+Ae+"[1]","depth range must be a 2d array")});var st=Ze.def("+",Ae,"[0]"),At=Ze.def("+",Ae,"[1]");return[st,At]});case us:return Je(function(ve){fe.commandType(ve,"object","blend.func",ae.commandStr);var Ze="srcRGB"in ve?ve.srcRGB:ve.src,Ae="srcAlpha"in ve?ve.srcAlpha:ve.src,st="dstRGB"in ve?ve.dstRGB:ve.dst,At="dstAlpha"in ve?ve.dstAlpha:ve.dst;return fe.commandParameter(Ze,rl,De+".srcRGB",ae.commandStr),fe.commandParameter(Ae,rl,De+".srcAlpha",ae.commandStr),fe.commandParameter(st,rl,De+".dstRGB",ae.commandStr),fe.commandParameter(At,rl,De+".dstAlpha",ae.commandStr),fe.command(Df.indexOf(Ze+", "+st)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+Ze+", "+st+")",ae.commandStr),[rl[Ze],rl[st],rl[Ae],rl[At]]},function(ve,Ze,Ae){var st=ve.constants.blendFuncs;fe.optional(function(){ve.assert(Ze,Ae+"&&typeof "+Ae+'==="object"',"invalid blend func, must be an object")});function At(un,En){var bn=Ze.def('"',un,En,'" in ',Ae,"?",Ae,".",un,En,":",Ae,".",un);return fe.optional(function(){ve.assert(Ze,bn+" in "+st,"invalid "+Ye+"."+un+En+", must be one of "+Object.keys(rl))}),bn}var cr=At("src","RGB"),zr=At("dst","RGB");fe.optional(function(){var un=ve.constants.invalidBlendCombinations;ve.assert(Ze,un+".indexOf("+cr+'+", "+'+zr+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var Ur=Ze.def(st,"[",cr,"]"),nn=Ze.def(st,"[",At("src","Alpha"),"]"),Lr=Ze.def(st,"[",zr,"]"),An=Ze.def(st,"[",At("dst","Alpha"),"]");return[Ur,Lr,nn,An]});case Bu:return Je(function(ve){if(typeof ve=="string")return fe.commandParameter(ve,Vt,"invalid "+Ye,ae.commandStr),[Vt[ve],Vt[ve]];if(typeof ve=="object")return fe.commandParameter(ve.rgb,Vt,Ye+".rgb",ae.commandStr),fe.commandParameter(ve.alpha,Vt,Ye+".alpha",ae.commandStr),[Vt[ve.rgb],Vt[ve.alpha]];fe.commandRaise("invalid blend.equation",ae.commandStr)},function(ve,Ze,Ae){var st=ve.constants.blendEquations,At=Ze.def(),cr=Ze.def(),zr=ve.cond("typeof ",Ae,'==="string"');return fe.optional(function(){function Ur(nn,Lr,An){ve.assert(nn,An+" in "+st,"invalid "+Lr+", must be one of "+Object.keys(Vt))}Ur(zr.then,Ye,Ae),ve.assert(zr.else,Ae+"&&typeof "+Ae+'==="object"',"invalid "+Ye),Ur(zr.else,Ye+".rgb",Ae+".rgb"),Ur(zr.else,Ye+".alpha",Ae+".alpha")}),zr.then(At,"=",cr,"=",st,"[",Ae,"];"),zr.else(At,"=",st,"[",Ae,".rgb];",cr,"=",st,"[",Ae,".alpha];"),Ze(zr),[At,cr]});case ss:return Je(function(ve){return fe.command(co(ve)&&ve.length===4,"blend.color must be a 4d array",ae.commandStr),Ge(4,function(Ze){return+ve[Ze]})},function(ve,Ze,Ae){return fe.optional(function(){ve.assert(Ze,ve.shared.isArrayLike+"("+Ae+")&&"+Ae+".length===4","blend.color must be a 4d array")}),Ge(4,function(st){return Ze.def("+",Ae,"[",st,"]")})});case Us:return Je(function(ve){return fe.commandType(ve,"number",De,ae.commandStr),ve|0},function(ve,Ze,Ae){return fe.optional(function(){ve.assert(Ze,"typeof "+Ae+'==="number"',"invalid stencil.mask")}),Ze.def(Ae,"|0")});case es:return Je(function(ve){fe.commandType(ve,"object",De,ae.commandStr);var Ze=ve.cmp||"keep",Ae=ve.ref||0,st="mask"in ve?ve.mask:-1;return fe.commandParameter(Ze,af,Ye+".cmp",ae.commandStr),fe.commandType(Ae,"number",Ye+".ref",ae.commandStr),fe.commandType(st,"number",Ye+".mask",ae.commandStr),[af[Ze],Ae,st]},function(ve,Ze,Ae){var st=ve.constants.compareFuncs;fe.optional(function(){function Ur(){ve.assert(Ze,Array.prototype.join.call(arguments,""),"invalid stencil.func")}Ur(Ae+"&&typeof ",Ae,'==="object"'),Ur('!("cmp" in ',Ae,")||(",Ae,".cmp in ",st,")")});var At=Ze.def('"cmp" in ',Ae,"?",st,"[",Ae,".cmp]",":",Cu),cr=Ze.def(Ae,".ref|0"),zr=Ze.def('"mask" in ',Ae,"?",Ae,".mask|0:-1");return[At,cr,zr]});case _u:case qc:return Je(function(ve){fe.commandType(ve,"object",De,ae.commandStr);var Ze=ve.fail||"keep",Ae=ve.zfail||"keep",st=ve.zpass||"keep";return fe.commandParameter(Ze,xc,Ye+".fail",ae.commandStr),fe.commandParameter(Ae,xc,Ye+".zfail",ae.commandStr),fe.commandParameter(st,xc,Ye+".zpass",ae.commandStr),[Ye===qc?rf:Cl,xc[Ze],xc[Ae],xc[st]]},function(ve,Ze,Ae){var st=ve.constants.stencilOps;fe.optional(function(){ve.assert(Ze,Ae+"&&typeof "+Ae+'==="object"',"invalid "+Ye)});function At(cr){return fe.optional(function(){ve.assert(Ze,'!("'+cr+'" in '+Ae+")||("+Ae+"."+cr+" in "+st+")","invalid "+Ye+"."+cr+", must be one of "+Object.keys(xc))}),Ze.def('"',cr,'" in ',Ae,"?",st,"[",Ae,".",cr,"]:",Cu)}return[Ye===qc?rf:Cl,At("fail"),At("zfail"),At("zpass")]});case Eo:return Je(function(ve){fe.commandType(ve,"object",De,ae.commandStr);var Ze=ve.factor|0,Ae=ve.units|0;return fe.commandType(Ze,"number",De+".factor",ae.commandStr),fe.commandType(Ae,"number",De+".units",ae.commandStr),[Ze,Ae]},function(ve,Ze,Ae){fe.optional(function(){ve.assert(Ze,Ae+"&&typeof "+Ae+'==="object"',"invalid "+Ye)});var st=Ze.def(Ae,".factor|0"),At=Ze.def(Ae,".units|0");return[st,At]});case Xl:return Je(function(ve){var Ze=0;return ve==="front"?Ze=Cl:ve==="back"&&(Ze=rf),fe.command(!!Ze,De,ae.commandStr),Ze},function(ve,Ze,Ae){return fe.optional(function(){ve.assert(Ze,Ae+'==="front"||'+Ae+'==="back"',"invalid cull.face")}),Ze.def(Ae,'==="front"?',Cl,":",rf)});case xl:return Je(function(ve){return fe.command(typeof ve=="number"&&ve>=Dt.lineWidthDims[0]&&ve<=Dt.lineWidthDims[1],"invalid line width, must be a positive number between "+Dt.lineWidthDims[0]+" and "+Dt.lineWidthDims[1],ae.commandStr),ve},function(ve,Ze,Ae){return fe.optional(function(){ve.assert(Ze,"typeof "+Ae+'==="number"&&'+Ae+">="+Dt.lineWidthDims[0]+"&&"+Ae+"<="+Dt.lineWidthDims[1],"invalid line width")}),Ae});case iu:return Je(function(ve){return fe.commandParameter(ve,of,De,ae.commandStr),of[ve]},function(ve,Ze,Ae){return fe.optional(function(){ve.assert(Ze,Ae+'==="cw"||'+Ae+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),Ze.def(Ae+'==="cw"?'+Jp+":"+Uh)});case Nu:return Je(function(ve){return fe.command(co(ve)&&ve.length===4,"color.mask must be length 4 array",ae.commandStr),ve.map(function(Ze){return!!Ze})},function(ve,Ze,Ae){return fe.optional(function(){ve.assert(Ze,ve.shared.isArrayLike+"("+Ae+")&&"+Ae+".length===4","invalid color.mask")}),Ge(4,function(st){return"!!"+Ae+"["+st+"]"})});case tl:return Je(function(ve){fe.command(typeof ve=="object"&&ve,De,ae.commandStr);var Ze="value"in ve?ve.value:1,Ae=!!ve.invert;return fe.command(typeof Ze=="number"&&Ze>=0&&Ze<=1,"sample.coverage.value must be a number between 0 and 1",ae.commandStr),[Ze,Ae]},function(ve,Ze,Ae){fe.optional(function(){ve.assert(Ze,Ae+"&&typeof "+Ae+'==="object"',"invalid sample.coverage")});var st=Ze.def('"value" in ',Ae,"?+",Ae,".value:1"),At=Ze.def("!!",Ae,".invert");return[st,At]})}}),Ot}function Fi(Ee,ae){var Ve=Ee.static,ot=Ee.dynamic,Ot={};return Object.keys(Ve).forEach(function(Ye){var De=Ve[Ye],Je;if(typeof De=="number"||typeof De=="boolean")Je=Po(function(){return De});else if(typeof De=="function"){var ve=De._reglType;ve==="texture2d"||ve==="textureCube"?Je=Po(function(Ze){return Ze.link(De)}):ve==="framebuffer"||ve==="framebufferCube"?(fe.command(De.color.length>0,'missing color attachment for framebuffer sent to uniform "'+Ye+'"',ae.commandStr),Je=Po(function(Ze){return Ze.link(De.color[0])})):fe.commandRaise('invalid data for uniform "'+Ye+'"',ae.commandStr)}else co(De)?Je=Po(function(Ze){var Ae=Ze.global.def("[",Ge(De.length,function(st){return fe.command(typeof De[st]=="number"||typeof De[st]=="boolean","invalid uniform "+Ye,Ze.commandStr),De[st]}),"]");return Ae}):fe.commandRaise('invalid or missing data for uniform "'+Ye+'"',ae.commandStr);Je.value=De,Ot[Ye]=Je}),Object.keys(ot).forEach(function(Ye){var De=ot[Ye];Ot[Ye]=js(De,function(Je,ve){return Je.invoke(ve,De)})}),Ot}function ts(Ee,ae){var Ve=Ee.static,ot=Ee.dynamic,Ot={};return Object.keys(Ve).forEach(function(Ye){var De=Ve[Ye],Je=ce.id(Ye),ve=new nt;if(jh(De))ve.state=Hn,ve.buffer=rr.getBuffer(rr.create(De,Jc,!1,!0)),ve.type=0;else{var Ze=rr.getBuffer(De);if(Ze)ve.state=Hn,ve.buffer=Ze,ve.type=0;else if(fe.command(typeof De=="object"&&De,"invalid data for attribute "+Ye,ae.commandStr),"constant"in De){var Ae=De.constant;ve.buffer="null",ve.state=di,typeof Ae=="number"?ve.x=Ae:(fe.command(co(Ae)&&Ae.length>0&&Ae.length<=4,"invalid constant for attribute "+Ye,ae.commandStr),li.forEach(function(Lr,An){An<Ae.length&&(ve[Lr]=Ae[An])}))}else{jh(De.buffer)?Ze=rr.getBuffer(rr.create(De.buffer,Jc,!1,!0)):Ze=rr.getBuffer(De.buffer),fe.command(!!Ze,'missing buffer for attribute "'+Ye+'"',ae.commandStr);var st=De.offset|0;fe.command(st>=0,'invalid offset for attribute "'+Ye+'"',ae.commandStr);var At=De.stride|0;fe.command(At>=0&&At<256,'invalid stride for attribute "'+Ye+'", must be integer betweeen [0, 255]',ae.commandStr);var cr=De.size|0;fe.command(!("size"in De)||cr>0&&cr<=4,'invalid size for attribute "'+Ye+'", must be 1,2,3,4',ae.commandStr);var zr=!!De.normalized,Ur=0;"type"in De&&(fe.commandParameter(De.type,fu,"invalid type for attribute "+Ye,ae.commandStr),Ur=fu[De.type]);var nn=De.divisor|0;fe.optional(function(){"divisor"in De&&(fe.command(nn===0||br,'cannot specify divisor for attribute "'+Ye+'", instancing not supported',ae.commandStr),fe.command(nn>=0,'invalid divisor for attribute "'+Ye+'"',ae.commandStr));var Lr=ae.commandStr,An=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(De).forEach(function(un){fe.command(An.indexOf(un)>=0,'unknown parameter "'+un+'" for attribute pointer "'+Ye+'" (valid parameters are '+An+")",Lr)})}),ve.buffer=Ze,ve.state=Hn,ve.size=cr,ve.normalized=zr,ve.type=Ur||Ze.dtype,ve.offset=st,ve.stride=At,ve.divisor=nn}}Ot[Ye]=Po(function(Lr,An){var un=Lr.attribCache;if(Je in un)return un[Je];var En={isStream:!1};return Object.keys(ve).forEach(function(bn){En[bn]=ve[bn]}),ve.buffer&&(En.buffer=Lr.link(ve.buffer),En.type=En.type||En.buffer+".dtype"),un[Je]=En,En})}),Object.keys(ot).forEach(function(Ye){var De=ot[Ye];function Je(ve,Ze){var Ae=ve.invoke(Ze,De),st=ve.shared,At=ve.constants,cr=st.isBufferArgs,zr=st.buffer;fe.optional(function(){ve.assert(Ze,Ae+"&&(typeof "+Ae+'==="object"||typeof '+Ae+'==="function")&&('+cr+"("+Ae+")||"+zr+".getBuffer("+Ae+")||"+zr+".getBuffer("+Ae+".buffer)||"+cr+"("+Ae+'.buffer)||("constant" in '+Ae+"&&(typeof "+Ae+'.constant==="number"||'+st.isArrayLike+"("+Ae+".constant))))",'invalid dynamic attribute "'+Ye+'"')});var Ur={isStream:Ze.def(!1)},nn=new nt;nn.state=Hn,Object.keys(nn).forEach(function(En){Ur[En]=Ze.def(""+nn[En])});var Lr=Ur.buffer,An=Ur.type;Ze("if(",cr,"(",Ae,")){",Ur.isStream,"=true;",Lr,"=",zr,".createStream(",Jc,",",Ae,");",An,"=",Lr,".dtype;","}else{",Lr,"=",zr,".getBuffer(",Ae,");","if(",Lr,"){",An,"=",Lr,".dtype;",'}else if("constant" in ',Ae,"){",Ur.state,"=",di,";","if(typeof "+Ae+'.constant === "number"){',Ur[li[0]],"=",Ae,".constant;",li.slice(1).map(function(En){return Ur[En]}).join("="),"=0;","}else{",li.map(function(En,bn){return Ur[En]+"="+Ae+".constant.length>"+bn+"?"+Ae+".constant["+bn+"]:0;"}).join(""),"}}else{","if(",cr,"(",Ae,".buffer)){",Lr,"=",zr,".createStream(",Jc,",",Ae,".buffer);","}else{",Lr,"=",zr,".getBuffer(",Ae,".buffer);","}",An,'="type" in ',Ae,"?",At.glTypes,"[",Ae,".type]:",Lr,".dtype;",Ur.normalized,"=!!",Ae,".normalized;");function un(En){Ze(Ur[En],"=",Ae,".",En,"|0;")}return un("size"),un("offset"),un("stride"),un("divisor"),Ze("}}"),Ze.exit("if(",Ur.isStream,"){",zr,".destroyStream(",Lr,");","}"),Ur}Ot[Ye]=js(De,Je)}),Ot}function ja(Ee){var ae=Ee.static,Ve=Ee.dynamic,ot={};return Object.keys(ae).forEach(function(Ot){var Ye=ae[Ot];ot[Ot]=Po(function(De,Je){return typeof Ye=="number"||typeof Ye=="boolean"?""+Ye:De.link(Ye)})}),Object.keys(Ve).forEach(function(Ot){var Ye=Ve[Ot];ot[Ot]=js(Ye,function(De,Je){return De.invoke(Je,Ye)})}),ot}function No(Ee,ae,Ve,ot,Ot){var Ye=Ee.static,De=Ee.dynamic;fe.optional(function(){var un=[ou,bl,gc,su,Bo,Jf,$c,kh,mc,eh].concat(Bn);function En(bn){Object.keys(bn).forEach(function(ln){fe.command(un.indexOf(ln)>=0,'unknown parameter "'+ln+'"',Ot.commandStr)})}En(Ye),En(De)});var Je=ci(Ee,ae),ve=rn(Ee,Ot),Ze=Qn(Ee,ve,Ot),Ae=so(Ee,Ot),st=uo(Ee,Ot),At=Ni(Ee,Ot,Je);function cr(un){var En=Ze[un];En&&(st[un]=En)}cr(au),cr(xn(Pf));var zr=Object.keys(st).length>0,Ur={framebuffer:ve,draw:Ae,shader:At,state:st,dirty:zr,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(Ur.profile=Hr(Ee,Ot),Ur.uniforms=Fi(Ve,Ot),Ur.drawVAO=Ur.scopeVAO=Ae.vao,!Ur.drawVAO&&At.program&&!Je&&Be.angle_instanced_arrays&&Ae.static.elements){var nn=!0,Lr=At.program.attributes.map(function(un){var En=ae.static[un];return nn=nn&&!!En,En});if(nn&&Lr.length>0){var An=xr.getVAO(xr.createVAO({attributes:Lr,elements:Ae.static.elements}));Ur.drawVAO=new qi(null,null,null,function(un,En){return un.link(An)}),Ur.useVAO=!0}}return Je?Ur.useVAO=!0:Ur.attributes=ts(ae,Ot),Ur.context=ja(ot,Ot),Ur}function So(Ee,ae,Ve){var ot=Ee.shared,Ot=ot.context,Ye=Ee.scope();Object.keys(Ve).forEach(function(De){ae.save(Ot,"."+De);var Je=Ve[De],ve=Je.append(Ee,ae);Array.isArray(ve)?Ye(Ot,".",De,"=[",ve.join(),"];"):Ye(Ot,".",De,"=",ve,";")}),ae(Ye)}function Wo(Ee,ae,Ve,ot){var Ot=Ee.shared,Ye=Ot.gl,De=Ot.framebuffer,Je;Nr&&(Je=ae.def(Ot.extensions,".webgl_draw_buffers"));var ve=Ee.constants,Ze=ve.drawBuffer,Ae=ve.backBuffer,st;Ve?st=Ve.append(Ee,ae):st=ae.def(De,".next"),ot||ae("if(",st,"!==",De,".cur){"),ae("if(",st,"){",Ye,".bindFramebuffer(",td,",",st,".framebuffer);"),Nr&&ae(Je,".drawBuffersWEBGL(",Ze,"[",st,".colorAttachments.length]);"),ae("}else{",Ye,".bindFramebuffer(",td,",null);"),Nr&&ae(Je,".drawBuffersWEBGL(",Ae,");"),ae("}",De,".cur=",st,";"),ot||ae("}")}function Oo(Ee,ae,Ve){var ot=Ee.shared,Ot=ot.gl,Ye=Ee.current,De=Ee.next,Je=ot.current,ve=ot.next,Ze=Ee.cond(Je,".dirty");Bn.forEach(function(Ae){var st=xn(Ae);if(!(st in Ve.state)){var At,cr;if(st in De){At=De[st],cr=Ye[st];var zr=Ge(Ir[st].length,function(nn){return Ze.def(At,"[",nn,"]")});Ze(Ee.cond(zr.map(function(nn,Lr){return nn+"!=="+cr+"["+Lr+"]"}).join("||")).then(Ot,".",tr[st],"(",zr,");",zr.map(function(nn,Lr){return cr+"["+Lr+"]="+nn}).join(";"),";"))}else{At=Ze.def(ve,".",st);var Ur=Ee.cond(At,"!==",Je,".",st);Ze(Ur),st in Jt?Ur(Ee.cond(At).then(Ot,".enable(",Jt[st],");").else(Ot,".disable(",Jt[st],");"),Je,".",st,"=",At,";"):Ur(Ot,".",tr[st],"(",At,");",Je,".",st,"=",At,";")}}}),Object.keys(Ve.state).length===0&&Ze(Je,".dirty=false;"),ae(Ze)}function cs(Ee,ae,Ve,ot){var Ot=Ee.shared,Ye=Ee.current,De=Ot.current,Je=Ot.gl;Oa(Object.keys(Ve)).forEach(function(ve){var Ze=Ve[ve];if(!(ot&&!ot(Ze))){var Ae=Ze.append(Ee,ae);if(Jt[ve]){var st=Jt[ve];bc(Ze)?Ae?ae(Je,".enable(",st,");"):ae(Je,".disable(",st,");"):ae(Ee.cond(Ae).then(Je,".enable(",st,");").else(Je,".disable(",st,");")),ae(De,".",ve,"=",Ae,";")}else if(co(Ae)){var At=Ye[ve];ae(Je,".",tr[ve],"(",Ae,");",Ae.map(function(cr,zr){return At+"["+zr+"]="+cr}).join(";"),";")}else ae(Je,".",tr[ve],"(",Ae,");",De,".",ve,"=",Ae,";")}})}function po(Ee,ae){br&&(Ee.instancing=ae.def(Ee.shared.extensions,".angle_instanced_arrays"))}function yi(Ee,ae,Ve,ot,Ot){var Ye=Ee.shared,De=Ee.stats,Je=Ye.current,ve=Ye.timer,Ze=Ve.profile;function Ae(){var un=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return un||typeof performance=="undefined"?"Date.now()":"performance.now()"}var st,At;function cr(un){st=ae.def(),un(st,"=",Ae(),";"),typeof Ot=="string"?un(De,".count+=",Ot,";"):un(De,".count++;"),gr&&(ot?(At=ae.def(),un(At,"=",ve,".getNumPendingQueries();")):un(ve,".beginQuery(",De,");"))}function zr(un){un(De,".cpuTime+=",Ae(),"-",st,";"),gr&&(ot?un(ve,".pushScopeStats(",At,",",ve,".getNumPendingQueries(),",De,");"):un(ve,".endQuery();"))}function Ur(un){var En=ae.def(Je,".profile");ae(Je,".profile=",un,";"),ae.exit(Je,".profile=",En,";")}var nn;if(Ze){if(bc(Ze)){Ze.enable?(cr(ae),zr(ae.exit),Ur("true")):Ur("false");return}nn=Ze.append(Ee,ae),Ur(nn)}else nn=ae.def(Je,".profile");var Lr=Ee.block();cr(Lr),ae("if(",nn,"){",Lr,"}");var An=Ee.block();zr(An),ae.exit("if(",nn,"){",An,"}")}function Io(Ee,ae,Ve,ot,Ot){var Ye=Ee.shared;function De(ve){switch(ve){case ih:case Nh:case sh:return 2;case Yl:case ql:case ef:return 3;case Sl:case oh:case kf:return 4;default:return 1}}function Je(ve,Ze,Ae){var st=Ye.gl,At=ae.def(ve,".location"),cr=ae.def(Ye.attributes,"[",At,"]"),zr=Ae.state,Ur=Ae.buffer,nn=[Ae.x,Ae.y,Ae.z,Ae.w],Lr=["buffer","normalized","offset","stride"];function An(){ae("if(!",cr,".buffer){",st,".enableVertexAttribArray(",At,");}");var En=Ae.type,bn;if(Ae.size?bn=ae.def(Ae.size,"||",Ze):bn=Ze,ae("if(",cr,".type!==",En,"||",cr,".size!==",bn,"||",Lr.map(function(Jn){return cr+"."+Jn+"!=="+Ae[Jn]}).join("||"),"){",st,".bindBuffer(",Jc,",",Ur,".buffer);",st,".vertexAttribPointer(",[At,bn,En,Ae.normalized,Ae.stride,Ae.offset],");",cr,".type=",En,";",cr,".size=",bn,";",Lr.map(function(Jn){return cr+"."+Jn+"="+Ae[Jn]+";"}).join(""),"}"),br){var ln=Ae.divisor;ae("if(",cr,".divisor!==",ln,"){",Ee.instancing,".vertexAttribDivisorANGLE(",[At,ln],");",cr,".divisor=",ln,";}")}}function un(){ae("if(",cr,".buffer){",st,".disableVertexAttribArray(",At,");",cr,".buffer=null;","}if(",li.map(function(En,bn){return cr+"."+En+"!=="+nn[bn]}).join("||"),"){",st,".vertexAttrib4f(",At,",",nn,");",li.map(function(En,bn){return cr+"."+En+"="+nn[bn]+";"}).join(""),"}")}zr===Hn?An():zr===di?un():(ae("if(",zr,"===",Hn,"){"),An(),ae("}else{"),un(),ae("}"))}ot.forEach(function(ve){var Ze=ve.name,Ae=Ve.attributes[Ze],st;if(Ae){if(!Ot(Ae))return;st=Ae.append(Ee,ae)}else{if(!Ot(nd))return;var At=Ee.scopeAttrib(Ze);fe.optional(function(){Ee.assert(ae,At+".state","missing attribute "+Ze)}),st={},Object.keys(new nt).forEach(function(cr){st[cr]=ae.def(At,".",cr)})}Je(Ee.link(ve),De(ve.info.type),st)})}function Ji(Ee,ae,Ve,ot,Ot,Ye){for(var De=Ee.shared,Je=De.gl,ve,Ze=0;Ze<ot.length;++Ze){var Ae=ot[Ze],st=Ae.name,At=Ae.info.type,cr=Ve.uniforms[st],zr=Ee.link(Ae),Ur=zr+".location",nn;if(cr){if(!Ot(cr))continue;if(bc(cr)){var Lr=cr.value;if(fe.command(Lr!==null&&typeof Lr!="undefined",'missing uniform "'+st+'"',Ee.commandStr),At===uh||At===lh){fe.command(typeof Lr=="function"&&(At===uh&&(Lr._reglType==="texture2d"||Lr._reglType==="framebuffer")||At===lh&&(Lr._reglType==="textureCube"||Lr._reglType==="framebufferCube")),"invalid texture for uniform "+st,Ee.commandStr);var An=Ee.link(Lr._texture||Lr.color[0]._texture);ae(Je,".uniform1i(",Ur,",",An+".bind());"),ae.exit(An,".unbind();")}else if(At===Zs||At===Lf||At===tf){fe.optional(function(){fe.command(co(Lr),"invalid matrix for uniform "+st,Ee.commandStr),fe.command(At===Zs&&Lr.length===4||At===Lf&&Lr.length===9||At===tf&&Lr.length===16,"invalid length for matrix uniform "+st,Ee.commandStr)});var un=Ee.global.def("new Float32Array(["+Array.prototype.slice.call(Lr)+"])"),En=2;At===Lf?En=3:At===tf&&(En=4),ae(Je,".uniformMatrix",En,"fv(",Ur,",false,",un,");")}else{switch(At){case nh:fe.commandType(Lr,"number","uniform "+st,Ee.commandStr),ve="1f";break;case ih:fe.command(co(Lr)&&Lr.length===2,"uniform "+st,Ee.commandStr),ve="2f";break;case Yl:fe.command(co(Lr)&&Lr.length===3,"uniform "+st,Ee.commandStr),ve="3f";break;case Sl:fe.command(co(Lr)&&Lr.length===4,"uniform "+st,Ee.commandStr),ve="4f";break;case Rf:fe.commandType(Lr,"boolean","uniform "+st,Ee.commandStr),ve="1i";break;case ah:fe.commandType(Lr,"number","uniform "+st,Ee.commandStr),ve="1i";break;case sh:fe.command(co(Lr)&&Lr.length===2,"uniform "+st,Ee.commandStr),ve="2i";break;case Nh:fe.command(co(Lr)&&Lr.length===2,"uniform "+st,Ee.commandStr),ve="2i";break;case ef:fe.command(co(Lr)&&Lr.length===3,"uniform "+st,Ee.commandStr),ve="3i";break;case ql:fe.command(co(Lr)&&Lr.length===3,"uniform "+st,Ee.commandStr),ve="3i";break;case kf:fe.command(co(Lr)&&Lr.length===4,"uniform "+st,Ee.commandStr),ve="4i";break;case oh:fe.command(co(Lr)&&Lr.length===4,"uniform "+st,Ee.commandStr),ve="4i";break}ae(Je,".uniform",ve,"(",Ur,",",co(Lr)?Array.prototype.slice.call(Lr):Lr,");")}continue}else nn=cr.append(Ee,ae)}else{if(!Ot(nd))continue;nn=ae.def(De.uniforms,"[",ce.id(st),"]")}At===uh?(fe(!Array.isArray(nn),"must specify a scalar prop for textures"),ae("if(",nn,"&&",nn,'._reglType==="framebuffer"){',nn,"=",nn,".color[0];","}")):At===lh&&(fe(!Array.isArray(nn),"must specify a scalar prop for cube maps"),ae("if(",nn,"&&",nn,'._reglType==="framebufferCube"){',nn,"=",nn,".color[0];","}")),fe.optional(function(){function Vs(Vu,uf){Ee.assert(ae,Vu,'bad data or missing for uniform "'+st+'".  '+uf)}function wl(Vu){fe(!Array.isArray(nn),"must not specify an array type for uniform"),Vs("typeof "+nn+'==="'+Vu+'"',"invalid type, expected "+Vu)}function ju(Vu,uf){Array.isArray(nn)?fe(nn.length===Vu,"must have length "+Vu):Vs(De.isArrayLike+"("+nn+")&&"+nn+".length==="+Vu,"invalid vector, should have length "+Vu,Ee.commandStr)}function ad(Vu){fe(!Array.isArray(nn),"must not specify a value type"),Vs("typeof "+nn+'==="function"&&'+nn+'._reglType==="texture'+(Vu===$p?"2d":"Cube")+'"',"invalid texture type",Ee.commandStr)}switch(At){case ah:wl("number");break;case Nh:ju(2,"number");break;case ql:ju(3,"number");break;case oh:ju(4,"number");break;case nh:wl("number");break;case ih:ju(2,"number");break;case Yl:ju(3,"number");break;case Sl:ju(4,"number");break;case Rf:wl("boolean");break;case sh:ju(2,"boolean");break;case ef:ju(3,"boolean");break;case kf:ju(4,"boolean");break;case Zs:ju(4,"number");break;case Lf:ju(9,"number");break;case tf:ju(16,"number");break;case uh:ad($p);break;case lh:ad(dp);break}});var bn=1;switch(At){case uh:case lh:var ln=ae.def(nn,"._texture");ae(Je,".uniform1i(",Ur,",",ln,".bind());"),ae.exit(ln,".unbind();");continue;case ah:case Rf:ve="1i";break;case Nh:case sh:ve="2i",bn=2;break;case ql:case ef:ve="3i",bn=3;break;case oh:case kf:ve="4i",bn=4;break;case nh:ve="1f";break;case ih:ve="2f",bn=2;break;case Yl:ve="3f",bn=3;break;case Sl:ve="4f",bn=4;break;case Zs:ve="Matrix2fv";break;case Lf:ve="Matrix3fv";break;case tf:ve="Matrix4fv";break}if(ve.charAt(0)==="M"){ae(Je,".uniform",ve,"(",Ur,",");var Jn=Math.pow(At-Zs+2,2),Sa=Ee.global.def("new Float32Array(",Jn,")");Array.isArray(nn)?ae("false,(",Ge(Jn,function(Vs){return Sa+"["+Vs+"]="+nn[Vs]}),",",Sa,")"):ae("false,(Array.isArray(",nn,")||",nn," instanceof Float32Array)?",nn,":(",Ge(Jn,function(Vs){return Sa+"["+Vs+"]="+nn+"["+Vs+"]"}),",",Sa,")"),ae(");")}else if(bn>1){for(var fs=[],Va=[],_a=0;_a<bn;++_a)Array.isArray(nn)?Va.push(nn[_a]):Va.push(ae.def(nn+"["+_a+"]")),Ye&&fs.push(ae.def());Ye&&ae("if(!",Ee.batchId,"||",fs.map(function(Vs,wl){return Vs+"!=="+Va[wl]}).join("||"),"){",fs.map(function(Vs,wl){return Vs+"="+Va[wl]+";"}).join("")),ae(Je,".uniform",ve,"(",Ur,",",Va.join(","),");"),Ye&&ae("}")}else{if(fe(!Array.isArray(nn),"uniform value must not be an array"),Ye){var Ql=ae.def();ae("if(!",Ee.batchId,"||",Ql,"!==",nn,"){",Ql,"=",nn,";")}ae(Je,".uniform",ve,"(",Ur,",",nn,");"),Ye&&ae("}")}}}function zo(Ee,ae,Ve,ot){var Ot=Ee.shared,Ye=Ot.gl,De=Ot.draw,Je=ot.draw;function ve(){var bn=Je.elements,ln,Jn=ae;return bn?((bn.contextDep&&ot.contextDynamic||bn.propDep)&&(Jn=Ve),ln=bn.append(Ee,Jn),Je.elementsActive&&Jn("if("+ln+")"+Ye+".bindBuffer("+Dh+","+ln+".buffer.buffer);")):(ln=Jn.def(),Jn(ln,"=",De,".",su,";","if(",ln,"){",Ye,".bindBuffer(",Dh,",",ln,".buffer.buffer);}","else if(",Ot.vao,".currentVAO){",ln,"=",Ee.shared.elements+".getElements("+Ot.vao,".currentVAO.elements);",ur?"":"if("+ln+")"+Ye+".bindBuffer("+Dh+","+ln+".buffer.buffer);","}")),ln}function Ze(){var bn=Je.count,ln,Jn=ae;return bn?((bn.contextDep&&ot.contextDynamic||bn.propDep)&&(Jn=Ve),ln=bn.append(Ee,Jn),fe.optional(function(){bn.MISSING&&Ee.assert(ae,"false","missing vertex count"),bn.DYNAMIC&&Ee.assert(Jn,ln+">=0","missing vertex count")})):(ln=Jn.def(De,".",$c),fe.optional(function(){Ee.assert(Jn,ln+">=0","missing vertex count")})),ln}var Ae=ve();function st(bn){var ln=Je[bn];return ln?ln.contextDep&&ot.contextDynamic||ln.propDep?ln.append(Ee,Ve):ln.append(Ee,ae):ae.def(De,".",bn)}var At=st(Bo),cr=st(Jf),zr=Ze();if(typeof zr=="number"){if(zr===0)return}else Ve("if(",zr,"){"),Ve.exit("}");var Ur,nn;br&&(Ur=st(kh),nn=Ee.instancing);var Lr=Ae+".type",An=Je.elements&&bc(Je.elements)&&!Je.vaoActive;function un(){function bn(){Ve(nn,".drawElementsInstancedANGLE(",[At,zr,Lr,cr+"<<(("+Lr+"-"+$n+")>>1)",Ur],");")}function ln(){Ve(nn,".drawArraysInstancedANGLE(",[At,cr,zr,Ur],");")}Ae&&Ae!=="null"?An?bn():(Ve("if(",Ae,"){"),bn(),Ve("}else{"),ln(),Ve("}")):ln()}function En(){function bn(){Ve(Ye+".drawElements("+[At,zr,Lr,cr+"<<(("+Lr+"-"+$n+")>>1)"]+");")}function ln(){Ve(Ye+".drawArrays("+[At,cr,zr]+");")}Ae&&Ae!=="null"?An?bn():(Ve("if(",Ae,"){"),bn(),Ve("}else{"),ln(),Ve("}")):ln()}br&&(typeof Ur!="number"||Ur>=0)?typeof Ur=="string"?(Ve("if(",Ur,">0){"),un(),Ve("}else if(",Ur,"<0){"),En(),Ve("}")):un():En()}function ti(Ee,ae,Ve,ot,Ot){var Ye=ai(),De=Ye.proc("body",Ot);return fe.optional(function(){Ye.commandStr=ae.commandStr,Ye.command=Ye.link(ae.commandStr)}),br&&(Ye.instancing=De.def(Ye.shared.extensions,".angle_instanced_arrays")),Ee(Ye,De,Ve,ot),Ye.compile().body}function zi(Ee,ae,Ve,ot){po(Ee,ae),Ve.useVAO?Ve.drawVAO?ae(Ee.shared.vao,".setVAO(",Ve.drawVAO.append(Ee,ae),");"):ae(Ee.shared.vao,".setVAO(",Ee.shared.vao,".targetVAO);"):(ae(Ee.shared.vao,".setVAO(null);"),Io(Ee,ae,Ve,ot.attributes,function(){return!0})),Ji(Ee,ae,Ve,ot.uniforms,function(){return!0},!1),zo(Ee,ae,ae,Ve)}function ma(Ee,ae){var Ve=Ee.proc("draw",1);po(Ee,Ve),So(Ee,Ve,ae.context),Wo(Ee,Ve,ae.framebuffer),Oo(Ee,Ve,ae),cs(Ee,Ve,ae.state),yi(Ee,Ve,ae,!1,!0);var ot=ae.shader.progVar.append(Ee,Ve);if(Ve(Ee.shared.gl,".useProgram(",ot,".program);"),ae.shader.program)zi(Ee,Ve,ae,ae.shader.program);else{Ve(Ee.shared.vao,".setVAO(null);");var Ot=Ee.global.def("{}"),Ye=Ve.def(ot,".id"),De=Ve.def(Ot,"[",Ye,"]");Ve(Ee.cond(De).then(De,".call(this,a0);").else(De,"=",Ot,"[",Ye,"]=",Ee.link(function(Je){return ti(zi,Ee,ae,Je,1)}),"(",ot,");",De,".call(this,a0);"))}Object.keys(ae.state).length>0&&Ve(Ee.shared.current,".dirty=true;"),Ee.shared.vao&&Ve(Ee.shared.vao,".setVAO(null);")}function Ln(Ee,ae,Ve,ot){Ee.batchId="a1",po(Ee,ae);function Ot(){return!0}Io(Ee,ae,Ve,ot.attributes,Ot),Ji(Ee,ae,Ve,ot.uniforms,Ot,!1),zo(Ee,ae,ae,Ve)}function ri(Ee,ae,Ve,ot){po(Ee,ae);var Ot=Ve.contextDep,Ye=ae.def(),De="a0",Je="a1",ve=ae.def();Ee.shared.props=ve,Ee.batchId=Ye;var Ze=Ee.scope(),Ae=Ee.scope();ae(Ze.entry,"for(",Ye,"=0;",Ye,"<",Je,";++",Ye,"){",ve,"=",De,"[",Ye,"];",Ae,"}",Ze.exit);function st(Lr){return Lr.contextDep&&Ot||Lr.propDep}function At(Lr){return!st(Lr)}if(Ve.needsContext&&So(Ee,Ae,Ve.context),Ve.needsFramebuffer&&Wo(Ee,Ae,Ve.framebuffer),cs(Ee,Ae,Ve.state,st),Ve.profile&&st(Ve.profile)&&yi(Ee,Ae,Ve,!1,!0),ot)Ve.useVAO?Ve.drawVAO?st(Ve.drawVAO)?Ae(Ee.shared.vao,".setVAO(",Ve.drawVAO.append(Ee,Ae),");"):Ze(Ee.shared.vao,".setVAO(",Ve.drawVAO.append(Ee,Ze),");"):Ze(Ee.shared.vao,".setVAO(",Ee.shared.vao,".targetVAO);"):(Ze(Ee.shared.vao,".setVAO(null);"),Io(Ee,Ze,Ve,ot.attributes,At),Io(Ee,Ae,Ve,ot.attributes,st)),Ji(Ee,Ze,Ve,ot.uniforms,At,!1),Ji(Ee,Ae,Ve,ot.uniforms,st,!0),zo(Ee,Ze,Ae,Ve);else{var cr=Ee.global.def("{}"),zr=Ve.shader.progVar.append(Ee,Ae),Ur=Ae.def(zr,".id"),nn=Ae.def(cr,"[",Ur,"]");Ae(Ee.shared.gl,".useProgram(",zr,".program);","if(!",nn,"){",nn,"=",cr,"[",Ur,"]=",Ee.link(function(Lr){return ti(Ln,Ee,Ve,Lr,2)}),"(",zr,");}",nn,".call(this,a0[",Ye,"],",Ye,");")}}function we(Ee,ae){var Ve=Ee.proc("batch",2);Ee.batchId="0",po(Ee,Ve);var ot=!1,Ot=!0;Object.keys(ae.context).forEach(function(cr){ot=ot||ae.context[cr].propDep}),ot||(So(Ee,Ve,ae.context),Ot=!1);var Ye=ae.framebuffer,De=!1;Ye?(Ye.propDep?ot=De=!0:Ye.contextDep&&ot&&(De=!0),De||Wo(Ee,Ve,Ye)):Wo(Ee,Ve,null),ae.state.viewport&&ae.state.viewport.propDep&&(ot=!0);function Je(cr){return cr.contextDep&&ot||cr.propDep}Oo(Ee,Ve,ae),cs(Ee,Ve,ae.state,function(cr){return!Je(cr)}),(!ae.profile||!Je(ae.profile))&&yi(Ee,Ve,ae,!1,"a1"),ae.contextDep=ot,ae.needsContext=Ot,ae.needsFramebuffer=De;var ve=ae.shader.progVar;if(ve.contextDep&&ot||ve.propDep)ri(Ee,Ve,ae,null);else{var Ze=ve.append(Ee,Ve);if(Ve(Ee.shared.gl,".useProgram(",Ze,".program);"),ae.shader.program)ri(Ee,Ve,ae,ae.shader.program);else{Ve(Ee.shared.vao,".setVAO(null);");var Ae=Ee.global.def("{}"),st=Ve.def(Ze,".id"),At=Ve.def(Ae,"[",st,"]");Ve(Ee.cond(At).then(At,".call(this,a0,a1);").else(At,"=",Ae,"[",st,"]=",Ee.link(function(cr){return ti(ri,Ee,ae,cr,2)}),"(",Ze,");",At,".call(this,a0,a1);"))}}Object.keys(ae.state).length>0&&Ve(Ee.shared.current,".dirty=true;"),Ee.shared.vao&&Ve(Ee.shared.vao,".setVAO(null);")}function zt(Ee,ae){var Ve=Ee.proc("scope",3);Ee.batchId="a2";var ot=Ee.shared,Ot=ot.current;So(Ee,Ve,ae.context),ae.framebuffer&&ae.framebuffer.append(Ee,Ve),Oa(Object.keys(ae.state)).forEach(function(De){var Je=ae.state[De],ve=Je.append(Ee,Ve);co(ve)?ve.forEach(function(Ze,Ae){Ve.set(Ee.next[De],"["+Ae+"]",Ze)}):Ve.set(ot.next,"."+De,ve)}),yi(Ee,Ve,ae,!0,!0),[su,Jf,$c,kh,Bo].forEach(function(De){var Je=ae.draw[De];!Je||Ve.set(ot.draw,"."+De,""+Je.append(Ee,Ve))}),Object.keys(ae.uniforms).forEach(function(De){var Je=ae.uniforms[De].append(Ee,Ve);Array.isArray(Je)&&(Je="["+Je.join()+"]"),Ve.set(ot.uniforms,"["+ce.id(De)+"]",Je)}),Object.keys(ae.attributes).forEach(function(De){var Je=ae.attributes[De].append(Ee,Ve),ve=Ee.scopeAttrib(De);Object.keys(new nt).forEach(function(Ze){Ve.set(ve,"."+Ze,Je[Ze])})}),ae.scopeVAO&&Ve.set(ot.vao,".targetVAO",ae.scopeVAO.append(Ee,Ve));function Ye(De){var Je=ae.shader[De];Je&&Ve.set(ot.shader,"."+De,Je.append(Ee,Ve))}Ye(bl),Ye(gc),Object.keys(ae.state).length>0&&(Ve(Ot,".dirty=true;"),Ve.exit(Ot,".dirty=true;")),Ve("a1(",Ee.shared.context,",a0,",Ee.batchId,");")}function St(Ee){if(!(typeof Ee!="object"||co(Ee))){for(var ae=Object.keys(Ee),Ve=0;Ve<ae.length;++Ve)if(Sn.isDynamic(Ee[ae[Ve]]))return!0;return!1}}function mn(Ee,ae,Ve){var ot=ae.static[Ve];if(!ot||!St(ot))return;var Ot=Ee.global,Ye=Object.keys(ot),De=!1,Je=!1,ve=!1,Ze=Ee.global.def("{}");Ye.forEach(function(st){var At=ot[st];if(Sn.isDynamic(At)){typeof At=="function"&&(At=ot[st]=Sn.unbox(At));var cr=js(At,null);De=De||cr.thisDep,ve=ve||cr.propDep,Je=Je||cr.contextDep}else{switch(Ot(Ze,".",st,"="),typeof At){case"number":Ot(At);break;case"string":Ot('"',At,'"');break;case"object":Array.isArray(At)&&Ot("[",At.join(),"]");break;default:Ot(Ee.link(At));break}Ot(";")}});function Ae(st,At){Ye.forEach(function(cr){var zr=ot[cr];if(!!Sn.isDynamic(zr)){var Ur=st.invoke(At,zr);At(Ze,".",cr,"=",Ur,";")}})}ae.dynamic[Ve]=new Sn.DynamicVariable(To,{thisDep:De,contextDep:Je,propDep:ve,ref:Ze,append:Ae}),delete ae.static[Ve]}function Gi(Ee,ae,Ve,ot,Ot){var Ye=ai();Ye.stats=Ye.link(Ot),Object.keys(ae.static).forEach(function(Je){mn(Ye,ae,Je)}),Pd.forEach(function(Je){mn(Ye,Ee,Je)});var De=No(Ee,ae,Ve,ot,Ye);return ma(Ye,De),zt(Ye,De),we(Ye,De),g(Ye.compile(),{destroy:function(){De.shader.program.destroy()}})}return{next:$r,current:Ir,procs:function(){var Ee=ai(),ae=Ee.proc("poll"),Ve=Ee.proc("refresh"),ot=Ee.block();ae(ot),Ve(ot);var Ot=Ee.shared,Ye=Ot.gl,De=Ot.next,Je=Ot.current;ot(Je,".dirty=false;"),Wo(Ee,ae),Wo(Ee,Ve,null,!0);var ve;br&&(ve=Ee.link(br)),Be.oes_vertex_array_object&&Ve(Ee.link(Be.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var Ze=0;Ze<Dt.maxAttributes;++Ze){var Ae=Ve.def(Ot.attributes,"[",Ze,"]"),st=Ee.cond(Ae,".buffer");st.then(Ye,".enableVertexAttribArray(",Ze,");",Ye,".bindBuffer(",Jc,",",Ae,".buffer.buffer);",Ye,".vertexAttribPointer(",Ze,",",Ae,".size,",Ae,".type,",Ae,".normalized,",Ae,".stride,",Ae,".offset);").else(Ye,".disableVertexAttribArray(",Ze,");",Ye,".vertexAttrib4f(",Ze,",",Ae,".x,",Ae,".y,",Ae,".z,",Ae,".w);",Ae,".buffer=null;"),Ve(st),br&&Ve(ve,".vertexAttribDivisorANGLE(",Ze,",",Ae,".divisor);")}return Ve(Ee.shared.vao,".currentVAO=null;",Ee.shared.vao,".setVAO(",Ee.shared.vao,".targetVAO);"),Object.keys(Jt).forEach(function(At){var cr=Jt[At],zr=ot.def(De,".",At),Ur=Ee.block();Ur("if(",zr,"){",Ye,".enable(",cr,")}else{",Ye,".disable(",cr,")}",Je,".",At,"=",zr,";"),Ve(Ur),ae("if(",zr,"!==",Je,".",At,"){",Ur,"}")}),Object.keys(tr).forEach(function(At){var cr=tr[At],zr=Ir[At],Ur,nn,Lr=Ee.block();if(Lr(Ye,".",cr,"("),co(zr)){var An=zr.length;Ur=Ee.global.def(De,".",At),nn=Ee.global.def(Je,".",At),Lr(Ge(An,function(un){return Ur+"["+un+"]"}),");",Ge(An,function(un){return nn+"["+un+"]="+Ur+"["+un+"];"}).join("")),ae("if(",Ge(An,function(un){return Ur+"["+un+"]!=="+nn+"["+un+"]"}).join("||"),"){",Lr,"}")}else Ur=ot.def(De,".",At),nn=ot.def(Je,".",At),Lr(Ur,");",Je,".",At,"=",Ur,";"),ae("if(",Ur,"!==",nn,"){",Lr,"}");Ve(Lr)}),Ee.compile()}(),compile:Gi}}function Ld(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Vh=34918,Dd=34919,yp=35007,Al=function(N,ce){if(!ce.ext_disjoint_timer_query)return null;var Be=[];function Dt(){return Be.pop()||ce.ext_disjoint_timer_query.createQueryEXT()}function rr(br){Be.push(br)}var Rt=[];function Qt(br){var Nr=Dt();ce.ext_disjoint_timer_query.beginQueryEXT(yp,Nr),Rt.push(Nr),gr(Rt.length-1,Rt.length,br)}function lr(){ce.ext_disjoint_timer_query.endQueryEXT(yp)}function dr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var xr=[];function wr(){return xr.pop()||new dr}function Tr(br){xr.push(br)}var jr=[];function gr(br,Nr,ur){var Ir=wr();Ir.startQueryIndex=br,Ir.endQueryIndex=Nr,Ir.sum=0,Ir.stats=ur,jr.push(Ir)}var Cr=[],nt=[];function Vt(){var br,Nr,ur=Rt.length;if(ur!==0){nt.length=Math.max(nt.length,ur+1),Cr.length=Math.max(Cr.length,ur+1),Cr[0]=0,nt[0]=0;var Ir=0;for(br=0,Nr=0;Nr<Rt.length;++Nr){var $r=Rt[Nr];ce.ext_disjoint_timer_query.getQueryObjectEXT($r,Dd)?(Ir+=ce.ext_disjoint_timer_query.getQueryObjectEXT($r,Vh),rr($r)):Rt[br++]=$r,Cr[Nr+1]=Ir,nt[Nr+1]=br}for(Rt.length=br,br=0,Nr=0;Nr<jr.length;++Nr){var Bn=jr[Nr],Jt=Bn.startQueryIndex,tr=Bn.endQueryIndex;Bn.sum+=Cr[tr]-Cr[Jt];var xn=nt[Jt],Vr=nt[tr];Vr===xn?(Bn.stats.gpuTime+=Bn.sum/1e6,Tr(Bn)):(Bn.startQueryIndex=xn,Bn.endQueryIndex=Vr,jr[br++]=Bn)}jr.length=br}}return{beginQuery:Qt,endQuery:lr,pushScopeStats:gr,update:Vt,getNumPendingQueries:function(){return Rt.length},clear:function(){Be.push.apply(Be,Rt);for(var br=0;br<Be.length;br++)ce.ext_disjoint_timer_query.deleteQueryEXT(Be[br]);Rt.length=0,Be.length=0},restore:function(){Rt.length=0,Be.length=0}}},ch=16384,Kl=256,id=1024,fh=34962,sf="webglcontextlost",Ea="webglcontextrestored",Gh=1,$l=2,Ff=3;function _p(N,ce){for(var Be=0;Be<N.length;++Be)if(N[Be]===ce)return Be;return-1}function Fd(N){var ce=pe(N);if(!ce)return null;var Be=ce.gl,Dt=Be.getContextAttributes(),rr=Be.isContextLost(),Rt=Me(Be,ce);if(!Rt)return null;var Qt=gs(),lr=Ld(),dr=Rt.extensions,xr=Al(Be,dr),wr=ao(),Tr=Be.drawingBufferWidth,jr=Be.drawingBufferHeight,gr={tick:0,time:0,viewportWidth:Tr,viewportHeight:jr,framebufferWidth:Tr,framebufferHeight:jr,drawingBufferWidth:Tr,drawingBufferHeight:jr,pixelRatio:ce.pixelRatio},Cr={},nt={elements:null,primitive:4,count:-1,offset:0,instances:-1},Vt=Ol(Be,dr),br=B(Be,lr,ce,Ir),Nr=ll(Be,dr,br,lr),ur=vt(Be,dr,Vt,lr,br,Nr,nt);function Ir(ti){return ur.destroyBuffer(ti)}var $r=kr(Be,Qt,lr,ce),Bn=As(Be,dr,Vt,function(){xn.procs.poll()},gr,lr,ce),Jt=dc(Be,dr,Vt,lr,ce),tr=Ie(Be,dr,Vt,Bn,Jt,lr),xn=gp(Be,Qt,dr,Vt,br,Nr,Bn,tr,Cr,ur,$r,nt,gr,xr,ce),Vr=kn(Be,tr,xn.procs.poll,gr,Dt,dr,Vt),Sr=xn.next,qr=Be.canvas,Kr=[],gi=[],ai=[],Hr=[ce.onDestroy],rn=null;function Qn(){if(Kr.length===0){xr&&xr.update(),rn=null;return}rn=Di.next(Qn),po();for(var ti=Kr.length-1;ti>=0;--ti){var zi=Kr[ti];zi&&zi(gr,null,0)}Be.flush(),xr&&xr.update()}function ci(){!rn&&Kr.length>0&&(rn=Di.next(Qn))}function Ni(){rn&&(Di.cancel(Qn),rn=null)}function so(ti){ti.preventDefault(),rr=!0,Ni(),gi.forEach(function(zi){zi()})}function uo(ti){Be.getError(),rr=!1,Rt.restore(),$r.restore(),br.restore(),Bn.restore(),Jt.restore(),tr.restore(),ur.restore(),xr&&xr.restore(),xn.procs.refresh(),ci(),ai.forEach(function(zi){zi()})}var Fi=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;!Fi&&qr&&(qr.addEventListener(sf,so,!1),qr.addEventListener(Ea,uo,!1));function ts(){Kr.length=0,Ni(),!Fi&&qr&&(qr.removeEventListener(sf,so),qr.removeEventListener(Ea,uo)),$r.clear(),tr.clear(),Jt.clear(),ur.clear(),Bn.clear(),Nr.clear(),br.clear(),xr&&xr.clear(),Hr.forEach(function(ti){ti()})}function ja(ti){fe(!!ti,"invalid args to regl({...})"),fe.type(ti,"object","invalid args to regl({...})");function zi(Ye){var De=g({},Ye);delete De.uniforms,delete De.attributes,delete De.context,delete De.vao,"stencil"in De&&De.stencil.op&&(De.stencil.opBack=De.stencil.opFront=De.stencil.op,delete De.stencil.op);function Je(ve){if(ve in De){var Ze=De[ve];delete De[ve],Object.keys(Ze).forEach(function(Ae){De[ve+"."+Ae]=Ze[Ae]})}}return Je("blend"),Je("depth"),Je("cull"),Je("stencil"),Je("polygonOffset"),Je("scissor"),Je("sample"),"vao"in Ye&&(De.vao=Ye.vao),De}function ma(Ye,De){var Je={},ve={};return Object.keys(Ye).forEach(function(Ze){var Ae=Ye[Ze];if(Sn.isDynamic(Ae)){ve[Ze]=Sn.unbox(Ae,Ze);return}else if(De&&Array.isArray(Ae)){for(var st=0;st<Ae.length;++st)if(Sn.isDynamic(Ae[st])){ve[Ze]=Sn.unbox(Ae,Ze);return}}Je[Ze]=Ae}),{dynamic:ve,static:Je}}var Ln=ma(ti.context||{},!0),ri=ma(ti.uniforms||{},!0),we=ma(ti.attributes||{},!1),zt=ma(zi(ti),!1),St={gpuTime:0,cpuTime:0,count:0},mn=xn.compile(zt,we,ri,Ln,St),Gi=mn.draw,Ee=mn.batch,ae=mn.scope,Ve=[];function ot(Ye){for(;Ve.length<Ye;)Ve.push(null);return Ve}function Ot(Ye,De){var Je;if(rr&&fe.raise("context lost"),typeof Ye=="function")return ae.call(this,null,Ye,0);if(typeof De=="function")if(typeof Ye=="number")for(Je=0;Je<Ye;++Je)ae.call(this,null,De,Je);else if(Array.isArray(Ye))for(Je=0;Je<Ye.length;++Je)ae.call(this,Ye[Je],De,Je);else return ae.call(this,Ye,De,0);else if(typeof Ye=="number"){if(Ye>0)return Ee.call(this,ot(Ye|0),Ye|0)}else if(Array.isArray(Ye)){if(Ye.length)return Ee.call(this,Ye,Ye.length)}else return Gi.call(this,Ye)}return g(Ot,{stats:St,destroy:function(){mn.destroy()}})}var No=tr.setFBO=ja({framebuffer:Sn.define.call(null,Gh,"framebuffer")});function So(ti,zi){var ma=0;xn.procs.poll();var Ln=zi.color;Ln&&(Be.clearColor(+Ln[0]||0,+Ln[1]||0,+Ln[2]||0,+Ln[3]||0),ma|=ch),"depth"in zi&&(Be.clearDepth(+zi.depth),ma|=Kl),"stencil"in zi&&(Be.clearStencil(zi.stencil|0),ma|=id),fe(!!ma,"called regl.clear with no buffer specified"),Be.clear(ma)}function Wo(ti){if(fe(typeof ti=="object"&&ti,"regl.clear() takes an object as input"),"framebuffer"in ti)if(ti.framebuffer&&ti.framebuffer_reglType==="framebufferCube")for(var zi=0;zi<6;++zi)No(g({framebuffer:ti.framebuffer.faces[zi]},ti),So);else No(ti,So);else So(null,ti)}function Oo(ti){fe.type(ti,"function","regl.frame() callback must be a function"),Kr.push(ti);function zi(){var ma=_p(Kr,ti);fe(ma>=0,"cannot cancel a frame twice");function Ln(){var ri=_p(Kr,Ln);Kr[ri]=Kr[Kr.length-1],Kr.length-=1,Kr.length<=0&&Ni()}Kr[ma]=Ln}return ci(),{cancel:zi}}function cs(){var ti=Sr.viewport,zi=Sr.scissor_box;ti[0]=ti[1]=zi[0]=zi[1]=0,gr.viewportWidth=gr.framebufferWidth=gr.drawingBufferWidth=ti[2]=zi[2]=Be.drawingBufferWidth,gr.viewportHeight=gr.framebufferHeight=gr.drawingBufferHeight=ti[3]=zi[3]=Be.drawingBufferHeight}function po(){gr.tick+=1,gr.time=Io(),cs(),xn.procs.poll()}function yi(){Bn.refresh(),cs(),xn.procs.refresh(),xr&&xr.update()}function Io(){return(ao()-wr)/1e3}yi();function Ji(ti,zi){fe.type(zi,"function","listener callback must be a function");var ma;switch(ti){case"frame":return Oo(zi);case"lost":ma=gi;break;case"restore":ma=ai;break;case"destroy":ma=Hr;break;default:fe.raise("invalid event, must be one of frame,lost,restore,destroy")}return ma.push(zi),{cancel:function(){for(var Ln=0;Ln<ma.length;++Ln)if(ma[Ln]===zi){ma[Ln]=ma[ma.length-1],ma.pop();return}}}}var zo=g(ja,{clear:Wo,prop:Sn.define.bind(null,Gh),context:Sn.define.bind(null,$l),this:Sn.define.bind(null,Ff),draw:ja({}),buffer:function(ti){return br.create(ti,fh,!1,!1)},elements:function(ti){return Nr.create(ti,!1)},texture:Bn.create2D,cube:Bn.createCube,renderbuffer:Jt.create,framebuffer:tr.create,framebufferCube:tr.createCube,vao:ur.createVAO,attributes:Dt,frame:Oo,on:Ji,limits:Vt,hasExtension:function(ti){return Vt.extensions.indexOf(ti.toLowerCase())>=0},read:Vr,destroy:ts,_gl:Be,_refresh:yi,poll:function(){po(),xr&&xr.update()},now:Io,stats:lr});return ce.onDone(null,zo),zo}return Fd})},49029:function(Er){var ne=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function Q(Ce){return Ce.match(ne)||[]}Er.exports=Q},29750:function(Er){function ne(Q,Ce,me){return Q===Q&&(me!==void 0&&(Q=Q<=me?Q:me),Ce!==void 0&&(Q=Q>=Ce?Q:Ce)),Q}Er.exports=ne},18674:function(Er){function ne(Q){return function(Ce){return Q==null?void 0:Q[Ce]}}Er.exports=ne},98805:function(Er,ne,Q){var Ce=Q(40180),me=Q(62689),g=Q(83140),Re=Q(79833);function W(he){return function(de){de=Re(de);var ze=me(de)?g(de):void 0,_e=ze?ze[0]:de.charAt(0),tt=ze?Ce(ze,1).join(""):de.slice(1);return _e[he]()+tt}}Er.exports=W},35393:function(Er,ne,Q){var Ce=Q(62663),me=Q(53816),g=Q(58748),Re="['\u2019]",W=RegExp(Re,"g");function he(de){return function(ze){return Ce(g(me(ze).replace(W,"")),de,"")}}Er.exports=he},69389:function(Er,ne,Q){var Ce=Q(18674),me={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},g=Ce(me);Er.exports=g},93157:function(Er){var ne=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function Q(Ce){return ne.test(Ce)}Er.exports=Q},2757:function(Er){var ne="\\ud800-\\udfff",Q="\\u0300-\\u036f",Ce="\\ufe20-\\ufe2f",me="\\u20d0-\\u20ff",g=Q+Ce+me,Re="\\u2700-\\u27bf",W="a-z\\xdf-\\xf6\\xf8-\\xff",he="\\xac\\xb1\\xd7\\xf7",de="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",ze="\\u2000-\\u206f",_e=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",tt="A-Z\\xc0-\\xd6\\xd8-\\xde",mt="\\ufe0e\\ufe0f",wt=he+de+ze+_e,Nt="['\u2019]",or="["+wt+"]",Tt="["+g+"]",Kt="\\d+",_t="["+Re+"]",ct="["+W+"]",it="[^"+ne+wt+Kt+Re+W+tt+"]",$t="\\ud83c[\\udffb-\\udfff]",Y="(?:"+Tt+"|"+$t+")",Xt="[^"+ne+"]",at="(?:\\ud83c[\\udde6-\\uddff]){2}",qe="[\\ud800-\\udbff][\\udc00-\\udfff]",Et="["+tt+"]",$e="\\u200d",Ht="(?:"+ct+"|"+it+")",mr="(?:"+Et+"|"+it+")",Fr="(?:"+Nt+"(?:d|ll|m|re|s|t|ve))?",Yr="(?:"+Nt+"(?:D|LL|M|RE|S|T|VE))?",S=Y+"?",Se="["+mt+"]?",ke="(?:"+$e+"(?:"+[Xt,at,qe].join("|")+")"+Se+S+")*",ut="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",ft="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",kt=Se+S+ke,Ft="(?:"+[_t,at,qe].join("|")+")"+kt,yr=RegExp([Et+"?"+ct+"+"+Fr+"(?="+[or,Et,"$"].join("|")+")",mr+"+"+Yr+"(?="+[or,Et+Ht,"$"].join("|")+")",Et+"?"+Ht+"+"+Fr,Et+"+"+Yr,ft,ut,Kt,Ft].join("|"),"g");function Yn(Gr){return Gr.match(yr)||[]}Er.exports=Yn},68929:function(Er,ne,Q){var Ce=Q(48403),me=Q(35393),g=me(function(Re,W,he){return W=W.toLowerCase(),Re+(he?Ce(W):W)});Er.exports=g},48403:function(Er,ne,Q){var Ce=Q(79833),me=Q(11700);function g(Re){return me(Ce(Re).toLowerCase())}Er.exports=g},74691:function(Er,ne,Q){var Ce=Q(29750),me=Q(14841);function g(Re,W,he){return he===void 0&&(he=W,W=void 0),he!==void 0&&(he=me(he),he=he===he?he:0),W!==void 0&&(W=me(W),W=W===W?W:0),Ce(me(Re),W,he)}Er.exports=g},53816:function(Er,ne,Q){var Ce=Q(69389),me=Q(79833),g=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Re="\\u0300-\\u036f",W="\\ufe20-\\ufe2f",he="\\u20d0-\\u20ff",de=Re+W+he,ze="["+de+"]",_e=RegExp(ze,"g");function tt(mt){return mt=me(mt),mt&&mt.replace(g,Ce).replace(_e,"")}Er.exports=tt},14293:function(Er){function ne(Q){return Q==null}Er.exports=ne},81763:function(Er,ne,Q){var Ce=Q(44239),me=Q(37005),g="[object Number]";function Re(W){return typeof W=="number"||me(W)&&Ce(W)==g}Er.exports=Re},30236:function(Er,ne,Q){var Ce=Q(42980),me=Q(21463),g=me(function(Re,W,he,de){Ce(Re,W,he,de)});Er.exports=g},44908:function(Er,ne,Q){var Ce=Q(45652);function me(g){return g&&g.length?Ce(g):[]}Er.exports=me},11700:function(Er,ne,Q){var Ce=Q(98805),me=Ce("toUpperCase");Er.exports=me},58748:function(Er,ne,Q){var Ce=Q(49029),me=Q(93157),g=Q(79833),Re=Q(2757);function W(he,de,ze){return he=g(he),de=ze?void 0:de,de===void 0?me(he)?Re(he):Ce(he):he.match(de)||[]}Er.exports=W},6158:function(Er){(function(ne,Q){Er.exports=Q()})(this,function(){"use strict";var ne,Q,Ce;function me(g,Re){if(!ne)ne=Re;else if(!Q)Q=Re;else{var W="var sharedChunk = {}; ("+ne+")(sharedChunk); ("+Q+")(sharedChunk);",he={};ne(he),Ce=Re(he),typeof window!="undefined"&&(Ce.workerUrl=window.URL.createObjectURL(new Blob([W],{type:"text/javascript"})))}}return me(["exports"],function(g){"use strict";function Re(t,o){return t(o={exports:{}},o.exports),o.exports}var W=he;function he(t,o,u,p){this.cx=3*t,this.bx=3*(u-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(p-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=p,this.p2x=u,this.p2y=p}he.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},he.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},he.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},he.prototype.solveCurveX=function(t,o){var u,p,y,b,C;for(o===void 0&&(o=1e-6),y=t,C=0;C<8;C++){if(b=this.sampleCurveX(y)-t,Math.abs(b)<o)return y;var O=this.sampleCurveDerivativeX(y);if(Math.abs(O)<1e-6)break;y-=b/O}if((y=t)<(u=0))return u;if(y>(p=1))return p;for(;u<p;){if(b=this.sampleCurveX(y),Math.abs(b-t)<o)return y;t>b?u=y:p=y,y=.5*(p-u)+u}return y},he.prototype.solve=function(t,o){return this.sampleCurveY(this.solveCurveX(t,o))};var de=ze;function ze(t,o){this.x=t,this.y=o}ze.prototype={clone:function(){return new ze(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,o){return this.clone()._rotateAround(t,o)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var o=t.x-this.x,u=t.y-this.y;return o*o+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,o){return Math.atan2(this.x*o-this.y*t,this.x*t+this.y*o)},_matMult:function(t){var o=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=o,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var o=Math.cos(t),u=Math.sin(t),p=u*this.x+o*this.y;return this.x=o*this.x-u*this.y,this.y=p,this},_rotateAround:function(t,o){var u=Math.cos(t),p=Math.sin(t),y=o.y+p*(this.x-o.x)+u*(this.y-o.y);return this.x=o.x+u*(this.x-o.x)-p*(this.y-o.y),this.y=y,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ze.convert=function(t){return t instanceof ze?t:Array.isArray(t)?new ze(t[0],t[1]):t};var _e=typeof self!="undefined"?self:{},tt=Math.pow(2,53)-1;function mt(t,o,u,p){var y=new W(t,o,u,p);return function(b){return y.solve(b)}}var wt=mt(.25,.1,.25,1);function Nt(t,o,u){return Math.min(u,Math.max(o,t))}function or(t,o,u){var p=u-o,y=((t-o)%p+p)%p+o;return y===o?u:y}function Tt(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];for(var p=0,y=o;p<y.length;p+=1){var b=y[p];for(var C in b)t[C]=b[C]}return t}var Kt=1;function _t(){return Kt++}function ct(){return function t(o){return o?(o^16*Math.random()>>o/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function it(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function $t(t,o){t.forEach(function(u){o[u]&&(o[u]=o[u].bind(o))})}function Y(t,o){return t.indexOf(o,t.length-o.length)!==-1}function Xt(t,o,u){var p={};for(var y in t)p[y]=o.call(u||this,t[y],y,t);return p}function at(t,o,u){var p={};for(var y in t)o.call(u||this,t[y],y,t)&&(p[y]=t[y]);return p}function qe(t){return Array.isArray(t)?t.map(qe):typeof t=="object"&&t?Xt(t,qe):t}var Et={};function $e(t){Et[t]||(typeof console!="undefined"&&console.warn(t),Et[t]=!0)}function Ht(t,o,u){return(u.y-t.y)*(o.x-t.x)>(o.y-t.y)*(u.x-t.x)}function mr(t){for(var o=0,u=0,p=t.length,y=p-1,b=void 0,C=void 0;u<p;y=u++)o+=((C=t[y]).x-(b=t[u]).x)*(b.y+C.y);return o}function Fr(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Yr(t){var o={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(p,y,b,C){var O=b||C;return o[y]=!O||O.toLowerCase(),""}),o["max-age"]){var u=parseInt(o["max-age"],10);isNaN(u)?delete o["max-age"]:o["max-age"]=u}return o}var S=null;function Se(t){if(S==null){var o=t.navigator?t.navigator.userAgent:null;S=!!t.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return S}function ke(t){try{var o=_e[t];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch(u){return!1}}var ut,ft,kt,Ft,yr=_e.performance&&_e.performance.now?_e.performance.now.bind(_e.performance):Date.now.bind(Date),Yn=_e.requestAnimationFrame||_e.mozRequestAnimationFrame||_e.webkitRequestAnimationFrame||_e.msRequestAnimationFrame,Gr=_e.cancelAnimationFrame||_e.mozCancelAnimationFrame||_e.webkitCancelAnimationFrame||_e.msCancelAnimationFrame,Nn={now:yr,frame:function(t){var o=Yn(t);return{cancel:function(){return Gr(o)}}},getImageData:function(t,o){o===void 0&&(o=0);var u=_e.document.createElement("canvas"),p=u.getContext("2d");if(!p)throw new Error("failed to create canvas 2d context");return u.width=t.width,u.height=t.height,p.drawImage(t,0,0,t.width,t.height),p.getImageData(-o,-o,t.width+2*o,t.height+2*o)},resolveURL:function(t){return ut||(ut=_e.document.createElement("a")),ut.href=t,ut.href},hardwareConcurrency:_e.navigator&&_e.navigator.hardwareConcurrency||4,get devicePixelRatio(){return _e.devicePixelRatio},get prefersReducedMotion(){return!!_e.matchMedia&&(ft==null&&(ft=_e.matchMedia("(prefers-reduced-motion: reduce)")),ft.matches)}},yn={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},zn={supported:!1,testSupport:function(t){!si&&Ft&&(Gn?fi(t):kt=t)}},si=!1,Gn=!1;function fi(t){var o=t.createTexture();t.bindTexture(t.TEXTURE_2D,o);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Ft),t.isContextLost())return;zn.supported=!0}catch(u){}t.deleteTexture(o),si=!0}_e.document&&((Ft=_e.document.createElement("img")).onload=function(){kt&&fi(kt),kt=null,Gn=!0},Ft.onerror=function(){si=!0,kt=null},Ft.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var na="01",Ui=function(t,o){this._transformRequestFn=t,this._customAccessToken=o,this._createSkuToken()};function Ii(t){return t.indexOf("mapbox:")===0}Ui.prototype._createSkuToken=function(){var t=function(){for(var o="",u=0;u<10;u++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",na,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},Ui.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Ui.prototype.transformRequest=function(t,o){return this._transformRequestFn&&this._transformRequestFn(t,o)||{url:t}},Ui.prototype.normalizeStyleURL=function(t,o){if(!Ii(t))return t;var u=aa(t);return u.path="/styles/v1"+u.path,this._makeAPIURL(u,this._customAccessToken||o)},Ui.prototype.normalizeGlyphsURL=function(t,o){if(!Ii(t))return t;var u=aa(t);return u.path="/fonts/v1"+u.path,this._makeAPIURL(u,this._customAccessToken||o)},Ui.prototype.normalizeSourceURL=function(t,o){if(!Ii(t))return t;var u=aa(t);return u.path="/v4/"+u.authority+".json",u.params.push("secure"),this._makeAPIURL(u,this._customAccessToken||o)},Ui.prototype.normalizeSpriteURL=function(t,o,u,p){var y=aa(t);return Ii(t)?(y.path="/styles/v1"+y.path+"/sprite"+o+u,this._makeAPIURL(y,this._customAccessToken||p)):(y.path+=""+o+u,oa(y))},Ui.prototype.normalizeTileURL=function(t,o){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Ii(t))return t;var u=aa(t);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,(Nn.devicePixelRatio>=2||o===512?"@2x":"")+(zn.supported?".webp":"$1")),u.path=u.path.replace(/^.+\/v4\//,"/"),u.path="/v4"+u.path;var p=this._customAccessToken||function(y){for(var b=0,C=y;b<C.length;b+=1){var O=C[b].match(/^access_token=(.*)$/);if(O)return O[1]}return null}(u.params)||yn.ACCESS_TOKEN;return yn.REQUIRE_ACCESS_TOKEN&&p&&this._skuToken&&u.params.push("sku="+this._skuToken),this._makeAPIURL(u,p)},Ui.prototype.canonicalizeTileURL=function(t,o){var u=aa(t);if(!u.path.match(/(^\/v4\/)/)||!u.path.match(/\.[\w]+$/))return t;var p="mapbox://tiles/";p+=u.path.replace("/v4/","");var y=u.params;return o&&(y=y.filter(function(b){return!b.match(/^access_token=/)})),y.length&&(p+="?"+y.join("&")),p},Ui.prototype.canonicalizeTileset=function(t,o){for(var u=!!o&&Ii(o),p=[],y=0,b=t.tiles||[];y<b.length;y+=1){var C=b[y];ia(C)?p.push(this.canonicalizeTileURL(C,u)):p.push(C)}return p},Ui.prototype._makeAPIURL=function(t,o){var u="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",p=aa(yn.API_URL);if(t.protocol=p.protocol,t.authority=p.authority,t.protocol==="http"){var y=t.params.indexOf("secure");y>=0&&t.params.splice(y,1)}if(p.path!=="/"&&(t.path=""+p.path+t.path),!yn.REQUIRE_ACCESS_TOKEN)return oa(t);if(!(o=o||yn.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+u);if(o[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+u);return t.params=t.params.filter(function(b){return b.indexOf("access_token")===-1}),t.params.push("access_token="+o),oa(t)};var $i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function ia(t){return $i.test(t)}var qa=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function aa(t){var o=t.match(qa);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function oa(t){var o=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+o}function Li(t){if(!t)return null;var o=t.split(".");if(!o||o.length!==3)return null;try{return JSON.parse(decodeURIComponent(_e.atob(o[1]).split("").map(function(u){return"%"+("00"+u.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(u){return null}}var Ki=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};Ki.prototype.getStorageKey=function(t){var o,u=Li(yn.ACCESS_TOKEN);return o=u&&u.u?_e.btoa(encodeURIComponent(u.u).replace(/%([0-9A-F]{2})/g,function(p,y){return String.fromCharCode(Number("0x"+y))})):yn.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+o:"mapbox.eventData:"+o},Ki.prototype.fetchEventData=function(){var t=ke("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{var p=_e.localStorage.getItem(o);p&&(this.eventData=JSON.parse(p));var y=_e.localStorage.getItem(u);y&&(this.anonId=y)}catch(b){$e("Unable to read from LocalStorage")}},Ki.prototype.saveEventData=function(){var t=ke("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{_e.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&_e.localStorage.setItem(o,JSON.stringify(this.eventData))}catch(p){$e("Unable to write to LocalStorage")}},Ki.prototype.processRequests=function(t){},Ki.prototype.postEvent=function(t,o,u,p){var y=this;if(yn.EVENTS_URL){var b=aa(yn.EVENTS_URL);b.params.push("access_token="+(p||yn.ACCESS_TOKEN||""));var C={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:na,userId:this.anonId},O=o?Tt(C,o):C,D={url:oa(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([O])};this.pendingRequest=ba(D,function(z){y.pendingRequest=null,u(z),y.saveEventData(),y.processRequests(p)})}},Ki.prototype.queueRequest=function(t,o){this.queue.push(t),this.processRequests(o)};var Hi,Ts,fe=function(t){function o(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.postMapLoadEvent=function(u,p,y,b){this.skuToken=y,(yn.EVENTS_URL&&b||yn.ACCESS_TOKEN&&Array.isArray(u)&&u.some(function(C){return Ii(C)||ia(C)}))&&this.queueRequest({id:p,timestamp:Date.now()},b)},o.prototype.processRequests=function(u){var p=this;if(!this.pendingRequest&&this.queue.length!==0){var y=this.queue.shift(),b=y.id,C=y.timestamp;b&&this.success[b]||(this.anonId||this.fetchEventData(),it(this.anonId)||(this.anonId=ct()),this.postEvent(C,{skuToken:this.skuToken},function(O){O||b&&(p.success[b]=!0)},u))}},o}(Ki),ui=new(function(t){function o(u){t.call(this,"appUserTurnstile"),this._customAccessToken=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.postTurnstileEvent=function(u,p){yn.EVENTS_URL&&yn.ACCESS_TOKEN&&Array.isArray(u)&&u.some(function(y){return Ii(y)||ia(y)})&&this.queueRequest(Date.now(),p)},o.prototype.processRequests=function(u){var p=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var y=Li(yn.ACCESS_TOKEN),b=y?y.u:yn.ACCESS_TOKEN,C=b!==this.eventData.tokenU;it(this.anonId)||(this.anonId=ct(),C=!0);var O=this.queue.shift();if(this.eventData.lastSuccess){var D=new Date(this.eventData.lastSuccess),z=new Date(O),Z=(O-this.eventData.lastSuccess)/864e5;C=C||Z>=1||Z<-1||D.getDate()!==z.getDate()}else C=!0;if(!C)return this.processRequests();this.postEvent(O,{"enabled.telemetry":!1},function(G){G||(p.eventData.lastSuccess=O,p.eventData.tokenU=b)},u)}},o}(Ki)),bo=ui.postTurnstileEvent.bind(ui),cu=new fe,Zt=cu.postMapLoadEvent.bind(cu),er=500,Rr=50;function an(){_e.caches&&!Hi&&(Hi=_e.caches.open("mapbox-tiles"))}function Mn(t){var o=t.indexOf("?");return o<0?t:t.slice(0,o)}var Un,bi=1/0;function vi(){return Un==null&&(Un=_e.OffscreenCanvas&&new _e.OffscreenCanvas(1,1).getContext("2d")&&typeof _e.createImageBitmap=="function"),Un}var Sn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Sn);var Di=function(t){function o(u,p,y){p===401&&ia(y)&&(u+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,u),this.status=p,this.url=y,this.name=this.constructor.name,this.message=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},o}(Error),Ri=Fr()?function(){return self.worker&&self.worker.referrer}:function(){return(_e.location.protocol==="blob:"?_e.parent:_e).location.href},ao,gs,Zo=function(t,o){if(!(/^file:/.test(u=t.url)||/^file:/.test(Ri())&&!/^\w+:/.test(u))){if(_e.fetch&&_e.Request&&_e.AbortController&&_e.Request.prototype.hasOwnProperty("signal"))return function(p,y){var b,C=new _e.AbortController,O=new _e.Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,referrer:Ri(),signal:C.signal}),D=!1,z=!1,Z=(b=O.url).indexOf("sku=")>0&&ia(b);p.type==="json"&&O.headers.set("Accept","application/json");var G=function(ie,Te,Oe){if(!z){if(ie&&ie.message!=="SecurityError"&&$e(ie),Te&&Oe)return q(Te);var k=Date.now();_e.fetch(O).then(function(Ue){if(Ue.ok){var rt=Z?Ue.clone():null;return q(Ue,rt,k)}return y(new Di(Ue.statusText,Ue.status,p.url))}).catch(function(Ue){Ue.code!==20&&y(new Error(Ue.message))})}},q=function(ie,Te,Oe){(p.type==="arrayBuffer"?ie.arrayBuffer():p.type==="json"?ie.json():ie.text()).then(function(k){z||(Te&&Oe&&function(Ue,rt,bt){if(an(),Hi){var Ut={status:rt.status,statusText:rt.statusText,headers:new _e.Headers};rt.headers.forEach(function(ir,Mr){return Ut.headers.set(Mr,ir)});var Gt=Yr(rt.headers.get("Cache-Control")||"");Gt["no-store"]||(Gt["max-age"]&&Ut.headers.set("Expires",new Date(bt+1e3*Gt["max-age"]).toUTCString()),new Date(Ut.headers.get("Expires")).getTime()-bt<42e4||function(ir,Mr){if(Ts===void 0)try{new Response(new ReadableStream),Ts=!0}catch(Dr){Ts=!1}Ts?Mr(ir.body):ir.blob().then(Mr)}(rt,function(ir){var Mr=new _e.Response(ir,Ut);an(),Hi&&Hi.then(function(Dr){return Dr.put(Mn(Ue.url),Mr)}).catch(function(Dr){return $e(Dr.message)})}))}}(O,Te,Oe),D=!0,y(null,k,ie.headers.get("Cache-Control"),ie.headers.get("Expires")))}).catch(function(k){z||y(new Error(k.message))})};return Z?function(ie,Te){if(an(),!Hi)return Te(null);var Oe=Mn(ie.url);Hi.then(function(k){k.match(Oe).then(function(Ue){var rt=function(bt){if(!bt)return!1;var Ut=new Date(bt.headers.get("Expires")||0),Gt=Yr(bt.headers.get("Cache-Control")||"");return Ut>Date.now()&&!Gt["no-cache"]}(Ue);k.delete(Oe),rt&&k.put(Oe,Ue.clone()),Te(null,Ue,rt)}).catch(Te)}).catch(Te)}(O,G):G(null,null),{cancel:function(){z=!0,D||C.abort()}}}(t,o);if(Fr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,o,void 0,!0)}var u;return function(p,y){var b=new _e.XMLHttpRequest;for(var C in b.open(p.method||"GET",p.url,!0),p.type==="arrayBuffer"&&(b.responseType="arraybuffer"),p.headers)b.setRequestHeader(C,p.headers[C]);return p.type==="json"&&(b.responseType="text",b.setRequestHeader("Accept","application/json")),b.withCredentials=p.credentials==="include",b.onerror=function(){y(new Error(b.statusText))},b.onload=function(){if((b.status>=200&&b.status<300||b.status===0)&&b.response!==null){var O=b.response;if(p.type==="json")try{O=JSON.parse(b.response)}catch(D){return y(D)}y(null,O,b.getResponseHeader("Cache-Control"),b.getResponseHeader("Expires"))}else y(new Di(b.statusText,b.status,p.url))},b.send(p.body),{cancel:function(){return b.abort()}}}(t,o)},Na=function(t,o){return Zo(Tt(t,{type:"arrayBuffer"}),o)},ba=function(t,o){return Zo(Tt(t,{method:"POST"}),o)},V="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";ao=[],gs=0;var $=function(t,o){if(zn.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),gs>=yn.MAX_PARALLEL_IMAGE_REQUESTS){var u={requestParameters:t,callback:o,cancelled:!1,cancel:function(){this.cancelled=!0}};return ao.push(u),u}gs++;var p=!1,y=function(){if(!p)for(p=!0,gs--;ao.length&&gs<yn.MAX_PARALLEL_IMAGE_REQUESTS;){var C=ao.shift();C.cancelled||(C.cancel=$(C.requestParameters,C.callback).cancel)}},b=Na(t,function(C,O,D,z){y(),C?o(C):O&&(vi()?function(Z,G){var q=new _e.Blob([new Uint8Array(Z)],{type:"image/png"});_e.createImageBitmap(q).then(function(ie){G(null,ie)}).catch(function(ie){G(new Error("Could not load image because of "+ie.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(O,o):function(Z,G,q,ie){var Te=new _e.Image,Oe=_e.URL;Te.onload=function(){G(null,Te),Oe.revokeObjectURL(Te.src),Te.onload=null,_e.requestAnimationFrame(function(){Te.src=V})},Te.onerror=function(){return G(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var k=new _e.Blob([new Uint8Array(Z)],{type:"image/png"});Te.cacheControl=q,Te.expires=ie,Te.src=Z.byteLength?Oe.createObjectURL(k):V}(O,o,D,z))});return{cancel:function(){b.cancel(),y()}}};function re(t,o,u){u[t]&&u[t].indexOf(o)!==-1||(u[t]=u[t]||[],u[t].push(o))}function pe(t,o,u){if(u&&u[t]){var p=u[t].indexOf(o);p!==-1&&u[t].splice(p,1)}}var Me=function(t,o){o===void 0&&(o={}),Tt(this,o),this.type=t},Ge=function(t){function o(u,p){p===void 0&&(p={}),t.call(this,"error",Tt({error:u},p))}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Me),Qe=function(){};Qe.prototype.on=function(t,o){return this._listeners=this._listeners||{},re(t,o,this._listeners),this},Qe.prototype.off=function(t,o){return pe(t,o,this._listeners),pe(t,o,this._oneTimeListeners),this},Qe.prototype.once=function(t,o){return this._oneTimeListeners=this._oneTimeListeners||{},re(t,o,this._oneTimeListeners),this},Qe.prototype.fire=function(t,o){typeof t=="string"&&(t=new Me(t,o||{}));var u=t.type;if(this.listens(u)){t.target=this;for(var p=0,y=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];p<y.length;p+=1)y[p].call(this,t);for(var b=0,C=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];b<C.length;b+=1){var O=C[b];pe(u,O,this._oneTimeListeners),O.call(this,t)}var D=this._eventedParent;D&&(Tt(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),D.fire(t))}else t instanceof Ge&&console.error(t.error);return this},Qe.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},Qe.prototype.setEventedParent=function(t,o){return this._eventedParent=t,this._eventedParentData=o,this};var se={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Le=function(t,o,u,p){this.message=(t?t+": ":"")+u,p&&(this.identifier=p),o!=null&&o.__line__&&(this.line=o.__line__)};function dt(t){var o=t.value;return o?[new Le(t.key,o,"constants have been deprecated as of v8")]:[]}function fr(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];for(var p=0,y=o;p<y.length;p+=1){var b=y[p];for(var C in b)t[C]=b[C]}return t}function Lt(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Bt(t){if(Array.isArray(t))return t.map(Bt);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var o={};for(var u in t)o[u]=Bt(t[u]);return o}return Lt(t)}var hr=function(t){function o(u,p){t.call(this,p),this.message=p,this.key=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Error),_n=function(t,o){o===void 0&&(o=[]),this.parent=t,this.bindings={};for(var u=0,p=o;u<p.length;u+=1){var y=p[u];this.bindings[y[0]]=y[1]}};_n.prototype.concat=function(t){return new _n(this,t)},_n.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},_n.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var fn={kind:"null"},Mt={kind:"number"},Jr={kind:"string"},Br={kind:"boolean"},Wr={kind:"color"},mi={kind:"object"},en={kind:"value"},dn={kind:"collator"},Wi={kind:"formatted"},hi={kind:"resolvedImage"};function wi(t,o){return{kind:"array",itemType:t,N:o}}function _i(t){if(t.kind==="array"){var o=_i(t.itemType);return typeof t.N=="number"?"array<"+o+", "+t.N+">":t.itemType.kind==="value"?"array":"array<"+o+">"}return t.kind}var ht=[fn,Mt,Jr,Br,Wr,Wi,mi,wi(en),hi];function Pt(t,o){if(o.kind==="error")return null;if(t.kind==="array"){if(o.kind==="array"&&(o.N===0&&o.itemType.kind==="value"||!Pt(t.itemType,o.itemType))&&(typeof t.N!="number"||t.N===o.N))return null}else{if(t.kind===o.kind)return null;if(t.kind==="value"){for(var u=0,p=ht;u<p.length;u+=1)if(!Pt(p[u],o))return null}}return"Expected "+_i(t)+" but found "+_i(o)+" instead."}function Ta(t,o){return o.some(function(u){return u.kind===t.kind})}function Ei(t,o){return o.some(function(u){return u==="null"?t===null:u==="array"?Array.isArray(t):u==="object"?t&&!Array.isArray(t)&&typeof t=="object":u===typeof t})}var Ti=Re(function(t,o){var u={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function p(O){return(O=Math.round(O))<0?0:O>255?255:O}function y(O){return p(O[O.length-1]==="%"?parseFloat(O)/100*255:parseInt(O))}function b(O){return(D=O[O.length-1]==="%"?parseFloat(O)/100:parseFloat(O))<0?0:D>1?1:D;var D}function C(O,D,z){return z<0?z+=1:z>1&&(z-=1),6*z<1?O+(D-O)*z*6:2*z<1?D:3*z<2?O+(D-O)*(2/3-z)*6:O}try{o.parseCSSColor=function(O){var D,z=O.replace(/ /g,"").toLowerCase();if(z in u)return u[z].slice();if(z[0]==="#")return z.length===4?(D=parseInt(z.substr(1),16))>=0&&D<=4095?[(3840&D)>>4|(3840&D)>>8,240&D|(240&D)>>4,15&D|(15&D)<<4,1]:null:z.length===7&&(D=parseInt(z.substr(1),16))>=0&&D<=16777215?[(16711680&D)>>16,(65280&D)>>8,255&D,1]:null;var Z=z.indexOf("("),G=z.indexOf(")");if(Z!==-1&&G+1===z.length){var q=z.substr(0,Z),ie=z.substr(Z+1,G-(Z+1)).split(","),Te=1;switch(q){case"rgba":if(ie.length!==4)return null;Te=b(ie.pop());case"rgb":return ie.length!==3?null:[y(ie[0]),y(ie[1]),y(ie[2]),Te];case"hsla":if(ie.length!==4)return null;Te=b(ie.pop());case"hsl":if(ie.length!==3)return null;var Oe=(parseFloat(ie[0])%360+360)%360/360,k=b(ie[1]),Ue=b(ie[2]),rt=Ue<=.5?Ue*(k+1):Ue+k-Ue*k,bt=2*Ue-rt;return[p(255*C(bt,rt,Oe+1/3)),p(255*C(bt,rt,Oe)),p(255*C(bt,rt,Oe-1/3)),Te];default:return null}}return null}}catch(O){}}).parseCSSColor,Zi=function(t,o,u,p){p===void 0&&(p=1),this.r=t,this.g=o,this.b=u,this.a=p};Zi.parse=function(t){if(t){if(t instanceof Zi)return t;if(typeof t=="string"){var o=Ti(t);if(o)return new Zi(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3])}}},Zi.prototype.toString=function(){var t=this.toArray(),o=t[1],u=t[2],p=t[3];return"rgba("+Math.round(t[0])+","+Math.round(o)+","+Math.round(u)+","+p+")"},Zi.prototype.toArray=function(){var t=this.a;return t===0?[0,0,0,0]:[255*this.r/t,255*this.g/t,255*this.b/t,t]},Zi.black=new Zi(0,0,0,1),Zi.white=new Zi(1,1,1,1),Zi.transparent=new Zi(0,0,0,0),Zi.red=new Zi(1,0,0,1);var Pr=function(t,o,u){this.sensitivity=t?o?"variant":"case":o?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Pr.prototype.compare=function(t,o){return this.collator.compare(t,o)},Pr.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var on=function(t,o,u,p,y){this.text=t,this.image=o,this.scale=u,this.fontStack=p,this.textColor=y},gt=function(t){this.sections=t};gt.fromString=function(t){return new gt([new on(t,null,null,null,null)])},gt.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(t){return t.text.length!==0||t.image&&t.image.name.length!==0})},gt.factory=function(t){return t instanceof gt?t:gt.fromString(t)},gt.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(t){return t.text}).join("")},gt.prototype.serialize=function(){for(var t=["format"],o=0,u=this.sections;o<u.length;o+=1){var p=u[o];if(p.image)t.push(["image",p.image.name]);else{t.push(p.text);var y={};p.fontStack&&(y["text-font"]=["literal",p.fontStack.split(",")]),p.scale&&(y["font-scale"]=p.scale),p.textColor&&(y["text-color"]=["rgba"].concat(p.textColor.toArray())),t.push(y)}}return t};var sa=function(t){this.name=t.name,this.available=t.available};function J(t,o,u,p){return typeof t=="number"&&t>=0&&t<=255&&typeof o=="number"&&o>=0&&o<=255&&typeof u=="number"&&u>=0&&u<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:"Invalid rgba value ["+[t,o,u,p].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof p=="number"?[t,o,u,p]:[t,o,u]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Ko(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Zi||t instanceof Pr||t instanceof gt||t instanceof sa)return!0;if(Array.isArray(t)){for(var o=0,u=t;o<u.length;o+=1)if(!Ko(u[o]))return!1;return!0}if(typeof t=="object"){for(var p in t)if(!Ko(t[p]))return!1;return!0}return!1}function ta(t){if(t===null)return fn;if(typeof t=="string")return Jr;if(typeof t=="boolean")return Br;if(typeof t=="number")return Mt;if(t instanceof Zi)return Wr;if(t instanceof Pr)return dn;if(t instanceof gt)return Wi;if(t instanceof sa)return hi;if(Array.isArray(t)){for(var o,u=t.length,p=0,y=t;p<y.length;p+=1){var b=ta(y[p]);if(o){if(o===b)continue;o=en;break}o=b}return wi(o||en,u)}return mi}function bu(t){var o=typeof t;return t===null?"":o==="string"||o==="number"||o==="boolean"?String(t):t instanceof Zi||t instanceof gt||t instanceof sa?t.toString():JSON.stringify(t)}sa.prototype.toString=function(){return this.name},sa.fromString=function(t){return t?new sa({name:t,available:!1}):null},sa.prototype.serialize=function(){return["image",this.name]};var za=function(t,o){this.type=t,this.value=o};za.parse=function(t,o){if(t.length!==2)return o.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!Ko(t[1]))return o.error("invalid value");var u=t[1],p=ta(u),y=o.expectedType;return p.kind!=="array"||p.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(p=y),new za(p,u)},za.prototype.evaluate=function(){return this.value},za.prototype.eachChild=function(){},za.prototype.outputDefined=function(){return!0},za.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Zi?["rgba"].concat(this.value.toArray()):this.value instanceof gt?this.value.serialize():this.value};var Ma=function(t){this.name="ExpressionEvaluationError",this.message=t};Ma.prototype.toJSON=function(){return this.message};var Ka={string:Jr,number:Mt,boolean:Br,object:mi},ua=function(t,o){this.type=t,this.args=o};ua.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u,p=1,y=t[0];if(y==="array"){var b,C;if(t.length>2){var O=t[1];if(typeof O!="string"||!(O in Ka)||O==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);b=Ka[O],p++}else b=en;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return o.error('The length argument to "array" must be a positive integer literal',2);C=t[2],p++}u=wi(b,C)}else u=Ka[y];for(var D=[];p<t.length;p++){var z=o.parse(t[p],p,en);if(!z)return null;D.push(z)}return new ua(u,D)},ua.prototype.evaluate=function(t){for(var o=0;o<this.args.length;o++){var u=this.args[o].evaluate(t);if(!Pt(this.type,ta(u)))return u;if(o===this.args.length-1)throw new Ma("Expected value to be of type "+_i(this.type)+", but found "+_i(ta(u))+" instead.")}return null},ua.prototype.eachChild=function(t){this.args.forEach(t)},ua.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},ua.prototype.serialize=function(){var t=this.type,o=[t.kind];if(t.kind==="array"){var u=t.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){o.push(u.kind);var p=t.N;(typeof p=="number"||this.args.length>1)&&o.push(p)}}return o.concat(this.args.map(function(y){return y.serialize()}))};var Ao=function(t){this.type=Wi,this.sections=t};Ao.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u=t[1];if(!Array.isArray(u)&&typeof u=="object")return o.error("First argument must be an image or text section.");for(var p=[],y=!1,b=1;b<=t.length-1;++b){var C=t[b];if(y&&typeof C=="object"&&!Array.isArray(C)){y=!1;var O=null;if(C["font-scale"]&&!(O=o.parse(C["font-scale"],1,Mt)))return null;var D=null;if(C["text-font"]&&!(D=o.parse(C["text-font"],1,wi(Jr))))return null;var z=null;if(C["text-color"]&&!(z=o.parse(C["text-color"],1,Wr)))return null;var Z=p[p.length-1];Z.scale=O,Z.font=D,Z.textColor=z}else{var G=o.parse(t[b],1,en);if(!G)return null;var q=G.type.kind;if(q!=="string"&&q!=="value"&&q!=="null"&&q!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,p.push({content:G,scale:null,font:null,textColor:null})}}return new Ao(p)},Ao.prototype.evaluate=function(t){return new gt(this.sections.map(function(o){var u=o.content.evaluate(t);return ta(u)===hi?new on("",u,null,null,null):new on(bu(u),null,o.scale?o.scale.evaluate(t):null,o.font?o.font.evaluate(t).join(","):null,o.textColor?o.textColor.evaluate(t):null)}))},Ao.prototype.eachChild=function(t){for(var o=0,u=this.sections;o<u.length;o+=1){var p=u[o];t(p.content),p.scale&&t(p.scale),p.font&&t(p.font),p.textColor&&t(p.textColor)}},Ao.prototype.outputDefined=function(){return!1},Ao.prototype.serialize=function(){for(var t=["format"],o=0,u=this.sections;o<u.length;o+=1){var p=u[o];t.push(p.content.serialize());var y={};p.scale&&(y["font-scale"]=p.scale.serialize()),p.font&&(y["text-font"]=p.font.serialize()),p.textColor&&(y["text-color"]=p.textColor.serialize()),t.push(y)}return t};var jo=function(t){this.type=hi,this.input=t};jo.parse=function(t,o){if(t.length!==2)return o.error("Expected two arguments.");var u=o.parse(t[1],1,Jr);return u?new jo(u):o.error("No image name provided.")},jo.prototype.evaluate=function(t){var o=this.input.evaluate(t),u=sa.fromString(o);return u&&t.availableImages&&(u.available=t.availableImages.indexOf(o)>-1),u},jo.prototype.eachChild=function(t){t(this.input)},jo.prototype.outputDefined=function(){return!1},jo.prototype.serialize=function(){return["image",this.input.serialize()]};var wu={"to-boolean":Br,"to-color":Wr,"to-number":Mt,"to-string":Jr},vo=function(t,o){this.type=t,this.args=o};vo.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u=t[0];if((u==="to-boolean"||u==="to-string")&&t.length!==2)return o.error("Expected one argument.");for(var p=wu[u],y=[],b=1;b<t.length;b++){var C=o.parse(t[b],b,en);if(!C)return null;y.push(C)}return new vo(p,y)},vo.prototype.evaluate=function(t){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(t));if(this.type.kind==="color"){for(var o,u,p=0,y=this.args;p<y.length;p+=1){if(u=null,(o=y[p].evaluate(t))instanceof Zi)return o;if(typeof o=="string"){var b=t.parseColor(o);if(b)return b}else if(Array.isArray(o)&&!(u=o.length<3||o.length>4?"Invalid rbga value "+JSON.stringify(o)+": expected an array containing either three or four numeric values.":J(o[0],o[1],o[2],o[3])))return new Zi(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new Ma(u||"Could not parse color from value '"+(typeof o=="string"?o:String(JSON.stringify(o)))+"'")}if(this.type.kind==="number"){for(var C=null,O=0,D=this.args;O<D.length;O+=1){if((C=D[O].evaluate(t))===null)return 0;var z=Number(C);if(!isNaN(z))return z}throw new Ma("Could not convert "+JSON.stringify(C)+" to number.")}return this.type.kind==="formatted"?gt.fromString(bu(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?sa.fromString(bu(this.args[0].evaluate(t))):bu(this.args[0].evaluate(t))},vo.prototype.eachChild=function(t){this.args.forEach(t)},vo.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},vo.prototype.serialize=function(){if(this.type.kind==="formatted")return new Ao([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new jo(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild(function(o){t.push(o.serialize())}),t};var Do=["Unknown","Point","LineString","Polygon"],la=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};la.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},la.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Do[this.feature.type]:this.feature.type:null},la.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},la.prototype.canonicalID=function(){return this.canonical},la.prototype.properties=function(){return this.feature&&this.feature.properties||{}},la.prototype.parseColor=function(t){var o=this._parseColorCache[t];return o||(o=this._parseColorCache[t]=Zi.parse(t)),o};var $a=function(t,o,u,p){this.name=t,this.type=o,this._evaluate=u,this.args=p};$a.prototype.evaluate=function(t){return this._evaluate(t,this.args)},$a.prototype.eachChild=function(t){this.args.forEach(t)},$a.prototype.outputDefined=function(){return!1},$a.prototype.serialize=function(){return[this.name].concat(this.args.map(function(t){return t.serialize()}))},$a.parse=function(t,o){var u,p=t[0],y=$a.definitions[p];if(!y)return o.error('Unknown expression "'+p+'". If you wanted a literal array, use ["literal", [...]].',0);for(var b=Array.isArray(y)?y[0]:y.type,C=Array.isArray(y)?[[y[1],y[2]]]:y.overloads,O=C.filter(function(Vn){var hn=Vn[0];return!Array.isArray(hn)||hn.length===t.length-1}),D=null,z=0,Z=O;z<Z.length;z+=1){var G=Z[z],q=G[0],ie=G[1];D=new Fs(o.registry,o.path,null,o.scope);for(var Te=[],Oe=!1,k=1;k<t.length;k++){var Ue=t[k],rt=Array.isArray(q)?q[k-1]:q.type,bt=D.parse(Ue,1+Te.length,rt);if(!bt){Oe=!0;break}Te.push(bt)}if(!Oe)if(Array.isArray(q)&&q.length!==Te.length)D.error("Expected "+q.length+" arguments, but found "+Te.length+" instead.");else{for(var Ut=0;Ut<Te.length;Ut++){var Gt=Array.isArray(q)?q[Ut]:q.type,ir=Te[Ut];D.concat(Ut+1).checkSubtype(Gt,ir.type)}if(D.errors.length===0)return new $a(p,b,ie,Te)}}if(O.length===1)(u=o.errors).push.apply(u,D.errors);else{for(var Mr=(O.length?O:C).map(function(Vn){var hn;return hn=Vn[0],Array.isArray(hn)?"("+hn.map(_i).join(", ")+")":"("+_i(hn.type)+"...)"}).join(" | "),Dr=[],Dn=1;Dn<t.length;Dn++){var cn=o.parse(t[Dn],1+Dr.length);if(!cn)return null;Dr.push(_i(cn.type))}o.error("Expected arguments of type "+Mr+", but found ("+Dr.join(", ")+") instead.")}return null},$a.register=function(t,o){for(var u in $a.definitions=o,o)t[u]=$a};var Fo=function(t,o,u){this.type=dn,this.locale=u,this.caseSensitive=t,this.diacriticSensitive=o};function Qa(t,o){t[0]=Math.min(t[0],o[0]),t[1]=Math.min(t[1],o[1]),t[2]=Math.max(t[2],o[0]),t[3]=Math.max(t[3],o[1])}function Ms(t,o){return!(t[0]<=o[0]||t[2]>=o[2]||t[1]<=o[1]||t[3]>=o[3])}function Ol(t,o){var u=(180+t[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,y=Math.pow(2,o.z);return[Math.round(u*y*8192),Math.round(p*y*8192)]}function ys(t,o,u){return o[1]>t[1]!=u[1]>t[1]&&t[0]<(u[0]-o[0])*(t[1]-o[1])/(u[1]-o[1])+o[0]}function te(t,o){for(var u,p,y,b,C,O,D,z=!1,Z=0,G=o.length;Z<G;Z++)for(var q=o[Z],ie=0,Te=q.length;ie<Te-1;ie++){if((b=(u=t)[0]-(p=q[ie])[0])*(D=u[1]-(y=q[ie+1])[1])-(O=u[0]-y[0])*(C=u[1]-p[1])==0&&b*O<=0&&C*D<=0)return!1;ys(t,q[ie],q[ie+1])&&(z=!z)}return z}function ye(t,o){for(var u=0;u<o.length;u++)if(te(t,o[u]))return!0;return!1}function Xe(t,o,u,p){var y=p[0]-u[0],b=p[1]-u[1],C=(t[0]-u[0])*b-y*(t[1]-u[1]),O=(o[0]-u[0])*b-y*(o[1]-u[1]);return C>0&&O<0||C<0&&O>0}function It(t,o,u){for(var p=0,y=u;p<y.length;p+=1)for(var b=y[p],C=0;C<b.length-1;++C)if((G=[(Z=b[C+1])[0]-(z=b[C])[0],Z[1]-z[1]])[0]*(q=[(D=o)[0]-(O=t)[0],D[1]-O[1]])[1]-G[1]*q[0]!=0&&Xe(O,D,z,Z)&&Xe(z,Z,O,D))return!0;var O,D,z,Z,G,q;return!1}function Or(t,o){for(var u=0;u<t.length;++u)if(!te(t[u],o))return!1;for(var p=0;p<t.length-1;++p)if(It(t[p],t[p+1],o))return!1;return!0}function On(t,o){for(var u=0;u<o.length;u++)if(Or(t,o[u]))return!0;return!1}function Mi(t,o,u){for(var p=[],y=0;y<t.length;y++){for(var b=[],C=0;C<t[y].length;C++){var O=Ol(t[y][C],u);Qa(o,O),b.push(O)}p.push(b)}return p}function oo(t,o,u){for(var p=[],y=0;y<t.length;y++){var b=Mi(t[y],o,u);p.push(b)}return p}function Ra(t,o,u,p){if(t[0]<u[0]||t[0]>u[2]){var y=.5*p,b=t[0]-u[0]>y?-p:u[0]-t[0]>y?p:0;b===0&&(b=t[0]-u[2]>y?-p:u[2]-t[0]>y?p:0),t[0]+=b}Qa(o,t)}function Ua(t,o,u,p){for(var y=8192*Math.pow(2,p.z),b=[8192*p.x,8192*p.y],C=[],O=0,D=t;O<D.length;O+=1)for(var z=0,Z=D[O];z<Z.length;z+=1){var G=Z[z],q=[G.x+b[0],G.y+b[1]];Ra(q,o,u,y),C.push(q)}return C}function Vo(t,o,u,p){for(var y,b=8192*Math.pow(2,p.z),C=[8192*p.x,8192*p.y],O=[],D=0,z=t;D<z.length;D+=1){for(var Z=[],G=0,q=z[D];G<q.length;G+=1){var ie=q[G],Te=[ie.x+C[0],ie.y+C[1]];Qa(o,Te),Z.push(Te)}O.push(Z)}if(o[2]-o[0]<=b/2){(y=o)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(var Oe=0,k=O;Oe<k.length;Oe+=1)for(var Ue=0,rt=k[Oe];Ue<rt.length;Ue+=1)Ra(rt[Ue],o,u,b)}return O}Fo.parse=function(t,o){if(t.length!==2)return o.error("Expected one argument.");var u=t[1];if(typeof u!="object"||Array.isArray(u))return o.error("Collator options argument must be an object.");var p=o.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,Br);if(!p)return null;var y=o.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,Br);if(!y)return null;var b=null;return u.locale&&!(b=o.parse(u.locale,1,Jr))?null:new Fo(p,y,b)},Fo.prototype.evaluate=function(t){return new Pr(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},Fo.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},Fo.prototype.outputDefined=function(){return!1},Fo.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var _s=function(t,o){this.type=Br,this.geojson=t,this.geometries=o};function lo(t){if(t instanceof $a&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof _s)return!1;var o=!0;return t.eachChild(function(u){o&&!lo(u)&&(o=!1)}),o}function wo(t){if(t instanceof $a&&t.name==="feature-state")return!1;var o=!0;return t.eachChild(function(u){o&&!wo(u)&&(o=!1)}),o}function xs(t,o){if(t instanceof $a&&o.indexOf(t.name)>=0)return!1;var u=!0;return t.eachChild(function(p){u&&!xs(p,o)&&(u=!1)}),u}_s.parse=function(t,o){if(t.length!==2)return o.error("'within' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(Ko(t[1])){var u=t[1];if(u.type==="FeatureCollection")for(var p=0;p<u.features.length;++p){var y=u.features[p].geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new _s(u,u.features[p].geometry)}else if(u.type==="Feature"){var b=u.geometry.type;if(b==="Polygon"||b==="MultiPolygon")return new _s(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new _s(u,u)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")},_s.prototype.evaluate=function(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(o,u){var p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=o.canonicalID();if(u.type==="Polygon"){var C=Mi(u.coordinates,y,b),O=Ua(o.geometry(),p,y,b);if(!Ms(p,y))return!1;for(var D=0,z=O;D<z.length;D+=1)if(!te(z[D],C))return!1}if(u.type==="MultiPolygon"){var Z=oo(u.coordinates,y,b),G=Ua(o.geometry(),p,y,b);if(!Ms(p,y))return!1;for(var q=0,ie=G;q<ie.length;q+=1)if(!ye(ie[q],Z))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(o,u){var p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=o.canonicalID();if(u.type==="Polygon"){var C=Mi(u.coordinates,y,b),O=Vo(o.geometry(),p,y,b);if(!Ms(p,y))return!1;for(var D=0,z=O;D<z.length;D+=1)if(!Or(z[D],C))return!1}if(u.type==="MultiPolygon"){var Z=oo(u.coordinates,y,b),G=Vo(o.geometry(),p,y,b);if(!Ms(p,y))return!1;for(var q=0,ie=G;q<ie.length;q+=1)if(!On(ie[q],Z))return!1}return!0}(t,this.geometries)}return!1},_s.prototype.eachChild=function(){},_s.prototype.outputDefined=function(){return!0},_s.prototype.serialize=function(){return["within",this.geojson]};var Ps=function(t,o){this.type=o.type,this.name=t,this.boundExpression=o};Ps.parse=function(t,o){if(t.length!==2||typeof t[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");var u=t[1];return o.scope.has(u)?new Ps(u,o.scope.get(u)):o.error('Unknown variable "'+u+'". Make sure "'+u+'" has been bound in an enclosing "let" expression before using it.',1)},Ps.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},Ps.prototype.eachChild=function(){},Ps.prototype.outputDefined=function(){return!1},Ps.prototype.serialize=function(){return["var",this.name]};var Fs=function(t,o,u,p,y){o===void 0&&(o=[]),p===void 0&&(p=new _n),y===void 0&&(y=[]),this.registry=t,this.path=o,this.key=o.map(function(b){return"["+b+"]"}).join(""),this.scope=p,this.errors=y,this.expectedType=u};function fu(t,o){for(var u,p=t.length-1,y=0,b=p,C=0;y<=b;)if((u=t[C=Math.floor((y+b)/2)])<=o){if(C===p||o<t[C+1])return C;y=C+1}else{if(!(u>o))throw new Ma("Input is not a number.");b=C-1}return 0}Fs.prototype.parse=function(t,o,u,p,y){return y===void 0&&(y={}),o?this.concat(o,u,p)._parse(t,y):this._parse(t,y)},Fs.prototype._parse=function(t,o){function u(z,Z,G){return G==="assert"?new ua(Z,[z]):G==="coerce"?new vo(Z,[z]):z}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var p=t[0];if(typeof p!="string")return this.error("Expression name must be a string, but found "+typeof p+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var y=this.registry[p];if(y){var b=y.parse(t,this);if(!b)return null;if(this.expectedType){var C=this.expectedType,O=b.type;if(C.kind!=="string"&&C.kind!=="number"&&C.kind!=="boolean"&&C.kind!=="object"&&C.kind!=="array"||O.kind!=="value")if(C.kind!=="color"&&C.kind!=="formatted"&&C.kind!=="resolvedImage"||O.kind!=="value"&&O.kind!=="string"){if(this.checkSubtype(C,O))return null}else b=u(b,C,o.typeAnnotation||"coerce");else b=u(b,C,o.typeAnnotation||"assert")}if(!(b instanceof za)&&b.type.kind!=="resolvedImage"&&function z(Z){if(Z instanceof Ps)return z(Z.boundExpression);if(Z instanceof $a&&Z.name==="error"||Z instanceof Fo||Z instanceof _s)return!1;var G=Z instanceof vo||Z instanceof ua,q=!0;return Z.eachChild(function(ie){q=G?q&&z(ie):q&&ie instanceof za}),!!q&&lo(Z)&&xs(Z,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(b)){var D=new la;try{b=new za(b.type,b.evaluate(D))}catch(z){return this.error(z.message),null}}return b}return this.error('Unknown expression "'+p+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof t+" instead.")},Fs.prototype.concat=function(t,o,u){var p=typeof t=="number"?this.path.concat(t):this.path,y=u?this.scope.concat(u):this.scope;return new Fs(this.registry,p,o||null,y,this.errors)},Fs.prototype.error=function(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];var p=""+this.key+o.map(function(y){return"["+y+"]"}).join("");this.errors.push(new hr(p,t))},Fs.prototype.checkSubtype=function(t,o){var u=Pt(t,o);return u&&this.error(u),u};var bs=function(t,o,u){this.type=t,this.input=o,this.labels=[],this.outputs=[];for(var p=0,y=u;p<y.length;p+=1){var b=y[p],C=b[1];this.labels.push(b[0]),this.outputs.push(C)}};function ga(t,o,u){return t*(1-u)+o*u}bs.parse=function(t,o){if(t.length-1<4)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");var u=o.parse(t[1],1,Mt);if(!u)return null;var p=[],y=null;o.expectedType&&o.expectedType.kind!=="value"&&(y=o.expectedType);for(var b=1;b<t.length;b+=2){var C=b===1?-1/0:t[b],O=t[b+1],D=b,z=b+1;if(typeof C!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(p.length&&p[p.length-1][0]>=C)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);var Z=o.parse(O,z,y);if(!Z)return null;y=y||Z.type,p.push([C,Z])}return new bs(y,u,p)},bs.prototype.evaluate=function(t){var o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(t);var p=this.input.evaluate(t);if(p<=o[0])return u[0].evaluate(t);var y=o.length;return p>=o[y-1]?u[y-1].evaluate(t):u[fu(o,p)].evaluate(t)},bs.prototype.eachChild=function(t){t(this.input);for(var o=0,u=this.outputs;o<u.length;o+=1)t(u[o])},bs.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},bs.prototype.serialize=function(){for(var t=["step",this.input.serialize()],o=0;o<this.labels.length;o++)o>0&&t.push(this.labels[o]),t.push(this.outputs[o].serialize());return t};var xa=Object.freeze({__proto__:null,number:ga,color:function(t,o,u){return new Zi(ga(t.r,o.r,u),ga(t.g,o.g,u),ga(t.b,o.b,u),ga(t.a,o.a,u))},array:function(t,o,u){return t.map(function(p,y){return ga(p,o[y],u)})}}),is=6/29*3*(6/29),mf=Math.PI/180,Il=180/Math.PI;function qs(t){return t>.008856451679035631?Math.pow(t,1/3):t/is+4/29}function ac(t){return t>6/29?t*t*t:is*(t-4/29)}function Yu(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Ks(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function ul(t){var o=Ks(t.r),u=Ks(t.g),p=Ks(t.b),y=qs((.4124564*o+.3575761*u+.1804375*p)/.95047),b=qs((.2126729*o+.7151522*u+.072175*p)/1);return{l:116*b-16,a:500*(y-b),b:200*(b-qs((.0193339*o+.119192*u+.9503041*p)/1.08883)),alpha:t.a}}function _(t){var o=(t.l+16)/116,u=isNaN(t.a)?o:o+t.a/500,p=isNaN(t.b)?o:o-t.b/200;return o=1*ac(o),u=.95047*ac(u),p=1.08883*ac(p),new Zi(Yu(3.2404542*u-1.5371385*o-.4985314*p),Yu(-.969266*u+1.8760108*o+.041556*p),Yu(.0556434*u-.2040259*o+1.0572252*p),t.alpha)}function M(t,o,u){var p=o-t;return t+u*(p>180||p<-180?p-360*Math.round(p/360):p)}var B={forward:ul,reverse:_,interpolate:function(t,o,u){return{l:ga(t.l,o.l,u),a:ga(t.a,o.a,u),b:ga(t.b,o.b,u),alpha:ga(t.alpha,o.alpha,u)}}},R={forward:function(t){var o=ul(t),u=o.l,p=o.a,y=o.b,b=Math.atan2(y,p)*Il;return{h:b<0?b+360:b,c:Math.sqrt(p*p+y*y),l:u,alpha:t.a}},reverse:function(t){var o=t.h*mf,u=t.c;return _({l:t.l,a:Math.cos(o)*u,b:Math.sin(o)*u,alpha:t.alpha})},interpolate:function(t,o,u){return{h:M(t.h,o.h,u),c:ga(t.c,o.c,u),l:ga(t.l,o.l,u),alpha:ga(t.alpha,o.alpha,u)}}},K=Object.freeze({__proto__:null,lab:B,hcl:R}),ge=function(t,o,u,p,y){this.type=t,this.operator=o,this.interpolation=u,this.input=p,this.labels=[],this.outputs=[];for(var b=0,C=y;b<C.length;b+=1){var O=C[b],D=O[1];this.labels.push(O[0]),this.outputs.push(D)}};function He(t,o,u,p){var y=p-u,b=t-u;return y===0?0:o===1?b/y:(Math.pow(o,b)-1)/(Math.pow(o,y)-1)}ge.interpolationFactor=function(t,o,u,p){var y=0;if(t.name==="exponential")y=He(o,t.base,u,p);else if(t.name==="linear")y=He(o,1,u,p);else if(t.name==="cubic-bezier"){var b=t.controlPoints;y=new W(b[0],b[1],b[2],b[3]).solve(He(o,1,u,p))}return y},ge.parse=function(t,o){var u=t[0],p=t[1],y=t[2],b=t.slice(3);if(!Array.isArray(p)||p.length===0)return o.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){var C=p[1];if(typeof C!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:C}}else{if(p[0]!=="cubic-bezier")return o.error("Unknown interpolation type "+String(p[0]),1,0);var O=p.slice(1);if(O.length!==4||O.some(function(k){return typeof k!="number"||k<0||k>1}))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:O}}if(t.length-1<4)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(!(y=o.parse(y,2,Mt)))return null;var D=[],z=null;u==="interpolate-hcl"||u==="interpolate-lab"?z=Wr:o.expectedType&&o.expectedType.kind!=="value"&&(z=o.expectedType);for(var Z=0;Z<b.length;Z+=2){var G=b[Z],q=b[Z+1],ie=Z+3,Te=Z+4;if(typeof G!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ie);if(D.length&&D[D.length-1][0]>=G)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ie);var Oe=o.parse(q,Te,z);if(!Oe)return null;z=z||Oe.type,D.push([G,Oe])}return z.kind==="number"||z.kind==="color"||z.kind==="array"&&z.itemType.kind==="number"&&typeof z.N=="number"?new ge(z,u,p,y,D):o.error("Type "+_i(z)+" is not interpolatable.")},ge.prototype.evaluate=function(t){var o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(t);var p=this.input.evaluate(t);if(p<=o[0])return u[0].evaluate(t);var y=o.length;if(p>=o[y-1])return u[y-1].evaluate(t);var b=fu(o,p),C=ge.interpolationFactor(this.interpolation,p,o[b],o[b+1]),O=u[b].evaluate(t),D=u[b+1].evaluate(t);return this.operator==="interpolate"?xa[this.type.kind.toLowerCase()](O,D,C):this.operator==="interpolate-hcl"?R.reverse(R.interpolate(R.forward(O),R.forward(D),C)):B.reverse(B.interpolate(B.forward(O),B.forward(D),C))},ge.prototype.eachChild=function(t){t(this.input);for(var o=0,u=this.outputs;o<u.length;o+=1)t(u[o])},ge.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},ge.prototype.serialize=function(){var t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var o=[this.operator,t,this.input.serialize()],u=0;u<this.labels.length;u++)o.push(this.labels[u],this.outputs[u].serialize());return o};var lt=function(t,o){this.type=t,this.args=o};lt.parse=function(t,o){if(t.length<2)return o.error("Expectected at least one argument.");var u=null,p=o.expectedType;p&&p.kind!=="value"&&(u=p);for(var y=[],b=0,C=t.slice(1);b<C.length;b+=1){var O=o.parse(C[b],1+y.length,u,void 0,{typeAnnotation:"omit"});if(!O)return null;u=u||O.type,y.push(O)}var D=p&&y.some(function(z){return Pt(p,z.type)});return new lt(D?en:u,y)},lt.prototype.evaluate=function(t){for(var o,u=null,p=0,y=0,b=this.args;y<b.length&&(p++,(u=b[y].evaluate(t))&&u instanceof sa&&!u.available&&(o||(o=u.name),u=null,p===this.args.length&&(u=o)),u===null);y+=1);return u},lt.prototype.eachChild=function(t){this.args.forEach(t)},lt.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},lt.prototype.serialize=function(){var t=["coalesce"];return this.eachChild(function(o){t.push(o.serialize())}),t};var pt=function(t,o){this.type=o.type,this.bindings=[].concat(t),this.result=o};pt.prototype.evaluate=function(t){return this.result.evaluate(t)},pt.prototype.eachChild=function(t){for(var o=0,u=this.bindings;o<u.length;o+=1)t(u[o][1]);t(this.result)},pt.parse=function(t,o){if(t.length<4)return o.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var u=[],p=1;p<t.length-1;p+=2){var y=t[p];if(typeof y!="string")return o.error("Expected string, but found "+typeof y+" instead.",p);if(/[^a-zA-Z0-9_]/.test(y))return o.error("Variable names must contain only alphanumeric characters or '_'.",p);var b=o.parse(t[p+1],p+1);if(!b)return null;u.push([y,b])}var C=o.parse(t[t.length-1],t.length-1,o.expectedType,u);return C?new pt(u,C):null},pt.prototype.outputDefined=function(){return this.result.outputDefined()},pt.prototype.serialize=function(){for(var t=["let"],o=0,u=this.bindings;o<u.length;o+=1){var p=u[o];t.push(p[0],p[1].serialize())}return t.push(this.result.serialize()),t};var nr=function(t,o,u){this.type=t,this.index=o,this.input=u};nr.parse=function(t,o){if(t.length!==3)return o.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,Mt),p=o.parse(t[2],2,wi(o.expectedType||en));return u&&p?new nr(p.type.itemType,u,p):null},nr.prototype.evaluate=function(t){var o=this.index.evaluate(t),u=this.input.evaluate(t);if(o<0)throw new Ma("Array index out of bounds: "+o+" < 0.");if(o>=u.length)throw new Ma("Array index out of bounds: "+o+" > "+(u.length-1)+".");if(o!==Math.floor(o))throw new Ma("Array index must be an integer, but found "+o+" instead.");return u[o]},nr.prototype.eachChild=function(t){t(this.index),t(this.input)},nr.prototype.outputDefined=function(){return!1},nr.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var sr=function(t,o){this.type=Br,this.needle=t,this.haystack=o};sr.parse=function(t,o){if(t.length!==3)return o.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,en),p=o.parse(t[2],2,en);return u&&p?Ta(u.type,[Br,Jr,Mt,fn,en])?new sr(u,p):o.error("Expected first argument to be of type boolean, string, number or null, but found "+_i(u.type)+" instead"):null},sr.prototype.evaluate=function(t){var o=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!u)return!1;if(!Ei(o,["boolean","string","number","null"]))throw new Ma("Expected first argument to be of type boolean, string, number or null, but found "+_i(ta(o))+" instead.");if(!Ei(u,["string","array"]))throw new Ma("Expected second argument to be of type array or string, but found "+_i(ta(u))+" instead.");return u.indexOf(o)>=0},sr.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},sr.prototype.outputDefined=function(){return!0},sr.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Pn=function(t,o,u){this.type=Mt,this.needle=t,this.haystack=o,this.fromIndex=u};Pn.parse=function(t,o){if(t.length<=2||t.length>=5)return o.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,en),p=o.parse(t[2],2,en);if(!u||!p)return null;if(!Ta(u.type,[Br,Jr,Mt,fn,en]))return o.error("Expected first argument to be of type boolean, string, number or null, but found "+_i(u.type)+" instead");if(t.length===4){var y=o.parse(t[3],3,Mt);return y?new Pn(u,p,y):null}return new Pn(u,p)},Pn.prototype.evaluate=function(t){var o=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!Ei(o,["boolean","string","number","null"]))throw new Ma("Expected first argument to be of type boolean, string, number or null, but found "+_i(ta(o))+" instead.");if(!Ei(u,["string","array"]))throw new Ma("Expected second argument to be of type array or string, but found "+_i(ta(u))+" instead.");if(this.fromIndex){var p=this.fromIndex.evaluate(t);return u.indexOf(o,p)}return u.indexOf(o)},Pn.prototype.eachChild=function(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)},Pn.prototype.outputDefined=function(){return!1},Pn.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var ni=function(t,o,u,p,y,b){this.inputType=t,this.type=o,this.input=u,this.cases=p,this.outputs=y,this.otherwise=b};ni.parse=function(t,o){if(t.length<5)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return o.error("Expected an even number of arguments.");var u,p;o.expectedType&&o.expectedType.kind!=="value"&&(p=o.expectedType);for(var y={},b=[],C=2;C<t.length-1;C+=2){var O=t[C],D=t[C+1];Array.isArray(O)||(O=[O]);var z=o.concat(C);if(O.length===0)return z.error("Expected at least one branch label.");for(var Z=0,G=O;Z<G.length;Z+=1){var q=G[Z];if(typeof q!="number"&&typeof q!="string")return z.error("Branch labels must be numbers or strings.");if(typeof q=="number"&&Math.abs(q)>Number.MAX_SAFE_INTEGER)return z.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof q=="number"&&Math.floor(q)!==q)return z.error("Numeric branch labels must be integer values.");if(u){if(z.checkSubtype(u,ta(q)))return null}else u=ta(q);if(y[String(q)]!==void 0)return z.error("Branch labels must be unique.");y[String(q)]=b.length}var ie=o.parse(D,C,p);if(!ie)return null;p=p||ie.type,b.push(ie)}var Te=o.parse(t[1],1,en);if(!Te)return null;var Oe=o.parse(t[t.length-1],t.length-1,p);return Oe?Te.type.kind!=="value"&&o.concat(1).checkSubtype(u,Te.type)?null:new ni(u,p,Te,y,b,Oe):null},ni.prototype.evaluate=function(t){var o=this.input.evaluate(t);return(ta(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(t)},ni.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},ni.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})&&this.otherwise.outputDefined()},ni.prototype.serialize=function(){for(var t=this,o=["match",this.input.serialize()],u=[],p={},y=0,b=Object.keys(this.cases).sort();y<b.length;y+=1){var C=b[y];(G=p[this.cases[C]])===void 0?(p[this.cases[C]]=u.length,u.push([this.cases[C],[C]])):u[G][1].push(C)}for(var O=function(ie){return t.inputType.kind==="number"?Number(ie):ie},D=0,z=u;D<z.length;D+=1){var Z=z[D],G=Z[0],q=Z[1];o.push(q.length===1?O(q[0]):q.map(O)),o.push(this.outputs[outputIndex$1].serialize())}return o.push(this.otherwise.serialize()),o};var Rn=function(t,o,u){this.type=t,this.branches=o,this.otherwise=u};Rn.parse=function(t,o){if(t.length<4)return o.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return o.error("Expected an odd number of arguments.");var u;o.expectedType&&o.expectedType.kind!=="value"&&(u=o.expectedType);for(var p=[],y=1;y<t.length-1;y+=2){var b=o.parse(t[y],y,Br);if(!b)return null;var C=o.parse(t[y+1],y+1,u);if(!C)return null;p.push([b,C]),u=u||C.type}var O=o.parse(t[t.length-1],t.length-1,u);return O?new Rn(u,p,O):null},Rn.prototype.evaluate=function(t){for(var o=0,u=this.branches;o<u.length;o+=1){var p=u[o],y=p[1];if(p[0].evaluate(t))return y.evaluate(t)}return this.otherwise.evaluate(t)},Rn.prototype.eachChild=function(t){for(var o=0,u=this.branches;o<u.length;o+=1){var p=u[o],y=p[1];t(p[0]),t(y)}t(this.otherwise)},Rn.prototype.outputDefined=function(){return this.branches.every(function(t){return t[1].outputDefined()})&&this.otherwise.outputDefined()},Rn.prototype.serialize=function(){var t=["case"];return this.eachChild(function(o){t.push(o.serialize())}),t};var Xi=function(t,o,u,p){this.type=t,this.input=o,this.beginIndex=u,this.endIndex=p};function va(t,o){return t==="=="||t==="!="?o.kind==="boolean"||o.kind==="string"||o.kind==="number"||o.kind==="null"||o.kind==="value":o.kind==="string"||o.kind==="number"||o.kind==="value"}function Ca(t,o,u,p){return p.compare(o,u)===0}function Vi(t,o,u){var p=t!=="=="&&t!=="!=";return function(){function y(b,C,O){this.type=Br,this.lhs=b,this.rhs=C,this.collator=O,this.hasUntypedArgument=b.type.kind==="value"||C.type.kind==="value"}return y.parse=function(b,C){if(b.length!==3&&b.length!==4)return C.error("Expected two or three arguments.");var O=b[0],D=C.parse(b[1],1,en);if(!D)return null;if(!va(O,D.type))return C.concat(1).error('"'+O+`" comparisons are not supported for type '`+_i(D.type)+"'.");var z=C.parse(b[2],2,en);if(!z)return null;if(!va(O,z.type))return C.concat(2).error('"'+O+`" comparisons are not supported for type '`+_i(z.type)+"'.");if(D.type.kind!==z.type.kind&&D.type.kind!=="value"&&z.type.kind!=="value")return C.error("Cannot compare types '"+_i(D.type)+"' and '"+_i(z.type)+"'.");p&&(D.type.kind==="value"&&z.type.kind!=="value"?D=new ua(z.type,[D]):D.type.kind!=="value"&&z.type.kind==="value"&&(z=new ua(D.type,[z])));var Z=null;if(b.length===4){if(D.type.kind!=="string"&&z.type.kind!=="string"&&D.type.kind!=="value"&&z.type.kind!=="value")return C.error("Cannot use collator to compare non-string types.");if(!(Z=C.parse(b[3],3,dn)))return null}return new y(D,z,Z)},y.prototype.evaluate=function(b){var C=this.lhs.evaluate(b),O=this.rhs.evaluate(b);if(p&&this.hasUntypedArgument){var D=ta(C),z=ta(O);if(D.kind!==z.kind||D.kind!=="string"&&D.kind!=="number")throw new Ma('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+D.kind+", "+z.kind+") instead.")}if(this.collator&&!p&&this.hasUntypedArgument){var Z=ta(C),G=ta(O);if(Z.kind!=="string"||G.kind!=="string")return o(b,C,O)}return this.collator?u(b,C,O,this.collator.evaluate(b)):o(b,C,O)},y.prototype.eachChild=function(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)},y.prototype.outputDefined=function(){return!0},y.prototype.serialize=function(){var b=[t];return this.eachChild(function(C){b.push(C.serialize())}),b},y}()}Xi.parse=function(t,o){if(t.length<=2||t.length>=5)return o.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,en),p=o.parse(t[2],2,Mt);if(!u||!p)return null;if(!Ta(u.type,[wi(en),Jr,en]))return o.error("Expected first argument to be of type array or string, but found "+_i(u.type)+" instead");if(t.length===4){var y=o.parse(t[3],3,Mt);return y?new Xi(u.type,u,p,y):null}return new Xi(u.type,u,p)},Xi.prototype.evaluate=function(t){var o=this.input.evaluate(t),u=this.beginIndex.evaluate(t);if(!Ei(o,["string","array"]))throw new Ma("Expected first argument to be of type array or string, but found "+_i(ta(o))+" instead.");if(this.endIndex){var p=this.endIndex.evaluate(t);return o.slice(u,p)}return o.slice(u)},Xi.prototype.eachChild=function(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)},Xi.prototype.outputDefined=function(){return!1},Xi.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var Es=Vi("==",function(t,o,u){return o===u},Ca),hu=Vi("!=",function(t,o,u){return o!==u},function(t,o,u,p){return!Ca(0,o,u,p)}),qu=Vi("<",function(t,o,u){return o<u},function(t,o,u,p){return p.compare(o,u)<0}),gf=Vi(">",function(t,o,u){return o>u},function(t,o,u,p){return p.compare(o,u)>0}),ll=Vi("<=",function(t,o,u){return o<=u},function(t,o,u,p){return p.compare(o,u)<=0}),Bc=Vi(">=",function(t,o,u){return o>=u},function(t,o,u,p){return p.compare(o,u)>=0}),Tu=function(t,o,u,p,y){this.type=Jr,this.number=t,this.locale=o,this.currency=u,this.minFractionDigits=p,this.maxFractionDigits=y};Tu.parse=function(t,o){if(t.length!==3)return o.error("Expected two arguments.");var u=o.parse(t[1],1,Mt);if(!u)return null;var p=t[2];if(typeof p!="object"||Array.isArray(p))return o.error("NumberFormat options argument must be an object.");var y=null;if(p.locale&&!(y=o.parse(p.locale,1,Jr)))return null;var b=null;if(p.currency&&!(b=o.parse(p.currency,1,Jr)))return null;var C=null;if(p["min-fraction-digits"]&&!(C=o.parse(p["min-fraction-digits"],1,Mt)))return null;var O=null;return p["max-fraction-digits"]&&!(O=o.parse(p["max-fraction-digits"],1,Mt))?null:new Tu(u,y,b,C,O)},Tu.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},Tu.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},Tu.prototype.outputDefined=function(){return!1},Tu.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var Mu=function(t){this.type=Mt,this.input=t};Mu.parse=function(t,o){if(t.length!==2)return o.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?o.error("Expected argument of type string or array, but found "+_i(u.type)+" instead."):new Mu(u):null},Mu.prototype.evaluate=function(t){var o=this.input.evaluate(t);if(typeof o=="string"||Array.isArray(o))return o.length;throw new Ma("Expected value to be of type string or array, but found "+_i(ta(o))+" instead.")},Mu.prototype.eachChild=function(t){t(this.input)},Mu.prototype.outputDefined=function(){return!1},Mu.prototype.serialize=function(){var t=["length"];return this.eachChild(function(o){t.push(o.serialize())}),t};var Pu={"==":Es,"!=":hu,">":gf,"<":qu,">=":Bc,"<=":ll,array:ua,at:nr,boolean:ua,case:Rn,coalesce:lt,collator:Fo,format:Ao,image:jo,in:sr,"index-of":Pn,interpolate:ge,"interpolate-hcl":ge,"interpolate-lab":ge,length:Mu,let:pt,literal:za,match:ni,number:ua,"number-format":Tu,object:ua,slice:Xi,step:bs,string:ua,"to-boolean":vo,"to-color":vo,"to-number":vo,"to-string":vo,var:Ps,within:_s};function co(t,o){var u=o[0],p=o[1],y=o[2],b=o[3];u=u.evaluate(t),p=p.evaluate(t),y=y.evaluate(t);var C=b?b.evaluate(t):1,O=J(u,p,y,C);if(O)throw new Ma(O);return new Zi(u/255*C,p/255*C,y/255*C,C)}function Gf(t,o){return t in o}function Hf(t,o){var u=o[t];return u===void 0?null:u}function $o(t){return{type:t}}function Nc(t){return{result:"success",value:t}}function Ou(t){return{result:"error",value:t}}function pu(t){return t["property-type"]==="data-driven"||t["property-type"]==="cross-faded-data-driven"}function yf(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Rl(t){return!!t.expression&&t.expression.interpolated}function Bi(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function kl(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function Mh(t){return t}function cl(t,o,u){return t!==void 0?t:o!==void 0?o:u!==void 0?u:void 0}function zc(t,o,u,p,y){return cl(typeof u===y?p[u]:void 0,t.default,o.default)}function Wf(t,o,u){if(Bi(u)!=="number")return cl(t.default,o.default);var p=t.stops.length;if(p===1||u<=t.stops[0][0])return t.stops[0][1];if(u>=t.stops[p-1][0])return t.stops[p-1][1];var y=fu(t.stops.map(function(b){return b[0]}),u);return t.stops[y][1]}function Ph(t,o,u){var p=t.base!==void 0?t.base:1;if(Bi(u)!=="number")return cl(t.default,o.default);var y=t.stops.length;if(y===1||u<=t.stops[0][0])return t.stops[0][1];if(u>=t.stops[y-1][0])return t.stops[y-1][1];var b=fu(t.stops.map(function(G){return G[0]}),u),C=function(G,q,ie,Te){var Oe=Te-ie,k=G-ie;return Oe===0?0:q===1?k/Oe:(Math.pow(q,k)-1)/(Math.pow(q,Oe)-1)}(u,p,t.stops[b][0],t.stops[b+1][0]),O=t.stops[b][1],D=t.stops[b+1][1],z=xa[o.type]||Mh;if(t.colorSpace&&t.colorSpace!=="rgb"){var Z=K[t.colorSpace];z=function(G,q){return Z.reverse(Z.interpolate(Z.forward(G),Z.forward(q),C))}}return typeof O.evaluate=="function"?{evaluate:function(){for(var G=[],q=arguments.length;q--;)G[q]=arguments[q];var ie=O.evaluate.apply(void 0,G),Te=D.evaluate.apply(void 0,G);if(ie!==void 0&&Te!==void 0)return z(ie,Te,C)}}:z(O,D,C)}function Xf(t,o,u){return o.type==="color"?u=Zi.parse(u):o.type==="formatted"?u=gt.fromString(u.toString()):o.type==="resolvedImage"?u=sa.fromString(u.toString()):Bi(u)===o.type||o.type==="enum"&&o.values[u]||(u=void 0),cl(u,t.default,o.default)}$a.register(Pu,{error:[{kind:"error"},[Jr],function(t,o){throw new Ma(o[0].evaluate(t))}],typeof:[Jr,[en],function(t,o){return _i(ta(o[0].evaluate(t)))}],"to-rgba":[wi(Mt,4),[Wr],function(t,o){return o[0].evaluate(t).toArray()}],rgb:[Wr,[Mt,Mt,Mt],co],rgba:[Wr,[Mt,Mt,Mt,Mt],co],has:{type:Br,overloads:[[[Jr],function(t,o){return Gf(o[0].evaluate(t),t.properties())}],[[Jr,mi],function(t,o){var u=o[1];return Gf(o[0].evaluate(t),u.evaluate(t))}]]},get:{type:en,overloads:[[[Jr],function(t,o){return Hf(o[0].evaluate(t),t.properties())}],[[Jr,mi],function(t,o){var u=o[1];return Hf(o[0].evaluate(t),u.evaluate(t))}]]},"feature-state":[en,[Jr],function(t,o){return Hf(o[0].evaluate(t),t.featureState||{})}],properties:[mi,[],function(t){return t.properties()}],"geometry-type":[Jr,[],function(t){return t.geometryType()}],id:[en,[],function(t){return t.id()}],zoom:[Mt,[],function(t){return t.globals.zoom}],"heatmap-density":[Mt,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[Mt,[],function(t){return t.globals.lineProgress||0}],accumulated:[en,[],function(t){return t.globals.accumulated===void 0?null:t.globals.accumulated}],"+":[Mt,$o(Mt),function(t,o){for(var u=0,p=0,y=o;p<y.length;p+=1)u+=y[p].evaluate(t);return u}],"*":[Mt,$o(Mt),function(t,o){for(var u=1,p=0,y=o;p<y.length;p+=1)u*=y[p].evaluate(t);return u}],"-":{type:Mt,overloads:[[[Mt,Mt],function(t,o){var u=o[1];return o[0].evaluate(t)-u.evaluate(t)}],[[Mt],function(t,o){return-o[0].evaluate(t)}]]},"/":[Mt,[Mt,Mt],function(t,o){var u=o[1];return o[0].evaluate(t)/u.evaluate(t)}],"%":[Mt,[Mt,Mt],function(t,o){var u=o[1];return o[0].evaluate(t)%u.evaluate(t)}],ln2:[Mt,[],function(){return Math.LN2}],pi:[Mt,[],function(){return Math.PI}],e:[Mt,[],function(){return Math.E}],"^":[Mt,[Mt,Mt],function(t,o){var u=o[1];return Math.pow(o[0].evaluate(t),u.evaluate(t))}],sqrt:[Mt,[Mt],function(t,o){return Math.sqrt(o[0].evaluate(t))}],log10:[Mt,[Mt],function(t,o){return Math.log(o[0].evaluate(t))/Math.LN10}],ln:[Mt,[Mt],function(t,o){return Math.log(o[0].evaluate(t))}],log2:[Mt,[Mt],function(t,o){return Math.log(o[0].evaluate(t))/Math.LN2}],sin:[Mt,[Mt],function(t,o){return Math.sin(o[0].evaluate(t))}],cos:[Mt,[Mt],function(t,o){return Math.cos(o[0].evaluate(t))}],tan:[Mt,[Mt],function(t,o){return Math.tan(o[0].evaluate(t))}],asin:[Mt,[Mt],function(t,o){return Math.asin(o[0].evaluate(t))}],acos:[Mt,[Mt],function(t,o){return Math.acos(o[0].evaluate(t))}],atan:[Mt,[Mt],function(t,o){return Math.atan(o[0].evaluate(t))}],min:[Mt,$o(Mt),function(t,o){return Math.min.apply(Math,o.map(function(u){return u.evaluate(t)}))}],max:[Mt,$o(Mt),function(t,o){return Math.max.apply(Math,o.map(function(u){return u.evaluate(t)}))}],abs:[Mt,[Mt],function(t,o){return Math.abs(o[0].evaluate(t))}],round:[Mt,[Mt],function(t,o){var u=o[0].evaluate(t);return u<0?-Math.round(-u):Math.round(u)}],floor:[Mt,[Mt],function(t,o){return Math.floor(o[0].evaluate(t))}],ceil:[Mt,[Mt],function(t,o){return Math.ceil(o[0].evaluate(t))}],"filter-==":[Br,[Jr,en],function(t,o){var u=o[0],p=o[1];return t.properties()[u.value]===p.value}],"filter-id-==":[Br,[en],function(t,o){var u=o[0];return t.id()===u.value}],"filter-type-==":[Br,[Jr],function(t,o){var u=o[0];return t.geometryType()===u.value}],"filter-<":[Br,[Jr,en],function(t,o){var u=o[0],p=o[1],y=t.properties()[u.value],b=p.value;return typeof y==typeof b&&y<b}],"filter-id-<":[Br,[en],function(t,o){var u=o[0],p=t.id(),y=u.value;return typeof p==typeof y&&p<y}],"filter->":[Br,[Jr,en],function(t,o){var u=o[0],p=o[1],y=t.properties()[u.value],b=p.value;return typeof y==typeof b&&y>b}],"filter-id->":[Br,[en],function(t,o){var u=o[0],p=t.id(),y=u.value;return typeof p==typeof y&&p>y}],"filter-<=":[Br,[Jr,en],function(t,o){var u=o[0],p=o[1],y=t.properties()[u.value],b=p.value;return typeof y==typeof b&&y<=b}],"filter-id-<=":[Br,[en],function(t,o){var u=o[0],p=t.id(),y=u.value;return typeof p==typeof y&&p<=y}],"filter->=":[Br,[Jr,en],function(t,o){var u=o[0],p=o[1],y=t.properties()[u.value],b=p.value;return typeof y==typeof b&&y>=b}],"filter-id->=":[Br,[en],function(t,o){var u=o[0],p=t.id(),y=u.value;return typeof p==typeof y&&p>=y}],"filter-has":[Br,[en],function(t,o){return o[0].value in t.properties()}],"filter-has-id":[Br,[],function(t){return t.id()!==null&&t.id()!==void 0}],"filter-type-in":[Br,[wi(Jr)],function(t,o){return o[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[Br,[wi(en)],function(t,o){return o[0].value.indexOf(t.id())>=0}],"filter-in-small":[Br,[Jr,wi(en)],function(t,o){var u=o[0];return o[1].value.indexOf(t.properties()[u.value])>=0}],"filter-in-large":[Br,[Jr,wi(en)],function(t,o){var u=o[0],p=o[1];return function(y,b,C,O){for(;C<=O;){var D=C+O>>1;if(b[D]===y)return!0;b[D]>y?O=D-1:C=D+1}return!1}(t.properties()[u.value],p.value,0,p.value.length-1)}],all:{type:Br,overloads:[[[Br,Br],function(t,o){var u=o[1];return o[0].evaluate(t)&&u.evaluate(t)}],[$o(Br),function(t,o){for(var u=0,p=o;u<p.length;u+=1)if(!p[u].evaluate(t))return!1;return!0}]]},any:{type:Br,overloads:[[[Br,Br],function(t,o){var u=o[1];return o[0].evaluate(t)||u.evaluate(t)}],[$o(Br),function(t,o){for(var u=0,p=o;u<p.length;u+=1)if(p[u].evaluate(t))return!0;return!1}]]},"!":[Br,[Br],function(t,o){return!o[0].evaluate(t)}],"is-supported-script":[Br,[Jr],function(t,o){var u=t.globals&&t.globals.isSupportedScript;return!u||u(o[0].evaluate(t))}],upcase:[Jr,[Jr],function(t,o){return o[0].evaluate(t).toUpperCase()}],downcase:[Jr,[Jr],function(t,o){return o[0].evaluate(t).toLowerCase()}],concat:[Jr,$o(en),function(t,o){return o.map(function(u){return bu(u.evaluate(t))}).join("")}],"resolved-locale":[Jr,[dn],function(t,o){return o[0].evaluate(t).resolvedLocale()}]});var Uc=function(t,o){this.expression=t,this._warningHistory={},this._evaluator=new la,this._defaultValue=o?function(u){return u.type==="color"&&kl(u.default)?new Zi(0,0,0,0):u.type==="color"?Zi.parse(u.default)||null:u.default===void 0?null:u.default}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null};function oc(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Pu}function sc(t,o){var u=new Fs(Pu,[],o?function(y){var b={color:Wr,string:Jr,number:Mt,enum:Jr,boolean:Br,formatted:Wi,resolvedImage:hi};return y.type==="array"?wi(b[y.value]||en,y.length):b[y.type]}(o):void 0),p=u.parse(t,void 0,void 0,void 0,o&&o.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?Nc(new Uc(p,o)):Ou(u.errors)}Uc.prototype.evaluateWithoutErrorHandling=function(t,o,u,p,y,b){return this._evaluator.globals=t,this._evaluator.feature=o,this._evaluator.featureState=u,this._evaluator.canonical=p,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)},Uc.prototype.evaluate=function(t,o,u,p,y,b){this._evaluator.globals=t,this._evaluator.feature=o||null,this._evaluator.featureState=u||null,this._evaluator.canonical=p,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b||null;try{var C=this.expression.evaluate(this._evaluator);if(C==null||typeof C=="number"&&C!=C)return this._defaultValue;if(this._enumValues&&!(C in this._enumValues))throw new Ma("Expected value to be one of "+Object.keys(this._enumValues).map(function(O){return JSON.stringify(O)}).join(", ")+", but found "+JSON.stringify(C)+" instead.");return C}catch(O){return this._warningHistory[O.message]||(this._warningHistory[O.message]=!0,typeof console!="undefined"&&console.warn(O.message)),this._defaultValue}};var Ll=function(t,o){this.kind=t,this._styleExpression=o,this.isStateDependent=t!=="constant"&&!wo(o.expression)};Ll.prototype.evaluateWithoutErrorHandling=function(t,o,u,p,y,b){return this._styleExpression.evaluateWithoutErrorHandling(t,o,u,p,y,b)},Ll.prototype.evaluate=function(t,o,u,p,y,b){return this._styleExpression.evaluate(t,o,u,p,y,b)};var fl=function(t,o,u,p){this.kind=t,this.zoomStops=u,this._styleExpression=o,this.isStateDependent=t!=="camera"&&!wo(o.expression),this.interpolationType=p};function Dl(t,o){if((t=sc(t,o)).result==="error")return t;var u=t.value.expression,p=lo(u);if(!p&&!pu(o))return Ou([new hr("","data expressions not supported")]);var y=xs(u,["zoom"]);if(!y&&!yf(o))return Ou([new hr("","zoom expressions not supported")]);var b=function C(O){var D=null;if(O instanceof pt)D=C(O.result);else if(O instanceof lt)for(var z=0,Z=O.args;z<Z.length&&!(D=C(Z[z]));z+=1);else(O instanceof bs||O instanceof ge)&&O.input instanceof $a&&O.input.name==="zoom"&&(D=O);return D instanceof hr||O.eachChild(function(G){var q=C(G);q instanceof hr?D=q:!D&&q?D=new hr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):D&&q&&D!==q&&(D=new hr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),D}(u);return b||y?b instanceof hr?Ou([b]):b instanceof ge&&!Rl(o)?Ou([new hr("",'"interpolate" expressions cannot be used with this property')]):Nc(b?new fl(p?"camera":"composite",t.value,b.labels,b instanceof ge?b.interpolation:void 0):new Ll(p?"constant":"source",t.value)):Ou([new hr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}fl.prototype.evaluateWithoutErrorHandling=function(t,o,u,p,y,b){return this._styleExpression.evaluateWithoutErrorHandling(t,o,u,p,y,b)},fl.prototype.evaluate=function(t,o,u,p,y,b){return this._styleExpression.evaluate(t,o,u,p,y,b)},fl.prototype.interpolationFactor=function(t,o,u){return this.interpolationType?ge.interpolationFactor(this.interpolationType,t,o,u):0};var Ku=function(t,o){this._parameters=t,this._specification=o,fr(this,function u(p,y){var b,C,O,D=y.type==="color",z=p.stops&&typeof p.stops[0][0]=="object",Z=z||!(z||p.property!==void 0),G=p.type||(Rl(y)?"exponential":"interval");if(D&&((p=fr({},p)).stops&&(p.stops=p.stops.map(function(cn){return[cn[0],Zi.parse(cn[1])]})),p.default=Zi.parse(p.default?p.default:y.default)),p.colorSpace&&p.colorSpace!=="rgb"&&!K[p.colorSpace])throw new Error("Unknown color space: "+p.colorSpace);if(G==="exponential")b=Ph;else if(G==="interval")b=Wf;else if(G==="categorical"){b=zc,C=Object.create(null);for(var q=0,ie=p.stops;q<ie.length;q+=1){var Te=ie[q];C[Te[0]]=Te[1]}O=typeof p.stops[0][0]}else{if(G!=="identity")throw new Error('Unknown function type "'+G+'"');b=Xf}if(z){for(var Oe={},k=[],Ue=0;Ue<p.stops.length;Ue++){var rt=p.stops[Ue],bt=rt[0].zoom;Oe[bt]===void 0&&(Oe[bt]={zoom:bt,type:p.type,property:p.property,default:p.default,stops:[]},k.push(bt)),Oe[bt].stops.push([rt[0].value,rt[1]])}for(var Ut=[],Gt=0,ir=k;Gt<ir.length;Gt+=1){var Mr=ir[Gt];Ut.push([Oe[Mr].zoom,u(Oe[Mr],y)])}var Dr={name:"linear"};return{kind:"composite",interpolationType:Dr,interpolationFactor:ge.interpolationFactor.bind(void 0,Dr),zoomStops:Ut.map(function(cn){return cn[0]}),evaluate:function(cn,Vn){var hn=cn.zoom;return Ph({stops:Ut,base:p.base},y,hn).evaluate(hn,Vn)}}}if(Z){var Dn=G==="exponential"?{name:"exponential",base:p.base!==void 0?p.base:1}:null;return{kind:"camera",interpolationType:Dn,interpolationFactor:ge.interpolationFactor.bind(void 0,Dn),zoomStops:p.stops.map(function(cn){return cn[0]}),evaluate:function(cn){return b(p,y,cn.zoom,C,O)}}}return{kind:"source",evaluate:function(cn,Vn){var hn=Vn&&Vn.properties?Vn.properties[p.property]:void 0;return hn===void 0?cl(p.default,y.default):b(p,y,hn,C,O)}}}(this._parameters,this._specification))};function $s(t){var o=t.key,u=t.value,p=t.valueSpec||{},y=t.objectElementValidators||{},b=t.style,C=t.styleSpec,O=[],D=Bi(u);if(D!=="object")return[new Le(o,u,"object expected, "+D+" found")];for(var z in u){var Z=z.split(".")[0],G=p[Z]||p["*"],q=void 0;if(y[Z])q=y[Z];else if(p[Z])q=Yi;else if(y["*"])q=y["*"];else{if(!p["*"]){O.push(new Le(o,u[z],'unknown property "'+z+'"'));continue}q=Yi}O=O.concat(q({key:(o&&o+".")+z,value:u[z],valueSpec:G,style:b,styleSpec:C,object:u,objectKey:z},u))}for(var ie in p)y[ie]||p[ie].required&&p[ie].default===void 0&&u[ie]===void 0&&O.push(new Le(o,u,'missing required property "'+ie+'"'));return O}function _f(t){var o=t.value,u=t.valueSpec,p=t.style,y=t.styleSpec,b=t.key,C=t.arrayElementValidator||Yi;if(Bi(o)!=="array")return[new Le(b,o,"array expected, "+Bi(o)+" found")];if(u.length&&o.length!==u.length)return[new Le(b,o,"array length "+u.length+" expected, length "+o.length+" found")];if(u["min-length"]&&o.length<u["min-length"])return[new Le(b,o,"array length at least "+u["min-length"]+" expected, length "+o.length+" found")];var O={type:u.value,values:u.values};y.$version<7&&(O.function=u.function),Bi(u.value)==="object"&&(O=u.value);for(var D=[],z=0;z<o.length;z++)D=D.concat(C({array:o,arrayIndex:z,value:o[z],valueSpec:O,style:p,styleSpec:y,key:b+"["+z+"]"}));return D}function xf(t){var o=t.key,u=t.value,p=t.valueSpec,y=Bi(u);return y==="number"&&u!=u&&(y="NaN"),y!=="number"?[new Le(o,u,"number expected, "+y+" found")]:"minimum"in p&&u<p.minimum?[new Le(o,u,u+" is less than the minimum value "+p.minimum)]:"maximum"in p&&u>p.maximum?[new Le(o,u,u+" is greater than the maximum value "+p.maximum)]:[]}function Yf(t){var o,u,p,y=t.valueSpec,b=Lt(t.value.type),C={},O=b!=="categorical"&&t.value.property===void 0,D=!O,z=Bi(t.value.stops)==="array"&&Bi(t.value.stops[0])==="array"&&Bi(t.value.stops[0][0])==="object",Z=$s({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(ie){if(b==="identity")return[new Le(ie.key,ie.value,'identity function may not have a "stops" property')];var Te=[],Oe=ie.value;return Te=Te.concat(_f({key:ie.key,value:Oe,valueSpec:ie.valueSpec,style:ie.style,styleSpec:ie.styleSpec,arrayElementValidator:G})),Bi(Oe)==="array"&&Oe.length===0&&Te.push(new Le(ie.key,Oe,"array must have at least one stop")),Te},default:function(ie){return Yi({key:ie.key,value:ie.value,valueSpec:y,style:ie.style,styleSpec:ie.styleSpec})}}});return b==="identity"&&O&&Z.push(new Le(t.key,t.value,'missing required property "property"')),b==="identity"||t.value.stops||Z.push(new Le(t.key,t.value,'missing required property "stops"')),b==="exponential"&&t.valueSpec.expression&&!Rl(t.valueSpec)&&Z.push(new Le(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(D&&!pu(t.valueSpec)?Z.push(new Le(t.key,t.value,"property functions not supported")):O&&!yf(t.valueSpec)&&Z.push(new Le(t.key,t.value,"zoom functions not supported"))),b!=="categorical"&&!z||t.value.property!==void 0||Z.push(new Le(t.key,t.value,'"property" property is required')),Z;function G(ie){var Te=[],Oe=ie.value,k=ie.key;if(Bi(Oe)!=="array")return[new Le(k,Oe,"array expected, "+Bi(Oe)+" found")];if(Oe.length!==2)return[new Le(k,Oe,"array length 2 expected, length "+Oe.length+" found")];if(z){if(Bi(Oe[0])!=="object")return[new Le(k,Oe,"object expected, "+Bi(Oe[0])+" found")];if(Oe[0].zoom===void 0)return[new Le(k,Oe,"object stop key must have zoom")];if(Oe[0].value===void 0)return[new Le(k,Oe,"object stop key must have value")];if(p&&p>Lt(Oe[0].zoom))return[new Le(k,Oe[0].zoom,"stop zoom values must appear in ascending order")];Lt(Oe[0].zoom)!==p&&(p=Lt(Oe[0].zoom),u=void 0,C={}),Te=Te.concat($s({key:k+"[0]",value:Oe[0],valueSpec:{zoom:{}},style:ie.style,styleSpec:ie.styleSpec,objectElementValidators:{zoom:xf,value:q}}))}else Te=Te.concat(q({key:k+"[0]",value:Oe[0],valueSpec:{},style:ie.style,styleSpec:ie.styleSpec},Oe));return oc(Bt(Oe[1]))?Te.concat([new Le(k+"[1]",Oe[1],"expressions are not allowed in function stops.")]):Te.concat(Yi({key:k+"[1]",value:Oe[1],valueSpec:y,style:ie.style,styleSpec:ie.styleSpec}))}function q(ie,Te){var Oe=Bi(ie.value),k=Lt(ie.value),Ue=ie.value!==null?ie.value:Te;if(o){if(Oe!==o)return[new Le(ie.key,Ue,Oe+" stop domain type must match previous stop domain type "+o)]}else o=Oe;if(Oe!=="number"&&Oe!=="string"&&Oe!=="boolean")return[new Le(ie.key,Ue,"stop domain value must be a number, string, or boolean")];if(Oe!=="number"&&b!=="categorical"){var rt="number expected, "+Oe+" found";return pu(y)&&b===void 0&&(rt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Le(ie.key,Ue,rt)]}return b!=="categorical"||Oe!=="number"||isFinite(k)&&Math.floor(k)===k?b!=="categorical"&&Oe==="number"&&u!==void 0&&k<u?[new Le(ie.key,Ue,"stop domain values must appear in ascending order")]:(u=k,b==="categorical"&&k in C?[new Le(ie.key,Ue,"stop domain values must be unique")]:(C[k]=!0,[])):[new Le(ie.key,Ue,"integer expected, found "+k)]}}function du(t){var o=(t.expressionContext==="property"?Dl:sc)(Bt(t.value),t.valueSpec);if(o.result==="error")return o.value.map(function(p){return new Le(""+t.key+p.key,t.value,p.message)});var u=o.value.expression||o.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!u.outputDefined())return[new Le(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!wo(u))return[new Le(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter"&&!wo(u))return[new Le(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!xs(u,["zoom","feature-state"]))return[new Le(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!lo(u))return[new Le(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function uc(t){var o=t.key,u=t.value,p=t.valueSpec,y=[];return Array.isArray(p.values)?p.values.indexOf(Lt(u))===-1&&y.push(new Le(o,u,"expected one of ["+p.values.join(", ")+"], "+JSON.stringify(u)+" found")):Object.keys(p.values).indexOf(Lt(u))===-1&&y.push(new Le(o,u,"expected one of ["+Object.keys(p.values).join(", ")+"], "+JSON.stringify(u)+" found")),y}function Zc(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var o=0,u=t.slice(1);o<u.length;o+=1){var p=u[o];if(!Zc(p)&&typeof p!="boolean")return!1}return!0;default:return!0}}Ku.deserialize=function(t){return new Ku(t._parameters,t._specification)},Ku.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var bf={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Fl(t){if(t==null)return{filter:function(){return!0},needGeometry:!1};Zc(t)||(t=Ef(t));var o=sc(t,bf);if(o.result==="error")throw new Error(o.value.map(function(u){return u.key+": "+u.message}).join(", "));return{filter:function(u,p,y){return o.value.evaluate(u,p,{},y)},needGeometry:function u(p){if(!Array.isArray(p))return!1;if(p[0]==="within")return!0;for(var y=1;y<p.length;y++)if(u(p[y]))return!0;return!1}(t)}}function hp(t,o){return t<o?-1:t>o?1:0}function Ef(t){if(!t)return!0;var o,u=t[0];return t.length<=1?u!=="any":u==="=="?Bl(t[1],t[2],"=="):u==="!="?Nl(Bl(t[1],t[2],"==")):u==="<"||u===">"||u==="<="||u===">="?Bl(t[1],t[2],u):u==="any"?(o=t.slice(1),["any"].concat(o.map(Ef))):u==="all"?["all"].concat(t.slice(1).map(Ef)):u==="none"?["all"].concat(t.slice(1).map(Ef).map(Nl)):u==="in"?Sf(t[1],t.slice(2)):u==="!in"?Nl(Sf(t[1],t.slice(2))):u==="has"?Cf(t[1]):u==="!has"?Nl(Cf(t[1])):u!=="within"||t}function Bl(t,o,u){switch(t){case"$type":return["filter-type-"+u,o];case"$id":return["filter-id-"+u,o];default:return["filter-"+u,t,o]}}function Sf(t,o){if(o.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(function(u){return typeof u!=typeof o[0]})?["filter-in-large",t,["literal",o.sort(hp)]]:["filter-in-small",t,["literal",o]]}}function Cf(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Nl(t){return["!",t]}function jc(t){return Zc(Bt(t.value))?du(fr({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function o(u){var p=u.value,y=u.key;if(Bi(p)!=="array")return[new Le(y,p,"array expected, "+Bi(p)+" found")];var b,C=u.styleSpec,O=[];if(p.length<1)return[new Le(y,p,"filter array must have at least 1 element")];switch(O=O.concat(uc({key:y+"[0]",value:p[0],valueSpec:C.filter_operator,style:u.style,styleSpec:u.styleSpec})),Lt(p[0])){case"<":case"<=":case">":case">=":p.length>=2&&Lt(p[1])==="$type"&&O.push(new Le(y,p,'"$type" cannot be use with operator "'+p[0]+'"'));case"==":case"!=":p.length!==3&&O.push(new Le(y,p,'filter array for operator "'+p[0]+'" must have 3 elements'));case"in":case"!in":p.length>=2&&(b=Bi(p[1]))!=="string"&&O.push(new Le(y+"[1]",p[1],"string expected, "+b+" found"));for(var D=2;D<p.length;D++)b=Bi(p[D]),Lt(p[1])==="$type"?O=O.concat(uc({key:y+"["+D+"]",value:p[D],valueSpec:C.geometry_type,style:u.style,styleSpec:u.styleSpec})):b!=="string"&&b!=="number"&&b!=="boolean"&&O.push(new Le(y+"["+D+"]",p[D],"string, number, or boolean expected, "+b+" found"));break;case"any":case"all":case"none":for(var z=1;z<p.length;z++)O=O.concat(o({key:y+"["+z+"]",value:p[z],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":b=Bi(p[1]),p.length!==2?O.push(new Le(y,p,'filter array for "'+p[0]+'" operator must have 2 elements')):b!=="string"&&O.push(new Le(y+"[1]",p[1],"string expected, "+b+" found"));break;case"within":b=Bi(p[1]),p.length!==2?O.push(new Le(y,p,'filter array for "'+p[0]+'" operator must have 2 elements')):b!=="object"&&O.push(new Le(y+"[1]",p[1],"object expected, "+b+" found"))}return O}(t)}function Oh(t,o){var u=t.key,p=t.style,y=t.styleSpec,b=t.value,C=t.objectKey,O=y[o+"_"+t.layerType];if(!O)return[];var D=C.match(/^(.*)-transition$/);if(o==="paint"&&D&&O[D[1]]&&O[D[1]].transition)return Yi({key:u,value:b,valueSpec:y.transition,style:p,styleSpec:y});var z,Z=t.valueSpec||O[C];if(!Z)return[new Le(u,b,'unknown property "'+C+'"')];if(Bi(b)==="string"&&pu(Z)&&!Z.tokens&&(z=/^{([^}]+)}$/.exec(b)))return[new Le(u,b,'"'+C+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(z[1])+" }`.")];var G=[];return t.layerType==="symbol"&&(C==="text-field"&&p&&!p.glyphs&&G.push(new Le(u,b,'use of "text-field" requires a style "glyphs" property')),C==="text-font"&&kl(Bt(b))&&Lt(b.type)==="identity"&&G.push(new Le(u,b,'"text-font" does not support identity functions'))),G.concat(Yi({key:t.key,value:b,valueSpec:Z,style:p,styleSpec:y,expressionContext:"property",propertyType:o,propertyKey:C}))}function Ih(t){return Oh(t,"paint")}function lc(t){return Oh(t,"layout")}function Rh(t){var o=[],u=t.value,p=t.key,y=t.style,b=t.styleSpec;u.type||u.ref||o.push(new Le(p,u,'either "type" or "ref" is required'));var C,O=Lt(u.type),D=Lt(u.ref);if(u.id)for(var z=Lt(u.id),Z=0;Z<t.arrayIndex;Z++){var G=y.layers[Z];Lt(G.id)===z&&o.push(new Le(p,u.id,'duplicate layer id "'+u.id+'", previously used at line '+G.id.__line__))}if("ref"in u)["type","source","source-layer","filter","layout"].forEach(function(Te){Te in u&&o.push(new Le(p,u[Te],'"'+Te+'" is prohibited for ref layers'))}),y.layers.forEach(function(Te){Lt(Te.id)===D&&(C=Te)}),C?C.ref?o.push(new Le(p,u.ref,"ref cannot reference another ref layer")):O=Lt(C.type):o.push(new Le(p,u.ref,'ref layer "'+D+'" not found'));else if(O!=="background")if(u.source){var q=y.sources&&y.sources[u.source],ie=q&&Lt(q.type);q?ie==="vector"&&O==="raster"?o.push(new Le(p,u.source,'layer "'+u.id+'" requires a raster source')):ie==="raster"&&O!=="raster"?o.push(new Le(p,u.source,'layer "'+u.id+'" requires a vector source')):ie!=="vector"||u["source-layer"]?ie==="raster-dem"&&O!=="hillshade"?o.push(new Le(p,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):O!=="line"||!u.paint||!u.paint["line-gradient"]||ie==="geojson"&&q.lineMetrics||o.push(new Le(p,u,'layer "'+u.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):o.push(new Le(p,u,'layer "'+u.id+'" must specify a "source-layer"')):o.push(new Le(p,u.source,'source "'+u.source+'" not found'))}else o.push(new Le(p,u,'missing required property "source"'));return o=o.concat($s({key:p,value:u,valueSpec:b.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Yi({key:p+".type",value:u.type,valueSpec:b.layer.type,style:t.style,styleSpec:t.styleSpec,object:u,objectKey:"type"})},filter:jc,layout:function(Te){return $s({layer:u,key:Te.key,value:Te.value,style:Te.style,styleSpec:Te.styleSpec,objectElementValidators:{"*":function(Oe){return lc(fr({layerType:O},Oe))}}})},paint:function(Te){return $s({layer:u,key:Te.key,value:Te.value,style:Te.style,styleSpec:Te.styleSpec,objectElementValidators:{"*":function(Oe){return Ih(fr({layerType:O},Oe))}}})}}}))}function zl(t){var o=t.value,u=t.key,p=Bi(o);return p!=="string"?[new Le(u,o,"string expected, "+p+" found")]:[]}var Qi={promoteId:function(t){var o=t.key,u=t.value;if(Bi(u)==="string")return zl({key:o,value:u});var p=[];for(var y in u)p.push.apply(p,zl({key:o+"."+y,value:u[y]}));return p}};function cc(t){var o=t.value,u=t.key,p=t.styleSpec,y=t.style;if(!o.type)return[new Le(u,o,'"type" is required')];var b,C=Lt(o.type);switch(C){case"vector":case"raster":case"raster-dem":return $s({key:u,value:o,valueSpec:p["source_"+C.replace("-","_")],style:t.style,styleSpec:p,objectElementValidators:Qi});case"geojson":if(b=$s({key:u,value:o,valueSpec:p.source_geojson,style:y,styleSpec:p,objectElementValidators:Qi}),o.cluster)for(var O in o.clusterProperties){var D=o.clusterProperties[O],z=D[0],Z=typeof z=="string"?[z,["accumulated"],["get",O]]:z;b.push.apply(b,du({key:u+"."+O+".map",value:D[1],expressionContext:"cluster-map"})),b.push.apply(b,du({key:u+"."+O+".reduce",value:Z,expressionContext:"cluster-reduce"}))}return b;case"video":return $s({key:u,value:o,valueSpec:p.source_video,style:y,styleSpec:p});case"image":return $s({key:u,value:o,valueSpec:p.source_image,style:y,styleSpec:p});case"canvas":return[new Le(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return uc({key:u+".type",value:o.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:y,styleSpec:p})}}function ha(t){var o=t.value,u=t.styleSpec,p=u.light,y=t.style,b=[],C=Bi(o);if(o===void 0)return b;if(C!=="object")return b.concat([new Le("light",o,"object expected, "+C+" found")]);for(var O in o){var D=O.match(/^(.*)-transition$/);b=b.concat(D&&p[D[1]]&&p[D[1]].transition?Yi({key:O,value:o[O],valueSpec:u.transition,style:y,styleSpec:u}):p[O]?Yi({key:O,value:o[O],valueSpec:p[O],style:y,styleSpec:u}):[new Le(O,o[O],'unknown property "'+O+'"')])}return b}var Iu={"*":function(){return[]},array:_f,boolean:function(t){var o=t.value,u=t.key,p=Bi(o);return p!=="boolean"?[new Le(u,o,"boolean expected, "+p+" found")]:[]},number:xf,color:function(t){var o=t.key,u=t.value,p=Bi(u);return p!=="string"?[new Le(o,u,"color expected, "+p+" found")]:Ti(u)===null?[new Le(o,u,'color expected, "'+u+'" found')]:[]},constants:dt,enum:uc,filter:jc,function:Yf,layer:Rh,object:$s,source:cc,light:ha,string:zl,formatted:function(t){return zl(t).length===0?[]:du(t)},resolvedImage:function(t){return zl(t).length===0?[]:du(t)}};function Yi(t){var o=t.value,u=t.valueSpec,p=t.styleSpec;return u.expression&&kl(Lt(o))?Yf(t):u.expression&&oc(Bt(o))?du(t):u.type&&Iu[u.type]?Iu[u.type](t):$s(fr({},t,{valueSpec:u.type?p[u.type]:u}))}function Pa(t){var o=t.value,u=t.key,p=zl(t);return p.length||(o.indexOf("{fontstack}")===-1&&p.push(new Le(u,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&p.push(new Le(u,o,'"glyphs" url must include a "{range}" token'))),p}function Ss(t,o){o===void 0&&(o=se);var u=[];return u=u.concat(Yi({key:"",value:t,valueSpec:o.$root,styleSpec:o,style:t,objectElementValidators:{glyphs:Pa,"*":function(){return[]}}})),t.constants&&(u=u.concat(dt({key:"constants",value:t.constants,style:t,styleSpec:o}))),Vc(u)}function Vc(t){return[].concat(t).sort(function(o,u){return o.line-u.line})}function $u(t){return function(){for(var o=[],u=arguments.length;u--;)o[u]=arguments[u];return Vc(t.apply(this,o))}}Ss.source=$u(cc),Ss.light=$u(ha),Ss.layer=$u(Rh),Ss.filter=$u(jc),Ss.paintProperty=$u(Ih),Ss.layoutProperty=$u(lc);var Za=Ss,fc=Za.light,Ul=Za.paintProperty,Qu=Za.layoutProperty;function Gc(t,o){var u=!1;if(o&&o.length)for(var p=0,y=o;p<y.length;p+=1)t.fire(new Ge(new Error(y[p].message))),u=!0;return u}var Ru=mo;function mo(t,o,u){var p=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var y=new Int32Array(this.arrayBuffer);t=y[0],this.d=(o=y[1])+2*(u=y[2]);for(var b=0;b<this.d*this.d;b++){var C=y[3+b],O=y[3+b+1];p.push(C===O?null:y.subarray(C,O))}var D=y[3+p.length+1];this.keys=y.subarray(y[3+p.length],D),this.bboxes=y.subarray(D),this.insert=this._insertReadonly}else{this.d=o+2*u;for(var z=0;z<this.d*this.d;z++)p.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=t,this.padding=u,this.scale=o/t,this.uid=0;var Z=u/o*t;this.min=-Z,this.max=t+Z}mo.prototype.insert=function(t,o,u,p,y){this._forEachCell(o,u,p,y,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(y)},mo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},mo.prototype._insertCell=function(t,o,u,p,y,b){this.cells[y].push(b)},mo.prototype.query=function(t,o,u,p,y){var b=this.min,C=this.max;if(t<=b&&o<=b&&C<=u&&C<=p&&!y)return Array.prototype.slice.call(this.keys);var O=[];return this._forEachCell(t,o,u,p,this._queryCell,O,{},y),O},mo.prototype._queryCell=function(t,o,u,p,y,b,C,O){var D=this.cells[y];if(D!==null)for(var z=this.keys,Z=this.bboxes,G=0;G<D.length;G++){var q=D[G];if(C[q]===void 0){var ie=4*q;(O?O(Z[ie+0],Z[ie+1],Z[ie+2],Z[ie+3]):t<=Z[ie+2]&&o<=Z[ie+3]&&u>=Z[ie+0]&&p>=Z[ie+1])?(C[q]=!0,b.push(z[q])):C[q]=!1}}},mo.prototype._forEachCell=function(t,o,u,p,y,b,C,O){for(var D=this._convertToCellCoord(t),z=this._convertToCellCoord(o),Z=this._convertToCellCoord(u),G=this._convertToCellCoord(p),q=D;q<=Z;q++)for(var ie=z;ie<=G;ie++){var Te=this.d*ie+q;if((!O||O(this._convertFromCellCoord(q),this._convertFromCellCoord(ie),this._convertFromCellCoord(q+1),this._convertFromCellCoord(ie+1)))&&y.call(this,t,o,u,p,Te,b,C,O))return}},mo.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},mo.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},mo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,o=3+this.cells.length+1+1,u=0,p=0;p<this.cells.length;p++)u+=this.cells[p].length;var y=new Int32Array(o+u+this.keys.length+this.bboxes.length);y[0]=this.extent,y[1]=this.n,y[2]=this.padding;for(var b=o,C=0;C<t.length;C++){var O=t[C];y[3+C]=b,y.set(O,b),b+=O.length}return y[3+t.length]=b,y.set(this.keys,b),y[3+t.length+1]=b+=this.keys.length,y.set(this.bboxes,b),b+=this.bboxes.length,y.buffer};var Zl=_e.ImageData,hc=_e.ImageBitmap,go={};function vn(t,o,u){u===void 0&&(u={}),Object.defineProperty(o,"_classRegistryKey",{value:t,writeable:!1}),go[t]={klass:o,omit:u.omit||[],shallow:u.shallow||[]}}for(var fo in vn("Object",Object),Ru.serialize=function(t,o){var u=t.toArrayBuffer();return o&&o.push(u),{buffer:u}},Ru.deserialize=function(t){return new Ru(t.buffer)},vn("Grid",Ru),vn("Color",Zi),vn("Error",Error),vn("ResolvedImage",sa),vn("StylePropertyFunction",Ku),vn("StyleExpression",Uc,{omit:["_evaluator"]}),vn("ZoomDependentExpression",fl),vn("ZoomConstantExpression",Ll),vn("CompoundExpression",$a,{omit:["_evaluate"]}),Pu)Pu[fo]._classRegistryKey||vn("Expression_"+fo,Pu[fo]);function Ju(t){return t&&typeof ArrayBuffer!="undefined"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function ka(t){return hc&&t instanceof hc}function Qs(t,o){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Ju(t)||ka(t))return o&&o.push(t),t;if(ArrayBuffer.isView(t)){var u=t;return o&&o.push(u.buffer),u}if(t instanceof Zl)return o&&o.push(t.data.buffer),t;if(Array.isArray(t)){for(var p=[],y=0,b=t;y<b.length;y+=1)p.push(Qs(b[y],o));return p}if(typeof t=="object"){var C=t.constructor,O=C._classRegistryKey;if(!O)throw new Error("can't serialize object of unregistered class");var D=C.serialize?C.serialize(t,o):{};if(!C.serialize){for(var z in t)if(t.hasOwnProperty(z)&&!(go[O].omit.indexOf(z)>=0)){var Z=t[z];D[z]=go[O].shallow.indexOf(z)>=0?Z:Qs(Z,o)}t instanceof Error&&(D.message=t.message)}if(D.$name)throw new Error("$name property is reserved for worker serialization logic.");return O!=="Object"&&(D.$name=O),D}throw new Error("can't serialize object of type "+typeof t)}function Os(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Ju(t)||ka(t)||ArrayBuffer.isView(t)||t instanceof Zl)return t;if(Array.isArray(t))return t.map(Os);if(typeof t=="object"){var o=t.$name||"Object",u=go[o].klass;if(!u)throw new Error("can't deserialize unregistered class "+o);if(u.deserialize)return u.deserialize(t);for(var p=Object.create(u.prototype),y=0,b=Object.keys(t);y<b.length;y+=1){var C=b[y];if(C!=="$name"){var O=t[C];p[C]=go[o].shallow.indexOf(C)>=0?O:Os(O)}}return p}throw new Error("can't deserialize object of type "+typeof t)}var Af=function(){this.first=!0};Af.prototype.update=function(t,o){var u=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=o):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=o),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=u,!0))};var Zr={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function pc(t){for(var o=0,u=t;o<u.length;o+=1)if(wf(u[o].charCodeAt(0)))return!0;return!1}function wf(t){return!(t!==746&&t!==747&&(t<4352||!(Zr["Bopomofo Extended"](t)||Zr.Bopomofo(t)||Zr["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Zr["CJK Compatibility Ideographs"](t)||Zr["CJK Compatibility"](t)||Zr["CJK Radicals Supplement"](t)||Zr["CJK Strokes"](t)||!(!Zr["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||Zr["CJK Unified Ideographs Extension A"](t)||Zr["CJK Unified Ideographs"](t)||Zr["Enclosed CJK Letters and Months"](t)||Zr["Hangul Compatibility Jamo"](t)||Zr["Hangul Jamo Extended-A"](t)||Zr["Hangul Jamo Extended-B"](t)||Zr["Hangul Jamo"](t)||Zr["Hangul Syllables"](t)||Zr.Hiragana(t)||Zr["Ideographic Description Characters"](t)||Zr.Kanbun(t)||Zr["Kangxi Radicals"](t)||Zr["Katakana Phonetic Extensions"](t)||Zr.Katakana(t)&&t!==12540||!(!Zr["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!Zr["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Zr["Unified Canadian Aboriginal Syllabics"](t)||Zr["Unified Canadian Aboriginal Syllabics Extended"](t)||Zr["Vertical Forms"](t)||Zr["Yijing Hexagram Symbols"](t)||Zr["Yi Syllables"](t)||Zr["Yi Radicals"](t))))}function hl(t){return!(wf(t)||function(o){return!!(Zr["Latin-1 Supplement"](o)&&(o===167||o===169||o===174||o===177||o===188||o===189||o===190||o===215||o===247)||Zr["General Punctuation"](o)&&(o===8214||o===8224||o===8225||o===8240||o===8241||o===8251||o===8252||o===8258||o===8263||o===8264||o===8265||o===8273)||Zr["Letterlike Symbols"](o)||Zr["Number Forms"](o)||Zr["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||o===9003||o>=9085&&o<=9114||o>=9150&&o<=9165||o===9167||o>=9169&&o<=9179||o>=9186&&o<=9215)||Zr["Control Pictures"](o)&&o!==9251||Zr["Optical Character Recognition"](o)||Zr["Enclosed Alphanumerics"](o)||Zr["Geometric Shapes"](o)||Zr["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||Zr["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||Zr["CJK Symbols and Punctuation"](o)||Zr.Katakana(o)||Zr["Private Use Area"](o)||Zr["CJK Compatibility Forms"](o)||Zr["Small Form Variants"](o)||Zr["Halfwidth and Fullwidth Forms"](o)||o===8734||o===8756||o===8757||o>=9984&&o<=10087||o>=10102&&o<=10131||o===65532||o===65533)}(t))}function Aa(t){return t>=1424&&t<=2303||Zr["Arabic Presentation Forms-A"](t)||Zr["Arabic Presentation Forms-B"](t)}function Cs(t,o){return!(!o&&Aa(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Zr.Khmer(t))}function Tf(t){for(var o=0,u=t;o<u.length;o+=1)if(Aa(u[o].charCodeAt(0)))return!0;return!1}var ku=null,Bs="unavailable",Lu=null,qf=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(Bs="error"),ku&&ku(t)};function pl(){Kf.fire(new Me("pluginStateChange",{pluginStatus:Bs,pluginURL:Lu}))}var Kf=new Qe,Mf=function(){return Bs},vu=function(){if(Bs!=="deferred"||!Lu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Bs="loading",pl(),Lu&&Na({url:Lu},function(t){t?qf(t):(Bs="loaded",pl())})},Is={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Bs==="loaded"||Is.applyArabicShaping!=null},isLoading:function(){return Bs==="loading"},setState:function(t){Bs=t.pluginStatus,Lu=t.pluginURL},isParsed:function(){return Is.applyArabicShaping!=null&&Is.processBidirectionalText!=null&&Is.processStyledBidirectionalText!=null},getPluginURL:function(){return Lu}},Ai=function(t,o){this.zoom=t,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.zoomHistory=o.zoomHistory,this.transition=o.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Af,this.transition={})};Ai.prototype.isSupportedScript=function(t){return function(o,u){for(var p=0,y=o;p<y.length;p+=1)if(!Cs(y[p].charCodeAt(0),u))return!1;return!0}(t,Is.isLoaded())},Ai.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Ai.prototype.getCrossfadeParameters=function(){var t=this.zoom,o=t-Math.floor(t),u=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:o+(1-o)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*o}};var Du=function(t,o){this.property=t,this.value=o,this.expression=function(u,p){if(kl(u))return new Ku(u,p);if(oc(u)){var y=Dl(u,p);if(y.result==="error")throw new Error(y.value.map(function(C){return C.key+": "+C.message}).join(", "));return y.value}var b=u;return typeof u=="string"&&p.type==="color"&&(b=Zi.parse(u)),{kind:"constant",evaluate:function(){return b}}}(o===void 0?t.specification.default:o,t.specification)};Du.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Du.prototype.possiblyEvaluate=function(t,o,u){return this.property.possiblyEvaluate(this,t,o,u)};var mu=function(t){this.property=t,this.value=new Du(t,void 0)};mu.prototype.transitioned=function(t,o){return new dl(this.property,this.value,o,Tt({},t.transition,this.transition),t.now)},mu.prototype.untransitioned=function(){return new dl(this.property,this.value,null,{},0)};var Go=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};Go.prototype.getValue=function(t){return qe(this._values[t].value.value)},Go.prototype.setValue=function(t,o){this._values.hasOwnProperty(t)||(this._values[t]=new mu(this._values[t].property)),this._values[t].value=new Du(this._values[t].property,o===null?void 0:qe(o))},Go.prototype.getTransition=function(t){return qe(this._values[t].transition)},Go.prototype.setTransition=function(t,o){this._values.hasOwnProperty(t)||(this._values[t]=new mu(this._values[t].property)),this._values[t].transition=qe(o)||void 0},Go.prototype.serialize=function(){for(var t={},o=0,u=Object.keys(this._values);o<u.length;o+=1){var p=u[o],y=this.getValue(p);y!==void 0&&(t[p]=y);var b=this.getTransition(p);b!==void 0&&(t[p+"-transition"]=b)}return t},Go.prototype.transitioned=function(t,o){for(var u=new as(this._properties),p=0,y=Object.keys(this._values);p<y.length;p+=1){var b=y[p];u._values[b]=this._values[b].transitioned(t,o._values[b])}return u},Go.prototype.untransitioned=function(){for(var t=new as(this._properties),o=0,u=Object.keys(this._values);o<u.length;o+=1){var p=u[o];t._values[p]=this._values[p].untransitioned()}return t};var dl=function(t,o,u,p,y){this.property=t,this.value=o,this.begin=y+p.delay||0,this.end=this.begin+p.duration||0,t.specification.transition&&(p.delay||p.duration)&&(this.prior=u)};dl.prototype.possiblyEvaluate=function(t,o,u){var p=t.now||0,y=this.value.possiblyEvaluate(t,o,u),b=this.prior;if(b){if(p>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(p<this.begin)return b.possiblyEvaluate(t,o,u);var C=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(t,o,u),y,function(O){if(O<=0)return 0;if(O>=1)return 1;var D=O*O,z=D*O;return 4*(O<.5?z:3*(O-D)+z-.75)}(C))}return y};var as=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};as.prototype.possiblyEvaluate=function(t,o,u){for(var p=new Eu(this._properties),y=0,b=Object.keys(this._values);y<b.length;y+=1){var C=b[y];p._values[C]=this._values[C].possiblyEvaluate(t,o,u)}return p},as.prototype.hasTransition=function(){for(var t=0,o=Object.keys(this._values);t<o.length;t+=1)if(this._values[o[t]].prior)return!0;return!1};var Js=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};Js.prototype.getValue=function(t){return qe(this._values[t].value)},Js.prototype.setValue=function(t,o){this._values[t]=new Du(this._values[t].property,o===null?void 0:qe(o))},Js.prototype.serialize=function(){for(var t={},o=0,u=Object.keys(this._values);o<u.length;o+=1){var p=u[o],y=this.getValue(p);y!==void 0&&(t[p]=y)}return t},Js.prototype.possiblyEvaluate=function(t,o,u){for(var p=new Eu(this._properties),y=0,b=Object.keys(this._values);y<b.length;y+=1){var C=b[y];p._values[C]=this._values[C].possiblyEvaluate(t,o,u)}return p};var As=function(t,o,u){this.property=t,this.value=o,this.parameters=u};As.prototype.isConstant=function(){return this.value.kind==="constant"},As.prototype.constantOr=function(t){return this.value.kind==="constant"?this.value.value:t},As.prototype.evaluate=function(t,o,u,p){return this.property.evaluate(this.value,this.parameters,t,o,u,p)};var Eu=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};Eu.prototype.get=function(t){return this._values[t]};var In=function(t){this.specification=t};In.prototype.possiblyEvaluate=function(t,o){return t.expression.evaluate(o)},In.prototype.interpolate=function(t,o,u){var p=xa[this.specification.type];return p?p(t,o,u):t};var Cn=function(t,o){this.specification=t,this.overrides=o};Cn.prototype.possiblyEvaluate=function(t,o,u,p){return new As(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(o,null,{},u,p)}:t.expression,o)},Cn.prototype.interpolate=function(t,o,u){if(t.value.kind!=="constant"||o.value.kind!=="constant")return t;if(t.value.value===void 0||o.value.value===void 0)return new As(this,{kind:"constant",value:void 0},t.parameters);var p=xa[this.specification.type];return p?new As(this,{kind:"constant",value:p(t.value.value,o.value.value,u)},t.parameters):t},Cn.prototype.evaluate=function(t,o,u,p,y,b){return t.kind==="constant"?t.value:t.evaluate(o,u,p,y,b)};var Hc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.possiblyEvaluate=function(u,p,y,b){if(u.value===void 0)return new As(this,{kind:"constant",value:void 0},p);if(u.expression.kind==="constant"){var C=u.expression.evaluate(p,null,{},y,b),O=u.property.specification.type==="resolvedImage"&&typeof C!="string"?C.name:C,D=this._calculate(O,O,O,p);return new As(this,{kind:"constant",value:D},p)}if(u.expression.kind==="camera"){var z=this._calculate(u.expression.evaluate({zoom:p.zoom-1}),u.expression.evaluate({zoom:p.zoom}),u.expression.evaluate({zoom:p.zoom+1}),p);return new As(this,{kind:"constant",value:z},p)}return new As(this,u.expression,p)},o.prototype.evaluate=function(u,p,y,b,C,O){if(u.kind==="source"){var D=u.evaluate(p,y,b,C,O);return this._calculate(D,D,D,p)}return u.kind==="composite"?this._calculate(u.evaluate({zoom:Math.floor(p.zoom)-1},y,b),u.evaluate({zoom:Math.floor(p.zoom)},y,b),u.evaluate({zoom:Math.floor(p.zoom)+1},y,b),p):u.value},o.prototype._calculate=function(u,p,y,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:u,to:p}:{from:y,to:p}},o.prototype.interpolate=function(u){return u},o}(Cn),Qo=function(t){this.specification=t};Qo.prototype.possiblyEvaluate=function(t,o,u,p){if(t.value!==void 0){if(t.expression.kind==="constant"){var y=t.expression.evaluate(o,null,{},u,p);return this._calculate(y,y,y,o)}return this._calculate(t.expression.evaluate(new Ai(Math.floor(o.zoom-1),o)),t.expression.evaluate(new Ai(Math.floor(o.zoom),o)),t.expression.evaluate(new Ai(Math.floor(o.zoom+1),o)),o)}},Qo.prototype._calculate=function(t,o,u,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:t,to:o}:{from:u,to:o}},Qo.prototype.interpolate=function(t){return t};var eu=function(t){this.specification=t};eu.prototype.possiblyEvaluate=function(t,o,u,p){return!!t.expression.evaluate(o,null,{},u,p)},eu.prototype.interpolate=function(){return!1};var Ho=function(t){for(var o in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var u=t[o];u.specification.overridable&&this.overridableProperties.push(o);var p=this.defaultPropertyValues[o]=new Du(u,void 0),y=this.defaultTransitionablePropertyValues[o]=new mu(u);this.defaultTransitioningPropertyValues[o]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=p.possiblyEvaluate({})}};vn("DataDrivenProperty",Cn),vn("DataConstantProperty",In),vn("CrossFadedDataDrivenProperty",Hc),vn("CrossFadedProperty",Qo),vn("ColorRampProperty",eu);var gu=function(t){function o(u,p){if(t.call(this),this.id=u.id,this.type=u.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},u.type!=="custom"&&(this.metadata=(u=u).metadata,this.minzoom=u.minzoom,this.maxzoom=u.maxzoom,u.type!=="background"&&(this.source=u.source,this.sourceLayer=u["source-layer"],this.filter=u.filter),p.layout&&(this._unevaluatedLayout=new Js(p.layout)),p.paint)){for(var y in this._transitionablePaint=new Go(p.paint),u.paint)this.setPaintProperty(y,u.paint[y],{validate:!1});for(var b in u.layout)this.setLayoutProperty(b,u.layout[b],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Eu(p.paint)}}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},o.prototype.getLayoutProperty=function(u){return u==="visibility"?this.visibility:this._unevaluatedLayout.getValue(u)},o.prototype.setLayoutProperty=function(u,p,y){y===void 0&&(y={}),p!=null&&this._validate(Qu,"layers."+this.id+".layout."+u,u,p,y)||(u!=="visibility"?this._unevaluatedLayout.setValue(u,p):this.visibility=p)},o.prototype.getPaintProperty=function(u){return Y(u,"-transition")?this._transitionablePaint.getTransition(u.slice(0,-"-transition".length)):this._transitionablePaint.getValue(u)},o.prototype.setPaintProperty=function(u,p,y){if(y===void 0&&(y={}),p!=null&&this._validate(Ul,"layers."+this.id+".paint."+u,u,p,y))return!1;if(Y(u,"-transition"))return this._transitionablePaint.setTransition(u.slice(0,-"-transition".length),p||void 0),!1;var b=this._transitionablePaint._values[u],C=b.property.specification["property-type"]==="cross-faded-data-driven",O=b.value.isDataDriven(),D=b.value;this._transitionablePaint.setValue(u,p),this._handleSpecialPaintPropertyUpdate(u);var z=this._transitionablePaint._values[u].value;return z.isDataDriven()||O||C||this._handleOverridablePaintPropertyUpdate(u,D,z)},o.prototype._handleSpecialPaintPropertyUpdate=function(u){},o.prototype._handleOverridablePaintPropertyUpdate=function(u,p,y){return!1},o.prototype.isHidden=function(u){return!!(this.minzoom&&u<this.minzoom)||!!(this.maxzoom&&u>=this.maxzoom)||this.visibility==="none"},o.prototype.updateTransitions=function(u){this._transitioningPaint=this._transitionablePaint.transitioned(u,this._transitioningPaint)},o.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},o.prototype.recalculate=function(u,p){u.getCrossfadeParameters&&(this._crossfadeParameters=u.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(u,void 0,p)),this.paint=this._transitioningPaint.possiblyEvaluate(u,void 0,p)},o.prototype.serialize=function(){var u={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(u.layout=u.layout||{},u.layout.visibility=this.visibility),at(u,function(p,y){return!(p===void 0||y==="layout"&&!Object.keys(p).length||y==="paint"&&!Object.keys(p).length)})},o.prototype._validate=function(u,p,y,b,C){return C===void 0&&(C={}),(!C||C.validate!==!1)&&Gc(this,u.call(Za,{key:p,layerType:this.type,objectKey:y,value:b,styleSpec:se,style:{glyphs:!0,sprite:!0}}))},o.prototype.is3D=function(){return!1},o.prototype.isTileClipped=function(){return!1},o.prototype.hasOffscreenPass=function(){return!1},o.prototype.resize=function(){},o.prototype.isStateDependent=function(){for(var u in this.paint._values){var p=this.paint.get(u);if(p instanceof As&&pu(p.property.specification)&&(p.value.kind==="source"||p.value.kind==="composite")&&p.value.isStateDependent)return!0}return!1},o}(Qe),$f={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Wc=function(t,o){this._structArray=t,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},ya=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function La(t,o){o===void 0&&(o=1);var u=0,p=0;return{members:t.map(function(y){var b=$f[y.type].BYTES_PER_ELEMENT,C=u=vl(u,Math.max(o,b)),O=y.components||1;return p=Math.max(p,b),u+=b*O,{name:y.name,type:y.type,components:O,offset:C}}),size:vl(u,Math.max(p,o)),alignment:o}}function vl(t,o){return Math.ceil(t/o)*o}ya.serialize=function(t,o){return t._trim(),o&&(t.isTransferred=!0,o.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},ya.deserialize=function(t){var o=Object.create(this.prototype);return o.arrayBuffer=t.arrayBuffer,o.length=t.length,o.capacity=t.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o},ya.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},ya.prototype.clear=function(){this.length=0},ya.prototype.resize=function(t){this.reserve(t),this.length=t},ya.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}},ya.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var dc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p){var y=this.length;return this.resize(y+1),this.emplace(y,u,p)},o.prototype.emplace=function(u,p,y){var b=2*u;return this.int16[b+0]=p,this.int16[b+1]=y,u},o}(ya);dc.prototype.bytesPerElement=4,vn("StructArrayLayout2i4",dc);var Ns=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b){var C=this.length;return this.resize(C+1),this.emplace(C,u,p,y,b)},o.prototype.emplace=function(u,p,y,b,C){var O=4*u;return this.int16[O+0]=p,this.int16[O+1]=y,this.int16[O+2]=b,this.int16[O+3]=C,u},o}(ya);Ns.prototype.bytesPerElement=8,vn("StructArrayLayout4i8",Ns);var yu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,C,O){var D=this.length;return this.resize(D+1),this.emplace(D,u,p,y,b,C,O)},o.prototype.emplace=function(u,p,y,b,C,O,D){var z=6*u;return this.int16[z+0]=p,this.int16[z+1]=y,this.int16[z+2]=b,this.int16[z+3]=C,this.int16[z+4]=O,this.int16[z+5]=D,u},o}(ya);yu.prototype.bytesPerElement=12,vn("StructArrayLayout2i4i12",yu);var pi=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,C,O){var D=this.length;return this.resize(D+1),this.emplace(D,u,p,y,b,C,O)},o.prototype.emplace=function(u,p,y,b,C,O,D){var z=4*u,Z=8*u;return this.int16[z+0]=p,this.int16[z+1]=y,this.uint8[Z+4]=b,this.uint8[Z+5]=C,this.uint8[Z+6]=O,this.uint8[Z+7]=D,u},o}(ya);pi.prototype.bytesPerElement=8,vn("StructArrayLayout2i4ub8",pi);var zs=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p){var y=this.length;return this.resize(y+1),this.emplace(y,u,p)},o.prototype.emplace=function(u,p,y){var b=2*u;return this.float32[b+0]=p,this.float32[b+1]=y,u},o}(ya);zs.prototype.bytesPerElement=8,vn("StructArrayLayout2f8",zs);var os=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,C,O,D,z,Z,G){var q=this.length;return this.resize(q+1),this.emplace(q,u,p,y,b,C,O,D,z,Z,G)},o.prototype.emplace=function(u,p,y,b,C,O,D,z,Z,G,q){var ie=10*u;return this.uint16[ie+0]=p,this.uint16[ie+1]=y,this.uint16[ie+2]=b,this.uint16[ie+3]=C,this.uint16[ie+4]=O,this.uint16[ie+5]=D,this.uint16[ie+6]=z,this.uint16[ie+7]=Z,this.uint16[ie+8]=G,this.uint16[ie+9]=q,u},o}(ya);os.prototype.bytesPerElement=20,vn("StructArrayLayout10ui20",os);var jl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,C,O,D,z,Z,G,q,ie){var Te=this.length;return this.resize(Te+1),this.emplace(Te,u,p,y,b,C,O,D,z,Z,G,q,ie)},o.prototype.emplace=function(u,p,y,b,C,O,D,z,Z,G,q,ie,Te){var Oe=12*u;return this.int16[Oe+0]=p,this.int16[Oe+1]=y,this.int16[Oe+2]=b,this.int16[Oe+3]=C,this.uint16[Oe+4]=O,this.uint16[Oe+5]=D,this.uint16[Oe+6]=z,this.uint16[Oe+7]=Z,this.int16[Oe+8]=G,this.int16[Oe+9]=q,this.int16[Oe+10]=ie,this.int16[Oe+11]=Te,u},o}(ya);jl.prototype.bytesPerElement=24,vn("StructArrayLayout4i4ui4i24",jl);var Fu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,p,y)},o.prototype.emplace=function(u,p,y,b){var C=3*u;return this.float32[C+0]=p,this.float32[C+1]=y,this.float32[C+2]=b,u},o}(ya);Fu.prototype.bytesPerElement=12,vn("StructArrayLayout3f12",Fu);var el=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var p=this.length;return this.resize(p+1),this.emplace(p,u)},o.prototype.emplace=function(u,p){return this.uint32[1*u+0]=p,u},o}(ya);el.prototype.bytesPerElement=4,vn("StructArrayLayout1ul4",el);var Xc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,C,O,D,z,Z){var G=this.length;return this.resize(G+1),this.emplace(G,u,p,y,b,C,O,D,z,Z)},o.prototype.emplace=function(u,p,y,b,C,O,D,z,Z,G){var q=10*u,ie=5*u;return this.int16[q+0]=p,this.int16[q+1]=y,this.int16[q+2]=b,this.int16[q+3]=C,this.int16[q+4]=O,this.int16[q+5]=D,this.uint32[ie+3]=z,this.uint16[q+8]=Z,this.uint16[q+9]=G,u},o}(ya);Xc.prototype.bytesPerElement=20,vn("StructArrayLayout6i1ul2ui20",Xc);var Da=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,C,O){var D=this.length;return this.resize(D+1),this.emplace(D,u,p,y,b,C,O)},o.prototype.emplace=function(u,p,y,b,C,O,D){var z=6*u;return this.int16[z+0]=p,this.int16[z+1]=y,this.int16[z+2]=b,this.int16[z+3]=C,this.int16[z+4]=O,this.int16[z+5]=D,u},o}(ya);Da.prototype.bytesPerElement=12,vn("StructArrayLayout2i2i2i12",Da);var tu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,C){var O=this.length;return this.resize(O+1),this.emplace(O,u,p,y,b,C)},o.prototype.emplace=function(u,p,y,b,C,O){var D=4*u,z=8*u;return this.float32[D+0]=p,this.float32[D+1]=y,this.float32[D+2]=b,this.int16[z+6]=C,this.int16[z+7]=O,u},o}(ya);tu.prototype.bytesPerElement=16,vn("StructArrayLayout2f1f2i16",tu);var Vl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b){var C=this.length;return this.resize(C+1),this.emplace(C,u,p,y,b)},o.prototype.emplace=function(u,p,y,b,C){var O=12*u,D=3*u;return this.uint8[O+0]=p,this.uint8[O+1]=y,this.float32[D+1]=b,this.float32[D+2]=C,u},o}(ya);Vl.prototype.bytesPerElement=12,vn("StructArrayLayout2ub2f12",Vl);var ml=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,p,y)},o.prototype.emplace=function(u,p,y,b){var C=3*u;return this.uint16[C+0]=p,this.uint16[C+1]=y,this.uint16[C+2]=b,u},o}(ya);ml.prototype.bytesPerElement=6,vn("StructArrayLayout3ui6",ml);var gl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,C,O,D,z,Z,G,q,ie,Te,Oe,k,Ue,rt){var bt=this.length;return this.resize(bt+1),this.emplace(bt,u,p,y,b,C,O,D,z,Z,G,q,ie,Te,Oe,k,Ue,rt)},o.prototype.emplace=function(u,p,y,b,C,O,D,z,Z,G,q,ie,Te,Oe,k,Ue,rt,bt){var Ut=24*u,Gt=12*u,ir=48*u;return this.int16[Ut+0]=p,this.int16[Ut+1]=y,this.uint16[Ut+2]=b,this.uint16[Ut+3]=C,this.uint32[Gt+2]=O,this.uint32[Gt+3]=D,this.uint32[Gt+4]=z,this.uint16[Ut+10]=Z,this.uint16[Ut+11]=G,this.uint16[Ut+12]=q,this.float32[Gt+7]=ie,this.float32[Gt+8]=Te,this.uint8[ir+36]=Oe,this.uint8[ir+37]=k,this.uint8[ir+38]=Ue,this.uint32[Gt+10]=rt,this.int16[Ut+22]=bt,u},o}(ya);gl.prototype.bytesPerElement=48,vn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",gl);var Yc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,C,O,D,z,Z,G,q,ie,Te,Oe,k,Ue,rt,bt,Ut,Gt,ir,Mr,Dr,Dn,cn,Vn,hn,Pi){var ei=this.length;return this.resize(ei+1),this.emplace(ei,u,p,y,b,C,O,D,z,Z,G,q,ie,Te,Oe,k,Ue,rt,bt,Ut,Gt,ir,Mr,Dr,Dn,cn,Vn,hn,Pi)},o.prototype.emplace=function(u,p,y,b,C,O,D,z,Z,G,q,ie,Te,Oe,k,Ue,rt,bt,Ut,Gt,ir,Mr,Dr,Dn,cn,Vn,hn,Pi,ei){var wn=34*u,ji=17*u;return this.int16[wn+0]=p,this.int16[wn+1]=y,this.int16[wn+2]=b,this.int16[wn+3]=C,this.int16[wn+4]=O,this.int16[wn+5]=D,this.int16[wn+6]=z,this.int16[wn+7]=Z,this.uint16[wn+8]=G,this.uint16[wn+9]=q,this.uint16[wn+10]=ie,this.uint16[wn+11]=Te,this.uint16[wn+12]=Oe,this.uint16[wn+13]=k,this.uint16[wn+14]=Ue,this.uint16[wn+15]=rt,this.uint16[wn+16]=bt,this.uint16[wn+17]=Ut,this.uint16[wn+18]=Gt,this.uint16[wn+19]=ir,this.uint16[wn+20]=Mr,this.uint16[wn+21]=Dr,this.uint16[wn+22]=Dn,this.uint32[ji+12]=cn,this.float32[ji+13]=Vn,this.float32[ji+14]=hn,this.float32[ji+15]=Pi,this.float32[ji+16]=ei,u},o}(ya);Yc.prototype.bytesPerElement=68,vn("StructArrayLayout8i15ui1ul4f68",Yc);var yl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var p=this.length;return this.resize(p+1),this.emplace(p,u)},o.prototype.emplace=function(u,p){return this.float32[1*u+0]=p,u},o}(ya);yl.prototype.bytesPerElement=4,vn("StructArrayLayout1f4",yl);var ru=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,p,y)},o.prototype.emplace=function(u,p,y,b){var C=3*u;return this.int16[C+0]=p,this.int16[C+1]=y,this.int16[C+2]=b,u},o}(ya);ru.prototype.bytesPerElement=6,vn("StructArrayLayout3i6",ru);var vc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,p,y)},o.prototype.emplace=function(u,p,y,b){var C=4*u;return this.uint32[2*u+0]=p,this.uint16[C+2]=y,this.uint16[C+3]=b,u},o}(ya);vc.prototype.bytesPerElement=8,vn("StructArrayLayout1ul2ui8",vc);var Gl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p){var y=this.length;return this.resize(y+1),this.emplace(y,u,p)},o.prototype.emplace=function(u,p,y){var b=2*u;return this.uint16[b+0]=p,this.uint16[b+1]=y,u},o}(ya);Gl.prototype.bytesPerElement=4,vn("StructArrayLayout2ui4",Gl);var Qf=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var p=this.length;return this.resize(p+1),this.emplace(p,u)},o.prototype.emplace=function(u,p){return this.uint16[1*u+0]=p,u},o}(ya);Qf.prototype.bytesPerElement=2,vn("StructArrayLayout1ui2",Qf);var Hl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b){var C=this.length;return this.resize(C+1),this.emplace(C,u,p,y,b)},o.prototype.emplace=function(u,p,y,b,C){var O=4*u;return this.float32[O+0]=p,this.float32[O+1]=y,this.float32[O+2]=b,this.float32[O+3]=C,u},o}(ya);Hl.prototype.bytesPerElement=16,vn("StructArrayLayout4f16",Hl);var l=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return u.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},u.x1.get=function(){return this._structArray.int16[this._pos2+2]},u.y1.get=function(){return this._structArray.int16[this._pos2+3]},u.x2.get=function(){return this._structArray.int16[this._pos2+4]},u.y2.get=function(){return this._structArray.int16[this._pos2+5]},u.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},u.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},u.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},u.anchorPoint.get=function(){return new de(this.anchorPointX,this.anchorPointY)},Object.defineProperties(o.prototype,u),o}(Wc);l.prototype.size=20;var h=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new l(this,u)},o}(Xc);vn("CollisionBoxArray",h);var c=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return u.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},u.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},u.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},u.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},u.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},u.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},u.segment.get=function(){return this._structArray.uint16[this._pos2+10]},u.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},u.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},u.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},u.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},u.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},u.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},u.placedOrientation.set=function(p){this._structArray.uint8[this._pos1+37]=p},u.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},u.hidden.set=function(p){this._structArray.uint8[this._pos1+38]=p},u.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},u.crossTileID.set=function(p){this._structArray.uint32[this._pos4+10]=p},u.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(o.prototype,u),o}(Wc);c.prototype.size=48;var d=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new c(this,u)},o}(gl);vn("PlacedSymbolArray",d);var E=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return u.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},u.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},u.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},u.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},u.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},u.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},u.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},u.key.get=function(){return this._structArray.uint16[this._pos2+8]},u.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},u.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},u.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},u.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},u.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},u.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},u.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},u.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},u.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},u.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},u.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},u.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},u.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},u.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},u.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},u.crossTileID.set=function(p){this._structArray.uint32[this._pos4+12]=p},u.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},u.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},u.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},u.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(o.prototype,u),o}(Wc);E.prototype.size=68;var w=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new E(this,u)},o}(Yc);vn("SymbolInstanceArray",w);var P=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getoffsetX=function(u){return this.float32[1*u+0]},o}(yl);vn("GlyphOffsetArray",P);var L=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getx=function(u){return this.int16[3*u+0]},o.prototype.gety=function(u){return this.int16[3*u+1]},o.prototype.gettileUnitDistanceFromAnchor=function(u){return this.int16[3*u+2]},o}(ru);vn("SymbolLineVertexArray",L);var U=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return u.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},u.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},u.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(o.prototype,u),o}(Wc);U.prototype.size=8;var H=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new U(this,u)},o}(vc);vn("FeatureIndexArray",H);var oe=La([{name:"a_pos",components:2,type:"Int16"}],4).members,ue=function(t){t===void 0&&(t=[]),this.segments=t};function le(t,o){return 256*(t=Nt(Math.floor(t),0,255))+Nt(Math.floor(o),0,255)}ue.prototype.prepareSegment=function(t,o,u,p){var y=this.segments[this.segments.length-1];return t>ue.MAX_VERTEX_ARRAY_LENGTH&&$e("Max vertices per segment is "+ue.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!y||y.vertexLength+t>ue.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==p)&&(y={vertexOffset:o.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},p!==void 0&&(y.sortKey=p),this.segments.push(y)),y},ue.prototype.get=function(){return this.segments},ue.prototype.destroy=function(){for(var t=0,o=this.segments;t<o.length;t+=1){var u=o[t];for(var p in u.vaos)u.vaos[p].destroy()}},ue.simpleSegment=function(t,o,u,p){return new ue([{vertexOffset:t,primitiveOffset:o,vertexLength:u,primitiveLength:p,vaos:{},sortKey:0}])},ue.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,vn("SegmentVector",ue);var Ie=La([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Pe=Re(function(t){t.exports=function(o,u){var p,y,b,C,O,D,z,Z;for(y=o.length-(p=3&o.length),b=u,O=3432918353,D=461845907,Z=0;Z<y;)z=255&o.charCodeAt(Z)|(255&o.charCodeAt(++Z))<<8|(255&o.charCodeAt(++Z))<<16|(255&o.charCodeAt(++Z))<<24,++Z,b=27492+(65535&(C=5*(65535&(b=(b^=z=(65535&(z=(z=(65535&z)*O+(((z>>>16)*O&65535)<<16)&4294967295)<<15|z>>>17))*D+(((z>>>16)*D&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(C>>>16)&65535)<<16);switch(z=0,p){case 3:z^=(255&o.charCodeAt(Z+2))<<16;case 2:z^=(255&o.charCodeAt(Z+1))<<8;case 1:b^=z=(65535&(z=(z=(65535&(z^=255&o.charCodeAt(Z)))*O+(((z>>>16)*O&65535)<<16)&4294967295)<<15|z>>>17))*D+(((z>>>16)*D&65535)<<16)&4294967295}return b^=o.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0}}),Ne=Re(function(t){t.exports=function(o,u){for(var p,y=o.length,b=u^y,C=0;y>=4;)p=1540483477*(65535&(p=255&o.charCodeAt(C)|(255&o.charCodeAt(++C))<<8|(255&o.charCodeAt(++C))<<16|(255&o.charCodeAt(++C))<<24))+((1540483477*(p>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),y-=4,++C;switch(y){case 3:b^=(255&o.charCodeAt(C+2))<<16;case 2:b^=(255&o.charCodeAt(C+1))<<8;case 1:b=1540483477*(65535&(b^=255&o.charCodeAt(C)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0}}),xe=Pe,je=Ne;xe.murmur3=Pe,xe.murmur2=je;var Ke=function(){this.ids=[],this.positions=[],this.indexed=!1};Ke.prototype.add=function(t,o,u,p){this.ids.push(Wt(t)),this.positions.push(o,u,p)},Ke.prototype.getPositions=function(t){for(var o=Wt(t),u=0,p=this.ids.length-1;u<p;){var y=u+p>>1;this.ids[y]>=o?p=y:u=y+1}for(var b=[];this.ids[u]===o;)b.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return b},Ke.serialize=function(t,o){var u=new Float64Array(t.ids),p=new Uint32Array(t.positions);return function y(b,C,O,D){for(;O<D;){for(var z=b[O+D>>1],Z=O-1,G=D+1;;){do Z++;while(b[Z]<z);do G--;while(b[G]>z);if(Z>=G)break;jt(b,Z,G),jt(C,3*Z,3*G),jt(C,3*Z+1,3*G+1),jt(C,3*Z+2,3*G+2)}G-O<D-G?(y(b,C,O,G),O=G+1):(y(b,C,G+1,D),D=G)}}(u,p,0,u.length-1),o&&o.push(u.buffer,p.buffer),{ids:u,positions:p}},Ke.deserialize=function(t){var o=new Ke;return o.ids=t.ids,o.positions=t.positions,o.indexed=!0,o};var vt=Math.pow(2,53)-1;function Wt(t){var o=+t;return!isNaN(o)&&o<=vt?o:xe(String(t))}function jt(t,o,u){var p=t[o];t[o]=t[u],t[u]=p}vn("FeaturePositionMap",Ke);var qt=function(t,o){this.gl=t.gl,this.location=o},pr=function(t){function o(u,p){t.call(this,u,p),this.current=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))},o}(qt),kr=function(t){function o(u,p){t.call(this,u,p),this.current=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))},o}(qt),_r=function(t){function o(u,p){t.call(this,u,p),this.current=[0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1]))},o}(qt),sn=function(t){function o(u,p){t.call(this,u,p),this.current=[0,0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2]))},o}(qt),Zn=function(t){function o(u,p){t.call(this,u,p),this.current=[0,0,0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3]))},o}(qt),jn=function(t){function o(u,p){t.call(this,u,p),this.current=Zi.transparent}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a))},o}(qt),kn=new Float32Array(16),ki=function(t){function o(u,p){t.call(this,u,p),this.current=kn}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(var p=1;p<16;p++)if(u[p]!==this.current[p]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}},o}(qt);function tn(t){return[le(255*t.r,255*t.g),le(255*t.b,255*t.a)]}var ii=function(t,o,u){this.value=t,this.uniformNames=o.map(function(p){return"u_"+p}),this.type=u};ii.prototype.setUniform=function(t,o,u){t.set(u.constantOr(this.value))},ii.prototype.getBinding=function(t,o,u){return this.type==="color"?new jn(t,o):new kr(t,o)};var li=function(t,o){this.uniformNames=o.map(function(u){return"u_"+u}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};li.prototype.setConstantPatternPositions=function(t,o){this.pixelRatioFrom=o.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=o.tlbr,this.patternTo=t.tlbr},li.prototype.setUniform=function(t,o,u,p){var y=p==="u_pattern_to"?this.patternTo:p==="u_pattern_from"?this.patternFrom:p==="u_pixel_ratio_to"?this.pixelRatioTo:p==="u_pixel_ratio_from"?this.pixelRatioFrom:null;y&&t.set(y)},li.prototype.getBinding=function(t,o,u){return u.substr(0,9)==="u_pattern"?new Zn(t,o):new kr(t,o)};var $n=function(t,o,u,p){this.expression=t,this.type=u,this.maxValue=0,this.paintVertexAttributes=o.map(function(y){return{name:"a_"+y,type:"Float32",components:u==="color"?2:1,offset:0}}),this.paintVertexArray=new p};$n.prototype.populatePaintArray=function(t,o,u,p,y){var b=this.paintVertexArray.length,C=this.expression.evaluate(new Ai(0),o,{},p,[],y);this.paintVertexArray.resize(t),this._setPaintValue(b,t,C)},$n.prototype.updatePaintArray=function(t,o,u,p){var y=this.expression.evaluate({zoom:0},u,p);this._setPaintValue(t,o,y)},$n.prototype._setPaintValue=function(t,o,u){if(this.type==="color")for(var p=tn(u),y=t;y<o;y++)this.paintVertexArray.emplace(y,p[0],p[1]);else{for(var b=t;b<o;b++)this.paintVertexArray.emplace(b,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}},$n.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},$n.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Hn=function(t,o,u,p,y,b){this.expression=t,this.uniformNames=o.map(function(C){return"u_"+C+"_t"}),this.type=u,this.useIntegerZoom=p,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=o.map(function(C){return{name:"a_"+C,type:"Float32",components:u==="color"?4:2,offset:0}}),this.paintVertexArray=new b};Hn.prototype.populatePaintArray=function(t,o,u,p,y){var b=this.expression.evaluate(new Ai(this.zoom),o,{},p,[],y),C=this.expression.evaluate(new Ai(this.zoom+1),o,{},p,[],y),O=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(O,t,b,C)},Hn.prototype.updatePaintArray=function(t,o,u,p){var y=this.expression.evaluate({zoom:this.zoom},u,p),b=this.expression.evaluate({zoom:this.zoom+1},u,p);this._setPaintValue(t,o,y,b)},Hn.prototype._setPaintValue=function(t,o,u,p){if(this.type==="color")for(var y=tn(u),b=tn(p),C=t;C<o;C++)this.paintVertexArray.emplace(C,y[0],y[1],b[0],b[1]);else{for(var O=t;O<o;O++)this.paintVertexArray.emplace(O,u,p);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(p))}},Hn.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Hn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Hn.prototype.setUniform=function(t,o){var u=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,p=Nt(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);t.set(p)},Hn.prototype.getBinding=function(t,o,u){return new kr(t,o)};var di=function(t,o,u,p,y,b){this.expression=t,this.type=o,this.useIntegerZoom=u,this.zoom=p,this.layerId=b,this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y};di.prototype.populatePaintArray=function(t,o,u){var p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(p,t,o.patterns&&o.patterns[this.layerId],u)},di.prototype.updatePaintArray=function(t,o,u,p,y){this._setPaintValues(t,o,u.patterns&&u.patterns[this.layerId],y)},di.prototype._setPaintValues=function(t,o,u,p){if(p&&u){var y=p[u.min],b=p[u.mid],C=p[u.max];if(y&&b&&C)for(var O=t;O<o;O++)this.zoomInPaintVertexArray.emplace(O,b.tl[0],b.tl[1],b.br[0],b.br[1],y.tl[0],y.tl[1],y.br[0],y.br[1],b.pixelRatio,y.pixelRatio),this.zoomOutPaintVertexArray.emplace(O,b.tl[0],b.tl[1],b.br[0],b.br[1],C.tl[0],C.tl[1],C.br[0],C.br[1],b.pixelRatio,C.pixelRatio)}},di.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Ie.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Ie.members,this.expression.isStateDependent))},di.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Kn=function(t,o,u){this.binders={},this._buffers=[];var p=[];for(var y in t.paint._values)if(u(y)){var b=t.paint.get(y);if(b instanceof As&&pu(b.property.specification)){var C=yo(y,t.type),O=b.value,D=b.property.specification.type,z=b.property.useIntegerZoom,Z=b.property.specification["property-type"],G=Z==="cross-faded"||Z==="cross-faded-data-driven";if(O.kind==="constant")this.binders[y]=G?new li(O.value,C):new ii(O.value,C,D),p.push("/u_"+y);else if(O.kind==="source"||G){var q=Ja(y,D,"source");this.binders[y]=G?new di(O,D,z,o,q,t.id):new $n(O,C,D,q),p.push("/a_"+y)}else{var ie=Ja(y,D,"composite");this.binders[y]=new Hn(O,C,D,z,o,ie),p.push("/z_"+y)}}}this.cacheKey=p.sort().join("")};Kn.prototype.getMaxValue=function(t){var o=this.binders[t];return o instanceof $n||o instanceof Hn?o.maxValue:0},Kn.prototype.populatePaintArrays=function(t,o,u,p,y){for(var b in this.binders){var C=this.binders[b];(C instanceof $n||C instanceof Hn||C instanceof di)&&C.populatePaintArray(t,o,u,p,y)}},Kn.prototype.setConstantPatternPositions=function(t,o){for(var u in this.binders){var p=this.binders[u];p instanceof li&&p.setConstantPatternPositions(t,o)}},Kn.prototype.updatePaintArrays=function(t,o,u,p,y){var b=!1;for(var C in t)for(var O=0,D=o.getPositions(C);O<D.length;O+=1){var z=D[O],Z=u.feature(z.index);for(var G in this.binders){var q=this.binders[G];if((q instanceof $n||q instanceof Hn||q instanceof di)&&q.expression.isStateDependent===!0){var ie=p.paint.get(G);q.expression=ie.value,q.updatePaintArray(z.start,z.end,Z,t[C],y),b=!0}}}return b},Kn.prototype.defines=function(){var t=[];for(var o in this.binders){var u=this.binders[o];(u instanceof ii||u instanceof li)&&t.push.apply(t,u.uniformNames.map(function(p){return"#define HAS_UNIFORM_"+p}))}return t},Kn.prototype.getBinderAttributes=function(){var t=[];for(var o in this.binders){var u=this.binders[o];if(u instanceof $n||u instanceof Hn)for(var p=0;p<u.paintVertexAttributes.length;p++)t.push(u.paintVertexAttributes[p].name);else if(u instanceof di)for(var y=0;y<Ie.members.length;y++)t.push(Ie.members[y].name)}return t},Kn.prototype.getBinderUniforms=function(){var t=[];for(var o in this.binders){var u=this.binders[o];if(u instanceof ii||u instanceof li||u instanceof Hn)for(var p=0,y=u.uniformNames;p<y.length;p+=1)t.push(y[p])}return t},Kn.prototype.getPaintVertexBuffers=function(){return this._buffers},Kn.prototype.getUniforms=function(t,o){var u=[];for(var p in this.binders){var y=this.binders[p];if(y instanceof ii||y instanceof li||y instanceof Hn)for(var b=0,C=y.uniformNames;b<C.length;b+=1){var O=C[b];if(o[O]){var D=y.getBinding(t,o[O],O);u.push({name:O,property:p,binding:D})}}}return u},Kn.prototype.setUniforms=function(t,o,u,p){for(var y=0,b=o;y<b.length;y+=1){var C=b[y],O=C.name,D=C.property;this.binders[D].setUniform(C.binding,p,u.get(D),O)}},Kn.prototype.updatePaintBuffers=function(t){for(var o in this._buffers=[],this.binders){var u=this.binders[o];if(t&&u instanceof di){var p=t.fromScale===2?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(u instanceof $n||u instanceof Hn)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}},Kn.prototype.upload=function(t){for(var o in this.binders){var u=this.binders[o];(u instanceof $n||u instanceof Hn||u instanceof di)&&u.upload(t)}this.updatePaintBuffers()},Kn.prototype.destroy=function(){for(var t in this.binders){var o=this.binders[t];(o instanceof $n||o instanceof Hn||o instanceof di)&&o.destroy()}};var Xn=function(t,o,u){u===void 0&&(u=function(){return!0}),this.programConfigurations={};for(var p=0,y=t;p<y.length;p+=1){var b=y[p];this.programConfigurations[b.id]=new Kn(b,o,u)}this.needsUpload=!1,this._featureMap=new Ke,this._bufferOffset=0};function yo(t,o){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(o+"-","").replace(/-/g,"_")]}function Ja(t,o,u){var p={color:{source:zs,composite:Hl},number:{source:yl,composite:zs}},y=function(b){return{"line-pattern":{source:os,composite:os},"fill-pattern":{source:os,composite:os},"fill-extrusion-pattern":{source:os,composite:os}}[b]}(t);return y&&y[u]||p[o][u]}Xn.prototype.populatePaintArrays=function(t,o,u,p,y,b){for(var C in this.programConfigurations)this.programConfigurations[C].populatePaintArrays(t,o,p,y,b);o.id!==void 0&&this._featureMap.add(o.id,u,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0},Xn.prototype.updatePaintArrays=function(t,o,u,p){for(var y=0,b=u;y<b.length;y+=1){var C=b[y];this.needsUpload=this.programConfigurations[C.id].updatePaintArrays(t,this._featureMap,o,C,p)||this.needsUpload}},Xn.prototype.get=function(t){return this.programConfigurations[t]},Xn.prototype.upload=function(t){if(this.needsUpload){for(var o in this.programConfigurations)this.programConfigurations[o].upload(t);this.needsUpload=!1}},Xn.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},vn("ConstantBinder",ii),vn("CrossFadedConstantBinder",li),vn("SourceExpressionBinder",$n),vn("CrossFadedCompositeBinder",di),vn("CompositeExpressionBinder",Hn),vn("ProgramConfiguration",Kn,{omit:["_buffers"]}),vn("ProgramConfigurationSet",Xn);var To=Math.pow(2,14)-1,ra=-To-1;function Ha(t){for(var o=8192/t.extent,u=t.loadGeometry(),p=0;p<u.length;p++)for(var y=u[p],b=0;b<y.length;b++){var C=y[b],O=Math.round(C.x*o),D=Math.round(C.y*o);C.x=Nt(O,ra,To),C.y=Nt(D,ra,To),(O<C.x||O>C.x+1||D<C.y||D>C.y+1)&&$e("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return u}function ho(t,o){return{type:t.type,id:t.id,properties:t.properties,geometry:o?Ha(t):[]}}function Rs(t,o,u,p,y){t.emplaceBack(2*o+(p+1)/2,2*u+(y+1)/2)}var ss=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new dc,this.indexArray=new ml,this.segments=new ue,this.programConfigurations=new Xn(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};function Bu(t,o){for(var u=0;u<t.length;u++)if(iu(o,t[u]))return!0;for(var p=0;p<o.length;p++)if(iu(t,o[p]))return!0;return!!ls(t,o)}function us(t,o,u){return!!iu(t,o)||!!Nu(o,t,u)}function nu(t,o){if(t.length===1)return Xl(o,t[0]);for(var u=0;u<o.length;u++)for(var p=o[u],y=0;y<p.length;y++)if(iu(t,p[y]))return!0;for(var b=0;b<t.length;b++)if(Xl(o,t[b]))return!0;for(var C=0;C<o.length;C++)if(ls(t,o[C]))return!0;return!1}function Jo(t,o,u){if(t.length>1){if(ls(t,o))return!0;for(var p=0;p<o.length;p++)if(Nu(o[p],t,u))return!0}for(var y=0;y<t.length;y++)if(Nu(t[y],o,u))return!0;return!1}function ls(t,o){if(t.length===0||o.length===0)return!1;for(var u=0;u<t.length-1;u++)for(var p=t[u],y=t[u+1],b=0;b<o.length-1;b++)if(Wl(p,y,o[b],o[b+1]))return!0;return!1}function Wl(t,o,u,p){return Ht(t,u,p)!==Ht(o,u,p)&&Ht(t,o,u)!==Ht(t,o,p)}function Nu(t,o,u){var p=u*u;if(o.length===1)return t.distSqr(o[0])<p;for(var y=1;y<o.length;y++)if(_l(t,o[y-1],o[y])<p)return!0;return!1}function _l(t,o,u){var p=o.distSqr(u);if(p===0)return t.distSqr(o);var y=((t.x-o.x)*(u.x-o.x)+(t.y-o.y)*(u.y-o.y))/p;return t.distSqr(y<0?o:y>1?u:u.sub(o)._mult(y)._add(o))}function Xl(t,o){for(var u,p,y,b=!1,C=0;C<t.length;C++)for(var O=0,D=(u=t[C]).length-1;O<u.length;D=O++)(p=u[O]).y>o.y!=(y=u[D]).y>o.y&&o.x<(y.x-p.x)*(o.y-p.y)/(y.y-p.y)+p.x&&(b=!b);return b}function iu(t,o){for(var u=!1,p=0,y=t.length-1;p<t.length;y=p++){var b=t[p],C=t[y];b.y>o.y!=C.y>o.y&&o.x<(C.x-b.x)*(o.y-b.y)/(C.y-b.y)+b.x&&(u=!u)}return u}function xl(t,o,u){var p=u[0],y=u[2];if(t.x<p.x&&o.x<p.x||t.x>y.x&&o.x>y.x||t.y<p.y&&o.y<p.y||t.y>y.y&&o.y>y.y)return!1;var b=Ht(t,o,u[0]);return b!==Ht(t,o,u[1])||b!==Ht(t,o,u[2])||b!==Ht(t,o,u[3])}function Su(t,o,u){var p=o.paint.get(t).value;return p.kind==="constant"?p.value:u.programConfigurations.get(o.id).getMaxValue(t)}function Eo(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function zu(t,o,u,p,y){if(!o[0]&&!o[1])return t;var b=de.convert(o)._mult(y);u==="viewport"&&b._rotate(-p);for(var C=[],O=0;O<t.length;O++)C.push(t[O].sub(b));return C}ss.prototype.populate=function(t,o,u){var p=this.layers[0],y=[],b=null;p.type==="circle"&&(b=p.layout.get("circle-sort-key"));for(var C=0,O=t;C<O.length;C+=1){var D=O[C],z=D.feature,Z=D.id,G=D.index,q=D.sourceLayerIndex,ie=this.layers[0]._featureFilter.needGeometry,Te=ho(z,ie);if(this.layers[0]._featureFilter.filter(new Ai(this.zoom),Te,u)){var Oe=b?b.evaluate(Te,{},u):void 0,k={id:Z,properties:z.properties,type:z.type,sourceLayerIndex:q,index:G,geometry:ie?Te.geometry:Ha(z),patterns:{},sortKey:Oe};y.push(k)}}b&&y.sort(function(Dr,Dn){return Dr.sortKey-Dn.sortKey});for(var Ue=0,rt=y;Ue<rt.length;Ue+=1){var bt=rt[Ue],Ut=bt.geometry,Gt=bt.index,ir=bt.sourceLayerIndex,Mr=t[Gt].feature;this.addFeature(bt,Ut,Gt,u),o.featureIndex.insert(Mr,Ut,Gt,ir,this.index)}},ss.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},ss.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ss.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ss.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,oe),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},ss.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ss.prototype.addFeature=function(t,o,u,p){for(var y=0,b=o;y<b.length;y+=1)for(var C=0,O=b[y];C<O.length;C+=1){var D=O[C],z=D.x,Z=D.y;if(!(z<0||z>=8192||Z<0||Z>=8192)){var G=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),q=G.vertexLength;Rs(this.layoutVertexArray,z,Z,-1,-1),Rs(this.layoutVertexArray,z,Z,1,-1),Rs(this.layoutVertexArray,z,Z,1,1),Rs(this.layoutVertexArray,z,Z,-1,1),this.indexArray.emplaceBack(q,q+1,q+2),this.indexArray.emplaceBack(q,q+3,q+2),G.vertexLength+=4,G.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,{},p)},vn("CircleBucket",ss,{omit:["layers"]});var Uu=new Ho({"circle-sort-key":new Cn(se.layout_circle["circle-sort-key"])}),tl={paint:new Ho({"circle-radius":new Cn(se.paint_circle["circle-radius"]),"circle-color":new Cn(se.paint_circle["circle-color"]),"circle-blur":new Cn(se.paint_circle["circle-blur"]),"circle-opacity":new Cn(se.paint_circle["circle-opacity"]),"circle-translate":new In(se.paint_circle["circle-translate"]),"circle-translate-anchor":new In(se.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new In(se.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new In(se.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Cn(se.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Cn(se.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Cn(se.paint_circle["circle-stroke-opacity"])}),layout:Uu},ca=typeof Float32Array!="undefined"?Float32Array:Array;function Us(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function es(t,o,u){var p=o[0],y=o[1],b=o[2],C=o[3],O=o[4],D=o[5],z=o[6],Z=o[7],G=o[8],q=o[9],ie=o[10],Te=o[11],Oe=o[12],k=o[13],Ue=o[14],rt=o[15],bt=u[0],Ut=u[1],Gt=u[2],ir=u[3];return t[0]=bt*p+Ut*O+Gt*G+ir*Oe,t[1]=bt*y+Ut*D+Gt*q+ir*k,t[2]=bt*b+Ut*z+Gt*ie+ir*Ue,t[3]=bt*C+Ut*Z+Gt*Te+ir*rt,t[4]=(bt=u[4])*p+(Ut=u[5])*O+(Gt=u[6])*G+(ir=u[7])*Oe,t[5]=bt*y+Ut*D+Gt*q+ir*k,t[6]=bt*b+Ut*z+Gt*ie+ir*Ue,t[7]=bt*C+Ut*Z+Gt*Te+ir*rt,t[8]=(bt=u[8])*p+(Ut=u[9])*O+(Gt=u[10])*G+(ir=u[11])*Oe,t[9]=bt*y+Ut*D+Gt*q+ir*k,t[10]=bt*b+Ut*z+Gt*ie+ir*Ue,t[11]=bt*C+Ut*Z+Gt*Te+ir*rt,t[12]=(bt=u[12])*p+(Ut=u[13])*O+(Gt=u[14])*G+(ir=u[15])*Oe,t[13]=bt*y+Ut*D+Gt*q+ir*k,t[14]=bt*b+Ut*z+Gt*ie+ir*Ue,t[15]=bt*C+Ut*Z+Gt*Te+ir*rt,t}Math.hypot||(Math.hypot=function(){for(var t=arguments,o=0,u=arguments.length;u--;)o+=t[u]*t[u];return Math.sqrt(o)});var _u,qc=es;function Kc(t,o,u){var p=o[0],y=o[1],b=o[2],C=o[3];return t[0]=u[0]*p+u[4]*y+u[8]*b+u[12]*C,t[1]=u[1]*p+u[5]*y+u[9]*b+u[13]*C,t[2]=u[2]*p+u[6]*y+u[10]*b+u[14]*C,t[3]=u[3]*p+u[7]*y+u[11]*b+u[15]*C,t}_u=new ca(3),ca!=Float32Array&&(_u[0]=0,_u[1]=0,_u[2]=0),function(){var t=new ca(4);ca!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var Pf=(function(){var t=new ca(2);ca!=Float32Array&&(t[0]=0,t[1]=0)}(),function(t){function o(u){t.call(this,u,tl)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new ss(u)},o.prototype.queryRadius=function(u){var p=u;return Su("circle-radius",this,p)+Su("circle-stroke-width",this,p)+Eo(this.paint.get("circle-translate"))},o.prototype.queryIntersectsFeature=function(u,p,y,b,C,O,D,z){for(var Z=zu(u,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),O.angle,D),G=this.paint.get("circle-radius").evaluate(p,y)+this.paint.get("circle-stroke-width").evaluate(p,y),q=this.paint.get("circle-pitch-alignment")==="map",ie=q?Z:function(Mr,Dr){return Mr.map(function(Dn){return au(Dn,Dr)})}(Z,z),Te=q?G*D:G,Oe=0,k=b;Oe<k.length;Oe+=1)for(var Ue=0,rt=k[Oe];Ue<rt.length;Ue+=1){var bt=rt[Ue],Ut=q?bt:au(bt,z),Gt=Te,ir=Kc([],[bt.x,bt.y,0,1],z);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Gt*=ir[3]/O.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Gt*=O.cameraToCenterDistance/ir[3]),us(ie,Ut,Gt))return!0}return!1},o}(gu));function au(t,o){var u=Kc([],[t.x,t.y,0,1],o);return new de(u[0]/u[3],u[1]/u[3])}var mc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(ss);function ou(t,o,u,p){var y=o.width,b=o.height;if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==y*b*u)throw new RangeError("mismatched image size")}else p=new Uint8Array(y*b*u);return t.width=y,t.height=b,t.data=p,t}function bl(t,o,u){var p=o.width,y=o.height;if(p!==t.width||y!==t.height){var b=ou({},{width:p,height:y},u);gc(t,b,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,p),height:Math.min(t.height,y)},u),t.width=p,t.height=y,t.data=b.data}}function gc(t,o,u,p,y,b){if(y.width===0||y.height===0)return o;if(y.width>t.width||y.height>t.height||u.x>t.width-y.width||u.y>t.height-y.height)throw new RangeError("out of range source coordinates for image copy");if(y.width>o.width||y.height>o.height||p.x>o.width-y.width||p.y>o.height-y.height)throw new RangeError("out of range destination coordinates for image copy");for(var C=t.data,O=o.data,D=0;D<y.height;D++)for(var z=((u.y+D)*t.width+u.x)*b,Z=((p.y+D)*o.width+p.x)*b,G=0;G<y.width*b;G++)O[Z+G]=C[z+G];return o}vn("HeatmapBucket",mc,{omit:["layers"]});var su=function(t,o){ou(this,t,1,o)};su.prototype.resize=function(t){bl(this,t,1)},su.prototype.clone=function(){return new su({width:this.width,height:this.height},new Uint8Array(this.data))},su.copy=function(t,o,u,p,y){gc(t,o,u,p,y,1)};var Bo=function(t,o){ou(this,t,4,o)};Bo.prototype.resize=function(t){bl(this,t,4)},Bo.prototype.replace=function(t,o){o?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t},Bo.prototype.clone=function(){return new Bo({width:this.width,height:this.height},new Uint8Array(this.data))},Bo.copy=function(t,o,u,p,y){gc(t,o,u,p,y,4)},vn("AlphaImage",su),vn("RGBAImage",Bo);var $c={paint:new Ho({"heatmap-radius":new Cn(se.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Cn(se.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new In(se.paint_heatmap["heatmap-intensity"]),"heatmap-color":new eu(se.paint_heatmap["heatmap-color"]),"heatmap-opacity":new In(se.paint_heatmap["heatmap-opacity"])})};function Jf(t){var o={},u=t.resolution||256,p=t.clips?t.clips.length:1,y=t.image||new Bo({width:u,height:p}),b=function(Te,Oe,k){o[t.evaluationKey]=k;var Ue=t.expression.evaluate(o);y.data[Te+Oe+0]=Math.floor(255*Ue.r/Ue.a),y.data[Te+Oe+1]=Math.floor(255*Ue.g/Ue.a),y.data[Te+Oe+2]=Math.floor(255*Ue.b/Ue.a),y.data[Te+Oe+3]=Math.floor(255*Ue.a)};if(t.clips)for(var C=0,O=0;C<p;++C,O+=4*u)for(var D=0,z=0;D<u;D++,z+=4){var Z=D/(u-1),G=t.clips[C];b(O,z,G.start*(1-Z)+G.end*Z)}else for(var q=0,ie=0;q<u;q++,ie+=4)b(0,ie,q/(u-1));return y}var kh=function(t){function o(u){t.call(this,u,$c),this._updateColorRamp()}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new mc(u)},o.prototype._handleSpecialPaintPropertyUpdate=function(u){u==="heatmap-color"&&this._updateColorRamp()},o.prototype._updateColorRamp=function(){this.colorRamp=Jf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},o.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},o.prototype.queryRadius=function(){return 0},o.prototype.queryIntersectsFeature=function(){return!1},o.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},o}(gu),eh={paint:new Ho({"hillshade-illumination-direction":new In(se.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new In(se.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new In(se.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new In(se.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new In(se.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new In(se.paint_hillshade["hillshade-accent-color"])})},pp=function(t){function o(u){t.call(this,u,eh)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},o}(gu),yc=La([{name:"a_pos",components:2,type:"Int16"}],4).members,_c=Lh,Of=Lh;function Lh(t,o,u){u=u||2;var p,y,b,C,O,D,z,Z=o&&o.length,G=Z?o[0]*u:t.length,q=qp(t,0,G,u,!0),ie=[];if(!q||q.next===q.prev)return ie;if(Z&&(q=function(Oe,k,Ue,rt){var bt,Ut,Gt,ir=[];for(bt=0,Ut=k.length;bt<Ut;bt++)(Gt=qp(Oe,k[bt]*rt,bt<Ut-1?k[bt+1]*rt:Oe.length,rt,!1))===Gt.next&&(Gt.steiner=!0),ir.push(Fh(Gt));for(ir.sort(Od),bt=0;bt<ir.length;bt++)Id(ir[bt],Ue),Ue=El(Ue,Ue.next);return Ue}(t,o,q,u)),t.length>80*u){p=b=t[0],y=C=t[1];for(var Te=u;Te<G;Te+=u)(O=t[Te])<p&&(p=O),(D=t[Te+1])<y&&(y=D),O>b&&(b=O),D>C&&(C=D);z=(z=Math.max(b-p,C-y))!==0?1/z:0}return Qc(q,ie,u,p,y,z),ie}function qp(t,o,u,p,y){var b,C;if(y===ah(t,o,u,p)>0)for(b=o;b<u;b+=p)C=ih(b,t[b],t[b+1],C);else for(b=u-p;b>=o;b-=p)C=ih(b,t[b],t[b+1],C);return C&&yt(C,C.next)&&(Yl(C),C=C.next),C}function El(t,o){if(!t)return t;o||(o=t);var u,p=t;do if(u=!1,p.steiner||!yt(p,p.next)&&Mo(p.prev,p,p.next)!==0)p=p.next;else{if(Yl(p),(p=o=p.prev)===p.next)break;u=!0}while(u||p!==o);return o}function Qc(t,o,u,p,y,b,C){if(t){!C&&b&&function(Z,G,q,ie){var Te=Z;do Te.z===null&&(Te.z=dp(Te.x,Te.y,G,q,ie)),Te.prevZ=Te.prev,Te.nextZ=Te.next,Te=Te.next;while(Te!==Z);Te.prevZ.nextZ=null,Te.prevZ=null,function(Oe){var k,Ue,rt,bt,Ut,Gt,ir,Mr,Dr=1;do{for(Ue=Oe,Oe=null,Ut=null,Gt=0;Ue;){for(Gt++,rt=Ue,ir=0,k=0;k<Dr&&(ir++,rt=rt.nextZ);k++);for(Mr=Dr;ir>0||Mr>0&&rt;)ir!==0&&(Mr===0||!rt||Ue.z<=rt.z)?(bt=Ue,Ue=Ue.nextZ,ir--):(bt=rt,rt=rt.nextZ,Mr--),Ut?Ut.nextZ=bt:Oe=bt,bt.prevZ=Ut,Ut=bt;Ue=rt}Ut.nextZ=null,Dr*=2}while(Gt>1)}(Te)}(t,p,y,b);for(var O,D,z=t;t.prev!==t.next;)if(O=t.prev,D=t.next,b?Pd(t,p,y,b):Kp(t))o.push(O.i/u),o.push(t.i/u),o.push(D.i/u),Yl(t),t=D.next,z=D.next;else if((t=D)===z){C?C===1?Qc(t=Jc(El(t),o,u),o,u,p,y,b,2):C===2&&Dh(t,o,u,p,y,b):Qc(El(t),o,u,p,y,b,1);break}}}function Kp(t){var o=t.prev,u=t,p=t.next;if(Mo(o,u,p)>=0)return!1;for(var y=t.next.next;y!==t.prev;){if(th(o.x,o.y,u.x,u.y,p.x,p.y,y.x,y.y)&&Mo(y.prev,y,y.next)>=0)return!1;y=y.next}return!0}function Pd(t,o,u,p){var y=t.prev,b=t,C=t.next;if(Mo(y,b,C)>=0)return!1;for(var O=y.x>b.x?y.x>C.x?y.x:C.x:b.x>C.x?b.x:C.x,D=y.y>b.y?y.y>C.y?y.y:C.y:b.y>C.y?b.y:C.y,z=dp(y.x<b.x?y.x<C.x?y.x:C.x:b.x<C.x?b.x:C.x,y.y<b.y?y.y<C.y?y.y:C.y:b.y<C.y?b.y:C.y,o,u,p),Z=dp(O,D,o,u,p),G=t.prevZ,q=t.nextZ;G&&G.z>=z&&q&&q.z<=Z;){if(G!==t.prev&&G!==t.next&&th(y.x,y.y,b.x,b.y,C.x,C.y,G.x,G.y)&&Mo(G.prev,G,G.next)>=0||(G=G.prevZ,q!==t.prev&&q!==t.next&&th(y.x,y.y,b.x,b.y,C.x,C.y,q.x,q.y)&&Mo(q.prev,q,q.next)>=0))return!1;q=q.nextZ}for(;G&&G.z>=z;){if(G!==t.prev&&G!==t.next&&th(y.x,y.y,b.x,b.y,C.x,C.y,G.x,G.y)&&Mo(G.prev,G,G.next)>=0)return!1;G=G.prevZ}for(;q&&q.z<=Z;){if(q!==t.prev&&q!==t.next&&th(y.x,y.y,b.x,b.y,C.x,C.y,q.x,q.y)&&Mo(q.prev,q,q.next)>=0)return!1;q=q.nextZ}return!0}function Jc(t,o,u){var p=t;do{var y=p.prev,b=p.next.next;!yt(y,b)&&Qp(y,p,p.next,b)&&If(y,b)&&If(b,y)&&(o.push(y.i/u),o.push(p.i/u),o.push(b.i/u),Yl(p),Yl(p.next),p=t=b),p=p.next}while(p!==t);return El(p)}function Dh(t,o,u,p,y,b){var C=t;do{for(var O=C.next.next;O!==C.prev;){if(C.i!==O.i&&Xr(C,O)){var D=nh(C,O);return C=El(C,C.next),D=El(D,D.next),Qc(C,o,u,p,y,b),void Qc(D,o,u,p,y,b)}O=O.next}C=C.next}while(C!==t)}function Od(t,o){return t.x-o.x}function Id(t,o){if(o=function(p,y){var b,C=y,O=p.x,D=p.y,z=-1/0;do{if(D<=C.y&&D>=C.next.y&&C.next.y!==C.y){var Z=C.x+(D-C.y)*(C.next.x-C.x)/(C.next.y-C.y);if(Z<=O&&Z>z){if(z=Z,Z===O){if(D===C.y)return C;if(D===C.next.y)return C.next}b=C.x<C.next.x?C:C.next}}C=C.next}while(C!==y);if(!b)return null;if(O===z)return b;var G,q=b,ie=b.x,Te=b.y,Oe=1/0;C=b;do O>=C.x&&C.x>=ie&&O!==C.x&&th(D<Te?O:z,D,ie,Te,D<Te?z:O,D,C.x,C.y)&&(G=Math.abs(D-C.y)/(O-C.x),If(C,p)&&(G<Oe||G===Oe&&(C.x>b.x||C.x===b.x&&$p(b,C)))&&(b=C,Oe=G)),C=C.next;while(C!==q);return b}(t,o)){var u=nh(o,t);El(o,o.next),El(u,u.next)}}function $p(t,o){return Mo(t.prev,t,o.prev)<0&&Mo(o.next,t,t.next)<0}function dp(t,o,u,p,y){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-u)*y)|t<<8))|t<<4))|t<<2))|t<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-p)*y)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function Fh(t){var o=t,u=t;do(o.x<u.x||o.x===u.x&&o.y<u.y)&&(u=o),o=o.next;while(o!==t);return u}function th(t,o,u,p,y,b,C,O){return(y-C)*(o-O)-(t-C)*(b-O)>=0&&(t-C)*(p-O)-(u-C)*(o-O)>=0&&(u-C)*(b-O)-(y-C)*(p-O)>=0}function Xr(t,o){return t.next.i!==o.i&&t.prev.i!==o.i&&!function(u,p){var y=u;do{if(y.i!==u.i&&y.next.i!==u.i&&y.i!==p.i&&y.next.i!==p.i&&Qp(y,y.next,u,p))return!0;y=y.next}while(y!==u);return!1}(t,o)&&(If(t,o)&&If(o,t)&&function(u,p){var y=u,b=!1,C=(u.x+p.x)/2,O=(u.y+p.y)/2;do y.y>O!=y.next.y>O&&y.next.y!==y.y&&C<(y.next.x-y.x)*(O-y.y)/(y.next.y-y.y)+y.x&&(b=!b),y=y.next;while(y!==u);return b}(t,o)&&(Mo(t.prev,t,o.prev)||Mo(t,o.prev,o))||yt(t,o)&&Mo(t.prev,t,t.next)>0&&Mo(o.prev,o,o.next)>0)}function Mo(t,o,u){return(o.y-t.y)*(u.x-o.x)-(o.x-t.x)*(u.y-o.y)}function yt(t,o){return t.x===o.x&&t.y===o.y}function Qp(t,o,u,p){var y=rh(Mo(t,o,u)),b=rh(Mo(t,o,p)),C=rh(Mo(u,p,t)),O=rh(Mo(u,p,o));return y!==b&&C!==O||!(y!==0||!Bh(t,u,o))||!(b!==0||!Bh(t,p,o))||!(C!==0||!Bh(u,t,p))||!(O!==0||!Bh(u,o,p))}function Bh(t,o,u){return o.x<=Math.max(t.x,u.x)&&o.x>=Math.min(t.x,u.x)&&o.y<=Math.max(t.y,u.y)&&o.y>=Math.min(t.y,u.y)}function rh(t){return t>0?1:t<0?-1:0}function If(t,o){return Mo(t.prev,t,t.next)<0?Mo(t,o,t.next)>=0&&Mo(t,t.prev,o)>=0:Mo(t,o,t.prev)<0||Mo(t,t.next,o)<0}function nh(t,o){var u=new Sl(t.i,t.x,t.y),p=new Sl(o.i,o.x,o.y),y=t.next,b=o.prev;return t.next=o,o.prev=t,u.next=y,y.prev=u,p.next=u,u.prev=p,b.next=p,p.prev=b,p}function ih(t,o,u,p){var y=new Sl(t,o,u);return p?(y.next=p.next,y.prev=p,p.next.prev=y,p.next=y):(y.prev=y,y.next=y),y}function Yl(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Sl(t,o,u){this.i=t,this.x=o,this.y=u,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ah(t,o,u,p){for(var y=0,b=o,C=u-p;b<u;b+=p)y+=(t[C]-t[b])*(t[b+1]+t[C+1]),C=b;return y}function Nh(t,o,u,p,y){(function b(C,O,D,z,Z){for(;z>D;){if(z-D>600){var G=z-D+1,q=O-D+1,ie=Math.log(G),Te=.5*Math.exp(2*ie/3),Oe=.5*Math.sqrt(ie*Te*(G-Te)/G)*(q-G/2<0?-1:1);b(C,O,Math.max(D,Math.floor(O-q*Te/G+Oe)),Math.min(z,Math.floor(O+(G-q)*Te/G+Oe)),Z)}var k=C[O],Ue=D,rt=z;for(ql(C,D,O),Z(C[z],k)>0&&ql(C,D,z);Ue<rt;){for(ql(C,Ue,rt),Ue++,rt--;Z(C[Ue],k)<0;)Ue++;for(;Z(C[rt],k)>0;)rt--}Z(C[D],k)===0?ql(C,D,rt):ql(C,++rt,z),rt<=O&&(D=rt+1),O<=rt&&(z=rt-1)}})(t,o,u||0,p||t.length-1,y||oh)}function ql(t,o,u){var p=t[o];t[o]=t[u],t[u]=p}function oh(t,o){return t<o?-1:t>o?1:0}function Rf(t,o){var u=t.length;if(u<=1)return[t];for(var p,y,b=[],C=0;C<u;C++){var O=mr(t[C]);O!==0&&(t[C].area=Math.abs(O),y===void 0&&(y=O<0),y===O<0?(p&&b.push(p),p=[t[C]]):p.push(t[C]))}if(p&&b.push(p),o>1)for(var D=0;D<b.length;D++)b[D].length<=o||(Nh(b[D],o,1,b[D].length-1,sh),b[D]=b[D].slice(0,o));return b}function sh(t,o){return o.area-t.area}function ef(t,o,u){for(var p=u.patternDependencies,y=!1,b=0,C=o;b<C.length;b+=1){var O=C[b].paint.get(t+"-pattern");O.isConstant()||(y=!0);var D=O.constantOr(null);D&&(y=!0,p[D.to]=!0,p[D.from]=!0)}return y}function kf(t,o,u,p,y){for(var b=y.patternDependencies,C=0,O=o;C<O.length;C+=1){var D=O[C],z=D.paint.get(t+"-pattern").value;if(z.kind!=="constant"){var Z=z.evaluate({zoom:p-1},u,{},y.availableImages),G=z.evaluate({zoom:p},u,{},y.availableImages),q=z.evaluate({zoom:p+1},u,{},y.availableImages);G=G&&G.name?G.name:G,q=q&&q.name?q.name:q,b[Z=Z&&Z.name?Z.name:Z]=!0,b[G]=!0,b[q]=!0,u.patterns[D.id]={min:Z,mid:G,max:q}}}return u}Lh.deviation=function(t,o,u,p){var y=o&&o.length,b=Math.abs(ah(t,0,y?o[0]*u:t.length,u));if(y)for(var C=0,O=o.length;C<O;C++)b-=Math.abs(ah(t,o[C]*u,C<O-1?o[C+1]*u:t.length,u));var D=0;for(C=0;C<p.length;C+=3){var z=p[C]*u,Z=p[C+1]*u,G=p[C+2]*u;D+=Math.abs((t[z]-t[G])*(t[Z+1]-t[z+1])-(t[z]-t[Z])*(t[G+1]-t[z+1]))}return b===0&&D===0?0:Math.abs((D-b)/b)},Lh.flatten=function(t){for(var o=t[0][0].length,u={vertices:[],holes:[],dimensions:o},p=0,y=0;y<t.length;y++){for(var b=0;b<t[y].length;b++)for(var C=0;C<o;C++)u.vertices.push(t[y][b][C]);y>0&&u.holes.push(p+=t[y-1].length)}return u},_c.default=Of;var Zs=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new dc,this.indexArray=new ml,this.indexArray2=new Gl,this.programConfigurations=new Xn(t.layers,t.zoom),this.segments=new ue,this.segments2=new ue,this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};Zs.prototype.populate=function(t,o,u){this.hasPattern=ef("fill",this.layers,o);for(var p=this.layers[0].layout.get("fill-sort-key"),y=[],b=0,C=t;b<C.length;b+=1){var O=C[b],D=O.feature,z=O.id,Z=O.index,G=O.sourceLayerIndex,q=this.layers[0]._featureFilter.needGeometry,ie=ho(D,q);if(this.layers[0]._featureFilter.filter(new Ai(this.zoom),ie,u)){var Te=p?p.evaluate(ie,{},u,o.availableImages):void 0,Oe={id:z,properties:D.properties,type:D.type,sourceLayerIndex:G,index:Z,geometry:q?ie.geometry:Ha(D),patterns:{},sortKey:Te};y.push(Oe)}}p&&y.sort(function(Mr,Dr){return Mr.sortKey-Dr.sortKey});for(var k=0,Ue=y;k<Ue.length;k+=1){var rt=Ue[k],bt=rt.geometry,Ut=rt.index,Gt=rt.sourceLayerIndex;if(this.hasPattern){var ir=kf("fill",this.layers,rt,this.zoom,o);this.patternFeatures.push(ir)}else this.addFeature(rt,bt,Ut,u,{});o.featureIndex.insert(t[Ut].feature,bt,Ut,Gt,this.index)}},Zs.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},Zs.prototype.addFeatures=function(t,o,u){for(var p=0,y=this.patternFeatures;p<y.length;p+=1){var b=y[p];this.addFeature(b,b.geometry,b.index,o,u)}},Zs.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Zs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Zs.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,yc),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},Zs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Zs.prototype.addFeature=function(t,o,u,p,y){for(var b=0,C=Rf(o,500);b<C.length;b+=1){for(var O=C[b],D=0,z=0,Z=O;z<Z.length;z+=1)D+=Z[z].length;for(var G=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray),q=G.vertexLength,ie=[],Te=[],Oe=0,k=O;Oe<k.length;Oe+=1){var Ue=k[Oe];if(Ue.length!==0){Ue!==O[0]&&Te.push(ie.length/2);var rt=this.segments2.prepareSegment(Ue.length,this.layoutVertexArray,this.indexArray2),bt=rt.vertexLength;this.layoutVertexArray.emplaceBack(Ue[0].x,Ue[0].y),this.indexArray2.emplaceBack(bt+Ue.length-1,bt),ie.push(Ue[0].x),ie.push(Ue[0].y);for(var Ut=1;Ut<Ue.length;Ut++)this.layoutVertexArray.emplaceBack(Ue[Ut].x,Ue[Ut].y),this.indexArray2.emplaceBack(bt+Ut-1,bt+Ut),ie.push(Ue[Ut].x),ie.push(Ue[Ut].y);rt.vertexLength+=Ue.length,rt.primitiveLength+=Ue.length}}for(var Gt=_c(ie,Te),ir=0;ir<Gt.length;ir+=3)this.indexArray.emplaceBack(q+Gt[ir],q+Gt[ir+1],q+Gt[ir+2]);G.vertexLength+=D,G.primitiveLength+=Gt.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,p)},vn("FillBucket",Zs,{omit:["layers","patternFeatures"]});var Lf=new Ho({"fill-sort-key":new Cn(se.layout_fill["fill-sort-key"])}),tf={paint:new Ho({"fill-antialias":new In(se.paint_fill["fill-antialias"]),"fill-opacity":new Cn(se.paint_fill["fill-opacity"]),"fill-color":new Cn(se.paint_fill["fill-color"]),"fill-outline-color":new Cn(se.paint_fill["fill-outline-color"]),"fill-translate":new In(se.paint_fill["fill-translate"]),"fill-translate-anchor":new In(se.paint_fill["fill-translate-anchor"]),"fill-pattern":new Hc(se.paint_fill["fill-pattern"])}),layout:Lf},uh=function(t){function o(u){t.call(this,u,tf)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.recalculate=function(u,p){t.prototype.recalculate.call(this,u,p);var y=this.paint._values["fill-outline-color"];y.value.kind==="constant"&&y.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},o.prototype.createBucket=function(u){return new Zs(u)},o.prototype.queryRadius=function(){return Eo(this.paint.get("fill-translate"))},o.prototype.queryIntersectsFeature=function(u,p,y,b,C,O,D){return nu(zu(u,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),O.angle,D),b)},o.prototype.isTileClipped=function(){return!0},o}(gu),lh=La([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,zh=Cl;function Cl(t,o,u,p,y){this.properties={},this.extent=u,this.type=0,this._pbf=t,this._geometry=-1,this._keys=p,this._values=y,t.readFields(rf,this,o)}function rf(t,o,u){t==1?o.id=u.readVarint():t==2?function(p,y){for(var b=p.readVarint()+p.pos;p.pos<b;){var C=y._keys[p.readVarint()],O=y._values[p.readVarint()];y.properties[C]=O}}(u,o):t==3?o.type=u.readVarint():t==4&&(o._geometry=u.pos)}function Jp(t){for(var o,u,p=0,y=0,b=t.length,C=b-1;y<b;C=y++)p+=((u=t[C]).x-(o=t[y]).x)*(o.y+u.y);return p}Cl.types=["Unknown","Point","LineString","Polygon"],Cl.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var o,u=t.readVarint()+t.pos,p=1,y=0,b=0,C=0,O=[];t.pos<u;){if(y<=0){var D=t.readVarint();p=7&D,y=D>>3}if(y--,p===1||p===2)b+=t.readSVarint(),C+=t.readSVarint(),p===1&&(o&&O.push(o),o=[]),o.push(new de(b,C));else{if(p!==7)throw new Error("unknown command "+p);o&&o.push(o[0].clone())}}return o&&O.push(o),O},Cl.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var o=t.readVarint()+t.pos,u=1,p=0,y=0,b=0,C=1/0,O=-1/0,D=1/0,z=-1/0;t.pos<o;){if(p<=0){var Z=t.readVarint();u=7&Z,p=Z>>3}if(p--,u===1||u===2)(y+=t.readSVarint())<C&&(C=y),y>O&&(O=y),(b+=t.readSVarint())<D&&(D=b),b>z&&(z=b);else if(u!==7)throw new Error("unknown command "+u)}return[C,D,O,z]},Cl.prototype.toGeoJSON=function(t,o,u){var p,y,b=this.extent*Math.pow(2,u),C=this.extent*t,O=this.extent*o,D=this.loadGeometry(),z=Cl.types[this.type];function Z(ie){for(var Te=0;Te<ie.length;Te++){var Oe=ie[Te];ie[Te]=[360*(Oe.x+C)/b-180,360/Math.PI*Math.atan(Math.exp((180-360*(Oe.y+O)/b)*Math.PI/180))-90]}}switch(this.type){case 1:var G=[];for(p=0;p<D.length;p++)G[p]=D[p][0];Z(D=G);break;case 2:for(p=0;p<D.length;p++)Z(D[p]);break;case 3:for(D=function(ie){var Te=ie.length;if(Te<=1)return[ie];for(var Oe,k,Ue=[],rt=0;rt<Te;rt++){var bt=Jp(ie[rt]);bt!==0&&(k===void 0&&(k=bt<0),k===bt<0?(Oe&&Ue.push(Oe),Oe=[ie[rt]]):Oe.push(ie[rt]))}return Oe&&Ue.push(Oe),Ue}(D),p=0;p<D.length;p++)for(y=0;y<D[p].length;y++)Z(D[p][y])}D.length===1?D=D[0]:z="Multi"+z;var q={type:"Feature",geometry:{type:z,coordinates:D},properties:this.properties};return"id"in this&&(q.id=this.id),q};var Uh=vp;function vp(t,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Rd,this,o),this.length=this._features.length}function Rd(t,o,u){t===15?o.version=u.readVarint():t===1?o.name=u.readString():t===5?o.extent=u.readVarint():t===2?o._features.push(u.pos):t===3?o._keys.push(u.readString()):t===4&&o._values.push(function(p){for(var y=null,b=p.readVarint()+p.pos;p.pos<b;){var C=p.readVarint()>>3;y=C===1?p.readString():C===2?p.readFloat():C===3?p.readDouble():C===4?p.readVarint64():C===5?p.readVarint():C===6?p.readSVarint():C===7?p.readBoolean():null}return y}(u))}function ed(t,o,u){if(t===3){var p=new Uh(u,u.readVarint()+u.pos);p.length&&(o[p.name]=p)}}vp.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var o=this._pbf.readVarint()+this._pbf.pos;return new zh(this._pbf,o,this.extent,this._keys,this._values)};var Cu={VectorTile:function(t,o){this.layers=t.readFields(ed,{},o)},VectorTileFeature:zh,VectorTileLayer:Uh},kd=Cu.VectorTileFeature.types,Zh=Math.pow(2,13);function nf(t,o,u,p,y,b,C,O){t.emplaceBack(o,u,2*Math.floor(p*Zh)+C,y*Zh*2,b*Zh*2,Math.round(O))}var Zu=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new yu,this.indexArray=new ml,this.programConfigurations=new Xn(t.layers,t.zoom),this.segments=new ue,this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};function td(t,o){return t.x===o.x&&(t.x<0||t.x>8192)||t.y===o.y&&(t.y<0||t.y>8192)}Zu.prototype.populate=function(t,o,u){this.features=[],this.hasPattern=ef("fill-extrusion",this.layers,o);for(var p=0,y=t;p<y.length;p+=1){var b=y[p],C=b.feature,O=b.id,D=b.index,z=b.sourceLayerIndex,Z=this.layers[0]._featureFilter.needGeometry,G=ho(C,Z);if(this.layers[0]._featureFilter.filter(new Ai(this.zoom),G,u)){var q={id:O,sourceLayerIndex:z,index:D,geometry:Z?G.geometry:Ha(C),properties:C.properties,type:C.type,patterns:{}};this.hasPattern?this.features.push(kf("fill-extrusion",this.layers,q,this.zoom,o)):this.addFeature(q,q.geometry,D,u,{}),o.featureIndex.insert(C,q.geometry,D,z,this.index,!0)}}},Zu.prototype.addFeatures=function(t,o,u){for(var p=0,y=this.features;p<y.length;p+=1){var b=y[p];this.addFeature(b,b.geometry,b.index,o,u)}},Zu.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},Zu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Zu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Zu.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,lh),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Zu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Zu.prototype.addFeature=function(t,o,u,p,y){for(var b=0,C=Rf(o,500);b<C.length;b+=1){for(var O=C[b],D=0,z=0,Z=O;z<Z.length;z+=1)D+=Z[z].length;for(var G=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),q=0,ie=O;q<ie.length;q+=1){var Te=ie[q];if(Te.length!==0&&!((ji=Te).every(function(Si){return Si.x<0})||ji.every(function(Si){return Si.x>8192})||ji.every(function(Si){return Si.y<0})||ji.every(function(Si){return Si.y>8192})))for(var Oe=0,k=0;k<Te.length;k++){var Ue=Te[k];if(k>=1){var rt=Te[k-1];if(!td(Ue,rt)){G.vertexLength+4>ue.MAX_VERTEX_ARRAY_LENGTH&&(G=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var bt=Ue.sub(rt)._perp()._unit(),Ut=rt.dist(Ue);Oe+Ut>32768&&(Oe=0),nf(this.layoutVertexArray,Ue.x,Ue.y,bt.x,bt.y,0,0,Oe),nf(this.layoutVertexArray,Ue.x,Ue.y,bt.x,bt.y,0,1,Oe),nf(this.layoutVertexArray,rt.x,rt.y,bt.x,bt.y,0,0,Oe+=Ut),nf(this.layoutVertexArray,rt.x,rt.y,bt.x,bt.y,0,1,Oe);var Gt=G.vertexLength;this.indexArray.emplaceBack(Gt,Gt+2,Gt+1),this.indexArray.emplaceBack(Gt+1,Gt+2,Gt+3),G.vertexLength+=4,G.primitiveLength+=2}}}}if(G.vertexLength+D>ue.MAX_VERTEX_ARRAY_LENGTH&&(G=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray)),kd[t.type]==="Polygon"){for(var ir=[],Mr=[],Dr=G.vertexLength,Dn=0,cn=O;Dn<cn.length;Dn+=1){var Vn=cn[Dn];if(Vn.length!==0){Vn!==O[0]&&Mr.push(ir.length/2);for(var hn=0;hn<Vn.length;hn++){var Pi=Vn[hn];nf(this.layoutVertexArray,Pi.x,Pi.y,0,0,1,1,0),ir.push(Pi.x),ir.push(Pi.y)}}}for(var ei=_c(ir,Mr),wn=0;wn<ei.length;wn+=3)this.indexArray.emplaceBack(Dr+ei[wn],Dr+ei[wn+2],Dr+ei[wn+1]);G.primitiveLength+=ei.length/3,G.vertexLength+=D}}var ji;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,p)},vn("FillExtrusionBucket",Zu,{omit:["layers","features"]});var rd={paint:new Ho({"fill-extrusion-opacity":new In(se["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Cn(se["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new In(se["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new In(se["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Hc(se["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Cn(se["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Cn(se["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new In(se["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},rl=function(t){function o(u){t.call(this,u,rd)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new Zu(u)},o.prototype.queryRadius=function(){return Eo(this.paint.get("fill-extrusion-translate"))},o.prototype.is3D=function(){return!0},o.prototype.queryIntersectsFeature=function(u,p,y,b,C,O,D,z){var Z=zu(u,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),O.angle,D),G=this.paint.get("fill-extrusion-height").evaluate(p,y),q=this.paint.get("fill-extrusion-base").evaluate(p,y),ie=function(Oe,k,Ue,rt){for(var bt=[],Ut=0,Gt=Oe;Ut<Gt.length;Ut+=1){var ir=Gt[Ut],Mr=[ir.x,ir.y,0,1];Kc(Mr,Mr,k),bt.push(new de(Mr[0]/Mr[3],Mr[1]/Mr[3]))}return bt}(Z,z),Te=function(Oe,k,Ue,rt){for(var bt=[],Ut=[],Gt=rt[8]*k,ir=rt[9]*k,Mr=rt[10]*k,Dr=rt[11]*k,Dn=rt[8]*Ue,cn=rt[9]*Ue,Vn=rt[10]*Ue,hn=rt[11]*Ue,Pi=0,ei=Oe;Pi<ei.length;Pi+=1){for(var wn=[],ji=[],Si=0,ea=ei[Pi];Si<ea.length;Si+=1){var Wn=ea[Si],pa=Wn.x,eo=Wn.y,_o=rt[0]*pa+rt[4]*eo+rt[12],Wa=rt[1]*pa+rt[5]*eo+rt[13],to=rt[2]*pa+rt[6]*eo+rt[14],xo=rt[3]*pa+rt[7]*eo+rt[15],Yo=to+Mr,rs=xo+Dr,Gs=_o+Dn,ns=Wa+cn,Hs=to+Vn,Ga=xo+hn,ps=new de((_o+Gt)/rs,(Wa+ir)/rs);ps.z=Yo/rs,wn.push(ps);var Ci=new de(Gs/Ga,ns/Ga);Ci.z=Hs/Ga,ji.push(Ci)}bt.push(wn),Ut.push(ji)}return[bt,Ut]}(b,q,G,z);return function(Oe,k,Ue){var rt=1/0;nu(Ue,k)&&(rt=af(Ue,k[0]));for(var bt=0;bt<k.length;bt++)for(var Ut=k[bt],Gt=Oe[bt],ir=0;ir<Ut.length-1;ir++){var Mr=Ut[ir],Dr=[Mr,Ut[ir+1],Gt[ir+1],Gt[ir],Mr];Bu(Ue,Dr)&&(rt=Math.min(rt,af(Ue,Dr)))}return rt!==1/0&&rt}(Te[0],Te[1],ie)},o}(gu);function Df(t,o){return t.x*o.x+t.y*o.y}function af(t,o){if(t.length===1){for(var u,p=0,y=o[p++];!u||y.equals(u);)if(!(u=o[p++]))return 1/0;for(;p<o.length;p++){var b=o[p],C=t[0],O=u.sub(y),D=b.sub(y),z=C.sub(y),Z=Df(O,O),G=Df(O,D),q=Df(D,D),ie=Df(z,O),Te=Df(z,D),Oe=Z*q-G*G,k=(q*ie-G*Te)/Oe,Ue=(Z*Te-G*ie)/Oe,rt=y.z*(1-k-Ue)+u.z*k+b.z*Ue;if(isFinite(rt))return rt}return 1/0}for(var bt=1/0,Ut=0,Gt=o;Ut<Gt.length;Ut+=1)bt=Math.min(bt,Gt[Ut].z);return bt}var xc=La([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,mp=La([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,of=Cu.VectorTileFeature.types,jh=Math.cos(Math.PI/180*37.5),Oa=Math.pow(2,14)/.5,qi=function(t){var o=this;this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(u){o.gradients[u.id]={}}),this.layoutVertexArray=new pi,this.layoutVertexArray2=new zs,this.indexArray=new ml,this.programConfigurations=new Xn(t.layers,t.zoom),this.segments=new ue,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};qi.prototype.populate=function(t,o,u){this.hasPattern=ef("line",this.layers,o);for(var p=this.layers[0].layout.get("line-sort-key"),y=[],b=0,C=t;b<C.length;b+=1){var O=C[b],D=O.feature,z=O.id,Z=O.index,G=O.sourceLayerIndex,q=this.layers[0]._featureFilter.needGeometry,ie=ho(D,q);if(this.layers[0]._featureFilter.filter(new Ai(this.zoom),ie,u)){var Te=p?p.evaluate(ie,{},u):void 0,Oe={id:z,properties:D.properties,type:D.type,sourceLayerIndex:G,index:Z,geometry:q?ie.geometry:Ha(D),patterns:{},sortKey:Te};y.push(Oe)}}p&&y.sort(function(Mr,Dr){return Mr.sortKey-Dr.sortKey});for(var k=0,Ue=y;k<Ue.length;k+=1){var rt=Ue[k],bt=rt.geometry,Ut=rt.index,Gt=rt.sourceLayerIndex;if(this.hasPattern){var ir=kf("line",this.layers,rt,this.zoom,o);this.patternFeatures.push(ir)}else this.addFeature(rt,bt,Ut,u,{});o.featureIndex.insert(t[Ut].feature,bt,Ut,Gt,this.index)}},qi.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},qi.prototype.addFeatures=function(t,o,u){for(var p=0,y=this.patternFeatures;p<y.length;p+=1){var b=y[p];this.addFeature(b,b.geometry,b.index,o,u)}},qi.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},qi.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},qi.prototype.upload=function(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,mp)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,xc),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},qi.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},qi.prototype.lineFeatureClips=function(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}},qi.prototype.addFeature=function(t,o,u,p,y){var b=this.layers[0].layout,C=b.get("line-join").evaluate(t,{}),O=b.get("line-cap"),D=b.get("line-miter-limit"),z=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(var Z=0,G=o;Z<G.length;Z+=1)this.addLine(G[Z],t,C,O,D,z);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,p)},qi.prototype.addLine=function(t,o,u,p,y,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var C=0;C<t.length-1;C++)this.totalDistance+=t[C].dist(t[C+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var O=of[o.type]==="Polygon",D=t.length;D>=2&&t[D-1].equals(t[D-2]);)D--;for(var z=0;z<D-1&&t[z].equals(t[z+1]);)z++;if(!(D<(O?3:2))){u==="bevel"&&(y=1.05);var Z,G=this.overscaling<=16?122880/(512*this.overscaling):0,q=this.segments.prepareSegment(10*D,this.layoutVertexArray,this.indexArray),ie=void 0,Te=void 0,Oe=void 0,k=void 0;this.e1=this.e2=-1,O&&(k=t[z].sub(Z=t[D-2])._unit()._perp());for(var Ue=z;Ue<D;Ue++)if(!(Te=Ue===D-1?O?t[z+1]:void 0:t[Ue+1])||!t[Ue].equals(Te)){k&&(Oe=k),Z&&(ie=Z),Z=t[Ue],k=Te?Te.sub(Z)._unit()._perp():Oe;var rt=(Oe=Oe||k).add(k);rt.x===0&&rt.y===0||rt._unit();var bt=Oe.x*k.x+Oe.y*k.y,Ut=rt.x*k.x+rt.y*k.y,Gt=Ut!==0?1/Ut:1/0,ir=2*Math.sqrt(2-2*Ut),Mr=Ut<jh&&ie&&Te,Dr=Oe.x*k.y-Oe.y*k.x>0;if(Mr&&Ue>z){var Dn=Z.dist(ie);if(Dn>2*G){var cn=Z.sub(Z.sub(ie)._mult(G/Dn)._round());this.updateDistance(ie,cn),this.addCurrentVertex(cn,Oe,0,0,q),ie=cn}}var Vn=ie&&Te,hn=Vn?u:O?"butt":p;if(Vn&&hn==="round"&&(Gt<b?hn="miter":Gt<=2&&(hn="fakeround")),hn==="miter"&&Gt>y&&(hn="bevel"),hn==="bevel"&&(Gt>2&&(hn="flipbevel"),Gt<y&&(hn="miter")),ie&&this.updateDistance(ie,Z),hn==="miter")rt._mult(Gt),this.addCurrentVertex(Z,rt,0,0,q);else if(hn==="flipbevel"){if(Gt>100)rt=k.mult(-1);else{var Pi=Gt*Oe.add(k).mag()/Oe.sub(k).mag();rt._perp()._mult(Pi*(Dr?-1:1))}this.addCurrentVertex(Z,rt,0,0,q),this.addCurrentVertex(Z,rt.mult(-1),0,0,q)}else if(hn==="bevel"||hn==="fakeround"){var ei=-Math.sqrt(Gt*Gt-1),wn=Dr?ei:0,ji=Dr?0:ei;if(ie&&this.addCurrentVertex(Z,Oe,wn,ji,q),hn==="fakeround")for(var Si=Math.round(180*ir/Math.PI/20),ea=1;ea<Si;ea++){var Wn=ea/Si;if(Wn!==.5){var pa=Wn-.5;Wn+=Wn*pa*(Wn-1)*((1.0904+bt*(bt*(3.55645-1.43519*bt)-3.2452))*pa*pa+(.848013+bt*(.215638*bt-1.06021)))}var eo=k.sub(Oe)._mult(Wn)._add(Oe)._unit()._mult(Dr?-1:1);this.addHalfVertex(Z,eo.x,eo.y,!1,Dr,0,q)}Te&&this.addCurrentVertex(Z,k,-wn,-ji,q)}else if(hn==="butt")this.addCurrentVertex(Z,rt,0,0,q);else if(hn==="square"){var _o=ie?1:-1;this.addCurrentVertex(Z,rt,_o,_o,q)}else hn==="round"&&(ie&&(this.addCurrentVertex(Z,Oe,0,0,q),this.addCurrentVertex(Z,Oe,1,1,q,!0)),Te&&(this.addCurrentVertex(Z,k,-1,-1,q,!0),this.addCurrentVertex(Z,k,0,0,q)));if(Mr&&Ue<D-1){var Wa=Z.dist(Te);if(Wa>2*G){var to=Z.add(Te.sub(Z)._mult(G/Wa)._round());this.updateDistance(Z,to),this.addCurrentVertex(to,k,0,0,q),Z=to}}}}},qi.prototype.addCurrentVertex=function(t,o,u,p,y,b){b===void 0&&(b=!1);var C=o.y*p-o.x,O=-o.y-o.x*p;this.addHalfVertex(t,o.x+o.y*u,o.y-o.x*u,b,!1,u,y),this.addHalfVertex(t,C,O,b,!0,-p,y),this.distance>Oa/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(t,o,u,p,y,b))},qi.prototype.addHalfVertex=function(t,o,u,p,y,b,C){var O=.5*(this.lineClips?this.scaledDistance*(Oa-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t.x<<1)+(p?1:0),(t.y<<1)+(y?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(b===0?0:b<0?-1:1)|(63&O)<<2,O>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var D=C.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),C.primitiveLength++),y?this.e2=D:this.e1=D},qi.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},qi.prototype.updateDistance=function(t,o){this.distance+=t.dist(o),this.updateScaledDistance()},vn("LineBucket",qi,{omit:["layers","patternFeatures"]});var bc=new Ho({"line-cap":new In(se.layout_line["line-cap"]),"line-join":new Cn(se.layout_line["line-join"]),"line-miter-limit":new In(se.layout_line["line-miter-limit"]),"line-round-limit":new In(se.layout_line["line-round-limit"]),"line-sort-key":new Cn(se.layout_line["line-sort-key"])}),Po={paint:new Ho({"line-opacity":new Cn(se.paint_line["line-opacity"]),"line-color":new Cn(se.paint_line["line-color"]),"line-translate":new In(se.paint_line["line-translate"]),"line-translate-anchor":new In(se.paint_line["line-translate-anchor"]),"line-width":new Cn(se.paint_line["line-width"]),"line-gap-width":new Cn(se.paint_line["line-gap-width"]),"line-offset":new Cn(se.paint_line["line-offset"]),"line-blur":new Cn(se.paint_line["line-blur"]),"line-dasharray":new Qo(se.paint_line["line-dasharray"]),"line-pattern":new Hc(se.paint_line["line-pattern"]),"line-gradient":new eu(se.paint_line["line-gradient"])}),layout:bc},js=new(function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.possiblyEvaluate=function(u,p){return p=new Ai(Math.floor(p.zoom),{now:p.now,fadeDuration:p.fadeDuration,zoomHistory:p.zoomHistory,transition:p.transition}),t.prototype.possiblyEvaluate.call(this,u,p)},o.prototype.evaluate=function(u,p,y,b){return p=Tt({},p,{zoom:Math.floor(p.zoom)}),t.prototype.evaluate.call(this,u,p,y,b)},o}(Cn))(Po.paint.properties["line-width"].specification);js.useIntegerZoom=!0;var nd=function(t){function o(u){t.call(this,u,Po),this.gradientVersion=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._handleSpecialPaintPropertyUpdate=function(u){u==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof bs,this.gradientVersion=(this.gradientVersion+1)%tt)},o.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},o.prototype.recalculate=function(u,p){t.prototype.recalculate.call(this,u,p),this.paint._values["line-floorwidth"]=js.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)},o.prototype.createBucket=function(u){return new qi(u)},o.prototype.queryRadius=function(u){var p=u,y=gp(Su("line-width",this,p),Su("line-gap-width",this,p)),b=Su("line-offset",this,p);return y/2+Math.abs(b)+Eo(this.paint.get("line-translate"))},o.prototype.queryIntersectsFeature=function(u,p,y,b,C,O,D){var z=zu(u,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),O.angle,D),Z=D/2*gp(this.paint.get("line-width").evaluate(p,y),this.paint.get("line-gap-width").evaluate(p,y)),G=this.paint.get("line-offset").evaluate(p,y);return G&&(b=function(q,ie){for(var Te=[],Oe=new de(0,0),k=0;k<q.length;k++){for(var Ue=q[k],rt=[],bt=0;bt<Ue.length;bt++){var Ut=Ue[bt],Gt=Ue[bt+1],ir=bt===0?Oe:Ut.sub(Ue[bt-1])._unit()._perp(),Mr=bt===Ue.length-1?Oe:Gt.sub(Ut)._unit()._perp(),Dr=ir._add(Mr)._unit();Dr._mult(1/(Dr.x*Mr.x+Dr.y*Mr.y)),rt.push(Dr._mult(ie)._add(Ut))}Te.push(rt)}return Te}(b,G*D)),function(q,ie,Te){for(var Oe=0;Oe<ie.length;Oe++){var k=ie[Oe];if(q.length>=3){for(var Ue=0;Ue<k.length;Ue++)if(iu(q,k[Ue]))return!0}if(Jo(q,k,Te))return!0}return!1}(z,b,Z)},o.prototype.isTileClipped=function(){return!0},o}(gu);function gp(t,o){return o>0?o+2*t:t}var Ld=La([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Vh=La([{name:"a_projected_pos",components:3,type:"Float32"}],4),Dd=(La([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),La([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),yp=(La([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),La([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Al=La([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function ch(t,o,u){return t.sections.forEach(function(p){p.text=function(y,b,C){var O=b.layout.get("text-transform").evaluate(C,{});return O==="uppercase"?y=y.toLocaleUpperCase():O==="lowercase"&&(y=y.toLocaleLowerCase()),Is.applyArabicShaping&&(y=Is.applyArabicShaping(y)),y}(p.text,o,u)}),t}La([{name:"triangle",components:3,type:"Uint16"}]),La([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),La([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),La([{type:"Float32",name:"offsetX"}]),La([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Kl={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},id=function(t,o,u,p,y){var b,C,O=8*y-p-1,D=(1<<O)-1,z=D>>1,Z=-7,G=u?y-1:0,q=u?-1:1,ie=t[o+G];for(G+=q,b=ie&(1<<-Z)-1,ie>>=-Z,Z+=O;Z>0;b=256*b+t[o+G],G+=q,Z-=8);for(C=b&(1<<-Z)-1,b>>=-Z,Z+=p;Z>0;C=256*C+t[o+G],G+=q,Z-=8);if(b===0)b=1-z;else{if(b===D)return C?NaN:1/0*(ie?-1:1);C+=Math.pow(2,p),b-=z}return(ie?-1:1)*C*Math.pow(2,b-p)},fh=function(t,o,u,p,y,b){var C,O,D,z=8*b-y-1,Z=(1<<z)-1,G=Z>>1,q=y===23?Math.pow(2,-24)-Math.pow(2,-77):0,ie=p?0:b-1,Te=p?1:-1,Oe=o<0||o===0&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(O=isNaN(o)?1:0,C=Z):(C=Math.floor(Math.log(o)/Math.LN2),o*(D=Math.pow(2,-C))<1&&(C--,D*=2),(o+=C+G>=1?q/D:q*Math.pow(2,1-G))*D>=2&&(C++,D/=2),C+G>=Z?(O=0,C=Z):C+G>=1?(O=(o*D-1)*Math.pow(2,y),C+=G):(O=o*Math.pow(2,G-1)*Math.pow(2,y),C=0));y>=8;t[u+ie]=255&O,ie+=Te,O/=256,y-=8);for(C=C<<y|O,z+=y;z>0;t[u+ie]=255&C,ie+=Te,C/=256,z-=8);t[u+ie-Te]|=128*Oe},sf=Ea;function Ea(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Ea.Varint=0,Ea.Fixed64=1,Ea.Bytes=2,Ea.Fixed32=5;var Gh=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function $l(t){return t.type===Ea.Bytes?t.readVarint()+t.pos:t.pos+1}function Ff(t,o,u){return u?4294967296*o+(t>>>0):4294967296*(o>>>0)+(t>>>0)}function _p(t,o,u){var p=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));u.realloc(p);for(var y=u.pos-1;y>=t;y--)u.buf[y+p]=u.buf[y]}function Fd(t,o){for(var u=0;u<t.length;u++)o.writeVarint(t[u])}function N(t,o){for(var u=0;u<t.length;u++)o.writeSVarint(t[u])}function ce(t,o){for(var u=0;u<t.length;u++)o.writeFloat(t[u])}function Be(t,o){for(var u=0;u<t.length;u++)o.writeDouble(t[u])}function Dt(t,o){for(var u=0;u<t.length;u++)o.writeBoolean(t[u])}function rr(t,o){for(var u=0;u<t.length;u++)o.writeFixed32(t[u])}function Rt(t,o){for(var u=0;u<t.length;u++)o.writeSFixed32(t[u])}function Qt(t,o){for(var u=0;u<t.length;u++)o.writeFixed64(t[u])}function lr(t,o){for(var u=0;u<t.length;u++)o.writeSFixed64(t[u])}function dr(t,o){return(t[o]|t[o+1]<<8|t[o+2]<<16)+16777216*t[o+3]}function xr(t,o,u){t[u]=o,t[u+1]=o>>>8,t[u+2]=o>>>16,t[u+3]=o>>>24}function wr(t,o){return(t[o]|t[o+1]<<8|t[o+2]<<16)+(t[o+3]<<24)}function Tr(t,o,u){t===1&&u.readMessage(jr,o)}function jr(t,o,u){if(t===3){var p=u.readMessage(gr,{}),y=p.width,b=p.height,C=p.left,O=p.top,D=p.advance;o.push({id:p.id,bitmap:new su({width:y+6,height:b+6},p.bitmap),metrics:{width:y,height:b,left:C,top:O,advance:D}})}}function gr(t,o,u){t===1?o.id=u.readVarint():t===2?o.bitmap=u.readBytes():t===3?o.width=u.readVarint():t===4?o.height=u.readVarint():t===5?o.left=u.readSVarint():t===6?o.top=u.readSVarint():t===7&&(o.advance=u.readVarint())}function Cr(t){for(var o=0,u=0,p=0,y=t;p<y.length;p+=1){var b=y[p];o+=b.w*b.h,u=Math.max(u,b.w)}t.sort(function(Oe,k){return k.h-Oe.h});for(var C=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),u),h:1/0}],O=0,D=0,z=0,Z=t;z<Z.length;z+=1)for(var G=Z[z],q=C.length-1;q>=0;q--){var ie=C[q];if(!(G.w>ie.w||G.h>ie.h)){if(G.x=ie.x,G.y=ie.y,D=Math.max(D,G.y+G.h),O=Math.max(O,G.x+G.w),G.w===ie.w&&G.h===ie.h){var Te=C.pop();q<C.length&&(C[q]=Te)}else G.h===ie.h?(ie.x+=G.w,ie.w-=G.w):G.w===ie.w?(ie.y+=G.h,ie.h-=G.h):(C.push({x:ie.x+G.w,y:ie.y,w:ie.w-G.w,h:G.h}),ie.y+=G.h,ie.h-=G.h);break}}return{w:O,h:D,fill:o/(O*D)||0}}Ea.prototype={destroy:function(){this.buf=null},readFields:function(t,o,u){for(u=u||this.length;this.pos<u;){var p=this.readVarint(),y=p>>3,b=this.pos;this.type=7&p,t(y,o,this),this.pos===b&&this.skip(p)}return o},readMessage:function(t,o){return this.readFields(t,o,this.readVarint()+this.pos)},readFixed32:function(){var t=dr(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=wr(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=dr(this.buf,this.pos)+4294967296*dr(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=dr(this.buf,this.pos)+4294967296*wr(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=id(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=id(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var o,u,p=this.buf;return o=127&(u=p[this.pos++]),u<128?o:(o|=(127&(u=p[this.pos++]))<<7,u<128?o:(o|=(127&(u=p[this.pos++]))<<14,u<128?o:(o|=(127&(u=p[this.pos++]))<<21,u<128?o:function(y,b,C){var O,D,z=C.buf;if(O=(112&(D=z[C.pos++]))>>4,D<128||(O|=(127&(D=z[C.pos++]))<<3,D<128)||(O|=(127&(D=z[C.pos++]))<<10,D<128)||(O|=(127&(D=z[C.pos++]))<<17,D<128)||(O|=(127&(D=z[C.pos++]))<<24,D<128)||(O|=(1&(D=z[C.pos++]))<<31,D<128))return Ff(y,O,b);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(u=p[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,o=this.pos;return this.pos=t,t-o>=12&&Gh?function(u,p,y){return Gh.decode(u.subarray(p,y))}(this.buf,o,t):function(u,p,y){for(var b="",C=p;C<y;){var O,D,z,Z=u[C],G=null,q=Z>239?4:Z>223?3:Z>191?2:1;if(C+q>y)break;q===1?Z<128&&(G=Z):q===2?(192&(O=u[C+1]))==128&&(G=(31&Z)<<6|63&O)<=127&&(G=null):q===3?(D=u[C+2],(192&(O=u[C+1]))==128&&(192&D)==128&&((G=(15&Z)<<12|(63&O)<<6|63&D)<=2047||G>=55296&&G<=57343)&&(G=null)):q===4&&(D=u[C+2],z=u[C+3],(192&(O=u[C+1]))==128&&(192&D)==128&&(192&z)==128&&((G=(15&Z)<<18|(63&O)<<12|(63&D)<<6|63&z)<=65535||G>=1114112)&&(G=null)),G===null?(G=65533,q=1):G>65535&&(G-=65536,b+=String.fromCharCode(G>>>10&1023|55296),G=56320|1023&G),b+=String.fromCharCode(G),C+=q}return b}(this.buf,o,t)},readBytes:function(){var t=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,t);return this.pos=t,o},readPackedVarint:function(t,o){if(this.type!==Ea.Bytes)return t.push(this.readVarint(o));var u=$l(this);for(t=t||[];this.pos<u;)t.push(this.readVarint(o));return t},readPackedSVarint:function(t){if(this.type!==Ea.Bytes)return t.push(this.readSVarint());var o=$l(this);for(t=t||[];this.pos<o;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Ea.Bytes)return t.push(this.readBoolean());var o=$l(this);for(t=t||[];this.pos<o;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Ea.Bytes)return t.push(this.readFloat());var o=$l(this);for(t=t||[];this.pos<o;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Ea.Bytes)return t.push(this.readDouble());var o=$l(this);for(t=t||[];this.pos<o;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Ea.Bytes)return t.push(this.readFixed32());var o=$l(this);for(t=t||[];this.pos<o;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Ea.Bytes)return t.push(this.readSFixed32());var o=$l(this);for(t=t||[];this.pos<o;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Ea.Bytes)return t.push(this.readFixed64());var o=$l(this);for(t=t||[];this.pos<o;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Ea.Bytes)return t.push(this.readSFixed64());var o=$l(this);for(t=t||[];this.pos<o;)t.push(this.readSFixed64());return t},skip:function(t){var o=7&t;if(o===Ea.Varint)for(;this.buf[this.pos++]>127;);else if(o===Ea.Bytes)this.pos=this.readVarint()+this.pos;else if(o===Ea.Fixed32)this.pos+=4;else{if(o!==Ea.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(t,o){this.writeVarint(t<<3|o)},realloc:function(t){for(var o=this.length||16;o<this.pos+t;)o*=2;if(o!==this.length){var u=new Uint8Array(o);u.set(this.buf),this.buf=u,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),xr(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),xr(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),xr(this.buf,-1&t,this.pos),xr(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),xr(this.buf,-1&t,this.pos),xr(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(o,u){var p,y;if(o>=0?(p=o%4294967296|0,y=o/4294967296|0):(y=~(-o/4294967296),4294967295^(p=~(-o%4294967296))?p=p+1|0:(p=0,y=y+1|0)),o>=18446744073709552e3||o<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),function(b,C,O){O.buf[O.pos++]=127&b|128,b>>>=7,O.buf[O.pos++]=127&b|128,b>>>=7,O.buf[O.pos++]=127&b|128,b>>>=7,O.buf[O.pos++]=127&b|128,O.buf[O.pos]=127&(b>>>=7)}(p,0,u),function(b,C){var O=(7&b)<<4;C.buf[C.pos++]|=O|((b>>>=3)?128:0),b&&(C.buf[C.pos++]=127&b|((b>>>=7)?128:0),b&&(C.buf[C.pos++]=127&b|((b>>>=7)?128:0),b&&(C.buf[C.pos++]=127&b|((b>>>=7)?128:0),b&&(C.buf[C.pos++]=127&b|((b>>>=7)?128:0),b&&(C.buf[C.pos++]=127&b)))))}(y,u)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var o=this.pos;this.pos=function(p,y,b){for(var C,O,D=0;D<y.length;D++){if((C=y.charCodeAt(D))>55295&&C<57344){if(!O){C>56319||D+1===y.length?(p[b++]=239,p[b++]=191,p[b++]=189):O=C;continue}if(C<56320){p[b++]=239,p[b++]=191,p[b++]=189,O=C;continue}C=O-55296<<10|C-56320|65536,O=null}else O&&(p[b++]=239,p[b++]=191,p[b++]=189,O=null);C<128?p[b++]=C:(C<2048?p[b++]=C>>6|192:(C<65536?p[b++]=C>>12|224:(p[b++]=C>>18|240,p[b++]=C>>12&63|128),p[b++]=C>>6&63|128),p[b++]=63&C|128)}return b}(this.buf,t,this.pos);var u=this.pos-o;u>=128&&_p(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u},writeFloat:function(t){this.realloc(4),fh(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),fh(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var o=t.length;this.writeVarint(o),this.realloc(o);for(var u=0;u<o;u++)this.buf[this.pos++]=t[u]},writeRawMessage:function(t,o){this.pos++;var u=this.pos;t(o,this);var p=this.pos-u;p>=128&&_p(u,p,this),this.pos=u-1,this.writeVarint(p),this.pos+=p},writeMessage:function(t,o,u){this.writeTag(t,Ea.Bytes),this.writeRawMessage(o,u)},writePackedVarint:function(t,o){o.length&&this.writeMessage(t,Fd,o)},writePackedSVarint:function(t,o){o.length&&this.writeMessage(t,N,o)},writePackedBoolean:function(t,o){o.length&&this.writeMessage(t,Dt,o)},writePackedFloat:function(t,o){o.length&&this.writeMessage(t,ce,o)},writePackedDouble:function(t,o){o.length&&this.writeMessage(t,Be,o)},writePackedFixed32:function(t,o){o.length&&this.writeMessage(t,rr,o)},writePackedSFixed32:function(t,o){o.length&&this.writeMessage(t,Rt,o)},writePackedFixed64:function(t,o){o.length&&this.writeMessage(t,Qt,o)},writePackedSFixed64:function(t,o){o.length&&this.writeMessage(t,lr,o)},writeBytesField:function(t,o){this.writeTag(t,Ea.Bytes),this.writeBytes(o)},writeFixed32Field:function(t,o){this.writeTag(t,Ea.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(t,o){this.writeTag(t,Ea.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(t,o){this.writeTag(t,Ea.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(t,o){this.writeTag(t,Ea.Fixed64),this.writeSFixed64(o)},writeVarintField:function(t,o){this.writeTag(t,Ea.Varint),this.writeVarint(o)},writeSVarintField:function(t,o){this.writeTag(t,Ea.Varint),this.writeSVarint(o)},writeStringField:function(t,o){this.writeTag(t,Ea.Bytes),this.writeString(o)},writeFloatField:function(t,o){this.writeTag(t,Ea.Fixed32),this.writeFloat(o)},writeDoubleField:function(t,o){this.writeTag(t,Ea.Fixed64),this.writeDouble(o)},writeBooleanField:function(t,o){this.writeVarintField(t,Boolean(o))}};var nt=function(t,o){var u=o.pixelRatio,p=o.version,y=o.stretchX,b=o.stretchY,C=o.content;this.paddedRect=t,this.pixelRatio=u,this.stretchX=y,this.stretchY=b,this.content=C,this.version=p},Vt={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Vt.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Vt.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Vt.tlbr.get=function(){return this.tl.concat(this.br)},Vt.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(nt.prototype,Vt);var br=function(t,o){var u={},p={};this.haveRenderCallbacks=[];var y=[];this.addImages(t,u,y),this.addImages(o,p,y);var b=Cr(y),C=new Bo({width:b.w||1,height:b.h||1});for(var O in t){var D=t[O],z=u[O].paddedRect;Bo.copy(D.data,C,{x:0,y:0},{x:z.x+1,y:z.y+1},D.data)}for(var Z in o){var G=o[Z],q=p[Z].paddedRect,ie=q.x+1,Te=q.y+1,Oe=G.data.width,k=G.data.height;Bo.copy(G.data,C,{x:0,y:0},{x:ie,y:Te},G.data),Bo.copy(G.data,C,{x:0,y:k-1},{x:ie,y:Te-1},{width:Oe,height:1}),Bo.copy(G.data,C,{x:0,y:0},{x:ie,y:Te+k},{width:Oe,height:1}),Bo.copy(G.data,C,{x:Oe-1,y:0},{x:ie-1,y:Te},{width:1,height:k}),Bo.copy(G.data,C,{x:0,y:0},{x:ie+Oe,y:Te},{width:1,height:k})}this.image=C,this.iconPositions=u,this.patternPositions=p};br.prototype.addImages=function(t,o,u){for(var p in t){var y=t[p],b={x:0,y:0,w:y.data.width+2,h:y.data.height+2};u.push(b),o[p]=new nt(b,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(p)}},br.prototype.patchUpdatedImages=function(t,o){for(var u in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[u],t.getImage(u),o),this.patchUpdatedImage(this.patternPositions[u],t.getImage(u),o)},br.prototype.patchUpdatedImage=function(t,o,u){if(t&&o&&t.version!==o.version){t.version=o.version;var p=t.tl;u.update(o.data,void 0,{x:p[0],y:p[1]})}},vn("ImagePosition",nt),vn("ImageAtlas",br);var Nr={horizontal:1,vertical:2,horizontalOnly:3},ur=function(){this.scale=1,this.fontStack="",this.imageName=null};ur.forText=function(t,o){var u=new ur;return u.scale=t||1,u.fontStack=o,u},ur.forImage=function(t){var o=new ur;return o.imageName=t,o};var Ir=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function $r(t,o,u,p,y,b,C,O,D,z,Z,G,q,ie,Te,Oe){var k,Ue=Ir.fromFeature(t,y);G===Nr.vertical&&Ue.verticalizePunctuation();var rt=Is.processBidirectionalText,bt=Is.processStyledBidirectionalText;if(rt&&Ue.sections.length===1){k=[];for(var Ut=0,Gt=rt(Ue.toString(),qr(Ue,z,b,o,p,ie,Te));Ut<Gt.length;Ut+=1){var ir=Gt[Ut],Mr=new Ir;Mr.text=ir,Mr.sections=Ue.sections;for(var Dr=0;Dr<ir.length;Dr++)Mr.sectionIndex.push(0);k.push(Mr)}}else if(bt){k=[];for(var Dn=0,cn=bt(Ue.text,Ue.sectionIndex,qr(Ue,z,b,o,p,ie,Te));Dn<cn.length;Dn+=1){var Vn=cn[Dn],hn=new Ir;hn.text=Vn[0],hn.sectionIndex=Vn[1],hn.sections=Ue.sections,k.push(hn)}}else k=function(wn,ji){for(var Si=[],ea=wn.text,Wn=0,pa=0,eo=ji;pa<eo.length;pa+=1){var _o=eo[pa];Si.push(wn.substring(Wn,_o)),Wn=_o}return Wn<ea.length&&Si.push(wn.substring(Wn,ea.length)),Si}(Ue,qr(Ue,z,b,o,p,ie,Te));var Pi=[],ei={positionedLines:Pi,text:Ue.toString(),top:Z[1],bottom:Z[1],left:Z[0],right:Z[0],writingMode:G,iconsInText:!1,verticalizable:!1};return function(wn,ji,Si,ea,Wn,pa,eo,_o,Wa,to,xo,Yo){for(var rs=0,Gs=-17,ns=0,Hs=0,Ga=_o==="right"?1:_o==="left"?0:.5,ps=0,Ci=0,Fa=Wn;Ci<Fa.length;Ci+=1){var wa=Fa[Ci];wa.trim();var fa=wa.getMaxScale(),ds=24*(fa-1),ws={positionedGlyphs:[],lineOffset:0};wn.positionedLines[ps]=ws;var Xa=ws.positionedGlyphs,Ro=0;if(wa.length()){for(var vs=0;vs<wa.length();vs++){var da=wa.getSection(vs),ec=wa.getSectionIndex(vs),uu=wa.getCharCode(vs),lf=0,ko=null,Ac=null,nl=null,Yh=24,Nf=!(Wa===Nr.horizontal||!xo&&!wf(uu)||xo&&(Bn[uu]||(Tc=uu,Zr.Arabic(Tc)||Zr["Arabic Supplement"](Tc)||Zr["Arabic Extended-A"](Tc)||Zr["Arabic Presentation Forms-A"](Tc)||Zr["Arabic Presentation Forms-B"](Tc))));if(da.imageName){var ph=ea[da.imageName];if(!ph)continue;nl=da.imageName,wn.iconsInText=wn.iconsInText||!0,Ac=ph.paddedRect;var wc=ph.displaySize;da.scale=24*da.scale/Yo,lf=ds+(24-wc[1]*da.scale),Yh=(ko={width:wc[0],height:wc[1],left:1,top:-3,advance:Nf?wc[1]:wc[0]}).advance;var dh=Nf?wc[0]*da.scale-24*fa:wc[1]*da.scale-24*fa;dh>0&&dh>Ro&&(Ro=dh)}else{var xp=Si[da.fontStack],vh=xp&&xp[uu];if(vh&&vh.rect)Ac=vh.rect,ko=vh.metrics;else{var qh=ji[da.fontStack],bp=qh&&qh[uu];if(!bp)continue;ko=bp.metrics}lf=24*(fa-da.scale)}Nf?(wn.verticalizable=!0,Xa.push({glyph:uu,imageName:nl,x:rs,y:Gs+lf,vertical:Nf,scale:da.scale,fontStack:da.fontStack,sectionIndex:ec,metrics:ko,rect:Ac}),rs+=Yh*da.scale+to):(Xa.push({glyph:uu,imageName:nl,x:rs,y:Gs+lf,vertical:Nf,scale:da.scale,fontStack:da.fontStack,sectionIndex:ec,metrics:ko,rect:Ac}),rs+=ko.advance*da.scale+to)}Xa.length!==0&&(ns=Math.max(rs-to,ns),gi(Xa,0,Xa.length-1,Ga,Ro)),rs=0;var Ep=pa*fa+Ro;ws.lineOffset=Math.max(Ro,ds),Gs+=Ep,Hs=Math.max(Ep,Hs),++ps}else Gs+=pa,++ps}var Tc,Kh=Gs- -17,mh=Kr(eo),cf=mh.horizontalAlign,gh=mh.verticalAlign;(function(Sp,Cp,$h,ms,Ap,Qh,Jh,ep,wp){var yh,Tp=(Cp-$h)*Ap;yh=Qh!==Jh?-ep*ms- -17:(-ms*wp+.5)*Jh;for(var _h=0,tp=Sp;_h<tp.length;_h+=1)for(var zf=0,rp=tp[_h].positionedGlyphs;zf<rp.length;zf+=1){var xh=rp[zf];xh.x+=Tp,xh.y+=yh}})(wn.positionedLines,Ga,cf,gh,ns,Hs,pa,Kh,Wn.length),wn.top+=-gh*Kh,wn.bottom=wn.top+Kh,wn.left+=-cf*ns,wn.right=wn.left+ns}(ei,o,u,p,k,C,O,D,G,z,q,Oe),!function(wn){for(var ji=0,Si=wn;ji<Si.length;ji+=1)if(Si[ji].positionedGlyphs.length!==0)return!1;return!0}(Pi)&&ei}Ir.fromFeature=function(t,o){for(var u=new Ir,p=0;p<t.sections.length;p++){var y=t.sections[p];y.image?u.addImageSection(y):u.addTextSection(y,o)}return u},Ir.prototype.length=function(){return this.text.length},Ir.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},Ir.prototype.getSectionIndex=function(t){return this.sectionIndex[t]},Ir.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},Ir.prototype.verticalizePunctuation=function(){this.text=function(t){for(var o="",u=0;u<t.length;u++){var p=t.charCodeAt(u+1)||null,y=t.charCodeAt(u-1)||null;o+=p&&hl(p)&&!Kl[t[u+1]]||y&&hl(y)&&!Kl[t[u-1]]||!Kl[t[u]]?t[u]:Kl[t[u]]}return o}(this.text)},Ir.prototype.trim=function(){for(var t=0,o=0;o<this.text.length&&Bn[this.text.charCodeAt(o)];o++)t++;for(var u=this.text.length,p=this.text.length-1;p>=0&&p>=t&&Bn[this.text.charCodeAt(p)];p--)u--;this.text=this.text.substring(t,u),this.sectionIndex=this.sectionIndex.slice(t,u)},Ir.prototype.substring=function(t,o){var u=new Ir;return u.text=this.text.substring(t,o),u.sectionIndex=this.sectionIndex.slice(t,o),u.sections=this.sections,u},Ir.prototype.toString=function(){return this.text},Ir.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce(function(o,u){return Math.max(o,t.sections[u].scale)},0)},Ir.prototype.addTextSection=function(t,o){this.text+=t.text,this.sections.push(ur.forText(t.scale,t.fontStack||o));for(var u=this.sections.length-1,p=0;p<t.text.length;++p)this.sectionIndex.push(u)},Ir.prototype.addImageSection=function(t){var o=t.image?t.image.name:"";if(o.length!==0){var u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(ur.forImage(o)),this.sectionIndex.push(this.sections.length-1)):$e("Reached maximum number of images 6401")}else $e("Can't add FormattedSection with an empty image.")},Ir.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Bn={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Jt={};function tr(t,o,u,p,y,b){if(o.imageName){var C=p[o.imageName];return C?C.displaySize[0]*o.scale*24/b+y:0}var O=u[o.fontStack],D=O&&O[t];return D?D.metrics.advance*o.scale+y:0}function xn(t,o,u,p){var y=Math.pow(t-o,2);return p?t<o?y/2:2*y:y+Math.abs(u)*u}function Vr(t,o,u){var p=0;return t===10&&(p-=1e4),u&&(p+=150),t!==40&&t!==65288||(p+=50),o!==41&&o!==65289||(p+=50),p}function Sr(t,o,u,p,y,b){for(var C=null,O=xn(o,u,y,b),D=0,z=p;D<z.length;D+=1){var Z=z[D],G=xn(o-Z.x,u,y,b)+Z.badness;G<=O&&(C=Z,O=G)}return{index:t,x:o,priorBreak:C,badness:O}}function qr(t,o,u,p,y,b,C){if(b!=="point")return[];if(!t)return[];for(var O,D=[],z=function(k,Ue,rt,bt,Ut,Gt){for(var ir=0,Mr=0;Mr<k.length();Mr++){var Dr=k.getSection(Mr);ir+=tr(k.getCharCode(Mr),Dr,bt,Ut,Ue,Gt)}return ir/Math.max(1,Math.ceil(ir/rt))}(t,o,u,p,y,C),Z=t.text.indexOf("\u200B")>=0,G=0,q=0;q<t.length();q++){var ie=t.getSection(q),Te=t.getCharCode(q);if(Bn[Te]||(G+=tr(Te,ie,p,y,o,C)),q<t.length()-1){var Oe=!((O=Te)<11904||!(Zr["Bopomofo Extended"](O)||Zr.Bopomofo(O)||Zr["CJK Compatibility Forms"](O)||Zr["CJK Compatibility Ideographs"](O)||Zr["CJK Compatibility"](O)||Zr["CJK Radicals Supplement"](O)||Zr["CJK Strokes"](O)||Zr["CJK Symbols and Punctuation"](O)||Zr["CJK Unified Ideographs Extension A"](O)||Zr["CJK Unified Ideographs"](O)||Zr["Enclosed CJK Letters and Months"](O)||Zr["Halfwidth and Fullwidth Forms"](O)||Zr.Hiragana(O)||Zr["Ideographic Description Characters"](O)||Zr["Kangxi Radicals"](O)||Zr["Katakana Phonetic Extensions"](O)||Zr.Katakana(O)||Zr["Vertical Forms"](O)||Zr["Yi Radicals"](O)||Zr["Yi Syllables"](O)));(Jt[Te]||Oe||ie.imageName)&&D.push(Sr(q+1,G,z,D,Vr(Te,t.getCharCode(q+1),Oe&&Z),!1))}}return function k(Ue){return Ue?k(Ue.priorBreak).concat(Ue.index):[]}(Sr(t.length(),G,z,D,0,!0))}function Kr(t){var o=.5,u=.5;switch(t){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:o,verticalAlign:u}}function gi(t,o,u,p,y){if(p||y)for(var b=t[u],C=(t[u].x+b.metrics.advance*b.scale)*p,O=o;O<=u;O++)t[O].x-=C,t[O].y+=y}function ai(t,o,u,p,y,b){var C,O=t.image;if(O.content){var D=O.content,z=O.pixelRatio||1;C=[D[0]/z,D[1]/z,O.displaySize[0]-D[2]/z,O.displaySize[1]-D[3]/z]}var Z,G,q,ie,Te=o.left*b,Oe=o.right*b;u==="width"||u==="both"?(ie=y[0]+Te-p[3],G=y[0]+Oe+p[1]):G=(ie=y[0]+(Te+Oe-O.displaySize[0])/2)+O.displaySize[0];var k=o.top*b,Ue=o.bottom*b;return u==="height"||u==="both"?(Z=y[1]+k-p[0],q=y[1]+Ue+p[2]):q=(Z=y[1]+(k+Ue-O.displaySize[1])/2)+O.displaySize[1],{image:O,top:Z,right:G,bottom:q,left:ie,collisionPadding:C}}Jt[10]=!0,Jt[32]=!0,Jt[38]=!0,Jt[40]=!0,Jt[41]=!0,Jt[43]=!0,Jt[45]=!0,Jt[47]=!0,Jt[173]=!0,Jt[183]=!0,Jt[8203]=!0,Jt[8208]=!0,Jt[8211]=!0,Jt[8231]=!0;var Hr=function(t){function o(u,p,y,b){t.call(this,u,p),this.angle=y,b!==void 0&&(this.segment=b)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.clone=function(){return new o(this.x,this.y,this.angle,this.segment)},o}(de);function rn(t,o){var u=o.expression;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new Ai(t+1))};if(u.kind==="source")return{kind:"source"};for(var p=u.zoomStops,y=u.interpolationType,b=0;b<p.length&&p[b]<=t;)b++;for(var C=b=Math.max(0,b-1);C<p.length&&p[C]<t+1;)C++;C=Math.min(p.length-1,C);var O=p[b],D=p[C];return u.kind==="composite"?{kind:"composite",minZoom:O,maxZoom:D,interpolationType:y}:{kind:"camera",minZoom:O,maxZoom:D,minSize:u.evaluate(new Ai(O)),maxSize:u.evaluate(new Ai(D)),interpolationType:y}}function Qn(t,o,u){var p=o.uSize,y=u.lowerSize;return t.kind==="source"?y/128:t.kind==="composite"?ga(y/128,u.upperSize/128,o.uSizeT):p}function ci(t,o){var u=0,p=0;if(t.kind==="constant")p=t.layoutSize;else if(t.kind!=="source"){var y=t.interpolationType,b=y?Nt(ge.interpolationFactor(y,o,t.minZoom,t.maxZoom),0,1):0;t.kind==="camera"?p=ga(t.minSize,t.maxSize,b):u=b}return{uSizeT:u,uSize:p}}vn("Anchor",Hr);var Ni=Object.freeze({__proto__:null,getSizeData:rn,evaluateSizeForFeature:Qn,evaluateSizeForZoom:ci,SIZE_PACK_FACTOR:128});function so(t,o,u,p,y){if(o.segment===void 0)return!0;for(var b=o,C=o.segment+1,O=0;O>-u/2;){if(--C<0)return!1;O-=t[C].dist(b),b=t[C]}O+=t[C].dist(t[C+1]),C++;for(var D=[],z=0;O<u/2;){var Z=t[C],G=t[C+1];if(!G)return!1;var q=t[C-1].angleTo(Z)-Z.angleTo(G);for(q=Math.abs((q+3*Math.PI)%(2*Math.PI)-Math.PI),D.push({distance:O,angleDelta:q}),z+=q;O-D[0].distance>p;)z-=D.shift().angleDelta;if(z>y)return!1;C++,O+=Z.dist(G)}return!0}function uo(t){for(var o=0,u=0;u<t.length-1;u++)o+=t[u].dist(t[u+1]);return o}function Fi(t,o,u){return t?.6*o*u:0}function ts(t,o){return Math.max(t?t.right-t.left:0,o?o.right-o.left:0)}function ja(t,o,u,p,y,b){for(var C=Fi(u,y,b),O=ts(u,p)*b,D=0,z=uo(t)/2,Z=0;Z<t.length-1;Z++){var G=t[Z],q=t[Z+1],ie=G.dist(q);if(D+ie>z){var Te=(z-D)/ie,Oe=ga(G.x,q.x,Te),k=ga(G.y,q.y,Te),Ue=new Hr(Oe,k,q.angleTo(G),Z);return Ue._round(),!C||so(t,Ue,O,C,o)?Ue:void 0}D+=ie}}function No(t,o,u,p,y,b,C,O,D){var z=Fi(p,b,C),Z=ts(p,y),G=Z*C,q=t[0].x===0||t[0].x===D||t[0].y===0||t[0].y===D;return o-G<o/4&&(o=G+o/4),function ie(Te,Oe,k,Ue,rt,bt,Ut,Gt,ir){for(var Mr=bt/2,Dr=uo(Te),Dn=0,cn=Oe-k,Vn=[],hn=0;hn<Te.length-1;hn++){for(var Pi=Te[hn],ei=Te[hn+1],wn=Pi.dist(ei),ji=ei.angleTo(Pi);cn+k<Dn+wn;){var Si=((cn+=k)-Dn)/wn,ea=ga(Pi.x,ei.x,Si),Wn=ga(Pi.y,ei.y,Si);if(ea>=0&&ea<ir&&Wn>=0&&Wn<ir&&cn-Mr>=0&&cn+Mr<=Dr){var pa=new Hr(ea,Wn,ji,hn);pa._round(),Ue&&!so(Te,pa,bt,Ue,rt)||Vn.push(pa)}}Dn+=wn}return Gt||Vn.length||Ut||(Vn=ie(Te,Dn/2,k,Ue,rt,bt,Ut,!0,ir)),Vn}(t,q?o/2*O%o:(Z/2+2*b)*C*O%o,o,z,u,G,q,!1,D)}function So(t,o,u,p,y){for(var b=[],C=0;C<t.length;C++)for(var O=t[C],D=void 0,z=0;z<O.length-1;z++){var Z=O[z],G=O[z+1];Z.x<o&&G.x<o||(Z.x<o?Z=new de(o,Z.y+(o-Z.x)/(G.x-Z.x)*(G.y-Z.y))._round():G.x<o&&(G=new de(o,Z.y+(o-Z.x)/(G.x-Z.x)*(G.y-Z.y))._round()),Z.y<u&&G.y<u||(Z.y<u?Z=new de(Z.x+(u-Z.y)/(G.y-Z.y)*(G.x-Z.x),u)._round():G.y<u&&(G=new de(Z.x+(u-Z.y)/(G.y-Z.y)*(G.x-Z.x),u)._round()),Z.x>=p&&G.x>=p||(Z.x>=p?Z=new de(p,Z.y+(p-Z.x)/(G.x-Z.x)*(G.y-Z.y))._round():G.x>=p&&(G=new de(p,Z.y+(p-Z.x)/(G.x-Z.x)*(G.y-Z.y))._round()),Z.y>=y&&G.y>=y||(Z.y>=y?Z=new de(Z.x+(y-Z.y)/(G.y-Z.y)*(G.x-Z.x),y)._round():G.y>=y&&(G=new de(Z.x+(y-Z.y)/(G.y-Z.y)*(G.x-Z.x),y)._round()),D&&Z.equals(D[D.length-1])||b.push(D=[Z]),D.push(G)))))}return b}function Wo(t,o,u,p){var y=[],b=t.image,C=b.pixelRatio,O=b.paddedRect.w-2,D=b.paddedRect.h-2,z=t.right-t.left,Z=t.bottom-t.top,G=b.stretchX||[[0,O]],q=b.stretchY||[[0,D]],ie=function(ea,Wn){return ea+Wn[1]-Wn[0]},Te=G.reduce(ie,0),Oe=q.reduce(ie,0),k=O-Te,Ue=D-Oe,rt=0,bt=Te,Ut=0,Gt=Oe,ir=0,Mr=k,Dr=0,Dn=Ue;if(b.content&&p){var cn=b.content;rt=Oo(G,0,cn[0]),Ut=Oo(q,0,cn[1]),bt=Oo(G,cn[0],cn[2]),Gt=Oo(q,cn[1],cn[3]),ir=cn[0]-rt,Dr=cn[1]-Ut,Mr=cn[2]-cn[0]-bt,Dn=cn[3]-cn[1]-Gt}var Vn=function(ea,Wn,pa,eo){var _o=po(ea.stretch-rt,bt,z,t.left),Wa=yi(ea.fixed-ir,Mr,ea.stretch,Te),to=po(Wn.stretch-Ut,Gt,Z,t.top),xo=yi(Wn.fixed-Dr,Dn,Wn.stretch,Oe),Yo=po(pa.stretch-rt,bt,z,t.left),rs=yi(pa.fixed-ir,Mr,pa.stretch,Te),Gs=po(eo.stretch-Ut,Gt,Z,t.top),ns=yi(eo.fixed-Dr,Dn,eo.stretch,Oe),Hs=new de(_o,to),Ga=new de(Yo,to),ps=new de(Yo,Gs),Ci=new de(_o,Gs),Fa=new de(Wa/C,xo/C),wa=new de(rs/C,ns/C),fa=o*Math.PI/180;if(fa){var ds=Math.sin(fa),ws=Math.cos(fa),Xa=[ws,-ds,ds,ws];Hs._matMult(Xa),Ga._matMult(Xa),Ci._matMult(Xa),ps._matMult(Xa)}var Ro=ea.stretch+ea.fixed,vs=Wn.stretch+Wn.fixed;return{tl:Hs,tr:Ga,bl:Ci,br:ps,tex:{x:b.paddedRect.x+1+Ro,y:b.paddedRect.y+1+vs,w:pa.stretch+pa.fixed-Ro,h:eo.stretch+eo.fixed-vs},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Fa,pixelOffsetBR:wa,minFontScaleX:Mr/C/z,minFontScaleY:Dn/C/Z,isSDF:u}};if(p&&(b.stretchX||b.stretchY))for(var hn=cs(G,k,Te),Pi=cs(q,Ue,Oe),ei=0;ei<hn.length-1;ei++)for(var wn=hn[ei],ji=hn[ei+1],Si=0;Si<Pi.length-1;Si++)y.push(Vn(wn,Pi[Si],ji,Pi[Si+1]));else y.push(Vn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:O+1},{fixed:0,stretch:D+1}));return y}function Oo(t,o,u){for(var p=0,y=0,b=t;y<b.length;y+=1){var C=b[y];p+=Math.max(o,Math.min(u,C[1]))-Math.max(o,Math.min(u,C[0]))}return p}function cs(t,o,u){for(var p=[{fixed:-1,stretch:0}],y=0,b=t;y<b.length;y+=1){var C=b[y],O=C[0],D=C[1],z=p[p.length-1];p.push({fixed:O-z.stretch,stretch:z.stretch}),p.push({fixed:O-z.stretch,stretch:z.stretch+(D-O)})}return p.push({fixed:o+1,stretch:u}),p}function po(t,o,u,p){return t/o*u+p}function yi(t,o,u,p){return t-o*u/p}var Io=function(t,o,u,p,y,b,C,O,D,z){if(this.boxStartIndex=t.length,D){var Z=b.top,G=b.bottom,q=b.collisionPadding;q&&(Z-=q[1],G+=q[3]);var ie=G-Z;ie>0&&(ie=Math.max(10,ie),this.circleDiameter=ie)}else{var Te=b.top*C-O,Oe=b.bottom*C+O,k=b.left*C-O,Ue=b.right*C+O,rt=b.collisionPadding;if(rt&&(k-=rt[0]*C,Te-=rt[1]*C,Ue+=rt[2]*C,Oe+=rt[3]*C),z){var bt=new de(k,Te),Ut=new de(Ue,Te),Gt=new de(k,Oe),ir=new de(Ue,Oe),Mr=z*Math.PI/180;bt._rotate(Mr),Ut._rotate(Mr),Gt._rotate(Mr),ir._rotate(Mr),k=Math.min(bt.x,Ut.x,Gt.x,ir.x),Ue=Math.max(bt.x,Ut.x,Gt.x,ir.x),Te=Math.min(bt.y,Ut.y,Gt.y,ir.y),Oe=Math.max(bt.y,Ut.y,Gt.y,ir.y)}t.emplaceBack(o.x,o.y,k,Te,Ue,Oe,u,p,y)}this.boxEndIndex=t.length},Ji=function(t,o){if(t===void 0&&(t=[]),o===void 0&&(o=zo),this.data=t,this.length=this.data.length,this.compare=o,this.length>0)for(var u=(this.length>>1)-1;u>=0;u--)this._down(u)};function zo(t,o){return t<o?-1:t>o?1:0}function ti(t,o,u){o===void 0&&(o=1),u===void 0&&(u=!1);for(var p=1/0,y=1/0,b=-1/0,C=-1/0,O=t[0],D=0;D<O.length;D++){var z=O[D];(!D||z.x<p)&&(p=z.x),(!D||z.y<y)&&(y=z.y),(!D||z.x>b)&&(b=z.x),(!D||z.y>C)&&(C=z.y)}var Z=Math.min(b-p,C-y),G=Z/2,q=new Ji([],zi);if(Z===0)return new de(p,y);for(var ie=p;ie<b;ie+=Z)for(var Te=y;Te<C;Te+=Z)q.push(new ma(ie+G,Te+G,G,t));for(var Oe=function(rt){for(var bt=0,Ut=0,Gt=0,ir=rt[0],Mr=0,Dr=ir.length,Dn=Dr-1;Mr<Dr;Dn=Mr++){var cn=ir[Mr],Vn=ir[Dn],hn=cn.x*Vn.y-Vn.x*cn.y;Ut+=(cn.x+Vn.x)*hn,Gt+=(cn.y+Vn.y)*hn,bt+=3*hn}return new ma(Ut/bt,Gt/bt,0,rt)}(t),k=q.length;q.length;){var Ue=q.pop();(Ue.d>Oe.d||!Oe.d)&&(Oe=Ue,u&&console.log("found best %d after %d probes",Math.round(1e4*Ue.d)/1e4,k)),Ue.max-Oe.d<=o||(q.push(new ma(Ue.p.x-(G=Ue.h/2),Ue.p.y-G,G,t)),q.push(new ma(Ue.p.x+G,Ue.p.y-G,G,t)),q.push(new ma(Ue.p.x-G,Ue.p.y+G,G,t)),q.push(new ma(Ue.p.x+G,Ue.p.y+G,G,t)),k+=4)}return u&&(console.log("num probes: "+k),console.log("best distance: "+Oe.d)),Oe.p}function zi(t,o){return o.max-t.max}function ma(t,o,u,p){this.p=new de(t,o),this.h=u,this.d=function(y,b){for(var C=!1,O=1/0,D=0;D<b.length;D++)for(var z=b[D],Z=0,G=z.length,q=G-1;Z<G;q=Z++){var ie=z[Z],Te=z[q];ie.y>y.y!=Te.y>y.y&&y.x<(Te.x-ie.x)*(y.y-ie.y)/(Te.y-ie.y)+ie.x&&(C=!C),O=Math.min(O,_l(y,ie,Te))}return(C?1:-1)*Math.sqrt(O)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}Ji.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},Ji.prototype.pop=function(){if(this.length!==0){var t=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),t}},Ji.prototype.peek=function(){return this.data[0]},Ji.prototype._up=function(t){for(var o=this.data,u=this.compare,p=o[t];t>0;){var y=t-1>>1,b=o[y];if(u(p,b)>=0)break;o[t]=b,t=y}o[t]=p},Ji.prototype._down=function(t){for(var o=this.data,u=this.compare,p=this.length>>1,y=o[t];t<p;){var b=1+(t<<1),C=o[b],O=b+1;if(O<this.length&&u(o[O],C)<0&&(b=O,C=o[O]),u(C,y)>=0)break;o[t]=C,t=b}o[t]=y};var Ln=Number.POSITIVE_INFINITY;function ri(t,o){return o[1]!==Ln?function(u,p,y){var b=0,C=0;switch(p=Math.abs(p),y=Math.abs(y),u){case"top-right":case"top-left":case"top":C=y-7;break;case"bottom-right":case"bottom-left":case"bottom":C=7-y}switch(u){case"top-right":case"bottom-right":case"right":b=-p;break;case"top-left":case"bottom-left":case"left":b=p}return[b,C]}(t,o[0],o[1]):function(u,p){var y=0,b=0;p<0&&(p=0);var C=p/Math.sqrt(2);switch(u){case"top-right":case"top-left":b=C-7;break;case"bottom-right":case"bottom-left":b=7-C;break;case"bottom":b=7-p;break;case"top":b=p-7}switch(u){case"top-right":case"bottom-right":y=-C;break;case"top-left":case"bottom-left":y=C;break;case"left":y=p;break;case"right":y=-p}return[y,b]}(t,o[0])}function we(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function zt(t,o,u,p,y,b,C,O,D,z,Z,G,q,ie,Te){var Oe=function(Ut,Gt,ir,Mr,Dr,Dn,cn,Vn){for(var hn=Mr.layout.get("text-rotate").evaluate(Dn,{})*Math.PI/180,Pi=[],ei=0,wn=Gt.positionedLines;ei<wn.length;ei+=1)for(var ji=wn[ei],Si=0,ea=ji.positionedGlyphs;Si<ea.length;Si+=1){var Wn=ea[Si];if(Wn.rect){var pa=Wn.rect||{},eo=4,_o=!0,Wa=1,to=0,xo=(Dr||Vn)&&Wn.vertical,Yo=Wn.metrics.advance*Wn.scale/2;if(Vn&&Gt.verticalizable&&(to=ji.lineOffset/2-(Wn.imageName?-(24-Wn.metrics.width*Wn.scale)/2:24*(Wn.scale-1))),Wn.imageName){var rs=cn[Wn.imageName];_o=rs.sdf,eo=1/(Wa=rs.pixelRatio)}var Gs=Dr?[Wn.x+Yo,Wn.y]:[0,0],ns=Dr?[0,0]:[Wn.x+Yo+ir[0],Wn.y+ir[1]-to],Hs=[0,0];xo&&(Hs=ns,ns=[0,0]);var Ga=(Wn.metrics.left-eo)*Wn.scale-Yo+ns[0],ps=(-Wn.metrics.top-eo)*Wn.scale+ns[1],Ci=Ga+pa.w*Wn.scale/Wa,Fa=ps+pa.h*Wn.scale/Wa,wa=new de(Ga,ps),fa=new de(Ci,ps),ds=new de(Ga,Fa),ws=new de(Ci,Fa);if(xo){var Xa=new de(-Yo,Yo- -17),Ro=-Math.PI/2,vs=12-Yo,da=new de(22-vs,-(Wn.imageName?vs:0)),ec=new(Function.prototype.bind.apply(de,[null].concat(Hs)));wa._rotateAround(Ro,Xa)._add(da)._add(ec),fa._rotateAround(Ro,Xa)._add(da)._add(ec),ds._rotateAround(Ro,Xa)._add(da)._add(ec),ws._rotateAround(Ro,Xa)._add(da)._add(ec)}if(hn){var uu=Math.sin(hn),lf=Math.cos(hn),ko=[lf,-uu,uu,lf];wa._matMult(ko),fa._matMult(ko),ds._matMult(ko),ws._matMult(ko)}var Ac=new de(0,0),nl=new de(0,0);Pi.push({tl:wa,tr:fa,bl:ds,br:ws,tex:pa,writingMode:Gt.writingMode,glyphOffset:Gs,sectionIndex:Wn.sectionIndex,isSDF:_o,pixelOffsetTL:Ac,pixelOffsetBR:nl,minFontScaleX:0,minFontScaleY:0})}}return Pi}(0,u,O,y,b,C,p,t.allowVerticalPlacement),k=t.textSizeData,Ue=null;k.kind==="source"?(Ue=[128*y.layout.get("text-size").evaluate(C,{})])[0]>32640&&$e(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):k.kind==="composite"&&((Ue=[128*ie.compositeTextSizes[0].evaluate(C,{},Te),128*ie.compositeTextSizes[1].evaluate(C,{},Te)])[0]>32640||Ue[1]>32640)&&$e(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),t.addSymbols(t.text,Oe,Ue,O,b,C,z,o,D.lineStartIndex,D.lineLength,q,Te);for(var rt=0,bt=Z;rt<bt.length;rt+=1)G[bt[rt]]=t.text.placedSymbolArray.length-1;return 4*Oe.length}function St(t){for(var o in t)return t[o];return null}function mn(t,o,u,p){var y=t.compareText;if(o in y){for(var b=y[o],C=b.length-1;C>=0;C--)if(p.dist(b[C])<u)return!0}else y[o]=[];return y[o].push(p),!1}var Gi=Cu.VectorTileFeature.types,Ee=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ae(t,o,u,p,y,b,C,O,D,z,Z,G,q){var ie=O?Math.min(32640,Math.round(O[0])):0,Te=O?Math.min(32640,Math.round(O[1])):0;t.emplaceBack(o,u,Math.round(32*p),Math.round(32*y),b,C,(ie<<1)+(D?1:0),Te,16*z,16*Z,256*G,256*q)}function Ve(t,o,u){t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u)}function ot(t){for(var o=0,u=t.sections;o<u.length;o+=1)if(Tf(u[o].text))return!0;return!1}var Ot=function(t){this.layoutVertexArray=new jl,this.indexArray=new ml,this.programConfigurations=t,this.segments=new ue,this.dynamicLayoutVertexArray=new Fu,this.opacityVertexArray=new el,this.placedSymbolArray=new d};Ot.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Ot.prototype.upload=function(t,o,u,p){this.isEmpty()||(u&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ld.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Vh.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Ee,!0),this.opacityVertexBuffer.itemSize=1),(u||p)&&this.programConfigurations.upload(t))},Ot.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},vn("SymbolBuffers",Ot);var Ye=function(t,o,u){this.layoutVertexArray=new t,this.layoutAttributes=o,this.indexArray=new u,this.segments=new ue,this.collisionVertexArray=new Vl};Ye.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Dd.members,!0)},Ye.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},vn("CollisionBuffers",Ye);var De=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(b){return b.id}),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Us([]),this.placementViewportMatrix=Us([]);var o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=rn(this.zoom,o["text-size"]),this.iconSizeData=rn(this.zoom,o["icon-size"]);var u=this.layers[0].layout,p=u.get("symbol-sort-key"),y=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,u.get("symbol-placement")==="point"&&(this.writingModes=u.get("text-writing-mode").map(function(b){return Nr[b]})),this.stateDependentLayerIds=this.layers.filter(function(b){return b.isStateDependent()}).map(function(b){return b.id}),this.sourceID=t.sourceID};De.prototype.createArrays=function(){this.text=new Ot(new Xn(this.layers,this.zoom,function(t){return/^text/.test(t)})),this.icon=new Ot(new Xn(this.layers,this.zoom,function(t){return/^icon/.test(t)})),this.glyphOffsetArray=new P,this.lineVertexArray=new L,this.symbolInstances=new w},De.prototype.calculateGlyphDependencies=function(t,o,u,p,y){for(var b=0;b<t.length;b++)if(o[t.charCodeAt(b)]=!0,(u||p)&&y){var C=Kl[t.charAt(b)];C&&(o[C.charCodeAt(0)]=!0)}},De.prototype.populate=function(t,o,u){var p=this.layers[0],y=p.layout,b=y.get("text-font"),C=y.get("text-field"),O=y.get("icon-image"),D=(C.value.kind!=="constant"||C.value.value instanceof gt&&!C.value.value.isEmpty()||C.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),z=O.value.kind!=="constant"||!!O.value.value||Object.keys(O.parameters).length>0,Z=y.get("symbol-sort-key");if(this.features=[],D||z){for(var G=o.iconDependencies,q=o.glyphDependencies,ie=o.availableImages,Te=new Ai(this.zoom),Oe=0,k=t;Oe<k.length;Oe+=1){var Ue=k[Oe],rt=Ue.feature,bt=Ue.id,Ut=Ue.index,Gt=Ue.sourceLayerIndex,ir=p._featureFilter.needGeometry,Mr=ho(rt,ir);if(p._featureFilter.filter(Te,Mr,u)){ir||(Mr.geometry=Ha(rt));var Dr=void 0;if(D){var Dn=p.getValueAndResolveTokens("text-field",Mr,u,ie),cn=gt.factory(Dn);ot(cn)&&(this.hasRTLText=!0),(!this.hasRTLText||Mf()==="unavailable"||this.hasRTLText&&Is.isParsed())&&(Dr=ch(cn,p,Mr))}var Vn=void 0;if(z){var hn=p.getValueAndResolveTokens("icon-image",Mr,u,ie);Vn=hn instanceof sa?hn:sa.fromString(hn)}if(Dr||Vn){var Pi=this.sortFeaturesByKey?Z.evaluate(Mr,{},u):void 0;if(this.features.push({id:bt,text:Dr,icon:Vn,index:Ut,sourceLayerIndex:Gt,geometry:Mr.geometry,properties:rt.properties,type:Gi[rt.type],sortKey:Pi}),Vn&&(G[Vn.name]=!0),Dr){var ei=b.evaluate(Mr,{},u).join(","),wn=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Nr.vertical)>=0;for(var ji=0,Si=Dr.sections;ji<Si.length;ji+=1){var ea=Si[ji];if(ea.image)G[ea.image.name]=!0;else{var Wn=pc(Dr.toString()),pa=ea.fontStack||ei,eo=q[pa]=q[pa]||{};this.calculateGlyphDependencies(ea.text,eo,wn,this.allowVerticalPlacement,Wn)}}}}}}y.get("symbol-placement")==="line"&&(this.features=function(_o){var Wa={},to={},xo=[],Yo=0;function rs(Xa){xo.push(_o[Xa]),Yo++}function Gs(Xa,Ro,vs){var da=to[Xa];return delete to[Xa],to[Ro]=da,xo[da].geometry[0].pop(),xo[da].geometry[0]=xo[da].geometry[0].concat(vs[0]),da}function ns(Xa,Ro,vs){var da=Wa[Ro];return delete Wa[Ro],Wa[Xa]=da,xo[da].geometry[0].shift(),xo[da].geometry[0]=vs[0].concat(xo[da].geometry[0]),da}function Hs(Xa,Ro,vs){var da=vs?Ro[0][Ro[0].length-1]:Ro[0][0];return Xa+":"+da.x+":"+da.y}for(var Ga=0;Ga<_o.length;Ga++){var ps=_o[Ga],Ci=ps.geometry,Fa=ps.text?ps.text.toString():null;if(Fa){var wa=Hs(Fa,Ci),fa=Hs(Fa,Ci,!0);if(wa in to&&fa in Wa&&to[wa]!==Wa[fa]){var ds=ns(wa,fa,Ci),ws=Gs(wa,fa,xo[ds].geometry);delete Wa[wa],delete to[fa],to[Hs(Fa,xo[ws].geometry,!0)]=ws,xo[ds].geometry=null}else wa in to?Gs(wa,fa,Ci):fa in Wa?ns(wa,fa,Ci):(rs(Ga),Wa[wa]=Yo-1,to[fa]=Yo-1)}else rs(Ga)}return xo.filter(function(Xa){return Xa.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(_o,Wa){return _o.sortKey-Wa.sortKey})}},De.prototype.update=function(t,o,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,o,this.layers,u),this.icon.programConfigurations.updatePaintArrays(t,o,this.layers,u))},De.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},De.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},De.prototype.upload=function(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},De.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},De.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},De.prototype.addToLineVertexArray=function(t,o){var u=this.lineVertexArray.length;if(t.segment!==void 0){for(var p=t.dist(o[t.segment+1]),y=t.dist(o[t.segment]),b={},C=t.segment+1;C<o.length;C++)b[C]={x:o[C].x,y:o[C].y,tileUnitDistanceFromAnchor:p},C<o.length-1&&(p+=o[C+1].dist(o[C]));for(var O=t.segment||0;O>=0;O--)b[O]={x:o[O].x,y:o[O].y,tileUnitDistanceFromAnchor:y},O>0&&(y+=o[O-1].dist(o[O]));for(var D=0;D<o.length;D++){var z=b[D];this.lineVertexArray.emplaceBack(z.x,z.y,z.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}},De.prototype.addSymbols=function(t,o,u,p,y,b,C,O,D,z,Z,G){for(var q=t.indexArray,ie=t.layoutVertexArray,Te=t.segments.prepareSegment(4*o.length,ie,q,this.canOverlap?b.sortKey:void 0),Oe=this.glyphOffsetArray.length,k=Te.vertexLength,Ue=this.allowVerticalPlacement&&C===Nr.vertical?Math.PI/2:0,rt=b.text&&b.text.sections,bt=0;bt<o.length;bt++){var Ut=o[bt],Gt=Ut.tl,ir=Ut.tr,Mr=Ut.bl,Dr=Ut.br,Dn=Ut.tex,cn=Ut.pixelOffsetTL,Vn=Ut.pixelOffsetBR,hn=Ut.minFontScaleX,Pi=Ut.minFontScaleY,ei=Ut.glyphOffset,wn=Ut.isSDF,ji=Ut.sectionIndex,Si=Te.vertexLength,ea=ei[1];ae(ie,O.x,O.y,Gt.x,ea+Gt.y,Dn.x,Dn.y,u,wn,cn.x,cn.y,hn,Pi),ae(ie,O.x,O.y,ir.x,ea+ir.y,Dn.x+Dn.w,Dn.y,u,wn,Vn.x,cn.y,hn,Pi),ae(ie,O.x,O.y,Mr.x,ea+Mr.y,Dn.x,Dn.y+Dn.h,u,wn,cn.x,Vn.y,hn,Pi),ae(ie,O.x,O.y,Dr.x,ea+Dr.y,Dn.x+Dn.w,Dn.y+Dn.h,u,wn,Vn.x,Vn.y,hn,Pi),Ve(t.dynamicLayoutVertexArray,O,Ue),q.emplaceBack(Si,Si+1,Si+2),q.emplaceBack(Si+1,Si+2,Si+3),Te.vertexLength+=4,Te.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ei[0]),bt!==o.length-1&&ji===o[bt+1].sectionIndex||t.programConfigurations.populatePaintArrays(ie.length,b,b.index,{},G,rt&&rt[ji])}t.placedSymbolArray.emplaceBack(O.x,O.y,Oe,this.glyphOffsetArray.length-Oe,k,D,z,O.segment,u?u[0]:0,u?u[1]:0,p[0],p[1],C,0,!1,0,Z)},De.prototype._addCollisionDebugVertex=function(t,o,u,p,y,b){return o.emplaceBack(0,0),t.emplaceBack(u.x,u.y,p,y,Math.round(b.x),Math.round(b.y))},De.prototype.addCollisionDebugVertices=function(t,o,u,p,y,b,C){var O=y.segments.prepareSegment(4,y.layoutVertexArray,y.indexArray),D=O.vertexLength,z=y.layoutVertexArray,Z=y.collisionVertexArray,G=C.anchorX,q=C.anchorY;this._addCollisionDebugVertex(z,Z,b,G,q,new de(t,o)),this._addCollisionDebugVertex(z,Z,b,G,q,new de(u,o)),this._addCollisionDebugVertex(z,Z,b,G,q,new de(u,p)),this._addCollisionDebugVertex(z,Z,b,G,q,new de(t,p)),O.vertexLength+=4;var ie=y.indexArray;ie.emplaceBack(D,D+1),ie.emplaceBack(D+1,D+2),ie.emplaceBack(D+2,D+3),ie.emplaceBack(D+3,D),O.primitiveLength+=4},De.prototype.addDebugCollisionBoxes=function(t,o,u,p){for(var y=t;y<o;y++){var b=this.collisionBoxArray.get(y);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,p?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,u)}},De.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ye(Da,yp.members,Gl),this.iconCollisionBox=new Ye(Da,yp.members,Gl);for(var t=0;t<this.symbolInstances.length;t++){var o=this.symbolInstances.get(t);this.addDebugCollisionBoxes(o.textBoxStartIndex,o.textBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.iconBoxStartIndex,o.iconBoxEndIndex,o,!1),this.addDebugCollisionBoxes(o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o,!1)}},De.prototype._deserializeCollisionBoxesForSymbol=function(t,o,u,p,y,b,C,O,D){for(var z={},Z=o;Z<u;Z++){var G=t.get(Z);z.textBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,anchorPointX:G.anchorPointX,anchorPointY:G.anchorPointY},z.textFeatureIndex=G.featureIndex;break}for(var q=p;q<y;q++){var ie=t.get(q);z.verticalTextBox={x1:ie.x1,y1:ie.y1,x2:ie.x2,y2:ie.y2,anchorPointX:ie.anchorPointX,anchorPointY:ie.anchorPointY},z.verticalTextFeatureIndex=ie.featureIndex;break}for(var Te=b;Te<C;Te++){var Oe=t.get(Te);z.iconBox={x1:Oe.x1,y1:Oe.y1,x2:Oe.x2,y2:Oe.y2,anchorPointX:Oe.anchorPointX,anchorPointY:Oe.anchorPointY},z.iconFeatureIndex=Oe.featureIndex;break}for(var k=O;k<D;k++){var Ue=t.get(k);z.verticalIconBox={x1:Ue.x1,y1:Ue.y1,x2:Ue.x2,y2:Ue.y2,anchorPointX:Ue.anchorPointX,anchorPointY:Ue.anchorPointY},z.verticalIconFeatureIndex=Ue.featureIndex;break}return z},De.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var o=0;o<this.symbolInstances.length;o++){var u=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}},De.prototype.hasTextData=function(){return this.text.segments.get().length>0},De.prototype.hasIconData=function(){return this.icon.segments.get().length>0},De.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},De.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},De.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},De.prototype.addIndicesForPlacedSymbol=function(t,o){for(var u=t.placedSymbolArray.get(o),p=u.vertexStartIndex+4*u.numGlyphs,y=u.vertexStartIndex;y<p;y+=4)t.indexArray.emplaceBack(y,y+1,y+2),t.indexArray.emplaceBack(y+1,y+2,y+3)},De.prototype.getSortedSymbolIndexes=function(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var o=Math.sin(t),u=Math.cos(t),p=[],y=[],b=[],C=0;C<this.symbolInstances.length;++C){b.push(C);var O=this.symbolInstances.get(C);p.push(0|Math.round(o*O.anchorX+u*O.anchorY)),y.push(O.featureIndex)}return b.sort(function(D,z){return p[D]-p[z]||y[z]-y[D]}),b},De.prototype.addToSortKeyRanges=function(t,o){var u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===o?u.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:t,symbolInstanceEnd:t+1})},De.prototype.sortFeatures=function(t){var o=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var u=0,p=this.symbolInstanceIndexes;u<p.length;u+=1){var y=this.symbolInstances.get(p[u]);this.featureSortOrder.push(y.featureIndex),[y.rightJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.leftJustifiedTextSymbolIndex].forEach(function(b,C,O){b>=0&&O.indexOf(b)===C&&o.addIndicesForPlacedSymbol(o.text,b)}),y.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,y.verticalPlacedTextSymbolIndex),y.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,y.placedIconSymbolIndex),y.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,y.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},vn("SymbolBucket",De,{omit:["layers","collisionBoxArray","features","compareText"]}),De.MAX_GLYPHS=65535,De.addDynamicAttributes=Ve;var Je=new Ho({"symbol-placement":new In(se.layout_symbol["symbol-placement"]),"symbol-spacing":new In(se.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new In(se.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Cn(se.layout_symbol["symbol-sort-key"]),"symbol-z-order":new In(se.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new In(se.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new In(se.layout_symbol["icon-ignore-placement"]),"icon-optional":new In(se.layout_symbol["icon-optional"]),"icon-rotation-alignment":new In(se.layout_symbol["icon-rotation-alignment"]),"icon-size":new Cn(se.layout_symbol["icon-size"]),"icon-text-fit":new In(se.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new In(se.layout_symbol["icon-text-fit-padding"]),"icon-image":new Cn(se.layout_symbol["icon-image"]),"icon-rotate":new Cn(se.layout_symbol["icon-rotate"]),"icon-padding":new In(se.layout_symbol["icon-padding"]),"icon-keep-upright":new In(se.layout_symbol["icon-keep-upright"]),"icon-offset":new Cn(se.layout_symbol["icon-offset"]),"icon-anchor":new Cn(se.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new In(se.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new In(se.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new In(se.layout_symbol["text-rotation-alignment"]),"text-field":new Cn(se.layout_symbol["text-field"]),"text-font":new Cn(se.layout_symbol["text-font"]),"text-size":new Cn(se.layout_symbol["text-size"]),"text-max-width":new Cn(se.layout_symbol["text-max-width"]),"text-line-height":new In(se.layout_symbol["text-line-height"]),"text-letter-spacing":new Cn(se.layout_symbol["text-letter-spacing"]),"text-justify":new Cn(se.layout_symbol["text-justify"]),"text-radial-offset":new Cn(se.layout_symbol["text-radial-offset"]),"text-variable-anchor":new In(se.layout_symbol["text-variable-anchor"]),"text-anchor":new Cn(se.layout_symbol["text-anchor"]),"text-max-angle":new In(se.layout_symbol["text-max-angle"]),"text-writing-mode":new In(se.layout_symbol["text-writing-mode"]),"text-rotate":new Cn(se.layout_symbol["text-rotate"]),"text-padding":new In(se.layout_symbol["text-padding"]),"text-keep-upright":new In(se.layout_symbol["text-keep-upright"]),"text-transform":new Cn(se.layout_symbol["text-transform"]),"text-offset":new Cn(se.layout_symbol["text-offset"]),"text-allow-overlap":new In(se.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new In(se.layout_symbol["text-ignore-placement"]),"text-optional":new In(se.layout_symbol["text-optional"])}),ve={paint:new Ho({"icon-opacity":new Cn(se.paint_symbol["icon-opacity"]),"icon-color":new Cn(se.paint_symbol["icon-color"]),"icon-halo-color":new Cn(se.paint_symbol["icon-halo-color"]),"icon-halo-width":new Cn(se.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Cn(se.paint_symbol["icon-halo-blur"]),"icon-translate":new In(se.paint_symbol["icon-translate"]),"icon-translate-anchor":new In(se.paint_symbol["icon-translate-anchor"]),"text-opacity":new Cn(se.paint_symbol["text-opacity"]),"text-color":new Cn(se.paint_symbol["text-color"],{runtimeType:Wr,getOverride:function(t){return t.textColor},hasOverride:function(t){return!!t.textColor}}),"text-halo-color":new Cn(se.paint_symbol["text-halo-color"]),"text-halo-width":new Cn(se.paint_symbol["text-halo-width"]),"text-halo-blur":new Cn(se.paint_symbol["text-halo-blur"]),"text-translate":new In(se.paint_symbol["text-translate"]),"text-translate-anchor":new In(se.paint_symbol["text-translate-anchor"])}),layout:Je},Ze=function(t){this.type=t.property.overrides?t.property.overrides.runtimeType:fn,this.defaultValue=t};Ze.prototype.evaluate=function(t){if(t.formattedSection){var o=this.defaultValue.property.overrides;if(o&&o.hasOverride(t.formattedSection))return o.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default},Ze.prototype.eachChild=function(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)},Ze.prototype.outputDefined=function(){return!1},Ze.prototype.serialize=function(){return null},vn("FormatSectionOverride",Ze,{omit:["defaultValue"]});var Ae=function(t){function o(u){t.call(this,u,ve)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.recalculate=function(u,p){if(t.prototype.recalculate.call(this,u,p),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var y=this.layout.get("text-writing-mode");if(y){for(var b=[],C=0,O=y;C<O.length;C+=1){var D=O[C];b.indexOf(D)<0&&b.push(D)}this.layout._values["text-writing-mode"]=b}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},o.prototype.getValueAndResolveTokens=function(u,p,y,b){var C=this.layout.get(u).evaluate(p,{},y,b),O=this._unevaluatedLayout._values[u];return O.isDataDriven()||oc(O.value)||!C?C:function(D,z){return z.replace(/{([^{}]+)}/g,function(Z,G){return G in D?String(D[G]):""})}(p.properties,C)},o.prototype.createBucket=function(u){return new De(u)},o.prototype.queryRadius=function(){return 0},o.prototype.queryIntersectsFeature=function(){return!1},o.prototype._setPaintOverrides=function(){for(var u=0,p=ve.paint.overridableProperties;u<p.length;u+=1){var y=p[u];if(o.hasPaintOverride(this.layout,y)){var b,C=this.paint.get(y),O=new Ze(C),D=new Uc(O,C.property.specification);b=C.value.kind==="constant"||C.value.kind==="source"?new Ll("source",D):new fl("composite",D,C.value.zoomStops,C.value._interpolationType),this.paint._values[y]=new As(C.property,b,C.parameters)}}},o.prototype._handleOverridablePaintPropertyUpdate=function(u,p,y){return!(!this.layout||p.isDataDriven()||y.isDataDriven())&&o.hasPaintOverride(this.layout,u)},o.hasPaintOverride=function(u,p){var y=u.get("text-field"),b=ve.paint.properties[p],C=!1,O=function(Z){for(var G=0,q=Z;G<q.length;G+=1)if(b.overrides&&b.overrides.hasOverride(q[G]))return void(C=!0)};if(y.value.kind==="constant"&&y.value.value instanceof gt)O(y.value.value.sections);else if(y.value.kind==="source"){var D=function(Z){C||(Z instanceof za&&ta(Z.value)===Wi?O(Z.value.sections):Z instanceof Ao?O(Z.sections):Z.eachChild(D))},z=y.value;z._styleExpression&&D(z._styleExpression.expression)}return C},o}(gu),st={paint:new Ho({"background-color":new In(se.paint_background["background-color"]),"background-pattern":new Qo(se.paint_background["background-pattern"]),"background-opacity":new In(se.paint_background["background-opacity"])})},At=function(t){function o(u){t.call(this,u,st)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(gu),cr={paint:new Ho({"raster-opacity":new In(se.paint_raster["raster-opacity"]),"raster-hue-rotate":new In(se.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new In(se.paint_raster["raster-brightness-min"]),"raster-brightness-max":new In(se.paint_raster["raster-brightness-max"]),"raster-saturation":new In(se.paint_raster["raster-saturation"]),"raster-contrast":new In(se.paint_raster["raster-contrast"]),"raster-resampling":new In(se.paint_raster["raster-resampling"]),"raster-fade-duration":new In(se.paint_raster["raster-fade-duration"])})},zr=function(t){function o(u){t.call(this,u,cr)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(gu),Ur=function(t){function o(u){t.call(this,u,{}),this.implementation=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},o.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},o.prototype.recalculate=function(){},o.prototype.updateTransitions=function(){},o.prototype.hasTransition=function(){},o.prototype.serialize=function(){},o.prototype.onAdd=function(u){this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},o.prototype.onRemove=function(u){this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},o}(gu),nn={circle:Pf,heatmap:kh,hillshade:pp,fill:uh,"fill-extrusion":rl,line:nd,symbol:Ae,background:At,raster:zr},Lr=_e.HTMLImageElement,An=_e.HTMLCanvasElement,un=_e.HTMLVideoElement,En=_e.ImageData,bn=_e.ImageBitmap,ln=function(t,o,u,p){this.context=t,this.format=u,this.texture=t.gl.createTexture(),this.update(o,p)};ln.prototype.update=function(t,o,u){var p=t.width,y=t.height,b=!(this.size&&this.size[0]===p&&this.size[1]===y||u),C=this.context,O=C.gl;if(this.useMipmap=Boolean(o&&o.useMipmap),O.bindTexture(O.TEXTURE_2D,this.texture),C.pixelStoreUnpackFlipY.set(!1),C.pixelStoreUnpack.set(1),C.pixelStoreUnpackPremultiplyAlpha.set(this.format===O.RGBA&&(!o||o.premultiply!==!1)),b)this.size=[p,y],t instanceof Lr||t instanceof An||t instanceof un||t instanceof En||bn&&t instanceof bn?O.texImage2D(O.TEXTURE_2D,0,this.format,this.format,O.UNSIGNED_BYTE,t):O.texImage2D(O.TEXTURE_2D,0,this.format,p,y,0,this.format,O.UNSIGNED_BYTE,t.data);else{var D=u||{x:0,y:0},z=D.x,Z=D.y;t instanceof Lr||t instanceof An||t instanceof un||t instanceof En||bn&&t instanceof bn?O.texSubImage2D(O.TEXTURE_2D,0,z,Z,O.RGBA,O.UNSIGNED_BYTE,t):O.texSubImage2D(O.TEXTURE_2D,0,z,Z,p,y,O.RGBA,O.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&O.generateMipmap(O.TEXTURE_2D)},ln.prototype.bind=function(t,o,u){var p=this.context.gl;p.bindTexture(p.TEXTURE_2D,this.texture),u!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=p.LINEAR),t!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,t),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,u||t),this.filter=t),o!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,o),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,o),this.wrap=o)},ln.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},ln.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Jn=function(t){var o=this;this._callback=t,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){o._triggered=!1,o._callback()})};Jn.prototype.trigger=function(){var t=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){t._triggered=!1,t._callback()},0))},Jn.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Sa=function(t,o,u){this.target=t,this.parent=o,this.mapId=u,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},$t(["receive","process"],this),this.invoker=new Jn(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Fr()?t:_e};function fs(t,o,u){var p=2*Math.PI*6378137/256/Math.pow(2,u);return[t*p-2*Math.PI*6378137/2,o*p-2*Math.PI*6378137/2]}Sa.prototype.send=function(t,o,u,p,y){var b=this;y===void 0&&(y=!1);var C=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(this.callbacks[C]=u);var O=Se(this.globalScope)?void 0:[];return this.target.postMessage({id:C,type:t,hasCallback:!!u,targetMapId:p,mustQueue:y,sourceMapId:this.mapId,data:Qs(o,O)},O),{cancel:function(){u&&delete b.callbacks[C],b.target.postMessage({id:C,type:"<cancel>",targetMapId:p,sourceMapId:b.mapId})}}},Sa.prototype.receive=function(t){var o=t.data,u=o.id;if(u&&(!o.targetMapId||this.mapId===o.targetMapId))if(o.type==="<cancel>"){delete this.tasks[u];var p=this.cancelCallbacks[u];delete this.cancelCallbacks[u],p&&p()}else Fr()||o.mustQueue?(this.tasks[u]=o,this.taskQueue.push(u),this.invoker.trigger()):this.processTask(u,o)},Sa.prototype.process=function(){if(this.taskQueue.length){var t=this.taskQueue.shift(),o=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),o&&this.processTask(t,o)}},Sa.prototype.processTask=function(t,o){var u=this;if(o.type==="<response>"){var p=this.callbacks[t];delete this.callbacks[t],p&&(o.error?p(Os(o.error)):p(null,Os(o.data)))}else{var y=!1,b=Se(this.globalScope)?void 0:[],C=o.hasCallback?function(Z,G){y=!0,delete u.cancelCallbacks[t],u.target.postMessage({id:t,type:"<response>",sourceMapId:u.mapId,error:Z?Qs(Z):null,data:Qs(G,b)},b)}:function(Z){y=!0},O=null,D=Os(o.data);if(this.parent[o.type])O=this.parent[o.type](o.sourceMapId,D,C);else if(this.parent.getWorkerSource){var z=o.type.split(".");O=this.parent.getWorkerSource(o.sourceMapId,z[0],D.source)[z[1]](D,C)}else C(new Error("Could not find function "+o.type));!y&&O&&O.cancel&&(this.cancelCallbacks[t]=O.cancel)}},Sa.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Va=function(t,o){t&&(o?this.setSouthWest(t).setNorthEast(o):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};Va.prototype.setNorthEast=function(t){return this._ne=t instanceof _a?new _a(t.lng,t.lat):_a.convert(t),this},Va.prototype.setSouthWest=function(t){return this._sw=t instanceof _a?new _a(t.lng,t.lat):_a.convert(t),this},Va.prototype.extend=function(t){var o,u,p=this._sw,y=this._ne;if(t instanceof _a)o=t,u=t;else{if(!(t instanceof Va))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Va.convert(t)):this.extend(_a.convert(t)):this;if(u=t._ne,!(o=t._sw)||!u)return this}return p||y?(p.lng=Math.min(o.lng,p.lng),p.lat=Math.min(o.lat,p.lat),y.lng=Math.max(u.lng,y.lng),y.lat=Math.max(u.lat,y.lat)):(this._sw=new _a(o.lng,o.lat),this._ne=new _a(u.lng,u.lat)),this},Va.prototype.getCenter=function(){return new _a((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Va.prototype.getSouthWest=function(){return this._sw},Va.prototype.getNorthEast=function(){return this._ne},Va.prototype.getNorthWest=function(){return new _a(this.getWest(),this.getNorth())},Va.prototype.getSouthEast=function(){return new _a(this.getEast(),this.getSouth())},Va.prototype.getWest=function(){return this._sw.lng},Va.prototype.getSouth=function(){return this._sw.lat},Va.prototype.getEast=function(){return this._ne.lng},Va.prototype.getNorth=function(){return this._ne.lat},Va.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Va.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Va.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Va.prototype.contains=function(t){var o=_a.convert(t),u=o.lng,p=o.lat,y=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(y=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&y},Va.convert=function(t){return!t||t instanceof Va?t:new Va(t)};var _a=function(t,o){if(isNaN(t)||isNaN(o))throw new Error("Invalid LngLat object: ("+t+", "+o+")");if(this.lng=+t,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};_a.prototype.wrap=function(){return new _a(or(this.lng,-180,180),this.lat)},_a.prototype.toArray=function(){return[this.lng,this.lat]},_a.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},_a.prototype.distanceTo=function(t){var o=Math.PI/180,u=this.lat*o,p=t.lat*o,y=Math.sin(u)*Math.sin(p)+Math.cos(u)*Math.cos(p)*Math.cos((t.lng-this.lng)*o);return 63710088e-1*Math.acos(Math.min(y,1))},_a.prototype.toBounds=function(t){t===void 0&&(t=0);var o=360*t/40075017,u=o/Math.cos(Math.PI/180*this.lat);return new Va(new _a(this.lng-u,this.lat-o),new _a(this.lng+u,this.lat+o))},_a.convert=function(t){if(t instanceof _a)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new _a(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new _a(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Ql=2*Math.PI*63710088e-1;function Vs(t){return Ql*Math.cos(t*Math.PI/180)}function wl(t){return(180+t)/360}function ju(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function ad(t,o){return t/Vs(o)}function Vu(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}var uf=function(t,o,u){u===void 0&&(u=0),this.x=+t,this.y=+o,this.z=+u};uf.fromLngLat=function(t,o){o===void 0&&(o=0);var u=_a.convert(t);return new uf(wl(u.lng),ju(u.lat),ad(o,u.lat))},uf.prototype.toLngLat=function(){return new _a(360*this.x-180,Vu(this.y))},uf.prototype.toAltitude=function(){return this.z*Vs(Vu(this.y))},uf.prototype.meterInMercatorCoordinateUnits=function(){return 1/Ql*(t=Vu(this.y),1/Math.cos(t*Math.PI/180));var t};var Hh=function(t,o,u){this.z=t,this.x=o,this.y=u,this.key=Wh(0,t,t,o,u)};Hh.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},Hh.prototype.url=function(t,o){var u,p,y,b,C,O=(p=this.y,y=this.z,b=fs(256*(u=this.x),256*(p=Math.pow(2,y)-p-1),y),C=fs(256*(u+1),256*(p+1),y),b[0]+","+b[1]+","+C[0]+","+C[1]),D=function(z,Z,G){for(var q,ie="",Te=z;Te>0;Te--)ie+=(Z&(q=1<<Te-1)?1:0)+(G&q?2:0);return ie}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",D).replace("{bbox-epsg-3857}",O)},Hh.prototype.getTilePoint=function(t){var o=Math.pow(2,this.z);return new de(8192*(t.x*o-this.x),8192*(t.y*o-this.y))},Hh.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var od=function(t,o){this.wrap=t,this.canonical=o,this.key=Wh(t,o.z,o.z,o.x,o.y)},Xo=function(t,o,u,p,y){this.overscaledZ=t,this.wrap=o,this.canonical=new Hh(u,+p,+y),this.key=Wh(o,t,u,p,y)};function Wh(t,o,u,p,y){(t*=2)<0&&(t=-1*t-1);var b=1<<u;return(b*b*t+b*y+p).toString(36)+u.toString(36)+o.toString(36)}Xo.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},Xo.prototype.scaledTo=function(t){var o=this.canonical.z-t;return t>this.canonical.z?new Xo(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Xo(t,this.wrap,t,this.canonical.x>>o,this.canonical.y>>o)},Xo.prototype.calculateScaledKey=function(t,o){var u=this.canonical.z-t;return t>this.canonical.z?Wh(this.wrap*+o,t,this.canonical.z,this.canonical.x,this.canonical.y):Wh(this.wrap*+o,t,t,this.canonical.x>>u,this.canonical.y>>u)},Xo.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var o=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>o&&t.canonical.y===this.canonical.y>>o},Xo.prototype.children=function(t){if(this.overscaledZ>=t)return[new Xo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var o=this.canonical.z+1,u=2*this.canonical.x,p=2*this.canonical.y;return[new Xo(o,this.wrap,o,u,p),new Xo(o,this.wrap,o,u+1,p),new Xo(o,this.wrap,o,u,p+1),new Xo(o,this.wrap,o,u+1,p+1)]},Xo.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},Xo.prototype.wrapped=function(){return new Xo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Xo.prototype.unwrapTo=function(t){return new Xo(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},Xo.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Xo.prototype.toUnwrapped=function(){return new od(this.wrap,this.canonical)},Xo.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Xo.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new uf(t.x-this.wrap,t.y))},vn("CanonicalTileID",Hh),vn("OverscaledTileID",Xo,{omit:["posMatrix"]});var Ec=function(t,o,u){if(this.uid=t,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return $e('"'+u+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=o.height;var p=this.dim=o.height-2;this.data=new Uint32Array(o.data.buffer),this.encoding=u||"mapbox";for(var y=0;y<p;y++)this.data[this._idx(-1,y)]=this.data[this._idx(0,y)],this.data[this._idx(p,y)]=this.data[this._idx(p-1,y)],this.data[this._idx(y,-1)]=this.data[this._idx(y,0)],this.data[this._idx(y,p)]=this.data[this._idx(y,p-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(p,-1)]=this.data[this._idx(p-1,0)],this.data[this._idx(-1,p)]=this.data[this._idx(0,p-1)],this.data[this._idx(p,p)]=this.data[this._idx(p-1,p-1)]};Ec.prototype.get=function(t,o){var u=new Uint8Array(this.data.buffer),p=4*this._idx(t,o);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(u[p],u[p+1],u[p+2])},Ec.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Ec.prototype._idx=function(t,o){if(t<-1||t>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(t+1)},Ec.prototype._unpackMapbox=function(t,o,u){return(256*t*256+256*o+u)/10-1e4},Ec.prototype._unpackTerrarium=function(t,o,u){return 256*t+o+u/256-32768},Ec.prototype.getPixels=function(){return new Bo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Ec.prototype.backfillBorder=function(t,o,u){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var p=o*this.dim,y=o*this.dim+this.dim,b=u*this.dim,C=u*this.dim+this.dim;switch(o){case-1:p=y-1;break;case 1:y=p+1}switch(u){case-1:b=C-1;break;case 1:C=b+1}for(var O=-o*this.dim,D=-u*this.dim,z=b;z<C;z++)for(var Z=p;Z<y;Z++)this.data[this._idx(Z,z)]=t.data[this._idx(Z+O,z+D)]},vn("DEMData",Ec);var Jl=function(t){this._stringToNumber={},this._numberToString=[];for(var o=0;o<t.length;o++){var u=t[o];this._stringToNumber[u]=o,this._numberToString[o]=u}};Jl.prototype.encode=function(t){return this._stringToNumber[t]},Jl.prototype.decode=function(t){return this._numberToString[t]};var Sc=function(t,o,u,p,y){this.type="Feature",this._vectorTileFeature=t,t._z=o,t._x=u,t._y=p,this.properties=t.properties,this.id=y},sd={geometry:{configurable:!0}};sd.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},sd.geometry.set=function(t){this._geometry=t},Sc.prototype.toJSON=function(){var t={geometry:this.geometry};for(var o in this)o!=="_geometry"&&o!=="_vectorTileFeature"&&(t[o]=this[o]);return t},Object.defineProperties(Sc.prototype,sd);var hh=function(){this.state={},this.stateChanges={},this.deletedStates={}};hh.prototype.updateState=function(t,o,u){var p=String(o);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][p]=this.stateChanges[t][p]||{},Tt(this.stateChanges[t][p],u),this.deletedStates[t]===null)for(var y in this.deletedStates[t]={},this.state[t])y!==p&&(this.deletedStates[t][y]=null);else if(this.deletedStates[t]&&this.deletedStates[t][p]===null)for(var b in this.deletedStates[t][p]={},this.state[t][p])u[b]||(this.deletedStates[t][p][b]=null);else for(var C in u)this.deletedStates[t]&&this.deletedStates[t][p]&&this.deletedStates[t][p][C]===null&&delete this.deletedStates[t][p][C]},hh.prototype.removeFeatureState=function(t,o,u){if(this.deletedStates[t]!==null){var p=String(o);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&o!==void 0)this.deletedStates[t][p]!==null&&(this.deletedStates[t][p]=this.deletedStates[t][p]||{},this.deletedStates[t][p][u]=null);else if(o!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][p])for(u in this.deletedStates[t][p]={},this.stateChanges[t][p])this.deletedStates[t][p][u]=null;else this.deletedStates[t][p]=null;else this.deletedStates[t]=null}},hh.prototype.getState=function(t,o){var u=String(o),p=Tt({},(this.state[t]||{})[u],(this.stateChanges[t]||{})[u]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){var y=this.deletedStates[t][o];if(y===null)return{};for(var b in y)delete p[b]}return p},hh.prototype.initializeTileState=function(t,o){t.setFeatureState(this.state,o)},hh.prototype.coalesceChanges=function(t,o){var u={};for(var p in this.stateChanges){this.state[p]=this.state[p]||{};var y={};for(var b in this.stateChanges[p])this.state[p][b]||(this.state[p][b]={}),Tt(this.state[p][b],this.stateChanges[p][b]),y[b]=this.state[p][b];u[p]=y}for(var C in this.deletedStates){this.state[C]=this.state[C]||{};var O={};if(this.deletedStates[C]===null)for(var D in this.state[C])O[D]={},this.state[C][D]={};else for(var z in this.deletedStates[C]){if(this.deletedStates[C][z]===null)this.state[C][z]={};else for(var Z=0,G=Object.keys(this.deletedStates[C][z]);Z<G.length;Z+=1)delete this.state[C][z][G[Z]];O[z]=this.state[C][z]}u[C]=u[C]||{},Tt(u[C],O)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(var q in t)t[q].setFeatureState(u,o)};var Cc=function(t,o){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Ru(8192,16,0),this.grid3D=new Ru(8192,16,0),this.featureIndexArray=new H,this.promoteId=o};function ud(t,o,u,p,y){return Xt(t,function(b,C){var O=o instanceof Eu?o.get(C):null;return O&&O.evaluate?O.evaluate(u,p,y):O})}function Bd(t){for(var o=1/0,u=1/0,p=-1/0,y=-1/0,b=0,C=t;b<C.length;b+=1){var O=C[b];o=Math.min(o,O.x),u=Math.min(u,O.y),p=Math.max(p,O.x),y=Math.max(y,O.y)}return{minX:o,minY:u,maxX:p,maxY:y}}function S0(t,o){return o-t}Cc.prototype.insert=function(t,o,u,p,y,b){var C=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,p,y);for(var O=b?this.grid3D:this.grid,D=0;D<o.length;D++){for(var z=o[D],Z=[1/0,1/0,-1/0,-1/0],G=0;G<z.length;G++){var q=z[G];Z[0]=Math.min(Z[0],q.x),Z[1]=Math.min(Z[1],q.y),Z[2]=Math.max(Z[2],q.x),Z[3]=Math.max(Z[3],q.y)}Z[0]<8192&&Z[1]<8192&&Z[2]>=0&&Z[3]>=0&&O.insert(C,Z[0],Z[1],Z[2],Z[3])}},Cc.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Cu.VectorTile(new sf(this.rawTileData)).layers,this.sourceLayerCoder=new Jl(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Cc.prototype.query=function(t,o,u,p){var y=this;this.loadVTLayers();for(var b=t.params||{},C=8192/t.tileSize/t.scale,O=Fl(b.filter),D=t.queryGeometry,z=t.queryPadding*C,Z=Bd(D),G=this.grid.query(Z.minX-z,Z.minY-z,Z.maxX+z,Z.maxY+z),q=Bd(t.cameraQueryGeometry),ie=this.grid3D.query(q.minX-z,q.minY-z,q.maxX+z,q.maxY+z,function(Ut,Gt,ir,Mr){return function(Dr,Dn,cn,Vn,hn){for(var Pi=0,ei=Dr;Pi<ei.length;Pi+=1){var wn=ei[Pi];if(Dn<=wn.x&&cn<=wn.y&&Vn>=wn.x&&hn>=wn.y)return!0}var ji=[new de(Dn,cn),new de(Dn,hn),new de(Vn,hn),new de(Vn,cn)];if(Dr.length>2){for(var Si=0,ea=ji;Si<ea.length;Si+=1)if(iu(Dr,ea[Si]))return!0}for(var Wn=0;Wn<Dr.length-1;Wn++)if(xl(Dr[Wn],Dr[Wn+1],ji))return!0;return!1}(t.cameraQueryGeometry,Ut-z,Gt-z,ir+z,Mr+z)}),Te=0,Oe=ie;Te<Oe.length;Te+=1)G.push(Oe[Te]);G.sort(S0);for(var k,Ue={},rt=function(Ut){var Gt=G[Ut];if(Gt!==k){k=Gt;var ir=y.featureIndexArray.get(Gt),Mr=null;y.loadMatchingFeature(Ue,ir.bucketIndex,ir.sourceLayerIndex,ir.featureIndex,O,b.layers,b.availableImages,o,u,p,function(Dr,Dn,cn){return Mr||(Mr=Ha(Dr)),Dn.queryIntersectsFeature(D,Dr,cn,Mr,y.z,t.transform,C,t.pixelPosMatrix)})}},bt=0;bt<G.length;bt++)rt(bt);return Ue},Cc.prototype.loadMatchingFeature=function(t,o,u,p,y,b,C,O,D,z,Z){var G=this.bucketLayerIDs[o];if(!b||function(Dr,Dn){for(var cn=0;cn<Dr.length;cn++)if(Dn.indexOf(Dr[cn])>=0)return!0;return!1}(b,G)){var q=this.sourceLayerCoder.decode(u),ie=this.vtLayers[q].feature(p);if(y.needGeometry){var Te=ho(ie,!0);if(!y.filter(new Ai(this.tileID.overscaledZ),Te,this.tileID.canonical))return}else if(!y.filter(new Ai(this.tileID.overscaledZ),ie))return;for(var Oe=this.getId(ie,q),k=0;k<G.length;k++){var Ue=G[k];if(!(b&&b.indexOf(Ue)<0)){var rt=O[Ue];if(rt){var bt={};Oe!==void 0&&z&&(bt=z.getState(rt.sourceLayer||"_geojsonTileLayer",Oe));var Ut=Tt({},D[Ue]);Ut.paint=ud(Ut.paint,rt.paint,ie,bt,C),Ut.layout=ud(Ut.layout,rt.layout,ie,bt,C);var Gt=!Z||Z(ie,rt,bt);if(Gt){var ir=new Sc(ie,this.z,this.x,this.y,Oe);ir.layer=Ut;var Mr=t[Ue];Mr===void 0&&(Mr=t[Ue]=[]),Mr.push({featureIndex:p,feature:ir,intersectionZ:Gt})}}}}}},Cc.prototype.lookupSymbolFeatures=function(t,o,u,p,y,b,C,O){var D={};this.loadVTLayers();for(var z=Fl(y),Z=0,G=t;Z<G.length;Z+=1)this.loadMatchingFeature(D,u,p,G[Z],z,b,C,O,o);return D},Cc.prototype.hasLayer=function(t){for(var o=0,u=this.bucketLayerIDs;o<u.length;o+=1)for(var p=0,y=u[o];p<y.length;p+=1)if(t===y[p])return!0;return!1},Cc.prototype.getId=function(t,o){var u=t.id;return this.promoteId&&typeof(u=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[o]])=="boolean"&&(u=Number(u)),u},vn("FeatureIndex",Cc,{omit:["rawTileData","sourceLayerCoder"]});var hs=function(t,o){this.tileID=t,this.uid=_t(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};hs.prototype.registerFadeDuration=function(t){var o=t+this.timeAdded;o<Nn.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)},hs.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},hs.prototype.loadVectorData=function(t,o,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var p in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(z,Z){var G={};if(!Z)return G;for(var q=function(){var Oe=Te[ie],k=Oe.layerIds.map(function(bt){return Z.getLayer(bt)}).filter(Boolean);if(k.length!==0){Oe.layers=k,Oe.stateDependentLayerIds&&(Oe.stateDependentLayers=Oe.stateDependentLayerIds.map(function(bt){return k.filter(function(Ut){return Ut.id===bt})[0]}));for(var Ue=0,rt=k;Ue<rt.length;Ue+=1)G[rt[Ue].id]=Oe}},ie=0,Te=z;ie<Te.length;ie+=1)q();return G}(t.buckets,o.style),this.hasSymbolBuckets=!1,this.buckets){var y=this.buckets[p];if(y instanceof De){if(this.hasSymbolBuckets=!0,!u)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var b in this.buckets){var C=this.buckets[b];if(C instanceof De&&C.hasRTLText){this.hasRTLText=!0,Is.isLoading()||Is.isLoaded()||Mf()!=="deferred"||vu();break}}for(var O in this.queryPadding=0,this.buckets){var D=this.buckets[O];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(O).queryRadius(D))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new h},hs.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},hs.prototype.getBucket=function(t){return this.buckets[t.id]},hs.prototype.upload=function(t){for(var o in this.buckets){var u=this.buckets[o];u.uploadPending()&&u.upload(t)}var p=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ln(t,this.imageAtlas.image,p.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ln(t,this.glyphAtlasImage,p.ALPHA),this.glyphAtlasImage=null)},hs.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},hs.prototype.queryRenderedFeatures=function(t,o,u,p,y,b,C,O,D,z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:y,scale:b,tileSize:this.tileSize,pixelPosMatrix:z,transform:O,params:C,queryPadding:this.queryPadding*D},t,o,u):{}},hs.prototype.querySourceFeatures=function(t,o){var u=this.latestFeatureIndex;if(u&&u.rawTileData){var p=u.loadVTLayers(),y=o?o.sourceLayer:"",b=p._geojsonTileLayer||p[y];if(b)for(var C=Fl(o&&o.filter),O=this.tileID.canonical,D=O.z,z=O.x,Z=O.y,G={z:D,x:z,y:Z},q=0;q<b.length;q++){var ie=b.feature(q);if(C.needGeometry){var Te=ho(ie,!0);if(!C.filter(new Ai(this.tileID.overscaledZ),Te,this.tileID.canonical))continue}else if(!C.filter(new Ai(this.tileID.overscaledZ),ie))continue;var Oe=u.getId(ie,y),k=new Sc(ie,D,z,Z,Oe);k.tile=G,t.push(k)}}},hs.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},hs.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},hs.prototype.setExpiryData=function(t){var o=this.expirationTime;if(t.cacheControl){var u=Yr(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var p=Date.now(),y=!1;if(this.expirationTime>p)y=!1;else if(o)if(this.expirationTime<o)y=!0;else{var b=this.expirationTime-o;b?this.expirationTime=p+Math.max(b,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},hs.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},hs.prototype.setFeatureState=function(t,o){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(t).length!==0){var u=this.latestFeatureIndex.loadVTLayers();for(var p in this.buckets)if(o.style.hasLayer(p)){var y=this.buckets[p],b=y.layers[0].sourceLayer||"_geojsonTileLayer",C=u[b],O=t[b];if(C&&O&&Object.keys(O).length!==0){y.update(O,C,this.imageAtlas&&this.imageAtlas.patternPositions||{});var D=o&&o.style&&o.style.getLayer(p);D&&(this.queryPadding=Math.max(this.queryPadding,D.queryRadius(y)))}}}},hs.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},hs.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Nn.now()},hs.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},hs.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=Nn.now()+t},hs.prototype.setDependencies=function(t,o){for(var u={},p=0,y=o;p<y.length;p+=1)u[y[p]]=!0;this.dependencies[t]=u},hs.prototype.hasDependency=function(t,o){for(var u=0,p=t;u<p.length;u+=1){var y=this.dependencies[p[u]];if(y){for(var b=0,C=o;b<C.length;b+=1)if(y[C[b]])return!0}}return!1};var Bf=_e.performance,Xh=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},Bf.mark(this._marks.start)};Xh.prototype.finish=function(){Bf.mark(this._marks.end);var t=Bf.getEntriesByName(this._marks.measure);return t.length===0&&(Bf.measure(this._marks.measure,this._marks.start,this._marks.end),t=Bf.getEntriesByName(this._marks.measure),Bf.clearMarks(this._marks.start),Bf.clearMarks(this._marks.end),Bf.clearMeasures(this._marks.measure)),t},g.Actor=Sa,g.AlphaImage=su,g.CanonicalTileID=Hh,g.CollisionBoxArray=h,g.Color=Zi,g.DEMData=Ec,g.DataConstantProperty=In,g.DictionaryCoder=Jl,g.EXTENT=8192,g.ErrorEvent=Ge,g.EvaluationParameters=Ai,g.Event=Me,g.Evented=Qe,g.FeatureIndex=Cc,g.FillBucket=Zs,g.FillExtrusionBucket=Zu,g.ImageAtlas=br,g.ImagePosition=nt,g.LineBucket=qi,g.LngLat=_a,g.LngLatBounds=Va,g.MercatorCoordinate=uf,g.ONE_EM=24,g.OverscaledTileID=Xo,g.Point=de,g.Point$1=de,g.Properties=Ho,g.Protobuf=sf,g.RGBAImage=Bo,g.RequestManager=Ui,g.RequestPerformance=Xh,g.ResourceType=Sn,g.SegmentVector=ue,g.SourceFeatureState=hh,g.StructArrayLayout1ui2=Qf,g.StructArrayLayout2f1f2i16=tu,g.StructArrayLayout2i4=dc,g.StructArrayLayout3ui6=ml,g.StructArrayLayout4i8=Ns,g.SymbolBucket=De,g.Texture=ln,g.Tile=hs,g.Transitionable=Go,g.Uniform1f=kr,g.Uniform1i=pr,g.Uniform2f=_r,g.Uniform3f=sn,g.Uniform4f=Zn,g.UniformColor=jn,g.UniformMatrix4f=ki,g.UnwrappedTileID=od,g.ValidationError=Le,g.WritingMode=Nr,g.ZoomHistory=Af,g.add=function(t,o,u){return t[0]=o[0]+u[0],t[1]=o[1]+u[1],t[2]=o[2]+u[2],t},g.addDynamicAttributes=Ve,g.asyncAll=function(t,o,u){if(!t.length)return u(null,[]);var p=t.length,y=new Array(t.length),b=null;t.forEach(function(C,O){o(C,function(D,z){D&&(b=D),y[O]=z,--p==0&&u(b,y)})})},g.bezier=mt,g.bindAll=$t,g.browser=Nn,g.cacheEntryPossiblyAdded=function(t){++bi>Rr&&(t.getActor().send("enforceCacheSizeLimit",er),bi=0)},g.clamp=Nt,g.clearTileCache=function(t){var o=_e.caches.delete("mapbox-tiles");t&&o.catch(t).then(function(){return t()})},g.clipLine=So,g.clone=function(t){var o=new ca(16);return o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15],o},g.clone$1=qe,g.clone$2=function(t){var o=new ca(3);return o[0]=t[0],o[1]=t[1],o[2]=t[2],o},g.collisionCircleLayout=Al,g.config=yn,g.create=function(){var t=new ca(16);return ca!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},g.create$1=function(){var t=new ca(9);return ca!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},g.create$2=function(){var t=new ca(4);return ca!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},g.createCommonjsModule=Re,g.createExpression=sc,g.createLayout=La,g.createStyleLayer=function(t){return t.type==="custom"?new Ur(t):new nn[t.type](t)},g.cross=function(t,o,u){var p=o[0],y=o[1],b=o[2],C=u[0],O=u[1],D=u[2];return t[0]=y*D-b*O,t[1]=b*C-p*D,t[2]=p*O-y*C,t},g.deepEqual=function t(o,u){if(Array.isArray(o)){if(!Array.isArray(u)||o.length!==u.length)return!1;for(var p=0;p<o.length;p++)if(!t(o[p],u[p]))return!1;return!0}if(typeof o=="object"&&o!==null&&u!==null){if(typeof u!="object"||Object.keys(o).length!==Object.keys(u).length)return!1;for(var y in o)if(!t(o[y],u[y]))return!1;return!0}return o===u},g.dot=function(t,o){return t[0]*o[0]+t[1]*o[1]+t[2]*o[2]},g.dot$1=function(t,o){return t[0]*o[0]+t[1]*o[1]+t[2]*o[2]+t[3]*o[3]},g.ease=wt,g.emitValidationErrors=Gc,g.endsWith=Y,g.enforceCacheSizeLimit=function(t){an(),Hi&&Hi.then(function(o){o.keys().then(function(u){for(var p=0;p<u.length-t;p++)o.delete(u[p])})})},g.evaluateSizeForFeature=Qn,g.evaluateSizeForZoom=ci,g.evaluateVariableOffset=ri,g.evented=Kf,g.extend=Tt,g.featureFilter=Fl,g.filterObject=at,g.fromRotation=function(t,o){var u=Math.sin(o),p=Math.cos(o);return t[0]=p,t[1]=u,t[2]=0,t[3]=-u,t[4]=p,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},g.getAnchorAlignment=Kr,g.getAnchorJustification=we,g.getArrayBuffer=Na,g.getImage=$,g.getJSON=function(t,o){return Zo(Tt(t,{type:"json"}),o)},g.getRTLTextPluginStatus=Mf,g.getReferrer=Ri,g.getVideo=function(t,o){var u,p,y=_e.document.createElement("video");y.muted=!0,y.onloadstart=function(){o(null,y)};for(var b=0;b<t.length;b++){var C=_e.document.createElement("source");u=t[b],p=void 0,(p=_e.document.createElement("a")).href=u,(p.protocol!==_e.document.location.protocol||p.host!==_e.document.location.host)&&(y.crossOrigin="Anonymous"),C.src=t[b],y.appendChild(C)}return{cancel:function(){}}},g.identity=Us,g.invert=function(t,o){var u=o[0],p=o[1],y=o[2],b=o[3],C=o[4],O=o[5],D=o[6],z=o[7],Z=o[8],G=o[9],q=o[10],ie=o[11],Te=o[12],Oe=o[13],k=o[14],Ue=o[15],rt=u*O-p*C,bt=u*D-y*C,Ut=u*z-b*C,Gt=p*D-y*O,ir=p*z-b*O,Mr=y*z-b*D,Dr=Z*Oe-G*Te,Dn=Z*k-q*Te,cn=Z*Ue-ie*Te,Vn=G*k-q*Oe,hn=G*Ue-ie*Oe,Pi=q*Ue-ie*k,ei=rt*Pi-bt*hn+Ut*Vn+Gt*cn-ir*Dn+Mr*Dr;return ei?(t[0]=(O*Pi-D*hn+z*Vn)*(ei=1/ei),t[1]=(y*hn-p*Pi-b*Vn)*ei,t[2]=(Oe*Mr-k*ir+Ue*Gt)*ei,t[3]=(q*ir-G*Mr-ie*Gt)*ei,t[4]=(D*cn-C*Pi-z*Dn)*ei,t[5]=(u*Pi-y*cn+b*Dn)*ei,t[6]=(k*Ut-Te*Mr-Ue*bt)*ei,t[7]=(Z*Mr-q*Ut+ie*bt)*ei,t[8]=(C*hn-O*cn+z*Dr)*ei,t[9]=(p*cn-u*hn-b*Dr)*ei,t[10]=(Te*ir-Oe*Ut+Ue*rt)*ei,t[11]=(G*Ut-Z*ir-ie*rt)*ei,t[12]=(O*Dn-C*Vn-D*Dr)*ei,t[13]=(u*Vn-p*Dn+y*Dr)*ei,t[14]=(Oe*bt-Te*Gt-k*rt)*ei,t[15]=(Z*Gt-G*bt+q*rt)*ei,t):null},g.isChar=Zr,g.isMapboxURL=Ii,g.keysDifference=function(t,o){var u=[];for(var p in t)p in o||u.push(p);return u},g.makeRequest=Zo,g.mapObject=Xt,g.mercatorXfromLng=wl,g.mercatorYfromLat=ju,g.mercatorZfromAltitude=ad,g.mul=qc,g.multiply=es,g.mvt=Cu,g.nextPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},g.normalize=function(t,o){var u=o[0],p=o[1],y=o[2],b=u*u+p*p+y*y;return b>0&&(b=1/Math.sqrt(b)),t[0]=o[0]*b,t[1]=o[1]*b,t[2]=o[2]*b,t},g.number=ga,g.offscreenCanvasSupported=vi,g.ortho=function(t,o,u,p,y,b,C){var O=1/(o-u),D=1/(p-y),z=1/(b-C);return t[0]=-2*O,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*D,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*z,t[11]=0,t[12]=(o+u)*O,t[13]=(y+p)*D,t[14]=(C+b)*z,t[15]=1,t},g.parseGlyphPBF=function(t){return new sf(t).readFields(Tr,[])},g.pbf=sf,g.performSymbolLayout=function(t,o,u,p,y,b,C){t.createArrays(),t.tilePixelRatio=8192/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;var O=t.layers[0].layout,D=t.layers[0]._unevaluatedLayout._values,z={};if(t.textSizeData.kind==="composite"){var Z=t.textSizeData,G=Z.maxZoom;z.compositeTextSizes=[D["text-size"].possiblyEvaluate(new Ai(Z.minZoom),C),D["text-size"].possiblyEvaluate(new Ai(G),C)]}if(t.iconSizeData.kind==="composite"){var q=t.iconSizeData,ie=q.maxZoom;z.compositeIconSizes=[D["icon-size"].possiblyEvaluate(new Ai(q.minZoom),C),D["icon-size"].possiblyEvaluate(new Ai(ie),C)]}z.layoutTextSize=D["text-size"].possiblyEvaluate(new Ai(t.zoom+1),C),z.layoutIconSize=D["icon-size"].possiblyEvaluate(new Ai(t.zoom+1),C),z.textMaxSize=D["text-size"].possiblyEvaluate(new Ai(18));for(var Te=24*O.get("text-line-height"),Oe=O.get("text-rotation-alignment")==="map"&&O.get("symbol-placement")!=="point",k=O.get("text-keep-upright"),Ue=O.get("text-size"),rt=function(){var Gt=Ut[bt],ir=O.get("text-font").evaluate(Gt,{},C).join(","),Mr=Ue.evaluate(Gt,{},C),Dr=z.layoutTextSize.evaluate(Gt,{},C),Dn=z.layoutIconSize.evaluate(Gt,{},C),cn={horizontal:{},vertical:void 0},Vn=Gt.text,hn=[0,0];if(Vn){var Pi=Vn.toString(),ei=24*O.get("text-letter-spacing").evaluate(Gt,{},C),wn=function(Ci){for(var Fa=0,wa=Ci;Fa<wa.length;Fa+=1)if(fa=wa[Fa].charCodeAt(0),Zr.Arabic(fa)||Zr["Arabic Supplement"](fa)||Zr["Arabic Extended-A"](fa)||Zr["Arabic Presentation Forms-A"](fa)||Zr["Arabic Presentation Forms-B"](fa))return!1;var fa;return!0}(Pi)?ei:0,ji=O.get("text-anchor").evaluate(Gt,{},C),Si=O.get("text-variable-anchor");if(!Si){var ea=O.get("text-radial-offset").evaluate(Gt,{},C);hn=ea?ri(ji,[24*ea,Ln]):O.get("text-offset").evaluate(Gt,{},C).map(function(Ci){return 24*Ci})}var Wn=Oe?"center":O.get("text-justify").evaluate(Gt,{},C),pa=O.get("symbol-placement"),eo=pa==="point"?24*O.get("text-max-width").evaluate(Gt,{},C):0,_o=function(){t.allowVerticalPlacement&&pc(Pi)&&(cn.vertical=$r(Vn,o,u,y,ir,eo,Te,ji,"left",wn,hn,Nr.vertical,!0,pa,Dr,Mr))};if(!Oe&&Si){for(var Wa=Wn==="auto"?Si.map(function(Ci){return we(Ci)}):[Wn],to=!1,xo=0;xo<Wa.length;xo++){var Yo=Wa[xo];if(!cn.horizontal[Yo])if(to)cn.horizontal[Yo]=cn.horizontal[0];else{var rs=$r(Vn,o,u,y,ir,eo,Te,"center",Yo,wn,hn,Nr.horizontal,!1,pa,Dr,Mr);rs&&(cn.horizontal[Yo]=rs,to=rs.positionedLines.length===1)}}_o()}else{Wn==="auto"&&(Wn=we(ji));var Gs=$r(Vn,o,u,y,ir,eo,Te,ji,Wn,wn,hn,Nr.horizontal,!1,pa,Dr,Mr);Gs&&(cn.horizontal[Wn]=Gs),_o(),pc(Pi)&&Oe&&k&&(cn.vertical=$r(Vn,o,u,y,ir,eo,Te,ji,Wn,wn,hn,Nr.vertical,!1,pa,Dr,Mr))}}var ns=void 0,Hs=!1;if(Gt.icon&&Gt.icon.name){var Ga=p[Gt.icon.name];Ga&&(ns=function(Ci,Fa,wa){var fa=Kr(wa),ds=Fa[0]-Ci.displaySize[0]*fa.horizontalAlign,ws=Fa[1]-Ci.displaySize[1]*fa.verticalAlign;return{image:Ci,top:ws,bottom:ws+Ci.displaySize[1],left:ds,right:ds+Ci.displaySize[0]}}(y[Gt.icon.name],O.get("icon-offset").evaluate(Gt,{},C),O.get("icon-anchor").evaluate(Gt,{},C)),Hs=Ga.sdf,t.sdfIcons===void 0?t.sdfIcons=Ga.sdf:t.sdfIcons!==Ga.sdf&&$e("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ga.pixelRatio!==t.pixelRatio||O.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}var ps=St(cn.horizontal)||cn.vertical;t.iconsInText=!!ps&&ps.iconsInText,(ps||ns)&&function(Ci,Fa,wa,fa,ds,ws,Xa,Ro,vs,da,ec){var uu=ws.textMaxSize.evaluate(Fa,{});uu===void 0&&(uu=Xa);var lf,ko=Ci.layers[0].layout,Ac=ko.get("icon-offset").evaluate(Fa,{},ec),nl=St(wa.horizontal),Yh=Xa/24,Nf=Ci.tilePixelRatio*Yh,ph=Ci.tilePixelRatio*uu/24,wc=Ci.tilePixelRatio*Ro,dh=Ci.tilePixelRatio*ko.get("symbol-spacing"),xp=ko.get("text-padding")*Ci.tilePixelRatio,vh=ko.get("icon-padding")*Ci.tilePixelRatio,qh=ko.get("text-max-angle")/180*Math.PI,bp=ko.get("text-rotation-alignment")==="map"&&ko.get("symbol-placement")!=="point",Ep=ko.get("icon-rotation-alignment")==="map"&&ko.get("symbol-placement")!=="point",Tc=ko.get("symbol-placement"),Kh=dh/2,mh=ko.get("icon-text-fit");fa&&mh!=="none"&&(Ci.allowVerticalPlacement&&wa.vertical&&(lf=ai(fa,wa.vertical,mh,ko.get("icon-text-fit-padding"),Ac,Yh)),nl&&(fa=ai(fa,nl,mh,ko.get("icon-text-fit-padding"),Ac,Yh)));var cf=function(C0,Mp){Mp.x<0||Mp.x>=8192||Mp.y<0||Mp.y>=8192||function(Co,tc,A0,ff,fd,Ud,Pp,Gu,Op,Ip,hd,pd,Zd,bv,Rp,Ev,Sv,Cv,Av,wv,Hu,dd,Tv,Mc,w0){var Mv,bh,Tl,il,Eh,Sh=Co.addToLineVertexArray(tc,A0),kp=0,jd=0,Vd=0,Pv=0,Gd=-1,Hd=-1,Pc={},Wd=xe(""),vd=0,Lp=0;if(Gu._unevaluatedLayout.getValue("text-radial-offset")===void 0?(vd=(Mv=Gu.layout.get("text-offset").evaluate(Hu,{},Mc).map(function(hf){return 24*hf}))[0],Lp=Mv[1]):(vd=24*Gu.layout.get("text-radial-offset").evaluate(Hu,{},Mc),Lp=Ln),Co.allowVerticalPlacement&&ff.vertical){var Xd=Gu.layout.get("text-rotate").evaluate(Hu,{},Mc)+90;il=new Io(Op,tc,Ip,hd,pd,ff.vertical,Zd,bv,Rp,Xd),Pp&&(Eh=new Io(Op,tc,Ip,hd,pd,Pp,Sv,Cv,Rp,Xd))}if(fd){var Yd=Gu.layout.get("icon-rotate").evaluate(Hu,{}),Ov=Gu.layout.get("icon-text-fit")!=="none",qd=Wo(fd,Yd,Tv,Ov),Kd=Pp?Wo(Pp,Yd,Tv,Ov):void 0;Tl=new Io(Op,tc,Ip,hd,pd,fd,Sv,Cv,!1,Yd),kp=4*qd.length;var $d=Co.iconSizeData,np=null;$d.kind==="source"?(np=[128*Gu.layout.get("icon-size").evaluate(Hu,{})])[0]>32640&&$e(Co.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):$d.kind==="composite"&&((np=[128*dd.compositeIconSizes[0].evaluate(Hu,{},Mc),128*dd.compositeIconSizes[1].evaluate(Hu,{},Mc)])[0]>32640||np[1]>32640)&&$e(Co.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Co.addSymbols(Co.icon,qd,np,wv,Av,Hu,!1,tc,Sh.lineStartIndex,Sh.lineLength,-1,Mc),Gd=Co.icon.placedSymbolArray.length-1,Kd&&(jd=4*Kd.length,Co.addSymbols(Co.icon,Kd,np,wv,Av,Hu,Nr.vertical,tc,Sh.lineStartIndex,Sh.lineLength,-1,Mc),Hd=Co.icon.placedSymbolArray.length-1)}for(var Qd in ff.horizontal){var Dp=ff.horizontal[Qd];if(!bh){Wd=xe(Dp.text);var T0=Gu.layout.get("text-rotate").evaluate(Hu,{},Mc);bh=new Io(Op,tc,Ip,hd,pd,Dp,Zd,bv,Rp,T0)}var Iv=Dp.positionedLines.length===1;if(Vd+=zt(Co,tc,Dp,Ud,Gu,Rp,Hu,Ev,Sh,ff.vertical?Nr.horizontal:Nr.horizontalOnly,Iv?Object.keys(ff.horizontal):[Qd],Pc,Gd,dd,Mc),Iv)break}ff.vertical&&(Pv+=zt(Co,tc,ff.vertical,Ud,Gu,Rp,Hu,Ev,Sh,Nr.vertical,["vertical"],Pc,Hd,dd,Mc));var M0=bh?bh.boxStartIndex:Co.collisionBoxArray.length,P0=bh?bh.boxEndIndex:Co.collisionBoxArray.length,O0=il?il.boxStartIndex:Co.collisionBoxArray.length,I0=il?il.boxEndIndex:Co.collisionBoxArray.length,R0=Tl?Tl.boxStartIndex:Co.collisionBoxArray.length,Rv=Tl?Tl.boxEndIndex:Co.collisionBoxArray.length,kv=Eh?Eh.boxStartIndex:Co.collisionBoxArray.length,Lv=Eh?Eh.boxEndIndex:Co.collisionBoxArray.length,Ml=-1,Fp=function(hf,Dv){return hf&&hf.circleDiameter?Math.max(hf.circleDiameter,Dv):Dv};Ml=Fp(bh,Ml),Ml=Fp(il,Ml),Ml=Fp(Tl,Ml);var Jd=(Ml=Fp(Eh,Ml))>-1?1:0;Jd&&(Ml*=w0/24),Co.glyphOffsetArray.length>=De.MAX_GLYPHS&&$e("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Hu.sortKey!==void 0&&Co.addToSortKeyRanges(Co.symbolInstances.length,Hu.sortKey),Co.symbolInstances.emplaceBack(tc.x,tc.y,Pc.right>=0?Pc.right:-1,Pc.center>=0?Pc.center:-1,Pc.left>=0?Pc.left:-1,Pc.vertical||-1,Gd,Hd,Wd,M0,P0,O0,I0,R0,Rv,kv,Lv,Ip,Vd,Pv,kp,jd,Jd,0,Zd,vd,Lp,Ml)}(Ci,Mp,C0,wa,fa,ds,lf,Ci.layers[0],Ci.collisionBoxArray,Fa.index,Fa.sourceLayerIndex,Ci.index,Nf,xp,bp,vs,wc,vh,Ep,Ac,Fa,ws,da,ec,Xa)};if(Tc==="line")for(var gh=0,Sp=So(Fa.geometry,0,0,8192,8192);gh<Sp.length;gh+=1)for(var Cp=Sp[gh],$h=0,ms=No(Cp,dh,qh,wa.vertical||nl,fa,24,ph,Ci.overscaling,8192);$h<ms.length;$h+=1){var Ap=ms[$h];nl&&mn(Ci,nl.text,Kh,Ap)||cf(Cp,Ap)}else if(Tc==="line-center")for(var Qh=0,Jh=Fa.geometry;Qh<Jh.length;Qh+=1){var ep=Jh[Qh];if(ep.length>1){var wp=ja(ep,qh,wa.vertical||nl,fa,24,ph);wp&&cf(ep,wp)}}else if(Fa.type==="Polygon")for(var yh=0,Tp=Rf(Fa.geometry,0);yh<Tp.length;yh+=1){var _h=Tp[yh],tp=ti(_h,16);cf(_h[0],new Hr(tp.x,tp.y,0))}else if(Fa.type==="LineString")for(var zf=0,rp=Fa.geometry;zf<rp.length;zf+=1){var xh=rp[zf];cf(xh,new Hr(xh[0].x,xh[0].y,0))}else if(Fa.type==="Point")for(var ld=0,Nd=Fa.geometry;ld<Nd.length;ld+=1)for(var cd=0,xv=Nd[ld];cd<xv.length;cd+=1){var zd=xv[cd];cf([zd],new Hr(zd.x,zd.y,0))}}(t,Gt,cn,ns,p,z,Dr,Dn,hn,Hs,C)},bt=0,Ut=t.features;bt<Ut.length;bt+=1)rt();b&&t.generateCollisionDebugBuffers()},g.perspective=function(t,o,u,p,y){var b,C=1/Math.tan(o/2);return t[0]=C/u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=C,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,y!=null&&y!==1/0?(t[10]=(y+p)*(b=1/(p-y)),t[14]=2*y*p*b):(t[10]=-1,t[14]=-2*p),t},g.pick=function(t,o){for(var u={},p=0;p<o.length;p++){var y=o[p];y in t&&(u[y]=t[y])}return u},g.plugin=Is,g.polygonIntersectsPolygon=Bu,g.postMapLoadEvent=Zt,g.postTurnstileEvent=bo,g.potpack=Cr,g.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],g.register=vn,g.registerForPluginStateChange=function(t){return t({pluginStatus:Bs,pluginURL:Lu}),Kf.on("pluginStateChange",t),t},g.renderColorRamp=Jf,g.rotate=function(t,o,u){var p=o[0],y=o[1],b=o[2],C=o[3],O=Math.sin(u),D=Math.cos(u);return t[0]=p*D+b*O,t[1]=y*D+C*O,t[2]=p*-O+b*D,t[3]=y*-O+C*D,t},g.rotateX=function(t,o,u){var p=Math.sin(u),y=Math.cos(u),b=o[4],C=o[5],O=o[6],D=o[7],z=o[8],Z=o[9],G=o[10],q=o[11];return o!==t&&(t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=o[3],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15]),t[4]=b*y+z*p,t[5]=C*y+Z*p,t[6]=O*y+G*p,t[7]=D*y+q*p,t[8]=z*y-b*p,t[9]=Z*y-C*p,t[10]=G*y-O*p,t[11]=q*y-D*p,t},g.rotateZ=function(t,o,u){var p=Math.sin(u),y=Math.cos(u),b=o[0],C=o[1],O=o[2],D=o[3],z=o[4],Z=o[5],G=o[6],q=o[7];return o!==t&&(t[8]=o[8],t[9]=o[9],t[10]=o[10],t[11]=o[11],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15]),t[0]=b*y+z*p,t[1]=C*y+Z*p,t[2]=O*y+G*p,t[3]=D*y+q*p,t[4]=z*y-b*p,t[5]=Z*y-C*p,t[6]=G*y-O*p,t[7]=q*y-D*p,t},g.scale=function(t,o,u){var p=u[0],y=u[1],b=u[2];return t[0]=o[0]*p,t[1]=o[1]*p,t[2]=o[2]*p,t[3]=o[3]*p,t[4]=o[4]*y,t[5]=o[5]*y,t[6]=o[6]*y,t[7]=o[7]*y,t[8]=o[8]*b,t[9]=o[9]*b,t[10]=o[10]*b,t[11]=o[11]*b,t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15],t},g.scale$1=function(t,o,u){return t[0]=o[0]*u,t[1]=o[1]*u,t[2]=o[2]*u,t[3]=o[3]*u,t},g.scale$2=function(t,o,u){return t[0]=o[0]*u,t[1]=o[1]*u,t[2]=o[2]*u,t},g.setCacheLimits=function(t,o){er=t,Rr=o},g.setRTLTextPlugin=function(t,o,u){if(u===void 0&&(u=!1),Bs==="deferred"||Bs==="loading"||Bs==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");Lu=Nn.resolveURL(t),Bs="deferred",ku=o,pl(),u||vu()},g.sphericalToCartesian=function(t){var o=t[0],u=t[1],p=t[2];return u+=90,u*=Math.PI/180,p*=Math.PI/180,{x:o*Math.cos(u)*Math.sin(p),y:o*Math.sin(u)*Math.sin(p),z:o*Math.cos(p)}},g.sqrLen=function(t){var o=t[0],u=t[1];return o*o+u*u},g.styleSpec=se,g.sub=function(t,o,u){return t[0]=o[0]-u[0],t[1]=o[1]-u[1],t[2]=o[2]-u[2],t},g.symbolSize=Ni,g.transformMat3=function(t,o,u){var p=o[0],y=o[1],b=o[2];return t[0]=p*u[0]+y*u[3]+b*u[6],t[1]=p*u[1]+y*u[4]+b*u[7],t[2]=p*u[2]+y*u[5]+b*u[8],t},g.transformMat4=Kc,g.translate=function(t,o,u){var p,y,b,C,O,D,z,Z,G,q,ie,Te,Oe=u[0],k=u[1],Ue=u[2];return o===t?(t[12]=o[0]*Oe+o[4]*k+o[8]*Ue+o[12],t[13]=o[1]*Oe+o[5]*k+o[9]*Ue+o[13],t[14]=o[2]*Oe+o[6]*k+o[10]*Ue+o[14],t[15]=o[3]*Oe+o[7]*k+o[11]*Ue+o[15]):(y=o[1],b=o[2],C=o[3],O=o[4],D=o[5],z=o[6],Z=o[7],G=o[8],q=o[9],ie=o[10],Te=o[11],t[0]=p=o[0],t[1]=y,t[2]=b,t[3]=C,t[4]=O,t[5]=D,t[6]=z,t[7]=Z,t[8]=G,t[9]=q,t[10]=ie,t[11]=Te,t[12]=p*Oe+O*k+G*Ue+o[12],t[13]=y*Oe+D*k+q*Ue+o[13],t[14]=b*Oe+z*k+ie*Ue+o[14],t[15]=C*Oe+Z*k+Te*Ue+o[15]),t},g.triggerPluginCompletionEvent=qf,g.uniqueId=_t,g.validateCustomStyleLayer=function(t){var o=[],u=t.id;return u===void 0&&o.push({message:"layers."+u+': missing required property "id"'}),t.render===void 0&&o.push({message:"layers."+u+': missing required method "render"'}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&o.push({message:"layers."+u+': property "renderingMode" must be either "2d" or "3d"'}),o},g.validateLight=fc,g.validateStyle=Za,g.values=function(t){var o=[];for(var u in t)o.push(t[u]);return o},g.vectorTile=Cu,g.version="1.13.2",g.warnOnce=$e,g.webpSupported=zn,g.window=_e,g.wrap=or}),me(["./shared"],function(g){"use strict";function Re(V){var $=typeof V;if($==="number"||$==="boolean"||$==="string"||V==null)return JSON.stringify(V);if(Array.isArray(V)){for(var re="[",pe=0,Me=V;pe<Me.length;pe+=1)re+=Re(Me[pe])+",";return re+"]"}for(var Ge=Object.keys(V).sort(),Qe="{",se=0;se<Ge.length;se++)Qe+=JSON.stringify(Ge[se])+":"+Re(V[Ge[se]])+",";return Qe+"}"}function W(V){for(var $="",re=0,pe=g.refProperties;re<pe.length;re+=1)$+="/"+Re(V[pe[re]]);return $}var he=function(V){this.keyCache={},V&&this.replace(V)};he.prototype.replace=function(V){this._layerConfigs={},this._layers={},this.update(V,[])},he.prototype.update=function(V,$){for(var re=this,pe=0,Me=V;pe<Me.length;pe+=1){var Ge=Me[pe];this._layerConfigs[Ge.id]=Ge;var Qe=this._layers[Ge.id]=g.createStyleLayer(Ge);Qe._featureFilter=g.featureFilter(Qe.filter),this.keyCache[Ge.id]&&delete this.keyCache[Ge.id]}for(var se=0,Le=$;se<Le.length;se+=1){var dt=Le[se];delete this.keyCache[dt],delete this._layerConfigs[dt],delete this._layers[dt]}this.familiesBySource={};for(var fr=0,Lt=function(Br,Wr){for(var mi={},en=0;en<Br.length;en++){var dn=Wr&&Wr[Br[en].id]||W(Br[en]);Wr&&(Wr[Br[en].id]=dn);var Wi=mi[dn];Wi||(Wi=mi[dn]=[]),Wi.push(Br[en])}var hi=[];for(var wi in mi)hi.push(mi[wi]);return hi}(g.values(this._layerConfigs),this.keyCache);fr<Lt.length;fr+=1){var Bt=Lt[fr].map(function(Br){return re._layers[Br.id]}),hr=Bt[0];if(hr.visibility!=="none"){var _n=hr.source||"",fn=this.familiesBySource[_n];fn||(fn=this.familiesBySource[_n]={});var Mt=hr.sourceLayer||"_geojsonTileLayer",Jr=fn[Mt];Jr||(Jr=fn[Mt]=[]),Jr.push(Bt)}}};var de=function(V){var $={},re=[];for(var pe in V){var Me=V[pe],Ge=$[pe]={};for(var Qe in Me){var se=Me[+Qe];if(se&&se.bitmap.width!==0&&se.bitmap.height!==0){var Le={x:0,y:0,w:se.bitmap.width+2,h:se.bitmap.height+2};re.push(Le),Ge[Qe]={rect:Le,metrics:se.metrics}}}}var dt=g.potpack(re),fr=new g.AlphaImage({width:dt.w||1,height:dt.h||1});for(var Lt in V){var Bt=V[Lt];for(var hr in Bt){var _n=Bt[+hr];if(_n&&_n.bitmap.width!==0&&_n.bitmap.height!==0){var fn=$[Lt][hr].rect;g.AlphaImage.copy(_n.bitmap,fr,{x:0,y:0},{x:fn.x+1,y:fn.y+1},_n.bitmap)}}}this.image=fr,this.positions=$};g.register("GlyphAtlas",de);var ze=function(V){this.tileID=new g.OverscaledTileID(V.tileID.overscaledZ,V.tileID.wrap,V.tileID.canonical.z,V.tileID.canonical.x,V.tileID.canonical.y),this.uid=V.uid,this.zoom=V.zoom,this.pixelRatio=V.pixelRatio,this.tileSize=V.tileSize,this.source=V.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=V.showCollisionBoxes,this.collectResourceTiming=!!V.collectResourceTiming,this.returnDependencies=!!V.returnDependencies,this.promoteId=V.promoteId};function _e(V,$,re){for(var pe=new g.EvaluationParameters($),Me=0,Ge=V;Me<Ge.length;Me+=1)Ge[Me].recalculate(pe,re)}function tt(V,$){var re=g.getArrayBuffer(V.request,function(pe,Me,Ge,Qe){pe?$(pe):Me&&$(null,{vectorTile:new g.vectorTile.VectorTile(new g.pbf(Me)),rawData:Me,cacheControl:Ge,expires:Qe})});return function(){re.cancel(),$()}}ze.prototype.parse=function(V,$,re,pe,Me){var Ge=this;this.status="parsing",this.data=V,this.collisionBoxArray=new g.CollisionBoxArray;var Qe=new g.DictionaryCoder(Object.keys(V.layers).sort()),se=new g.FeatureIndex(this.tileID,this.promoteId);se.bucketLayerIDs=[];var Le,dt,fr,Lt,Bt={},hr={featureIndex:se,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:re},_n=$.familiesBySource[this.source];for(var fn in _n){var Mt=V.layers[fn];if(Mt){Mt.version===1&&g.warnOnce('Vector tile source "'+this.source+'" layer "'+fn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var Jr=Qe.encode(fn),Br=[],Wr=0;Wr<Mt.length;Wr++){var mi=Mt.feature(Wr),en=se.getId(mi,fn);Br.push({feature:mi,id:en,index:Wr,sourceLayerIndex:Jr})}for(var dn=0,Wi=_n[fn];dn<Wi.length;dn+=1){var hi=Wi[dn],wi=hi[0];wi.minzoom&&this.zoom<Math.floor(wi.minzoom)||wi.maxzoom&&this.zoom>=wi.maxzoom||wi.visibility!=="none"&&(_e(hi,this.zoom,re),(Bt[wi.id]=wi.createBucket({index:se.bucketLayerIDs.length,layers:hi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Jr,sourceID:this.source})).populate(Br,hr,this.tileID.canonical),se.bucketLayerIDs.push(hi.map(function(Ei){return Ei.id})))}}}var _i=g.mapObject(hr.glyphDependencies,function(Ei){return Object.keys(Ei).map(Number)});Object.keys(_i).length?pe.send("getGlyphs",{uid:this.uid,stacks:_i},function(Ei,Ti){Le||(Le=Ei,dt=Ti,Ta.call(Ge))}):dt={};var ht=Object.keys(hr.iconDependencies);ht.length?pe.send("getImages",{icons:ht,source:this.source,tileID:this.tileID,type:"icons"},function(Ei,Ti){Le||(Le=Ei,fr=Ti,Ta.call(Ge))}):fr={};var Pt=Object.keys(hr.patternDependencies);function Ta(){if(Le)return Me(Le);if(dt&&fr&&Lt){var Ei=new de(dt),Ti=new g.ImageAtlas(fr,Lt);for(var Zi in Bt){var Pr=Bt[Zi];Pr instanceof g.SymbolBucket?(_e(Pr.layers,this.zoom,re),g.performSymbolLayout(Pr,dt,Ei.positions,fr,Ti.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Pr.hasPattern&&(Pr instanceof g.LineBucket||Pr instanceof g.FillBucket||Pr instanceof g.FillExtrusionBucket)&&(_e(Pr.layers,this.zoom,re),Pr.addFeatures(hr,this.tileID.canonical,Ti.patternPositions))}this.status="done",Me(null,{buckets:g.values(Bt).filter(function(on){return!on.isEmpty()}),featureIndex:se,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ei.image,imageAtlas:Ti,glyphMap:this.returnDependencies?dt:null,iconMap:this.returnDependencies?fr:null,glyphPositions:this.returnDependencies?Ei.positions:null})}}Pt.length?pe.send("getImages",{icons:Pt,source:this.source,tileID:this.tileID,type:"patterns"},function(Ei,Ti){Le||(Le=Ei,Lt=Ti,Ta.call(Ge))}):Lt={},Ta.call(this)};var mt=function(V,$,re,pe){this.actor=V,this.layerIndex=$,this.availableImages=re,this.loadVectorData=pe||tt,this.loading={},this.loaded={}};mt.prototype.loadTile=function(V,$){var re=this,pe=V.uid;this.loading||(this.loading={});var Me=!!(V&&V.request&&V.request.collectResourceTiming)&&new g.RequestPerformance(V.request),Ge=this.loading[pe]=new ze(V);Ge.abort=this.loadVectorData(V,function(Qe,se){if(delete re.loading[pe],Qe||!se)return Ge.status="done",re.loaded[pe]=Ge,$(Qe);var Le=se.rawData,dt={};se.expires&&(dt.expires=se.expires),se.cacheControl&&(dt.cacheControl=se.cacheControl);var fr={};if(Me){var Lt=Me.finish();Lt&&(fr.resourceTiming=JSON.parse(JSON.stringify(Lt)))}Ge.vectorTile=se.vectorTile,Ge.parse(se.vectorTile,re.layerIndex,re.availableImages,re.actor,function(Bt,hr){if(Bt||!hr)return $(Bt);$(null,g.extend({rawTileData:Le.slice(0)},hr,dt,fr))}),re.loaded=re.loaded||{},re.loaded[pe]=Ge})},mt.prototype.reloadTile=function(V,$){var re=this,pe=this.loaded,Me=V.uid,Ge=this;if(pe&&pe[Me]){var Qe=pe[Me];Qe.showCollisionBoxes=V.showCollisionBoxes;var se=function(Le,dt){var fr=Qe.reloadCallback;fr&&(delete Qe.reloadCallback,Qe.parse(Qe.vectorTile,Ge.layerIndex,re.availableImages,Ge.actor,fr)),$(Le,dt)};Qe.status==="parsing"?Qe.reloadCallback=se:Qe.status==="done"&&(Qe.vectorTile?Qe.parse(Qe.vectorTile,this.layerIndex,this.availableImages,this.actor,se):se())}},mt.prototype.abortTile=function(V,$){var re=this.loading,pe=V.uid;re&&re[pe]&&re[pe].abort&&(re[pe].abort(),delete re[pe]),$()},mt.prototype.removeTile=function(V,$){var re=this.loaded,pe=V.uid;re&&re[pe]&&delete re[pe],$()};var wt=g.window.ImageBitmap,Nt=function(){this.loaded={}};function or(V,$){if(V.length!==0){Tt(V[0],$);for(var re=1;re<V.length;re++)Tt(V[re],!$)}}function Tt(V,$){for(var re=0,pe=0,Me=V.length,Ge=Me-1;pe<Me;Ge=pe++)re+=(V[pe][0]-V[Ge][0])*(V[Ge][1]+V[pe][1]);re>=0!=!!$&&V.reverse()}Nt.prototype.loadTile=function(V,$){var re=V.uid,pe=V.encoding,Me=V.rawImageData,Ge=wt&&Me instanceof wt?this.getImageData(Me):Me,Qe=new g.DEMData(re,Ge,pe);this.loaded=this.loaded||{},this.loaded[re]=Qe,$(null,Qe)},Nt.prototype.getImageData=function(V){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(V.width,V.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=V.width,this.offscreenCanvas.height=V.height,this.offscreenCanvasContext.drawImage(V,0,0,V.width,V.height);var $=this.offscreenCanvasContext.getImageData(-1,-1,V.width+2,V.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new g.RGBAImage({width:$.width,height:$.height},$.data)},Nt.prototype.removeTile=function(V){var $=this.loaded,re=V.uid;$&&$[re]&&delete $[re]};var Kt=g.vectorTile.VectorTileFeature.prototype.toGeoJSON,_t=function(V){this._feature=V,this.extent=g.EXTENT,this.type=V.type,this.properties=V.tags,"id"in V&&!isNaN(V.id)&&(this.id=parseInt(V.id,10))};_t.prototype.loadGeometry=function(){if(this._feature.type===1){for(var V=[],$=0,re=this._feature.geometry;$<re.length;$+=1){var pe=re[$];V.push([new g.Point$1(pe[0],pe[1])])}return V}for(var Me=[],Ge=0,Qe=this._feature.geometry;Ge<Qe.length;Ge+=1){for(var se=[],Le=0,dt=Qe[Ge];Le<dt.length;Le+=1){var fr=dt[Le];se.push(new g.Point$1(fr[0],fr[1]))}Me.push(se)}return Me},_t.prototype.toGeoJSON=function(V,$,re){return Kt.call(this,V,$,re)};var ct=function(V){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=g.EXTENT,this.length=V.length,this._features=V};ct.prototype.feature=function(V){return new _t(this._features[V])};var it=g.vectorTile.VectorTileFeature,$t=Y;function Y(V,$){this.options=$||{},this.features=V,this.length=V.length}function Xt(V,$){this.id=typeof V.id=="number"?V.id:void 0,this.type=V.type,this.rawGeometry=V.type===1?[V.geometry]:V.geometry,this.properties=V.tags,this.extent=$||4096}Y.prototype.feature=function(V){return new Xt(this.features[V],this.options.extent)},Xt.prototype.loadGeometry=function(){var V=this.rawGeometry;this.geometry=[];for(var $=0;$<V.length;$++){for(var re=V[$],pe=[],Me=0;Me<re.length;Me++)pe.push(new g.Point$1(re[Me][0],re[Me][1]));this.geometry.push(pe)}return this.geometry},Xt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var V=this.geometry,$=1/0,re=-1/0,pe=1/0,Me=-1/0,Ge=0;Ge<V.length;Ge++)for(var Qe=V[Ge],se=0;se<Qe.length;se++){var Le=Qe[se];$=Math.min($,Le.x),re=Math.max(re,Le.x),pe=Math.min(pe,Le.y),Me=Math.max(Me,Le.y)}return[$,pe,re,Me]},Xt.prototype.toGeoJSON=it.prototype.toGeoJSON;var at=Et,qe=$t;function Et(V){var $=new g.pbf;return function(re,pe){for(var Me in re.layers)pe.writeMessage(3,$e,re.layers[Me])}(V,$),$.finish()}function $e(V,$){var re;$.writeVarintField(15,V.version||1),$.writeStringField(1,V.name||""),$.writeVarintField(5,V.extent||4096);var pe={keys:[],values:[],keycache:{},valuecache:{}};for(re=0;re<V.length;re++)pe.feature=V.feature(re),$.writeMessage(2,Ht,pe);var Me=pe.keys;for(re=0;re<Me.length;re++)$.writeStringField(3,Me[re]);var Ge=pe.values;for(re=0;re<Ge.length;re++)$.writeMessage(4,Se,Ge[re])}function Ht(V,$){var re=V.feature;re.id!==void 0&&$.writeVarintField(1,re.id),$.writeMessage(2,mr,V),$.writeVarintField(3,re.type),$.writeMessage(4,S,re)}function mr(V,$){var re=V.feature,pe=V.keys,Me=V.values,Ge=V.keycache,Qe=V.valuecache;for(var se in re.properties){var Le=Ge[se];Le===void 0&&(pe.push(se),Ge[se]=Le=pe.length-1),$.writeVarint(Le);var dt=re.properties[se],fr=typeof dt;fr!=="string"&&fr!=="boolean"&&fr!=="number"&&(dt=JSON.stringify(dt));var Lt=fr+":"+dt,Bt=Qe[Lt];Bt===void 0&&(Me.push(dt),Qe[Lt]=Bt=Me.length-1),$.writeVarint(Bt)}}function Fr(V,$){return($<<3)+(7&V)}function Yr(V){return V<<1^V>>31}function S(V,$){for(var re=V.loadGeometry(),pe=V.type,Me=0,Ge=0,Qe=re.length,se=0;se<Qe;se++){var Le=re[se],dt=1;pe===1&&(dt=Le.length),$.writeVarint(Fr(1,dt));for(var fr=pe===3?Le.length-1:Le.length,Lt=0;Lt<fr;Lt++){Lt===1&&pe!==1&&$.writeVarint(Fr(2,fr-1));var Bt=Le[Lt].x-Me,hr=Le[Lt].y-Ge;$.writeVarint(Yr(Bt)),$.writeVarint(Yr(hr)),Me+=Bt,Ge+=hr}pe===3&&$.writeVarint(Fr(7,1))}}function Se(V,$){var re=typeof V;re==="string"?$.writeStringField(1,V):re==="boolean"?$.writeBooleanField(7,V):re==="number"&&(V%1!=0?$.writeDoubleField(3,V):V<0?$.writeSVarintField(6,V):$.writeVarintField(5,V))}function ke(V,$,re,pe){ut(V,re,pe),ut($,2*re,2*pe),ut($,2*re+1,2*pe+1)}function ut(V,$,re){var pe=V[$];V[$]=V[re],V[re]=pe}function ft(V,$,re,pe){var Me=V-re,Ge=$-pe;return Me*Me+Ge*Ge}at.fromVectorTileJs=Et,at.fromGeojsonVt=function(V,$){$=$||{};var re={};for(var pe in V)re[pe]=new $t(V[pe].features,$),re[pe].name=pe,re[pe].version=$.version,re[pe].extent=$.extent;return Et({layers:re})},at.GeoJSONWrapper=qe;var kt=function(V){return V[0]},Ft=function(V){return V[1]},yr=function(V,$,re,pe,Me){$===void 0&&($=kt),re===void 0&&(re=Ft),pe===void 0&&(pe=64),Me===void 0&&(Me=Float64Array),this.nodeSize=pe,this.points=V;for(var Ge=V.length<65536?Uint16Array:Uint32Array,Qe=this.ids=new Ge(V.length),se=this.coords=new Me(2*V.length),Le=0;Le<V.length;Le++)Qe[Le]=Le,se[2*Le]=$(V[Le]),se[2*Le+1]=re(V[Le]);(function dt(fr,Lt,Bt,hr,_n,fn){if(!(_n-hr<=Bt)){var Mt=hr+_n>>1;(function Jr(Br,Wr,mi,en,dn,Wi){for(;dn>en;){if(dn-en>600){var hi=dn-en+1,wi=mi-en+1,_i=Math.log(hi),ht=.5*Math.exp(2*_i/3),Pt=.5*Math.sqrt(_i*ht*(hi-ht)/hi)*(wi-hi/2<0?-1:1);Jr(Br,Wr,mi,Math.max(en,Math.floor(mi-wi*ht/hi+Pt)),Math.min(dn,Math.floor(mi+(hi-wi)*ht/hi+Pt)),Wi)}var Ta=Wr[2*mi+Wi],Ei=en,Ti=dn;for(ke(Br,Wr,en,mi),Wr[2*dn+Wi]>Ta&&ke(Br,Wr,en,dn);Ei<Ti;){for(ke(Br,Wr,Ei,Ti),Ei++,Ti--;Wr[2*Ei+Wi]<Ta;)Ei++;for(;Wr[2*Ti+Wi]>Ta;)Ti--}Wr[2*en+Wi]===Ta?ke(Br,Wr,en,Ti):ke(Br,Wr,++Ti,dn),Ti<=mi&&(en=Ti+1),mi<=Ti&&(dn=Ti-1)}})(fr,Lt,Mt,hr,_n,fn%2),dt(fr,Lt,Bt,hr,Mt-1,fn+1),dt(fr,Lt,Bt,Mt+1,_n,fn+1)}})(Qe,se,pe,0,Qe.length-1,0)};yr.prototype.range=function(V,$,re,pe){return function(Me,Ge,Qe,se,Le,dt,fr){for(var Lt,Bt,hr=[0,Me.length-1,0],_n=[];hr.length;){var fn=hr.pop(),Mt=hr.pop(),Jr=hr.pop();if(Mt-Jr<=fr)for(var Br=Jr;Br<=Mt;Br++)Bt=Ge[2*Br+1],(Lt=Ge[2*Br])>=Qe&&Lt<=Le&&Bt>=se&&Bt<=dt&&_n.push(Me[Br]);else{var Wr=Math.floor((Jr+Mt)/2);Bt=Ge[2*Wr+1],(Lt=Ge[2*Wr])>=Qe&&Lt<=Le&&Bt>=se&&Bt<=dt&&_n.push(Me[Wr]);var mi=(fn+1)%2;(fn===0?Qe<=Lt:se<=Bt)&&(hr.push(Jr),hr.push(Wr-1),hr.push(mi)),(fn===0?Le>=Lt:dt>=Bt)&&(hr.push(Wr+1),hr.push(Mt),hr.push(mi))}}return _n}(this.ids,this.coords,V,$,re,pe,this.nodeSize)},yr.prototype.within=function(V,$,re){return function(pe,Me,Ge,Qe,se,Le){for(var dt=[0,pe.length-1,0],fr=[],Lt=se*se;dt.length;){var Bt=dt.pop(),hr=dt.pop(),_n=dt.pop();if(hr-_n<=Le)for(var fn=_n;fn<=hr;fn++)ft(Me[2*fn],Me[2*fn+1],Ge,Qe)<=Lt&&fr.push(pe[fn]);else{var Mt=Math.floor((_n+hr)/2),Jr=Me[2*Mt],Br=Me[2*Mt+1];ft(Jr,Br,Ge,Qe)<=Lt&&fr.push(pe[Mt]);var Wr=(Bt+1)%2;(Bt===0?Ge-se<=Jr:Qe-se<=Br)&&(dt.push(_n),dt.push(Mt-1),dt.push(Wr)),(Bt===0?Ge+se>=Jr:Qe+se>=Br)&&(dt.push(Mt+1),dt.push(hr),dt.push(Wr))}}return fr}(this.ids,this.coords,V,$,re,this.nodeSize)};var Yn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(V){return V}},Gr=function(V){this.options=na(Object.create(Yn),V),this.trees=new Array(this.options.maxZoom+1)};function Nn(V,$,re,pe,Me){return{x:V,y:$,zoom:1/0,id:re,parentId:-1,numPoints:pe,properties:Me}}function yn(V,$){var re=V.geometry.coordinates,pe=re[1];return{x:Gn(re[0]),y:fi(pe),zoom:1/0,index:$,parentId:-1}}function zn(V){return{type:"Feature",id:V.id,properties:si(V),geometry:{type:"Point",coordinates:[(pe=V.x,360*(pe-.5)),($=V.y,re=(180-360*$)*Math.PI/180,360*Math.atan(Math.exp(re))/Math.PI-90)]}};var $,re,pe}function si(V){var $=V.numPoints,re=$>=1e4?Math.round($/1e3)+"k":$>=1e3?Math.round($/100)/10+"k":$;return na(na({},V.properties),{cluster:!0,cluster_id:V.id,point_count:$,point_count_abbreviated:re})}function Gn(V){return V/360+.5}function fi(V){var $=Math.sin(V*Math.PI/180),re=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return re<0?0:re>1?1:re}function na(V,$){for(var re in $)V[re]=$[re];return V}function Ui(V){return V.x}function Ii(V){return V.y}function $i(V,$,re,pe,Me,Ge){var Qe=Me-re,se=Ge-pe;if(Qe!==0||se!==0){var Le=((V-re)*Qe+($-pe)*se)/(Qe*Qe+se*se);Le>1?(re=Me,pe=Ge):Le>0&&(re+=Qe*Le,pe+=se*Le)}return(Qe=V-re)*Qe+(se=$-pe)*se}function ia(V,$,re,pe){var Me={id:V===void 0?null:V,type:$,geometry:re,tags:pe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ge){var Qe=Ge.geometry,se=Ge.type;if(se==="Point"||se==="MultiPoint"||se==="LineString")qa(Ge,Qe);else if(se==="Polygon"||se==="MultiLineString")for(var Le=0;Le<Qe.length;Le++)qa(Ge,Qe[Le]);else if(se==="MultiPolygon")for(Le=0;Le<Qe.length;Le++)for(var dt=0;dt<Qe[Le].length;dt++)qa(Ge,Qe[Le][dt])}(Me),Me}function qa(V,$){for(var re=0;re<$.length;re+=3)V.minX=Math.min(V.minX,$[re]),V.minY=Math.min(V.minY,$[re+1]),V.maxX=Math.max(V.maxX,$[re]),V.maxY=Math.max(V.maxY,$[re+1])}function aa(V,$,re,pe){if($.geometry){var Me=$.geometry.coordinates,Ge=$.geometry.type,Qe=Math.pow(re.tolerance/((1<<re.maxZoom)*re.extent),2),se=[],Le=$.id;if(re.promoteId?Le=$.properties[re.promoteId]:re.generateId&&(Le=pe||0),Ge==="Point")oa(Me,se);else if(Ge==="MultiPoint")for(var dt=0;dt<Me.length;dt++)oa(Me[dt],se);else if(Ge==="LineString")Li(Me,se,Qe,!1);else if(Ge==="MultiLineString"){if(re.lineMetrics){for(dt=0;dt<Me.length;dt++)Li(Me[dt],se=[],Qe,!1),V.push(ia(Le,"LineString",se,$.properties));return}Ki(Me,se,Qe,!1)}else if(Ge==="Polygon")Ki(Me,se,Qe,!0);else{if(Ge!=="MultiPolygon"){if(Ge==="GeometryCollection"){for(dt=0;dt<$.geometry.geometries.length;dt++)aa(V,{id:Le,geometry:$.geometry.geometries[dt],properties:$.properties},re,pe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(dt=0;dt<Me.length;dt++){var fr=[];Ki(Me[dt],fr,Qe,!0),se.push(fr)}}V.push(ia(Le,Ge,se,$.properties))}}function oa(V,$){$.push(Hi(V[0])),$.push(Ts(V[1])),$.push(0)}function Li(V,$,re,pe){for(var Me,Ge,Qe=0,se=0;se<V.length;se++){var Le=Hi(V[se][0]),dt=Ts(V[se][1]);$.push(Le),$.push(dt),$.push(0),se>0&&(Qe+=pe?(Me*dt-Le*Ge)/2:Math.sqrt(Math.pow(Le-Me,2)+Math.pow(dt-Ge,2))),Me=Le,Ge=dt}var fr=$.length-3;$[2]=1,function Lt(Bt,hr,_n,fn){for(var Mt,Jr=fn,Br=_n-hr>>1,Wr=_n-hr,mi=Bt[hr],en=Bt[hr+1],dn=Bt[_n],Wi=Bt[_n+1],hi=hr+3;hi<_n;hi+=3){var wi=$i(Bt[hi],Bt[hi+1],mi,en,dn,Wi);if(wi>Jr)Mt=hi,Jr=wi;else if(wi===Jr){var _i=Math.abs(hi-Br);_i<Wr&&(Mt=hi,Wr=_i)}}Jr>fn&&(Mt-hr>3&&Lt(Bt,hr,Mt,fn),Bt[Mt+2]=Jr,_n-Mt>3&&Lt(Bt,Mt,_n,fn))}($,0,fr,re),$[fr+2]=1,$.size=Math.abs(Qe),$.start=0,$.end=$.size}function Ki(V,$,re,pe){for(var Me=0;Me<V.length;Me++){var Ge=[];Li(V[Me],Ge,re,pe),$.push(Ge)}}function Hi(V){return V/360+.5}function Ts(V){var $=Math.sin(V*Math.PI/180),re=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return re<0?0:re>1?1:re}function fe(V,$,re,pe,Me,Ge,Qe,se){if(pe/=$,Ge>=(re/=$)&&Qe<pe)return V;if(Qe<re||Ge>=pe)return null;for(var Le=[],dt=0;dt<V.length;dt++){var fr=V[dt],Lt=fr.geometry,Bt=fr.type,hr=Me===0?fr.minX:fr.minY,_n=Me===0?fr.maxX:fr.maxY;if(hr>=re&&_n<pe)Le.push(fr);else if(!(_n<re||hr>=pe)){var fn=[];if(Bt==="Point"||Bt==="MultiPoint")ui(Lt,fn,re,pe,Me);else if(Bt==="LineString")bo(Lt,fn,re,pe,Me,!1,se.lineMetrics);else if(Bt==="MultiLineString")Zt(Lt,fn,re,pe,Me,!1);else if(Bt==="Polygon")Zt(Lt,fn,re,pe,Me,!0);else if(Bt==="MultiPolygon")for(var Mt=0;Mt<Lt.length;Mt++){var Jr=[];Zt(Lt[Mt],Jr,re,pe,Me,!0),Jr.length&&fn.push(Jr)}if(fn.length){if(se.lineMetrics&&Bt==="LineString"){for(Mt=0;Mt<fn.length;Mt++)Le.push(ia(fr.id,Bt,fn[Mt],fr.tags));continue}Bt!=="LineString"&&Bt!=="MultiLineString"||(fn.length===1?(Bt="LineString",fn=fn[0]):Bt="MultiLineString"),Bt!=="Point"&&Bt!=="MultiPoint"||(Bt=fn.length===3?"Point":"MultiPoint"),Le.push(ia(fr.id,Bt,fn,fr.tags))}}}return Le.length?Le:null}function ui(V,$,re,pe,Me){for(var Ge=0;Ge<V.length;Ge+=3){var Qe=V[Ge+Me];Qe>=re&&Qe<=pe&&($.push(V[Ge]),$.push(V[Ge+1]),$.push(V[Ge+2]))}}function bo(V,$,re,pe,Me,Ge,Qe){for(var se,Le,dt=cu(V),fr=Me===0?Rr:an,Lt=V.start,Bt=0;Bt<V.length-3;Bt+=3){var hr=V[Bt],_n=V[Bt+1],fn=V[Bt+2],Mt=V[Bt+3],Jr=V[Bt+4],Br=Me===0?hr:_n,Wr=Me===0?Mt:Jr,mi=!1;Qe&&(se=Math.sqrt(Math.pow(hr-Mt,2)+Math.pow(_n-Jr,2))),Br<re?Wr>re&&(Le=fr(dt,hr,_n,Mt,Jr,re),Qe&&(dt.start=Lt+se*Le)):Br>pe?Wr<pe&&(Le=fr(dt,hr,_n,Mt,Jr,pe),Qe&&(dt.start=Lt+se*Le)):er(dt,hr,_n,fn),Wr<re&&Br>=re&&(Le=fr(dt,hr,_n,Mt,Jr,re),mi=!0),Wr>pe&&Br<=pe&&(Le=fr(dt,hr,_n,Mt,Jr,pe),mi=!0),!Ge&&mi&&(Qe&&(dt.end=Lt+se*Le),$.push(dt),dt=cu(V)),Qe&&(Lt+=se)}var en=V.length-3;hr=V[en],_n=V[en+1],fn=V[en+2],(Br=Me===0?hr:_n)>=re&&Br<=pe&&er(dt,hr,_n,fn),en=dt.length-3,Ge&&en>=3&&(dt[en]!==dt[0]||dt[en+1]!==dt[1])&&er(dt,dt[0],dt[1],dt[2]),dt.length&&$.push(dt)}function cu(V){var $=[];return $.size=V.size,$.start=V.start,$.end=V.end,$}function Zt(V,$,re,pe,Me,Ge){for(var Qe=0;Qe<V.length;Qe++)bo(V[Qe],$,re,pe,Me,Ge,!1)}function er(V,$,re,pe){V.push($),V.push(re),V.push(pe)}function Rr(V,$,re,pe,Me,Ge){var Qe=(Ge-$)/(pe-$);return V.push(Ge),V.push(re+(Me-re)*Qe),V.push(1),Qe}function an(V,$,re,pe,Me,Ge){var Qe=(Ge-re)/(Me-re);return V.push($+(pe-$)*Qe),V.push(Ge),V.push(1),Qe}function Mn(V,$){for(var re=[],pe=0;pe<V.length;pe++){var Me,Ge=V[pe],Qe=Ge.type;if(Qe==="Point"||Qe==="MultiPoint"||Qe==="LineString")Me=Un(Ge.geometry,$);else if(Qe==="MultiLineString"||Qe==="Polygon"){Me=[];for(var se=0;se<Ge.geometry.length;se++)Me.push(Un(Ge.geometry[se],$))}else if(Qe==="MultiPolygon")for(Me=[],se=0;se<Ge.geometry.length;se++){for(var Le=[],dt=0;dt<Ge.geometry[se].length;dt++)Le.push(Un(Ge.geometry[se][dt],$));Me.push(Le)}re.push(ia(Ge.id,Qe,Me,Ge.tags))}return re}function Un(V,$){var re=[];re.size=V.size,V.start!==void 0&&(re.start=V.start,re.end=V.end);for(var pe=0;pe<V.length;pe+=3)re.push(V[pe]+$,V[pe+1],V[pe+2]);return re}function bi(V,$){if(V.transformed)return V;var re,pe,Me,Ge=1<<V.z,Qe=V.x,se=V.y;for(re=0;re<V.features.length;re++){var Le=V.features[re],dt=Le.geometry,fr=Le.type;if(Le.geometry=[],fr===1)for(pe=0;pe<dt.length;pe+=2)Le.geometry.push(vi(dt[pe],dt[pe+1],$,Ge,Qe,se));else for(pe=0;pe<dt.length;pe++){var Lt=[];for(Me=0;Me<dt[pe].length;Me+=2)Lt.push(vi(dt[pe][Me],dt[pe][Me+1],$,Ge,Qe,se));Le.geometry.push(Lt)}}return V.transformed=!0,V}function vi(V,$,re,pe,Me,Ge){return[Math.round(re*(V*pe-Me)),Math.round(re*($*pe-Ge))]}function Sn(V,$,re,pe,Me){for(var Ge=$===Me.maxZoom?0:Me.tolerance/((1<<$)*Me.extent),Qe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:re,y:pe,z:$,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},se=0;se<V.length;se++){Qe.numFeatures++,Di(Qe,V[se],Ge,Me);var Le=V[se].minX,dt=V[se].minY,fr=V[se].maxX,Lt=V[se].maxY;Le<Qe.minX&&(Qe.minX=Le),dt<Qe.minY&&(Qe.minY=dt),fr>Qe.maxX&&(Qe.maxX=fr),Lt>Qe.maxY&&(Qe.maxY=Lt)}return Qe}function Di(V,$,re,pe){var Me=$.geometry,Ge=$.type,Qe=[];if(Ge==="Point"||Ge==="MultiPoint")for(var se=0;se<Me.length;se+=3)Qe.push(Me[se]),Qe.push(Me[se+1]),V.numPoints++,V.numSimplified++;else if(Ge==="LineString")Ri(Qe,Me,V,re,!1,!1);else if(Ge==="MultiLineString"||Ge==="Polygon")for(se=0;se<Me.length;se++)Ri(Qe,Me[se],V,re,Ge==="Polygon",se===0);else if(Ge==="MultiPolygon")for(var Le=0;Le<Me.length;Le++){var dt=Me[Le];for(se=0;se<dt.length;se++)Ri(Qe,dt[se],V,re,!0,se===0)}if(Qe.length){var fr=$.tags||null;if(Ge==="LineString"&&pe.lineMetrics){for(var Lt in fr={},$.tags)fr[Lt]=$.tags[Lt];fr.mapbox_clip_start=Me.start/Me.size,fr.mapbox_clip_end=Me.end/Me.size}var Bt={geometry:Qe,type:Ge==="Polygon"||Ge==="MultiPolygon"?3:Ge==="LineString"||Ge==="MultiLineString"?2:1,tags:fr};$.id!==null&&(Bt.id=$.id),V.features.push(Bt)}}function Ri(V,$,re,pe,Me,Ge){var Qe=pe*pe;if(pe>0&&$.size<(Me?Qe:pe))re.numPoints+=$.length/3;else{for(var se=[],Le=0;Le<$.length;Le+=3)(pe===0||$[Le+2]>Qe)&&(re.numSimplified++,se.push($[Le]),se.push($[Le+1])),re.numPoints++;Me&&function(dt,fr){for(var Lt=0,Bt=0,hr=dt.length,_n=hr-2;Bt<hr;_n=Bt,Bt+=2)Lt+=(dt[Bt]-dt[_n])*(dt[Bt+1]+dt[_n+1]);if(Lt>0===fr)for(Bt=0,hr=dt.length;Bt<hr/2;Bt+=2){var fn=dt[Bt],Mt=dt[Bt+1];dt[Bt]=dt[hr-2-Bt],dt[Bt+1]=dt[hr-1-Bt],dt[hr-2-Bt]=fn,dt[hr-1-Bt]=Mt}}(se,Ge),V.push(se)}}function ao(V,$){var re=($=this.options=function(Me,Ge){for(var Qe in Ge)Me[Qe]=Ge[Qe];return Me}(Object.create(this.options),$)).debug;if(re&&console.time("preprocess data"),$.maxZoom<0||$.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if($.promoteId&&$.generateId)throw new Error("promoteId and generateId cannot be used together.");var pe=function(Me,Ge){var Qe=[];if(Me.type==="FeatureCollection")for(var se=0;se<Me.features.length;se++)aa(Qe,Me.features[se],Ge,se);else aa(Qe,Me.type==="Feature"?Me:{geometry:Me},Ge);return Qe}(V,$);this.tiles={},this.tileCoords=[],re&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",$.indexMaxZoom,$.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(pe=function(Me,Ge){var Qe=Ge.buffer/Ge.extent,se=Me,Le=fe(Me,1,-1-Qe,Qe,0,-1,2,Ge),dt=fe(Me,1,1-Qe,2+Qe,0,-1,2,Ge);return(Le||dt)&&(se=fe(Me,1,-Qe,1+Qe,0,-1,2,Ge)||[],Le&&(se=Mn(Le,1).concat(se)),dt&&(se=se.concat(Mn(dt,-1)))),se}(pe,$)).length&&this.splitTile(pe,0,0,0),re&&(pe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function gs(V,$,re){return 32*((1<<V)*re+$)+V}function Zo(V,$){var re=V.tileID.canonical;if(!this._geoJSONIndex)return $(null,null);var pe=this._geoJSONIndex.getTile(re.z,re.x,re.y);if(!pe)return $(null,null);var Me=new ct(pe.features),Ge=at(Me);Ge.byteOffset===0&&Ge.byteLength===Ge.buffer.byteLength||(Ge=new Uint8Array(Ge)),$(null,{vectorTile:Me,rawData:Ge.buffer})}Gr.prototype.load=function(V){var $=this.options,re=$.log,pe=$.minZoom,Me=$.maxZoom,Ge=$.nodeSize;re&&console.time("total time");var Qe="prepare "+V.length+" points";re&&console.time(Qe),this.points=V;for(var se=[],Le=0;Le<V.length;Le++)V[Le].geometry&&se.push(yn(V[Le],Le));this.trees[Me+1]=new yr(se,Ui,Ii,Ge,Float32Array),re&&console.timeEnd(Qe);for(var dt=Me;dt>=pe;dt--){var fr=+Date.now();se=this._cluster(se,dt),this.trees[dt]=new yr(se,Ui,Ii,Ge,Float32Array),re&&console.log("z%d: %d clusters in %dms",dt,se.length,+Date.now()-fr)}return re&&console.timeEnd("total time"),this},Gr.prototype.getClusters=function(V,$){var re=((V[0]+180)%360+360)%360-180,pe=Math.max(-90,Math.min(90,V[1])),Me=V[2]===180?180:((V[2]+180)%360+360)%360-180,Ge=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)re=-180,Me=180;else if(re>Me){var Qe=this.getClusters([re,pe,180,Ge],$),se=this.getClusters([-180,pe,Me,Ge],$);return Qe.concat(se)}for(var Le=this.trees[this._limitZoom($)],dt=[],fr=0,Lt=Le.range(Gn(re),fi(Ge),Gn(Me),fi(pe));fr<Lt.length;fr+=1){var Bt=Le.points[Lt[fr]];dt.push(Bt.numPoints?zn(Bt):this.points[Bt.index])}return dt},Gr.prototype.getChildren=function(V){var $=this._getOriginId(V),re=this._getOriginZoom(V),pe="No cluster with the specified id.",Me=this.trees[re];if(!Me)throw new Error(pe);var Ge=Me.points[$];if(!Ge)throw new Error(pe);for(var Qe=this.options.radius/(this.options.extent*Math.pow(2,re-1)),se=[],Le=0,dt=Me.within(Ge.x,Ge.y,Qe);Le<dt.length;Le+=1){var fr=Me.points[dt[Le]];fr.parentId===V&&se.push(fr.numPoints?zn(fr):this.points[fr.index])}if(se.length===0)throw new Error(pe);return se},Gr.prototype.getLeaves=function(V,$,re){var pe=[];return this._appendLeaves(pe,V,$=$||10,re=re||0,0),pe},Gr.prototype.getTile=function(V,$,re){var pe=this.trees[this._limitZoom(V)],Me=Math.pow(2,V),Ge=this.options,Qe=Ge.radius/Ge.extent,se=(re-Qe)/Me,Le=(re+1+Qe)/Me,dt={features:[]};return this._addTileFeatures(pe.range(($-Qe)/Me,se,($+1+Qe)/Me,Le),pe.points,$,re,Me,dt),$===0&&this._addTileFeatures(pe.range(1-Qe/Me,se,1,Le),pe.points,Me,re,Me,dt),$===Me-1&&this._addTileFeatures(pe.range(0,se,Qe/Me,Le),pe.points,-1,re,Me,dt),dt.features.length?dt:null},Gr.prototype.getClusterExpansionZoom=function(V){for(var $=this._getOriginZoom(V)-1;$<=this.options.maxZoom;){var re=this.getChildren(V);if($++,re.length!==1)break;V=re[0].properties.cluster_id}return $},Gr.prototype._appendLeaves=function(V,$,re,pe,Me){for(var Ge=0,Qe=this.getChildren($);Ge<Qe.length;Ge+=1){var se=Qe[Ge],Le=se.properties;if(Le&&Le.cluster?Me+Le.point_count<=pe?Me+=Le.point_count:Me=this._appendLeaves(V,Le.cluster_id,re,pe,Me):Me<pe?Me++:V.push(se),V.length===re)break}return Me},Gr.prototype._addTileFeatures=function(V,$,re,pe,Me,Ge){for(var Qe=0,se=V;Qe<se.length;Qe+=1){var Le=$[se[Qe]],dt=Le.numPoints,fr={type:1,geometry:[[Math.round(this.options.extent*(Le.x*Me-re)),Math.round(this.options.extent*(Le.y*Me-pe))]],tags:dt?si(Le):this.points[Le.index].properties},Lt=void 0;dt?Lt=Le.id:this.options.generateId?Lt=Le.index:this.points[Le.index].id&&(Lt=this.points[Le.index].id),Lt!==void 0&&(fr.id=Lt),Ge.features.push(fr)}},Gr.prototype._limitZoom=function(V){return Math.max(this.options.minZoom,Math.min(+V,this.options.maxZoom+1))},Gr.prototype._cluster=function(V,$){for(var re=[],pe=this.options,Me=pe.reduce,Ge=pe.minPoints,Qe=pe.radius/(pe.extent*Math.pow(2,$)),se=0;se<V.length;se++){var Le=V[se];if(!(Le.zoom<=$)){Le.zoom=$;for(var dt=this.trees[$+1],fr=dt.within(Le.x,Le.y,Qe),Lt=Le.numPoints||1,Bt=Lt,hr=0,_n=fr;hr<_n.length;hr+=1){var fn=dt.points[_n[hr]];fn.zoom>$&&(Bt+=fn.numPoints||1)}if(Bt>=Ge){for(var Mt=Le.x*Lt,Jr=Le.y*Lt,Br=Me&&Lt>1?this._map(Le,!0):null,Wr=(se<<5)+($+1)+this.points.length,mi=0,en=fr;mi<en.length;mi+=1){var dn=dt.points[en[mi]];if(!(dn.zoom<=$)){dn.zoom=$;var Wi=dn.numPoints||1;Mt+=dn.x*Wi,Jr+=dn.y*Wi,dn.parentId=Wr,Me&&(Br||(Br=this._map(Le,!0)),Me(Br,this._map(dn)))}}Le.parentId=Wr,re.push(Nn(Mt/Bt,Jr/Bt,Wr,Bt,Br))}else if(re.push(Le),Bt>1)for(var hi=0,wi=fr;hi<wi.length;hi+=1){var _i=dt.points[wi[hi]];_i.zoom<=$||(_i.zoom=$,re.push(_i))}}}return re},Gr.prototype._getOriginId=function(V){return V-this.points.length>>5},Gr.prototype._getOriginZoom=function(V){return(V-this.points.length)%32},Gr.prototype._map=function(V,$){if(V.numPoints)return $?na({},V.properties):V.properties;var re=this.points[V.index].properties,pe=this.options.map(re);return $&&pe===re?na({},pe):pe},ao.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ao.prototype.splitTile=function(V,$,re,pe,Me,Ge,Qe){for(var se=[V,$,re,pe],Le=this.options,dt=Le.debug;se.length;){pe=se.pop(),re=se.pop(),$=se.pop(),V=se.pop();var fr=1<<$,Lt=gs($,re,pe),Bt=this.tiles[Lt];if(!Bt&&(dt>1&&console.time("creation"),Bt=this.tiles[Lt]=Sn(V,$,re,pe,Le),this.tileCoords.push({z:$,x:re,y:pe}),dt)){dt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",$,re,pe,Bt.numFeatures,Bt.numPoints,Bt.numSimplified),console.timeEnd("creation"));var hr="z"+$;this.stats[hr]=(this.stats[hr]||0)+1,this.total++}if(Bt.source=V,Me){if($===Le.maxZoom||$===Me)continue;var _n=1<<Me-$;if(re!==Math.floor(Ge/_n)||pe!==Math.floor(Qe/_n))continue}else if($===Le.indexMaxZoom||Bt.numPoints<=Le.indexMaxPoints)continue;if(Bt.source=null,V.length!==0){dt>1&&console.time("clipping");var fn,Mt,Jr,Br,Wr,mi,en=.5*Le.buffer/Le.extent,dn=.5-en,Wi=.5+en,hi=1+en;fn=Mt=Jr=Br=null,Wr=fe(V,fr,re-en,re+Wi,0,Bt.minX,Bt.maxX,Le),mi=fe(V,fr,re+dn,re+hi,0,Bt.minX,Bt.maxX,Le),V=null,Wr&&(fn=fe(Wr,fr,pe-en,pe+Wi,1,Bt.minY,Bt.maxY,Le),Mt=fe(Wr,fr,pe+dn,pe+hi,1,Bt.minY,Bt.maxY,Le),Wr=null),mi&&(Jr=fe(mi,fr,pe-en,pe+Wi,1,Bt.minY,Bt.maxY,Le),Br=fe(mi,fr,pe+dn,pe+hi,1,Bt.minY,Bt.maxY,Le),mi=null),dt>1&&console.timeEnd("clipping"),se.push(fn||[],$+1,2*re,2*pe),se.push(Mt||[],$+1,2*re,2*pe+1),se.push(Jr||[],$+1,2*re+1,2*pe),se.push(Br||[],$+1,2*re+1,2*pe+1)}}},ao.prototype.getTile=function(V,$,re){var pe=this.options,Me=pe.extent,Ge=pe.debug;if(V<0||V>24)return null;var Qe=1<<V,se=gs(V,$=($%Qe+Qe)%Qe,re);if(this.tiles[se])return bi(this.tiles[se],Me);Ge>1&&console.log("drilling down to z%d-%d-%d",V,$,re);for(var Le,dt=V,fr=$,Lt=re;!Le&&dt>0;)dt--,fr=Math.floor(fr/2),Lt=Math.floor(Lt/2),Le=this.tiles[gs(dt,fr,Lt)];return Le&&Le.source?(Ge>1&&console.log("found parent tile z%d-%d-%d",dt,fr,Lt),Ge>1&&console.time("drilling down"),this.splitTile(Le.source,dt,fr,Lt,V,$,re),Ge>1&&console.timeEnd("drilling down"),this.tiles[se]?bi(this.tiles[se],Me):null):null};var Na=function(V){function $(re,pe,Me,Ge){V.call(this,re,pe,Me,Zo),Ge&&(this.loadGeoJSON=Ge)}return V&&($.__proto__=V),($.prototype=Object.create(V&&V.prototype)).constructor=$,$.prototype.loadData=function(re,pe){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=pe,this._pendingLoadDataParams=re,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},$.prototype._loadData=function(){var re=this;if(this._pendingCallback&&this._pendingLoadDataParams){var pe=this._pendingCallback,Me=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var Ge=!!(Me&&Me.request&&Me.request.collectResourceTiming)&&new g.RequestPerformance(Me.request);this.loadGeoJSON(Me,function(Qe,se){if(Qe||!se)return pe(Qe);if(typeof se!="object")return pe(new Error("Input data given to '"+Me.source+"' is not a valid GeoJSON object."));(function Bt(hr,_n){var fn,Mt=hr&&hr.type;if(Mt==="FeatureCollection")for(fn=0;fn<hr.features.length;fn++)Bt(hr.features[fn],_n);else if(Mt==="GeometryCollection")for(fn=0;fn<hr.geometries.length;fn++)Bt(hr.geometries[fn],_n);else if(Mt==="Feature")Bt(hr.geometry,_n);else if(Mt==="Polygon")or(hr.coordinates,_n);else if(Mt==="MultiPolygon")for(fn=0;fn<hr.coordinates.length;fn++)or(hr.coordinates[fn],_n);return hr})(se,!0);try{if(Me.filter){var Le=g.createExpression(Me.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Le.result==="error")throw new Error(Le.value.map(function(Bt){return Bt.key+": "+Bt.message}).join(", "));var dt=se.features.filter(function(Bt){return Le.value.evaluate({zoom:0},Bt)});se={type:"FeatureCollection",features:dt}}re._geoJSONIndex=Me.cluster?new Gr(function(Bt){var hr=Bt.superclusterOptions,_n=Bt.clusterProperties;if(!_n||!hr)return hr;for(var fn={},Mt={},Jr={accumulated:null,zoom:0},Br={properties:null},Wr=Object.keys(_n),mi=0,en=Wr;mi<en.length;mi+=1){var dn=en[mi],Wi=_n[dn],hi=Wi[0],wi=g.createExpression(Wi[1]),_i=g.createExpression(typeof hi=="string"?[hi,["accumulated"],["get",dn]]:hi);fn[dn]=wi.value,Mt[dn]=_i.value}return hr.map=function(ht){Br.properties=ht;for(var Pt={},Ta=0,Ei=Wr;Ta<Ei.length;Ta+=1){var Ti=Ei[Ta];Pt[Ti]=fn[Ti].evaluate(Jr,Br)}return Pt},hr.reduce=function(ht,Pt){Br.properties=Pt;for(var Ta=0,Ei=Wr;Ta<Ei.length;Ta+=1){var Ti=Ei[Ta];Jr.accumulated=ht[Ti],ht[Ti]=Mt[Ti].evaluate(Jr,Br)}},hr}(Me)).load(se.features):function(Bt,hr){return new ao(Bt,hr)}(se,Me.geojsonVtOptions)}catch(Bt){return pe(Bt)}re.loaded={};var fr={};if(Ge){var Lt=Ge.finish();Lt&&(fr.resourceTiming={},fr.resourceTiming[Me.source]=JSON.parse(JSON.stringify(Lt)))}pe(null,fr)})}},$.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},$.prototype.reloadTile=function(re,pe){var Me=this.loaded;return Me&&Me[re.uid]?V.prototype.reloadTile.call(this,re,pe):this.loadTile(re,pe)},$.prototype.loadGeoJSON=function(re,pe){if(re.request)g.getJSON(re.request,pe);else{if(typeof re.data!="string")return pe(new Error("Input data given to '"+re.source+"' is not a valid GeoJSON object."));try{return pe(null,JSON.parse(re.data))}catch(Me){return pe(new Error("Input data given to '"+re.source+"' is not a valid GeoJSON object."))}}},$.prototype.removeSource=function(re,pe){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),pe()},$.prototype.getClusterExpansionZoom=function(re,pe){try{pe(null,this._geoJSONIndex.getClusterExpansionZoom(re.clusterId))}catch(Me){pe(Me)}},$.prototype.getClusterChildren=function(re,pe){try{pe(null,this._geoJSONIndex.getChildren(re.clusterId))}catch(Me){pe(Me)}},$.prototype.getClusterLeaves=function(re,pe){try{pe(null,this._geoJSONIndex.getLeaves(re.clusterId,re.limit,re.offset))}catch(Me){pe(Me)}},$}(mt),ba=function(V){var $=this;this.self=V,this.actor=new g.Actor(V,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:mt,geojson:Na},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(re,pe){if($.workerSourceTypes[re])throw new Error('Worker source with name "'+re+'" already registered.');$.workerSourceTypes[re]=pe},this.self.registerRTLTextPlugin=function(re){if(g.plugin.isParsed())throw new Error("RTL text plugin already registered.");g.plugin.applyArabicShaping=re.applyArabicShaping,g.plugin.processBidirectionalText=re.processBidirectionalText,g.plugin.processStyledBidirectionalText=re.processStyledBidirectionalText}};return ba.prototype.setReferrer=function(V,$){this.referrer=$},ba.prototype.setImages=function(V,$,re){for(var pe in this.availableImages[V]=$,this.workerSources[V]){var Me=this.workerSources[V][pe];for(var Ge in Me)Me[Ge].availableImages=$}re()},ba.prototype.setLayers=function(V,$,re){this.getLayerIndex(V).replace($),re()},ba.prototype.updateLayers=function(V,$,re){this.getLayerIndex(V).update($.layers,$.removedIds),re()},ba.prototype.loadTile=function(V,$,re){this.getWorkerSource(V,$.type,$.source).loadTile($,re)},ba.prototype.loadDEMTile=function(V,$,re){this.getDEMWorkerSource(V,$.source).loadTile($,re)},ba.prototype.reloadTile=function(V,$,re){this.getWorkerSource(V,$.type,$.source).reloadTile($,re)},ba.prototype.abortTile=function(V,$,re){this.getWorkerSource(V,$.type,$.source).abortTile($,re)},ba.prototype.removeTile=function(V,$,re){this.getWorkerSource(V,$.type,$.source).removeTile($,re)},ba.prototype.removeDEMTile=function(V,$){this.getDEMWorkerSource(V,$.source).removeTile($)},ba.prototype.removeSource=function(V,$,re){if(this.workerSources[V]&&this.workerSources[V][$.type]&&this.workerSources[V][$.type][$.source]){var pe=this.workerSources[V][$.type][$.source];delete this.workerSources[V][$.type][$.source],pe.removeSource!==void 0?pe.removeSource($,re):re()}},ba.prototype.loadWorkerSource=function(V,$,re){try{this.self.importScripts($.url),re()}catch(pe){re(pe.toString())}},ba.prototype.syncRTLPluginState=function(V,$,re){try{g.plugin.setState($);var pe=g.plugin.getPluginURL();if(g.plugin.isLoaded()&&!g.plugin.isParsed()&&pe!=null){this.self.importScripts(pe);var Me=g.plugin.isParsed();re(Me?void 0:new Error("RTL Text Plugin failed to import scripts from "+pe),Me)}}catch(Ge){re(Ge.toString())}},ba.prototype.getAvailableImages=function(V){var $=this.availableImages[V];return $||($=[]),$},ba.prototype.getLayerIndex=function(V){var $=this.layerIndexes[V];return $||($=this.layerIndexes[V]=new he),$},ba.prototype.getWorkerSource=function(V,$,re){var pe=this;return this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][$]||(this.workerSources[V][$]={}),this.workerSources[V][$][re]||(this.workerSources[V][$][re]=new this.workerSourceTypes[$]({send:function(Me,Ge,Qe){pe.actor.send(Me,Ge,Qe,V)}},this.getLayerIndex(V),this.getAvailableImages(V))),this.workerSources[V][$][re]},ba.prototype.getDEMWorkerSource=function(V,$){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][$]||(this.demWorkerSources[V][$]=new Nt),this.demWorkerSources[V][$]},ba.prototype.enforceCacheSizeLimit=function(V,$){g.enforceCacheSizeLimit($)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new ba(self)),ba}),me(["./shared"],function(g){"use strict";var Re=g.createCommonjsModule(function(l){function h(E){return!c(E)}function c(E){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var P,L,U=new Blob([""],{type:"text/javascript"}),H=URL.createObjectURL(U);try{L=new Worker(H),P=!0}catch(oe){P=!1}return L&&L.terminate(),URL.revokeObjectURL(H),P}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var P=document.createElement("canvas");P.width=P.height=1;var L=P.getContext("2d");if(!L)return!1;var U=L.getImageData(0,0,1,1);return U&&U.width===P.width}()?(d[w=E&&E.failIfMajorPerformanceCaveat]===void 0&&(d[w]=function(P){var L=function(H){var oe=document.createElement("canvas"),ue=Object.create(h.webGLContextAttributes);return ue.failIfMajorPerformanceCaveat=H,oe.probablySupportsContext?oe.probablySupportsContext("webgl",ue)||oe.probablySupportsContext("experimental-webgl",ue):oe.supportsContext?oe.supportsContext("webgl",ue)||oe.supportsContext("experimental-webgl",ue):oe.getContext("webgl",ue)||oe.getContext("experimental-webgl",ue)}(P);if(!L)return!1;var U=L.createShader(L.VERTEX_SHADER);return!(!U||L.isContextLost())&&(L.shaderSource(U,"void main() {}"),L.compileShader(U),L.getShaderParameter(U,L.COMPILE_STATUS)===!0)}(w)),d[w]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var w}l.exports?l.exports=h:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=h,window.mapboxgl.notSupportedReason=c);var d={};h.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),W={create:function(l,h,c){var d=g.window.document.createElement(l);return h!==void 0&&(d.className=h),c&&c.appendChild(d),d},createNS:function(l,h){return g.window.document.createElementNS(l,h)}},he=g.window.document&&g.window.document.documentElement.style;function de(l){if(!he)return l[0];for(var h=0;h<l.length;h++)if(l[h]in he)return l[h];return l[0]}var ze,_e=de(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);W.disableDrag=function(){he&&_e&&(ze=he[_e],he[_e]="none")},W.enableDrag=function(){he&&_e&&(he[_e]=ze)};var tt=de(["transform","WebkitTransform"]);W.setTransform=function(l,h){l.style[tt]=h};var mt=!1;try{var wt=Object.defineProperty({},"passive",{get:function(){mt=!0}});g.window.addEventListener("test",wt,wt),g.window.removeEventListener("test",wt,wt)}catch(l){mt=!1}W.addEventListener=function(l,h,c,d){d===void 0&&(d={}),l.addEventListener(h,c,"passive"in d&&mt?d:d.capture)},W.removeEventListener=function(l,h,c,d){d===void 0&&(d={}),l.removeEventListener(h,c,"passive"in d&&mt?d:d.capture)};var Nt=function(l){l.preventDefault(),l.stopPropagation(),g.window.removeEventListener("click",Nt,!0)};function or(l){var h=l.userImage;return!!(h&&h.render&&h.render())&&(l.data.replace(new Uint8Array(h.data.buffer)),!0)}W.suppressClick=function(){g.window.addEventListener("click",Nt,!0),g.window.setTimeout(function(){g.window.removeEventListener("click",Nt,!0)},0)},W.mousePos=function(l,h){var c=l.getBoundingClientRect();return new g.Point(h.clientX-c.left-l.clientLeft,h.clientY-c.top-l.clientTop)},W.touchPos=function(l,h){for(var c=l.getBoundingClientRect(),d=[],E=0;E<h.length;E++)d.push(new g.Point(h[E].clientX-c.left-l.clientLeft,h[E].clientY-c.top-l.clientTop));return d},W.mouseButton=function(l){return g.window.InstallTrigger!==void 0&&l.button===2&&l.ctrlKey&&g.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:l.button},W.remove=function(l){l.parentNode&&l.parentNode.removeChild(l)};var Tt=function(l){function h(){l.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new g.RGBAImage({width:1,height:1}),this.dirty=!0}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.isLoaded=function(){return this.loaded},h.prototype.setLoaded=function(c){if(this.loaded!==c&&(this.loaded=c,c)){for(var d=0,E=this.requestors;d<E.length;d+=1){var w=E[d];this._notify(w.ids,w.callback)}this.requestors=[]}},h.prototype.getImage=function(c){return this.images[c]},h.prototype.addImage=function(c,d){this._validate(c,d)&&(this.images[c]=d)},h.prototype._validate=function(c,d){var E=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new g.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchX" value'))),E=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new g.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchY" value'))),E=!1),this._validateContent(d.content,d)||(this.fire(new g.ErrorEvent(new Error('Image "'+c+'" has invalid "content" value'))),E=!1),E},h.prototype._validateStretch=function(c,d){if(!c)return!0;for(var E=0,w=0,P=c;w<P.length;w+=1){var L=P[w];if(L[0]<E||L[1]<L[0]||d<L[1])return!1;E=L[1]}return!0},h.prototype._validateContent=function(c,d){return!(c&&(c.length!==4||c[0]<0||d.data.width<c[0]||c[1]<0||d.data.height<c[1]||c[2]<0||d.data.width<c[2]||c[3]<0||d.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))},h.prototype.updateImage=function(c,d){d.version=this.images[c].version+1,this.images[c]=d,this.updatedImages[c]=!0},h.prototype.removeImage=function(c){var d=this.images[c];delete this.images[c],delete this.patterns[c],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()},h.prototype.listImages=function(){return Object.keys(this.images)},h.prototype.getImages=function(c,d){var E=!0;if(!this.isLoaded())for(var w=0,P=c;w<P.length;w+=1)this.images[P[w]]||(E=!1);this.isLoaded()||E?this._notify(c,d):this.requestors.push({ids:c,callback:d})},h.prototype._notify=function(c,d){for(var E={},w=0,P=c;w<P.length;w+=1){var L=P[w];this.images[L]||this.fire(new g.Event("styleimagemissing",{id:L}));var U=this.images[L];U?E[L]={data:U.data.clone(),pixelRatio:U.pixelRatio,sdf:U.sdf,version:U.version,stretchX:U.stretchX,stretchY:U.stretchY,content:U.content,hasRenderCallback:Boolean(U.userImage&&U.userImage.render)}:g.warnOnce('Image "'+L+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}d(null,E)},h.prototype.getPixelSize=function(){var c=this.atlasImage;return{width:c.width,height:c.height}},h.prototype.getPattern=function(c){var d=this.patterns[c],E=this.getImage(c);if(!E)return null;if(d&&d.position.version===E.version)return d.position;if(d)d.position.version=E.version;else{var w={w:E.data.width+2,h:E.data.height+2,x:0,y:0},P=new g.ImagePosition(w,E);this.patterns[c]={bin:w,position:P}}return this._updatePatternAtlas(),this.patterns[c].position},h.prototype.bind=function(c){var d=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new g.Texture(c,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)},h.prototype._updatePatternAtlas=function(){var c=[];for(var d in this.patterns)c.push(this.patterns[d].bin);var E=g.potpack(c),w=E.w,P=E.h,L=this.atlasImage;for(var U in L.resize({width:w||1,height:P||1}),this.patterns){var H=this.patterns[U].bin,oe=H.x+1,ue=H.y+1,le=this.images[U].data,Ie=le.width,Pe=le.height;g.RGBAImage.copy(le,L,{x:0,y:0},{x:oe,y:ue},{width:Ie,height:Pe}),g.RGBAImage.copy(le,L,{x:0,y:Pe-1},{x:oe,y:ue-1},{width:Ie,height:1}),g.RGBAImage.copy(le,L,{x:0,y:0},{x:oe,y:ue+Pe},{width:Ie,height:1}),g.RGBAImage.copy(le,L,{x:Ie-1,y:0},{x:oe-1,y:ue},{width:1,height:Pe}),g.RGBAImage.copy(le,L,{x:0,y:0},{x:oe+Ie,y:ue},{width:1,height:Pe})}this.dirty=!0},h.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},h.prototype.dispatchRenderCallbacks=function(c){for(var d=0,E=c;d<E.length;d+=1){var w=E[d];if(!this.callbackDispatchedThisFrame[w]){this.callbackDispatchedThisFrame[w]=!0;var P=this.images[w];or(P)&&this.updateImage(w,P)}}},h}(g.Evented),Kt=it,_t=it,ct=1e20;function it(l,h,c,d,E,w){this.fontSize=l||24,this.buffer=h===void 0?3:h,this.cutoff=d||.25,this.fontFamily=E||"sans-serif",this.fontWeight=w||"normal",this.radius=c||8;var P=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=P,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(P*P),this.gridInner=new Float64Array(P*P),this.f=new Float64Array(P),this.d=new Float64Array(P),this.z=new Float64Array(P+1),this.v=new Int16Array(P),this.middle=Math.round(P/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function $t(l,h,c,d,E,w,P){for(var L=0;L<h;L++){for(var U=0;U<c;U++)d[U]=l[U*h+L];for(Y(d,E,w,P,c),U=0;U<c;U++)l[U*h+L]=E[U]}for(U=0;U<c;U++){for(L=0;L<h;L++)d[L]=l[U*h+L];for(Y(d,E,w,P,h),L=0;L<h;L++)l[U*h+L]=Math.sqrt(E[L])}}function Y(l,h,c,d,E){c[0]=0,d[0]=-ct,d[1]=+ct;for(var w=1,P=0;w<E;w++){for(var L=(l[w]+w*w-(l[c[P]]+c[P]*c[P]))/(2*w-2*c[P]);L<=d[P];)P--,L=(l[w]+w*w-(l[c[P]]+c[P]*c[P]))/(2*w-2*c[P]);c[++P]=w,d[P]=L,d[P+1]=+ct}for(w=0,P=0;w<E;w++){for(;d[P+1]<w;)P++;h[w]=(w-c[P])*(w-c[P])+l[c[P]]}}it.prototype.draw=function(l){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(l,this.buffer,this.middle);for(var h=this.ctx.getImageData(0,0,this.size,this.size),c=new Uint8ClampedArray(this.size*this.size),d=0;d<this.size*this.size;d++){var E=h.data[4*d+3]/255;this.gridOuter[d]=E===1?0:E===0?ct:Math.pow(Math.max(0,.5-E),2),this.gridInner[d]=E===1?ct:E===0?0:Math.pow(Math.max(0,E-.5),2)}for($t(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),$t(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),d=0;d<this.size*this.size;d++)c[d]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[d]-this.gridInner[d])/this.radius+this.cutoff))));return c},Kt.default=_t;var Xt=function(l,h){this.requestManager=l,this.localIdeographFontFamily=h,this.entries={}};Xt.prototype.setURL=function(l){this.url=l},Xt.prototype.getGlyphs=function(l,h){var c=this,d=[];for(var E in l)for(var w=0,P=l[E];w<P.length;w+=1)d.push({stack:E,id:P[w]});g.asyncAll(d,function(L,U){var H=L.stack,oe=L.id,ue=c.entries[H];ue||(ue=c.entries[H]={glyphs:{},requests:{},ranges:{}});var le=ue.glyphs[oe];if(le===void 0){if(le=c._tinySDF(ue,H,oe))return ue.glyphs[oe]=le,void U(null,{stack:H,id:oe,glyph:le});var Ie=Math.floor(oe/256);if(256*Ie>65535)U(new Error("glyphs > 65535 not supported"));else if(ue.ranges[Ie])U(null,{stack:H,id:oe,glyph:le});else{var Pe=ue.requests[Ie];Pe||(Pe=ue.requests[Ie]=[],Xt.loadGlyphRange(H,Ie,c.url,c.requestManager,function(Ne,xe){if(xe){for(var je in xe)c._doesCharSupportLocalGlyph(+je)||(ue.glyphs[+je]=xe[+je]);ue.ranges[Ie]=!0}for(var Ke=0,vt=Pe;Ke<vt.length;Ke+=1)(0,vt[Ke])(Ne,xe);delete ue.requests[Ie]})),Pe.push(function(Ne,xe){Ne?U(Ne):xe&&U(null,{stack:H,id:oe,glyph:xe[oe]||null})})}}else U(null,{stack:H,id:oe,glyph:le})},function(L,U){if(L)h(L);else if(U){for(var H={},oe=0,ue=U;oe<ue.length;oe+=1){var le=ue[oe],Ie=le.stack,Pe=le.id,Ne=le.glyph;(H[Ie]||(H[Ie]={}))[Pe]=Ne&&{id:Ne.id,bitmap:Ne.bitmap.clone(),metrics:Ne.metrics}}h(null,H)}})},Xt.prototype._doesCharSupportLocalGlyph=function(l){return!!this.localIdeographFontFamily&&(g.isChar["CJK Unified Ideographs"](l)||g.isChar["Hangul Syllables"](l)||g.isChar.Hiragana(l)||g.isChar.Katakana(l))},Xt.prototype._tinySDF=function(l,h,c){var d=this.localIdeographFontFamily;if(d&&this._doesCharSupportLocalGlyph(c)){var E=l.tinySDF;if(!E){var w="400";/bold/i.test(h)?w="900":/medium/i.test(h)?w="500":/light/i.test(h)&&(w="200"),E=l.tinySDF=new Xt.TinySDF(24,3,8,.25,d,w)}return{id:c,bitmap:new g.AlphaImage({width:30,height:30},E.draw(String.fromCharCode(c))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},Xt.loadGlyphRange=function(l,h,c,d,E){var w=256*h,P=w+255,L=d.transformRequest(d.normalizeGlyphsURL(c).replace("{fontstack}",l).replace("{range}",w+"-"+P),g.ResourceType.Glyphs);g.getArrayBuffer(L,function(U,H){if(U)E(U);else if(H){for(var oe={},ue=0,le=g.parseGlyphPBF(H);ue<le.length;ue+=1){var Ie=le[ue];oe[Ie.id]=Ie}E(null,oe)}})},Xt.TinySDF=Kt;var at=function(){this.specification=g.styleSpec.light.position};at.prototype.possiblyEvaluate=function(l,h){return g.sphericalToCartesian(l.expression.evaluate(h))},at.prototype.interpolate=function(l,h,c){return{x:g.number(l.x,h.x,c),y:g.number(l.y,h.y,c),z:g.number(l.z,h.z,c)}};var qe=new g.Properties({anchor:new g.DataConstantProperty(g.styleSpec.light.anchor),position:new at,color:new g.DataConstantProperty(g.styleSpec.light.color),intensity:new g.DataConstantProperty(g.styleSpec.light.intensity)}),Et=function(l){function h(c){l.call(this),this._transitionable=new g.Transitionable(qe),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getLight=function(){return this._transitionable.serialize()},h.prototype.setLight=function(c,d){if(d===void 0&&(d={}),!this._validate(g.validateLight,c,d))for(var E in c){var w=c[E];g.endsWith(E,"-transition")?this._transitionable.setTransition(E.slice(0,-"-transition".length),w):this._transitionable.setValue(E,w)}},h.prototype.updateTransitions=function(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)},h.prototype.hasTransition=function(){return this._transitioning.hasTransition()},h.prototype.recalculate=function(c){this.properties=this._transitioning.possiblyEvaluate(c)},h.prototype._validate=function(c,d,E){return(!E||E.validate!==!1)&&g.emitValidationErrors(this,c.call(g.validateStyle,g.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:g.styleSpec})))},h}(g.Evented),$e=function(l,h){this.width=l,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};$e.prototype.getDash=function(l,h){var c=l.join(",")+String(h);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(l,h)),this.dashEntry[c]},$e.prototype.getDashRanges=function(l,h,c){var d=[],E=l.length%2==1?-l[l.length-1]*c:0,w=l[0]*c,P=!0;d.push({left:E,right:w,isDash:P,zeroLength:l[0]===0});for(var L=l[0],U=1;U<l.length;U++){var H=l[U];d.push({left:E=L*c,right:w=(L+=H)*c,isDash:P=!P,zeroLength:H===0})}return d},$e.prototype.addRoundDash=function(l,h,c){for(var d=h/2,E=-c;E<=c;E++)for(var w=this.width*(this.nextRow+c+E),P=0,L=l[P],U=0;U<this.width;U++){U/L.right>1&&(L=l[++P]);var H=Math.abs(U-L.left),oe=Math.abs(U-L.right),ue=Math.min(H,oe),le=void 0,Ie=E/c*(d+1);if(L.isDash){var Pe=d-Math.abs(Ie);le=Math.sqrt(ue*ue+Pe*Pe)}else le=d-Math.sqrt(ue*ue+Ie*Ie);this.data[w+U]=Math.max(0,Math.min(255,le+128))}},$e.prototype.addRegularDash=function(l){for(var h=l.length-1;h>=0;--h){var c=l[h],d=l[h+1];c.zeroLength?l.splice(h,1):d&&d.isDash===c.isDash&&(d.left=c.left,l.splice(h,1))}var E=l[0],w=l[l.length-1];E.isDash===w.isDash&&(E.left=w.left-this.width,w.right=E.right+this.width);for(var P=this.width*this.nextRow,L=0,U=l[L],H=0;H<this.width;H++){H/U.right>1&&(U=l[++L]);var oe=Math.abs(H-U.left),ue=Math.abs(H-U.right),le=Math.min(oe,ue);this.data[P+H]=Math.max(0,Math.min(255,(U.isDash?le:-le)+128))}},$e.prototype.addDash=function(l,h){var c=h?7:0,d=2*c+1;if(this.nextRow+d>this.height)return g.warnOnce("LineAtlas out of space"),null;for(var E=0,w=0;w<l.length;w++)E+=l[w];if(E!==0){var P=this.width/E,L=this.getDashRanges(l,this.width,P);h?this.addRoundDash(L,P,c):this.addRegularDash(L)}var U={y:(this.nextRow+c+.5)/this.height,height:2*c/this.height,width:E};return this.nextRow+=d,this.dirty=!0,U},$e.prototype.bind=function(l){var h=l.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))};var Ht=function l(h,c){this.workerPool=h,this.actors=[],this.currentActor=0,this.id=g.uniqueId();for(var d=this.workerPool.acquire(this.id),E=0;E<d.length;E++){var w=new l.Actor(d[E],c,this.id);w.name="Worker "+E,this.actors.push(w)}};function mr(l,h,c){var d=function(E,w){if(E)return c(E);if(w){var P=g.pick(g.extend(w,l),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);w.vector_layers&&(P.vectorLayers=w.vector_layers,P.vectorLayerIds=P.vectorLayers.map(function(L){return L.id})),P.tiles=h.canonicalizeTileset(P,l.url),c(null,P)}};return l.url?g.getJSON(h.transformRequest(h.normalizeSourceURL(l.url),g.ResourceType.Source),d):g.browser.frame(function(){return d(null,l)})}Ht.prototype.broadcast=function(l,h,c){g.asyncAll(this.actors,function(d,E){d.send(l,h,E)},c=c||function(){})},Ht.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Ht.prototype.remove=function(){this.actors.forEach(function(l){l.remove()}),this.actors=[],this.workerPool.release(this.id)},Ht.Actor=g.Actor;var Fr=function(l,h,c){this.bounds=g.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=h||0,this.maxzoom=c||24};Fr.prototype.validateBounds=function(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]},Fr.prototype.contains=function(l){var h=Math.pow(2,l.z),c=Math.floor(g.mercatorXfromLng(this.bounds.getWest())*h),d=Math.floor(g.mercatorYfromLat(this.bounds.getNorth())*h),E=Math.ceil(g.mercatorXfromLng(this.bounds.getEast())*h),w=Math.ceil(g.mercatorYfromLat(this.bounds.getSouth())*h);return l.x>=c&&l.x<E&&l.y>=d&&l.y<w};var Yr=function(l){function h(c,d,E,w){if(l.call(this),this.id=c,this.dispatcher=E,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,g.extend(this,g.pick(d,["url","scheme","tileSize","promoteId"])),this._options=g.extend({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new g.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=mr(this._options,this.map._requestManager,function(d,E){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new g.ErrorEvent(d)):E&&(g.extend(c,E),E.bounds&&(c.tileBounds=new Fr(E.bounds,c.minzoom,c.maxzoom)),g.postTurnstileEvent(E.tiles,c.map._requestManager._customAccessToken),g.postMapLoadEvent(E.tiles,c.map._getMapId(),c.map._requestManager._skuToken,c.map._requestManager._customAccessToken),c.fire(new g.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new g.Event("data",{dataType:"source",sourceDataType:"content"})))})},h.prototype.loaded=function(){return this._loaded},h.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},h.prototype.onAdd=function(c){this.map=c,this.load()},h.prototype.setSourceProperty=function(c){this._tileJSONRequest&&this._tileJSONRequest.cancel(),c(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},h.prototype.setTiles=function(c){var d=this;return this.setSourceProperty(function(){d._options.tiles=c}),this},h.prototype.setUrl=function(c){var d=this;return this.setSourceProperty(function(){d.url=c,d._options.url=c}),this},h.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},h.prototype.serialize=function(){return g.extend({},this._options)},h.prototype.loadTile=function(c,d){var E=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),w={request:this.map._requestManager.transformRequest(E,g.ResourceType.Tile),uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:g.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function P(L,U){return delete c.request,c.aborted?d(null):L&&L.status!==404?d(L):(U&&U.resourceTiming&&(c.resourceTiming=U.resourceTiming),this.map._refreshExpiredTiles&&U&&c.setExpiryData(U),c.loadVectorData(U,this.map.painter),g.cacheEntryPossiblyAdded(this.dispatcher),d(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}w.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired"?c.state==="loading"?c.reloadCallback=d:c.request=c.actor.send("reloadTile",w,P.bind(this)):(c.actor=this.dispatcher.getActor(),c.request=c.actor.send("loadTile",w,P.bind(this)))},h.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id},void 0)},h.prototype.unloadTile=function(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id},void 0)},h.prototype.hasTransition=function(){return!1},h}(g.Evented),S=function(l){function h(c,d,E,w){l.call(this),this.id=c,this.dispatcher=E,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=g.extend({type:"raster"},d),g.extend(this,g.pick(d,["url","scheme","tileSize"]))}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new g.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=mr(this._options,this.map._requestManager,function(d,E){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new g.ErrorEvent(d)):E&&(g.extend(c,E),E.bounds&&(c.tileBounds=new Fr(E.bounds,c.minzoom,c.maxzoom)),g.postTurnstileEvent(E.tiles),g.postMapLoadEvent(E.tiles,c.map._getMapId(),c.map._requestManager._skuToken),c.fire(new g.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new g.Event("data",{dataType:"source",sourceDataType:"content"})))})},h.prototype.loaded=function(){return this._loaded},h.prototype.onAdd=function(c){this.map=c,this.load()},h.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},h.prototype.serialize=function(){return g.extend({},this._options)},h.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},h.prototype.loadTile=function(c,d){var E=this,w=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);c.request=g.getImage(this.map._requestManager.transformRequest(w,g.ResourceType.Tile),function(P,L){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(P)c.state="errored",d(P);else if(L){E.map._refreshExpiredTiles&&c.setExpiryData(L),delete L.cacheControl,delete L.expires;var U=E.map.painter.context,H=U.gl;c.texture=E.map.painter.getTileTexture(L.width),c.texture?c.texture.update(L,{useMipmap:!0}):(c.texture=new g.Texture(U,L,H.RGBA,{useMipmap:!0}),c.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST),U.extTextureFilterAnisotropic&&H.texParameterf(H.TEXTURE_2D,U.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,U.extTextureFilterAnisotropicMax)),c.state="loaded",g.cacheEntryPossiblyAdded(E.dispatcher),d(null)}})},h.prototype.abortTile=function(c,d){c.request&&(c.request.cancel(),delete c.request),d()},h.prototype.unloadTile=function(c,d){c.texture&&this.map.painter.saveTileTexture(c.texture),d()},h.prototype.hasTransition=function(){return!1},h}(g.Evented),Se=function(l){function h(c,d,E,w){l.call(this,c,d,E,w),this.type="raster-dem",this.maxzoom=22,this._options=g.extend({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox"}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},h.prototype.loadTile=function(c,d){var E=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function w(P,L){P&&(c.state="errored",d(P)),L&&(c.dem=L,c.needsHillshadePrepare=!0,c.state="loaded",d(null))}c.request=g.getImage(this.map._requestManager.transformRequest(E,g.ResourceType.Tile),function(P,L){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(P)c.state="errored",d(P);else if(L){this.map._refreshExpiredTiles&&c.setExpiryData(L),delete L.cacheControl,delete L.expires;var U=g.window.ImageBitmap&&L instanceof g.window.ImageBitmap&&g.offscreenCanvasSupported()?L:g.browser.getImageData(L,1),H={uid:c.uid,coord:c.tileID,source:this.id,rawImageData:U,encoding:this.encoding};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",H,w.bind(this)))}}.bind(this)),c.neighboringTiles=this._getNeighboringTiles(c.tileID)},h.prototype._getNeighboringTiles=function(c){var d=c.canonical,E=Math.pow(2,d.z),w=(d.x-1+E)%E,P=d.x===0?c.wrap-1:c.wrap,L=(d.x+1+E)%E,U=d.x+1===E?c.wrap+1:c.wrap,H={};return H[new g.OverscaledTileID(c.overscaledZ,P,d.z,w,d.y).key]={backfilled:!1},H[new g.OverscaledTileID(c.overscaledZ,U,d.z,L,d.y).key]={backfilled:!1},d.y>0&&(H[new g.OverscaledTileID(c.overscaledZ,P,d.z,w,d.y-1).key]={backfilled:!1},H[new g.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},H[new g.OverscaledTileID(c.overscaledZ,U,d.z,L,d.y-1).key]={backfilled:!1}),d.y+1<E&&(H[new g.OverscaledTileID(c.overscaledZ,P,d.z,w,d.y+1).key]={backfilled:!1},H[new g.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},H[new g.OverscaledTileID(c.overscaledZ,U,d.z,L,d.y+1).key]={backfilled:!1}),H},h.prototype.unloadTile=function(c){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded",c.actor&&c.actor.send("removeDEMTile",{uid:c.uid,source:this.id})},h}(S),ke=function(l){function h(c,d,E,w){l.call(this),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=E.getActor(),this.setEventedParent(w),this._data=d.data,this._options=g.extend({},d),this._collectResourceTiming=d.collectResourceTiming,this._resourceTiming=[],d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;var P=g.EXTENT/this.tileSize;this.workerOptions=g.extend({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*P,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*P,extent:g.EXTENT,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?Math.min(d.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:g.EXTENT,radius:(d.clusterRadius||50)*P,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.load=function(){var c=this;this.fire(new g.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(d){if(d)c.fire(new g.ErrorEvent(d));else{var E={dataType:"source",sourceDataType:"metadata"};c._collectResourceTiming&&c._resourceTiming&&c._resourceTiming.length>0&&(E.resourceTiming=c._resourceTiming,c._resourceTiming=[]),c.fire(new g.Event("data",E))}})},h.prototype.onAdd=function(c){this.map=c,this.load()},h.prototype.setData=function(c){var d=this;return this._data=c,this.fire(new g.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(E){if(E)d.fire(new g.ErrorEvent(E));else{var w={dataType:"source",sourceDataType:"content"};d._collectResourceTiming&&d._resourceTiming&&d._resourceTiming.length>0&&(w.resourceTiming=d._resourceTiming,d._resourceTiming=[]),d.fire(new g.Event("data",w))}}),this},h.prototype.getClusterExpansionZoom=function(c,d){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id},d),this},h.prototype.getClusterChildren=function(c,d){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id},d),this},h.prototype.getClusterLeaves=function(c,d,E,w){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:c,limit:d,offset:E},w),this},h.prototype._updateWorkerData=function(c){var d=this;this._loaded=!1;var E=g.extend({},this.workerOptions),w=this._data;typeof w=="string"?(E.request=this.map._requestManager.transformRequest(g.browser.resolveURL(w),g.ResourceType.Source),E.request.collectResourceTiming=this._collectResourceTiming):E.data=JSON.stringify(w),this.actor.send(this.type+".loadData",E,function(P,L){d._removed||L&&L.abandoned||(d._loaded=!0,L&&L.resourceTiming&&L.resourceTiming[d.id]&&(d._resourceTiming=L.resourceTiming[d.id].slice(0)),d.actor.send(d.type+".coalesce",{source:E.source},null),c(P))})},h.prototype.loaded=function(){return this._loaded},h.prototype.loadTile=function(c,d){var E=this,w=c.actor?"reloadTile":"loadTile";c.actor=this.actor,c.request=this.actor.send(w,{type:this.type,uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:g.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(P,L){return delete c.request,c.unloadVectorData(),c.aborted?d(null):P?d(P):(c.loadVectorData(L,E.map.painter,w==="reloadTile"),d(null))})},h.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0},h.prototype.unloadTile=function(c){c.unloadVectorData(),this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})},h.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},h.prototype.serialize=function(){return g.extend({},this._options,{type:this.type,data:this._data})},h.prototype.hasTransition=function(){return!1},h}(g.Evented),ut=g.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),ft=function(l){function h(c,d,E,w){l.call(this),this.id=c,this.dispatcher=E,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(w),this.options=d}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.load=function(c,d){var E=this;this._loaded=!1,this.fire(new g.Event("dataloading",{dataType:"source"})),this.url=this.options.url,g.getImage(this.map._requestManager.transformRequest(this.url,g.ResourceType.Image),function(w,P){E._loaded=!0,w?E.fire(new g.ErrorEvent(w)):P&&(E.image=P,c&&(E.coordinates=c),d&&d(),E._finishLoading())})},h.prototype.loaded=function(){return this._loaded},h.prototype.updateImage=function(c){var d=this;return this.image&&c.url?(this.options.url=c.url,this.load(c.coordinates,function(){d.texture=null}),this):this},h.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new g.Event("data",{dataType:"source",sourceDataType:"metadata"})))},h.prototype.onAdd=function(c){this.map=c,this.load()},h.prototype.setCoordinates=function(c){var d=this;this.coordinates=c;var E=c.map(g.MercatorCoordinate.fromLngLat);this.tileID=function(P){for(var L=1/0,U=1/0,H=-1/0,oe=-1/0,ue=0,le=P;ue<le.length;ue+=1){var Ie=le[ue];L=Math.min(L,Ie.x),U=Math.min(U,Ie.y),H=Math.max(H,Ie.x),oe=Math.max(oe,Ie.y)}var Pe=Math.max(H-L,oe-U),Ne=Math.max(0,Math.floor(-Math.log(Pe)/Math.LN2)),xe=Math.pow(2,Ne);return new g.CanonicalTileID(Ne,Math.floor((L+H)/2*xe),Math.floor((U+oe)/2*xe))}(E),this.minzoom=this.maxzoom=this.tileID.z;var w=E.map(function(P){return d.tileID.getTilePoint(P)._round()});return this._boundsArray=new g.StructArrayLayout4i8,this._boundsArray.emplaceBack(w[0].x,w[0].y,0,0),this._boundsArray.emplaceBack(w[1].x,w[1].y,g.EXTENT,0),this._boundsArray.emplaceBack(w[3].x,w[3].y,0,g.EXTENT),this._boundsArray.emplaceBack(w[2].x,w[2].y,g.EXTENT,g.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new g.Event("data",{dataType:"source",sourceDataType:"content"})),this},h.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var c=this.map.painter.context,d=c.gl;for(var E in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,ut.members)),this.boundsSegments||(this.boundsSegments=g.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new g.Texture(c,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[E];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},h.prototype.loadTile=function(c,d){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},d(null)):(c.state="errored",d(null))},h.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},h.prototype.hasTransition=function(){return!1},h}(g.Evented),kt=function(l){function h(c,d,E,w){l.call(this,c,d,E,w),this.roundZoom=!0,this.type="video",this.options=d}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.load=function(){var c=this;this._loaded=!1;var d=this.options;this.urls=[];for(var E=0,w=d.urls;E<w.length;E+=1)this.urls.push(this.map._requestManager.transformRequest(w[E],g.ResourceType.Source).url);g.getVideo(this.urls,function(P,L){c._loaded=!0,P?c.fire(new g.ErrorEvent(P)):L&&(c.video=L,c.video.loop=!0,c.video.addEventListener("playing",function(){c.map.triggerRepaint()}),c.map&&c.video.play(),c._finishLoading())})},h.prototype.pause=function(){this.video&&this.video.pause()},h.prototype.play=function(){this.video&&this.video.play()},h.prototype.seek=function(c){if(this.video){var d=this.video.seekable;c<d.start(0)||c>d.end(0)?this.fire(new g.ErrorEvent(new g.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+d.start(0)+" and "+d.end(0)+"-second mark."))):this.video.currentTime=c}},h.prototype.getVideo=function(){return this.video},h.prototype.onAdd=function(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},h.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var c=this.map.painter.context,d=c.gl;for(var E in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,ut.members)),this.boundsSegments||(this.boundsSegments=g.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new g.Texture(c,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[E];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},h.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},h.prototype.hasTransition=function(){return this.video&&!this.video.paused},h}(ft),Ft=function(l){function h(c,d,E,w){l.call(this,c,d,E,w),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(function(P){return!Array.isArray(P)||P.length!==2||P.some(function(L){return typeof L!="number"})})||this.fire(new g.ErrorEvent(new g.ValidationError("sources."+c,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new g.ErrorEvent(new g.ValidationError("sources."+c,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new g.ErrorEvent(new g.ValidationError("sources."+c,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof g.window.HTMLCanvasElement||this.fire(new g.ErrorEvent(new g.ValidationError("sources."+c,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new g.ErrorEvent(new g.ValidationError("sources."+c,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof g.window.HTMLCanvasElement?this.options.canvas:g.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new g.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},h.prototype.getCanvas=function(){return this.canvas},h.prototype.onAdd=function(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()},h.prototype.onRemove=function(){this.pause()},h.prototype.prepare=function(){var c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var d=this.map.painter.context,E=d.gl;for(var w in this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,ut.members)),this.boundsSegments||(this.boundsSegments=g.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new g.Texture(d,this.canvas,E.RGBA,{premultiply:!0}),this.tiles){var P=this.tiles[w];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture)}}},h.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},h.prototype.hasTransition=function(){return this._playing},h.prototype._hasInvalidDimensions=function(){for(var c=0,d=[this.canvas.width,this.canvas.height];c<d.length;c+=1){var E=d[c];if(isNaN(E)||E<=0)return!0}return!1},h}(ft),yr={vector:Yr,raster:S,"raster-dem":Se,geojson:ke,video:kt,image:ft,canvas:Ft};function Yn(l,h){var c=g.identity([]);return g.translate(c,c,[1,1,0]),g.scale(c,c,[.5*l.width,.5*l.height,1]),g.multiply(c,c,l.calculatePosMatrix(h.toUnwrapped()))}function Gr(l,h,c,d,E,w){var P=function(Ne,xe,je){if(Ne)for(var Ke=0,vt=Ne;Ke<vt.length;Ke+=1){var Wt=xe[vt[Ke]];if(Wt&&Wt.source===je&&Wt.type==="fill-extrusion")return!0}else for(var jt in xe){var qt=xe[jt];if(qt.source===je&&qt.type==="fill-extrusion")return!0}return!1}(E&&E.layers,h,l.id),L=w.maxPitchScaleFactor(),U=l.tilesIn(d,L,P);U.sort(Nn);for(var H=[],oe=0,ue=U;oe<ue.length;oe+=1){var le=ue[oe];H.push({wrappedTileID:le.tileID.wrapped().key,queryResults:le.tile.queryRenderedFeatures(h,c,l._state,le.queryGeometry,le.cameraQueryGeometry,le.scale,E,w,L,Yn(l.transform,le.tileID))})}var Ie=function(Ne){for(var xe={},je={},Ke=0,vt=Ne;Ke<vt.length;Ke+=1){var Wt=vt[Ke],jt=Wt.queryResults,qt=Wt.wrappedTileID,pr=je[qt]=je[qt]||{};for(var kr in jt)for(var _r=jt[kr],sn=pr[kr]=pr[kr]||{},Zn=xe[kr]=xe[kr]||[],jn=0,kn=_r;jn<kn.length;jn+=1){var ki=kn[jn];sn[ki.featureIndex]||(sn[ki.featureIndex]=!0,Zn.push(ki))}}return xe}(H);for(var Pe in Ie)Ie[Pe].forEach(function(Ne){var xe=Ne.feature,je=l.getFeatureState(xe.layer["source-layer"],xe.id);xe.source=xe.layer.source,xe.layer["source-layer"]&&(xe.sourceLayer=xe.layer["source-layer"]),xe.state=je});return Ie}function Nn(l,h){var c=l.tileID,d=h.tileID;return c.overscaledZ-d.overscaledZ||c.canonical.y-d.canonical.y||c.wrap-d.wrap||c.canonical.x-d.canonical.x}var yn=function(l,h){this.max=l,this.onRemove=h,this.reset()};yn.prototype.reset=function(){for(var l in this.data)for(var h=0,c=this.data[l];h<c.length;h+=1){var d=c[h];d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value)}return this.data={},this.order=[],this},yn.prototype.add=function(l,h,c){var d=this,E=l.wrapped().key;this.data[E]===void 0&&(this.data[E]=[]);var w={value:h,timeout:void 0};if(c!==void 0&&(w.timeout=setTimeout(function(){d.remove(l,w)},c)),this.data[E].push(w),this.order.push(E),this.order.length>this.max){var P=this._getAndRemoveByKey(this.order[0]);P&&this.onRemove(P)}return this},yn.prototype.has=function(l){return l.wrapped().key in this.data},yn.prototype.getAndRemove=function(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null},yn.prototype._getAndRemoveByKey=function(l){var h=this.data[l].shift();return h.timeout&&clearTimeout(h.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),h.value},yn.prototype.getByKey=function(l){var h=this.data[l];return h?h[0].value:null},yn.prototype.get=function(l){return this.has(l)?this.data[l.wrapped().key][0].value:null},yn.prototype.remove=function(l,h){if(!this.has(l))return this;var c=l.wrapped().key,d=h===void 0?0:this.data[c].indexOf(h),E=this.data[c][d];return this.data[c].splice(d,1),E.timeout&&clearTimeout(E.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(E.value),this.order.splice(this.order.indexOf(c),1),this},yn.prototype.setMaxSize=function(l){for(this.max=l;this.order.length>this.max;){var h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this},yn.prototype.filter=function(l){var h=[];for(var c in this.data)for(var d=0,E=this.data[c];d<E.length;d+=1){var w=E[d];l(w.value)||h.push(w)}for(var P=0,L=h;P<L.length;P+=1){var U=L[P];this.remove(U.value.tileID,U)}};var zn=function(l,h,c){this.context=l;var d=l.gl;this.buffer=d.createBuffer(),this.dynamicDraw=Boolean(c),this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer};zn.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},zn.prototype.updateData=function(l){var h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)},zn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var si={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Gn=function(l,h,c,d){this.length=h.length,this.attributes=c,this.itemSize=h.bytesPerElement,this.dynamicDraw=d,this.context=l;var E=l.gl;this.buffer=E.createBuffer(),l.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer};Gn.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Gn.prototype.updateData=function(l){var h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,l.arrayBuffer)},Gn.prototype.enableAttributes=function(l,h){for(var c=0;c<this.attributes.length;c++){var d=h.attributes[this.attributes[c].name];d!==void 0&&l.enableVertexAttribArray(d)}},Gn.prototype.setVertexAttribPointers=function(l,h,c){for(var d=0;d<this.attributes.length;d++){var E=this.attributes[d],w=h.attributes[E.name];w!==void 0&&l.vertexAttribPointer(w,E.components,l[si[E.type]],!1,this.itemSize,E.offset+this.itemSize*(c||0))}},Gn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var fi=function(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};fi.prototype.get=function(){return this.current},fi.prototype.set=function(l){},fi.prototype.getDefault=function(){return this.default},fi.prototype.setDefault=function(){this.set(this.default)};var na=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return g.Color.transparent},h.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},h}(fi),Ui=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return 1},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)},h}(fi),Ii=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return 0},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)},h}(fi),$i=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return[!0,!0,!0,!0]},h.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},h}(fi),ia=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!0},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)},h}(fi),qa=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return 255},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)},h}(fi),aa=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},h.prototype.set=function(c){var d=this.current;(c.func!==d.func||c.ref!==d.ref||c.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)},h}(fi),oa=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){var c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]},h.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)},h}(fi),Li=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=c,this.dirty=!1}},h}(fi),Ki=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return[0,1]},h.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)},h}(fi),Hi=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=c,this.dirty=!1}},h}(fi),Ts=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.LESS},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)},h}(fi),fe=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.BLEND):d.disable(d.BLEND),this.current=c,this.dirty=!1}},h}(fi),ui=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){var c=this.gl;return[c.ONE,c.ZERO]},h.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)},h}(fi),bo=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return g.Color.transparent},h.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},h}(fi),cu=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.FUNC_ADD},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)},h}(fi),Zt=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=c,this.dirty=!1}},h}(fi),er=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.BACK},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)},h}(fi),Rr=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.CCW},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)},h}(fi),an=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)},h}(fi),Mn=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.TEXTURE0},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)},h}(fi),Un=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){var c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]},h.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},h}(fi),bi=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,c),this.current=c,this.dirty=!1}},h}(fi),vi=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},h}(fi),Sn=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindTexture(d.TEXTURE_2D,c),this.current=c,this.dirty=!1}},h}(fi),Di=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}},h}(fi),Ri=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){var d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1},h}(fi),ao=function(l){function h(c){l.call(this,c),this.vao=c.extVertexArrayObject}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){this.vao&&(c!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(c),this.current=c,this.dirty=!1)},h}(fi),gs=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return 4},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}},h}(fi),Zo=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}},h}(fi),Na=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}},h}(fi),ba=function(l){function h(c,d){l.call(this,c),this.context=c,this.parent=d}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h}(fi),V=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.setDirty=function(){this.dirty=!0},h.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}},h}(ba),$=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},h}(ba),re=function(l,h,c,d){this.context=l,this.width=h,this.height=c;var E=this.framebuffer=l.gl.createFramebuffer();this.colorAttachment=new V(l,E),d&&(this.depthAttachment=new $(l,E))};re.prototype.destroy=function(){var l=this.context.gl,h=this.colorAttachment.get();if(h&&l.deleteTexture(h),this.depthAttachment){var c=this.depthAttachment.get();c&&l.deleteRenderbuffer(c)}l.deleteFramebuffer(this.framebuffer)};var pe=function(l,h,c){this.func=l,this.mask=h,this.range=c};pe.ReadOnly=!1,pe.ReadWrite=!0,pe.disabled=new pe(519,pe.ReadOnly,[0,1]);var Me=function(l,h,c,d,E,w){this.test=l,this.ref=h,this.mask=c,this.fail=d,this.depthFail=E,this.pass=w};Me.disabled=new Me({func:519,mask:0},0,0,7680,7680,7680);var Ge=function(l,h,c){this.blendFunction=l,this.blendColor=h,this.mask=c};Ge.disabled=new Ge(Ge.Replace=[1,0],g.Color.transparent,[!1,!1,!1,!1]),Ge.unblended=new Ge(Ge.Replace,g.Color.transparent,[!0,!0,!0,!0]),Ge.alphaBlended=new Ge([1,771],g.Color.transparent,[!0,!0,!0,!0]);var Qe=function(l,h,c){this.enable=l,this.mode=h,this.frontFace=c};Qe.disabled=new Qe(!1,1029,2305),Qe.backCCW=new Qe(!0,1029,2305);var se=function(l){this.gl=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new na(this),this.clearDepth=new Ui(this),this.clearStencil=new Ii(this),this.colorMask=new $i(this),this.depthMask=new ia(this),this.stencilMask=new qa(this),this.stencilFunc=new aa(this),this.stencilOp=new oa(this),this.stencilTest=new Li(this),this.depthRange=new Ki(this),this.depthTest=new Hi(this),this.depthFunc=new Ts(this),this.blend=new fe(this),this.blendFunc=new ui(this),this.blendColor=new bo(this),this.blendEquation=new cu(this),this.cullFace=new Zt(this),this.cullFaceSide=new er(this),this.frontFace=new Rr(this),this.program=new an(this),this.activeTexture=new Mn(this),this.viewport=new Un(this),this.bindFramebuffer=new bi(this),this.bindRenderbuffer=new vi(this),this.bindTexture=new Sn(this),this.bindVertexBuffer=new Di(this),this.bindElementBuffer=new Ri(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ao(this),this.pixelStoreUnpack=new gs(this),this.pixelStoreUnpackPremultiplyAlpha=new Zo(this),this.pixelStoreUnpackFlipY=new Na(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=l.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(l.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)};se.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},se.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},se.prototype.createIndexBuffer=function(l,h){return new zn(this,l,h)},se.prototype.createVertexBuffer=function(l,h,c){return new Gn(this,l,h,c)},se.prototype.createRenderbuffer=function(l,h,c){var d=this.gl,E=d.createRenderbuffer();return this.bindRenderbuffer.set(E),d.renderbufferStorage(d.RENDERBUFFER,l,h,c),this.bindRenderbuffer.set(null),E},se.prototype.createFramebuffer=function(l,h,c){return new re(this,l,h,c)},se.prototype.clear=function(l){var h=l.color,c=l.depth,d=this.gl,E=0;h&&(E|=d.COLOR_BUFFER_BIT,this.clearColor.set(h),this.colorMask.set([!0,!0,!0,!0])),c!==void 0&&(E|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),d.clear(E)},se.prototype.setCullFace=function(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))},se.prototype.setDepthMode=function(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)},se.prototype.setStencilMode=function(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)},se.prototype.setColorMode=function(l){g.deepEqual(l.blendFunction,Ge.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)},se.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Le=function(l){function h(c,d,E){var w=this;l.call(this),this.id=c,this.dispatcher=E,this.on("data",function(P){P.dataType==="source"&&P.sourceDataType==="metadata"&&(w._sourceLoaded=!0),w._sourceLoaded&&!w._paused&&P.dataType==="source"&&P.sourceDataType==="content"&&(w.reload(),w.transform&&w.update(w.transform))}),this.on("error",function(){w._sourceErrored=!0}),this._source=function(P,L,U,H){var oe=new yr[L.type](P,L,U,H);if(oe.id!==P)throw new Error("Expected Source id to be "+P+" instead of "+oe.id);return g.bindAll(["load","abort","unload","serialize","prepare"],oe),oe}(c,d,E,this),this._tiles={},this._cache=new yn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new g.SourceFeatureState}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.onAdd=function(c){this.map=c,this._maxTileCacheSize=c?c._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(c)},h.prototype.onRemove=function(c){this._source&&this._source.onRemove&&this._source.onRemove(c)},h.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var c in this._tiles){var d=this._tiles[c];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0},h.prototype.getSource=function(){return this._source},h.prototype.pause=function(){this._paused=!0},h.prototype.resume=function(){if(this._paused){var c=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,c&&this.reload(),this.transform&&this.update(this.transform)}},h.prototype._loadTile=function(c,d){return this._source.loadTile(c,d)},h.prototype._unloadTile=function(c){if(this._source.unloadTile)return this._source.unloadTile(c,function(){})},h.prototype._abortTile=function(c){if(this._source.abortTile)return this._source.abortTile(c,function(){})},h.prototype.serialize=function(){return this._source.serialize()},h.prototype.prepare=function(c){for(var d in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var E=this._tiles[d];E.upload(c),E.prepare(this.map.style.imageManager)}},h.prototype.getIds=function(){return g.values(this._tiles).map(function(c){return c.tileID}).sort(dt).map(function(c){return c.key})},h.prototype.getRenderableIds=function(c){var d=this,E=[];for(var w in this._tiles)this._isIdRenderable(w,c)&&E.push(this._tiles[w]);return c?E.sort(function(P,L){var U=P.tileID,H=L.tileID,oe=new g.Point(U.canonical.x,U.canonical.y)._rotate(d.transform.angle),ue=new g.Point(H.canonical.x,H.canonical.y)._rotate(d.transform.angle);return U.overscaledZ-H.overscaledZ||ue.y-oe.y||ue.x-oe.x}).map(function(P){return P.tileID.key}):E.map(function(P){return P.tileID}).sort(dt).map(function(P){return P.key})},h.prototype.hasRenderableParent=function(c){var d=this.findLoadedParent(c,0);return!!d&&this._isIdRenderable(d.tileID.key)},h.prototype._isIdRenderable=function(c,d){return this._tiles[c]&&this._tiles[c].hasData()&&!this._coveredTiles[c]&&(d||!this._tiles[c].holdingForFade())},h.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var c in this._cache.reset(),this._tiles)this._tiles[c].state!=="errored"&&this._reloadTile(c,"reloading")},h.prototype._reloadTile=function(c,d){var E=this._tiles[c];E&&(E.state!=="loading"&&(E.state=d),this._loadTile(E,this._tileLoaded.bind(this,E,c,d)))},h.prototype._tileLoaded=function(c,d,E,w){if(w)return c.state="errored",void(w.status!==404?this._source.fire(new g.ErrorEvent(w,{tile:c})):this.update(this.transform));c.timeAdded=g.browser.now(),E==="expired"&&(c.refreshedUponExpiration=!0),this._setTileReloadTimer(d,c),this.getSource().type==="raster-dem"&&c.dem&&this._backfillDEM(c),this._state.initializeTileState(c,this.map?this.map.painter:null),this._source.fire(new g.Event("data",{dataType:"source",tile:c,coord:c.tileID}))},h.prototype._backfillDEM=function(c){for(var d=this.getRenderableIds(),E=0;E<d.length;E++){var w=d[E];if(c.neighboringTiles&&c.neighboringTiles[w]){var P=this.getTileByID(w);L(c,P),L(P,c)}}function L(U,H){U.needsHillshadePrepare=!0;var oe=H.tileID.canonical.x-U.tileID.canonical.x,ue=H.tileID.canonical.y-U.tileID.canonical.y,le=Math.pow(2,U.tileID.canonical.z),Ie=H.tileID.key;oe===0&&ue===0||Math.abs(ue)>1||(Math.abs(oe)>1&&(Math.abs(oe+le)===1?oe+=le:Math.abs(oe-le)===1&&(oe-=le)),H.dem&&U.dem&&(U.dem.backfillBorder(H.dem,oe,ue),U.neighboringTiles&&U.neighboringTiles[Ie]&&(U.neighboringTiles[Ie].backfilled=!0)))}},h.prototype.getTile=function(c){return this.getTileByID(c.key)},h.prototype.getTileByID=function(c){return this._tiles[c]},h.prototype._retainLoadedChildren=function(c,d,E,w){for(var P in this._tiles){var L=this._tiles[P];if(!(w[P]||!L.hasData()||L.tileID.overscaledZ<=d||L.tileID.overscaledZ>E)){for(var U=L.tileID;L&&L.tileID.overscaledZ>d+1;){var H=L.tileID.scaledTo(L.tileID.overscaledZ-1);(L=this._tiles[H.key])&&L.hasData()&&(U=H)}for(var oe=U;oe.overscaledZ>d;)if(c[(oe=oe.scaledTo(oe.overscaledZ-1)).key]){w[U.key]=U;break}}}},h.prototype.findLoadedParent=function(c,d){if(c.key in this._loadedParentTiles){var E=this._loadedParentTiles[c.key];return E&&E.tileID.overscaledZ>=d?E:null}for(var w=c.overscaledZ-1;w>=d;w--){var P=c.scaledTo(w),L=this._getLoadedTile(P);if(L)return L}},h.prototype._getLoadedTile=function(c){var d=this._tiles[c.key];return d&&d.hasData()?d:this._cache.getByKey(c.wrapped().key)},h.prototype.updateCacheSize=function(c){var d=Math.ceil(c.width/this._source.tileSize)+1,E=Math.ceil(c.height/this._source.tileSize)+1,w=Math.floor(d*E*5),P=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(P)},h.prototype.handleWrapJump=function(c){var d=Math.round((c-(this._prevLng===void 0?c:this._prevLng))/360);if(this._prevLng=c,d){var E={};for(var w in this._tiles){var P=this._tiles[w];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+d),E[P.tileID.key]=P}for(var L in this._tiles=E,this._timers)clearTimeout(this._timers[L]),delete this._timers[L];for(var U in this._tiles)this._setTileReloadTimer(U,this._tiles[U])}},h.prototype.update=function(c){var d=this;if(this.transform=c,this._sourceLoaded&&!this._paused){var E;this.updateCacheSize(c),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?E=c.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(pr){return new g.OverscaledTileID(pr.canonical.z,pr.wrap,pr.canonical.z,pr.canonical.x,pr.canonical.y)}):(E=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(E=E.filter(function(pr){return d._source.hasTile(pr)}))):E=[];var w=c.coveringZoomLevel(this._source),P=Math.max(w-h.maxOverzooming,this._source.minzoom),L=Math.max(w+h.maxUnderzooming,this._source.minzoom),U=this._updateRetainedTiles(E,w);if(fr(this._source.type)){for(var H={},oe={},ue=0,le=Object.keys(U);ue<le.length;ue+=1){var Ie=le[ue],Pe=U[Ie],Ne=this._tiles[Ie];if(Ne&&!(Ne.fadeEndTime&&Ne.fadeEndTime<=g.browser.now())){var xe=this.findLoadedParent(Pe,P);xe&&(this._addTile(xe.tileID),H[xe.tileID.key]=xe.tileID),oe[Ie]=Pe}}for(var je in this._retainLoadedChildren(oe,w,L,U),H)U[je]||(this._coveredTiles[je]=!0,U[je]=H[je])}for(var Ke in U)this._tiles[Ke].clearFadeHold();for(var vt=0,Wt=g.keysDifference(this._tiles,U);vt<Wt.length;vt+=1){var jt=Wt[vt],qt=this._tiles[jt];qt.hasSymbolBuckets&&!qt.holdingForFade()?qt.setHoldDuration(this.map._fadeDuration):qt.hasSymbolBuckets&&!qt.symbolFadeFinished()||this._removeTile(jt)}this._updateLoadedParentTileCache()}},h.prototype.releaseSymbolFadeTiles=function(){for(var c in this._tiles)this._tiles[c].holdingForFade()&&this._removeTile(c)},h.prototype._updateRetainedTiles=function(c,d){for(var E={},w={},P=Math.max(d-h.maxOverzooming,this._source.minzoom),L=Math.max(d+h.maxUnderzooming,this._source.minzoom),U={},H=0,oe=c;H<oe.length;H+=1){var ue=oe[H],le=this._addTile(ue);E[ue.key]=ue,le.hasData()||d<this._source.maxzoom&&(U[ue.key]=ue)}this._retainLoadedChildren(U,d,L,E);for(var Ie=0,Pe=c;Ie<Pe.length;Ie+=1){var Ne=Pe[Ie],xe=this._tiles[Ne.key];if(!xe.hasData()){if(d+1>this._source.maxzoom){var je=Ne.children(this._source.maxzoom)[0],Ke=this.getTile(je);if(Ke&&Ke.hasData()){E[je.key]=je;continue}}else{var vt=Ne.children(this._source.maxzoom);if(E[vt[0].key]&&E[vt[1].key]&&E[vt[2].key]&&E[vt[3].key])continue}for(var Wt=xe.wasRequested(),jt=Ne.overscaledZ-1;jt>=P;--jt){var qt=Ne.scaledTo(jt);if(w[qt.key]||(w[qt.key]=!0,!(xe=this.getTile(qt))&&Wt&&(xe=this._addTile(qt)),xe&&(E[qt.key]=qt,Wt=xe.wasRequested(),xe.hasData())))break}}}return E},h.prototype._updateLoadedParentTileCache=function(){for(var c in this._loadedParentTiles={},this._tiles){for(var d=[],E=void 0,w=this._tiles[c].tileID;w.overscaledZ>0;){if(w.key in this._loadedParentTiles){E=this._loadedParentTiles[w.key];break}d.push(w.key);var P=w.scaledTo(w.overscaledZ-1);if(E=this._getLoadedTile(P))break;w=P}for(var L=0,U=d;L<U.length;L+=1)this._loadedParentTiles[U[L]]=E}},h.prototype._addTile=function(c){var d=this._tiles[c.key];if(d)return d;(d=this._cache.getAndRemove(c))&&(this._setTileReloadTimer(c.key,d),d.tileID=c,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[c.key]&&(clearTimeout(this._cacheTimers[c.key]),delete this._cacheTimers[c.key],this._setTileReloadTimer(c.key,d)));var E=Boolean(d);return E||(d=new g.Tile(c,this._source.tileSize*c.overscaleFactor()),this._loadTile(d,this._tileLoaded.bind(this,d,c.key,d.state))),d?(d.uses++,this._tiles[c.key]=d,E||this._source.fire(new g.Event("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d):null},h.prototype._setTileReloadTimer=function(c,d){var E=this;c in this._timers&&(clearTimeout(this._timers[c]),delete this._timers[c]);var w=d.getExpiryTimeout();w&&(this._timers[c]=setTimeout(function(){E._reloadTile(c,"expired"),delete E._timers[c]},w))},h.prototype._removeTile=function(c){var d=this._tiles[c];d&&(d.uses--,delete this._tiles[c],this._timers[c]&&(clearTimeout(this._timers[c]),delete this._timers[c]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))},h.prototype.clearTiles=function(){for(var c in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(c);this._cache.reset()},h.prototype.tilesIn=function(c,d,E){var w=this,P=[],L=this.transform;if(!L)return P;for(var U=E?L.getCameraQueryGeometry(c):c,H=c.map(function(jt){return L.pointCoordinate(jt)}),oe=U.map(function(jt){return L.pointCoordinate(jt)}),ue=this.getIds(),le=1/0,Ie=1/0,Pe=-1/0,Ne=-1/0,xe=0,je=oe;xe<je.length;xe+=1){var Ke=je[xe];le=Math.min(le,Ke.x),Ie=Math.min(Ie,Ke.y),Pe=Math.max(Pe,Ke.x),Ne=Math.max(Ne,Ke.y)}for(var vt=function(jt){var qt=w._tiles[ue[jt]];if(!qt.holdingForFade()){var pr=qt.tileID,kr=Math.pow(2,L.zoom-qt.tileID.overscaledZ),_r=d*qt.queryPadding*g.EXTENT/qt.tileSize/kr,sn=[pr.getTilePoint(new g.MercatorCoordinate(le,Ie)),pr.getTilePoint(new g.MercatorCoordinate(Pe,Ne))];if(sn[0].x-_r<g.EXTENT&&sn[0].y-_r<g.EXTENT&&sn[1].x+_r>=0&&sn[1].y+_r>=0){var Zn=H.map(function(kn){return pr.getTilePoint(kn)}),jn=oe.map(function(kn){return pr.getTilePoint(kn)});P.push({tile:qt,tileID:pr,queryGeometry:Zn,cameraQueryGeometry:jn,scale:kr})}}},Wt=0;Wt<ue.length;Wt++)vt(Wt);return P},h.prototype.getVisibleCoordinates=function(c){for(var d=this,E=this.getRenderableIds(c).map(function(U){return d._tiles[U].tileID}),w=0,P=E;w<P.length;w+=1){var L=P[w];L.posMatrix=this.transform.calculatePosMatrix(L.toUnwrapped())}return E},h.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(fr(this._source.type))for(var c in this._tiles){var d=this._tiles[c];if(d.fadeEndTime!==void 0&&d.fadeEndTime>=g.browser.now())return!0}return!1},h.prototype.setFeatureState=function(c,d,E){this._state.updateState(c=c||"_geojsonTileLayer",d,E)},h.prototype.removeFeatureState=function(c,d,E){this._state.removeFeatureState(c=c||"_geojsonTileLayer",d,E)},h.prototype.getFeatureState=function(c,d){return this._state.getState(c=c||"_geojsonTileLayer",d)},h.prototype.setDependencies=function(c,d,E){var w=this._tiles[c];w&&w.setDependencies(d,E)},h.prototype.reloadTilesForDependencies=function(c,d){for(var E in this._tiles)this._tiles[E].hasDependency(c,d)&&this._reloadTile(E,"reloading");this._cache.filter(function(w){return!w.hasDependency(c,d)})},h}(g.Evented);function dt(l,h){var c=Math.abs(2*l.wrap)-+(l.wrap<0),d=Math.abs(2*h.wrap)-+(h.wrap<0);return l.overscaledZ-h.overscaledZ||d-c||h.canonical.y-l.canonical.y||h.canonical.x-l.canonical.x}function fr(l){return l==="raster"||l==="image"||l==="video"}function Lt(){return new g.window.Worker(Hl.workerUrl)}Le.maxOverzooming=10,Le.maxUnderzooming=3;var Bt="mapboxgl_preloaded_worker_pool",hr=function(){this.active={}};hr.prototype.acquire=function(l){if(!this.workers)for(this.workers=[];this.workers.length<hr.workerCount;)this.workers.push(new Lt);return this.active[l]=!0,this.workers.slice()},hr.prototype.release=function(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(function(h){h.terminate()}),this.workers=null)},hr.prototype.isPreloaded=function(){return!!this.active[Bt]},hr.prototype.numActive=function(){return Object.keys(this.active).length};var _n,fn=Math.floor(g.browser.hardwareConcurrency/2);function Mt(){return _n||(_n=new hr),_n}function Jr(l,h){var c={};for(var d in l)d!=="ref"&&(c[d]=l[d]);return g.refProperties.forEach(function(E){E in h&&(c[E]=h[E])}),c}function Br(l){l=l.slice();for(var h=Object.create(null),c=0;c<l.length;c++)h[l[c].id]=l[c];for(var d=0;d<l.length;d++)"ref"in l[d]&&(l[d]=Jr(l[d],h[l[d].ref]));return l}hr.workerCount=Math.max(Math.min(fn,6),1);var Wr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function mi(l,h,c){c.push({command:Wr.addSource,args:[l,h[l]]})}function en(l,h,c){h.push({command:Wr.removeSource,args:[l]}),c[l]=!0}function dn(l,h,c,d){en(l,c,d),mi(l,h,c)}function Wi(l,h,c){var d;for(d in l[c])if(l[c].hasOwnProperty(d)&&d!=="data"&&!g.deepEqual(l[c][d],h[c][d]))return!1;for(d in h[c])if(h[c].hasOwnProperty(d)&&d!=="data"&&!g.deepEqual(l[c][d],h[c][d]))return!1;return!0}function hi(l,h,c,d,E,w){var P;for(P in h=h||{},l=l||{})l.hasOwnProperty(P)&&(g.deepEqual(l[P],h[P])||c.push({command:w,args:[d,P,h[P],E]}));for(P in h)h.hasOwnProperty(P)&&!l.hasOwnProperty(P)&&(g.deepEqual(l[P],h[P])||c.push({command:w,args:[d,P,h[P],E]}))}function wi(l){return l.id}function _i(l,h){return l[h.id]=h,l}var ht=function(l,h){this.reset(l,h)};ht.prototype.reset=function(l,h){this.points=l||[],this._distances=[0];for(var c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding},ht.prototype.lerp=function(l){if(this.points.length===1)return this.points[0];l=g.clamp(l,0,1);for(var h=1,c=this._distances[h],d=l*this.paddedLength+this.padding;c<d&&h<this._distances.length;)c=this._distances[++h];var E=h-1,w=this._distances[E],P=c-w,L=P>0?(d-w)/P:0;return this.points[E].mult(1-L).add(this.points[h].mult(L))};var Pt=function(l,h,c){var d=this.boxCells=[],E=this.circleCells=[];this.xCellCount=Math.ceil(l/c),this.yCellCount=Math.ceil(h/c);for(var w=0;w<this.xCellCount*this.yCellCount;w++)d.push([]),E.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=h,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0};function Ta(l,h,c,d,E){var w=g.create();return h?(g.scale(w,w,[1/E,1/E,1]),c||g.rotateZ(w,w,d.angle)):g.multiply(w,d.labelPlaneMatrix,l),w}function Ei(l,h,c,d,E){if(h){var w=g.clone(l);return g.scale(w,w,[E,E,1]),c||g.rotateZ(w,w,-d.angle),w}return d.glCoordMatrix}function Ti(l,h){var c=[l.x,l.y,0,1];Ma(c,c,h);var d=c[3];return{point:new g.Point(c[0]/d,c[1]/d),signedDistanceFromCamera:d}}function Zi(l,h){return .5+l/h*.5}function Pr(l,h){var c=l[0]/l[3],d=l[1]/l[3];return c>=-h[0]&&c<=h[0]&&d>=-h[1]&&d<=h[1]}function on(l,h,c,d,E,w,P,L){var U=d?l.textSizeData:l.iconSizeData,H=g.evaluateSizeForZoom(U,c.transform.zoom),oe=[256/c.width*2+1,256/c.height*2+1],ue=d?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;ue.clear();for(var le=l.lineVertexArray,Ie=d?l.text.placedSymbolArray:l.icon.placedSymbolArray,Pe=c.transform.width/c.transform.height,Ne=!1,xe=0;xe<Ie.length;xe++){var je=Ie.get(xe);if(je.hidden||je.writingMode===g.WritingMode.vertical&&!Ne)za(je.numGlyphs,ue);else{Ne=!1;var Ke=[je.anchorX,je.anchorY,0,1];if(g.transformMat4(Ke,Ke,h),Pr(Ke,oe)){var vt=Zi(c.transform.cameraToCenterDistance,Ke[3]),Wt=g.evaluateSizeForFeature(U,H,je),jt=P?Wt/vt:Wt*vt,qt=new g.Point(je.anchorX,je.anchorY),pr=Ti(qt,E).point,kr={},_r=J(je,jt,!1,L,h,E,w,l.glyphOffsetArray,le,ue,pr,qt,kr,Pe);Ne=_r.useVertical,(_r.notEnoughRoom||Ne||_r.needsFlipping&&J(je,jt,!0,L,h,E,w,l.glyphOffsetArray,le,ue,pr,qt,kr,Pe).notEnoughRoom)&&za(je.numGlyphs,ue)}else za(je.numGlyphs,ue)}}d?l.text.dynamicLayoutVertexBuffer.updateData(ue):l.icon.dynamicLayoutVertexBuffer.updateData(ue)}function gt(l,h,c,d,E,w,P,L,U,H,oe){var ue=L.glyphStartIndex+L.numGlyphs,le=L.lineStartIndex,Ie=L.lineStartIndex+L.lineLength,Pe=h.getoffsetX(L.glyphStartIndex),Ne=h.getoffsetX(ue-1),xe=ta(l*Pe,c,d,E,w,P,L.segment,le,Ie,U,H,oe);if(!xe)return null;var je=ta(l*Ne,c,d,E,w,P,L.segment,le,Ie,U,H,oe);return je?{first:xe,last:je}:null}function sa(l,h,c,d){return l===g.WritingMode.horizontal&&Math.abs(c.y-h.y)>Math.abs(c.x-h.x)*d?{useVertical:!0}:(l===g.WritingMode.vertical?h.y<c.y:h.x>c.x)?{needsFlipping:!0}:null}function J(l,h,c,d,E,w,P,L,U,H,oe,ue,le,Ie){var Pe,Ne=h/24,xe=l.lineOffsetX*Ne,je=l.lineOffsetY*Ne;if(l.numGlyphs>1){var Ke=l.glyphStartIndex+l.numGlyphs,vt=l.lineStartIndex,Wt=l.lineStartIndex+l.lineLength,jt=gt(Ne,L,xe,je,c,oe,ue,l,U,w,le);if(!jt)return{notEnoughRoom:!0};var qt=Ti(jt.first.point,P).point,pr=Ti(jt.last.point,P).point;if(d&&!c){var kr=sa(l.writingMode,qt,pr,Ie);if(kr)return kr}Pe=[jt.first];for(var _r=l.glyphStartIndex+1;_r<Ke-1;_r++)Pe.push(ta(Ne*L.getoffsetX(_r),xe,je,c,oe,ue,l.segment,vt,Wt,U,w,le));Pe.push(jt.last)}else{if(d&&!c){var sn=Ti(ue,E).point,Zn=l.lineStartIndex+l.segment+1,jn=new g.Point(U.getx(Zn),U.gety(Zn)),kn=Ti(jn,E),ki=kn.signedDistanceFromCamera>0?kn.point:Ko(ue,jn,sn,1,E),tn=sa(l.writingMode,sn,ki,Ie);if(tn)return tn}var ii=ta(Ne*L.getoffsetX(l.glyphStartIndex),xe,je,c,oe,ue,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,U,w,le);if(!ii)return{notEnoughRoom:!0};Pe=[ii]}for(var li=0,$n=Pe;li<$n.length;li+=1){var Hn=$n[li];g.addDynamicAttributes(H,Hn.point,Hn.angle)}return{}}function Ko(l,h,c,d,E){var w=Ti(l.add(l.sub(h)._unit()),E).point,P=c.sub(w);return c.add(P._mult(d/P.mag()))}function ta(l,h,c,d,E,w,P,L,U,H,oe,ue){var le=d?l-h:l+h,Ie=le>0?1:-1,Pe=0;d&&(Ie*=-1,Pe=Math.PI),Ie<0&&(Pe+=Math.PI);for(var Ne=Ie>0?L+P:L+P+1,xe=E,je=E,Ke=0,vt=0,Wt=Math.abs(le),jt=[];Ke+vt<=Wt;){if((Ne+=Ie)<L||Ne>=U)return null;if(je=xe,jt.push(xe),(xe=ue[Ne])===void 0){var qt=new g.Point(H.getx(Ne),H.gety(Ne)),pr=Ti(qt,oe);if(pr.signedDistanceFromCamera>0)xe=ue[Ne]=pr.point;else{var kr=Ne-Ie;xe=Ko(Ke===0?w:new g.Point(H.getx(kr),H.gety(kr)),qt,je,Wt-Ke+1,oe)}}Ke+=vt,vt=je.dist(xe)}var _r=(Wt-Ke)/vt,sn=xe.sub(je),Zn=sn.mult(_r)._add(je);Zn._add(sn._unit()._perp()._mult(c*Ie));var jn=Pe+Math.atan2(xe.y-je.y,xe.x-je.x);return jt.push(Zn),{point:Zn,angle:jn,path:jt}}Pt.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Pt.prototype.insert=function(l,h,c,d,E){this._forEachCell(h,c,d,E,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(h),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(E)},Pt.prototype.insertCircle=function(l,h,c,d){this._forEachCell(h-d,c-d,h+d,c+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(h),this.circles.push(c),this.circles.push(d)},Pt.prototype._insertBoxCell=function(l,h,c,d,E,w){this.boxCells[E].push(w)},Pt.prototype._insertCircleCell=function(l,h,c,d,E,w){this.circleCells[E].push(w)},Pt.prototype._query=function(l,h,c,d,E,w){if(c<0||l>this.width||d<0||h>this.height)return!E&&[];var P=[];if(l<=0&&h<=0&&this.width<=c&&this.height<=d){if(E)return!0;for(var L=0;L<this.boxKeys.length;L++)P.push({key:this.boxKeys[L],x1:this.bboxes[4*L],y1:this.bboxes[4*L+1],x2:this.bboxes[4*L+2],y2:this.bboxes[4*L+3]});for(var U=0;U<this.circleKeys.length;U++){var H=this.circles[3*U],oe=this.circles[3*U+1],ue=this.circles[3*U+2];P.push({key:this.circleKeys[U],x1:H-ue,y1:oe-ue,x2:H+ue,y2:oe+ue})}return w?P.filter(w):P}return this._forEachCell(l,h,c,d,this._queryCell,P,{hitTest:E,seenUids:{box:{},circle:{}}},w),E?P.length>0:P},Pt.prototype._queryCircle=function(l,h,c,d,E){var w=l-c,P=l+c,L=h-c,U=h+c;if(P<0||w>this.width||U<0||L>this.height)return!d&&[];var H=[];return this._forEachCell(w,L,P,U,this._queryCellCircle,H,{hitTest:d,circle:{x:l,y:h,radius:c},seenUids:{box:{},circle:{}}},E),d?H.length>0:H},Pt.prototype.query=function(l,h,c,d,E){return this._query(l,h,c,d,!1,E)},Pt.prototype.hitTest=function(l,h,c,d,E){return this._query(l,h,c,d,!0,E)},Pt.prototype.hitTestCircle=function(l,h,c,d){return this._queryCircle(l,h,c,!0,d)},Pt.prototype._queryCell=function(l,h,c,d,E,w,P,L){var U=P.seenUids,H=this.boxCells[E];if(H!==null)for(var oe=this.bboxes,ue=0,le=H;ue<le.length;ue+=1){var Ie=le[ue];if(!U.box[Ie]){U.box[Ie]=!0;var Pe=4*Ie;if(l<=oe[Pe+2]&&h<=oe[Pe+3]&&c>=oe[Pe+0]&&d>=oe[Pe+1]&&(!L||L(this.boxKeys[Ie]))){if(P.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[Ie],x1:oe[Pe],y1:oe[Pe+1],x2:oe[Pe+2],y2:oe[Pe+3]})}}}var Ne=this.circleCells[E];if(Ne!==null)for(var xe=this.circles,je=0,Ke=Ne;je<Ke.length;je+=1){var vt=Ke[je];if(!U.circle[vt]){U.circle[vt]=!0;var Wt=3*vt;if(this._circleAndRectCollide(xe[Wt],xe[Wt+1],xe[Wt+2],l,h,c,d)&&(!L||L(this.circleKeys[vt]))){if(P.hitTest)return w.push(!0),!0;var jt=xe[Wt],qt=xe[Wt+1],pr=xe[Wt+2];w.push({key:this.circleKeys[vt],x1:jt-pr,y1:qt-pr,x2:jt+pr,y2:qt+pr})}}}},Pt.prototype._queryCellCircle=function(l,h,c,d,E,w,P,L){var U=P.circle,H=P.seenUids,oe=this.boxCells[E];if(oe!==null)for(var ue=this.bboxes,le=0,Ie=oe;le<Ie.length;le+=1){var Pe=Ie[le];if(!H.box[Pe]){H.box[Pe]=!0;var Ne=4*Pe;if(this._circleAndRectCollide(U.x,U.y,U.radius,ue[Ne+0],ue[Ne+1],ue[Ne+2],ue[Ne+3])&&(!L||L(this.boxKeys[Pe])))return w.push(!0),!0}}var xe=this.circleCells[E];if(xe!==null)for(var je=this.circles,Ke=0,vt=xe;Ke<vt.length;Ke+=1){var Wt=vt[Ke];if(!H.circle[Wt]){H.circle[Wt]=!0;var jt=3*Wt;if(this._circlesCollide(je[jt],je[jt+1],je[jt+2],U.x,U.y,U.radius)&&(!L||L(this.circleKeys[Wt])))return w.push(!0),!0}}},Pt.prototype._forEachCell=function(l,h,c,d,E,w,P,L){for(var U=this._convertToXCellCoord(l),H=this._convertToYCellCoord(h),oe=this._convertToXCellCoord(c),ue=this._convertToYCellCoord(d),le=U;le<=oe;le++)for(var Ie=H;Ie<=ue;Ie++)if(E.call(this,l,h,c,d,this.xCellCount*Ie+le,w,P,L))return},Pt.prototype._convertToXCellCoord=function(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))},Pt.prototype._convertToYCellCoord=function(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))},Pt.prototype._circlesCollide=function(l,h,c,d,E,w){var P=d-l,L=E-h,U=c+w;return U*U>P*P+L*L},Pt.prototype._circleAndRectCollide=function(l,h,c,d,E,w,P){var L=(w-d)/2,U=Math.abs(l-(d+L));if(U>L+c)return!1;var H=(P-E)/2,oe=Math.abs(h-(E+H));if(oe>H+c)return!1;if(U<=L||oe<=H)return!0;var ue=U-L,le=oe-H;return ue*ue+le*le<=c*c};var bu=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function za(l,h){for(var c=0;c<l;c++){var d=h.length;h.resize(d+4),h.float32.set(bu,3*d)}}function Ma(l,h,c){var d=h[0],E=h[1];return l[0]=c[0]*d+c[4]*E+c[12],l[1]=c[1]*d+c[5]*E+c[13],l[3]=c[3]*d+c[7]*E+c[15],l}var Ka=function(l,h,c){h===void 0&&(h=new Pt(l.width+200,l.height+200,25)),c===void 0&&(c=new Pt(l.width+200,l.height+200,25)),this.transform=l,this.grid=h,this.ignoredGrid=c,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+100,this.screenBottomBoundary=l.height+100,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200};function ua(l,h,c){return h*(g.EXTENT/(l.tileSize*Math.pow(2,c-l.tileID.overscaledZ)))}Ka.prototype.placeCollisionBox=function(l,h,c,d,E){var w=this.projectAndGetPerspectiveRatio(d,l.anchorPointX,l.anchorPointY),P=c*w.perspectiveRatio,L=l.x1*P+w.point.x,U=l.y1*P+w.point.y,H=l.x2*P+w.point.x,oe=l.y2*P+w.point.y;return!this.isInsideGrid(L,U,H,oe)||!h&&this.grid.hitTest(L,U,H,oe,E)?{box:[],offscreen:!1}:{box:[L,U,H,oe],offscreen:this.isOffscreen(L,U,H,oe)}},Ka.prototype.placeCollisionCircles=function(l,h,c,d,E,w,P,L,U,H,oe,ue,le){var Ie=[],Pe=new g.Point(h.anchorX,h.anchorY),Ne=Ti(Pe,w),xe=Zi(this.transform.cameraToCenterDistance,Ne.signedDistanceFromCamera),je=(H?E/xe:E*xe)/g.ONE_EM,Ke=Ti(Pe,P).point,vt=gt(je,d,h.lineOffsetX*je,h.lineOffsetY*je,!1,Ke,Pe,h,c,P,{}),Wt=!1,jt=!1,qt=!0;if(vt){for(var pr=.5*ue*xe+le,kr=new g.Point(-100,-100),_r=new g.Point(this.screenRightBoundary,this.screenBottomBoundary),sn=new ht,Zn=vt.first,jn=vt.last,kn=[],ki=Zn.path.length-1;ki>=1;ki--)kn.push(Zn.path[ki]);for(var tn=1;tn<jn.path.length;tn++)kn.push(jn.path[tn]);var ii=2.5*pr;if(L){var li=kn.map(function(Jo){return Ti(Jo,L)});kn=li.some(function(Jo){return Jo.signedDistanceFromCamera<=0})?[]:li.map(function(Jo){return Jo.point})}var $n=[];if(kn.length>0){for(var Hn=kn[0].clone(),di=kn[0].clone(),Kn=1;Kn<kn.length;Kn++)Hn.x=Math.min(Hn.x,kn[Kn].x),Hn.y=Math.min(Hn.y,kn[Kn].y),di.x=Math.max(di.x,kn[Kn].x),di.y=Math.max(di.y,kn[Kn].y);$n=Hn.x>=kr.x&&di.x<=_r.x&&Hn.y>=kr.y&&di.y<=_r.y?[kn]:di.x<kr.x||Hn.x>_r.x||di.y<kr.y||Hn.y>_r.y?[]:g.clipLine([kn],kr.x,kr.y,_r.x,_r.y)}for(var Xn=0,yo=$n;Xn<yo.length;Xn+=1){var Ja;sn.reset(yo[Xn],.25*pr),Ja=sn.length<=.5*pr?1:Math.ceil(sn.paddedLength/ii)+1;for(var To=0;To<Ja;To++){var ra=To/Math.max(Ja-1,1),Ha=sn.lerp(ra),ho=Ha.x+100,Rs=Ha.y+100;Ie.push(ho,Rs,pr,0);var ss=ho-pr,Bu=Rs-pr,us=ho+pr,nu=Rs+pr;if(qt=qt&&this.isOffscreen(ss,Bu,us,nu),jt=jt||this.isInsideGrid(ss,Bu,us,nu),!l&&this.grid.hitTestCircle(ho,Rs,pr,oe)&&(Wt=!0,!U))return{circles:[],offscreen:!1,collisionDetected:Wt}}}}return{circles:!U&&Wt||!jt?[]:Ie,offscreen:qt,collisionDetected:Wt}},Ka.prototype.queryRenderedSymbols=function(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var h=[],c=1/0,d=1/0,E=-1/0,w=-1/0,P=0,L=l;P<L.length;P+=1){var U=L[P],H=new g.Point(U.x+100,U.y+100);c=Math.min(c,H.x),d=Math.min(d,H.y),E=Math.max(E,H.x),w=Math.max(w,H.y),h.push(H)}for(var oe={},ue={},le=0,Ie=this.grid.query(c,d,E,w).concat(this.ignoredGrid.query(c,d,E,w));le<Ie.length;le+=1){var Pe=Ie[le],Ne=Pe.key;if(oe[Ne.bucketInstanceId]===void 0&&(oe[Ne.bucketInstanceId]={}),!oe[Ne.bucketInstanceId][Ne.featureIndex]){var xe=[new g.Point(Pe.x1,Pe.y1),new g.Point(Pe.x2,Pe.y1),new g.Point(Pe.x2,Pe.y2),new g.Point(Pe.x1,Pe.y2)];g.polygonIntersectsPolygon(h,xe)&&(oe[Ne.bucketInstanceId][Ne.featureIndex]=!0,ue[Ne.bucketInstanceId]===void 0&&(ue[Ne.bucketInstanceId]=[]),ue[Ne.bucketInstanceId].push(Ne.featureIndex))}}return ue},Ka.prototype.insertCollisionBox=function(l,h,c,d,E){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:d,collisionGroupID:E},l[0],l[1],l[2],l[3])},Ka.prototype.insertCollisionCircles=function(l,h,c,d,E){for(var w=h?this.ignoredGrid:this.grid,P={bucketInstanceId:c,featureIndex:d,collisionGroupID:E},L=0;L<l.length;L+=4)w.insertCircle(P,l[L],l[L+1],l[L+2])},Ka.prototype.projectAndGetPerspectiveRatio=function(l,h,c){var d=[h,c,0,1];return Ma(d,d,l),{point:new g.Point((d[0]/d[3]+1)/2*this.transform.width+100,(-d[1]/d[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/d[3]*.5}},Ka.prototype.isOffscreen=function(l,h,c,d){return c<100||l>=this.screenRightBoundary||d<100||h>this.screenBottomBoundary},Ka.prototype.isInsideGrid=function(l,h,c,d){return c>=0&&l<this.gridRightBoundary&&d>=0&&h<this.gridBottomBoundary},Ka.prototype.getViewportMatrix=function(){var l=g.identity([]);return g.translate(l,l,[-100,-100,0]),l};var Ao=function(l,h,c,d){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?h:-h))):d&&c?1:0,this.placed=c};Ao.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var jo=function(l,h,c,d,E){this.text=new Ao(l?l.text:null,h,c,E),this.icon=new Ao(l?l.icon:null,h,d,E)};jo.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var wu=function(l,h,c){this.text=l,this.icon=h,this.skipFade=c},vo=function(){this.invProjMatrix=g.create(),this.viewportMatrix=g.create(),this.circles=[]},Do=function(l,h,c,d,E){this.bucketInstanceId=l,this.featureIndex=h,this.sourceLayerIndex=c,this.bucketIndex=d,this.tileID=E},la=function(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}};function $a(l,h,c,d,E){var w=g.getAnchorAlignment(l),P=-(w.horizontalAlign-.5)*h,L=-(w.verticalAlign-.5)*c,U=g.evaluateVariableOffset(l,d);return new g.Point(P+U[0]*E,L+U[1]*E)}function Fo(l,h,c,d,E,w){var P=l.x1,L=l.x2,U=l.y1,H=l.y2,oe=l.anchorPointX,ue=l.anchorPointY,le=new g.Point(h,c);return d&&le._rotate(E?w:-w),{x1:P+le.x,y1:U+le.y,x2:L+le.x,y2:H+le.y,anchorPointX:oe,anchorPointY:ue}}la.prototype.get=function(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){var h=++this.maxGroupID;this.collisionGroups[l]={ID:h,predicate:function(c){return c.collisionGroupID===h}}}return this.collisionGroups[l]};var Qa=function(l,h,c,d){this.transform=l.clone(),this.collisionIndex=new Ka(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new la(c),this.collisionCircleArrays={},this.prevPlacement=d,d&&(d.prevPlacement=void 0),this.placedOrientations={}};function Ms(l,h,c,d,E){l.emplaceBack(h?1:0,c?1:0,d||0,E||0),l.emplaceBack(h?1:0,c?1:0,d||0,E||0),l.emplaceBack(h?1:0,c?1:0,d||0,E||0),l.emplaceBack(h?1:0,c?1:0,d||0,E||0)}Qa.prototype.getBucketParts=function(l,h,c,d){var E=c.getBucket(h),w=c.latestFeatureIndex;if(E&&w&&h.id===E.layerIds[0]){var P=c.collisionBoxArray,L=E.layers[0].layout,U=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),H=c.tileSize/g.EXTENT,oe=this.transform.calculatePosMatrix(c.tileID.toUnwrapped()),ue=L.get("text-pitch-alignment")==="map",le=L.get("text-rotation-alignment")==="map",Ie=ua(c,1,this.transform.zoom),Pe=Ta(oe,ue,le,this.transform,Ie),Ne=null;if(ue){var xe=Ei(oe,ue,le,this.transform,Ie);Ne=g.multiply([],this.transform.labelPlaneMatrix,xe)}this.retainedQueryData[E.bucketInstanceId]=new Do(E.bucketInstanceId,w,E.sourceLayerIndex,E.index,c.tileID);var je={bucket:E,layout:L,posMatrix:oe,textLabelPlaneMatrix:Pe,labelToScreenMatrix:Ne,scale:U,textPixelRatio:H,holdingForFade:c.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:g.evaluateSizeForZoom(E.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(E.sourceID)};if(d)for(var Ke=0,vt=E.sortKeyRanges;Ke<vt.length;Ke+=1){var Wt=vt[Ke];l.push({sortKey:Wt.sortKey,symbolInstanceStart:Wt.symbolInstanceStart,symbolInstanceEnd:Wt.symbolInstanceEnd,parameters:je})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:je})}},Qa.prototype.attemptAnchorPlacement=function(l,h,c,d,E,w,P,L,U,H,oe,ue,le,Ie,Pe){var Ne,xe=[ue.textOffset0,ue.textOffset1],je=$a(l,c,d,xe,E),Ke=this.collisionIndex.placeCollisionBox(Fo(h,je.x,je.y,w,P,this.transform.angle),oe,L,U,H.predicate);if(!Pe||this.collisionIndex.placeCollisionBox(Fo(Pe,je.x,je.y,w,P,this.transform.angle),oe,L,U,H.predicate).box.length!==0)return Ke.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[ue.crossTileID]&&this.prevPlacement.placements[ue.crossTileID]&&this.prevPlacement.placements[ue.crossTileID].text&&(Ne=this.prevPlacement.variableOffsets[ue.crossTileID].anchor),this.variableOffsets[ue.crossTileID]={textOffset:xe,width:c,height:d,anchor:l,textBoxScale:E,prevAnchor:Ne},this.markUsedJustification(le,l,ue,Ie),le.allowVerticalPlacement&&(this.markUsedOrientation(le,Ie,ue),this.placedOrientations[ue.crossTileID]=Ie),{shift:je,placedGlyphBoxes:Ke}):void 0},Qa.prototype.placeLayerBucketPart=function(l,h,c){var d=this,E=l.parameters,w=E.bucket,P=E.layout,L=E.posMatrix,U=E.textLabelPlaneMatrix,H=E.labelToScreenMatrix,oe=E.textPixelRatio,ue=E.holdingForFade,le=E.collisionBoxArray,Ie=E.partiallyEvaluatedTextSize,Pe=E.collisionGroup,Ne=P.get("text-optional"),xe=P.get("icon-optional"),je=P.get("text-allow-overlap"),Ke=P.get("icon-allow-overlap"),vt=P.get("text-rotation-alignment")==="map",Wt=P.get("text-pitch-alignment")==="map",jt=P.get("icon-text-fit")!=="none",qt=P.get("symbol-z-order")==="viewport-y",pr=je&&(Ke||!w.hasIconData()||xe),kr=Ke&&(je||!w.hasTextData()||Ne);!w.collisionArrays&&le&&w.deserializeCollisionBoxes(le);var _r=function(tn,ii){if(!h[tn.crossTileID])if(ue)d.placements[tn.crossTileID]=new wu(!1,!1,!1);else{var li,$n=!1,Hn=!1,di=!0,Kn=null,Xn={box:null,offscreen:null},yo={box:null,offscreen:null},Ja=null,To=null,ra=0,Ha=0,ho=0;ii.textFeatureIndex?ra=ii.textFeatureIndex:tn.useRuntimeCollisionCircles&&(ra=tn.featureIndex),ii.verticalTextFeatureIndex&&(Ha=ii.verticalTextFeatureIndex);var Rs=ii.textBox;if(Rs){var ss=function(ca){var Us=g.WritingMode.horizontal;if(w.allowVerticalPlacement&&!ca&&d.prevPlacement){var es=d.prevPlacement.placedOrientations[tn.crossTileID];es&&(d.placedOrientations[tn.crossTileID]=es,d.markUsedOrientation(w,Us=es,tn))}return Us},Bu=function(ca,Us){if(w.allowVerticalPlacement&&tn.numVerticalGlyphVertices>0&&ii.verticalTextBox)for(var es=0,_u=w.writingModes;es<_u.length&&(_u[es]===g.WritingMode.vertical?(Xn=Us(),yo=Xn):Xn=ca(),!(Xn&&Xn.box&&Xn.box.length));es+=1);else Xn=ca()};if(P.get("text-variable-anchor")){var us=P.get("text-variable-anchor");if(d.prevPlacement&&d.prevPlacement.variableOffsets[tn.crossTileID]){var nu=d.prevPlacement.variableOffsets[tn.crossTileID];us.indexOf(nu.anchor)>0&&(us=us.filter(function(ca){return ca!==nu.anchor})).unshift(nu.anchor)}var Jo=function(ca,Us,es){for(var _u=ca.x2-ca.x1,qc=ca.y2-ca.y1,Kc=tn.textBoxScale,Pf=jt&&!Ke?Us:null,au={box:[],offscreen:!1},mc=je?2*us.length:us.length,ou=0;ou<mc;++ou){var bl=d.attemptAnchorPlacement(us[ou%us.length],ca,_u,qc,Kc,vt,Wt,oe,L,Pe,ou>=us.length,tn,w,es,Pf);if(bl&&(au=bl.placedGlyphBoxes)&&au.box&&au.box.length){$n=!0,Kn=bl.shift;break}}return au};Bu(function(){return Jo(Rs,ii.iconBox,g.WritingMode.horizontal)},function(){var ca=ii.verticalTextBox;return w.allowVerticalPlacement&&!(Xn&&Xn.box&&Xn.box.length)&&tn.numVerticalGlyphVertices>0&&ca?Jo(ca,ii.verticalIconBox,g.WritingMode.vertical):{box:null,offscreen:null}}),Xn&&($n=Xn.box,di=Xn.offscreen);var ls=ss(Xn&&Xn.box);if(!$n&&d.prevPlacement){var Wl=d.prevPlacement.variableOffsets[tn.crossTileID];Wl&&(d.variableOffsets[tn.crossTileID]=Wl,d.markUsedJustification(w,Wl.anchor,tn,ls))}}else{var Nu=function(ca,Us){var es=d.collisionIndex.placeCollisionBox(ca,je,oe,L,Pe.predicate);return es&&es.box&&es.box.length&&(d.markUsedOrientation(w,Us,tn),d.placedOrientations[tn.crossTileID]=Us),es};Bu(function(){return Nu(Rs,g.WritingMode.horizontal)},function(){var ca=ii.verticalTextBox;return w.allowVerticalPlacement&&tn.numVerticalGlyphVertices>0&&ca?Nu(ca,g.WritingMode.vertical):{box:null,offscreen:null}}),ss(Xn&&Xn.box&&Xn.box.length)}}if($n=(li=Xn)&&li.box&&li.box.length>0,di=li&&li.offscreen,tn.useRuntimeCollisionCircles){var _l=w.text.placedSymbolArray.get(tn.centerJustifiedTextSymbolIndex),Xl=g.evaluateSizeForFeature(w.textSizeData,Ie,_l),iu=P.get("text-padding");Ja=d.collisionIndex.placeCollisionCircles(je,_l,w.lineVertexArray,w.glyphOffsetArray,Xl,L,U,H,c,Wt,Pe.predicate,tn.collisionCircleDiameter,iu),$n=je||Ja.circles.length>0&&!Ja.collisionDetected,di=di&&Ja.offscreen}if(ii.iconFeatureIndex&&(ho=ii.iconFeatureIndex),ii.iconBox){var xl=function(ca){var Us=jt&&Kn?Fo(ca,Kn.x,Kn.y,vt,Wt,d.transform.angle):ca;return d.collisionIndex.placeCollisionBox(Us,Ke,oe,L,Pe.predicate)};Hn=yo&&yo.box&&yo.box.length&&ii.verticalIconBox?(To=xl(ii.verticalIconBox)).box.length>0:(To=xl(ii.iconBox)).box.length>0,di=di&&To.offscreen}var Su=Ne||tn.numHorizontalGlyphVertices===0&&tn.numVerticalGlyphVertices===0,Eo=xe||tn.numIconVertices===0;if(Su||Eo?Eo?Su||(Hn=Hn&&$n):$n=Hn&&$n:Hn=$n=Hn&&$n,$n&&li&&li.box&&d.collisionIndex.insertCollisionBox(li.box,P.get("text-ignore-placement"),w.bucketInstanceId,yo&&yo.box&&Ha?Ha:ra,Pe.ID),Hn&&To&&d.collisionIndex.insertCollisionBox(To.box,P.get("icon-ignore-placement"),w.bucketInstanceId,ho,Pe.ID),Ja&&($n&&d.collisionIndex.insertCollisionCircles(Ja.circles,P.get("text-ignore-placement"),w.bucketInstanceId,ra,Pe.ID),c)){var zu=w.bucketInstanceId,Uu=d.collisionCircleArrays[zu];Uu===void 0&&(Uu=d.collisionCircleArrays[zu]=new vo);for(var tl=0;tl<Ja.circles.length;tl+=4)Uu.circles.push(Ja.circles[tl+0]),Uu.circles.push(Ja.circles[tl+1]),Uu.circles.push(Ja.circles[tl+2]),Uu.circles.push(Ja.collisionDetected?1:0)}d.placements[tn.crossTileID]=new wu($n||pr,Hn||kr,di||w.justReloaded),h[tn.crossTileID]=!0}};if(qt)for(var sn=w.getSortedSymbolIndexes(this.transform.angle),Zn=sn.length-1;Zn>=0;--Zn){var jn=sn[Zn];_r(w.symbolInstances.get(jn),w.collisionArrays[jn])}else for(var kn=l.symbolInstanceStart;kn<l.symbolInstanceEnd;kn++)_r(w.symbolInstances.get(kn),w.collisionArrays[kn]);if(c&&w.bucketInstanceId in this.collisionCircleArrays){var ki=this.collisionCircleArrays[w.bucketInstanceId];g.invert(ki.invProjMatrix,L),ki.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1},Qa.prototype.markUsedJustification=function(l,h,c,d){var E;E=d===g.WritingMode.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[g.getAnchorJustification(h)];for(var w=0,P=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];w<P.length;w+=1){var L=P[w];L>=0&&(l.text.placedSymbolArray.get(L).crossTileID=E>=0&&L!==E?0:c.crossTileID)}},Qa.prototype.markUsedOrientation=function(l,h,c){for(var d=h===g.WritingMode.horizontal||h===g.WritingMode.horizontalOnly?h:0,E=h===g.WritingMode.vertical?h:0,w=0,P=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];w<P.length;w+=1)l.text.placedSymbolArray.get(P[w]).placedOrientation=d;c.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=E)},Qa.prototype.commit=function(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;var h=this.prevPlacement,c=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;var d=h?h.symbolFadeChange(l):1,E=h?h.opacities:{},w=h?h.variableOffsets:{},P=h?h.placedOrientations:{};for(var L in this.placements){var U=this.placements[L],H=E[L];H?(this.opacities[L]=new jo(H,d,U.text,U.icon),c=c||U.text!==H.text.placed||U.icon!==H.icon.placed):(this.opacities[L]=new jo(null,d,U.text,U.icon,U.skipFade),c=c||U.text||U.icon)}for(var oe in E){var ue=E[oe];if(!this.opacities[oe]){var le=new jo(ue,d,!1,!1);le.isHidden()||(this.opacities[oe]=le,c=c||ue.text.placed||ue.icon.placed)}}for(var Ie in w)this.variableOffsets[Ie]||!this.opacities[Ie]||this.opacities[Ie].isHidden()||(this.variableOffsets[Ie]=w[Ie]);for(var Pe in P)this.placedOrientations[Pe]||!this.opacities[Pe]||this.opacities[Pe].isHidden()||(this.placedOrientations[Pe]=P[Pe]);c?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:l)},Qa.prototype.updateLayerOpacities=function(l,h){for(var c={},d=0,E=h;d<E.length;d+=1){var w=E[d],P=w.getBucket(l);P&&w.latestFeatureIndex&&l.id===P.layerIds[0]&&this.updateBucketOpacities(P,c,w.collisionBoxArray)}},Qa.prototype.updateBucketOpacities=function(l,h,c){var d=this;l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();var E=l.layers[0].layout,w=new jo(null,0,!1,!1,!0),P=E.get("text-allow-overlap"),L=E.get("icon-allow-overlap"),U=E.get("text-variable-anchor"),H=E.get("text-rotation-alignment")==="map",oe=E.get("text-pitch-alignment")==="map",ue=E.get("icon-text-fit")!=="none",le=new jo(null,0,P&&(L||!l.hasIconData()||E.get("icon-optional")),L&&(P||!l.hasTextData()||E.get("text-optional")),!0);!l.collisionArrays&&c&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(c);for(var Ie=function(je,Ke,vt){for(var Wt=0;Wt<Ke/4;Wt++)je.opacityVertexArray.emplaceBack(vt)},Pe=function(je){var Ke=l.symbolInstances.get(je),vt=Ke.numHorizontalGlyphVertices,Wt=Ke.numVerticalGlyphVertices,jt=Ke.crossTileID,qt=d.opacities[jt];h[jt]?qt=w:qt||(d.opacities[jt]=qt=le),h[jt]=!0;var pr=Ke.numIconVertices>0,kr=d.placedOrientations[Ke.crossTileID],_r=kr===g.WritingMode.vertical,sn=kr===g.WritingMode.horizontal||kr===g.WritingMode.horizontalOnly;if(vt>0||Wt>0){var Zn=On(qt.text);Ie(l.text,vt,_r?Mi:Zn),Ie(l.text,Wt,sn?Mi:Zn);var jn=qt.text.isHidden();[Ke.rightJustifiedTextSymbolIndex,Ke.centerJustifiedTextSymbolIndex,Ke.leftJustifiedTextSymbolIndex].forEach(function(Xn){Xn>=0&&(l.text.placedSymbolArray.get(Xn).hidden=jn||_r?1:0)}),Ke.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(Ke.verticalPlacedTextSymbolIndex).hidden=jn||sn?1:0);var kn=d.variableOffsets[Ke.crossTileID];kn&&d.markUsedJustification(l,kn.anchor,Ke,kr);var ki=d.placedOrientations[Ke.crossTileID];ki&&(d.markUsedJustification(l,"left",Ke,ki),d.markUsedOrientation(l,ki,Ke))}if(pr){var tn=On(qt.icon),ii=!(ue&&Ke.verticalPlacedIconSymbolIndex&&_r);Ke.placedIconSymbolIndex>=0&&(Ie(l.icon,Ke.numIconVertices,ii?tn:Mi),l.icon.placedSymbolArray.get(Ke.placedIconSymbolIndex).hidden=qt.icon.isHidden()),Ke.verticalPlacedIconSymbolIndex>=0&&(Ie(l.icon,Ke.numVerticalIconVertices,ii?Mi:tn),l.icon.placedSymbolArray.get(Ke.verticalPlacedIconSymbolIndex).hidden=qt.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){var li=l.collisionArrays[je];if(li){var $n=new g.Point(0,0);if(li.textBox||li.verticalTextBox){var Hn=!0;if(U){var di=d.variableOffsets[jt];di?($n=$a(di.anchor,di.width,di.height,di.textOffset,di.textBoxScale),H&&$n._rotate(oe?d.transform.angle:-d.transform.angle)):Hn=!1}li.textBox&&Ms(l.textCollisionBox.collisionVertexArray,qt.text.placed,!Hn||_r,$n.x,$n.y),li.verticalTextBox&&Ms(l.textCollisionBox.collisionVertexArray,qt.text.placed,!Hn||sn,$n.x,$n.y)}var Kn=Boolean(!sn&&li.verticalIconBox);li.iconBox&&Ms(l.iconCollisionBox.collisionVertexArray,qt.icon.placed,Kn,ue?$n.x:0,ue?$n.y:0),li.verticalIconBox&&Ms(l.iconCollisionBox.collisionVertexArray,qt.icon.placed,!Kn,ue?$n.x:0,ue?$n.y:0)}}},Ne=0;Ne<l.symbolInstances.length;Ne++)Pe(Ne);if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){var xe=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=xe.invProjMatrix,l.placementViewportMatrix=xe.viewportMatrix,l.collisionCircleArray=xe.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}},Qa.prototype.symbolFadeChange=function(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Qa.prototype.zoomAdjustment=function(l){return Math.max(0,(this.transform.zoom-l)/1.5)},Qa.prototype.hasTransitions=function(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration},Qa.prototype.stillRecent=function(l,h){var c=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*c>l},Qa.prototype.setStale=function(){this.stale=!0};var Ol=Math.pow(2,25),ys=Math.pow(2,24),te=Math.pow(2,17),ye=Math.pow(2,16),Xe=Math.pow(2,9),It=Math.pow(2,8),Or=Math.pow(2,1);function On(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;var h=l.placed?1:0,c=Math.floor(127*l.opacity);return c*Ol+h*ys+c*te+h*ye+c*Xe+h*It+c*Or+h}var Mi=0,oo=function(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};oo.prototype.continuePlacement=function(l,h,c,d,E){for(var w=this._bucketParts;this._currentTileIndex<l.length;)if(h.getBucketParts(w,d,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,E())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort(function(P,L){return P.sortKey-L.sortKey}));this._currentPartIndex<w.length;)if(h.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,E())return!0;return!1};var Ra=function(l,h,c,d,E,w,P){this.placement=new Qa(l,E,w,P),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=d,this._done=!1};Ra.prototype.isDone=function(){return this._done},Ra.prototype.continuePlacement=function(l,h,c){for(var d=this,E=g.browser.now(),w=function(){var U=g.browser.now()-E;return!d._forceFullPlacement&&U>2};this._currentPlacementIndex>=0;){var P=h[l[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(P.type==="symbol"&&(!P.minzoom||P.minzoom<=L)&&(!P.maxzoom||P.maxzoom>L)){if(this._inProgressLayer||(this._inProgressLayer=new oo(P)),this._inProgressLayer.continuePlacement(c[P.source],this.placement,this._showCollisionBoxes,P,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Ra.prototype.commit=function(l){return this.placement.commit(l),this.placement};var Ua=512/g.EXTENT/2,Vo=function(l,h,c){this.tileID=l,this.indexedSymbolInstances={},this.bucketInstanceId=c;for(var d=0;d<h.length;d++){var E=h.get(d),w=E.key;this.indexedSymbolInstances[w]||(this.indexedSymbolInstances[w]=[]),this.indexedSymbolInstances[w].push({crossTileID:E.crossTileID,coord:this.getScaledCoordinates(E,l)})}};Vo.prototype.getScaledCoordinates=function(l,h){var c=Ua/Math.pow(2,h.canonical.z-this.tileID.canonical.z);return{x:Math.floor((h.canonical.x*g.EXTENT+l.anchorX)*c),y:Math.floor((h.canonical.y*g.EXTENT+l.anchorY)*c)}},Vo.prototype.findMatches=function(l,h,c){for(var d=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z),E=0;E<l.length;E++){var w=l.get(E);if(!w.crossTileID){var P=this.indexedSymbolInstances[w.key];if(P)for(var L=this.getScaledCoordinates(w,h),U=0,H=P;U<H.length;U+=1){var oe=H[U];if(Math.abs(oe.coord.x-L.x)<=d&&Math.abs(oe.coord.y-L.y)<=d&&!c[oe.crossTileID]){c[oe.crossTileID]=!0,w.crossTileID=oe.crossTileID;break}}}}};var _s=function(){this.maxCrossTileID=0};_s.prototype.generate=function(){return++this.maxCrossTileID};var lo=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};lo.prototype.handleWrapJump=function(l){var h=Math.round((l-this.lng)/360);if(h!==0)for(var c in this.indexes){var d=this.indexes[c],E={};for(var w in d){var P=d[w];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+h),E[P.tileID.key]=P}this.indexes[c]=E}this.lng=l},lo.prototype.addBucket=function(l,h,c){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(var d=0;d<h.symbolInstances.length;d++)h.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});var E=this.usedCrossTileIDs[l.overscaledZ];for(var w in this.indexes){var P=this.indexes[w];if(Number(w)>l.overscaledZ)for(var L in P){var U=P[L];U.tileID.isChildOf(l)&&U.findMatches(h.symbolInstances,l,E)}else{var H=P[l.scaledTo(Number(w)).key];H&&H.findMatches(h.symbolInstances,l,E)}}for(var oe=0;oe<h.symbolInstances.length;oe++){var ue=h.symbolInstances.get(oe);ue.crossTileID||(ue.crossTileID=c.generate(),E[ue.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Vo(l,h.symbolInstances,h.bucketInstanceId),!0},lo.prototype.removeBucketCrossTileIDs=function(l,h){for(var c in h.indexedSymbolInstances)for(var d=0,E=h.indexedSymbolInstances[c];d<E.length;d+=1)delete this.usedCrossTileIDs[l][E[d].crossTileID]},lo.prototype.removeStaleBuckets=function(l){var h=!1;for(var c in this.indexes){var d=this.indexes[c];for(var E in d)l[d[E].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,d[E]),delete d[E],h=!0)}return h};var wo=function(){this.layerIndexes={},this.crossTileIDs=new _s,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};wo.prototype.addLayer=function(l,h,c){var d=this.layerIndexes[l.id];d===void 0&&(d=this.layerIndexes[l.id]=new lo);var E=!1,w={};d.handleWrapJump(c);for(var P=0,L=h;P<L.length;P+=1){var U=L[P],H=U.getBucket(l);H&&l.id===H.layerIds[0]&&(H.bucketInstanceId||(H.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(U.tileID,H,this.crossTileIDs)&&(E=!0),w[H.bucketInstanceId]=!0)}return d.removeStaleBuckets(w)&&(E=!0),E},wo.prototype.pruneUnusedLayers=function(l){var h={};for(var c in l.forEach(function(d){h[d]=!0}),this.layerIndexes)h[c]||delete this.layerIndexes[c]};var xs=function(l,h){return g.emitValidationErrors(l,h&&h.filter(function(c){return c.identifier!=="source.canvas"}))},Ps=g.pick(Wr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Fs=g.pick(Wr,["setCenter","setZoom","setBearing","setPitch"]),fu=function(){var l={},h=g.styleSpec.$version;for(var c in g.styleSpec.$root){var d,E=g.styleSpec.$root[c];E.required&&(d=c==="version"?h:E.type==="array"?[]:{})!=null&&(l[c]=d)}return l}(),bs=function(l){function h(c,d){var E=this;d===void 0&&(d={}),l.call(this),this.map=c,this.dispatcher=new Ht(Mt(),this),this.imageManager=new Tt,this.imageManager.setEventedParent(this),this.glyphManager=new Xt(c._requestManager,d.localIdeographFontFamily),this.lineAtlas=new $e(256,512),this.crossTileSymbolIndex=new wo,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new g.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",g.getReferrer());var w=this;this._rtlTextPluginCallback=h.registerForPluginStateChange(function(P){w.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:P.pluginStatus,pluginURL:P.pluginURL},function(L,U){if(g.triggerPluginCompletionEvent(L),U&&U.every(function(oe){return oe}))for(var H in w.sourceCaches)w.sourceCaches[H].reload()})}),this.on("data",function(P){if(P.dataType==="source"&&P.sourceDataType==="metadata"){var L=E.sourceCaches[P.sourceId];if(L){var U=L.getSource();if(U&&U.vectorLayerIds)for(var H in E._layers){var oe=E._layers[H];oe.source===U.id&&E._validateLayer(oe)}}}})}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.loadURL=function(c,d){var E=this;d===void 0&&(d={}),this.fire(new g.Event("dataloading",{dataType:"style"}));var w=typeof d.validate=="boolean"?d.validate:!g.isMapboxURL(c);c=this.map._requestManager.normalizeStyleURL(c,d.accessToken);var P=this.map._requestManager.transformRequest(c,g.ResourceType.Style);this._request=g.getJSON(P,function(L,U){E._request=null,L?E.fire(new g.ErrorEvent(L)):U&&E._load(U,w)})},h.prototype.loadJSON=function(c,d){var E=this;d===void 0&&(d={}),this.fire(new g.Event("dataloading",{dataType:"style"})),this._request=g.browser.frame(function(){E._request=null,E._load(c,d.validate!==!1)})},h.prototype.loadEmpty=function(){this.fire(new g.Event("dataloading",{dataType:"style"})),this._load(fu,!1)},h.prototype._load=function(c,d){if(!d||!xs(this,g.validateStyle(c))){for(var E in this._loaded=!0,this.stylesheet=c,c.sources)this.addSource(E,c.sources[E],{validate:!1});c.sprite?this._loadSprite(c.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(c.glyphs);var w=Br(this.stylesheet.layers);this._order=w.map(function(H){return H.id}),this._layers={},this._serializedLayers={};for(var P=0,L=w;P<L.length;P+=1){var U=L[P];(U=g.createStyleLayer(U)).setEventedParent(this,{layer:{id:U.id}}),this._layers[U.id]=U,this._serializedLayers[U.id]=U.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Et(this.stylesheet.light),this.fire(new g.Event("data",{dataType:"style"})),this.fire(new g.Event("style.load"))}},h.prototype._loadSprite=function(c){var d=this;this._spriteRequest=function(E,w,P){var L,U,H,oe=g.browser.devicePixelRatio>1?"@2x":"",ue=g.getJSON(w.transformRequest(w.normalizeSpriteURL(E,oe,".json"),g.ResourceType.SpriteJSON),function(Pe,Ne){ue=null,H||(H=Pe,L=Ne,Ie())}),le=g.getImage(w.transformRequest(w.normalizeSpriteURL(E,oe,".png"),g.ResourceType.SpriteImage),function(Pe,Ne){le=null,H||(H=Pe,U=Ne,Ie())});function Ie(){if(H)P(H);else if(L&&U){var Pe=g.browser.getImageData(U),Ne={};for(var xe in L){var je=L[xe],Ke=je.width,vt=je.height,Wt=je.x,jt=je.y,qt=je.sdf,pr=je.pixelRatio,kr=je.stretchX,_r=je.stretchY,sn=je.content,Zn=new g.RGBAImage({width:Ke,height:vt});g.RGBAImage.copy(Pe,Zn,{x:Wt,y:jt},{x:0,y:0},{width:Ke,height:vt}),Ne[xe]={data:Zn,pixelRatio:pr,sdf:qt,stretchX:kr,stretchY:_r,content:sn}}P(null,Ne)}}return{cancel:function(){ue&&(ue.cancel(),ue=null),le&&(le.cancel(),le=null)}}}(c,this.map._requestManager,function(E,w){if(d._spriteRequest=null,E)d.fire(new g.ErrorEvent(E));else if(w)for(var P in w)d.imageManager.addImage(P,w[P]);d.imageManager.setLoaded(!0),d._availableImages=d.imageManager.listImages(),d.dispatcher.broadcast("setImages",d._availableImages),d.fire(new g.Event("data",{dataType:"style"}))})},h.prototype._validateLayer=function(c){var d=this.sourceCaches[c.source];if(d){var E=c.sourceLayer;if(E){var w=d.getSource();(w.type==="geojson"||w.vectorLayerIds&&w.vectorLayerIds.indexOf(E)===-1)&&this.fire(new g.ErrorEvent(new Error('Source layer "'+E+'" does not exist on source "'+w.id+'" as specified by style layer "'+c.id+'"')))}}},h.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var c in this.sourceCaches)if(!this.sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()},h.prototype._serializeLayers=function(c){for(var d=[],E=0,w=c;E<w.length;E+=1){var P=this._layers[w[E]];P.type!=="custom"&&d.push(P.serialize())}return d},h.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var c in this.sourceCaches)if(this.sourceCaches[c].hasTransition())return!0;for(var d in this._layers)if(this._layers[d].hasTransition())return!0;return!1},h.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},h.prototype.update=function(c){if(this._loaded){var d=this._changed;if(this._changed){var E=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);for(var P in(E.length||w.length)&&this._updateWorkerLayers(E,w),this._updatedSources){var L=this._updatedSources[P];L==="reload"?this._reloadSource(P):L==="clear"&&this._clearSource(P)}for(var U in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[U].updateTransitions(c);this.light.updateTransitions(c),this._resetUpdates()}var H={};for(var oe in this.sourceCaches){var ue=this.sourceCaches[oe];H[oe]=ue.used,ue.used=!1}for(var le=0,Ie=this._order;le<Ie.length;le+=1){var Pe=this._layers[Ie[le]];Pe.recalculate(c,this._availableImages),!Pe.isHidden(c.zoom)&&Pe.source&&(this.sourceCaches[Pe.source].used=!0)}for(var Ne in H){var xe=this.sourceCaches[Ne];H[Ne]!==xe.used&&xe.fire(new g.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:Ne}))}this.light.recalculate(c),this.z=c.zoom,d&&this.fire(new g.Event("data",{dataType:"style"}))}},h.prototype._updateTilesForChangedImages=function(){var c=Object.keys(this._changedImages);if(c.length){for(var d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}},h.prototype._updateWorkerLayers=function(c,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(c),removedIds:d})},h.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},h.prototype.setState=function(c){var d=this;if(this._checkLoaded(),xs(this,g.validateStyle(c)))return!1;(c=g.clone$1(c)).layers=Br(c.layers);var E=function(P,L){if(!P)return[{command:Wr.setStyle,args:[L]}];var U=[];try{if(!g.deepEqual(P.version,L.version))return[{command:Wr.setStyle,args:[L]}];g.deepEqual(P.center,L.center)||U.push({command:Wr.setCenter,args:[L.center]}),g.deepEqual(P.zoom,L.zoom)||U.push({command:Wr.setZoom,args:[L.zoom]}),g.deepEqual(P.bearing,L.bearing)||U.push({command:Wr.setBearing,args:[L.bearing]}),g.deepEqual(P.pitch,L.pitch)||U.push({command:Wr.setPitch,args:[L.pitch]}),g.deepEqual(P.sprite,L.sprite)||U.push({command:Wr.setSprite,args:[L.sprite]}),g.deepEqual(P.glyphs,L.glyphs)||U.push({command:Wr.setGlyphs,args:[L.glyphs]}),g.deepEqual(P.transition,L.transition)||U.push({command:Wr.setTransition,args:[L.transition]}),g.deepEqual(P.light,L.light)||U.push({command:Wr.setLight,args:[L.light]});var H={},oe=[];(function(le,Ie,Pe,Ne){var xe;for(xe in Ie=Ie||{},le=le||{})le.hasOwnProperty(xe)&&(Ie.hasOwnProperty(xe)||en(xe,Pe,Ne));for(xe in Ie)Ie.hasOwnProperty(xe)&&(le.hasOwnProperty(xe)?g.deepEqual(le[xe],Ie[xe])||(le[xe].type==="geojson"&&Ie[xe].type==="geojson"&&Wi(le,Ie,xe)?Pe.push({command:Wr.setGeoJSONSourceData,args:[xe,Ie[xe].data]}):dn(xe,Ie,Pe,Ne)):mi(xe,Ie,Pe))})(P.sources,L.sources,oe,H);var ue=[];P.layers&&P.layers.forEach(function(le){H[le.source]?U.push({command:Wr.removeLayer,args:[le.id]}):ue.push(le)}),U=U.concat(oe),function(le,Ie,Pe){Ie=Ie||[];var Ne,xe,je,Ke,vt,Wt,jt,qt=(le=le||[]).map(wi),pr=Ie.map(wi),kr=le.reduce(_i,{}),_r=Ie.reduce(_i,{}),sn=qt.slice(),Zn=Object.create(null);for(Ne=0,xe=0;Ne<qt.length;Ne++)_r.hasOwnProperty(je=qt[Ne])?xe++:(Pe.push({command:Wr.removeLayer,args:[je]}),sn.splice(sn.indexOf(je,xe),1));for(Ne=0,xe=0;Ne<pr.length;Ne++)sn[sn.length-1-Ne]!==(je=pr[pr.length-1-Ne])&&(kr.hasOwnProperty(je)?(Pe.push({command:Wr.removeLayer,args:[je]}),sn.splice(sn.lastIndexOf(je,sn.length-xe),1)):xe++,Pe.push({command:Wr.addLayer,args:[_r[je],Wt=sn[sn.length-Ne]]}),sn.splice(sn.length-Ne,0,je),Zn[je]=!0);for(Ne=0;Ne<pr.length;Ne++)if(Ke=kr[je=pr[Ne]],vt=_r[je],!Zn[je]&&!g.deepEqual(Ke,vt))if(g.deepEqual(Ke.source,vt.source)&&g.deepEqual(Ke["source-layer"],vt["source-layer"])&&g.deepEqual(Ke.type,vt.type)){for(jt in hi(Ke.layout,vt.layout,Pe,je,null,Wr.setLayoutProperty),hi(Ke.paint,vt.paint,Pe,je,null,Wr.setPaintProperty),g.deepEqual(Ke.filter,vt.filter)||Pe.push({command:Wr.setFilter,args:[je,vt.filter]}),g.deepEqual(Ke.minzoom,vt.minzoom)&&g.deepEqual(Ke.maxzoom,vt.maxzoom)||Pe.push({command:Wr.setLayerZoomRange,args:[je,vt.minzoom,vt.maxzoom]}),Ke)Ke.hasOwnProperty(jt)&&jt!=="layout"&&jt!=="paint"&&jt!=="filter"&&jt!=="metadata"&&jt!=="minzoom"&&jt!=="maxzoom"&&(jt.indexOf("paint.")===0?hi(Ke[jt],vt[jt],Pe,je,jt.slice(6),Wr.setPaintProperty):g.deepEqual(Ke[jt],vt[jt])||Pe.push({command:Wr.setLayerProperty,args:[je,jt,vt[jt]]}));for(jt in vt)vt.hasOwnProperty(jt)&&!Ke.hasOwnProperty(jt)&&jt!=="layout"&&jt!=="paint"&&jt!=="filter"&&jt!=="metadata"&&jt!=="minzoom"&&jt!=="maxzoom"&&(jt.indexOf("paint.")===0?hi(Ke[jt],vt[jt],Pe,je,jt.slice(6),Wr.setPaintProperty):g.deepEqual(Ke[jt],vt[jt])||Pe.push({command:Wr.setLayerProperty,args:[je,jt,vt[jt]]}))}else Pe.push({command:Wr.removeLayer,args:[je]}),Wt=sn[sn.lastIndexOf(je)+1],Pe.push({command:Wr.addLayer,args:[vt,Wt]})}(ue,L.layers,U)}catch(le){console.warn("Unable to compute style diff:",le),U=[{command:Wr.setStyle,args:[L]}]}return U}(this.serialize(),c).filter(function(P){return!(P.command in Fs)});if(E.length===0)return!1;var w=E.filter(function(P){return!(P.command in Ps)});if(w.length>0)throw new Error("Unimplemented: "+w.map(function(P){return P.command}).join(", ")+".");return E.forEach(function(P){P.command!=="setTransition"&&d[P.command].apply(d,P.args)}),this.stylesheet=c,!0},h.prototype.addImage=function(c,d){if(this.getImage(c))return this.fire(new g.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(c,d),this._afterImageUpdated(c)},h.prototype.updateImage=function(c,d){this.imageManager.updateImage(c,d)},h.prototype.getImage=function(c){return this.imageManager.getImage(c)},h.prototype.removeImage=function(c){if(!this.getImage(c))return this.fire(new g.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(c),this._afterImageUpdated(c)},h.prototype._afterImageUpdated=function(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new g.Event("data",{dataType:"style"}))},h.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},h.prototype.addSource=function(c,d,E){var w=this;if(E===void 0&&(E={}),this._checkLoaded(),this.sourceCaches[c]!==void 0)throw new Error("There is already a source with this ID");if(!d.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(d).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(g.validateStyle.source,"sources."+c,d,null,E))){this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);var P=this.sourceCaches[c]=new Le(c,d,this.dispatcher);P.style=this,P.setEventedParent(this,function(){return{isSourceLoaded:w.loaded(),source:P.serialize(),sourceId:c}}),P.onAdd(this.map),this._changed=!0}},h.prototype.removeSource=function(c){if(this._checkLoaded(),this.sourceCaches[c]===void 0)throw new Error("There is no source with this ID");for(var d in this._layers)if(this._layers[d].source===c)return this.fire(new g.ErrorEvent(new Error('Source "'+c+'" cannot be removed while layer "'+d+'" is using it.')));var E=this.sourceCaches[c];delete this.sourceCaches[c],delete this._updatedSources[c],E.fire(new g.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:c})),E.setEventedParent(null),E.clearTiles(),E.onRemove&&E.onRemove(this.map),this._changed=!0},h.prototype.setGeoJSONSourceData=function(c,d){this._checkLoaded(),this.sourceCaches[c].getSource().setData(d),this._changed=!0},h.prototype.getSource=function(c){return this.sourceCaches[c]&&this.sourceCaches[c].getSource()},h.prototype.addLayer=function(c,d,E){E===void 0&&(E={}),this._checkLoaded();var w=c.id;if(this.getLayer(w))this.fire(new g.ErrorEvent(new Error('Layer with id "'+w+'" already exists on this map')));else{var P;if(c.type==="custom"){if(xs(this,g.validateCustomStyleLayer(c)))return;P=g.createStyleLayer(c)}else{if(typeof c.source=="object"&&(this.addSource(w,c.source),c=g.clone$1(c),c=g.extend(c,{source:w})),this._validate(g.validateStyle.layer,"layers."+w,c,{arrayIndex:-1},E))return;P=g.createStyleLayer(c),this._validateLayer(P),P.setEventedParent(this,{layer:{id:w}}),this._serializedLayers[P.id]=P.serialize()}var L=d?this._order.indexOf(d):this._order.length;if(d&&L===-1)this.fire(new g.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.')));else{if(this._order.splice(L,0,w),this._layerOrderChanged=!0,this._layers[w]=P,this._removedLayers[w]&&P.source&&P.type!=="custom"){var U=this._removedLayers[w];delete this._removedLayers[w],U.type!==P.type?this._updatedSources[P.source]="clear":(this._updatedSources[P.source]="reload",this.sourceCaches[P.source].pause())}this._updateLayer(P),P.onAdd&&P.onAdd(this.map)}}},h.prototype.moveLayer=function(c,d){if(this._checkLoaded(),this._changed=!0,this._layers[c]){if(c!==d){var E=this._order.indexOf(c);this._order.splice(E,1);var w=d?this._order.indexOf(d):this._order.length;d&&w===-1?this.fire(new g.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.'))):(this._order.splice(w,0,c),this._layerOrderChanged=!0)}}else this.fire(new g.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be moved.")))},h.prototype.removeLayer=function(c){this._checkLoaded();var d=this._layers[c];if(d){d.setEventedParent(null);var E=this._order.indexOf(c);this._order.splice(E,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=d,delete this._layers[c],delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],d.onRemove&&d.onRemove(this.map)}else this.fire(new g.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be removed.")))},h.prototype.getLayer=function(c){return this._layers[c]},h.prototype.hasLayer=function(c){return c in this._layers},h.prototype.setLayerZoomRange=function(c,d,E){this._checkLoaded();var w=this.getLayer(c);w?w.minzoom===d&&w.maxzoom===E||(d!=null&&(w.minzoom=d),E!=null&&(w.maxzoom=E),this._updateLayer(w)):this.fire(new g.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot have zoom extent.")))},h.prototype.setFilter=function(c,d,E){E===void 0&&(E={}),this._checkLoaded();var w=this.getLayer(c);if(w){if(!g.deepEqual(w.filter,d))return d==null?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(g.validateStyle.filter,"layers."+w.id+".filter",d,null,E)||(w.filter=g.clone$1(d),this._updateLayer(w)))}else this.fire(new g.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be filtered.")))},h.prototype.getFilter=function(c){return g.clone$1(this.getLayer(c).filter)},h.prototype.setLayoutProperty=function(c,d,E,w){w===void 0&&(w={}),this._checkLoaded();var P=this.getLayer(c);P?g.deepEqual(P.getLayoutProperty(d),E)||(P.setLayoutProperty(d,E,w),this._updateLayer(P)):this.fire(new g.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},h.prototype.getLayoutProperty=function(c,d){var E=this.getLayer(c);if(E)return E.getLayoutProperty(d);this.fire(new g.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style.")))},h.prototype.setPaintProperty=function(c,d,E,w){w===void 0&&(w={}),this._checkLoaded();var P=this.getLayer(c);P?g.deepEqual(P.getPaintProperty(d),E)||(P.setPaintProperty(d,E,w)&&this._updateLayer(P),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new g.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},h.prototype.getPaintProperty=function(c,d){return this.getLayer(c).getPaintProperty(d)},h.prototype.setFeatureState=function(c,d){this._checkLoaded();var E=c.source,w=c.sourceLayer,P=this.sourceCaches[E];if(P!==void 0){var L=P.getSource().type;L==="geojson"&&w?this.fire(new g.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):L!=="vector"||w?(c.id===void 0&&this.fire(new g.ErrorEvent(new Error("The feature id parameter must be provided."))),P.setFeatureState(w,c.id,d)):this.fire(new g.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new g.ErrorEvent(new Error("The source '"+E+"' does not exist in the map's style.")))},h.prototype.removeFeatureState=function(c,d){this._checkLoaded();var E=c.source,w=this.sourceCaches[E];if(w!==void 0){var P=w.getSource().type,L=P==="vector"?c.sourceLayer:void 0;P!=="vector"||L?d&&typeof c.id!="string"&&typeof c.id!="number"?this.fire(new g.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):w.removeFeatureState(L,c.id,d):this.fire(new g.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new g.ErrorEvent(new Error("The source '"+E+"' does not exist in the map's style.")))},h.prototype.getFeatureState=function(c){this._checkLoaded();var d=c.source,E=c.sourceLayer,w=this.sourceCaches[d];if(w!==void 0){if(w.getSource().type!=="vector"||E)return c.id===void 0&&this.fire(new g.ErrorEvent(new Error("The feature id parameter must be provided."))),w.getFeatureState(E,c.id);this.fire(new g.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new g.ErrorEvent(new Error("The source '"+d+"' does not exist in the map's style.")))},h.prototype.getTransition=function(){return g.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},h.prototype.serialize=function(){return g.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:g.mapObject(this.sourceCaches,function(c){return c.serialize()}),layers:this._serializeLayers(this._order)},function(c){return c!==void 0})},h.prototype._updateLayer=function(c){this._updatedLayers[c.id]=!0,c.source&&!this._updatedSources[c.source]&&this.sourceCaches[c.source].getSource().type!=="raster"&&(this._updatedSources[c.source]="reload",this.sourceCaches[c.source].pause()),this._changed=!0},h.prototype._flattenAndSortRenderedFeatures=function(c){for(var d=this,E=function(kr){return d._layers[kr].type==="fill-extrusion"},w={},P=[],L=this._order.length-1;L>=0;L--){var U=this._order[L];if(E(U)){w[U]=L;for(var H=0,oe=c;H<oe.length;H+=1){var ue=oe[H][U];if(ue)for(var le=0,Ie=ue;le<Ie.length;le+=1)P.push(Ie[le])}}}P.sort(function(kr,_r){return _r.intersectionZ-kr.intersectionZ});for(var Pe=[],Ne=this._order.length-1;Ne>=0;Ne--){var xe=this._order[Ne];if(E(xe))for(var je=P.length-1;je>=0;je--){var Ke=P[je].feature;if(w[Ke.layer.id]<Ne)break;Pe.push(Ke),P.pop()}else for(var vt=0,Wt=c;vt<Wt.length;vt+=1){var jt=Wt[vt][xe];if(jt)for(var qt=0,pr=jt;qt<pr.length;qt+=1)Pe.push(pr[qt].feature)}}return Pe},h.prototype.queryRenderedFeatures=function(c,d,E){d&&d.filter&&this._validate(g.validateStyle.filter,"queryRenderedFeatures.filter",d.filter,null,d);var w={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new g.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var P=0,L=d.layers;P<L.length;P+=1){var U=L[P],H=this._layers[U];if(!H)return this.fire(new g.ErrorEvent(new Error("The layer '"+U+"' does not exist in the map's style and cannot be queried for features."))),[];w[H.source]=!0}}var oe=[];for(var ue in d.availableImages=this._availableImages,this.sourceCaches)d.layers&&!w[ue]||oe.push(Gr(this.sourceCaches[ue],this._layers,this._serializedLayers,c,d,E));return this.placement&&oe.push(function(le,Ie,Pe,Ne,xe,je,Ke){for(var vt={},Wt=je.queryRenderedSymbols(Ne),jt=[],qt=0,pr=Object.keys(Wt).map(Number);qt<pr.length;qt+=1)jt.push(Ke[pr[qt]]);jt.sort(Nn);for(var kr=function(){var kn=sn[_r],ki=kn.featureIndex.lookupSymbolFeatures(Wt[kn.bucketInstanceId],Ie,kn.bucketIndex,kn.sourceLayerIndex,xe.filter,xe.layers,xe.availableImages,le);for(var tn in ki){var ii=vt[tn]=vt[tn]||[],li=ki[tn];li.sort(function(di,Kn){var Xn=kn.featureSortOrder;if(Xn){var yo=Xn.indexOf(di.featureIndex);return Xn.indexOf(Kn.featureIndex)-yo}return Kn.featureIndex-di.featureIndex});for(var $n=0,Hn=li;$n<Hn.length;$n+=1)ii.push(Hn[$n])}},_r=0,sn=jt;_r<sn.length;_r+=1)kr();var Zn=function(kn){vt[kn].forEach(function(ki){var tn=ki.feature,ii=Pe[le[kn].source].getFeatureState(tn.layer["source-layer"],tn.id);tn.source=tn.layer.source,tn.layer["source-layer"]&&(tn.sourceLayer=tn.layer["source-layer"]),tn.state=ii})};for(var jn in vt)Zn(jn);return vt}(this._layers,this._serializedLayers,this.sourceCaches,c,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(oe)},h.prototype.querySourceFeatures=function(c,d){d&&d.filter&&this._validate(g.validateStyle.filter,"querySourceFeatures.filter",d.filter,null,d);var E=this.sourceCaches[c];return E?function(w,P){for(var L=w.getRenderableIds().map(function(Ie){return w.getTileByID(Ie)}),U=[],H={},oe=0;oe<L.length;oe++){var ue=L[oe],le=ue.tileID.canonical.key;H[le]||(H[le]=!0,ue.querySourceFeatures(U,P))}return U}(E,d):[]},h.prototype.addSourceType=function(c,d,E){return h.getSourceType(c)?E(new Error('A source type called "'+c+'" already exists.')):(h.setSourceType(c,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:d.workerSourceURL},E):E(null,null))},h.prototype.getLight=function(){return this.light.getLight()},h.prototype.setLight=function(c,d){d===void 0&&(d={}),this._checkLoaded();var E=this.light.getLight(),w=!1;for(var P in c)if(!g.deepEqual(c[P],E[P])){w=!0;break}if(w){var L={now:g.browser.now(),transition:g.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(c,d),this.light.updateTransitions(L)}},h.prototype._validate=function(c,d,E,w,P){return P===void 0&&(P={}),(!P||P.validate!==!1)&&xs(this,c.call(g.validateStyle,g.extend({key:d,style:this.serialize(),value:E,styleSpec:g.styleSpec},w)))},h.prototype._remove=function(){for(var c in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),g.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[c].setEventedParent(null);for(var d in this.sourceCaches)this.sourceCaches[d].clearTiles(),this.sourceCaches[d].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},h.prototype._clearSource=function(c){this.sourceCaches[c].clearTiles()},h.prototype._reloadSource=function(c){this.sourceCaches[c].resume(),this.sourceCaches[c].reload()},h.prototype._updateSources=function(c){for(var d in this.sourceCaches)this.sourceCaches[d].update(c)},h.prototype._generateCollisionBoxes=function(){for(var c in this.sourceCaches)this._reloadSource(c)},h.prototype._updatePlacement=function(c,d,E,w,P){P===void 0&&(P=!1);for(var L=!1,U=!1,H={},oe=0,ue=this._order;oe<ue.length;oe+=1){var le=this._layers[ue[oe]];if(le.type==="symbol"){if(!H[le.source]){var Ie=this.sourceCaches[le.source];H[le.source]=Ie.getRenderableIds(!0).map(function(Ke){return Ie.getTileByID(Ke)}).sort(function(Ke,vt){return vt.tileID.overscaledZ-Ke.tileID.overscaledZ||(Ke.tileID.isLessThan(vt.tileID)?-1:1)})}var Pe=this.crossTileSymbolIndex.addLayer(le,H[le.source],c.center.lng);L=L||Pe}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((P=P||this._layerOrderChanged||E===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(g.browser.now(),c.zoom))&&(this.pauseablePlacement=new Ra(c,this._order,P,d,E,w,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,H),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(g.browser.now()),U=!0),L&&this.pauseablePlacement.placement.setStale()),U||L)for(var Ne=0,xe=this._order;Ne<xe.length;Ne+=1){var je=this._layers[xe[Ne]];je.type==="symbol"&&this.placement.updateLayerOpacities(je,H[je.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(g.browser.now())},h.prototype._releaseSymbolFadeTiles=function(){for(var c in this.sourceCaches)this.sourceCaches[c].releaseSymbolFadeTiles()},h.prototype.getImages=function(c,d,E){this.imageManager.getImages(d.icons,E),this._updateTilesForChangedImages();var w=this.sourceCaches[d.source];w&&w.setDependencies(d.tileID.key,d.type,d.icons)},h.prototype.getGlyphs=function(c,d,E){this.glyphManager.getGlyphs(d.stacks,E)},h.prototype.getResource=function(c,d,E){return g.makeRequest(d,E)},h}(g.Evented);bs.getSourceType=function(l){return yr[l]},bs.setSourceType=function(l,h){yr[l]=h},bs.registerForPluginStateChange=g.registerForPluginStateChange;var ga=g.createLayout([{name:"a_pos",type:"Int16",components:2}]),xa=Vi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),is=Vi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),mf=Vi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Il=Vi(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),qs=Vi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),ac=Vi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Yu=Vi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Ks=Vi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),ul=Vi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),_=Vi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),M=Vi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),B=Vi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),R=Vi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),K=Vi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),ge=Vi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),He=Vi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),lt=Vi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),pt=Vi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),nr=Vi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),sr=Vi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Pn=Vi(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),ni=Vi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Rn=Vi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Xi=Vi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),va=Vi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),Ca=Vi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Vi(l,h){var c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=h.match(/attribute ([\w]+) ([\w]+)/g),E=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=h.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),P=w?w.concat(E):E,L={};return{fragmentSource:l=l.replace(c,function(U,H,oe,ue,le){return L[le]=!0,H==="define"?`
#ifndef HAS_UNIFORM_u_`+le+`
varying `+oe+" "+ue+" "+le+`;
#else
uniform `+oe+" "+ue+" u_"+le+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+le+`
    `+oe+" "+ue+" "+le+" = u_"+le+`;
#endif
`}),vertexSource:h=h.replace(c,function(U,H,oe,ue,le){var Ie=ue==="float"?"vec2":"vec4",Pe=le.match(/color/)?"color":Ie;return L[le]?H==="define"?`
#ifndef HAS_UNIFORM_u_`+le+`
uniform lowp float u_`+le+`_t;
attribute `+oe+" "+Ie+" a_"+le+`;
varying `+oe+" "+ue+" "+le+`;
#else
uniform `+oe+" "+ue+" u_"+le+`;
#endif
`:Pe==="vec4"?`
#ifndef HAS_UNIFORM_u_`+le+`
    `+le+" = a_"+le+`;
#else
    `+oe+" "+ue+" "+le+" = u_"+le+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+le+`
    `+le+" = unpack_mix_"+Pe+"(a_"+le+", u_"+le+`_t);
#else
    `+oe+" "+ue+" "+le+" = u_"+le+`;
#endif
`:H==="define"?`
#ifndef HAS_UNIFORM_u_`+le+`
uniform lowp float u_`+le+`_t;
attribute `+oe+" "+Ie+" a_"+le+`;
#else
uniform `+oe+" "+ue+" u_"+le+`;
#endif
`:Pe==="vec4"?`
#ifndef HAS_UNIFORM_u_`+le+`
    `+oe+" "+ue+" "+le+" = a_"+le+`;
#else
    `+oe+" "+ue+" "+le+" = u_"+le+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+le+`
    `+oe+" "+ue+" "+le+" = unpack_mix_"+Pe+"(a_"+le+", u_"+le+`_t);
#else
    `+oe+" "+ue+" "+le+" = u_"+le+`;
#endif
`}),staticAttributes:d,staticUniforms:P}}var Es=Object.freeze({__proto__:null,prelude:xa,background:is,backgroundPattern:mf,circle:Il,clippingMask:qs,heatmap:ac,heatmapTexture:Yu,collisionBox:Ks,collisionCircle:ul,debug:_,fill:M,fillOutline:B,fillOutlinePattern:R,fillPattern:K,fillExtrusion:ge,fillExtrusionPattern:He,hillshadePrepare:lt,hillshade:pt,line:nr,lineGradient:sr,linePattern:Pn,lineSDF:ni,raster:Rn,symbolIcon:Xi,symbolSDF:va,symbolTextAndIcon:Ca}),hu=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function qu(l){for(var h=[],c=0;c<l.length;c++)if(l[c]!==null){var d=l[c].split(" ");h.push(d.pop())}return h}hu.prototype.bind=function(l,h,c,d,E,w,P,L){this.context=l;for(var U=this.boundPaintVertexBuffers.length!==d.length,H=0;!U&&H<d.length;H++)this.boundPaintVertexBuffers[H]!==d[H]&&(U=!0);l.extVertexArrayObject&&this.vao&&this.boundProgram===h&&this.boundLayoutVertexBuffer===c&&!U&&this.boundIndexBuffer===E&&this.boundVertexOffset===w&&this.boundDynamicVertexBuffer===P&&this.boundDynamicVertexBuffer2===L?(l.bindVertexArrayOES.set(this.vao),P&&P.bind(),E&&E.dynamicDraw&&E.bind(),L&&L.bind()):this.freshBind(h,c,d,E,w,P,L)},hu.prototype.freshBind=function(l,h,c,d,E,w,P){var L,U=l.numAttributes,H=this.context,oe=H.gl;if(H.extVertexArrayObject)this.vao&&this.destroy(),this.vao=H.extVertexArrayObject.createVertexArrayOES(),H.bindVertexArrayOES.set(this.vao),L=0,this.boundProgram=l,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=d,this.boundVertexOffset=E,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=P;else{L=H.currentNumAttributes||0;for(var ue=U;ue<L;ue++)oe.disableVertexAttribArray(ue)}h.enableAttributes(oe,l);for(var le=0,Ie=c;le<Ie.length;le+=1)Ie[le].enableAttributes(oe,l);w&&w.enableAttributes(oe,l),P&&P.enableAttributes(oe,l),h.bind(),h.setVertexAttribPointers(oe,l,E);for(var Pe=0,Ne=c;Pe<Ne.length;Pe+=1){var xe=Ne[Pe];xe.bind(),xe.setVertexAttribPointers(oe,l,E)}w&&(w.bind(),w.setVertexAttribPointers(oe,l,E)),d&&d.bind(),P&&(P.bind(),P.setVertexAttribPointers(oe,l,E)),H.currentNumAttributes=U},hu.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var gf=function(l,h,c,d,E,w){var P=l.gl;this.program=P.createProgram();for(var L=qu(c.staticAttributes),U=d?d.getBinderAttributes():[],H=L.concat(U),oe=c.staticUniforms?qu(c.staticUniforms):[],ue=d?d.getBinderUniforms():[],le=[],Ie=0,Pe=oe.concat(ue);Ie<Pe.length;Ie+=1){var Ne=Pe[Ie];le.indexOf(Ne)<0&&le.push(Ne)}var xe=d?d.defines():[];w&&xe.push("#define OVERDRAW_INSPECTOR;");var je=xe.concat(xa.fragmentSource,c.fragmentSource).join(`
`),Ke=xe.concat(xa.vertexSource,c.vertexSource).join(`
`),vt=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(vt,je),P.compileShader(vt),P.attachShader(this.program,vt);var Wt=P.createShader(P.VERTEX_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(Wt,Ke),P.compileShader(Wt),P.attachShader(this.program,Wt),this.attributes={};var jt={};this.numAttributes=H.length;for(var qt=0;qt<this.numAttributes;qt++)H[qt]&&(P.bindAttribLocation(this.program,qt,H[qt]),this.attributes[H[qt]]=qt);P.linkProgram(this.program),P.deleteShader(Wt),P.deleteShader(vt);for(var pr=0;pr<le.length;pr++){var kr=le[pr];if(kr&&!jt[kr]){var _r=P.getUniformLocation(this.program,kr);_r&&(jt[kr]=_r)}}this.fixedUniforms=E(l,jt),this.binderUniforms=d?d.getUniforms(l,jt):[]}}};function ll(l,h,c){var d=1/ua(c,1,h.transform.tileZoom),E=Math.pow(2,c.tileID.overscaledZ),w=c.tileSize*Math.pow(2,h.transform.tileZoom)/E,P=w*(c.tileID.canonical.x+c.tileID.wrap*E),L=w*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[d,l.fromScale,l.toScale],u_fade:l.t,u_pixel_coord_upper:[P>>16,L>>16],u_pixel_coord_lower:[65535&P,65535&L]}}gf.prototype.draw=function(l,h,c,d,E,w,P,L,U,H,oe,ue,le,Ie,Pe,Ne){var xe,je=l.gl;if(!this.failedToCreate){for(var Ke in l.program.set(this.program),l.setDepthMode(c),l.setStencilMode(d),l.setColorMode(E),l.setCullFace(w),this.fixedUniforms)this.fixedUniforms[Ke].set(P[Ke]);Ie&&Ie.setUniforms(l,this.binderUniforms,ue,{zoom:le});for(var vt=(xe={},xe[je.LINES]=2,xe[je.TRIANGLES]=3,xe[je.LINE_STRIP]=1,xe)[h],Wt=0,jt=oe.get();Wt<jt.length;Wt+=1){var qt=jt[Wt],pr=qt.vaos||(qt.vaos={});(pr[L]||(pr[L]=new hu)).bind(l,this,U,Ie?Ie.getPaintVertexBuffers():[],H,qt.vertexOffset,Pe,Ne),je.drawElements(h,qt.primitiveLength*vt,je.UNSIGNED_SHORT,qt.primitiveOffset*vt*2)}}};var Bc=function(l,h,c,d){var E=h.style.light,w=E.properties.get("position"),P=[w.x,w.y,w.z],L=g.create$1();E.properties.get("anchor")==="viewport"&&g.fromRotation(L,-h.transform.angle),g.transformMat3(P,P,L);var U=E.properties.get("color");return{u_matrix:l,u_lightpos:P,u_lightintensity:E.properties.get("intensity"),u_lightcolor:[U.r,U.g,U.b],u_vertical_gradient:+c,u_opacity:d}},Tu=function(l,h,c,d,E,w,P){return g.extend(Bc(l,h,c,d),ll(w,h,P),{u_height_factor:-Math.pow(2,E.overscaledZ)/P.tileSize/8})},Mu=function(l){return{u_matrix:l}},Pu=function(l,h,c,d){return g.extend(Mu(l),ll(c,h,d))},co=function(l,h){return{u_matrix:l,u_world:h}},Gf=function(l,h,c,d,E){return g.extend(Pu(l,h,c,d),{u_world:E})},Hf=function(l,h,c,d){var E,w,P=l.transform;if(d.paint.get("circle-pitch-alignment")==="map"){var L=ua(c,1,P.zoom);E=!0,w=[L,L]}else E=!1,w=P.pixelsToGLUnits;return{u_camera_to_center_distance:P.cameraToCenterDistance,u_scale_with_map:+(d.paint.get("circle-pitch-scale")==="map"),u_matrix:l.translatePosMatrix(h.posMatrix,c,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_pitch_with_map:+E,u_device_pixel_ratio:g.browser.devicePixelRatio,u_extrude_scale:w}},$o=function(l,h,c){var d=ua(c,1,h.zoom),E=Math.pow(2,h.zoom-c.tileID.overscaledZ),w=c.tileID.overscaleFactor();return{u_matrix:l,u_camera_to_center_distance:h.cameraToCenterDistance,u_pixels_to_tile_units:d,u_extrude_scale:[h.pixelsToGLUnits[0]/(d*E),h.pixelsToGLUnits[1]/(d*E)],u_overscale_factor:w}},Nc=function(l,h,c){return{u_matrix:l,u_inv_matrix:h,u_camera_to_center_distance:c.cameraToCenterDistance,u_viewport_size:[c.width,c.height]}},Ou=function(l,h,c){return c===void 0&&(c=1),{u_matrix:l,u_color:h,u_overlay:0,u_overlay_scale:c}},pu=function(l){return{u_matrix:l}},yf=function(l,h,c,d){return{u_matrix:l,u_extrude_scale:ua(h,1,c),u_intensity:d}},Rl=function(l,h,c){var d=l.transform;return{u_matrix:zc(l,h,c),u_ratio:1/ua(h,1,d.zoom),u_device_pixel_ratio:g.browser.devicePixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},Bi=function(l,h,c,d){return g.extend(Rl(l,h,c),{u_image:0,u_image_height:d})},kl=function(l,h,c,d){var E=l.transform,w=cl(h,E);return{u_matrix:zc(l,h,c),u_texsize:h.imageAtlasTexture.size,u_ratio:1/ua(h,1,E.zoom),u_device_pixel_ratio:g.browser.devicePixelRatio,u_image:0,u_scale:[w,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]]}},Mh=function(l,h,c,d,E){var w=l.lineAtlas,P=cl(h,l.transform),L=c.layout.get("line-cap")==="round",U=w.getDash(d.from,L),H=w.getDash(d.to,L),oe=U.width*E.fromScale,ue=H.width*E.toScale;return g.extend(Rl(l,h,c),{u_patternscale_a:[P/oe,-U.height/2],u_patternscale_b:[P/ue,-H.height/2],u_sdfgamma:w.width/(256*Math.min(oe,ue)*g.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:U.y,u_tex_y_b:H.y,u_mix:E.t})};function cl(l,h){return 1/ua(l,1,h.tileZoom)}function zc(l,h,c){return l.translatePosMatrix(h.tileID.posMatrix,h,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}var Wf=function(l,h,c,d,E){return{u_matrix:l,u_tl_parent:h,u_scale_parent:c,u_buffer_scale:1,u_fade_t:d.mix,u_opacity:d.opacity*E.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:E.paint.get("raster-brightness-min"),u_brightness_high:E.paint.get("raster-brightness-max"),u_saturation_factor:(P=E.paint.get("raster-saturation"),P>0?1-1/(1.001-P):-P),u_contrast_factor:(w=E.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:Ph(E.paint.get("raster-hue-rotate"))};var w,P};function Ph(l){l*=Math.PI/180;var h=Math.sin(l),c=Math.cos(l);return[(2*c+1)/3,(-Math.sqrt(3)*h-c+1)/3,(Math.sqrt(3)*h-c+1)/3]}var Xf,Uc=function(l,h,c,d,E,w,P,L,U,H){var oe=E.transform;return{u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:h?h.uSizeT:0,u_size:h?h.uSize:0,u_camera_to_center_distance:oe.cameraToCenterDistance,u_pitch:oe.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:oe.width/oe.height,u_fade_change:E.options.fadeDuration?E.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:P,u_coord_matrix:L,u_is_text:+U,u_pitch_with_map:+d,u_texsize:H,u_texture:0}},oc=function(l,h,c,d,E,w,P,L,U,H,oe){var ue=E.transform;return g.extend(Uc(l,h,c,d,E,w,P,L,U,H),{u_gamma_scale:d?Math.cos(ue._pitch)*ue.cameraToCenterDistance:1,u_device_pixel_ratio:g.browser.devicePixelRatio,u_is_halo:+oe})},sc=function(l,h,c,d,E,w,P,L,U,H){return g.extend(oc(l,h,c,d,E,w,P,L,!0,U,!0),{u_texsize_icon:H,u_texture_icon:1})},Ll=function(l,h,c){return{u_matrix:l,u_opacity:h,u_color:c}},fl=function(l,h,c,d,E,w){return g.extend(function(P,L,U,H){var oe=U.imageManager.getPattern(P.from.toString()),ue=U.imageManager.getPattern(P.to.toString()),le=U.imageManager.getPixelSize(),Ie=le.width,Pe=le.height,Ne=Math.pow(2,H.tileID.overscaledZ),xe=H.tileSize*Math.pow(2,U.transform.tileZoom)/Ne,je=xe*(H.tileID.canonical.x+H.tileID.wrap*Ne),Ke=xe*H.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:oe.tl,u_pattern_br_a:oe.br,u_pattern_tl_b:ue.tl,u_pattern_br_b:ue.br,u_texsize:[Ie,Pe],u_mix:L.t,u_pattern_size_a:oe.displaySize,u_pattern_size_b:ue.displaySize,u_scale_a:L.fromScale,u_scale_b:L.toScale,u_tile_units_to_pixels:1/ua(H,1,U.transform.tileZoom),u_pixel_coord_upper:[je>>16,Ke>>16],u_pixel_coord_lower:[65535&je,65535&Ke]}}(d,w,c,E),{u_matrix:l,u_opacity:h})},Dl={fillExtrusion:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_lightpos:new g.Uniform3f(l,h.u_lightpos),u_lightintensity:new g.Uniform1f(l,h.u_lightintensity),u_lightcolor:new g.Uniform3f(l,h.u_lightcolor),u_vertical_gradient:new g.Uniform1f(l,h.u_vertical_gradient),u_opacity:new g.Uniform1f(l,h.u_opacity)}},fillExtrusionPattern:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_lightpos:new g.Uniform3f(l,h.u_lightpos),u_lightintensity:new g.Uniform1f(l,h.u_lightintensity),u_lightcolor:new g.Uniform3f(l,h.u_lightcolor),u_vertical_gradient:new g.Uniform1f(l,h.u_vertical_gradient),u_height_factor:new g.Uniform1f(l,h.u_height_factor),u_image:new g.Uniform1i(l,h.u_image),u_texsize:new g.Uniform2f(l,h.u_texsize),u_pixel_coord_upper:new g.Uniform2f(l,h.u_pixel_coord_upper),u_pixel_coord_lower:new g.Uniform2f(l,h.u_pixel_coord_lower),u_scale:new g.Uniform3f(l,h.u_scale),u_fade:new g.Uniform1f(l,h.u_fade),u_opacity:new g.Uniform1f(l,h.u_opacity)}},fill:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix)}},fillPattern:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_image:new g.Uniform1i(l,h.u_image),u_texsize:new g.Uniform2f(l,h.u_texsize),u_pixel_coord_upper:new g.Uniform2f(l,h.u_pixel_coord_upper),u_pixel_coord_lower:new g.Uniform2f(l,h.u_pixel_coord_lower),u_scale:new g.Uniform3f(l,h.u_scale),u_fade:new g.Uniform1f(l,h.u_fade)}},fillOutline:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_world:new g.Uniform2f(l,h.u_world)}},fillOutlinePattern:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_world:new g.Uniform2f(l,h.u_world),u_image:new g.Uniform1i(l,h.u_image),u_texsize:new g.Uniform2f(l,h.u_texsize),u_pixel_coord_upper:new g.Uniform2f(l,h.u_pixel_coord_upper),u_pixel_coord_lower:new g.Uniform2f(l,h.u_pixel_coord_lower),u_scale:new g.Uniform3f(l,h.u_scale),u_fade:new g.Uniform1f(l,h.u_fade)}},circle:function(l,h){return{u_camera_to_center_distance:new g.Uniform1f(l,h.u_camera_to_center_distance),u_scale_with_map:new g.Uniform1i(l,h.u_scale_with_map),u_pitch_with_map:new g.Uniform1i(l,h.u_pitch_with_map),u_extrude_scale:new g.Uniform2f(l,h.u_extrude_scale),u_device_pixel_ratio:new g.Uniform1f(l,h.u_device_pixel_ratio),u_matrix:new g.UniformMatrix4f(l,h.u_matrix)}},collisionBox:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_camera_to_center_distance:new g.Uniform1f(l,h.u_camera_to_center_distance),u_pixels_to_tile_units:new g.Uniform1f(l,h.u_pixels_to_tile_units),u_extrude_scale:new g.Uniform2f(l,h.u_extrude_scale),u_overscale_factor:new g.Uniform1f(l,h.u_overscale_factor)}},collisionCircle:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_inv_matrix:new g.UniformMatrix4f(l,h.u_inv_matrix),u_camera_to_center_distance:new g.Uniform1f(l,h.u_camera_to_center_distance),u_viewport_size:new g.Uniform2f(l,h.u_viewport_size)}},debug:function(l,h){return{u_color:new g.UniformColor(l,h.u_color),u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_overlay:new g.Uniform1i(l,h.u_overlay),u_overlay_scale:new g.Uniform1f(l,h.u_overlay_scale)}},clippingMask:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix)}},heatmap:function(l,h){return{u_extrude_scale:new g.Uniform1f(l,h.u_extrude_scale),u_intensity:new g.Uniform1f(l,h.u_intensity),u_matrix:new g.UniformMatrix4f(l,h.u_matrix)}},heatmapTexture:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_world:new g.Uniform2f(l,h.u_world),u_image:new g.Uniform1i(l,h.u_image),u_color_ramp:new g.Uniform1i(l,h.u_color_ramp),u_opacity:new g.Uniform1f(l,h.u_opacity)}},hillshade:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_image:new g.Uniform1i(l,h.u_image),u_latrange:new g.Uniform2f(l,h.u_latrange),u_light:new g.Uniform2f(l,h.u_light),u_shadow:new g.UniformColor(l,h.u_shadow),u_highlight:new g.UniformColor(l,h.u_highlight),u_accent:new g.UniformColor(l,h.u_accent)}},hillshadePrepare:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_image:new g.Uniform1i(l,h.u_image),u_dimension:new g.Uniform2f(l,h.u_dimension),u_zoom:new g.Uniform1f(l,h.u_zoom),u_unpack:new g.Uniform4f(l,h.u_unpack)}},line:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_ratio:new g.Uniform1f(l,h.u_ratio),u_device_pixel_ratio:new g.Uniform1f(l,h.u_device_pixel_ratio),u_units_to_pixels:new g.Uniform2f(l,h.u_units_to_pixels)}},lineGradient:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_ratio:new g.Uniform1f(l,h.u_ratio),u_device_pixel_ratio:new g.Uniform1f(l,h.u_device_pixel_ratio),u_units_to_pixels:new g.Uniform2f(l,h.u_units_to_pixels),u_image:new g.Uniform1i(l,h.u_image),u_image_height:new g.Uniform1f(l,h.u_image_height)}},linePattern:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_texsize:new g.Uniform2f(l,h.u_texsize),u_ratio:new g.Uniform1f(l,h.u_ratio),u_device_pixel_ratio:new g.Uniform1f(l,h.u_device_pixel_ratio),u_image:new g.Uniform1i(l,h.u_image),u_units_to_pixels:new g.Uniform2f(l,h.u_units_to_pixels),u_scale:new g.Uniform3f(l,h.u_scale),u_fade:new g.Uniform1f(l,h.u_fade)}},lineSDF:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_ratio:new g.Uniform1f(l,h.u_ratio),u_device_pixel_ratio:new g.Uniform1f(l,h.u_device_pixel_ratio),u_units_to_pixels:new g.Uniform2f(l,h.u_units_to_pixels),u_patternscale_a:new g.Uniform2f(l,h.u_patternscale_a),u_patternscale_b:new g.Uniform2f(l,h.u_patternscale_b),u_sdfgamma:new g.Uniform1f(l,h.u_sdfgamma),u_image:new g.Uniform1i(l,h.u_image),u_tex_y_a:new g.Uniform1f(l,h.u_tex_y_a),u_tex_y_b:new g.Uniform1f(l,h.u_tex_y_b),u_mix:new g.Uniform1f(l,h.u_mix)}},raster:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_tl_parent:new g.Uniform2f(l,h.u_tl_parent),u_scale_parent:new g.Uniform1f(l,h.u_scale_parent),u_buffer_scale:new g.Uniform1f(l,h.u_buffer_scale),u_fade_t:new g.Uniform1f(l,h.u_fade_t),u_opacity:new g.Uniform1f(l,h.u_opacity),u_image0:new g.Uniform1i(l,h.u_image0),u_image1:new g.Uniform1i(l,h.u_image1),u_brightness_low:new g.Uniform1f(l,h.u_brightness_low),u_brightness_high:new g.Uniform1f(l,h.u_brightness_high),u_saturation_factor:new g.Uniform1f(l,h.u_saturation_factor),u_contrast_factor:new g.Uniform1f(l,h.u_contrast_factor),u_spin_weights:new g.Uniform3f(l,h.u_spin_weights)}},symbolIcon:function(l,h){return{u_is_size_zoom_constant:new g.Uniform1i(l,h.u_is_size_zoom_constant),u_is_size_feature_constant:new g.Uniform1i(l,h.u_is_size_feature_constant),u_size_t:new g.Uniform1f(l,h.u_size_t),u_size:new g.Uniform1f(l,h.u_size),u_camera_to_center_distance:new g.Uniform1f(l,h.u_camera_to_center_distance),u_pitch:new g.Uniform1f(l,h.u_pitch),u_rotate_symbol:new g.Uniform1i(l,h.u_rotate_symbol),u_aspect_ratio:new g.Uniform1f(l,h.u_aspect_ratio),u_fade_change:new g.Uniform1f(l,h.u_fade_change),u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_label_plane_matrix:new g.UniformMatrix4f(l,h.u_label_plane_matrix),u_coord_matrix:new g.UniformMatrix4f(l,h.u_coord_matrix),u_is_text:new g.Uniform1i(l,h.u_is_text),u_pitch_with_map:new g.Uniform1i(l,h.u_pitch_with_map),u_texsize:new g.Uniform2f(l,h.u_texsize),u_texture:new g.Uniform1i(l,h.u_texture)}},symbolSDF:function(l,h){return{u_is_size_zoom_constant:new g.Uniform1i(l,h.u_is_size_zoom_constant),u_is_size_feature_constant:new g.Uniform1i(l,h.u_is_size_feature_constant),u_size_t:new g.Uniform1f(l,h.u_size_t),u_size:new g.Uniform1f(l,h.u_size),u_camera_to_center_distance:new g.Uniform1f(l,h.u_camera_to_center_distance),u_pitch:new g.Uniform1f(l,h.u_pitch),u_rotate_symbol:new g.Uniform1i(l,h.u_rotate_symbol),u_aspect_ratio:new g.Uniform1f(l,h.u_aspect_ratio),u_fade_change:new g.Uniform1f(l,h.u_fade_change),u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_label_plane_matrix:new g.UniformMatrix4f(l,h.u_label_plane_matrix),u_coord_matrix:new g.UniformMatrix4f(l,h.u_coord_matrix),u_is_text:new g.Uniform1i(l,h.u_is_text),u_pitch_with_map:new g.Uniform1i(l,h.u_pitch_with_map),u_texsize:new g.Uniform2f(l,h.u_texsize),u_texture:new g.Uniform1i(l,h.u_texture),u_gamma_scale:new g.Uniform1f(l,h.u_gamma_scale),u_device_pixel_ratio:new g.Uniform1f(l,h.u_device_pixel_ratio),u_is_halo:new g.Uniform1i(l,h.u_is_halo)}},symbolTextAndIcon:function(l,h){return{u_is_size_zoom_constant:new g.Uniform1i(l,h.u_is_size_zoom_constant),u_is_size_feature_constant:new g.Uniform1i(l,h.u_is_size_feature_constant),u_size_t:new g.Uniform1f(l,h.u_size_t),u_size:new g.Uniform1f(l,h.u_size),u_camera_to_center_distance:new g.Uniform1f(l,h.u_camera_to_center_distance),u_pitch:new g.Uniform1f(l,h.u_pitch),u_rotate_symbol:new g.Uniform1i(l,h.u_rotate_symbol),u_aspect_ratio:new g.Uniform1f(l,h.u_aspect_ratio),u_fade_change:new g.Uniform1f(l,h.u_fade_change),u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_label_plane_matrix:new g.UniformMatrix4f(l,h.u_label_plane_matrix),u_coord_matrix:new g.UniformMatrix4f(l,h.u_coord_matrix),u_is_text:new g.Uniform1i(l,h.u_is_text),u_pitch_with_map:new g.Uniform1i(l,h.u_pitch_with_map),u_texsize:new g.Uniform2f(l,h.u_texsize),u_texsize_icon:new g.Uniform2f(l,h.u_texsize_icon),u_texture:new g.Uniform1i(l,h.u_texture),u_texture_icon:new g.Uniform1i(l,h.u_texture_icon),u_gamma_scale:new g.Uniform1f(l,h.u_gamma_scale),u_device_pixel_ratio:new g.Uniform1f(l,h.u_device_pixel_ratio),u_is_halo:new g.Uniform1i(l,h.u_is_halo)}},background:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_opacity:new g.Uniform1f(l,h.u_opacity),u_color:new g.UniformColor(l,h.u_color)}},backgroundPattern:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_opacity:new g.Uniform1f(l,h.u_opacity),u_image:new g.Uniform1i(l,h.u_image),u_pattern_tl_a:new g.Uniform2f(l,h.u_pattern_tl_a),u_pattern_br_a:new g.Uniform2f(l,h.u_pattern_br_a),u_pattern_tl_b:new g.Uniform2f(l,h.u_pattern_tl_b),u_pattern_br_b:new g.Uniform2f(l,h.u_pattern_br_b),u_texsize:new g.Uniform2f(l,h.u_texsize),u_mix:new g.Uniform1f(l,h.u_mix),u_pattern_size_a:new g.Uniform2f(l,h.u_pattern_size_a),u_pattern_size_b:new g.Uniform2f(l,h.u_pattern_size_b),u_scale_a:new g.Uniform1f(l,h.u_scale_a),u_scale_b:new g.Uniform1f(l,h.u_scale_b),u_pixel_coord_upper:new g.Uniform2f(l,h.u_pixel_coord_upper),u_pixel_coord_lower:new g.Uniform2f(l,h.u_pixel_coord_lower),u_tile_units_to_pixels:new g.Uniform1f(l,h.u_tile_units_to_pixels)}}};function Ku(l,h,c,d,E,w,P){for(var L=l.context,U=L.gl,H=l.useProgram("collisionBox"),oe=[],ue=0,le=0,Ie=0;Ie<d.length;Ie++){var Pe=d[Ie],Ne=h.getTile(Pe),xe=Ne.getBucket(c);if(xe){var je=Pe.posMatrix;E[0]===0&&E[1]===0||(je=l.translatePosMatrix(Pe.posMatrix,Ne,E,w));var Ke=P?xe.textCollisionBox:xe.iconCollisionBox,vt=xe.collisionCircleArray;if(vt.length>0){var Wt=g.create(),jt=je;g.mul(Wt,xe.placementInvProjMatrix,l.transform.glCoordMatrix),g.mul(Wt,Wt,xe.placementViewportMatrix),oe.push({circleArray:vt,circleOffset:le,transform:jt,invTransform:Wt}),le=ue+=vt.length/4}Ke&&H.draw(L,U.LINES,pe.disabled,Me.disabled,l.colorModeForRenderPass(),Qe.disabled,$o(je,l.transform,Ne),c.id,Ke.layoutVertexBuffer,Ke.indexBuffer,Ke.segments,null,l.transform.zoom,null,null,Ke.collisionVertexBuffer)}}if(P&&oe.length){var qt=l.useProgram("collisionCircle"),pr=new g.StructArrayLayout2f1f2i16;pr.resize(4*ue),pr._trim();for(var kr=0,_r=0,sn=oe;_r<sn.length;_r+=1)for(var Zn=sn[_r],jn=0;jn<Zn.circleArray.length/4;jn++){var kn=4*jn,ki=Zn.circleArray[kn+0],tn=Zn.circleArray[kn+1],ii=Zn.circleArray[kn+2],li=Zn.circleArray[kn+3];pr.emplace(kr++,ki,tn,ii,li,0),pr.emplace(kr++,ki,tn,ii,li,1),pr.emplace(kr++,ki,tn,ii,li,2),pr.emplace(kr++,ki,tn,ii,li,3)}(!Xf||Xf.length<2*ue)&&(Xf=function(Ja){var To=2*Ja,ra=new g.StructArrayLayout3ui6;ra.resize(To),ra._trim();for(var Ha=0;Ha<To;Ha++){var ho=6*Ha;ra.uint16[ho+0]=4*Ha+0,ra.uint16[ho+1]=4*Ha+1,ra.uint16[ho+2]=4*Ha+2,ra.uint16[ho+3]=4*Ha+2,ra.uint16[ho+4]=4*Ha+3,ra.uint16[ho+5]=4*Ha+0}return ra}(ue));for(var $n=L.createIndexBuffer(Xf,!0),Hn=L.createVertexBuffer(pr,g.collisionCircleLayout.members,!0),di=0,Kn=oe;di<Kn.length;di+=1){var Xn=Kn[di],yo=Nc(Xn.transform,Xn.invTransform,l.transform);qt.draw(L,U.TRIANGLES,pe.disabled,Me.disabled,l.colorModeForRenderPass(),Qe.disabled,yo,c.id,Hn,$n,g.SegmentVector.simpleSegment(0,2*Xn.circleOffset,Xn.circleArray.length,Xn.circleArray.length/2),null,l.transform.zoom,null,null,null)}Hn.destroy(),$n.destroy()}}var $s=g.identity(new Float32Array(16));function _f(l,h,c,d,E,w){var P=g.getAnchorAlignment(l),L=-(P.horizontalAlign-.5)*h,U=-(P.verticalAlign-.5)*c,H=g.evaluateVariableOffset(l,d);return new g.Point((L/E+H[0])*w,(U/E+H[1])*w)}function xf(l,h,c,d,E,w,P,L,U,H,oe){var ue=l.text.placedSymbolArray,le=l.text.dynamicLayoutVertexArray,Ie=l.icon.dynamicLayoutVertexArray,Pe={};le.clear();for(var Ne=0;Ne<ue.length;Ne++){var xe=ue.get(Ne),je=xe.hidden||!xe.crossTileID||l.allowVerticalPlacement&&!xe.placedOrientation?null:d[xe.crossTileID];if(je){var Ke=new g.Point(xe.anchorX,xe.anchorY),vt=Ti(Ke,c?L:P),Wt=Zi(w.cameraToCenterDistance,vt.signedDistanceFromCamera),jt=E.evaluateSizeForFeature(l.textSizeData,H,xe)*Wt/g.ONE_EM;c&&(jt*=l.tilePixelRatio/U);for(var qt=_f(je.anchor,je.width,je.height,je.textOffset,je.textBoxScale,jt),pr=c?Ti(Ke.add(qt),P).point:vt.point.add(h?qt.rotate(-w.angle):qt),kr=l.allowVerticalPlacement&&xe.placedOrientation===g.WritingMode.vertical?Math.PI/2:0,_r=0;_r<xe.numGlyphs;_r++)g.addDynamicAttributes(le,pr,kr);oe&&xe.associatedIconIndex>=0&&(Pe[xe.associatedIconIndex]={shiftedAnchor:pr,angle:kr})}else za(xe.numGlyphs,le)}if(oe){Ie.clear();for(var sn=l.icon.placedSymbolArray,Zn=0;Zn<sn.length;Zn++){var jn=sn.get(Zn);if(jn.hidden)za(jn.numGlyphs,Ie);else{var kn=Pe[Zn];if(kn)for(var ki=0;ki<jn.numGlyphs;ki++)g.addDynamicAttributes(Ie,kn.shiftedAnchor,kn.angle);else za(jn.numGlyphs,Ie)}}l.icon.dynamicLayoutVertexBuffer.updateData(Ie)}l.text.dynamicLayoutVertexBuffer.updateData(le)}function Yf(l,h,c){return c.iconsInText&&h?"symbolTextAndIcon":l?"symbolSDF":"symbolIcon"}function du(l,h,c,d,E,w,P,L,U,H,oe,ue){for(var le=l.context,Ie=le.gl,Pe=l.transform,Ne=L==="map",xe=U==="map",je=Ne&&c.layout.get("symbol-placement")!=="point",Ke=Ne&&!xe&&!je,vt=c.layout.get("symbol-sort-key").constantOr(1)!==void 0,Wt=!1,jt=l.depthModeForSublayer(0,pe.ReadOnly),qt=c.layout.get("text-variable-anchor"),pr=[],kr=0,_r=d;kr<_r.length;kr+=1){var sn=_r[kr],Zn=h.getTile(sn),jn=Zn.getBucket(c);if(jn){var kn=E?jn.text:jn.icon;if(kn&&kn.segments.get().length){var ki=kn.programConfigurations.get(c.id),tn=E||jn.sdfIcons,ii=E?jn.textSizeData:jn.iconSizeData,li=xe||Pe.pitch!==0,$n=l.useProgram(Yf(tn,E,jn),ki),Hn=g.evaluateSizeForZoom(ii,Pe.zoom),di=void 0,Kn=[0,0],Xn=void 0,yo=void 0,Ja=null,To=void 0;if(E)Xn=Zn.glyphAtlasTexture,yo=Ie.LINEAR,di=Zn.glyphAtlasTexture.size,jn.iconsInText&&(Kn=Zn.imageAtlasTexture.size,Ja=Zn.imageAtlasTexture,To=li||l.options.rotating||l.options.zooming||ii.kind==="composite"||ii.kind==="camera"?Ie.LINEAR:Ie.NEAREST);else{var ra=c.layout.get("icon-size").constantOr(0)!==1||jn.iconsNeedLinear;Xn=Zn.imageAtlasTexture,yo=tn||l.options.rotating||l.options.zooming||ra||li?Ie.LINEAR:Ie.NEAREST,di=Zn.imageAtlasTexture.size}var Ha=ua(Zn,1,l.transform.zoom),ho=Ta(sn.posMatrix,xe,Ne,l.transform,Ha),Rs=Ei(sn.posMatrix,xe,Ne,l.transform,Ha),ss=qt&&jn.hasTextData(),Bu=c.layout.get("icon-text-fit")!=="none"&&ss&&jn.hasIconData();je&&on(jn,sn.posMatrix,l,E,ho,Rs,xe,H);var us=l.translatePosMatrix(sn.posMatrix,Zn,w,P),nu=je||E&&qt||Bu?$s:ho,Jo=l.translatePosMatrix(Rs,Zn,w,P,!0),ls=tn&&c.paint.get(E?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Wl={program:$n,buffers:kn,uniformValues:tn?jn.iconsInText?sc(ii.kind,Hn,Ke,xe,l,us,nu,Jo,di,Kn):oc(ii.kind,Hn,Ke,xe,l,us,nu,Jo,E,di,!0):Uc(ii.kind,Hn,Ke,xe,l,us,nu,Jo,E,di),atlasTexture:Xn,atlasTextureIcon:Ja,atlasInterpolation:yo,atlasInterpolationIcon:To,isSDF:tn,hasHalo:ls};if(vt&&jn.canOverlap){Wt=!0;for(var Nu=0,_l=kn.segments.get();Nu<_l.length;Nu+=1){var Xl=_l[Nu];pr.push({segments:new g.SegmentVector([Xl]),sortKey:Xl.sortKey,state:Wl})}}else pr.push({segments:kn.segments,sortKey:0,state:Wl})}}}Wt&&pr.sort(function(Uu,tl){return Uu.sortKey-tl.sortKey});for(var iu=0,xl=pr;iu<xl.length;iu+=1){var Su=xl[iu],Eo=Su.state;if(le.activeTexture.set(Ie.TEXTURE0),Eo.atlasTexture.bind(Eo.atlasInterpolation,Ie.CLAMP_TO_EDGE),Eo.atlasTextureIcon&&(le.activeTexture.set(Ie.TEXTURE1),Eo.atlasTextureIcon&&Eo.atlasTextureIcon.bind(Eo.atlasInterpolationIcon,Ie.CLAMP_TO_EDGE)),Eo.isSDF){var zu=Eo.uniformValues;Eo.hasHalo&&(zu.u_is_halo=1,uc(Eo.buffers,Su.segments,c,l,Eo.program,jt,oe,ue,zu)),zu.u_is_halo=0}uc(Eo.buffers,Su.segments,c,l,Eo.program,jt,oe,ue,Eo.uniformValues)}}function uc(l,h,c,d,E,w,P,L,U){var H=d.context;E.draw(H,H.gl.TRIANGLES,w,P,L,Qe.disabled,U,c.id,l.layoutVertexBuffer,l.indexBuffer,h,c.paint,d.transform.zoom,l.programConfigurations.get(c.id),l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer)}function Zc(l,h,c,d,E,w,P){var L,U,H,oe,ue,le=l.context.gl,Ie=c.paint.get("fill-pattern"),Pe=Ie&&Ie.constantOr(1),Ne=c.getCrossfadeParameters();P?(U=Pe&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=le.LINES):(U=Pe?"fillPattern":"fill",L=le.TRIANGLES);for(var xe=0,je=d;xe<je.length;xe+=1){var Ke=je[xe],vt=h.getTile(Ke);if(!Pe||vt.patternsLoaded()){var Wt=vt.getBucket(c);if(Wt){var jt=Wt.programConfigurations.get(c.id),qt=l.useProgram(U,jt);Pe&&(l.context.activeTexture.set(le.TEXTURE0),vt.imageAtlasTexture.bind(le.LINEAR,le.CLAMP_TO_EDGE),jt.updatePaintBuffers(Ne));var pr=Ie.constantOr(null);if(pr&&vt.imageAtlas){var kr=vt.imageAtlas,_r=kr.patternPositions[pr.to.toString()],sn=kr.patternPositions[pr.from.toString()];_r&&sn&&jt.setConstantPatternPositions(_r,sn)}var Zn=l.translatePosMatrix(Ke.posMatrix,vt,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(P){oe=Wt.indexBuffer2,ue=Wt.segments2;var jn=[le.drawingBufferWidth,le.drawingBufferHeight];H=U==="fillOutlinePattern"&&Pe?Gf(Zn,l,Ne,vt,jn):co(Zn,jn)}else oe=Wt.indexBuffer,ue=Wt.segments,H=Pe?Pu(Zn,l,Ne,vt):Mu(Zn);qt.draw(l.context,L,E,l.stencilModeForClipping(Ke),w,Qe.disabled,H,c.id,Wt.layoutVertexBuffer,oe,ue,c.paint,l.transform.zoom,jt)}}}}function bf(l,h,c,d,E,w,P){for(var L=l.context,U=L.gl,H=c.paint.get("fill-extrusion-pattern"),oe=H.constantOr(1),ue=c.getCrossfadeParameters(),le=c.paint.get("fill-extrusion-opacity"),Ie=0,Pe=d;Ie<Pe.length;Ie+=1){var Ne=Pe[Ie],xe=h.getTile(Ne),je=xe.getBucket(c);if(je){var Ke=je.programConfigurations.get(c.id),vt=l.useProgram(oe?"fillExtrusionPattern":"fillExtrusion",Ke);oe&&(l.context.activeTexture.set(U.TEXTURE0),xe.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),Ke.updatePaintBuffers(ue));var Wt=H.constantOr(null);if(Wt&&xe.imageAtlas){var jt=xe.imageAtlas,qt=jt.patternPositions[Wt.to.toString()],pr=jt.patternPositions[Wt.from.toString()];qt&&pr&&Ke.setConstantPatternPositions(qt,pr)}var kr=l.translatePosMatrix(Ne.posMatrix,xe,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),_r=c.paint.get("fill-extrusion-vertical-gradient"),sn=oe?Tu(kr,l,_r,le,Ne,ue,xe):Bc(kr,l,_r,le);vt.draw(L,L.gl.TRIANGLES,E,w,P,Qe.backCCW,sn,c.id,je.layoutVertexBuffer,je.indexBuffer,je.segments,c.paint,l.transform.zoom,Ke)}}}function Fl(l,h,c,d,E,w){var P=l.context,L=P.gl,U=h.fbo;if(U){var H=l.useProgram("hillshade");P.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,U.colorAttachment.get());var oe=function(ue,le,Ie){var Pe=Ie.paint.get("hillshade-shadow-color"),Ne=Ie.paint.get("hillshade-highlight-color"),xe=Ie.paint.get("hillshade-accent-color"),je=Ie.paint.get("hillshade-illumination-direction")*(Math.PI/180);Ie.paint.get("hillshade-illumination-anchor")==="viewport"&&(je-=ue.transform.angle);var Ke,vt,Wt,jt=!ue.options.moving;return{u_matrix:ue.transform.calculatePosMatrix(le.tileID.toUnwrapped(),jt),u_image:0,u_latrange:(Ke=le.tileID,vt=Math.pow(2,Ke.canonical.z),Wt=Ke.canonical.y,[new g.MercatorCoordinate(0,Wt/vt).toLngLat().lat,new g.MercatorCoordinate(0,(Wt+1)/vt).toLngLat().lat]),u_light:[Ie.paint.get("hillshade-exaggeration"),je],u_shadow:Pe,u_highlight:Ne,u_accent:xe}}(l,h,c);H.draw(P,L.TRIANGLES,d,E,w,Qe.disabled,oe,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}}function hp(l,h,c,d,E,w){var P=l.context,L=P.gl,U=h.dem;if(U&&U.data){var H=U.dim,oe=U.stride,ue=U.getPixels();if(P.activeTexture.set(L.TEXTURE1),P.pixelStoreUnpackPremultiplyAlpha.set(!1),h.demTexture=h.demTexture||l.getTileTexture(oe),h.demTexture){var le=h.demTexture;le.update(ue,{premultiply:!1}),le.bind(L.NEAREST,L.CLAMP_TO_EDGE)}else h.demTexture=new g.Texture(P,ue,L.RGBA,{premultiply:!1}),h.demTexture.bind(L.NEAREST,L.CLAMP_TO_EDGE);P.activeTexture.set(L.TEXTURE0);var Ie=h.fbo;if(!Ie){var Pe=new g.Texture(P,{width:H,height:H,data:null},L.RGBA);Pe.bind(L.LINEAR,L.CLAMP_TO_EDGE),(Ie=h.fbo=P.createFramebuffer(H,H,!0)).colorAttachment.set(Pe.texture)}P.bindFramebuffer.set(Ie.framebuffer),P.viewport.set([0,0,H,H]),l.useProgram("hillshadePrepare").draw(P,L.TRIANGLES,d,E,w,Qe.disabled,function(Ne,xe){var je=xe.stride,Ke=g.create();return g.ortho(Ke,0,g.EXTENT,-g.EXTENT,0,0,1),g.translate(Ke,Ke,[0,-g.EXTENT,0]),{u_matrix:Ke,u_image:1,u_dimension:[je,je],u_zoom:Ne.overscaledZ,u_unpack:xe.getUnpackVector()}}(h.tileID,U),c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments),h.needsHillshadePrepare=!1}}function Ef(l,h,c,d,E){var w=d.paint.get("raster-fade-duration");if(w>0){var P=g.browser.now(),L=(P-l.timeAdded)/w,U=h?(P-h.timeAdded)/w:-1,H=c.getSource(),oe=E.coveringZoomLevel({tileSize:H.tileSize,roundZoom:H.roundZoom}),ue=!h||Math.abs(h.tileID.overscaledZ-oe)>Math.abs(l.tileID.overscaledZ-oe),le=ue&&l.refreshedUponExpiration?1:g.clamp(ue?L:1-U,0,1);return l.refreshedUponExpiration&&L>=1&&(l.refreshedUponExpiration=!1),h?{opacity:1,mix:1-le}:{opacity:le,mix:0}}return{opacity:1,mix:0}}var Bl=new g.Color(1,0,0,1),Sf=new g.Color(0,1,0,1),Cf=new g.Color(0,0,1,1),Nl=new g.Color(1,0,1,1),jc=new g.Color(0,1,1,1);function Oh(l,h,c,d){lc(l,0,h+c/2,l.transform.width,c,d)}function Ih(l,h,c,d){lc(l,h-c/2,0,c,l.transform.height,d)}function lc(l,h,c,d,E,w){var P=l.context,L=P.gl;L.enable(L.SCISSOR_TEST),L.scissor(h*g.browser.devicePixelRatio,c*g.browser.devicePixelRatio,d*g.browser.devicePixelRatio,E*g.browser.devicePixelRatio),P.clear({color:w}),L.disable(L.SCISSOR_TEST)}function Rh(l,h,c){var d=l.context,E=d.gl,w=c.posMatrix,P=l.useProgram("debug"),L=pe.disabled,U=Me.disabled,H=l.colorModeForRenderPass();d.activeTexture.set(E.TEXTURE0),l.emptyTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),P.draw(d,E.LINE_STRIP,L,U,H,Qe.disabled,Ou(w,g.Color.red),"$debug",l.debugBuffer,l.tileBorderIndexBuffer,l.debugSegments);var oe=h.getTileByID(c.key).latestRawTileData,ue=Math.floor((oe&&oe.byteLength||0)/1024),le=h.getTile(c).tileSize,Ie=512/Math.min(le,512)*(c.overscaledZ/l.transform.zoom)*.5,Pe=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(Pe+=" => "+c.overscaledZ),function(Ne,xe){Ne.initDebugOverlayCanvas();var je=Ne.debugOverlayCanvas,Ke=Ne.context.gl,vt=Ne.debugOverlayCanvas.getContext("2d");vt.clearRect(0,0,je.width,je.height),vt.shadowColor="white",vt.shadowBlur=2,vt.lineWidth=1.5,vt.strokeStyle="white",vt.textBaseline="top",vt.font="bold 36px Open Sans, sans-serif",vt.fillText(xe,5,5),vt.strokeText(xe,5,5),Ne.debugOverlayTexture.update(je),Ne.debugOverlayTexture.bind(Ke.LINEAR,Ke.CLAMP_TO_EDGE)}(l,Pe+" "+ue+"kb"),P.draw(d,E.TRIANGLES,L,U,Ge.alphaBlended,Qe.disabled,Ou(w,g.Color.transparent,Ie),"$debug",l.debugBuffer,l.quadTriangleIndexBuffer,l.debugSegments)}var zl={symbol:function(l,h,c,d,E){if(l.renderPass==="translucent"){var w=Me.disabled,P=l.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(L,U,H,oe,ue,le,Ie){for(var Pe=U.transform,Ne=ue==="map",xe=le==="map",je=0,Ke=L;je<Ke.length;je+=1){var vt=Ke[je],Wt=oe.getTile(vt),jt=Wt.getBucket(H);if(jt&&jt.text&&jt.text.segments.get().length){var qt=g.evaluateSizeForZoom(jt.textSizeData,Pe.zoom),pr=ua(Wt,1,U.transform.zoom),kr=Ta(vt.posMatrix,xe,Ne,U.transform,pr),_r=H.layout.get("icon-text-fit")!=="none"&&jt.hasIconData();if(qt){var sn=Math.pow(2,Pe.zoom-Wt.tileID.overscaledZ);xf(jt,Ne,xe,Ie,g.symbolSize,Pe,kr,vt.posMatrix,sn,qt,_r)}}}}(d,l,c,h,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),E),c.paint.get("icon-opacity").constantOr(1)!==0&&du(l,h,c,d,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),w,P),c.paint.get("text-opacity").constantOr(1)!==0&&du(l,h,c,d,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),w,P),h.map.showCollisionBoxes&&(Ku(l,h,c,d,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),Ku(l,h,c,d,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))}},circle:function(l,h,c,d){if(l.renderPass==="translucent"){var E=c.paint.get("circle-opacity"),w=c.paint.get("circle-stroke-width"),P=c.paint.get("circle-stroke-opacity"),L=c.layout.get("circle-sort-key").constantOr(1)!==void 0;if(E.constantOr(1)!==0||w.constantOr(1)!==0&&P.constantOr(1)!==0){for(var U=l.context,H=U.gl,oe=l.depthModeForSublayer(0,pe.ReadOnly),ue=Me.disabled,le=l.colorModeForRenderPass(),Ie=[],Pe=0;Pe<d.length;Pe++){var Ne=d[Pe],xe=h.getTile(Ne),je=xe.getBucket(c);if(je){var Ke=je.programConfigurations.get(c.id),vt={programConfiguration:Ke,program:l.useProgram("circle",Ke),layoutVertexBuffer:je.layoutVertexBuffer,indexBuffer:je.indexBuffer,uniformValues:Hf(l,Ne,xe,c)};if(L)for(var Wt=0,jt=je.segments.get();Wt<jt.length;Wt+=1){var qt=jt[Wt];Ie.push({segments:new g.SegmentVector([qt]),sortKey:qt.sortKey,state:vt})}else Ie.push({segments:je.segments,sortKey:0,state:vt})}}L&&Ie.sort(function(Zn,jn){return Zn.sortKey-jn.sortKey});for(var pr=0,kr=Ie;pr<kr.length;pr+=1){var _r=kr[pr],sn=_r.state;sn.program.draw(U,H.TRIANGLES,oe,ue,le,Qe.disabled,sn.uniformValues,c.id,sn.layoutVertexBuffer,sn.indexBuffer,_r.segments,c.paint,l.transform.zoom,sn.programConfiguration)}}}},heatmap:function(l,h,c,d){if(c.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){var E=l.context,w=E.gl,P=Me.disabled,L=new Ge([w.ONE,w.ONE],g.Color.transparent,[!0,!0,!0,!0]);(function(Ie,Pe,Ne){var xe=Ie.gl;Ie.activeTexture.set(xe.TEXTURE1),Ie.viewport.set([0,0,Pe.width/4,Pe.height/4]);var je=Ne.heatmapFbo;if(je)xe.bindTexture(xe.TEXTURE_2D,je.colorAttachment.get()),Ie.bindFramebuffer.set(je.framebuffer);else{var Ke=xe.createTexture();xe.bindTexture(xe.TEXTURE_2D,Ke),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_WRAP_S,xe.CLAMP_TO_EDGE),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_WRAP_T,xe.CLAMP_TO_EDGE),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_MIN_FILTER,xe.LINEAR),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_MAG_FILTER,xe.LINEAR),je=Ne.heatmapFbo=Ie.createFramebuffer(Pe.width/4,Pe.height/4,!1),function(vt,Wt,jt,qt){var pr=vt.gl;pr.texImage2D(pr.TEXTURE_2D,0,pr.RGBA,Wt.width/4,Wt.height/4,0,pr.RGBA,vt.extRenderToTextureHalfFloat?vt.extTextureHalfFloat.HALF_FLOAT_OES:pr.UNSIGNED_BYTE,null),qt.colorAttachment.set(jt)}(Ie,Pe,Ke,je)}})(E,l,c),E.clear({color:g.Color.transparent});for(var U=0;U<d.length;U++){var H=d[U];if(!h.hasRenderableParent(H)){var oe=h.getTile(H),ue=oe.getBucket(c);if(ue){var le=ue.programConfigurations.get(c.id);l.useProgram("heatmap",le).draw(E,w.TRIANGLES,pe.disabled,P,L,Qe.disabled,yf(H.posMatrix,oe,l.transform.zoom,c.paint.get("heatmap-intensity")),c.id,ue.layoutVertexBuffer,ue.indexBuffer,ue.segments,c.paint,l.transform.zoom,le)}}}E.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(Ie,Pe){var Ne=Ie.context,xe=Ne.gl,je=Pe.heatmapFbo;if(je){Ne.activeTexture.set(xe.TEXTURE0),xe.bindTexture(xe.TEXTURE_2D,je.colorAttachment.get()),Ne.activeTexture.set(xe.TEXTURE1);var Ke=Pe.colorRampTexture;Ke||(Ke=Pe.colorRampTexture=new g.Texture(Ne,Pe.colorRamp,xe.RGBA)),Ke.bind(xe.LINEAR,xe.CLAMP_TO_EDGE),Ie.useProgram("heatmapTexture").draw(Ne,xe.TRIANGLES,pe.disabled,Me.disabled,Ie.colorModeForRenderPass(),Qe.disabled,function(vt,Wt,jt,qt){var pr=g.create();g.ortho(pr,0,vt.width,vt.height,0,0,1);var kr=vt.context.gl;return{u_matrix:pr,u_world:[kr.drawingBufferWidth,kr.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Wt.paint.get("heatmap-opacity")}}(Ie,Pe),Pe.id,Ie.viewportBuffer,Ie.quadTriangleIndexBuffer,Ie.viewportSegments,Pe.paint,Ie.transform.zoom)}}(l,c))},line:function(l,h,c,d){if(l.renderPass==="translucent"){var E=c.paint.get("line-opacity"),w=c.paint.get("line-width");if(E.constantOr(1)!==0&&w.constantOr(1)!==0)for(var P=l.depthModeForSublayer(0,pe.ReadOnly),L=l.colorModeForRenderPass(),U=c.paint.get("line-dasharray"),H=c.paint.get("line-pattern"),oe=H.constantOr(1),ue=c.paint.get("line-gradient"),le=c.getCrossfadeParameters(),Ie=oe?"linePattern":U?"lineSDF":ue?"lineGradient":"line",Pe=l.context,Ne=Pe.gl,xe=!0,je=0,Ke=d;je<Ke.length;je+=1){var vt=Ke[je],Wt=h.getTile(vt);if(!oe||Wt.patternsLoaded()){var jt=Wt.getBucket(c);if(jt){var qt=jt.programConfigurations.get(c.id),pr=l.context.program.get(),kr=l.useProgram(Ie,qt),_r=xe||kr.program!==pr,sn=H.constantOr(null);if(sn&&Wt.imageAtlas){var Zn=Wt.imageAtlas,jn=Zn.patternPositions[sn.to.toString()],kn=Zn.patternPositions[sn.from.toString()];jn&&kn&&qt.setConstantPatternPositions(jn,kn)}var ki=oe?kl(l,Wt,c,le):U?Mh(l,Wt,c,U,le):ue?Bi(l,Wt,c,jt.lineClipsArray.length):Rl(l,Wt,c);if(oe)Pe.activeTexture.set(Ne.TEXTURE0),Wt.imageAtlasTexture.bind(Ne.LINEAR,Ne.CLAMP_TO_EDGE),qt.updatePaintBuffers(le);else if(U&&(_r||l.lineAtlas.dirty))Pe.activeTexture.set(Ne.TEXTURE0),l.lineAtlas.bind(Pe);else if(ue){var tn=jt.gradients[c.id],ii=tn.texture;if(c.gradientVersion!==tn.version){var li=256;if(c.stepInterpolant){var $n=h.getSource().maxzoom,Hn=vt.canonical.z===$n?Math.ceil(1<<l.transform.maxZoom-vt.canonical.z):1;li=g.clamp(g.nextPowerOfTwo(jt.maxLineLength/g.EXTENT*1024*Hn),256,Pe.maxTextureSize)}tn.gradient=g.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:li,image:tn.gradient||void 0,clips:jt.lineClipsArray}),tn.texture?tn.texture.update(tn.gradient):tn.texture=new g.Texture(Pe,tn.gradient,Ne.RGBA),tn.version=c.gradientVersion,ii=tn.texture}Pe.activeTexture.set(Ne.TEXTURE0),ii.bind(c.stepInterpolant?Ne.NEAREST:Ne.LINEAR,Ne.CLAMP_TO_EDGE)}kr.draw(Pe,Ne.TRIANGLES,P,l.stencilModeForClipping(vt),L,Qe.disabled,ki,c.id,jt.layoutVertexBuffer,jt.indexBuffer,jt.segments,c.paint,l.transform.zoom,qt,jt.layoutVertexBuffer2),xe=!1}}}}},fill:function(l,h,c,d){var E=c.paint.get("fill-color"),w=c.paint.get("fill-opacity");if(w.constantOr(1)!==0){var P=l.colorModeForRenderPass(),L=c.paint.get("fill-pattern"),U=l.opaquePassEnabledForLayer()&&!L.constantOr(1)&&E.constantOr(g.Color.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";if(l.renderPass===U){var H=l.depthModeForSublayer(1,l.renderPass==="opaque"?pe.ReadWrite:pe.ReadOnly);Zc(l,h,c,d,H,P,!1)}if(l.renderPass==="translucent"&&c.paint.get("fill-antialias")){var oe=l.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,pe.ReadOnly);Zc(l,h,c,d,oe,P,!0)}}},"fill-extrusion":function(l,h,c,d){var E=c.paint.get("fill-extrusion-opacity");if(E!==0&&l.renderPass==="translucent"){var w=new pe(l.context.gl.LEQUAL,pe.ReadWrite,l.depthRangeFor3D);if(E!==1||c.paint.get("fill-extrusion-pattern").constantOr(1))bf(l,h,c,d,w,Me.disabled,Ge.disabled),bf(l,h,c,d,w,l.stencilModeFor3D(),l.colorModeForRenderPass());else{var P=l.colorModeForRenderPass();bf(l,h,c,d,w,Me.disabled,P)}}},hillshade:function(l,h,c,d){if(l.renderPass==="offscreen"||l.renderPass==="translucent"){for(var E=l.context,w=l.depthModeForSublayer(0,pe.ReadOnly),P=l.colorModeForRenderPass(),L=l.renderPass==="translucent"?l.stencilConfigForOverlap(d):[{},d],U=L[0],H=0,oe=L[1];H<oe.length;H+=1){var ue=oe[H],le=h.getTile(ue);le.needsHillshadePrepare&&l.renderPass==="offscreen"?hp(l,le,c,w,Me.disabled,P):l.renderPass==="translucent"&&Fl(l,le,c,w,U[ue.overscaledZ],P)}E.viewport.set([0,0,l.width,l.height])}},raster:function(l,h,c,d){if(l.renderPass==="translucent"&&c.paint.get("raster-opacity")!==0&&d.length)for(var E=l.context,w=E.gl,P=h.getSource(),L=l.useProgram("raster"),U=l.colorModeForRenderPass(),H=P instanceof ft?[{},d]:l.stencilConfigForOverlap(d),oe=H[0],ue=H[1],le=ue[ue.length-1].overscaledZ,Ie=!l.options.moving,Pe=0,Ne=ue;Pe<Ne.length;Pe+=1){var xe=Ne[Pe],je=l.depthModeForSublayer(xe.overscaledZ-le,c.paint.get("raster-opacity")===1?pe.ReadWrite:pe.ReadOnly,w.LESS),Ke=h.getTile(xe),vt=l.transform.calculatePosMatrix(xe.toUnwrapped(),Ie);Ke.registerFadeDuration(c.paint.get("raster-fade-duration"));var Wt=h.findLoadedParent(xe,0),jt=Ef(Ke,Wt,h,c,l.transform),qt=void 0,pr=void 0,kr=c.paint.get("raster-resampling")==="nearest"?w.NEAREST:w.LINEAR;E.activeTexture.set(w.TEXTURE0),Ke.texture.bind(kr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),E.activeTexture.set(w.TEXTURE1),Wt?(Wt.texture.bind(kr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),qt=Math.pow(2,Wt.tileID.overscaledZ-Ke.tileID.overscaledZ),pr=[Ke.tileID.canonical.x*qt%1,Ke.tileID.canonical.y*qt%1]):Ke.texture.bind(kr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST);var _r=Wf(vt,pr||[0,0],qt||1,jt,c);P instanceof ft?L.draw(E,w.TRIANGLES,je,Me.disabled,U,Qe.disabled,_r,c.id,P.boundsBuffer,l.quadTriangleIndexBuffer,P.boundsSegments):L.draw(E,w.TRIANGLES,je,oe[xe.overscaledZ],U,Qe.disabled,_r,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}},background:function(l,h,c){var d=c.paint.get("background-color"),E=c.paint.get("background-opacity");if(E!==0){var w=l.context,P=w.gl,L=l.transform,U=L.tileSize,H=c.paint.get("background-pattern");if(!l.isPatternMissing(H)){var oe=!H&&d.a===1&&E===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass===oe){var ue=Me.disabled,le=l.depthModeForSublayer(0,oe==="opaque"?pe.ReadWrite:pe.ReadOnly),Ie=l.colorModeForRenderPass(),Pe=l.useProgram(H?"backgroundPattern":"background"),Ne=L.coveringTiles({tileSize:U});H&&(w.activeTexture.set(P.TEXTURE0),l.imageManager.bind(l.context));for(var xe=c.getCrossfadeParameters(),je=0,Ke=Ne;je<Ke.length;je+=1){var vt=Ke[je],Wt=l.transform.calculatePosMatrix(vt.toUnwrapped()),jt=H?fl(Wt,E,l,H,{tileID:vt,tileSize:U},xe):Ll(Wt,E,d);Pe.draw(w,P.TRIANGLES,le,ue,Ie,Qe.disabled,jt,c.id,l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments)}}}}},debug:function(l,h,c){for(var d=0;d<c.length;d++)Rh(l,h,c[d])},custom:function(l,h,c){var d=l.context,E=c.implementation;if(l.renderPass==="offscreen"){var w=E.prerender;w&&(l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),w.call(E,d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState())}else if(l.renderPass==="translucent"){l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),d.setStencilMode(Me.disabled);var P=E.renderingMode==="3d"?new pe(l.context.gl.LEQUAL,pe.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,pe.ReadOnly);d.setDepthMode(P),E.render(d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState(),d.bindFramebuffer.set(null)}}},Qi=function(l,h){this.context=new se(l),this.transform=h,this._tileTextures={},this.setup(),this.numSublayers=Le.maxUnderzooming+Le.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new wo,this.gpuTimers={}};Qi.prototype.resize=function(l,h){if(this.width=l*g.browser.devicePixelRatio,this.height=h*g.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var c=0,d=this.style._order;c<d.length;c+=1)this.style._layers[d[c]].resize()},Qi.prototype.setup=function(){var l=this.context,h=new g.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(g.EXTENT,0),h.emplaceBack(0,g.EXTENT),h.emplaceBack(g.EXTENT,g.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(h,ga.members),this.tileExtentSegments=g.SegmentVector.simpleSegment(0,0,4,2);var c=new g.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(g.EXTENT,0),c.emplaceBack(0,g.EXTENT),c.emplaceBack(g.EXTENT,g.EXTENT),this.debugBuffer=l.createVertexBuffer(c,ga.members),this.debugSegments=g.SegmentVector.simpleSegment(0,0,4,5);var d=new g.StructArrayLayout4i8;d.emplaceBack(0,0,0,0),d.emplaceBack(g.EXTENT,0,g.EXTENT,0),d.emplaceBack(0,g.EXTENT,0,g.EXTENT),d.emplaceBack(g.EXTENT,g.EXTENT,g.EXTENT,g.EXTENT),this.rasterBoundsBuffer=l.createVertexBuffer(d,ut.members),this.rasterBoundsSegments=g.SegmentVector.simpleSegment(0,0,4,2);var E=new g.StructArrayLayout2i4;E.emplaceBack(0,0),E.emplaceBack(1,0),E.emplaceBack(0,1),E.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(E,ga.members),this.viewportSegments=g.SegmentVector.simpleSegment(0,0,4,2);var w=new g.StructArrayLayout1ui2;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(w);var P=new g.StructArrayLayout3ui6;P.emplaceBack(0,1,2),P.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(P),this.emptyTexture=new g.Texture(l,{width:1,height:1,data:new Uint8Array([0,0,0,0])},l.gl.RGBA);var L=this.context.gl;this.stencilClearMode=new Me({func:L.ALWAYS,mask:0},0,255,L.ZERO,L.ZERO,L.ZERO)},Qi.prototype.clearStencil=function(){var l=this.context,h=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var c=g.create();g.ortho(c,0,this.width,this.height,0,0,1),g.scale(c,c,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,h.TRIANGLES,pe.disabled,this.stencilClearMode,Ge.disabled,Qe.disabled,pu(c),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Qi.prototype._renderTileClippingMasks=function(l,h){if(this.currentStencilSource!==l.source&&l.isTileClipped()&&h&&h.length){this.currentStencilSource=l.source;var c=this.context,d=c.gl;this.nextStencilID+h.length>256&&this.clearStencil(),c.setColorMode(Ge.disabled),c.setDepthMode(pe.disabled);var E=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var w=0,P=h;w<P.length;w+=1){var L=P[w],U=this._tileClippingMaskIDs[L.key]=this.nextStencilID++;E.draw(c,d.TRIANGLES,pe.disabled,new Me({func:d.ALWAYS,mask:0},U,255,d.KEEP,d.KEEP,d.REPLACE),Ge.disabled,Qe.disabled,pu(L.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Qi.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var l=this.nextStencilID++,h=this.context.gl;return new Me({func:h.NOTEQUAL,mask:255},l,255,h.KEEP,h.KEEP,h.REPLACE)},Qi.prototype.stencilModeForClipping=function(l){var h=this.context.gl;return new Me({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,h.KEEP,h.KEEP,h.REPLACE)},Qi.prototype.stencilConfigForOverlap=function(l){var h,c=this.context.gl,d=l.sort(function(U,H){return H.overscaledZ-U.overscaledZ}),E=d[d.length-1].overscaledZ,w=d[0].overscaledZ-E+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();for(var P={},L=0;L<w;L++)P[L+E]=new Me({func:c.GEQUAL,mask:255},L+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=w,[P,d]}return[(h={},h[E]=Me.disabled,h),d]},Qi.prototype.colorModeForRenderPass=function(){var l=this.context.gl;return this._showOverdrawInspector?new Ge([l.CONSTANT_COLOR,l.ONE],new g.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ge.unblended:Ge.alphaBlended},Qi.prototype.depthModeForSublayer=function(l,h,c){if(!this.opaquePassEnabledForLayer())return pe.disabled;var d=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new pe(c||this.context.gl.LEQUAL,h,[d,d])},Qi.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Qi.prototype.render=function(l,h){var c=this;this.style=l,this.options=h,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(g.browser.now()),this.imageManager.beginFrame();var d=this.style._order,E=this.style.sourceCaches;for(var w in E){var P=E[w];P.used&&P.prepare(this.context)}var L,U,H={},oe={},ue={};for(var le in E){var Ie=E[le];H[le]=Ie.getVisibleCoordinates(),oe[le]=H[le].slice().reverse(),ue[le]=Ie.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Pe=0;Pe<d.length;Pe++)if(this.style._layers[d[Pe]].is3D()){this.opaquePassCutoff=Pe;break}this.renderPass="offscreen";for(var Ne=0,xe=d;Ne<xe.length;Ne+=1){var je=this.style._layers[xe[Ne]];if(je.hasOffscreenPass()&&!je.isHidden(this.transform.zoom)){var Ke=oe[je.source];(je.type==="custom"||Ke.length)&&this.renderLayer(this,E[je.source],je,Ke)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?g.Color.black:g.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){var vt=this.style._layers[d[this.currentLayer]],Wt=E[vt.source],jt=H[vt.source];this._renderTileClippingMasks(vt,jt),this.renderLayer(this,Wt,vt,jt)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){var qt=this.style._layers[d[this.currentLayer]],pr=E[qt.source],kr=(qt.type==="symbol"?ue:oe)[qt.source];this._renderTileClippingMasks(qt,H[qt.source]),this.renderLayer(this,pr,qt,kr)}this.options.showTileBoundaries&&(g.values(this.style._layers).forEach(function(_r){_r.source&&!_r.isHidden(c.transform.zoom)&&(_r.source!==(U&&U.id)&&(U=c.style.sourceCaches[_r.source]),(!L||L.getSource().maxzoom<U.getSource().maxzoom)&&(L=U))}),L&&zl.debug(this,L,L.getVisibleCoordinates())),this.options.showPadding&&function(_r){var sn=_r.transform.padding;Oh(_r,_r.transform.height-(sn.top||0),3,Bl),Oh(_r,sn.bottom||0,3,Sf),Ih(_r,sn.left||0,3,Cf),Ih(_r,_r.transform.width-(sn.right||0),3,Nl);var Zn=_r.transform.centerPoint;(function(jn,kn,ki,tn){lc(jn,kn-1,ki-10,2,20,tn),lc(jn,kn-10,ki-1,20,2,tn)})(_r,Zn.x,_r.transform.height-Zn.y,jc)}(this),this.context.setDefault()},Qi.prototype.renderLayer=function(l,h,c,d){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||d.length)&&(this.id=c.id,this.gpuTimingStart(c),zl[c.type](l,h,c,d,this.style.placement.variableOffsets),this.gpuTimingEnd())},Qi.prototype.gpuTimingStart=function(l){if(this.options.gpuTiming){var h=this.context.extTimerQuery,c=this.gpuTimers[l.id];c||(c=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),c.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,c.query)}},Qi.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}},Qi.prototype.collectGpuTimers=function(){var l=this.gpuTimers;return this.gpuTimers={},l},Qi.prototype.queryGpuTimers=function(l){var h={};for(var c in l){var d=l[c],E=this.context.extTimerQuery,w=E.getQueryObjectEXT(d.query,E.QUERY_RESULT_EXT)/1e6;E.deleteQueryEXT(d.query),h[c]=w}return h},Qi.prototype.translatePosMatrix=function(l,h,c,d,E){if(!c[0]&&!c[1])return l;var w=E?d==="map"?this.transform.angle:0:d==="viewport"?-this.transform.angle:0;if(w){var P=Math.sin(w),L=Math.cos(w);c=[c[0]*L-c[1]*P,c[0]*P+c[1]*L]}var U=[E?c[0]:ua(h,c[0],this.transform.zoom),E?c[1]:ua(h,c[1],this.transform.zoom),0],H=new Float32Array(16);return g.translate(H,l,U),H},Qi.prototype.saveTileTexture=function(l){var h=this._tileTextures[l.size[0]];h?h.push(l):this._tileTextures[l.size[0]]=[l]},Qi.prototype.getTileTexture=function(l){var h=this._tileTextures[l];return h&&h.length>0?h.pop():null},Qi.prototype.isPatternMissing=function(l){if(!l)return!1;if(!l.from||!l.to)return!0;var h=this.imageManager.getPattern(l.from.toString()),c=this.imageManager.getPattern(l.to.toString());return!h||!c},Qi.prototype.useProgram=function(l,h){this.cache=this.cache||{};var c=""+l+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[c]||(this.cache[c]=new gf(this.context,l,Es[l],h,Dl[l],this._showOverdrawInspector)),this.cache[c]},Qi.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Qi.prototype.setBaseState=function(){var l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)},Qi.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=g.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new g.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Qi.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var cc=function(l,h){this.points=l,this.planes=h};cc.fromInvProjectionMatrix=function(l,h,c){var d=Math.pow(2,c),E=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(P){return g.transformMat4([],P,l)}).map(function(P){return g.scale$1([],P,1/P[3]/h*d)}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(P){var L=g.sub([],E[P[0]],E[P[1]]),U=g.sub([],E[P[2]],E[P[1]]),H=g.normalize([],g.cross([],L,U)),oe=-g.dot(H,E[P[1]]);return H.concat(oe)});return new cc(E,w)};var ha=function(l,h){this.min=l,this.max=h,this.center=g.scale$2([],g.add([],this.min,this.max),.5)};ha.prototype.quadrant=function(l){for(var h=[l%2==0,l<2],c=g.clone$2(this.min),d=g.clone$2(this.max),E=0;E<h.length;E++)c[E]=h[E]?this.min[E]:this.center[E],d[E]=h[E]?this.center[E]:this.max[E];return d[2]=this.max[2],new ha(c,d)},ha.prototype.distanceX=function(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]},ha.prototype.distanceY=function(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]},ha.prototype.intersects=function(l){for(var h=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],c=!0,d=0;d<l.planes.length;d++){for(var E=l.planes[d],w=0,P=0;P<h.length;P++)w+=g.dot$1(E,h[P])>=0;if(w===0)return 0;w!==h.length&&(c=!1)}if(c)return 2;for(var L=0;L<3;L++){for(var U=Number.MAX_VALUE,H=-Number.MAX_VALUE,oe=0;oe<l.points.length;oe++){var ue=l.points[oe][L]-this.min[L];U=Math.min(U,ue),H=Math.max(H,ue)}if(H<0||U>this.max[L]-this.min[L])return 0}return 1};var Iu=function(l,h,c,d){if(l===void 0&&(l=0),h===void 0&&(h=0),c===void 0&&(c=0),d===void 0&&(d=0),isNaN(l)||l<0||isNaN(h)||h<0||isNaN(c)||c<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=h,this.left=c,this.right=d};Iu.prototype.interpolate=function(l,h,c){return h.top!=null&&l.top!=null&&(this.top=g.number(l.top,h.top,c)),h.bottom!=null&&l.bottom!=null&&(this.bottom=g.number(l.bottom,h.bottom,c)),h.left!=null&&l.left!=null&&(this.left=g.number(l.left,h.left,c)),h.right!=null&&l.right!=null&&(this.right=g.number(l.right,h.right,c)),this},Iu.prototype.getCenter=function(l,h){var c=g.clamp((this.left+l-this.right)/2,0,l),d=g.clamp((this.top+h-this.bottom)/2,0,h);return new g.Point(c,d)},Iu.prototype.equals=function(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right},Iu.prototype.clone=function(){return new Iu(this.top,this.bottom,this.left,this.right)},Iu.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Yi=function(l,h,c,d,E){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=E===void 0||E,this._minZoom=l||0,this._maxZoom=h||22,this._minPitch=c==null?0:c,this._maxPitch=d==null?60:d,this.setMaxBounds(),this.width=0,this.height=0,this._center=new g.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Iu,this._posMatrixCache={},this._alignedPosMatrixCache={}},Pa={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Yi.prototype.clone=function(){var l=new Yi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.tileSize=this.tileSize,l.latRange=this.latRange,l.width=this.width,l.height=this.height,l._center=this._center,l.zoom=this.zoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._calcMatrices(),l},Pa.minZoom.get=function(){return this._minZoom},Pa.minZoom.set=function(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))},Pa.maxZoom.get=function(){return this._maxZoom},Pa.maxZoom.set=function(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))},Pa.minPitch.get=function(){return this._minPitch},Pa.minPitch.set=function(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))},Pa.maxPitch.get=function(){return this._maxPitch},Pa.maxPitch.set=function(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))},Pa.renderWorldCopies.get=function(){return this._renderWorldCopies},Pa.renderWorldCopies.set=function(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l},Pa.worldSize.get=function(){return this.tileSize*this.scale},Pa.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Pa.size.get=function(){return new g.Point(this.width,this.height)},Pa.bearing.get=function(){return-this.angle/Math.PI*180},Pa.bearing.set=function(l){var h=-g.wrap(l,-180,180)*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=g.create$2(),g.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Pa.pitch.get=function(){return this._pitch/Math.PI*180},Pa.pitch.set=function(l){var h=g.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())},Pa.fov.get=function(){return this._fov/Math.PI*180},Pa.fov.set=function(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())},Pa.zoom.get=function(){return this._zoom},Pa.zoom.set=function(l){var h=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.scale=this.zoomScale(h),this.tileZoom=Math.floor(h),this.zoomFraction=h-this.tileZoom,this._constrain(),this._calcMatrices())},Pa.center.get=function(){return this._center},Pa.center.set=function(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())},Pa.padding.get=function(){return this._edgeInsets.toJSON()},Pa.padding.set=function(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())},Pa.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Yi.prototype.isPaddingEqual=function(l){return this._edgeInsets.equals(l)},Yi.prototype.interpolatePadding=function(l,h,c){this._unmodified=!1,this._edgeInsets.interpolate(l,h,c),this._constrain(),this._calcMatrices()},Yi.prototype.coveringZoomLevel=function(l){var h=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,h)},Yi.prototype.getVisibleUnwrappedCoordinates=function(l){var h=[new g.UnwrappedTileID(0,l)];if(this._renderWorldCopies)for(var c=this.pointCoordinate(new g.Point(0,0)),d=this.pointCoordinate(new g.Point(this.width,0)),E=this.pointCoordinate(new g.Point(this.width,this.height)),w=this.pointCoordinate(new g.Point(0,this.height)),P=Math.floor(Math.min(c.x,d.x,E.x,w.x)),L=Math.floor(Math.max(c.x,d.x,E.x,w.x)),U=P-1;U<=L+1;U++)U!==0&&h.push(new g.UnwrappedTileID(U,l));return h},Yi.prototype.coveringTiles=function(l){var h=this.coveringZoomLevel(l),c=h;if(l.minzoom!==void 0&&h<l.minzoom)return[];l.maxzoom!==void 0&&h>l.maxzoom&&(h=l.maxzoom);var d=g.MercatorCoordinate.fromLngLat(this.center),E=Math.pow(2,h),w=[E*d.x,E*d.y,0],P=cc.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h),L=l.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(L=h);var U=function(_r){return{aabb:new ha([_r*E,0,0],[(_r+1)*E,E,0]),zoom:0,x:0,y:0,wrap:_r,fullyVisible:!1}},H=[],oe=[],ue=h,le=l.reparseOverscaled?c:h;if(this._renderWorldCopies)for(var Ie=1;Ie<=3;Ie++)H.push(U(-Ie)),H.push(U(Ie));for(H.push(U(0));H.length>0;){var Pe=H.pop(),Ne=Pe.x,xe=Pe.y,je=Pe.fullyVisible;if(!je){var Ke=Pe.aabb.intersects(P);if(Ke===0)continue;je=Ke===2}var vt=Pe.aabb.distanceX(w),Wt=Pe.aabb.distanceY(w),jt=Math.max(Math.abs(vt),Math.abs(Wt));if(Pe.zoom===ue||jt>3+(1<<ue-Pe.zoom)-2&&Pe.zoom>=L)oe.push({tileID:new g.OverscaledTileID(Pe.zoom===ue?le:Pe.zoom,Pe.wrap,Pe.zoom,Ne,xe),distanceSq:g.sqrLen([w[0]-.5-Ne,w[1]-.5-xe])});else for(var qt=0;qt<4;qt++){var pr=(Ne<<1)+qt%2,kr=(xe<<1)+(qt>>1);H.push({aabb:Pe.aabb.quadrant(qt),zoom:Pe.zoom+1,x:pr,y:kr,wrap:Pe.wrap,fullyVisible:je})}}return oe.sort(function(_r,sn){return _r.distanceSq-sn.distanceSq}).map(function(_r){return _r.tileID})},Yi.prototype.resize=function(l,h){this.width=l,this.height=h,this.pixelsToGLUnits=[2/l,-2/h],this._constrain(),this._calcMatrices()},Pa.unmodified.get=function(){return this._unmodified},Yi.prototype.zoomScale=function(l){return Math.pow(2,l)},Yi.prototype.scaleZoom=function(l){return Math.log(l)/Math.LN2},Yi.prototype.project=function(l){var h=g.clamp(l.lat,-this.maxValidLatitude,this.maxValidLatitude);return new g.Point(g.mercatorXfromLng(l.lng)*this.worldSize,g.mercatorYfromLat(h)*this.worldSize)},Yi.prototype.unproject=function(l){return new g.MercatorCoordinate(l.x/this.worldSize,l.y/this.worldSize).toLngLat()},Pa.point.get=function(){return this.project(this.center)},Yi.prototype.setLocationAtPoint=function(l,h){var c=this.pointCoordinate(h),d=this.pointCoordinate(this.centerPoint),E=this.locationCoordinate(l),w=new g.MercatorCoordinate(E.x-(c.x-d.x),E.y-(c.y-d.y));this.center=this.coordinateLocation(w),this._renderWorldCopies&&(this.center=this.center.wrap())},Yi.prototype.locationPoint=function(l){return this.coordinatePoint(this.locationCoordinate(l))},Yi.prototype.pointLocation=function(l){return this.coordinateLocation(this.pointCoordinate(l))},Yi.prototype.locationCoordinate=function(l){return g.MercatorCoordinate.fromLngLat(l)},Yi.prototype.coordinateLocation=function(l){return l.toLngLat()},Yi.prototype.pointCoordinate=function(l){var h=[l.x,l.y,0,1],c=[l.x,l.y,1,1];g.transformMat4(h,h,this.pixelMatrixInverse),g.transformMat4(c,c,this.pixelMatrixInverse);var d=h[3],E=c[3],w=h[1]/d,P=c[1]/E,L=h[2]/d,U=c[2]/E,H=L===U?0:(0-L)/(U-L);return new g.MercatorCoordinate(g.number(h[0]/d,c[0]/E,H)/this.worldSize,g.number(w,P,H)/this.worldSize)},Yi.prototype.coordinatePoint=function(l){var h=[l.x*this.worldSize,l.y*this.worldSize,0,1];return g.transformMat4(h,h,this.pixelMatrix),new g.Point(h[0]/h[3],h[1]/h[3])},Yi.prototype.getBounds=function(){return new g.LngLatBounds().extend(this.pointLocation(new g.Point(0,0))).extend(this.pointLocation(new g.Point(this.width,0))).extend(this.pointLocation(new g.Point(this.width,this.height))).extend(this.pointLocation(new g.Point(0,this.height)))},Yi.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new g.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Yi.prototype.setMaxBounds=function(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Yi.prototype.calculatePosMatrix=function(l,h){h===void 0&&(h=!1);var c=l.key,d=h?this._alignedPosMatrixCache:this._posMatrixCache;if(d[c])return d[c];var E=l.canonical,w=this.worldSize/this.zoomScale(E.z),P=E.x+Math.pow(2,E.z)*l.wrap,L=g.identity(new Float64Array(16));return g.translate(L,L,[P*w,E.y*w,0]),g.scale(L,L,[w/g.EXTENT,w/g.EXTENT,1]),g.multiply(L,h?this.alignedProjMatrix:this.projMatrix,L),d[c]=new Float32Array(L),d[c]},Yi.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Yi.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var l,h,c,d,E=-90,w=90,P=-180,L=180,U=this.size,H=this._unmodified;if(this.latRange){var oe=this.latRange;E=g.mercatorYfromLat(oe[1])*this.worldSize,l=(w=g.mercatorYfromLat(oe[0])*this.worldSize)-E<U.y?U.y/(w-E):0}if(this.lngRange){var ue=this.lngRange;P=g.mercatorXfromLng(ue[0])*this.worldSize,h=(L=g.mercatorXfromLng(ue[1])*this.worldSize)-P<U.x?U.x/(L-P):0}var le=this.point,Ie=Math.max(h||0,l||0);if(Ie)return this.center=this.unproject(new g.Point(h?(L+P)/2:le.x,l?(w+E)/2:le.y)),this.zoom+=this.scaleZoom(Ie),this._unmodified=H,void(this._constraining=!1);if(this.latRange){var Pe=le.y,Ne=U.y/2;Pe-Ne<E&&(d=E+Ne),Pe+Ne>w&&(d=w-Ne)}if(this.lngRange){var xe=le.x,je=U.x/2;xe-je<P&&(c=P+je),xe+je>L&&(c=L-je)}c===void 0&&d===void 0||(this.center=this.unproject(new g.Point(c!==void 0?c:le.x,d!==void 0?d:le.y))),this._unmodified=H,this._constraining=!1}},Yi.prototype._calcMatrices=function(){if(this.height){var l=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var h=Math.PI/2+this._pitch,c=this._fov*(.5+l.y/this.height),d=Math.sin(c)*this.cameraToCenterDistance/Math.sin(g.clamp(Math.PI-h-c,.01,Math.PI-.01)),E=this.point,w=E.x,P=E.y,L=1.01*(Math.cos(Math.PI/2-this._pitch)*d+this.cameraToCenterDistance),U=this.height/50,H=new Float64Array(16);g.perspective(H,this._fov,this.width/this.height,U,L),H[8]=2*-l.x/this.width,H[9]=2*l.y/this.height,g.scale(H,H,[1,-1,1]),g.translate(H,H,[0,0,-this.cameraToCenterDistance]),g.rotateX(H,H,this._pitch),g.rotateZ(H,H,this.angle),g.translate(H,H,[-w,-P,0]),this.mercatorMatrix=g.scale([],H,[this.worldSize,this.worldSize,this.worldSize]),g.scale(H,H,[1,1,g.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=H,this.invProjMatrix=g.invert([],this.projMatrix);var oe=this.width%2/2,ue=this.height%2/2,le=Math.cos(this.angle),Ie=Math.sin(this.angle),Pe=w-Math.round(w)+le*oe+Ie*ue,Ne=P-Math.round(P)+le*ue+Ie*oe,xe=new Float64Array(H);if(g.translate(xe,xe,[Pe>.5?Pe-1:Pe,Ne>.5?Ne-1:Ne,0]),this.alignedProjMatrix=xe,H=g.create(),g.scale(H,H,[this.width/2,-this.height/2,1]),g.translate(H,H,[1,-1,0]),this.labelPlaneMatrix=H,H=g.create(),g.scale(H,H,[1,-1,1]),g.translate(H,H,[-1,-1,0]),g.scale(H,H,[2/this.width,2/this.height,1]),this.glCoordMatrix=H,this.pixelMatrix=g.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(H=g.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=H,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Yi.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var l=this.pointCoordinate(new g.Point(0,0)),h=[l.x*this.worldSize,l.y*this.worldSize,0,1];return g.transformMat4(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance},Yi.prototype.getCameraPoint=function(){var l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new g.Point(0,l))},Yi.prototype.getCameraQueryGeometry=function(l){var h=this.getCameraPoint();if(l.length===1)return[l[0],h];for(var c=h.x,d=h.y,E=h.x,w=h.y,P=0,L=l;P<L.length;P+=1){var U=L[P];c=Math.min(c,U.x),d=Math.min(d,U.y),E=Math.max(E,U.x),w=Math.max(w,U.y)}return[new g.Point(c,d),new g.Point(E,d),new g.Point(E,w),new g.Point(c,w),new g.Point(c,d)]},Object.defineProperties(Yi.prototype,Pa);var Ss=function(l){var h,c,d,E;this._hashName=l&&encodeURIComponent(l),g.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(h=this._updateHashUnthrottled.bind(this),c=!1,d=null,E=function(){d=null,c&&(h(),d=setTimeout(E,300),c=!1)},function(){return c=!0,d||E(),d})};Ss.prototype.addTo=function(l){return this._map=l,g.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Ss.prototype.remove=function(){return g.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Ss.prototype.getHashString=function(l){var h=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,d=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,d),w=Math.round(h.lng*E)/E,P=Math.round(h.lat*E)/E,L=this._map.getBearing(),U=this._map.getPitch(),H="";if(H+=l?"/"+w+"/"+P+"/"+c:c+"/"+P+"/"+w,(L||U)&&(H+="/"+Math.round(10*L)/10),U&&(H+="/"+Math.round(U)),this._hashName){var oe=this._hashName,ue=!1,le=g.window.location.hash.slice(1).split("&").map(function(Ie){var Pe=Ie.split("=")[0];return Pe===oe?(ue=!0,Pe+"="+H):Ie}).filter(function(Ie){return Ie});return ue||le.push(oe+"="+H),"#"+le.join("&")}return"#"+H},Ss.prototype._getCurrentHash=function(){var l,h=this,c=g.window.location.hash.replace("#","");return this._hashName?(c.split("&").map(function(d){return d.split("=")}).forEach(function(d){d[0]===h._hashName&&(l=d)}),(l&&l[1]||"").split("/")):c.split("/")},Ss.prototype._onHashChange=function(){var l=this._getCurrentHash();if(l.length>=3&&!l.some(function(c){return isNaN(c)})){var h=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(l[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:h,pitch:+(l[4]||0)}),!0}return!1},Ss.prototype._updateHashUnthrottled=function(){var l=g.window.location.href.replace(/(#.+)?$/,this.getHashString());try{g.window.history.replaceState(g.window.history.state,null,l)}catch(h){}};var Vc={linearity:.3,easing:g.bezier(0,0,.3,1)},$u=g.extend({deceleration:2500,maxSpeed:1400},Vc),Za=g.extend({deceleration:20,maxSpeed:1400},Vc),fc=g.extend({deceleration:1e3,maxSpeed:360},Vc),Ul=g.extend({deceleration:1e3,maxSpeed:90},Vc),Qu=function(l){this._map=l,this.clear()};function Gc(l,h){(!l.duration||l.duration<h.duration)&&(l.duration=h.duration,l.easing=h.easing)}function Ru(l,h,c){var d=c.maxSpeed,E=c.linearity,w=c.deceleration,P=g.clamp(l*E/(h/1e3),-d,d),L=Math.abs(P)/(w*E);return{easing:c.easing,duration:1e3*L,amount:P*(L/2)}}Qu.prototype.clear=function(){this._inertiaBuffer=[]},Qu.prototype.record=function(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:g.browser.now(),settings:l})},Qu.prototype._drainInertiaBuffer=function(){for(var l=this._inertiaBuffer,h=g.browser.now();l.length>0&&h-l[0].time>160;)l.shift()},Qu.prototype._onMoveEnd=function(l){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var h={zoom:0,bearing:0,pitch:0,pan:new g.Point(0,0),pinchAround:void 0,around:void 0},c=0,d=this._inertiaBuffer;c<d.length;c+=1){var E=d[c].settings;h.zoom+=E.zoomDelta||0,h.bearing+=E.bearingDelta||0,h.pitch+=E.pitchDelta||0,E.panDelta&&h.pan._add(E.panDelta),E.around&&(h.around=E.around),E.pinchAround&&(h.pinchAround=E.pinchAround)}var w=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,P={};if(h.pan.mag()){var L=Ru(h.pan.mag(),w,g.extend({},$u,l||{}));P.offset=h.pan.mult(L.amount/h.pan.mag()),P.center=this._map.transform.center,Gc(P,L)}if(h.zoom){var U=Ru(h.zoom,w,Za);P.zoom=this._map.transform.zoom+U.amount,Gc(P,U)}if(h.bearing){var H=Ru(h.bearing,w,fc);P.bearing=this._map.transform.bearing+g.clamp(H.amount,-179,179),Gc(P,H)}if(h.pitch){var oe=Ru(h.pitch,w,Ul);P.pitch=this._map.transform.pitch+oe.amount,Gc(P,oe)}if(P.zoom||P.bearing){var ue=h.pinchAround===void 0?h.around:h.pinchAround;P.around=ue?this._map.unproject(ue):this._map.getCenter()}return this.clear(),g.extend(P,{noMoveStart:!0})}};var mo=function(l){function h(d,E,w,P){P===void 0&&(P={});var L=W.mousePos(E.getCanvasContainer(),w),U=E.unproject(L);l.call(this,d,g.extend({point:L,lngLat:U,originalEvent:w},P)),this._defaultPrevented=!1,this.target=E}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var c={defaultPrevented:{configurable:!0}};return h.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(h.prototype,c),h}(g.Event),Zl=function(l){function h(d,E,w){var P=d==="touchend"?w.changedTouches:w.touches,L=W.touchPos(E.getCanvasContainer(),P),U=L.map(function(ue){return E.unproject(ue)}),H=L.reduce(function(ue,le,Ie,Pe){return ue.add(le.div(Pe.length))},new g.Point(0,0)),oe=E.unproject(H);l.call(this,d,{points:L,point:H,lngLats:U,lngLat:oe,originalEvent:w}),this._defaultPrevented=!1}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var c={defaultPrevented:{configurable:!0}};return h.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(h.prototype,c),h}(g.Event),hc=function(l){function h(d,E,w){l.call(this,d,{originalEvent:w}),this._defaultPrevented=!1}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var c={defaultPrevented:{configurable:!0}};return h.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(h.prototype,c),h}(g.Event),go=function(l,h){this._map=l,this._clickTolerance=h.clickTolerance};go.prototype.reset=function(){delete this._mousedownPos},go.prototype.wheel=function(l){return this._firePreventable(new hc(l.type,this._map,l))},go.prototype.mousedown=function(l,h){return this._mousedownPos=h,this._firePreventable(new mo(l.type,this._map,l))},go.prototype.mouseup=function(l){this._map.fire(new mo(l.type,this._map,l))},go.prototype.click=function(l,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new mo(l.type,this._map,l))},go.prototype.dblclick=function(l){return this._firePreventable(new mo(l.type,this._map,l))},go.prototype.mouseover=function(l){this._map.fire(new mo(l.type,this._map,l))},go.prototype.mouseout=function(l){this._map.fire(new mo(l.type,this._map,l))},go.prototype.touchstart=function(l){return this._firePreventable(new Zl(l.type,this._map,l))},go.prototype.touchmove=function(l){this._map.fire(new Zl(l.type,this._map,l))},go.prototype.touchend=function(l){this._map.fire(new Zl(l.type,this._map,l))},go.prototype.touchcancel=function(l){this._map.fire(new Zl(l.type,this._map,l))},go.prototype._firePreventable=function(l){if(this._map.fire(l),l.defaultPrevented)return{}},go.prototype.isEnabled=function(){return!0},go.prototype.isActive=function(){return!1},go.prototype.enable=function(){},go.prototype.disable=function(){};var vn=function(l){this._map=l};vn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},vn.prototype.mousemove=function(l){this._map.fire(new mo(l.type,this._map,l))},vn.prototype.mousedown=function(){this._delayContextMenu=!0},vn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new mo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},vn.prototype.contextmenu=function(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new mo(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()},vn.prototype.isEnabled=function(){return!0},vn.prototype.isActive=function(){return!1},vn.prototype.enable=function(){},vn.prototype.disable=function(){};var fo=function(l,h){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=h.clickTolerance||1};function Ju(l,h){for(var c={},d=0;d<l.length;d++)c[l[d].identifier]=h[d];return c}fo.prototype.isEnabled=function(){return!!this._enabled},fo.prototype.isActive=function(){return!!this._active},fo.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},fo.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},fo.prototype.mousedown=function(l,h){this.isEnabled()&&l.shiftKey&&l.button===0&&(W.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)},fo.prototype.mousemoveWindow=function(l,h){if(this._active){var c=h;if(!(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)){var d=this._startPos;this._lastPos=c,this._box||(this._box=W.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));var E=Math.min(d.x,c.x),w=Math.max(d.x,c.x),P=Math.min(d.y,c.y),L=Math.max(d.y,c.y);W.setTransform(this._box,"translate("+E+"px,"+P+"px)"),this._box.style.width=w-E+"px",this._box.style.height=L-P+"px"}}},fo.prototype.mouseupWindow=function(l,h){var c=this;if(this._active&&l.button===0){var d=this._startPos,E=h;if(this.reset(),W.suppressClick(),d.x!==E.x||d.y!==E.y)return this._map.fire(new g.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:function(w){return w.fitScreenCoordinates(d,E,c._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",l)}},fo.prototype.keydown=function(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))},fo.prototype.blur=function(){this.reset()},fo.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(W.remove(this._box),this._box=null),W.enableDrag(),delete this._startPos,delete this._lastPos},fo.prototype._fireEvent=function(l,h){return this._map.fire(new g.Event(l,{originalEvent:h}))};var ka=function(l){this.reset(),this.numTouches=l.numTouches};ka.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},ka.prototype.touchstart=function(l,h,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),c.length===this.numTouches&&(this.centroid=function(d){for(var E=new g.Point(0,0),w=0,P=d;w<P.length;w+=1)E._add(P[w]);return E.div(d.length)}(h),this.touches=Ju(c,h)))},ka.prototype.touchmove=function(l,h,c){if(!this.aborted&&this.centroid){var d=Ju(c,h);for(var E in this.touches){var w=d[E];(!w||w.dist(this.touches[E])>30)&&(this.aborted=!0)}}},ka.prototype.touchend=function(l,h,c){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){var d=!this.aborted&&this.centroid;if(this.reset(),d)return d}};var Qs=function(l){this.singleTap=new ka(l),this.numTaps=l.numTaps,this.reset()};Qs.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Qs.prototype.touchstart=function(l,h,c){this.singleTap.touchstart(l,h,c)},Qs.prototype.touchmove=function(l,h,c){this.singleTap.touchmove(l,h,c)},Qs.prototype.touchend=function(l,h,c){var d=this.singleTap.touchend(l,h,c);if(d){var E=l.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(d)<30;if(E&&w||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}};var Os=function(){this._zoomIn=new Qs({numTouches:1,numTaps:2}),this._zoomOut=new Qs({numTouches:2,numTaps:1}),this.reset()};Os.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Os.prototype.touchstart=function(l,h,c){this._zoomIn.touchstart(l,h,c),this._zoomOut.touchstart(l,h,c)},Os.prototype.touchmove=function(l,h,c){this._zoomIn.touchmove(l,h,c),this._zoomOut.touchmove(l,h,c)},Os.prototype.touchend=function(l,h,c){var d=this,E=this._zoomIn.touchend(l,h,c),w=this._zoomOut.touchend(l,h,c);return E?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(P){return P.easeTo({duration:300,zoom:P.getZoom()+1,around:P.unproject(E)},{originalEvent:l})}}):w?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(P){return P.easeTo({duration:300,zoom:P.getZoom()-1,around:P.unproject(w)},{originalEvent:l})}}):void 0},Os.prototype.touchcancel=function(){this.reset()},Os.prototype.enable=function(){this._enabled=!0},Os.prototype.disable=function(){this._enabled=!1,this.reset()},Os.prototype.isEnabled=function(){return this._enabled},Os.prototype.isActive=function(){return this._active};var Af={0:1,2:2},Zr=function(l){this.reset(),this._clickTolerance=l.clickTolerance||1};Zr.prototype.blur=function(){this.reset()},Zr.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Zr.prototype._correctButton=function(l,h){return!1},Zr.prototype._move=function(l,h){return{}},Zr.prototype.mousedown=function(l,h){if(!this._lastPoint){var c=W.mouseButton(l);this._correctButton(l,c)&&(this._lastPoint=h,this._eventButton=c)}},Zr.prototype.mousemoveWindow=function(l,h){var c=this._lastPoint;if(c){if(l.preventDefault(),function(d,E){var w=Af[E];return d.buttons===void 0||(d.buttons&w)!==w}(l,this._eventButton))this.reset();else if(this._moved||!(h.dist(c)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(c,h)}},Zr.prototype.mouseupWindow=function(l){this._lastPoint&&W.mouseButton(l)===this._eventButton&&(this._moved&&W.suppressClick(),this.reset())},Zr.prototype.enable=function(){this._enabled=!0},Zr.prototype.disable=function(){this._enabled=!1,this.reset()},Zr.prototype.isEnabled=function(){return this._enabled},Zr.prototype.isActive=function(){return this._active};var pc=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.mousedown=function(c,d){l.prototype.mousedown.call(this,c,d),this._lastPoint&&(this._active=!0)},h.prototype._correctButton=function(c,d){return d===0&&!c.ctrlKey},h.prototype._move=function(c,d){return{around:d,panDelta:d.sub(c)}},h}(Zr),wf=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},h.prototype._move=function(c,d){var E=.8*(d.x-c.x);if(E)return this._active=!0,{bearingDelta:E}},h.prototype.contextmenu=function(c){c.preventDefault()},h}(Zr),hl=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},h.prototype._move=function(c,d){var E=-.5*(d.y-c.y);if(E)return this._active=!0,{pitchDelta:E}},h.prototype.contextmenu=function(c){c.preventDefault()},h}(Zr),Aa=function(l){this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset()};Aa.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new g.Point(0,0)},Aa.prototype.touchstart=function(l,h,c){return this._calculateTransform(l,h,c)},Aa.prototype.touchmove=function(l,h,c){if(this._active&&!(c.length<this._minTouches))return l.preventDefault(),this._calculateTransform(l,h,c)},Aa.prototype.touchend=function(l,h,c){this._calculateTransform(l,h,c),this._active&&c.length<this._minTouches&&this.reset()},Aa.prototype.touchcancel=function(){this.reset()},Aa.prototype._calculateTransform=function(l,h,c){c.length>0&&(this._active=!0);var d=Ju(c,h),E=new g.Point(0,0),w=new g.Point(0,0),P=0;for(var L in d){var U=d[L],H=this._touches[L];H&&(E._add(U),w._add(U.sub(H)),P++,d[L]=U)}if(this._touches=d,!(P<this._minTouches)&&w.mag()){var oe=w.div(P);if(this._sum._add(oe),!(this._sum.mag()<this._clickTolerance))return{around:E.div(P),panDelta:oe}}},Aa.prototype.enable=function(){this._enabled=!0},Aa.prototype.disable=function(){this._enabled=!1,this.reset()},Aa.prototype.isEnabled=function(){return this._enabled},Aa.prototype.isActive=function(){return this._active};var Cs=function(){this.reset()};function Tf(l,h,c){for(var d=0;d<l.length;d++)if(l[d].identifier===c)return h[d]}function ku(l,h){return Math.log(l/h)/Math.LN2}Cs.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Cs.prototype._start=function(l){},Cs.prototype._move=function(l,h,c){return{}},Cs.prototype.touchstart=function(l,h,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([h[0],h[1]]))},Cs.prototype.touchmove=function(l,h,c){if(this._firstTwoTouches){l.preventDefault();var d=this._firstTwoTouches,E=d[1],w=Tf(c,h,d[0]),P=Tf(c,h,E);if(w&&P){var L=this._aroundCenter?null:w.add(P).div(2);return this._move([w,P],L,l)}}},Cs.prototype.touchend=function(l,h,c){if(this._firstTwoTouches){var d=this._firstTwoTouches,E=d[1],w=Tf(c,h,d[0]),P=Tf(c,h,E);w&&P||(this._active&&W.suppressClick(),this.reset())}},Cs.prototype.touchcancel=function(){this.reset()},Cs.prototype.enable=function(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"},Cs.prototype.disable=function(){this._enabled=!1,this.reset()},Cs.prototype.isEnabled=function(){return this._enabled},Cs.prototype.isActive=function(){return this._active};var Bs=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.reset=function(){l.prototype.reset.call(this),delete this._distance,delete this._startDistance},h.prototype._start=function(c){this._startDistance=this._distance=c[0].dist(c[1])},h.prototype._move=function(c,d){var E=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(ku(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ku(this._distance,E),pinchAround:d}},h}(Cs);function Lu(l,h){return 180*l.angleWith(h)/Math.PI}var qf=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.reset=function(){l.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},h.prototype._start=function(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])},h.prototype._move=function(c,d){var E=this._vector;if(this._vector=c[0].sub(c[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Lu(this._vector,E),pinchAround:d}},h.prototype._isBelowThreshold=function(c){this._minDiameter=Math.min(this._minDiameter,c.mag());var d=25/(Math.PI*this._minDiameter)*360,E=Lu(c,this._startVector);return Math.abs(E)<d},h}(Cs);function pl(l){return Math.abs(l.y)>Math.abs(l.x)}var Kf=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.reset=function(){l.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},h.prototype._start=function(c){this._lastPoints=c,pl(c[0].sub(c[1]))&&(this._valid=!1)},h.prototype._move=function(c,d,E){var w=c[0].sub(this._lastPoints[0]),P=c[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(w,P,E.timeStamp),this._valid)return this._lastPoints=c,this._active=!0,{pitchDelta:(w.y+P.y)/2*-.5}},h.prototype.gestureBeginsVertically=function(c,d,E){if(this._valid!==void 0)return this._valid;var w=c.mag()>=2,P=d.mag()>=2;if(w||P){if(!w||!P)return this._firstMove===void 0&&(this._firstMove=E),E-this._firstMove<100&&void 0;var L=c.y>0==d.y>0;return pl(c)&&pl(d)&&L}},h}(Cs),Mf={panStep:100,bearingStep:15,pitchStep:10},vu=function(){var l=Mf;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1};function Is(l){return l*(2-l)}vu.prototype.blur=function(){this.reset()},vu.prototype.reset=function(){this._active=!1},vu.prototype.keydown=function(l){var h=this;if(!(l.altKey||l.ctrlKey||l.metaKey)){var c=0,d=0,E=0,w=0,P=0;switch(l.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:l.shiftKey?d=-1:(l.preventDefault(),w=-1);break;case 39:l.shiftKey?d=1:(l.preventDefault(),w=1);break;case 38:l.shiftKey?E=1:(l.preventDefault(),P=-1);break;case 40:l.shiftKey?E=-1:(l.preventDefault(),P=1);break;default:return}return this._rotationDisabled&&(d=0,E=0),{cameraAnimation:function(L){var U=L.getZoom();L.easeTo({duration:300,easeId:"keyboardHandler",easing:Is,zoom:c?Math.round(U)+c*(l.shiftKey?2:1):U,bearing:L.getBearing()+d*h._bearingStep,pitch:L.getPitch()+E*h._pitchStep,offset:[-w*h._panStep,-P*h._panStep],center:L.getCenter()},{originalEvent:l})}}}},vu.prototype.enable=function(){this._enabled=!0},vu.prototype.disable=function(){this._enabled=!1,this.reset()},vu.prototype.isEnabled=function(){return this._enabled},vu.prototype.isActive=function(){return this._active},vu.prototype.disableRotation=function(){this._rotationDisabled=!0},vu.prototype.enableRotation=function(){this._rotationDisabled=!1};var Ai=function(l,h){this._map=l,this._el=l.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,g.bindAll(["_onTimeout"],this)};Ai.prototype.setZoomRate=function(l){this._defaultZoomRate=l},Ai.prototype.setWheelZoomRate=function(l){this._wheelZoomRate=l},Ai.prototype.isEnabled=function(){return!!this._enabled},Ai.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Ai.prototype.isZooming=function(){return!!this._zooming},Ai.prototype.enable=function(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=l&&l.around==="center")},Ai.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Ai.prototype.wheel=function(l){if(this.isEnabled()){var h=l.deltaMode===g.window.WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY,c=g.browser.now(),d=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,h!==0&&h%4.000244140625==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(d*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),l.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=l,this._delta-=h,this._active||this._start(l)),l.preventDefault()}},Ai.prototype._onTimeout=function(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},Ai.prototype._start=function(l){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var h=W.mousePos(this._el,l);this._around=g.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(h)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Ai.prototype.renderFrame=function(){var l=this;if(this._frameId&&(this._frameId=null,this.isActive())){var h=this._map.transform;if(this._delta!==0){var c=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,d=2/(1+Math.exp(-Math.abs(this._delta*c)));this._delta<0&&d!==0&&(d=1/d);var E=typeof this._targetZoom=="number"?h.zoomScale(this._targetZoom):h.scale;this._targetZoom=Math.min(h.maxZoom,Math.max(h.minZoom,h.scaleZoom(E*d))),this._type==="wheel"&&(this._startZoom=h.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var w,P=typeof this._targetZoom=="number"?this._targetZoom:h.zoom,L=this._startZoom,U=this._easing,H=!1;if(this._type==="wheel"&&L&&U){var oe=Math.min((g.browser.now()-this._lastWheelEventTime)/200,1),ue=U(oe);w=g.number(L,P,ue),oe<1?this._frameId||(this._frameId=!0):H=!0}else w=P,H=!0;return this._active=!0,H&&(this._active=!1,this._finishTimeout=setTimeout(function(){l._zooming=!1,l._handler._triggerRenderFrame(),delete l._targetZoom,delete l._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!H,zoomDelta:w-h.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Ai.prototype._smoothOutEasing=function(l){var h=g.ease;if(this._prevEase){var c=this._prevEase,d=(g.browser.now()-c.start)/c.duration,E=c.easing(d+.01)-c.easing(d),w=.27/Math.sqrt(E*E+1e-4)*.01,P=Math.sqrt(.0729-w*w);h=g.bezier(w,P,.25,1)}return this._prevEase={start:g.browser.now(),duration:l,easing:h},h},Ai.prototype.blur=function(){this.reset()},Ai.prototype.reset=function(){this._active=!1};var Du=function(l,h){this._clickZoom=l,this._tapZoom=h};Du.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Du.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Du.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Du.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var mu=function(){this.reset()};mu.prototype.reset=function(){this._active=!1},mu.prototype.blur=function(){this.reset()},mu.prototype.dblclick=function(l,h){return l.preventDefault(),{cameraAnimation:function(c){c.easeTo({duration:300,zoom:c.getZoom()+(l.shiftKey?-1:1),around:c.unproject(h)},{originalEvent:l})}}},mu.prototype.enable=function(){this._enabled=!0},mu.prototype.disable=function(){this._enabled=!1,this.reset()},mu.prototype.isEnabled=function(){return this._enabled},mu.prototype.isActive=function(){return this._active};var Go=function(){this._tap=new Qs({numTouches:1,numTaps:1}),this.reset()};Go.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Go.prototype.touchstart=function(l,h,c){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?c.length>0&&(this._swipePoint=h[0],this._swipeTouch=c[0].identifier):this._tap.touchstart(l,h,c))},Go.prototype.touchmove=function(l,h,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;var d=h[0],E=d.y-this._swipePoint.y;return this._swipePoint=d,l.preventDefault(),this._active=!0,{zoomDelta:E/128}}}else this._tap.touchmove(l,h,c)},Go.prototype.touchend=function(l,h,c){this._tapTime?this._swipePoint&&c.length===0&&this.reset():this._tap.touchend(l,h,c)&&(this._tapTime=l.timeStamp)},Go.prototype.touchcancel=function(){this.reset()},Go.prototype.enable=function(){this._enabled=!0},Go.prototype.disable=function(){this._enabled=!1,this.reset()},Go.prototype.isEnabled=function(){return this._enabled},Go.prototype.isActive=function(){return this._active};var dl=function(l,h,c){this._el=l,this._mousePan=h,this._touchPan=c};dl.prototype.enable=function(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},dl.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},dl.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},dl.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var as=function(l,h,c){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=h,this._mousePitch=c};as.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},as.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},as.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},as.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var Js=function(l,h,c,d){this._el=l,this._touchZoom=h,this._touchRotate=c,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0};Js.prototype.enable=function(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},Js.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},Js.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},Js.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},Js.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},Js.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var As=function(l){return l.zoom||l.drag||l.pitch||l.rotate},Eu=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h}(g.Event);function In(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}var Cn=function(l,h){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Qu(l),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h),g.bindAll(["handleEvent","handleWindowEvent"],this);var c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[g.window.document,"mousemove",{capture:!0}],[g.window.document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[g.window,"blur",void 0]];for(var d=0,E=this._listeners;d<E.length;d+=1){var w=E[d],P=w[0];W.addEventListener(P,w[1],P===g.window.document?this.handleWindowEvent:this.handleEvent,w[2])}};Cn.prototype.destroy=function(){for(var l=0,h=this._listeners;l<h.length;l+=1){var c=h[l],d=c[0];W.removeEventListener(d,c[1],d===g.window.document?this.handleWindowEvent:this.handleEvent,c[2])}},Cn.prototype._addDefaultHandlers=function(l){var h=this._map,c=h.getCanvasContainer();this._add("mapEvent",new go(h,l));var d=h.boxZoom=new fo(h,l);this._add("boxZoom",d);var E=new Os,w=new mu;h.doubleClickZoom=new Du(w,E),this._add("tapZoom",E),this._add("clickZoom",w);var P=new Go;this._add("tapDragZoom",P);var L=h.touchPitch=new Kf;this._add("touchPitch",L);var U=new wf(l),H=new hl(l);h.dragRotate=new as(l,U,H),this._add("mouseRotate",U,["mousePitch"]),this._add("mousePitch",H,["mouseRotate"]);var oe=new pc(l),ue=new Aa(l);h.dragPan=new dl(c,oe,ue),this._add("mousePan",oe),this._add("touchPan",ue,["touchZoom","touchRotate"]);var le=new qf,Ie=new Bs;h.touchZoomRotate=new Js(c,Ie,le,P),this._add("touchRotate",le,["touchPan","touchZoom"]),this._add("touchZoom",Ie,["touchPan","touchRotate"]);var Pe=h.scrollZoom=new Ai(h,this);this._add("scrollZoom",Pe,["mousePan"]);var Ne=h.keyboard=new vu;this._add("keyboard",Ne),this._add("blockableMapEvent",new vn(h));for(var xe=0,je=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];xe<je.length;xe+=1){var Ke=je[xe];l.interactive&&l[Ke]&&h[Ke].enable(l[Ke])}},Cn.prototype._add=function(l,h,c){this._handlers.push({handlerName:l,handler:h,allowed:c}),this._handlersById[l]=h},Cn.prototype.stop=function(l){if(!this._updatingCamera){for(var h=0,c=this._handlers;h<c.length;h+=1)c[h].handler.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}},Cn.prototype.isActive=function(){for(var l=0,h=this._handlers;l<h.length;l+=1)if(h[l].handler.isActive())return!0;return!1},Cn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},Cn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},Cn.prototype.isMoving=function(){return Boolean(As(this._eventsInProgress))||this.isZooming()},Cn.prototype._blockedByActive=function(l,h,c){for(var d in l)if(d!==c&&(!h||h.indexOf(d)<0))return!0;return!1},Cn.prototype.handleWindowEvent=function(l){this.handleEvent(l,l.type+"Window")},Cn.prototype._getMapTouches=function(l){for(var h=[],c=0,d=l;c<d.length;c+=1){var E=d[c];this._el.contains(E.target)&&h.push(E)}return h},Cn.prototype.handleEvent=function(l,h){this._updatingCamera=!0;for(var c=l.type==="renderFrame"?void 0:l,d={needsRenderFrame:!1},E={},w={},P=l.touches?this._getMapTouches(l.touches):void 0,L=P?W.touchPos(this._el,P):W.mousePos(this._el,l),U=0,H=this._handlers;U<H.length;U+=1){var oe=H[U],ue=oe.handlerName,le=oe.handler,Ie=oe.allowed;if(le.isEnabled()){var Pe=void 0;this._blockedByActive(w,Ie,ue)?le.reset():le[h||l.type]&&(Pe=le[h||l.type](l,L,P),this.mergeHandlerResult(d,E,Pe,ue,c),Pe&&Pe.needsRenderFrame&&this._triggerRenderFrame()),(Pe||le.isActive())&&(w[ue]=le)}}var Ne={};for(var xe in this._previousActiveHandlers)w[xe]||(Ne[xe]=c);this._previousActiveHandlers=w,(Object.keys(Ne).length||In(d))&&(this._changes.push([d,E,Ne]),this._triggerRenderFrame()),(Object.keys(w).length||In(d))&&this._map._stop(!0),this._updatingCamera=!1;var je=d.cameraAnimation;je&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],je(this._map))},Cn.prototype.mergeHandlerResult=function(l,h,c,d,E){if(c){g.extend(l,c);var w={handlerName:d,originalEvent:c.originalEvent||E};c.zoomDelta!==void 0&&(h.zoom=w),c.panDelta!==void 0&&(h.drag=w),c.pitchDelta!==void 0&&(h.pitch=w),c.bearingDelta!==void 0&&(h.rotate=w)}},Cn.prototype._applyChanges=function(){for(var l={},h={},c={},d=0,E=this._changes;d<E.length;d+=1){var w=E[d],P=w[0],L=w[1],U=w[2];P.panDelta&&(l.panDelta=(l.panDelta||new g.Point(0,0))._add(P.panDelta)),P.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+P.zoomDelta),P.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+P.bearingDelta),P.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+P.pitchDelta),P.around!==void 0&&(l.around=P.around),P.pinchAround!==void 0&&(l.pinchAround=P.pinchAround),P.noInertia&&(l.noInertia=P.noInertia),g.extend(h,L),g.extend(c,U)}this._updateMapTransform(l,h,c),this._changes=[]},Cn.prototype._updateMapTransform=function(l,h,c){var d=this._map,E=d.transform;if(!In(l))return this._fireEvents(h,c,!0);var w=l.panDelta,P=l.zoomDelta,L=l.bearingDelta,U=l.pitchDelta,H=l.around,oe=l.pinchAround;oe!==void 0&&(H=oe),d._stop(!0),H=H||d.transform.centerPoint;var ue=E.pointLocation(w?H.sub(w):H);L&&(E.bearing+=L),U&&(E.pitch+=U),P&&(E.zoom+=P),E.setLocationAtPoint(ue,H),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(h,c,!0)},Cn.prototype._fireEvents=function(l,h,c){var d=this,E=As(this._eventsInProgress),w=As(l),P={};for(var L in l)this._eventsInProgress[L]||(P[L+"start"]=l[L].originalEvent),this._eventsInProgress[L]=l[L];for(var U in!E&&w&&this._fireEvent("movestart",w.originalEvent),P)this._fireEvent(U,P[U]);for(var H in w&&this._fireEvent("move",w.originalEvent),l)this._fireEvent(H,l[H].originalEvent);var oe,ue={};for(var le in this._eventsInProgress){var Ie=this._eventsInProgress[le],Pe=Ie.handlerName,Ne=Ie.originalEvent;this._handlersById[Pe].isActive()||(delete this._eventsInProgress[le],ue[le+"end"]=oe=h[Pe]||Ne)}for(var xe in ue)this._fireEvent(xe,ue[xe]);var je=As(this._eventsInProgress);if(c&&(E||w)&&!je){this._updatingCamera=!0;var Ke=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),vt=function(Wt){return Wt!==0&&-d._bearingSnap<Wt&&Wt<d._bearingSnap};Ke?(vt(Ke.bearing||this._map.getBearing())&&(Ke.bearing=0),this._map.easeTo(Ke,{originalEvent:oe})):(this._map.fire(new g.Event("moveend",{originalEvent:oe})),vt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},Cn.prototype._fireEvent=function(l,h){this._map.fire(new g.Event(l,h?{originalEvent:h}:{}))},Cn.prototype._requestFrame=function(){var l=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(h){delete l._frameId,l.handleEvent(new Eu("renderFrame",{timeStamp:h})),l._applyChanges()})},Cn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Hc=function(l){function h(c,d){l.call(this),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=d.bearingSnap,g.bindAll(["_renderFrameCallback"],this)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getCenter=function(){return new g.LngLat(this.transform.center.lng,this.transform.center.lat)},h.prototype.setCenter=function(c,d){return this.jumpTo({center:c},d)},h.prototype.panBy=function(c,d,E){return c=g.Point.convert(c).mult(-1),this.panTo(this.transform.center,g.extend({offset:c},d),E)},h.prototype.panTo=function(c,d,E){return this.easeTo(g.extend({center:c},d),E)},h.prototype.getZoom=function(){return this.transform.zoom},h.prototype.setZoom=function(c,d){return this.jumpTo({zoom:c},d),this},h.prototype.zoomTo=function(c,d,E){return this.easeTo(g.extend({zoom:c},d),E)},h.prototype.zoomIn=function(c,d){return this.zoomTo(this.getZoom()+1,c,d),this},h.prototype.zoomOut=function(c,d){return this.zoomTo(this.getZoom()-1,c,d),this},h.prototype.getBearing=function(){return this.transform.bearing},h.prototype.setBearing=function(c,d){return this.jumpTo({bearing:c},d),this},h.prototype.getPadding=function(){return this.transform.padding},h.prototype.setPadding=function(c,d){return this.jumpTo({padding:c},d),this},h.prototype.rotateTo=function(c,d,E){return this.easeTo(g.extend({bearing:c},d),E)},h.prototype.resetNorth=function(c,d){return this.rotateTo(0,g.extend({duration:1e3},c),d),this},h.prototype.resetNorthPitch=function(c,d){return this.easeTo(g.extend({bearing:0,pitch:0,duration:1e3},c),d),this},h.prototype.snapToNorth=function(c,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,d):this},h.prototype.getPitch=function(){return this.transform.pitch},h.prototype.setPitch=function(c,d){return this.jumpTo({pitch:c},d),this},h.prototype.cameraForBounds=function(c,d){c=g.LngLatBounds.convert(c);var E=d&&d.bearing||0;return this._cameraForBoxAndBearing(c.getNorthWest(),c.getSouthEast(),E,d)},h.prototype._cameraForBoxAndBearing=function(c,d,E,w){var P={top:0,bottom:0,right:0,left:0};if(typeof(w=g.extend({padding:P,offset:[0,0],maxZoom:this.transform.maxZoom},w)).padding=="number"){var L=w.padding;w.padding={top:L,bottom:L,right:L,left:L}}w.padding=g.extend(P,w.padding);var U=this.transform,H=U.padding,oe=U.project(g.LngLat.convert(c)),ue=U.project(g.LngLat.convert(d)),le=oe.rotate(-E*Math.PI/180),Ie=ue.rotate(-E*Math.PI/180),Pe=new g.Point(Math.max(le.x,Ie.x),Math.max(le.y,Ie.y)),Ne=new g.Point(Math.min(le.x,Ie.x),Math.min(le.y,Ie.y)),xe=Pe.sub(Ne),je=(U.width-(H.left+H.right+w.padding.left+w.padding.right))/xe.x,Ke=(U.height-(H.top+H.bottom+w.padding.top+w.padding.bottom))/xe.y;if(!(Ke<0||je<0)){var vt=Math.min(U.scaleZoom(U.scale*Math.min(je,Ke)),w.maxZoom),Wt=typeof w.offset.x=="number"?new g.Point(w.offset.x,w.offset.y):g.Point.convert(w.offset),jt=new g.Point((w.padding.left-w.padding.right)/2,(w.padding.top-w.padding.bottom)/2).rotate(E*Math.PI/180),qt=Wt.add(jt).mult(U.scale/U.zoomScale(vt));return{center:U.unproject(oe.add(ue).div(2).sub(qt)),zoom:vt,bearing:E}}g.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},h.prototype.fitBounds=function(c,d,E){return this._fitInternal(this.cameraForBounds(c,d),d,E)},h.prototype.fitScreenCoordinates=function(c,d,E,w,P){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(g.Point.convert(c)),this.transform.pointLocation(g.Point.convert(d)),E,w),w,P)},h.prototype._fitInternal=function(c,d,E){return c?(delete(d=g.extend(c,d)).padding,d.linear?this.easeTo(d,E):this.flyTo(d,E)):this},h.prototype.jumpTo=function(c,d){this.stop();var E=this.transform,w=!1,P=!1,L=!1;return"zoom"in c&&E.zoom!==+c.zoom&&(w=!0,E.zoom=+c.zoom),c.center!==void 0&&(E.center=g.LngLat.convert(c.center)),"bearing"in c&&E.bearing!==+c.bearing&&(P=!0,E.bearing=+c.bearing),"pitch"in c&&E.pitch!==+c.pitch&&(L=!0,E.pitch=+c.pitch),c.padding==null||E.isPaddingEqual(c.padding)||(E.padding=c.padding),this.fire(new g.Event("movestart",d)).fire(new g.Event("move",d)),w&&this.fire(new g.Event("zoomstart",d)).fire(new g.Event("zoom",d)).fire(new g.Event("zoomend",d)),P&&this.fire(new g.Event("rotatestart",d)).fire(new g.Event("rotate",d)).fire(new g.Event("rotateend",d)),L&&this.fire(new g.Event("pitchstart",d)).fire(new g.Event("pitch",d)).fire(new g.Event("pitchend",d)),this.fire(new g.Event("moveend",d))},h.prototype.easeTo=function(c,d){var E=this;this._stop(!1,c.easeId),((c=g.extend({offset:[0,0],duration:500,easing:g.ease},c)).animate===!1||!c.essential&&g.browser.prefersReducedMotion)&&(c.duration=0);var w=this.transform,P=this.getZoom(),L=this.getBearing(),U=this.getPitch(),H=this.getPadding(),oe="zoom"in c?+c.zoom:P,ue="bearing"in c?this._normalizeBearing(c.bearing,L):L,le="pitch"in c?+c.pitch:U,Ie="padding"in c?c.padding:w.padding,Pe=g.Point.convert(c.offset),Ne=w.centerPoint.add(Pe),xe=w.pointLocation(Ne),je=g.LngLat.convert(c.center||xe);this._normalizeCenter(je);var Ke,vt,Wt=w.project(xe),jt=w.project(je).sub(Wt),qt=w.zoomScale(oe-P);c.around&&(Ke=g.LngLat.convert(c.around),vt=w.locationPoint(Ke));var pr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||oe!==P,this._rotating=this._rotating||L!==ue,this._pitching=this._pitching||le!==U,this._padding=!w.isPaddingEqual(Ie),this._easeId=c.easeId,this._prepareEase(d,c.noMoveStart,pr),this._ease(function(kr){if(E._zooming&&(w.zoom=g.number(P,oe,kr)),E._rotating&&(w.bearing=g.number(L,ue,kr)),E._pitching&&(w.pitch=g.number(U,le,kr)),E._padding&&(w.interpolatePadding(H,Ie,kr),Ne=w.centerPoint.add(Pe)),Ke)w.setLocationAtPoint(Ke,vt);else{var _r=w.zoomScale(w.zoom-P),sn=oe>P?Math.min(2,qt):Math.max(.5,qt),Zn=Math.pow(sn,1-kr),jn=w.unproject(Wt.add(jt.mult(kr*Zn)).mult(_r));w.setLocationAtPoint(w.renderWorldCopies?jn.wrap():jn,Ne)}E._fireMoveEvents(d)},function(kr){E._afterEase(d,kr)},c),this},h.prototype._prepareEase=function(c,d,E){E===void 0&&(E={}),this._moving=!0,d||E.moving||this.fire(new g.Event("movestart",c)),this._zooming&&!E.zooming&&this.fire(new g.Event("zoomstart",c)),this._rotating&&!E.rotating&&this.fire(new g.Event("rotatestart",c)),this._pitching&&!E.pitching&&this.fire(new g.Event("pitchstart",c))},h.prototype._fireMoveEvents=function(c){this.fire(new g.Event("move",c)),this._zooming&&this.fire(new g.Event("zoom",c)),this._rotating&&this.fire(new g.Event("rotate",c)),this._pitching&&this.fire(new g.Event("pitch",c))},h.prototype._afterEase=function(c,d){if(!this._easeId||!d||this._easeId!==d){delete this._easeId;var E=this._zooming,w=this._rotating,P=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,E&&this.fire(new g.Event("zoomend",c)),w&&this.fire(new g.Event("rotateend",c)),P&&this.fire(new g.Event("pitchend",c)),this.fire(new g.Event("moveend",c))}},h.prototype.flyTo=function(c,d){var E=this;if(!c.essential&&g.browser.prefersReducedMotion){var w=g.pick(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(w,d)}this.stop(),c=g.extend({offset:[0,0],speed:1.2,curve:1.42,easing:g.ease},c);var P=this.transform,L=this.getZoom(),U=this.getBearing(),H=this.getPitch(),oe=this.getPadding(),ue="zoom"in c?g.clamp(+c.zoom,P.minZoom,P.maxZoom):L,le="bearing"in c?this._normalizeBearing(c.bearing,U):U,Ie="pitch"in c?+c.pitch:H,Pe="padding"in c?c.padding:P.padding,Ne=P.zoomScale(ue-L),xe=g.Point.convert(c.offset),je=P.centerPoint.add(xe),Ke=P.pointLocation(je),vt=g.LngLat.convert(c.center||Ke);this._normalizeCenter(vt);var Wt=P.project(Ke),jt=P.project(vt).sub(Wt),qt=c.curve,pr=Math.max(P.width,P.height),kr=pr/Ne,_r=jt.mag();if("minZoom"in c){var sn=g.clamp(Math.min(c.minZoom,L,ue),P.minZoom,P.maxZoom),Zn=pr/P.zoomScale(sn-L);qt=Math.sqrt(Zn/_r*2)}var jn=qt*qt;function kn(Kn){var Xn=(kr*kr-pr*pr+(Kn?-1:1)*jn*jn*_r*_r)/(2*(Kn?kr:pr)*jn*_r);return Math.log(Math.sqrt(Xn*Xn+1)-Xn)}function ki(Kn){return(Math.exp(Kn)-Math.exp(-Kn))/2}function tn(Kn){return(Math.exp(Kn)+Math.exp(-Kn))/2}var ii=kn(0),li=function(Kn){return tn(ii)/tn(ii+qt*Kn)},$n=function(Kn){return pr*((tn(ii)*(ki(Xn=ii+qt*Kn)/tn(Xn))-ki(ii))/jn)/_r;var Xn},Hn=(kn(1)-ii)/qt;if(Math.abs(_r)<1e-6||!isFinite(Hn)){if(Math.abs(pr-kr)<1e-6)return this.easeTo(c,d);var di=kr<pr?-1:1;Hn=Math.abs(Math.log(kr/pr))/qt,$n=function(){return 0},li=function(Kn){return Math.exp(di*qt*Kn)}}return c.duration="duration"in c?+c.duration:1e3*Hn/("screenSpeed"in c?+c.screenSpeed/qt:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0),this._zooming=!0,this._rotating=U!==le,this._pitching=Ie!==H,this._padding=!P.isPaddingEqual(Pe),this._prepareEase(d,!1),this._ease(function(Kn){var Xn=Kn*Hn,yo=1/li(Xn);P.zoom=Kn===1?ue:L+P.scaleZoom(yo),E._rotating&&(P.bearing=g.number(U,le,Kn)),E._pitching&&(P.pitch=g.number(H,Ie,Kn)),E._padding&&(P.interpolatePadding(oe,Pe,Kn),je=P.centerPoint.add(xe));var Ja=Kn===1?vt:P.unproject(Wt.add(jt.mult($n(Xn))).mult(yo));P.setLocationAtPoint(P.renderWorldCopies?Ja.wrap():Ja,je),E._fireMoveEvents(d)},function(){return E._afterEase(d)},c),this},h.prototype.isEasing=function(){return!!this._easeFrameId},h.prototype.stop=function(){return this._stop()},h.prototype._stop=function(c,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var E=this._onEaseEnd;delete this._onEaseEnd,E.call(this,d)}if(!c){var w=this.handlers;w&&w.stop(!1)}return this},h.prototype._ease=function(c,d,E){E.animate===!1||E.duration===0?(c(1),d()):(this._easeStart=g.browser.now(),this._easeOptions=E,this._onEaseFrame=c,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},h.prototype._renderFrameCallback=function(){var c=Math.min((g.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},h.prototype._normalizeBearing=function(c,d){c=g.wrap(c,-180,180);var E=Math.abs(c-d);return Math.abs(c-360-d)<E&&(c-=360),Math.abs(c+360-d)<E&&(c+=360),c},h.prototype._normalizeCenter=function(c){var d=this.transform;if(d.renderWorldCopies&&!d.lngRange){var E=c.lng-d.center.lng;c.lng+=E>180?-360:E<-180?360:0}},h}(g.Evented),Qo=function(l){l===void 0&&(l={}),this.options=l,g.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};Qo.prototype.getDefaultPosition=function(){return"bottom-right"},Qo.prototype.onAdd=function(l){var h=this.options&&this.options.compact;return this._map=l,this._container=W.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=W.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=W.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),h===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},Qo.prototype.onRemove=function(){W.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},Qo.prototype._setElementTitle=function(l,h){var c=this._map._getUIString("AttributionControl."+h);l.title=c,l.setAttribute("aria-label",c)},Qo.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},Qo.prototype._updateEditLink=function(){var l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));var h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||g.config.ACCESS_TOKEN}];if(l){var c=h.reduce(function(d,E,w){return E.value&&(d+=E.key+"="+E.value+(w<h.length-1?"&":"")),d},"?");l.href=g.config.FEEDBACK_URL+"/"+c+(this._map._hash?this._map._hash.getHashString(!0):""),l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}},Qo.prototype._updateData=function(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},Qo.prototype._updateAttributions=function(){if(this._map.style){var l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(function(L){return typeof L!="string"?"":L})):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){var h=this._map.style.stylesheet;this.styleOwner=h.owner,this.styleId=h.id}var c=this._map.style.sourceCaches;for(var d in c){var E=c[d];if(E.used){var w=E.getSource();w.attribution&&l.indexOf(w.attribution)<0&&l.push(w.attribution)}}l.sort(function(L,U){return L.length-U.length});var P=(l=l.filter(function(L,U){for(var H=U+1;H<l.length;H++)if(l[H].indexOf(L)>=0)return!1;return!0})).join(" | ");P!==this._attribHTML&&(this._attribHTML=P,l.length?(this._innerContainer.innerHTML=P,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},Qo.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var eu=function(){g.bindAll(["_updateLogo"],this),g.bindAll(["_updateCompact"],this)};eu.prototype.onAdd=function(l){this._map=l,this._container=W.create("div","mapboxgl-ctrl");var h=W.create("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},eu.prototype.onRemove=function(){W.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},eu.prototype.getDefaultPosition=function(){return"bottom-left"},eu.prototype._updateLogo=function(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},eu.prototype._logoRequired=function(){if(this._map.style){var l=this._map.style.sourceCaches;for(var h in l)if(l[h].getSource().mapbox_logo)return!0;return!1}},eu.prototype._updateCompact=function(){var l=this._container.children;if(l.length){var h=l[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}};var Ho=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Ho.prototype.add=function(l){var h=++this._id;return this._queue.push({callback:l,id:h,cancelled:!1}),h},Ho.prototype.remove=function(l){for(var h=this._currentlyRunning,c=0,d=h?this._queue.concat(h):this._queue;c<d.length;c+=1){var E=d[c];if(E.id===l)return void(E.cancelled=!0)}},Ho.prototype.run=function(l){l===void 0&&(l=0);var h=this._currentlyRunning=this._queue;this._queue=[];for(var c=0,d=h;c<d.length;c+=1){var E=d[c];if(!E.cancelled&&(E.callback(l),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Ho.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var gu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},$f=g.window.HTMLImageElement,Wc=g.window.HTMLElement,ya=g.window.ImageBitmap,La={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},vl=function(l){function h(d){var E=this;if((d=g.extend({},La,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var w=new Yi(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies);if(l.call(this,w,d),this._interactive=d.interactive,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._crossSourceCollisions=d.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=d.collectResourceTiming,this._renderTaskQueue=new Ho,this._controls=[],this._mapId=g.uniqueId(),this._locale=g.extend({},gu,d.locale),this._clickTolerance=d.clickTolerance,this._requestManager=new g.RequestManager(d.transformRequest,d.accessToken),typeof d.container=="string"){if(this._container=g.window.document.getElementById(d.container),!this._container)throw new Error("Container '"+d.container+"' not found.")}else{if(!(d.container instanceof Wc))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(d.maxBounds&&this.setMaxBounds(d.maxBounds),g.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return E._update(!1)}),this.on("moveend",function(){return E._update(!1)}),this.on("zoom",function(){return E._update(!0)}),g.window!==void 0&&(g.window.addEventListener("online",this._onWindowOnline,!1),g.window.addEventListener("resize",this._onWindowResize,!1),g.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Cn(this,d),this._hash=d.hash&&new Ss(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,g.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localIdeographFontFamily:d.localIdeographFontFamily}),d.attributionControl&&this.addControl(new Qo({customAttribution:d.customAttribution})),this.addControl(new eu,d.logoPosition),this.on("style.load",function(){E.transform.unmodified&&E.jumpTo(E.style.stylesheet)}),this.on("data",function(P){E._update(P.dataType==="style"),E.fire(new g.Event(P.dataType+"data",P))}),this.on("dataloading",function(P){E.fire(new g.Event(P.dataType+"dataloading",P))})}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var c={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return h.prototype._getMapId=function(){return this._mapId},h.prototype.addControl=function(d,E){if(E===void 0&&(E=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new g.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var w=d.onAdd(this);this._controls.push(d);var P=this._controlPositions[E];return E.indexOf("bottom")!==-1?P.insertBefore(w,P.firstChild):P.appendChild(w),this},h.prototype.removeControl=function(d){if(!d||!d.onRemove)return this.fire(new g.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var E=this._controls.indexOf(d);return E>-1&&this._controls.splice(E,1),d.onRemove(this),this},h.prototype.hasControl=function(d){return this._controls.indexOf(d)>-1},h.prototype.resize=function(d){var E=this._containerDimensions(),w=E[0],P=E[1];if(w===this.transform.width&&P===this.transform.height)return this;this._resizeCanvas(w,P),this.transform.resize(w,P),this.painter.resize(w,P);var L=!this._moving;return L&&this.fire(new g.Event("movestart",d)).fire(new g.Event("move",d)),this.fire(new g.Event("resize",d)),L&&this.fire(new g.Event("moveend",d)),this},h.prototype.getBounds=function(){return this.transform.getBounds()},h.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},h.prototype.setMaxBounds=function(d){return this.transform.setMaxBounds(g.LngLatBounds.convert(d)),this._update()},h.prototype.setMinZoom=function(d){if((d=d==null?-2:d)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d&&this.setZoom(d),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},h.prototype.getMinZoom=function(){return this.transform.minZoom},h.prototype.setMaxZoom=function(d){if((d=d==null?22:d)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d&&this.setZoom(d),this;throw new Error("maxZoom must be greater than the current minZoom")},h.prototype.getMaxZoom=function(){return this.transform.maxZoom},h.prototype.setMinPitch=function(d){if((d=d==null?0:d)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d&&this.setPitch(d),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},h.prototype.getMinPitch=function(){return this.transform.minPitch},h.prototype.setMaxPitch=function(d){if((d=d==null?60:d)>60)throw new Error("maxPitch must be less than or equal to 60");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d&&this.setPitch(d),this;throw new Error("maxPitch must be greater than the current minPitch")},h.prototype.getMaxPitch=function(){return this.transform.maxPitch},h.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},h.prototype.setRenderWorldCopies=function(d){return this.transform.renderWorldCopies=d,this._update()},h.prototype.project=function(d){return this.transform.locationPoint(g.LngLat.convert(d))},h.prototype.unproject=function(d){return this.transform.pointLocation(g.Point.convert(d))},h.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},h.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},h.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},h.prototype._createDelegatedListener=function(d,E,w){var P,L=this;if(d==="mouseenter"||d==="mouseover"){var U=!1;return{layer:E,listener:w,delegates:{mousemove:function(oe){var ue=L.getLayer(E)?L.queryRenderedFeatures(oe.point,{layers:[E]}):[];ue.length?U||(U=!0,w.call(L,new mo(d,L,oe.originalEvent,{features:ue}))):U=!1},mouseout:function(){U=!1}}}}if(d==="mouseleave"||d==="mouseout"){var H=!1;return{layer:E,listener:w,delegates:{mousemove:function(oe){(L.getLayer(E)?L.queryRenderedFeatures(oe.point,{layers:[E]}):[]).length?H=!0:H&&(H=!1,w.call(L,new mo(d,L,oe.originalEvent)))},mouseout:function(oe){H&&(H=!1,w.call(L,new mo(d,L,oe.originalEvent)))}}}}return{layer:E,listener:w,delegates:(P={},P[d]=function(oe){var ue=L.getLayer(E)?L.queryRenderedFeatures(oe.point,{layers:[E]}):[];ue.length&&(oe.features=ue,w.call(L,oe),delete oe.features)},P)}},h.prototype.on=function(d,E,w){if(w===void 0)return l.prototype.on.call(this,d,E);var P=this._createDelegatedListener(d,E,w);for(var L in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(P),P.delegates)this.on(L,P.delegates[L]);return this},h.prototype.once=function(d,E,w){if(w===void 0)return l.prototype.once.call(this,d,E);var P=this._createDelegatedListener(d,E,w);for(var L in P.delegates)this.once(L,P.delegates[L]);return this},h.prototype.off=function(d,E,w){var P=this;return w===void 0?l.prototype.off.call(this,d,E):(this._delegatedListeners&&this._delegatedListeners[d]&&function(L){for(var U=L[d],H=0;H<U.length;H++){var oe=U[H];if(oe.layer===E&&oe.listener===w){for(var ue in oe.delegates)P.off(ue,oe.delegates[ue]);return U.splice(H,1),P}}}(this._delegatedListeners),this)},h.prototype.queryRenderedFeatures=function(d,E){if(!this.style)return[];var w;if(E!==void 0||d===void 0||d instanceof g.Point||Array.isArray(d)||(E=d,d=void 0),E=E||{},(d=d||[[0,0],[this.transform.width,this.transform.height]])instanceof g.Point||typeof d[0]=="number")w=[g.Point.convert(d)];else{var P=g.Point.convert(d[0]),L=g.Point.convert(d[1]);w=[P,new g.Point(L.x,P.y),L,new g.Point(P.x,L.y),P]}return this.style.queryRenderedFeatures(w,E,this.transform)},h.prototype.querySourceFeatures=function(d,E){return this.style.querySourceFeatures(d,E)},h.prototype.setStyle=function(d,E){return(E=g.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},E)).diff!==!1&&E.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&d?(this._diffStyle(d,E),this):(this._localIdeographFontFamily=E.localIdeographFontFamily,this._updateStyle(d,E))},h.prototype._getUIString=function(d){var E=this._locale[d];if(E==null)throw new Error("Missing UI string '"+d+"'");return E},h.prototype._updateStyle=function(d,E){return this.style&&(this.style.setEventedParent(null),this.style._remove()),d?(this.style=new bs(this,E||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d):this.style.loadJSON(d),this):(delete this.style,this)},h.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new bs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},h.prototype._diffStyle=function(d,E){var w=this;if(typeof d=="string"){var P=this._requestManager.normalizeStyleURL(d),L=this._requestManager.transformRequest(P,g.ResourceType.Style);g.getJSON(L,function(U,H){U?w.fire(new g.ErrorEvent(U)):H&&w._updateDiff(H,E)})}else typeof d=="object"&&this._updateDiff(d,E)},h.prototype._updateDiff=function(d,E){try{this.style.setState(d)&&this._update(!0)}catch(w){g.warnOnce("Unable to perform style diff: "+(w.message||w.error||w)+".  Rebuilding the style from scratch."),this._updateStyle(d,E)}},h.prototype.getStyle=function(){if(this.style)return this.style.serialize()},h.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():g.warnOnce("There is no style added to the map.")},h.prototype.addSource=function(d,E){return this._lazyInitEmptyStyle(),this.style.addSource(d,E),this._update(!0)},h.prototype.isSourceLoaded=function(d){var E=this.style&&this.style.sourceCaches[d];if(E!==void 0)return E.loaded();this.fire(new g.ErrorEvent(new Error("There is no source with ID '"+d+"'")))},h.prototype.areTilesLoaded=function(){var d=this.style&&this.style.sourceCaches;for(var E in d){var w=d[E]._tiles;for(var P in w){var L=w[P];if(L.state!=="loaded"&&L.state!=="errored")return!1}}return!0},h.prototype.addSourceType=function(d,E,w){return this._lazyInitEmptyStyle(),this.style.addSourceType(d,E,w)},h.prototype.removeSource=function(d){return this.style.removeSource(d),this._update(!0)},h.prototype.getSource=function(d){return this.style.getSource(d)},h.prototype.addImage=function(d,E,w){w===void 0&&(w={});var P=w.pixelRatio;P===void 0&&(P=1);var L=w.sdf;L===void 0&&(L=!1);var U=w.stretchX,H=w.stretchY,oe=w.content;if(this._lazyInitEmptyStyle(),E instanceof $f||ya&&E instanceof ya){var ue=g.browser.getImageData(E);this.style.addImage(d,{data:new g.RGBAImage({width:ue.width,height:ue.height},ue.data),pixelRatio:P,stretchX:U,stretchY:H,content:oe,sdf:L,version:0})}else{if(E.width===void 0||E.height===void 0)return this.fire(new g.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var le=E;this.style.addImage(d,{data:new g.RGBAImage({width:E.width,height:E.height},new Uint8Array(E.data)),pixelRatio:P,stretchX:U,stretchY:H,content:oe,sdf:L,version:0,userImage:le}),le.onAdd&&le.onAdd(this,d)}},h.prototype.updateImage=function(d,E){var w=this.style.getImage(d);if(!w)return this.fire(new g.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var P=E instanceof $f||ya&&E instanceof ya?g.browser.getImageData(E):E,L=P.width,U=P.height,H=P.data;return L===void 0||U===void 0?this.fire(new g.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):L!==w.data.width||U!==w.data.height?this.fire(new g.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(w.data.replace(H,!(E instanceof $f||ya&&E instanceof ya)),void this.style.updateImage(d,w))},h.prototype.hasImage=function(d){return d?!!this.style.getImage(d):(this.fire(new g.ErrorEvent(new Error("Missing required image id"))),!1)},h.prototype.removeImage=function(d){this.style.removeImage(d)},h.prototype.loadImage=function(d,E){g.getImage(this._requestManager.transformRequest(d,g.ResourceType.Image),E)},h.prototype.listImages=function(){return this.style.listImages()},h.prototype.addLayer=function(d,E){return this._lazyInitEmptyStyle(),this.style.addLayer(d,E),this._update(!0)},h.prototype.moveLayer=function(d,E){return this.style.moveLayer(d,E),this._update(!0)},h.prototype.removeLayer=function(d){return this.style.removeLayer(d),this._update(!0)},h.prototype.getLayer=function(d){return this.style.getLayer(d)},h.prototype.setLayerZoomRange=function(d,E,w){return this.style.setLayerZoomRange(d,E,w),this._update(!0)},h.prototype.setFilter=function(d,E,w){return w===void 0&&(w={}),this.style.setFilter(d,E,w),this._update(!0)},h.prototype.getFilter=function(d){return this.style.getFilter(d)},h.prototype.setPaintProperty=function(d,E,w,P){return P===void 0&&(P={}),this.style.setPaintProperty(d,E,w,P),this._update(!0)},h.prototype.getPaintProperty=function(d,E){return this.style.getPaintProperty(d,E)},h.prototype.setLayoutProperty=function(d,E,w,P){return P===void 0&&(P={}),this.style.setLayoutProperty(d,E,w,P),this._update(!0)},h.prototype.getLayoutProperty=function(d,E){return this.style.getLayoutProperty(d,E)},h.prototype.setLight=function(d,E){return E===void 0&&(E={}),this._lazyInitEmptyStyle(),this.style.setLight(d,E),this._update(!0)},h.prototype.getLight=function(){return this.style.getLight()},h.prototype.setFeatureState=function(d,E){return this.style.setFeatureState(d,E),this._update()},h.prototype.removeFeatureState=function(d,E){return this.style.removeFeatureState(d,E),this._update()},h.prototype.getFeatureState=function(d){return this.style.getFeatureState(d)},h.prototype.getContainer=function(){return this._container},h.prototype.getCanvasContainer=function(){return this._canvasContainer},h.prototype.getCanvas=function(){return this._canvas},h.prototype._containerDimensions=function(){var d=0,E=0;return this._container&&(d=this._container.clientWidth||400,E=this._container.clientHeight||300),[d,E]},h.prototype._detectMissingCSS=function(){g.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&g.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},h.prototype._setupContainer=function(){var d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=W.create("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();var E=this._canvasContainer=W.create("div","mapboxgl-canvas-container",d);this._interactive&&E.classList.add("mapboxgl-interactive"),this._canvas=W.create("canvas","mapboxgl-canvas",E),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var w=this._containerDimensions();this._resizeCanvas(w[0],w[1]);var P=this._controlContainer=W.create("div","mapboxgl-control-container",d),L=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(U){L[U]=W.create("div","mapboxgl-ctrl-"+U,P)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},h.prototype._resizeCanvas=function(d,E){var w=g.browser.devicePixelRatio||1;this._canvas.width=w*d,this._canvas.height=w*E,this._canvas.style.width=d+"px",this._canvas.style.height=E+"px"},h.prototype._setupPainter=function(){var d=g.extend({},Re.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),E=this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);E?(this.painter=new Qi(E,this.transform),g.webpSupported.testSupport(E)):this.fire(new g.ErrorEvent(new Error("Failed to initialize WebGL")))},h.prototype._contextLost=function(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new g.Event("webglcontextlost",{originalEvent:d}))},h.prototype._contextRestored=function(d){this._setupPainter(),this.resize(),this._update(),this.fire(new g.Event("webglcontextrestored",{originalEvent:d}))},h.prototype._onMapScroll=function(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},h.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},h.prototype._update=function(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this},h.prototype._requestRenderFrame=function(d){return this._update(),this._renderTaskQueue.add(d)},h.prototype._cancelRenderFrame=function(d){this._renderTaskQueue.remove(d)},h.prototype._render=function(d){var E,w=this,P=0,L=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(E=L.createQueryEXT(),L.beginQueryEXT(L.TIME_ELAPSED_EXT,E),P=g.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),!this._removed){var U=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var H=this.transform.zoom,oe=g.browser.now();this.style.zoomHistory.update(H,oe);var ue=new g.EvaluationParameters(H,{now:oe,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),le=ue.crossFadingFactor();le===1&&le===this._crossFadingFactor||(U=!0,this._crossFadingFactor=le),this.style.update(ue)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new g.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new g.Event("load"))),this.style&&(this.style.hasTransitions()||U)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Ie=g.browser.now()-P;L.endQueryEXT(L.TIME_ELAPSED_EXT,E),setTimeout(function(){var xe=L.getQueryObjectEXT(E,L.QUERY_RESULT_EXT)/1e6;L.deleteQueryEXT(E),w.fire(new g.Event("gpu-timing-frame",{cpuTime:Ie,gpuTime:xe}))},50)}if(this.listens("gpu-timing-layer")){var Pe=this.painter.collectGpuTimers();setTimeout(function(){var xe=w.painter.queryGpuTimers(Pe);w.fire(new g.Event("gpu-timing-layer",{layerTimes:xe}))},50)}var Ne=this._sourcesDirty||this._styleDirty||this._placementDirty;return Ne||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new g.Event("idle")),!this._loaded||this._fullyLoaded||Ne||(this._fullyLoaded=!0),this}},h.prototype.remove=function(){this._hash&&this._hash.remove();for(var d=0,E=this._controls;d<E.length;d+=1)E[d].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),g.window!==void 0&&(g.window.removeEventListener("resize",this._onWindowResize,!1),g.window.removeEventListener("orientationchange",this._onWindowResize,!1),g.window.removeEventListener("online",this._onWindowOnline,!1));var w=this.painter.context.gl.getExtension("WEBGL_lose_context");w&&w.loseContext(),dc(this._canvasContainer),dc(this._controlContainer),dc(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new g.Event("remove"))},h.prototype.triggerRepaint=function(){var d=this;this.style&&!this._frame&&(this._frame=g.browser.frame(function(E){d._frame=null,d._render(E)}))},h.prototype._onWindowOnline=function(){this._update()},h.prototype._onWindowResize=function(d){this._trackResize&&this.resize({originalEvent:d})._update()},c.showTileBoundaries.get=function(){return!!this._showTileBoundaries},c.showTileBoundaries.set=function(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())},c.showPadding.get=function(){return!!this._showPadding},c.showPadding.set=function(d){this._showPadding!==d&&(this._showPadding=d,this._update())},c.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},c.showCollisionBoxes.set=function(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())},c.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},c.showOverdrawInspector.set=function(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())},c.repaint.get=function(){return!!this._repaint},c.repaint.set=function(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())},c.vertices.get=function(){return!!this._vertices},c.vertices.set=function(d){this._vertices=d,this._update()},h.prototype._setCacheLimits=function(d,E){g.setCacheLimits(d,E)},c.version.get=function(){return g.version},Object.defineProperties(h.prototype,c),h}(Hc);function dc(l){l.parentNode&&l.parentNode.removeChild(l)}var Ns={showCompass:!0,showZoom:!0,visualizePitch:!1},yu=function(l){var h=this;this.options=g.extend({},Ns,l),this._container=W.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(c){return c.preventDefault()}),this.options.showZoom&&(g.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(c){return h._map.zoomIn({},{originalEvent:c})}),W.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(c){return h._map.zoomOut({},{originalEvent:c})}),W.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(g.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(c){h.options.visualizePitch?h._map.resetNorthPitch({},{originalEvent:c}):h._map.resetNorth({},{originalEvent:c})}),this._compassIcon=W.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};yu.prototype._updateZoomButtons=function(){var l=this._map.getZoom(),h=l===this._map.getMaxZoom(),c=l===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},yu.prototype._rotateCompassArrow=function(){var l=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=l},yu.prototype.onAdd=function(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new pi(this._map,this._compass,this.options.visualizePitch)),this._container},yu.prototype.onRemove=function(){W.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},yu.prototype._createButton=function(l,h){var c=W.create("button",l,this._container);return c.type="button",c.addEventListener("click",h),c},yu.prototype._setButtonTitle=function(l,h){var c=this._map._getUIString("NavigationControl."+h);l.title=c,l.setAttribute("aria-label",c)};var pi=function(l,h,c){c===void 0&&(c=!1),this._clickTolerance=10,this.element=h,this.mouseRotate=new wf({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,c&&(this.mousePitch=new hl({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),g.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),W.addEventListener(h,"mousedown",this.mousedown),W.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),W.addEventListener(h,"touchmove",this.touchmove),W.addEventListener(h,"touchend",this.touchend),W.addEventListener(h,"touchcancel",this.reset)};function zs(l,h,c){if(l=new g.LngLat(l.lng,l.lat),h){var d=new g.LngLat(l.lng-360,l.lat),E=new g.LngLat(l.lng+360,l.lat),w=c.locationPoint(l).distSqr(h);c.locationPoint(d).distSqr(h)<w?l=d:c.locationPoint(E).distSqr(h)<w&&(l=E)}for(;Math.abs(l.lng-c.center.lng)>180;){var P=c.locationPoint(l);if(P.x>=0&&P.y>=0&&P.x<=c.width&&P.y<=c.height)break;l.lng>c.center.lng?l.lng-=360:l.lng+=360}return l}pi.prototype.down=function(l,h){this.mouseRotate.mousedown(l,h),this.mousePitch&&this.mousePitch.mousedown(l,h),W.disableDrag()},pi.prototype.move=function(l,h){var c=this.map,d=this.mouseRotate.mousemoveWindow(l,h);if(d&&d.bearingDelta&&c.setBearing(c.getBearing()+d.bearingDelta),this.mousePitch){var E=this.mousePitch.mousemoveWindow(l,h);E&&E.pitchDelta&&c.setPitch(c.getPitch()+E.pitchDelta)}},pi.prototype.off=function(){var l=this.element;W.removeEventListener(l,"mousedown",this.mousedown),W.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),W.removeEventListener(l,"touchmove",this.touchmove),W.removeEventListener(l,"touchend",this.touchend),W.removeEventListener(l,"touchcancel",this.reset),this.offTemp()},pi.prototype.offTemp=function(){W.enableDrag(),W.removeEventListener(g.window,"mousemove",this.mousemove),W.removeEventListener(g.window,"mouseup",this.mouseup)},pi.prototype.mousedown=function(l){this.down(g.extend({},l,{ctrlKey:!0,preventDefault:function(){return l.preventDefault()}}),W.mousePos(this.element,l)),W.addEventListener(g.window,"mousemove",this.mousemove),W.addEventListener(g.window,"mouseup",this.mouseup)},pi.prototype.mousemove=function(l){this.move(l,W.mousePos(this.element,l))},pi.prototype.mouseup=function(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()},pi.prototype.touchstart=function(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=W.touchPos(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return l.preventDefault()}},this._startPos))},pi.prototype.touchmove=function(l){l.targetTouches.length!==1?this.reset():(this._lastPos=W.touchPos(this.element,l.targetTouches)[0],this.move({preventDefault:function(){return l.preventDefault()}},this._lastPos))},pi.prototype.touchend=function(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},pi.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var os={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function jl(l,h,c){var d=l.classList;for(var E in os)d.remove("mapboxgl-"+c+"-anchor-"+E);d.add("mapboxgl-"+c+"-anchor-"+h)}var Fu,el=function(l){function h(c,d){if(l.call(this),(c instanceof g.window.HTMLElement||d)&&(c=g.extend({element:c},d)),g.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment!=="auto"?c.pitchAlignment:this._rotationAlignment,c&&c.element)this._element=c.element,this._offset=g.Point.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=W.create("div"),this._element.setAttribute("aria-label","Map marker");var E=W.createNS("http://www.w3.org/2000/svg","svg");E.setAttributeNS(null,"display","block"),E.setAttributeNS(null,"height","41px"),E.setAttributeNS(null,"width","27px"),E.setAttributeNS(null,"viewBox","0 0 27 41");var w=W.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"stroke","none"),w.setAttributeNS(null,"stroke-width","1"),w.setAttributeNS(null,"fill","none"),w.setAttributeNS(null,"fill-rule","evenodd");var P=W.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill-rule","nonzero");var L=W.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"transform","translate(3.0, 29.0)"),L.setAttributeNS(null,"fill","#000000");for(var U=0,H=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];U<H.length;U+=1){var oe=H[U],ue=W.createNS("http://www.w3.org/2000/svg","ellipse");ue.setAttributeNS(null,"opacity","0.04"),ue.setAttributeNS(null,"cx","10.5"),ue.setAttributeNS(null,"cy","5.80029008"),ue.setAttributeNS(null,"rx",oe.rx),ue.setAttributeNS(null,"ry",oe.ry),L.appendChild(ue)}var le=W.createNS("http://www.w3.org/2000/svg","g");le.setAttributeNS(null,"fill",this._color);var Ie=W.createNS("http://www.w3.org/2000/svg","path");Ie.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),le.appendChild(Ie);var Pe=W.createNS("http://www.w3.org/2000/svg","g");Pe.setAttributeNS(null,"opacity","0.25"),Pe.setAttributeNS(null,"fill","#000000");var Ne=W.createNS("http://www.w3.org/2000/svg","path");Ne.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Pe.appendChild(Ne);var xe=W.createNS("http://www.w3.org/2000/svg","g");xe.setAttributeNS(null,"transform","translate(6.0, 7.0)"),xe.setAttributeNS(null,"fill","#FFFFFF");var je=W.createNS("http://www.w3.org/2000/svg","g");je.setAttributeNS(null,"transform","translate(8.0, 8.0)");var Ke=W.createNS("http://www.w3.org/2000/svg","circle");Ke.setAttributeNS(null,"fill","#000000"),Ke.setAttributeNS(null,"opacity","0.25"),Ke.setAttributeNS(null,"cx","5.5"),Ke.setAttributeNS(null,"cy","5.5"),Ke.setAttributeNS(null,"r","5.4999962");var vt=W.createNS("http://www.w3.org/2000/svg","circle");vt.setAttributeNS(null,"fill","#FFFFFF"),vt.setAttributeNS(null,"cx","5.5"),vt.setAttributeNS(null,"cy","5.5"),vt.setAttributeNS(null,"r","5.4999962"),je.appendChild(Ke),je.appendChild(vt),P.appendChild(L),P.appendChild(le),P.appendChild(Pe),P.appendChild(xe),P.appendChild(je),E.appendChild(P),E.setAttributeNS(null,"height",41*this._scale+"px"),E.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(E),this._offset=g.Point.convert(c&&c.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(Wt){Wt.preventDefault()}),this._element.addEventListener("mousedown",function(Wt){Wt.preventDefault()}),jl(this._element,this._anchor,"marker"),this._popup=null}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.addTo=function(c){return this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._update),c.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},h.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),W.remove(this._element),this._popup&&this._popup.remove(),this},h.prototype.getLngLat=function(){return this._lngLat},h.prototype.setLngLat=function(c){return this._lngLat=g.LngLat.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},h.prototype.getElement=function(){return this._element},h.prototype.setPopup=function(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){var d=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(24.6+d)],"bottom-right":[-d,-1*(24.6+d)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=c,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},h.prototype._onKeyPress=function(c){var d=c.code,E=c.charCode||c.keyCode;d!=="Space"&&d!=="Enter"&&E!==32&&E!==13||this.togglePopup()},h.prototype._onMapClick=function(c){var d=c.originalEvent.target,E=this._element;this._popup&&(d===E||E.contains(d))&&this.togglePopup()},h.prototype.getPopup=function(){return this._popup},h.prototype.togglePopup=function(){var c=this._popup;return c?(c.isOpen()?c.remove():c.addTo(this._map),this):this},h.prototype._update=function(c){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=zs(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(d="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var E="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?E="rotateX(0deg)":this._pitchAlignment==="map"&&(E="rotateX("+this._map.getPitch()+"deg)"),c&&c.type!=="moveend"||(this._pos=this._pos.round()),W.setTransform(this._element,os[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+E+" "+d)}},h.prototype.getOffset=function(){return this._offset},h.prototype.setOffset=function(c){return this._offset=g.Point.convert(c),this._update(),this},h.prototype._onMove=function(c){if(!this._isDragging){var d=this._clickTolerance||this._map._clickTolerance;this._isDragging=c.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=c.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new g.Event("dragstart"))),this.fire(new g.Event("drag")))},h.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new g.Event("dragend")),this._state="inactive"},h.prototype._addDragHandler=function(c){this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(this._pos).add(this._offset),this._pointerdownPos=c.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},h.prototype.setDraggable=function(c){return this._draggable=!!c,this._map&&(c?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},h.prototype.isDraggable=function(){return this._draggable},h.prototype.setRotation=function(c){return this._rotation=c||0,this._update(),this},h.prototype.getRotation=function(){return this._rotation},h.prototype.setRotationAlignment=function(c){return this._rotationAlignment=c||"auto",this._update(),this},h.prototype.getRotationAlignment=function(){return this._rotationAlignment},h.prototype.setPitchAlignment=function(c){return this._pitchAlignment=c&&c!=="auto"?c:this._rotationAlignment,this._update(),this},h.prototype.getPitchAlignment=function(){return this._pitchAlignment},h}(g.Evented),Xc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Da=0,tu=!1,Vl=function(l){function h(c){l.call(this),this.options=g.extend({},Xc,c),g.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.onAdd=function(c){var d;return this._map=c,this._container=W.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),d=this._setupUI,Fu!==void 0?d(Fu):g.window.navigator.permissions!==void 0?g.window.navigator.permissions.query({name:"geolocation"}).then(function(E){d(Fu=E.state!=="denied")}):d(Fu=!!g.window.navigator.geolocation),this._container},h.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(g.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),W.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Da=0,tu=!1},h.prototype._isOutOfMapMaxBounds=function(c){var d=this._map.getMaxBounds(),E=c.coords;return d&&(E.longitude<d.getWest()||E.longitude>d.getEast()||E.latitude<d.getSouth()||E.latitude>d.getNorth())},h.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},h.prototype._onSuccess=function(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new g.Event("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new g.Event("geolocate",c)),this._finish()}},h.prototype._updateCamera=function(c){var d=new g.LngLat(c.coords.longitude,c.coords.latitude),E=c.coords.accuracy,w=this._map.getBearing(),P=g.extend({bearing:w},this.options.fitBoundsOptions);this._map.fitBounds(d.toBounds(E),P,{geolocateSource:!0})},h.prototype._updateMarker=function(c){if(c){var d=new g.LngLat(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},h.prototype._updateCircleRadius=function(){var c=this._map._container.clientHeight/2,d=this._map.unproject([0,c]),E=this._map.unproject([1,c]),w=d.distanceTo(E),P=Math.ceil(2*this._accuracy/w);this._circleElement.style.width=P+"px",this._circleElement.style.height=P+"px"},h.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},h.prototype._onError=function(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&tu)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new g.Event("error",c)),this._finish()}},h.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},h.prototype._setupUI=function(c){var d=this;if(this._container.addEventListener("contextmenu",function(P){return P.preventDefault()}),this._geolocateButton=W.create("button","mapboxgl-ctrl-geolocate",this._container),W.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",c===!1){g.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var E=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=E,this._geolocateButton.setAttribute("aria-label",E)}else{var w=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=w,this._geolocateButton.setAttribute("aria-label",w)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=W.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new el(this._dotElement),this._circleElement=W.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new el({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(P){P.geolocateSource||d._watchState!=="ACTIVE_LOCK"||P.originalEvent&&P.originalEvent.type==="resize"||(d._watchState="BACKGROUND",d._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),d._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),d.fire(new g.Event("trackuserlocationend")))})},h.prototype.trigger=function(){if(!this._setup)return g.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new g.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Da--,tu=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new g.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new g.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++Da>1?(c={maximumAge:6e5,timeout:0},tu=!0):(c=this.options.positionOptions,tu=!1),this._geolocationWatchID=g.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,c)}}else g.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},h.prototype._clearWatch=function(){g.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},h}(g.Evented),ml={maxWidth:100,unit:"metric"},gl=function(l){this.options=g.extend({},ml,l),g.bindAll(["_onMove","setUnit"],this)};function Yc(l,h,c){var d=c&&c.maxWidth||100,E=l._container.clientHeight/2,w=l.unproject([0,E]),P=l.unproject([d,E]),L=w.distanceTo(P);if(c&&c.unit==="imperial"){var U=3.2808*L;U>5280?yl(h,d,U/5280,l._getUIString("ScaleControl.Miles")):yl(h,d,U,l._getUIString("ScaleControl.Feet"))}else c&&c.unit==="nautical"?yl(h,d,L/1852,l._getUIString("ScaleControl.NauticalMiles")):L>=1e3?yl(h,d,L/1e3,l._getUIString("ScaleControl.Kilometers")):yl(h,d,L,l._getUIString("ScaleControl.Meters"))}function yl(l,h,c,d){var E,w,P,L=(E=c,(w=Math.pow(10,(""+Math.floor(E)).length-1))*(P=(P=E/w)>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(U){var H=Math.pow(10,Math.ceil(-Math.log(U)/Math.LN10));return Math.round(U*H)/H}(P)));l.style.width=h*(L/c)+"px",l.innerHTML=L+"&nbsp;"+d}gl.prototype.getDefaultPosition=function(){return"bottom-left"},gl.prototype._onMove=function(){Yc(this._map,this._container,this.options)},gl.prototype.onAdd=function(l){return this._map=l,this._container=W.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},gl.prototype.onRemove=function(){W.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},gl.prototype.setUnit=function(l){this.options.unit=l,Yc(this._map,this._container,this.options)};var ru=function(l){this._fullscreen=!1,l&&l.container&&(l.container instanceof g.window.HTMLElement?this._container=l.container:g.warnOnce("Full screen control 'container' must be a DOM element.")),g.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in g.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in g.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in g.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in g.window.document&&(this._fullscreenchange="MSFullscreenChange")};ru.prototype.onAdd=function(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=W.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",g.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},ru.prototype.onRemove=function(){W.remove(this._controlContainer),this._map=null,g.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},ru.prototype._checkFullscreenSupport=function(){return!!(g.window.document.fullscreenEnabled||g.window.document.mozFullScreenEnabled||g.window.document.msFullscreenEnabled||g.window.document.webkitFullscreenEnabled)},ru.prototype._setupUI=function(){var l=this._fullscreenButton=W.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);W.create("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden",!0),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),g.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},ru.prototype._updateTitle=function(){var l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.title=l},ru.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},ru.prototype._isFullscreen=function(){return this._fullscreen},ru.prototype._changeIcon=function(){(g.window.document.fullscreenElement||g.window.document.mozFullScreenElement||g.window.document.webkitFullscreenElement||g.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},ru.prototype._onClickFullscreen=function(){this._isFullscreen()?g.window.document.exitFullscreen?g.window.document.exitFullscreen():g.window.document.mozCancelFullScreen?g.window.document.mozCancelFullScreen():g.window.document.msExitFullscreen?g.window.document.msExitFullscreen():g.window.document.webkitCancelFullScreen&&g.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var vc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Gl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Qf=function(l){function h(c){l.call(this),this.options=g.extend(Object.create(vc),c),g.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.addTo=function(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new g.Event("open")),this},h.prototype.isOpen=function(){return!!this._map},h.prototype.remove=function(){return this._content&&W.remove(this._content),this._container&&(W.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new g.Event("close")),this},h.prototype.getLngLat=function(){return this._lngLat},h.prototype.setLngLat=function(c){return this._lngLat=g.LngLat.convert(c),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},h.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},h.prototype.getElement=function(){return this._container},h.prototype.setText=function(c){return this.setDOMContent(g.window.document.createTextNode(c))},h.prototype.setHTML=function(c){var d,E=g.window.document.createDocumentFragment(),w=g.window.document.createElement("body");for(w.innerHTML=c;d=w.firstChild;)E.appendChild(d);return this.setDOMContent(E)},h.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},h.prototype.setMaxWidth=function(c){return this.options.maxWidth=c,this._update(),this},h.prototype.setDOMContent=function(c){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=W.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(c),this._createCloseButton(),this._update(),this._focusFirstElement(),this},h.prototype.addClassName=function(c){this._container&&this._container.classList.add(c)},h.prototype.removeClassName=function(c){this._container&&this._container.classList.remove(c)},h.prototype.setOffset=function(c){return this.options.offset=c,this._update(),this},h.prototype.toggleClassName=function(c){if(this._container)return this._container.classList.toggle(c)},h.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=W.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},h.prototype._onMouseUp=function(c){this._update(c.point)},h.prototype._onMouseMove=function(c){this._update(c.point)},h.prototype._onDrag=function(c){this._update(c.point)},h.prototype._update=function(c){var d=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=W.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=W.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(ue){return d._container.classList.add(ue)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=zs(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||c)){var E=this._pos=this._trackPointer&&c?c:this._map.project(this._lngLat),w=this.options.anchor,P=function ue(le){if(le){if(typeof le=="number"){var Ie=Math.round(Math.sqrt(.5*Math.pow(le,2)));return{center:new g.Point(0,0),top:new g.Point(0,le),"top-left":new g.Point(Ie,Ie),"top-right":new g.Point(-Ie,Ie),bottom:new g.Point(0,-le),"bottom-left":new g.Point(Ie,-Ie),"bottom-right":new g.Point(-Ie,-Ie),left:new g.Point(le,0),right:new g.Point(-le,0)}}if(le instanceof g.Point||Array.isArray(le)){var Pe=g.Point.convert(le);return{center:Pe,top:Pe,"top-left":Pe,"top-right":Pe,bottom:Pe,"bottom-left":Pe,"bottom-right":Pe,left:Pe,right:Pe}}return{center:g.Point.convert(le.center||[0,0]),top:g.Point.convert(le.top||[0,0]),"top-left":g.Point.convert(le["top-left"]||[0,0]),"top-right":g.Point.convert(le["top-right"]||[0,0]),bottom:g.Point.convert(le.bottom||[0,0]),"bottom-left":g.Point.convert(le["bottom-left"]||[0,0]),"bottom-right":g.Point.convert(le["bottom-right"]||[0,0]),left:g.Point.convert(le.left||[0,0]),right:g.Point.convert(le.right||[0,0])}}return ue(new g.Point(0,0))}(this.options.offset);if(!w){var L,U=this._container.offsetWidth,H=this._container.offsetHeight;L=E.y+P.bottom.y<H?["top"]:E.y>this._map.transform.height-H?["bottom"]:[],E.x<U/2?L.push("left"):E.x>this._map.transform.width-U/2&&L.push("right"),w=L.length===0?"bottom":L.join("-")}var oe=E.add(P[w]).round();W.setTransform(this._container,os[w]+" translate("+oe.x+"px,"+oe.y+"px)"),jl(this._container,w,"popup")}},h.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var c=this._container.querySelector(Gl);c&&c.focus()}},h.prototype._onClose=function(){this.remove()},h}(g.Evented),Hl={version:g.version,supported:Re,setRTLTextPlugin:g.setRTLTextPlugin,getRTLTextPluginStatus:g.getRTLTextPluginStatus,Map:vl,NavigationControl:yu,GeolocateControl:Vl,AttributionControl:Qo,ScaleControl:gl,FullscreenControl:ru,Popup:Qf,Marker:el,Style:bs,LngLat:g.LngLat,LngLatBounds:g.LngLatBounds,Point:g.Point,MercatorCoordinate:g.MercatorCoordinate,Evented:g.Evented,config:g.config,prewarm:function(){Mt().acquire(Bt)},clearPrewarmedResources:function(){var l=_n;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(Bt),_n=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return g.config.ACCESS_TOKEN},set accessToken(l){g.config.ACCESS_TOKEN=l},get baseApiUrl(){return g.config.API_URL},set baseApiUrl(l){g.config.API_URL=l},get workerCount(){return hr.workerCount},set workerCount(l){hr.workerCount=l},get maxParallelImageRequests(){return g.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){g.config.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage:function(l){g.clearTileCache(l)},workerUrl:""};return Hl}),Ce})},28660:function(Er,ne,Q){var Ce=Q(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var me;(function(g){(function(Re){var W=typeof Q.g=="object"?Q.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),he=de(g);typeof W.Reflect=="undefined"?W.Reflect=g:he=de(W.Reflect,he),Re(he);function de(ze,_e){return function(tt,mt){typeof ze[tt]!="function"&&Object.defineProperty(ze,tt,{configurable:!0,writable:!0,value:mt}),_e&&_e(tt,mt)}}})(function(Re){var W=Object.prototype.hasOwnProperty,he=typeof Symbol=="function",de=he&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",ze=he&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",_e=typeof Object.create=="function",tt={__proto__:[]}instanceof Array,mt=!_e&&!tt,wt={create:_e?function(){return cu(Object.create(null))}:tt?function(){return cu({__proto__:null})}:function(){return cu({})},has:mt?function(Zt,er){return W.call(Zt,er)}:function(Zt,er){return er in Zt},get:mt?function(Zt,er){return W.call(Zt,er)?Zt[er]:void 0}:function(Zt,er){return Zt[er]}},Nt=Object.getPrototypeOf(Function),or=typeof Ce=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",Tt=!or&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:fe(),Kt=!or&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:ui(),_t=!or&&typeof WeakMap=="function"?WeakMap:bo(),ct=new _t;function it(Zt,er,Rr,an){if(Gr(Rr)){if(!Ii(Zt))throw new TypeError;if(!ia(er))throw new TypeError;return Fr(Zt,er)}else{if(!Ii(Zt))throw new TypeError;if(!zn(er))throw new TypeError;if(!zn(an)&&!Gr(an)&&!Nn(an))throw new TypeError;return Nn(an)&&(an=void 0),Rr=Ui(Rr),Yr(Zt,er,Rr,an)}}Re("decorate",it);function $t(Zt,er){function Rr(an,Mn){if(!zn(an))throw new TypeError;if(!Gr(Mn)&&!qa(Mn))throw new TypeError;kt(Zt,er,an,Mn)}return Rr}Re("metadata",$t);function Y(Zt,er,Rr,an){if(!zn(Rr))throw new TypeError;return Gr(an)||(an=Ui(an)),kt(Zt,er,Rr,an)}Re("defineMetadata",Y);function Xt(Zt,er,Rr){if(!zn(er))throw new TypeError;return Gr(Rr)||(Rr=Ui(Rr)),Se(Zt,er,Rr)}Re("hasMetadata",Xt);function at(Zt,er,Rr){if(!zn(er))throw new TypeError;return Gr(Rr)||(Rr=Ui(Rr)),ke(Zt,er,Rr)}Re("hasOwnMetadata",at);function qe(Zt,er,Rr){if(!zn(er))throw new TypeError;return Gr(Rr)||(Rr=Ui(Rr)),ut(Zt,er,Rr)}Re("getMetadata",qe);function Et(Zt,er,Rr){if(!zn(er))throw new TypeError;return Gr(Rr)||(Rr=Ui(Rr)),ft(Zt,er,Rr)}Re("getOwnMetadata",Et);function $e(Zt,er){if(!zn(Zt))throw new TypeError;return Gr(er)||(er=Ui(er)),Ft(Zt,er)}Re("getMetadataKeys",$e);function Ht(Zt,er){if(!zn(Zt))throw new TypeError;return Gr(er)||(er=Ui(er)),yr(Zt,er)}Re("getOwnMetadataKeys",Ht);function mr(Zt,er,Rr){if(!zn(er))throw new TypeError;Gr(Rr)||(Rr=Ui(Rr));var an=S(er,Rr,!1);if(Gr(an)||!an.delete(Zt))return!1;if(an.size>0)return!0;var Mn=ct.get(er);return Mn.delete(Rr),Mn.size>0||ct.delete(er),!0}Re("deleteMetadata",mr);function Fr(Zt,er){for(var Rr=Zt.length-1;Rr>=0;--Rr){var an=Zt[Rr],Mn=an(er);if(!Gr(Mn)&&!Nn(Mn)){if(!ia(Mn))throw new TypeError;er=Mn}}return er}function Yr(Zt,er,Rr,an){for(var Mn=Zt.length-1;Mn>=0;--Mn){var Un=Zt[Mn],bi=Un(er,Rr,an);if(!Gr(bi)&&!Nn(bi)){if(!zn(bi))throw new TypeError;an=bi}}return an}function S(Zt,er,Rr){var an=ct.get(Zt);if(Gr(an)){if(!Rr)return;an=new Tt,ct.set(Zt,an)}var Mn=an.get(er);if(Gr(Mn)){if(!Rr)return;Mn=new Tt,an.set(er,Mn)}return Mn}function Se(Zt,er,Rr){var an=ke(Zt,er,Rr);if(an)return!0;var Mn=Ts(er);return Nn(Mn)?!1:Se(Zt,Mn,Rr)}function ke(Zt,er,Rr){var an=S(er,Rr,!1);return Gr(an)?!1:fi(an.has(Zt))}function ut(Zt,er,Rr){var an=ke(Zt,er,Rr);if(an)return ft(Zt,er,Rr);var Mn=Ts(er);if(!Nn(Mn))return ut(Zt,Mn,Rr)}function ft(Zt,er,Rr){var an=S(er,Rr,!1);if(!Gr(an))return an.get(Zt)}function kt(Zt,er,Rr,an){var Mn=S(Rr,an,!0);Mn.set(Zt,er)}function Ft(Zt,er){var Rr=yr(Zt,er),an=Ts(Zt);if(an===null)return Rr;var Mn=Ft(an,er);if(Mn.length<=0)return Rr;if(Rr.length<=0)return Mn;for(var Un=new Kt,bi=[],vi=0,Sn=Rr;vi<Sn.length;vi++){var Di=Sn[vi],Ri=Un.has(Di);Ri||(Un.add(Di),bi.push(Di))}for(var ao=0,gs=Mn;ao<gs.length;ao++){var Di=gs[ao],Ri=Un.has(Di);Ri||(Un.add(Di),bi.push(Di))}return bi}function yr(Zt,er){var Rr=[],an=S(Zt,er,!1);if(Gr(an))return Rr;for(var Mn=an.keys(),Un=oa(Mn),bi=0;;){var vi=Ki(Un);if(!vi)return Rr.length=bi,Rr;var Sn=Li(vi);try{Rr[bi]=Sn}catch(Di){try{Hi(Un)}finally{throw Di}}bi++}}function Yn(Zt){if(Zt===null)return 1;switch(typeof Zt){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Zt===null?1:6;default:return 6}}function Gr(Zt){return Zt===void 0}function Nn(Zt){return Zt===null}function yn(Zt){return typeof Zt=="symbol"}function zn(Zt){return typeof Zt=="object"?Zt!==null:typeof Zt=="function"}function si(Zt,er){switch(Yn(Zt)){case 0:return Zt;case 1:return Zt;case 2:return Zt;case 3:return Zt;case 4:return Zt;case 5:return Zt}var Rr=er===3?"string":er===5?"number":"default",an=aa(Zt,de);if(an!==void 0){var Mn=an.call(Zt,Rr);if(zn(Mn))throw new TypeError;return Mn}return Gn(Zt,Rr==="default"?"number":Rr)}function Gn(Zt,er){if(er==="string"){var Rr=Zt.toString;if($i(Rr)){var an=Rr.call(Zt);if(!zn(an))return an}var Mn=Zt.valueOf;if($i(Mn)){var an=Mn.call(Zt);if(!zn(an))return an}}else{var Mn=Zt.valueOf;if($i(Mn)){var an=Mn.call(Zt);if(!zn(an))return an}var Un=Zt.toString;if($i(Un)){var an=Un.call(Zt);if(!zn(an))return an}}throw new TypeError}function fi(Zt){return!!Zt}function na(Zt){return""+Zt}function Ui(Zt){var er=si(Zt,3);return yn(er)?er:na(er)}function Ii(Zt){return Array.isArray?Array.isArray(Zt):Zt instanceof Object?Zt instanceof Array:Object.prototype.toString.call(Zt)==="[object Array]"}function $i(Zt){return typeof Zt=="function"}function ia(Zt){return typeof Zt=="function"}function qa(Zt){switch(Yn(Zt)){case 3:return!0;case 4:return!0;default:return!1}}function aa(Zt,er){var Rr=Zt[er];if(Rr!=null){if(!$i(Rr))throw new TypeError;return Rr}}function oa(Zt){var er=aa(Zt,ze);if(!$i(er))throw new TypeError;var Rr=er.call(Zt);if(!zn(Rr))throw new TypeError;return Rr}function Li(Zt){return Zt.value}function Ki(Zt){var er=Zt.next();return er.done?!1:er}function Hi(Zt){var er=Zt.return;er&&er.call(Zt)}function Ts(Zt){var er=Object.getPrototypeOf(Zt);if(typeof Zt!="function"||Zt===Nt||er!==Nt)return er;var Rr=Zt.prototype,an=Rr&&Object.getPrototypeOf(Rr);if(an==null||an===Object.prototype)return er;var Mn=an.constructor;return typeof Mn!="function"||Mn===Zt?er:Mn}function fe(){var Zt={},er=[],Rr=function(){function bi(vi,Sn,Di){this._index=0,this._keys=vi,this._values=Sn,this._selector=Di}return bi.prototype["@@iterator"]=function(){return this},bi.prototype[ze]=function(){return this},bi.prototype.next=function(){var vi=this._index;if(vi>=0&&vi<this._keys.length){var Sn=this._selector(this._keys[vi],this._values[vi]);return vi+1>=this._keys.length?(this._index=-1,this._keys=er,this._values=er):this._index++,{value:Sn,done:!1}}return{value:void 0,done:!0}},bi.prototype.throw=function(vi){throw this._index>=0&&(this._index=-1,this._keys=er,this._values=er),vi},bi.prototype.return=function(vi){return this._index>=0&&(this._index=-1,this._keys=er,this._values=er),{value:vi,done:!0}},bi}();return function(){function bi(){this._keys=[],this._values=[],this._cacheKey=Zt,this._cacheIndex=-2}return Object.defineProperty(bi.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),bi.prototype.has=function(vi){return this._find(vi,!1)>=0},bi.prototype.get=function(vi){var Sn=this._find(vi,!1);return Sn>=0?this._values[Sn]:void 0},bi.prototype.set=function(vi,Sn){var Di=this._find(vi,!0);return this._values[Di]=Sn,this},bi.prototype.delete=function(vi){var Sn=this._find(vi,!1);if(Sn>=0){for(var Di=this._keys.length,Ri=Sn+1;Ri<Di;Ri++)this._keys[Ri-1]=this._keys[Ri],this._values[Ri-1]=this._values[Ri];return this._keys.length--,this._values.length--,vi===this._cacheKey&&(this._cacheKey=Zt,this._cacheIndex=-2),!0}return!1},bi.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Zt,this._cacheIndex=-2},bi.prototype.keys=function(){return new Rr(this._keys,this._values,an)},bi.prototype.values=function(){return new Rr(this._keys,this._values,Mn)},bi.prototype.entries=function(){return new Rr(this._keys,this._values,Un)},bi.prototype["@@iterator"]=function(){return this.entries()},bi.prototype[ze]=function(){return this.entries()},bi.prototype._find=function(vi,Sn){return this._cacheKey!==vi&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=vi)),this._cacheIndex<0&&Sn&&(this._cacheIndex=this._keys.length,this._keys.push(vi),this._values.push(void 0)),this._cacheIndex},bi}();function an(bi,vi){return bi}function Mn(bi,vi){return vi}function Un(bi,vi){return[bi,vi]}}function ui(){return function(){function Zt(){this._map=new Tt}return Object.defineProperty(Zt.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Zt.prototype.has=function(er){return this._map.has(er)},Zt.prototype.add=function(er){return this._map.set(er,er),this},Zt.prototype.delete=function(er){return this._map.delete(er)},Zt.prototype.clear=function(){this._map.clear()},Zt.prototype.keys=function(){return this._map.keys()},Zt.prototype.values=function(){return this._map.values()},Zt.prototype.entries=function(){return this._map.entries()},Zt.prototype["@@iterator"]=function(){return this.keys()},Zt.prototype[ze]=function(){return this.keys()},Zt}()}function bo(){var Zt=16,er=wt.create(),Rr=an();return function(){function Sn(){this._key=an()}return Sn.prototype.has=function(Di){var Ri=Mn(Di,!1);return Ri!==void 0?wt.has(Ri,this._key):!1},Sn.prototype.get=function(Di){var Ri=Mn(Di,!1);return Ri!==void 0?wt.get(Ri,this._key):void 0},Sn.prototype.set=function(Di,Ri){var ao=Mn(Di,!0);return ao[this._key]=Ri,this},Sn.prototype.delete=function(Di){var Ri=Mn(Di,!1);return Ri!==void 0?delete Ri[this._key]:!1},Sn.prototype.clear=function(){this._key=an()},Sn}();function an(){var Sn;do Sn="@@WeakMap@@"+vi();while(wt.has(er,Sn));return er[Sn]=!0,Sn}function Mn(Sn,Di){if(!W.call(Sn,Rr)){if(!Di)return;Object.defineProperty(Sn,Rr,{value:wt.create()})}return Sn[Rr]}function Un(Sn,Di){for(var Ri=0;Ri<Di;++Ri)Sn[Ri]=Math.random()*255|0;return Sn}function bi(Sn){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(Sn)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(Sn)):Un(new Uint8Array(Sn),Sn):Un(new Array(Sn),Sn)}function vi(){var Sn=bi(Zt);Sn[6]=Sn[6]&79|64,Sn[8]=Sn[8]&191|128;for(var Di="",Ri=0;Ri<Zt;++Ri){var ao=Sn[Ri];(Ri===4||Ri===6||Ri===8)&&(Di+="-"),ao<16&&(Di+="0"),Di+=ao.toString(16).toLowerCase()}return Di}}function cu(Zt){return Zt.__=void 0,delete Zt.__,Zt}})})(me||(me={}))},69848:function(Er){(function(ne,Q){Er.exports=Q()})(this,function(){"use strict";function ne(at,qe,Et,$e,Ht,mr){if(!(Ht-$e<=Et)){var Fr=$e+Ht>>1;Q(at,qe,Fr,$e,Ht,mr%2),ne(at,qe,Et,$e,Fr-1,mr+1),ne(at,qe,Et,Fr+1,Ht,mr+1)}}function Q(at,qe,Et,$e,Ht,mr){for(;Ht>$e;){if(Ht-$e>600){var Fr=Ht-$e+1,Yr=Et-$e+1,S=Math.log(Fr),Se=.5*Math.exp(2*S/3),ke=.5*Math.sqrt(S*Se*(Fr-Se)/Fr)*(Yr-Fr/2<0?-1:1),ut=Math.max($e,Math.floor(Et-Yr*Se/Fr+ke)),ft=Math.min(Ht,Math.floor(Et+(Fr-Yr)*Se/Fr+ke));Q(at,qe,Et,ut,ft,mr)}var kt=qe[2*Et+mr],Ft=$e,yr=Ht;for(Ce(at,qe,$e,Et),qe[2*Ht+mr]>kt&&Ce(at,qe,$e,Ht);Ft<yr;){for(Ce(at,qe,Ft,yr),Ft++,yr--;qe[2*Ft+mr]<kt;)Ft++;for(;qe[2*yr+mr]>kt;)yr--}qe[2*$e+mr]===kt?Ce(at,qe,$e,yr):(yr++,Ce(at,qe,yr,Ht)),yr<=Et&&($e=yr+1),Et<=yr&&(Ht=yr-1)}}function Ce(at,qe,Et,$e){me(at,Et,$e),me(qe,2*Et,2*$e),me(qe,2*Et+1,2*$e+1)}function me(at,qe,Et){var $e=at[qe];at[qe]=at[Et],at[Et]=$e}function g(at,qe,Et,$e,Ht,mr,Fr){for(var Yr=[0,at.length-1,0],S=[],Se,ke;Yr.length;){var ut=Yr.pop(),ft=Yr.pop(),kt=Yr.pop();if(ft-kt<=Fr){for(var Ft=kt;Ft<=ft;Ft++)Se=qe[2*Ft],ke=qe[2*Ft+1],Se>=Et&&Se<=Ht&&ke>=$e&&ke<=mr&&S.push(at[Ft]);continue}var yr=Math.floor((kt+ft)/2);Se=qe[2*yr],ke=qe[2*yr+1],Se>=Et&&Se<=Ht&&ke>=$e&&ke<=mr&&S.push(at[yr]);var Yn=(ut+1)%2;(ut===0?Et<=Se:$e<=ke)&&(Yr.push(kt),Yr.push(yr-1),Yr.push(Yn)),(ut===0?Ht>=Se:mr>=ke)&&(Yr.push(yr+1),Yr.push(ft),Yr.push(Yn))}return S}function Re(at,qe,Et,$e,Ht,mr){for(var Fr=[0,at.length-1,0],Yr=[],S=Ht*Ht;Fr.length;){var Se=Fr.pop(),ke=Fr.pop(),ut=Fr.pop();if(ke-ut<=mr){for(var ft=ut;ft<=ke;ft++)W(qe[2*ft],qe[2*ft+1],Et,$e)<=S&&Yr.push(at[ft]);continue}var kt=Math.floor((ut+ke)/2),Ft=qe[2*kt],yr=qe[2*kt+1];W(Ft,yr,Et,$e)<=S&&Yr.push(at[kt]);var Yn=(Se+1)%2;(Se===0?Et-Ht<=Ft:$e-Ht<=yr)&&(Fr.push(ut),Fr.push(kt-1),Fr.push(Yn)),(Se===0?Et+Ht>=Ft:$e+Ht>=yr)&&(Fr.push(kt+1),Fr.push(ke),Fr.push(Yn))}return Yr}function W(at,qe,Et,$e){var Ht=at-Et,mr=qe-$e;return Ht*Ht+mr*mr}var he=function(at){return at[0]},de=function(at){return at[1]},ze=function(qe,Et,$e,Ht,mr){Et===void 0&&(Et=he),$e===void 0&&($e=de),Ht===void 0&&(Ht=64),mr===void 0&&(mr=Float64Array),this.nodeSize=Ht,this.points=qe;for(var Fr=qe.length<65536?Uint16Array:Uint32Array,Yr=this.ids=new Fr(qe.length),S=this.coords=new mr(qe.length*2),Se=0;Se<qe.length;Se++)Yr[Se]=Se,S[2*Se]=Et(qe[Se]),S[2*Se+1]=$e(qe[Se]);ne(Yr,S,Ht,0,Yr.length-1,0)};ze.prototype.range=function(qe,Et,$e,Ht){return g(this.ids,this.coords,qe,Et,$e,Ht,this.nodeSize)},ze.prototype.within=function(qe,Et,$e){return Re(this.ids,this.coords,qe,Et,$e,this.nodeSize)};var _e={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(at){return at}},tt=Math.fround||function(at){return function(qe){return at[0]=+qe,at[0]}}(new Float32Array(1)),mt=function(qe){this.options=$t(Object.create(_e),qe),this.trees=new Array(this.options.maxZoom+1)};mt.prototype.load=function(qe){var Et=this.options,$e=Et.log,Ht=Et.minZoom,mr=Et.maxZoom,Fr=Et.nodeSize;$e&&console.time("total time");var Yr="prepare "+qe.length+" points";$e&&console.time(Yr),this.points=qe;for(var S=[],Se=0;Se<qe.length;Se++)!qe[Se].geometry||S.push(Nt(qe[Se],Se));this.trees[mr+1]=new ze(S,Y,Xt,Fr,Float32Array),$e&&console.timeEnd(Yr);for(var ke=mr;ke>=Ht;ke--){var ut=+Date.now();S=this._cluster(S,ke),this.trees[ke]=new ze(S,Y,Xt,Fr,Float32Array),$e&&console.log("z%d: %d clusters in %dms",ke,S.length,+Date.now()-ut)}return $e&&console.timeEnd("total time"),this},mt.prototype.getClusters=function(qe,Et){var $e=((qe[0]+180)%360+360)%360-180,Ht=Math.max(-90,Math.min(90,qe[1])),mr=qe[2]===180?180:((qe[2]+180)%360+360)%360-180,Fr=Math.max(-90,Math.min(90,qe[3]));if(qe[2]-qe[0]>=360)$e=-180,mr=180;else if($e>mr){var Yr=this.getClusters([$e,Ht,180,Fr],Et),S=this.getClusters([-180,Ht,mr,Fr],Et);return Yr.concat(S)}for(var Se=this.trees[this._limitZoom(Et)],ke=Se.range(Kt($e),_t(Fr),Kt(mr),_t(Ht)),ut=[],ft=0,kt=ke;ft<kt.length;ft+=1){var Ft=kt[ft],yr=Se.points[Ft];ut.push(yr.numPoints?or(yr):this.points[yr.index])}return ut},mt.prototype.getChildren=function(qe){var Et=this._getOriginId(qe),$e=this._getOriginZoom(qe),Ht="No cluster with the specified id.",mr=this.trees[$e];if(!mr)throw new Error(Ht);var Fr=mr.points[Et];if(!Fr)throw new Error(Ht);for(var Yr=this.options.radius/(this.options.extent*Math.pow(2,$e-1)),S=mr.within(Fr.x,Fr.y,Yr),Se=[],ke=0,ut=S;ke<ut.length;ke+=1){var ft=ut[ke],kt=mr.points[ft];kt.parentId===qe&&Se.push(kt.numPoints?or(kt):this.points[kt.index])}if(Se.length===0)throw new Error(Ht);return Se},mt.prototype.getLeaves=function(qe,Et,$e){Et=Et||10,$e=$e||0;var Ht=[];return this._appendLeaves(Ht,qe,Et,$e,0),Ht},mt.prototype.getTile=function(qe,Et,$e){var Ht=this.trees[this._limitZoom(qe)],mr=Math.pow(2,qe),Fr=this.options,Yr=Fr.extent,S=Fr.radius,Se=S/Yr,ke=($e-Se)/mr,ut=($e+1+Se)/mr,ft={features:[]};return this._addTileFeatures(Ht.range((Et-Se)/mr,ke,(Et+1+Se)/mr,ut),Ht.points,Et,$e,mr,ft),Et===0&&this._addTileFeatures(Ht.range(1-Se/mr,ke,1,ut),Ht.points,mr,$e,mr,ft),Et===mr-1&&this._addTileFeatures(Ht.range(0,ke,Se/mr,ut),Ht.points,-1,$e,mr,ft),ft.features.length?ft:null},mt.prototype.getClusterExpansionZoom=function(qe){for(var Et=this._getOriginZoom(qe)-1;Et<=this.options.maxZoom;){var $e=this.getChildren(qe);if(Et++,$e.length!==1)break;qe=$e[0].properties.cluster_id}return Et},mt.prototype._appendLeaves=function(qe,Et,$e,Ht,mr){for(var Fr=this.getChildren(Et),Yr=0,S=Fr;Yr<S.length;Yr+=1){var Se=S[Yr],ke=Se.properties;if(ke&&ke.cluster?mr+ke.point_count<=Ht?mr+=ke.point_count:mr=this._appendLeaves(qe,ke.cluster_id,$e,Ht,mr):mr<Ht?mr++:qe.push(Se),qe.length===$e)break}return mr},mt.prototype._addTileFeatures=function(qe,Et,$e,Ht,mr,Fr){for(var Yr=0,S=qe;Yr<S.length;Yr+=1){var Se=S[Yr],ke=Et[Se],ut=ke.numPoints,ft=void 0,kt=void 0,Ft=void 0;if(ut)ft=Tt(ke),kt=ke.x,Ft=ke.y;else{var yr=this.points[ke.index];ft=yr.properties,kt=Kt(yr.geometry.coordinates[0]),Ft=_t(yr.geometry.coordinates[1])}var Yn={type:1,geometry:[[Math.round(this.options.extent*(kt*mr-$e)),Math.round(this.options.extent*(Ft*mr-Ht))]],tags:ft},Gr=void 0;ut?Gr=ke.id:this.options.generateId?Gr=ke.index:this.points[ke.index].id&&(Gr=this.points[ke.index].id),Gr!==void 0&&(Yn.id=Gr),Fr.features.push(Yn)}},mt.prototype._limitZoom=function(qe){return Math.max(this.options.minZoom,Math.min(Math.floor(+qe),this.options.maxZoom+1))},mt.prototype._cluster=function(qe,Et){for(var $e=[],Ht=this.options,mr=Ht.radius,Fr=Ht.extent,Yr=Ht.reduce,S=Ht.minPoints,Se=mr/(Fr*Math.pow(2,Et)),ke=0;ke<qe.length;ke++){var ut=qe[ke];if(!(ut.zoom<=Et)){ut.zoom=Et;for(var ft=this.trees[Et+1],kt=ft.within(ut.x,ut.y,Se),Ft=ut.numPoints||1,yr=Ft,Yn=0,Gr=kt;Yn<Gr.length;Yn+=1){var Nn=Gr[Yn],yn=ft.points[Nn];yn.zoom>Et&&(yr+=yn.numPoints||1)}if(yr>Ft&&yr>=S){for(var zn=ut.x*Ft,si=ut.y*Ft,Gn=Yr&&Ft>1?this._map(ut,!0):null,fi=(ke<<5)+(Et+1)+this.points.length,na=0,Ui=kt;na<Ui.length;na+=1){var Ii=Ui[na],$i=ft.points[Ii];if(!($i.zoom<=Et)){$i.zoom=Et;var ia=$i.numPoints||1;zn+=$i.x*ia,si+=$i.y*ia,$i.parentId=fi,Yr&&(Gn||(Gn=this._map(ut,!0)),Yr(Gn,this._map($i)))}}ut.parentId=fi,$e.push(wt(zn/yr,si/yr,fi,yr,Gn))}else if($e.push(ut),yr>1)for(var qa=0,aa=kt;qa<aa.length;qa+=1){var oa=aa[qa],Li=ft.points[oa];Li.zoom<=Et||(Li.zoom=Et,$e.push(Li))}}}return $e},mt.prototype._getOriginId=function(qe){return qe-this.points.length>>5},mt.prototype._getOriginZoom=function(qe){return(qe-this.points.length)%32},mt.prototype._map=function(qe,Et){if(qe.numPoints)return Et?$t({},qe.properties):qe.properties;var $e=this.points[qe.index].properties,Ht=this.options.map($e);return Et&&Ht===$e?$t({},Ht):Ht};function wt(at,qe,Et,$e,Ht){return{x:tt(at),y:tt(qe),zoom:Infinity,id:Et,parentId:-1,numPoints:$e,properties:Ht}}function Nt(at,qe){var Et=at.geometry.coordinates,$e=Et[0],Ht=Et[1];return{x:tt(Kt($e)),y:tt(_t(Ht)),zoom:Infinity,index:qe,parentId:-1}}function or(at){return{type:"Feature",id:at.id,properties:Tt(at),geometry:{type:"Point",coordinates:[ct(at.x),it(at.y)]}}}function Tt(at){var qe=at.numPoints,Et=qe>=1e4?Math.round(qe/1e3)+"k":qe>=1e3?Math.round(qe/100)/10+"k":qe;return $t($t({},at.properties),{cluster:!0,cluster_id:at.id,point_count:qe,point_count_abbreviated:Et})}function Kt(at){return at/360+.5}function _t(at){var qe=Math.sin(at*Math.PI/180),Et=.5-.25*Math.log((1+qe)/(1-qe))/Math.PI;return Et<0?0:Et>1?1:Et}function ct(at){return(at-.5)*360}function it(at){var qe=(180-at*360)*Math.PI/180;return 360*Math.atan(Math.exp(qe))/Math.PI-90}function $t(at,qe){for(var Et in qe)at[Et]=qe[Et];return at}function Y(at){return at.x}function Xt(at){return at.y}return mt})},75752:function(Er){Er.exports.RADIUS=6378137,Er.exports.FLATTENING=1/298.257223563,Er.exports.POLAR_RADIUS=63567523142e-4}}]);
